{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u4f60\u8be5\u8d77\u98de\u4e86 \u559c\u6b22 \u00b6 \u5bc4\u8bed \u00b6 \u5e38\u542c\u4eba\u8bf4\uff0c\u5e74\u8f7b\u5c31\u662f\u8d44\u672c\uff0c\u56e0\u4e3a\u5e74\u8f7b\uff0c\u6240\u4ee5\u6709\u65e0\u9650\u7684\u53ef\u80fd\u3002\u8fd9\u53e5\u8bdd\uff0c\u6211\u53ea\u540c\u610f\u4e00\u534a\u3002\u6211\u4e00\u76f4\u89c9\u5f97\uff0c\u5e74\u8f7b\u4e0d\u662f\u8d44\u672c\uff0c\u5e74\u8f7b\u53c8\u52aa\u529b\u624d\u4f1a\u6210\u4e3a\u8d44\u672c\u3002\u6e05\u695a\u81ea\u5df1\u60f3\u8981\u7684\uff0c\u7136\u540e\u4e00\u6b65\u4e00\u6b65\u63a5\u8fd1\u76ee\u6807\uff0c\u65e2\u6709\u96c4\u5fc3\u4e07\u4e08\u7684\u62b1\u8d1f\u3001\u6c34\u6ef4\u77f3\u7a7f\u7684\u575a\u6301\uff0c\u4e5f\u8981\u6709\u4e0d\u8f7b\u6613\u670d\u8f93\u7684\u52c7\u6c14\u548c\u8fce\u96be\u800c\u4e0a\u7684\u97e7\u52b2\uff01 \u4e00\u9897\u77f3\u69b4\u79cd\u5b50\u7684\u4e09\u79cd\u7ed3\u5c40\uff1a\u653e\u5230\u82b1\u76c6\u91cc\u683d\u79cd\uff0c\u6700\u591a\u53ea\u80fd\u957f\u5230\u534a\u7c73\u591a\u9ad8\uff01\u653e\u5230\u7f38\u91cc\u683d\u79cd\uff0c\u5c31\u80fd\u591f\u957f\u5230\u4e00\u7c73\u591a\u9ad8\uff01\u653e\u5230\u5ead\u9662\u7a7a\u5730\u91cc\u683d\u79cd\uff0c\u5c31\u80fd\u591f\u957f\u5230\u56db\u4e94\u7c73\u9ad8\uff01\u5927\u5883\u754c\u624d\u80fd\u6709\u5927\u80f8\u6000\uff0c\u5927\u683c\u5c40\u624d\u5927\u6709\u4f5c\u4e3a\uff01 \u5982\u679c\u4f60\u4e0d\u80fd\u7ed9\u81ea\u5df1\u4e00\u5f20\u8000\u773c\u7684\u6587\u51ed\u3001\u4e00\u6bb5\u8361\u6c14\u56de\u80a0\u7684\u7231\u60c5\uff0c\u90a3\u4e48\uff0c\u4f60\u8fd8\u53ef\u4ee5\u7ed9\u81ea\u5df1\u4e00\u4e2a\u4e5d\u6210\u4e5d\u4f1a\u906d\u5230\u5632\u7b11\u7684\u68a6\u60f3\u3002\u56e0\u4e3a\uff0c\u603b\u6709\u4e00\u5929\uff0c\u5b83\u4f1a\u8ba9\u4f60\u95ea\u95ea\u53d1\u5149\uff01 \u7528\u4eba\u54c1\u53bb\u611f\u52a8\u522b\u4eba\uff0c\u7528\u6539\u53d8\u53bb\u5f71\u54cd\u522b\u4eba\uff0c\u7528\u72b6\u6001\u53bb\u71c3\u70e7\u522b\u4eba\uff0c\u7528\u884c\u52a8\u53bb\u5e26\u52a8\u522b\u4eba\uff0c\u7528\u9633\u5149\u53bb\u7167\u8000\u522b\u4eba\uff0c\u7528\u575a\u6301\u53bb\u8d62\u5f97\u522b\u4eba\uff0c\u8981\u6c42\u81ea\u5df1\u6bcf\u5929\u90fd\u53bb\u505a\u4e0e\u76ee\u6807\u6709\u5173\u7684\u4e8b\u60c5\uff0c\u54ea\u6015\u6bcf\u5929\u53ea\u8fdb\u6b65\u4e00\u70b9\u70b9\uff0c\u575a\u6301\u4e0b\u6765\u4f60\u5c31\u662f\u6700\u4f18\u79c0\u5353\u8d8a\u7684\uff01\u4e0d\u5fd8\u521d\u5fc3\uff0c\u65b9\u5f97\u59cb\u7ec8\uff01\u611f\u6069\u4e00\u5207\uff01\u7528\u7231\u505a\u4eba\uff0c\u7528\u5fc3\u505a\u4e8b\uff01 \u5982\u679c\u6709\u4e00\u5929\uff0c\u4f60\u7684\u52aa\u529b\u914d\u5f97\u4e0a\u4f60\u7684\u68a6\u60f3\uff0c\u90a3\u4e48\u4f60\u7684\u68a6\u60f3\u4e5f\u7edd\u5bf9\u4e0d\u4f1a\u8f9c\u8d1f\u4f60\u7684\u52aa\u529b\u3002 \u9e70\uff0c\u6ca1\u4eba\u9f13\u638c\uff0c\u4e5f\u5728\u98de\u7fd4\u3002\u8349\uff0c\u6ca1\u4eba\u5173\u6ce8\uff0c\u4e5f\u5728\u6210\u957f\u3002\u6df1\u5c71\u7684\u91ce\u82b1\uff0c\u6ca1\u4eba\u6b23\u8d4f\uff0c\u4e5f\u5728\u82ac\u82b3\u3002\u505a\u4e8b\uff0c\u4e0d\u9700\u8981\u4eba\u4eba\u90fd\u7406\u89e3\uff0c\u53ea\u9700\u8981\u5c3d\u5fc3\u5c3d\u529b\u3002\u505a\u4eba\uff0c\u4e0d\u9700\u8981\u4eba\u4eba\u90fd\u559c\u6b22\uff0c\u53ea\u9700\u8981\u5766\u5766\u8361\u8361\u3002\u6267\u7740\uff0c\u6ce8\u5b9a\u6709\u5b64\u72ec\u4e0e\u5f77\u5fa8\u3002\u5c31\u7b97\u904d\u4f53\u9cde\u4f24\uff0c\u4e5f\u8981\u6491\u8d77\u575a\u5f3a\u3002\u4eba\u751f\u4e00\u4e16,\u8349\u6728\u4e00\u79cb\u3002\u4e00\u8f88\u5b50\uff0c\u5e76\u4e0d\u957f\uff0c\u65e2\u7136\u6765\u4e86\uff0c\u5c31\u8981\u5c55\u73b0\u7cbe\u5f69\uff0c\u6d3b\u5f97\u6f02\u4eae\uff01 \u8fbe\u5230\u76ee\u6807\u7684\u6700\u597d\u529e\u6cd5\uff0c\u5c31\u662f\u6295\u5165\u81ea\u5df1\u767e\u5206\u4e4b\u767e\u7684\u65f6\u95f4\u548c\u7cbe\u529b\u53bb\u5b8c\u6210\u5b83\u3002 \u5973\u4eba\u5343\u4e07\u8981\u5de5\u4f5c\uff0c\u5343\u4e07\u8981\u72ec\u7acb\uff0c\u5343\u4e07\u8981\u81ea\u4fe1\u3002\u4e0d\u8981\u8ba9\u9633\u53f0\uff0c\u7076\u53f0\uff0c\u6210\u4e3a\u4f60\u7684\u4eba\u751f\u821e\u53f0\u3002\u4e0d\u8981\u8ba9\u6cb9\u5473\uff0c\u70df\u5473\uff0c\u6210\u4e3a\u4f60\u7684\u5973\u4eba\u5473\uff01 \u751f\u6d3b\u5c31\u662f\u8fd9\u6837\uff0c\u811a\u957f\u5728\u81ea\u5df1\u8eab\u4e0a\uff0c\u5f80\u524d\u8d70\u5c31\u5bf9\u4e86\uff0c\u76f4\u5230\u5411\u5f80\u7684\u98ce\u666f\uff0c\u53d8\u6210\u8d70\u8fc7\u7684\u5730\u65b9\uff01 \u8fd0\u6c14\u662f\u52aa\u529b\u7684\u9644\u5c5e\u54c1\u3002\u6ca1\u6709\u7ecf\u8fc7\u5b9e\u529b\u7684\u539f\u59cb\u79ef\u7d2f\uff0c\u7ed9\u4f60\u8fd0\u6c14\u4f60\u4e5f\u6293\u4e0d\u4f4f\u3002\u4e0a\u5929\u7ed9\u4e88\u6bcf\u4e2a\u4eba\u7684\u90fd\u4e00\u6837\uff0c\u4f46\u6bcf\u4e2a\u4eba\u7684\u51c6\u5907\u5374\u4e0d\u4e00\u6837\u3002\u4e0d\u8981\u7fa1\u6155\u90a3\u4e9b\u603b\u80fd\u649e\u5927\u8fd0\u7684\u4eba\uff0c\u4f60\u5fc5\u987b\u5f88\u52aa\u529b\uff0c\u624d\u80fd\u9047\u4e0a\u597d\u8fd0\u6c14\u3002","title":"\u4e00. \u4ecb\u7ecd"},{"location":"#_1","text":"","title":"\u559c\u6b22"},{"location":"#_2","text":"\u5e38\u542c\u4eba\u8bf4\uff0c\u5e74\u8f7b\u5c31\u662f\u8d44\u672c\uff0c\u56e0\u4e3a\u5e74\u8f7b\uff0c\u6240\u4ee5\u6709\u65e0\u9650\u7684\u53ef\u80fd\u3002\u8fd9\u53e5\u8bdd\uff0c\u6211\u53ea\u540c\u610f\u4e00\u534a\u3002\u6211\u4e00\u76f4\u89c9\u5f97\uff0c\u5e74\u8f7b\u4e0d\u662f\u8d44\u672c\uff0c\u5e74\u8f7b\u53c8\u52aa\u529b\u624d\u4f1a\u6210\u4e3a\u8d44\u672c\u3002\u6e05\u695a\u81ea\u5df1\u60f3\u8981\u7684\uff0c\u7136\u540e\u4e00\u6b65\u4e00\u6b65\u63a5\u8fd1\u76ee\u6807\uff0c\u65e2\u6709\u96c4\u5fc3\u4e07\u4e08\u7684\u62b1\u8d1f\u3001\u6c34\u6ef4\u77f3\u7a7f\u7684\u575a\u6301\uff0c\u4e5f\u8981\u6709\u4e0d\u8f7b\u6613\u670d\u8f93\u7684\u52c7\u6c14\u548c\u8fce\u96be\u800c\u4e0a\u7684\u97e7\u52b2\uff01 \u4e00\u9897\u77f3\u69b4\u79cd\u5b50\u7684\u4e09\u79cd\u7ed3\u5c40\uff1a\u653e\u5230\u82b1\u76c6\u91cc\u683d\u79cd\uff0c\u6700\u591a\u53ea\u80fd\u957f\u5230\u534a\u7c73\u591a\u9ad8\uff01\u653e\u5230\u7f38\u91cc\u683d\u79cd\uff0c\u5c31\u80fd\u591f\u957f\u5230\u4e00\u7c73\u591a\u9ad8\uff01\u653e\u5230\u5ead\u9662\u7a7a\u5730\u91cc\u683d\u79cd\uff0c\u5c31\u80fd\u591f\u957f\u5230\u56db\u4e94\u7c73\u9ad8\uff01\u5927\u5883\u754c\u624d\u80fd\u6709\u5927\u80f8\u6000\uff0c\u5927\u683c\u5c40\u624d\u5927\u6709\u4f5c\u4e3a\uff01 \u5982\u679c\u4f60\u4e0d\u80fd\u7ed9\u81ea\u5df1\u4e00\u5f20\u8000\u773c\u7684\u6587\u51ed\u3001\u4e00\u6bb5\u8361\u6c14\u56de\u80a0\u7684\u7231\u60c5\uff0c\u90a3\u4e48\uff0c\u4f60\u8fd8\u53ef\u4ee5\u7ed9\u81ea\u5df1\u4e00\u4e2a\u4e5d\u6210\u4e5d\u4f1a\u906d\u5230\u5632\u7b11\u7684\u68a6\u60f3\u3002\u56e0\u4e3a\uff0c\u603b\u6709\u4e00\u5929\uff0c\u5b83\u4f1a\u8ba9\u4f60\u95ea\u95ea\u53d1\u5149\uff01 \u7528\u4eba\u54c1\u53bb\u611f\u52a8\u522b\u4eba\uff0c\u7528\u6539\u53d8\u53bb\u5f71\u54cd\u522b\u4eba\uff0c\u7528\u72b6\u6001\u53bb\u71c3\u70e7\u522b\u4eba\uff0c\u7528\u884c\u52a8\u53bb\u5e26\u52a8\u522b\u4eba\uff0c\u7528\u9633\u5149\u53bb\u7167\u8000\u522b\u4eba\uff0c\u7528\u575a\u6301\u53bb\u8d62\u5f97\u522b\u4eba\uff0c\u8981\u6c42\u81ea\u5df1\u6bcf\u5929\u90fd\u53bb\u505a\u4e0e\u76ee\u6807\u6709\u5173\u7684\u4e8b\u60c5\uff0c\u54ea\u6015\u6bcf\u5929\u53ea\u8fdb\u6b65\u4e00\u70b9\u70b9\uff0c\u575a\u6301\u4e0b\u6765\u4f60\u5c31\u662f\u6700\u4f18\u79c0\u5353\u8d8a\u7684\uff01\u4e0d\u5fd8\u521d\u5fc3\uff0c\u65b9\u5f97\u59cb\u7ec8\uff01\u611f\u6069\u4e00\u5207\uff01\u7528\u7231\u505a\u4eba\uff0c\u7528\u5fc3\u505a\u4e8b\uff01 \u5982\u679c\u6709\u4e00\u5929\uff0c\u4f60\u7684\u52aa\u529b\u914d\u5f97\u4e0a\u4f60\u7684\u68a6\u60f3\uff0c\u90a3\u4e48\u4f60\u7684\u68a6\u60f3\u4e5f\u7edd\u5bf9\u4e0d\u4f1a\u8f9c\u8d1f\u4f60\u7684\u52aa\u529b\u3002 \u9e70\uff0c\u6ca1\u4eba\u9f13\u638c\uff0c\u4e5f\u5728\u98de\u7fd4\u3002\u8349\uff0c\u6ca1\u4eba\u5173\u6ce8\uff0c\u4e5f\u5728\u6210\u957f\u3002\u6df1\u5c71\u7684\u91ce\u82b1\uff0c\u6ca1\u4eba\u6b23\u8d4f\uff0c\u4e5f\u5728\u82ac\u82b3\u3002\u505a\u4e8b\uff0c\u4e0d\u9700\u8981\u4eba\u4eba\u90fd\u7406\u89e3\uff0c\u53ea\u9700\u8981\u5c3d\u5fc3\u5c3d\u529b\u3002\u505a\u4eba\uff0c\u4e0d\u9700\u8981\u4eba\u4eba\u90fd\u559c\u6b22\uff0c\u53ea\u9700\u8981\u5766\u5766\u8361\u8361\u3002\u6267\u7740\uff0c\u6ce8\u5b9a\u6709\u5b64\u72ec\u4e0e\u5f77\u5fa8\u3002\u5c31\u7b97\u904d\u4f53\u9cde\u4f24\uff0c\u4e5f\u8981\u6491\u8d77\u575a\u5f3a\u3002\u4eba\u751f\u4e00\u4e16,\u8349\u6728\u4e00\u79cb\u3002\u4e00\u8f88\u5b50\uff0c\u5e76\u4e0d\u957f\uff0c\u65e2\u7136\u6765\u4e86\uff0c\u5c31\u8981\u5c55\u73b0\u7cbe\u5f69\uff0c\u6d3b\u5f97\u6f02\u4eae\uff01 \u8fbe\u5230\u76ee\u6807\u7684\u6700\u597d\u529e\u6cd5\uff0c\u5c31\u662f\u6295\u5165\u81ea\u5df1\u767e\u5206\u4e4b\u767e\u7684\u65f6\u95f4\u548c\u7cbe\u529b\u53bb\u5b8c\u6210\u5b83\u3002 \u5973\u4eba\u5343\u4e07\u8981\u5de5\u4f5c\uff0c\u5343\u4e07\u8981\u72ec\u7acb\uff0c\u5343\u4e07\u8981\u81ea\u4fe1\u3002\u4e0d\u8981\u8ba9\u9633\u53f0\uff0c\u7076\u53f0\uff0c\u6210\u4e3a\u4f60\u7684\u4eba\u751f\u821e\u53f0\u3002\u4e0d\u8981\u8ba9\u6cb9\u5473\uff0c\u70df\u5473\uff0c\u6210\u4e3a\u4f60\u7684\u5973\u4eba\u5473\uff01 \u751f\u6d3b\u5c31\u662f\u8fd9\u6837\uff0c\u811a\u957f\u5728\u81ea\u5df1\u8eab\u4e0a\uff0c\u5f80\u524d\u8d70\u5c31\u5bf9\u4e86\uff0c\u76f4\u5230\u5411\u5f80\u7684\u98ce\u666f\uff0c\u53d8\u6210\u8d70\u8fc7\u7684\u5730\u65b9\uff01 \u8fd0\u6c14\u662f\u52aa\u529b\u7684\u9644\u5c5e\u54c1\u3002\u6ca1\u6709\u7ecf\u8fc7\u5b9e\u529b\u7684\u539f\u59cb\u79ef\u7d2f\uff0c\u7ed9\u4f60\u8fd0\u6c14\u4f60\u4e5f\u6293\u4e0d\u4f4f\u3002\u4e0a\u5929\u7ed9\u4e88\u6bcf\u4e2a\u4eba\u7684\u90fd\u4e00\u6837\uff0c\u4f46\u6bcf\u4e2a\u4eba\u7684\u51c6\u5907\u5374\u4e0d\u4e00\u6837\u3002\u4e0d\u8981\u7fa1\u6155\u90a3\u4e9b\u603b\u80fd\u649e\u5927\u8fd0\u7684\u4eba\uff0c\u4f60\u5fc5\u987b\u5f88\u52aa\u529b\uff0c\u624d\u80fd\u9047\u4e0a\u597d\u8fd0\u6c14\u3002","title":"\u5bc4\u8bed"},{"location":"contact/","text":"E-mail\u5730\u5740: 610658552@qq.com caimengzhi","title":"\u516d. \u8054\u7cfb\u65b9\u5f0f"},{"location":"recommend/","text":"\u5982\u679c\u5e0c\u671b\u81ea\u5df1\u6240\u5199\u7684markdown\u53ef\u4ee5\u517c\u5bb9\u5404\u4e2amarkdown\u7f16\u8f91\u5668\uff0c\u90a3\u4e48\u53ea\u9700\u4e86\u89e3markdown\u7684\u4f20\u7edf\u8bed\u6cd5\u5373\u53ef\uff0c\u8fd9\u91cc\u63a8\u8350\u4e00\u7bc7\u6587\u7ae0 Markdown\u57fa\u672c\u8bed\u6cd5 \u3002 \u5982\u679c\u60f3\u8ba9\u81ea\u5df1\u6240\u5199\u7684markdown\u53d1\u5e03\u5230web\u670d\u52a1\u5668\uff0c\u4f8b\u5982GitHub Pages\u3001\u81ea\u5df1\u642d\u5efa\u7684HTTP Server\uff0c\u90a3\u4e48\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u672c\u6587\u6240\u4ecb\u7ecd\u7684\u8bed\u6cd5\uff0c\u4ee5\u5b9e\u73b0\u4e30\u5bcc\u591a\u6837\u7684\u6e32\u67d3\u6548\u679c\u3002 \u7b14\u8005\u5efa\u8bae\uff1a\u5c3d\u91cf\u4f7f\u7528\u4f20\u7edf\u8bed\u6cd5\uff0c\u53ea\u5728\u5fc5\u8981\u65f6\u5019\u624d\u4f7f\u7528\u672c\u6587\u4ecb\u7ecd\u7684\u8bed\u6cd5\u3002\u56e0\u4e3a\u6392\u7248\u7b80\u6d01\u3001\u6761\u7406\u6e05\u6670\u624d\u80fd\u5e26\u6765\u6700\u8212\u670d\u7684\u9605\u8bfb\u611f\u53d7\u3002","title":"\u4e94. \u4f7f\u7528\u5efa\u8bae"},{"location":"appendix/baidu_tongji/","text":"\u5148\u5728\u767e\u5ea6\u7edf\u8ba1\u91cc\u521b\u5efa\u6dfb\u52a0\u7ad9\u70b9\uff0c\u4ee5\u672c\u7ad9\u4e3a\u4f8b: \u786e\u5b9a\u540e\u4f1a\u770b\u5230javascript\u4ee3\u7801\uff0c\u590d\u5236\u4ee3\u7801 \u5728docs\u76ee\u5f55\u4e0b\u65b0\u5efajs\u76ee\u5f55\uff0c\u5e76\u5728docs/js\u76ee\u5f55\u91cc\u653e\u7f6ebaidu-tongji.js\uff0c\u5c06\u590d\u5236\u7684\u4ee3\u7801\u7c98\u8d34\u8fdb\u6765\uff0c\u4ee5\u672c\u7ad9\u4e3a\u4f8b: var _hmt = _hmt || []; ( function () { var hm = document . createElement ( \"script\" ); hm . src = \"https://hm.baidu.com/hm.js?51fafb2ac8f80ecf43b05bb4cc281020\" ; var s = document . getElementsByTagName ( \"script\" )[ 0 ]; s . parentNode . insertBefore ( hm , s ); })(); \u6700\u540e\u5728mkdocs.yml\u91cc\u65b0\u589e\u5982\u4e0b\u914d\u7f6e: extra_javascript : - 'js/baidu-tongji.js' \u6548\u679c: js\u4f1a\u81ea\u52a8\u52a0\u5728 \u524d\uff0c\u4ee5\u672c\u7ad9\u4e3a\u4f8b:","title":"3. \u6dfb\u52a0\u767e\u5ea6\u7edf\u8ba1"},{"location":"appendix/color/","text":"\u4ecb\u7ecd \u00b6 mkdocs-material\u652f\u6301google material ui\u89c4\u8303\u5b9a\u4e49\u768419\u79cd\u4e3b\u4f53\u914d\u8272\u548c16\u79cd\u9f20\u6807\u60ac\u505c\u8d85\u94fe\u63a5\u6587\u5b57\u914d\u8272 \u4f7f\u7528 \u00b6 \u5728mkdocs.yml\u91cc\u6dfb\u52a0\u914d\u7f6e\uff0c\u4ee5\u672c\u7ad9\u4e3a\u4f8b: extra : palette : primary : 'Blue Grey' accent : 'Pink' primary\u548caccent\u7684\u9ed8\u8ba4\u503c\u5747\u662f\"Indigo\" 19\u79cd\u4e3b\u4f53\u914d\u8272 \u00b6 \u9f20\u6807\u70b9\u51fb\u5373\u53ef\u4e34\u65f6\u6539\u53d8\u5f53\u524d\u9875\u4e3b\u4f53\u989c\u8272 Red Pink Purple Deep Purple Indigo Blue Light Blue Cyan Teal Green Light Green Lime Yellow Amber Orange Deep Orange Brown Grey Blue Grey var buttons = document.querySelectorAll(\"button[data-md-color-primary]\"); Array.prototype.forEach.call(buttons, function(button) { button.addEventListener(\"click\", function() { document.body.dataset.mdColorPrimary = this.dataset.mdColorPrimary; }) }) 16\u79cd\u9f20\u6807\u60ac\u505c\u8d85\u94fe\u63a5\u6587\u5b57\u914d\u8272 \u00b6 \u9f20\u6807\u70b9\u51fb\u5373\u53ef\u4e34\u65f6\u6539\u53d8\u5f53\u524d\u9875\u9f20\u6807\u60ac\u505c\u8d85\u94fe\u63a5\u6587\u5b57\u989c\u8272 Red Pink Purple Deep Purple Indigo Blue Light Blue Cyan Teal Green Light Green Lime Yellow Amber Orange Deep Orange var buttons = document.querySelectorAll(\"button[data-md-color-accent]\"); Array.prototype.forEach.call(buttons, function(button) { button.addEventListener(\"click\", function() { document.body.dataset.mdColorAccent = this.dataset.mdColorAccent; }) })","title":"4. \u914d\u8272"},{"location":"appendix/color/#_1","text":"mkdocs-material\u652f\u6301google material ui\u89c4\u8303\u5b9a\u4e49\u768419\u79cd\u4e3b\u4f53\u914d\u8272\u548c16\u79cd\u9f20\u6807\u60ac\u505c\u8d85\u94fe\u63a5\u6587\u5b57\u914d\u8272","title":"\u4ecb\u7ecd"},{"location":"appendix/color/#_2","text":"\u5728mkdocs.yml\u91cc\u6dfb\u52a0\u914d\u7f6e\uff0c\u4ee5\u672c\u7ad9\u4e3a\u4f8b: extra : palette : primary : 'Blue Grey' accent : 'Pink' primary\u548caccent\u7684\u9ed8\u8ba4\u503c\u5747\u662f\"Indigo\"","title":"\u4f7f\u7528"},{"location":"appendix/color/#19","text":"\u9f20\u6807\u70b9\u51fb\u5373\u53ef\u4e34\u65f6\u6539\u53d8\u5f53\u524d\u9875\u4e3b\u4f53\u989c\u8272 Red Pink Purple Deep Purple Indigo Blue Light Blue Cyan Teal Green Light Green Lime Yellow Amber Orange Deep Orange Brown Grey Blue Grey var buttons = document.querySelectorAll(\"button[data-md-color-primary]\"); Array.prototype.forEach.call(buttons, function(button) { button.addEventListener(\"click\", function() { document.body.dataset.mdColorPrimary = this.dataset.mdColorPrimary; }) })","title":"19\u79cd\u4e3b\u4f53\u914d\u8272"},{"location":"appendix/color/#16","text":"\u9f20\u6807\u70b9\u51fb\u5373\u53ef\u4e34\u65f6\u6539\u53d8\u5f53\u524d\u9875\u9f20\u6807\u60ac\u505c\u8d85\u94fe\u63a5\u6587\u5b57\u989c\u8272 Red Pink Purple Deep Purple Indigo Blue Light Blue Cyan Teal Green Light Green Lime Yellow Amber Orange Deep Orange var buttons = document.querySelectorAll(\"button[data-md-color-accent]\"); Array.prototype.forEach.call(buttons, function(button) { button.addEventListener(\"click\", function() { document.body.dataset.mdColorAccent = this.dataset.mdColorAccent; }) })","title":"16\u79cd\u9f20\u6807\u60ac\u505c\u8d85\u94fe\u63a5\u6587\u5b57\u914d\u8272"},{"location":"appendix/emoji_shortname/","text":"\u8be5\u8868\u683c\u4e3aemojione-3.1.2(pymdownx-4.0\u96c6\u6210)\u7684\u5168\u540d\u548c\u77ed\u540d\u6620\u5c04\u8868\uff0c\u51712666\u4e2a \u5168\u540d \u77ed\u540d hundred points :100: input numbers :1234: pool 8 ball :8ball: A button (blood type) :a: AB button (blood type) :ab: input latin letters :abc: input latin lowercase :abcd: Japanese \\u201cacceptable\\u201d button :accept: adult :adult: adult: light skin tone :adult_tone1: adult: medium-light skin tone :adult_tone2: adult: medium skin tone :adult_tone3: adult: medium-dark skin tone :adult_tone4: adult: dark skin tone :adult_tone5: aerial tramway :aerial_tramway: airplane :airplane: airplane arrival :airplane_arriving: airplane departure :airplane_departure: small airplane :airplane_small: alarm clock :alarm_clock: alembic :alembic: alien :alien: ambulance :ambulance: amphora :amphora: anchor :anchor: baby angel :angel: baby angel: light skin tone :angel_tone1: baby angel: medium-light skin tone :angel_tone2: baby angel: medium skin tone :angel_tone3: baby angel: medium-dark skin tone :angel_tone4: baby angel: dark skin tone :angel_tone5: anger symbol :anger: right anger bubble :anger_right: angry face :angry: anguished face :anguished: ant :ant: red apple :apple: Aquarius :aquarius: Aries :aries: reverse button :arrow_backward: fast down button :arrow_double_down: fast up button :arrow_double_up: down arrow :arrow_down: down button :arrow_down_small: play button :arrow_forward: right arrow curving down :arrow_heading_down: right arrow curving up :arrow_heading_up: left arrow :arrow_left: down-left arrow :arrow_lower_left: down-right arrow :arrow_lower_right: right arrow :arrow_right: left arrow curving right :arrow_right_hook: up arrow :arrow_up: up-down arrow :arrow_up_down: up button :arrow_up_small: up-left arrow :arrow_upper_left: up-right arrow :arrow_upper_right: clockwise vertical arrows :arrows_clockwise: anticlockwise arrows button :arrows_counterclockwise: artist palette :art: articulated lorry :articulated_lorry: keycap: * :asterisk: asterisk :asterisk_symbol: astonished face :astonished: running shoe :athletic_shoe: ATM sign :atm: atom symbol :atom: avocado :avocado: B button (blood type) :b: baby :baby: baby bottle :baby_bottle: baby chick :baby_chick: baby symbol :baby_symbol: baby: light skin tone :baby_tone1: baby: medium-light skin tone :baby_tone2: baby: medium skin tone :baby_tone3: baby: medium-dark skin tone :baby_tone4: baby: dark skin tone :baby_tone5: BACK arrow :back: bacon :bacon: badminton :badminton: baggage claim :baggage_claim: balloon :balloon: ballot box with ballot :ballot_box: ballot box with check :ballot_box_with_check: pine decoration :bamboo: banana :banana: double exclamation mark :bangbang: bank :bank: bar chart :bar_chart: barber pole :barber: baseball :baseball: basketball :basketball: bat :bat: person taking bath :bath: person taking bath: light skin tone :bath_tone1: person taking bath: medium-light skin tone :bath_tone2: person taking bath: medium skin tone :bath_tone3: person taking bath: medium-dark skin tone :bath_tone4: person taking bath: dark skin tone :bath_tone5: bathtub :bathtub: battery :battery: beach with umbrella :beach: umbrella on ground :beach_umbrella: bear face :bear: bearded person :bearded_person: bearded person: light skin tone :bearded_person_tone1: bearded person: medium-light skin tone :bearded_person_tone2: bearded person: medium skin tone :bearded_person_tone3: bearded person: medium-dark skin tone :bearded_person_tone4: bearded person: dark skin tone :bearded_person_tone5: bed :bed: honeybee :bee: beer mug :beer: clinking beer mugs :beers: lady beetle :beetle: Japanese symbol for beginner :beginner: bell :bell: bellhop bell :bellhop: bento box :bento: bicycle :bike: bikini :bikini: billed cap :billed_cap: biohazard :biohazard: bird :bird: birthday cake :birthday: black circle :black_circle: black heart :black_heart: joker :black_joker: black large square :black_large_square: black medium-small square :black_medium_small_square: black medium square :black_medium_square: black nib :black_nib: black small square :black_small_square: black square button :black_square_button: blond-haired man :blond-haired_man: blond-haired man: light skin tone :blond-haired_man_tone1: blond-haired man: medium-light skin tone :blond-haired_man_tone2: blond-haired man: medium skin tone :blond-haired_man_tone3: blond-haired man: medium-dark skin tone :blond-haired_man_tone4: blond-haired man: dark skin tone :blond-haired_man_tone5: blond-haired woman :blond-haired_woman: blond-haired woman: light skin tone :blond-haired_woman_tone1: blond-haired woman: medium-light skin tone :blond-haired_woman_tone2: blond-haired woman: medium skin tone :blond-haired_woman_tone3: blond-haired woman: medium-dark skin tone :blond-haired_woman_tone4: blond-haired woman: dark skin tone :blond-haired_woman_tone5: blond-haired person :blond_haired_person: blond-haired person: light skin tone :blond_haired_person_tone1: blond-haired person: medium-light skin tone :blond_haired_person_tone2: blond-haired person: medium skin tone :blond_haired_person_tone3: blond-haired person: medium-dark skin tone :blond_haired_person_tone4: blond-haired person: dark skin tone :blond_haired_person_tone5: blossom :blossom: blowfish :blowfish: blue book :blue_book: sport utility vehicle :blue_car: blue circle :blue_circle: blue heart :blue_heart: smiling face with smiling eyes :blush: boar :boar: bomb :bomb: open book :book: bookmark :bookmark: bookmark tabs :bookmark_tabs: books :books: collision :boom: woman\\u2019s boot :boot: bouquet :bouquet: bow and arrow :bow_and_arrow: bowl with spoon :bowl_with_spoon: bowling :bowling: boxing glove :boxing_glove: boy :boy: boy: light skin tone :boy_tone1: boy: medium-light skin tone :boy_tone2: boy: medium skin tone :boy_tone3: boy: medium-dark skin tone :boy_tone4: boy: dark skin tone :boy_tone5: brain :brain: bread :bread: breast-feeding :breast_feeding: breast-feeding: light skin tone :breast_feeding_tone1: breast-feeding: medium-light skin tone :breast_feeding_tone2: breast-feeding: medium skin tone :breast_feeding_tone3: breast-feeding: medium-dark skin tone :breast_feeding_tone4: breast-feeding: dark skin tone :breast_feeding_tone5: bride with veil :bride_with_veil: bride with veil: light skin tone :bride_with_veil_tone1: bride with veil: medium-light skin tone :bride_with_veil_tone2: bride with veil: medium skin tone :bride_with_veil_tone3: bride with veil: medium-dark skin tone :bride_with_veil_tone4: bride with veil: dark skin tone :bride_with_veil_tone5: bridge at night :bridge_at_night: briefcase :briefcase: broccoli :broccoli: broken heart :broken_heart: bug :bug: light bulb :bulb: high-speed train with bullet nose :bullettrain_front: high-speed train :bullettrain_side: burrito :burrito: bus :bus: bus stop :busstop: bust in silhouette :bust_in_silhouette: busts in silhouette :busts_in_silhouette: butterfly :butterfly: cactus :cactus: shortcake :cake: tear-off calendar :calendar: spiral calendar :calendar_spiral: call me hand :call_me: call me hand: light skin tone :call_me_tone1: call me hand: medium-light skin tone :call_me_tone2: call me hand: medium skin tone :call_me_tone3: call me hand: medium-dark skin tone :call_me_tone4: call me hand: dark skin tone :call_me_tone5: mobile phone with arrow :calling: two-hump camel :camel: camera :camera: camera with flash :camera_with_flash: camping :camping: Cancer :cancer: candle :candle: candy :candy: canned food :canned_food: canoe :canoe: input latin uppercase :capital_abcd: Capricorn :capricorn: card file box :card_box: card index :card_index: carousel horse :carousel_horse: carrot :carrot: cat :cat2: cat face :cat: optical disk :cd: chains :chains: bottle with popping cork :champagne: clinking glasses :champagne_glass: chart increasing with yen :chart: chart decreasing :chart_with_downwards_trend: chart increasing :chart_with_upwards_trend: chequered flag :checkered_flag: cheese wedge :cheese: cherries :cherries: cherry blossom :cherry_blossom: chestnut :chestnut: chicken :chicken: child :child: child: light skin tone :child_tone1: child: medium-light skin tone :child_tone2: child: medium skin tone :child_tone3: child: medium-dark skin tone :child_tone4: child: dark skin tone :child_tone5: children crossing :children_crossing: chipmunk :chipmunk: chocolate bar :chocolate_bar: chopsticks :chopsticks: Christmas tree :christmas_tree: church :church: cinema :cinema: circus tent :circus_tent: cityscape at dusk :city_dusk: sunset :city_sunset: cityscape :cityscape: CL button :cl: clapping hands :clap: clapping hands: light skin tone :clap_tone1: clapping hands: medium-light skin tone :clap_tone2: clapping hands: medium skin tone :clap_tone3: clapping hands: medium-dark skin tone :clap_tone4: clapping hands: dark skin tone :clap_tone5: clapper board :clapper: classical building :classical_building: clipboard :clipboard: ten-thirty :clock1030: ten o\\u2019clock :clock10: eleven-thirty :clock1130: eleven o\\u2019clock :clock11: twelve-thirty :clock1230: twelve o\\u2019clock :clock12: one-thirty :clock130: one o\\u2019clock :clock1: two-thirty :clock230: two o\\u2019clock :clock2: three-thirty :clock330: three o\\u2019clock :clock3: four-thirty :clock430: four o\\u2019clock :clock4: five-thirty :clock530: five o\\u2019clock :clock5: six-thirty :clock630: six o\\u2019clock :clock6: seven-thirty :clock730: seven o\\u2019clock :clock7: eight-thirty :clock830: eight o\\u2019clock :clock8: nine-thirty :clock930: nine o\\u2019clock :clock9: mantelpiece clock :clock: closed book :closed_book: locked with key :closed_lock_with_key: closed umbrella :closed_umbrella: cloud :cloud: cloud with lightning :cloud_lightning: cloud with rain :cloud_rain: cloud with snow :cloud_snow: tornado :cloud_tornado: clown face :clown: club suit :clubs: coat :coat: cocktail glass :cocktail: coconut :coconut: hot beverage :coffee: coffin :coffin: face with open mouth & cold sweat :cold_sweat: comet :comet: clamp :compression: laptop computer :computer: confetti ball :confetti_ball: confounded face :confounded: confused face :confused: Japanese \\u201ccongratulations\\u201d button :congratulations: construction :construction: building construction :construction_site: construction worker :construction_worker: construction worker: light skin tone :construction_worker_tone1: construction worker: medium-light skin tone :construction_worker_tone2: construction worker: medium skin tone :construction_worker_tone3: construction worker: medium-dark skin tone :construction_worker_tone4: construction worker: dark skin tone :construction_worker_tone5: control knobs :control_knobs: convenience store :convenience_store: cookie :cookie: cooking :cooking: COOL button :cool: copyright :copyright: ear of corn :corn: couch and lamp :couch: man and woman holding hands :couple: couple with heart: man, man :couple_mm: couple with heart :couple_with_heart: couple with heart: woman, man :couple_with_heart_woman_man: couple with heart: woman, woman :couple_ww: kiss :couplekiss: cow :cow2: cow face :cow: cowboy hat face :cowboy: crab :crab: crayon :crayon: crazy face :crazy_face: credit card :credit_card: crescent moon :crescent_moon: cricket :cricket: cricket game :cricket_game: crocodile :crocodile: croissant :croissant: latin cross :cross: crossed flags :crossed_flags: crossed swords :crossed_swords: crown :crown: passenger ship :cruise_ship: crying face :cry: crying cat face :crying_cat_face: crystal ball :crystal_ball: cucumber :cucumber: cup with straw :cup_with_straw: heart with arrow :cupid: curling stone :curling_stone: curly loop :curly_loop: currency exchange :currency_exchange: curry rice :curry: custard :custard: customs :customs: cut of meat :cut_of_meat: cyclone :cyclone: dagger :dagger: woman dancing :dancer: woman dancing: light skin tone :dancer_tone1: woman dancing: medium-light skin tone :dancer_tone2: woman dancing: medium skin tone :dancer_tone3: woman dancing: medium-dark skin tone :dancer_tone4: woman dancing: dark skin tone :dancer_tone5: dango :dango: sunglasses :dark_sunglasses: direct hit :dart: dashing away :dash: calendar :date: deciduous tree :deciduous_tree: deer :deer: department store :department_store: desert :desert: desktop computer :desktop: detective :detective: detective: light skin tone :detective_tone1: detective: medium-light skin tone :detective_tone2: detective: medium skin tone :detective_tone3: detective: medium-dark skin tone :detective_tone4: detective: dark skin tone :detective_tone5: diamond with a dot :diamond_shape_with_a_dot_inside: diamond suit :diamonds: digit eight :digit_eight: digit five :digit_five: digit four :digit_four: digit nine :digit_nine: digit one :digit_one: digit seven :digit_seven: digit six :digit_six: digit three :digit_three: digit two :digit_two: digit zero :digit_zero: disappointed face :disappointed: disappointed but relieved face :disappointed_relieved: card index dividers :dividers: dizzy :dizzy: dizzy face :dizzy_face: no littering :do_not_litter: dog :dog2: dog face :dog: dollar banknote :dollar: Japanese dolls :dolls: dolphin :dolphin: door :door: doughnut :doughnut: dove :dove: dragon :dragon: dragon face :dragon_face: dress :dress: camel :dromedary_camel: drooling face :drooling_face: droplet :droplet: drum :drum: duck :duck: dumpling :dumpling: dvd :dvd: e-mail :e-mail: eagle :eagle: ear :ear: sheaf of rice :ear_of_rice: ear: light skin tone :ear_tone1: ear: medium-light skin tone :ear_tone2: ear: medium skin tone :ear_tone3: ear: medium-dark skin tone :ear_tone4: ear: dark skin tone :ear_tone5: globe showing Europe-Africa :earth_africa: globe showing Americas :earth_americas: globe showing Asia-Australia :earth_asia: egg :egg: eggplant :eggplant: keycap: 8 :eight: eight-pointed star :eight_pointed_black_star: eight-spoked asterisk :eight_spoked_asterisk: eject button :eject: electric plug :electric_plug: elephant :elephant: elf :elf: elf: light skin tone :elf_tone1: elf: medium-light skin tone :elf_tone2: elf: medium skin tone :elf_tone3: elf: medium-dark skin tone :elf_tone4: elf: dark skin tone :elf_tone5: END arrow :end: England :england: envelope :envelope: envelope with arrow :envelope_with_arrow: euro banknote :euro: castle :european_castle: post office :european_post_office: evergreen tree :evergreen_tree: exclamation mark :exclamation: exploding head :exploding_head: expressionless face :expressionless: eye :eye: eye in speech bubble :eye_in_speech_bubble: glasses :eyeglasses: eyes :eyes: face vomiting :face_vomiting: face with hand over mouth :face_with_hand_over_mouth: face with monocle :face_with_monocle: face with raised eyebrow :face_with_raised_eyebrow: face with symbols over mouth :face_with_symbols_over_mouth: factory :factory: fairy :fairy: fairy: light skin tone :fairy_tone1: fairy: medium-light skin tone :fairy_tone2: fairy: medium skin tone :fairy_tone3: fairy: medium-dark skin tone :fairy_tone4: fairy: dark skin tone :fairy_tone5: fallen leaf :fallen_leaf: family :family: family: man, boy :family_man_boy: family: man, boy, boy :family_man_boy_boy: family: man, girl :family_man_girl: family: man, girl, boy :family_man_girl_boy: family: man, girl, girl :family_man_girl_girl: family: man, woman, boy :family_man_woman_boy: family: man, man, boy :family_mmb: family: man, man, boy, boy :family_mmbb: family: man, man, girl :family_mmg: family: man, man, girl, boy :family_mmgb: family: man, man, girl, girl :family_mmgg: family: man, woman, boy, boy :family_mwbb: family: man, woman, girl :family_mwg: family: man, woman, girl, boy :family_mwgb: family: man, woman, girl, girl :family_mwgg: family: woman, boy :family_woman_boy: family: woman, boy, boy :family_woman_boy_boy: family: woman, girl :family_woman_girl: family: woman, girl, boy :family_woman_girl_boy: family: woman, girl, girl :family_woman_girl_girl: family: woman, woman, boy :family_wwb: family: woman, woman, boy, boy :family_wwbb: family: woman, woman, girl :family_wwg: family: woman, woman, girl, boy :family_wwgb: family: woman, woman, girl, girl :family_wwgg: fast-forward button :fast_forward: fax machine :fax: fearful face :fearful: paw prints :feet: female sign :female_sign: ferris wheel :ferris_wheel: ferry :ferry: field hockey :field_hockey: file cabinet :file_cabinet: file folder :file_folder: film frames :film_frames: crossed fingers :fingers_crossed: crossed fingers: light skin tone :fingers_crossed_tone1: crossed fingers: medium-light skin tone :fingers_crossed_tone2: crossed fingers: medium skin tone :fingers_crossed_tone3: crossed fingers: medium-dark skin tone :fingers_crossed_tone4: crossed fingers: dark skin tone :fingers_crossed_tone5: fire :fire: fire engine :fire_engine: fireworks :fireworks: 1 st place medal :first_place: first quarter moon :first_quarter_moon: first quarter moon with face :first_quarter_moon_with_face: fish :fish: fish cake with swirl :fish_cake: fishing pole :fishing_pole_and_fish: raised fist :fist: raised fist: light skin tone :fist_tone1: raised fist: medium-light skin tone :fist_tone2: raised fist: medium skin tone :fist_tone3: raised fist: medium-dark skin tone :fist_tone4: raised fist: dark skin tone :fist_tone5: keycap: 5 :five: Ascension Island :flag_ac: Andorra :flag_ad: United Arab Emirates :flag_ae: Afghanistan :flag_af: Antigua & Barbuda :flag_ag: Anguilla :flag_ai: Albania :flag_al: Armenia :flag_am: Angola :flag_ao: Antarctica :flag_aq: Argentina :flag_ar: American Samoa :flag_as: Austria :flag_at: Australia :flag_au: Aruba :flag_aw: \\u00c5land Islands :flag_ax: Azerbaijan :flag_az: Bosnia & Herzegovina :flag_ba: Barbados :flag_bb: Bangladesh :flag_bd: Belgium :flag_be: Burkina Faso :flag_bf: Bulgaria :flag_bg: Bahrain :flag_bh: Burundi :flag_bi: Benin :flag_bj: St. Barth\\u00e9lemy :flag_bl: black flag :flag_black: Bermuda :flag_bm: Brunei :flag_bn: Bolivia :flag_bo: Caribbean Netherlands :flag_bq: Brazil :flag_br: Bahamas :flag_bs: Bhutan :flag_bt: Bouvet Island :flag_bv: Botswana :flag_bw: Belarus :flag_by: Belize :flag_bz: Canada :flag_ca: Cocos (Keeling) Islands :flag_cc: Congo - Kinshasa :flag_cd: Central African Republic :flag_cf: Congo - Brazzaville :flag_cg: Switzerland :flag_ch: C\\u00f4te d\\u2019Ivoire :flag_ci: Cook Islands :flag_ck: Chile :flag_cl: Cameroon :flag_cm: China :flag_cn: Colombia :flag_co: Clipperton Island :flag_cp: Costa Rica :flag_cr: Cuba :flag_cu: Cape Verde :flag_cv: Cura\\u00e7ao :flag_cw: Christmas Island :flag_cx: Cyprus :flag_cy: Czechia :flag_cz: Germany :flag_de: Diego Garcia :flag_dg: Djibouti :flag_dj: Denmark :flag_dk: Dominica :flag_dm: Dominican Republic :flag_do: Algeria :flag_dz: Ceuta & Melilla :flag_ea: Ecuador :flag_ec: Estonia :flag_ee: Egypt :flag_eg: Western Sahara :flag_eh: Eritrea :flag_er: Spain :flag_es: Ethiopia :flag_et: European Union :flag_eu: Finland :flag_fi: Fiji :flag_fj: Falkland Islands :flag_fk: Micronesia :flag_fm: Faroe Islands :flag_fo: France :flag_fr: Gabon :flag_ga: United Kingdom :flag_gb: Grenada :flag_gd: Georgia :flag_ge: French Guiana :flag_gf: Guernsey :flag_gg: Ghana :flag_gh: Gibraltar :flag_gi: Greenland :flag_gl: Gambia :flag_gm: Guinea :flag_gn: Guadeloupe :flag_gp: Equatorial Guinea :flag_gq: Greece :flag_gr: South Georgia & South Sandwich Islands :flag_gs: Guatemala :flag_gt: Guam :flag_gu: Guinea-Bissau :flag_gw: Guyana :flag_gy: Hong Kong SAR China :flag_hk: Heard & McDonald Islands :flag_hm: Honduras :flag_hn: Croatia :flag_hr: Haiti :flag_ht: Hungary :flag_hu: Canary Islands :flag_ic: Indonesia :flag_id: Ireland :flag_ie: Israel :flag_il: Isle of Man :flag_im: India :flag_in: British Indian Ocean Territory :flag_io: Iraq :flag_iq: Iran :flag_ir: Iceland :flag_is: Italy :flag_it: Jersey :flag_je: Jamaica :flag_jm: Jordan :flag_jo: Japan :flag_jp: Kenya :flag_ke: Kyrgyzstan :flag_kg: Cambodia :flag_kh: Kiribati :flag_ki: Comoros :flag_km: St. Kitts & Nevis :flag_kn: North Korea :flag_kp: South Korea :flag_kr: Kuwait :flag_kw: Cayman Islands :flag_ky: Kazakhstan :flag_kz: Laos :flag_la: Lebanon :flag_lb: St. Lucia :flag_lc: Liechtenstein :flag_li: Sri Lanka :flag_lk: Liberia :flag_lr: Lesotho :flag_ls: Lithuania :flag_lt: Luxembourg :flag_lu: Latvia :flag_lv: Libya :flag_ly: Morocco :flag_ma: Monaco :flag_mc: Moldova :flag_md: Montenegro :flag_me: St. Martin :flag_mf: Madagascar :flag_mg: Marshall Islands :flag_mh: Macedonia :flag_mk: Mali :flag_ml: Myanmar (Burma) :flag_mm: Mongolia :flag_mn: Macau SAR China :flag_mo: Northern Mariana Islands :flag_mp: Martinique :flag_mq: Mauritania :flag_mr: Montserrat :flag_ms: Malta :flag_mt: Mauritius :flag_mu: Maldives :flag_mv: Malawi :flag_mw: Mexico :flag_mx: Malaysia :flag_my: Mozambique :flag_mz: Namibia :flag_na: New Caledonia :flag_nc: Niger :flag_ne: Norfolk Island :flag_nf: Nigeria :flag_ng: Nicaragua :flag_ni: Netherlands :flag_nl: Norway :flag_no: Nepal :flag_np: Nauru :flag_nr: Niue :flag_nu: New Zealand :flag_nz: Oman :flag_om: Panama :flag_pa: Peru :flag_pe: French Polynesia :flag_pf: Papua New Guinea :flag_pg: Philippines :flag_ph: Pakistan :flag_pk: Poland :flag_pl: St. Pierre & Miquelon :flag_pm: Pitcairn Islands :flag_pn: Puerto Rico :flag_pr: Palestinian Territories :flag_ps: Portugal :flag_pt: Palau :flag_pw: Paraguay :flag_py: Qatar :flag_qa: R\\u00e9union :flag_re: Romania :flag_ro: Serbia :flag_rs: Russia :flag_ru: Rwanda :flag_rw: Saudi Arabia :flag_sa: Solomon Islands :flag_sb: Seychelles :flag_sc: Sudan :flag_sd: Sweden :flag_se: Singapore :flag_sg: St. Helena :flag_sh: Slovenia :flag_si: Svalbard & Jan Mayen :flag_sj: Slovakia :flag_sk: Sierra Leone :flag_sl: San Marino :flag_sm: Senegal :flag_sn: Somalia :flag_so: Suriname :flag_sr: South Sudan :flag_ss: S\\u00e3o Tom\\u00e9 & Pr\\u00edncipe :flag_st: El Salvador :flag_sv: Sint Maarten :flag_sx: Syria :flag_sy: Swaziland :flag_sz: Tristan da Cunha :flag_ta: Turks & Caicos Islands :flag_tc: Chad :flag_td: French Southern Territories :flag_tf: Togo :flag_tg: Thailand :flag_th: Tajikistan :flag_tj: Tokelau :flag_tk: Timor-Leste :flag_tl: Turkmenistan :flag_tm: Tunisia :flag_tn: Tonga :flag_to: Turkey :flag_tr: Trinidad & Tobago :flag_tt: Tuvalu :flag_tv: Taiwan :flag_tw: Tanzania :flag_tz: Ukraine :flag_ua: Uganda :flag_ug: U.S. Outlying Islands :flag_um: United States :flag_us: Uruguay :flag_uy: Uzbekistan :flag_uz: Vatican City :flag_va: St. Vincent & Grenadines :flag_vc: Venezuela :flag_ve: British Virgin Islands :flag_vg: U.S. Virgin Islands :flag_vi: Vietnam :flag_vn: Vanuatu :flag_vu: Wallis & Futuna :flag_wf: white flag :flag_white: Samoa :flag_ws: Kosovo :flag_xk: Yemen :flag_ye: Mayotte :flag_yt: South Africa :flag_za: Zambia :flag_zm: Zimbabwe :flag_zw: carp streamer :flags: flashlight :flashlight: fleur-de-lis :fleur-de-lis: floppy disk :floppy_disk: flower playing cards :flower_playing_cards: flushed face :flushed: flying saucer :flying_saucer: fog :fog: foggy :foggy: american football :football: footprints :footprints: fork and knife :fork_and_knife: fork and knife with plate :fork_knife_plate: fortune cookie :fortune_cookie: fountain :fountain: keycap: 4 :four: four leaf clover :four_leaf_clover: fox face :fox: framed picture :frame_photo: FREE button :free: baguette bread :french_bread: fried shrimp :fried_shrimp: french fries :fries: frog face :frog: frowning face :frowning2: frowning face with open mouth :frowning: fuel pump :fuelpump: full moon :full_moon: full moon with face :full_moon_with_face: game die :game_die: gear :gear: gem stone :gem: Gemini :gemini: genie :genie: ghost :ghost: wrapped gift :gift: heart with ribbon :gift_heart: giraffe :giraffe: girl :girl: girl: light skin tone :girl_tone1: girl: medium-light skin tone :girl_tone2: girl: medium skin tone :girl_tone3: girl: medium-dark skin tone :girl_tone4: girl: dark skin tone :girl_tone5: globe with meridians :globe_with_meridians: gloves :gloves: goal net :goal: goat :goat: flag in hole :golf: gorilla :gorilla: grapes :grapes: green apple :green_apple: green book :green_book: green heart :green_heart: white exclamation mark :grey_exclamation: white question mark :grey_question: grimacing face :grimacing: grinning face with smiling eyes :grin: grinning face :grinning: guard :guard: guard: light skin tone :guard_tone1: guard: medium-light skin tone :guard_tone2: guard: medium skin tone :guard_tone3: guard: medium-dark skin tone :guard_tone4: guard: dark skin tone :guard_tone5: guitar :guitar: pistol :gun: hamburger :hamburger: hammer :hammer: hammer and pick :hammer_pick: hamster face :hamster: raised hand with fingers splayed :hand_splayed: raised hand with fingers splayed: light skin tone :hand_splayed_tone1: raised hand with fingers splayed: medium-light skin tone :hand_splayed_tone2: raised hand with fingers splayed: medium skin tone :hand_splayed_tone3: raised hand with fingers splayed: medium-dark skin tone :hand_splayed_tone4: raised hand with fingers splayed: dark skin tone :hand_splayed_tone5: handbag :handbag: handshake :handshake: keycap: # :hash: front-facing baby chick :hatched_chick: hatching chick :hatching_chick: face with head-bandage :head_bandage: headphone :headphones: hear-no-evil monkey :hear_no_evil: red heart :heart: heart decoration :heart_decoration: heavy heart exclamation :heart_exclamation: smiling face with heart-eyes :heart_eyes: smiling cat face with heart-eyes :heart_eyes_cat: beating heart :heartbeat: growing heart :heartpulse: heart suit :hearts: heavy check mark :heavy_check_mark: heavy division sign :heavy_division_sign: heavy dollar sign :heavy_dollar_sign: heavy minus sign :heavy_minus_sign: heavy multiplication x :heavy_multiplication_x: heavy plus sign :heavy_plus_sign: hedgehog :hedgehog: helicopter :helicopter: rescue worker\\u2019s helmet :helmet_with_cross: herb :herb: hibiscus :hibiscus: bright button :high_brightness: high-heeled shoe :high_heel: ice hockey :hockey: hole :hole: houses :homes: honey pot :honey_pot: horse face :horse: horse racing :horse_racing: horse racing: light skin tone :horse_racing_tone1: horse racing: medium-light skin tone :horse_racing_tone2: horse racing: medium skin tone :horse_racing_tone3: horse racing: medium-dark skin tone :horse_racing_tone4: horse racing: dark skin tone :horse_racing_tone5: hospital :hospital: hot pepper :hot_pepper: hot dog :hotdog: hotel :hotel: hot springs :hotsprings: hourglass :hourglass: hourglass with flowing sand :hourglass_flowing_sand: house :house: derelict house :house_abandoned: house with garden :house_with_garden: hugging face :hugging: hushed face :hushed: ice cream :ice_cream: ice skate :ice_skate: soft ice cream :icecream: ID button :id: Japanese \\u201cbargain\\u201d button :ideograph_advantage: angry face with horns :imp: inbox tray :inbox_tray: incoming envelope :incoming_envelope: information :information_source: smiling face with halo :innocent: exclamation question mark :interrobang: mobile phone :iphone: desert island :island: red paper lantern :izakaya_lantern: jack-o-lantern :jack_o_lantern: map of Japan :japan: Japanese castle :japanese_castle: goblin :japanese_goblin: ogre :japanese_ogre: jeans :jeans: face with tears of joy :joy: cat face with tears of joy :joy_cat: joystick :joystick: kaaba :kaaba: old key :key2: key :key: keyboard :keyboard: keycap 10 :keycap_ten: kimono :kimono: kiss mark :kiss: kiss: man, man :kiss_mm: kiss: woman, man :kiss_woman_man: kiss: woman, woman :kiss_ww: kissing face :kissing: kissing cat face with closed eyes :kissing_cat: kissing face with closed eyes :kissing_closed_eyes: face blowing a kiss :kissing_heart: kissing face with smiling eyes :kissing_smiling_eyes: kiwi fruit :kiwi: kitchen knife :knife: koala :koala: Japanese \\u201chere\\u201d button :koko: label :label: large blue diamond :large_blue_diamond: large orange diamond :large_orange_diamond: last quarter moon :last_quarter_moon: last quarter moon with face :last_quarter_moon_with_face: smiling face with open mouth & closed eyes :laughing: leaf fluttering in wind :leaves: ledger :ledger: left-facing fist :left_facing_fist: left-facing fist: light skin tone :left_facing_fist_tone1: left-facing fist: medium-light skin tone :left_facing_fist_tone2: left-facing fist: medium skin tone :left_facing_fist_tone3: left-facing fist: medium-dark skin tone :left_facing_fist_tone4: left-facing fist: dark skin tone :left_facing_fist_tone5: left luggage :left_luggage: left-right arrow :left_right_arrow: right arrow curving left :leftwards_arrow_with_hook: lemon :lemon: Leo :leo: leopard :leopard: level slider :level_slider: man in business suit levitating :levitate: Libra :libra: light rail :light_rail: link :link: lion face :lion_face: mouth :lips: lipstick :lipstick: lizard :lizard: locked :lock: locked with pen :lock_with_ink_pen: lollipop :lollipop: double curly loop :loop: speaker high volume :loud_sound: loudspeaker :loudspeaker: love hotel :love_hotel: love letter :love_letter: love-you gesture :love_you_gesture: love-you gesture: light skin tone :love_you_gesture_tone1: love-you gesture: medium-light skin tone :love_you_gesture_tone2: love-you gesture: medium skin tone :love_you_gesture_tone3: love-you gesture: medium-dark skin tone :love_you_gesture_tone4: love-you gesture: dark skin tone :love_you_gesture_tone5: dim button :low_brightness: lying face :lying_face: circled M :m: left-pointing magnifying glass :mag: right-pointing magnifying glass :mag_right: mage :mage: mage: light skin tone :mage_tone1: mage: medium-light skin tone :mage_tone2: mage: medium skin tone :mage_tone3: mage: medium-dark skin tone :mage_tone4: mage: dark skin tone :mage_tone5: mahjong red dragon :mahjong: closed mailbox with raised flag :mailbox: closed mailbox with lowered flag :mailbox_closed: open mailbox with raised flag :mailbox_with_mail: open mailbox with lowered flag :mailbox_with_no_mail: male sign :male_sign: man :man: man artist :man_artist: man artist: light skin tone :man_artist_tone1: man artist: medium-light skin tone :man_artist_tone2: man artist: medium skin tone :man_artist_tone3: man artist: medium-dark skin tone :man_artist_tone4: man artist: dark skin tone :man_artist_tone5: man astronaut :man_astronaut: man astronaut: light skin tone :man_astronaut_tone1: man astronaut: medium-light skin tone :man_astronaut_tone2: man astronaut: medium skin tone :man_astronaut_tone3: man astronaut: medium-dark skin tone :man_astronaut_tone4: man astronaut: dark skin tone :man_astronaut_tone5: man biking :man_biking: man biking: light skin tone :man_biking_tone1: man biking: medium-light skin tone :man_biking_tone2: man biking: medium skin tone :man_biking_tone3: man biking: medium-dark skin tone :man_biking_tone4: man biking: dark skin tone :man_biking_tone5: man bouncing ball :man_bouncing_ball: man bouncing ball: light skin tone :man_bouncing_ball_tone1: man bouncing ball: medium-light skin tone :man_bouncing_ball_tone2: man bouncing ball: medium skin tone :man_bouncing_ball_tone3: man bouncing ball: medium-dark skin tone :man_bouncing_ball_tone4: man bouncing ball: dark skin tone :man_bouncing_ball_tone5: man bowing :man_bowing: man bowing: light skin tone :man_bowing_tone1: man bowing: medium-light skin tone :man_bowing_tone2: man bowing: medium skin tone :man_bowing_tone3: man bowing: medium-dark skin tone :man_bowing_tone4: man bowing: dark skin tone :man_bowing_tone5: man cartwheeling :man_cartwheeling: man cartwheeling: light skin tone :man_cartwheeling_tone1: man cartwheeling: medium-light skin tone :man_cartwheeling_tone2: man cartwheeling: medium skin tone :man_cartwheeling_tone3: man cartwheeling: medium-dark skin tone :man_cartwheeling_tone4: man cartwheeling: dark skin tone :man_cartwheeling_tone5: man climbing :man_climbing: man climbing: light skin tone :man_climbing_tone1: man climbing: medium-light skin tone :man_climbing_tone2: man climbing: medium skin tone :man_climbing_tone3: man climbing: medium-dark skin tone :man_climbing_tone4: man climbing: dark skin tone :man_climbing_tone5: man construction worker :man_construction_worker: man construction worker: light skin tone :man_construction_worker_tone1: man construction worker: medium-light skin tone :man_construction_worker_tone2: man construction worker: medium skin tone :man_construction_worker_tone3: man construction worker: medium-dark skin tone :man_construction_worker_tone4: man construction worker: dark skin tone :man_construction_worker_tone5: man cook :man_cook: man cook: light skin tone :man_cook_tone1: man cook: medium-light skin tone :man_cook_tone2: man cook: medium skin tone :man_cook_tone3: man cook: medium-dark skin tone :man_cook_tone4: man cook: dark skin tone :man_cook_tone5: man dancing :man_dancing: man dancing: light skin tone :man_dancing_tone1: man dancing: medium-light skin tone :man_dancing_tone2: man dancing: medium skin tone :man_dancing_tone3: man dancing: medium-dark skin tone :man_dancing_tone4: man dancing: dark skin tone :man_dancing_tone5: man detective :man_detective: man detective: light skin tone :man_detective_tone1: man detective: medium-light skin tone :man_detective_tone2: man detective: medium skin tone :man_detective_tone3: man detective: medium-dark skin tone :man_detective_tone4: man detective: dark skin tone :man_detective_tone5: man elf :man_elf: man elf: light skin tone :man_elf_tone1: man elf: medium-light skin tone :man_elf_tone2: man elf: medium skin tone :man_elf_tone3: man elf: medium-dark skin tone :man_elf_tone4: man elf: dark skin tone :man_elf_tone5: man facepalming :man_facepalming: man facepalming: light skin tone :man_facepalming_tone1: man facepalming: medium-light skin tone :man_facepalming_tone2: man facepalming: medium skin tone :man_facepalming_tone3: man facepalming: medium-dark skin tone :man_facepalming_tone4: man facepalming: dark skin tone :man_facepalming_tone5: man factory worker :man_factory_worker: man factory worker: light skin tone :man_factory_worker_tone1: man factory worker: medium-light skin tone :man_factory_worker_tone2: man factory worker: medium skin tone :man_factory_worker_tone3: man factory worker: medium-dark skin tone :man_factory_worker_tone4: man factory worker: dark skin tone :man_factory_worker_tone5: man fairy :man_fairy: man fairy: light skin tone :man_fairy_tone1: man fairy: medium-light skin tone :man_fairy_tone2: man fairy: medium skin tone :man_fairy_tone3: man fairy: medium-dark skin tone :man_fairy_tone4: man fairy: dark skin tone :man_fairy_tone5: man farmer :man_farmer: man farmer: light skin tone :man_farmer_tone1: man farmer: medium-light skin tone :man_farmer_tone2: man farmer: medium skin tone :man_farmer_tone3: man farmer: medium-dark skin tone :man_farmer_tone4: man farmer: dark skin tone :man_farmer_tone5: man firefighter :man_firefighter: man firefighter: light skin tone :man_firefighter_tone1: man firefighter: medium-light skin tone :man_firefighter_tone2: man firefighter: medium skin tone :man_firefighter_tone3: man firefighter: medium-dark skin tone :man_firefighter_tone4: man firefighter: dark skin tone :man_firefighter_tone5: man frowning :man_frowning: man frowning: light skin tone :man_frowning_tone1: man frowning: medium-light skin tone :man_frowning_tone2: man frowning: medium skin tone :man_frowning_tone3: man frowning: medium-dark skin tone :man_frowning_tone4: man frowning: dark skin tone :man_frowning_tone5: man genie :man_genie: man gesturing NO :man_gesturing_no: man gesturing NO: light skin tone :man_gesturing_no_tone1: man gesturing NO: medium-light skin tone :man_gesturing_no_tone2: man gesturing NO: medium skin tone :man_gesturing_no_tone3: man gesturing NO: medium-dark skin tone :man_gesturing_no_tone4: man gesturing NO: dark skin tone :man_gesturing_no_tone5: man gesturing OK :man_gesturing_ok: man gesturing OK: light skin tone :man_gesturing_ok_tone1: man gesturing OK: medium-light skin tone :man_gesturing_ok_tone2: man gesturing OK: medium skin tone :man_gesturing_ok_tone3: man gesturing OK: medium-dark skin tone :man_gesturing_ok_tone4: man gesturing OK: dark skin tone :man_gesturing_ok_tone5: man getting massage :man_getting_face_massage: man getting massage: light skin tone :man_getting_face_massage_tone1: man getting massage: medium-light skin tone :man_getting_face_massage_tone2: man getting massage: medium skin tone :man_getting_face_massage_tone3: man getting massage: medium-dark skin tone :man_getting_face_massage_tone4: man getting massage: dark skin tone :man_getting_face_massage_tone5: man getting haircut :man_getting_haircut: man getting haircut: light skin tone :man_getting_haircut_tone1: man getting haircut: medium-light skin tone :man_getting_haircut_tone2: man getting haircut: medium skin tone :man_getting_haircut_tone3: man getting haircut: medium-dark skin tone :man_getting_haircut_tone4: man getting haircut: dark skin tone :man_getting_haircut_tone5: man golfing :man_golfing: man golfing: light skin tone :man_golfing_tone1: man golfing: medium-light skin tone :man_golfing_tone2: man golfing: medium skin tone :man_golfing_tone3: man golfing: medium-dark skin tone :man_golfing_tone4: man golfing: dark skin tone :man_golfing_tone5: man guard :man_guard: man guard: light skin tone :man_guard_tone1: man guard: medium-light skin tone :man_guard_tone2: man guard: medium skin tone :man_guard_tone3: man guard: medium-dark skin tone :man_guard_tone4: man guard: dark skin tone :man_guard_tone5: man health worker :man_health_worker: man health worker: light skin tone :man_health_worker_tone1: man health worker: medium-light skin tone :man_health_worker_tone2: man health worker: medium skin tone :man_health_worker_tone3: man health worker: medium-dark skin tone :man_health_worker_tone4: man health worker: dark skin tone :man_health_worker_tone5: man in business suit levitating: light skin tone :man_in_business_suit_levitating_tone1: man in business suit levitating: medium-light skin tone :man_in_business_suit_levitating_tone2: man in business suit levitating: medium skin tone :man_in_business_suit_levitating_tone3: man in business suit levitating: medium-dark skin tone :man_in_business_suit_levitating_tone4: man in business suit levitating: dark skin tone :man_in_business_suit_levitating_tone5: man in lotus position :man_in_lotus_position: man in lotus position: light skin tone :man_in_lotus_position_tone1: man in lotus position: medium-light skin tone :man_in_lotus_position_tone2: man in lotus position: medium skin tone :man_in_lotus_position_tone3: man in lotus position: medium-dark skin tone :man_in_lotus_position_tone4: man in lotus position: dark skin tone :man_in_lotus_position_tone5: man in steamy room :man_in_steamy_room: man in steamy room: light skin tone :man_in_steamy_room_tone1: man in steamy room: medium-light skin tone :man_in_steamy_room_tone2: man in steamy room: medium skin tone :man_in_steamy_room_tone3: man in steamy room: medium-dark skin tone :man_in_steamy_room_tone4: man in steamy room: dark skin tone :man_in_steamy_room_tone5: man in tuxedo :man_in_tuxedo: man in tuxedo: light skin tone :man_in_tuxedo_tone1: man in tuxedo: medium-light skin tone :man_in_tuxedo_tone2: man in tuxedo: medium skin tone :man_in_tuxedo_tone3: man in tuxedo: medium-dark skin tone :man_in_tuxedo_tone4: man in tuxedo: dark skin tone :man_in_tuxedo_tone5: man judge :man_judge: man judge: light skin tone :man_judge_tone1: man judge: medium-light skin tone :man_judge_tone2: man judge: medium skin tone :man_judge_tone3: man judge: medium-dark skin tone :man_judge_tone4: man judge: dark skin tone :man_judge_tone5: man juggling :man_juggling: man juggling: light skin tone :man_juggling_tone1: man juggling: medium-light skin tone :man_juggling_tone2: man juggling: medium skin tone :man_juggling_tone3: man juggling: medium-dark skin tone :man_juggling_tone4: man juggling: dark skin tone :man_juggling_tone5: man lifting weights :man_lifting_weights: man lifting weights: light skin tone :man_lifting_weights_tone1: man lifting weights: medium-light skin tone :man_lifting_weights_tone2: man lifting weights: medium skin tone :man_lifting_weights_tone3: man lifting weights: medium-dark skin tone :man_lifting_weights_tone4: man lifting weights: dark skin tone :man_lifting_weights_tone5: man mage :man_mage: man mage: light skin tone :man_mage_tone1: man mage: medium-light skin tone :man_mage_tone2: man mage: medium skin tone :man_mage_tone3: man mage: medium-dark skin tone :man_mage_tone4: man mage: dark skin tone :man_mage_tone5: man mechanic :man_mechanic: man mechanic: light skin tone :man_mechanic_tone1: man mechanic: medium-light skin tone :man_mechanic_tone2: man mechanic: medium skin tone :man_mechanic_tone3: man mechanic: medium-dark skin tone :man_mechanic_tone4: man mechanic: dark skin tone :man_mechanic_tone5: man mountain biking :man_mountain_biking: man mountain biking: light skin tone :man_mountain_biking_tone1: man mountain biking: medium-light skin tone :man_mountain_biking_tone2: man mountain biking: medium skin tone :man_mountain_biking_tone3: man mountain biking: medium-dark skin tone :man_mountain_biking_tone4: man mountain biking: dark skin tone :man_mountain_biking_tone5: man office worker :man_office_worker: man office worker: light skin tone :man_office_worker_tone1: man office worker: medium-light skin tone :man_office_worker_tone2: man office worker: medium skin tone :man_office_worker_tone3: man office worker: medium-dark skin tone :man_office_worker_tone4: man office worker: dark skin tone :man_office_worker_tone5: man pilot :man_pilot: man pilot: light skin tone :man_pilot_tone1: man pilot: medium-light skin tone :man_pilot_tone2: man pilot: medium skin tone :man_pilot_tone3: man pilot: medium-dark skin tone :man_pilot_tone4: man pilot: dark skin tone :man_pilot_tone5: man playing handball :man_playing_handball: man playing handball: light skin tone :man_playing_handball_tone1: man playing handball: medium-light skin tone :man_playing_handball_tone2: man playing handball: medium skin tone :man_playing_handball_tone3: man playing handball: medium-dark skin tone :man_playing_handball_tone4: man playing handball: dark skin tone :man_playing_handball_tone5: man playing water polo :man_playing_water_polo: man playing water polo: light skin tone :man_playing_water_polo_tone1: man playing water polo: medium-light skin tone :man_playing_water_polo_tone2: man playing water polo: medium skin tone :man_playing_water_polo_tone3: man playing water polo: medium-dark skin tone :man_playing_water_polo_tone4: man playing water polo: dark skin tone :man_playing_water_polo_tone5: man police officer :man_police_officer: man police officer: light skin tone :man_police_officer_tone1: man police officer: medium-light skin tone :man_police_officer_tone2: man police officer: medium skin tone :man_police_officer_tone3: man police officer: medium-dark skin tone :man_police_officer_tone4: man police officer: dark skin tone :man_police_officer_tone5: man pouting :man_pouting: man pouting: light skin tone :man_pouting_tone1: man pouting: medium-light skin tone :man_pouting_tone2: man pouting: medium skin tone :man_pouting_tone3: man pouting: medium-dark skin tone :man_pouting_tone4: man pouting: dark skin tone :man_pouting_tone5: man raising hand :man_raising_hand: man raising hand: light skin tone :man_raising_hand_tone1: man raising hand: medium-light skin tone :man_raising_hand_tone2: man raising hand: medium skin tone :man_raising_hand_tone3: man raising hand: medium-dark skin tone :man_raising_hand_tone4: man raising hand: dark skin tone :man_raising_hand_tone5: man rowing boat :man_rowing_boat: man rowing boat: light skin tone :man_rowing_boat_tone1: man rowing boat: medium-light skin tone :man_rowing_boat_tone2: man rowing boat: medium skin tone :man_rowing_boat_tone3: man rowing boat: medium-dark skin tone :man_rowing_boat_tone4: man rowing boat: dark skin tone :man_rowing_boat_tone5: man running :man_running: man running: light skin tone :man_running_tone1: man running: medium-light skin tone :man_running_tone2: man running: medium skin tone :man_running_tone3: man running: medium-dark skin tone :man_running_tone4: man running: dark skin tone :man_running_tone5: man scientist :man_scientist: man scientist: light skin tone :man_scientist_tone1: man scientist: medium-light skin tone :man_scientist_tone2: man scientist: medium skin tone :man_scientist_tone3: man scientist: medium-dark skin tone :man_scientist_tone4: man scientist: dark skin tone :man_scientist_tone5: man shrugging :man_shrugging: man shrugging: light skin tone :man_shrugging_tone1: man shrugging: medium-light skin tone :man_shrugging_tone2: man shrugging: medium skin tone :man_shrugging_tone3: man shrugging: medium-dark skin tone :man_shrugging_tone4: man shrugging: dark skin tone :man_shrugging_tone5: man singer :man_singer: man singer: light skin tone :man_singer_tone1: man singer: medium-light skin tone :man_singer_tone2: man singer: medium skin tone :man_singer_tone3: man singer: medium-dark skin tone :man_singer_tone4: man singer: dark skin tone :man_singer_tone5: man student :man_student: man student: light skin tone :man_student_tone1: man student: medium-light skin tone :man_student_tone2: man student: medium skin tone :man_student_tone3: man student: medium-dark skin tone :man_student_tone4: man student: dark skin tone :man_student_tone5: man surfing :man_surfing: man surfing: light skin tone :man_surfing_tone1: man surfing: medium-light skin tone :man_surfing_tone2: man surfing: medium skin tone :man_surfing_tone3: man surfing: medium-dark skin tone :man_surfing_tone4: man surfing: dark skin tone :man_surfing_tone5: man swimming :man_swimming: man swimming: light skin tone :man_swimming_tone1: man swimming: medium-light skin tone :man_swimming_tone2: man swimming: medium skin tone :man_swimming_tone3: man swimming: medium-dark skin tone :man_swimming_tone4: man swimming: dark skin tone :man_swimming_tone5: man teacher :man_teacher: man teacher: light skin tone :man_teacher_tone1: man teacher: medium-light skin tone :man_teacher_tone2: man teacher: medium skin tone :man_teacher_tone3: man teacher: medium-dark skin tone :man_teacher_tone4: man teacher: dark skin tone :man_teacher_tone5: man technologist :man_technologist: man technologist: light skin tone :man_technologist_tone1: man technologist: medium-light skin tone :man_technologist_tone2: man technologist: medium skin tone :man_technologist_tone3: man technologist: medium-dark skin tone :man_technologist_tone4: man technologist: dark skin tone :man_technologist_tone5: man tipping hand :man_tipping_hand: man tipping hand: light skin tone :man_tipping_hand_tone1: man tipping hand: medium-light skin tone :man_tipping_hand_tone2: man tipping hand: medium skin tone :man_tipping_hand_tone3: man tipping hand: medium-dark skin tone :man_tipping_hand_tone4: man tipping hand: dark skin tone :man_tipping_hand_tone5: man: light skin tone :man_tone1: man: medium-light skin tone :man_tone2: man: medium skin tone :man_tone3: man: medium-dark skin tone :man_tone4: man: dark skin tone :man_tone5: man vampire :man_vampire: man vampire: light skin tone :man_vampire_tone1: man vampire: medium-light skin tone :man_vampire_tone2: man vampire: medium skin tone :man_vampire_tone3: man vampire: medium-dark skin tone :man_vampire_tone4: man vampire: dark skin tone :man_vampire_tone5: man walking :man_walking: man walking: light skin tone :man_walking_tone1: man walking: medium-light skin tone :man_walking_tone2: man walking: medium skin tone :man_walking_tone3: man walking: medium-dark skin tone :man_walking_tone4: man walking: dark skin tone :man_walking_tone5: man wearing turban :man_wearing_turban: man wearing turban: light skin tone :man_wearing_turban_tone1: man wearing turban: medium-light skin tone :man_wearing_turban_tone2: man wearing turban: medium skin tone :man_wearing_turban_tone3: man wearing turban: medium-dark skin tone :man_wearing_turban_tone4: man wearing turban: dark skin tone :man_wearing_turban_tone5: man with Chinese cap :man_with_chinese_cap: man with Chinese cap: light skin tone :man_with_chinese_cap_tone1: man with Chinese cap: medium-light skin tone :man_with_chinese_cap_tone2: man with Chinese cap: medium skin tone :man_with_chinese_cap_tone3: man with Chinese cap: medium-dark skin tone :man_with_chinese_cap_tone4: man with Chinese cap: dark skin tone :man_with_chinese_cap_tone5: man zombie :man_zombie: man\\u2019s shoe :mans_shoe: world map :map: maple leaf :maple_leaf: martial arts uniform :martial_arts_uniform: face with medical mask :mask: meat on bone :meat_on_bone: sports medal :medal: medical symbol :medical_symbol: megaphone :mega: melon :melon: men with bunny ears partying :men_with_bunny_ears_partying: men wrestling :men_wrestling: menorah :menorah: men\\u2019s room :mens: mermaid :mermaid: mermaid: light skin tone :mermaid_tone1: mermaid: medium-light skin tone :mermaid_tone2: mermaid: medium skin tone :mermaid_tone3: mermaid: medium-dark skin tone :mermaid_tone4: mermaid: dark skin tone :mermaid_tone5: merman :merman: merman: light skin tone :merman_tone1: merman: medium-light skin tone :merman_tone2: merman: medium skin tone :merman_tone3: merman: medium-dark skin tone :merman_tone4: merman: dark skin tone :merman_tone5: merperson :merperson: merperson: light skin tone :merperson_tone1: merperson: medium-light skin tone :merperson_tone2: merperson: medium skin tone :merperson_tone3: merperson: medium-dark skin tone :merperson_tone4: merperson: dark skin tone :merperson_tone5: sign of the horns :metal: sign of the horns: light skin tone :metal_tone1: sign of the horns: medium-light skin tone :metal_tone2: sign of the horns: medium skin tone :metal_tone3: sign of the horns: medium-dark skin tone :metal_tone4: sign of the horns: dark skin tone :metal_tone5: metro :metro: studio microphone :microphone2: microphone :microphone: microscope :microscope: middle finger :middle_finger: middle finger: light skin tone :middle_finger_tone1: middle finger: medium-light skin tone :middle_finger_tone2: middle finger: medium skin tone :middle_finger_tone3: middle finger: medium-dark skin tone :middle_finger_tone4: middle finger: dark skin tone :middle_finger_tone5: military medal :military_medal: glass of milk :milk: milky way :milky_way: minibus :minibus: computer disk :minidisc: mobile phone off :mobile_phone_off: money-mouth face :money_mouth: money with wings :money_with_wings: money bag :moneybag: monkey :monkey: monkey face :monkey_face: monorail :monorail: graduation cap :mortar_board: mosque :mosque: motor scooter :motor_scooter: motor boat :motorboat: motorcycle :motorcycle: motorway :motorway: mount fuji :mount_fuji: mountain :mountain: mountain cableway :mountain_cableway: mountain railway :mountain_railway: snow-capped mountain :mountain_snow: mouse :mouse2: mouse face :mouse: computer mouse :mouse_three_button: movie camera :movie_camera: moai :moyai: Mrs. Claus :mrs_claus: Mrs. Claus: light skin tone :mrs_claus_tone1: Mrs. Claus: medium-light skin tone :mrs_claus_tone2: Mrs. Claus: medium skin tone :mrs_claus_tone3: Mrs. Claus: medium-dark skin tone :mrs_claus_tone4: Mrs. Claus: dark skin tone :mrs_claus_tone5: flexed biceps :muscle: flexed biceps: light skin tone :muscle_tone1: flexed biceps: medium-light skin tone :muscle_tone2: flexed biceps: medium skin tone :muscle_tone3: flexed biceps: medium-dark skin tone :muscle_tone4: flexed biceps: dark skin tone :muscle_tone5: mushroom :mushroom: musical keyboard :musical_keyboard: musical note :musical_note: musical score :musical_score: muted speaker :mute: nail polish :nail_care: nail polish: light skin tone :nail_care_tone1: nail polish: medium-light skin tone :nail_care_tone2: nail polish: medium skin tone :nail_care_tone3: nail polish: medium-dark skin tone :nail_care_tone4: nail polish: dark skin tone :nail_care_tone5: name badge :name_badge: nauseated face :nauseated_face: necktie :necktie: cross mark button :negative_squared_cross_mark: nerd face :nerd: neutral face :neutral_face: NEW button :new: new moon :new_moon: new moon face :new_moon_with_face: rolled-up newspaper :newspaper2: newspaper :newspaper: NG button :ng: night with stars :night_with_stars: keycap: 9 :nine: bell with slash :no_bell: no bicycles :no_bicycles: no entry :no_entry: prohibited :no_entry_sign: no mobile phones :no_mobile_phones: face without mouth :no_mouth: no pedestrians :no_pedestrians: no smoking :no_smoking: non-potable water :non-potable_water: nose :nose: nose: light skin tone :nose_tone1: nose: medium-light skin tone :nose_tone2: nose: medium skin tone :nose_tone3: nose: medium-dark skin tone :nose_tone4: nose: dark skin tone :nose_tone5: notebook :notebook: notebook with decorative cover :notebook_with_decorative_cover: spiral notepad :notepad_spiral: musical notes :notes: nut and bolt :nut_and_bolt: O button (blood type) :o2: heavy large circle :o: water wave :ocean: stop sign :octagonal_sign: octopus :octopus: oden :oden: office building :office: oil drum :oil: OK button :ok: OK hand :ok_hand: OK hand: light skin tone :ok_hand_tone1: OK hand: medium-light skin tone :ok_hand_tone2: OK hand: medium skin tone :ok_hand_tone3: OK hand: medium-dark skin tone :ok_hand_tone4: OK hand: dark skin tone :ok_hand_tone5: older adult :older_adult: older adult: light skin tone :older_adult_tone1: older adult: medium-light skin tone :older_adult_tone2: older adult: medium skin tone :older_adult_tone3: older adult: medium-dark skin tone :older_adult_tone4: older adult: dark skin tone :older_adult_tone5: old man :older_man: old man: light skin tone :older_man_tone1: old man: medium-light skin tone :older_man_tone2: old man: medium skin tone :older_man_tone3: old man: medium-dark skin tone :older_man_tone4: old man: dark skin tone :older_man_tone5: old woman :older_woman: old woman: light skin tone :older_woman_tone1: old woman: medium-light skin tone :older_woman_tone2: old woman: medium skin tone :older_woman_tone3: old woman: medium-dark skin tone :older_woman_tone4: old woman: dark skin tone :older_woman_tone5: om :om_symbol: ON! arrow :on: oncoming automobile :oncoming_automobile: oncoming bus :oncoming_bus: oncoming police car :oncoming_police_car: oncoming taxi :oncoming_taxi: keycap: 1 :one: open file folder :open_file_folder: open hands :open_hands: open hands: light skin tone :open_hands_tone1: open hands: medium-light skin tone :open_hands_tone2: open hands: medium skin tone :open_hands_tone3: open hands: medium-dark skin tone :open_hands_tone4: open hands: dark skin tone :open_hands_tone5: face with open mouth :open_mouth: Ophiuchus :ophiuchus: orange book :orange_book: orange heart :orange_heart: orthodox cross :orthodox_cross: outbox tray :outbox_tray: owl :owl: ox :ox: package :package: page facing up :page_facing_up: page with curl :page_with_curl: pager :pager: paintbrush :paintbrush: palm tree :palm_tree: palms up together :palms_up_together: palms up together: light skin tone :palms_up_together_tone1: palms up together: medium-light skin tone :palms_up_together_tone2: palms up together: medium skin tone :palms_up_together_tone3: palms up together: medium-dark skin tone :palms_up_together_tone4: palms up together: dark skin tone :palms_up_together_tone5: pancakes :pancakes: panda face :panda_face: paperclip :paperclip: linked paperclips :paperclips: national park :park: P button :parking: part alternation mark :part_alternation_mark: sun behind cloud :partly_sunny: passport control :passport_control: pause button :pause_button: peace symbol :peace: peach :peach: peanuts :peanuts: pear :pear: pen :pen_ballpoint: fountain pen :pen_fountain: pencil :pencil2: memo :pencil: penguin :penguin: pensive face :pensive: people with bunny ears partying :people_with_bunny_ears_partying: people wrestling :people_wrestling: performing arts :performing_arts: persevering face :persevere: person biking :person_biking: person biking: light skin tone :person_biking_tone1: person biking: medium-light skin tone :person_biking_tone2: person biking: medium skin tone :person_biking_tone3: person biking: medium-dark skin tone :person_biking_tone4: person biking: dark skin tone :person_biking_tone5: person bouncing ball :person_bouncing_ball: person bouncing ball: light skin tone :person_bouncing_ball_tone1: person bouncing ball: medium-light skin tone :person_bouncing_ball_tone2: person bouncing ball: medium skin tone :person_bouncing_ball_tone3: person bouncing ball: medium-dark skin tone :person_bouncing_ball_tone4: person bouncing ball: dark skin tone :person_bouncing_ball_tone5: person bowing :person_bowing: person bowing: light skin tone :person_bowing_tone1: person bowing: medium-light skin tone :person_bowing_tone2: person bowing: medium skin tone :person_bowing_tone3: person bowing: medium-dark skin tone :person_bowing_tone4: person bowing: dark skin tone :person_bowing_tone5: person climbing :person_climbing: person climbing: light skin tone :person_climbing_tone1: person climbing: medium-light skin tone :person_climbing_tone2: person climbing: medium skin tone :person_climbing_tone3: person climbing: medium-dark skin tone :person_climbing_tone4: person climbing: dark skin tone :person_climbing_tone5: person cartwheeling :person_doing_cartwheel: person cartwheeling: light skin tone :person_doing_cartwheel_tone1: person cartwheeling: medium-light skin tone :person_doing_cartwheel_tone2: person cartwheeling: medium skin tone :person_doing_cartwheel_tone3: person cartwheeling: medium-dark skin tone :person_doing_cartwheel_tone4: person cartwheeling: dark skin tone :person_doing_cartwheel_tone5: person facepalming :person_facepalming: person facepalming: light skin tone :person_facepalming_tone1: person facepalming: medium-light skin tone :person_facepalming_tone2: person facepalming: medium skin tone :person_facepalming_tone3: person facepalming: medium-dark skin tone :person_facepalming_tone4: person facepalming: dark skin tone :person_facepalming_tone5: person fencing :person_fencing: person frowning :person_frowning: person frowning: light skin tone :person_frowning_tone1: person frowning: medium-light skin tone :person_frowning_tone2: person frowning: medium skin tone :person_frowning_tone3: person frowning: medium-dark skin tone :person_frowning_tone4: person frowning: dark skin tone :person_frowning_tone5: person gesturing NO :person_gesturing_no: person gesturing NO: light skin tone :person_gesturing_no_tone1: person gesturing NO: medium-light skin tone :person_gesturing_no_tone2: person gesturing NO: medium skin tone :person_gesturing_no_tone3: person gesturing NO: medium-dark skin tone :person_gesturing_no_tone4: person gesturing NO: dark skin tone :person_gesturing_no_tone5: person gesturing OK :person_gesturing_ok: person gesturing OK: light skin tone :person_gesturing_ok_tone1: person gesturing OK: medium-light skin tone :person_gesturing_ok_tone2: person gesturing OK: medium skin tone :person_gesturing_ok_tone3: person gesturing OK: medium-dark skin tone :person_gesturing_ok_tone4: person gesturing OK: dark skin tone :person_gesturing_ok_tone5: person getting haircut :person_getting_haircut: person getting haircut: light skin tone :person_getting_haircut_tone1: person getting haircut: medium-light skin tone :person_getting_haircut_tone2: person getting haircut: medium skin tone :person_getting_haircut_tone3: person getting haircut: medium-dark skin tone :person_getting_haircut_tone4: person getting haircut: dark skin tone :person_getting_haircut_tone5: person getting massage :person_getting_massage: person getting massage: light skin tone :person_getting_massage_tone1: person getting massage: medium-light skin tone :person_getting_massage_tone2: person getting massage: medium skin tone :person_getting_massage_tone3: person getting massage: medium-dark skin tone :person_getting_massage_tone4: person getting massage: dark skin tone :person_getting_massage_tone5: person golfing :person_golfing: person golfing: light skin tone :person_golfing_tone1: person golfing: medium-light skin tone :person_golfing_tone2: person golfing: medium skin tone :person_golfing_tone3: person golfing: medium-dark skin tone :person_golfing_tone4: person golfing: dark skin tone :person_golfing_tone5: person in bed: light skin tone :person_in_bed_tone1: person in bed: medium-light skin tone :person_in_bed_tone2: person in bed: medium skin tone :person_in_bed_tone3: person in bed: medium-dark skin tone :person_in_bed_tone4: person in bed: dark skin tone :person_in_bed_tone5: person in lotus position :person_in_lotus_position: person in lotus position: light skin tone :person_in_lotus_position_tone1: person in lotus position: medium-light skin tone :person_in_lotus_position_tone2: person in lotus position: medium skin tone :person_in_lotus_position_tone3: person in lotus position: medium-dark skin tone :person_in_lotus_position_tone4: person in lotus position: dark skin tone :person_in_lotus_position_tone5: person in steamy room :person_in_steamy_room: person in steamy room: light skin tone :person_in_steamy_room_tone1: person in steamy room: medium-light skin tone :person_in_steamy_room_tone2: person in steamy room: medium skin tone :person_in_steamy_room_tone3: person in steamy room: medium-dark skin tone :person_in_steamy_room_tone4: person in steamy room: dark skin tone :person_in_steamy_room_tone5: person juggling :person_juggling: person juggling: light skin tone :person_juggling_tone1: person juggling: medium-light skin tone :person_juggling_tone2: person juggling: medium skin tone :person_juggling_tone3: person juggling: medium-dark skin tone :person_juggling_tone4: person juggling: dark skin tone :person_juggling_tone5: person lifting weights :person_lifting_weights: person lifting weights: light skin tone :person_lifting_weights_tone1: person lifting weights: medium-light skin tone :person_lifting_weights_tone2: person lifting weights: medium skin tone :person_lifting_weights_tone3: person lifting weights: medium-dark skin tone :person_lifting_weights_tone4: person lifting weights: dark skin tone :person_lifting_weights_tone5: person mountain biking :person_mountain_biking: person mountain biking: light skin tone :person_mountain_biking_tone1: person mountain biking: medium-light skin tone :person_mountain_biking_tone2: person mountain biking: medium skin tone :person_mountain_biking_tone3: person mountain biking: medium-dark skin tone :person_mountain_biking_tone4: person mountain biking: dark skin tone :person_mountain_biking_tone5: person playing handball :person_playing_handball: person playing handball: light skin tone :person_playing_handball_tone1: person playing handball: medium-light skin tone :person_playing_handball_tone2: person playing handball: medium skin tone :person_playing_handball_tone3: person playing handball: medium-dark skin tone :person_playing_handball_tone4: person playing handball: dark skin tone :person_playing_handball_tone5: person playing water polo :person_playing_water_polo: person playing water polo: light skin tone :person_playing_water_polo_tone1: person playing water polo: medium-light skin tone :person_playing_water_polo_tone2: person playing water polo: medium skin tone :person_playing_water_polo_tone3: person playing water polo: medium-dark skin tone :person_playing_water_polo_tone4: person playing water polo: dark skin tone :person_playing_water_polo_tone5: person pouting :person_pouting: person pouting: light skin tone :person_pouting_tone1: person pouting: medium-light skin tone :person_pouting_tone2: person pouting: medium skin tone :person_pouting_tone3: person pouting: medium-dark skin tone :person_pouting_tone4: person pouting: dark skin tone :person_pouting_tone5: person raising hand :person_raising_hand: person raising hand: light skin tone :person_raising_hand_tone1: person raising hand: medium-light skin tone :person_raising_hand_tone2: person raising hand: medium skin tone :person_raising_hand_tone3: person raising hand: medium-dark skin tone :person_raising_hand_tone4: person raising hand: dark skin tone :person_raising_hand_tone5: person rowing boat :person_rowing_boat: person rowing boat: light skin tone :person_rowing_boat_tone1: person rowing boat: medium-light skin tone :person_rowing_boat_tone2: person rowing boat: medium skin tone :person_rowing_boat_tone3: person rowing boat: medium-dark skin tone :person_rowing_boat_tone4: person rowing boat: dark skin tone :person_rowing_boat_tone5: person running :person_running: person running: light skin tone :person_running_tone1: person running: medium-light skin tone :person_running_tone2: person running: medium skin tone :person_running_tone3: person running: medium-dark skin tone :person_running_tone4: person running: dark skin tone :person_running_tone5: person shrugging :person_shrugging: person shrugging: light skin tone :person_shrugging_tone1: person shrugging: medium-light skin tone :person_shrugging_tone2: person shrugging: medium skin tone :person_shrugging_tone3: person shrugging: medium-dark skin tone :person_shrugging_tone4: person shrugging: dark skin tone :person_shrugging_tone5: person surfing :person_surfing: person surfing: light skin tone :person_surfing_tone1: person surfing: medium-light skin tone :person_surfing_tone2: person surfing: medium skin tone :person_surfing_tone3: person surfing: medium-dark skin tone :person_surfing_tone4: person surfing: dark skin tone :person_surfing_tone5: person swimming :person_swimming: person swimming: light skin tone :person_swimming_tone1: person swimming: medium-light skin tone :person_swimming_tone2: person swimming: medium skin tone :person_swimming_tone3: person swimming: medium-dark skin tone :person_swimming_tone4: person swimming: dark skin tone :person_swimming_tone5: person tipping hand :person_tipping_hand: person tipping hand: light skin tone :person_tipping_hand_tone1: person tipping hand: medium-light skin tone :person_tipping_hand_tone2: person tipping hand: medium skin tone :person_tipping_hand_tone3: person tipping hand: medium-dark skin tone :person_tipping_hand_tone4: person tipping hand: dark skin tone :person_tipping_hand_tone5: person walking :person_walking: person walking: light skin tone :person_walking_tone1: person walking: medium-light skin tone :person_walking_tone2: person walking: medium skin tone :person_walking_tone3: person walking: medium-dark skin tone :person_walking_tone4: person walking: dark skin tone :person_walking_tone5: person wearing turban :person_wearing_turban: person wearing turban: light skin tone :person_wearing_turban_tone1: person wearing turban: medium-light skin tone :person_wearing_turban_tone2: person wearing turban: medium skin tone :person_wearing_turban_tone3: person wearing turban: medium-dark skin tone :person_wearing_turban_tone4: person wearing turban: dark skin tone :person_wearing_turban_tone5: pick :pick: pie :pie: pig :pig2: pig face :pig: pig nose :pig_nose: pill :pill: pineapple :pineapple: ping pong :ping_pong: Pisces :pisces: pizza :pizza: place of worship :place_of_worship: play or pause button :play_pause: backhand index pointing down :point_down: backhand index pointing down: light skin tone :point_down_tone1: backhand index pointing down: medium-light skin tone :point_down_tone2: backhand index pointing down: medium skin tone :point_down_tone3: backhand index pointing down: medium-dark skin tone :point_down_tone4: backhand index pointing down: dark skin tone :point_down_tone5: backhand index pointing left :point_left: backhand index pointing left: light skin tone :point_left_tone1: backhand index pointing left: medium-light skin tone :point_left_tone2: backhand index pointing left: medium skin tone :point_left_tone3: backhand index pointing left: medium-dark skin tone :point_left_tone4: backhand index pointing left: dark skin tone :point_left_tone5: backhand index pointing right :point_right: backhand index pointing right: light skin tone :point_right_tone1: backhand index pointing right: medium-light skin tone :point_right_tone2: backhand index pointing right: medium skin tone :point_right_tone3: backhand index pointing right: medium-dark skin tone :point_right_tone4: backhand index pointing right: dark skin tone :point_right_tone5: index pointing up :point_up: backhand index pointing up :point_up_2: backhand index pointing up: light skin tone :point_up_2_tone1: backhand index pointing up: medium-light skin tone :point_up_2_tone2: backhand index pointing up: medium skin tone :point_up_2_tone3: backhand index pointing up: medium-dark skin tone :point_up_2_tone4: backhand index pointing up: dark skin tone :point_up_2_tone5: index pointing up: light skin tone :point_up_tone1: index pointing up: medium-light skin tone :point_up_tone2: index pointing up: medium skin tone :point_up_tone3: index pointing up: medium-dark skin tone :point_up_tone4: index pointing up: dark skin tone :point_up_tone5: police car :police_car: police officer :police_officer: police officer: light skin tone :police_officer_tone1: police officer: medium-light skin tone :police_officer_tone2: police officer: medium skin tone :police_officer_tone3: police officer: medium-dark skin tone :police_officer_tone4: police officer: dark skin tone :police_officer_tone5: poodle :poodle: pile of poo :poop: popcorn :popcorn: Japanese post office :post_office: postal horn :postal_horn: postbox :postbox: potable water :potable_water: potato :potato: clutch bag :pouch: poultry leg :poultry_leg: pound banknote :pound: pound symbol :pound_symbol: pouting cat face :pouting_cat: folded hands :pray: folded hands: light skin tone :pray_tone1: folded hands: medium-light skin tone :pray_tone2: folded hands: medium skin tone :pray_tone3: folded hands: medium-dark skin tone :pray_tone4: folded hands: dark skin tone :pray_tone5: prayer beads :prayer_beads: pregnant woman :pregnant_woman: pregnant woman: light skin tone :pregnant_woman_tone1: pregnant woman: medium-light skin tone :pregnant_woman_tone2: pregnant woman: medium skin tone :pregnant_woman_tone3: pregnant woman: medium-dark skin tone :pregnant_woman_tone4: pregnant woman: dark skin tone :pregnant_woman_tone5: pretzel :pretzel: prince :prince: prince: light skin tone :prince_tone1: prince: medium-light skin tone :prince_tone2: prince: medium skin tone :prince_tone3: prince: medium-dark skin tone :prince_tone4: prince: dark skin tone :prince_tone5: princess :princess: princess: light skin tone :princess_tone1: princess: medium-light skin tone :princess_tone2: princess: medium skin tone :princess_tone3: princess: medium-dark skin tone :princess_tone4: princess: dark skin tone :princess_tone5: printer :printer: film projector :projector: oncoming fist :punch: oncoming fist: light skin tone :punch_tone1: oncoming fist: medium-light skin tone :punch_tone2: oncoming fist: medium skin tone :punch_tone3: oncoming fist: medium-dark skin tone :punch_tone4: oncoming fist: dark skin tone :punch_tone5: purple heart :purple_heart: purse :purse: pushpin :pushpin: litter in bin sign :put_litter_in_its_place: question mark :question: rabbit :rabbit2: rabbit face :rabbit: racing car :race_car: horse :racehorse: radio :radio: radio button :radio_button: radioactive :radioactive: pouting face :rage: railway car :railway_car: railway track :railway_track: rainbow :rainbow: rainbow flag :rainbow_flag: raised back of hand :raised_back_of_hand: raised back of hand: light skin tone :raised_back_of_hand_tone1: raised back of hand: medium-light skin tone :raised_back_of_hand_tone2: raised back of hand: medium skin tone :raised_back_of_hand_tone3: raised back of hand: medium-dark skin tone :raised_back_of_hand_tone4: raised back of hand: dark skin tone :raised_back_of_hand_tone5: raised hand :raised_hand: raised hand: light skin tone :raised_hand_tone1: raised hand: medium-light skin tone :raised_hand_tone2: raised hand: medium skin tone :raised_hand_tone3: raised hand: medium-dark skin tone :raised_hand_tone4: raised hand: dark skin tone :raised_hand_tone5: raising hands :raised_hands: raising hands: light skin tone :raised_hands_tone1: raising hands: medium-light skin tone :raised_hands_tone2: raising hands: medium skin tone :raised_hands_tone3: raising hands: medium-dark skin tone :raised_hands_tone4: raising hands: dark skin tone :raised_hands_tone5: ram :ram: steaming bowl :ramen: rat :rat: record button :record_button: recycling symbol :recycle: automobile :red_car: red circle :red_circle: regional indicator symbol letter a :regional_indicator_a: regional indicator symbol letter b :regional_indicator_b: regional indicator symbol letter c :regional_indicator_c: regional indicator symbol letter d :regional_indicator_d: regional indicator symbol letter e :regional_indicator_e: regional indicator symbol letter f :regional_indicator_f: regional indicator symbol letter g :regional_indicator_g: regional indicator symbol letter h :regional_indicator_h: regional indicator symbol letter i :regional_indicator_i: regional indicator symbol letter j :regional_indicator_j: regional indicator symbol letter k :regional_indicator_k: regional indicator symbol letter l :regional_indicator_l: regional indicator symbol letter m :regional_indicator_m: regional indicator symbol letter n :regional_indicator_n: regional indicator symbol letter o :regional_indicator_o: regional indicator symbol letter p :regional_indicator_p: regional indicator symbol letter q :regional_indicator_q: regional indicator symbol letter r :regional_indicator_r: regional indicator symbol letter s :regional_indicator_s: regional indicator symbol letter t :regional_indicator_t: regional indicator symbol letter u :regional_indicator_u: regional indicator symbol letter v :regional_indicator_v: regional indicator symbol letter w :regional_indicator_w: regional indicator symbol letter x :regional_indicator_x: regional indicator symbol letter y :regional_indicator_y: regional indicator symbol letter z :regional_indicator_z: registered :registered: smiling face :relaxed: relieved face :relieved: reminder ribbon :reminder_ribbon: repeat button :repeat: repeat single button :repeat_one: restroom :restroom: revolving hearts :revolving_hearts: fast reverse button :rewind: rhinoceros :rhino: ribbon :ribbon: cooked rice :rice: rice ball :rice_ball: rice cracker :rice_cracker: moon viewing ceremony :rice_scene: right-facing fist :right_facing_fist: right-facing fist: light skin tone :right_facing_fist_tone1: right-facing fist: medium-light skin tone :right_facing_fist_tone2: right-facing fist: medium skin tone :right_facing_fist_tone3: right-facing fist: medium-dark skin tone :right_facing_fist_tone4: right-facing fist: dark skin tone :right_facing_fist_tone5: ring :ring: robot face :robot: rocket :rocket: rolling on the floor laughing :rofl: roller coaster :roller_coaster: face with rolling eyes :rolling_eyes: rooster :rooster: rose :rose: rosette :rosette: police car light :rotating_light: round pushpin :round_pushpin: rugby football :rugby_football: running shirt :running_shirt_with_sash: Japanese \\u201cservice charge\\u201d button :sa: Sagittarius :sagittarius: sailboat :sailboat: sake :sake: green salad :salad: woman\\u2019s sandal :sandal: sandwich :sandwich: Santa Claus :santa: Santa Claus: light skin tone :santa_tone1: Santa Claus: medium-light skin tone :santa_tone2: Santa Claus: medium skin tone :santa_tone3: Santa Claus: medium-dark skin tone :santa_tone4: Santa Claus: dark skin tone :santa_tone5: satellite antenna :satellite: satellite :satellite_orbital: sauropod :sauropod: saxophone :saxophone: balance scale :scales: scarf :scarf: school :school: school backpack :school_satchel: scissors :scissors: kick scooter :scooter: scorpion :scorpion: Scorpius :scorpius: Scotland :scotland: face screaming in fear :scream: weary cat face :scream_cat: scroll :scroll: seat :seat: 2 nd place medal :second_place: Japanese \\u201csecret\\u201d button :secret: see-no-evil monkey :see_no_evil: seedling :seedling: selfie :selfie: selfie: light skin tone :selfie_tone1: selfie: medium-light skin tone :selfie_tone2: selfie: medium skin tone :selfie_tone3: selfie: medium-dark skin tone :selfie_tone4: selfie: dark skin tone :selfie_tone5: keycap: 7 :seven: shallow pan of food :shallow_pan_of_food: shamrock :shamrock: shark :shark: shaved ice :shaved_ice: ewe :sheep: spiral shell :shell: shield :shield: shinto shrine :shinto_shrine: ship :ship: t-shirt :shirt: shopping bags :shopping_bags: shopping cart :shopping_cart: shower :shower: shrimp :shrimp: shushing face :shushing_face: antenna bars :signal_strength: keycap: 6 :six: dotted six-pointed star :six_pointed_star: skis :ski: skier :skier: skull :skull: skull and crossbones :skull_crossbones: sled :sled: sleeping face :sleeping: person in bed :sleeping_accommodation: sleepy face :sleepy: slightly frowning face :slight_frown: slightly smiling face :slight_smile: slot machine :slot_machine: small blue diamond :small_blue_diamond: small orange diamond :small_orange_diamond: red triangle pointed up :small_red_triangle: red triangle pointed down :small_red_triangle_down: smiling face with open mouth & smiling eyes :smile: grinning cat face with smiling eyes :smile_cat: smiling face with open mouth :smiley: smiling cat face with open mouth :smiley_cat: smiling face with horns :smiling_imp: smirking face :smirk: cat face with wry smile :smirk_cat: cigarette :smoking: snail :snail: snake :snake: sneezing face :sneezing_face: snowboarder :snowboarder: snowboarder: light skin tone :snowboarder_tone1: snowboarder: medium-light skin tone :snowboarder_tone2: snowboarder: medium skin tone :snowboarder_tone3: snowboarder: medium-dark skin tone :snowboarder_tone4: snowboarder: dark skin tone :snowboarder_tone5: snowflake :snowflake: snowman :snowman2: snowman without snow :snowman: loudly crying face :sob: soccer ball :soccer: socks :socks: SOON arrow :soon: SOS button :sos: speaker medium volume :sound: alien monster :space_invader: spade suit :spades: spaghetti :spaghetti: sparkle :sparkle: sparkler :sparkler: sparkles :sparkles: sparkling heart :sparkling_heart: speak-no-evil monkey :speak_no_evil: speaker low volume :speaker: speaking head :speaking_head: speech balloon :speech_balloon: left speech bubble :speech_left: speedboat :speedboat: spider :spider: spider web :spider_web: spoon :spoon: squid :squid: stadium :stadium: glowing star :star2: white medium star :star: star and crescent :star_and_crescent: star of David :star_of_david: star-struck :star_struck: shooting star :stars: station :station: Statue of Liberty :statue_of_liberty: locomotive :steam_locomotive: pot of food :stew: stop button :stop_button: stopwatch :stopwatch: straight ruler :straight_ruler: strawberry :strawberry: face with stuck-out tongue :stuck_out_tongue: face with stuck-out tongue & closed eyes :stuck_out_tongue_closed_eyes: face with stuck-out tongue & winking eye :stuck_out_tongue_winking_eye: stuffed flatbread :stuffed_flatbread: sun with face :sun_with_face: sunflower :sunflower: smiling face with sunglasses :sunglasses: sun :sunny: sunrise :sunrise: sunrise over mountains :sunrise_over_mountains: sushi :sushi: suspension railway :suspension_railway: face with cold sweat :sweat: sweat droplets :sweat_drops: smiling face with open mouth & cold sweat :sweat_smile: roasted sweet potato :sweet_potato: input symbols :symbols: synagogue :synagogue: syringe :syringe: T-Rex :t_rex: taco :taco: party popper :tada: takeout box :takeout_box: tanabata tree :tanabata_tree: tangerine :tangerine: Taurus :taurus: taxi :taxi: teacup without handle :tea: telephone :telephone: telephone receiver :telephone_receiver: telescope :telescope: tennis :tennis: tent :tent: thermometer :thermometer: face with thermometer :thermometer_face: thinking face :thinking: 3 rd place medal :third_place: thought balloon :thought_balloon: keycap: 3 :three: thumbs down :thumbsdown: thumbs down: light skin tone :thumbsdown_tone1: thumbs down: medium-light skin tone :thumbsdown_tone2: thumbs down: medium skin tone :thumbsdown_tone3: thumbs down: medium-dark skin tone :thumbsdown_tone4: thumbs down: dark skin tone :thumbsdown_tone5: thumbs up :thumbsup: thumbs up: light skin tone :thumbsup_tone1: thumbs up: medium-light skin tone :thumbsup_tone2: thumbs up: medium skin tone :thumbsup_tone3: thumbs up: medium-dark skin tone :thumbsup_tone4: thumbs up: dark skin tone :thumbsup_tone5: cloud with lightning and rain :thunder_cloud_rain: ticket :ticket: admission tickets :tickets: tiger :tiger2: tiger face :tiger: timer clock :timer: tired face :tired_face: trade mark :tm: toilet :toilet: Tokyo tower :tokyo_tower: tomato :tomato: light skin tone :tone1: medium-light skin tone :tone2: medium skin tone :tone3: medium-dark skin tone :tone4: dark skin tone :tone5: tongue :tongue: hammer and wrench :tools: TOP arrow :top: top hat :tophat: next track button :track_next: last track button :track_previous: trackball :trackball: tractor :tractor: horizontal traffic light :traffic_light: train :train2: tram car :train: tram :tram: triangular flag :triangular_flag_on_post: triangular ruler :triangular_ruler: trident emblem :trident: face with steam from nose :triumph: trolleybus :trolleybus: trophy :trophy: tropical drink :tropical_drink: tropical fish :tropical_fish: delivery truck :truck: trumpet :trumpet: tulip :tulip: tumbler glass :tumbler_glass: turkey :turkey: turtle :turtle: television :tv: shuffle tracks button :twisted_rightwards_arrows: keycap: 2 :two: two hearts :two_hearts: two men holding hands :two_men_holding_hands: two women holding hands :two_women_holding_hands: Japanese \\u201cdiscount\\u201d button :u5272: Japanese \\u201cpassing grade\\u201d button :u5408: Japanese \\u201copen for business\\u201d button :u55b6: Japanese \\u201creserved\\u201d button :u6307: Japanese \\u201cmonthly amount\\u201d button :u6708: Japanese \\u201cnot free of charge\\u201d button :u6709: Japanese \\u201cno vacancy\\u201d button :u6e80: Japanese \\u201cfree of charge\\u201d button :u7121: Japanese \\u201capplication\\u201d button :u7533: Japanese \\u201cprohibited\\u201d button :u7981: Japanese \\u201cvacancy\\u201d button :u7a7a: umbrella :umbrella2: umbrella with rain drops :umbrella: unamused face :unamused: no one under eighteen :underage: unicorn face :unicorn: United Nations :united_nations: unlocked :unlock: UP! button :up: upside-down face :upside_down: funeral urn :urn: victory hand :v: victory hand: light skin tone :v_tone1: victory hand: medium-light skin tone :v_tone2: victory hand: medium skin tone :v_tone3: victory hand: medium-dark skin tone :v_tone4: victory hand: dark skin tone :v_tone5: vampire :vampire: vampire: light skin tone :vampire_tone1: vampire: medium-light skin tone :vampire_tone2: vampire: medium skin tone :vampire_tone3: vampire: medium-dark skin tone :vampire_tone4: vampire: dark skin tone :vampire_tone5: vertical traffic light :vertical_traffic_light: videocassette :vhs: vibration mode :vibration_mode: video camera :video_camera: video game :video_game: violin :violin: Virgo :virgo: volcano :volcano: volleyball :volleyball: VS button :vs: vulcan salute :vulcan: vulcan salute: light skin tone :vulcan_tone1: vulcan salute: medium-light skin tone :vulcan_tone2: vulcan salute: medium skin tone :vulcan_tone3: vulcan salute: medium-dark skin tone :vulcan_tone4: vulcan salute: dark skin tone :vulcan_tone5: Wales :wales: waning crescent moon :waning_crescent_moon: waning gibbous moon :waning_gibbous_moon: warning :warning: wastebasket :wastebasket: watch :watch: water buffalo :water_buffalo: watermelon :watermelon: waving hand :wave: waving hand: light skin tone :wave_tone1: waving hand: medium-light skin tone :wave_tone2: waving hand: medium skin tone :wave_tone3: waving hand: medium-dark skin tone :wave_tone4: waving hand: dark skin tone :wave_tone5: wavy dash :wavy_dash: waxing crescent moon :waxing_crescent_moon: waxing gibbous moon :waxing_gibbous_moon: water closet :wc: weary face :weary: wedding :wedding: whale :whale2: spouting whale :whale: wheel of dharma :wheel_of_dharma: wheelchair symbol :wheelchair: white heavy check mark :white_check_mark: white circle :white_circle: white flower :white_flower: white large square :white_large_square: white medium-small square :white_medium_small_square: white medium square :white_medium_square: white small square :white_small_square: white square button :white_square_button: sun behind large cloud :white_sun_cloud: sun behind rain cloud :white_sun_rain_cloud: sun behind small cloud :white_sun_small_cloud: wilted flower :wilted_rose: wind face :wind_blowing_face: wind chime :wind_chime: wine glass :wine_glass: winking face :wink: wolf face :wolf: woman :woman: woman artist :woman_artist: woman artist: light skin tone :woman_artist_tone1: woman artist: medium-light skin tone :woman_artist_tone2: woman artist: medium skin tone :woman_artist_tone3: woman artist: medium-dark skin tone :woman_artist_tone4: woman artist: dark skin tone :woman_artist_tone5: woman astronaut :woman_astronaut: woman astronaut: light skin tone :woman_astronaut_tone1: woman astronaut: medium-light skin tone :woman_astronaut_tone2: woman astronaut: medium skin tone :woman_astronaut_tone3: woman astronaut: medium-dark skin tone :woman_astronaut_tone4: woman astronaut: dark skin tone :woman_astronaut_tone5: woman biking :woman_biking: woman biking: light skin tone :woman_biking_tone1: woman biking: medium-light skin tone :woman_biking_tone2: woman biking: medium skin tone :woman_biking_tone3: woman biking: medium-dark skin tone :woman_biking_tone4: woman biking: dark skin tone :woman_biking_tone5: woman bouncing ball :woman_bouncing_ball: woman bouncing ball: light skin tone :woman_bouncing_ball_tone1: woman bouncing ball: medium-light skin tone :woman_bouncing_ball_tone2: woman bouncing ball: medium skin tone :woman_bouncing_ball_tone3: woman bouncing ball: medium-dark skin tone :woman_bouncing_ball_tone4: woman bouncing ball: dark skin tone :woman_bouncing_ball_tone5: woman bowing :woman_bowing: woman bowing: light skin tone :woman_bowing_tone1: woman bowing: medium-light skin tone :woman_bowing_tone2: woman bowing: medium skin tone :woman_bowing_tone3: woman bowing: medium-dark skin tone :woman_bowing_tone4: woman bowing: dark skin tone :woman_bowing_tone5: woman cartwheeling :woman_cartwheeling: woman cartwheeling: light skin tone :woman_cartwheeling_tone1: woman cartwheeling: medium-light skin tone :woman_cartwheeling_tone2: woman cartwheeling: medium skin tone :woman_cartwheeling_tone3: woman cartwheeling: medium-dark skin tone :woman_cartwheeling_tone4: woman cartwheeling: dark skin tone :woman_cartwheeling_tone5: woman climbing :woman_climbing: woman climbing: light skin tone :woman_climbing_tone1: woman climbing: medium-light skin tone :woman_climbing_tone2: woman climbing: medium skin tone :woman_climbing_tone3: woman climbing: medium-dark skin tone :woman_climbing_tone4: woman climbing: dark skin tone :woman_climbing_tone5: woman construction worker :woman_construction_worker: woman construction worker: light skin tone :woman_construction_worker_tone1: woman construction worker: medium-light skin tone :woman_construction_worker_tone2: woman construction worker: medium skin tone :woman_construction_worker_tone3: woman construction worker: medium-dark skin tone :woman_construction_worker_tone4: woman construction worker: dark skin tone :woman_construction_worker_tone5: woman cook :woman_cook: woman cook: light skin tone :woman_cook_tone1: woman cook: medium-light skin tone :woman_cook_tone2: woman cook: medium skin tone :woman_cook_tone3: woman cook: medium-dark skin tone :woman_cook_tone4: woman cook: dark skin tone :woman_cook_tone5: woman detective :woman_detective: woman detective: light skin tone :woman_detective_tone1: woman detective: medium-light skin tone :woman_detective_tone2: woman detective: medium skin tone :woman_detective_tone3: woman detective: medium-dark skin tone :woman_detective_tone4: woman detective: dark skin tone :woman_detective_tone5: woman elf :woman_elf: woman elf: light skin tone :woman_elf_tone1: woman elf: medium-light skin tone :woman_elf_tone2: woman elf: medium skin tone :woman_elf_tone3: woman elf: medium-dark skin tone :woman_elf_tone4: woman elf: dark skin tone :woman_elf_tone5: woman facepalming :woman_facepalming: woman facepalming: light skin tone :woman_facepalming_tone1: woman facepalming: medium-light skin tone :woman_facepalming_tone2: woman facepalming: medium skin tone :woman_facepalming_tone3: woman facepalming: medium-dark skin tone :woman_facepalming_tone4: woman facepalming: dark skin tone :woman_facepalming_tone5: woman factory worker :woman_factory_worker: woman factory worker: light skin tone :woman_factory_worker_tone1: woman factory worker: medium-light skin tone :woman_factory_worker_tone2: woman factory worker: medium skin tone :woman_factory_worker_tone3: woman factory worker: medium-dark skin tone :woman_factory_worker_tone4: woman factory worker: dark skin tone :woman_factory_worker_tone5: woman fairy :woman_fairy: woman fairy: light skin tone :woman_fairy_tone1: woman fairy: medium-light skin tone :woman_fairy_tone2: woman fairy: medium skin tone :woman_fairy_tone3: woman fairy: medium-dark skin tone :woman_fairy_tone4: woman fairy: dark skin tone :woman_fairy_tone5: woman farmer :woman_farmer: woman farmer: light skin tone :woman_farmer_tone1: woman farmer: medium-light skin tone :woman_farmer_tone2: woman farmer: medium skin tone :woman_farmer_tone3: woman farmer: medium-dark skin tone :woman_farmer_tone4: woman farmer: dark skin tone :woman_farmer_tone5: woman firefighter :woman_firefighter: woman firefighter: light skin tone :woman_firefighter_tone1: woman firefighter: medium-light skin tone :woman_firefighter_tone2: woman firefighter: medium skin tone :woman_firefighter_tone3: woman firefighter: medium-dark skin tone :woman_firefighter_tone4: woman firefighter: dark skin tone :woman_firefighter_tone5: woman frowning :woman_frowning: woman frowning: light skin tone :woman_frowning_tone1: woman frowning: medium-light skin tone :woman_frowning_tone2: woman frowning: medium skin tone :woman_frowning_tone3: woman frowning: medium-dark skin tone :woman_frowning_tone4: woman frowning: dark skin tone :woman_frowning_tone5: woman genie :woman_genie: woman gesturing NO :woman_gesturing_no: woman gesturing NO: light skin tone :woman_gesturing_no_tone1: woman gesturing NO: medium-light skin tone :woman_gesturing_no_tone2: woman gesturing NO: medium skin tone :woman_gesturing_no_tone3: woman gesturing NO: medium-dark skin tone :woman_gesturing_no_tone4: woman gesturing NO: dark skin tone :woman_gesturing_no_tone5: woman gesturing OK :woman_gesturing_ok: woman gesturing OK: light skin tone :woman_gesturing_ok_tone1: woman gesturing OK: medium-light skin tone :woman_gesturing_ok_tone2: woman gesturing OK: medium skin tone :woman_gesturing_ok_tone3: woman gesturing OK: medium-dark skin tone :woman_gesturing_ok_tone4: woman gesturing OK: dark skin tone :woman_gesturing_ok_tone5: woman getting massage :woman_getting_face_massage: woman getting massage: light skin tone :woman_getting_face_massage_tone1: woman getting massage: medium-light skin tone :woman_getting_face_massage_tone2: woman getting massage: medium skin tone :woman_getting_face_massage_tone3: woman getting massage: medium-dark skin tone :woman_getting_face_massage_tone4: woman getting massage: dark skin tone :woman_getting_face_massage_tone5: woman getting haircut :woman_getting_haircut: woman getting haircut: light skin tone :woman_getting_haircut_tone1: woman getting haircut: medium-light skin tone :woman_getting_haircut_tone2: woman getting haircut: medium skin tone :woman_getting_haircut_tone3: woman getting haircut: medium-dark skin tone :woman_getting_haircut_tone4: woman getting haircut: dark skin tone :woman_getting_haircut_tone5: woman golfing :woman_golfing: woman golfing: light skin tone :woman_golfing_tone1: woman golfing: medium-light skin tone :woman_golfing_tone2: woman golfing: medium skin tone :woman_golfing_tone3: woman golfing: medium-dark skin tone :woman_golfing_tone4: woman golfing: dark skin tone :woman_golfing_tone5: woman guard :woman_guard: woman guard: light skin tone :woman_guard_tone1: woman guard: medium-light skin tone :woman_guard_tone2: woman guard: medium skin tone :woman_guard_tone3: woman guard: medium-dark skin tone :woman_guard_tone4: woman guard: dark skin tone :woman_guard_tone5: woman health worker :woman_health_worker: woman health worker: light skin tone :woman_health_worker_tone1: woman health worker: medium-light skin tone :woman_health_worker_tone2: woman health worker: medium skin tone :woman_health_worker_tone3: woman health worker: medium-dark skin tone :woman_health_worker_tone4: woman health worker: dark skin tone :woman_health_worker_tone5: woman in lotus position :woman_in_lotus_position: woman in lotus position: light skin tone :woman_in_lotus_position_tone1: woman in lotus position: medium-light skin tone :woman_in_lotus_position_tone2: woman in lotus position: medium skin tone :woman_in_lotus_position_tone3: woman in lotus position: medium-dark skin tone :woman_in_lotus_position_tone4: woman in lotus position: dark skin tone :woman_in_lotus_position_tone5: woman in steamy room :woman_in_steamy_room: woman in steamy room: light skin tone :woman_in_steamy_room_tone1: woman in steamy room: medium-light skin tone :woman_in_steamy_room_tone2: woman in steamy room: medium skin tone :woman_in_steamy_room_tone3: woman in steamy room: medium-dark skin tone :woman_in_steamy_room_tone4: woman in steamy room: dark skin tone :woman_in_steamy_room_tone5: woman judge :woman_judge: woman judge: light skin tone :woman_judge_tone1: woman judge: medium-light skin tone :woman_judge_tone2: woman judge: medium skin tone :woman_judge_tone3: woman judge: medium-dark skin tone :woman_judge_tone4: woman judge: dark skin tone :woman_judge_tone5: woman juggling :woman_juggling: woman juggling: light skin tone :woman_juggling_tone1: woman juggling: medium-light skin tone :woman_juggling_tone2: woman juggling: medium skin tone :woman_juggling_tone3: woman juggling: medium-dark skin tone :woman_juggling_tone4: woman juggling: dark skin tone :woman_juggling_tone5: woman lifting weights :woman_lifting_weights: woman lifting weights: light skin tone :woman_lifting_weights_tone1: woman lifting weights: medium-light skin tone :woman_lifting_weights_tone2: woman lifting weights: medium skin tone :woman_lifting_weights_tone3: woman lifting weights: medium-dark skin tone :woman_lifting_weights_tone4: woman lifting weights: dark skin tone :woman_lifting_weights_tone5: woman mage :woman_mage: woman mage: light skin tone :woman_mage_tone1: woman mage: medium-light skin tone :woman_mage_tone2: woman mage: medium skin tone :woman_mage_tone3: woman mage: medium-dark skin tone :woman_mage_tone4: woman mage: dark skin tone :woman_mage_tone5: woman mechanic :woman_mechanic: woman mechanic: light skin tone :woman_mechanic_tone1: woman mechanic: medium-light skin tone :woman_mechanic_tone2: woman mechanic: medium skin tone :woman_mechanic_tone3: woman mechanic: medium-dark skin tone :woman_mechanic_tone4: woman mechanic: dark skin tone :woman_mechanic_tone5: woman mountain biking :woman_mountain_biking: woman mountain biking: light skin tone :woman_mountain_biking_tone1: woman mountain biking: medium-light skin tone :woman_mountain_biking_tone2: woman mountain biking: medium skin tone :woman_mountain_biking_tone3: woman mountain biking: medium-dark skin tone :woman_mountain_biking_tone4: woman mountain biking: dark skin tone :woman_mountain_biking_tone5: woman office worker :woman_office_worker: woman office worker: light skin tone :woman_office_worker_tone1: woman office worker: medium-light skin tone :woman_office_worker_tone2: woman office worker: medium skin tone :woman_office_worker_tone3: woman office worker: medium-dark skin tone :woman_office_worker_tone4: woman office worker: dark skin tone :woman_office_worker_tone5: woman pilot :woman_pilot: woman pilot: light skin tone :woman_pilot_tone1: woman pilot: medium-light skin tone :woman_pilot_tone2: woman pilot: medium skin tone :woman_pilot_tone3: woman pilot: medium-dark skin tone :woman_pilot_tone4: woman pilot: dark skin tone :woman_pilot_tone5: woman playing handball :woman_playing_handball: woman playing handball: light skin tone :woman_playing_handball_tone1: woman playing handball: medium-light skin tone :woman_playing_handball_tone2: woman playing handball: medium skin tone :woman_playing_handball_tone3: woman playing handball: medium-dark skin tone :woman_playing_handball_tone4: woman playing handball: dark skin tone :woman_playing_handball_tone5: woman playing water polo :woman_playing_water_polo: woman playing water polo: light skin tone :woman_playing_water_polo_tone1: woman playing water polo: medium-light skin tone :woman_playing_water_polo_tone2: woman playing water polo: medium skin tone :woman_playing_water_polo_tone3: woman playing water polo: medium-dark skin tone :woman_playing_water_polo_tone4: woman playing water polo: dark skin tone :woman_playing_water_polo_tone5: woman police officer :woman_police_officer: woman police officer: light skin tone :woman_police_officer_tone1: woman police officer: medium-light skin tone :woman_police_officer_tone2: woman police officer: medium skin tone :woman_police_officer_tone3: woman police officer: medium-dark skin tone :woman_police_officer_tone4: woman police officer: dark skin tone :woman_police_officer_tone5: woman pouting :woman_pouting: woman pouting: light skin tone :woman_pouting_tone1: woman pouting: medium-light skin tone :woman_pouting_tone2: woman pouting: medium skin tone :woman_pouting_tone3: woman pouting: medium-dark skin tone :woman_pouting_tone4: woman pouting: dark skin tone :woman_pouting_tone5: woman raising hand :woman_raising_hand: woman raising hand: light skin tone :woman_raising_hand_tone1: woman raising hand: medium-light skin tone :woman_raising_hand_tone2: woman raising hand: medium skin tone :woman_raising_hand_tone3: woman raising hand: medium-dark skin tone :woman_raising_hand_tone4: woman raising hand: dark skin tone :woman_raising_hand_tone5: woman rowing boat :woman_rowing_boat: woman rowing boat: light skin tone :woman_rowing_boat_tone1: woman rowing boat: medium-light skin tone :woman_rowing_boat_tone2: woman rowing boat: medium skin tone :woman_rowing_boat_tone3: woman rowing boat: medium-dark skin tone :woman_rowing_boat_tone4: woman rowing boat: dark skin tone :woman_rowing_boat_tone5: woman running :woman_running: woman running: light skin tone :woman_running_tone1: woman running: medium-light skin tone :woman_running_tone2: woman running: medium skin tone :woman_running_tone3: woman running: medium-dark skin tone :woman_running_tone4: woman running: dark skin tone :woman_running_tone5: woman scientist :woman_scientist: woman scientist: light skin tone :woman_scientist_tone1: woman scientist: medium-light skin tone :woman_scientist_tone2: woman scientist: medium skin tone :woman_scientist_tone3: woman scientist: medium-dark skin tone :woman_scientist_tone4: woman scientist: dark skin tone :woman_scientist_tone5: woman shrugging :woman_shrugging: woman shrugging: light skin tone :woman_shrugging_tone1: woman shrugging: medium-light skin tone :woman_shrugging_tone2: woman shrugging: medium skin tone :woman_shrugging_tone3: woman shrugging: medium-dark skin tone :woman_shrugging_tone4: woman shrugging: dark skin tone :woman_shrugging_tone5: woman singer :woman_singer: woman singer: light skin tone :woman_singer_tone1: woman singer: medium-light skin tone :woman_singer_tone2: woman singer: medium skin tone :woman_singer_tone3: woman singer: medium-dark skin tone :woman_singer_tone4: woman singer: dark skin tone :woman_singer_tone5: woman student :woman_student: woman student: light skin tone :woman_student_tone1: woman student: medium-light skin tone :woman_student_tone2: woman student: medium skin tone :woman_student_tone3: woman student: medium-dark skin tone :woman_student_tone4: woman student: dark skin tone :woman_student_tone5: woman surfing :woman_surfing: woman surfing: light skin tone :woman_surfing_tone1: woman surfing: medium-light skin tone :woman_surfing_tone2: woman surfing: medium skin tone :woman_surfing_tone3: woman surfing: medium-dark skin tone :woman_surfing_tone4: woman surfing: dark skin tone :woman_surfing_tone5: woman swimming :woman_swimming: woman swimming: light skin tone :woman_swimming_tone1: woman swimming: medium-light skin tone :woman_swimming_tone2: woman swimming: medium skin tone :woman_swimming_tone3: woman swimming: medium-dark skin tone :woman_swimming_tone4: woman swimming: dark skin tone :woman_swimming_tone5: woman teacher :woman_teacher: woman teacher: light skin tone :woman_teacher_tone1: woman teacher: medium-light skin tone :woman_teacher_tone2: woman teacher: medium skin tone :woman_teacher_tone3: woman teacher: medium-dark skin tone :woman_teacher_tone4: woman teacher: dark skin tone :woman_teacher_tone5: woman technologist :woman_technologist: woman technologist: light skin tone :woman_technologist_tone1: woman technologist: medium-light skin tone :woman_technologist_tone2: woman technologist: medium skin tone :woman_technologist_tone3: woman technologist: medium-dark skin tone :woman_technologist_tone4: woman technologist: dark skin tone :woman_technologist_tone5: woman tipping hand :woman_tipping_hand: woman tipping hand: light skin tone :woman_tipping_hand_tone1: woman tipping hand: medium-light skin tone :woman_tipping_hand_tone2: woman tipping hand: medium skin tone :woman_tipping_hand_tone3: woman tipping hand: medium-dark skin tone :woman_tipping_hand_tone4: woman tipping hand: dark skin tone :woman_tipping_hand_tone5: woman: light skin tone :woman_tone1: woman: medium-light skin tone :woman_tone2: woman: medium skin tone :woman_tone3: woman: medium-dark skin tone :woman_tone4: woman: dark skin tone :woman_tone5: woman vampire :woman_vampire: woman vampire: light skin tone :woman_vampire_tone1: woman vampire: medium-light skin tone :woman_vampire_tone2: woman vampire: medium skin tone :woman_vampire_tone3: woman vampire: medium-dark skin tone :woman_vampire_tone4: woman vampire: dark skin tone :woman_vampire_tone5: woman walking :woman_walking: woman walking: light skin tone :woman_walking_tone1: woman walking: medium-light skin tone :woman_walking_tone2: woman walking: medium skin tone :woman_walking_tone3: woman walking: medium-dark skin tone :woman_walking_tone4: woman walking: dark skin tone :woman_walking_tone5: woman wearing turban :woman_wearing_turban: woman wearing turban: light skin tone :woman_wearing_turban_tone1: woman wearing turban: medium-light skin tone :woman_wearing_turban_tone2: woman wearing turban: medium skin tone :woman_wearing_turban_tone3: woman wearing turban: medium-dark skin tone :woman_wearing_turban_tone4: woman wearing turban: dark skin tone :woman_wearing_turban_tone5: woman with headscarf :woman_with_headscarf: woman with headscarf: light skin tone :woman_with_headscarf_tone1: woman with headscarf: medium-light skin tone :woman_with_headscarf_tone2: woman with headscarf: medium skin tone :woman_with_headscarf_tone3: woman with headscarf: medium-dark skin tone :woman_with_headscarf_tone4: woman with headscarf: dark skin tone :woman_with_headscarf_tone5: woman zombie :woman_zombie: woman\\u2019s clothes :womans_clothes: woman\\u2019s hat :womans_hat: women with bunny ears partying :women_with_bunny_ears_partying: women wrestling :women_wrestling: women\\u2019s room :womens: worried face :worried: wrench :wrench: writing hand :writing_hand: writing hand: light skin tone :writing_hand_tone1: writing hand: medium-light skin tone :writing_hand_tone2: writing hand: medium skin tone :writing_hand_tone3: writing hand: medium-dark skin tone :writing_hand_tone4: writing hand: dark skin tone :writing_hand_tone5: cross mark :x: yellow heart :yellow_heart: yen banknote :yen: yin yang :yin_yang: face savouring delicious food :yum: high voltage :zap: zebra :zebra: keycap: 0 :zero: zipper-mouth face :zipper_mouth: zombie :zombie: zzz :zzz:","title":"2. emojione\u5168\u540d\u77ed\u540d\u6620\u5c04\u8868"},{"location":"appendix/level/","text":"\u4e00\u4e2a.md\u91cc\u53ea\u80fd\u6709\u4e00\u4e2a#\uff08h1\uff09\uff0c\u4e0b\u9762\u662f\u591a\u4e2a## \u5982\u679c\u6709\u591a\u4e2a#\uff08h1\uff09\uff0c\u5219\u662f\u4e0d\u6807\u51c6\u7684\u76ee\u5f55\u7ed3\u6784\uff0c\u4e0d\u4f1a\u81ea\u52a8\u751f\u4ea7\u76ee\u5f55 \u5982\u679c.md\u6ca1\u6709\u7528#\uff08h1\uff09\uff0c\u5219mkdocs\u4f1a\u81ea\u52a8\u5c06\u8be5\u6587\u4ef6\u5728mkdocs.yml\u91cc\u5bf9\u5e94\u7684page\u540d\u7528h1\u6548\u679c\u5c55\u793a\u5728\u7b2c\u4e00\u884c","title":"6. mkdocs\u5c42\u7ea7\u5173\u7cfb"},{"location":"appendix/module/","text":"\u4e0b\u8ff0\u5747\u4e3a\u4e2a\u4eba\u7406\u89e3\uff0c\u4e0d\u4fdd\u8bc1\u51c6\u786e\u6027 python markdown \u00b6 \u662f\u7528python\u5199\u7684markdown\u6a21\u5757\uff0c\u7528\u8fd9\u6a21\u5757\u53ef\u4ee5\u5c06markdown\u6587\u672c\u6e32\u67d3\u6210html\uff0c\u6bd4\u5982\uff1a >>> import markdown >>> text = ''' ... # abc ... ```go ... import \"fmt\" ... ``` ... ... ## sss ... ... - xxx ... - yyy ... ''' >>> html = markdown.markdown(text) >>> print html <h1>abc</h1> <p><code>go import \"fmt\"</code></p> <h2>sss</h2> <ul> <li>xxx</li> <li>yyy</li> </ul> \u540c\u65f6markdown\u6a21\u5757\u5185\u7f6e\u4e00\u4e9b\u6269\u5c55\uff0c\u6709\uff1a abbr.py admonition.py attr_list.py codehilite.py def_list.py extra.py fenced_code.py footnotes.py headerid.py meta.py nl2br.py sane_lists.py smart_strong.py smarty.py tables.py toc.py wikilinks.py pymdownx \u00b6 \u662fpython\u7684\u4e00\u4e2a\u6a21\u5757\uff0c\u6269\u5c55\u4e86markdown\u7684\u529f\u80fd\uff0c\u6bd4\u5982emoji\u56fe\u6807\u3001\u53ef\u6298\u53e0\u7684\u6587\u672c\u6846\u7b49\uff0cpymdownx\u4e5f\u662f\u8c03\u7528markdown\u6a21\u5757\u505a\u4e8b\uff0cpymdownx\u5305\u542b\u4ee5\u4e0b\u529f\u80fd\uff1a arithmatex.py b64.py betterem.py caret.py critic.py details.py emoji.py emoji1_db.py escapeall.py extra.py extrarawhtml.py gemoji_db.py github.py highlight.py inlinehilite.py keymap_db.py keys.py magiclink.py mark.py pathconverter.py plainhtml.py progressbar.py slugs.py smartsymbols.py snippets.py superfences.py tasklist.py tilde.py twemoji_db.py util.py mkdocs \u00b6 \u662f\u7528python\u7f16\u5199\u7684\uff0c\u5305\u62ecmkdocs\u4e3b\u9898\u53ca\u547d\u4ee4\u884c\u5de5\u5177\uff0cmkdocs\u8c03\u7528python markdown\u6765\u6e32\u67d3html\uff0c\u5176\u4e2d\u91cd\u5199\u4e86\u5c11\u90e8\u5206\u57fa\u7840\u529f\u80fd\uff0c\u6bd4\u5982toc\uff0c\u4ee5\u8fbe\u5230\u7b26\u5408mkdocs\u4e3b\u9898\u6548\u679c\uff1bmkdocs\u4e5f\u5185\u7f6e\u4e00\u79cd\u4e3b\u9898\uff0c\u5c31\u53ebmkdocs\uff0c\u540c\u65f6\u4e5f\u5185\u7f6e\u652f\u6301readthedocs\uff0c\u5e76\u4e14mkdocs\u4e5f\u652f\u6301\u81ea\u5b9a\u4e49\u4e3b\u9898\u3002mkdocs\u4e3b\u8981\u5c31\u662f\u4e00\u4e2a\u96c6\u6210\u5668\uff0c\u901a\u8fc7\u8fd9\u4e2a\u5de5\u5177\u6765\u7b80\u5316\u6e32\u67d3\u3001\u90e8\u7f72\u3001\u4f7f\u7528\u3001\u6a21\u5757\u8c03\u7528\u3001\u4e3b\u9898\u8c03\u7528 material \u00b6 \u662fpython\u7684\u4e00\u4e2a\u6a21\u5757\uff0c\u662f\u7b26\u5408mkdocs\u89c4\u8303\u7684\u81ea\u5b9a\u4e49\u4e3b\u9898\uff0c\u53ef\u4ee5\u901a\u8fc7pip install mkdocs-material\u6765\u4e0b\u8f7d\uff0c\u8fd9\u4e2a\u6a21\u5757\u91cc\u9762\u90fd\u662f\u4e00\u4e9bjs\u3001css\u3001html\u6587\u4ef6 material\u8fd9\u4e2a\u6a21\u5757\u540d\u548c\u4e3b\u9898\u98ce\u683c\uff0c\u662f\u6765\u81ea\u4e8egoogle material\uff0c\u5373google\u5b9a\u4e49\u7684\u4e00\u79cd\u901a\u7528\u98ce\u683c\uff0c\u7528\u4e8e\u517c\u5bb9\u4e0d\u540c\u5206\u8fa8\u7387\u4e0b\u7684\u9875\u9762\u5c55\u793a\uff0c\u5373\u53ea\u8981\u7b26\u5408\u8fd9\u79cd\u8c37\u6b4c\u98ce\u683c\u7684\uff0c\u4e00\u5904\u7f16\u5199\uff0c\u5904\u5904\u4f7f\u7528\uff08\u5728pc\u3001\u624b\u673a\u4e0a\u90fd\u53ef\u4ee5\u7528\uff0c\u5373\u4f1a\u6839\u636e\u5206\u8fa8\u7387\u81ea\u52a8\u8c03\u6574\u9875\u9762\u5c55\u793a\uff09 material\u4e3b\u9898\u5bf9python markdown\u7684\u4e00\u4e9b\u5185\u7f6e\u6269\u5c55\u548cpymdownx\u7684\u529f\u80fd\u505a\u4e86\u4e3b\u9898\u6548\u679c\u4f18\u5316\uff0c\u4ee5\u4fbf\u66f4\u4f18\u7f8e\uff0c\u5185\u7f6e\u7684\u6709\uff1a \u652f\u6301\u7684python markdown\u6269\u5c55\u6709\uff1aAdmonition\u3001CodeHilite\u3001Footnotes\u3001Metadata\u3001Permalinks pymdownx\u6709\uff1aArithmatex\u3001BetterEM\u3001Caret\u3001Critic\u3001Details\u3001Emoji\u3001InlineHilite\u3001MagicLink\u3001Mark\u3001SmartSymbols\u3001SuperFences\u3001Tasklist\u3001Tilde","title":"5. \u6a21\u5757\u4ecb\u7ecd"},{"location":"appendix/module/#python-markdown","text":"\u662f\u7528python\u5199\u7684markdown\u6a21\u5757\uff0c\u7528\u8fd9\u6a21\u5757\u53ef\u4ee5\u5c06markdown\u6587\u672c\u6e32\u67d3\u6210html\uff0c\u6bd4\u5982\uff1a >>> import markdown >>> text = ''' ... # abc ... ```go ... import \"fmt\" ... ``` ... ... ## sss ... ... - xxx ... - yyy ... ''' >>> html = markdown.markdown(text) >>> print html <h1>abc</h1> <p><code>go import \"fmt\"</code></p> <h2>sss</h2> <ul> <li>xxx</li> <li>yyy</li> </ul> \u540c\u65f6markdown\u6a21\u5757\u5185\u7f6e\u4e00\u4e9b\u6269\u5c55\uff0c\u6709\uff1a abbr.py admonition.py attr_list.py codehilite.py def_list.py extra.py fenced_code.py footnotes.py headerid.py meta.py nl2br.py sane_lists.py smart_strong.py smarty.py tables.py toc.py wikilinks.py","title":"python markdown"},{"location":"appendix/module/#pymdownx","text":"\u662fpython\u7684\u4e00\u4e2a\u6a21\u5757\uff0c\u6269\u5c55\u4e86markdown\u7684\u529f\u80fd\uff0c\u6bd4\u5982emoji\u56fe\u6807\u3001\u53ef\u6298\u53e0\u7684\u6587\u672c\u6846\u7b49\uff0cpymdownx\u4e5f\u662f\u8c03\u7528markdown\u6a21\u5757\u505a\u4e8b\uff0cpymdownx\u5305\u542b\u4ee5\u4e0b\u529f\u80fd\uff1a arithmatex.py b64.py betterem.py caret.py critic.py details.py emoji.py emoji1_db.py escapeall.py extra.py extrarawhtml.py gemoji_db.py github.py highlight.py inlinehilite.py keymap_db.py keys.py magiclink.py mark.py pathconverter.py plainhtml.py progressbar.py slugs.py smartsymbols.py snippets.py superfences.py tasklist.py tilde.py twemoji_db.py util.py","title":"pymdownx"},{"location":"appendix/module/#mkdocs","text":"\u662f\u7528python\u7f16\u5199\u7684\uff0c\u5305\u62ecmkdocs\u4e3b\u9898\u53ca\u547d\u4ee4\u884c\u5de5\u5177\uff0cmkdocs\u8c03\u7528python markdown\u6765\u6e32\u67d3html\uff0c\u5176\u4e2d\u91cd\u5199\u4e86\u5c11\u90e8\u5206\u57fa\u7840\u529f\u80fd\uff0c\u6bd4\u5982toc\uff0c\u4ee5\u8fbe\u5230\u7b26\u5408mkdocs\u4e3b\u9898\u6548\u679c\uff1bmkdocs\u4e5f\u5185\u7f6e\u4e00\u79cd\u4e3b\u9898\uff0c\u5c31\u53ebmkdocs\uff0c\u540c\u65f6\u4e5f\u5185\u7f6e\u652f\u6301readthedocs\uff0c\u5e76\u4e14mkdocs\u4e5f\u652f\u6301\u81ea\u5b9a\u4e49\u4e3b\u9898\u3002mkdocs\u4e3b\u8981\u5c31\u662f\u4e00\u4e2a\u96c6\u6210\u5668\uff0c\u901a\u8fc7\u8fd9\u4e2a\u5de5\u5177\u6765\u7b80\u5316\u6e32\u67d3\u3001\u90e8\u7f72\u3001\u4f7f\u7528\u3001\u6a21\u5757\u8c03\u7528\u3001\u4e3b\u9898\u8c03\u7528","title":"mkdocs"},{"location":"appendix/module/#material","text":"\u662fpython\u7684\u4e00\u4e2a\u6a21\u5757\uff0c\u662f\u7b26\u5408mkdocs\u89c4\u8303\u7684\u81ea\u5b9a\u4e49\u4e3b\u9898\uff0c\u53ef\u4ee5\u901a\u8fc7pip install mkdocs-material\u6765\u4e0b\u8f7d\uff0c\u8fd9\u4e2a\u6a21\u5757\u91cc\u9762\u90fd\u662f\u4e00\u4e9bjs\u3001css\u3001html\u6587\u4ef6 material\u8fd9\u4e2a\u6a21\u5757\u540d\u548c\u4e3b\u9898\u98ce\u683c\uff0c\u662f\u6765\u81ea\u4e8egoogle material\uff0c\u5373google\u5b9a\u4e49\u7684\u4e00\u79cd\u901a\u7528\u98ce\u683c\uff0c\u7528\u4e8e\u517c\u5bb9\u4e0d\u540c\u5206\u8fa8\u7387\u4e0b\u7684\u9875\u9762\u5c55\u793a\uff0c\u5373\u53ea\u8981\u7b26\u5408\u8fd9\u79cd\u8c37\u6b4c\u98ce\u683c\u7684\uff0c\u4e00\u5904\u7f16\u5199\uff0c\u5904\u5904\u4f7f\u7528\uff08\u5728pc\u3001\u624b\u673a\u4e0a\u90fd\u53ef\u4ee5\u7528\uff0c\u5373\u4f1a\u6839\u636e\u5206\u8fa8\u7387\u81ea\u52a8\u8c03\u6574\u9875\u9762\u5c55\u793a\uff09 material\u4e3b\u9898\u5bf9python markdown\u7684\u4e00\u4e9b\u5185\u7f6e\u6269\u5c55\u548cpymdownx\u7684\u529f\u80fd\u505a\u4e86\u4e3b\u9898\u6548\u679c\u4f18\u5316\uff0c\u4ee5\u4fbf\u66f4\u4f18\u7f8e\uff0c\u5185\u7f6e\u7684\u6709\uff1a \u652f\u6301\u7684python markdown\u6269\u5c55\u6709\uff1aAdmonition\u3001CodeHilite\u3001Footnotes\u3001Metadata\u3001Permalinks pymdownx\u6709\uff1aArithmatex\u3001BetterEM\u3001Caret\u3001Critic\u3001Details\u3001Emoji\u3001InlineHilite\u3001MagicLink\u3001Mark\u3001SmartSymbols\u3001SuperFences\u3001Tasklist\u3001Tilde","title":"material"},{"location":"appendix/pygments/","text":"\u5305\u62ec\u9ad8\u7ea7\u8bed\u8a00\u3001\u6a21\u7248\u8bed\u8a00\u3001\u6807\u8bb0\u8bed\u8a00\uff0c\u5171434\u4e2a \u683c\u5f0f \u77ed\u540d ABAP abap ABNF abnf ActionScript 3 as3, actionscript3 ActionScript as, actionscript Ada ada, ada95, ada2005 ADL adl Agda agda Aheui aheui Alloy alloy AmbientTalk at, ambienttalk, ambienttalk/2 Ampl ampl Angular2 ng2 ANTLR With ActionScript Target antlr-as, antlr-actionscript ANTLR With C# Target antlr-csharp, antlr-c# ANTLR With CPP Target antlr-cpp ANTLR With Java Target antlr-java ANTLR With ObjectiveC Target antlr-objc ANTLR With Perl Target antlr-perl ANTLR With Python Target antlr-python ANTLR With Ruby Target antlr-ruby, antlr-rb ANTLR antlr ApacheConf apacheconf, aconf, apache APL apl AppleScript applescript Arduino arduino AspectJ aspectj aspx-cs aspx-cs aspx-vb aspx-vb Asymptote asy, asymptote autohotkey ahk, autohotkey AutoIt autoit Awk awk, gawk, mawk, nawk Base Makefile basemake Bash Session console, shell-session Bash bash, sh, ksh, zsh, shell Batchfile bat, batch, dosbatch, winbatch BBCode bbcode BC bc Befunge befunge BibTeX bib, bibtex BlitzBasic blitzbasic, b3d, bplus BlitzMax blitzmax, bmax BNF bnf Boo boo Boogie boogie Brainfuck brainfuck, bf Bro bro BST bst, bst-pybtex BUGS bugs, winbugs, openbugs C c C# csharp, c# C++ cpp, c++ c-objdump c-objdump ca65 assembler ca65 cADL cadl CAmkES camkes, idl4 Cap'n Proto capnp CapDL capdl CBM BASIC V2 cbmbas Ceylon ceylon CFEngine3 cfengine3, cf3 cfstatement cfs ChaiScript chai, chaiscript Chapel chapel, chpl Cheetah cheetah, spitfire Cirru cirru Clay clay Clean clean Clojure clojure, clj ClojureScript clojurescript, cljs CMake cmake COBOL cobol COBOLFree cobolfree CoffeeScript coffee-script, coffeescript, coffee Coldfusion CFC cfc Coldfusion HTML cfm Common Lisp common-lisp, cl, lisp Component Pascal componentpascal, cp Coq coq cpp-objdump cpp-objdump, c++-objdumb, cxx-objdump CPSA cpsa Crmsh crmsh, pcmk Croc croc Cryptol cryptol, cry Crystal cr, crystal Csound Document csound-document, csound-csd Csound Orchestra csound, csound-orc Csound Score csound-score, csound-sco CSS css CSS+Django/Jinja css+django, css+jinja CSS+Genshi Text css+genshitext, css+genshi CSS+Lasso css+lasso CSS+Mako css+mako CSS+mozpreproc css+mozpreproc CSS+Myghty css+myghty CSS+PHP css+php CSS+Ruby css+erb, css+ruby CSS+Smarty css+smarty CUDA cuda, cu Cypher cypher Cython cython, pyx, pyrex D d d-objdump d-objdump Darcs Patch dpatch Dart dart Debian Control file control, debcontrol Debian Sourcelist sourceslist, sources.list, debsources Delphi delphi, pas, pascal, objectpascal dg dg Diff diff, udiff Django/Jinja django, jinja Docker docker, dockerfile DTD dtd Duel duel, jbst, jsonml+bst Dylan session dylan-console, dylan-repl Dylan dylan DylanLID dylan-lid, lid Earl Grey earl-grey, earlgrey, eg Easytrieve easytrieve EBNF ebnf eC ec ECL ecl Eiffel eiffel Elixir iex session iex Elixir elixir, ex, exs Elm elm EmacsLisp emacs, elisp, emacs-lisp Embedded Ragel ragel-em ERB erb Erlang erl session erl Erlang erlang Evoque evoque Ezhil ezhil Factor factor Fancy fancy, fy Fantom fan Felix felix, flx Fish fish, fishshell Flatline flatline Forth forth Fortran fortran FortranFixed fortranfixed FoxPro foxpro, vfp, clipper, xbase FSharp fsharp GAP gap GAS gas, asm Genshi Text genshitext Genshi genshi, kid, xml+genshi, xml+kid Gettext Catalog pot, po Gherkin cucumber, gherkin GLSL glsl Gnuplot gnuplot Go go Golo golo GoodData-CL gooddata-cl Gosu Template gst Gosu gosu Groff groff, nroff, man Groovy groovy Haml haml Handlebars handlebars Haskell haskell, hs Haxe hx, haxe, hxsl Hexdump hexdump HSAIL hsail, hsa HTML + Angular2 html+ng2 HTML html HTML+Cheetah html+cheetah, html+spitfire, htmlcheetah HTML+Django/Jinja html+django, html+jinja, htmldjango HTML+Evoque html+evoque HTML+Genshi html+genshi, html+kid HTML+Handlebars html+handlebars HTML+Lasso html+lasso HTML+Mako html+mako HTML+Myghty html+myghty HTML+PHP html+php HTML+Smarty html+smarty HTML+Twig html+twig HTML+Velocity html+velocity HTTP http Hxml haxeml, hxml Hy hylang Hybris hybris, hy IDL idl Idris idris, idr Igor igor, igorpro Inform 6 template i6t Inform 6 inform6, i6 Inform 7 inform7, i7 INI ini, cfg, dosini Io io Ioke ioke, ik IRC logs irc Isabelle isabelle J j JAGS jags Jasmin jasmin, jasminxt Java Server Page jsp Java java JavaScript js, javascript JavaScript+Cheetah js+cheetah, javascript+cheetah, js+spitfire, javascript+spitfire JavaScript+Django/Jinja js+django, javascript+django, js+jinja, javascript+jinja JavaScript+Genshi Text js+genshitext, js+genshi, javascript+genshitext, javascript+genshi JavaScript+Lasso js+lasso, javascript+lasso JavaScript+Mako js+mako, javascript+mako Javascript+mozpreproc javascript+mozpreproc JavaScript+Myghty js+myghty, javascript+myghty JavaScript+PHP js+php, javascript+php JavaScript+Ruby js+erb, javascript+erb, js+ruby, javascript+ruby JavaScript+Smarty js+smarty, javascript+smarty JCL jcl JSGF jsgf JSON json JSON-LD jsonld, json-ld JSONBareObject json-object Julia console jlcon Julia julia, jl Juttle juttle, juttle Kal kal Kconfig kconfig, menuconfig, linux-config, kernel-config Koka koka Kotlin kotlin Lasso lasso, lassoscript Lean lean LessCss less Lighttpd configuration file lighty, lighttpd Limbo limbo liquid liquid Literate Agda lagda, literate-agda Literate Cryptol lcry, literate-cryptol, lcryptol Literate Haskell lhs, literate-haskell, lhaskell Literate Idris lidr, literate-idris, lidris LiveScript live-script, livescript LLVM llvm Logos logos Logtalk logtalk LSL lsl Lua lua Makefile make, makefile, mf, bsdmake Mako mako MAQL maql markdown md Mask mask Mason mason Mathematica mathematica, mma, nb Matlab session matlabsession Matlab matlab MiniD minid Modelica modelica Modula-2 modula2, m2 MoinMoin/Trac Wiki markup trac-wiki, moin Monkey monkey Monte monte MOOCode moocode, moo MoonScript moon, moonscript mozhashpreproc mozhashpreproc mozpercentpreproc mozpercentpreproc MQL mql, mq4, mq5, mql4, mql5 Mscgen mscgen, msc MSDOS Session doscon MuPAD mupad MXML mxml Myghty myghty MySQL mysql NASM nasm NCL ncl Nemerle nemerle nesC nesc NewLisp newlisp Newspeak newspeak Nginx configuration file nginx Nimrod nim, nimrod Nit nit Nix nixos, nix NSIS nsis, nsi, nsh NumPy numpy NuSMV nusmv objdump objdump objdump-nasm objdump-nasm Objective-C objective-c, objectivec, obj-c, objc Objective-C++ objective-c++, objectivec++, obj-c++, objc++ Objective-J objective-j, objectivej, obj-j, objj OCaml ocaml Octave octave ODIN odin Ooc ooc Opa opa OpenEdge ABL openedge, abl, progress PacmanConf pacmanconf Pan pan ParaSail parasail Pawn pawn Perl perl, pl Perl6 perl6, pl6 PHP php, php3, php4, php5 Pig pig Pike pike PkgConfig pkgconfig PL/pgSQL plpgsql PostgreSQL console (psql) psql, postgresql-console, postgres-console PostgreSQL SQL dialect postgresql, postgres PostScript postscript, postscr POVRay pov PowerShell Session ps1con PowerShell powershell, posh, ps1, psm1 Praat praat Prolog prolog Properties properties, jproperties Protocol Buffer protobuf, proto Pug pug, jade Puppet puppet PyPy Log pypylog, pypy Python 3 python3, py3 Python 3.0 Traceback py3tb Python console session pycon Python Traceback pytb Python python, py, sage QBasic qbasic, basic QML qml, qbs QVTO qvto, qvt Racket racket, rkt Ragel in C Host ragel-c Ragel in CPP Host ragel-cpp Ragel in D Host ragel-d Ragel in Java Host ragel-java Ragel in Objective C Host ragel-objc Ragel in Ruby Host ragel-ruby, ragel-rb Ragel ragel Raw token data raw RConsole rconsole, rout Rd rd REBOL rebol Red red, red/system Redcode redcode reg registry Relax-NG Compact rnc, rng-compact ResourceBundle resource, resourcebundle reStructuredText rst, rest, restructuredtext Rexx rexx, arexx RHTML rhtml, html+erb, html+ruby Roboconf Graph roboconf-graph Roboconf Instances roboconf-instances RobotFramework robotframework RPMSpec spec RQL rql RSL rsl Ruby irb session rbcon, irb Ruby rb, ruby, duby Rust rust S splus, s, r SAS sas Sass sass Scala scala Scalate Server Page ssp Scaml scaml Scheme scheme, scm Scilab scilab SCSS scss Shen shen Silver silver Slim slim Smali smali Smalltalk smalltalk, squeak, st Smarty smarty Snobol snobol Snowball snowball SourcePawn sp SPARQL sparql SQL sql sqlite3con sqlite3 SquidConf squidconf, squid.conf, squid Stan stan Standard ML sml Stata stata, do SuperCollider sc, supercollider Swift swift SWIG swig systemverilog systemverilog, sv TADS 3 tads3 TAP tap TASM tasm Tcl tcl Tcsh Session tcshcon Tcsh tcsh, csh Tea tea Termcap termcap Terminfo terminfo Terraform terraform, tf TeX tex, latex Text only text Thrift thrift Todotxt todotxt TrafficScript rts, trafficscript Transact-SQL tsql, t-sql Treetop treetop Turtle turtle Twig twig TypeScript ts, typescript TypoScript typoscript TypoScriptCssData typoscriptcssdata TypoScriptHtmlData typoscripthtmldata UrbiScript urbiscript Vala vala, vapi VB.net vb.net, vbnet VCL vcl VCLSnippets vclsnippets, vclsnippet VCTreeStatus vctreestatus Velocity velocity verilog verilog, v VGL vgl vhdl vhdl VimL vim WDiff wdiff Whiley whiley X10 x10, xten XML xml XML+Cheetah xml+cheetah, xml+spitfire XML+Django/Jinja xml+django, xml+jinja XML+Evoque xml+evoque XML+Lasso xml+lasso XML+Mako xml+mako XML+Myghty xml+myghty XML+PHP xml+php XML+Ruby xml+erb, xml+ruby XML+Smarty xml+smarty XML+Velocity xml+velocity XQuery xquery, xqy, xq, xql, xqm XSLT xslt Xtend xtend xtlang extempore XUL+mozpreproc xul+mozpreproc YAML yaml YAML+Jinja yaml+jinja, salt, sls Zephir zephir \u8bf4\u660e \u9017\u53f7\u5206\u9694\u8868\u793a\u4efb\u9009\u4e00\u79cd\u5747\u53ef \u5e95\u5c42\u5b9e\u9645\u662f\u7531Pygments\u7684lexers\u6240\u5b9e\u73b0\uff0c\u4e0a\u8ff0\u8868\u683c\u4e2d\u7684Pygments\u7248\u672c\u662f2.2.0\uff0c\u652f\u6301\u5171434\u79cd\u8bed\u8a00\u3001\u6a21\u7248\u3001\u6807\u8bb0\u8bed\u8a00\u3002 \u53ea\u8981\u662f\u4f9d\u8d56Pygments\u5b9e\u73b0\u7684\u8bed\u6cd5\u9ad8\u4eae\uff0c\u4e0a\u8ff0\u8868\u683c\u91cc\u7684\u5747\u53ef\u4ee5\u4f7f\u7528 \u4e0a\u8ff0\u8868\u683c\u4e0d\u662f\u4ecepygments\u7684\u5b98\u7f51\u4e0a\u627e\u5230\u7684\uff0c\u56e0\u4e3a\u5b98\u7f51\u5df2\u7ecf\u5f88\u4e45\u6ca1\u66f4\u65b0\u8fd9\u4e2a\u8868\u683c\u4e86\uff08 http://pygments.org/languages/ \uff0c\u8fdego\u8bed\u8a00\u90fd\u6ca1\u5199\u51fa\u6765\uff09\uff0c\u6240\u4ee5\u6211\u662f\u76f4\u63a5\u4ecepygments\u6e90\u4ee3\u7801\uff08pygments/lexers/_mapping.py\uff09\u91cc\u641c\u96c6\u7684\u3002 \u9644: \u83b7\u5f97\u4e0a\u8ff0434\u79cd\u8bed\u8a00\u7684\u65b9\u6cd5 #!/usr/bin/python from pygments.lexers import get_all_lexers lexers = get_all_lexers () for lexer in lexers : print lexer","title":"1. \u652f\u6301\u4ee3\u7801\u9ad8\u4eae\u7684\u8bed\u8a00"},{"location":"appendix/search/","text":"\u867d\u7136search\u529f\u80fd(lunr.js)\u6682\u4e0d\u76f4\u63a5\u652f\u6301\u4e2d\u6587\uff0c\u4f46\u6d4b\u8bd5\u53d1\u73b0\u8bbe\u7f6e\u4e3a\u65e5\u8bed\u540e\uff0c\u4e2d\u6587\u548c\u82f1\u6587\u641c\u7d22\u90fd\u53ef\u4ee5\u4f7f\u7528 extra: search: language: 'jp' Note \u6d4b\u8bd5\u53d1\u73b0\uff0c\u5f53\u7ad9\u70b9\u6587\u5b57\u6bd4\u8f83\u591a\u7684\u65f6\u5019\uff0c\u6709\u7684\u65f6\u5019\u7b2c\u4e00\u6b21\u641c\u7d22\u52a0\u8f7d\u67e5\u8be2\u7684\u65f6\u95f4\u6bd4\u8f83\u4e45\uff0c\u4f1a\u5f15\u8d77\u6d4f\u89c8\u5668\u5047\u6b7b\uff0c\u591a\u7b49\u4e00\u4f1a\u5c31\u884c\u4e86\u3002\u6bd4\u5982\u672c\u7ad9\u70b9\u5185\u5bb9\u6bd4\u8f83\u591a\uff0c\u641c\u7d22\u5c31\u6bd4\u8f83\u5361 \u4e3a\u4ec0\u4e48\u4e0a\u9762\u8bf4\u7684\u662f\u6709\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u6211\u7684\u53e6\u4e00\u4e2a\u7ad9\u70b9\u6587\u5b57\u6570\u91cf\u6bd4\u672c\u7ad9\u8fd8\u8981\u591a\uff0c\u4f46\u641c\u7d22\u786e\u5f88\u5feb\uff0c\u7b49\u4ee5\u540e\u719f\u6089\u4e86lunr.js\u540e\u518d\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898 \u53e6\u5916\uff0c\u641c\u7d22\u5bf9\u8bdd\u6846\u7684\u663e\u793a\u6587\u5b57\uff0c\u9ed8\u8ba4\u4e3a\u82f1\u6587\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u4e2d\u6587\u3002\u4f8b\u5982\"search\"\u6539\u4e3a\u4e2d\u6587\u540e\u5c31\u53eb\"\u641c\u7d22\" theme: language: 'zh'","title":"7. \u652f\u6301\u4e2d\u6587\u641c\u7d22"},{"location":"appendix/yml/","text":"site_name : markdown\u8bed\u6cd5\u8be6\u89e3(\u57fa\u4e8emkdocs-material) - cyent\u7b14\u8bb0 site_description : \u5173\u4e8emkdocs-material\u652f\u6301\u7684markdown\u8bed\u6cd5\uff0c\u5305\u62ec\u4f20\u7edf\u8bed\u6cd5\u548c\u6269\u5c55\u8bed\u6cd5 site_author : cyent site_url : https://cyent.github.io/markdown-with-mkdocs-material/ repo_name : 'cyent/markdown-with-mkdocs-material' repo_url : 'https://github.com/cyent/markdown-with-mkdocs-material' theme : name : material palette : primary : 'Blue Grey' accent : 'Pink' feature : tabs : false #font: #text: 'Ubuntu' #code: 'Ubuntu Mono' language : 'zh' extra : social : - type : github link : https://github.com/cyent search : language : 'jp' markdown_extensions : - admonition - codehilite : guess_lang : false linenums : false - toc : permalink : true - footnotes - meta - def_list - pymdownx.arithmatex - pymdownx.betterem : smart_enable : all - pymdownx.caret - pymdownx.critic - pymdownx.details - pymdownx.emoji : emoji_generator : !!python/name:pymdownx.emoji.to_png #emoji_generator: !!python/name:pymdownx.emoji.to_svg #emoji_generator: !!python/name:pymdownx.emoji.to_png_sprite #emoji_generator: !!python/name:pymdownx.emoji.to_svg_sprite #emoji_generator: !!python/name:pymdownx.emoji.to_awesome #emoji_generator: !!python/name:pymdownx.emoji.to_alt - pymdownx.inlinehilite - pymdownx.magiclink - pymdownx.mark - pymdownx.smartsymbols - pymdownx.superfences - pymdownx.tasklist - pymdownx.tilde extra_javascript : - 'js/extra.js' - 'js/baidu-tongji.js' - 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML' nav : - \u4e00. \u4ecb\u7ecd : index.md - \u4e8c. \u5b89\u88c5 : - 1. \u672c\u5730\u73af\u5883\u642d\u5efa : install/local.md - 2. \u53d1\u5e03\u81f3GitHub Pages : install/github-pages.md - 3. \u53d1\u5e03\u81f3\u81ea\u5df1\u7684HTTP Server : install/http-server.md - \u4e09. \u8bed\u6cd5 : - 1. \u8bed\u6cd5\u603b\u89c8 : syntax/main.md - 2. \u6807\u9898 : syntax/headline.md - 3. \u6bb5\u843d : syntax/paragraph.md","title":"8. mkdocs.yml\u8303\u4f8b"},{"location":"course/","text":"1. \u514b\u9686\u9879\u76ee \u00b6 root@leco:/tmp/leco# git clone https://github.com/caimengzhi/books.git \u6b63\u514b\u9686\u5230 'books'... remote: Enumerating objects: 1879, done. remote: Counting objects: 100% (1879/1879), done. remote: Compressing objects: 100% (237/237), done. remote: Total 6365 (delta 835), reused 1800 (delta 782), pack-reused 4486 \u63a5\u6536\u5bf9\u8c61\u4e2d: 100% (6365/6365), 5.58 MiB | 24.00 KiB/s, \u5b8c\u6210. \u5904\u7406 delta \u4e2d: 100% (2938/2938), \u5b8c\u6210. \u68c0\u67e5\u8fde\u63a5... \u5b8c\u6210\u3002 root@leco:/tmp/leco# cd books/ root@leco:/tmp/leco/books# ls docs mkdocs.yml README.md site root@leco:/tmp/leco/books# cd .. root@leco:/tmp/leco# tree . -L 3 . \u2514\u2500\u2500 books \u251c\u2500\u2500 docs \u2502 \u251c\u2500\u2500 appendix \u2502 \u251c\u2500\u2500 contact.md \u2502 \u251c\u2500\u2500 frontend \u2502 \u251c\u2500\u2500 img \u2502 \u251c\u2500\u2500 index.md \u2502 \u251c\u2500\u2500 install \u2502 \u251c\u2500\u2500 js \u2502 \u251c\u2500\u2500 linux \u2502 \u251c\u2500\u2500 pictures \u2502 \u251c\u2500\u2500 python \u2502 \u251c\u2500\u2500 recommend.md \u2502 \u2514\u2500\u2500 syntax \u251c\u2500\u2500 mkdocs.yml \u251c\u2500\u2500 README.md \u2514\u2500\u2500 site \u251c\u2500\u2500 404.html \u251c\u2500\u2500 appendix \u251c\u2500\u2500 assets \u251c\u2500\u2500 contact \u251c\u2500\u2500 frontend \u251c\u2500\u2500 img \u251c\u2500\u2500 index.html \u251c\u2500\u2500 install \u251c\u2500\u2500 js \u251c\u2500\u2500 linux \u251c\u2500\u2500 pictures \u251c\u2500\u2500 python \u251c\u2500\u2500 recommend \u251c\u2500\u2500 search \u251c\u2500\u2500 sitemap.xml \u251c\u2500\u2500 sitemap.xml.gz \u2514\u2500\u2500 syntax 25 directories, 9 files \u89e3\u91ca \u751f\u6210\u9759\u6001\u6587\u4ef6 mkdocs build \u7136\u540e\u5c31\u5728\u9879\u76ee\u7684\u6587\u4ef6\u5939\u4e0b\u751f\u6210site\u9759\u6001\u6587\u4ef6\uff0c\u4ee5\u540enginx\u7684\u5bb6\u76ee\u5f55\u6307\u5b9a\u5230\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u5373\u53ef 2. \u521b\u5efa\u9879\u76ee \u00b6 2.1 \u521b\u5efamarkdown\u6587\u4ef6 \u00b6 root@leco:~/book/books/docs# cd course/ root@leco:~/book/books/docs/course# ls index.md root@leco:~/book/books/docs/course# cat index.md ### 1. \u514b\u9686\u9879\u76ee root@leco:/tmp/leco# git clone git@github.com:caimengzhi/books.git \u6b63\u514b\u9686\u5230 'books'... remote: Enumerating objects: 1879, done. remote: Counting objects: 100% (1879/1879), done. remote: Compressing objects: 100% (237/237), done. remote: Total 6365 (delta 835), reused 1800 (delta 782), pack-reused 4486 \u63a5\u6536\u5bf9\u8c61\u4e2d: 100% (6365/6365), 5.58 MiB | 24.00 KiB/s, \u5b8c\u6210. \u5904\u7406 delta \u4e2d: 100% (2938/2938), \u5b8c\u6210. \u68c0\u67e5\u8fde\u63a5... \u5b8c\u6210\u3002 root@leco:/tmp/leco# cd books/ root@leco:/tmp/leco/books# ls docs mkdocs.yml README.md site root@leco:/tmp/leco/books# cd .. root@leco:/tmp/leco# tree . -L 3 . \u2514\u2500\u2500 books 2.2 \u4fee\u6539\u76ee\u5f55\u6587\u4ef6 \u00b6 \u6587\u4ef6\u5185\u5bb9\u5176\u4ed6\u7701\u7565 root@leco:~/book/books# egrep -irn course mkdocs.yml 107: - \u6559\u7a0b: course/index.md 2.3 \u914d\u7f6e\u76ee\u5f55 \u00b6 \u914d\u7f6e\u76f8\u5173\u4fe1\u606f\uff0c\u63d0\u4ea4\u4ee3\u7801 root@leco:~/book/books/docs/course# cd .. root@leco:~/book/books/docs# ls appendix contact.md course frontend img index.md install js linux mysql pictures python recommend.md syntax root@leco:~/book/books/docs# cd .. root@leco:~/book/books# ls docs mkdocs.yml README.md site root@leco:~/book/books# ls docs mkdocs.yml README.md site root@leco:~/book/books# git add . root@leco:~/book/books# git commit -m 'add course how to use mkdocs' [master 205de67] add course how to use mkdocs 98 files changed, 10137 insertions(+), 4377 deletions(-) create mode 100644 docs/course/index.md create mode 100644 site/course/index.html rewrite site/search/search_index.json (64%) root@leco:~/book/books# git tag v1.0 root@leco:~/book/books# git push \u5bf9\u8c61\u8ba1\u6570\u4e2d: 215, \u5b8c\u6210. Delta compression using up to 4 threads. \u538b\u7f29\u5bf9\u8c61\u4e2d: 100% (28/28), \u5b8c\u6210. \u5199\u5165\u5bf9\u8c61\u4e2d: 100% (215/215), 152.75 KiB | 173.00 KiB/s, \u5b8c\u6210. Total 215 (delta 97), reused 195 (delta 83) remote: Resolving deltas: 100% (97/97), completed with 13 local objects. To git@github.com:caimengzhi/books.git 0de48fc..205de67 master -> master 2.4 \u90e8\u7f72 \u00b6 2.4.1 \u751f\u6210\u9759\u6001\u6587\u4ef6 \u00b6 root@leco:~/book/books# mkdocs build \u6267\u884c mkdocs build\u7684\u65f6\u5019\u5fc5\u987b\u5728\u8fd9\u76ee\u5f55\u4e0b\u56e0\u4e3a\u4f1a\u53bb\u627e\u914d\u7f6e\u6587\u4ef6\uff0c\u6267\u884c\u540e\u6b64\u65f6\u4f1a\u751f\u6210\u9759\u6001\u6587\u4ef6site 2.4.2 site\u7ed3\u548cnginx \u00b6 root@leco:~/book/books# ll site \u603b\u7528\u91cf 176 drwxr-xr-x 16 root root 4096 2\u6708 14 15:17 ./ drwxr-xr-x 5 root root 4096 2\u6708 13 16:36 ../ -rw-r--r-- 1 root root 43718 2\u6708 14 15:17 404.html drwxr-xr-x 10 root root 4096 2\u6708 14 15:17 appendix/ drwxr-xr-x 6 root root 4096 2\u6708 14 15:17 assets/ drwxr-xr-x 2 root root 4096 2\u6708 14 15:17 contact/ drwxr-xr-x 2 root root 4096 2\u6708 14 15:17 course/ drwxr-xr-x 3 root root 4096 2\u6708 14 15:17 frontend/ drwxr-xr-x 2 root root 4096 2\u6708 14 15:17 img/ -rw-r--r-- 1 root root 49983 2\u6708 14 15:17 index.html drwxr-xr-x 5 root root 4096 2\u6708 14 15:17 install/ drwxr-xr-x 2 root root 4096 2\u6708 14 15:17 js/ drwxr-xr-x 3 root root 4096 2\u6708 14 15:17 linux/ drwxr-xr-x 3 root root 4096 2\u6708 14 15:17 pictures/ drwxr-xr-x 3 root root 4096 2\u6708 14 15:17 python/ drwxr-xr-x 2 root root 4096 2\u6708 14 15:17 recommend/ drwxr-xr-x 2 root root 4096 2\u6708 14 15:17 search/ -rw-r--r-- 1 root root 10505 2\u6708 14 15:17 sitemap.xml -rw-r--r-- 1 root root 245 2\u6708 14 15:17 sitemap.xml.gz drwxr-xr-x 58 root root 4096 2\u6708 14 15:17 syntax/ root@leco:~/book/books# cat /etc/nginx/sites-enabled/book.conf server { listen 5000; charset utf-8; client_max_body_size 75M; location / { root /root/book/books/site; index index.html; } } root@leco:~/book/books# /etc/init.d/nginx restart [ ok ] Restarting nginx (via systemctl): nginx.service. \u5c55\u793a\u6548\u679c 2.4.3 \u90e8\u7f72\u5230github page \u00b6 root@leco:~/book/books# mkdocs gh-deploy INFO - Cleaning site directory INFO - Building documentation to directory: /root/book/books/site INFO - Copying '/root/book/books/site' to 'gh-pages' branch and pushing to GitHub. INFO - Your documentation should shortly be available at: https://caimengzhi.github.io/books/ 2.5 \u914d\u7f6e\u5feb\u6377\u547d\u4ee4 \u00b6 2.5.1 \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 \u00b6 root@leco:~/book/books/docs/course# egrep -irn 'cmz' /root/.bashrc 84:alias cmzb='cd /root/book/books;mkdocs build;cd -' 85:alias cmzd='cd /root/book/books;mkdocs gh-deploy;cd -' 2.5.2 \u751f\u6548\u73af\u5883\u53d8\u91cf \u00b6 root@leco:~/book/books/docs/course# source /root/.bashrc \u4e0b\u6b21\u767b\u5f55root\u7528\u6237\u7684\u65f6\u5019\uff0c\u5728\u4efb\u4f55\u76ee\u5f55\u4e0b\u90fd\u53ef\u4ee5\u6267\u884ccmzb\u3002 root@leco:~/book/books/docs/course# cmzd INFO - Cleaning site directory INFO - Building documentation to directory: /root/book/books/site INFO - Copying '/root/book/books/site' to 'gh-pages' branch and pushing to GitHub. INFO - Your documentation should shortly be available at: https://caimengzhi.github.io/books/ 2.6 \u914d\u7f6e\u6587\u4ef6 \u00b6 \u628a\u622a\u53d6\u7684\u56fe\u7247\u4e0a\u4f20\u5230\u6307\u5b9a\u7684\u76ee\u5f55\u4e0b root@leco:~/book/books/docs/course# ls ~/book/books/docs/pictures/course/1.png /root/book/books/docs//course/1.png \u5c55\u793a\u6548\u679c \u6ce8\u610f\u56fe\u7247\u76f8\u5bf9\u4f4d\u7f6e 1. ![](../pictures/course/1.png) \u671f\u4e2d\u56fe\u7247\u7684\u4f4d\u7f6e\u662f../pictures/course/1.png\u662f\u6839\u636emarkdown\u6587\u4ef6\u6240\u5728\u4f4d\u7f6e\u53bb\u627e\u56fe\u7247\u7684\u76f8\u5bf9\u4f4d\u7f6e root@leco:~/book/books/docs/course# ls index.md root@leco:~/book/books/docs/course# ls ../pictures/course/1.png ../pictures/course/1.png 2. \u6211\u8bd5\u8fc7\u7edd\u5bf9\u8def\u5f84\u4e0d\u884c\uff0c\u4f60\u4eec\u8bd5\u8bd5\u770b","title":"\u6559\u7a0b"},{"location":"course/#1","text":"root@leco:/tmp/leco# git clone https://github.com/caimengzhi/books.git \u6b63\u514b\u9686\u5230 'books'... remote: Enumerating objects: 1879, done. remote: Counting objects: 100% (1879/1879), done. remote: Compressing objects: 100% (237/237), done. remote: Total 6365 (delta 835), reused 1800 (delta 782), pack-reused 4486 \u63a5\u6536\u5bf9\u8c61\u4e2d: 100% (6365/6365), 5.58 MiB | 24.00 KiB/s, \u5b8c\u6210. \u5904\u7406 delta \u4e2d: 100% (2938/2938), \u5b8c\u6210. \u68c0\u67e5\u8fde\u63a5... \u5b8c\u6210\u3002 root@leco:/tmp/leco# cd books/ root@leco:/tmp/leco/books# ls docs mkdocs.yml README.md site root@leco:/tmp/leco/books# cd .. root@leco:/tmp/leco# tree . -L 3 . \u2514\u2500\u2500 books \u251c\u2500\u2500 docs \u2502 \u251c\u2500\u2500 appendix \u2502 \u251c\u2500\u2500 contact.md \u2502 \u251c\u2500\u2500 frontend \u2502 \u251c\u2500\u2500 img \u2502 \u251c\u2500\u2500 index.md \u2502 \u251c\u2500\u2500 install \u2502 \u251c\u2500\u2500 js \u2502 \u251c\u2500\u2500 linux \u2502 \u251c\u2500\u2500 pictures \u2502 \u251c\u2500\u2500 python \u2502 \u251c\u2500\u2500 recommend.md \u2502 \u2514\u2500\u2500 syntax \u251c\u2500\u2500 mkdocs.yml \u251c\u2500\u2500 README.md \u2514\u2500\u2500 site \u251c\u2500\u2500 404.html \u251c\u2500\u2500 appendix \u251c\u2500\u2500 assets \u251c\u2500\u2500 contact \u251c\u2500\u2500 frontend \u251c\u2500\u2500 img \u251c\u2500\u2500 index.html \u251c\u2500\u2500 install \u251c\u2500\u2500 js \u251c\u2500\u2500 linux \u251c\u2500\u2500 pictures \u251c\u2500\u2500 python \u251c\u2500\u2500 recommend \u251c\u2500\u2500 search \u251c\u2500\u2500 sitemap.xml \u251c\u2500\u2500 sitemap.xml.gz \u2514\u2500\u2500 syntax 25 directories, 9 files \u89e3\u91ca \u751f\u6210\u9759\u6001\u6587\u4ef6 mkdocs build \u7136\u540e\u5c31\u5728\u9879\u76ee\u7684\u6587\u4ef6\u5939\u4e0b\u751f\u6210site\u9759\u6001\u6587\u4ef6\uff0c\u4ee5\u540enginx\u7684\u5bb6\u76ee\u5f55\u6307\u5b9a\u5230\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u5373\u53ef","title":"1. \u514b\u9686\u9879\u76ee"},{"location":"course/#2","text":"","title":"2. \u521b\u5efa\u9879\u76ee"},{"location":"course/#21-markdown","text":"root@leco:~/book/books/docs# cd course/ root@leco:~/book/books/docs/course# ls index.md root@leco:~/book/books/docs/course# cat index.md ### 1. \u514b\u9686\u9879\u76ee root@leco:/tmp/leco# git clone git@github.com:caimengzhi/books.git \u6b63\u514b\u9686\u5230 'books'... remote: Enumerating objects: 1879, done. remote: Counting objects: 100% (1879/1879), done. remote: Compressing objects: 100% (237/237), done. remote: Total 6365 (delta 835), reused 1800 (delta 782), pack-reused 4486 \u63a5\u6536\u5bf9\u8c61\u4e2d: 100% (6365/6365), 5.58 MiB | 24.00 KiB/s, \u5b8c\u6210. \u5904\u7406 delta \u4e2d: 100% (2938/2938), \u5b8c\u6210. \u68c0\u67e5\u8fde\u63a5... \u5b8c\u6210\u3002 root@leco:/tmp/leco# cd books/ root@leco:/tmp/leco/books# ls docs mkdocs.yml README.md site root@leco:/tmp/leco/books# cd .. root@leco:/tmp/leco# tree . -L 3 . \u2514\u2500\u2500 books","title":"2.1 \u521b\u5efamarkdown\u6587\u4ef6"},{"location":"course/#22","text":"\u6587\u4ef6\u5185\u5bb9\u5176\u4ed6\u7701\u7565 root@leco:~/book/books# egrep -irn course mkdocs.yml 107: - \u6559\u7a0b: course/index.md","title":"2.2 \u4fee\u6539\u76ee\u5f55\u6587\u4ef6"},{"location":"course/#23","text":"\u914d\u7f6e\u76f8\u5173\u4fe1\u606f\uff0c\u63d0\u4ea4\u4ee3\u7801 root@leco:~/book/books/docs/course# cd .. root@leco:~/book/books/docs# ls appendix contact.md course frontend img index.md install js linux mysql pictures python recommend.md syntax root@leco:~/book/books/docs# cd .. root@leco:~/book/books# ls docs mkdocs.yml README.md site root@leco:~/book/books# ls docs mkdocs.yml README.md site root@leco:~/book/books# git add . root@leco:~/book/books# git commit -m 'add course how to use mkdocs' [master 205de67] add course how to use mkdocs 98 files changed, 10137 insertions(+), 4377 deletions(-) create mode 100644 docs/course/index.md create mode 100644 site/course/index.html rewrite site/search/search_index.json (64%) root@leco:~/book/books# git tag v1.0 root@leco:~/book/books# git push \u5bf9\u8c61\u8ba1\u6570\u4e2d: 215, \u5b8c\u6210. Delta compression using up to 4 threads. \u538b\u7f29\u5bf9\u8c61\u4e2d: 100% (28/28), \u5b8c\u6210. \u5199\u5165\u5bf9\u8c61\u4e2d: 100% (215/215), 152.75 KiB | 173.00 KiB/s, \u5b8c\u6210. Total 215 (delta 97), reused 195 (delta 83) remote: Resolving deltas: 100% (97/97), completed with 13 local objects. To git@github.com:caimengzhi/books.git 0de48fc..205de67 master -> master","title":"2.3 \u914d\u7f6e\u76ee\u5f55"},{"location":"course/#24","text":"","title":"2.4 \u90e8\u7f72"},{"location":"course/#241","text":"root@leco:~/book/books# mkdocs build \u6267\u884c mkdocs build\u7684\u65f6\u5019\u5fc5\u987b\u5728\u8fd9\u76ee\u5f55\u4e0b\u56e0\u4e3a\u4f1a\u53bb\u627e\u914d\u7f6e\u6587\u4ef6\uff0c\u6267\u884c\u540e\u6b64\u65f6\u4f1a\u751f\u6210\u9759\u6001\u6587\u4ef6site","title":"2.4.1 \u751f\u6210\u9759\u6001\u6587\u4ef6"},{"location":"course/#242-sitenginx","text":"root@leco:~/book/books# ll site \u603b\u7528\u91cf 176 drwxr-xr-x 16 root root 4096 2\u6708 14 15:17 ./ drwxr-xr-x 5 root root 4096 2\u6708 13 16:36 ../ -rw-r--r-- 1 root root 43718 2\u6708 14 15:17 404.html drwxr-xr-x 10 root root 4096 2\u6708 14 15:17 appendix/ drwxr-xr-x 6 root root 4096 2\u6708 14 15:17 assets/ drwxr-xr-x 2 root root 4096 2\u6708 14 15:17 contact/ drwxr-xr-x 2 root root 4096 2\u6708 14 15:17 course/ drwxr-xr-x 3 root root 4096 2\u6708 14 15:17 frontend/ drwxr-xr-x 2 root root 4096 2\u6708 14 15:17 img/ -rw-r--r-- 1 root root 49983 2\u6708 14 15:17 index.html drwxr-xr-x 5 root root 4096 2\u6708 14 15:17 install/ drwxr-xr-x 2 root root 4096 2\u6708 14 15:17 js/ drwxr-xr-x 3 root root 4096 2\u6708 14 15:17 linux/ drwxr-xr-x 3 root root 4096 2\u6708 14 15:17 pictures/ drwxr-xr-x 3 root root 4096 2\u6708 14 15:17 python/ drwxr-xr-x 2 root root 4096 2\u6708 14 15:17 recommend/ drwxr-xr-x 2 root root 4096 2\u6708 14 15:17 search/ -rw-r--r-- 1 root root 10505 2\u6708 14 15:17 sitemap.xml -rw-r--r-- 1 root root 245 2\u6708 14 15:17 sitemap.xml.gz drwxr-xr-x 58 root root 4096 2\u6708 14 15:17 syntax/ root@leco:~/book/books# cat /etc/nginx/sites-enabled/book.conf server { listen 5000; charset utf-8; client_max_body_size 75M; location / { root /root/book/books/site; index index.html; } } root@leco:~/book/books# /etc/init.d/nginx restart [ ok ] Restarting nginx (via systemctl): nginx.service. \u5c55\u793a\u6548\u679c","title":"2.4.2 site\u7ed3\u548cnginx"},{"location":"course/#243-github-page","text":"root@leco:~/book/books# mkdocs gh-deploy INFO - Cleaning site directory INFO - Building documentation to directory: /root/book/books/site INFO - Copying '/root/book/books/site' to 'gh-pages' branch and pushing to GitHub. INFO - Your documentation should shortly be available at: https://caimengzhi.github.io/books/","title":"2.4.3 \u90e8\u7f72\u5230github page"},{"location":"course/#25","text":"","title":"2.5 \u914d\u7f6e\u5feb\u6377\u547d\u4ee4"},{"location":"course/#251","text":"root@leco:~/book/books/docs/course# egrep -irn 'cmz' /root/.bashrc 84:alias cmzb='cd /root/book/books;mkdocs build;cd -' 85:alias cmzd='cd /root/book/books;mkdocs gh-deploy;cd -'","title":"2.5.1 \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6"},{"location":"course/#252","text":"root@leco:~/book/books/docs/course# source /root/.bashrc \u4e0b\u6b21\u767b\u5f55root\u7528\u6237\u7684\u65f6\u5019\uff0c\u5728\u4efb\u4f55\u76ee\u5f55\u4e0b\u90fd\u53ef\u4ee5\u6267\u884ccmzb\u3002 root@leco:~/book/books/docs/course# cmzd INFO - Cleaning site directory INFO - Building documentation to directory: /root/book/books/site INFO - Copying '/root/book/books/site' to 'gh-pages' branch and pushing to GitHub. INFO - Your documentation should shortly be available at: https://caimengzhi.github.io/books/","title":"2.5.2 \u751f\u6548\u73af\u5883\u53d8\u91cf"},{"location":"course/#26","text":"\u628a\u622a\u53d6\u7684\u56fe\u7247\u4e0a\u4f20\u5230\u6307\u5b9a\u7684\u76ee\u5f55\u4e0b root@leco:~/book/books/docs/course# ls ~/book/books/docs/pictures/course/1.png /root/book/books/docs//course/1.png \u5c55\u793a\u6548\u679c \u6ce8\u610f\u56fe\u7247\u76f8\u5bf9\u4f4d\u7f6e 1. ![](../pictures/course/1.png) \u671f\u4e2d\u56fe\u7247\u7684\u4f4d\u7f6e\u662f../pictures/course/1.png\u662f\u6839\u636emarkdown\u6587\u4ef6\u6240\u5728\u4f4d\u7f6e\u53bb\u627e\u56fe\u7247\u7684\u76f8\u5bf9\u4f4d\u7f6e root@leco:~/book/books/docs/course# ls index.md root@leco:~/book/books/docs/course# ls ../pictures/course/1.png ../pictures/course/1.png 2. \u6211\u8bd5\u8fc7\u7edd\u5bf9\u8def\u5f84\u4e0d\u884c\uff0c\u4f60\u4eec\u8bd5\u8bd5\u770b","title":"2.6 \u914d\u7f6e\u6587\u4ef6"},{"location":"frontend/css/css.index/","text":"CSS 1. CSS\u4ecb\u7ecd \u00b6 \u5c42\u53e0\u6837\u5f0f\u8868(\u82f1\u6587\u5168\u79f0\uff1aCascading Style Sheets)\u662f\u4e00\u79cd\u7528\u6765\u8868\u73b0HTML\uff08\u6807\u51c6\u901a\u7528\u6807\u8bb0\u8bed\u8a00\u7684\u4e00\u4e2a\u5e94\u7528\uff09\u6216XML\uff08\u6807\u51c6\u901a\u7528\u6807\u8bb0\u8bed\u8a00\u7684\u4e00\u4e2a\u5b50\u96c6\uff09\u7b49\u6587\u4ef6\u6837\u5f0f\u7684\u8ba1\u7b97\u673a\u8bed\u8a00\u3002CSS\u4e0d\u4ec5\u53ef\u4ee5\u9759\u6001\u5730\u4fee\u9970\u7f51\u9875\uff0c\u8fd8\u53ef\u4ee5\u914d\u5408\u5404\u79cd\u811a\u672c\u8bed\u8a00\u52a8\u6001\u5730\u5bf9\u7f51\u9875\u5404\u5143\u7d20\u8fdb\u884c\u683c\u5f0f\u5316\uff0cCSS \u80fd\u591f\u5bf9\u7f51\u9875\u4e2d\u5143\u7d20\u4f4d\u7f6e\u7684\u6392\u7248\u8fdb\u884c\u50cf\u7d20\u7ea7\u7cbe\u786e\u63a7\u5236\uff0c\u652f\u6301\u51e0\u4e4e\u6240\u6709\u7684\u5b57\u4f53\u5b57\u53f7\u6837\u5f0f\uff0c\u62e5\u6709\u5bf9\u7f51\u9875\u5bf9\u8c61\u548c\u6a21\u578b\u6837\u5f0f\u7f16\u8f91\u7684\u80fd\u529b\u3002 \u9996\u5148\u5f3a\u8c03\u4e00\u70b9CSS\u5728\u524d\u7aef\u9875\u9762\u4e2d\u7684\u5730\u4f4d\u3002HTML\u4ee3\u7801\u5199\u5b8c\u540e\u3002CSS\u5bf9HTML\u8fdb\u884c\u4fee\u7f2e\uff0c\u4e5f\u5c31\u662f\u4f20\u8bf4\u7684\"\u7f8e\u5bb9\u5e08\"\u3002\u5982\u6211\u4eec\u5728\u6d4f\u89c8\u5668\u4e0a\u770b\u5230\u7684\u9875\u9762\u4e2d\u7684\u5b57\u4f53\u989c\u8272\uff0c\u5b57\u4f53\u5927\u5c0f\uff0c\u6bb5\u843d\u683c\u5f0f\uff0c\u56fe\u7247\uff0c\u89c6\u9891\u663e\u793a\uff0c\u800cJs\u7684\u4f5c\u7528\u5c31\u662f\u6211\u4eec\u8ba9\u9875\u9762\u52a8\u8d77\u6765\u3002\u6bd4\u5982 \u6211\u4eec\u9f20\u6807\u70b9\u51fb\uff0c\u62d6\u52a8\u7b49\uff0c\u52a8\u4f5c\u90fd\u662fjs\u8d77\u5230\u4f5c\u7528\u3002 2. CSS \u5f15\u5165 \u00b6 2.1 \u7279\u6027 \u00b6 \u6982\u5ff5\uff1a\u5c42\u53e0\u6837\u5f0f\u8868\u6216\u8005\u7ea7\u8054\u6837\u5f0f\u8868\uff08Cascading style sheets\uff09 \u5c42\u53e0\uff1aCSS\u7684\u7279\u6027 \u4f5c\u7528\uff1a\u8bbe\u7f6e\u7f51\u9875\u7ed3\u6784\u6837\u5f0f(\u6539\u53d8html\u6807\u7b7e\u6837\u5f0f)\uff0c\u901a\u8fc7CSS\u7ed9HTML\u6807\u7b7e\u5c5e\u6027\u8fbe\u5230\u6539\u53d8\u6807\u7b7e\u6837\u5f0f\u3002 2.2 \u5f15\u5165\u65b9\u5f0f \u00b6 2.2.1 \u5185\u5d4c\u65b9\u6cd5 \u00b6 css\u6837\u5f0f\u5199\u5728html\u6587\u4ef6head\u5185\u3002 <head> <style type=\"text/css\"> \u6837\u5f0f\u8868\u5185\u5bb9|CSS\u4ee3\u7801 </style> </head> \u6837\u5f0f\u53ea\u4f5c\u7528\u4e8e\u5f53\u524d\u6587\u4ef6\uff0c\u6ca1\u6709\u771f\u6b63\u5b9e\u73b0\u7ed3\u6784\u8868\u73b0\u5206\u79bb\u3002 2.2.2 \u5916\u94fe\u65b9\u6cd5 \u00b6 css\u6837\u5f0f\u4e3a\u5355\u72ec\u7684\u6587\u4ef6\uff0c\u7136\u540ehtml\u6587\u4ef6\u94fe\u63a5\u5230\u6b64css\u6587\u4ef6\uff0c\u6781\u529b\u63a8\u8350\u8fd9\u6837\u5199\u3002 <head> <link rel=\"stylesheet\" href=\"header.css\"> <head> \u4f5c\u7528\u4e8e\u94fe\u63a5\u5230\u5b83\u7684\u6587\u4ef6\uff0c\u8303\u56f4\u5e7f\uff0c\u771f\u6b63\u5b9e\u73b0\u7ed3\u6784\u8868\u73b0\u5206\u79bb\u3002 2.2.3 \u884c\u5185\u65b9\u6cd5 \u00b6 \u76f4\u63a5\u5199\u5728\u6807\u7b7e\u5185\u7684\u6837\u5f0f\u3002 <body> <h1 style=\"font-size:30px; color:red;\">\u535a\u5ba2</h1> </body> \u4f5c\u7528\u8303\u56f4\u4ec5\u9650\u4e8e\u5f53\u524d\u6807\u7b7e\uff0c\u8303\u56f4\u5c0f\uff0c\u7ed3\u6784\u8868\u73b0\u6df7\u5728\u4e00\u8d77\u3002 3. \u9009\u62e9\u5668 \u00b6 \u5728 CSS \u4e2d\uff0c\u9009\u62e9\u5668\u662f\u4e00\u79cd\u6a21\u5f0f\uff0c\u7528\u4e8e\u9009\u62e9\u9700\u8981\u6dfb\u52a0\u6837\u5f0f\u7684\u5143\u7d20\u3002\u9009\u62e9\u5668 {\u5c5e\u6027\uff1a\u503c;} \u9009\u62e9\u5668\uff1a\u9009\u62e9\u6807\u7b7e\u7684\u8fc7\u7a0b \u6807\u7b7e\u9009\u62e9\u5668 \u7c7b\u9009\u62e9\u5668 D\u9009\u62e9\u5668 \u901a\u914d\u7b26\u9009\u62e9\u5668 \u4ea4\u96c6\u9009\u62e9\u5668\uff08\u6807\u7b7e\u6307\u5b9a\u5f0f\uff09 \u540e\u4ee3\u9009\u62e9\u5668 \u81ea\u5e26\u9009\u62e9\u5668 \u5e76\u96c6\u9009\u62e9\u5668 \u8865\u5145\u9009\u62e9\u5668 1. \u4f2a\u7c7b\u9009\u62e9\u5668 1. \u5c5e\u6027\u9009\u62e9\u5668 1. \u4f2a\u5143\u7d20\u9009\u62e9\u5668 3.1 \u9009\u62e9\u5668\u4ecb\u7ecd \u00b6 \"CSS\" \u5217\u6307\u793a\u8be5\u5c5e\u6027\u662f\u5728\u54ea\u4e2a CSS \u7248\u672c\u4e2d\u5b9a\u4e49\u7684\u3002\uff08CSS1\u3001CSS2 \u8fd8\u662f CSS3\u3002 \u9009\u62e9\u5668 \u4f8b\u5b50 \u4f8b\u5b50\u63cf\u8ff0 CSS\u7248\u672c .class .intro \u9009\u62e9 class=\"intro\" \u7684\u6240\u6709\u5143\u7d20\u3002 1 #id #firstname \u9009\u62e9 id=\"firstname\" \u7684\u6240\u6709\u5143\u7d20\u3002 1 * * \u9009\u62e9\u6240\u6709\u5143\u7d20\u3002 2 element p \u9009\u62e9\u6240\u6709 \u5143\u7d20\u3002 1 element,element div,p \u9009\u62e9\u6240\u6709 \u5143\u7d20\u548c\u6240\u6709 \u5143\u7d20\u3002 1 element element div p \u9009\u62e9 \u5143\u7d20\u5185\u90e8\u7684\u6240\u6709 \u5143\u7d20\u3002 1 element>element div>p \u9009\u62e9\u7236\u5143\u7d20\u4e3a \u5143\u7d20\u7684\u6240\u6709 \u5143\u7d20\u3002 2 element+element div+p \u9009\u62e9\u7d27\u63a5\u5728 \u5143\u7d20\u4e4b\u540e\u7684\u6240\u6709 \u5143\u7d20\u3002 2 [attribute] [target] \u9009\u62e9\u5e26\u6709 target \u5c5e\u6027\u6240\u6709\u5143\u7d20\u3002 2 [attribute=value] [target=_blank] \u9009\u62e9 target=\"_blank\" \u7684\u6240\u6709\u5143\u7d20\u3002 2 [attribute~=value] [title~=flower] \u9009\u62e9 title \u5c5e\u6027\u5305\u542b\u5355\u8bcd \"flower\" \u7684\u6240\u6709\u5143\u7d20\u3002 2 [attribute =value] [lang =en] :link a:link \u9009\u62e9\u6240\u6709\u672a\u88ab\u8bbf\u95ee\u7684\u94fe\u63a5\u3002 1 :visited a:visited \u9009\u62e9\u6240\u6709\u5df2\u88ab\u8bbf\u95ee\u7684\u94fe\u63a5\u3002 :active a:active \u9009\u62e9\u6d3b\u52a8\u94fe\u63a5\u3002 1 :hover a:hover \u9009\u62e9\u9f20\u6807\u6307\u9488\u4f4d\u4e8e\u5176\u4e0a\u7684\u94fe\u63a5\u3002 1 :focus input:focus \u9009\u62e9\u83b7\u5f97\u7126\u70b9\u7684 input \u5143\u7d20\u3002 2 :first-letter p:first-letter \u9009\u62e9\u6bcf\u4e2a \u5143\u7d20\u7684\u9996\u5b57\u6bcd\u3002 1 :first-line p:first-line \u9009\u62e9\u6bcf\u4e2a \u5143\u7d20\u7684\u9996\u884c\u3002 1 :first-child p:first-child \u9009\u62e9\u5c5e\u4e8e\u7236\u5143\u7d20\u7684\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 2 :before p:before \u5728\u6bcf\u4e2a \u5143\u7d20\u7684\u5185\u5bb9\u4e4b\u524d\u63d2\u5165\u5185\u5bb9\u3002 2 :after p:after \u5728\u6bcf\u4e2a \u5143\u7d20\u7684\u5185\u5bb9\u4e4b\u540e\u63d2\u5165\u5185\u5bb9\u3002 2 :lang(language) p:lang(it) \u9009\u62e9\u5e26\u6709\u4ee5 \"it\" \u5f00\u5934\u7684 lang \u5c5e\u6027\u503c\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 2 element1~element2 p~ul \u9009\u62e9\u524d\u9762\u6709 \u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 [attribute^=value] a[src^=\"https\"] \u9009\u62e9\u5176 src \u5c5e\u6027\u503c\u4ee5 \"https\" \u5f00\u5934\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 [attribute$=value] a[src$=\".pdf\"] \u9009\u62e9\u5176 src \u5c5e\u6027\u4ee5 \".pdf\" \u7ed3\u5c3e\u7684\u6240\u6709 \u5143\u7d20\u3002 3 [attribute*=value] a[src*=\"abc\"] \u9009\u62e9\u5176 src \u5c5e\u6027\u4e2d\u5305\u542b \"abc\" \u5b50\u4e32\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 :first-of-type p:first-of-type \u9009\u62e9\u5c5e\u4e8e\u5176\u7236\u5143\u7d20\u7684\u9996\u4e2a \u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 :last-of-type p:last-of-type \u9009\u62e9\u5c5e\u4e8e\u5176\u7236\u5143\u7d20\u7684\u6700\u540e \u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 :only-of-type p:only-of-type \u9009\u62e9\u5c5e\u4e8e\u5176\u7236\u5143\u7d20\u552f\u4e00\u7684 \u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 :only-child p:only-child \u9009\u62e9\u5c5e\u4e8e\u5176\u7236\u5143\u7d20\u7684\u552f\u4e00\u5b50\u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 :nth-child(n) p:nth-child(2) \u9009\u62e9\u5c5e\u4e8e\u5176\u7236\u5143\u7d20\u7684\u7b2c\u4e8c\u4e2a\u5b50\u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 :nth-last-child(n) p:nth-last-child(2) \u540c\u4e0a\uff0c\u4ece\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\u5f00\u59cb\u8ba1\u6570\u3002 3 :nth-of-type(n) p:nth-of-type(2) \u9009\u62e9\u5c5e\u4e8e\u5176\u7236\u5143\u7d20\u7b2c\u4e8c\u4e2a \u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 :nth-last-of-type(n) p:nth-last-of-type(2) \u540c\u4e0a\uff0c\u4f46\u662f\u4ece\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\u5f00\u59cb\u8ba1\u6570\u3002 3 :last-child p:last-child \u9009\u62e9\u5c5e\u4e8e\u5176\u7236\u5143\u7d20\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\u6bcf\u4e2a \u5143\u7d20\u3002 3 :root :root \u9009\u62e9\u6587\u6863\u7684\u6839\u5143\u7d20\u3002 3 :empty p:empty \u9009\u62e9\u6ca1\u6709\u5b50\u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\uff08\u5305\u62ec\u6587\u672c\u8282\u70b9\uff09\u3002 3 :target #news:target \u9009\u62e9\u5f53\u524d\u6d3b\u52a8\u7684 #news \u5143\u7d20\u3002 3 :enabled input:enabled \u9009\u62e9\u6bcf\u4e2a\u542f\u7528\u7684 \u5143\u7d20\u3002 3 :disabled input:disabled \u9009\u62e9\u6bcf\u4e2a\u7981\u7528\u7684 \u5143\u7d20 3 :checked input:checked \u9009\u62e9\u6bcf\u4e2a\u88ab\u9009\u4e2d\u7684 \u5143\u7d20\u3002 3 :not(selector) :not(p) \u9009\u62e9\u975e \u5143\u7d20\u7684\u6bcf\u4e2a\u5143\u7d20\u3002 3 ::selection ::selection \u9009\u62e9\u88ab\u7528\u6237\u9009\u53d6\u7684\u5143 3 3.2 \u6807\u7b7e\u9009\u62e9\u5668 \u00b6 Html\u6807\u7b7e\u540d {\u5c5e\u6027\uff1a\u503c;} \uff0c\u5e38\u7528\u7684\u5c5e\u6027: \u5c5e\u6027 \u63cf\u8ff0 color \u524d\u666f\u8272\uff08\u6587\u5b57\u989c\u8272\uff09 backgroud-color \u80cc\u666f\u8272 font-size \u8bbe\u7f6e\u6587\u5b57\u5927\u5c0f width \u8bbe\u7f6e\u5bbd\u5ea6 height \u8bbe\u7f6e\u9ad8\u5ea6 text-align left right text-indent \u9996\u884c\u7f29\u8fdb text-indent: 2em; \u9996\u884c\u7f29\u8fdb\u4e24\u4e2a\u6c49\u5b57 text-indent: 20px; \u9996\u884c\u7f29\u8fdb20\u50cf\u7d20 3.3 \u5355\u4f4d\u4ecb\u7ecd \u00b6 \u5c5e\u6027 \u63cf\u8ff0 px \u50cf\u7d20 20px----20\u50cf\u7d20\u70b9 em 1em=1\u4e2a\u6587\u5b57\u5927\u5c0f\uff0cnem=n\u4e2a\u6587\u5b57\u5927\u5c0f 3.4 \u989c\u8272 \u00b6 3.4.1 \u76f4\u63a5\u4f7f\u7528\u989c\u8272\u7684\u540d\u8bcd \u00b6 background-color: red; 3.4.2 \u4f7f\u752816\u8fdb\u5236\u8868\u793a \u00b6 background-color: #000000; 3.3.3 \u4f7f\u7528\u4e09\u539f\u8272\u8868\u793a \u00b6 rgb r: red (0-255)\u53d6\u503c\u8303\u56f4 g:green (0-255)\u53d6\u503c\u8303\u56f4 b:blue (0-255)\u53d6\u503c\u8303\u56f4 background-color: rgb(23,56,89); 1. \u534a\u900f\u660e\uff1a background-color: rgba(23,56,89,0.2); #\u6700\u540e\u4e00\u4f4d\u53d6\u503c0\u52301 2. \u4f7f\u7528opacity\u5b9e\u73b0\u534a\u900f\u660e background-color: red; opacity: 0.5; \u4f1a\u8ba9\u6587\u5b57\u4e5f\u534a\u900f\u660e \u89e3\u51b3IE\u4f4e\u7248\u672c\u4e0d\u517c\u5bb9\u95ee\u9898 background-color: red; opacity: 0.5; filter: Alpha(opacity=50); 3.5 \u7c7b\u9009\u62e9\u5668 \u00b6 \u9996\u5148\uff0c\u7c7b \u9009\u62e9\u5668\u524d\u9762\u6709\u4e00\u4e2a . \u53f7 \u4e5f\u79f0\u4e3a\u68cb\u70b9\u53f7\u3002 3.5.1 \u81ea\u5b9a\u4e49\u7c7b\u540d \u00b6 \u81ea\u5b9a\u4e49\u7c7b\u540d {\u5c5e\u6027\uff1a\u503c;} - \u901a\u8fc7.\u81ea\u5b9a\u4e49\u7c7b\u540d \u5b9a\u4e49\u4e00\u4e2a\u7c7b\u6837\u5f0f .p_red{ } 3.5.2 \u8c03\u7528 \u00b6 \u6807\u7b7e\u901aclass\u5c5e\u6027\u8c03\u7528\u7c7b\u6837\u5f0f <p class=\"p_red\">\u6587\u5b572</p> .p_red{ color: red; } <p class=\"p_red\">\u6587\u5b572</p> \u6b64\u65f6\u4f1a\u5c06\u6807\u7b7ep\u4e2dclass\u662fp_red\u7684\u9009\u4e2d 3.5.3 \u7279\u70b9 \u00b6 \u4e00\u4e2a\u6837\u5f0f\u53ef\u4ee5\u88ab\u591a\u4e2a\u6807\u7b7e\u8c03\u7528 <p class=\"p_red\">\u6587\u5b572</p> <div class=\"p_red\">\u6587\u5b572</div> 2. \u4e00\u4e2a\u6807\u7b7e\u53ef\u4ee5\u540c\u65f6\u8c03\u7528\u591a\u4e2a\u7c7b\u6837\u5f0f(\u4e2d\u95f4\u52a0\u7a7a\u683c) <div class=\"p_red public\">\u6587\u5b572</div> 3.5.4 \u547d\u540d\u89c4\u8303 \u00b6 \u987e\u540d\u601d\u4e49 \u5c31\u662f\u6839\u636e\u4f5c\u7528\u8d77\u5bf9\u5e94\u7684\u540d\u5b57\u3002\u6bd4\u5982\u6392\u5934\u6eda\u52a8\u7684\u6807\u8bed\uff0c\u53ef\u4ee5\u9009\u62e9banner \u901a\u7528\u7c7b\u540d \u4e2d\u6587\u540d \u82f1\u6587\u540d \u5934 header \u5185 \u5bb9 content/container \u5c3e footer \u5bfc \u822a nav \u4fa7 \u680f sidebar \u680f \u76ee column \u6807 \u5fd7 logo \u5e7f \u544a banner \u70ed \u70b9 hot \u65b0 \u95fb news \u4e0b \u8f7d download \u83dc \u5355 menu \u641c \u7d22 search \u9875 \u811a footer \u7248 \u6743 copyright \u6eda \u52a8 scroll \u5185 \u5bb9 content \u53cb\u60c5\u94fe\u63a5 friendlink \u5b50\u5bfc \u822a subnav \u9875\u9762\u4e3b\u4f53 main \u5de6\u4e2d \u53f3 left right center \u767b\u5f55 \u6761 loginbar \u9875\u9762\u5916\u56f4\u63a7\u5236\u6574\u4f53\u5e03\u5c40\u5bbd\u5ea6 wrapper \u4ee5\u4e0b\u662f\u4e0d\u63a8\u8350\u7684\u5199\u6cd5 \u4e0d\u80fd\u4f7f\u7528\u4ee5\u6570\u5b57\u5f00\u5934 \u4e0d\u63a8\u8350\u4f7f\u7528\u4e2d\u6587\u5b9a\u4e49\u7c7b\u540d\uff08\u867d\u7136\u53ef\u4ee5\u4f7f\u7528\uff09 \u4e0d\u80fd\u4f7f\u7528\u4ee5\u7279\u6b8a\u5b57\u7b26\u5f00\u5934\u7684 \u4e2a\u4eba\u4e0d\u63a8\u8350\u4f7f\u7528\u6807\u7b7e\u540d\u4f5c\u4e3a\u5b9a\u4e49\u7c7b\u540d \u6bd4\u5982div\u4f5c\u4e3aclass\u503c\u7684 3.6 ID \u9009\u62e9\u5668 \u00b6 3.6.1 ID\u9009\u62e9\u5668\u8bed\u6cd5 \u00b6 \u5728\u67d0\u4e9b\u65b9\u9762\uff0cID \u9009\u62e9\u5668\u7c7b\u4f3c\u4e8e\u7c7b\u9009\u62e9\u5668\uff0c\u4e0d\u8fc7\u4e5f\u6709\u4e00\u4e9b\u91cd\u8981\u5dee\u522b\u3002\u9996\u5148\uff0cID \u9009\u62e9\u5668\u524d\u9762\u6709\u4e00\u4e2a # \u53f7 - \u4e5f\u79f0\u4e3a\u68cb\u76d8\u53f7\u6216\u4e95\u53f7\u3002\u8bed\u6cd5\u5982\u4e0b \u8bed\u6cd5\uff1a #\u81ea\u5b9a\u4e49\u540d\u79f0 {\u5c5e\u6027: \u503c;} 3.6.2 \u4f7f\u7528 \u00b6 \u9996\u5148\u901a\u8fc7#\u81ea\u5b9a\u4e49\u540d\u79f0 \u5b9a\u4e49\u4e00\u4e2aid\u9009\u62e9\u5668\u6837\u5f0f #color { color: red; } \u6807\u7b7e\u901a\u8fc7id\u5c5e\u6027\u8c03\u7528id\u6837\u5f0f <div class=\"one\" id=\"color\">caimengzhi</div> ID\u9009\u62e9\u5668\u548c\u7c7b\u9009\u62e9\u5668\u533a\u522b 1. \u9875\u9762\u4e2d\u7684ID\u9009\u62e9\u5668\u503c\u5fc5\u987b\u552f\u4e00\uff0c\u800c\u7c7b\u9009\u62e9\u5668\u53ef\u4ee5\u91cd\u590d\u3002 2. \u4e00\u4e2a\u6807\u7b7e\u53ea\u80fd\u8c03\u7528\u4e00\u4e2a\u6837\u5f0f <div class=\"p_red public\">caimengzhi</div> \u662f\u5bf9\u7684 <div id=\"p_red public\">caimengzhi</div> \u662f\u9519\u8bef 3.7 \u901a\u914d\u7b26\u9009\u62e9\u5668 \u00b6 \u901a\u914d\u9009\u62e9\u5668\u7528\u4e00\u4e2a\u661f\u53f7\uff08*\uff09\u8868\u793a\u3002\u5355\u72ec\u4f7f\u7528\u65f6\uff0c\u8fd9\u4e2a\u9009\u62e9\u5668\u53ef\u4ee5\u4e0e\u6587\u6863\u4e2d\u7684\u4efb\u4f55\u5143\u7d20\u5339\u914d\uff0c\u5c31\u50cf\u4e00\u4e2a\u901a\u914d\u7b26\u3002 \u8bed\u6cd5 \u8bed\u6cd5\uff1a * {\u5c5e\u6027: \u503c;.....} \u4f7f\u7528\uff1a\u8be5\u9009\u62e9\u5668\u4f1a\u5c06\u9875\u9762\u4e2d\u6240\u6709\u6807\u7b7e\u90fd\u9009\u4e2d * { color: red; } \u4f1a\u5728\u6837\u5f0f\u521d\u59cb\u5316\u65f6\u5019\u4f7f\u7528\u3002 3.7 font \u5c5e\u6027\u4ecb\u7ecd \u00b6 1. font-size \u6587\u5b57\u5927\u5c0f 2. font-weight \u6587\u5b57\u52a0\u7c97 1. normal \u5b57\u4f53\u6b63\u5e38 2. 700 \u6587\u5b57\u52a0\u7c97 3. bold \u6587\u5b57\u52a0\u7c97 4. 400 \u6b63\u5e38\u663e\u793a 3. font-style \u6587\u5b57\u659c\u4f53 1. normal \u6b63\u5e38 2. italic \u659c\u4f53 4. font-family 1. font-family: \"\u5fae\u8f6f\u96c5\u9ed1\"; 2. \u6587\u5b57\u5b57\u4f53\u8868\u793a\u65b9\u5f0f 1. \u76f4\u63a5\u8bbe\u7f6e\u5b57\u4f53\u5bf9\u5e94\u540d\u79f0\uff0c\uff08\u5b8b\u4f53\uff0c\u9ed1\u4f53\uff09 2. \u8bbe\u7f6e\u5b57\u4f53\u5bf9\u5e94\u7684\u82f1\u6587\u65b9\u5f0f 3. \u8bbe\u7f6e\u5b57\u4f53\u5bf9\u5e94\u7684unicode\u7684\u7f16\u7801 4. font-family \u4e00\u6b21\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u5b57\u4f53\uff0c\u5b57\u4f53\u5b57\u4f53\u4e4b\u95f4\u7528\u9017\u53f7\u9694\u5f00 5. line-height \u8bbe\u7f6e\u6587\u5b57\u884c\u9ad8 3.8 font \u5c5e\u6027\u8fde\u5199 \u00b6 1. font: font-weight font-style font-size/line-height font-family font: 700 italic 30px/20px \u5fae\u8f6f\u96c5\u9ed1; \u6ce8\u610f 1. \u5c5e\u6027\u8054\u5199\u4e2d\u5fc5\u987b\u8bbe\u7f6e font - size font - family 2. \u5c5e\u6027\u8054\u5199\u4e2d font - szie\u5fc5\u987b\u653e\u5230font - family\u4e4b\u524d 3. \u5982\u679c font\u5c5e\u6027\u8054\u5199\u4e2d\u7684\u5c5e\u6027\u90fd\u8981\u8bbe\u7f6e \uff0c\u90a3\u4e48\u6309\u7167\u4e0a\u8ff0\u5c5e\u6027\u53bb\u8bbe\u7f6e 3.9 \u590d\u5408\u9009\u62e9\u5668 \u00b6 \u590d\u5408\u9009\u62e9\u5668\u662f\u7531\u4e24\u4e2a\u6216\u591a\u4e2a\u57fa\u7840\u9009\u62e9\u5668\uff0c\u901a\u8fc7\u4e0d\u540c\u7684\u65b9\u5f0f\u7ec4\u5408\u800c\u6210\u7684,\u76ee\u7684\u662f\u4e3a\u4e86\u53ef\u4ee5\u9009\u62e9\u66f4\u51c6\u786e\u66f4\u7cbe\u7ec6\u7684\u76ee\u6807\u5143\u7d20\u6807\u7b7e 3.9.1 \u6807\u7b7e\u6307\u5b9a\u5f0f\u9009\u62e9\u5668 \u00b6 \u8bed\u6cd5\uff1a \u6807\u7b7e\u540d.\u7c7b\u540d {\u5c5e\u6027: \u503c;} \u6216\u8005 \u6807\u7b7e\u540d#id\u540d {\u5c5e\u6027: \u503c;} \u5173\u7cfb \u65e2\u3002\u3002\u3002\u3002\u53c8\u3002\u3002\u3002\u3002 \u5982\u4e0b\u56fe\u6240\u6709 div.one{ color: red; } <div class=\"one\">div\u4e2d\u7684\u6587\u5b57</div> <p class=\"one\">p\u4e2d\u7684\u6587\u5b57</p> <div class=\"two\">cmz</div> 3.9.2 \u540e\u4ee3\u9009\u62e9\u5668 \u00b6 \u540e\u4ee3\u9009\u62e9\u5668\uff08descendant selector\uff09\u53c8\u79f0\u4e3a\u5305\u542b\u9009\u62e9\u5668\u3002\u540e\u4ee3\u9009\u62e9\u5668\u53ef\u4ee5\u9009\u62e9\u4f5c\u4e3a\u67d0\u5143\u7d20\u540e\u4ee3\u7684\u5143\u7d20\u3002 \u8bed\u6cd5\uff1a \u9009\u62e9\u5668 \u9009\u62e9\u5668 ...{\u5c5e\u6027: \u503c;} \u6ce8\u610f 1. \u540e\u4ee3\u9009\u62e9\u5668\u6807\u7b7e\u4e4b\u95f4\u5fc5\u987b\u662f\u5d4c\u5957\u5173\u7cfb 2. \u9009\u62e9\u5668\u4e0e\u9009\u62e9\u5668\u4e4b\u95f4\u5fc5\u987b\u4f7f\u7528\u7a7a\u683c\u9694\u5f00 3. \u540e\u4ee3\u9009\u62e9\u5668\u53ea\u80fd\u9009\u4e2d\u540e\u4ee3\u5143\u7d20 ( \u6240\u6709\u540e\u4ee3 ) div span { color: red; } <div class=\"one\"> <span>\u6587\u5b571</span> <p> <span>\u6587\u5b572</span> </p> </div> <p class=\"tree\">\u6ca1\u6709\u7236\u5143\u7d20p</p> \u663e\u793a\u6548\u679c\u5982\u4e0b 3.9.3 \u5e76\u96c6\u9009\u62e9\u5668 \u00b6 CSS\u5e76\u96c6\u9009\u62e9\u5668\u4e5f\u53eb\u7fa4\u9009\u62e9\u5668\uff0c\u662f\u7531\u591a\u4e2a\u9009\u62e9\u5668\u901a\u8fc7\u9017\u53f7\u8fde\u63a5\u5728\u4e00\u8d77\u7684\uff0c\u8fd9\u4e9b\u9009\u62e9\u5668\u5206\u522b\u662f\uff1a\u6807\u7b7e\u9009\u62e9\u5668\u3001\u7c7b\u9009\u62e9\u5668\u6216id\u9009\u62e9\u5668\u7b49\u3002 \u5728\u58f0\u660e\u5404\u79cdCSS\u9009\u62e9\u5668\u65f6\uff0c\u5982\u679c\u67d0\u4e9b\u9009\u62e9\u5668\u7684\u98ce\u683c\u5b8c\u5168\u76f8\u540c\uff0c\u6216\u8005\u90e8\u5206\u76f8\u540c\uff0c\u4fbf\u53ef\u4ee5\u5229\u7528\u5e76\u96c6\u9009\u62e9\u5668\u540c\u65f6\u58f0\u660e\u8fd9\u4e9b\u98ce\u683c\u76f8\u540c\u7684CSS\u9009\u62e9\u5668\u3002 \u5e76\u96c6\u9009\u62e9\u5668\u5141\u8bb8\u540c\u65f6\u7ed9\u591a\u4e2a\u9009\u62e9\u5668\u5e94\u7528\u540c\u4e00\u79cd\u6837\u5f0f\u3002 \u8bed\u6cd5\uff1a \u9009\u62e9\u5668,\u9009\u62e9\u5668...{\u5c5e\u6027: \u503c;} \u6ce8\u610f 1. \u9009\u62e9\u5668\u4e0e\u9009\u62e9\u5668\u4e4b\u95f4\u662f\u6709\u9017\u53f7\u9694\u5f00 2. \u9009\u62e9\u5668\u6807\u7b7e\u4e4b\u95f4\u7684\u7ed3\u6784\u53ef\u4ee5\u662f\u4efb\u4f55\u4e00\u79cd\u5173\u7cfb div,p,span { color: blue; } <div class=\"one\">123</div> <p class=\"one\">456</p> <span>adsdsd</span> 3.9.4 \u5b50\u4ee3\u9009\u62e9\u5668 \u00b6 \u4e0e\u540e\u4ee3\u9009\u62e9\u5668\u76f8\u6bd4\uff0c\u5b50\u5143\u7d20\u9009\u62e9\u5668\uff08Child selectors\uff09\u53ea\u80fd\u9009\u62e9\u4f5c\u4e3a\u67d0\u5143\u7d20\u5b50\u5143\u7d20\u7684\u5143\u7d20,\u5982\u679c\u60a8\u4e0d\u5e0c\u671b\u9009\u62e9\u4efb\u610f\u7684\u540e\u4ee3\u5143\u7d20\uff0c\u800c\u662f\u5e0c\u671b\u7f29\u5c0f\u8303\u56f4\uff0c\u53ea\u9009\u62e9\u67d0\u4e2a\u5143\u7d20\u7684\u5b50\u5143\u7d20\uff0c\u8bf7\u4f7f\u7528\u5b50\u5143\u7d20\u9009\u62e9\u5668\uff08Child selector\uff09\u3002 \u8bed\u6cd5\uff1a \u9009\u62e9\u5668>\u9009\u62e9\u5668{\u5c5e\u6027: \u503c;} ---->\u5b50\u4ee3\u5c31\u662f\u513f\u5b50\u5173\u7cfb\uff08\u4e0b\u4e00\u4ee3\uff09 \u6ce8\u610f 1. \u5b50\u4ee3\u9009\u62e9\u5668\u4e4b\u95f4\u5fc5\u987b\u662f\u5d4c\u5957\u7ed3\u6784 2. \u5b50\u4ee3\u9009\u62e9\u5668\u53ea\u80fd\u9009\u62e9\u76f4\u63a5\u540e\u4ee3\u5143\u7d20 , \u4e5f\u5c31\u662f\u513f\u5b50\u90a3\u4e00\u4ee3\uff0c 3. \u540e\u4ee3\u9009\u62e9\u5668\u53ef\u4ee5\u9009\u4e2d\u6240\u6709\u540e\u4ee3\u5143\u7d20 .one>span{ color: red; } <div class=\"one\"> <span>\u76f4\u63a5\u540e\u4ee3\u540e\u8005\u76f4\u63a5\u5b50\u4ee3</span> <p> <span>\u540e\u4ee3\u5143\u7d20</span> </p> </div> \u663e\u793a\u6548\u679c\u5982\u4e0b 3.9.5 \u5c5e\u6027\u9009\u62e9\u5668 \u00b6 \u53ef\u4ee5\u4e3a\u62e5\u6709\u6307\u5b9a\u5c5e\u6027\u7684 HTML \u5143\u7d20\u8bbe\u7f6e\u6837\u5f0f\uff0c\u800c\u4e0d\u4ec5\u9650\u4e8e class \u548c id \u5c5e\u6027\u3002 \u8bed\u6cd5\uff1a [\u5c5e\u6027\u540d]{\u5c5e\u6027: \u503c; \u628a\u5177\u6709id\u5c5e\u6027\u548cclass\u5c5e\u6027\u7684\u6807\u7b7e\u9009\u4e2d [id][class] { color: blue; } <div class=\"one\">123</div> <div class=\"one\" id=\"two\">456</div> <div class=\"one\" name=\"username\">789</div> \u663e\u793a\u6548\u679c\u5982\u4e0b \u5c5e\u6027\u9009\u62e9\u5668\u5176\u4ed6\u9009\u62e9\u65b9\u5f0f 3.9.5.1 \u5c5e\u6027\u9009\u62e9\u5668 = \u00b6 1. [\u5c5e\u6027=\u503c]{ } /*\u5c5e\u6027\u8d4b\u503c*/ [class=\"two\"]{ color: crimson; } \u9009\u62e9\u6709class\u5c5e\u6027\u5668\u5c5e\u6027\u503c\u4e3atwo\u7684\u6807\u7b7e 3.9.5.2 \u5c5e\u6027\u9009\u62e9\u5668 ^= \u00b6 2. [\u5c5e\u6027^=\u503c] [class^=\"two\"] { color: darkblue; } \u9009\u62e9\u6709calss\u5c5e\u6027\u4e14\u4ee5two\u5f00\u5934\u7684\u6807\u7b7e 3.9.5.3 \u5c5e\u6027\u9009\u62e9\u5668 $= \u00b6 [class$=\"two\"] { color: darkblue; } \u9009\u62e9\u6709calss\u5c5e\u6027\u4e14\u4ee5two\u7ed3\u675f\u7684\u6807\u7b7e 3.9.5.4 \u5c5e\u6027\u9009\u62e9\u5668 *= \u00b6 [class*=\"two\"] { color: darkblue; } \u9009\u62e9\u6709class\u5c5e\u6027\u4e14\u53ea\u8981\u6807\u7b7e\u4e2d\u5305\u542btwo\u5c31\u884c 3.10 \u4f2a\u7c7b\u9009\u62e9\u5668 \u00b6 \u7ed3\u6784\u4f2a\u7c7b\u662fCSS3\u65b0\u589e\u7684\u7c7b\u578b\u9009\u62e9\u5668\uff0c\u5229\u7528DOM\u6811\u5b9e\u73b0\u5143\u7d20\u8fc7\u6ee4\uff0c\u901a\u8fc7\u6587\u6863\u7ed3\u6784\u7684\u76f8\u4e92\u5173\u7cfb\u6765\u5339\u914d\u5143\u7d20\uff0c\u53ef\u4ee5\u51cf\u5c11class\u548cid\u5c5e\u6027\u7684\u5b9a\u4e49\uff0c\u4f7f\u6587\u6863\u53d8\u5f97\u66f4\u52a0\u7b80\u6d01 3.10.1 root \u00b6 \u9009\u62e9\u5143\u7d20\u6240\u5728\u6587\u6863\u7684\u6839\u5143\u7d20\u3002\u5728(X)HTML\u6587\u6863\u4e2d\uff0c\u6839\u5143\u7d20\u59cb\u7ec8\u662fhtml\u5143\u7d20\u3002 3.10.2 not \u00b6 \u5426\u5b9a\u9009\u62e9\u5668\uff0c\u548cjQuery\u4e2d\u7684:not\u9009\u62e9\u5668\u4e00\u6a21\u4e00\u6837\uff0c\u53ef\u4ee5\u9009\u62e9\u9664\u67d0\u4e2a\u5143\u7d20\u4e4b\u5916\u7684\u6240\u6709\u5143\u7d20\u3002 <body> <div id=\"header\">\u9875\u5934</div> <div id=\"page\">\u9875\u4f53</div> <div id=\"footer\">\u9875\u811a</div> </body> div{ padding: 10px 20px; min-height: 50px; } div:not([id=\"footer\"]){ background: pink; } 3.10.3 empty \u00b6 \u7528\u6765\u9009\u62e9\u6ca1\u6709\u4efb\u4f55\u5185\u5bb9\u7684\u5143\u7d20\uff0c\u8fd9\u91cc\u6ca1\u6709\u5185\u5bb9\u6307\u7684\u662f\u4e00\u70b9\u5185\u5bb9\u90fd\u6ca1\u6709\uff0c\u54ea\u6015\u662f\u4e00\u4e2a\u7a7a\u683c\u90fd\u4e0d\u884c <body> <div>\u6211\u8fd9\u91cc\u6709\u5185\u5bb9</div> <div> </div><!-- \u6211\u8fd9\u91cc\u6709\u4e00\u4e2a\u7a7a\u683c --> <div></div><!-- \u6211\u8fd9\u91cc\u4efb\u4f55\u5185\u5bb9\u90fd\u6ca1\u6709 --> </body> div { min-height: 30px; } div:empty { background-color: green; } 3.10.4 first-child \u00b6 \u9009\u62e9F\u7684\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20(\u6240\u6709\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20\u90fd\u4f1a\u88ab\u9009\u62e9) ,\u8fd9\u91cc\u4f5c\u4e3aF(selector1)\u7684\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20\u7684\u6709 span\u3001div\u91cc\u7684p\u3001ul\u7684\u7b2c\u4e00\u4e2ali <body> <div id=\"selector1\"> <span>\u6211\u662f\u7b2c\u4e00\u4e2aspan</span> <p>\u6211\u662f\u7b2c\u4e00\u4e2ap\uff0c\u5728span\u540e\u9762</p> <div><p>\u7b2c\u4e8c\u4e2ap</p></div> <p>\u7b2c\u4e09\u4e2ap</p> <p>\u7b2c\u56db\u4e2ap</p> <em>I am em</em> <p>iewnvk</p> <ul> <li>1</li> <li>2</li> <li>3</li> <li>4</li> <li>5</li> </ul> </div> </body> #selector1 :first-child{ color: pink; } first-child\u7684\u5192\u53f7\u8981\u4e0e\u524d\u9762\u7684\u5143\u7d20\u6709\u4e00\u4e2a\u7a7a\u683c\u7684\u8ddd\u79bb\uff0c\u5426\u5219\u5b83\u4f1a\u628a\u7236\u5143\u7d20\u91cc\u6240\u6709\u7684\u5b50\u5143\u7d20\u90fd\u9009\u4e0a 3.10.5 last-child \u00b6 \u9009\u62e9\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20 \u5404\u79cd\u53d8\u5316\u548c:first-child\u4e00\u6837\uff0c\u4e0d\u518d\u4e3e\u4f8b\u3002 3.10.6 nth-child(n) \u00b6 \u7528\u6765\u5b9a\u4f4d\u67d0\u7236\u5143\u7d20\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u7279\u5b9a\u7684\u5b50\u5143\u7d20\u3002\u5176\u4e2d\u201cn\u201d\u662f\u53c2\u6570\uff0c\u53ef\u4ee5\u662f\u6574\u6570\u503c(1,2,3,4)\uff0c\u4e5f\u53ef\u4ee5\u662f\u8868\u8fbe\u5f0f(2n+1\u3001-n+5)\u548c\u5173\u952e\u8bcd(odd\u3001even)\uff0c\u53c2\u6570n\u7684\u8d77\u59cb\u503c\u59cb\u7ec8\u662f1\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u53c2\u6570n\u7684\u503c\u4e3a0\u65f6\uff0c\u9009\u62e9\u5668\u5c06\u9009\u62e9\u4e0d\u5230\u4efb\u4f55\u5339\u914d\u7684\u5143\u7d20\u3002 tr:nth-child(2n+1):\u5339\u914d\u5947\u6570\u884c\u7684tr tr:nth-child(2n):\u5339\u914d\u5076\u6570\u884c\u7684tr tr:nth-child(odd):\u5339\u914d\u5947\u6570\u884c\u7684tr tr:nth-child(even):\u5339\u914d\u5076\u6570\u884c\u7684tr tr:nth-child(4):\u5339\u914d\u7b2c\u56db\u884c\u7684tr <body> <ol> <li>item1</li> <li>item2</li> <li>item3</li> <li>item4</li> <li>item5</li> <li>item6</li> <li>item7</li> <li>item8</li> <li>item9</li> <li>item10</li> </ol> </body> ol > li:nth-child(2n-1){ background: pink; } 3.10.7 nth-child(n) \u00b6 \u9009\u62e9\u5728\u5176\u7236\u5143\u7d20\u4e2d\u5012\u6570\u7b2cn\u4e2a\u4f4d\u7f6e\u7684\u5143\u7d20\u6216\u7279\u5b9a\u67d0\u5143\u7d20\u3002 \u8ba1\u7b97\u987a\u5e8f\u4e0e:nth-child\u4e0d\u540c\uff0c\u5176\u4f59\u7528\u6cd5\u76f8\u540c\uff0c\u4e0d\u518d\u4e3e\u4f8b\u3002 3.10.8 first-of-type \u00b6 \u9009\u62e9\u5668\u7c7b\u4f3c\u4e8e\u201c:first-child\u201d\u9009\u62e9\u5668\uff0c\u4e0d\u540c\u4e4b\u5904\u5c31\u662f\u6307\u5b9a\u4e86\u5143\u7d20\u7684\u7c7b\u578b,\u5176\u4e3b\u8981\u7528\u6765\u5b9a\u4f4d\u4e00\u4e2a\u7236\u5143\u7d20\u4e0b\u7684\u67d0\u4e2a\u7c7b\u578b\u7684\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20\u3002 \u5728E:first-of-type\u529f\u80fd\u7c7b\u4f3c\u4e8eE:nth-of-type(1) <body> <div class=\"wrapper\"> <p>\u6211\u662f\u7b2c\u4e00\u4e2a\u6bb5\u843d</p> <p>\u6211\u662f\u7b2c\u4e8c\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u7b2c\u4e00\u4e2aDiv\u5143\u7d20</div> <div>\u6211\u662f\u7b2c\u4e8c\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u7b2c\u4e09\u4e2a\u6bb5\u843d</p> <p>\u6211\u662f\u7b2c\u56db\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u7b2c\u4e09\u4e2aDiv\u5143\u7d20</div> <div>\u6211\u662f\u7b2c\u56db\u4e2aDiv\u5143\u7d20</div> </div> </body> .wrapper > p, .wrapper > div { margin: 10px 0; background:#89c3eb; color: #fff; padding: 5px; } .wrapper > div:first-of-type { background: #928178; } 3.10.9 last-of-type \u00b6 \u9009\u62e9\u5668\u548c\u201c:first-of-type\u201d\u9009\u62e9\u5668\u529f\u80fd\u662f\u4e00\u6837\u7684\uff0c\u4e0d\u540c\u7684\u662f\u4ed6\u9009\u62e9\u662f\u7236\u5143\u7d20\u4e0b\u7684\u67d0\u4e2a\u7c7b\u578b\u7684\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\u3002\u4e0d\u518d\u4e3e\u4f8b 3.10.10 nth-of-type(n) \u00b6 \u9009\u62e9\u5668\u548c\u201c:nth-child(n)\u201d\u9009\u62e9\u5668\u975e\u5e38\u7c7b\u4f3c\uff0c\u4e0d\u540c\u7684\u662f\u5b83\u53ea\u8ba1\u7b97\u7236\u5143\u7d20\u4e2d\u6307\u5b9a\u7684\u67d0\u79cd\u7c7b\u578b\u7684\u5b50\u5143\u7d20[\u5373E:nth-of-type(n)]\u3002\u5f53\u67d0\u4e2a\u5143\u7d20\u4e2d\u7684\u5b50\u5143\u7d20\u4e0d\u5355\u662f\u540c\u4e00\u79cd\u7c7b\u578b\u7684\u5b50\u5143\u7d20\u65f6\uff0c\u4f7f\u7528\u201c:nth-of-type(n)\u201d\u9009\u62e9\u5668\u6765\u5b9a\u4f4d\u4e8e\u7236\u5143\u7d20\u4e2d\u67d0\u79cd\u7c7b\u578b\u7684\u5b50\u5143\u7d20\u662f\u975e\u5e38\u65b9\u4fbf\u548c\u6709\u7528\u7684\u3002\u5728\u201c:nth-of-type(n)\u201d\u9009\u62e9\u5668\u4e2d\u7684\u201cn\u201d\u548c\u201c:nth-child(n)\u201d\u9009\u62e9\u5668\u4e2d\u7684\u201cn\u201d\u53c2\u6570\u4e5f\u4e00\u6837\uff0c\u53ef\u4ee5\u662f\u5177\u4f53\u7684\u6574\u6570\uff0c\u4e5f\u53ef\u4ee5\u662f\u8868\u8fbe\u5f0f\uff0c\u8fd8\u53ef\u4ee5\u662f\u5173\u952e\u8bcd\u3002 <body> <div class=\"wrapper\"> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d\u5143\u7d20</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> </div> </body> .wrapper > div:nth-of-type(odd), .wrapper > p:nth-of-type(even){ background: #59b9c6; } 3.10.11 nth-last-of-type(n) \u00b6 \u9009\u62e9\u5668\u548c\u201c:nth-of-type(n)\u201d\u9009\u62e9\u5668\u662f\u4e00\u6837\u7684\uff0c\u9009\u62e9\u7236\u5143\u7d20\u4e2d\u6307\u5b9a\u7684\u67d0\u79cd\u5b50\u5143\u7d20\u7c7b\u578b\uff0c\u4f46\u5b83\u7684\u8d77\u59cb\u65b9\u5411\u662f\u4ece\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\u5f00\u59cb\uff0c\u800c\u4e14\u5b83\u7684\u4f7f\u7528\u65b9\u6cd5\u4e0e\u201c:nth-last-child(n)\u201d\u9009\u62e9\u5668\u4e00\u6837\uff0c\u4e0d\u518d\u4e3e\u4f8b\u3002 3.10.12 only-child \u00b6 \u5339\u914d\u7684\u5143\u7d20\u7684\u7236\u5143\u7d20\u4e2d\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u5b50\u5143\u7d20\u3002\u3010E:only-child\u3011 <body> <ul> <li>Item1</li> <li>Item2</li> <li>Item3</li> </ul> <ul> <li>Item1</li> </ul> <ol> <li>Item1</li> </ol> <ol> <li>Item1</li> <li>Item2</li> <li>Item3</li> </ol> </body> li { background: #84b9cb; padding: 10px; margin-bottom: 5px; } li:only-child { background: #a99e93; } 3.10.13 only-of-type \u00b6 \u9009\u62e9\u5176\u7236\u5143\u7d20\u53ea\u5305\u542b\u4e00\u4e2a\u540c\u7c7b\u578b\u7684\u5b50\u5143\u7d20 \u3010\u8868\u793a\u4e00\u4e2a\u5143\u7d20\u6709\u5f88\u591a\u4e2a\u5b50\u5143\u7d20\uff0c\u800c\u5176\u4e2d\u53ea\u6709\u4e00\u79cd\u7c7b\u578b\u7684\u5b50\u5143\u7d20\u662f\u552f\u4e00\u7684\uff0c\u4f7f\u7528\u201c:only-of-type\u201d\u9009\u62e9\u5668\u5c31\u53ef\u4ee5\u9009\u4e2d\u8fd9\u4e2a\u5143\u7d20\u4e2d\u7684\u552f\u4e00\u4e00\u4e2a\u7c7b\u578b\u5b50\u5143\u7d20\u3002\u3011 <body> <div class=\"wrapper\"> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> </div> <div class=\"wrapper\"> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> </div> <div class=\"wrapper\"> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> </div> </body> .wrapper { border: 1px solid #ccc; padding: 10px; width: 500px; margin: 10px auto; } .wrapper p:only-of-type{ background: #84b9cb; } 3.10.14 link_visited \u00b6 :link\u8868\u793a\u672a\u8bbf\u95ee\u7684\u8d85\u94fe\u63a5\uff0cvisite\u8868\u793a\u5df2\u8bbf\u95ee\u7684\u3002 <body> <a href=\"#\">\u6211\u672a\u8bbf\u95ee</a> <a href=\"##\">\u6211\u5df2\u8bbf\u95ee</a> </body> a:link{ color: pink; font-size: 20px; } a:visited{ color: #7b8d42; font-size: 20px; } 3.10.15 hover \u00b6 \u9f20\u6807\u79fb\u52a8\u5230\u94fe\u63a5\uff0c\u4e0d\u4ec5\u9650\u4e8e\u94fe\u63a5\uff0c\u53ef\u7528\u4e8e\u9875\u9762\u4e2d\u7684\u4efb\u4f55\u5143\u7d20\uff08IE6\u4e2d\u4ec5\u53ef\u7528\u4e8e\u94fe\u63a5\uff09 <body> <input type=\"text\" /> </body> input:hover{ height: 100px; background-color: #c099a0; } \u9f20\u6807\u672a\u653e\u4e0a\u53bb\u6548\u679c \u9f20\u6807\u653e\u4e0a\u53bb\u6548\u679c 3.10.16 active \u00b6 \u88ab\u6fc0\u6d3b\u65f6\u7684\u72b6\u6001\uff0c\u4e0d\u4ec5\u9650\u4e8e\u94fe\u63a5\uff0c\u53ef\u7528\u4e8e\u4efb\u4f55\u5177\u6709tabindex\u5c5e\u6027\u7684\u5143\u7d20\uff0c \u5bf9a\u6807\u7b7e\u6765\u8bf4\u5c31\u662f\u9f20\u6807\u6309\u4e0b\u53bb\u7684\u65f6\u5019 \u5728CSS\u4e2d\uff0ca:hover\u5fc5\u987b\u7f6e\u4e8ea:link\u548ca:visited\u540e\u624d\u751f\u6548\uff0ca:active\u5fc5\u987b\u7f6e\u4e8ea:hover\u540e\u624d\u751f\u6548\u3002 <body> <a href=\"#\">\u6211\u662f\u94fe\u63a5</a> </body> a:active {color:yellow;} 3.10.17 focus \u00b6 \u7528\u4e8e\u8bbe\u7f6e\u83b7\u53d6\u7126\u70b9\u65f6\u7684\u6837\u5f0f\uff0c\u4e0d\u4ec5\u9650\u4e8e\u94fe\u63a5 <body> <input type=\"text\" /> </body> input:focus{ background-color: #93ca76; } \u672a\u83b7\u53d6\u7126\u70b9\u65f6\uff1a \u83b7\u53d6\u7126\u70b9\u540e\uff1a 3.10.18 enabled/disabled \u00b6 \u5728Web\u7684\u8868\u5355\u4e2d\uff0c\u6709\u4e9b\u8868\u5355\u5143\u7d20\u6709\u53ef\u7528\uff08\u201c:enabled\u201d\uff09\u548c\u4e0d\u53ef\u7528\uff08\u201c:disabled\u201d\uff09\u72b6\u6001\uff0c\u6bd4\u5982\u8f93\u5165\u6846\uff0c\u5bc6\u7801\u6846\uff0c\u590d\u9009\u6846\u7b49\u3002\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e4b\u4e0b\uff0c\u8fd9\u4e9b\u8868\u5355\u5143\u7d20\u90fd\u5904\u5728\u53ef\u7528\u72b6\u6001\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4f2a\u9009\u62e9\u5668\u201c:enabled\u201d\u5bf9\u8fd9\u4e9b\u8868\u5355\u5143\u7d20\u8bbe\u7f6e\u6837\u5f0f\u3002 <body> <form action=\"#\"> <div> <label for=\"enabled\">\u53ef\u7528\u8f93\u5165\u6846:</label> <input type=\"text\" id=\"enabled\" /> </div> <div> <label for=\"disabled\">\u7981\u7528\u8f93\u5165\u6846:</label> <input type=\"text\" id=\"disabled\" disabled=\"disabled\" /> </div> </form> </body> div { margin: 30px; } input[type=\"text\"]:enabled{ border:3px solid #8491c3; box-shadow: 0 0 5px #8491c3; } input[type=\"text\"]:disabled{ box-shadow: none; } 3.10.19 checked \u00b6 \u5728\u8868\u5355\u5143\u7d20\u4e2d\uff0c\u5355\u9009\u6309\u94ae\u548c\u590d\u9009\u6309\u94ae\u90fd\u5177\u6709\u9009\u4e2d\u548c\u672a\u9009\u4e2d\u72b6\u6001\u3002\u5728CSS3\u4e2d\u53ef\u4ee5\u901a\u8fc7\u72b6\u6001\u9009\u62e9\u5668\u201c:checked\u201d\u914d\u5408\u5176\u4ed6\u6807\u7b7e\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6837\u5f0f\u3002\u800c\u201c:checked\u201d\u8868\u793a\u7684\u662f\u9009\u4e2d\u72b6\u6001\u3002 <form action=\"#\"> <div class=\"wrapper\"> <div class=\"box\"> <input type=\"radio\" checked=\"checked\" id=\"boy\" name=\"1\" /><span></span> </div> <label for=\"boy\">\u7537</label> </div> <div class=\"wrapper\"> <div class=\"box\"> <input type=\"radio\" id=\"girl\" name=\"1\" /><span></span> </div> <label for=\"girl\">\u5973</label> </div> </form> form { border: 1px solid #ccc; padding: 20px; width: 300px; margin: 30px auto; } .wrapper { margin-bottom: 10px; } .box { display: inline-block; width: 30px; height: 30px; margin-right: 10px; position: relative; background: orange; vertical-align: middle; border-radius: 100%; } .box input { opacity: 0; position: absolute; top:0; left:0; width: 100%; height:100%; z-index:100;/*\u4f7finput\u6309\u94ae\u5728span\u7684\u4e0a\u4e00\u5c42\uff0c\u4e0d\u52a0\u70b9\u51fb\u533a\u57df\u4f1a\u51fa\u73b0\u4e0d\u7075\u654f*/ } .box span { display: block; width: 10px; height: 10px; border-radius: 100%; position: absolute; background: #fff; top: 50%; left:50%; margin: -5px 0 0 -5px; z-index:1; } input[type=\"radio\"] + span { opacity: 0; } input[type=\"radio\"]:checked + span { opacity: 1; } 3.10.20 read-only \u00b6 \u7528\u6765\u6307\u5b9a\u5904\u4e8e\u53ea\u8bfb\u72b6\u6001\u5143\u7d20\u7684\u6837\u5f0f\u3002 <form action=\"#\"> <div> <label for=\"name\">\u59d3\u540d:</label> <input type=\"text\" name=\"name\" id=\"name\" placeholder=\"\u5927\u6f20\" /> </div> <div> <label for=\"address\">\u5730\u5740:</label> <input type=\"text\" name=\"address\" id=\"address\" placeholder=\"\u4e2d\u56fd\u4e0a\u6d77\" readonly=\"readonly\" /> </div> <div> <label for=\"comment\">\u8bc4\u8bba\uff1a</label> <textarea name=\"comment\" id=\"\" cols=\"30\" rows=\"10\" readonly=\"readonly\"></textarea> </div> </form> form { width: 300px; padding: 10px; border: 1px solid #ccc; margin: 50px auto; } form > div { margin-bottom: 10px; } input[type=\"text\"]{ border: 1px solid orange; padding: 5px; background: #fff; border-radius: 5px; } input[type=\"text\"]:-moz-read-only{ border-color: #ccc; } input[type=\"text\"]:read-only{ border-color: #ccc; } textarea:-moz-read-only{ border: 1px solid #ccc; height: 50px; resize: none; background: #eee; } textarea:read-only { border: 1px solid #ccc; height: 50px; resize: none; background: #eee; } 3.10.21 read-write \u00b6 \u7528\u6765\u6307\u5b9a\u5f53\u5143\u7d20\u5904\u4e8e\u975e\u53ea\u8bfb\u72b6\u6001\u65f6\u7684\u6837\u5f0f\u3002 <form action=\"#\"> <div> <label for=\"name\">\u59d3\u540d:</label> <input type=\"text\" name=\"name\" id=\"name\" placeholder=\"\u5927\u6f20\" /> </div> <div> <label for=\"address\">\u5730\u5740:</label> <input type=\"text\" name=\"address\" id=\"address\" placeholder=\"\u4e2d\u56fd\u4e0a\u6d77\" readonly=\"readonly\" /> </div> </form> form { width: 300px; padding: 10px; border: 1px solid #ccc; margin: 50px auto; } form > div { margin-bottom: 10px; } input[type=\"text\"]{ border: 1px solid orange; padding: 5px; background: #fff; border-radius: 5px; } input[type=\"text\"]:-moz-read-only{ border-color: #ccc; } input[type=\"text\"]:read-only{ border-color: #ccc; } input[type=\"text\"]:-moz-read-write{ border:2px solid red; } 4. CSS \u5176\u4ed6 \u00b6 4.1 \u5143\u7d20\u663e\u793a\u65b9\u5f0f \u00b6 \u5757\u7ea7\u5143\u7d20\uff0c\u884c\u5185\u5143\u7d20\uff0c\u884c\u5185\u5757\u5143\u7d20 4.1.1 \u5757\u7ea7\u5143\u7d20 \u00b6 \u4ee3\u8868\uff1a div,p,ul,ol,dl,li,dd,dt,h1...h6... \u7279\u70b9: 1. \u5757\u7ea7\u5143\u7d20\u8981\u72ec\u5360\u4e00\u884c\u663e\u793a 2. \u5757\u7ea7\u5143\u7d20\u9ed8\u8ba4\u5bbd\u5ea6\u4e0e\u7236\u5143\u7d20\u7684\u5bbd\u5ea6\u4e00\u81f4 3. \u5757\u7ea7\u5143\u7d20\u53ef\u4ee5\u8bbe\u7f6e\u5bbd\u5ea6\u548c\u9ad8\u5ea6 4.1.2 \u884c\u5185\u5143\u7d20 \u00b6 \u4ee3\u8868\uff1a span,a,font,strong,i,s.... \u7279\u70b9\uff1a 1. \u884c\u5185\u5143\u7d20\u53ef\u4ee5\u5728\u4e00\u884c\u4e0a\u663e\u793a 2. \u884c\u5185\u5143\u7d20\u4e0d\u80fd\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 3. \u8bbe\u7f6e\u5bbd\u5ea6width \u65e0\u6548\u3002 4. \u8bbe\u7f6e\u9ad8\u5ea6height \u65e0\u6548\uff0c\u53ef\u4ee5\u901a\u8fc7line-height\u6765\u8bbe\u7f6e\u3002 5. \u8bbe\u7f6emargin \u53ea\u6709\u5de6\u53f3margin\u6709\u6548\uff0c\u4e0a\u4e0b\u65e0\u6548\u3002 6. \u8bbe\u7f6epadding \u53ea\u6709\u5de6\u53f3padding\u6709\u6548\uff0c\u4e0a\u4e0b\u5219\u65e0\u6548\u3002\u6ce8\u610f\u5143\u7d20\u8303\u56f4\u662f\u589e\u5927\u4e86\uff0c\u4f46\u662f\u5bf9\u5143\u7d20\u5468\u56f4\u7684\u5185\u5bb9\u662f\u6ca1\u5f71\u54cd\u7684\u3002 4.1.3 \u884c\u5185\u5757\u5143\u7d20 \u00b6 \u4ee3\u8868\uff1a img,input..... \u7279\u70b9\uff1a 1. \u884c\u5185\u5143\u7d20\u53ef\u4ee5\u5728\u4e00\u884c\u4e0a\u663e\u793a 2. \u884c\u5185\u5143\u7d20\u53ef\u4ee5\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 4.2 \u5143\u7d20\u8f6c\u6362 \u00b6 4.2.1 \u8f6c\u5316\u4e3a\u5757\u7ea7\u5143\u7d20 \u00b6 \u8f6c\u5316\u4e3a\u5757\u7ea7\u5143\u7d20\uff08\u4ee5\u5757\u7ea7\u5143\u7d20\u7684\u65b9\u5f0f\u53bb\u663e\u793a\uff09,\u8bed\u6cd5\u5982\u4e0b\uff1a display\uff1ablock\uff1b \u4f8b\u5b50 a { width: 300px; #\u662f\u4e0d\u751f\u6548\u7684\uff0c\u56e0\u4e3aa\u662f\u884c\u5185\u5143\u7d20\uff0c\u4e0d\u80fd\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 height: 300px; #\u662f\u4e0d\u751f\u6548\u7684\uff0c\u56e0\u4e3aa\u662f\u884c\u5185\u5143\u7d20\uff0c\u4e0d\u80fd\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 background-color: red; } <a href=\"#\">\u884c\u5185\u5143\u7d20</a> \u6539\u4e4b\u540e a { width: 300px; height: 300px; background-color: red; /*\u8f6c\u5316\u4e3a\u5757\u5143\u7d20*/ display: block; #\u5c06\u884c\u5185\u5143\u7d20a\u8f6c\u4e3a\u5757\u7ea7\u5143\u7d20\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 } <a href=\"#\">\u884c\u5185\u5143\u7d20</a> <a href=\"#\">\u884c\u5185\u5143\u7d20</a> 4.2.2 \u8f6c\u5316\u4e3a\u884c\u5185\u5757\u5143\u7d20 \u00b6 \u8bed\u6cd5\uff1a display\uff1ainline-block\uff1b \u4f8b\u5b50 a { width: 300px; #\u662f\u4e0d\u751f\u6548\u7684\uff0c\u56e0\u4e3aa\u662f\u884c\u5185\u5143\u7d20\uff0c\u4e0d\u80fd\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 height: 300px; #\u662f\u4e0d\u751f\u6548\u7684\uff0c\u56e0\u4e3aa\u662f\u884c\u5185\u5143\u7d20\uff0c\u4e0d\u80fd\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 background-color: red; } <a href=\"#\">\u884c\u5185\u5143\u7d20</a> a { width: 300px; height: 300px; background-color: red; /*\u8f6c\u5316\u4e3a\u5757\u5143\u7d20*/ display: inline-block; #\u5c06\u884c\u5185\u5143\u7d20a\u8f6c\u4e3a\u884c\u5185\u5757\u7ea7\u5143\u7d20\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 } <a href=\"#\">\u884c\u5185\u5143\u7d20</a> <a href=\"#\">\u884c\u5185\u5143\u7d20</a> 4.2.3 \u8f6c\u5316\u4e3a\u884c\u5185\u5143\u7d20 \u00b6 \u8bed\u6cd5: display\uff1ainline\uff1b \u4f8b\u5b50 a{ width: 100px; height: 100px; background-color: red; /*\u8f6c\u5316\u4e3a\u5757\u5143\u7d20*/ /*display: block;*/ /*display: inline-block;*/ display: inline; } div{ background-color: red; display: inline; width: 100px; #\u90fd\u4e0d\u542f\u4f5c\u7528\u4e86\uff0c\u56e0\u4e3adiv\u88ab\u8f6c\u4e3a\u884c\u5185\u5143\u7d20\u4e86 height: 100px; #\u90fd\u4e0d\u542f\u4f5c\u7528\u4e86\uff0c\u56e0\u4e3adiv\u88ab\u8f6c\u4e3a\u884c\u5185\u5143\u7d20\u4e86 } <div>\u6211\u662f\u884c\u5185\u5143\u7d20</div> #\u539f\u672c\u8fd9\u4e2adiv\u662f\u8981\u72ec\u5360\u4e00\u884c\u7684\uff0c\u4f46\u662fdiv\u88ab\u4e0a\u9762css\u6539\u4e3a\u884c\u5185\u5143\u7d20\u4e86\uff0c\u6240\u4ee5\u548c\u5176\u4ed6\u884c\u5185\u5143\u7d20\u5728\u4e00\u884c\u663e\u793a <a href=\"#\">\u884c\u5185\u5143\u7d20</a> <a href=\"#\">\u884c\u5185\u5143\u7d20</a> \u6ce8\u610f 1. \u53ef\u4ee5\u628a\u884c\u5185\u5143\u7d20\uff0c\u5757\u5143\u7d20\u8f6c\u5316\u6210\u4efb\u4f55\u4e00\u76f4\u5143\u7d20 2. \u884c\u5185\u5757\u5143\u7d20\u8f6c\u5316\u6210\u884c\u5185\u5143\u7d20\u6ca1\u6709\u6548\u679c 3. \u4e00\u822c\u60c5\u51b5\u4e0b\u4f1a\u5c06\u884c\u5185\u5143\u7d20\u8f6c\u6362 4.2.4 \u884c\u5185/\u5757\u5143\u7d20\u533a\u522b \u00b6 \u5757\u7ea7\uff1a\u5757\u7ea7\u5143\u7d20\u4f1a\u72ec\u5360\u4e00\u884c\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5bbd\u5ea6\u81ea\u52a8\u586b\u6ee1\u5176\u7236\u5143\u7d20\u5bbd\u5ea6, \u884c\u5185\uff1a\u884c\u5185\u5143\u7d20\u4e0d\u4f1a\u72ec\u5360\u4e00\u884c\uff0c\u76f8\u90bb\u7684\u884c\u5185\u5143\u7d20\u4f1a\u6392\u5728\u540c\u4e00\u884c\u3002\u5176\u5bbd\u5ea6\u968f\u5185\u5bb9\u7684\u53d8\u5316\u800c\u53d8\u5316\u3002 \u5757\u7ea7\uff1a\u5757\u7ea7\u5143\u7d20\u53ef\u4ee5\u8bbe\u7f6e\u5bbd\u9ad8 \u884c\u5185\uff1a\u884c\u5185\u5143\u7d20\u4e0d\u53ef\u4ee5\u8bbe\u7f6e\u5bbd\u9ad8 \u5757\u7ea7\uff1a\u5757\u7ea7\u5143\u7d20\u53ef\u4ee5\u8bbe\u7f6emargin\uff0cpadding \u884c\u5185\uff1a\u884c\u5185\u5143\u7d20\u6c34\u5e73\u65b9\u5411\u7684margin-left; margin-right; padding-left; padding-right;\u53ef\u4ee5\u751f\u6548\u3002\u4f46\u662f\u7ad6\u76f4\u65b9\u5411\u7684margin-bottom; margin-top; padding-top; padding-bottom;\u5374\u4e0d\u80fd\u751f\u6548\u3002 \u5757\u7ea7\uff1adisplay:block; \u884c\u5185\uff1adisplay:inline;\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539display\u5c5e\u6027\u6765\u5207\u6362\u5757\u7ea7\u5143\u7d20\u548c\u884c\u5185\u5143\u7d20 4.3 CSS\u7279\u6027 \u00b6 4.3.1 \u5c42\u53e0\u6027 \u00b6 \u5728\u6743\u91cd\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u7528\u4e00\u4e2a\u6807\u7b7e\u4e2d\u6837\u5f0f\u53d1\u751f\u51b2\u7a81\uff0c\u540e\u9762\u7684\u6837\u5f0f\u4f1a\u5c06\u524d\u9762\u7684\u6837\u5f0f\u7ed9\u8986\u76d6\u6389\u3002\u6837\u5f0f\u4e0e\u5b9a\u4e49\u7684\u987a\u5e8f\u6709\u5173\uff0c\u4e0e\u8c03\u7528\u7684\u987a\u5e8f\u65e0\u5173 .one{ color: red; } .two{ color: blue; } <div class=\"one two\">\u6587\u5b57</div> \u53ea\u8ddfCSS\u4e2d\u8c03\u7528\u7684\u6837\u5f0f.one \u548c .two\u7684\u987a\u5e8f\u6709\u5173\u548cdiv\u7684class\u540e\u9762\u7684one\u548ctwo\u987a\u5e8f\u65e0\u5173\uff0c\u8c03\u8bd5\u7f51\u9875\u7684\u65f6\u5019\u53d1\u4e0b\u6837\u5f0f\u8868\u683c\u4e2d\u7684red\u6a21\u5f0f\u5df2\u7ecf\u88ab\u5220\u9664\u4e86\u3002 4.3.2 \u7ee7\u627f\u6027 \u00b6 \u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5b50\u5143\u7d20\u6ca1\u6709\u8bbe\u7f6e\u6837\u5f0f\uff0c\u90a3\u4e48\u5b50\u5143\u7d20\u4f1a\u7ee7\u627f\u7236\u5143\u7d20\u7684\u6837\u5f0f \u53ea\u80fd\u53d1\u751f\u5728\u6807\u7b7e\u5d4c\u5957\u7ed3\u6784\u4e2d \u5bbd\u5ea6\u548c\u9ad8\u5ea6\u4e0d\u80fd\u88ab\u7ee7\u627f\uff0c\u53ea\u662f\u5757\u5143\u7d20\u7279\u70b9\u3002 \u53ef\u7ee7\u627f\u7684\u5c5e\u6027 color \u4e0efont\u5c5e\u76f8\u76f8\u5173\u7684\u90fd\u53ef\u4ee5\u7ee7\u627f\u5982font-sizes line-height\u53ef\u4ee5\u88ab\u7ee7\u627f text-align\u53ef\u4ee5\u88ab\u7ee7\u627f 4.3.3 \u7ee7\u627f\u6027\u4e2d\u7279\u6b8a\u6807\u7b7e \u00b6 a\u6807\u7b7e\u4e0d\u80fd\u76f4\u63a5\u63a5\u53d7\u7236\u5143\u7d20\u4e2d\u7684\u6587\u5b57\u989c\u8272\u5f71\u54cd \u6807\u9898\u6807\u7b7e(h1~h6)\u4e0d\u80fd\u76f4\u63a5\u63a5\u53d7\u7236\u5143\u7d20\u4e2d\u7684\u6587\u5b57\u5927\u5c0f\u5f71\u54cd\uff0ch1\u53d8\u4e3a2em\uff082\u500d\u6587\u5b57\u5927\u5c0f\uff09 4.3.4 \u6743\u91cd \u00b6 1. \u4f18\u5148\u6743\uff08\u6743\u91cd\uff09 \u6807\u7b7e\u9009\u62e9\u5668< \u7c7b\u9009\u62e9\u5668< ID\u9009\u62e9\u5668<\u884c\u5185\u6837\u5f0f<!important \u6743\u91cd\u503c 10 100 1000 10000 10000+ 2. \u7ee7\u627f\u6743\u91cd\u4e3a0 \u6ca1\u6709\u81ea\u5df1\u6837\u5f0f\u5c31\u7ee7\u627f\uff0c\u6709\u81ea\u5df1\u6837\u5f0f\u5c31\u8986\u76d6 3. \u6743\u91cd\u53ef\u4ee5\u53e0\u52a0 div p{ color: red; } p{ color:blue; } \u6700\u7ec8\u4f1a\u662fred\uff0c\u56e0\u4e3adiv\u52a0p\u7684\u6743\u91cd\u5927\u4e8ep\u7684\u6743\u91cd\u3002 \u603b\u7ed3 1. \u901a\u8fc7\u9009\u62e9\u5668\u6307\u5411\u7684\u662f\u540c\u4e00\u4e2a\u6807\u7b7e\uff0c\u5982\u679c\u6743\u91cd\u4e0d\u4e00\u6837\uff0c\u90a3\u4e48\u53ea\u8981\u8003\u8651\u4f18\u5148\u7ea7\u3002 2. \u901a\u8fc7\u9009\u62e9\u5668\u6307\u5411\u7684\u662f\u540c\u4e00\u4e2a\u6807\u7b7e\uff0c\u5982\u679c\u6743\u91cd\u4e00\u6837\uff0c\u90a3\u4e48\u53ea\u8003\u8651\u5c42\u53e0\u6027\u3002 4.4 \u80cc\u666f \u00b6 4.4.1 \u80cc\u666f\u989c\u8272 \u00b6 background-color \u8bbe\u7f6e\u989c\u8272 \u9ed8\u8ba4\u503c\u662f\uff1atransparent \u900f\u660e\u8272 4.4.2 \u80cc\u666f\u56fe\u7247 \u00b6 background-image \u8bbe\u7f6e\u80cc\u666f\u56fe\u7247 1. none/url\uff08\u4f7f\u7528\u7edd\u5bf9\u6216\u8005\u76f8\u5bf9\u8def\u5f84\uff09 background-image: url(\"1.png\"); 4.4.3 \u80cc\u666f\u5e73\u94fa \u00b6 background-repeat \u8bbe\u7f6e\u80cc\u666f\u56fe\u7247\u5e73\u94fa 1. repeat \u9ed8\u8ba4\u503c 2. no-repeat \u4e0d\u5e73\u94fa 3. repeat-x \u6a2a\u5411\u5e73\u94fa 4. repeat-y \u7eb5\u5411\u5e73\u94fa 4.4.4 \u80cc\u666f\u5b9a\u4f4d \u00b6 background-position \u8bbe\u7f6e\u80cc\u666f\u56fe\u7247\u4f4d\u7f6e 1. length \u767e\u5206\u6bd4|\u6709\u6d6e\u70b9\u6570\u5b57\u548c\u5355\u4f4d\u6807\u8bc6\u7b26\u7ec4\u6210\u7684\u957f\u5ea6 2. position top|center|bottom|left|right background-position: right top; \u8bbe\u7f6e\u80cc\u666f\u56fe\u7247\u4e3a\u53f3\u4e0a\u89d2 \u6ce8\u610f 1. \u5f53\u80cc\u666f\u56fe\u7247\u8bbe\u7f6e\u4e00\u4e2a\u503c\u7684\u65f6\u5019\uff0c\u7b2c\u4e8c\u4e2a\u9ed8\u8ba4\u662f center \u3002 background - position : right \uff1b \u6b64\u65f6\u56fe\u7247\u5c31\u662f\u53f3\u4e2d\u663e\u793a 2. \u5f53\u80cc\u666f\u56fe\u7247\u4f4d\u7f6e\u51fa\u73b0\u5177\u4f53\u6570\u5b57\u7684\u65f6\u5019\uff0c\u7b2c\u4e00\u4e2a\u503c\u4ee3\u8868\u6c34\u5e73\u65b9\u5411\uff0c\u7b2c\u4e8c\u53ea\u4ee3\u8868\u5782\u76f4\u65b9\u5411\u3002 4.4.5 \u80cc\u666f\u56fe\u7247\u8fde\u5199 \u00b6 background: red url(\"logo.png\") no-repeat right top; \u6ce8\u610f\uff1a 1. \u8be5\u5c5e\u6027\u8054\u5199\u4e2d\u6ca1\u6709\u4e2a\u6570\u9650\u5236 2. \u8be5\u5c5e\u6027\u4e2d\u6ca1\u6709\u987a\u4fbf\u9650\u5236 4.5 \u884c\u9ad8 \u00b6 4.5.1 \u884c\u9ad8\u7279\u6027 \u00b6 \u884c\u9ad8\u5c5e\u4e8e\u6587\u5b57\u7684\u5c5e\u6027 \u884c\u9ad8=\u6587\u5b57\u5927\u5c0f+\u4e0a\u95f4\u8ddd+\u4e0b\u95f4\u8ddd\uff08\u9ed8\u8ba4\u884c\u9ad8\u662f18px,\u6587\u5b57\u5927\u5c0f\u662f16px\uff0c\u4e0a\u95f4\u8ddd\u548c\u4e0b\u95f4\u8ddd\u90fd\u662f1px\uff09 \u884c\u9ad8\u7684\u4f5c\u7528\uff1a \u8bbe\u7f6e\u6587\u5b57\u5782\u76f4\u65b9\u5411\u4e2d\u6709\u95f4\u8ddd \u6587\u5b57\u5782\u76f4\u5c45\u4e2d(\u8ba9\u884c\u9ad8=\u5bb9\u5668\u7684\u9ad8\u5ea6\u5c31\u53ef\u4ee5\u4e86) \u5f71\u54cd\u884c\u9ad8 \u6587\u5b57\u5927\u5c0f\u53ef\u4ee5\u6539\u53d8\u884c\u9ad8 \u6587\u5b57\u5b57\u4f53\u4e5f\u53ef\u4ee5\u6539\u53d8\u884c\u9ad8 4.5.2 \u884c\u9ad8\u5355\u4f4d \u00b6 \u5982\u4f55\u7ed9\u5355\u72ec\u4e00\u4e2a\u6807\u7b7e\u8bbe\u7f6e\u884c\u9ad8 px \uff1a\u884c\u9ad8\u503c\u5c31\u662f\u8bbe\u7f6e\u7684\u5927\u5c0f,\u4e0e\u6587\u5b57\u5927\u5c0f\u6ca1\u6709\u5173\u7cfb \u63a8\u8350\u4f7f\u7528 em \uff1a\u884c\u9ad8\u503c=\u8bbe\u7f6e\u7684\u884c\u9ad8*\u6587\u5b57\u5927\u5c0f \u767e\u5206\u6bd4 : \u884c\u9ad8\u503c=\u8bbe\u7f6e\u7684\u884c\u9ad8*\u6587\u5b57\u5927\u5c0f \u4e0d\u5e26\u5355\u4f4d : \u884c\u9ad8\u503c=\u8bbe\u7f6e\u7684\u884c\u9ad8*\u6587\u5b57\u5927\u5c0f \u5982\u679c\u7ed9\u7236\u5143\u7d20\u8bbe\u7f6e\u884c\u9ad8\uff0c\u5b50\u5143\u7d20\u884c\u9ad8\u7279\u70b9 \u7236px \uff1a\u5b50\u5143\u7d20\u7684\u884c\u9ad8=\u7236\u5143\u7d20\u7684\u884c\u9ad8 \u63a8\u8350\u4f7f\u7528 \u7236em \uff1a\u5b50\u5143\u7d20\u7684\u884c\u9ad8=\u7236\u5143\u7d20\u7684\u884c\u9ad8*\u7236\u5143\u7d20\u6587\u5b57\u5927\u5c0f\uff08\u5148\u8ba1\u7b97\u540e\u7ee7\u627f\uff09 \u7236\u767e\u5206\u6bd4 : \u5b50\u5143\u7d20\u7684\u884c\u9ad8=\u7236\u5143\u7d20\u7684\u884c\u9ad8*\u7236\u5143\u7d20\u6587\u5b57\u5927\u5c0f\uff08\u5148\u8ba1\u7b97\u540e\u7ee7\u627f\uff09 \u7236\u4e0d\u5e26\u5355\u4f4d : \u5b50\u5143\u7d20\u7684\u884c\u9ad8=\u7236\u5143\u7d20\u7684\u884c\u9ad8*\u5b50\u5143\u7d20\u6587\u5b57\u5927\u5c0f\uff08\u5148\u7ee7\u627f\u540e\u8ba1\u7b97\uff09 4.6 \u76d2\u5b50\u6a21\u578b \u00b6 4.6.1 \u4f5c\u7528 \u00b6 \u5b9e\u73b0\u7f51\u9875\u5e03\u5c40\uff08\u5728\u7f51\u9875\u91cc\u9762\u753b\u76d2\u5b50\uff09 4.6.2 \u7ec4\u6210 \u00b6 \u8fb9\u6846 border \u5185\u8fb9\u8ddd padding \u76d2\u5b50\u4e2d\u7684\u5185\u5bb9\u548c\u76d2\u5b50\u8fb9\u6846\u7684\u8ddd\u79bb \u5916\u8fb9\u754c margin \u76d2\u5b50\u4e0e\u76d2\u5b50\u4e4b\u95f4\u7684\u8ddd\u79bb 4.6.3 \u8fb9\u6846 \u00b6 4.6.3.1 \u8fb9\u6846\u57fa\u672c\u8bbe\u7f6e \u00b6 1. border-style: none; \u9ed8\u8ba4\u6ca1\u6709\u8fb9\u6846 a) solid \u5b9e\u7ebf b) dotted \u70b9\u7ebf c) dashed \u865a\u7ebf d) none \u6ca1\u6709\u8fb9\u6846 2. border-width: \u8fb9\u6846\u5bbd\u5ea6 3. border-color: \u8fb9\u6846\u989c\u8272 4. border\u5c5e\u6027\u8054\u5199\u4e2d a) \u5fc5\u987b\u8bbe\u7f6eborder-style b) \u6ca1\u6709\u4e66\u5e8f\u9650\u5236 5. \u5176\u4ed6\u5199\u6cd5 border-left: 2px dotted green; #\u5de6\u8fb9\u6846 border-right: 5px dashed yellow; #\u53f3\u8fb9\u6846 border-top: 3px dotted red; #\u4e0a\u8fb9\u6846 border-bottom:5px dashed darkcyan; #\u4e0b\u8fb9\u6846 border-left: 5px dashed pink; \u7b49\u4ef7\u4e8e border-left-color: pink; border-left-style: dashed; border-left-width: 5px; 4.6.3.2 \u53bb\u8fb9\u6846 \u00b6 border\uff1a0 none\uff1b #0 \u52a0\u4e0a\u4e3b\u8981\u662f\u517c\u5bb9\u6027\u9700\u8981 4.6.3.3 \u53bb\u8f6e\u5ed3 \u00b6 outline-style: none; \u5982input \u5bfc\u822a\u6761\u7ec3\u4e60\u4f8b\u5b50 .nav{ height: 50px; border-top: 1px solid red ; border-bottom: 1px solid pink ; background-color: #ddd; } .nav a{ text-decoration: none; heighte: 50px; display: inline-block; /*\u8bbe\u7f6e\u884c\u9ad8*/ line-height: 50px; } .nav a:hover{ background-color: #ccc; color: red; } <a href=\"#\">\u9996\u9875</a> <a href=\"#\">\u8bbe\u7f6e\u4e3a\u9996\u9875</a> Label for id \u901a\u8fc7label\u6765\u5f53\u7528\u6237\u70b9\u51fb\u6807\u7b7e\u540d\u4e5f\u53ef\u4ee5\u8f93\u5165 <label for=\"um\">\u7528\u6237\u540d: </label> <input type=\"text\" class=\"username\" id=\"um\"><br><br> 4.6.4 \u5185\u8fb9\u6846 \u00b6 \u5b9a\u4e49\uff1a\u5185\u5bb9\u4e0e\u8fb9\u6846\u4e4b\u95f4\u7684\u8ddd\u79bb \u6ce8\u610f\uff1apadding\u503c\u53ea\u80fd\u79fb\u52a8\u76d2\u5b50\u91cc\u9762\u5185\u5bb9\u3002 padding\u503c\u5c5e\u6027\u8054\u5199\uff1a 1. padding: 10px; \u8868\u793a\u4e0a\u53f3\u4e0b\u5de6\uff08\u987a\u65f6\u9488\uff09\u7684\u503c\u90fd\u662f10px 2. padding: 10px 20px; \u8868\u793a\u4e0a\u4e0b10px\uff0c\u5de6\u53f320px 3. padding: 10px 20px 30px; \u8868\u793a\u4e0a10px\uff0c\u53f320px\uff0c\u4e0b30px\uff0c\u5de620px 4. padding: 10px 20px 30px 40px; \u8868\u793a\u4e0a10px\uff0c\u53f320px\uff0c\u4e0b30px\uff0c\u5de640px \u76d2\u5b50\u95ee\u9898 \u76d2\u5b50\u5927\u5c0f\u95ee\u9898\uff1a 1. \u8fb9\u6846\u548c\u5185\u8fb9\u754c\u53ef\u4ee5\u6539\u53d8\u76d2\u5b50\u5927\u5c0f 2. \u76d2\u5b50\u5927\u5c0f\uff08\u5bbd\u5ea6\uff09 = \u5185\u5bb9\u5bbd\u5ea6 + \u5de6\u53f3\u5185\u8fb9\u8ddd + \u5de6\u53f3\u8fb9\u6846 \u5d4c\u5957\u76d2\u5b50 padding\u503c 1. \u7ee7\u627f\u7684\u76d2\u5b50\uff0c\u9ed8\u8ba4\u4e0d\u8bbe\u7f6e\u5bbd\u5ea6\u7684\u60c5\u51b5\u4e0b\uff0c\u7ed9\u5b50\u76d2\u5b50\u8bbe\u7f6e padding\u503c\u5728\u7236\u76d2\u5b50\u5bbd\u5ea6\u8303\u56f4\u5185\u4e0d\u4f1a\u5f71\u54cd\u5b50\u76d2\u5b50\u5927\u5c0f \uff0c 2. \u7ed9\u5b50\u76d2\u5b50\u8bbe\u7f6e padding\u503c\u5728\u7236\u76d2\u5b50\u5bbd\u5ea6\u8303\u56f4\u4e4b\u5916 \uff0c\u6b64\u65f6\u5b50\u76d2\u5b50\u5c31\u662f\u53d8\u5927\uff0c\u6b64\u65f6\u5df2\u7ecf\u6491\u51fa\u4e86\u5927\u76d2\u5b50\u3002 4.6.5 \u5916\u8fb9\u6846 \u00b6 \u5b9a\u4e49\uff1a \u76d2\u5b50\u4e0e\u76d2\u5b50\u4e4b\u95f4\u8ddd\u79bb\uff0c\u79fb\u52a8\u76d2\u5b50\u3002 padding\u5c5e\u6027\u8054\u5199\uff1a \u4e0e\u5185\u8fb9\u8ddd\uff08padding\uff09\u4e00\u6837\u3002 \u5916\u8fb9\u754c\u4e0d\u4f1a\u6539\u53d8\u76d2\u5b50\u5927\u5c0f \u7279\u70b9: \u5782\u76f4\u5916\u8fb9\u8ddd\u5408\u5e76\uff08\u4ee5\u6700\u5927\u5916\u8fb9\u8ddd\u503c\u4e3a\u51c6\uff09 \u5782\u76f4\u5916\u8fb9\u8ddd\u584c\u9677\u3002 \u5916\u8fb9\u6846\u584c\u9677\u89e3\u51b3\u65b9\u6cd5\uff1a - \u7ed9\u7236\u5143\u7d20\u8bbe\u7f6e\u8fb9\u6846 - \u7ed9\u7236\u5143\u7d20\u8bbe\u7f6eoverflow: hidden;(\u7531\u4e8eoverflow:hidden\u89e6\u53d1\u4e86\u5143\u7d20bfc\uff08\u683c\u5f0f\u5316\u4e0a\u4e0b\u6587\uff09) 4.6.6 \u9ed8\u8ba4\u6807\u7b7e\u5185\u5916\u8fb9\u8ddd \u00b6 body,p,h1,h2,h3,h4,h5,h6,ul,ol,dl,li,dd,dt,input{ margin: 0; padding: 0; } 4.7 \u6d6e\u52a8 \u00b6 4.7.1 \u6807\u51c6\u6d41 \u00b6 \u5b9a\u4e49\uff1a \u5728\u9875\u9762\u4e2d\u6807\u7b7e\uff08\u5143\u7d20\uff09\u9ed8\u8ba4\u7684\u663e\u793a\u65b9\u5f0f\u5c31\u662f\u6807\u51c6\u6d41\u7684\u663e\u793a\u65b9\u5f0f\u3002 4.7.2 \u6d6e\u52a8 \u00b6 \u7528\u6cd5: float: left|right; \u7279\u70b9: 1. \u6d6e\u52a8\u5143\u7d20\u4e0d\u5360\u4f4d\u7f6e\uff08\u8131\u6807\u4e86<\u8131\u79bb\u6807\u51c6\u6d41>\uff09 2. \u6d6e\u52a8\u53ef\u4ee5\u8ba9\u5757\u5143\u7d20\u5728\u4e00\u884c\u4e0a\u663e\u793a\uff08\u8131\u6807\uff09 3. \u53ef\u4ee5\u8fdb\u884c\u5143\u7d20\u7684\u6a21\u5f0f\u8f6c\u6362\uff08\u884c\u5185\uff09 \u4f5c\u7528 \u6d6e\u52a8\u7684\u51fa\u73b0\u6700\u521d\u662f\u89e3\u51b3\u56fe\u7247\u6587\u5b57\u73af\u7ed5\u6548\u679c\uff08\u5305\u88f9\u6027\uff09\u3002 2. \u8ba9\u5757\u7ea7\u5143\u7d20\u5728\u4e00\u884c\u4e0a\u663e\u793a\u5c31\u4f7f\u7528\u6d6e\u52a8\u65b9\u5f0f\u3002 1. \u5236\u4f5c\u5bfc\u822a 2. \u7f51\u9875\u5e03\u5c40 4.7.3 \u6e05\u9664\u6d6e\u52a8 \u00b6 4.7.3.1 clear \u00b6 \u6e05\u9664\u65b9\u5f0f\uff1a 1. \u4f7f\u7528clear\uff1aleft|right|both \uff08\u4e0d\u662f\u4e3b\u6d41\uff09 \u5728\u6d6e\u52a8\u6807\u7b7e\u540e\u9762\u6dfb\u52a0\u4e00\u4e2aclear 4.7.3.2 hidden \u00b6 \u7236\u5143\u7d20\u8bbe\u7f6eoverflow\uff1ahidden\uff1b overflow\uff1ahidden\uff1b\u8fd8\u53ef\u4ee5\u5c06\u8d85\u51fa\u7236\u5143\u7d20\u7684\u90e8\u5206\u8fdb\u884c\u9690\u85cf 4.7.3.3 \u4f2a\u5143\u7d20 \u00b6 \u4f7f\u7528\u4f2a\u5143\u7d20\u6e05\u9664\u6d6e\u52a8\uff08\u63a8\u8350\uff09 \u5355\u4f2a\u5143\u7d20\u6e05\u9664\u6d6e\u52a8 .clearfix:after { content: \" \"; height: 0; line-height: 0; display: block; clear: both; visibility: hidden; } .clearfix { /*\u517c\u5bb9IE*/ zomm: 1; } \u6216\u8005\uff08\u53cc\u4f2a\u5143\u7d20\uff09\u6e05\u9664\u6d6e\u52a8 .clearfix:before .clearfix:after { content: \" \"; height: 0; line-height: 0; display: block; clear: both; visibility: hidden; } .clearfix { /*\u517c\u5bb9IE*/ zomm: 1; } \u6e05\u9664\u6d6e\u52a8\u7684\u65f6\u673a 1. \u7236\u5bb9\u5668\u6ca1\u6709\u9ad8\u5ea6 2. \u7236\u5bb9\u5668\u4e2d\u6240\u6709\u5b50\u5143\u7d20\u90fd\u8bbe\u7f6e\u4e86\u6d6e\u52a8 \u4ee5\u4e0a\u4e24\u4e2a\u90fd\u6ee1\u8db3\u4e86\uff0c\u624d\u80fd\u8003\u8651\u662f\u5426\u6e05\u9664\u6d6e\u52a8 4.7.4 \u521d\u59cb\u5316 \u00b6 4.7.5 overflow\u4ecb\u7ecd \u00b6 overflow\uff1avisible; \u9ed8\u8ba4\u503c----- /*\u9ed8\u8ba4\u503c*/ overflow: hidden; \u8d85\u51fa\u90e8\u5206\u9690\u85cf------/*\u5c06\u8d85\u51fa\u90e8\u5206\u9690\u85cf*/ overflow: scroll; \u8bbe\u7f6e\u6eda\u52a8\u6761----/*\u8d85\u4e0d\u8d85\u51fa\u90fd\u4f1a\u6709\u6eda\u52a8\u6761\u3002\u8d85\u51fa\u4f1a\u80fd\u62d6\u52a8\u6eda\u52a8\u6761\uff0c\u4e0d\u8d85\u51fa\u7684\u4e0d\u80fd\u62d6\u52a8\u6eda\u52a8\u6761*/ overflow: auto; \u81ea\u52a8-----/*\u8d85\u51fa\u90e8\u5206\u81ea\u52a8\u51fa\u73b0\u6eda\u52a8\uff0c\u4e0d\u8d85\u51fa\u7684\u60c5\u51b5\u4e0d\u51fa\u73b0\u6eda\u52a8\u6761*/ 4.7.6 \u4f2a\u5143\u7d20 \u00b6 4.7.6.1 \u8bed\u6cd5 \u00b6 \u9009\u62e9\u5668:\u4f2a\u5143\u7d20{\u5c5e\u6027:\u503c;} 4.7.6.2 \u7528\u6cd5 \u00b6 1. first-line \u4f2a\u5143\u7d20 \"first-line\" \u4f2a\u5143\u7d20\u7528\u4e8e\u5411\u67d0\u4e2a\u9009\u62e9\u5668\u4e2d\u7684\u6587\u5b57\u7684\u9996\u884c\u6dfb\u52a0\u7279\u6b8a\u6837\u5f0f\uff1a p{ font-size: 12pt; } p:first-line{ color: #0000FF; font-variant: small-caps; } 2. :first-letter \u4f2a\u5143\u7d20 first-letter \u4f2a\u5143\u7d20\u7528\u4e8e\u5411\u67d0\u4e2a\u9009\u62e9\u5668\u4e2d\u7684\u6587\u672c\u7684\u9996\u5b57\u6bcd\u6dfb\u52a0\u7279\u6b8a\u7684\u6837\u5f0f\uff1a p{ font-size: 12pt; } p:first-letter{ font-size: 200%; float: left; } 3. :before \u4f2a\u5143\u7d20 before \u4f2a\u5143\u7d20\u53ef\u7528\u4e8e\u5728\u67d0\u4e2a\u5143\u7d20\u4e4b\u524d\u63d2\u5165\u67d0\u4e9b\u5185\u5bb9\u3002 \u4e0b\u9762\u7684\u6837\u5f0f\u4f1a\u5728\u6807\u9898\u4e4b\u524d\u64ad\u653e\u97f3\u9891\uff1a h1:before{ content:url(beep.wav); } 4. :after \u4f2a\u5143\u7d20 after \u4f2a\u7c7b\u53ef\u7528\u4e8e\u5728\u67d0\u4e2a\u5143\u7d20\u4e4b\u540e\u63d2\u5165\u67d0\u4e9b\u5185\u5bb9\u3002 \u4e0b\u9762\u7684\u6837\u5f0f\u4f1a\u5728\u6807\u9898\u4e4b\u540e\u64ad\u653e\u97f3\u9891\uff1a h1:after{ content: url(beep.wav); } \u4f8b\u5b50 <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> <style type=\"text/css\"> .box { width: 200px; height: 300px; border: 1px solid red; } div:before,div:after { \u5728div\u4e4b\u524d\u548c\u4e4b\u540e\u6709\u4f2a\u5143\u7d20\u51fa\u73b0 content: \"\u8fd9\u662f\u4e00\u4e2aspan\"; background-color: pink; width: 120px; height: 30px; display: block; } /*\u9009\u62e9\u533a\u57df*/ div::selection { background-color: red; \u5f53\u9009\u62e9\u65f6\u5019\uff0c\u6587\u5b57\u663e\u793a\u7ea2\u8272\uff0c\u677e\u5f00\u5c31\u663e\u793a\u539f\u6765\uff0c\u989c\u8272\u5b57\u4f53 } </style> </head> <body> <div class=\"box\"> \u8fd9\u4e2a\u662f\u6b63\u6587DIV <br> \u8fd9\u4e2a\u662f\u6b63\u6587DIV <br> \u8fd9\u4e2a\u662f\u6b63\u6587DIV <br> </div> </body> </html> \u5927\u90e8\u5206\u4f2a\u5143\u7d20\u672c\u6765\u662f::\u4e5f\u5c31\u662f\u4e24\u4e2a\u5192\u53f7\u7684\uff0c\u4f46\u662f\u5f88\u591a\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\uff0c\u6240\u4ee5\u4f7f\u7528\u4e86\uff1a\u4e5f\u5c31\u662f\u4e00\u4e2a\u5192\u53f7\uff0c \u4f46\u662f\u6709\u7684\u4f2a\u5143\u7d20\u5fc5\u987b\u4f7f\u7528\uff1a\uff1a\uff0c\u800c\u4f2a\u7c7b\u662f\u4f7f\u7528\uff1a\u4e5f\u5c31\u662f\u4e00\u4e2a\u5192\u53f7\u5982div:hover{.....} 4.8 \u5b9a\u4f4d \u00b6 4.8.1 \u5c5e\u6027 \u00b6 \u901a\u8fc7\u5b9a\u4f4d\u53ef\u4ee5\u79fb\u52a8\u5143\u7d20\u4f4d\u7f6e\uff0c\u901a\u8fc7\u4f7f\u7528 position \u5c5e\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9 4 \u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u5b9a\u4f4d\uff0c\u8fd9\u4f1a\u5f71\u54cd\u5143\u7d20\u6846\u751f\u6210\u7684\u65b9\u5f0f\u3002 position \u5c5e\u6027\u503c\u7684\u542b\u4e49\uff1a 1. static \u9759\u6001\u5b9a\u4f4d \u5143\u7d20\u6846\u6b63\u5e38\u751f\u6210\u3002\u5757\u7ea7\u5143\u7d20\u751f\u6210\u4e00\u4e2a\u77e9\u5f62\u6846\uff0c\u4f5c\u4e3a\u6587\u6863\u6d41\u7684\u4e00\u90e8\u5206\uff0c\u884c\u5185\u5143\u7d20\u5219\u4f1a\u521b\u5efa\u4e00\u4e2a\u6216\u591a\u4e2a\u884c\u6846\uff0c\u7f6e\u4e8e\u5176\u7236\u5143\u7d20\u4e2d\u3002 2. relative \u76f8\u5bf9\u5b9a\u4f4d \u5143\u7d20\u6846\u504f\u79fb\u67d0\u4e2a\u8ddd\u79bb\u3002\u5143\u7d20\u4ecd\u4fdd\u6301\u5176\u672a\u5b9a\u4f4d\u524d\u7684\u5f62\u72b6\uff0c\u5b83\u539f\u672c\u6240\u5360\u7684\u7a7a\u95f4\u4ecd\u4fdd\u7559\u3002 3. absolute \u7edd\u5bf9\u5b9a\u4f4d \u5143\u7d20\u6846\u4ece\u6587\u6863\u6d41\u5b8c\u5168\u5220\u9664\uff0c\u5e76\u76f8\u5bf9\u4e8e\u5176\u5305\u542b\u5757\u5b9a\u4f4d\u3002\u5305\u542b\u5757\u53ef\u80fd\u662f\u6587\u6863\u4e2d\u7684\u53e6\u4e00\u4e2a\u5143\u7d20\u6216\u8005\u662f\u521d\u59cb\u5305\u542b\u5757\u3002\u5143\u7d20\u539f\u5148\u5728\u6b63\u5e38\u6587\u6863\u6d41\u4e2d\u6240\u5360\u7684\u7a7a\u95f4\u4f1a\u5173\u95ed\uff0c\u5c31\u597d\u50cf\u5143\u7d20\u539f\u6765\u4e0d\u5b58\u5728\u4e00\u6837\u3002\u5143\u7d20\u5b9a\u4f4d\u540e\u751f\u6210\u4e00\u4e2a\u5757\u7ea7\u6846\uff0c\u800c\u4e0d\u8bba\u539f\u6765\u5b83\u5728\u6b63\u5e38\u6d41\u4e2d\u751f\u6210\u4f55\u79cd\u7c7b\u578b\u7684\u6846\u3002 4. fixed \u5143\u7d20\u6846\u7684\u8868\u73b0\u7c7b\u4f3c\u4e8e\u5c06 position \u8bbe\u7f6e\u4e3a absolute\uff0c\u4e0d\u8fc7\u5176\u5305\u542b\u5757\u662f\u89c6\u7a97\u672c\u8eab\u3002 \u63d0\u793a\uff1a\u76f8\u5bf9\u5b9a\u4f4d\u5b9e\u9645\u4e0a\u88ab\u770b\u4f5c\u666e\u901a\u6d41\u5b9a\u4f4d\u6a21\u578b\u7684\u4e00\u90e8\u5206\uff0c\u56e0\u4e3a\u5143\u7d20\u7684\u4f4d\u7f6e\u76f8\u5bf9\u4e8e\u5b83\u5728\u666e\u901a\u6d41\u4e2d\u7684\u4f4d\u7f6e\u3002 4.8.2 \u4f7f\u7528\u573a\u666f\u548c\u7279\u70b9 \u00b6 \u5f53\u9875\u9762\u4e2d\u51fa\u73b0\u76d2\u5b50\u538b\u76d2\u5b50\u65f6\u5019\uff0c\u63a8\u8350\u4f7f\u7528\u5b9a\u4f4d\u3002 \u5b9a\u4f4d\u4f53\u73b0\u7684\u662f\u5143\u7d20\u4e4b\u95f4\u7684\u5c42\u7ea7\u5173\u7cfb\u3002 4.8.3 \u9759\u6001\u5b9a\u4f4d \u00b6 \u8bed\u6cd5 position: static; left\uff1a 10px; top: 50px; bottom: 10px; right: 10px; - \u7279\u70b9 1. \u9759\u6001\u5b9a\u4f4d\u4e0d\u80fd\u79fb\u52a8\u5143\u7d20\u4f4d\u7f6e\u3002 2. \u9759\u6001\u5b9a\u4f4d\u7684\u5143\u7d20\u5c31\u662f\u6807\u51c6\u6d41\u5143\u7d20\u7684\u663e\u793a\u65b9\u5f0f\u3002 4.8.4 \u7edd\u5bf9\u5b9a\u4f4d \u00b6 \u8bed\u6cd5\uff1a position: absolute; \u7279\u70b9 1. \u5982\u679c\u4e00\u4e2a\u5b50\u5143\u7d20\u8bbe\u7f6e\u4e86\u7edd\u5bf9\u5b9a\u4f4d\uff0c\u5982\u679c\u8be5\u5b50\u5143\u7d20\u7684\u7236\u5143\u7d20\u8bbe\u7f6e\u4e86\u9759\u6001\u5b9a\u4f4d\u6216\u8005\u6ca1\u6709\u5b9a\u4f4d\uff0c\u90a3\u4e48\u5f53\u524d\u5b50\u5143\u7d20\u662f\u4ee5body\uff08\u6d4f\u89c8\u5668\uff09\u5de6\u4e0a\u89d2\u4f5c\u4e3a\u53c2\u7167\u8fdb\u884c\u79fb\u52a8\u3002 2. \u5982\u679c\u4e00\u4e2a\u5b50\u5143\u7d20\u8bbe\u7f6e\u4e86\u7edd\u5bf9\u5b9a\u4f4d\uff0c\u5982\u679c\u8be5\u5b50\u5143\u7d20\u7684\u7236\u5143\u7d20\u8bbe\u7f6e\u4e86\u9664\u9759\u6001\u5b9a\u4f4d\u4ee5\u5916\u7684\u5176\u4ed6\u5b9a\u4f4d\uff0c\u90a3\u4e48\u5f53\u524d\u7edd\u5bf9\u5b9a\u4f4d\u7684\u5b50\u5143\u7d20\u4f1a\u4ee5\u7236\u5143\u7d20\u5de6\u4e0a\u89d2\u4e3a\u53c2\u7167\u8fdb\u884c\u79fb\u52a8\u3002 3. \u8131\u79bb\u6587\u6863\u6d41\u3002\u4e0d\u5360\u4f4d\u7f6e\u3002 4. \u8bbe\u7f6e\u4e3a\u7edd\u5bf9\u5b9a\u4f4d\u7684\u5143\u7d20\u6846\u4ece\u6587\u6863\u6d41\u5b8c\u5168\u5220\u9664\uff0c\u5e76\u76f8\u5bf9\u4e8e\u5176\u5305\u542b\u5757\u5b9a\u4f4d\uff0c\u5305\u542b\u5757\u53ef\u80fd\u662f\u6587\u6863\u4e2d\u7684\u53e6\u4e00\u4e2a\u5143\u7d20\u6216\u8005\u662f\u521d\u59cb\u5305\u542b\u5757\u3002\u5143\u7d20\u539f\u5148\u5728\u6b63\u5e38\u6587\u6863\u6d41\u4e2d\u6240\u5360\u7684\u7a7a\u95f4\u4f1a\u5173\u95ed\uff0c\u5c31\u597d\u50cf\u8be5\u5143\u7d20\u539f\u6765\u4e0d\u5b58\u5728\u4e00\u6837\u3002\u5143\u7d20\u5b9a\u4f4d\u540e\u751f\u6210\u4e00\u4e2a\u5757\u7ea7\u6846\uff0c\u800c\u4e0d\u8bba\u539f\u6765\u5b83\u5728\u6b63\u5e38\u6d41\u4e2d\u751f\u6210\u4f55\u79cd\u7c7b\u578b\u7684\u6846\u3002 \u4f8b\u5b50 #box_relative { position: absolute; left: 30px; top: 20px; } \u7edd\u5bf9\u5b9a\u4f4d\u7684\u5143\u7d20\u7684\u4f4d\u7f6e\u76f8\u5bf9\u4e8e==\u6700\u8fd1\u7684\u5df2\u5b9a\u4f4d\u7956\u5148\u5143\u7d20==\uff0c\u5982\u679c\u5143\u7d20\u6ca1\u6709\u5df2\u5b9a\u4f4d\u7684\u7956\u5148\u5143\u7d20\uff0c\u90a3\u4e48\u5b83\u7684\u4f4d\u7f6e\u76f8\u5bf9\u4e8e\u6700\u521d\u7684\u5305\u542b\u5757\u3002\u800c\u76f8\u5bf9\u5b9a\u4f4d\u662f\u201c\u76f8\u5bf9\u4e8e\u201d\u5143\u7d20\u5728\u6587\u6863\u4e2d\u7684\u521d\u59cb\u4f4d\u7f6e\uff08 \u672c\u8eab\u6e90\u4f4d\u7f6e \uff09\uff0c\u800c\u7edd\u5bf9\u5b9a\u4f4d\u662f\u201c\u76f8\u5bf9\u4e8e\u201d \u6700\u8fd1\u7684\u5df2\u5b9a\u4f4d\u7956\u5148\u5143\u7d20 \uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5df2\u5b9a\u4f4d\u7684\u7956\u5148\u5143\u7d20\uff0c\u90a3\u4e48\u201c\u76f8\u5bf9\u4e8e\u201d==\u6700\u521d\u7684\u5305\u542b==\u5757\u3002 4.8.5 \u76f8\u5bf9\u5b9a\u4f4d \u00b6 \u8bed\u6cd5 position: relative; \u7279\u70b9 1. \u76f8\u5bf9\u5b9a\u4f4d\u7684\u5143\u7d20\u5360\u4f4d\u7f6e 2. \u76f8\u5bf9\u5b9a\u4f4d\u5143\u7d20\u662f\u4ee5\u5143\u7d20\u7684\u539f\u6765\u7684\u4f4d\u7f6e\u4e3a\u53c2\u7167\u8bbe\u7f6e\u5b9a\u4f4d\u3002 3. \u76f8\u5bf9\u5b9a\u4f4d\u4e0d\u80fd\u5b9e\u73b0\u6a21\u5f0f\u8f6c\u6362 4. \u8bbe\u7f6e\u4e3a\u76f8\u5bf9\u5b9a\u4f4d\u7684\u5143\u7d20\u6846\u4f1a\u504f\u79fb\u67d0\u4e2a\u8ddd\u79bb\u3002\u5143\u7d20\u4ecd\u7136\u4fdd\u6301\u5176\u672a\u5b9a\u4f4d\u524d\u7684\u5f62\u72b6\uff0c\u5b83\u539f\u672c\u6240\u5360\u7684\u7a7a\u95f4\u4ecd\u4fdd\u7559 5. \u4e00\u822c\u60c5\u51b5\u4e0b\u8981\u8bbe\u7f6e \u5b50\u7edd\uff08\u7edd\u5bf9\u5b9a\u4f4d\uff09\u7236\u76f8\uff08\u76f8\u5bf9\u5b9a\u4f4d\uff09 \u4f8b\u5b50 #box_relative { position: relative; left: 30px; top: 20px; } 4.8.6 \u56fa\u5b9a\u5b9a\u4f4d \u00b6 \u8bed\u6cd5 position: fixed; \u7279\u70b9 1. \u56fa\u5b9a\u5b9a\u4f4d\u7684\u5143\u7d20\u59cb\u7ec8\u4ee5body\uff08\u6d4f\u89c8\u5668\uff09\u53ef\u89c6\u533a\u57df\u4e3a\u53c2\u7167\u8bbe\u7f6e\u5b9a\u4f4d 2. \u56fa\u5b9a\u5b9a\u4f4d\u7684\u5143\u7d20\u8131\u6807\u4e0d\u5360\u4f4d\u7f6e 3. \u56fa\u5b9a\u5b9a\u4f4d\u7684\u5143\u7d20\u53ef\u4ee5\u5b9e\u73b0\u6a21\u5f0f\u8f6c\u6362 4.8.7 Z-index \u00b6 \u5b9a\u4f4d\u5143\u7d20\u7684\u7279\u70b9 1. \u53ea\u6709\uff08\u9664\u4e86\u9759\u6001\u5b9a\u4f4d\uff09\u5b9a\u4f4d\u7684\u5143\u7d20\u6709\u5c42\u7ea7\u5173\u7cfb\u3002\u50cf\u6d6e\u52a8\u5143\u7d20\u4ec0\u4e48\u7684\u90fd\u6ca1\u6709\u5c42\u7ea7\u5173\u7cfb 2. \u901a\u8fc7 z-index\u6539\u53d8\u5c42\u7ea7\u5173\u7cfb \u5c42\u7ea7\u5173\u7cfb 1. \u5f53\u7ed9\u4f60\u4e00\u4e2a\u5143\u7d20\u8bbe\u7f6e\u4e86\u5b9a\u4f4d\uff0c\u8be5\u5143\u7d20\u9ed8\u8ba4\u7684\u5c42\u7ea7z-index\u503c\u662fauto(0) 2. \u5f53z-index\u503c\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u90a3\u4e48\u6700\u540e\u5b9a\u4f4d\u7684\u5143\u7d20\u5c42\u7ea7\u8981\u9ad8\u4e8e\u524d\u9762\u5b9a\u4f4d\u5143\u7d20\uff08\u540e\u6765\u5c45\u4e0a\u539f\u5219\uff09 3. \u5f53z-index\u503c\u4e0d\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u90a3\u4e48z-index\u503c\u8d8a\u9ad8\uff0c\u5c42\u7ea7\u5173\u7cfb\u5c31\u8d8a\u9ad8 4. \u5982\u679c\u5b50\u5143\u7d20\u7684\u7236\u5143\u7d20\u8bbe\u7f6e\u4e86z-index\u503c\uff0c\u90a3\u4e48\u7236\u5143\u7d20\u7684z-index\u503c\u7684\u8d8a\u5927\uff0c\u8be5\u5b50\u5143\u7d20\u7684\u5c42\u7ea7\u8d8a\u9ad8 4.8.8 \u5b9a\u4f4d\u76d2\u5b50\u5c45\u4e2d \u00b6 \u6807\u51c6\u6d41\u7684\u76d2\u5b50\u5c45\u4e2d\u663e\u793a\uff1amargin\uff1a0 auto; \u53ea\u662f\u8ba9\u6807\u51c6\u6d41\u76d2\u5b50\u5c45\u4e2d\u663e\u793a\uff0c\u7edd\u5bf9\u5b9a\u4f4d\u7684\u76d2\u5b50\u5c45\u4e2d\u663e\u793a\uff1a 1. left: 50%; \u7236\u5143\u7d20\u5bbd\u5ea6\u4e00\u534a 2. margin-left: -\u5143\u7d20\u81ea\u5df1\u5bbd\u5ea6\u4e00\u534a(\u5176\u4e2d\u7b26\u53f7-\u8868\u793a\u5411\u5de6\u79fb\u52a8\uff0c\u4ee3\u8868\u65b9\u5411) \u4e5f\u5c31\u662f\u5148\u6309\u7167\u7236\u5143\u7d20\u7684\u5bbd\u5ea6\u5411\u53f3\u79fb\u52a8\u5230\u7236\u5143\u7d20\u4e2d\u95f4\uff0c\u7136\u540e\u81ea\u8eab\u50cf\u5de6\u79fb\u52a8\u4e00\u534a\u3002 4.9 \u5176\u4ed6\u8bbe\u7f6e \u00b6 4.9.1 CSS \u89c4\u8303 \u00b6 \u884c\u5185\u5143\u7d20\u5c3d\u91cf\u91cc\u9762\u5305\u542b\u884c\u5185\u5143\u7d20 \u4e0d\u63a8\u8350a\u91cc\u9762\u5305\u542bh\u6807\u7b7e \u6709\u4e9b\u5757\u7ea7\u5143\u7d20\u4e0d\u80fd\u5305\u542b\u5176\u4ed6\u5757\u7ea7\u5143\u7d20\u3002\u6807\u9898\u6807\u7b7e\uff0c\u6bb5\u843d\u6807\u7b7e\u4e0d\u80fd\u5305\u542bdiv\uff0c\u5c24\u5176\u662fP\u6807\u7b7e\u4e0d\u80fd\u5305\u542bdiv 4.9.2 \u8131\u6807\u6d41 \u00b6 \u7f51\u9875\u5e03\u5c40\u907f\u514d\u8131\u6807\u6d41 1. \u7f51\u9875\u5e03\u5c40\u4f18\u5148\u8003\u8651\u6807\u51c6\u6d41 2. \u7136\u540e\u8003\u8651\u4f7f\u7528\u6d6e\u52a8 3. \u6700\u540e\u4f7f\u7528\u5b9a\u4f4d 4. \u5143\u7d20\u6a21\u5f0f\u8f6c\u6362\uff0c\u5fc5\u987b\u4f7f\u7528display 4.9.3 vertical-align\u5c5e\u6027\u4ecb\u7ecd \u00b6 1. text-align \u6c34\u5e73\u5bf9\u9f50 2. vertical-align \u5782\u76f4\u5bf9\u9f50 3. \u9ed8\u8ba4\u884c\u5185\u5757\u5143\u7d20(img,input)\uff0c\u6709\u9ed8\u8ba4\u7684vertical-align\u5c5e\u6027\u503c vertical-align: baseline ; \u9ed8\u8ba4\u503c top ; \u9876\u90e8\u5bf9\u9f50 middle ; \u4e2d\u90e8\u5bf9\u9f50 bottom ; \u5e95\u90e8\u5bf9\u9f50 4.9.4 \u9690\u85cf\u65b9\u5f0f \u00b6 overflow\uff1a hidden; \u5c06\u6ea2\u51fa\u90e8\u5206\u9690\u85cf display: none; \u5143\u7d20\u9690\u85cf\uff0c\u9690\u85cf\u540e\u5143\u7d20\u4e0d\u5360\u4f4d\u7f6e display: block; \u663e\u793a\u5143\u7d20 visibility: hidden \u5143\u7d20\u9690\u85cf\uff0c\u9690\u85cf\u540e\u5143\u7d20\u5360\u4f4d\u7f6e 4.9.5 log\u5185\u5bb9\u79fb\u9664 \u00b6 1. logo\u4e00\u822c\u63a8\u8350\u7ed9a\u6807\u7b7e\u8bbe\u7f6e\u80cc\u666f\u56fe\u7247 2. logo\u4e2da\u6807\u7b7e\u6700\u597d\u8bbe\u7f6e\u6587\u5b57 3. text-indent: -1000px;\u8fd9\u4e2a\u503c\u662f\u8d1f\u6570\u968f\u4fbf\u5199\uff08\u9996\u884c\u7f29\u8fdb\uff09 4.9.6 \u7cbe\u7075\u56fe \u00b6 \u5b9a\u4e49: \u662f\u4e00\u79cd\u5904\u7406\u7f51\u9875\u7279\u6b8a\u80cc\u666f\u56fe\u7247 \u5b83\u5c06\u4e00\u4e2a\u9875\u9762\u7684\u6d89\u53ca\u5230\u7684\u6240\u6709\u96f6\u661f\u80cc\u666f\u56fe\u50cf\u90fd\u96c6\u4e2d\u5230\u4e00\u5f20\u5927\u56fe\u4e2d\uff0c\u7136\u540e\u5c06\u5927\u56fe\u5e94\u7528\u4e8e\u7f51\u9875\uff0c\u8fd9\u6837\u5f53\u7528\u6237\u8bbf\u95ee\u8be5\u7f51\u9875\u7684\u65f6\u5019\uff0c\u53ea\u8981\u5411\u670d\u52a1\u5668\u53d1\u9001\u4e00\u6b21\u8bf7\u6c42\uff0c\u7f51\u9875\u4e2d\u7684\u80cc\u666f\u56fe\u50cf\u5373\u53ef\u5168\u90e8\u5c55\u793a\u51fa\u6765\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u7531\u5f88\u591a\u5c0f\u7684\u80cc\u666f\u56fe\u50cf\u5408\u6210\u5927\u56fe\u79f0\u4e3a\u7cbe\u7075\u56fe\u3002 \u4f7f\u7528\uff1a 1. \u7ed9\u5143\u7d20\u8bbe\u7f6e\u7cbe\u7075\u56fe\u4e3a\u80cc\u666f\u56fe\u7247 2. \u901a\u8fc7backgroud-position\u79fb\u52a8\u80cc\u666f\u56fe\u7247 4.9.7 \u6ed1\u52a8\u95e8 \u00b6 \u5b9a\u4e49\uff1a\u6839\u636e\u6587\u672c\u81ea\u9002\u5e94\u5927\u5c0f\uff0c\u6839\u636e\u80cc\u666f\u7684\u5c42\u53e0\u6027\u5236\u4f5c\uff0c\u5e76\u5141\u8bb8\u4ed6\u4eec\u5728\u5f7c\u6b64\u4e4b\u4e0a\u8fdb\u884c\u6ed1\u52a8\uff0c\u4ee5\u521b\u9020\u51fa\u4e00\u4e9b\u7279\u6b8a\u7684\u6548\u679c\u3002 \u6ce8\u610f\uff1a 1. \u5236\u4f5c\u7f51\u9875\u5bfc\u822a\u3002 2. \u6ed1\u52a8\u95e8\u5bfc\u822a\u4f7f\u7528\u80cc\u666f\u56fe\u7247\u5236\u4f5c\u3002 3. \u6ed1\u52a8\u95e8\u5bfc\u822a\u5185\u5bb9\u4e0d\u80fd\u8bbe\u7f6e\u5bbd\u5ea6\u3002 4. \u5de6\u8fb9\u56fa\u5b9a\u4e0d\u52a8\u7684\u90e8\u5206\uff0c\u80cc\u666f\u5de6\u5bf9\u9f50 5. \u53f3\u8fb9\u968f\u7740\u5185\u5bb9\u53d8\u5bbd\u7684\u90e8\u5206\uff0c\u80cc\u666f\u53f3\u5bf9\u9f50 \u4f8b\u5b50 div { float: left; } .left { width: 9px; height: 64px; background: url(\"l.png\") no-repeat; } .middle { height: 64px; line-height: 64px; background: url(\"m.png\"); } .right { width: 9px; height: 64px; background: url(\"r.png\") no-repeat; } <div class=\"left\"></div> <div class=\"middle\">\u6587\u5b57111111111111111</div> \u8fd9\u4e2a\u6587\u5b57\u8d8a\u591a\u4e2d\u95f4\u7684\u5c31\u88ab\u6491\u5f00\u8d8a\u5bbd <div class=\"right\"></div> 4.9.8 \u56fe\u6807\u5b57\u4f53 \u00b6 http://www.iconfont.cn/collections <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> <link rel=\"stylesheet\" href=\"iconfont.css\"> \u94fe\u63a5\u5f15\u7528 </head> <body> <span class=\"iconfont\">&#xe624;</span> <span class=\"iconfont\">&#xe625;</span> <span class=\"iconfont\">&#xe626;</span> <span class=\"iconfont\">&#xe62c;</span> <span class=\"iconfont\">&#xe62d;</span> <span class=\"iconfont\">&#xe62e;</span> <span class=\"iconfont\">&#xe62f;</span> </body> </html> \u8bbf\u95eeabc.html\u5c31\u663e\u793a\u53f3\u4fa7\u7684\u56fe\u6807\uff0c\u53c2\u8003\u4e0a\u56fe\u7684\u90a3\u4e09\u4e2ademohtml\uff0c\u91cc\u9762\u6709\u5177\u4f53\u7528\u6cd5","title":"CSS"},{"location":"frontend/css/css.index/#1-css","text":"\u5c42\u53e0\u6837\u5f0f\u8868(\u82f1\u6587\u5168\u79f0\uff1aCascading Style Sheets)\u662f\u4e00\u79cd\u7528\u6765\u8868\u73b0HTML\uff08\u6807\u51c6\u901a\u7528\u6807\u8bb0\u8bed\u8a00\u7684\u4e00\u4e2a\u5e94\u7528\uff09\u6216XML\uff08\u6807\u51c6\u901a\u7528\u6807\u8bb0\u8bed\u8a00\u7684\u4e00\u4e2a\u5b50\u96c6\uff09\u7b49\u6587\u4ef6\u6837\u5f0f\u7684\u8ba1\u7b97\u673a\u8bed\u8a00\u3002CSS\u4e0d\u4ec5\u53ef\u4ee5\u9759\u6001\u5730\u4fee\u9970\u7f51\u9875\uff0c\u8fd8\u53ef\u4ee5\u914d\u5408\u5404\u79cd\u811a\u672c\u8bed\u8a00\u52a8\u6001\u5730\u5bf9\u7f51\u9875\u5404\u5143\u7d20\u8fdb\u884c\u683c\u5f0f\u5316\uff0cCSS \u80fd\u591f\u5bf9\u7f51\u9875\u4e2d\u5143\u7d20\u4f4d\u7f6e\u7684\u6392\u7248\u8fdb\u884c\u50cf\u7d20\u7ea7\u7cbe\u786e\u63a7\u5236\uff0c\u652f\u6301\u51e0\u4e4e\u6240\u6709\u7684\u5b57\u4f53\u5b57\u53f7\u6837\u5f0f\uff0c\u62e5\u6709\u5bf9\u7f51\u9875\u5bf9\u8c61\u548c\u6a21\u578b\u6837\u5f0f\u7f16\u8f91\u7684\u80fd\u529b\u3002 \u9996\u5148\u5f3a\u8c03\u4e00\u70b9CSS\u5728\u524d\u7aef\u9875\u9762\u4e2d\u7684\u5730\u4f4d\u3002HTML\u4ee3\u7801\u5199\u5b8c\u540e\u3002CSS\u5bf9HTML\u8fdb\u884c\u4fee\u7f2e\uff0c\u4e5f\u5c31\u662f\u4f20\u8bf4\u7684\"\u7f8e\u5bb9\u5e08\"\u3002\u5982\u6211\u4eec\u5728\u6d4f\u89c8\u5668\u4e0a\u770b\u5230\u7684\u9875\u9762\u4e2d\u7684\u5b57\u4f53\u989c\u8272\uff0c\u5b57\u4f53\u5927\u5c0f\uff0c\u6bb5\u843d\u683c\u5f0f\uff0c\u56fe\u7247\uff0c\u89c6\u9891\u663e\u793a\uff0c\u800cJs\u7684\u4f5c\u7528\u5c31\u662f\u6211\u4eec\u8ba9\u9875\u9762\u52a8\u8d77\u6765\u3002\u6bd4\u5982 \u6211\u4eec\u9f20\u6807\u70b9\u51fb\uff0c\u62d6\u52a8\u7b49\uff0c\u52a8\u4f5c\u90fd\u662fjs\u8d77\u5230\u4f5c\u7528\u3002","title":"1. CSS\u4ecb\u7ecd"},{"location":"frontend/css/css.index/#2-css","text":"","title":"2. CSS \u5f15\u5165"},{"location":"frontend/css/css.index/#21","text":"\u6982\u5ff5\uff1a\u5c42\u53e0\u6837\u5f0f\u8868\u6216\u8005\u7ea7\u8054\u6837\u5f0f\u8868\uff08Cascading style sheets\uff09 \u5c42\u53e0\uff1aCSS\u7684\u7279\u6027 \u4f5c\u7528\uff1a\u8bbe\u7f6e\u7f51\u9875\u7ed3\u6784\u6837\u5f0f(\u6539\u53d8html\u6807\u7b7e\u6837\u5f0f)\uff0c\u901a\u8fc7CSS\u7ed9HTML\u6807\u7b7e\u5c5e\u6027\u8fbe\u5230\u6539\u53d8\u6807\u7b7e\u6837\u5f0f\u3002","title":"2.1 \u7279\u6027"},{"location":"frontend/css/css.index/#22","text":"","title":"2.2 \u5f15\u5165\u65b9\u5f0f"},{"location":"frontend/css/css.index/#221","text":"css\u6837\u5f0f\u5199\u5728html\u6587\u4ef6head\u5185\u3002 <head> <style type=\"text/css\"> \u6837\u5f0f\u8868\u5185\u5bb9|CSS\u4ee3\u7801 </style> </head> \u6837\u5f0f\u53ea\u4f5c\u7528\u4e8e\u5f53\u524d\u6587\u4ef6\uff0c\u6ca1\u6709\u771f\u6b63\u5b9e\u73b0\u7ed3\u6784\u8868\u73b0\u5206\u79bb\u3002","title":"2.2.1 \u5185\u5d4c\u65b9\u6cd5"},{"location":"frontend/css/css.index/#222","text":"css\u6837\u5f0f\u4e3a\u5355\u72ec\u7684\u6587\u4ef6\uff0c\u7136\u540ehtml\u6587\u4ef6\u94fe\u63a5\u5230\u6b64css\u6587\u4ef6\uff0c\u6781\u529b\u63a8\u8350\u8fd9\u6837\u5199\u3002 <head> <link rel=\"stylesheet\" href=\"header.css\"> <head> \u4f5c\u7528\u4e8e\u94fe\u63a5\u5230\u5b83\u7684\u6587\u4ef6\uff0c\u8303\u56f4\u5e7f\uff0c\u771f\u6b63\u5b9e\u73b0\u7ed3\u6784\u8868\u73b0\u5206\u79bb\u3002","title":"2.2.2 \u5916\u94fe\u65b9\u6cd5"},{"location":"frontend/css/css.index/#223","text":"\u76f4\u63a5\u5199\u5728\u6807\u7b7e\u5185\u7684\u6837\u5f0f\u3002 <body> <h1 style=\"font-size:30px; color:red;\">\u535a\u5ba2</h1> </body> \u4f5c\u7528\u8303\u56f4\u4ec5\u9650\u4e8e\u5f53\u524d\u6807\u7b7e\uff0c\u8303\u56f4\u5c0f\uff0c\u7ed3\u6784\u8868\u73b0\u6df7\u5728\u4e00\u8d77\u3002","title":"2.2.3 \u884c\u5185\u65b9\u6cd5"},{"location":"frontend/css/css.index/#3","text":"\u5728 CSS \u4e2d\uff0c\u9009\u62e9\u5668\u662f\u4e00\u79cd\u6a21\u5f0f\uff0c\u7528\u4e8e\u9009\u62e9\u9700\u8981\u6dfb\u52a0\u6837\u5f0f\u7684\u5143\u7d20\u3002\u9009\u62e9\u5668 {\u5c5e\u6027\uff1a\u503c;} \u9009\u62e9\u5668\uff1a\u9009\u62e9\u6807\u7b7e\u7684\u8fc7\u7a0b \u6807\u7b7e\u9009\u62e9\u5668 \u7c7b\u9009\u62e9\u5668 D\u9009\u62e9\u5668 \u901a\u914d\u7b26\u9009\u62e9\u5668 \u4ea4\u96c6\u9009\u62e9\u5668\uff08\u6807\u7b7e\u6307\u5b9a\u5f0f\uff09 \u540e\u4ee3\u9009\u62e9\u5668 \u81ea\u5e26\u9009\u62e9\u5668 \u5e76\u96c6\u9009\u62e9\u5668 \u8865\u5145\u9009\u62e9\u5668 1. \u4f2a\u7c7b\u9009\u62e9\u5668 1. \u5c5e\u6027\u9009\u62e9\u5668 1. \u4f2a\u5143\u7d20\u9009\u62e9\u5668","title":"3. \u9009\u62e9\u5668"},{"location":"frontend/css/css.index/#31","text":"\"CSS\" \u5217\u6307\u793a\u8be5\u5c5e\u6027\u662f\u5728\u54ea\u4e2a CSS \u7248\u672c\u4e2d\u5b9a\u4e49\u7684\u3002\uff08CSS1\u3001CSS2 \u8fd8\u662f CSS3\u3002 \u9009\u62e9\u5668 \u4f8b\u5b50 \u4f8b\u5b50\u63cf\u8ff0 CSS\u7248\u672c .class .intro \u9009\u62e9 class=\"intro\" \u7684\u6240\u6709\u5143\u7d20\u3002 1 #id #firstname \u9009\u62e9 id=\"firstname\" \u7684\u6240\u6709\u5143\u7d20\u3002 1 * * \u9009\u62e9\u6240\u6709\u5143\u7d20\u3002 2 element p \u9009\u62e9\u6240\u6709 \u5143\u7d20\u3002 1 element,element div,p \u9009\u62e9\u6240\u6709 \u5143\u7d20\u548c\u6240\u6709 \u5143\u7d20\u3002 1 element element div p \u9009\u62e9 \u5143\u7d20\u5185\u90e8\u7684\u6240\u6709 \u5143\u7d20\u3002 1 element>element div>p \u9009\u62e9\u7236\u5143\u7d20\u4e3a \u5143\u7d20\u7684\u6240\u6709 \u5143\u7d20\u3002 2 element+element div+p \u9009\u62e9\u7d27\u63a5\u5728 \u5143\u7d20\u4e4b\u540e\u7684\u6240\u6709 \u5143\u7d20\u3002 2 [attribute] [target] \u9009\u62e9\u5e26\u6709 target \u5c5e\u6027\u6240\u6709\u5143\u7d20\u3002 2 [attribute=value] [target=_blank] \u9009\u62e9 target=\"_blank\" \u7684\u6240\u6709\u5143\u7d20\u3002 2 [attribute~=value] [title~=flower] \u9009\u62e9 title \u5c5e\u6027\u5305\u542b\u5355\u8bcd \"flower\" \u7684\u6240\u6709\u5143\u7d20\u3002 2 [attribute =value] [lang =en] :link a:link \u9009\u62e9\u6240\u6709\u672a\u88ab\u8bbf\u95ee\u7684\u94fe\u63a5\u3002 1 :visited a:visited \u9009\u62e9\u6240\u6709\u5df2\u88ab\u8bbf\u95ee\u7684\u94fe\u63a5\u3002 :active a:active \u9009\u62e9\u6d3b\u52a8\u94fe\u63a5\u3002 1 :hover a:hover \u9009\u62e9\u9f20\u6807\u6307\u9488\u4f4d\u4e8e\u5176\u4e0a\u7684\u94fe\u63a5\u3002 1 :focus input:focus \u9009\u62e9\u83b7\u5f97\u7126\u70b9\u7684 input \u5143\u7d20\u3002 2 :first-letter p:first-letter \u9009\u62e9\u6bcf\u4e2a \u5143\u7d20\u7684\u9996\u5b57\u6bcd\u3002 1 :first-line p:first-line \u9009\u62e9\u6bcf\u4e2a \u5143\u7d20\u7684\u9996\u884c\u3002 1 :first-child p:first-child \u9009\u62e9\u5c5e\u4e8e\u7236\u5143\u7d20\u7684\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 2 :before p:before \u5728\u6bcf\u4e2a \u5143\u7d20\u7684\u5185\u5bb9\u4e4b\u524d\u63d2\u5165\u5185\u5bb9\u3002 2 :after p:after \u5728\u6bcf\u4e2a \u5143\u7d20\u7684\u5185\u5bb9\u4e4b\u540e\u63d2\u5165\u5185\u5bb9\u3002 2 :lang(language) p:lang(it) \u9009\u62e9\u5e26\u6709\u4ee5 \"it\" \u5f00\u5934\u7684 lang \u5c5e\u6027\u503c\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 2 element1~element2 p~ul \u9009\u62e9\u524d\u9762\u6709 \u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 [attribute^=value] a[src^=\"https\"] \u9009\u62e9\u5176 src \u5c5e\u6027\u503c\u4ee5 \"https\" \u5f00\u5934\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 [attribute$=value] a[src$=\".pdf\"] \u9009\u62e9\u5176 src \u5c5e\u6027\u4ee5 \".pdf\" \u7ed3\u5c3e\u7684\u6240\u6709 \u5143\u7d20\u3002 3 [attribute*=value] a[src*=\"abc\"] \u9009\u62e9\u5176 src \u5c5e\u6027\u4e2d\u5305\u542b \"abc\" \u5b50\u4e32\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 :first-of-type p:first-of-type \u9009\u62e9\u5c5e\u4e8e\u5176\u7236\u5143\u7d20\u7684\u9996\u4e2a \u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 :last-of-type p:last-of-type \u9009\u62e9\u5c5e\u4e8e\u5176\u7236\u5143\u7d20\u7684\u6700\u540e \u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 :only-of-type p:only-of-type \u9009\u62e9\u5c5e\u4e8e\u5176\u7236\u5143\u7d20\u552f\u4e00\u7684 \u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 :only-child p:only-child \u9009\u62e9\u5c5e\u4e8e\u5176\u7236\u5143\u7d20\u7684\u552f\u4e00\u5b50\u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 :nth-child(n) p:nth-child(2) \u9009\u62e9\u5c5e\u4e8e\u5176\u7236\u5143\u7d20\u7684\u7b2c\u4e8c\u4e2a\u5b50\u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 :nth-last-child(n) p:nth-last-child(2) \u540c\u4e0a\uff0c\u4ece\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\u5f00\u59cb\u8ba1\u6570\u3002 3 :nth-of-type(n) p:nth-of-type(2) \u9009\u62e9\u5c5e\u4e8e\u5176\u7236\u5143\u7d20\u7b2c\u4e8c\u4e2a \u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\u3002 3 :nth-last-of-type(n) p:nth-last-of-type(2) \u540c\u4e0a\uff0c\u4f46\u662f\u4ece\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\u5f00\u59cb\u8ba1\u6570\u3002 3 :last-child p:last-child \u9009\u62e9\u5c5e\u4e8e\u5176\u7236\u5143\u7d20\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\u6bcf\u4e2a \u5143\u7d20\u3002 3 :root :root \u9009\u62e9\u6587\u6863\u7684\u6839\u5143\u7d20\u3002 3 :empty p:empty \u9009\u62e9\u6ca1\u6709\u5b50\u5143\u7d20\u7684\u6bcf\u4e2a \u5143\u7d20\uff08\u5305\u62ec\u6587\u672c\u8282\u70b9\uff09\u3002 3 :target #news:target \u9009\u62e9\u5f53\u524d\u6d3b\u52a8\u7684 #news \u5143\u7d20\u3002 3 :enabled input:enabled \u9009\u62e9\u6bcf\u4e2a\u542f\u7528\u7684 \u5143\u7d20\u3002 3 :disabled input:disabled \u9009\u62e9\u6bcf\u4e2a\u7981\u7528\u7684 \u5143\u7d20 3 :checked input:checked \u9009\u62e9\u6bcf\u4e2a\u88ab\u9009\u4e2d\u7684 \u5143\u7d20\u3002 3 :not(selector) :not(p) \u9009\u62e9\u975e \u5143\u7d20\u7684\u6bcf\u4e2a\u5143\u7d20\u3002 3 ::selection ::selection \u9009\u62e9\u88ab\u7528\u6237\u9009\u53d6\u7684\u5143 3","title":"3.1 \u9009\u62e9\u5668\u4ecb\u7ecd"},{"location":"frontend/css/css.index/#32","text":"Html\u6807\u7b7e\u540d {\u5c5e\u6027\uff1a\u503c;} \uff0c\u5e38\u7528\u7684\u5c5e\u6027: \u5c5e\u6027 \u63cf\u8ff0 color \u524d\u666f\u8272\uff08\u6587\u5b57\u989c\u8272\uff09 backgroud-color \u80cc\u666f\u8272 font-size \u8bbe\u7f6e\u6587\u5b57\u5927\u5c0f width \u8bbe\u7f6e\u5bbd\u5ea6 height \u8bbe\u7f6e\u9ad8\u5ea6 text-align left right text-indent \u9996\u884c\u7f29\u8fdb text-indent: 2em; \u9996\u884c\u7f29\u8fdb\u4e24\u4e2a\u6c49\u5b57 text-indent: 20px; \u9996\u884c\u7f29\u8fdb20\u50cf\u7d20","title":"3.2 \u6807\u7b7e\u9009\u62e9\u5668"},{"location":"frontend/css/css.index/#33","text":"\u5c5e\u6027 \u63cf\u8ff0 px \u50cf\u7d20 20px----20\u50cf\u7d20\u70b9 em 1em=1\u4e2a\u6587\u5b57\u5927\u5c0f\uff0cnem=n\u4e2a\u6587\u5b57\u5927\u5c0f","title":"3.3 \u5355\u4f4d\u4ecb\u7ecd"},{"location":"frontend/css/css.index/#34","text":"","title":"3.4 \u989c\u8272"},{"location":"frontend/css/css.index/#341","text":"background-color: red;","title":"3.4.1 \u76f4\u63a5\u4f7f\u7528\u989c\u8272\u7684\u540d\u8bcd"},{"location":"frontend/css/css.index/#342-16","text":"background-color: #000000;","title":"3.4.2 \u4f7f\u752816\u8fdb\u5236\u8868\u793a"},{"location":"frontend/css/css.index/#333","text":"rgb r: red (0-255)\u53d6\u503c\u8303\u56f4 g:green (0-255)\u53d6\u503c\u8303\u56f4 b:blue (0-255)\u53d6\u503c\u8303\u56f4 background-color: rgb(23,56,89); 1. \u534a\u900f\u660e\uff1a background-color: rgba(23,56,89,0.2); #\u6700\u540e\u4e00\u4f4d\u53d6\u503c0\u52301 2. \u4f7f\u7528opacity\u5b9e\u73b0\u534a\u900f\u660e background-color: red; opacity: 0.5; \u4f1a\u8ba9\u6587\u5b57\u4e5f\u534a\u900f\u660e \u89e3\u51b3IE\u4f4e\u7248\u672c\u4e0d\u517c\u5bb9\u95ee\u9898 background-color: red; opacity: 0.5; filter: Alpha(opacity=50);","title":"3.3.3 \u4f7f\u7528\u4e09\u539f\u8272\u8868\u793a"},{"location":"frontend/css/css.index/#35","text":"\u9996\u5148\uff0c\u7c7b \u9009\u62e9\u5668\u524d\u9762\u6709\u4e00\u4e2a . \u53f7 \u4e5f\u79f0\u4e3a\u68cb\u70b9\u53f7\u3002","title":"3.5 \u7c7b\u9009\u62e9\u5668"},{"location":"frontend/css/css.index/#351","text":"\u81ea\u5b9a\u4e49\u7c7b\u540d {\u5c5e\u6027\uff1a\u503c;} - \u901a\u8fc7.\u81ea\u5b9a\u4e49\u7c7b\u540d \u5b9a\u4e49\u4e00\u4e2a\u7c7b\u6837\u5f0f .p_red{ }","title":"3.5.1 \u81ea\u5b9a\u4e49\u7c7b\u540d"},{"location":"frontend/css/css.index/#352","text":"\u6807\u7b7e\u901aclass\u5c5e\u6027\u8c03\u7528\u7c7b\u6837\u5f0f <p class=\"p_red\">\u6587\u5b572</p> .p_red{ color: red; } <p class=\"p_red\">\u6587\u5b572</p> \u6b64\u65f6\u4f1a\u5c06\u6807\u7b7ep\u4e2dclass\u662fp_red\u7684\u9009\u4e2d","title":"3.5.2 \u8c03\u7528"},{"location":"frontend/css/css.index/#353","text":"\u4e00\u4e2a\u6837\u5f0f\u53ef\u4ee5\u88ab\u591a\u4e2a\u6807\u7b7e\u8c03\u7528 <p class=\"p_red\">\u6587\u5b572</p> <div class=\"p_red\">\u6587\u5b572</div> 2. \u4e00\u4e2a\u6807\u7b7e\u53ef\u4ee5\u540c\u65f6\u8c03\u7528\u591a\u4e2a\u7c7b\u6837\u5f0f(\u4e2d\u95f4\u52a0\u7a7a\u683c) <div class=\"p_red public\">\u6587\u5b572</div>","title":"3.5.3 \u7279\u70b9"},{"location":"frontend/css/css.index/#354","text":"\u987e\u540d\u601d\u4e49 \u5c31\u662f\u6839\u636e\u4f5c\u7528\u8d77\u5bf9\u5e94\u7684\u540d\u5b57\u3002\u6bd4\u5982\u6392\u5934\u6eda\u52a8\u7684\u6807\u8bed\uff0c\u53ef\u4ee5\u9009\u62e9banner \u901a\u7528\u7c7b\u540d \u4e2d\u6587\u540d \u82f1\u6587\u540d \u5934 header \u5185 \u5bb9 content/container \u5c3e footer \u5bfc \u822a nav \u4fa7 \u680f sidebar \u680f \u76ee column \u6807 \u5fd7 logo \u5e7f \u544a banner \u70ed \u70b9 hot \u65b0 \u95fb news \u4e0b \u8f7d download \u83dc \u5355 menu \u641c \u7d22 search \u9875 \u811a footer \u7248 \u6743 copyright \u6eda \u52a8 scroll \u5185 \u5bb9 content \u53cb\u60c5\u94fe\u63a5 friendlink \u5b50\u5bfc \u822a subnav \u9875\u9762\u4e3b\u4f53 main \u5de6\u4e2d \u53f3 left right center \u767b\u5f55 \u6761 loginbar \u9875\u9762\u5916\u56f4\u63a7\u5236\u6574\u4f53\u5e03\u5c40\u5bbd\u5ea6 wrapper \u4ee5\u4e0b\u662f\u4e0d\u63a8\u8350\u7684\u5199\u6cd5 \u4e0d\u80fd\u4f7f\u7528\u4ee5\u6570\u5b57\u5f00\u5934 \u4e0d\u63a8\u8350\u4f7f\u7528\u4e2d\u6587\u5b9a\u4e49\u7c7b\u540d\uff08\u867d\u7136\u53ef\u4ee5\u4f7f\u7528\uff09 \u4e0d\u80fd\u4f7f\u7528\u4ee5\u7279\u6b8a\u5b57\u7b26\u5f00\u5934\u7684 \u4e2a\u4eba\u4e0d\u63a8\u8350\u4f7f\u7528\u6807\u7b7e\u540d\u4f5c\u4e3a\u5b9a\u4e49\u7c7b\u540d \u6bd4\u5982div\u4f5c\u4e3aclass\u503c\u7684","title":"3.5.4 \u547d\u540d\u89c4\u8303"},{"location":"frontend/css/css.index/#36-id","text":"","title":"3.6 ID \u9009\u62e9\u5668"},{"location":"frontend/css/css.index/#361-id","text":"\u5728\u67d0\u4e9b\u65b9\u9762\uff0cID \u9009\u62e9\u5668\u7c7b\u4f3c\u4e8e\u7c7b\u9009\u62e9\u5668\uff0c\u4e0d\u8fc7\u4e5f\u6709\u4e00\u4e9b\u91cd\u8981\u5dee\u522b\u3002\u9996\u5148\uff0cID \u9009\u62e9\u5668\u524d\u9762\u6709\u4e00\u4e2a # \u53f7 - \u4e5f\u79f0\u4e3a\u68cb\u76d8\u53f7\u6216\u4e95\u53f7\u3002\u8bed\u6cd5\u5982\u4e0b \u8bed\u6cd5\uff1a #\u81ea\u5b9a\u4e49\u540d\u79f0 {\u5c5e\u6027: \u503c;}","title":"3.6.1 ID\u9009\u62e9\u5668\u8bed\u6cd5"},{"location":"frontend/css/css.index/#362","text":"\u9996\u5148\u901a\u8fc7#\u81ea\u5b9a\u4e49\u540d\u79f0 \u5b9a\u4e49\u4e00\u4e2aid\u9009\u62e9\u5668\u6837\u5f0f #color { color: red; } \u6807\u7b7e\u901a\u8fc7id\u5c5e\u6027\u8c03\u7528id\u6837\u5f0f <div class=\"one\" id=\"color\">caimengzhi</div> ID\u9009\u62e9\u5668\u548c\u7c7b\u9009\u62e9\u5668\u533a\u522b 1. \u9875\u9762\u4e2d\u7684ID\u9009\u62e9\u5668\u503c\u5fc5\u987b\u552f\u4e00\uff0c\u800c\u7c7b\u9009\u62e9\u5668\u53ef\u4ee5\u91cd\u590d\u3002 2. \u4e00\u4e2a\u6807\u7b7e\u53ea\u80fd\u8c03\u7528\u4e00\u4e2a\u6837\u5f0f <div class=\"p_red public\">caimengzhi</div> \u662f\u5bf9\u7684 <div id=\"p_red public\">caimengzhi</div> \u662f\u9519\u8bef","title":"3.6.2 \u4f7f\u7528"},{"location":"frontend/css/css.index/#37","text":"\u901a\u914d\u9009\u62e9\u5668\u7528\u4e00\u4e2a\u661f\u53f7\uff08*\uff09\u8868\u793a\u3002\u5355\u72ec\u4f7f\u7528\u65f6\uff0c\u8fd9\u4e2a\u9009\u62e9\u5668\u53ef\u4ee5\u4e0e\u6587\u6863\u4e2d\u7684\u4efb\u4f55\u5143\u7d20\u5339\u914d\uff0c\u5c31\u50cf\u4e00\u4e2a\u901a\u914d\u7b26\u3002 \u8bed\u6cd5 \u8bed\u6cd5\uff1a * {\u5c5e\u6027: \u503c;.....} \u4f7f\u7528\uff1a\u8be5\u9009\u62e9\u5668\u4f1a\u5c06\u9875\u9762\u4e2d\u6240\u6709\u6807\u7b7e\u90fd\u9009\u4e2d * { color: red; } \u4f1a\u5728\u6837\u5f0f\u521d\u59cb\u5316\u65f6\u5019\u4f7f\u7528\u3002","title":"3.7 \u901a\u914d\u7b26\u9009\u62e9\u5668"},{"location":"frontend/css/css.index/#37-font","text":"1. font-size \u6587\u5b57\u5927\u5c0f 2. font-weight \u6587\u5b57\u52a0\u7c97 1. normal \u5b57\u4f53\u6b63\u5e38 2. 700 \u6587\u5b57\u52a0\u7c97 3. bold \u6587\u5b57\u52a0\u7c97 4. 400 \u6b63\u5e38\u663e\u793a 3. font-style \u6587\u5b57\u659c\u4f53 1. normal \u6b63\u5e38 2. italic \u659c\u4f53 4. font-family 1. font-family: \"\u5fae\u8f6f\u96c5\u9ed1\"; 2. \u6587\u5b57\u5b57\u4f53\u8868\u793a\u65b9\u5f0f 1. \u76f4\u63a5\u8bbe\u7f6e\u5b57\u4f53\u5bf9\u5e94\u540d\u79f0\uff0c\uff08\u5b8b\u4f53\uff0c\u9ed1\u4f53\uff09 2. \u8bbe\u7f6e\u5b57\u4f53\u5bf9\u5e94\u7684\u82f1\u6587\u65b9\u5f0f 3. \u8bbe\u7f6e\u5b57\u4f53\u5bf9\u5e94\u7684unicode\u7684\u7f16\u7801 4. font-family \u4e00\u6b21\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u5b57\u4f53\uff0c\u5b57\u4f53\u5b57\u4f53\u4e4b\u95f4\u7528\u9017\u53f7\u9694\u5f00 5. line-height \u8bbe\u7f6e\u6587\u5b57\u884c\u9ad8","title":"3.7 font \u5c5e\u6027\u4ecb\u7ecd"},{"location":"frontend/css/css.index/#38-font","text":"1. font: font-weight font-style font-size/line-height font-family font: 700 italic 30px/20px \u5fae\u8f6f\u96c5\u9ed1; \u6ce8\u610f 1. \u5c5e\u6027\u8054\u5199\u4e2d\u5fc5\u987b\u8bbe\u7f6e font - size font - family 2. \u5c5e\u6027\u8054\u5199\u4e2d font - szie\u5fc5\u987b\u653e\u5230font - family\u4e4b\u524d 3. \u5982\u679c font\u5c5e\u6027\u8054\u5199\u4e2d\u7684\u5c5e\u6027\u90fd\u8981\u8bbe\u7f6e \uff0c\u90a3\u4e48\u6309\u7167\u4e0a\u8ff0\u5c5e\u6027\u53bb\u8bbe\u7f6e","title":"3.8 font \u5c5e\u6027\u8fde\u5199"},{"location":"frontend/css/css.index/#39","text":"\u590d\u5408\u9009\u62e9\u5668\u662f\u7531\u4e24\u4e2a\u6216\u591a\u4e2a\u57fa\u7840\u9009\u62e9\u5668\uff0c\u901a\u8fc7\u4e0d\u540c\u7684\u65b9\u5f0f\u7ec4\u5408\u800c\u6210\u7684,\u76ee\u7684\u662f\u4e3a\u4e86\u53ef\u4ee5\u9009\u62e9\u66f4\u51c6\u786e\u66f4\u7cbe\u7ec6\u7684\u76ee\u6807\u5143\u7d20\u6807\u7b7e","title":"3.9 \u590d\u5408\u9009\u62e9\u5668"},{"location":"frontend/css/css.index/#391","text":"\u8bed\u6cd5\uff1a \u6807\u7b7e\u540d.\u7c7b\u540d {\u5c5e\u6027: \u503c;} \u6216\u8005 \u6807\u7b7e\u540d#id\u540d {\u5c5e\u6027: \u503c;} \u5173\u7cfb \u65e2\u3002\u3002\u3002\u3002\u53c8\u3002\u3002\u3002\u3002 \u5982\u4e0b\u56fe\u6240\u6709 div.one{ color: red; } <div class=\"one\">div\u4e2d\u7684\u6587\u5b57</div> <p class=\"one\">p\u4e2d\u7684\u6587\u5b57</p> <div class=\"two\">cmz</div>","title":"3.9.1 \u6807\u7b7e\u6307\u5b9a\u5f0f\u9009\u62e9\u5668"},{"location":"frontend/css/css.index/#392","text":"\u540e\u4ee3\u9009\u62e9\u5668\uff08descendant selector\uff09\u53c8\u79f0\u4e3a\u5305\u542b\u9009\u62e9\u5668\u3002\u540e\u4ee3\u9009\u62e9\u5668\u53ef\u4ee5\u9009\u62e9\u4f5c\u4e3a\u67d0\u5143\u7d20\u540e\u4ee3\u7684\u5143\u7d20\u3002 \u8bed\u6cd5\uff1a \u9009\u62e9\u5668 \u9009\u62e9\u5668 ...{\u5c5e\u6027: \u503c;} \u6ce8\u610f 1. \u540e\u4ee3\u9009\u62e9\u5668\u6807\u7b7e\u4e4b\u95f4\u5fc5\u987b\u662f\u5d4c\u5957\u5173\u7cfb 2. \u9009\u62e9\u5668\u4e0e\u9009\u62e9\u5668\u4e4b\u95f4\u5fc5\u987b\u4f7f\u7528\u7a7a\u683c\u9694\u5f00 3. \u540e\u4ee3\u9009\u62e9\u5668\u53ea\u80fd\u9009\u4e2d\u540e\u4ee3\u5143\u7d20 ( \u6240\u6709\u540e\u4ee3 ) div span { color: red; } <div class=\"one\"> <span>\u6587\u5b571</span> <p> <span>\u6587\u5b572</span> </p> </div> <p class=\"tree\">\u6ca1\u6709\u7236\u5143\u7d20p</p> \u663e\u793a\u6548\u679c\u5982\u4e0b","title":"3.9.2 \u540e\u4ee3\u9009\u62e9\u5668"},{"location":"frontend/css/css.index/#393","text":"CSS\u5e76\u96c6\u9009\u62e9\u5668\u4e5f\u53eb\u7fa4\u9009\u62e9\u5668\uff0c\u662f\u7531\u591a\u4e2a\u9009\u62e9\u5668\u901a\u8fc7\u9017\u53f7\u8fde\u63a5\u5728\u4e00\u8d77\u7684\uff0c\u8fd9\u4e9b\u9009\u62e9\u5668\u5206\u522b\u662f\uff1a\u6807\u7b7e\u9009\u62e9\u5668\u3001\u7c7b\u9009\u62e9\u5668\u6216id\u9009\u62e9\u5668\u7b49\u3002 \u5728\u58f0\u660e\u5404\u79cdCSS\u9009\u62e9\u5668\u65f6\uff0c\u5982\u679c\u67d0\u4e9b\u9009\u62e9\u5668\u7684\u98ce\u683c\u5b8c\u5168\u76f8\u540c\uff0c\u6216\u8005\u90e8\u5206\u76f8\u540c\uff0c\u4fbf\u53ef\u4ee5\u5229\u7528\u5e76\u96c6\u9009\u62e9\u5668\u540c\u65f6\u58f0\u660e\u8fd9\u4e9b\u98ce\u683c\u76f8\u540c\u7684CSS\u9009\u62e9\u5668\u3002 \u5e76\u96c6\u9009\u62e9\u5668\u5141\u8bb8\u540c\u65f6\u7ed9\u591a\u4e2a\u9009\u62e9\u5668\u5e94\u7528\u540c\u4e00\u79cd\u6837\u5f0f\u3002 \u8bed\u6cd5\uff1a \u9009\u62e9\u5668,\u9009\u62e9\u5668...{\u5c5e\u6027: \u503c;} \u6ce8\u610f 1. \u9009\u62e9\u5668\u4e0e\u9009\u62e9\u5668\u4e4b\u95f4\u662f\u6709\u9017\u53f7\u9694\u5f00 2. \u9009\u62e9\u5668\u6807\u7b7e\u4e4b\u95f4\u7684\u7ed3\u6784\u53ef\u4ee5\u662f\u4efb\u4f55\u4e00\u79cd\u5173\u7cfb div,p,span { color: blue; } <div class=\"one\">123</div> <p class=\"one\">456</p> <span>adsdsd</span>","title":"3.9.3 \u5e76\u96c6\u9009\u62e9\u5668"},{"location":"frontend/css/css.index/#394","text":"\u4e0e\u540e\u4ee3\u9009\u62e9\u5668\u76f8\u6bd4\uff0c\u5b50\u5143\u7d20\u9009\u62e9\u5668\uff08Child selectors\uff09\u53ea\u80fd\u9009\u62e9\u4f5c\u4e3a\u67d0\u5143\u7d20\u5b50\u5143\u7d20\u7684\u5143\u7d20,\u5982\u679c\u60a8\u4e0d\u5e0c\u671b\u9009\u62e9\u4efb\u610f\u7684\u540e\u4ee3\u5143\u7d20\uff0c\u800c\u662f\u5e0c\u671b\u7f29\u5c0f\u8303\u56f4\uff0c\u53ea\u9009\u62e9\u67d0\u4e2a\u5143\u7d20\u7684\u5b50\u5143\u7d20\uff0c\u8bf7\u4f7f\u7528\u5b50\u5143\u7d20\u9009\u62e9\u5668\uff08Child selector\uff09\u3002 \u8bed\u6cd5\uff1a \u9009\u62e9\u5668>\u9009\u62e9\u5668{\u5c5e\u6027: \u503c;} ---->\u5b50\u4ee3\u5c31\u662f\u513f\u5b50\u5173\u7cfb\uff08\u4e0b\u4e00\u4ee3\uff09 \u6ce8\u610f 1. \u5b50\u4ee3\u9009\u62e9\u5668\u4e4b\u95f4\u5fc5\u987b\u662f\u5d4c\u5957\u7ed3\u6784 2. \u5b50\u4ee3\u9009\u62e9\u5668\u53ea\u80fd\u9009\u62e9\u76f4\u63a5\u540e\u4ee3\u5143\u7d20 , \u4e5f\u5c31\u662f\u513f\u5b50\u90a3\u4e00\u4ee3\uff0c 3. \u540e\u4ee3\u9009\u62e9\u5668\u53ef\u4ee5\u9009\u4e2d\u6240\u6709\u540e\u4ee3\u5143\u7d20 .one>span{ color: red; } <div class=\"one\"> <span>\u76f4\u63a5\u540e\u4ee3\u540e\u8005\u76f4\u63a5\u5b50\u4ee3</span> <p> <span>\u540e\u4ee3\u5143\u7d20</span> </p> </div> \u663e\u793a\u6548\u679c\u5982\u4e0b","title":"3.9.4 \u5b50\u4ee3\u9009\u62e9\u5668"},{"location":"frontend/css/css.index/#395","text":"\u53ef\u4ee5\u4e3a\u62e5\u6709\u6307\u5b9a\u5c5e\u6027\u7684 HTML \u5143\u7d20\u8bbe\u7f6e\u6837\u5f0f\uff0c\u800c\u4e0d\u4ec5\u9650\u4e8e class \u548c id \u5c5e\u6027\u3002 \u8bed\u6cd5\uff1a [\u5c5e\u6027\u540d]{\u5c5e\u6027: \u503c; \u628a\u5177\u6709id\u5c5e\u6027\u548cclass\u5c5e\u6027\u7684\u6807\u7b7e\u9009\u4e2d [id][class] { color: blue; } <div class=\"one\">123</div> <div class=\"one\" id=\"two\">456</div> <div class=\"one\" name=\"username\">789</div> \u663e\u793a\u6548\u679c\u5982\u4e0b \u5c5e\u6027\u9009\u62e9\u5668\u5176\u4ed6\u9009\u62e9\u65b9\u5f0f","title":"3.9.5 \u5c5e\u6027\u9009\u62e9\u5668"},{"location":"frontend/css/css.index/#3951","text":"1. [\u5c5e\u6027=\u503c]{ } /*\u5c5e\u6027\u8d4b\u503c*/ [class=\"two\"]{ color: crimson; } \u9009\u62e9\u6709class\u5c5e\u6027\u5668\u5c5e\u6027\u503c\u4e3atwo\u7684\u6807\u7b7e","title":"3.9.5.1 \u5c5e\u6027\u9009\u62e9\u5668 ="},{"location":"frontend/css/css.index/#3952","text":"2. [\u5c5e\u6027^=\u503c] [class^=\"two\"] { color: darkblue; } \u9009\u62e9\u6709calss\u5c5e\u6027\u4e14\u4ee5two\u5f00\u5934\u7684\u6807\u7b7e","title":"3.9.5.2 \u5c5e\u6027\u9009\u62e9\u5668 ^="},{"location":"frontend/css/css.index/#3953","text":"[class$=\"two\"] { color: darkblue; } \u9009\u62e9\u6709calss\u5c5e\u6027\u4e14\u4ee5two\u7ed3\u675f\u7684\u6807\u7b7e","title":"3.9.5.3 \u5c5e\u6027\u9009\u62e9\u5668 $="},{"location":"frontend/css/css.index/#3954","text":"[class*=\"two\"] { color: darkblue; } \u9009\u62e9\u6709class\u5c5e\u6027\u4e14\u53ea\u8981\u6807\u7b7e\u4e2d\u5305\u542btwo\u5c31\u884c","title":"3.9.5.4 \u5c5e\u6027\u9009\u62e9\u5668 *="},{"location":"frontend/css/css.index/#310","text":"\u7ed3\u6784\u4f2a\u7c7b\u662fCSS3\u65b0\u589e\u7684\u7c7b\u578b\u9009\u62e9\u5668\uff0c\u5229\u7528DOM\u6811\u5b9e\u73b0\u5143\u7d20\u8fc7\u6ee4\uff0c\u901a\u8fc7\u6587\u6863\u7ed3\u6784\u7684\u76f8\u4e92\u5173\u7cfb\u6765\u5339\u914d\u5143\u7d20\uff0c\u53ef\u4ee5\u51cf\u5c11class\u548cid\u5c5e\u6027\u7684\u5b9a\u4e49\uff0c\u4f7f\u6587\u6863\u53d8\u5f97\u66f4\u52a0\u7b80\u6d01","title":"3.10 \u4f2a\u7c7b\u9009\u62e9\u5668"},{"location":"frontend/css/css.index/#3101-root","text":"\u9009\u62e9\u5143\u7d20\u6240\u5728\u6587\u6863\u7684\u6839\u5143\u7d20\u3002\u5728(X)HTML\u6587\u6863\u4e2d\uff0c\u6839\u5143\u7d20\u59cb\u7ec8\u662fhtml\u5143\u7d20\u3002","title":"3.10.1 root"},{"location":"frontend/css/css.index/#3102-not","text":"\u5426\u5b9a\u9009\u62e9\u5668\uff0c\u548cjQuery\u4e2d\u7684:not\u9009\u62e9\u5668\u4e00\u6a21\u4e00\u6837\uff0c\u53ef\u4ee5\u9009\u62e9\u9664\u67d0\u4e2a\u5143\u7d20\u4e4b\u5916\u7684\u6240\u6709\u5143\u7d20\u3002 <body> <div id=\"header\">\u9875\u5934</div> <div id=\"page\">\u9875\u4f53</div> <div id=\"footer\">\u9875\u811a</div> </body> div{ padding: 10px 20px; min-height: 50px; } div:not([id=\"footer\"]){ background: pink; }","title":"3.10.2 not"},{"location":"frontend/css/css.index/#3103-empty","text":"\u7528\u6765\u9009\u62e9\u6ca1\u6709\u4efb\u4f55\u5185\u5bb9\u7684\u5143\u7d20\uff0c\u8fd9\u91cc\u6ca1\u6709\u5185\u5bb9\u6307\u7684\u662f\u4e00\u70b9\u5185\u5bb9\u90fd\u6ca1\u6709\uff0c\u54ea\u6015\u662f\u4e00\u4e2a\u7a7a\u683c\u90fd\u4e0d\u884c <body> <div>\u6211\u8fd9\u91cc\u6709\u5185\u5bb9</div> <div> </div><!-- \u6211\u8fd9\u91cc\u6709\u4e00\u4e2a\u7a7a\u683c --> <div></div><!-- \u6211\u8fd9\u91cc\u4efb\u4f55\u5185\u5bb9\u90fd\u6ca1\u6709 --> </body> div { min-height: 30px; } div:empty { background-color: green; }","title":"3.10.3 empty"},{"location":"frontend/css/css.index/#3104-first-child","text":"\u9009\u62e9F\u7684\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20(\u6240\u6709\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20\u90fd\u4f1a\u88ab\u9009\u62e9) ,\u8fd9\u91cc\u4f5c\u4e3aF(selector1)\u7684\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20\u7684\u6709 span\u3001div\u91cc\u7684p\u3001ul\u7684\u7b2c\u4e00\u4e2ali <body> <div id=\"selector1\"> <span>\u6211\u662f\u7b2c\u4e00\u4e2aspan</span> <p>\u6211\u662f\u7b2c\u4e00\u4e2ap\uff0c\u5728span\u540e\u9762</p> <div><p>\u7b2c\u4e8c\u4e2ap</p></div> <p>\u7b2c\u4e09\u4e2ap</p> <p>\u7b2c\u56db\u4e2ap</p> <em>I am em</em> <p>iewnvk</p> <ul> <li>1</li> <li>2</li> <li>3</li> <li>4</li> <li>5</li> </ul> </div> </body> #selector1 :first-child{ color: pink; } first-child\u7684\u5192\u53f7\u8981\u4e0e\u524d\u9762\u7684\u5143\u7d20\u6709\u4e00\u4e2a\u7a7a\u683c\u7684\u8ddd\u79bb\uff0c\u5426\u5219\u5b83\u4f1a\u628a\u7236\u5143\u7d20\u91cc\u6240\u6709\u7684\u5b50\u5143\u7d20\u90fd\u9009\u4e0a","title":"3.10.4 first-child"},{"location":"frontend/css/css.index/#3105-last-child","text":"\u9009\u62e9\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20 \u5404\u79cd\u53d8\u5316\u548c:first-child\u4e00\u6837\uff0c\u4e0d\u518d\u4e3e\u4f8b\u3002","title":"3.10.5 last-child"},{"location":"frontend/css/css.index/#3106-nth-childn","text":"\u7528\u6765\u5b9a\u4f4d\u67d0\u7236\u5143\u7d20\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u7279\u5b9a\u7684\u5b50\u5143\u7d20\u3002\u5176\u4e2d\u201cn\u201d\u662f\u53c2\u6570\uff0c\u53ef\u4ee5\u662f\u6574\u6570\u503c(1,2,3,4)\uff0c\u4e5f\u53ef\u4ee5\u662f\u8868\u8fbe\u5f0f(2n+1\u3001-n+5)\u548c\u5173\u952e\u8bcd(odd\u3001even)\uff0c\u53c2\u6570n\u7684\u8d77\u59cb\u503c\u59cb\u7ec8\u662f1\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u53c2\u6570n\u7684\u503c\u4e3a0\u65f6\uff0c\u9009\u62e9\u5668\u5c06\u9009\u62e9\u4e0d\u5230\u4efb\u4f55\u5339\u914d\u7684\u5143\u7d20\u3002 tr:nth-child(2n+1):\u5339\u914d\u5947\u6570\u884c\u7684tr tr:nth-child(2n):\u5339\u914d\u5076\u6570\u884c\u7684tr tr:nth-child(odd):\u5339\u914d\u5947\u6570\u884c\u7684tr tr:nth-child(even):\u5339\u914d\u5076\u6570\u884c\u7684tr tr:nth-child(4):\u5339\u914d\u7b2c\u56db\u884c\u7684tr <body> <ol> <li>item1</li> <li>item2</li> <li>item3</li> <li>item4</li> <li>item5</li> <li>item6</li> <li>item7</li> <li>item8</li> <li>item9</li> <li>item10</li> </ol> </body> ol > li:nth-child(2n-1){ background: pink; }","title":"3.10.6 nth-child(n)"},{"location":"frontend/css/css.index/#3107-nth-childn","text":"\u9009\u62e9\u5728\u5176\u7236\u5143\u7d20\u4e2d\u5012\u6570\u7b2cn\u4e2a\u4f4d\u7f6e\u7684\u5143\u7d20\u6216\u7279\u5b9a\u67d0\u5143\u7d20\u3002 \u8ba1\u7b97\u987a\u5e8f\u4e0e:nth-child\u4e0d\u540c\uff0c\u5176\u4f59\u7528\u6cd5\u76f8\u540c\uff0c\u4e0d\u518d\u4e3e\u4f8b\u3002","title":"3.10.7 nth-child(n)"},{"location":"frontend/css/css.index/#3108-first-of-type","text":"\u9009\u62e9\u5668\u7c7b\u4f3c\u4e8e\u201c:first-child\u201d\u9009\u62e9\u5668\uff0c\u4e0d\u540c\u4e4b\u5904\u5c31\u662f\u6307\u5b9a\u4e86\u5143\u7d20\u7684\u7c7b\u578b,\u5176\u4e3b\u8981\u7528\u6765\u5b9a\u4f4d\u4e00\u4e2a\u7236\u5143\u7d20\u4e0b\u7684\u67d0\u4e2a\u7c7b\u578b\u7684\u7b2c\u4e00\u4e2a\u5b50\u5143\u7d20\u3002 \u5728E:first-of-type\u529f\u80fd\u7c7b\u4f3c\u4e8eE:nth-of-type(1) <body> <div class=\"wrapper\"> <p>\u6211\u662f\u7b2c\u4e00\u4e2a\u6bb5\u843d</p> <p>\u6211\u662f\u7b2c\u4e8c\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u7b2c\u4e00\u4e2aDiv\u5143\u7d20</div> <div>\u6211\u662f\u7b2c\u4e8c\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u7b2c\u4e09\u4e2a\u6bb5\u843d</p> <p>\u6211\u662f\u7b2c\u56db\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u7b2c\u4e09\u4e2aDiv\u5143\u7d20</div> <div>\u6211\u662f\u7b2c\u56db\u4e2aDiv\u5143\u7d20</div> </div> </body> .wrapper > p, .wrapper > div { margin: 10px 0; background:#89c3eb; color: #fff; padding: 5px; } .wrapper > div:first-of-type { background: #928178; }","title":"3.10.8 first-of-type"},{"location":"frontend/css/css.index/#3109-last-of-type","text":"\u9009\u62e9\u5668\u548c\u201c:first-of-type\u201d\u9009\u62e9\u5668\u529f\u80fd\u662f\u4e00\u6837\u7684\uff0c\u4e0d\u540c\u7684\u662f\u4ed6\u9009\u62e9\u662f\u7236\u5143\u7d20\u4e0b\u7684\u67d0\u4e2a\u7c7b\u578b\u7684\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\u3002\u4e0d\u518d\u4e3e\u4f8b","title":"3.10.9 last-of-type"},{"location":"frontend/css/css.index/#31010-nth-of-typen","text":"\u9009\u62e9\u5668\u548c\u201c:nth-child(n)\u201d\u9009\u62e9\u5668\u975e\u5e38\u7c7b\u4f3c\uff0c\u4e0d\u540c\u7684\u662f\u5b83\u53ea\u8ba1\u7b97\u7236\u5143\u7d20\u4e2d\u6307\u5b9a\u7684\u67d0\u79cd\u7c7b\u578b\u7684\u5b50\u5143\u7d20[\u5373E:nth-of-type(n)]\u3002\u5f53\u67d0\u4e2a\u5143\u7d20\u4e2d\u7684\u5b50\u5143\u7d20\u4e0d\u5355\u662f\u540c\u4e00\u79cd\u7c7b\u578b\u7684\u5b50\u5143\u7d20\u65f6\uff0c\u4f7f\u7528\u201c:nth-of-type(n)\u201d\u9009\u62e9\u5668\u6765\u5b9a\u4f4d\u4e8e\u7236\u5143\u7d20\u4e2d\u67d0\u79cd\u7c7b\u578b\u7684\u5b50\u5143\u7d20\u662f\u975e\u5e38\u65b9\u4fbf\u548c\u6709\u7528\u7684\u3002\u5728\u201c:nth-of-type(n)\u201d\u9009\u62e9\u5668\u4e2d\u7684\u201cn\u201d\u548c\u201c:nth-child(n)\u201d\u9009\u62e9\u5668\u4e2d\u7684\u201cn\u201d\u53c2\u6570\u4e5f\u4e00\u6837\uff0c\u53ef\u4ee5\u662f\u5177\u4f53\u7684\u6574\u6570\uff0c\u4e5f\u53ef\u4ee5\u662f\u8868\u8fbe\u5f0f\uff0c\u8fd8\u53ef\u4ee5\u662f\u5173\u952e\u8bcd\u3002 <body> <div class=\"wrapper\"> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d\u5143\u7d20</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> </div> </body> .wrapper > div:nth-of-type(odd), .wrapper > p:nth-of-type(even){ background: #59b9c6; }","title":"3.10.10 nth-of-type(n)"},{"location":"frontend/css/css.index/#31011-nth-last-of-typen","text":"\u9009\u62e9\u5668\u548c\u201c:nth-of-type(n)\u201d\u9009\u62e9\u5668\u662f\u4e00\u6837\u7684\uff0c\u9009\u62e9\u7236\u5143\u7d20\u4e2d\u6307\u5b9a\u7684\u67d0\u79cd\u5b50\u5143\u7d20\u7c7b\u578b\uff0c\u4f46\u5b83\u7684\u8d77\u59cb\u65b9\u5411\u662f\u4ece\u6700\u540e\u4e00\u4e2a\u5b50\u5143\u7d20\u5f00\u59cb\uff0c\u800c\u4e14\u5b83\u7684\u4f7f\u7528\u65b9\u6cd5\u4e0e\u201c:nth-last-child(n)\u201d\u9009\u62e9\u5668\u4e00\u6837\uff0c\u4e0d\u518d\u4e3e\u4f8b\u3002","title":"3.10.11 nth-last-of-type(n)"},{"location":"frontend/css/css.index/#31012-only-child","text":"\u5339\u914d\u7684\u5143\u7d20\u7684\u7236\u5143\u7d20\u4e2d\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u5b50\u5143\u7d20\u3002\u3010E:only-child\u3011 <body> <ul> <li>Item1</li> <li>Item2</li> <li>Item3</li> </ul> <ul> <li>Item1</li> </ul> <ol> <li>Item1</li> </ol> <ol> <li>Item1</li> <li>Item2</li> <li>Item3</li> </ol> </body> li { background: #84b9cb; padding: 10px; margin-bottom: 5px; } li:only-child { background: #a99e93; }","title":"3.10.12 only-child"},{"location":"frontend/css/css.index/#31013-only-of-type","text":"\u9009\u62e9\u5176\u7236\u5143\u7d20\u53ea\u5305\u542b\u4e00\u4e2a\u540c\u7c7b\u578b\u7684\u5b50\u5143\u7d20 \u3010\u8868\u793a\u4e00\u4e2a\u5143\u7d20\u6709\u5f88\u591a\u4e2a\u5b50\u5143\u7d20\uff0c\u800c\u5176\u4e2d\u53ea\u6709\u4e00\u79cd\u7c7b\u578b\u7684\u5b50\u5143\u7d20\u662f\u552f\u4e00\u7684\uff0c\u4f7f\u7528\u201c:only-of-type\u201d\u9009\u62e9\u5668\u5c31\u53ef\u4ee5\u9009\u4e2d\u8fd9\u4e2a\u5143\u7d20\u4e2d\u7684\u552f\u4e00\u4e00\u4e2a\u7c7b\u578b\u5b50\u5143\u7d20\u3002\u3011 <body> <div class=\"wrapper\"> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> </div> <div class=\"wrapper\"> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> </div> <div class=\"wrapper\"> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> <p>\u6211\u662f\u4e00\u4e2a\u6bb5\u843d</p> <div>\u6211\u662f\u4e00\u4e2aDiv\u5143\u7d20</div> </div> </body> .wrapper { border: 1px solid #ccc; padding: 10px; width: 500px; margin: 10px auto; } .wrapper p:only-of-type{ background: #84b9cb; }","title":"3.10.13 only-of-type"},{"location":"frontend/css/css.index/#31014-link_visited","text":":link\u8868\u793a\u672a\u8bbf\u95ee\u7684\u8d85\u94fe\u63a5\uff0cvisite\u8868\u793a\u5df2\u8bbf\u95ee\u7684\u3002 <body> <a href=\"#\">\u6211\u672a\u8bbf\u95ee</a> <a href=\"##\">\u6211\u5df2\u8bbf\u95ee</a> </body> a:link{ color: pink; font-size: 20px; } a:visited{ color: #7b8d42; font-size: 20px; }","title":"3.10.14 link_visited"},{"location":"frontend/css/css.index/#31015-hover","text":"\u9f20\u6807\u79fb\u52a8\u5230\u94fe\u63a5\uff0c\u4e0d\u4ec5\u9650\u4e8e\u94fe\u63a5\uff0c\u53ef\u7528\u4e8e\u9875\u9762\u4e2d\u7684\u4efb\u4f55\u5143\u7d20\uff08IE6\u4e2d\u4ec5\u53ef\u7528\u4e8e\u94fe\u63a5\uff09 <body> <input type=\"text\" /> </body> input:hover{ height: 100px; background-color: #c099a0; } \u9f20\u6807\u672a\u653e\u4e0a\u53bb\u6548\u679c \u9f20\u6807\u653e\u4e0a\u53bb\u6548\u679c","title":"3.10.15 hover"},{"location":"frontend/css/css.index/#31016-active","text":"\u88ab\u6fc0\u6d3b\u65f6\u7684\u72b6\u6001\uff0c\u4e0d\u4ec5\u9650\u4e8e\u94fe\u63a5\uff0c\u53ef\u7528\u4e8e\u4efb\u4f55\u5177\u6709tabindex\u5c5e\u6027\u7684\u5143\u7d20\uff0c \u5bf9a\u6807\u7b7e\u6765\u8bf4\u5c31\u662f\u9f20\u6807\u6309\u4e0b\u53bb\u7684\u65f6\u5019 \u5728CSS\u4e2d\uff0ca:hover\u5fc5\u987b\u7f6e\u4e8ea:link\u548ca:visited\u540e\u624d\u751f\u6548\uff0ca:active\u5fc5\u987b\u7f6e\u4e8ea:hover\u540e\u624d\u751f\u6548\u3002 <body> <a href=\"#\">\u6211\u662f\u94fe\u63a5</a> </body> a:active {color:yellow;}","title":"3.10.16 active"},{"location":"frontend/css/css.index/#31017-focus","text":"\u7528\u4e8e\u8bbe\u7f6e\u83b7\u53d6\u7126\u70b9\u65f6\u7684\u6837\u5f0f\uff0c\u4e0d\u4ec5\u9650\u4e8e\u94fe\u63a5 <body> <input type=\"text\" /> </body> input:focus{ background-color: #93ca76; } \u672a\u83b7\u53d6\u7126\u70b9\u65f6\uff1a \u83b7\u53d6\u7126\u70b9\u540e\uff1a","title":"3.10.17 focus"},{"location":"frontend/css/css.index/#31018-enableddisabled","text":"\u5728Web\u7684\u8868\u5355\u4e2d\uff0c\u6709\u4e9b\u8868\u5355\u5143\u7d20\u6709\u53ef\u7528\uff08\u201c:enabled\u201d\uff09\u548c\u4e0d\u53ef\u7528\uff08\u201c:disabled\u201d\uff09\u72b6\u6001\uff0c\u6bd4\u5982\u8f93\u5165\u6846\uff0c\u5bc6\u7801\u6846\uff0c\u590d\u9009\u6846\u7b49\u3002\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e4b\u4e0b\uff0c\u8fd9\u4e9b\u8868\u5355\u5143\u7d20\u90fd\u5904\u5728\u53ef\u7528\u72b6\u6001\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4f2a\u9009\u62e9\u5668\u201c:enabled\u201d\u5bf9\u8fd9\u4e9b\u8868\u5355\u5143\u7d20\u8bbe\u7f6e\u6837\u5f0f\u3002 <body> <form action=\"#\"> <div> <label for=\"enabled\">\u53ef\u7528\u8f93\u5165\u6846:</label> <input type=\"text\" id=\"enabled\" /> </div> <div> <label for=\"disabled\">\u7981\u7528\u8f93\u5165\u6846:</label> <input type=\"text\" id=\"disabled\" disabled=\"disabled\" /> </div> </form> </body> div { margin: 30px; } input[type=\"text\"]:enabled{ border:3px solid #8491c3; box-shadow: 0 0 5px #8491c3; } input[type=\"text\"]:disabled{ box-shadow: none; }","title":"3.10.18 enabled/disabled"},{"location":"frontend/css/css.index/#31019-checked","text":"\u5728\u8868\u5355\u5143\u7d20\u4e2d\uff0c\u5355\u9009\u6309\u94ae\u548c\u590d\u9009\u6309\u94ae\u90fd\u5177\u6709\u9009\u4e2d\u548c\u672a\u9009\u4e2d\u72b6\u6001\u3002\u5728CSS3\u4e2d\u53ef\u4ee5\u901a\u8fc7\u72b6\u6001\u9009\u62e9\u5668\u201c:checked\u201d\u914d\u5408\u5176\u4ed6\u6807\u7b7e\u5b9e\u73b0\u81ea\u5b9a\u4e49\u6837\u5f0f\u3002\u800c\u201c:checked\u201d\u8868\u793a\u7684\u662f\u9009\u4e2d\u72b6\u6001\u3002 <form action=\"#\"> <div class=\"wrapper\"> <div class=\"box\"> <input type=\"radio\" checked=\"checked\" id=\"boy\" name=\"1\" /><span></span> </div> <label for=\"boy\">\u7537</label> </div> <div class=\"wrapper\"> <div class=\"box\"> <input type=\"radio\" id=\"girl\" name=\"1\" /><span></span> </div> <label for=\"girl\">\u5973</label> </div> </form> form { border: 1px solid #ccc; padding: 20px; width: 300px; margin: 30px auto; } .wrapper { margin-bottom: 10px; } .box { display: inline-block; width: 30px; height: 30px; margin-right: 10px; position: relative; background: orange; vertical-align: middle; border-radius: 100%; } .box input { opacity: 0; position: absolute; top:0; left:0; width: 100%; height:100%; z-index:100;/*\u4f7finput\u6309\u94ae\u5728span\u7684\u4e0a\u4e00\u5c42\uff0c\u4e0d\u52a0\u70b9\u51fb\u533a\u57df\u4f1a\u51fa\u73b0\u4e0d\u7075\u654f*/ } .box span { display: block; width: 10px; height: 10px; border-radius: 100%; position: absolute; background: #fff; top: 50%; left:50%; margin: -5px 0 0 -5px; z-index:1; } input[type=\"radio\"] + span { opacity: 0; } input[type=\"radio\"]:checked + span { opacity: 1; }","title":"3.10.19 checked"},{"location":"frontend/css/css.index/#31020-read-only","text":"\u7528\u6765\u6307\u5b9a\u5904\u4e8e\u53ea\u8bfb\u72b6\u6001\u5143\u7d20\u7684\u6837\u5f0f\u3002 <form action=\"#\"> <div> <label for=\"name\">\u59d3\u540d:</label> <input type=\"text\" name=\"name\" id=\"name\" placeholder=\"\u5927\u6f20\" /> </div> <div> <label for=\"address\">\u5730\u5740:</label> <input type=\"text\" name=\"address\" id=\"address\" placeholder=\"\u4e2d\u56fd\u4e0a\u6d77\" readonly=\"readonly\" /> </div> <div> <label for=\"comment\">\u8bc4\u8bba\uff1a</label> <textarea name=\"comment\" id=\"\" cols=\"30\" rows=\"10\" readonly=\"readonly\"></textarea> </div> </form> form { width: 300px; padding: 10px; border: 1px solid #ccc; margin: 50px auto; } form > div { margin-bottom: 10px; } input[type=\"text\"]{ border: 1px solid orange; padding: 5px; background: #fff; border-radius: 5px; } input[type=\"text\"]:-moz-read-only{ border-color: #ccc; } input[type=\"text\"]:read-only{ border-color: #ccc; } textarea:-moz-read-only{ border: 1px solid #ccc; height: 50px; resize: none; background: #eee; } textarea:read-only { border: 1px solid #ccc; height: 50px; resize: none; background: #eee; }","title":"3.10.20 read-only"},{"location":"frontend/css/css.index/#31021-read-write","text":"\u7528\u6765\u6307\u5b9a\u5f53\u5143\u7d20\u5904\u4e8e\u975e\u53ea\u8bfb\u72b6\u6001\u65f6\u7684\u6837\u5f0f\u3002 <form action=\"#\"> <div> <label for=\"name\">\u59d3\u540d:</label> <input type=\"text\" name=\"name\" id=\"name\" placeholder=\"\u5927\u6f20\" /> </div> <div> <label for=\"address\">\u5730\u5740:</label> <input type=\"text\" name=\"address\" id=\"address\" placeholder=\"\u4e2d\u56fd\u4e0a\u6d77\" readonly=\"readonly\" /> </div> </form> form { width: 300px; padding: 10px; border: 1px solid #ccc; margin: 50px auto; } form > div { margin-bottom: 10px; } input[type=\"text\"]{ border: 1px solid orange; padding: 5px; background: #fff; border-radius: 5px; } input[type=\"text\"]:-moz-read-only{ border-color: #ccc; } input[type=\"text\"]:read-only{ border-color: #ccc; } input[type=\"text\"]:-moz-read-write{ border:2px solid red; }","title":"3.10.21 read-write"},{"location":"frontend/css/css.index/#4-css","text":"","title":"4. CSS \u5176\u4ed6"},{"location":"frontend/css/css.index/#41","text":"\u5757\u7ea7\u5143\u7d20\uff0c\u884c\u5185\u5143\u7d20\uff0c\u884c\u5185\u5757\u5143\u7d20","title":"4.1 \u5143\u7d20\u663e\u793a\u65b9\u5f0f"},{"location":"frontend/css/css.index/#411","text":"\u4ee3\u8868\uff1a div,p,ul,ol,dl,li,dd,dt,h1...h6... \u7279\u70b9: 1. \u5757\u7ea7\u5143\u7d20\u8981\u72ec\u5360\u4e00\u884c\u663e\u793a 2. \u5757\u7ea7\u5143\u7d20\u9ed8\u8ba4\u5bbd\u5ea6\u4e0e\u7236\u5143\u7d20\u7684\u5bbd\u5ea6\u4e00\u81f4 3. \u5757\u7ea7\u5143\u7d20\u53ef\u4ee5\u8bbe\u7f6e\u5bbd\u5ea6\u548c\u9ad8\u5ea6","title":"4.1.1 \u5757\u7ea7\u5143\u7d20"},{"location":"frontend/css/css.index/#412","text":"\u4ee3\u8868\uff1a span,a,font,strong,i,s.... \u7279\u70b9\uff1a 1. \u884c\u5185\u5143\u7d20\u53ef\u4ee5\u5728\u4e00\u884c\u4e0a\u663e\u793a 2. \u884c\u5185\u5143\u7d20\u4e0d\u80fd\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 3. \u8bbe\u7f6e\u5bbd\u5ea6width \u65e0\u6548\u3002 4. \u8bbe\u7f6e\u9ad8\u5ea6height \u65e0\u6548\uff0c\u53ef\u4ee5\u901a\u8fc7line-height\u6765\u8bbe\u7f6e\u3002 5. \u8bbe\u7f6emargin \u53ea\u6709\u5de6\u53f3margin\u6709\u6548\uff0c\u4e0a\u4e0b\u65e0\u6548\u3002 6. \u8bbe\u7f6epadding \u53ea\u6709\u5de6\u53f3padding\u6709\u6548\uff0c\u4e0a\u4e0b\u5219\u65e0\u6548\u3002\u6ce8\u610f\u5143\u7d20\u8303\u56f4\u662f\u589e\u5927\u4e86\uff0c\u4f46\u662f\u5bf9\u5143\u7d20\u5468\u56f4\u7684\u5185\u5bb9\u662f\u6ca1\u5f71\u54cd\u7684\u3002","title":"4.1.2 \u884c\u5185\u5143\u7d20"},{"location":"frontend/css/css.index/#413","text":"\u4ee3\u8868\uff1a img,input..... \u7279\u70b9\uff1a 1. \u884c\u5185\u5143\u7d20\u53ef\u4ee5\u5728\u4e00\u884c\u4e0a\u663e\u793a 2. \u884c\u5185\u5143\u7d20\u53ef\u4ee5\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6","title":"4.1.3 \u884c\u5185\u5757\u5143\u7d20"},{"location":"frontend/css/css.index/#42","text":"","title":"4.2  \u5143\u7d20\u8f6c\u6362"},{"location":"frontend/css/css.index/#421","text":"\u8f6c\u5316\u4e3a\u5757\u7ea7\u5143\u7d20\uff08\u4ee5\u5757\u7ea7\u5143\u7d20\u7684\u65b9\u5f0f\u53bb\u663e\u793a\uff09,\u8bed\u6cd5\u5982\u4e0b\uff1a display\uff1ablock\uff1b \u4f8b\u5b50 a { width: 300px; #\u662f\u4e0d\u751f\u6548\u7684\uff0c\u56e0\u4e3aa\u662f\u884c\u5185\u5143\u7d20\uff0c\u4e0d\u80fd\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 height: 300px; #\u662f\u4e0d\u751f\u6548\u7684\uff0c\u56e0\u4e3aa\u662f\u884c\u5185\u5143\u7d20\uff0c\u4e0d\u80fd\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 background-color: red; } <a href=\"#\">\u884c\u5185\u5143\u7d20</a> \u6539\u4e4b\u540e a { width: 300px; height: 300px; background-color: red; /*\u8f6c\u5316\u4e3a\u5757\u5143\u7d20*/ display: block; #\u5c06\u884c\u5185\u5143\u7d20a\u8f6c\u4e3a\u5757\u7ea7\u5143\u7d20\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 } <a href=\"#\">\u884c\u5185\u5143\u7d20</a> <a href=\"#\">\u884c\u5185\u5143\u7d20</a>","title":"4.2.1 \u8f6c\u5316\u4e3a\u5757\u7ea7\u5143\u7d20"},{"location":"frontend/css/css.index/#422","text":"\u8bed\u6cd5\uff1a display\uff1ainline-block\uff1b \u4f8b\u5b50 a { width: 300px; #\u662f\u4e0d\u751f\u6548\u7684\uff0c\u56e0\u4e3aa\u662f\u884c\u5185\u5143\u7d20\uff0c\u4e0d\u80fd\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 height: 300px; #\u662f\u4e0d\u751f\u6548\u7684\uff0c\u56e0\u4e3aa\u662f\u884c\u5185\u5143\u7d20\uff0c\u4e0d\u80fd\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 background-color: red; } <a href=\"#\">\u884c\u5185\u5143\u7d20</a> a { width: 300px; height: 300px; background-color: red; /*\u8f6c\u5316\u4e3a\u5757\u5143\u7d20*/ display: inline-block; #\u5c06\u884c\u5185\u5143\u7d20a\u8f6c\u4e3a\u884c\u5185\u5757\u7ea7\u5143\u7d20\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u9ad8\u5ea6\u548c\u5bbd\u5ea6 } <a href=\"#\">\u884c\u5185\u5143\u7d20</a> <a href=\"#\">\u884c\u5185\u5143\u7d20</a>","title":"4.2.2 \u8f6c\u5316\u4e3a\u884c\u5185\u5757\u5143\u7d20"},{"location":"frontend/css/css.index/#423","text":"\u8bed\u6cd5: display\uff1ainline\uff1b \u4f8b\u5b50 a{ width: 100px; height: 100px; background-color: red; /*\u8f6c\u5316\u4e3a\u5757\u5143\u7d20*/ /*display: block;*/ /*display: inline-block;*/ display: inline; } div{ background-color: red; display: inline; width: 100px; #\u90fd\u4e0d\u542f\u4f5c\u7528\u4e86\uff0c\u56e0\u4e3adiv\u88ab\u8f6c\u4e3a\u884c\u5185\u5143\u7d20\u4e86 height: 100px; #\u90fd\u4e0d\u542f\u4f5c\u7528\u4e86\uff0c\u56e0\u4e3adiv\u88ab\u8f6c\u4e3a\u884c\u5185\u5143\u7d20\u4e86 } <div>\u6211\u662f\u884c\u5185\u5143\u7d20</div> #\u539f\u672c\u8fd9\u4e2adiv\u662f\u8981\u72ec\u5360\u4e00\u884c\u7684\uff0c\u4f46\u662fdiv\u88ab\u4e0a\u9762css\u6539\u4e3a\u884c\u5185\u5143\u7d20\u4e86\uff0c\u6240\u4ee5\u548c\u5176\u4ed6\u884c\u5185\u5143\u7d20\u5728\u4e00\u884c\u663e\u793a <a href=\"#\">\u884c\u5185\u5143\u7d20</a> <a href=\"#\">\u884c\u5185\u5143\u7d20</a> \u6ce8\u610f 1. \u53ef\u4ee5\u628a\u884c\u5185\u5143\u7d20\uff0c\u5757\u5143\u7d20\u8f6c\u5316\u6210\u4efb\u4f55\u4e00\u76f4\u5143\u7d20 2. \u884c\u5185\u5757\u5143\u7d20\u8f6c\u5316\u6210\u884c\u5185\u5143\u7d20\u6ca1\u6709\u6548\u679c 3. \u4e00\u822c\u60c5\u51b5\u4e0b\u4f1a\u5c06\u884c\u5185\u5143\u7d20\u8f6c\u6362","title":"4.2.3 \u8f6c\u5316\u4e3a\u884c\u5185\u5143\u7d20"},{"location":"frontend/css/css.index/#424","text":"\u5757\u7ea7\uff1a\u5757\u7ea7\u5143\u7d20\u4f1a\u72ec\u5360\u4e00\u884c\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5bbd\u5ea6\u81ea\u52a8\u586b\u6ee1\u5176\u7236\u5143\u7d20\u5bbd\u5ea6, \u884c\u5185\uff1a\u884c\u5185\u5143\u7d20\u4e0d\u4f1a\u72ec\u5360\u4e00\u884c\uff0c\u76f8\u90bb\u7684\u884c\u5185\u5143\u7d20\u4f1a\u6392\u5728\u540c\u4e00\u884c\u3002\u5176\u5bbd\u5ea6\u968f\u5185\u5bb9\u7684\u53d8\u5316\u800c\u53d8\u5316\u3002 \u5757\u7ea7\uff1a\u5757\u7ea7\u5143\u7d20\u53ef\u4ee5\u8bbe\u7f6e\u5bbd\u9ad8 \u884c\u5185\uff1a\u884c\u5185\u5143\u7d20\u4e0d\u53ef\u4ee5\u8bbe\u7f6e\u5bbd\u9ad8 \u5757\u7ea7\uff1a\u5757\u7ea7\u5143\u7d20\u53ef\u4ee5\u8bbe\u7f6emargin\uff0cpadding \u884c\u5185\uff1a\u884c\u5185\u5143\u7d20\u6c34\u5e73\u65b9\u5411\u7684margin-left; margin-right; padding-left; padding-right;\u53ef\u4ee5\u751f\u6548\u3002\u4f46\u662f\u7ad6\u76f4\u65b9\u5411\u7684margin-bottom; margin-top; padding-top; padding-bottom;\u5374\u4e0d\u80fd\u751f\u6548\u3002 \u5757\u7ea7\uff1adisplay:block; \u884c\u5185\uff1adisplay:inline;\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539display\u5c5e\u6027\u6765\u5207\u6362\u5757\u7ea7\u5143\u7d20\u548c\u884c\u5185\u5143\u7d20","title":"4.2.4 \u884c\u5185/\u5757\u5143\u7d20\u533a\u522b"},{"location":"frontend/css/css.index/#43-css","text":"","title":"4.3 CSS\u7279\u6027"},{"location":"frontend/css/css.index/#431","text":"\u5728\u6743\u91cd\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u7528\u4e00\u4e2a\u6807\u7b7e\u4e2d\u6837\u5f0f\u53d1\u751f\u51b2\u7a81\uff0c\u540e\u9762\u7684\u6837\u5f0f\u4f1a\u5c06\u524d\u9762\u7684\u6837\u5f0f\u7ed9\u8986\u76d6\u6389\u3002\u6837\u5f0f\u4e0e\u5b9a\u4e49\u7684\u987a\u5e8f\u6709\u5173\uff0c\u4e0e\u8c03\u7528\u7684\u987a\u5e8f\u65e0\u5173 .one{ color: red; } .two{ color: blue; } <div class=\"one two\">\u6587\u5b57</div> \u53ea\u8ddfCSS\u4e2d\u8c03\u7528\u7684\u6837\u5f0f.one \u548c .two\u7684\u987a\u5e8f\u6709\u5173\u548cdiv\u7684class\u540e\u9762\u7684one\u548ctwo\u987a\u5e8f\u65e0\u5173\uff0c\u8c03\u8bd5\u7f51\u9875\u7684\u65f6\u5019\u53d1\u4e0b\u6837\u5f0f\u8868\u683c\u4e2d\u7684red\u6a21\u5f0f\u5df2\u7ecf\u88ab\u5220\u9664\u4e86\u3002","title":"4.3.1 \u5c42\u53e0\u6027"},{"location":"frontend/css/css.index/#432","text":"\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5b50\u5143\u7d20\u6ca1\u6709\u8bbe\u7f6e\u6837\u5f0f\uff0c\u90a3\u4e48\u5b50\u5143\u7d20\u4f1a\u7ee7\u627f\u7236\u5143\u7d20\u7684\u6837\u5f0f \u53ea\u80fd\u53d1\u751f\u5728\u6807\u7b7e\u5d4c\u5957\u7ed3\u6784\u4e2d \u5bbd\u5ea6\u548c\u9ad8\u5ea6\u4e0d\u80fd\u88ab\u7ee7\u627f\uff0c\u53ea\u662f\u5757\u5143\u7d20\u7279\u70b9\u3002 \u53ef\u7ee7\u627f\u7684\u5c5e\u6027 color \u4e0efont\u5c5e\u76f8\u76f8\u5173\u7684\u90fd\u53ef\u4ee5\u7ee7\u627f\u5982font-sizes line-height\u53ef\u4ee5\u88ab\u7ee7\u627f text-align\u53ef\u4ee5\u88ab\u7ee7\u627f","title":"4.3.2 \u7ee7\u627f\u6027"},{"location":"frontend/css/css.index/#433","text":"a\u6807\u7b7e\u4e0d\u80fd\u76f4\u63a5\u63a5\u53d7\u7236\u5143\u7d20\u4e2d\u7684\u6587\u5b57\u989c\u8272\u5f71\u54cd \u6807\u9898\u6807\u7b7e(h1~h6)\u4e0d\u80fd\u76f4\u63a5\u63a5\u53d7\u7236\u5143\u7d20\u4e2d\u7684\u6587\u5b57\u5927\u5c0f\u5f71\u54cd\uff0ch1\u53d8\u4e3a2em\uff082\u500d\u6587\u5b57\u5927\u5c0f\uff09","title":"4.3.3 \u7ee7\u627f\u6027\u4e2d\u7279\u6b8a\u6807\u7b7e"},{"location":"frontend/css/css.index/#434","text":"1. \u4f18\u5148\u6743\uff08\u6743\u91cd\uff09 \u6807\u7b7e\u9009\u62e9\u5668< \u7c7b\u9009\u62e9\u5668< ID\u9009\u62e9\u5668<\u884c\u5185\u6837\u5f0f<!important \u6743\u91cd\u503c 10 100 1000 10000 10000+ 2. \u7ee7\u627f\u6743\u91cd\u4e3a0 \u6ca1\u6709\u81ea\u5df1\u6837\u5f0f\u5c31\u7ee7\u627f\uff0c\u6709\u81ea\u5df1\u6837\u5f0f\u5c31\u8986\u76d6 3. \u6743\u91cd\u53ef\u4ee5\u53e0\u52a0 div p{ color: red; } p{ color:blue; } \u6700\u7ec8\u4f1a\u662fred\uff0c\u56e0\u4e3adiv\u52a0p\u7684\u6743\u91cd\u5927\u4e8ep\u7684\u6743\u91cd\u3002 \u603b\u7ed3 1. \u901a\u8fc7\u9009\u62e9\u5668\u6307\u5411\u7684\u662f\u540c\u4e00\u4e2a\u6807\u7b7e\uff0c\u5982\u679c\u6743\u91cd\u4e0d\u4e00\u6837\uff0c\u90a3\u4e48\u53ea\u8981\u8003\u8651\u4f18\u5148\u7ea7\u3002 2. \u901a\u8fc7\u9009\u62e9\u5668\u6307\u5411\u7684\u662f\u540c\u4e00\u4e2a\u6807\u7b7e\uff0c\u5982\u679c\u6743\u91cd\u4e00\u6837\uff0c\u90a3\u4e48\u53ea\u8003\u8651\u5c42\u53e0\u6027\u3002","title":"4.3.4 \u6743\u91cd"},{"location":"frontend/css/css.index/#44","text":"","title":"4.4 \u80cc\u666f"},{"location":"frontend/css/css.index/#441","text":"background-color \u8bbe\u7f6e\u989c\u8272 \u9ed8\u8ba4\u503c\u662f\uff1atransparent \u900f\u660e\u8272","title":"4.4.1 \u80cc\u666f\u989c\u8272"},{"location":"frontend/css/css.index/#442","text":"background-image \u8bbe\u7f6e\u80cc\u666f\u56fe\u7247 1. none/url\uff08\u4f7f\u7528\u7edd\u5bf9\u6216\u8005\u76f8\u5bf9\u8def\u5f84\uff09 background-image: url(\"1.png\");","title":"4.4.2 \u80cc\u666f\u56fe\u7247"},{"location":"frontend/css/css.index/#443","text":"background-repeat \u8bbe\u7f6e\u80cc\u666f\u56fe\u7247\u5e73\u94fa 1. repeat \u9ed8\u8ba4\u503c 2. no-repeat \u4e0d\u5e73\u94fa 3. repeat-x \u6a2a\u5411\u5e73\u94fa 4. repeat-y \u7eb5\u5411\u5e73\u94fa","title":"4.4.3 \u80cc\u666f\u5e73\u94fa"},{"location":"frontend/css/css.index/#444","text":"background-position \u8bbe\u7f6e\u80cc\u666f\u56fe\u7247\u4f4d\u7f6e 1. length \u767e\u5206\u6bd4|\u6709\u6d6e\u70b9\u6570\u5b57\u548c\u5355\u4f4d\u6807\u8bc6\u7b26\u7ec4\u6210\u7684\u957f\u5ea6 2. position top|center|bottom|left|right background-position: right top; \u8bbe\u7f6e\u80cc\u666f\u56fe\u7247\u4e3a\u53f3\u4e0a\u89d2 \u6ce8\u610f 1. \u5f53\u80cc\u666f\u56fe\u7247\u8bbe\u7f6e\u4e00\u4e2a\u503c\u7684\u65f6\u5019\uff0c\u7b2c\u4e8c\u4e2a\u9ed8\u8ba4\u662f center \u3002 background - position : right \uff1b \u6b64\u65f6\u56fe\u7247\u5c31\u662f\u53f3\u4e2d\u663e\u793a 2. \u5f53\u80cc\u666f\u56fe\u7247\u4f4d\u7f6e\u51fa\u73b0\u5177\u4f53\u6570\u5b57\u7684\u65f6\u5019\uff0c\u7b2c\u4e00\u4e2a\u503c\u4ee3\u8868\u6c34\u5e73\u65b9\u5411\uff0c\u7b2c\u4e8c\u53ea\u4ee3\u8868\u5782\u76f4\u65b9\u5411\u3002","title":"4.4.4 \u80cc\u666f\u5b9a\u4f4d"},{"location":"frontend/css/css.index/#445","text":"background: red url(\"logo.png\") no-repeat right top; \u6ce8\u610f\uff1a 1. \u8be5\u5c5e\u6027\u8054\u5199\u4e2d\u6ca1\u6709\u4e2a\u6570\u9650\u5236 2. \u8be5\u5c5e\u6027\u4e2d\u6ca1\u6709\u987a\u4fbf\u9650\u5236","title":"4.4.5 \u80cc\u666f\u56fe\u7247\u8fde\u5199"},{"location":"frontend/css/css.index/#45","text":"","title":"4.5 \u884c\u9ad8"},{"location":"frontend/css/css.index/#451","text":"\u884c\u9ad8\u5c5e\u4e8e\u6587\u5b57\u7684\u5c5e\u6027 \u884c\u9ad8=\u6587\u5b57\u5927\u5c0f+\u4e0a\u95f4\u8ddd+\u4e0b\u95f4\u8ddd\uff08\u9ed8\u8ba4\u884c\u9ad8\u662f18px,\u6587\u5b57\u5927\u5c0f\u662f16px\uff0c\u4e0a\u95f4\u8ddd\u548c\u4e0b\u95f4\u8ddd\u90fd\u662f1px\uff09 \u884c\u9ad8\u7684\u4f5c\u7528\uff1a \u8bbe\u7f6e\u6587\u5b57\u5782\u76f4\u65b9\u5411\u4e2d\u6709\u95f4\u8ddd \u6587\u5b57\u5782\u76f4\u5c45\u4e2d(\u8ba9\u884c\u9ad8=\u5bb9\u5668\u7684\u9ad8\u5ea6\u5c31\u53ef\u4ee5\u4e86) \u5f71\u54cd\u884c\u9ad8 \u6587\u5b57\u5927\u5c0f\u53ef\u4ee5\u6539\u53d8\u884c\u9ad8 \u6587\u5b57\u5b57\u4f53\u4e5f\u53ef\u4ee5\u6539\u53d8\u884c\u9ad8","title":"4.5.1 \u884c\u9ad8\u7279\u6027"},{"location":"frontend/css/css.index/#452","text":"\u5982\u4f55\u7ed9\u5355\u72ec\u4e00\u4e2a\u6807\u7b7e\u8bbe\u7f6e\u884c\u9ad8 px \uff1a\u884c\u9ad8\u503c\u5c31\u662f\u8bbe\u7f6e\u7684\u5927\u5c0f,\u4e0e\u6587\u5b57\u5927\u5c0f\u6ca1\u6709\u5173\u7cfb \u63a8\u8350\u4f7f\u7528 em \uff1a\u884c\u9ad8\u503c=\u8bbe\u7f6e\u7684\u884c\u9ad8*\u6587\u5b57\u5927\u5c0f \u767e\u5206\u6bd4 : \u884c\u9ad8\u503c=\u8bbe\u7f6e\u7684\u884c\u9ad8*\u6587\u5b57\u5927\u5c0f \u4e0d\u5e26\u5355\u4f4d : \u884c\u9ad8\u503c=\u8bbe\u7f6e\u7684\u884c\u9ad8*\u6587\u5b57\u5927\u5c0f \u5982\u679c\u7ed9\u7236\u5143\u7d20\u8bbe\u7f6e\u884c\u9ad8\uff0c\u5b50\u5143\u7d20\u884c\u9ad8\u7279\u70b9 \u7236px \uff1a\u5b50\u5143\u7d20\u7684\u884c\u9ad8=\u7236\u5143\u7d20\u7684\u884c\u9ad8 \u63a8\u8350\u4f7f\u7528 \u7236em \uff1a\u5b50\u5143\u7d20\u7684\u884c\u9ad8=\u7236\u5143\u7d20\u7684\u884c\u9ad8*\u7236\u5143\u7d20\u6587\u5b57\u5927\u5c0f\uff08\u5148\u8ba1\u7b97\u540e\u7ee7\u627f\uff09 \u7236\u767e\u5206\u6bd4 : \u5b50\u5143\u7d20\u7684\u884c\u9ad8=\u7236\u5143\u7d20\u7684\u884c\u9ad8*\u7236\u5143\u7d20\u6587\u5b57\u5927\u5c0f\uff08\u5148\u8ba1\u7b97\u540e\u7ee7\u627f\uff09 \u7236\u4e0d\u5e26\u5355\u4f4d : \u5b50\u5143\u7d20\u7684\u884c\u9ad8=\u7236\u5143\u7d20\u7684\u884c\u9ad8*\u5b50\u5143\u7d20\u6587\u5b57\u5927\u5c0f\uff08\u5148\u7ee7\u627f\u540e\u8ba1\u7b97\uff09","title":"4.5.2 \u884c\u9ad8\u5355\u4f4d"},{"location":"frontend/css/css.index/#46","text":"","title":"4.6 \u76d2\u5b50\u6a21\u578b"},{"location":"frontend/css/css.index/#461","text":"\u5b9e\u73b0\u7f51\u9875\u5e03\u5c40\uff08\u5728\u7f51\u9875\u91cc\u9762\u753b\u76d2\u5b50\uff09","title":"4.6.1 \u4f5c\u7528"},{"location":"frontend/css/css.index/#462","text":"\u8fb9\u6846 border \u5185\u8fb9\u8ddd padding \u76d2\u5b50\u4e2d\u7684\u5185\u5bb9\u548c\u76d2\u5b50\u8fb9\u6846\u7684\u8ddd\u79bb \u5916\u8fb9\u754c margin \u76d2\u5b50\u4e0e\u76d2\u5b50\u4e4b\u95f4\u7684\u8ddd\u79bb","title":"4.6.2 \u7ec4\u6210"},{"location":"frontend/css/css.index/#463","text":"","title":"4.6.3 \u8fb9\u6846"},{"location":"frontend/css/css.index/#4631","text":"1. border-style: none; \u9ed8\u8ba4\u6ca1\u6709\u8fb9\u6846 a) solid \u5b9e\u7ebf b) dotted \u70b9\u7ebf c) dashed \u865a\u7ebf d) none \u6ca1\u6709\u8fb9\u6846 2. border-width: \u8fb9\u6846\u5bbd\u5ea6 3. border-color: \u8fb9\u6846\u989c\u8272 4. border\u5c5e\u6027\u8054\u5199\u4e2d a) \u5fc5\u987b\u8bbe\u7f6eborder-style b) \u6ca1\u6709\u4e66\u5e8f\u9650\u5236 5. \u5176\u4ed6\u5199\u6cd5 border-left: 2px dotted green; #\u5de6\u8fb9\u6846 border-right: 5px dashed yellow; #\u53f3\u8fb9\u6846 border-top: 3px dotted red; #\u4e0a\u8fb9\u6846 border-bottom:5px dashed darkcyan; #\u4e0b\u8fb9\u6846 border-left: 5px dashed pink; \u7b49\u4ef7\u4e8e border-left-color: pink; border-left-style: dashed; border-left-width: 5px;","title":"4.6.3.1 \u8fb9\u6846\u57fa\u672c\u8bbe\u7f6e"},{"location":"frontend/css/css.index/#4632","text":"border\uff1a0 none\uff1b #0 \u52a0\u4e0a\u4e3b\u8981\u662f\u517c\u5bb9\u6027\u9700\u8981","title":"4.6.3.2 \u53bb\u8fb9\u6846"},{"location":"frontend/css/css.index/#4633","text":"outline-style: none; \u5982input \u5bfc\u822a\u6761\u7ec3\u4e60\u4f8b\u5b50 .nav{ height: 50px; border-top: 1px solid red ; border-bottom: 1px solid pink ; background-color: #ddd; } .nav a{ text-decoration: none; heighte: 50px; display: inline-block; /*\u8bbe\u7f6e\u884c\u9ad8*/ line-height: 50px; } .nav a:hover{ background-color: #ccc; color: red; } <a href=\"#\">\u9996\u9875</a> <a href=\"#\">\u8bbe\u7f6e\u4e3a\u9996\u9875</a> Label for id \u901a\u8fc7label\u6765\u5f53\u7528\u6237\u70b9\u51fb\u6807\u7b7e\u540d\u4e5f\u53ef\u4ee5\u8f93\u5165 <label for=\"um\">\u7528\u6237\u540d: </label> <input type=\"text\" class=\"username\" id=\"um\"><br><br>","title":"4.6.3.3 \u53bb\u8f6e\u5ed3"},{"location":"frontend/css/css.index/#464","text":"\u5b9a\u4e49\uff1a\u5185\u5bb9\u4e0e\u8fb9\u6846\u4e4b\u95f4\u7684\u8ddd\u79bb \u6ce8\u610f\uff1apadding\u503c\u53ea\u80fd\u79fb\u52a8\u76d2\u5b50\u91cc\u9762\u5185\u5bb9\u3002 padding\u503c\u5c5e\u6027\u8054\u5199\uff1a 1. padding: 10px; \u8868\u793a\u4e0a\u53f3\u4e0b\u5de6\uff08\u987a\u65f6\u9488\uff09\u7684\u503c\u90fd\u662f10px 2. padding: 10px 20px; \u8868\u793a\u4e0a\u4e0b10px\uff0c\u5de6\u53f320px 3. padding: 10px 20px 30px; \u8868\u793a\u4e0a10px\uff0c\u53f320px\uff0c\u4e0b30px\uff0c\u5de620px 4. padding: 10px 20px 30px 40px; \u8868\u793a\u4e0a10px\uff0c\u53f320px\uff0c\u4e0b30px\uff0c\u5de640px \u76d2\u5b50\u95ee\u9898 \u76d2\u5b50\u5927\u5c0f\u95ee\u9898\uff1a 1. \u8fb9\u6846\u548c\u5185\u8fb9\u754c\u53ef\u4ee5\u6539\u53d8\u76d2\u5b50\u5927\u5c0f 2. \u76d2\u5b50\u5927\u5c0f\uff08\u5bbd\u5ea6\uff09 = \u5185\u5bb9\u5bbd\u5ea6 + \u5de6\u53f3\u5185\u8fb9\u8ddd + \u5de6\u53f3\u8fb9\u6846 \u5d4c\u5957\u76d2\u5b50 padding\u503c 1. \u7ee7\u627f\u7684\u76d2\u5b50\uff0c\u9ed8\u8ba4\u4e0d\u8bbe\u7f6e\u5bbd\u5ea6\u7684\u60c5\u51b5\u4e0b\uff0c\u7ed9\u5b50\u76d2\u5b50\u8bbe\u7f6e padding\u503c\u5728\u7236\u76d2\u5b50\u5bbd\u5ea6\u8303\u56f4\u5185\u4e0d\u4f1a\u5f71\u54cd\u5b50\u76d2\u5b50\u5927\u5c0f \uff0c 2. \u7ed9\u5b50\u76d2\u5b50\u8bbe\u7f6e padding\u503c\u5728\u7236\u76d2\u5b50\u5bbd\u5ea6\u8303\u56f4\u4e4b\u5916 \uff0c\u6b64\u65f6\u5b50\u76d2\u5b50\u5c31\u662f\u53d8\u5927\uff0c\u6b64\u65f6\u5df2\u7ecf\u6491\u51fa\u4e86\u5927\u76d2\u5b50\u3002","title":"4.6.4 \u5185\u8fb9\u6846"},{"location":"frontend/css/css.index/#465","text":"\u5b9a\u4e49\uff1a \u76d2\u5b50\u4e0e\u76d2\u5b50\u4e4b\u95f4\u8ddd\u79bb\uff0c\u79fb\u52a8\u76d2\u5b50\u3002 padding\u5c5e\u6027\u8054\u5199\uff1a \u4e0e\u5185\u8fb9\u8ddd\uff08padding\uff09\u4e00\u6837\u3002 \u5916\u8fb9\u754c\u4e0d\u4f1a\u6539\u53d8\u76d2\u5b50\u5927\u5c0f \u7279\u70b9: \u5782\u76f4\u5916\u8fb9\u8ddd\u5408\u5e76\uff08\u4ee5\u6700\u5927\u5916\u8fb9\u8ddd\u503c\u4e3a\u51c6\uff09 \u5782\u76f4\u5916\u8fb9\u8ddd\u584c\u9677\u3002 \u5916\u8fb9\u6846\u584c\u9677\u89e3\u51b3\u65b9\u6cd5\uff1a - \u7ed9\u7236\u5143\u7d20\u8bbe\u7f6e\u8fb9\u6846 - \u7ed9\u7236\u5143\u7d20\u8bbe\u7f6eoverflow: hidden;(\u7531\u4e8eoverflow:hidden\u89e6\u53d1\u4e86\u5143\u7d20bfc\uff08\u683c\u5f0f\u5316\u4e0a\u4e0b\u6587\uff09)","title":"4.6.5 \u5916\u8fb9\u6846"},{"location":"frontend/css/css.index/#466","text":"body,p,h1,h2,h3,h4,h5,h6,ul,ol,dl,li,dd,dt,input{ margin: 0; padding: 0; }","title":"4.6.6 \u9ed8\u8ba4\u6807\u7b7e\u5185\u5916\u8fb9\u8ddd"},{"location":"frontend/css/css.index/#47","text":"","title":"4.7 \u6d6e\u52a8"},{"location":"frontend/css/css.index/#471","text":"\u5b9a\u4e49\uff1a \u5728\u9875\u9762\u4e2d\u6807\u7b7e\uff08\u5143\u7d20\uff09\u9ed8\u8ba4\u7684\u663e\u793a\u65b9\u5f0f\u5c31\u662f\u6807\u51c6\u6d41\u7684\u663e\u793a\u65b9\u5f0f\u3002","title":"4.7.1 \u6807\u51c6\u6d41"},{"location":"frontend/css/css.index/#472","text":"\u7528\u6cd5: float: left|right; \u7279\u70b9: 1. \u6d6e\u52a8\u5143\u7d20\u4e0d\u5360\u4f4d\u7f6e\uff08\u8131\u6807\u4e86<\u8131\u79bb\u6807\u51c6\u6d41>\uff09 2. \u6d6e\u52a8\u53ef\u4ee5\u8ba9\u5757\u5143\u7d20\u5728\u4e00\u884c\u4e0a\u663e\u793a\uff08\u8131\u6807\uff09 3. \u53ef\u4ee5\u8fdb\u884c\u5143\u7d20\u7684\u6a21\u5f0f\u8f6c\u6362\uff08\u884c\u5185\uff09 \u4f5c\u7528 \u6d6e\u52a8\u7684\u51fa\u73b0\u6700\u521d\u662f\u89e3\u51b3\u56fe\u7247\u6587\u5b57\u73af\u7ed5\u6548\u679c\uff08\u5305\u88f9\u6027\uff09\u3002 2. \u8ba9\u5757\u7ea7\u5143\u7d20\u5728\u4e00\u884c\u4e0a\u663e\u793a\u5c31\u4f7f\u7528\u6d6e\u52a8\u65b9\u5f0f\u3002 1. \u5236\u4f5c\u5bfc\u822a 2. \u7f51\u9875\u5e03\u5c40","title":"4.7.2 \u6d6e\u52a8"},{"location":"frontend/css/css.index/#473","text":"","title":"4.7.3 \u6e05\u9664\u6d6e\u52a8"},{"location":"frontend/css/css.index/#4731-clear","text":"\u6e05\u9664\u65b9\u5f0f\uff1a 1. \u4f7f\u7528clear\uff1aleft|right|both \uff08\u4e0d\u662f\u4e3b\u6d41\uff09 \u5728\u6d6e\u52a8\u6807\u7b7e\u540e\u9762\u6dfb\u52a0\u4e00\u4e2aclear","title":"4.7.3.1 clear"},{"location":"frontend/css/css.index/#4732-hidden","text":"\u7236\u5143\u7d20\u8bbe\u7f6eoverflow\uff1ahidden\uff1b overflow\uff1ahidden\uff1b\u8fd8\u53ef\u4ee5\u5c06\u8d85\u51fa\u7236\u5143\u7d20\u7684\u90e8\u5206\u8fdb\u884c\u9690\u85cf","title":"4.7.3.2 hidden"},{"location":"frontend/css/css.index/#4733","text":"\u4f7f\u7528\u4f2a\u5143\u7d20\u6e05\u9664\u6d6e\u52a8\uff08\u63a8\u8350\uff09 \u5355\u4f2a\u5143\u7d20\u6e05\u9664\u6d6e\u52a8 .clearfix:after { content: \" \"; height: 0; line-height: 0; display: block; clear: both; visibility: hidden; } .clearfix { /*\u517c\u5bb9IE*/ zomm: 1; } \u6216\u8005\uff08\u53cc\u4f2a\u5143\u7d20\uff09\u6e05\u9664\u6d6e\u52a8 .clearfix:before .clearfix:after { content: \" \"; height: 0; line-height: 0; display: block; clear: both; visibility: hidden; } .clearfix { /*\u517c\u5bb9IE*/ zomm: 1; } \u6e05\u9664\u6d6e\u52a8\u7684\u65f6\u673a 1. \u7236\u5bb9\u5668\u6ca1\u6709\u9ad8\u5ea6 2. \u7236\u5bb9\u5668\u4e2d\u6240\u6709\u5b50\u5143\u7d20\u90fd\u8bbe\u7f6e\u4e86\u6d6e\u52a8 \u4ee5\u4e0a\u4e24\u4e2a\u90fd\u6ee1\u8db3\u4e86\uff0c\u624d\u80fd\u8003\u8651\u662f\u5426\u6e05\u9664\u6d6e\u52a8","title":"4.7.3.3 \u4f2a\u5143\u7d20"},{"location":"frontend/css/css.index/#474","text":"","title":"4.7.4 \u521d\u59cb\u5316"},{"location":"frontend/css/css.index/#475-overflow","text":"overflow\uff1avisible; \u9ed8\u8ba4\u503c----- /*\u9ed8\u8ba4\u503c*/ overflow: hidden; \u8d85\u51fa\u90e8\u5206\u9690\u85cf------/*\u5c06\u8d85\u51fa\u90e8\u5206\u9690\u85cf*/ overflow: scroll; \u8bbe\u7f6e\u6eda\u52a8\u6761----/*\u8d85\u4e0d\u8d85\u51fa\u90fd\u4f1a\u6709\u6eda\u52a8\u6761\u3002\u8d85\u51fa\u4f1a\u80fd\u62d6\u52a8\u6eda\u52a8\u6761\uff0c\u4e0d\u8d85\u51fa\u7684\u4e0d\u80fd\u62d6\u52a8\u6eda\u52a8\u6761*/ overflow: auto; \u81ea\u52a8-----/*\u8d85\u51fa\u90e8\u5206\u81ea\u52a8\u51fa\u73b0\u6eda\u52a8\uff0c\u4e0d\u8d85\u51fa\u7684\u60c5\u51b5\u4e0d\u51fa\u73b0\u6eda\u52a8\u6761*/","title":"4.7.5 overflow\u4ecb\u7ecd"},{"location":"frontend/css/css.index/#476","text":"","title":"4.7.6 \u4f2a\u5143\u7d20"},{"location":"frontend/css/css.index/#4761","text":"\u9009\u62e9\u5668:\u4f2a\u5143\u7d20{\u5c5e\u6027:\u503c;}","title":"4.7.6.1 \u8bed\u6cd5"},{"location":"frontend/css/css.index/#4762","text":"1. first-line \u4f2a\u5143\u7d20 \"first-line\" \u4f2a\u5143\u7d20\u7528\u4e8e\u5411\u67d0\u4e2a\u9009\u62e9\u5668\u4e2d\u7684\u6587\u5b57\u7684\u9996\u884c\u6dfb\u52a0\u7279\u6b8a\u6837\u5f0f\uff1a p{ font-size: 12pt; } p:first-line{ color: #0000FF; font-variant: small-caps; } 2. :first-letter \u4f2a\u5143\u7d20 first-letter \u4f2a\u5143\u7d20\u7528\u4e8e\u5411\u67d0\u4e2a\u9009\u62e9\u5668\u4e2d\u7684\u6587\u672c\u7684\u9996\u5b57\u6bcd\u6dfb\u52a0\u7279\u6b8a\u7684\u6837\u5f0f\uff1a p{ font-size: 12pt; } p:first-letter{ font-size: 200%; float: left; } 3. :before \u4f2a\u5143\u7d20 before \u4f2a\u5143\u7d20\u53ef\u7528\u4e8e\u5728\u67d0\u4e2a\u5143\u7d20\u4e4b\u524d\u63d2\u5165\u67d0\u4e9b\u5185\u5bb9\u3002 \u4e0b\u9762\u7684\u6837\u5f0f\u4f1a\u5728\u6807\u9898\u4e4b\u524d\u64ad\u653e\u97f3\u9891\uff1a h1:before{ content:url(beep.wav); } 4. :after \u4f2a\u5143\u7d20 after \u4f2a\u7c7b\u53ef\u7528\u4e8e\u5728\u67d0\u4e2a\u5143\u7d20\u4e4b\u540e\u63d2\u5165\u67d0\u4e9b\u5185\u5bb9\u3002 \u4e0b\u9762\u7684\u6837\u5f0f\u4f1a\u5728\u6807\u9898\u4e4b\u540e\u64ad\u653e\u97f3\u9891\uff1a h1:after{ content: url(beep.wav); } \u4f8b\u5b50 <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> <style type=\"text/css\"> .box { width: 200px; height: 300px; border: 1px solid red; } div:before,div:after { \u5728div\u4e4b\u524d\u548c\u4e4b\u540e\u6709\u4f2a\u5143\u7d20\u51fa\u73b0 content: \"\u8fd9\u662f\u4e00\u4e2aspan\"; background-color: pink; width: 120px; height: 30px; display: block; } /*\u9009\u62e9\u533a\u57df*/ div::selection { background-color: red; \u5f53\u9009\u62e9\u65f6\u5019\uff0c\u6587\u5b57\u663e\u793a\u7ea2\u8272\uff0c\u677e\u5f00\u5c31\u663e\u793a\u539f\u6765\uff0c\u989c\u8272\u5b57\u4f53 } </style> </head> <body> <div class=\"box\"> \u8fd9\u4e2a\u662f\u6b63\u6587DIV <br> \u8fd9\u4e2a\u662f\u6b63\u6587DIV <br> \u8fd9\u4e2a\u662f\u6b63\u6587DIV <br> </div> </body> </html> \u5927\u90e8\u5206\u4f2a\u5143\u7d20\u672c\u6765\u662f::\u4e5f\u5c31\u662f\u4e24\u4e2a\u5192\u53f7\u7684\uff0c\u4f46\u662f\u5f88\u591a\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\uff0c\u6240\u4ee5\u4f7f\u7528\u4e86\uff1a\u4e5f\u5c31\u662f\u4e00\u4e2a\u5192\u53f7\uff0c \u4f46\u662f\u6709\u7684\u4f2a\u5143\u7d20\u5fc5\u987b\u4f7f\u7528\uff1a\uff1a\uff0c\u800c\u4f2a\u7c7b\u662f\u4f7f\u7528\uff1a\u4e5f\u5c31\u662f\u4e00\u4e2a\u5192\u53f7\u5982div:hover{.....}","title":"4.7.6.2 \u7528\u6cd5"},{"location":"frontend/css/css.index/#48","text":"","title":"4.8 \u5b9a\u4f4d"},{"location":"frontend/css/css.index/#481","text":"\u901a\u8fc7\u5b9a\u4f4d\u53ef\u4ee5\u79fb\u52a8\u5143\u7d20\u4f4d\u7f6e\uff0c\u901a\u8fc7\u4f7f\u7528 position \u5c5e\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9 4 \u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u5b9a\u4f4d\uff0c\u8fd9\u4f1a\u5f71\u54cd\u5143\u7d20\u6846\u751f\u6210\u7684\u65b9\u5f0f\u3002 position \u5c5e\u6027\u503c\u7684\u542b\u4e49\uff1a 1. static \u9759\u6001\u5b9a\u4f4d \u5143\u7d20\u6846\u6b63\u5e38\u751f\u6210\u3002\u5757\u7ea7\u5143\u7d20\u751f\u6210\u4e00\u4e2a\u77e9\u5f62\u6846\uff0c\u4f5c\u4e3a\u6587\u6863\u6d41\u7684\u4e00\u90e8\u5206\uff0c\u884c\u5185\u5143\u7d20\u5219\u4f1a\u521b\u5efa\u4e00\u4e2a\u6216\u591a\u4e2a\u884c\u6846\uff0c\u7f6e\u4e8e\u5176\u7236\u5143\u7d20\u4e2d\u3002 2. relative \u76f8\u5bf9\u5b9a\u4f4d \u5143\u7d20\u6846\u504f\u79fb\u67d0\u4e2a\u8ddd\u79bb\u3002\u5143\u7d20\u4ecd\u4fdd\u6301\u5176\u672a\u5b9a\u4f4d\u524d\u7684\u5f62\u72b6\uff0c\u5b83\u539f\u672c\u6240\u5360\u7684\u7a7a\u95f4\u4ecd\u4fdd\u7559\u3002 3. absolute \u7edd\u5bf9\u5b9a\u4f4d \u5143\u7d20\u6846\u4ece\u6587\u6863\u6d41\u5b8c\u5168\u5220\u9664\uff0c\u5e76\u76f8\u5bf9\u4e8e\u5176\u5305\u542b\u5757\u5b9a\u4f4d\u3002\u5305\u542b\u5757\u53ef\u80fd\u662f\u6587\u6863\u4e2d\u7684\u53e6\u4e00\u4e2a\u5143\u7d20\u6216\u8005\u662f\u521d\u59cb\u5305\u542b\u5757\u3002\u5143\u7d20\u539f\u5148\u5728\u6b63\u5e38\u6587\u6863\u6d41\u4e2d\u6240\u5360\u7684\u7a7a\u95f4\u4f1a\u5173\u95ed\uff0c\u5c31\u597d\u50cf\u5143\u7d20\u539f\u6765\u4e0d\u5b58\u5728\u4e00\u6837\u3002\u5143\u7d20\u5b9a\u4f4d\u540e\u751f\u6210\u4e00\u4e2a\u5757\u7ea7\u6846\uff0c\u800c\u4e0d\u8bba\u539f\u6765\u5b83\u5728\u6b63\u5e38\u6d41\u4e2d\u751f\u6210\u4f55\u79cd\u7c7b\u578b\u7684\u6846\u3002 4. fixed \u5143\u7d20\u6846\u7684\u8868\u73b0\u7c7b\u4f3c\u4e8e\u5c06 position \u8bbe\u7f6e\u4e3a absolute\uff0c\u4e0d\u8fc7\u5176\u5305\u542b\u5757\u662f\u89c6\u7a97\u672c\u8eab\u3002 \u63d0\u793a\uff1a\u76f8\u5bf9\u5b9a\u4f4d\u5b9e\u9645\u4e0a\u88ab\u770b\u4f5c\u666e\u901a\u6d41\u5b9a\u4f4d\u6a21\u578b\u7684\u4e00\u90e8\u5206\uff0c\u56e0\u4e3a\u5143\u7d20\u7684\u4f4d\u7f6e\u76f8\u5bf9\u4e8e\u5b83\u5728\u666e\u901a\u6d41\u4e2d\u7684\u4f4d\u7f6e\u3002","title":"4.8.1 \u5c5e\u6027"},{"location":"frontend/css/css.index/#482","text":"\u5f53\u9875\u9762\u4e2d\u51fa\u73b0\u76d2\u5b50\u538b\u76d2\u5b50\u65f6\u5019\uff0c\u63a8\u8350\u4f7f\u7528\u5b9a\u4f4d\u3002 \u5b9a\u4f4d\u4f53\u73b0\u7684\u662f\u5143\u7d20\u4e4b\u95f4\u7684\u5c42\u7ea7\u5173\u7cfb\u3002","title":"4.8.2 \u4f7f\u7528\u573a\u666f\u548c\u7279\u70b9"},{"location":"frontend/css/css.index/#483","text":"\u8bed\u6cd5 position: static; left\uff1a 10px; top: 50px; bottom: 10px; right: 10px; - \u7279\u70b9 1. \u9759\u6001\u5b9a\u4f4d\u4e0d\u80fd\u79fb\u52a8\u5143\u7d20\u4f4d\u7f6e\u3002 2. \u9759\u6001\u5b9a\u4f4d\u7684\u5143\u7d20\u5c31\u662f\u6807\u51c6\u6d41\u5143\u7d20\u7684\u663e\u793a\u65b9\u5f0f\u3002","title":"4.8.3 \u9759\u6001\u5b9a\u4f4d"},{"location":"frontend/css/css.index/#484","text":"\u8bed\u6cd5\uff1a position: absolute; \u7279\u70b9 1. \u5982\u679c\u4e00\u4e2a\u5b50\u5143\u7d20\u8bbe\u7f6e\u4e86\u7edd\u5bf9\u5b9a\u4f4d\uff0c\u5982\u679c\u8be5\u5b50\u5143\u7d20\u7684\u7236\u5143\u7d20\u8bbe\u7f6e\u4e86\u9759\u6001\u5b9a\u4f4d\u6216\u8005\u6ca1\u6709\u5b9a\u4f4d\uff0c\u90a3\u4e48\u5f53\u524d\u5b50\u5143\u7d20\u662f\u4ee5body\uff08\u6d4f\u89c8\u5668\uff09\u5de6\u4e0a\u89d2\u4f5c\u4e3a\u53c2\u7167\u8fdb\u884c\u79fb\u52a8\u3002 2. \u5982\u679c\u4e00\u4e2a\u5b50\u5143\u7d20\u8bbe\u7f6e\u4e86\u7edd\u5bf9\u5b9a\u4f4d\uff0c\u5982\u679c\u8be5\u5b50\u5143\u7d20\u7684\u7236\u5143\u7d20\u8bbe\u7f6e\u4e86\u9664\u9759\u6001\u5b9a\u4f4d\u4ee5\u5916\u7684\u5176\u4ed6\u5b9a\u4f4d\uff0c\u90a3\u4e48\u5f53\u524d\u7edd\u5bf9\u5b9a\u4f4d\u7684\u5b50\u5143\u7d20\u4f1a\u4ee5\u7236\u5143\u7d20\u5de6\u4e0a\u89d2\u4e3a\u53c2\u7167\u8fdb\u884c\u79fb\u52a8\u3002 3. \u8131\u79bb\u6587\u6863\u6d41\u3002\u4e0d\u5360\u4f4d\u7f6e\u3002 4. \u8bbe\u7f6e\u4e3a\u7edd\u5bf9\u5b9a\u4f4d\u7684\u5143\u7d20\u6846\u4ece\u6587\u6863\u6d41\u5b8c\u5168\u5220\u9664\uff0c\u5e76\u76f8\u5bf9\u4e8e\u5176\u5305\u542b\u5757\u5b9a\u4f4d\uff0c\u5305\u542b\u5757\u53ef\u80fd\u662f\u6587\u6863\u4e2d\u7684\u53e6\u4e00\u4e2a\u5143\u7d20\u6216\u8005\u662f\u521d\u59cb\u5305\u542b\u5757\u3002\u5143\u7d20\u539f\u5148\u5728\u6b63\u5e38\u6587\u6863\u6d41\u4e2d\u6240\u5360\u7684\u7a7a\u95f4\u4f1a\u5173\u95ed\uff0c\u5c31\u597d\u50cf\u8be5\u5143\u7d20\u539f\u6765\u4e0d\u5b58\u5728\u4e00\u6837\u3002\u5143\u7d20\u5b9a\u4f4d\u540e\u751f\u6210\u4e00\u4e2a\u5757\u7ea7\u6846\uff0c\u800c\u4e0d\u8bba\u539f\u6765\u5b83\u5728\u6b63\u5e38\u6d41\u4e2d\u751f\u6210\u4f55\u79cd\u7c7b\u578b\u7684\u6846\u3002 \u4f8b\u5b50 #box_relative { position: absolute; left: 30px; top: 20px; } \u7edd\u5bf9\u5b9a\u4f4d\u7684\u5143\u7d20\u7684\u4f4d\u7f6e\u76f8\u5bf9\u4e8e==\u6700\u8fd1\u7684\u5df2\u5b9a\u4f4d\u7956\u5148\u5143\u7d20==\uff0c\u5982\u679c\u5143\u7d20\u6ca1\u6709\u5df2\u5b9a\u4f4d\u7684\u7956\u5148\u5143\u7d20\uff0c\u90a3\u4e48\u5b83\u7684\u4f4d\u7f6e\u76f8\u5bf9\u4e8e\u6700\u521d\u7684\u5305\u542b\u5757\u3002\u800c\u76f8\u5bf9\u5b9a\u4f4d\u662f\u201c\u76f8\u5bf9\u4e8e\u201d\u5143\u7d20\u5728\u6587\u6863\u4e2d\u7684\u521d\u59cb\u4f4d\u7f6e\uff08 \u672c\u8eab\u6e90\u4f4d\u7f6e \uff09\uff0c\u800c\u7edd\u5bf9\u5b9a\u4f4d\u662f\u201c\u76f8\u5bf9\u4e8e\u201d \u6700\u8fd1\u7684\u5df2\u5b9a\u4f4d\u7956\u5148\u5143\u7d20 \uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5df2\u5b9a\u4f4d\u7684\u7956\u5148\u5143\u7d20\uff0c\u90a3\u4e48\u201c\u76f8\u5bf9\u4e8e\u201d==\u6700\u521d\u7684\u5305\u542b==\u5757\u3002","title":"4.8.4 \u7edd\u5bf9\u5b9a\u4f4d"},{"location":"frontend/css/css.index/#485","text":"\u8bed\u6cd5 position: relative; \u7279\u70b9 1. \u76f8\u5bf9\u5b9a\u4f4d\u7684\u5143\u7d20\u5360\u4f4d\u7f6e 2. \u76f8\u5bf9\u5b9a\u4f4d\u5143\u7d20\u662f\u4ee5\u5143\u7d20\u7684\u539f\u6765\u7684\u4f4d\u7f6e\u4e3a\u53c2\u7167\u8bbe\u7f6e\u5b9a\u4f4d\u3002 3. \u76f8\u5bf9\u5b9a\u4f4d\u4e0d\u80fd\u5b9e\u73b0\u6a21\u5f0f\u8f6c\u6362 4. \u8bbe\u7f6e\u4e3a\u76f8\u5bf9\u5b9a\u4f4d\u7684\u5143\u7d20\u6846\u4f1a\u504f\u79fb\u67d0\u4e2a\u8ddd\u79bb\u3002\u5143\u7d20\u4ecd\u7136\u4fdd\u6301\u5176\u672a\u5b9a\u4f4d\u524d\u7684\u5f62\u72b6\uff0c\u5b83\u539f\u672c\u6240\u5360\u7684\u7a7a\u95f4\u4ecd\u4fdd\u7559 5. \u4e00\u822c\u60c5\u51b5\u4e0b\u8981\u8bbe\u7f6e \u5b50\u7edd\uff08\u7edd\u5bf9\u5b9a\u4f4d\uff09\u7236\u76f8\uff08\u76f8\u5bf9\u5b9a\u4f4d\uff09 \u4f8b\u5b50 #box_relative { position: relative; left: 30px; top: 20px; }","title":"4.8.5 \u76f8\u5bf9\u5b9a\u4f4d"},{"location":"frontend/css/css.index/#486","text":"\u8bed\u6cd5 position: fixed; \u7279\u70b9 1. \u56fa\u5b9a\u5b9a\u4f4d\u7684\u5143\u7d20\u59cb\u7ec8\u4ee5body\uff08\u6d4f\u89c8\u5668\uff09\u53ef\u89c6\u533a\u57df\u4e3a\u53c2\u7167\u8bbe\u7f6e\u5b9a\u4f4d 2. \u56fa\u5b9a\u5b9a\u4f4d\u7684\u5143\u7d20\u8131\u6807\u4e0d\u5360\u4f4d\u7f6e 3. \u56fa\u5b9a\u5b9a\u4f4d\u7684\u5143\u7d20\u53ef\u4ee5\u5b9e\u73b0\u6a21\u5f0f\u8f6c\u6362","title":"4.8.6 \u56fa\u5b9a\u5b9a\u4f4d"},{"location":"frontend/css/css.index/#487-z-index","text":"\u5b9a\u4f4d\u5143\u7d20\u7684\u7279\u70b9 1. \u53ea\u6709\uff08\u9664\u4e86\u9759\u6001\u5b9a\u4f4d\uff09\u5b9a\u4f4d\u7684\u5143\u7d20\u6709\u5c42\u7ea7\u5173\u7cfb\u3002\u50cf\u6d6e\u52a8\u5143\u7d20\u4ec0\u4e48\u7684\u90fd\u6ca1\u6709\u5c42\u7ea7\u5173\u7cfb 2. \u901a\u8fc7 z-index\u6539\u53d8\u5c42\u7ea7\u5173\u7cfb \u5c42\u7ea7\u5173\u7cfb 1. \u5f53\u7ed9\u4f60\u4e00\u4e2a\u5143\u7d20\u8bbe\u7f6e\u4e86\u5b9a\u4f4d\uff0c\u8be5\u5143\u7d20\u9ed8\u8ba4\u7684\u5c42\u7ea7z-index\u503c\u662fauto(0) 2. \u5f53z-index\u503c\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u90a3\u4e48\u6700\u540e\u5b9a\u4f4d\u7684\u5143\u7d20\u5c42\u7ea7\u8981\u9ad8\u4e8e\u524d\u9762\u5b9a\u4f4d\u5143\u7d20\uff08\u540e\u6765\u5c45\u4e0a\u539f\u5219\uff09 3. \u5f53z-index\u503c\u4e0d\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u90a3\u4e48z-index\u503c\u8d8a\u9ad8\uff0c\u5c42\u7ea7\u5173\u7cfb\u5c31\u8d8a\u9ad8 4. \u5982\u679c\u5b50\u5143\u7d20\u7684\u7236\u5143\u7d20\u8bbe\u7f6e\u4e86z-index\u503c\uff0c\u90a3\u4e48\u7236\u5143\u7d20\u7684z-index\u503c\u7684\u8d8a\u5927\uff0c\u8be5\u5b50\u5143\u7d20\u7684\u5c42\u7ea7\u8d8a\u9ad8","title":"4.8.7 Z-index"},{"location":"frontend/css/css.index/#488","text":"\u6807\u51c6\u6d41\u7684\u76d2\u5b50\u5c45\u4e2d\u663e\u793a\uff1amargin\uff1a0 auto; \u53ea\u662f\u8ba9\u6807\u51c6\u6d41\u76d2\u5b50\u5c45\u4e2d\u663e\u793a\uff0c\u7edd\u5bf9\u5b9a\u4f4d\u7684\u76d2\u5b50\u5c45\u4e2d\u663e\u793a\uff1a 1. left: 50%; \u7236\u5143\u7d20\u5bbd\u5ea6\u4e00\u534a 2. margin-left: -\u5143\u7d20\u81ea\u5df1\u5bbd\u5ea6\u4e00\u534a(\u5176\u4e2d\u7b26\u53f7-\u8868\u793a\u5411\u5de6\u79fb\u52a8\uff0c\u4ee3\u8868\u65b9\u5411) \u4e5f\u5c31\u662f\u5148\u6309\u7167\u7236\u5143\u7d20\u7684\u5bbd\u5ea6\u5411\u53f3\u79fb\u52a8\u5230\u7236\u5143\u7d20\u4e2d\u95f4\uff0c\u7136\u540e\u81ea\u8eab\u50cf\u5de6\u79fb\u52a8\u4e00\u534a\u3002","title":"4.8.8 \u5b9a\u4f4d\u76d2\u5b50\u5c45\u4e2d"},{"location":"frontend/css/css.index/#49","text":"","title":"4.9 \u5176\u4ed6\u8bbe\u7f6e"},{"location":"frontend/css/css.index/#491-css","text":"\u884c\u5185\u5143\u7d20\u5c3d\u91cf\u91cc\u9762\u5305\u542b\u884c\u5185\u5143\u7d20 \u4e0d\u63a8\u8350a\u91cc\u9762\u5305\u542bh\u6807\u7b7e \u6709\u4e9b\u5757\u7ea7\u5143\u7d20\u4e0d\u80fd\u5305\u542b\u5176\u4ed6\u5757\u7ea7\u5143\u7d20\u3002\u6807\u9898\u6807\u7b7e\uff0c\u6bb5\u843d\u6807\u7b7e\u4e0d\u80fd\u5305\u542bdiv\uff0c\u5c24\u5176\u662fP\u6807\u7b7e\u4e0d\u80fd\u5305\u542bdiv","title":"4.9.1 CSS \u89c4\u8303"},{"location":"frontend/css/css.index/#492","text":"\u7f51\u9875\u5e03\u5c40\u907f\u514d\u8131\u6807\u6d41 1. \u7f51\u9875\u5e03\u5c40\u4f18\u5148\u8003\u8651\u6807\u51c6\u6d41 2. \u7136\u540e\u8003\u8651\u4f7f\u7528\u6d6e\u52a8 3. \u6700\u540e\u4f7f\u7528\u5b9a\u4f4d 4. \u5143\u7d20\u6a21\u5f0f\u8f6c\u6362\uff0c\u5fc5\u987b\u4f7f\u7528display","title":"4.9.2 \u8131\u6807\u6d41"},{"location":"frontend/css/css.index/#493-vertical-align","text":"1. text-align \u6c34\u5e73\u5bf9\u9f50 2. vertical-align \u5782\u76f4\u5bf9\u9f50 3. \u9ed8\u8ba4\u884c\u5185\u5757\u5143\u7d20(img,input)\uff0c\u6709\u9ed8\u8ba4\u7684vertical-align\u5c5e\u6027\u503c vertical-align: baseline ; \u9ed8\u8ba4\u503c top ; \u9876\u90e8\u5bf9\u9f50 middle ; \u4e2d\u90e8\u5bf9\u9f50 bottom ; \u5e95\u90e8\u5bf9\u9f50","title":"4.9.3 vertical-align\u5c5e\u6027\u4ecb\u7ecd"},{"location":"frontend/css/css.index/#494","text":"overflow\uff1a hidden; \u5c06\u6ea2\u51fa\u90e8\u5206\u9690\u85cf display: none; \u5143\u7d20\u9690\u85cf\uff0c\u9690\u85cf\u540e\u5143\u7d20\u4e0d\u5360\u4f4d\u7f6e display: block; \u663e\u793a\u5143\u7d20 visibility: hidden \u5143\u7d20\u9690\u85cf\uff0c\u9690\u85cf\u540e\u5143\u7d20\u5360\u4f4d\u7f6e","title":"4.9.4 \u9690\u85cf\u65b9\u5f0f"},{"location":"frontend/css/css.index/#495-log","text":"1. logo\u4e00\u822c\u63a8\u8350\u7ed9a\u6807\u7b7e\u8bbe\u7f6e\u80cc\u666f\u56fe\u7247 2. logo\u4e2da\u6807\u7b7e\u6700\u597d\u8bbe\u7f6e\u6587\u5b57 3. text-indent: -1000px;\u8fd9\u4e2a\u503c\u662f\u8d1f\u6570\u968f\u4fbf\u5199\uff08\u9996\u884c\u7f29\u8fdb\uff09","title":"4.9.5 log\u5185\u5bb9\u79fb\u9664"},{"location":"frontend/css/css.index/#496","text":"\u5b9a\u4e49: \u662f\u4e00\u79cd\u5904\u7406\u7f51\u9875\u7279\u6b8a\u80cc\u666f\u56fe\u7247 \u5b83\u5c06\u4e00\u4e2a\u9875\u9762\u7684\u6d89\u53ca\u5230\u7684\u6240\u6709\u96f6\u661f\u80cc\u666f\u56fe\u50cf\u90fd\u96c6\u4e2d\u5230\u4e00\u5f20\u5927\u56fe\u4e2d\uff0c\u7136\u540e\u5c06\u5927\u56fe\u5e94\u7528\u4e8e\u7f51\u9875\uff0c\u8fd9\u6837\u5f53\u7528\u6237\u8bbf\u95ee\u8be5\u7f51\u9875\u7684\u65f6\u5019\uff0c\u53ea\u8981\u5411\u670d\u52a1\u5668\u53d1\u9001\u4e00\u6b21\u8bf7\u6c42\uff0c\u7f51\u9875\u4e2d\u7684\u80cc\u666f\u56fe\u50cf\u5373\u53ef\u5168\u90e8\u5c55\u793a\u51fa\u6765\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u7531\u5f88\u591a\u5c0f\u7684\u80cc\u666f\u56fe\u50cf\u5408\u6210\u5927\u56fe\u79f0\u4e3a\u7cbe\u7075\u56fe\u3002 \u4f7f\u7528\uff1a 1. \u7ed9\u5143\u7d20\u8bbe\u7f6e\u7cbe\u7075\u56fe\u4e3a\u80cc\u666f\u56fe\u7247 2. \u901a\u8fc7backgroud-position\u79fb\u52a8\u80cc\u666f\u56fe\u7247","title":"4.9.6 \u7cbe\u7075\u56fe"},{"location":"frontend/css/css.index/#497","text":"\u5b9a\u4e49\uff1a\u6839\u636e\u6587\u672c\u81ea\u9002\u5e94\u5927\u5c0f\uff0c\u6839\u636e\u80cc\u666f\u7684\u5c42\u53e0\u6027\u5236\u4f5c\uff0c\u5e76\u5141\u8bb8\u4ed6\u4eec\u5728\u5f7c\u6b64\u4e4b\u4e0a\u8fdb\u884c\u6ed1\u52a8\uff0c\u4ee5\u521b\u9020\u51fa\u4e00\u4e9b\u7279\u6b8a\u7684\u6548\u679c\u3002 \u6ce8\u610f\uff1a 1. \u5236\u4f5c\u7f51\u9875\u5bfc\u822a\u3002 2. \u6ed1\u52a8\u95e8\u5bfc\u822a\u4f7f\u7528\u80cc\u666f\u56fe\u7247\u5236\u4f5c\u3002 3. \u6ed1\u52a8\u95e8\u5bfc\u822a\u5185\u5bb9\u4e0d\u80fd\u8bbe\u7f6e\u5bbd\u5ea6\u3002 4. \u5de6\u8fb9\u56fa\u5b9a\u4e0d\u52a8\u7684\u90e8\u5206\uff0c\u80cc\u666f\u5de6\u5bf9\u9f50 5. \u53f3\u8fb9\u968f\u7740\u5185\u5bb9\u53d8\u5bbd\u7684\u90e8\u5206\uff0c\u80cc\u666f\u53f3\u5bf9\u9f50 \u4f8b\u5b50 div { float: left; } .left { width: 9px; height: 64px; background: url(\"l.png\") no-repeat; } .middle { height: 64px; line-height: 64px; background: url(\"m.png\"); } .right { width: 9px; height: 64px; background: url(\"r.png\") no-repeat; } <div class=\"left\"></div> <div class=\"middle\">\u6587\u5b57111111111111111</div> \u8fd9\u4e2a\u6587\u5b57\u8d8a\u591a\u4e2d\u95f4\u7684\u5c31\u88ab\u6491\u5f00\u8d8a\u5bbd <div class=\"right\"></div>","title":"4.9.7 \u6ed1\u52a8\u95e8"},{"location":"frontend/css/css.index/#498","text":"http://www.iconfont.cn/collections <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> <link rel=\"stylesheet\" href=\"iconfont.css\"> \u94fe\u63a5\u5f15\u7528 </head> <body> <span class=\"iconfont\">&#xe624;</span> <span class=\"iconfont\">&#xe625;</span> <span class=\"iconfont\">&#xe626;</span> <span class=\"iconfont\">&#xe62c;</span> <span class=\"iconfont\">&#xe62d;</span> <span class=\"iconfont\">&#xe62e;</span> <span class=\"iconfont\">&#xe62f;</span> </body> </html> \u8bbf\u95eeabc.html\u5c31\u663e\u793a\u53f3\u4fa7\u7684\u56fe\u6807\uff0c\u53c2\u8003\u4e0a\u56fe\u7684\u90a3\u4e09\u4e2ademohtml\uff0c\u91cc\u9762\u6709\u5177\u4f53\u7528\u6cd5","title":"4.9.8 \u56fe\u6807\u5b57\u4f53"},{"location":"frontend/vue/","text":"1. method \u00b6 \u4f60\u597d","title":"Vue"},{"location":"frontend/vue/#1-method","text":"\u4f60\u597d","title":"1. method"},{"location":"hadoop/CDH/cdh.deploy/","text":"CDH \u90e8\u7f72hadoop 1. \u90e8\u7f72\u73af\u5883 \u00b6 CDH\u662fCloudera\u516c\u53f8\u5bf9\u6574\u4f53hadoop\u96c6\u7fa4\u73af\u5883\u8fdb\u884c\u76d1\u63a7\u4e0e\u7ba1\u7406\u7684\u4f01\u4e1a\u7ea7\u5927\u6570\u636e\u7ba1\u7406\u5e73\u53f0\u3002 Cloudera Manager\u5206\u4e3a\uff1a Cloudera Manager Server\uff1a\u5bf9\u6574\u4e2a\u96c6\u7fa4\u63d0\u4f9b\u76d1\u63a7\u4e0e\u7ba1\u7406\u64cd\u4f5c\u3002Cloudera Manager Server\u901a\u8fc7\u90e8\u7f72\u5728\u4e0d\u540c\u8bbe\u5907\u4e0a\u7684Cloudera Manager Agent\u8fdb\u884c\u7ba1\u7406\u6574\u4f53\u96c6\u7fa4\u3002Cloudera Manager Server\u9700\u8981\u90e8\u7f72\u5728\u4e00\u53f0\u8bbe\u5907\u4e0a\u3002 Cloudera Manager Agent\uff1a\u90e8\u7f72\u5728\u6bcf\u4e2a\u9700\u8981\u76d1\u63a7\u4e0e\u7ba1\u7406\u7684\u8bbe\u5907\u4e0a\u3002\u8d1f\u8d23\u91c7\u96c6\u8fd0\u884c\u6570\u636e\u4e0e\u6267\u884c\u4e0b\u53d1\u7684\u7ba1\u7406\u547d\u4ee4 DataBase\uff1a\u5173\u7cfb\u578b\u6570\u636e\u5e93\u662fCloudera Manager\u6267\u884c\u7ba1\u7406\u64cd\u4f5c\u65f6\uff0c\u5b58\u50a8\u6574\u4f53\u96c6\u7fa4\u60c5\u51b5\u6570\u636e\u3002 \u5de6\u4fa7: client \u662f\u94fe\u63a5\u5230\u53f3\u4fa7\u7684server \u4e2d\u95f4: \u4e5f\u5c31\u662fclouder-manager server 1. \u5b89\u88c5\u7684\u5305\u53ef\u4ee5\u4ece\u5728\u7ebf\u5b89\u88c5\uff0c\u6216\u8005\u79bb\u7ebf\u5b89\u88c5[\u4e00\u822c\u90fd\u662f\u8fd9\u65b9\u5f0f\u5b89\u88c5]\u3002\u5305\u4e00\u5b9a\u8981\u653e\u5728/opt/cloudera/parcel-repo/\uff0c\u8fd9\u4e2a\u662f\u9ed8\u8ba4\u7684\u4f4d\u7f6e[\u6ca1\u6709\u5c31\u521b\u5efa] 2. server\u4f9d\u8d56mysql\u3002 \u4e0b\u9762: \u662fagent\uff0c\u9ed8\u8ba4\u662f15\u79d2\uff0c\u53bb\u4e3b\u52a8\u901a\u8baf\u4e00\u6b21. agent\u7684\u662f\u901a\u8fc7python \u8c03\u7528shell\u53bb\u64cd\u4f5c\u3002 \u672c\u6587\u662f\u57fa\u4e8e\u4ee5\u4e0b\u4e09\u53f0\u673a\u5668\u64cd\u4f5c\u3002\u56e0\u4e3a\u6211\u5c0f\u7c73\u7b14\u8bb0\u672c\u7684\u786c\u76d8\u4e0d\u591f\uff0c\u53ea\u80fd\u52c9\u5f3a\u8dd1\u4e09\u4e2a\u865a\u62df\u673a\u3002\u671f\u4e2dmaster\u517c\u804cagent\u3002 IP \u7cfb\u7edf \u8eab\u4efd \u4e3b\u673a\u540d \u5185\u5b58\u5206\u914d 192.168.186.128 centos7.5 master agent1 master 5GB 192.168.186.129 centos7.5 cdh agent slave1 1GB 192.168.186.137 centos7.5 cdh agent slave2 1GB master \u4e00\u5b9a\u8981\u5c3d\u53ef\u80fd\u5206\u914d\u5927\u4e00\u70b9\u3002\u5426\u5219\u5185\u5b58\u4f1a\u5751\u6b7b\u4f60\uff0cagent\u53ef\u4ee5\u5206\u914d1GB\u3002\u53cd\u6b63\u5b89\u88c5CDH\u5c3d\u91cf\u5927\u5185\u5b58\u673a\u5668 [root@slave1 ~]# lsb_release -a LSB Version: :core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarch Distributor ID: CentOS Description: CentOS Linux release 7.5.1804 (Core) Release: 7.5.1804 Codename: Core \u90e8\u7f72\u6b65\u9aa4\u5927\u81f4\u5982\u4e0b 1. \u4ee5\u975e\u56fe\u884c\u754c\u9762\u542f\u52a8 2. SSH \u4f18\u5316\uff0c\u65f6\u95f4\u540c\u6b65 3. \u4fee\u6539\u4e3b\u673a\u540d\u548chost\u6587\u4ef6 4. \u914d\u7f6e\u4ea4\u6362\u5206\u533a 5. \u5f00\u542fssh\u514d\u5bc6\u767b\u5f55 6. \u5b89\u88c5java 7. mysql 8. \u5b89\u88c5cdh 9. \u914d\u7f6ecdh\u5404\u4e2a\u670d\u52a1 10. \u914d\u7f6ehadoop \u4e2dha 11. \u542f\u52a8\u5404\u4e2a\u670d\u52a1\uff0c\u7136\u540e\u5b89\u88c5 cdh-clouder-manager\u7684\u79bb\u7ebf\u5305 cdh\u7684\u79bb\u7ebf\u5305 \u5305\u89e3\u91ca \u901a\u8fc7 clouder - manager\u5b89\u88c5hadoop\u96c6\u7fa4\u9700\u8981\u4e0b\u8f7d\u51e0\u4e2a\u5305 \u3002\u6211\u4ee5\u6211\u4e0b\u8f7d\u7684\u5305\u4e3a\u4f8b\u8bb2\u89e3 : CDH - 5.13 . 1 - 1. cdh5 . 13.1 . p0 . 2 - el7 . parcel # \u5b89\u88c5hadoop\u7684\u5305\uff0c\u6839\u636e\u81ea\u5df1\u7684\u7cfb\u7edf\u4e0b\u8f7d,el7\u662fcentos7,el6\u662fcentos6\uff0c CDH - 5.13 . 1 - 1. cdh5 . 13.1 . p0 . 2 - el7 . parcel . sha # \u5305hash\u503c cloudera - manager - centos7 - cm5 . 13.1 _x86_64 . tar . gz # clouder-manager\u5b89\u88c5\u5305 \uff0c\u6839\u636e\u81ea\u5df1\u7684\u7cfb\u7edf\u4e0b\u8f7d\uff0c\u4f8b\u5982 cloudera-manager-trusty-cm5.2.0_amd64.tar.gz\u662f\u9488\u5bf9ubuntu\u7684[lsb_release -a\u67e5\u770b] manifest . json # \u914d\u7f6e\u6587\u4ef6\u3002\u4e3b\u8981\u662f\u9488\u5bf9\uff0ccdh\u7248\u672c\u5bf9\u4e8e\u7684\u5b89\u88c5\u90a3\u4e9b\u5305\u7b49\u53c2\u6570 1.1 \u975e\u56fe\u50cf\u754c\u9762\u542f\u52a8 \u00b6 \u51cf\u5c11\u6027\u80fd\u6d88\u8017\u3002\u6211\u4ee5\u975e\u56fe\u5f62\u754c\u9762\u65b9\u5f0f\u542f\u52a8 systemctl set-default multi-user.target \u6bcf\u4e2a\u673a\u5668\u90fd\u505a\u8fd9\u4e00\u6b65 1.2 \u4fee\u6539SSH \u00b6 \u914d\u7f6essh root@ubuntu:/home/cmz# egrep -i 'PermitRootLogin|dns' /etc/ssh/sshd_config |grep -v \"#\" PermitRootLogin yes UseDNS no root@ubuntu:/home/cmz# /etc/init.d/ssh restart [ ok ] Restarting ssh (via systemctl): ssh.service. \u8bbe\u7f6e\u65f6\u533a\uff0ccdh\u4f1a\u68c0\u67e5\u5404\u4e2a\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u65f6\u95f4\u662f\u5426\u901a\u8fc7\u3002\u65f6\u95f4\u4e0d\u4e00\u81f4\u4f1a\u51fa\u73b0\u95ee\u9898\u3002 root@ubuntu:/usr/local/src/cdh# apt install ntpdate root@ubuntu:/usr/local/src/cdh# crontab -e no crontab for root - using an empty one Select an editor. To change later, run 'select-editor'. 1. /bin/ed 2. /bin/nano <---- easiest 3. /usr/bin/vim.basic 4. /usr/bin/vim.tiny Choose 1-4 [2]: 3 crontab: installing new crontab root@ubuntu:/usr/local/src/cdh# tzselect Please identify a location so that time zone rules can be set correctly. Please select a continent, ocean, \"coord\", or \"TZ\". 1) Africa 2) Americas 3) Antarctica 4) Asia 5) Atlantic Ocean 6) Australia 7) Europe 8) Indian Ocean 9) Pacific Ocean 10) coord - I want to use geographical coordinates. 11) TZ - I want to specify the time zone using the Posix TZ format. #? 4 Please select a country whose clocks agree with yours. 1) Afghanistan 18) Israel 35) Palestine 2) Armenia 19) Japan 36) Philippines 3) Azerbaijan 20) Jordan 37) Qatar 4) Bahrain 21) Kazakhstan 38) Russia 5) Bangladesh 22) Korea (North) 39) Saudi Arabia 6) Bhutan 23) Korea (South) 40) Singapore 7) Brunei 24) Kuwait 41) Sri Lanka 8) Cambodia 25) Kyrgyzstan 42) Syria 9) China 26) Laos 43) Taiwan 10) Cyprus 27) Lebanon 44) Tajikistan 11) East Timor 28) Macau 45) Thailand 12) Georgia 29) Malaysia 46) Turkmenistan 13) Hong Kong 30) Mongolia 47) United Arab Emirates 14) India 31) Myanmar (Burma) 48) Uzbekistan 15) Indonesia 32) Nepal 49) Vietnam 16) Iran 33) Oman 50) Yemen 17) Iraq 34) Pakistan #? 9 Please select one of the following time zone regions. 1) Beijing Time 2) Xinjiang Time #? 1 The following information has been given: China Beijing Time Therefore TZ='Asia/Shanghai' will be used. Local time is now: Thu Mar 28 16:51:03 CST 2019. Universal Time is now: Thu Mar 28 08:51:03 UTC 2019. Is the above information OK? 1) Yes 2) No #? 1 You can make this change permanent for yourself by appending the line TZ='Asia/Shanghai'; export TZ to the file '.profile' in your home directory; then log out and log in again. Here is that TZ value again, this time on standard output so that you can use the /usr/bin/tzselect command in shell scripts: Asia/Shanghai root@ubuntu:/usr/local/src/cdh# TZ='Asia/Shanghai'; export TZ root@ubuntu:/usr/local/src/cdh# cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime root@ubuntu:/usr/local/src/cdh# crontab -l */15 * * * * /usr/sbin/ntpdate pool.ntp.org >/dev/null 2>&1 \u4ee5\u4e0a\u4e24\u4e2a\u6b65\u9aa4\uff0c\u6bcf\u4e2a\u673a\u5668\u90fd\u505a\u8fd9\u4e00\u6b65 1.3 \u4fee\u6539\u4e3b\u673a\u540d\u548chost\u6587\u4ef6 \u00b6 echo 'master'>/etc/hostname hostname master bash echo 'save1'>/etc/hostname hostname slave1 bash echo 'slave2'>/etc/hostname hostname slave2 bash oot@ubuntu:/home/cmz# echo 'master'>/etc/hostname root@ubuntu:/home/cmz# hostname master root@ubuntu:/home/cmz# bash root@master:/home/cmz# \u6bcf\u4e2a\u673a\u5668\u90fd\u8981\u505a\u7c7b\u4f3c\u64cd\u4f5c \uff0c\u4f46\u662f\u6839\u636e\u81ea\u5df1\u7684\u8eab\u4efd\uff0c\u4fee\u6539\u6210\u81ea\u5df1\u5bf9\u5e94\u7684\u4e3b\u673a\u540d\u3002 cat>>/etc/hosts<<EOF 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 EOF \u6bcf\u4e2a\u673a\u5668\u90fd\u505a\u8fd9\u4e00\u6b65 \uff0c\u81ea\u5df1\u624b\u52a8\u914d\u7f6ehosts\u6587\u4ef6\uff0c\u8fd9\u6837\u53ef\u4ee5\u540chostname\u6765\u64cd\u4f5c\u673a\u5668\u3002\u7701\u53bb\u76f4\u63a5\u64cd\u4f5cip\u7684\u9ebb\u70e6\u3002 ping master -c1 ping slave1 -c1 ping slave2 -c1 [root@master ~]# ping master -c1 PING master (192.168.186.128) 56(84) bytes of data. 64 bytes from master (192.168.186.128): icmp_seq=1 ttl=64 time=0.018 ms --- master ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.018/0.018/0.018/0.000 ms [root@master ~]# ping slave1 -c1 PING slave1 (192.168.186.129) 56(84) bytes of data. 64 bytes from slave1 (192.168.186.129): icmp_seq=1 ttl=64 time=0.291 ms --- slave1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.291/0.291/0.291/0.000 ms [root@master ~]# ping slave2 -c1 PING slave2 (192.168.186.137) 56(84) bytes of data. 64 bytes from slave2 (192.168.186.137): icmp_seq=1 ttl=64 time=0.205 ms --- slave2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.205/0.205/0.205/0.000 ms \u4ee5\u4e0a\u6bcf\u4e2a\u673a\u5668\u6d4b\u8bd5\u4e00\u904d \uff0c\u770b\u770b\u662f\u5426\u89e3\u6790\u4e86\uff0c\u4ee5\u4e0a\u914d\u7f6e\u3002 1.4 \u4ea4\u6362\u5206\u533a \u00b6 \u5b98\u65b9\u5efa\u8bae\u662f\u8bbe\u7f6e\u4ea4\u6362\u5206\u533a\u4e3a0 echo \"0\">> /proc/sys/vm/swappiness sysctl -p cat /proc/sys/vm/swappiness \u6bcf\u4e2a\u673a\u5668\u90fd\u505a\u8fd9\u4e00\u6b65 1.5 \u514d\u5bc6\u767b\u5f55 \u00b6 \u5b98\u65b9\u8981\u6c42\uff0cCDH\u7684\u51e0\u4e2a\u673a\u5668\u8981\u505a\u7ebf\u6027\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u65e0\u5bc6\u7801\u767b\u5f55\u3002CDH\u90fd\u662f\u4ee5root\u65b9\u5f0f\u8fd0\u884c\uff0c\u6240\u4ee5\u662f\u505aroot\u7684\u514d\u5bc6\u767b\u5f55\u3002 root@master:~# ssh-keygen Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): Created directory '/root/.ssh'. Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.ssh/id_rsa. Your public key has been saved in /root/.ssh/id_rsa.pub. The key fingerprint is: SHA256:+QoiIFdrD0UatNHm7IeKBY3OBuf3Tg4WnMZ3B3helO4 root@cdh-master The key's randomart image is: +---[RSA 2048]----+ | .+.. .. | | *o. .. | | o++o o.. | |. ++.+oo +. | |o*..X...S.. | |.o=oo=o..oE | | ..++o+. . | | .o.=.. . | | .o . | +----[SHA256]-----+ \u4e00\u8def\u56de\u8f66\uff0c ssh-copy-id -i /root/.ssh/id_rsa root@master ssh-copy-id -i /root/.ssh/id_rsa root@slave1 ssh-copy-id -i /root/.ssh/id_rsa root@slave2 \u6d4b\u8bd5 [root@master ~]# ssh slave1 Last login: Mon Apr 1 11:42:48 2019 from 192.168.186.1 \u514d\u5bc6\u5230slave1\u4e0a\u4e86\u3002\u7136\u540e\u6d4b\u8bd5\u662f\u5426\u80fd\u514d\u5bc6\u5230\u5176\u4ed6\u673a\u5668\u3002 \u7136\u540e\u53e6\u5916\u7684\u4e09\u4e2a\u673a\u5668\u90fd\u6837\u64cd\u4f5c\u3002\u628a\u5404\u81ea\u7684\u516c\u7ea6\u5206\u53d1\u5230\u56db\u4e2a\u673a\u5668\u4e0a \u3002 1.6 JDK \u00b6 hadoop\u4f9d\u8d56JAVA\uff0c\u6211\u4eec\u5b89\u88c5jdk\u73af\u5883\u3002 \u5feb\u901f\u547d\u4ee4 wget http://192.168.1.31:8080/software/cmz/JDK/JDK8_112.zip \u8be6\u7ec6\u8fc7\u7a0b root@master:/usr/local/src# wget http://192.168.1.31:8080/software/cmz/JDK/JDK8_112.zip --2019-03-26 23:17:33-- http://192.168.1.31:8080/software/cmz/JDK/JDK8_112.zip Connecting to 180.96.7.219:8080... connected. HTTP request sent, awaiting response... 200 OK Length: 182583345 (174M) [application/zip] Saving to: \u2018JDK8_112.zip\u2019 JDK8_112.zip 100%[==================================>] 174.12M 3.87MB/s in 61s 2019-03-26 23:18:34 (2.83 MB/s) - \u2018JDK8_112.zip\u2019 saved [182583345/182583345] root@cdh-master:/usr/local/src# unzip JDK8_112.zip Archive: JDK8_112.zip inflating: InstallJDK8.sh inflating: jdk-8u112-linux-x64.tar.gz root@master:/usr/local/src# cat InstallJDK8.sh #!/bin/bash JDKPath=/usr/lib/jvm SourcePath=/etc/profile [ ! -f $JDKPath ] && mkdir -p $JDKPath cd $JDKPath #rm -rf * cd - [ ! -f jdk-8u112-linux-x64.tar.gz ] && echo \"The jdk-8u112-linux-x64.tar.gz file is not exist.\" tar -xf jdk-8u112-linux-x64.tar.gz -C $JDKPath >/dev/null cat >>$SourcePath<<EOF #add by caimengzhi at `date +%F` start export JAVA_HOME=$JDKPath/jdk1.8.0_112 export JRE_HOME=\\${JAVA_HOME}/jre export CLASSPATH=.:\\${JAVA_HOME}/lib:\\${JRE_HOME}/lib export PATH=\\${JAVA_HOME}/bin:\\$PATH #add by caimengzhi at `date +%F` end EOF . $SourcePath root@master:/usr/local/src# sh InstallJDK8.sh /usr/local/src root@master:/usr/local/src# source /etc/profile root@master:/usr/local/src# java -version java version \"1.8.0_112\" Java(TM) SE Runtime Environment (build 1.8.0_112-b15) Java HotSpot(TM) 64-Bit Server VM (build 25.112-b15, mixed mode) \u68c0\u67e5\uff0c\u9000\u51fa\u91cd\u65b0\u767b\u5f55\uff0c\u76f4\u63a5\u5207\u6362\u5230root\u7528\u6237\u3002 root@master:/usr/local/src# java -version java version \"1.8.0_112\" Java(TM) SE Runtime Environment (build 1.8.0_112-b15) Java HotSpot(TM) 64-Bit Server VM (build 25.112-b15, mixed mode) \u4ee5\u4e0a\u8868\u793ajdk\u73af\u5883\u51c6\u5907\u5b8c\u6bd5\u3002 \u6bcf\u4e2a\u673a\u5668\u90fd\u505a\u8fd9\u4e00\u6b65 1.7 mysql \u00b6 \u5b89\u88c5mysql\u53ea\u5728master\u4e0a\u64cd\u4f5c\uff0c\u800c\u5b89\u88c5mysql jdbc\u6bcf\u4e2a\u673a\u5668\u4e0a\u90fd\u8981\u5b89\u88c5 1.7.1 \u5b89\u88c5mysql-server \u00b6 [root@master ~]# apt-get install -y mysql-server Reading package lists... Done Building dependency tree 1.7.2 \u5b89\u88c5mysql jdbc \u00b6 [root@master ~]# apt-get install libmysql-java \u6bcf\u4e2a\u673a\u5668\u90fd\u505a\u8fd9\u4e00\u6b65 1.7.3 \u914d\u7f6e \u00b6 \u4fee\u6539mysql \u5141\u8bb8\u8fdc\u7a0b\u767b\u5f55 root@cdh-master:/usr/local/src# grep -i bind /etc/mysql/mysql.conf.d/mysqld.cnf bind-address = 0.0.0.0 root@cdh-master:/usr/local/src# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service. \u82e5\u662fmaster\u4e0a\u5b89\u88c5\u7684cdh\u53ef\u4ee5\u4e0d\u7528\u4fee\u6539\u3002 \u751f\u4ea7\u73af\u5883\u7684\u8bdd\uff0c\u522b\u91cd\u542fmysql\u3002 \u5feb\u901f\u547d\u4ee4 create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database hue DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database oozie DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database amon DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database rman DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database metastore DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database sentry DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database nav DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database navms DEFAULT CHARSET utf8 COLLATE utf8_general_ci; grant all privileges on *.* to 'root'@'cdh-master' identified by 'root' with grant option; flush privileges; \u8be6\u7ec6\u8fc7\u7a0b mysql> create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> create database hue DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> create database oozie DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.01 sec) mysql> create database amon DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> create database rman DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> create database metastore DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> create database sentry DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> create database nav DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> create database navms DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> grant all privileges on *.* to 'root'@'cdh-master' identified by 'root' with grant option; Query OK, 0 rows affected, 1 warning (0.00 sec) mysql> flush privileges; Query OK, 0 rows affected (0.00 sec) mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | amon | | hive | | hue | | metastore | | mysql | | nav | | navms | | oozie | | performance_schema | | rman | | sentry | | sys | +--------------------+ 13 rows in set (0.09 sec) 1.8 Cloud Manger C/S \u00b6 1.8.1 \u4e0b\u8f7d\u8f6f\u4ef6\u5305 \u00b6 \u5feb\u901f\u547d\u4ee4 mkdir /opt/cloudera-manager axel http://archive.cloudera.com/cm5/cm/5/cloudera-manager-centos7-cm5.13.1_x86_64.tar.gz axel http://archive.cloudera.com/cdh5/parcels/5.13.1/CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel axel http://archive.cloudera.com/cdh5/parcels/5.13.1/CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel.sha1 axel http://archive.cloudera.com/cdh5/parcels/5.13.1/manifest.json \u8be6\u7ec6\u8fc7\u7a0b [root@master parcel-repo]# cd /usr/local/src/ [root@master src]# axel http://archive.cloudera.com/cm5/cm/5/cloudera-manager-centos7-cm5.13.1_x86_64.tar.gz [root@master src]# axel http://archive.cloudera.com/cdh5/parcels/5.13.1/CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel [root@master src]# axel http://archive.cloudera.com/cdh5/parcels/5.13.1/CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel.sha1 [root@master src]# axel http://archive.cloudera.com/cdh5/parcels/5.13.1/manifest.json \u5c06\u4e0b\u8f7d\u597d\u7684cloudera-manager-trusty-cm5.13.1_amd64.tar.gz\u89e3\u538b\u5230/opt/cloudera-manager cd /opt mkdir cloudera # \u521b\u5efacloudera\u6587\u4ef6\u5939 cd cloudera mkdir parcels # \u521b\u5efaparcels\u6587\u4ef6\u5939 mkdir parcel-repo # \u521b\u5efaparcel-rep\u6587\u4ef6\u5939 cd /usr/local/src/cdh tar -zxf cloudera-manager-xenial-cm5.14.0_amd64.tar.gz -C /opt # \u89e3\u538bcm \u8be6\u7ec6\u8fc7\u7a0b [root@master ~]# cd /usr/local/src/ [root@master src]# ll total 1950296 -rw-r--r-- 1 cloudera-scm cloudera-scm 1934231261 Mar 30 21:49 CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel -rw-r--r-- 1 cloudera-scm cloudera-scm 41 Mar 30 21:42 CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel.sha -rw-r----- 1 root root 73966 Mar 30 23:57 CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel.torrent -rw-r----- 1 root root 62709760 Mar 31 00:45 CDH-5.13.3-1.cdh5.13.3.p0.2-el7.parcel.part -rw-r--r-- 1 cloudera-scm cloudera-scm 73766 Feb 23 2018 manifest.json [root@master src]# tar xf cloudera-manager-xenial-cm5.16.1_amd64.tar.gz -C /opt/ [root@master parcel-repo]# ls /opt/cloudera-manager/ cloudera cm-5.13.1 \u53ea\u5728master\u4e0a\u64cd\u4f5c 1.8.2 \u521b\u5efa\u7528\u6237 \u00b6 \u5feb\u901f\u547d\u4ee4 useradd --system --home=/opt/cloudera-manager/cm-5.13.1/run/cloudera-scm-server/ --no-create-home --shell=/bin/false --comment \"Cloudera SCM User\" cloudera-scm \u8be6\u7ec6\u8fc7\u7a0b [root@master ~]# useradd --system --home=/opt/cloudera-manager/cm-5.13.1/run/cloudera-scm-server/ --no-create-home --shell=/bin/false --comment \"Cloudera SCM User\" cloudera-scm --home \u6307\u5411\u4f60cloudera-scm-server\u7684\u8def\u5f84,\u6240\u6709\u670d\u52a1\u5668\u90fd\u8981\u914d\u7f6e\uff0c\u5176\u4ed6\u673a\u5668\u90fd\u8981\u5b89\u88c5\u7701\u7565\u3002 1.8.3 \u521b\u5efa\u5b58\u50a8\u76ee\u5f55 \u00b6 \u521b\u5efacloudera manager server\u7684\u672c\u5730\u5b58\u50a8\u76ee\u5f55 mkdir /var/log/cloudera-scm-server chown cloudera-scm:cloudera-scm /var/log/cloudera-scm-server \u8be6\u7ec6\u8fc7\u7a0b [root@master ~]# mkdir /var/log/cloudera-scm-server [root@master ~]# chown cloudera-scm:cloudera-scm /var/log/cloudera-scm-server \u53ea\u5728master\u4e0a\u64cd\u4f5c 1.8.4 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 \u00b6 [root@master ~]# cd /opt/cloudera-manager/cm-5.13.1/etc/cloudera-scm-agent/ [root@master cloudera-scm-agent]# ls config.ini [root@master cloudera-scm-agent]# sed -i \"s@server_host=localhost@server_host=cdh-master@g\" config.ini [root@master cloudera-scm-agent]# grep server_host config.ini server_host=cdh-master \u628a\u5176\u4e2d\u7684server_host\u503c\u4fee\u6539\u6210cloudera manager server\u7684IP\u3002\u4e5f\u5c31\u662fmaster \u53ea\u5728master\u4e0a\u64cd\u4f5c 1.8.5 \u5206\u53d1 \u00b6 \u5c06cloudera-manager\u53d1\u9001\u5230\u5404\u4ece\u8282\u70b9\u5bf9\u5e94\u7684\u76ee\u5f55\u4e0b(\u5373/opt) rsync -avz /opt/cloudera-manager root@cdh-agent1:/opt rsync -avz /opt/cloudera-manager root@cdh-agent2:/opt rsync -avz /opt/cloudera-manager root@cdh-agent3:/opt \u8be6\u89e3\u64cd\u4f5c\u8fc7\u7a0b [root@master ~]# rsync -avz /opt/cloudera-manager root@node1:/opt [root@master ~]# rsync -avz /opt/cloudera-manager root@node2:/opt \u68c0\u67e5 [root@slave1 ~]# ls /opt/cloudera-manager/ cm-5.13.1 [root@slave2 ~]# ls /opt/cloudera-manager/ cm-5.13.1 \u53ea\u5728master\u4e0a\u64cd\u4f5c 1.8.6 \u4e3b\u8282\u70b9\u521b\u5efaParcel\u76ee\u5f55 \u00b6 \u521b\u5efa\u5b89\u88c5\u5305\u76ee\u5f55\uff0c\u5c06CHD5\u76f8\u5173\u7684Parcel\u5305\u653e\u5230\u4e3b\u8282\u70b9\u7684/opt/cloudera/parcel-repo/\u76ee\u5f55\u4e2d [root@master ~]# mkdir -p /opt/cloudera/parcels [root@master ~]# rsync -avz /usr/local/src/cdh/* /opt/cloudera/parcel-repo/ sending incremental file list CDH-5.13.1-1.cdh5.13.1.p0.2-trusty.parcel CDH-5.13.1-1.cdh5.13.1.p0.2-trusty.parcel.sha cloudera-manager-trusty-cm5.13.1_amd64.tar.gz manifest.json sent 2,633,137,325 bytes received 92 bytes 27,572,119.55 bytes/sec total size is 2,635,696,679 speedup is 1.00 [root@master ~]# cd /opt/cloudera/parcel-repo/ [root@master parcel-repo]# ll total 1950296 -rw-r--r-- 1 cloudera-scm cloudera-scm 1934231261 Mar 30 21:49 CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel -rw-r--r-- 1 cloudera-scm cloudera-scm 41 Mar 30 21:42 CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel.sha1 -rw-r--r-- 1 cloudera-scm cloudera-scm 73766 Feb 23 2018 manifest.json \u6ce8\u610f \u4e00\u5b9a\u8981\u628a\u4e0b\u8f7d\u7684\u5305 CDH - 5.13 . 1 - 1. cdh5 . 13.1 . p0 . 2 - el7 . parcel . sha1 \uff0c\u540e\u9762\u7684 1 \u53bb\u6389\uff0c\u56e0\u4e3a\u540e\u9762\u79bb\u7ebf\u7684\u5b89\u88c5\u7684\u65f6\u5019\uff0c\u4f9d\u8d56\u8fd9\u4e2a\u5305\uff0c\u5230\u65f6\u5019\u540e\u9762\u8981\u662f\u6709 1 \uff0c\u4f1a\u81ea\u52a8\u8054\u7f51\u4e0b\u8f7d 1.8.7 \u4ece\u8282\u70b9\u521b\u5efaParcel\u76ee\u5f55 \u00b6 [root@slave1 ~]# mkdir -p /opt/cloudera/parcels [root@slave2 ~]# mkdir -p /opt/cloudera/parcels 1.8.8 \u6570\u636e\u5bfc\u5165 \u00b6 [root@master ~]# cd /opt/cloudera-manager/cm-5.13.1/share/cmf/schema/ [root@master schema]# ./scm_prepare_database.sh mysql -uroot -proot --scm-host localhost scm scm root JAVA_HOME=/usr/lib/jvm/jdk1.8.0_112 Verifying that we can write to /opt/cm-5.13.1/etc/cloudera-scm-server Thu Mar 28 02:33:23 PDT 2019 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification. Creating SCM configuration file in /opt/cm-5.13.1/etc/cloudera-scm-server groups: \u2018cloudera-scm\u2019: no such user Executing: /usr/lib/jvm/jdk1.8.0_112/bin/java -cp /usr/share/java/mysql-connector-java.jar:/usr/share/java/oracle-connector-java.jar:/usr/share/java/postgresql-connector-java.jar:/opt/cm-5.16.1/share/cmf/schema/../lib/* com.cloudera.enterprise.dbutil.DbCommandExecutor /opt/cm-5.13.1/etc/cloudera-scm-server/db.properties com.cloudera.cmf.db. Thu Mar 28 02:33:24 PDT 2019 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification. [ main] DbCommandExecutor INFO Successfully connected to database. All done, your SCM database is configured correctly! \u53ea\u6709\u770b\u5230 All done, your SCM database is configured correctly! ,\u5c31\u8868\u660e\u5bfc\u5165OK\uff0c\u82e5\u662f\u6709\u4ec0\u4e48log4j\u4ec0\u4e48\u7684\u9519\u8bef\uff0c\u53ef\u4ee5\u4e0d\u7528\u7ba1 1.8.9 \u542f\u52a8 \u00b6 [root@master ~]# /opt/cloudera-manager/cm-5.13.1/etc/init.d/cloudera-scm-server start [root@master ~]# /opt/cloudera-manager/cm-5.13.1/etc/init.d/cloudera-scm-agent start [root@slave1 ~]# /opt/cloudera-manager/cm-5.13.1/etc/init.d/cloudera-scm-agent start [root@slave2 ~]# /opt/cloudera-manager/cm-5.13.1/etc/init.d/cloudera-scm-agent start 1.8.10 \u68c0\u67e5 \u00b6 [root@master ~]# netstat -lnp|grep 7180 tcp 0 0 0.0.0.0:7180 0.0.0.0:* LISTEN 1750/java \u67e5\u770bmaster\u7aef\u76847180\u7aef\u53e3\u662f\u5426\u5b58\u5728[\u4e0d\u5b58\u5728\u5c31\u8bf4\u660e\u6709\u95ee\u9898]\u3002 \u975e\u5e38\u6ce8\u610f\uff0c\u6211\u78b0\u89c1\u7684\u95ee\u9898 \u4e0a\u5468\u6211\u672c\u5730\u6d4b\u8bd5 cdh\u7684\u65f6\u5019 \uff0c\u641e\u4e00\u5468\uff0c\u5dee\u70b9\u5d29\u6e83\uff0c\u5404\u79cd\u5947\u8469\u95ee\u9898\uff0c\u6bd4\u5982 1. \u8fd0\u884c\u8fd0\u884c\u5185\u5b58\u4e0d\u591f\uff0c\u8e66\u4e86 2. \u865a\u62df\u673a\u786c\u76d8\u4e0d\u591f\uff0c\u8e66\u4e86 3. IP\u5730\u5740\u51b2\u7a81 \uff0c\u65ad\u7f51 4. \u865a\u62df\u673a\u7684 cdh\u542f\u52a8\u6162 \uff0c\u5bfc\u81f4\u6211\u4ee5\u4e3a\u4e0d\u6b63\u5e38\uff0c\u8fd9\u5947\u8469\u95ee\u9898\u5bfc\u81f4\u6211\u90fd\u5f00\u59cb\u6000\u7591\u6211\u81ea\u5df1 5. cdh\u7248\u672c\u548c\u7cfb\u7edf\u4e0d\u4e00\u81f4 \uff0c 1.9 \u5b89\u88c5 \u00b6 \u9009\u62e9\u6700\u5de6\u8fb9\u7684\u514d\u8d39\u7248\u672c\u3002 \u70b9\u51fb\u53f3\u4fa7\u5f53\u524d\u7ba1\u7406\u7684\u4e3b\u673a\u6309\u94ae\u3002\u9009\u62e9\u6240\u6709\u673a\u5668\u3002 \u82e5\u662f\u53d1\u73b0\uff0c\u5df2\u9009\u62e9\u7684\u6b63\u5728\u4e0b\u8f7d\uff0c\u8bf4\u660e\u4e4b\u524d\u4f60\u7684\u9009\u9879\u6ca1\u6709\u9009\u62e9\u4f60\u4e4b\u524d\u4e0b\u8f7d\u7684\u5305\uff0c\u6b64\u65f6\u5373\u4f7f\u4f60\u5728\u9875\u9762\u53d6\u6d88\uff0c\u4e5f\u662f\u4e0d\u884c\u7684\u3002\u53ea\u80fd\u5728\u7cfb\u7edf\u4e0bkill\u5230\u8fdb\u7a0b\uff0c\u7136\u540e\u91cd\u65b0\u6765\u4e00\u904d\u3002\u56e0\u4e3a\u8fd9\u7cfb\u7edf\u4f1a\u5728\u540e\u53f0\u4e0b\u8f7d\u5305\uff0c\u8fd9\u5305\u90fd1.8GB\u5de6\u53f3\uff0c\u7334\u5e74\u9a6c\u6708\u624d\u80fd\u4e0b\u8f7d\u5b8c\u3002 \u7b49\u5f85\u5b89\u88c5\uff0c\u9519\u8bef\u7684\u65f6\u5019\u4f1a\u6709\u63d0\u793a\u3002\u4ee5\u4e0b\u6709\u4e2a\u63d0\u793a\u3002[\u56e0\u4e3a\u6211\u4e4b\u524d\u7cfb\u7edf\u4e0a\u5b89\u88c5\u8fc7\uff0c\u6211\u867d\u7136\u5220\u9664\u4e86\u96c6\u7fa4\u3002\u91cd\u65b0\u5b89\u88c5\u7684\u65f6\u5019\uff0c\u4e4b\u524d\u6587\u4ef6\u5939\u8fd8\u662f\u5b58\u5728\u7684\uff0c\u6240\u4ee5\u62a5\u9519\uff0c\u5220\u9664\u5373\u53ef\uff0c\u82e5\u662f\u7ebf\u4e0a\u673a\u5668\u8c28\u614e\u64cd\u4f5c\u3002] [root@master overlay2]# cd /dfs/nn [root@master nn]# ll total 12 drwxr-xr-x 2 hdfs hdfs 8192 Apr 1 11:54 current [root@master nn]# cd current/ [root@master current]# ls edits_0000000000000000001-0000000000000000079 edits_0000000000000000284-0000000000000000297 edits_0000000000000001311-0000000000000001372 edits_0000000000000000080-0000000000000000087 edits_0000000000000000298-0000000000000000311 edits_0000000000000001406-0000000000000001491 edits_0000000000000000088-0000000000000000101 edits_0000000000000000312-0000000000000000325 edits_0000000000000001492-0000000000000001505 edits_0000000000000000102-0000000000000000115 edits_0000000000000000326-0000000000000000339 edits_0000000000000001506-0000000000000001519 edits_0000000000000000116-0000000000000000129 edits_0000000000000000340-0000000000000000353 edits_0000000000000001520-0000000000000001533 edits_0000000000000000130-0000000000000000143 edits_0000000000000000354-0000000000000000367 edits_0000000000000001534-0000000000000001547 edits_0000000000000000144-0000000000000000157 edits_0000000000000000368-0000000000000000381 edits_0000000000000001548-0000000000000001561 edits_0000000000000000158-0000000000000000171 edits_0000000000000000382-0000000000000000395 edits_0000000000000001562-0000000000000001575 edits_0000000000000000172-0000000000000000185 edits_0000000000000000396-0000000000000000409 fsimage_0000000000000000000 edits_0000000000000000186-0000000000000000199 edits_0000000000000000410-0000000000000000423 fsimage_0000000000000000000.md5 edits_0000000000000000200-0000000000000000213 edits_0000000000000000424-0000000000000000437 fsimage_0000000000000000873 edits_0000000000000000214-0000000000000000227 edits_0000000000000000438-0000000000000000451 fsimage_0000000000000000873.md5 edits_0000000000000000228-0000000000000000241 edits_0000000000000000452-0000000000000000459 seen_txid edits_0000000000000000242-0000000000000000255 edits_0000000000000001133-0000000000000001145 VERSION edits_0000000000000000256-0000000000000000269 edits_0000000000000001146-0000000000000001147 edits_0000000000000000270-0000000000000000283 edits_0000000000000001148-0000000000000001148 [root@master current]# cd .. [root@master nn]# ls current [root@master nn]# cd .. [root@master dfs]# ls dn jn nn snn [root@master dfs]# rm /dfs/nn -rf \u5220\u9664\u6587\u4ef6\u5939\u540e\uff0c\u70b9\u51fb\u672c\u9875\u9762\u4e0a\u7684resume\uff0c\u91cd\u65b0\u5f00\u59cb\u3002 \u5230\u6b64cdh\u5b89\u88c5\u7684hdaoop\u96c6\u7fa4\u5b8c\u6bd5\u3002","title":"2. CDH \u90e8\u7f72"},{"location":"hadoop/CDH/cdh.deploy/#1","text":"CDH\u662fCloudera\u516c\u53f8\u5bf9\u6574\u4f53hadoop\u96c6\u7fa4\u73af\u5883\u8fdb\u884c\u76d1\u63a7\u4e0e\u7ba1\u7406\u7684\u4f01\u4e1a\u7ea7\u5927\u6570\u636e\u7ba1\u7406\u5e73\u53f0\u3002 Cloudera Manager\u5206\u4e3a\uff1a Cloudera Manager Server\uff1a\u5bf9\u6574\u4e2a\u96c6\u7fa4\u63d0\u4f9b\u76d1\u63a7\u4e0e\u7ba1\u7406\u64cd\u4f5c\u3002Cloudera Manager Server\u901a\u8fc7\u90e8\u7f72\u5728\u4e0d\u540c\u8bbe\u5907\u4e0a\u7684Cloudera Manager Agent\u8fdb\u884c\u7ba1\u7406\u6574\u4f53\u96c6\u7fa4\u3002Cloudera Manager Server\u9700\u8981\u90e8\u7f72\u5728\u4e00\u53f0\u8bbe\u5907\u4e0a\u3002 Cloudera Manager Agent\uff1a\u90e8\u7f72\u5728\u6bcf\u4e2a\u9700\u8981\u76d1\u63a7\u4e0e\u7ba1\u7406\u7684\u8bbe\u5907\u4e0a\u3002\u8d1f\u8d23\u91c7\u96c6\u8fd0\u884c\u6570\u636e\u4e0e\u6267\u884c\u4e0b\u53d1\u7684\u7ba1\u7406\u547d\u4ee4 DataBase\uff1a\u5173\u7cfb\u578b\u6570\u636e\u5e93\u662fCloudera Manager\u6267\u884c\u7ba1\u7406\u64cd\u4f5c\u65f6\uff0c\u5b58\u50a8\u6574\u4f53\u96c6\u7fa4\u60c5\u51b5\u6570\u636e\u3002 \u5de6\u4fa7: client \u662f\u94fe\u63a5\u5230\u53f3\u4fa7\u7684server \u4e2d\u95f4: \u4e5f\u5c31\u662fclouder-manager server 1. \u5b89\u88c5\u7684\u5305\u53ef\u4ee5\u4ece\u5728\u7ebf\u5b89\u88c5\uff0c\u6216\u8005\u79bb\u7ebf\u5b89\u88c5[\u4e00\u822c\u90fd\u662f\u8fd9\u65b9\u5f0f\u5b89\u88c5]\u3002\u5305\u4e00\u5b9a\u8981\u653e\u5728/opt/cloudera/parcel-repo/\uff0c\u8fd9\u4e2a\u662f\u9ed8\u8ba4\u7684\u4f4d\u7f6e[\u6ca1\u6709\u5c31\u521b\u5efa] 2. server\u4f9d\u8d56mysql\u3002 \u4e0b\u9762: \u662fagent\uff0c\u9ed8\u8ba4\u662f15\u79d2\uff0c\u53bb\u4e3b\u52a8\u901a\u8baf\u4e00\u6b21. agent\u7684\u662f\u901a\u8fc7python \u8c03\u7528shell\u53bb\u64cd\u4f5c\u3002 \u672c\u6587\u662f\u57fa\u4e8e\u4ee5\u4e0b\u4e09\u53f0\u673a\u5668\u64cd\u4f5c\u3002\u56e0\u4e3a\u6211\u5c0f\u7c73\u7b14\u8bb0\u672c\u7684\u786c\u76d8\u4e0d\u591f\uff0c\u53ea\u80fd\u52c9\u5f3a\u8dd1\u4e09\u4e2a\u865a\u62df\u673a\u3002\u671f\u4e2dmaster\u517c\u804cagent\u3002 IP \u7cfb\u7edf \u8eab\u4efd \u4e3b\u673a\u540d \u5185\u5b58\u5206\u914d 192.168.186.128 centos7.5 master agent1 master 5GB 192.168.186.129 centos7.5 cdh agent slave1 1GB 192.168.186.137 centos7.5 cdh agent slave2 1GB master \u4e00\u5b9a\u8981\u5c3d\u53ef\u80fd\u5206\u914d\u5927\u4e00\u70b9\u3002\u5426\u5219\u5185\u5b58\u4f1a\u5751\u6b7b\u4f60\uff0cagent\u53ef\u4ee5\u5206\u914d1GB\u3002\u53cd\u6b63\u5b89\u88c5CDH\u5c3d\u91cf\u5927\u5185\u5b58\u673a\u5668 [root@slave1 ~]# lsb_release -a LSB Version: :core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarch Distributor ID: CentOS Description: CentOS Linux release 7.5.1804 (Core) Release: 7.5.1804 Codename: Core \u90e8\u7f72\u6b65\u9aa4\u5927\u81f4\u5982\u4e0b 1. \u4ee5\u975e\u56fe\u884c\u754c\u9762\u542f\u52a8 2. SSH \u4f18\u5316\uff0c\u65f6\u95f4\u540c\u6b65 3. \u4fee\u6539\u4e3b\u673a\u540d\u548chost\u6587\u4ef6 4. \u914d\u7f6e\u4ea4\u6362\u5206\u533a 5. \u5f00\u542fssh\u514d\u5bc6\u767b\u5f55 6. \u5b89\u88c5java 7. mysql 8. \u5b89\u88c5cdh 9. \u914d\u7f6ecdh\u5404\u4e2a\u670d\u52a1 10. \u914d\u7f6ehadoop \u4e2dha 11. \u542f\u52a8\u5404\u4e2a\u670d\u52a1\uff0c\u7136\u540e\u5b89\u88c5 cdh-clouder-manager\u7684\u79bb\u7ebf\u5305 cdh\u7684\u79bb\u7ebf\u5305 \u5305\u89e3\u91ca \u901a\u8fc7 clouder - manager\u5b89\u88c5hadoop\u96c6\u7fa4\u9700\u8981\u4e0b\u8f7d\u51e0\u4e2a\u5305 \u3002\u6211\u4ee5\u6211\u4e0b\u8f7d\u7684\u5305\u4e3a\u4f8b\u8bb2\u89e3 : CDH - 5.13 . 1 - 1. cdh5 . 13.1 . p0 . 2 - el7 . parcel # \u5b89\u88c5hadoop\u7684\u5305\uff0c\u6839\u636e\u81ea\u5df1\u7684\u7cfb\u7edf\u4e0b\u8f7d,el7\u662fcentos7,el6\u662fcentos6\uff0c CDH - 5.13 . 1 - 1. cdh5 . 13.1 . p0 . 2 - el7 . parcel . sha # \u5305hash\u503c cloudera - manager - centos7 - cm5 . 13.1 _x86_64 . tar . gz # clouder-manager\u5b89\u88c5\u5305 \uff0c\u6839\u636e\u81ea\u5df1\u7684\u7cfb\u7edf\u4e0b\u8f7d\uff0c\u4f8b\u5982 cloudera-manager-trusty-cm5.2.0_amd64.tar.gz\u662f\u9488\u5bf9ubuntu\u7684[lsb_release -a\u67e5\u770b] manifest . json # \u914d\u7f6e\u6587\u4ef6\u3002\u4e3b\u8981\u662f\u9488\u5bf9\uff0ccdh\u7248\u672c\u5bf9\u4e8e\u7684\u5b89\u88c5\u90a3\u4e9b\u5305\u7b49\u53c2\u6570","title":"1. \u90e8\u7f72\u73af\u5883"},{"location":"hadoop/CDH/cdh.deploy/#11","text":"\u51cf\u5c11\u6027\u80fd\u6d88\u8017\u3002\u6211\u4ee5\u975e\u56fe\u5f62\u754c\u9762\u65b9\u5f0f\u542f\u52a8 systemctl set-default multi-user.target \u6bcf\u4e2a\u673a\u5668\u90fd\u505a\u8fd9\u4e00\u6b65","title":"1.1 \u975e\u56fe\u50cf\u754c\u9762\u542f\u52a8"},{"location":"hadoop/CDH/cdh.deploy/#12-ssh","text":"\u914d\u7f6essh root@ubuntu:/home/cmz# egrep -i 'PermitRootLogin|dns' /etc/ssh/sshd_config |grep -v \"#\" PermitRootLogin yes UseDNS no root@ubuntu:/home/cmz# /etc/init.d/ssh restart [ ok ] Restarting ssh (via systemctl): ssh.service. \u8bbe\u7f6e\u65f6\u533a\uff0ccdh\u4f1a\u68c0\u67e5\u5404\u4e2a\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u65f6\u95f4\u662f\u5426\u901a\u8fc7\u3002\u65f6\u95f4\u4e0d\u4e00\u81f4\u4f1a\u51fa\u73b0\u95ee\u9898\u3002 root@ubuntu:/usr/local/src/cdh# apt install ntpdate root@ubuntu:/usr/local/src/cdh# crontab -e no crontab for root - using an empty one Select an editor. To change later, run 'select-editor'. 1. /bin/ed 2. /bin/nano <---- easiest 3. /usr/bin/vim.basic 4. /usr/bin/vim.tiny Choose 1-4 [2]: 3 crontab: installing new crontab root@ubuntu:/usr/local/src/cdh# tzselect Please identify a location so that time zone rules can be set correctly. Please select a continent, ocean, \"coord\", or \"TZ\". 1) Africa 2) Americas 3) Antarctica 4) Asia 5) Atlantic Ocean 6) Australia 7) Europe 8) Indian Ocean 9) Pacific Ocean 10) coord - I want to use geographical coordinates. 11) TZ - I want to specify the time zone using the Posix TZ format. #? 4 Please select a country whose clocks agree with yours. 1) Afghanistan 18) Israel 35) Palestine 2) Armenia 19) Japan 36) Philippines 3) Azerbaijan 20) Jordan 37) Qatar 4) Bahrain 21) Kazakhstan 38) Russia 5) Bangladesh 22) Korea (North) 39) Saudi Arabia 6) Bhutan 23) Korea (South) 40) Singapore 7) Brunei 24) Kuwait 41) Sri Lanka 8) Cambodia 25) Kyrgyzstan 42) Syria 9) China 26) Laos 43) Taiwan 10) Cyprus 27) Lebanon 44) Tajikistan 11) East Timor 28) Macau 45) Thailand 12) Georgia 29) Malaysia 46) Turkmenistan 13) Hong Kong 30) Mongolia 47) United Arab Emirates 14) India 31) Myanmar (Burma) 48) Uzbekistan 15) Indonesia 32) Nepal 49) Vietnam 16) Iran 33) Oman 50) Yemen 17) Iraq 34) Pakistan #? 9 Please select one of the following time zone regions. 1) Beijing Time 2) Xinjiang Time #? 1 The following information has been given: China Beijing Time Therefore TZ='Asia/Shanghai' will be used. Local time is now: Thu Mar 28 16:51:03 CST 2019. Universal Time is now: Thu Mar 28 08:51:03 UTC 2019. Is the above information OK? 1) Yes 2) No #? 1 You can make this change permanent for yourself by appending the line TZ='Asia/Shanghai'; export TZ to the file '.profile' in your home directory; then log out and log in again. Here is that TZ value again, this time on standard output so that you can use the /usr/bin/tzselect command in shell scripts: Asia/Shanghai root@ubuntu:/usr/local/src/cdh# TZ='Asia/Shanghai'; export TZ root@ubuntu:/usr/local/src/cdh# cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime root@ubuntu:/usr/local/src/cdh# crontab -l */15 * * * * /usr/sbin/ntpdate pool.ntp.org >/dev/null 2>&1 \u4ee5\u4e0a\u4e24\u4e2a\u6b65\u9aa4\uff0c\u6bcf\u4e2a\u673a\u5668\u90fd\u505a\u8fd9\u4e00\u6b65","title":"1.2 \u4fee\u6539SSH"},{"location":"hadoop/CDH/cdh.deploy/#13-host","text":"echo 'master'>/etc/hostname hostname master bash echo 'save1'>/etc/hostname hostname slave1 bash echo 'slave2'>/etc/hostname hostname slave2 bash oot@ubuntu:/home/cmz# echo 'master'>/etc/hostname root@ubuntu:/home/cmz# hostname master root@ubuntu:/home/cmz# bash root@master:/home/cmz# \u6bcf\u4e2a\u673a\u5668\u90fd\u8981\u505a\u7c7b\u4f3c\u64cd\u4f5c \uff0c\u4f46\u662f\u6839\u636e\u81ea\u5df1\u7684\u8eab\u4efd\uff0c\u4fee\u6539\u6210\u81ea\u5df1\u5bf9\u5e94\u7684\u4e3b\u673a\u540d\u3002 cat>>/etc/hosts<<EOF 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 EOF \u6bcf\u4e2a\u673a\u5668\u90fd\u505a\u8fd9\u4e00\u6b65 \uff0c\u81ea\u5df1\u624b\u52a8\u914d\u7f6ehosts\u6587\u4ef6\uff0c\u8fd9\u6837\u53ef\u4ee5\u540chostname\u6765\u64cd\u4f5c\u673a\u5668\u3002\u7701\u53bb\u76f4\u63a5\u64cd\u4f5cip\u7684\u9ebb\u70e6\u3002 ping master -c1 ping slave1 -c1 ping slave2 -c1 [root@master ~]# ping master -c1 PING master (192.168.186.128) 56(84) bytes of data. 64 bytes from master (192.168.186.128): icmp_seq=1 ttl=64 time=0.018 ms --- master ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.018/0.018/0.018/0.000 ms [root@master ~]# ping slave1 -c1 PING slave1 (192.168.186.129) 56(84) bytes of data. 64 bytes from slave1 (192.168.186.129): icmp_seq=1 ttl=64 time=0.291 ms --- slave1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.291/0.291/0.291/0.000 ms [root@master ~]# ping slave2 -c1 PING slave2 (192.168.186.137) 56(84) bytes of data. 64 bytes from slave2 (192.168.186.137): icmp_seq=1 ttl=64 time=0.205 ms --- slave2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.205/0.205/0.205/0.000 ms \u4ee5\u4e0a\u6bcf\u4e2a\u673a\u5668\u6d4b\u8bd5\u4e00\u904d \uff0c\u770b\u770b\u662f\u5426\u89e3\u6790\u4e86\uff0c\u4ee5\u4e0a\u914d\u7f6e\u3002","title":"1.3 \u4fee\u6539\u4e3b\u673a\u540d\u548chost\u6587\u4ef6"},{"location":"hadoop/CDH/cdh.deploy/#14","text":"\u5b98\u65b9\u5efa\u8bae\u662f\u8bbe\u7f6e\u4ea4\u6362\u5206\u533a\u4e3a0 echo \"0\">> /proc/sys/vm/swappiness sysctl -p cat /proc/sys/vm/swappiness \u6bcf\u4e2a\u673a\u5668\u90fd\u505a\u8fd9\u4e00\u6b65","title":"1.4 \u4ea4\u6362\u5206\u533a"},{"location":"hadoop/CDH/cdh.deploy/#15","text":"\u5b98\u65b9\u8981\u6c42\uff0cCDH\u7684\u51e0\u4e2a\u673a\u5668\u8981\u505a\u7ebf\u6027\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u65e0\u5bc6\u7801\u767b\u5f55\u3002CDH\u90fd\u662f\u4ee5root\u65b9\u5f0f\u8fd0\u884c\uff0c\u6240\u4ee5\u662f\u505aroot\u7684\u514d\u5bc6\u767b\u5f55\u3002 root@master:~# ssh-keygen Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): Created directory '/root/.ssh'. Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.ssh/id_rsa. Your public key has been saved in /root/.ssh/id_rsa.pub. The key fingerprint is: SHA256:+QoiIFdrD0UatNHm7IeKBY3OBuf3Tg4WnMZ3B3helO4 root@cdh-master The key's randomart image is: +---[RSA 2048]----+ | .+.. .. | | *o. .. | | o++o o.. | |. ++.+oo +. | |o*..X...S.. | |.o=oo=o..oE | | ..++o+. . | | .o.=.. . | | .o . | +----[SHA256]-----+ \u4e00\u8def\u56de\u8f66\uff0c ssh-copy-id -i /root/.ssh/id_rsa root@master ssh-copy-id -i /root/.ssh/id_rsa root@slave1 ssh-copy-id -i /root/.ssh/id_rsa root@slave2 \u6d4b\u8bd5 [root@master ~]# ssh slave1 Last login: Mon Apr 1 11:42:48 2019 from 192.168.186.1 \u514d\u5bc6\u5230slave1\u4e0a\u4e86\u3002\u7136\u540e\u6d4b\u8bd5\u662f\u5426\u80fd\u514d\u5bc6\u5230\u5176\u4ed6\u673a\u5668\u3002 \u7136\u540e\u53e6\u5916\u7684\u4e09\u4e2a\u673a\u5668\u90fd\u6837\u64cd\u4f5c\u3002\u628a\u5404\u81ea\u7684\u516c\u7ea6\u5206\u53d1\u5230\u56db\u4e2a\u673a\u5668\u4e0a \u3002","title":"1.5 \u514d\u5bc6\u767b\u5f55"},{"location":"hadoop/CDH/cdh.deploy/#16-jdk","text":"hadoop\u4f9d\u8d56JAVA\uff0c\u6211\u4eec\u5b89\u88c5jdk\u73af\u5883\u3002 \u5feb\u901f\u547d\u4ee4 wget http://192.168.1.31:8080/software/cmz/JDK/JDK8_112.zip \u8be6\u7ec6\u8fc7\u7a0b root@master:/usr/local/src# wget http://192.168.1.31:8080/software/cmz/JDK/JDK8_112.zip --2019-03-26 23:17:33-- http://192.168.1.31:8080/software/cmz/JDK/JDK8_112.zip Connecting to 180.96.7.219:8080... connected. HTTP request sent, awaiting response... 200 OK Length: 182583345 (174M) [application/zip] Saving to: \u2018JDK8_112.zip\u2019 JDK8_112.zip 100%[==================================>] 174.12M 3.87MB/s in 61s 2019-03-26 23:18:34 (2.83 MB/s) - \u2018JDK8_112.zip\u2019 saved [182583345/182583345] root@cdh-master:/usr/local/src# unzip JDK8_112.zip Archive: JDK8_112.zip inflating: InstallJDK8.sh inflating: jdk-8u112-linux-x64.tar.gz root@master:/usr/local/src# cat InstallJDK8.sh #!/bin/bash JDKPath=/usr/lib/jvm SourcePath=/etc/profile [ ! -f $JDKPath ] && mkdir -p $JDKPath cd $JDKPath #rm -rf * cd - [ ! -f jdk-8u112-linux-x64.tar.gz ] && echo \"The jdk-8u112-linux-x64.tar.gz file is not exist.\" tar -xf jdk-8u112-linux-x64.tar.gz -C $JDKPath >/dev/null cat >>$SourcePath<<EOF #add by caimengzhi at `date +%F` start export JAVA_HOME=$JDKPath/jdk1.8.0_112 export JRE_HOME=\\${JAVA_HOME}/jre export CLASSPATH=.:\\${JAVA_HOME}/lib:\\${JRE_HOME}/lib export PATH=\\${JAVA_HOME}/bin:\\$PATH #add by caimengzhi at `date +%F` end EOF . $SourcePath root@master:/usr/local/src# sh InstallJDK8.sh /usr/local/src root@master:/usr/local/src# source /etc/profile root@master:/usr/local/src# java -version java version \"1.8.0_112\" Java(TM) SE Runtime Environment (build 1.8.0_112-b15) Java HotSpot(TM) 64-Bit Server VM (build 25.112-b15, mixed mode) \u68c0\u67e5\uff0c\u9000\u51fa\u91cd\u65b0\u767b\u5f55\uff0c\u76f4\u63a5\u5207\u6362\u5230root\u7528\u6237\u3002 root@master:/usr/local/src# java -version java version \"1.8.0_112\" Java(TM) SE Runtime Environment (build 1.8.0_112-b15) Java HotSpot(TM) 64-Bit Server VM (build 25.112-b15, mixed mode) \u4ee5\u4e0a\u8868\u793ajdk\u73af\u5883\u51c6\u5907\u5b8c\u6bd5\u3002 \u6bcf\u4e2a\u673a\u5668\u90fd\u505a\u8fd9\u4e00\u6b65","title":"1.6 JDK"},{"location":"hadoop/CDH/cdh.deploy/#17-mysql","text":"\u5b89\u88c5mysql\u53ea\u5728master\u4e0a\u64cd\u4f5c\uff0c\u800c\u5b89\u88c5mysql jdbc\u6bcf\u4e2a\u673a\u5668\u4e0a\u90fd\u8981\u5b89\u88c5","title":"1.7 mysql"},{"location":"hadoop/CDH/cdh.deploy/#171-mysql-server","text":"[root@master ~]# apt-get install -y mysql-server Reading package lists... Done Building dependency tree","title":"1.7.1 \u5b89\u88c5mysql-server"},{"location":"hadoop/CDH/cdh.deploy/#172-mysql-jdbc","text":"[root@master ~]# apt-get install libmysql-java \u6bcf\u4e2a\u673a\u5668\u90fd\u505a\u8fd9\u4e00\u6b65","title":"1.7.2 \u5b89\u88c5mysql jdbc"},{"location":"hadoop/CDH/cdh.deploy/#173","text":"\u4fee\u6539mysql \u5141\u8bb8\u8fdc\u7a0b\u767b\u5f55 root@cdh-master:/usr/local/src# grep -i bind /etc/mysql/mysql.conf.d/mysqld.cnf bind-address = 0.0.0.0 root@cdh-master:/usr/local/src# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service. \u82e5\u662fmaster\u4e0a\u5b89\u88c5\u7684cdh\u53ef\u4ee5\u4e0d\u7528\u4fee\u6539\u3002 \u751f\u4ea7\u73af\u5883\u7684\u8bdd\uff0c\u522b\u91cd\u542fmysql\u3002 \u5feb\u901f\u547d\u4ee4 create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database hue DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database oozie DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database amon DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database rman DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database metastore DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database sentry DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database nav DEFAULT CHARSET utf8 COLLATE utf8_general_ci; create database navms DEFAULT CHARSET utf8 COLLATE utf8_general_ci; grant all privileges on *.* to 'root'@'cdh-master' identified by 'root' with grant option; flush privileges; \u8be6\u7ec6\u8fc7\u7a0b mysql> create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> create database hue DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> create database oozie DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.01 sec) mysql> create database amon DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> create database rman DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> create database metastore DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> create database sentry DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> create database nav DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> create database navms DEFAULT CHARSET utf8 COLLATE utf8_general_ci; Query OK, 1 row affected (0.00 sec) mysql> grant all privileges on *.* to 'root'@'cdh-master' identified by 'root' with grant option; Query OK, 0 rows affected, 1 warning (0.00 sec) mysql> flush privileges; Query OK, 0 rows affected (0.00 sec) mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | amon | | hive | | hue | | metastore | | mysql | | nav | | navms | | oozie | | performance_schema | | rman | | sentry | | sys | +--------------------+ 13 rows in set (0.09 sec)","title":"1.7.3 \u914d\u7f6e"},{"location":"hadoop/CDH/cdh.deploy/#18-cloud-manger-cs","text":"","title":"1.8 Cloud Manger C/S"},{"location":"hadoop/CDH/cdh.deploy/#181","text":"\u5feb\u901f\u547d\u4ee4 mkdir /opt/cloudera-manager axel http://archive.cloudera.com/cm5/cm/5/cloudera-manager-centos7-cm5.13.1_x86_64.tar.gz axel http://archive.cloudera.com/cdh5/parcels/5.13.1/CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel axel http://archive.cloudera.com/cdh5/parcels/5.13.1/CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel.sha1 axel http://archive.cloudera.com/cdh5/parcels/5.13.1/manifest.json \u8be6\u7ec6\u8fc7\u7a0b [root@master parcel-repo]# cd /usr/local/src/ [root@master src]# axel http://archive.cloudera.com/cm5/cm/5/cloudera-manager-centos7-cm5.13.1_x86_64.tar.gz [root@master src]# axel http://archive.cloudera.com/cdh5/parcels/5.13.1/CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel [root@master src]# axel http://archive.cloudera.com/cdh5/parcels/5.13.1/CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel.sha1 [root@master src]# axel http://archive.cloudera.com/cdh5/parcels/5.13.1/manifest.json \u5c06\u4e0b\u8f7d\u597d\u7684cloudera-manager-trusty-cm5.13.1_amd64.tar.gz\u89e3\u538b\u5230/opt/cloudera-manager cd /opt mkdir cloudera # \u521b\u5efacloudera\u6587\u4ef6\u5939 cd cloudera mkdir parcels # \u521b\u5efaparcels\u6587\u4ef6\u5939 mkdir parcel-repo # \u521b\u5efaparcel-rep\u6587\u4ef6\u5939 cd /usr/local/src/cdh tar -zxf cloudera-manager-xenial-cm5.14.0_amd64.tar.gz -C /opt # \u89e3\u538bcm \u8be6\u7ec6\u8fc7\u7a0b [root@master ~]# cd /usr/local/src/ [root@master src]# ll total 1950296 -rw-r--r-- 1 cloudera-scm cloudera-scm 1934231261 Mar 30 21:49 CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel -rw-r--r-- 1 cloudera-scm cloudera-scm 41 Mar 30 21:42 CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel.sha -rw-r----- 1 root root 73966 Mar 30 23:57 CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel.torrent -rw-r----- 1 root root 62709760 Mar 31 00:45 CDH-5.13.3-1.cdh5.13.3.p0.2-el7.parcel.part -rw-r--r-- 1 cloudera-scm cloudera-scm 73766 Feb 23 2018 manifest.json [root@master src]# tar xf cloudera-manager-xenial-cm5.16.1_amd64.tar.gz -C /opt/ [root@master parcel-repo]# ls /opt/cloudera-manager/ cloudera cm-5.13.1 \u53ea\u5728master\u4e0a\u64cd\u4f5c","title":"1.8.1 \u4e0b\u8f7d\u8f6f\u4ef6\u5305"},{"location":"hadoop/CDH/cdh.deploy/#182","text":"\u5feb\u901f\u547d\u4ee4 useradd --system --home=/opt/cloudera-manager/cm-5.13.1/run/cloudera-scm-server/ --no-create-home --shell=/bin/false --comment \"Cloudera SCM User\" cloudera-scm \u8be6\u7ec6\u8fc7\u7a0b [root@master ~]# useradd --system --home=/opt/cloudera-manager/cm-5.13.1/run/cloudera-scm-server/ --no-create-home --shell=/bin/false --comment \"Cloudera SCM User\" cloudera-scm --home \u6307\u5411\u4f60cloudera-scm-server\u7684\u8def\u5f84,\u6240\u6709\u670d\u52a1\u5668\u90fd\u8981\u914d\u7f6e\uff0c\u5176\u4ed6\u673a\u5668\u90fd\u8981\u5b89\u88c5\u7701\u7565\u3002","title":"1.8.2 \u521b\u5efa\u7528\u6237"},{"location":"hadoop/CDH/cdh.deploy/#183","text":"\u521b\u5efacloudera manager server\u7684\u672c\u5730\u5b58\u50a8\u76ee\u5f55 mkdir /var/log/cloudera-scm-server chown cloudera-scm:cloudera-scm /var/log/cloudera-scm-server \u8be6\u7ec6\u8fc7\u7a0b [root@master ~]# mkdir /var/log/cloudera-scm-server [root@master ~]# chown cloudera-scm:cloudera-scm /var/log/cloudera-scm-server \u53ea\u5728master\u4e0a\u64cd\u4f5c","title":"1.8.3 \u521b\u5efa\u5b58\u50a8\u76ee\u5f55"},{"location":"hadoop/CDH/cdh.deploy/#184","text":"[root@master ~]# cd /opt/cloudera-manager/cm-5.13.1/etc/cloudera-scm-agent/ [root@master cloudera-scm-agent]# ls config.ini [root@master cloudera-scm-agent]# sed -i \"s@server_host=localhost@server_host=cdh-master@g\" config.ini [root@master cloudera-scm-agent]# grep server_host config.ini server_host=cdh-master \u628a\u5176\u4e2d\u7684server_host\u503c\u4fee\u6539\u6210cloudera manager server\u7684IP\u3002\u4e5f\u5c31\u662fmaster \u53ea\u5728master\u4e0a\u64cd\u4f5c","title":"1.8.4 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},{"location":"hadoop/CDH/cdh.deploy/#185","text":"\u5c06cloudera-manager\u53d1\u9001\u5230\u5404\u4ece\u8282\u70b9\u5bf9\u5e94\u7684\u76ee\u5f55\u4e0b(\u5373/opt) rsync -avz /opt/cloudera-manager root@cdh-agent1:/opt rsync -avz /opt/cloudera-manager root@cdh-agent2:/opt rsync -avz /opt/cloudera-manager root@cdh-agent3:/opt \u8be6\u89e3\u64cd\u4f5c\u8fc7\u7a0b [root@master ~]# rsync -avz /opt/cloudera-manager root@node1:/opt [root@master ~]# rsync -avz /opt/cloudera-manager root@node2:/opt \u68c0\u67e5 [root@slave1 ~]# ls /opt/cloudera-manager/ cm-5.13.1 [root@slave2 ~]# ls /opt/cloudera-manager/ cm-5.13.1 \u53ea\u5728master\u4e0a\u64cd\u4f5c","title":"1.8.5 \u5206\u53d1"},{"location":"hadoop/CDH/cdh.deploy/#186-parcel","text":"\u521b\u5efa\u5b89\u88c5\u5305\u76ee\u5f55\uff0c\u5c06CHD5\u76f8\u5173\u7684Parcel\u5305\u653e\u5230\u4e3b\u8282\u70b9\u7684/opt/cloudera/parcel-repo/\u76ee\u5f55\u4e2d [root@master ~]# mkdir -p /opt/cloudera/parcels [root@master ~]# rsync -avz /usr/local/src/cdh/* /opt/cloudera/parcel-repo/ sending incremental file list CDH-5.13.1-1.cdh5.13.1.p0.2-trusty.parcel CDH-5.13.1-1.cdh5.13.1.p0.2-trusty.parcel.sha cloudera-manager-trusty-cm5.13.1_amd64.tar.gz manifest.json sent 2,633,137,325 bytes received 92 bytes 27,572,119.55 bytes/sec total size is 2,635,696,679 speedup is 1.00 [root@master ~]# cd /opt/cloudera/parcel-repo/ [root@master parcel-repo]# ll total 1950296 -rw-r--r-- 1 cloudera-scm cloudera-scm 1934231261 Mar 30 21:49 CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel -rw-r--r-- 1 cloudera-scm cloudera-scm 41 Mar 30 21:42 CDH-5.13.1-1.cdh5.13.1.p0.2-el7.parcel.sha1 -rw-r--r-- 1 cloudera-scm cloudera-scm 73766 Feb 23 2018 manifest.json \u6ce8\u610f \u4e00\u5b9a\u8981\u628a\u4e0b\u8f7d\u7684\u5305 CDH - 5.13 . 1 - 1. cdh5 . 13.1 . p0 . 2 - el7 . parcel . sha1 \uff0c\u540e\u9762\u7684 1 \u53bb\u6389\uff0c\u56e0\u4e3a\u540e\u9762\u79bb\u7ebf\u7684\u5b89\u88c5\u7684\u65f6\u5019\uff0c\u4f9d\u8d56\u8fd9\u4e2a\u5305\uff0c\u5230\u65f6\u5019\u540e\u9762\u8981\u662f\u6709 1 \uff0c\u4f1a\u81ea\u52a8\u8054\u7f51\u4e0b\u8f7d","title":"1.8.6 \u4e3b\u8282\u70b9\u521b\u5efaParcel\u76ee\u5f55"},{"location":"hadoop/CDH/cdh.deploy/#187-parcel","text":"[root@slave1 ~]# mkdir -p /opt/cloudera/parcels [root@slave2 ~]# mkdir -p /opt/cloudera/parcels","title":"1.8.7 \u4ece\u8282\u70b9\u521b\u5efaParcel\u76ee\u5f55"},{"location":"hadoop/CDH/cdh.deploy/#188","text":"[root@master ~]# cd /opt/cloudera-manager/cm-5.13.1/share/cmf/schema/ [root@master schema]# ./scm_prepare_database.sh mysql -uroot -proot --scm-host localhost scm scm root JAVA_HOME=/usr/lib/jvm/jdk1.8.0_112 Verifying that we can write to /opt/cm-5.13.1/etc/cloudera-scm-server Thu Mar 28 02:33:23 PDT 2019 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification. Creating SCM configuration file in /opt/cm-5.13.1/etc/cloudera-scm-server groups: \u2018cloudera-scm\u2019: no such user Executing: /usr/lib/jvm/jdk1.8.0_112/bin/java -cp /usr/share/java/mysql-connector-java.jar:/usr/share/java/oracle-connector-java.jar:/usr/share/java/postgresql-connector-java.jar:/opt/cm-5.16.1/share/cmf/schema/../lib/* com.cloudera.enterprise.dbutil.DbCommandExecutor /opt/cm-5.13.1/etc/cloudera-scm-server/db.properties com.cloudera.cmf.db. Thu Mar 28 02:33:24 PDT 2019 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification. [ main] DbCommandExecutor INFO Successfully connected to database. All done, your SCM database is configured correctly! \u53ea\u6709\u770b\u5230 All done, your SCM database is configured correctly! ,\u5c31\u8868\u660e\u5bfc\u5165OK\uff0c\u82e5\u662f\u6709\u4ec0\u4e48log4j\u4ec0\u4e48\u7684\u9519\u8bef\uff0c\u53ef\u4ee5\u4e0d\u7528\u7ba1","title":"1.8.8 \u6570\u636e\u5bfc\u5165"},{"location":"hadoop/CDH/cdh.deploy/#189","text":"[root@master ~]# /opt/cloudera-manager/cm-5.13.1/etc/init.d/cloudera-scm-server start [root@master ~]# /opt/cloudera-manager/cm-5.13.1/etc/init.d/cloudera-scm-agent start [root@slave1 ~]# /opt/cloudera-manager/cm-5.13.1/etc/init.d/cloudera-scm-agent start [root@slave2 ~]# /opt/cloudera-manager/cm-5.13.1/etc/init.d/cloudera-scm-agent start","title":"1.8.9 \u542f\u52a8"},{"location":"hadoop/CDH/cdh.deploy/#1810","text":"[root@master ~]# netstat -lnp|grep 7180 tcp 0 0 0.0.0.0:7180 0.0.0.0:* LISTEN 1750/java \u67e5\u770bmaster\u7aef\u76847180\u7aef\u53e3\u662f\u5426\u5b58\u5728[\u4e0d\u5b58\u5728\u5c31\u8bf4\u660e\u6709\u95ee\u9898]\u3002 \u975e\u5e38\u6ce8\u610f\uff0c\u6211\u78b0\u89c1\u7684\u95ee\u9898 \u4e0a\u5468\u6211\u672c\u5730\u6d4b\u8bd5 cdh\u7684\u65f6\u5019 \uff0c\u641e\u4e00\u5468\uff0c\u5dee\u70b9\u5d29\u6e83\uff0c\u5404\u79cd\u5947\u8469\u95ee\u9898\uff0c\u6bd4\u5982 1. \u8fd0\u884c\u8fd0\u884c\u5185\u5b58\u4e0d\u591f\uff0c\u8e66\u4e86 2. \u865a\u62df\u673a\u786c\u76d8\u4e0d\u591f\uff0c\u8e66\u4e86 3. IP\u5730\u5740\u51b2\u7a81 \uff0c\u65ad\u7f51 4. \u865a\u62df\u673a\u7684 cdh\u542f\u52a8\u6162 \uff0c\u5bfc\u81f4\u6211\u4ee5\u4e3a\u4e0d\u6b63\u5e38\uff0c\u8fd9\u5947\u8469\u95ee\u9898\u5bfc\u81f4\u6211\u90fd\u5f00\u59cb\u6000\u7591\u6211\u81ea\u5df1 5. cdh\u7248\u672c\u548c\u7cfb\u7edf\u4e0d\u4e00\u81f4 \uff0c","title":"1.8.10 \u68c0\u67e5"},{"location":"hadoop/CDH/cdh.deploy/#19","text":"\u9009\u62e9\u6700\u5de6\u8fb9\u7684\u514d\u8d39\u7248\u672c\u3002 \u70b9\u51fb\u53f3\u4fa7\u5f53\u524d\u7ba1\u7406\u7684\u4e3b\u673a\u6309\u94ae\u3002\u9009\u62e9\u6240\u6709\u673a\u5668\u3002 \u82e5\u662f\u53d1\u73b0\uff0c\u5df2\u9009\u62e9\u7684\u6b63\u5728\u4e0b\u8f7d\uff0c\u8bf4\u660e\u4e4b\u524d\u4f60\u7684\u9009\u9879\u6ca1\u6709\u9009\u62e9\u4f60\u4e4b\u524d\u4e0b\u8f7d\u7684\u5305\uff0c\u6b64\u65f6\u5373\u4f7f\u4f60\u5728\u9875\u9762\u53d6\u6d88\uff0c\u4e5f\u662f\u4e0d\u884c\u7684\u3002\u53ea\u80fd\u5728\u7cfb\u7edf\u4e0bkill\u5230\u8fdb\u7a0b\uff0c\u7136\u540e\u91cd\u65b0\u6765\u4e00\u904d\u3002\u56e0\u4e3a\u8fd9\u7cfb\u7edf\u4f1a\u5728\u540e\u53f0\u4e0b\u8f7d\u5305\uff0c\u8fd9\u5305\u90fd1.8GB\u5de6\u53f3\uff0c\u7334\u5e74\u9a6c\u6708\u624d\u80fd\u4e0b\u8f7d\u5b8c\u3002 \u7b49\u5f85\u5b89\u88c5\uff0c\u9519\u8bef\u7684\u65f6\u5019\u4f1a\u6709\u63d0\u793a\u3002\u4ee5\u4e0b\u6709\u4e2a\u63d0\u793a\u3002[\u56e0\u4e3a\u6211\u4e4b\u524d\u7cfb\u7edf\u4e0a\u5b89\u88c5\u8fc7\uff0c\u6211\u867d\u7136\u5220\u9664\u4e86\u96c6\u7fa4\u3002\u91cd\u65b0\u5b89\u88c5\u7684\u65f6\u5019\uff0c\u4e4b\u524d\u6587\u4ef6\u5939\u8fd8\u662f\u5b58\u5728\u7684\uff0c\u6240\u4ee5\u62a5\u9519\uff0c\u5220\u9664\u5373\u53ef\uff0c\u82e5\u662f\u7ebf\u4e0a\u673a\u5668\u8c28\u614e\u64cd\u4f5c\u3002] [root@master overlay2]# cd /dfs/nn [root@master nn]# ll total 12 drwxr-xr-x 2 hdfs hdfs 8192 Apr 1 11:54 current [root@master nn]# cd current/ [root@master current]# ls edits_0000000000000000001-0000000000000000079 edits_0000000000000000284-0000000000000000297 edits_0000000000000001311-0000000000000001372 edits_0000000000000000080-0000000000000000087 edits_0000000000000000298-0000000000000000311 edits_0000000000000001406-0000000000000001491 edits_0000000000000000088-0000000000000000101 edits_0000000000000000312-0000000000000000325 edits_0000000000000001492-0000000000000001505 edits_0000000000000000102-0000000000000000115 edits_0000000000000000326-0000000000000000339 edits_0000000000000001506-0000000000000001519 edits_0000000000000000116-0000000000000000129 edits_0000000000000000340-0000000000000000353 edits_0000000000000001520-0000000000000001533 edits_0000000000000000130-0000000000000000143 edits_0000000000000000354-0000000000000000367 edits_0000000000000001534-0000000000000001547 edits_0000000000000000144-0000000000000000157 edits_0000000000000000368-0000000000000000381 edits_0000000000000001548-0000000000000001561 edits_0000000000000000158-0000000000000000171 edits_0000000000000000382-0000000000000000395 edits_0000000000000001562-0000000000000001575 edits_0000000000000000172-0000000000000000185 edits_0000000000000000396-0000000000000000409 fsimage_0000000000000000000 edits_0000000000000000186-0000000000000000199 edits_0000000000000000410-0000000000000000423 fsimage_0000000000000000000.md5 edits_0000000000000000200-0000000000000000213 edits_0000000000000000424-0000000000000000437 fsimage_0000000000000000873 edits_0000000000000000214-0000000000000000227 edits_0000000000000000438-0000000000000000451 fsimage_0000000000000000873.md5 edits_0000000000000000228-0000000000000000241 edits_0000000000000000452-0000000000000000459 seen_txid edits_0000000000000000242-0000000000000000255 edits_0000000000000001133-0000000000000001145 VERSION edits_0000000000000000256-0000000000000000269 edits_0000000000000001146-0000000000000001147 edits_0000000000000000270-0000000000000000283 edits_0000000000000001148-0000000000000001148 [root@master current]# cd .. [root@master nn]# ls current [root@master nn]# cd .. [root@master dfs]# ls dn jn nn snn [root@master dfs]# rm /dfs/nn -rf \u5220\u9664\u6587\u4ef6\u5939\u540e\uff0c\u70b9\u51fb\u672c\u9875\u9762\u4e0a\u7684resume\uff0c\u91cd\u65b0\u5f00\u59cb\u3002 \u5230\u6b64cdh\u5b89\u88c5\u7684hdaoop\u96c6\u7fa4\u5b8c\u6bd5\u3002","title":"1.9 \u5b89\u88c5"},{"location":"hadoop/CDH/cdh.hdfs_info/","text":"HDFS \u57fa\u672c\u77e5\u8bc6 1. \u4ecb\u7ecd \u00b6 \u5728\u73b0\u4ee3\u7684\u4f01\u4e1a\u73af\u5883\u4e2d\uff0c\u5355\u673a\u5bb9\u91cf\u5f80\u5f80\u65e0\u6cd5\u5b58\u50a8\u5927\u91cf\u6570\u636e\uff0c\u9700\u8981\u8de8\u673a\u5668\u5b58\u50a8\u3002\u7edf\u4e00\u7ba1\u7406\u5206\u5e03\u5728\u96c6\u7fa4\u4e0a\u7684\u6587\u4ef6\u7cfb\u7edf\u79f0\u4e3a\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u3002\u800c\u4e00\u65e6\u5728\u7cfb\u7edf\u4e2d\uff0c\u5f15\u5165\u7f51\u7edc\uff0c\u5c31\u4e0d\u53ef\u907f\u514d\u5730\u5f15\u5165\u4e86\u6240\u6709\u7f51\u7edc\u7f16\u7a0b\u7684\u590d\u6742\u6027\uff0c\u4f8b\u5982\u6311\u6218\u4e4b\u4e00\u662f\u5982\u679c\u4fdd\u8bc1\u5728\u8282\u70b9\u4e0d\u53ef\u7528\u7684\u65f6\u5019\u6570\u636e\u4e0d\u4e22\u5931\u3002 \u4f20\u7edf\u7684\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\uff08NFS\uff09\u867d\u7136\u4e5f\u79f0\u4e3a\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u4f46\u662f\u5176\u5b58\u5728\u4e00\u4e9b\u9650\u5236\u3002\u7531\u4e8eNFS\u4e2d\uff0c\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u5355\u673a\u4e0a\uff0c\u56e0\u6b64\u65e0\u6cd5\u63d0\u4f9b\u53ef\u9760\u6027\u4fdd\u8bc1\uff0c\u5f53\u5f88\u591a\u5ba2\u6237\u7aef\u540c\u65f6\u8bbf\u95eeNFS Server\u65f6\uff0c\u5f88\u5bb9\u6613\u9020\u6210\u670d\u52a1\u5668\u538b\u529b\uff0c\u9020\u6210\u6027\u80fd\u74f6\u9888\u3002\u53e6\u5916\u5982\u679c\u8981\u5bf9NFS\u4e2d\u7684\u6587\u4ef6\u8fdb\u884c\u64cd\u4f5c\uff0c\u9700\u8981\u9996\u5148\u540c\u6b65\u5230\u672c\u5730\uff0c\u8fd9\u4e9b\u4fee\u6539\u5728\u540c\u6b65\u5230\u670d\u52a1\u7aef\u4e4b\u524d\uff0c\u5176\u4ed6\u5ba2\u6237\u7aef\u662f\u4e0d\u53ef\u89c1\u7684\u3002\u67d0\u79cd\u7a0b\u5ea6\u4e0a\uff0cNFS\u4e0d\u662f\u4e00\u79cd\u5178\u578b\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u867d\u7136\u5b83\u7684\u6587\u4ef6\u7684\u786e\u653e\u5728\u8fdc\u7aef\uff08\u5355\u4e00\uff09\u7684\u670d\u52a1\u5668\u4e0a\u9762\u3002 \u4eceNFS\u7684\u534f\u8bae\u6808\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u4e8b\u5b9e\u4e0a\u662f\u4e00\u79cdVFS\uff08\u64cd\u4f5c\u7cfb\u7edf\u5bf9\u6587\u4ef6\u7684\u4e00\u79cd\u62bd\u8c61\uff09\u5b9e\u73b0\u3002 HDFS\uff0c\u662fHadoop Distributed File System\u7684\u7b80\u79f0\uff0c\u662fHadoop\u62bd\u8c61\u6587\u4ef6\u7cfb\u7edf\u7684\u4e00\u79cd\u5b9e\u73b0\u3002Hadoop\u62bd\u8c61\u6587\u4ef6\u7cfb\u7edf\u53ef\u4ee5\u4e0e\u672c\u5730\u7cfb\u7edf\u3001Amazon S3\u7b49\u96c6\u6210\uff0c\u751a\u81f3\u53ef\u4ee5\u901a\u8fc7Web\u534f\u8bae\uff08webhsfs\uff09\u6765\u64cd\u4f5c\u3002HDFS\u7684\u6587\u4ef6\u5206\u5e03\u5728\u96c6\u7fa4\u673a\u5668\u4e0a\uff0c\u540c\u65f6\u63d0\u4f9b\u526f\u672c\u8fdb\u884c\u5bb9\u9519\u53ca\u53ef\u9760\u6027\u4fdd\u8bc1\u3002\u4f8b\u5982\u5ba2\u6237\u7aef\u5199\u5165\u8bfb\u53d6\u6587\u4ef6\u7684\u76f4\u63a5\u64cd\u4f5c\u90fd\u662f\u5206\u5e03\u5728\u96c6\u7fa4\u5404\u4e2a\u673a\u5668\u4e0a\u7684\uff0c\u6ca1\u6709\u5355\u70b9\u6027\u80fd\u538b\u529b\u3002 2. HDFS \u00b6 HDFS\u8bbe\u8ba1\u4e4b\u521d\u5c31\u975e\u5e38\u660e\u786e\u5176\u5e94\u7528\u573a\u666f\uff0c\u9002\u7528\u4e0e\u4ec0\u4e48\u7c7b\u578b\u7684\u5e94\u7528\uff0c\u4e0d\u9002\u7528\u4ec0\u4e48\u5e94\u7528\uff0c\u6709\u4e00\u4e2a\u76f8\u5bf9\u660e\u786e\u7684\u6307\u5bfc\u539f\u5219\u3002 2.1 \u8bbe\u8ba1\u76ee\u6807 \u00b6 2.1.1 \u5b58\u50a8\u975e\u5e38\u5927\u7684\u6587\u4ef6 \u00b6 \u8fd9\u91cc\u975e\u5e38\u5927\u6307\u7684\u662f\u51e0\u767eM\u3001G\u3001\u6216\u8005TB\u7ea7\u522b\u3002\u5b9e\u9645\u5e94\u7528\u4e2d\u5df2\u6709\u5f88\u591a\u96c6\u7fa4\u5b58\u50a8\u7684\u6570\u636e\u8fbe\u5230PB\u7ea7\u522b\u3002\u6839\u636eHadoop\u5b98\u7f51\uff0cYahoo\uff01\u7684Hadoop\u96c6\u7fa4\u7ea6\u670910\u4e07\u9897CPU\uff0c\u8fd0\u884c\u57284\u4e07\u4e2a\u673a\u5668\u8282\u70b9\u4e0a\u3002\u66f4\u591a\u4e16\u754c\u4e0a\u7684Hadoop\u96c6\u7fa4\u4f7f\u7528\u60c5\u51b5\uff0c\u53c2\u8003Hadoop\u5b98\u7f51. 2.1.2 \u91c7\u7528\u6d41\u5f0f\u7684\u6570\u636e\u8bbf\u95ee\u65b9\u5f0f \u00b6 HDFS\u57fa\u4e8e\u8fd9\u6837\u7684\u4e00\u4e2a\u5047\u8bbe\uff1a\u6700\u6709\u6548\u7684\u6570\u636e\u5904\u7406\u6a21\u5f0f\u662f\u4e00\u6b21\u5199\u5165\u3001\u591a\u6b21\u8bfb\u53d6\u6570\u636e\u96c6\u7ecf\u5e38\u4ece\u6570\u636e\u6e90\u751f\u6210\u6216\u8005\u62f7\u8d1d\u4e00\u6b21\uff0c\u7136\u540e\u5728\u5176\u4e0a\u505a\u5f88\u591a\u5206\u6790\u5de5\u4f5c\uff0c\u5206\u6790\u5de5\u4f5c\u7ecf\u5e38\u8bfb\u53d6\u5176\u4e2d\u7684\u5927\u90e8\u5206\u6570\u636e\uff0c\u5373\u4f7f\u4e0d\u662f\u5168\u90e8\u3002 \u56e0\u6b64\u8bfb\u53d6\u6574\u4e2a\u6570\u636e\u96c6\u6240\u9700\u65f6\u95f4\u6bd4\u8bfb\u53d6\u7b2c\u4e00\u6761\u8bb0\u5f55\u7684\u5ef6\u65f6\u66f4\u91cd\u8981\u3002 2.1.2\u8fd0\u884c\u4e8e\u5546\u4e1a\u786c\u4ef6\u4e0a \u00b6 Hadoop\u4e0d\u9700\u8981\u7279\u522b\u8d35\u7684\u3001reliable\u7684\uff08\u53ef\u9760\u7684\uff09\u673a\u5668\uff0c\u53ef\u8fd0\u884c\u4e8e\u666e\u901a\u5546\u7528\u673a\u5668\uff08\u53ef\u4ee5\u4ece\u591a\u5bb6\u4f9b\u5e94\u5546\u91c7\u8d2d\uff09 \uff0c\u5546\u7528\u673a\u5668\u4e0d\u4ee3\u8868\u4f4e\u7aef\u673a\u5668\u3002\u5728\u96c6\u7fa4\u4e2d\uff08\u5c24\u5176\u662f\u5927\u7684\u96c6\u7fa4\uff09\uff0c\u8282\u70b9\u5931\u8d25\u7387\u662f\u6bd4\u8f83\u9ad8\u7684HDFS\u7684\u76ee\u6807\u662f\u786e\u4fdd\u96c6\u7fa4\u5728\u8282\u70b9\u5931\u8d25\u7684\u65f6\u5019\u4e0d\u4f1a\u8ba9\u7528\u6237\u611f\u89c9\u5230\u660e\u663e\u7684\u4e2d\u65ad\u3002 2.2 \u4e0d\u9002\u5408\u5e94\u7528 \u00b6 2.2.1 \u4f4e\u5ef6\u65f6\u7684\u6570\u636e\u8bbf\u95ee \u00b6 \u5bf9\u5ef6\u65f6\u8981\u6c42\u5728\u6beb\u79d2\u7ea7\u522b\u7684\u5e94\u7528\uff0c\u4e0d\u9002\u5408\u91c7\u7528HDFS\u3002HDFS\u662f\u4e3a\u9ad8\u541e\u5410\u6570\u636e\u4f20\u8f93\u8bbe\u8ba1\u7684,\u56e0\u6b64\u53ef\u80fd\u727a\u7272\u5ef6\u65f6HBase\u66f4\u9002\u5408\u4f4e\u5ef6\u65f6\u7684\u6570\u636e\u8bbf\u95ee\u3002 2.2.2 \u5927\u91cf\u5c0f\u6587\u4ef6 \u00b6 \u6587\u4ef6\u7684\u5143\u6570\u636e\uff08\u5982\u76ee\u5f55\u7ed3\u6784\uff0c\u6587\u4ef6block\u7684\u8282\u70b9\u5217\u8868\uff0cblock-node mapping\uff09\u4fdd\u5b58\u5728NameNode\u7684\u5185\u5b58\u4e2d\uff0c \u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u6587\u4ef6\u6570\u91cf\u4f1a\u53d7\u9650\u4e8eNameNode\u7684\u5185\u5b58\u5927\u5c0f\u3002 \u7ecf\u9a8c\u800c\u8a00\uff0c\u4e00\u4e2a\u6587\u4ef6/\u76ee\u5f55/\u6587\u4ef6\u5757\u4e00\u822c\u5360\u6709150\u5b57\u8282\u7684\u5143\u6570\u636e\u5185\u5b58\u7a7a\u95f4\u3002\u5982\u679c\u6709100\u4e07\u4e2a\u6587\u4ef6\uff0c\u6bcf\u4e2a\u6587\u4ef6\u5360\u75281\u4e2a\u6587\u4ef6\u5757\uff0c\u5219\u9700\u8981\u5927\u7ea6300M\u7684\u5185\u5b58\u3002\u56e0\u6b64\u5341\u4ebf\u7ea7\u522b\u7684\u6587\u4ef6\u6570\u91cf\u5728\u73b0\u6709\u5546\u7528\u673a\u5668\u4e0a\u96be\u4ee5\u652f\u6301\u3002 2.2.3 \u591a\u65b9\u8bfb\u5199\uff0c\u9700\u8981\u4efb\u610f\u7684\u6587\u4ef6\u4fee\u6539 \u00b6 HDFS\u91c7\u7528\u8ffd\u52a0\uff08append-only\uff09\u7684\u65b9\u5f0f\u5199\u5165\u6570\u636e\u3002\u4e0d\u652f\u6301\u6587\u4ef6\u4efb\u610foffset\u7684\u4fee\u6539\u3002\u4e0d\u652f\u6301\u591a\u4e2a\u5199\u5165\u5668\uff08writer\uff09\u3002 3. HDFS\u6838\u5fc3\u6982\u5ff5 \u00b6 3.1 BLOCK \u00b6 H\u7269\u7406\u78c1\u76d8\u4e2d\u6709\u5757\u7684\u6982\u5ff5\uff0c\u78c1\u76d8\u7684\u7269\u7406Block\u662f\u78c1\u76d8\u64cd\u4f5c\u6700\u5c0f\u7684\u5355\u5143\uff0c\u8bfb\u5199\u64cd\u4f5c\u5747\u4ee5Block\u4e3a\u6700\u5c0f\u5355\u5143\uff0c\u4e00\u822c\u4e3a512 Byte\u3002\u6587\u4ef6\u7cfb\u7edf\u5728\u7269\u7406Block\u4e4b\u4e0a\u62bd\u8c61\u4e86\u53e6\u4e00\u5c42\u6982\u5ff5\uff0c\u6587\u4ef6\u7cfb\u7edfBlock\u7269\u7406\u78c1\u76d8Block\u7684\u6574\u6570\u500d\u3002\u901a\u5e38\u4e3a\u51e0KB\u3002Hadoop\u63d0\u4f9b\u7684df\u3001fsck\u8fd9\u7c7b\u8fd0\u7ef4\u5de5\u5177\u90fd\u662f\u5728\u6587\u4ef6\u7cfb\u7edf\u7684Block\u7ea7\u522b\u4e0a\u8fdb\u884c\u64cd\u4f5c\u3002 HHDFS\u7684Block\u5757\u6bd4\u4e00\u822c\u5355\u673a\u6587\u4ef6\u7cfb\u7edf\u5927\u5f97\u591a\uff0c\u9ed8\u8ba4\u4e3a128M\u3002HDFS\u7684\u6587\u4ef6\u88ab\u62c6\u5206\u6210block-sized\u7684chunk\uff0cchunk\u4f5c\u4e3a\u72ec\u7acb\u5355\u5143\u5b58\u50a8\u3002\u6bd4Block\u5c0f\u7684\u6587\u4ef6\u4e0d\u4f1a\u5360\u7528\u6574\u4e2aBlock\uff0c\u53ea\u4f1a\u5360\u636e\u5b9e\u9645\u5927\u5c0f\u3002\u4f8b\u5982\uff0c \u5982\u679c\u4e00\u4e2a\u6587\u4ef6\u5927\u5c0f\u4e3a1M\uff0c\u5219\u5728HDFS\u4e2d\u53ea\u4f1a\u5360\u75281M\u7684\u7a7a\u95f4\uff0c\u800c\u4e0d\u662f128M\u3002 HDFS\u7684Block\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u5927\uff1f \u662f\u4e3a\u4e86\u6700\u5c0f\u5316\u67e5\u627e\uff08seek\uff09\u65f6\u95f4\uff0c\u63a7\u5236\u5b9a\u4f4d\u6587\u4ef6\u4e0e\u4f20\u8f93\u6587\u4ef6\u6240\u7528\u7684\u65f6\u95f4\u6bd4\u4f8b\u3002\u5047\u8bbe\u5b9a\u4f4d\u5230Block\u6240\u9700\u7684\u65f6\u95f4\u4e3a10ms\uff0c\u78c1\u76d8\u4f20\u8f93\u901f\u5ea6\u4e3a100M/s\u3002\u5982\u679c\u8981\u5c06\u5b9a\u4f4d\u5230Block\u6240\u7528\u65f6\u95f4\u5360\u4f20\u8f93\u65f6\u95f4\u7684\u6bd4\u4f8b\u63a7\u52361%\uff0c\u5219Block\u5927\u5c0f\u9700\u8981\u7ea6100M\u3002 \u4f46\u662f\u5982\u679cBlock\u8bbe\u7f6e\u8fc7\u5927\uff0c\u5728MapReduce\u4efb\u52a1\u4e2d\uff0cMap\u6216\u8005Reduce\u4efb\u52a1\u7684\u4e2a\u6570 \u5982\u679c\u5c0f\u4e8e\u96c6\u7fa4\u673a\u5668\u6570\u91cf\uff0c\u4f1a\u4f7f\u5f97\u4f5c\u4e1a\u8fd0\u884c\u6548\u7387\u5f88\u4f4e\u3002 Block\u62bd\u8c61\u7684\u597d\u5904 block\u7684\u62c6\u5206\u4f7f\u5f97\u5355\u4e2a\u6587\u4ef6\u5927\u5c0f\u53ef\u4ee5\u5927\u4e8e\u6574\u4e2a\u78c1\u76d8\u7684\u5bb9\u91cf\uff0c\u6784\u6210\u6587\u4ef6\u7684Block\u53ef\u4ee5\u5206\u5e03\u5728\u6574\u4e2a\u96c6\u7fa4\uff0c \u7406\u8bba\u4e0a\uff0c\u5355\u4e2a\u6587\u4ef6\u53ef\u4ee5\u5360\u636e\u96c6\u7fa4\u4e2d\u6240\u6709\u673a\u5668\u7684\u78c1\u76d8\u3002 Block\u7684\u62bd\u8c61\u4e5f\u7b80\u5316\u4e86\u5b58\u50a8\u7cfb\u7edf\uff0c\u5bf9\u4e8eBlock\uff0c\u65e0\u9700\u5173\u6ce8\u5176\u6743\u9650\uff0c\u6240\u6709\u8005\u7b49\u5185\u5bb9\uff08\u8fd9\u4e9b\u5185\u5bb9\u90fd\u5728\u6587\u4ef6\u7ea7\u522b\u4e0a\u8fdb\u884c\u63a7\u5236\uff09\u3002 Block\u4f5c\u4e3a\u5bb9\u9519\u548c\u9ad8\u53ef\u7528\u673a\u5236\u4e2d\u7684\u526f\u672c\u5355\u5143\uff0c\u5373\u4ee5Block\u4e3a\u5355\u4f4d\u8fdb\u884c\u590d\u5236\u3002 3.2 namenode datanode \u00b6 \u6574\u4e2aHDFS\u96c6\u7fa4\u7531Namenode\u548cDatanode\u6784\u6210master-worker\uff08\u4e3b\u4ece\uff09\u6a21\u5f0f\u3002Namenode\u8d1f\u8d23\u6784\u5efa\u547d\u540d\u7a7a\u95f4\uff0c\u7ba1\u7406\u6587\u4ef6\u7684\u5143\u6570\u636e\u7b49\uff0c\u800cDatanode\u8d1f\u8d23\u5b9e\u9645\u5b58\u50a8\u6570\u636e\uff0c\u8d1f\u8d23\u8bfb\u5199\u5de5\u4f5c\u3002 3.2.1 namenode \u00b6 Namenode\u5b58\u653e\u6587\u4ef6\u7cfb\u7edf\u6811\u53ca\u6240\u6709\u6587\u4ef6\u3001\u76ee\u5f55\u7684\u5143\u6570\u636e\u3002\u5143\u6570\u636e\u6301\u4e45\u5316\u4e3a2\u79cd\u5f62\u5f0f namespcae image edit log \u4f46\u662f\u6301\u4e45\u5316\u6570\u636e\u4e2d\u4e0d\u5305\u62ecBlock\u6240\u5728\u7684\u8282\u70b9\u5217\u8868\uff0c\u53ca\u6587\u4ef6\u7684Block\u5206\u5e03\u5728\u96c6\u7fa4\u4e2d\u7684\u54ea\u4e9b\u8282\u70b9\u4e0a\uff0c\u8fd9\u4e9b\u4fe1\u606f\u662f\u5728\u7cfb\u7edf\u91cd\u542f\u7684\u65f6\u5019\u91cd\u65b0\u6784\u5efa\uff08\u901a\u8fc7Datanode\u6c47\u62a5\u7684Block\u4fe1\u606f\uff09\u3002 \u5728HDFS\u4e2d\uff0cNamenode\u53ef\u80fd\u6210\u4e3a\u96c6\u7fa4\u7684\u5355\u70b9\u6545\u969c\uff0cNamenode\u4e0d\u53ef\u7528\u65f6\uff0c\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u662f\u4e0d\u53ef\u7528\u7684\u3002HDFS\u9488\u5bf9\u5355\u70b9\u6545\u969c\u63d0\u4f9b\u4e862\u79cd\u89e3\u51b3\u673a\u5236\uff1a \u5907\u4efd\u6301\u4e45\u5316\u5143\u6570\u636e \u5c06\u6587\u4ef6\u7cfb\u7edf\u7684\u5143\u6570\u636e\u540c\u65f6\u5199\u5230\u591a\u4e2a\u6587\u4ef6\u7cfb\u7edf\uff0c \u4f8b\u5982\u540c\u65f6\u5c06\u5143\u6570\u636e\u5199\u5230\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u53caNFS\u3002\u8fd9\u4e9b\u5907\u4efd\u64cd\u4f5c\u90fd\u662f\u540c\u6b65\u7684\u3001\u539f\u5b50\u7684\u3002 Secondary Namenode Secondary\u8282\u70b9\u5b9a\u671f\u5408\u5e76\u4e3bNamenode\u7684namespace image\u548cedit log\uff0c \u907f\u514dedit log\u8fc7\u5927\uff0c\u901a\u8fc7\u521b\u5efa\u68c0\u67e5\u70b9checkpoint\u6765\u5408\u5e76\u3002\u5b83\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u5408\u5e76\u540e\u7684namespace image\u526f\u672c\uff0c \u53ef\u7528\u4e8e\u5728Namenode\u5b8c\u5168\u5d29\u6e83\u65f6\u6062\u590d\u6570\u636e\u3002 Secondary Namenode\u901a\u5e38\u8fd0\u884c\u5728\u53e6\u4e00\u53f0\u673a\u5668\uff0c\u56e0\u4e3a\u5408\u5e76\u64cd\u4f5c\u9700\u8981\u8017\u8d39\u5927\u91cf\u7684CPU\u548c\u5185\u5b58\u3002\u5176\u6570\u636e\u843d\u540e\u4e8eNamenode\uff0c\u56e0\u6b64\u5f53Namenode\u5b8c\u5168\u5d29\u6e83\u65f6\uff0c\u4f1a\u51fa\u73b0\u6570\u636e\u4e22\u5931\u3002 \u901a\u5e38\u505a\u6cd5\u662f\u62f7\u8d1dNFS\u4e2d\u7684\u5907\u4efd\u5143\u6570\u636e\u5230Second\uff0c\u5c06\u5176\u4f5c\u4e3a\u65b0\u7684\u4e3bNamenode\u3002 \u5728HA\uff08High Availability\u9ad8\u53ef\u7528\u6027\uff09\u4e2d\u53ef\u4ee5\u8fd0\u884c\u4e00\u4e2aHot Standby\uff0c\u4f5c\u4e3a\u70ed\u5907\u4efd\uff0c\u5728Active Namenode\u6545\u969c\u4e4b\u540e\uff0c\u66ff\u4ee3\u539f\u6709Namenode\u6210\u4e3aActive Namenode\u3002 3.2.2 dits\u548cfsimage \u00b6 \u9996\u5148\u8981\u63d0\u5230\u4e24\u4e2a\u6587\u4ef6edits\u548cfsimage\uff0c\u4e0b\u9762\u6765\u8bf4\u8bf4\u4ed6\u4eec\u662f\u505a\u4ec0\u4e48\u7684\u3002 \u96c6\u7fa4\u4e2d\u7684\u540d\u79f0\u8282\u70b9\uff08NameNode\uff09\u4f1a\u628a\u6587\u4ef6\u7cfb\u7edf\u7684\u53d8\u5316\u4ee5\u8ffd\u52a0\u4fdd\u5b58\u5230\u65e5\u5fd7\u6587\u4ef6edits\u4e2d\u3002 \u5f53\u540d\u79f0\u8282\u70b9\uff08NameNode\uff09\u542f\u52a8\u65f6\uff0c\u4f1a\u4ece\u955c\u50cf\u6587\u4ef6 fsimage \u4e2d\u8bfb\u53d6HDFS\u7684\u72b6\u6001\uff0c\u5e76\u4e14\u628aedits\u6587\u4ef6\u4e2d\u8bb0\u5f55\u7684\u64cd\u4f5c\u5e94\u7528\u5230fsimage\uff0c\u4e5f\u5c31\u662f\u5408\u5e76\u5230fsimage\u4e2d\u53bb\u3002\u5408\u5e76\u540e\u66f4\u65b0fsimage\u7684HDFS\u72b6\u6001\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684edits\u6587\u4ef6\u6765\u8bb0\u5f55\u6587\u4ef6\u7cfb\u7edf\u7684\u53d8\u5316 3.2.3 datanode \u00b6 \u6570\u636e\u8282\u70b9\u8d1f\u8d23\u5b58\u50a8\u548c\u63d0\u53d6Block\uff0c\u8bfb\u5199\u8bf7\u6c42\u53ef\u80fd\u6765\u81eanamenode\uff0c\u4e5f\u53ef\u80fd\u76f4\u63a5\u6765\u81ea\u5ba2\u6237\u7aef\u3002\u6570\u636e\u8282\u70b9\u5468\u671f\u6027\u5411Namenode\u6c47\u62a5\u81ea\u5df1\u8282\u70b9\u4e0a\u6240\u5b58\u50a8\u7684Block\u76f8\u5173\u4fe1\u606f\u3002 3.3 block cache \u00b6 DataNode\u901a\u5e38\u76f4\u63a5\u4ece\u78c1\u76d8\u8bfb\u53d6\u6570\u636e\uff0c\u4f46\u662f\u9891\u7e41\u4f7f\u7528\u7684Block\u53ef\u4ee5\u5728\u5185\u5b58\u4e2d\u7f13\u5b58\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2aBlock\u53ea\u6709\u4e00\u4e2a\u6570\u636e\u8282\u70b9\u4f1a\u7f13\u5b58\u3002\u4f46\u662f\u53ef\u4ee5\u9488\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u53ef\u4ee5\u4e2a\u6027\u5316\u914d\u7f6e\u3002 \u4f5c\u4e1a\u8c03\u5ea6\u5668\u53ef\u4ee5\u5229\u7528\u7f13\u5b58\u63d0\u5347\u6027\u80fd\uff0c\u4f8b\u5982MapReduce\u53ef\u4ee5\u628a\u4efb\u52a1\u8fd0\u884c\u5728\u6709Block\u7f13\u5b58\u7684\u8282\u70b9\u4e0a\u3002 \u7528\u6237\u6216\u8005\u5e94\u7528\u53ef\u4ee5\u5411NameNode\u53d1\u9001\u7f13\u5b58\u6307\u4ee4\uff08\u7f13\u5b58\u54ea\u4e2a\u6587\u4ef6\uff0c\u7f13\u5b58\u591a\u4e45\uff09\uff0c \u7f13\u5b58\u6c60\u7684\u6982\u5ff5\u7528\u4e8e\u7ba1\u7406\u4e00\u7ec4\u7f13\u5b58\u7684\u6743\u9650\u548c\u8d44\u6e90\u3002 3.4 HDFS Federation \u00b6 \u6211\u4eec\u77e5\u9053NameNode\u7684\u5185\u5b58\u4f1a\u5236\u7ea6\u6587\u4ef6\u6570\u91cf\uff0cHDFS Federation\u63d0\u4f9b\u4e86\u4e00\u79cd\u6a2a\u5411\u6269\u5c55NameNode\u7684\u65b9\u5f0f\u3002\u5728Federation\u6a21\u5f0f\u4e2d\uff0c\u6bcf\u4e2aNameNode\u7ba1\u7406\u547d\u540d\u7a7a\u95f4\u7684\u4e00\u90e8\u5206\uff0c\u4f8b\u5982\u4e00\u4e2aNameNode\u7ba1\u7406/user\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c \u53e6\u4e00\u4e2aNameNode\u7ba1\u7406/share\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u3002 \u6bcf\u4e2aNameNode\u7ba1\u7406\u4e00\u4e2anamespace volumn\uff0c\u6240\u6709volumn\u6784\u6210\u6587\u4ef6\u7cfb\u7edf\u7684\u5143\u6570\u636e\u3002\u6bcf\u4e2aNameNode\u540c\u65f6\u7ef4\u62a4\u4e00\u4e2aBlock Pool\uff0c\u4fdd\u5b58Block\u7684\u8282\u70b9\u6620\u5c04\u7b49\u4fe1\u606f\u3002\u5404NameNode\u4e4b\u95f4\u662f\u72ec\u7acb\u7684\uff0c\u4e00\u4e2a\u8282\u70b9\u7684\u5931\u8d25\u4e0d\u4f1a\u5bfc\u81f4\u5176\u4ed6\u8282\u70b9\u7ba1\u7406\u7684\u6587\u4ef6\u4e0d\u53ef\u7528\u3002 \u5ba2\u6237\u7aef\u4f7f\u7528mount table\u5c06\u6587\u4ef6\u8def\u5f84\u6620\u5c04\u5230NameNode\u3002mount table\u662f\u5728Namenode\u7fa4\u7ec4\u4e4b\u4e0a\u5c01\u88c5\u4e86\u4e00\u5c42\uff0c\u8fd9\u4e00\u5c42\u4e5f\u662f\u4e00\u4e2aHadoop\u6587\u4ef6\u7cfb\u7edf\u7684\u5b9e\u73b0\uff0c\u901a\u8fc7viewfs:\u534f\u8bae\u8bbf\u95ee\u3002 3.5 HDFS HA \u00b6 \u5728HDFS\u96c6\u7fa4\u4e2d\uff0cNameNode\u4f9d\u7136\u662f\u5355\u70b9\u6545\u969c\uff08SPOF: Single Point Of Failure\uff09\u3002\u5143\u6570\u636e\u540c\u65f6\u5199\u5230\u591a\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4ee5\u53caSecond NameNode\u5b9a\u671fcheckpoint\u6709\u5229\u4e8e\u4fdd\u62a4\u6570\u636e\u4e22\u5931\uff0c\u4f46\u662f\u5e76\u4e0d\u80fd\u63d0\u9ad8\u53ef\u7528\u6027\u3002 \u8fd9\u662f\u56e0\u4e3aNameNode\u662f\u552f\u4e00\u4e00\u4e2a\u5bf9\u6587\u4ef6\u5143\u6570\u636e\u548cfile-block\u6620\u5c04\u8d1f\u8d23\u7684\u5730\u65b9\uff0c \u5f53\u5b83\u6302\u4e86\u4e4b\u540e\uff0c\u5305\u62ecMapReduce\u5728\u5185\u7684\u4f5c\u4e1a\u90fd\u65e0\u6cd5\u8fdb\u884c\u8bfb\u5199\u3002 \u5f53NameNode\u6545\u969c\u65f6\uff0c\u5e38\u89c4\u7684\u505a\u6cd5\u662f\u4f7f\u7528\u5143\u6570\u636e\u5907\u4efd\u91cd\u65b0\u542f\u52a8\u4e00\u4e2aNameNode\u3002\u5143\u6570\u636e\u5907\u4efd\u53ef\u80fd\u6765\u6e90\u4e8e\uff1a \u591a\u6587\u4ef6\u7cfb\u7edf\u5199\u5165\u4e2d\u7684\u5907\u4efd Second NameNode\u7684\u68c0\u67e5\u70b9\u6587\u4ef6 \u542f\u52a8\u65b0\u7684Namenode\u4e4b\u540e\uff0c\u9700\u8981\u91cd\u65b0\u914d\u7f6e\u5ba2\u6237\u7aef\u548cDataNode\u7684NameNode\u4fe1\u606f\u3002\u53e6\u5916\u91cd\u542f\u8017\u65f6\u4e00\u822c\u6bd4\u8f83\u4e45\uff0c\u7a0d\u5177\u89c4\u6a21\u7684\u96c6\u7fa4\u91cd\u542f\u7ecf\u5e38\u9700\u8981\u51e0\u5341\u5206\u949f\u751a\u81f3\u6570\u5c0f\u65f6\uff0c\u9020\u6210\u91cd\u542f\u8017\u65f6\u7684\u539f\u56e0\u5927\u81f4\u6709\uff1a \u5143\u6570\u636e\u955c\u50cf\u6587\u4ef6\u8f7d\u5165\u5230\u5185\u5b58\u8017\u65f6\u8f83\u957f\u3002 \u9700\u8981\u91cd\u653eedit log \u9700\u8981\u6536\u5230\u6765\u81eaDataNode\u7684\u72b6\u6001\u62a5\u544a\u5e76\u4e14\u6ee1\u8db3\u6761\u4ef6\u540e\u624d\u80fd\u79bb\u5f00\u5b89\u5168\u6a21\u5f0f\u63d0\u4f9b\u5199\u670d\u52a1\u3002 4. hadoop ha \u00b6 \u91c7\u7528HA\u7684HDFS\u96c6\u7fa4\u914d\u7f6e\u4e24\u4e2aNameNode\uff0c\u5206\u522b\u5904\u4e8eActive\u548cStandby\u72b6\u6001\u3002\u5f53Active NameNode\u6545\u969c\u4e4b\u540e\uff0cStandby\u63a5\u8fc7\u8d23\u4efb\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\uff0c\u7528\u6237\u6ca1\u6709\u660e\u663e\u7684\u4e2d\u65ad\u611f\u89c9\u3002\u4e00\u822c\u8017\u65f6\u5728\u51e0\u5341\u79d2\u5230\u6570\u5206\u949f\u3002 HA\u6d89\u53ca\u5230\u7684\u4e3b\u8981\u5b9e\u73b0\u903b\u8f91\u6709 4.1 \u5b58\u50a8 \u00b6 \u4e3b\u5907\u9700\u5171\u4eabedit log\u5b58\u50a8\uff0c\u4e3bNameNode\u548c\u5f85\u547d\u7684NameNode\u5171\u4eab\u4e00\u4efdedit log\uff0c\u5f53\u4e3b\u5907\u5207\u6362\u65f6\uff0cStandby\u901a\u8fc7\u56de\u653eedit log\u540c\u6b65\u6570\u636e\u3002 \u5171\u4eab\u5b58\u50a8\u901a\u5e38\u67092\u79cd\u9009\u62e9 NFS\uff1a\u4f20\u7edf\u7684\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf QJM\uff1aquorum journal manager QJM\u662f\u4e13\u95e8\u4e3aHDFS\u7684HA\u5b9e\u73b0\u800c\u8bbe\u8ba1\u7684\uff0c\u7528\u6765\u63d0\u4f9b\u9ad8\u53ef\u7528\u7684edit log\u3002QJM\u8fd0\u884c\u4e00\u7ec4journal node\uff0cedit log\u5fc5\u987b\u5199\u5230\u5927\u90e8\u5206\u7684journal nodes\u3002\u901a\u5e38\u4f7f\u75283\u4e2a\u8282\u70b9\uff0c\u56e0\u6b64\u5141\u8bb8\u4e00\u4e2a\u8282\u70b9\u5931\u8d25\uff0c\u7c7b\u4f3cZooKeeper\u3002\u6ce8\u610fQJM\u6ca1\u6709\u4f7f\u7528ZK\uff0c\u867d\u7136HDFS HA\u7684\u786e\u4f7f\u7528\u4e86ZK\u6765\u9009\u4e3e\u4e3bNamenode\u3002\u4e00\u822c\u63a8\u8350\u4f7f\u7528QJM\u3002 4.2 \u6570\u636e\u53d1\u9001 \u00b6 DataNode\u9700\u8981\u540c\u65f6\u5f80\u4e3b\u5907\u53d1\u9001Block Report \uff0c\u56e0\u4e3aBlock\u6620\u5c04\u6570\u636e\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff08\u4e0d\u662f\u5728\u78c1\u76d8\u4e0a\uff09\uff0c\u4e3a\u4e86\u5728Active NameNode\u6302\u6389\u4e4b\u540e\uff0c\u65b0\u7684NameNode\u80fd\u591f\u5feb\u901f\u542f\u52a8\uff0c\u4e0d\u9700\u8981\u7b49\u5f85\u6765\u81eaDatanode\u7684Block Report\uff0cDataNode\u9700\u8981\u540c\u65f6\u5411\u4e3b\u5907\u4e24\u4e2aNameNode\u53d1\u9001Block Report\u3002 4.3 failover \u00b6 \u5ba2\u6237\u7aef\u9700\u8981\u914d\u7f6efailover\u6a21\u5f0f\uff08\u5931\u6548\u5907\u63f4\u6a21\u5f0f\uff0c\u5bf9\u7528\u6237\u900f\u660e\uff09,Namenode\u7684\u5207\u6362\u5bf9\u5ba2\u6237\u7aef\u6765\u8bf4\u662f\u65e0\u611f\u77e5\u7684\uff0c\u901a\u8fc7\u5ba2\u6237\u7aef\u5e93\u6765\u5b9e\u73b0\u3002\u5ba2\u6237\u7aef\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528\u7684HDFS URI\u662f\u903b\u8f91\u8def\u5f84\uff0c\u6620\u5c04\u5230\u4e00\u5bf9Namenode\u5730\u5740\u3002\u5ba2\u6237\u7aef\u4f1a\u4e0d\u65ad\u5c1d\u8bd5\u6bcf\u4e00\u4e2aNamenode\u5730\u5740\u76f4\u5230\u6210\u529f\u3002 4.4 \u63a5\u7ba1 \u00b6 Standby\u66ff\u4ee3Secondary NameNode \uff0c\u5982\u679c\u6ca1\u6709\u542f\u7528HA\uff0cHDFS\u72ec\u7acb\u8fd0\u884c\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b\u4f5c\u4e3aSecondary Namenode\u3002\u5b9a\u671fcheckpoint\uff0c\u5408\u5e76\u955c\u50cf\u6587\u4ef6\u548cedit\u65e5\u5fd7\u3002 \u5982\u679c\u5f53\u4e3bNamenode\u5931\u8d25\u65f6\uff0c\u5907\u4efdNamenode\u6b63\u5728\u5173\u673a\uff08\u505c\u6b62 Standby\uff09\uff0c\u8fd0\u7ef4\u4eba\u5458\u4f9d\u7136\u53ef\u4ee5\u4ece\u5934\u542f\u52a8\u5907\u4efdNamenode\uff0c\u8fd9\u6837\u6bd4\u6ca1\u6709HA\u7684\u65f6\u5019\u66f4\u7701\u4e8b\uff0c\u7b97\u662f\u4e00\u79cd\u6539\u8fdb\uff0c\u56e0\u4e3a\u91cd\u542f\u6574\u4e2a\u8fc7\u7a0b\u5df2\u7ecf\u6807\u51c6\u5316\u5230Hadoop\u5185\u90e8\uff0c\u65e0\u9700\u8fd0\u7ef4\u8fdb\u884c\u590d\u6742\u7684\u5207\u6362\u64cd\u4f5c\u3002 NameNode\u7684\u5207\u6362\u901a\u8fc7\u4ee3failover controller\u6765\u5b9e\u73b0\u3002failover controller\u6709\u591a\u79cd\u5b9e\u73b0\uff0c\u9ed8\u8ba4\u5b9e\u73b0\u4f7f\u7528ZooKeeper\u6765\u4fdd\u8bc1\u53ea\u6709\u4e00\u4e2aNamenode\u5904\u4e8eactive\u72b6\u6001\u3002 \u6bcf\u4e2aNamenode\u8fd0\u884c\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684failover controller\u8fdb\u7a0b\uff0c\u8be5\u8fdb\u7a0b\u4f7f\u7528\u7b80\u5355\u7684\u5fc3\u8df3\u673a\u5236\u6765\u76d1\u63a7Namenode\u7684\u5b58\u6d3b\u72b6\u6001\u5e76\u5728Namenode\u5931\u8d25\u65f6\u89e6\u53d1failover\u3002Failover\u53ef\u4ee5\u7531\u8fd0\u7ef4\u624b\u52a8\u89e6\u53d1\uff0c\u4f8b\u5982\u5728\u65e5\u5e38\u7ef4\u62a4\u4e2d\u9700\u8981\u5207\u6362\u4e3bNamenode\uff0c\u8fd9\u79cd\u60c5\u51b5graceful(\u4f18\u96c5\u7684) failover\uff0c\u975e\u624b\u52a8\u89e6\u53d1\u7684failover\u79f0\u4e3aungraceful failover\u3002 \u5728ungraceful failover\u7684\u60c5\u51b5\u4e0b\uff0c\u6ca1\u6709\u529e\u6cd5\u786e\u5b9a\u5931\u8d25\uff08\u88ab\u5224\u5b9a\u4e3a\u5931\u8d25\uff09\u7684\u8282\u70b9\u662f\u5426\u505c\u6b62\u8fd0\u884c\uff0c\u4e5f\u5c31\u662f\u8bf4\u89e6\u53d1failover\u540e\uff0c\u4e4b\u524d\u7684\u4e3bNamenode\u53ef\u80fd\u8fd8\u5728\u8fd0\u884c\u3002QJM\u4e00\u6b21\u53ea\u5141\u8bb8\u4e00\u4e2aNamenode\u5199edit log\uff0c\u4f46\u662f\u4e4b\u524d\u7684\u4e3bNamenode\u4ecd\u7136\u53ef\u4ee5\u63a5\u53d7\u8bfb\u8bf7\u6c42\u3002Hadoop\u4f7f\u7528fencing\u6765\u6740\u6389\u4e4b\u524d\u7684Namenode\u3002Fencing\u901a\u8fc7\u6536\u56de\u4e4b\u524dNamenode\u5bf9\u5171\u4eab\u7684edit log\u7684\u8bbf\u95ee\u6743\u9650\u3001\u5173\u95ed\u5176\u7f51\u7edc\u7aef\u53e3\u4f7f\u5f97\u539f\u6709\u7684Namenode\u4e0d\u80fd\u518d\u7ee7\u7eed\u63a5\u53d7\u670d\u52a1\u8bf7\u6c42\u3002\u4f7f\u7528STONITH\u6280\u672f\u4e5f\u53ef\u4ee5\u5c06\u4e4b\u524d\u7684\u4e3bNamenode\u5173\u673a\u3002 \u6700\u540e\uff0cHA\u65b9\u6848\u4e2dNamenode\u7684\u5207\u6362\u5bf9\u5ba2\u6237\u7aef\u6765\u8bf4\u662f\u4e0d\u53ef\u89c1\u7684\uff0c\u524d\u9762\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\uff0c\u4e3b\u8981\u901a\u8fc7\u5ba2\u6237\u7aef\u5e93\u6765\u5b8c\u6210\u3002 5. HDFS \u5982\u4f55\u5b58\u50a8\u6570\u636e \u00b6 HDFS \u91c7\u7528Master/Slave\u7684\u67b6\u6784\u6765\u5b58\u50a8\u6570\u636e\uff0c\u8fd9\u79cd\u67b6\u6784\u4e3b\u8981\u7531\u56db\u4e2a\u90e8\u5206\u7ec4\u6210\uff0c\u5206\u522b\u4e3aHDFS Client\u3001NameNode\u3001DataNode\u548cSecondary NameNode\u3002\u4e0b\u9762\u6211\u4eec\u5206\u522b\u4ecb\u7ecd\u8fd9\u56db\u4e2a\u7ec4\u6210\u90e8\u5206 5.1 Client \u00b6 Client\uff1a\u5c31\u662f\u5ba2\u6237\u7aef. \u6587\u4ef6\u5207\u5206\u3002\u6587\u4ef6\u4e0a\u4f20 HDFS \u7684\u65f6\u5019\uff0cClient \u5c06\u6587\u4ef6\u5207\u5206\u6210 \u4e00\u4e2a\u4e00\u4e2a\u7684Block\uff0c\u7136\u540e\u8fdb\u884c\u5b58\u50a8\u3002 \u4e0e NameNode \u4ea4\u4e92\uff0c\u83b7\u53d6\u6587\u4ef6\u7684\u4f4d\u7f6e\u4fe1\u606f\u3002 \u4e0e DataNode \u4ea4\u4e92\uff0c\u8bfb\u53d6\u6216\u8005\u5199\u5165\u6570\u636e\u3002 Client \u63d0\u4f9b\u4e00\u4e9b\u547d\u4ee4\u6765\u7ba1\u7406 HDFS\uff0c\u6bd4\u5982\u542f\u52a8\u6216\u8005\u5173\u95edHDFS\u3002 Client \u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u547d\u4ee4\u6765\u8bbf\u95ee HDFS\u3002 5.2 namenode \u00b6 NameNode\uff1a\u5c31\u662f master\uff0c\u5b83\u662f\u4e00\u4e2a\u4e3b\u7ba1\u3001\u7ba1\u7406\u8005\u3002 \u7ba1\u7406 HDFS \u7684\u540d\u79f0\u7a7a\u95f4 \u7ba1\u7406\u6570\u636e\u5757\uff08Block\uff09\u6620\u5c04\u4fe1\u606f \u914d\u7f6e\u526f\u672c\u7b56\u7565 \u5904\u7406\u5ba2\u6237\u7aef\u8bfb\u5199\u8bf7\u6c42\u3002 5.3 DataNode \u00b6 \u5c31\u662fSlave\u3002NameNode \u4e0b\u8fbe\u547d\u4ee4\uff0cDataNode \u6267\u884c\u5b9e\u9645\u7684\u64cd\u4f5c\u3002 \u5b58\u50a8\u5b9e\u9645\u7684\u6570\u636e\u5757\u3002 \u6267\u884c\u6570\u636e\u5757\u7684\u8bfb/\u5199\u64cd\u4f5c\u3002 5.4 Secondary NameNode \u00b6 \u5e76\u975e NameNode \u7684\u70ed\u5907\u3002\u5f53NameNode \u6302\u6389\u7684\u65f6\u5019\uff0c\u5b83\u5e76\u4e0d\u80fd\u9a6c\u4e0a\u66ff\u6362 NameNode \u5e76\u63d0\u4f9b\u670d\u52a1\u3002 \u8f85\u52a9 NameNode\uff0c\u5206\u62c5\u5176\u5de5\u4f5c\u91cf\u3002 \u5b9a\u671f\u5408\u5e76 fsimage\u548cfsedits\uff0c\u5e76\u63a8\u9001\u7ed9NameNode\u3002 \u5728\u7d27\u6025\u60c5\u51b5\u4e0b\uff0c\u53ef\u8f85\u52a9\u6062\u590d NameNode\u3002 6. HDFS \u5982\u4f55\u8bfb\u53d6\u6587\u4ef6 \u00b6 HDFS\u7684\u6587\u4ef6\u8bfb\u53d6\u539f\u7406\uff0c\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a \u9996\u5148\u8c03\u7528FileSystem\u5bf9\u8c61\u7684open\u65b9\u6cd5\uff0c\u5176\u5b9e\u83b7\u53d6\u7684\u662f\u4e00\u4e2aDistributedFileSystem\u7684\u5b9e\u4f8b\u3002 DistributedFileSystem\u901a\u8fc7RPC(\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528)\u83b7\u5f97\u6587\u4ef6\u7684\u7b2c\u4e00\u6279block\u7684locations\uff0c\u540c\u4e00block\u6309\u7167\u91cd\u590d\u6570\u4f1a\u8fd4\u56de\u591a\u4e2alocations\uff0c\u8fd9\u4e9blocations\u6309\u7167hadoop\u62d3\u6251\u7ed3\u6784\u6392\u5e8f\uff0c\u8ddd\u79bb\u5ba2\u6237\u7aef\u8fd1\u7684\u6392\u5728\u524d\u9762\u3002 \u524d\u4e24\u6b65\u4f1a\u8fd4\u56de\u4e00\u4e2aFSDataInputStream\u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u4f1a\u88ab\u5c01\u88c5\u6210 DFSInputStream\u5bf9\u8c61\uff0cDFSInputStream\u53ef\u4ee5\u65b9\u4fbf\u7684\u7ba1\u7406datanode\u548cnamenode\u6570\u636e\u6d41\u3002\u5ba2\u6237\u7aef\u8c03\u7528read\u65b9\u6cd5\uff0cDFSInputStream\u5c31\u4f1a\u627e\u51fa\u79bb\u5ba2\u6237\u7aef\u6700\u8fd1\u7684datanode\u5e76\u8fde\u63a5datanode\u3002 \u6570\u636e\u4ecedatanode\u6e90\u6e90\u4e0d\u65ad\u7684\u6d41\u5411\u5ba2\u6237\u7aef\u3002 \u5982\u679c\u7b2c\u4e00\u4e2ablock\u5757\u7684\u6570\u636e\u8bfb\u5b8c\u4e86\uff0c\u5c31\u4f1a\u5173\u95ed\u6307\u5411\u7b2c\u4e00\u4e2ablock\u5757\u7684datanode\u8fde\u63a5\uff0c\u63a5\u7740\u8bfb\u53d6\u4e0b\u4e00\u4e2ablock\u5757\u3002\u8fd9\u4e9b\u64cd\u4f5c\u5bf9\u5ba2\u6237\u7aef\u6765\u8bf4\u662f\u900f\u660e\u7684\uff0c\u4ece\u5ba2\u6237\u7aef\u7684\u89d2\u5ea6\u6765\u770b\u53ea\u662f\u8bfb\u4e00\u4e2a\u6301\u7eed\u4e0d\u65ad\u7684\u6d41\u3002 \u5982\u679c\u7b2c\u4e00\u6279block\u90fd\u8bfb\u5b8c\u4e86\uff0cDFSInputStream\u5c31\u4f1a\u53bbnamenode\u62ff\u4e0b\u4e00\u6279blocks\u7684location\uff0c\u7136\u540e\u7ee7\u7eed\u8bfb\uff0c\u5982\u679c\u6240\u6709\u7684block\u5757\u90fd\u8bfb\u5b8c\uff0c\u8fd9\u65f6\u5c31\u4f1a\u5173\u95ed\u6389\u6240\u6709\u7684\u6d41\u3002 7. HDFS \u5982\u4f55\u5199\u5165\u6587\u4ef6 \u00b6 HDFS\u7684\u6587\u4ef6\u5199\u5165\u539f\u7406\uff0c\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a \u5ba2\u6237\u7aef\u901a\u8fc7\u8c03\u7528 DistributedFileSystem \u7684create\u65b9\u6cd5\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6\u3002 DistributedFileSystem \u901a\u8fc7 RPC\uff08\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\uff09\u8c03\u7528 NameNode\uff0c\u53bb\u521b\u5efa\u4e00\u4e2a\u6ca1\u6709blocks\u5173\u8054\u7684\u65b0\u6587\u4ef6\u3002\u521b\u5efa\u524d\uff0cNameNode \u4f1a\u505a\u5404\u79cd\u6821\u9a8c\uff0c\u6bd4\u5982\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u5ba2\u6237\u7aef\u6709\u65e0\u6743\u9650\u53bb\u521b\u5efa\u7b49\u3002\u5982\u679c\u6821\u9a8c\u901a\u8fc7\uff0cNameNode \u5c31\u4f1a\u8bb0\u5f55\u4e0b\u65b0\u6587\u4ef6\uff0c\u5426\u5219\u5c31\u4f1a\u629b\u51faIO\u5f02\u5e38\u3002 \u524d\u4e24\u6b65\u7ed3\u675f\u540e\u4f1a\u8fd4\u56de FSDataOutputStream \u7684\u5bf9\u8c61\uff0c\u548c\u8bfb\u6587\u4ef6\u7684\u65f6\u5019\u76f8\u4f3c\uff0cFSDataOutputStream \u88ab\u5c01\u88c5\u6210 DFSOutputStream\uff0cDFSOutputStream \u53ef\u4ee5\u534f\u8c03 NameNode\u548c DataNode\u3002\u5ba2\u6237\u7aef\u5f00\u59cb\u5199\u6570\u636e\u5230DFSOutputStream,DFSOutputStream\u4f1a\u628a\u6570\u636e\u5207\u6210\u4e00\u4e2a\u4e2a\u5c0fpacket\uff0c\u7136\u540e\u6392\u6210\u961f\u5217 data queue\u3002 DataStreamer \u4f1a\u53bb\u5904\u7406\u63a5\u53d7 data queue\uff0c\u5b83\u5148\u95ee\u8be2 NameNode \u8fd9\u4e2a\u65b0\u7684 block \u6700\u9002\u5408\u5b58\u50a8\u7684\u5728\u54ea\u51e0\u4e2aDataNode\u91cc\uff0c\u6bd4\u5982\u91cd\u590d\u6570\u662f3\uff0c\u90a3\u4e48\u5c31\u627e\u52303\u4e2a\u6700\u9002\u5408\u7684 DataNode\uff0c\u628a\u5b83\u4eec\u6392\u6210\u4e00\u4e2a pipeline\u3002DataStreamer \u628a packet \u6309\u961f\u5217\u8f93\u51fa\u5230\u7ba1\u9053\u7684\u7b2c\u4e00\u4e2a DataNode \u4e2d\uff0c\u7b2c\u4e00\u4e2a DataNode\u53c8\u628a packet \u8f93\u51fa\u5230\u7b2c\u4e8c\u4e2a DataNode \u4e2d\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002 DFSOutputStream \u8fd8\u6709\u4e00\u4e2a\u961f\u5217\u53eb ack queue\uff0c\u4e5f\u662f\u7531 packet \u7ec4\u6210\uff0c\u7b49\u5f85DataNode\u7684\u6536\u5230\u54cd\u5e94\uff0c\u5f53pipeline\u4e2d\u7684\u6240\u6709DataNode\u90fd\u8868\u793a\u5df2\u7ecf\u6536\u5230\u7684\u65f6\u5019\uff0c\u8fd9\u65f6akc queue\u624d\u4f1a\u628a\u5bf9\u5e94\u7684packet\u5305\u79fb\u9664\u6389\u3002 \u5ba2\u6237\u7aef\u5b8c\u6210\u5199\u6570\u636e\u540e\uff0c\u8c03\u7528close\u65b9\u6cd5\u5173\u95ed\u5199\u5165\u6d41\u3002 DataStreamer \u628a\u5269\u4f59\u7684\u5305\u90fd\u5237\u5230 pipeline \u91cc\uff0c\u7136\u540e\u7b49\u5f85 ack \u4fe1\u606f\uff0c\u6536\u5230\u6700\u540e\u4e00\u4e2a ack \u540e\uff0c\u901a\u77e5 DataNode \u628a\u6587\u4ef6\u6807\u793a\u4e3a\u5df2\u5b8c\u6210\u3002 8. HDFS \u526f\u672c\u5b58\u653e\u7b56\u7565 \u00b6 namenode\u5982\u4f55\u9009\u62e9\u5728\u54ea\u4e2adatanode \u5b58\u50a8\u526f\u672c\uff08replication\uff09\uff1f\u8fd9\u91cc\u9700\u8981\u5bf9\u53ef\u9760\u6027\u3001\u5199\u5165\u5e26\u5bbd\u548c\u8bfb\u53d6\u5e26\u5bbd\u8fdb\u884c\u6743\u8861\u3002Hadoop\u5bf9datanode\u5b58\u50a8\u526f\u672c\u6709\u81ea\u5df1\u7684\u526f\u672c\u7b56\u7565\uff0c\u5728\u5176\u53d1\u5c55\u8fc7\u7a0b\u4e2d\u4e00\u5171\u6709\u4e24\u4e2a\u7248\u672c\u7684\u526f\u672c\u7b56\u7565\uff0c\u5206\u522b\u5982\u4e0b\u6240\u793a 9. hadoop2.x\u65b0\u7279\u6027 \u00b6 \u5f15\u5165\u4e86NameNode Federation\uff0c\u89e3\u51b3\u4e86\u6a2a\u5411\u5185\u5b58\u6269\u5c55 \u5f15\u5165\u4e86Namenode HA\uff0c\u89e3\u51b3\u4e86namenode\u5355\u70b9\u6545\u969c \u5f15\u5165\u4e86YARN\uff0c\u8d1f\u8d23\u8d44\u6e90\u7ba1\u7406\u548c\u8c03\u5ea6 \u589e\u52a0\u4e86ResourceManager HA\u89e3\u51b3\u4e86ResourceManager\u5355\u70b9\u6545\u969c 9.1 NameNode Federation \u00b6 \u5b58\u5728\u591a\u4e2aNameNode\uff0c\u6bcf\u4e2aNameNode\u5206\u7ba1\u4e00\u90e8\u5206\u76ee\u5f55 NameNode\u5171\u7528DataNode \u8fd9\u6837\u505a\u7684\u597d\u5904\u5c31\u662f\u5f53NN\u5185\u5b58\u53d7\u9650\u65f6\uff0c\u80fd\u6269\u5c55\u5185\u5b58\uff0c\u89e3\u51b3\u5185\u5b58\u6269\u5c55\u95ee\u9898\uff0c\u800c\u4e14\u6bcf\u4e2aNN\u72ec\u7acb\u5de5\u4f5c\u76f8\u4e92\u4e0d\u53d7\u5f71\u54cd\uff0c\u6bd4\u5982\u5176\u4e2d\u4e00\u4e2aNN\u6302\u6389\u5566\uff0c\u5b83\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6NN\u63d0\u4f9b\u670d\u52a1\uff0c\u4f46\u6211\u4eec\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u867d\u7136\u6709\u591a\u4e2aNN\uff0c\u5206\u7ba1\u4e0d\u540c\u7684\u76ee\u5f55\uff0c\u4f46\u662f\u5bf9\u4e8e\u7279\u5b9a\u7684NN\uff0c\u4f9d\u7136\u5b58\u5728\u5355\u70b9\u6545\u969c\uff0c\u56e0\u4e3a\u6ca1\u6709\u5b83\u6ca1\u6709\u70ed\u5907\uff0c\u89e3\u51b3\u5355\u70b9\u6545\u969c\u4f7f\u7528NameNode HA 9.2 NameNode HA \u00b6 \u57fa\u4e8eNFS\u5171\u4eab\u5b58\u50a8\u89e3\u51b3\u65b9\u6848 \u57fa\u4e8eQurom Journal Manager(QJM)\u89e3\u51b3\u65b9\u6848 9.2.1 \u57fa\u4e8eNFS\u65b9\u6848 \u00b6 Active NN\u4e0eStandby NN\u901a\u8fc7NFS\u5b9e\u73b0\u5171\u4eab\u6570\u636e\uff0c\u4f46\u5982\u679cActive NN\u4e0eNFS\u4e4b\u95f4\u6216Standby NN\u4e0eNFS\u4e4b\u95f4\uff0c\u5176\u4e2d\u4e00\u5904\u6709\u7f51\u7edc\u6545\u969c\u7684\u8bdd\uff0c\u90a3\u5c31\u4f1a\u9020\u6210\u6570\u636e\u540c\u6b65\u95ee\u9898\u3002 9.2.2 \u57fa\u4e8eQJM\u65b9\u6848 \u00b6 Active NN\u3001Standby NN\u6709\u4e3b\u5907\u4e4b\u5206\uff0cNN Active\u662f\u4e3b\u7684\uff0cNN Standby\u5907\u7528\u7684 \u96c6\u7fa4\u542f\u52a8\u4e4b\u540e\uff0c\u4e00\u4e2anamenode\u662factive\u72b6\u6001\uff0c\u6765\u5904\u7406client\u4e0edatanode\u4e4b\u95f4\u7684\u8bf7\u6c42\uff0c\u5e76\u628a\u76f8\u5e94\u7684\u65e5\u5fd7\u6587\u4ef6\u5199\u5230\u672c\u5730\u4e2d\u6216JN\u4e2d\uff1b Active NN\u4e0eStandby NN\u4e4b\u95f4\u662f\u901a\u8fc7\u4e00\u7ec4JN\u5171\u4eab\u6570\u636e\uff08JN\u4e00\u822c\u4e3a\u5947\u6570\u4e2a\uff0cZK\u4e00\u822c\u4e5f\u4e3a\u5947\u6570\u4e2a\uff09\uff0cActive NN\u4f1a\u628a\u65e5\u5fd7\u6587\u4ef6\u3001\u955c\u50cf\u6587\u4ef6\u5199\u5230JN\u4e2d\u53bb\uff0c\u53ea\u8981JN\u4e2d\u6709\u4e00\u534a\u5199\u6210\u529f\uff0c\u90a3\u5c31\u8868\u660eActive NN\u5411JN\u4e2d\u5199\u6210\u529f\u5566\uff0cStandby NN\u5c31\u5f00\u59cb\u4eceJN\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u6765\u5b9e\u73b0\u4e0eActive NN\u6570\u636e\u540c\u6b65\uff0c\u8fd9\u79cd\u65b9\u5f0f\u652f\u6301\u5bb9\u9519\uff0c\u56e0\u4e3aStandby NN\u5728\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u8f7d\u955c\u50cf\u6587\u4ef6\uff08fsimage\uff09\u5e76\u5468\u671f\u6027\u7684\u4eceJN\u4e2d\u83b7\u53d6\u65e5\u5fd7\u6587\u4ef6\u6765\u4fdd\u6301\u4e0eActive NN\u540c\u6b65 \u4e3a\u4e86\u5b9e\u73b0Standby NN\u5728Active NN\u6302\u6389\u4e4b\u540e\uff0c\u80fd\u8fc5\u901f\u7684\u518d\u63d0\u4f9b\u670d\u52a1\uff0c\u9700\u8981DN\u4e0d\u4ec5\u9700\u8981\u5411Active NN\u6c47\u62a5\uff0c\u540c\u65f6\u8fd8\u8981\u5411Standby NN\u6c47\u62a5\uff0c\u8fd9\u6837\u5c31\u4f7f\u5f97Standby NN\u80fd\u4fdd\u5b58\u6570\u636e\u5757\u5728DN\u4e0a\u7684\u4f4d\u7f6e\u4fe1\u606f\uff0c\u56e0\u4e3a\u5728NameNode\u5728\u542f\u52a8\u8fc7\u7a0b\u4e2d\u6700\u8d39\u65f6\u5de5\u4f5c\uff0c\u5c31\u662f\u5904\u7406\u6240\u6709DN\u4e0a\u7684\u6570\u636e\u5757\u7684\u4fe1\u606f \u4e3a\u4e86\u5b9e\u73b0Active NN\u9ad8\u70ed\u5907\uff0c\u589e\u52a0\u4e86FailoverController\u548cZK\uff0cFailoverController\u901a\u8fc7Heartbeat\u7684\u65b9\u5f0f\u4e0eZK\u901a\u4fe1\uff0c\u901a\u8fc7ZK\u6765\u9009\u4e3e\uff0c\u4e00\u65e6Active NN\u6302\u6389\uff0c\u5c31\u9009\u53d6\u53e6\u4e00\u4e2aFailoverController\u4f5c\u4e3aactive\u72b6\u6001\uff0c\u7136\u540eFailoverController\u901a\u8fc7rpc\uff0c\u8ba9standby NN\u8f6c\u53d8\u4e3aActive NN FailoverController\u4e00\u65b9\u9762\u76d1\u63a7NN\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u4e00\u65b9\u9762\u8fd8\u5411ZK\u5b9a\u65f6\u53d1\u9001\u5fc3\u8df3\uff0c\u4f7f\u81ea\u5df1\u88ab\u9009\u4e3e\u3002\u5f53\u81ea\u5df1\u88ab\u9009\u4e3a\u4e3b\uff08Active\uff09\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u901a\u8fc7rpc\u4f7f\u76f8\u5e94NN\u8f6c\u53d8Active\u72b6\u6001 \u7ed3\u5408HDFS2\u7684\u65b0\u7279\u6027\uff0c\u5728\u5b9e\u9645\u751f\u6210\u73af\u5883\u4e2d\u90e8\u7f72\u56fe \u8fd9\u91cc\u670912\u4e2aDN,\u67094\u4e2aNN\uff0cNN-1\u4e0eNN-2\u662f\u4e3b\u5907\u5173\u7cfb\uff0c\u5b83\u4eec\u7ba1\u7406/share\u76ee\u5f55\uff1bNN-3\u4e0eNN-4\u662f\u4e3b\u5907\u5173\u7cfb\uff0c\u5b83\u4eec\u7ba1\u7406/user\u76ee\u5f55","title":"1. HDFS \u4ecb\u7ecd"},{"location":"hadoop/CDH/cdh.hdfs_info/#1","text":"\u5728\u73b0\u4ee3\u7684\u4f01\u4e1a\u73af\u5883\u4e2d\uff0c\u5355\u673a\u5bb9\u91cf\u5f80\u5f80\u65e0\u6cd5\u5b58\u50a8\u5927\u91cf\u6570\u636e\uff0c\u9700\u8981\u8de8\u673a\u5668\u5b58\u50a8\u3002\u7edf\u4e00\u7ba1\u7406\u5206\u5e03\u5728\u96c6\u7fa4\u4e0a\u7684\u6587\u4ef6\u7cfb\u7edf\u79f0\u4e3a\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u3002\u800c\u4e00\u65e6\u5728\u7cfb\u7edf\u4e2d\uff0c\u5f15\u5165\u7f51\u7edc\uff0c\u5c31\u4e0d\u53ef\u907f\u514d\u5730\u5f15\u5165\u4e86\u6240\u6709\u7f51\u7edc\u7f16\u7a0b\u7684\u590d\u6742\u6027\uff0c\u4f8b\u5982\u6311\u6218\u4e4b\u4e00\u662f\u5982\u679c\u4fdd\u8bc1\u5728\u8282\u70b9\u4e0d\u53ef\u7528\u7684\u65f6\u5019\u6570\u636e\u4e0d\u4e22\u5931\u3002 \u4f20\u7edf\u7684\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\uff08NFS\uff09\u867d\u7136\u4e5f\u79f0\u4e3a\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u4f46\u662f\u5176\u5b58\u5728\u4e00\u4e9b\u9650\u5236\u3002\u7531\u4e8eNFS\u4e2d\uff0c\u6587\u4ef6\u662f\u5b58\u50a8\u5728\u5355\u673a\u4e0a\uff0c\u56e0\u6b64\u65e0\u6cd5\u63d0\u4f9b\u53ef\u9760\u6027\u4fdd\u8bc1\uff0c\u5f53\u5f88\u591a\u5ba2\u6237\u7aef\u540c\u65f6\u8bbf\u95eeNFS Server\u65f6\uff0c\u5f88\u5bb9\u6613\u9020\u6210\u670d\u52a1\u5668\u538b\u529b\uff0c\u9020\u6210\u6027\u80fd\u74f6\u9888\u3002\u53e6\u5916\u5982\u679c\u8981\u5bf9NFS\u4e2d\u7684\u6587\u4ef6\u8fdb\u884c\u64cd\u4f5c\uff0c\u9700\u8981\u9996\u5148\u540c\u6b65\u5230\u672c\u5730\uff0c\u8fd9\u4e9b\u4fee\u6539\u5728\u540c\u6b65\u5230\u670d\u52a1\u7aef\u4e4b\u524d\uff0c\u5176\u4ed6\u5ba2\u6237\u7aef\u662f\u4e0d\u53ef\u89c1\u7684\u3002\u67d0\u79cd\u7a0b\u5ea6\u4e0a\uff0cNFS\u4e0d\u662f\u4e00\u79cd\u5178\u578b\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u867d\u7136\u5b83\u7684\u6587\u4ef6\u7684\u786e\u653e\u5728\u8fdc\u7aef\uff08\u5355\u4e00\uff09\u7684\u670d\u52a1\u5668\u4e0a\u9762\u3002 \u4eceNFS\u7684\u534f\u8bae\u6808\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u4e8b\u5b9e\u4e0a\u662f\u4e00\u79cdVFS\uff08\u64cd\u4f5c\u7cfb\u7edf\u5bf9\u6587\u4ef6\u7684\u4e00\u79cd\u62bd\u8c61\uff09\u5b9e\u73b0\u3002 HDFS\uff0c\u662fHadoop Distributed File System\u7684\u7b80\u79f0\uff0c\u662fHadoop\u62bd\u8c61\u6587\u4ef6\u7cfb\u7edf\u7684\u4e00\u79cd\u5b9e\u73b0\u3002Hadoop\u62bd\u8c61\u6587\u4ef6\u7cfb\u7edf\u53ef\u4ee5\u4e0e\u672c\u5730\u7cfb\u7edf\u3001Amazon S3\u7b49\u96c6\u6210\uff0c\u751a\u81f3\u53ef\u4ee5\u901a\u8fc7Web\u534f\u8bae\uff08webhsfs\uff09\u6765\u64cd\u4f5c\u3002HDFS\u7684\u6587\u4ef6\u5206\u5e03\u5728\u96c6\u7fa4\u673a\u5668\u4e0a\uff0c\u540c\u65f6\u63d0\u4f9b\u526f\u672c\u8fdb\u884c\u5bb9\u9519\u53ca\u53ef\u9760\u6027\u4fdd\u8bc1\u3002\u4f8b\u5982\u5ba2\u6237\u7aef\u5199\u5165\u8bfb\u53d6\u6587\u4ef6\u7684\u76f4\u63a5\u64cd\u4f5c\u90fd\u662f\u5206\u5e03\u5728\u96c6\u7fa4\u5404\u4e2a\u673a\u5668\u4e0a\u7684\uff0c\u6ca1\u6709\u5355\u70b9\u6027\u80fd\u538b\u529b\u3002","title":"1. \u4ecb\u7ecd"},{"location":"hadoop/CDH/cdh.hdfs_info/#2-hdfs","text":"HDFS\u8bbe\u8ba1\u4e4b\u521d\u5c31\u975e\u5e38\u660e\u786e\u5176\u5e94\u7528\u573a\u666f\uff0c\u9002\u7528\u4e0e\u4ec0\u4e48\u7c7b\u578b\u7684\u5e94\u7528\uff0c\u4e0d\u9002\u7528\u4ec0\u4e48\u5e94\u7528\uff0c\u6709\u4e00\u4e2a\u76f8\u5bf9\u660e\u786e\u7684\u6307\u5bfc\u539f\u5219\u3002","title":"2. HDFS"},{"location":"hadoop/CDH/cdh.hdfs_info/#21","text":"","title":"2.1 \u8bbe\u8ba1\u76ee\u6807"},{"location":"hadoop/CDH/cdh.hdfs_info/#211","text":"\u8fd9\u91cc\u975e\u5e38\u5927\u6307\u7684\u662f\u51e0\u767eM\u3001G\u3001\u6216\u8005TB\u7ea7\u522b\u3002\u5b9e\u9645\u5e94\u7528\u4e2d\u5df2\u6709\u5f88\u591a\u96c6\u7fa4\u5b58\u50a8\u7684\u6570\u636e\u8fbe\u5230PB\u7ea7\u522b\u3002\u6839\u636eHadoop\u5b98\u7f51\uff0cYahoo\uff01\u7684Hadoop\u96c6\u7fa4\u7ea6\u670910\u4e07\u9897CPU\uff0c\u8fd0\u884c\u57284\u4e07\u4e2a\u673a\u5668\u8282\u70b9\u4e0a\u3002\u66f4\u591a\u4e16\u754c\u4e0a\u7684Hadoop\u96c6\u7fa4\u4f7f\u7528\u60c5\u51b5\uff0c\u53c2\u8003Hadoop\u5b98\u7f51.","title":"2.1.1 \u5b58\u50a8\u975e\u5e38\u5927\u7684\u6587\u4ef6"},{"location":"hadoop/CDH/cdh.hdfs_info/#212","text":"HDFS\u57fa\u4e8e\u8fd9\u6837\u7684\u4e00\u4e2a\u5047\u8bbe\uff1a\u6700\u6709\u6548\u7684\u6570\u636e\u5904\u7406\u6a21\u5f0f\u662f\u4e00\u6b21\u5199\u5165\u3001\u591a\u6b21\u8bfb\u53d6\u6570\u636e\u96c6\u7ecf\u5e38\u4ece\u6570\u636e\u6e90\u751f\u6210\u6216\u8005\u62f7\u8d1d\u4e00\u6b21\uff0c\u7136\u540e\u5728\u5176\u4e0a\u505a\u5f88\u591a\u5206\u6790\u5de5\u4f5c\uff0c\u5206\u6790\u5de5\u4f5c\u7ecf\u5e38\u8bfb\u53d6\u5176\u4e2d\u7684\u5927\u90e8\u5206\u6570\u636e\uff0c\u5373\u4f7f\u4e0d\u662f\u5168\u90e8\u3002 \u56e0\u6b64\u8bfb\u53d6\u6574\u4e2a\u6570\u636e\u96c6\u6240\u9700\u65f6\u95f4\u6bd4\u8bfb\u53d6\u7b2c\u4e00\u6761\u8bb0\u5f55\u7684\u5ef6\u65f6\u66f4\u91cd\u8981\u3002","title":"2.1.2 \u91c7\u7528\u6d41\u5f0f\u7684\u6570\u636e\u8bbf\u95ee\u65b9\u5f0f"},{"location":"hadoop/CDH/cdh.hdfs_info/#212_1","text":"Hadoop\u4e0d\u9700\u8981\u7279\u522b\u8d35\u7684\u3001reliable\u7684\uff08\u53ef\u9760\u7684\uff09\u673a\u5668\uff0c\u53ef\u8fd0\u884c\u4e8e\u666e\u901a\u5546\u7528\u673a\u5668\uff08\u53ef\u4ee5\u4ece\u591a\u5bb6\u4f9b\u5e94\u5546\u91c7\u8d2d\uff09 \uff0c\u5546\u7528\u673a\u5668\u4e0d\u4ee3\u8868\u4f4e\u7aef\u673a\u5668\u3002\u5728\u96c6\u7fa4\u4e2d\uff08\u5c24\u5176\u662f\u5927\u7684\u96c6\u7fa4\uff09\uff0c\u8282\u70b9\u5931\u8d25\u7387\u662f\u6bd4\u8f83\u9ad8\u7684HDFS\u7684\u76ee\u6807\u662f\u786e\u4fdd\u96c6\u7fa4\u5728\u8282\u70b9\u5931\u8d25\u7684\u65f6\u5019\u4e0d\u4f1a\u8ba9\u7528\u6237\u611f\u89c9\u5230\u660e\u663e\u7684\u4e2d\u65ad\u3002","title":"2.1.2\u8fd0\u884c\u4e8e\u5546\u4e1a\u786c\u4ef6\u4e0a"},{"location":"hadoop/CDH/cdh.hdfs_info/#22","text":"","title":"2.2 \u4e0d\u9002\u5408\u5e94\u7528"},{"location":"hadoop/CDH/cdh.hdfs_info/#221","text":"\u5bf9\u5ef6\u65f6\u8981\u6c42\u5728\u6beb\u79d2\u7ea7\u522b\u7684\u5e94\u7528\uff0c\u4e0d\u9002\u5408\u91c7\u7528HDFS\u3002HDFS\u662f\u4e3a\u9ad8\u541e\u5410\u6570\u636e\u4f20\u8f93\u8bbe\u8ba1\u7684,\u56e0\u6b64\u53ef\u80fd\u727a\u7272\u5ef6\u65f6HBase\u66f4\u9002\u5408\u4f4e\u5ef6\u65f6\u7684\u6570\u636e\u8bbf\u95ee\u3002","title":"2.2.1 \u4f4e\u5ef6\u65f6\u7684\u6570\u636e\u8bbf\u95ee"},{"location":"hadoop/CDH/cdh.hdfs_info/#222","text":"\u6587\u4ef6\u7684\u5143\u6570\u636e\uff08\u5982\u76ee\u5f55\u7ed3\u6784\uff0c\u6587\u4ef6block\u7684\u8282\u70b9\u5217\u8868\uff0cblock-node mapping\uff09\u4fdd\u5b58\u5728NameNode\u7684\u5185\u5b58\u4e2d\uff0c \u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u6587\u4ef6\u6570\u91cf\u4f1a\u53d7\u9650\u4e8eNameNode\u7684\u5185\u5b58\u5927\u5c0f\u3002 \u7ecf\u9a8c\u800c\u8a00\uff0c\u4e00\u4e2a\u6587\u4ef6/\u76ee\u5f55/\u6587\u4ef6\u5757\u4e00\u822c\u5360\u6709150\u5b57\u8282\u7684\u5143\u6570\u636e\u5185\u5b58\u7a7a\u95f4\u3002\u5982\u679c\u6709100\u4e07\u4e2a\u6587\u4ef6\uff0c\u6bcf\u4e2a\u6587\u4ef6\u5360\u75281\u4e2a\u6587\u4ef6\u5757\uff0c\u5219\u9700\u8981\u5927\u7ea6300M\u7684\u5185\u5b58\u3002\u56e0\u6b64\u5341\u4ebf\u7ea7\u522b\u7684\u6587\u4ef6\u6570\u91cf\u5728\u73b0\u6709\u5546\u7528\u673a\u5668\u4e0a\u96be\u4ee5\u652f\u6301\u3002","title":"2.2.2 \u5927\u91cf\u5c0f\u6587\u4ef6"},{"location":"hadoop/CDH/cdh.hdfs_info/#223","text":"HDFS\u91c7\u7528\u8ffd\u52a0\uff08append-only\uff09\u7684\u65b9\u5f0f\u5199\u5165\u6570\u636e\u3002\u4e0d\u652f\u6301\u6587\u4ef6\u4efb\u610foffset\u7684\u4fee\u6539\u3002\u4e0d\u652f\u6301\u591a\u4e2a\u5199\u5165\u5668\uff08writer\uff09\u3002","title":"2.2.3 \u591a\u65b9\u8bfb\u5199\uff0c\u9700\u8981\u4efb\u610f\u7684\u6587\u4ef6\u4fee\u6539"},{"location":"hadoop/CDH/cdh.hdfs_info/#3-hdfs","text":"","title":"3. HDFS\u6838\u5fc3\u6982\u5ff5"},{"location":"hadoop/CDH/cdh.hdfs_info/#31-block","text":"H\u7269\u7406\u78c1\u76d8\u4e2d\u6709\u5757\u7684\u6982\u5ff5\uff0c\u78c1\u76d8\u7684\u7269\u7406Block\u662f\u78c1\u76d8\u64cd\u4f5c\u6700\u5c0f\u7684\u5355\u5143\uff0c\u8bfb\u5199\u64cd\u4f5c\u5747\u4ee5Block\u4e3a\u6700\u5c0f\u5355\u5143\uff0c\u4e00\u822c\u4e3a512 Byte\u3002\u6587\u4ef6\u7cfb\u7edf\u5728\u7269\u7406Block\u4e4b\u4e0a\u62bd\u8c61\u4e86\u53e6\u4e00\u5c42\u6982\u5ff5\uff0c\u6587\u4ef6\u7cfb\u7edfBlock\u7269\u7406\u78c1\u76d8Block\u7684\u6574\u6570\u500d\u3002\u901a\u5e38\u4e3a\u51e0KB\u3002Hadoop\u63d0\u4f9b\u7684df\u3001fsck\u8fd9\u7c7b\u8fd0\u7ef4\u5de5\u5177\u90fd\u662f\u5728\u6587\u4ef6\u7cfb\u7edf\u7684Block\u7ea7\u522b\u4e0a\u8fdb\u884c\u64cd\u4f5c\u3002 HHDFS\u7684Block\u5757\u6bd4\u4e00\u822c\u5355\u673a\u6587\u4ef6\u7cfb\u7edf\u5927\u5f97\u591a\uff0c\u9ed8\u8ba4\u4e3a128M\u3002HDFS\u7684\u6587\u4ef6\u88ab\u62c6\u5206\u6210block-sized\u7684chunk\uff0cchunk\u4f5c\u4e3a\u72ec\u7acb\u5355\u5143\u5b58\u50a8\u3002\u6bd4Block\u5c0f\u7684\u6587\u4ef6\u4e0d\u4f1a\u5360\u7528\u6574\u4e2aBlock\uff0c\u53ea\u4f1a\u5360\u636e\u5b9e\u9645\u5927\u5c0f\u3002\u4f8b\u5982\uff0c \u5982\u679c\u4e00\u4e2a\u6587\u4ef6\u5927\u5c0f\u4e3a1M\uff0c\u5219\u5728HDFS\u4e2d\u53ea\u4f1a\u5360\u75281M\u7684\u7a7a\u95f4\uff0c\u800c\u4e0d\u662f128M\u3002 HDFS\u7684Block\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u5927\uff1f \u662f\u4e3a\u4e86\u6700\u5c0f\u5316\u67e5\u627e\uff08seek\uff09\u65f6\u95f4\uff0c\u63a7\u5236\u5b9a\u4f4d\u6587\u4ef6\u4e0e\u4f20\u8f93\u6587\u4ef6\u6240\u7528\u7684\u65f6\u95f4\u6bd4\u4f8b\u3002\u5047\u8bbe\u5b9a\u4f4d\u5230Block\u6240\u9700\u7684\u65f6\u95f4\u4e3a10ms\uff0c\u78c1\u76d8\u4f20\u8f93\u901f\u5ea6\u4e3a100M/s\u3002\u5982\u679c\u8981\u5c06\u5b9a\u4f4d\u5230Block\u6240\u7528\u65f6\u95f4\u5360\u4f20\u8f93\u65f6\u95f4\u7684\u6bd4\u4f8b\u63a7\u52361%\uff0c\u5219Block\u5927\u5c0f\u9700\u8981\u7ea6100M\u3002 \u4f46\u662f\u5982\u679cBlock\u8bbe\u7f6e\u8fc7\u5927\uff0c\u5728MapReduce\u4efb\u52a1\u4e2d\uff0cMap\u6216\u8005Reduce\u4efb\u52a1\u7684\u4e2a\u6570 \u5982\u679c\u5c0f\u4e8e\u96c6\u7fa4\u673a\u5668\u6570\u91cf\uff0c\u4f1a\u4f7f\u5f97\u4f5c\u4e1a\u8fd0\u884c\u6548\u7387\u5f88\u4f4e\u3002 Block\u62bd\u8c61\u7684\u597d\u5904 block\u7684\u62c6\u5206\u4f7f\u5f97\u5355\u4e2a\u6587\u4ef6\u5927\u5c0f\u53ef\u4ee5\u5927\u4e8e\u6574\u4e2a\u78c1\u76d8\u7684\u5bb9\u91cf\uff0c\u6784\u6210\u6587\u4ef6\u7684Block\u53ef\u4ee5\u5206\u5e03\u5728\u6574\u4e2a\u96c6\u7fa4\uff0c \u7406\u8bba\u4e0a\uff0c\u5355\u4e2a\u6587\u4ef6\u53ef\u4ee5\u5360\u636e\u96c6\u7fa4\u4e2d\u6240\u6709\u673a\u5668\u7684\u78c1\u76d8\u3002 Block\u7684\u62bd\u8c61\u4e5f\u7b80\u5316\u4e86\u5b58\u50a8\u7cfb\u7edf\uff0c\u5bf9\u4e8eBlock\uff0c\u65e0\u9700\u5173\u6ce8\u5176\u6743\u9650\uff0c\u6240\u6709\u8005\u7b49\u5185\u5bb9\uff08\u8fd9\u4e9b\u5185\u5bb9\u90fd\u5728\u6587\u4ef6\u7ea7\u522b\u4e0a\u8fdb\u884c\u63a7\u5236\uff09\u3002 Block\u4f5c\u4e3a\u5bb9\u9519\u548c\u9ad8\u53ef\u7528\u673a\u5236\u4e2d\u7684\u526f\u672c\u5355\u5143\uff0c\u5373\u4ee5Block\u4e3a\u5355\u4f4d\u8fdb\u884c\u590d\u5236\u3002","title":"3.1 BLOCK"},{"location":"hadoop/CDH/cdh.hdfs_info/#32-namenode-datanode","text":"\u6574\u4e2aHDFS\u96c6\u7fa4\u7531Namenode\u548cDatanode\u6784\u6210master-worker\uff08\u4e3b\u4ece\uff09\u6a21\u5f0f\u3002Namenode\u8d1f\u8d23\u6784\u5efa\u547d\u540d\u7a7a\u95f4\uff0c\u7ba1\u7406\u6587\u4ef6\u7684\u5143\u6570\u636e\u7b49\uff0c\u800cDatanode\u8d1f\u8d23\u5b9e\u9645\u5b58\u50a8\u6570\u636e\uff0c\u8d1f\u8d23\u8bfb\u5199\u5de5\u4f5c\u3002","title":"3.2 namenode datanode"},{"location":"hadoop/CDH/cdh.hdfs_info/#321-namenode","text":"Namenode\u5b58\u653e\u6587\u4ef6\u7cfb\u7edf\u6811\u53ca\u6240\u6709\u6587\u4ef6\u3001\u76ee\u5f55\u7684\u5143\u6570\u636e\u3002\u5143\u6570\u636e\u6301\u4e45\u5316\u4e3a2\u79cd\u5f62\u5f0f namespcae image edit log \u4f46\u662f\u6301\u4e45\u5316\u6570\u636e\u4e2d\u4e0d\u5305\u62ecBlock\u6240\u5728\u7684\u8282\u70b9\u5217\u8868\uff0c\u53ca\u6587\u4ef6\u7684Block\u5206\u5e03\u5728\u96c6\u7fa4\u4e2d\u7684\u54ea\u4e9b\u8282\u70b9\u4e0a\uff0c\u8fd9\u4e9b\u4fe1\u606f\u662f\u5728\u7cfb\u7edf\u91cd\u542f\u7684\u65f6\u5019\u91cd\u65b0\u6784\u5efa\uff08\u901a\u8fc7Datanode\u6c47\u62a5\u7684Block\u4fe1\u606f\uff09\u3002 \u5728HDFS\u4e2d\uff0cNamenode\u53ef\u80fd\u6210\u4e3a\u96c6\u7fa4\u7684\u5355\u70b9\u6545\u969c\uff0cNamenode\u4e0d\u53ef\u7528\u65f6\uff0c\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u662f\u4e0d\u53ef\u7528\u7684\u3002HDFS\u9488\u5bf9\u5355\u70b9\u6545\u969c\u63d0\u4f9b\u4e862\u79cd\u89e3\u51b3\u673a\u5236\uff1a \u5907\u4efd\u6301\u4e45\u5316\u5143\u6570\u636e \u5c06\u6587\u4ef6\u7cfb\u7edf\u7684\u5143\u6570\u636e\u540c\u65f6\u5199\u5230\u591a\u4e2a\u6587\u4ef6\u7cfb\u7edf\uff0c \u4f8b\u5982\u540c\u65f6\u5c06\u5143\u6570\u636e\u5199\u5230\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u53caNFS\u3002\u8fd9\u4e9b\u5907\u4efd\u64cd\u4f5c\u90fd\u662f\u540c\u6b65\u7684\u3001\u539f\u5b50\u7684\u3002 Secondary Namenode Secondary\u8282\u70b9\u5b9a\u671f\u5408\u5e76\u4e3bNamenode\u7684namespace image\u548cedit log\uff0c \u907f\u514dedit log\u8fc7\u5927\uff0c\u901a\u8fc7\u521b\u5efa\u68c0\u67e5\u70b9checkpoint\u6765\u5408\u5e76\u3002\u5b83\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u5408\u5e76\u540e\u7684namespace image\u526f\u672c\uff0c \u53ef\u7528\u4e8e\u5728Namenode\u5b8c\u5168\u5d29\u6e83\u65f6\u6062\u590d\u6570\u636e\u3002 Secondary Namenode\u901a\u5e38\u8fd0\u884c\u5728\u53e6\u4e00\u53f0\u673a\u5668\uff0c\u56e0\u4e3a\u5408\u5e76\u64cd\u4f5c\u9700\u8981\u8017\u8d39\u5927\u91cf\u7684CPU\u548c\u5185\u5b58\u3002\u5176\u6570\u636e\u843d\u540e\u4e8eNamenode\uff0c\u56e0\u6b64\u5f53Namenode\u5b8c\u5168\u5d29\u6e83\u65f6\uff0c\u4f1a\u51fa\u73b0\u6570\u636e\u4e22\u5931\u3002 \u901a\u5e38\u505a\u6cd5\u662f\u62f7\u8d1dNFS\u4e2d\u7684\u5907\u4efd\u5143\u6570\u636e\u5230Second\uff0c\u5c06\u5176\u4f5c\u4e3a\u65b0\u7684\u4e3bNamenode\u3002 \u5728HA\uff08High Availability\u9ad8\u53ef\u7528\u6027\uff09\u4e2d\u53ef\u4ee5\u8fd0\u884c\u4e00\u4e2aHot Standby\uff0c\u4f5c\u4e3a\u70ed\u5907\u4efd\uff0c\u5728Active Namenode\u6545\u969c\u4e4b\u540e\uff0c\u66ff\u4ee3\u539f\u6709Namenode\u6210\u4e3aActive Namenode\u3002","title":"3.2.1 namenode"},{"location":"hadoop/CDH/cdh.hdfs_info/#322-ditsfsimage","text":"\u9996\u5148\u8981\u63d0\u5230\u4e24\u4e2a\u6587\u4ef6edits\u548cfsimage\uff0c\u4e0b\u9762\u6765\u8bf4\u8bf4\u4ed6\u4eec\u662f\u505a\u4ec0\u4e48\u7684\u3002 \u96c6\u7fa4\u4e2d\u7684\u540d\u79f0\u8282\u70b9\uff08NameNode\uff09\u4f1a\u628a\u6587\u4ef6\u7cfb\u7edf\u7684\u53d8\u5316\u4ee5\u8ffd\u52a0\u4fdd\u5b58\u5230\u65e5\u5fd7\u6587\u4ef6edits\u4e2d\u3002 \u5f53\u540d\u79f0\u8282\u70b9\uff08NameNode\uff09\u542f\u52a8\u65f6\uff0c\u4f1a\u4ece\u955c\u50cf\u6587\u4ef6 fsimage \u4e2d\u8bfb\u53d6HDFS\u7684\u72b6\u6001\uff0c\u5e76\u4e14\u628aedits\u6587\u4ef6\u4e2d\u8bb0\u5f55\u7684\u64cd\u4f5c\u5e94\u7528\u5230fsimage\uff0c\u4e5f\u5c31\u662f\u5408\u5e76\u5230fsimage\u4e2d\u53bb\u3002\u5408\u5e76\u540e\u66f4\u65b0fsimage\u7684HDFS\u72b6\u6001\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684edits\u6587\u4ef6\u6765\u8bb0\u5f55\u6587\u4ef6\u7cfb\u7edf\u7684\u53d8\u5316","title":"3.2.2 dits\u548cfsimage"},{"location":"hadoop/CDH/cdh.hdfs_info/#323-datanode","text":"\u6570\u636e\u8282\u70b9\u8d1f\u8d23\u5b58\u50a8\u548c\u63d0\u53d6Block\uff0c\u8bfb\u5199\u8bf7\u6c42\u53ef\u80fd\u6765\u81eanamenode\uff0c\u4e5f\u53ef\u80fd\u76f4\u63a5\u6765\u81ea\u5ba2\u6237\u7aef\u3002\u6570\u636e\u8282\u70b9\u5468\u671f\u6027\u5411Namenode\u6c47\u62a5\u81ea\u5df1\u8282\u70b9\u4e0a\u6240\u5b58\u50a8\u7684Block\u76f8\u5173\u4fe1\u606f\u3002","title":"3.2.3 datanode"},{"location":"hadoop/CDH/cdh.hdfs_info/#33-block-cache","text":"DataNode\u901a\u5e38\u76f4\u63a5\u4ece\u78c1\u76d8\u8bfb\u53d6\u6570\u636e\uff0c\u4f46\u662f\u9891\u7e41\u4f7f\u7528\u7684Block\u53ef\u4ee5\u5728\u5185\u5b58\u4e2d\u7f13\u5b58\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2aBlock\u53ea\u6709\u4e00\u4e2a\u6570\u636e\u8282\u70b9\u4f1a\u7f13\u5b58\u3002\u4f46\u662f\u53ef\u4ee5\u9488\u5bf9\u6bcf\u4e2a\u6587\u4ef6\u53ef\u4ee5\u4e2a\u6027\u5316\u914d\u7f6e\u3002 \u4f5c\u4e1a\u8c03\u5ea6\u5668\u53ef\u4ee5\u5229\u7528\u7f13\u5b58\u63d0\u5347\u6027\u80fd\uff0c\u4f8b\u5982MapReduce\u53ef\u4ee5\u628a\u4efb\u52a1\u8fd0\u884c\u5728\u6709Block\u7f13\u5b58\u7684\u8282\u70b9\u4e0a\u3002 \u7528\u6237\u6216\u8005\u5e94\u7528\u53ef\u4ee5\u5411NameNode\u53d1\u9001\u7f13\u5b58\u6307\u4ee4\uff08\u7f13\u5b58\u54ea\u4e2a\u6587\u4ef6\uff0c\u7f13\u5b58\u591a\u4e45\uff09\uff0c \u7f13\u5b58\u6c60\u7684\u6982\u5ff5\u7528\u4e8e\u7ba1\u7406\u4e00\u7ec4\u7f13\u5b58\u7684\u6743\u9650\u548c\u8d44\u6e90\u3002","title":"3.3 block  cache"},{"location":"hadoop/CDH/cdh.hdfs_info/#34-hdfs-federation","text":"\u6211\u4eec\u77e5\u9053NameNode\u7684\u5185\u5b58\u4f1a\u5236\u7ea6\u6587\u4ef6\u6570\u91cf\uff0cHDFS Federation\u63d0\u4f9b\u4e86\u4e00\u79cd\u6a2a\u5411\u6269\u5c55NameNode\u7684\u65b9\u5f0f\u3002\u5728Federation\u6a21\u5f0f\u4e2d\uff0c\u6bcf\u4e2aNameNode\u7ba1\u7406\u547d\u540d\u7a7a\u95f4\u7684\u4e00\u90e8\u5206\uff0c\u4f8b\u5982\u4e00\u4e2aNameNode\u7ba1\u7406/user\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c \u53e6\u4e00\u4e2aNameNode\u7ba1\u7406/share\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u3002 \u6bcf\u4e2aNameNode\u7ba1\u7406\u4e00\u4e2anamespace volumn\uff0c\u6240\u6709volumn\u6784\u6210\u6587\u4ef6\u7cfb\u7edf\u7684\u5143\u6570\u636e\u3002\u6bcf\u4e2aNameNode\u540c\u65f6\u7ef4\u62a4\u4e00\u4e2aBlock Pool\uff0c\u4fdd\u5b58Block\u7684\u8282\u70b9\u6620\u5c04\u7b49\u4fe1\u606f\u3002\u5404NameNode\u4e4b\u95f4\u662f\u72ec\u7acb\u7684\uff0c\u4e00\u4e2a\u8282\u70b9\u7684\u5931\u8d25\u4e0d\u4f1a\u5bfc\u81f4\u5176\u4ed6\u8282\u70b9\u7ba1\u7406\u7684\u6587\u4ef6\u4e0d\u53ef\u7528\u3002 \u5ba2\u6237\u7aef\u4f7f\u7528mount table\u5c06\u6587\u4ef6\u8def\u5f84\u6620\u5c04\u5230NameNode\u3002mount table\u662f\u5728Namenode\u7fa4\u7ec4\u4e4b\u4e0a\u5c01\u88c5\u4e86\u4e00\u5c42\uff0c\u8fd9\u4e00\u5c42\u4e5f\u662f\u4e00\u4e2aHadoop\u6587\u4ef6\u7cfb\u7edf\u7684\u5b9e\u73b0\uff0c\u901a\u8fc7viewfs:\u534f\u8bae\u8bbf\u95ee\u3002","title":"3.4 HDFS Federation"},{"location":"hadoop/CDH/cdh.hdfs_info/#35-hdfs-ha","text":"\u5728HDFS\u96c6\u7fa4\u4e2d\uff0cNameNode\u4f9d\u7136\u662f\u5355\u70b9\u6545\u969c\uff08SPOF: Single Point Of Failure\uff09\u3002\u5143\u6570\u636e\u540c\u65f6\u5199\u5230\u591a\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4ee5\u53caSecond NameNode\u5b9a\u671fcheckpoint\u6709\u5229\u4e8e\u4fdd\u62a4\u6570\u636e\u4e22\u5931\uff0c\u4f46\u662f\u5e76\u4e0d\u80fd\u63d0\u9ad8\u53ef\u7528\u6027\u3002 \u8fd9\u662f\u56e0\u4e3aNameNode\u662f\u552f\u4e00\u4e00\u4e2a\u5bf9\u6587\u4ef6\u5143\u6570\u636e\u548cfile-block\u6620\u5c04\u8d1f\u8d23\u7684\u5730\u65b9\uff0c \u5f53\u5b83\u6302\u4e86\u4e4b\u540e\uff0c\u5305\u62ecMapReduce\u5728\u5185\u7684\u4f5c\u4e1a\u90fd\u65e0\u6cd5\u8fdb\u884c\u8bfb\u5199\u3002 \u5f53NameNode\u6545\u969c\u65f6\uff0c\u5e38\u89c4\u7684\u505a\u6cd5\u662f\u4f7f\u7528\u5143\u6570\u636e\u5907\u4efd\u91cd\u65b0\u542f\u52a8\u4e00\u4e2aNameNode\u3002\u5143\u6570\u636e\u5907\u4efd\u53ef\u80fd\u6765\u6e90\u4e8e\uff1a \u591a\u6587\u4ef6\u7cfb\u7edf\u5199\u5165\u4e2d\u7684\u5907\u4efd Second NameNode\u7684\u68c0\u67e5\u70b9\u6587\u4ef6 \u542f\u52a8\u65b0\u7684Namenode\u4e4b\u540e\uff0c\u9700\u8981\u91cd\u65b0\u914d\u7f6e\u5ba2\u6237\u7aef\u548cDataNode\u7684NameNode\u4fe1\u606f\u3002\u53e6\u5916\u91cd\u542f\u8017\u65f6\u4e00\u822c\u6bd4\u8f83\u4e45\uff0c\u7a0d\u5177\u89c4\u6a21\u7684\u96c6\u7fa4\u91cd\u542f\u7ecf\u5e38\u9700\u8981\u51e0\u5341\u5206\u949f\u751a\u81f3\u6570\u5c0f\u65f6\uff0c\u9020\u6210\u91cd\u542f\u8017\u65f6\u7684\u539f\u56e0\u5927\u81f4\u6709\uff1a \u5143\u6570\u636e\u955c\u50cf\u6587\u4ef6\u8f7d\u5165\u5230\u5185\u5b58\u8017\u65f6\u8f83\u957f\u3002 \u9700\u8981\u91cd\u653eedit log \u9700\u8981\u6536\u5230\u6765\u81eaDataNode\u7684\u72b6\u6001\u62a5\u544a\u5e76\u4e14\u6ee1\u8db3\u6761\u4ef6\u540e\u624d\u80fd\u79bb\u5f00\u5b89\u5168\u6a21\u5f0f\u63d0\u4f9b\u5199\u670d\u52a1\u3002","title":"3.5 HDFS HA"},{"location":"hadoop/CDH/cdh.hdfs_info/#4-hadoop-ha","text":"\u91c7\u7528HA\u7684HDFS\u96c6\u7fa4\u914d\u7f6e\u4e24\u4e2aNameNode\uff0c\u5206\u522b\u5904\u4e8eActive\u548cStandby\u72b6\u6001\u3002\u5f53Active NameNode\u6545\u969c\u4e4b\u540e\uff0cStandby\u63a5\u8fc7\u8d23\u4efb\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\uff0c\u7528\u6237\u6ca1\u6709\u660e\u663e\u7684\u4e2d\u65ad\u611f\u89c9\u3002\u4e00\u822c\u8017\u65f6\u5728\u51e0\u5341\u79d2\u5230\u6570\u5206\u949f\u3002 HA\u6d89\u53ca\u5230\u7684\u4e3b\u8981\u5b9e\u73b0\u903b\u8f91\u6709","title":"4. hadoop ha"},{"location":"hadoop/CDH/cdh.hdfs_info/#41","text":"\u4e3b\u5907\u9700\u5171\u4eabedit log\u5b58\u50a8\uff0c\u4e3bNameNode\u548c\u5f85\u547d\u7684NameNode\u5171\u4eab\u4e00\u4efdedit log\uff0c\u5f53\u4e3b\u5907\u5207\u6362\u65f6\uff0cStandby\u901a\u8fc7\u56de\u653eedit log\u540c\u6b65\u6570\u636e\u3002 \u5171\u4eab\u5b58\u50a8\u901a\u5e38\u67092\u79cd\u9009\u62e9 NFS\uff1a\u4f20\u7edf\u7684\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf QJM\uff1aquorum journal manager QJM\u662f\u4e13\u95e8\u4e3aHDFS\u7684HA\u5b9e\u73b0\u800c\u8bbe\u8ba1\u7684\uff0c\u7528\u6765\u63d0\u4f9b\u9ad8\u53ef\u7528\u7684edit log\u3002QJM\u8fd0\u884c\u4e00\u7ec4journal node\uff0cedit log\u5fc5\u987b\u5199\u5230\u5927\u90e8\u5206\u7684journal nodes\u3002\u901a\u5e38\u4f7f\u75283\u4e2a\u8282\u70b9\uff0c\u56e0\u6b64\u5141\u8bb8\u4e00\u4e2a\u8282\u70b9\u5931\u8d25\uff0c\u7c7b\u4f3cZooKeeper\u3002\u6ce8\u610fQJM\u6ca1\u6709\u4f7f\u7528ZK\uff0c\u867d\u7136HDFS HA\u7684\u786e\u4f7f\u7528\u4e86ZK\u6765\u9009\u4e3e\u4e3bNamenode\u3002\u4e00\u822c\u63a8\u8350\u4f7f\u7528QJM\u3002","title":"4.1 \u5b58\u50a8"},{"location":"hadoop/CDH/cdh.hdfs_info/#42","text":"DataNode\u9700\u8981\u540c\u65f6\u5f80\u4e3b\u5907\u53d1\u9001Block Report \uff0c\u56e0\u4e3aBlock\u6620\u5c04\u6570\u636e\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff08\u4e0d\u662f\u5728\u78c1\u76d8\u4e0a\uff09\uff0c\u4e3a\u4e86\u5728Active NameNode\u6302\u6389\u4e4b\u540e\uff0c\u65b0\u7684NameNode\u80fd\u591f\u5feb\u901f\u542f\u52a8\uff0c\u4e0d\u9700\u8981\u7b49\u5f85\u6765\u81eaDatanode\u7684Block Report\uff0cDataNode\u9700\u8981\u540c\u65f6\u5411\u4e3b\u5907\u4e24\u4e2aNameNode\u53d1\u9001Block Report\u3002","title":"4.2 \u6570\u636e\u53d1\u9001"},{"location":"hadoop/CDH/cdh.hdfs_info/#43-failover","text":"\u5ba2\u6237\u7aef\u9700\u8981\u914d\u7f6efailover\u6a21\u5f0f\uff08\u5931\u6548\u5907\u63f4\u6a21\u5f0f\uff0c\u5bf9\u7528\u6237\u900f\u660e\uff09,Namenode\u7684\u5207\u6362\u5bf9\u5ba2\u6237\u7aef\u6765\u8bf4\u662f\u65e0\u611f\u77e5\u7684\uff0c\u901a\u8fc7\u5ba2\u6237\u7aef\u5e93\u6765\u5b9e\u73b0\u3002\u5ba2\u6237\u7aef\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528\u7684HDFS URI\u662f\u903b\u8f91\u8def\u5f84\uff0c\u6620\u5c04\u5230\u4e00\u5bf9Namenode\u5730\u5740\u3002\u5ba2\u6237\u7aef\u4f1a\u4e0d\u65ad\u5c1d\u8bd5\u6bcf\u4e00\u4e2aNamenode\u5730\u5740\u76f4\u5230\u6210\u529f\u3002","title":"4.3 failover"},{"location":"hadoop/CDH/cdh.hdfs_info/#44","text":"Standby\u66ff\u4ee3Secondary NameNode \uff0c\u5982\u679c\u6ca1\u6709\u542f\u7528HA\uff0cHDFS\u72ec\u7acb\u8fd0\u884c\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b\u4f5c\u4e3aSecondary Namenode\u3002\u5b9a\u671fcheckpoint\uff0c\u5408\u5e76\u955c\u50cf\u6587\u4ef6\u548cedit\u65e5\u5fd7\u3002 \u5982\u679c\u5f53\u4e3bNamenode\u5931\u8d25\u65f6\uff0c\u5907\u4efdNamenode\u6b63\u5728\u5173\u673a\uff08\u505c\u6b62 Standby\uff09\uff0c\u8fd0\u7ef4\u4eba\u5458\u4f9d\u7136\u53ef\u4ee5\u4ece\u5934\u542f\u52a8\u5907\u4efdNamenode\uff0c\u8fd9\u6837\u6bd4\u6ca1\u6709HA\u7684\u65f6\u5019\u66f4\u7701\u4e8b\uff0c\u7b97\u662f\u4e00\u79cd\u6539\u8fdb\uff0c\u56e0\u4e3a\u91cd\u542f\u6574\u4e2a\u8fc7\u7a0b\u5df2\u7ecf\u6807\u51c6\u5316\u5230Hadoop\u5185\u90e8\uff0c\u65e0\u9700\u8fd0\u7ef4\u8fdb\u884c\u590d\u6742\u7684\u5207\u6362\u64cd\u4f5c\u3002 NameNode\u7684\u5207\u6362\u901a\u8fc7\u4ee3failover controller\u6765\u5b9e\u73b0\u3002failover controller\u6709\u591a\u79cd\u5b9e\u73b0\uff0c\u9ed8\u8ba4\u5b9e\u73b0\u4f7f\u7528ZooKeeper\u6765\u4fdd\u8bc1\u53ea\u6709\u4e00\u4e2aNamenode\u5904\u4e8eactive\u72b6\u6001\u3002 \u6bcf\u4e2aNamenode\u8fd0\u884c\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684failover controller\u8fdb\u7a0b\uff0c\u8be5\u8fdb\u7a0b\u4f7f\u7528\u7b80\u5355\u7684\u5fc3\u8df3\u673a\u5236\u6765\u76d1\u63a7Namenode\u7684\u5b58\u6d3b\u72b6\u6001\u5e76\u5728Namenode\u5931\u8d25\u65f6\u89e6\u53d1failover\u3002Failover\u53ef\u4ee5\u7531\u8fd0\u7ef4\u624b\u52a8\u89e6\u53d1\uff0c\u4f8b\u5982\u5728\u65e5\u5e38\u7ef4\u62a4\u4e2d\u9700\u8981\u5207\u6362\u4e3bNamenode\uff0c\u8fd9\u79cd\u60c5\u51b5graceful(\u4f18\u96c5\u7684) failover\uff0c\u975e\u624b\u52a8\u89e6\u53d1\u7684failover\u79f0\u4e3aungraceful failover\u3002 \u5728ungraceful failover\u7684\u60c5\u51b5\u4e0b\uff0c\u6ca1\u6709\u529e\u6cd5\u786e\u5b9a\u5931\u8d25\uff08\u88ab\u5224\u5b9a\u4e3a\u5931\u8d25\uff09\u7684\u8282\u70b9\u662f\u5426\u505c\u6b62\u8fd0\u884c\uff0c\u4e5f\u5c31\u662f\u8bf4\u89e6\u53d1failover\u540e\uff0c\u4e4b\u524d\u7684\u4e3bNamenode\u53ef\u80fd\u8fd8\u5728\u8fd0\u884c\u3002QJM\u4e00\u6b21\u53ea\u5141\u8bb8\u4e00\u4e2aNamenode\u5199edit log\uff0c\u4f46\u662f\u4e4b\u524d\u7684\u4e3bNamenode\u4ecd\u7136\u53ef\u4ee5\u63a5\u53d7\u8bfb\u8bf7\u6c42\u3002Hadoop\u4f7f\u7528fencing\u6765\u6740\u6389\u4e4b\u524d\u7684Namenode\u3002Fencing\u901a\u8fc7\u6536\u56de\u4e4b\u524dNamenode\u5bf9\u5171\u4eab\u7684edit log\u7684\u8bbf\u95ee\u6743\u9650\u3001\u5173\u95ed\u5176\u7f51\u7edc\u7aef\u53e3\u4f7f\u5f97\u539f\u6709\u7684Namenode\u4e0d\u80fd\u518d\u7ee7\u7eed\u63a5\u53d7\u670d\u52a1\u8bf7\u6c42\u3002\u4f7f\u7528STONITH\u6280\u672f\u4e5f\u53ef\u4ee5\u5c06\u4e4b\u524d\u7684\u4e3bNamenode\u5173\u673a\u3002 \u6700\u540e\uff0cHA\u65b9\u6848\u4e2dNamenode\u7684\u5207\u6362\u5bf9\u5ba2\u6237\u7aef\u6765\u8bf4\u662f\u4e0d\u53ef\u89c1\u7684\uff0c\u524d\u9762\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\uff0c\u4e3b\u8981\u901a\u8fc7\u5ba2\u6237\u7aef\u5e93\u6765\u5b8c\u6210\u3002","title":"4.4 \u63a5\u7ba1"},{"location":"hadoop/CDH/cdh.hdfs_info/#5-hdfs","text":"HDFS \u91c7\u7528Master/Slave\u7684\u67b6\u6784\u6765\u5b58\u50a8\u6570\u636e\uff0c\u8fd9\u79cd\u67b6\u6784\u4e3b\u8981\u7531\u56db\u4e2a\u90e8\u5206\u7ec4\u6210\uff0c\u5206\u522b\u4e3aHDFS Client\u3001NameNode\u3001DataNode\u548cSecondary NameNode\u3002\u4e0b\u9762\u6211\u4eec\u5206\u522b\u4ecb\u7ecd\u8fd9\u56db\u4e2a\u7ec4\u6210\u90e8\u5206","title":"5. HDFS \u5982\u4f55\u5b58\u50a8\u6570\u636e"},{"location":"hadoop/CDH/cdh.hdfs_info/#51-client","text":"Client\uff1a\u5c31\u662f\u5ba2\u6237\u7aef. \u6587\u4ef6\u5207\u5206\u3002\u6587\u4ef6\u4e0a\u4f20 HDFS \u7684\u65f6\u5019\uff0cClient \u5c06\u6587\u4ef6\u5207\u5206\u6210 \u4e00\u4e2a\u4e00\u4e2a\u7684Block\uff0c\u7136\u540e\u8fdb\u884c\u5b58\u50a8\u3002 \u4e0e NameNode \u4ea4\u4e92\uff0c\u83b7\u53d6\u6587\u4ef6\u7684\u4f4d\u7f6e\u4fe1\u606f\u3002 \u4e0e DataNode \u4ea4\u4e92\uff0c\u8bfb\u53d6\u6216\u8005\u5199\u5165\u6570\u636e\u3002 Client \u63d0\u4f9b\u4e00\u4e9b\u547d\u4ee4\u6765\u7ba1\u7406 HDFS\uff0c\u6bd4\u5982\u542f\u52a8\u6216\u8005\u5173\u95edHDFS\u3002 Client \u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u547d\u4ee4\u6765\u8bbf\u95ee HDFS\u3002","title":"5.1 Client"},{"location":"hadoop/CDH/cdh.hdfs_info/#52-namenode","text":"NameNode\uff1a\u5c31\u662f master\uff0c\u5b83\u662f\u4e00\u4e2a\u4e3b\u7ba1\u3001\u7ba1\u7406\u8005\u3002 \u7ba1\u7406 HDFS \u7684\u540d\u79f0\u7a7a\u95f4 \u7ba1\u7406\u6570\u636e\u5757\uff08Block\uff09\u6620\u5c04\u4fe1\u606f \u914d\u7f6e\u526f\u672c\u7b56\u7565 \u5904\u7406\u5ba2\u6237\u7aef\u8bfb\u5199\u8bf7\u6c42\u3002","title":"5.2 namenode"},{"location":"hadoop/CDH/cdh.hdfs_info/#53-datanode","text":"\u5c31\u662fSlave\u3002NameNode \u4e0b\u8fbe\u547d\u4ee4\uff0cDataNode \u6267\u884c\u5b9e\u9645\u7684\u64cd\u4f5c\u3002 \u5b58\u50a8\u5b9e\u9645\u7684\u6570\u636e\u5757\u3002 \u6267\u884c\u6570\u636e\u5757\u7684\u8bfb/\u5199\u64cd\u4f5c\u3002","title":"5.3 DataNode"},{"location":"hadoop/CDH/cdh.hdfs_info/#54-secondary-namenode","text":"\u5e76\u975e NameNode \u7684\u70ed\u5907\u3002\u5f53NameNode \u6302\u6389\u7684\u65f6\u5019\uff0c\u5b83\u5e76\u4e0d\u80fd\u9a6c\u4e0a\u66ff\u6362 NameNode \u5e76\u63d0\u4f9b\u670d\u52a1\u3002 \u8f85\u52a9 NameNode\uff0c\u5206\u62c5\u5176\u5de5\u4f5c\u91cf\u3002 \u5b9a\u671f\u5408\u5e76 fsimage\u548cfsedits\uff0c\u5e76\u63a8\u9001\u7ed9NameNode\u3002 \u5728\u7d27\u6025\u60c5\u51b5\u4e0b\uff0c\u53ef\u8f85\u52a9\u6062\u590d NameNode\u3002","title":"5.4 Secondary NameNode"},{"location":"hadoop/CDH/cdh.hdfs_info/#6-hdfs","text":"HDFS\u7684\u6587\u4ef6\u8bfb\u53d6\u539f\u7406\uff0c\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a \u9996\u5148\u8c03\u7528FileSystem\u5bf9\u8c61\u7684open\u65b9\u6cd5\uff0c\u5176\u5b9e\u83b7\u53d6\u7684\u662f\u4e00\u4e2aDistributedFileSystem\u7684\u5b9e\u4f8b\u3002 DistributedFileSystem\u901a\u8fc7RPC(\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528)\u83b7\u5f97\u6587\u4ef6\u7684\u7b2c\u4e00\u6279block\u7684locations\uff0c\u540c\u4e00block\u6309\u7167\u91cd\u590d\u6570\u4f1a\u8fd4\u56de\u591a\u4e2alocations\uff0c\u8fd9\u4e9blocations\u6309\u7167hadoop\u62d3\u6251\u7ed3\u6784\u6392\u5e8f\uff0c\u8ddd\u79bb\u5ba2\u6237\u7aef\u8fd1\u7684\u6392\u5728\u524d\u9762\u3002 \u524d\u4e24\u6b65\u4f1a\u8fd4\u56de\u4e00\u4e2aFSDataInputStream\u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u4f1a\u88ab\u5c01\u88c5\u6210 DFSInputStream\u5bf9\u8c61\uff0cDFSInputStream\u53ef\u4ee5\u65b9\u4fbf\u7684\u7ba1\u7406datanode\u548cnamenode\u6570\u636e\u6d41\u3002\u5ba2\u6237\u7aef\u8c03\u7528read\u65b9\u6cd5\uff0cDFSInputStream\u5c31\u4f1a\u627e\u51fa\u79bb\u5ba2\u6237\u7aef\u6700\u8fd1\u7684datanode\u5e76\u8fde\u63a5datanode\u3002 \u6570\u636e\u4ecedatanode\u6e90\u6e90\u4e0d\u65ad\u7684\u6d41\u5411\u5ba2\u6237\u7aef\u3002 \u5982\u679c\u7b2c\u4e00\u4e2ablock\u5757\u7684\u6570\u636e\u8bfb\u5b8c\u4e86\uff0c\u5c31\u4f1a\u5173\u95ed\u6307\u5411\u7b2c\u4e00\u4e2ablock\u5757\u7684datanode\u8fde\u63a5\uff0c\u63a5\u7740\u8bfb\u53d6\u4e0b\u4e00\u4e2ablock\u5757\u3002\u8fd9\u4e9b\u64cd\u4f5c\u5bf9\u5ba2\u6237\u7aef\u6765\u8bf4\u662f\u900f\u660e\u7684\uff0c\u4ece\u5ba2\u6237\u7aef\u7684\u89d2\u5ea6\u6765\u770b\u53ea\u662f\u8bfb\u4e00\u4e2a\u6301\u7eed\u4e0d\u65ad\u7684\u6d41\u3002 \u5982\u679c\u7b2c\u4e00\u6279block\u90fd\u8bfb\u5b8c\u4e86\uff0cDFSInputStream\u5c31\u4f1a\u53bbnamenode\u62ff\u4e0b\u4e00\u6279blocks\u7684location\uff0c\u7136\u540e\u7ee7\u7eed\u8bfb\uff0c\u5982\u679c\u6240\u6709\u7684block\u5757\u90fd\u8bfb\u5b8c\uff0c\u8fd9\u65f6\u5c31\u4f1a\u5173\u95ed\u6389\u6240\u6709\u7684\u6d41\u3002","title":"6. HDFS \u5982\u4f55\u8bfb\u53d6\u6587\u4ef6"},{"location":"hadoop/CDH/cdh.hdfs_info/#7-hdfs","text":"HDFS\u7684\u6587\u4ef6\u5199\u5165\u539f\u7406\uff0c\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a \u5ba2\u6237\u7aef\u901a\u8fc7\u8c03\u7528 DistributedFileSystem \u7684create\u65b9\u6cd5\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6\u3002 DistributedFileSystem \u901a\u8fc7 RPC\uff08\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\uff09\u8c03\u7528 NameNode\uff0c\u53bb\u521b\u5efa\u4e00\u4e2a\u6ca1\u6709blocks\u5173\u8054\u7684\u65b0\u6587\u4ef6\u3002\u521b\u5efa\u524d\uff0cNameNode \u4f1a\u505a\u5404\u79cd\u6821\u9a8c\uff0c\u6bd4\u5982\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u5ba2\u6237\u7aef\u6709\u65e0\u6743\u9650\u53bb\u521b\u5efa\u7b49\u3002\u5982\u679c\u6821\u9a8c\u901a\u8fc7\uff0cNameNode \u5c31\u4f1a\u8bb0\u5f55\u4e0b\u65b0\u6587\u4ef6\uff0c\u5426\u5219\u5c31\u4f1a\u629b\u51faIO\u5f02\u5e38\u3002 \u524d\u4e24\u6b65\u7ed3\u675f\u540e\u4f1a\u8fd4\u56de FSDataOutputStream \u7684\u5bf9\u8c61\uff0c\u548c\u8bfb\u6587\u4ef6\u7684\u65f6\u5019\u76f8\u4f3c\uff0cFSDataOutputStream \u88ab\u5c01\u88c5\u6210 DFSOutputStream\uff0cDFSOutputStream \u53ef\u4ee5\u534f\u8c03 NameNode\u548c DataNode\u3002\u5ba2\u6237\u7aef\u5f00\u59cb\u5199\u6570\u636e\u5230DFSOutputStream,DFSOutputStream\u4f1a\u628a\u6570\u636e\u5207\u6210\u4e00\u4e2a\u4e2a\u5c0fpacket\uff0c\u7136\u540e\u6392\u6210\u961f\u5217 data queue\u3002 DataStreamer \u4f1a\u53bb\u5904\u7406\u63a5\u53d7 data queue\uff0c\u5b83\u5148\u95ee\u8be2 NameNode \u8fd9\u4e2a\u65b0\u7684 block \u6700\u9002\u5408\u5b58\u50a8\u7684\u5728\u54ea\u51e0\u4e2aDataNode\u91cc\uff0c\u6bd4\u5982\u91cd\u590d\u6570\u662f3\uff0c\u90a3\u4e48\u5c31\u627e\u52303\u4e2a\u6700\u9002\u5408\u7684 DataNode\uff0c\u628a\u5b83\u4eec\u6392\u6210\u4e00\u4e2a pipeline\u3002DataStreamer \u628a packet \u6309\u961f\u5217\u8f93\u51fa\u5230\u7ba1\u9053\u7684\u7b2c\u4e00\u4e2a DataNode \u4e2d\uff0c\u7b2c\u4e00\u4e2a DataNode\u53c8\u628a packet \u8f93\u51fa\u5230\u7b2c\u4e8c\u4e2a DataNode \u4e2d\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002 DFSOutputStream \u8fd8\u6709\u4e00\u4e2a\u961f\u5217\u53eb ack queue\uff0c\u4e5f\u662f\u7531 packet \u7ec4\u6210\uff0c\u7b49\u5f85DataNode\u7684\u6536\u5230\u54cd\u5e94\uff0c\u5f53pipeline\u4e2d\u7684\u6240\u6709DataNode\u90fd\u8868\u793a\u5df2\u7ecf\u6536\u5230\u7684\u65f6\u5019\uff0c\u8fd9\u65f6akc queue\u624d\u4f1a\u628a\u5bf9\u5e94\u7684packet\u5305\u79fb\u9664\u6389\u3002 \u5ba2\u6237\u7aef\u5b8c\u6210\u5199\u6570\u636e\u540e\uff0c\u8c03\u7528close\u65b9\u6cd5\u5173\u95ed\u5199\u5165\u6d41\u3002 DataStreamer \u628a\u5269\u4f59\u7684\u5305\u90fd\u5237\u5230 pipeline \u91cc\uff0c\u7136\u540e\u7b49\u5f85 ack \u4fe1\u606f\uff0c\u6536\u5230\u6700\u540e\u4e00\u4e2a ack \u540e\uff0c\u901a\u77e5 DataNode \u628a\u6587\u4ef6\u6807\u793a\u4e3a\u5df2\u5b8c\u6210\u3002","title":"7. HDFS \u5982\u4f55\u5199\u5165\u6587\u4ef6"},{"location":"hadoop/CDH/cdh.hdfs_info/#8-hdfs","text":"namenode\u5982\u4f55\u9009\u62e9\u5728\u54ea\u4e2adatanode \u5b58\u50a8\u526f\u672c\uff08replication\uff09\uff1f\u8fd9\u91cc\u9700\u8981\u5bf9\u53ef\u9760\u6027\u3001\u5199\u5165\u5e26\u5bbd\u548c\u8bfb\u53d6\u5e26\u5bbd\u8fdb\u884c\u6743\u8861\u3002Hadoop\u5bf9datanode\u5b58\u50a8\u526f\u672c\u6709\u81ea\u5df1\u7684\u526f\u672c\u7b56\u7565\uff0c\u5728\u5176\u53d1\u5c55\u8fc7\u7a0b\u4e2d\u4e00\u5171\u6709\u4e24\u4e2a\u7248\u672c\u7684\u526f\u672c\u7b56\u7565\uff0c\u5206\u522b\u5982\u4e0b\u6240\u793a","title":"8. HDFS \u526f\u672c\u5b58\u653e\u7b56\u7565"},{"location":"hadoop/CDH/cdh.hdfs_info/#9-hadoop2x","text":"\u5f15\u5165\u4e86NameNode Federation\uff0c\u89e3\u51b3\u4e86\u6a2a\u5411\u5185\u5b58\u6269\u5c55 \u5f15\u5165\u4e86Namenode HA\uff0c\u89e3\u51b3\u4e86namenode\u5355\u70b9\u6545\u969c \u5f15\u5165\u4e86YARN\uff0c\u8d1f\u8d23\u8d44\u6e90\u7ba1\u7406\u548c\u8c03\u5ea6 \u589e\u52a0\u4e86ResourceManager HA\u89e3\u51b3\u4e86ResourceManager\u5355\u70b9\u6545\u969c","title":"9. hadoop2.x\u65b0\u7279\u6027"},{"location":"hadoop/CDH/cdh.hdfs_info/#91-namenode-federation","text":"\u5b58\u5728\u591a\u4e2aNameNode\uff0c\u6bcf\u4e2aNameNode\u5206\u7ba1\u4e00\u90e8\u5206\u76ee\u5f55 NameNode\u5171\u7528DataNode \u8fd9\u6837\u505a\u7684\u597d\u5904\u5c31\u662f\u5f53NN\u5185\u5b58\u53d7\u9650\u65f6\uff0c\u80fd\u6269\u5c55\u5185\u5b58\uff0c\u89e3\u51b3\u5185\u5b58\u6269\u5c55\u95ee\u9898\uff0c\u800c\u4e14\u6bcf\u4e2aNN\u72ec\u7acb\u5de5\u4f5c\u76f8\u4e92\u4e0d\u53d7\u5f71\u54cd\uff0c\u6bd4\u5982\u5176\u4e2d\u4e00\u4e2aNN\u6302\u6389\u5566\uff0c\u5b83\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6NN\u63d0\u4f9b\u670d\u52a1\uff0c\u4f46\u6211\u4eec\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u867d\u7136\u6709\u591a\u4e2aNN\uff0c\u5206\u7ba1\u4e0d\u540c\u7684\u76ee\u5f55\uff0c\u4f46\u662f\u5bf9\u4e8e\u7279\u5b9a\u7684NN\uff0c\u4f9d\u7136\u5b58\u5728\u5355\u70b9\u6545\u969c\uff0c\u56e0\u4e3a\u6ca1\u6709\u5b83\u6ca1\u6709\u70ed\u5907\uff0c\u89e3\u51b3\u5355\u70b9\u6545\u969c\u4f7f\u7528NameNode HA","title":"9.1 NameNode Federation"},{"location":"hadoop/CDH/cdh.hdfs_info/#92-namenode-ha","text":"\u57fa\u4e8eNFS\u5171\u4eab\u5b58\u50a8\u89e3\u51b3\u65b9\u6848 \u57fa\u4e8eQurom Journal Manager(QJM)\u89e3\u51b3\u65b9\u6848","title":"9.2 NameNode HA"},{"location":"hadoop/CDH/cdh.hdfs_info/#921-nfs","text":"Active NN\u4e0eStandby NN\u901a\u8fc7NFS\u5b9e\u73b0\u5171\u4eab\u6570\u636e\uff0c\u4f46\u5982\u679cActive NN\u4e0eNFS\u4e4b\u95f4\u6216Standby NN\u4e0eNFS\u4e4b\u95f4\uff0c\u5176\u4e2d\u4e00\u5904\u6709\u7f51\u7edc\u6545\u969c\u7684\u8bdd\uff0c\u90a3\u5c31\u4f1a\u9020\u6210\u6570\u636e\u540c\u6b65\u95ee\u9898\u3002","title":"9.2.1 \u57fa\u4e8eNFS\u65b9\u6848"},{"location":"hadoop/CDH/cdh.hdfs_info/#922-qjm","text":"Active NN\u3001Standby NN\u6709\u4e3b\u5907\u4e4b\u5206\uff0cNN Active\u662f\u4e3b\u7684\uff0cNN Standby\u5907\u7528\u7684 \u96c6\u7fa4\u542f\u52a8\u4e4b\u540e\uff0c\u4e00\u4e2anamenode\u662factive\u72b6\u6001\uff0c\u6765\u5904\u7406client\u4e0edatanode\u4e4b\u95f4\u7684\u8bf7\u6c42\uff0c\u5e76\u628a\u76f8\u5e94\u7684\u65e5\u5fd7\u6587\u4ef6\u5199\u5230\u672c\u5730\u4e2d\u6216JN\u4e2d\uff1b Active NN\u4e0eStandby NN\u4e4b\u95f4\u662f\u901a\u8fc7\u4e00\u7ec4JN\u5171\u4eab\u6570\u636e\uff08JN\u4e00\u822c\u4e3a\u5947\u6570\u4e2a\uff0cZK\u4e00\u822c\u4e5f\u4e3a\u5947\u6570\u4e2a\uff09\uff0cActive NN\u4f1a\u628a\u65e5\u5fd7\u6587\u4ef6\u3001\u955c\u50cf\u6587\u4ef6\u5199\u5230JN\u4e2d\u53bb\uff0c\u53ea\u8981JN\u4e2d\u6709\u4e00\u534a\u5199\u6210\u529f\uff0c\u90a3\u5c31\u8868\u660eActive NN\u5411JN\u4e2d\u5199\u6210\u529f\u5566\uff0cStandby NN\u5c31\u5f00\u59cb\u4eceJN\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u6765\u5b9e\u73b0\u4e0eActive NN\u6570\u636e\u540c\u6b65\uff0c\u8fd9\u79cd\u65b9\u5f0f\u652f\u6301\u5bb9\u9519\uff0c\u56e0\u4e3aStandby NN\u5728\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u8f7d\u955c\u50cf\u6587\u4ef6\uff08fsimage\uff09\u5e76\u5468\u671f\u6027\u7684\u4eceJN\u4e2d\u83b7\u53d6\u65e5\u5fd7\u6587\u4ef6\u6765\u4fdd\u6301\u4e0eActive NN\u540c\u6b65 \u4e3a\u4e86\u5b9e\u73b0Standby NN\u5728Active NN\u6302\u6389\u4e4b\u540e\uff0c\u80fd\u8fc5\u901f\u7684\u518d\u63d0\u4f9b\u670d\u52a1\uff0c\u9700\u8981DN\u4e0d\u4ec5\u9700\u8981\u5411Active NN\u6c47\u62a5\uff0c\u540c\u65f6\u8fd8\u8981\u5411Standby NN\u6c47\u62a5\uff0c\u8fd9\u6837\u5c31\u4f7f\u5f97Standby NN\u80fd\u4fdd\u5b58\u6570\u636e\u5757\u5728DN\u4e0a\u7684\u4f4d\u7f6e\u4fe1\u606f\uff0c\u56e0\u4e3a\u5728NameNode\u5728\u542f\u52a8\u8fc7\u7a0b\u4e2d\u6700\u8d39\u65f6\u5de5\u4f5c\uff0c\u5c31\u662f\u5904\u7406\u6240\u6709DN\u4e0a\u7684\u6570\u636e\u5757\u7684\u4fe1\u606f \u4e3a\u4e86\u5b9e\u73b0Active NN\u9ad8\u70ed\u5907\uff0c\u589e\u52a0\u4e86FailoverController\u548cZK\uff0cFailoverController\u901a\u8fc7Heartbeat\u7684\u65b9\u5f0f\u4e0eZK\u901a\u4fe1\uff0c\u901a\u8fc7ZK\u6765\u9009\u4e3e\uff0c\u4e00\u65e6Active NN\u6302\u6389\uff0c\u5c31\u9009\u53d6\u53e6\u4e00\u4e2aFailoverController\u4f5c\u4e3aactive\u72b6\u6001\uff0c\u7136\u540eFailoverController\u901a\u8fc7rpc\uff0c\u8ba9standby NN\u8f6c\u53d8\u4e3aActive NN FailoverController\u4e00\u65b9\u9762\u76d1\u63a7NN\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u4e00\u65b9\u9762\u8fd8\u5411ZK\u5b9a\u65f6\u53d1\u9001\u5fc3\u8df3\uff0c\u4f7f\u81ea\u5df1\u88ab\u9009\u4e3e\u3002\u5f53\u81ea\u5df1\u88ab\u9009\u4e3a\u4e3b\uff08Active\uff09\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u901a\u8fc7rpc\u4f7f\u76f8\u5e94NN\u8f6c\u53d8Active\u72b6\u6001 \u7ed3\u5408HDFS2\u7684\u65b0\u7279\u6027\uff0c\u5728\u5b9e\u9645\u751f\u6210\u73af\u5883\u4e2d\u90e8\u7f72\u56fe \u8fd9\u91cc\u670912\u4e2aDN,\u67094\u4e2aNN\uff0cNN-1\u4e0eNN-2\u662f\u4e3b\u5907\u5173\u7cfb\uff0c\u5b83\u4eec\u7ba1\u7406/share\u76ee\u5f55\uff1bNN-3\u4e0eNN-4\u662f\u4e3b\u5907\u5173\u7cfb\uff0c\u5b83\u4eec\u7ba1\u7406/user\u76ee\u5f55","title":"9.2.2 \u57fa\u4e8eQJM\u65b9\u6848"},{"location":"hadoop/CDH/cdh.hdfs_shell/","text":"HDFS shell\u57fa\u672c\u64cd\u4f5c 1. \u4ecb\u7ecd \u00b6 \u65e2\u7136HDFS\u662f\u5b58\u53d6\u6570\u636e\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u90a3\u4e48\u5bf9HDFS\u7684\u64cd\u4f5c\uff0c\u5c31\u662f\u6587\u4ef6\u7cfb\u7edf\u7684\u57fa\u672c\u64cd\u4f5c\uff0c\u6bd4\u5982\u6587\u4ef6\u7684\u521b\u5efa\u3001\u4fee\u6539\u3001\u5220\u9664\u3001\u4fee\u6539\u6743\u9650\u7b49\uff0c\u6587\u4ef6\u5939\u7684\u521b\u5efa\u3001\u5220\u9664\u3001\u91cd\u547d\u540d\u7b49\u3002\u5bf9HDFS\u7684\u64cd\u4f5c\u547d\u4ee4\u7c7b\u4f3c\u4e8eLinux\u7684shell\u5bf9\u6587\u4ef6\u7684\u64cd\u4f5c\uff0c\u5982ls\u3001mkdir\u3001rm\u7b49\u3002 \u6211\u4eec\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u8981\u786e\u5b9ahadoop\u662f\u6b63\u5e38\u8fd0\u884c\u7684\uff0c\u4f7f\u7528jps\u547d\u4ee4\u786e\u4fdd\u770b\u5230\u5404\u4e2ahadoop\u8fdb\u7a0b\u3002 \u6211\u4eec\u6267\u884chadoop fs\uff0c [root@master ~]# hdfs dfs -ls / Found 3 items drwxr-xr-x - hdfs supergroup 0 2019-04-01 15:09 /cmz drwxrwxrwt - hdfs supergroup 0 2019-04-01 13:34 /tmp drwxr-xr-x - hdfs supergroup 0 2019-04-01 13:33 /user [root@master ~]# hadoop fs Usage: hadoop fs [generic options] [-appendToFile <localsrc> ... <dst>] [-cat [-ignoreCrc] <src> ...] [-checksum <src> ...] [-chgrp [-R] GROUP PATH...] [-chmod [-R] <MODE[,MODE]... | OCTALMODE> PATH...] [-chown [-R] [OWNER][:[GROUP]] PATH...] [-copyFromLocal [-f] [-p] [-l] <localsrc> ... <dst>] [-copyToLocal [-p] [-ignoreCrc] [-crc] <src> ... <localdst>] [-count [-q] [-h] [-v] [-x] <path> ...] [-cp [-f] [-p | -p[topax]] <src> ... <dst>] [-createSnapshot <snapshotDir> [<snapshotName>]] [-deleteSnapshot <snapshotDir> <snapshotName>] [-df [-h] [<path> ...]] [-du [-s] [-h] [-x] <path> ...] [-expunge] [-find <path> ... <expression> ...] [-get [-p] [-ignoreCrc] [-crc] <src> ... <localdst>] [-getfacl [-R] <path>] [-getfattr [-R] {-n name | -d} [-e en] <path>] [-getmerge [-nl] <src> <localdst>] [-help [cmd ...]] [-ls [-C] [-d] [-h] [-q] [-R] [-t] [-S] [-r] [-u] [<path> ...]] [-mkdir [-p] <path> ...] [-moveFromLocal <localsrc> ... <dst>] [-moveToLocal <src> <localdst>] [-mv <src> ... <dst>] [-put [-f] [-p] [-l] <localsrc> ... <dst>] [-renameSnapshot <snapshotDir> <oldName> <newName>] [-rm [-f] [-r|-R] [-skipTrash] <src> ...] [-rmdir [--ignore-fail-on-non-empty] <dir> ...] [-setfacl [-R] [{-b|-k} {-m|-x <acl_spec>} <path>]|[--set <acl_spec> <path>]] [-setfattr {-n name [-v value] | -x name} <path>] [-setrep [-R] [-w] <rep> <path> ...] [-stat [format] <path> ...] [-tail [-f] <file>] [-test -[defsz] <path>] [-text [-ignoreCrc] <src> ...] [-touchz <path> ...] [-usage [cmd ...]] Generic options supported are -conf <configuration file> specify an application configuration file -D <property=value> use value for given property -fs <local|namenode:port> specify a namenode -jt <local|resourcemanager:port> specify a ResourceManager -files <comma separated list of files> specify comma separated files to be copied to the map reduce cluster -libjars <comma separated list of jars> specify comma separated jar files to include in the classpath. -archives <comma separated list of archives> specify comma separated archives to be unarchived on the compute machines. The general command line syntax is bin/hadoop command [genericOptions] [commandOptions] 2. \u57fa\u672c\u6307\u4ee4 \u00b6 \u9009\u9879\u540d\u79f0 \u4f7f\u7528\u683c\u5f0f \u542b\u4e49 -ls -ls <\u8def\u5f84> \u67e5\u770b\u6307\u5b9a\u8def\u5f84\u7684\u5f53\u524d\u76ee\u5f55\u7ed3\u6784 -lsr -lsr <\u8def\u5f84> \u9012\u5f52\u67e5\u770b\u6307\u5b9a\u8def\u5f84\u7684\u76ee\u5f55\u7ed3\u6784 -du -du <\u8def\u5f84> \u7edf\u8ba1\u76ee\u5f55\u4e0b\u4e2a\u6587\u4ef6\u5927\u5c0f -dus -dus <\u8def\u5f84> \u6c47\u603b\u7edf\u8ba1\u76ee\u5f55\u4e0b\u6587\u4ef6(\u5939)\u5927\u5c0f -count -count [-q] <\u8def\u5f84> \u7edf\u8ba1\u6587\u4ef6(\u5939)\u6570\u91cf -mv -mv <\u6e90\u8def\u5f84> <\u76ee\u7684\u8def\u5f84> \u79fb\u52a8 -cp -cp <\u6e90\u8def\u5f84> <\u76ee\u7684\u8def\u5f84> \u590d\u5236 -rm -rm [-skipTrash] <\u8def\u5f84> \u5220\u9664\u6587\u4ef6/\u7a7a\u767d\u6587\u4ef6\u5939 -rmr -rmr [-skipTrash] <\u8def\u5f84> \u9012\u5f52\u5220\u9664 -put -put <\u591a\u4e2alinux\u4e0a\u7684\u6587\u4ef6> \u4e0a\u4f20\u6587\u4ef6 -copyFromLocal -copyFromLocal <\u591a\u4e2alinux\u4e0a\u7684\u6587\u4ef6> \u4ece\u672c\u5730\u590d\u5236 -moveFromLocal -moveFromLocal <\u591a\u4e2alinux\u4e0a\u7684\u6587\u4ef6> \u4ece\u672c\u5730\u79fb\u52a8 -getmerge -getmerge <\u6e90\u8def\u5f84> \u5408\u5e76\u5230\u672c\u5730 -cat -cat \u67e5\u770b\u6587\u4ef6\u5185\u5bb9 -text -text \u67e5\u770b\u6587\u4ef6\u5185\u5bb9 -copyToLocal -copyToLocal [-ignoreCrc] [-crc] [hdfs\u6e90\u8def\u5f84] [linux\u76ee\u7684\u8def\u5f84] \u4ece\u672c\u5730\u590d\u5236 -moveToLocal -moveToLocal [-crc] \u4ece\u672c\u5730\u79fb\u52a8 -mkdir -mkdir \u521b\u5efa\u7a7a\u767d\u6587\u4ef6\u5939 -setrep -setrep [-R] [-w] <\u526f\u672c\u6570> <\u8def\u5f84> \u4fee\u6539\u526f\u672c\u6570\u91cf -touchz -touchz <\u6587\u4ef6\u8def\u5f84> \u521b\u5efa\u7a7a\u767d\u6587\u4ef6 -stat -stat [format] <\u8def\u5f84> \u663e\u793a\u6587\u4ef6\u7edf\u8ba1\u4fe1\u606f -tail -tail [-f] <\u6587\u4ef6> \u67e5\u770b\u6587\u4ef6\u5c3e\u90e8\u4fe1\u606f -chmod -chmod [-R] <\u6743\u9650\u6a21\u5f0f> [\u8def\u5f84] \u4fee\u6539\u6743\u9650 -chown -chown [-R] [\u5c5e\u4e3b][:[\u5c5e\u7ec4]] \u8def\u5f84 \u4fee\u6539\u5c5e\u4e3b -chgrp -chgrp [-R] \u5c5e\u7ec4\u540d\u79f0 \u8def\u5f84 \u4fee\u6539\u5c5e\u7ec4 -help -help [\u547d\u4ee4\u9009\u9879] \u5e2e\u52a9 2.1 ls \u00b6 -ls \u663e\u793a\u5f53\u524d\u76ee\u5f55\u7ed3\u6784,\u547d\u4ee4\u9009\u9879\u8868\u793a\u67e5\u770b\u6307\u5b9a\u8def\u5f84\u7684\u5f53\u524d\u76ee\u5f55\u7ed3\u6784\uff0c\u540e\u9762\u8ddfhdfs\u8def\u5f84 [root@master ~]# hdfs dfs -ls / Found 3 items drwxr-xr-x - hdfs supergroup 0 2019-04-01 15:09 /cmz drwxrwxrwt - hdfs supergroup 0 2019-04-01 13:34 /tmp drwxr-xr-x - hdfs supergroup 0 2019-04-01 13:33 /user \u4e0a\u56fe\u4e2d\u7684\u8def\u5f84\u662fhdfs\u6839\u76ee\u5f55\uff0c\u663e\u793a\u7684\u5185\u5bb9\u683c\u5f0f\u4e0elinux\u7684\u547d\u4ee4ls \u2013l\u663e\u793a\u7684\u5185\u5bb9\u683c\u5f0f\u975e\u5e38\u76f8\u4f3c\uff0c\u4e0b\u9762\u89e3\u6790\u6bcf\u4e00\u884c\u7684\u5185\u5bb9\u683c\u5f0f\uff1a \u89e3\u91ca \u4e0a\u56fe\u4e2d\u7684\u8def\u5f84\u662f hdfs\u6839\u76ee\u5f55 \uff0c\u663e\u793a\u7684\u5185\u5bb9\u683c\u5f0f\u4e0e linux\u7684\u547d\u4ee4ls \u2013 l\u663e\u793a\u7684\u5185\u5bb9\u683c\u5f0f\u975e\u5e38\u76f8\u4f3c \uff0c\u4e0b\u9762\u89e3\u6790\u6bcf\u4e00\u884c\u7684\u5185\u5bb9\u683c\u5f0f\uff1a \u9996\u5b57\u6bcd\u8868\u793a\u6587\u4ef6\u5939 ( \u5982\u679c\u662f\u201c d \u201d ) \u8fd8\u662f\u6587\u4ef6\uff08\u5982\u679c\u662f\u201c - \u201d\uff09\uff1b \u540e\u9762\u7684 9 \u4f4d\u5b57\u7b26\u8868\u793a\u6743\u9650\uff1b \u540e\u9762\u7684\u6570\u5b57\u6216\u8005\u201c - \u201d\u8868\u793a\u526f\u672c\u6570\u3002\u5982\u679c\u662f\u6587\u4ef6\uff0c\u4f7f\u7528\u6570\u5b57\u8868\u793a\u526f\u672c\u6570\uff1b\u6587\u4ef6\u5939\u6ca1\u6709\u526f\u672c\uff1b \u540e\u9762\u7684\u201c root \u201d\u8868\u793a\u5c5e\u4e3b\uff1b \u540e\u9762\u7684\u201c supergroup \u201d\u8868\u793a\u5c5e\u7ec4\uff1b \u540e\u9762\u7684\u201c 0 \u201d\u3001\u201c 6176 \u201d\u3001\u201c 37645 \u201d\u8868\u793a\u6587\u4ef6\u5927\u5c0f\uff0c\u5355\u4f4d\u662f\u5b57\u8282\uff1b \u540e\u9762\u7684\u65f6\u95f4\u8868\u793a\u4fee\u6539\u65f6\u95f4\uff0c\u683c\u5f0f\u662f\u5e74\u6708\u65e5\u65f6\u5206\uff1b \u6700\u540e\u4e00\u9879\u8868\u793a\u6587\u4ef6\u8def\u5f84\u3002 \u53ef\u89c1\u6839\u76ee\u5f55\u4e0b\u9762\u6709\u56db\u4e2a\u6587\u4ef6\u5939\u3001\u4e24\u4e2a\u6587\u4ef6\u3002 \u5982\u679c\u8be5\u547d\u4ee4\u9009\u9879\u540e\u9762\u6ca1\u6709\u8def\u5f84\uff0c\u90a3\u4e48\u5c31\u4f1a\u8bbf\u95ee / user /< \u5f53\u524d\u7528\u6237 > \u76ee\u5f55\u3002 2.2 lsr \u00b6 \u9012\u5f52\u663e\u793a [root@master ~]# hdfs dfs -ls -R / drwxr-xr-x - hdfs supergroup 0 2019-04-01 15:09 /cmz -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts drwxrwxrwt - hdfs supergroup 0 2019-04-01 13:34 /tmp drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:17 /tmp/.cloudera_health_monitoring_canary_files drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs drwxr-xr-x - hdfs supergroup 0 2019-04-01 13:33 /user drwxrwxrwx - mapred hadoop 0 2019-04-01 13:33 /user/history drwxrwx--- - mapred hadoop 0 2019-04-01 13:33 /user/history/done drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /user/history/done_intermediate 2.3 du \u00b6 \u7edf\u8ba1\u76ee\u5f55\u4e0b\u5404\u6587\u4ef6\u5927\u5c0f\uff0c\u8be5\u547d\u4ee4\u9009\u9879\u663e\u793a\u6307\u5b9a\u8def\u5f84\u4e0b\u7684\u6587\u4ef6\u5927\u5c0f\uff0c\u5355\u4f4d\u662f\u5b57\u8282\u3002 [root@master ~]# hdfs dfs -du /cmz 231 693 /cmz/hosts 2.4 dus \u00b6 \u6c47\u603b\u7edf\u8ba1\u76ee\u5f55\u4e0b\u6587\u4ef6\u5927\u5c0f\uff0c\u8be5\u547d\u4ee4\u9009\u9879\u663e\u793a\u6307\u5b9a\u8def\u5f84\u7684\u6587\u4ef6\u5927\u5c0f\uff0c\u5355\u4f4d\u662f\u5b57\u8282\u3002 [root@master ~]# hdfs dfs -du -s /cmz 231 693 /cmz 2.5 count \u00b6 count \u7edf\u8ba1\u6587\u4ef6(\u5939)\u6570\u91cf\uff0c\u8be5\u547d\u4ee4\u9009\u9879\u663e\u793a\u6307\u5b9a\u8def\u5f84\u4e0b\u7684\u6587\u4ef6\u5939\u6570\u91cf\u3001\u6587\u4ef6\u6570\u91cf\u3001\u6587\u4ef6\u603b\u5927\u5c0f\u4fe1\u606f\u3002 [root@master ~]# hdfs dfs -count /user 4 0 0 /user [root@master ~]# hdfs dfs -ls -R /user drwxrwxrwx - mapred hadoop 0 2019-04-01 13:33 /user/history drwxrwx--- - mapred hadoop 0 2019-04-01 13:33 /user/history/done drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /user/history/done_intermediate 2.6 mv \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u8868\u793a\u79fb\u52a8hdfs\u7684\u6587\u4ef6\u5230\u6307\u5b9a\u7684hdfs\u76ee\u5f55\u4e2d\u3002\u540e\u9762\u8ddf\u4e24\u4e2a\u8def\u5f84\uff0c\u7b2c\u4e00\u4e2a\u8868\u793a\u6e90\u6587\u4ef6\uff0c\u7b2c\u4e8c\u4e2a\u8868\u793a\u76ee\u7684\u76ee\u5f55\u3002 [root@master ~]# hdfs dfs -ls -R / drwxr-xr-x - hdfs supergroup 0 2019-04-01 15:09 /cmz -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts drwxrwxrwt - hdfs supergroup 0 2019-04-01 13:34 /tmp drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:23 /tmp/.cloudera_health_monitoring_canary_files drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs drwxr-xr-x - hdfs supergroup 0 2019-04-01 13:33 /user drwxrwxrwx - mapred hadoop 0 2019-04-01 13:33 /user/history drwxrwx--- - mapred hadoop 0 2019-04-01 13:33 /user/history/done drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /user/history/done_intermediate [root@master ~]# hdfs dfs -mv /cmz/hosts /tmp/ [root@master ~]# hdfs dfs -ls -R / drwxr-xr-x - hdfs supergroup 0 2019-04-01 22:24 /cmz drwxrwxrwt - hdfs supergroup 0 2019-04-01 22:24 /tmp drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:23 /tmp/.cloudera_health_monitoring_canary_files -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /tmp/hosts drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs drwxr-xr-x - hdfs supergroup 0 2019-04-01 13:33 /user drwxrwxrwx - mapred hadoop 0 2019-04-01 13:33 /user/history drwxrwx--- - mapred hadoop 0 2019-04-01 13:33 /user/history/done drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /user/history/done_intermediate [root@master ~]# 2.7 cp \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u8868\u793a\u590d\u5236hdfs\u6307\u5b9a\u7684\u6587\u4ef6\u5230\u6307\u5b9a\u7684hdfs\u76ee\u5f55\u4e2d\u3002\u540e\u9762\u8ddf\u4e24\u4e2a\u8def\u5f84\uff0c\u7b2c\u4e00\u4e2a\u662f\u88ab\u590d\u5236\u7684\u6587\u4ef6\uff0c\u7b2c\u4e8c\u4e2a\u662f\u76ee\u7684\u5730\u3002 [root@master ~]# hdfs dfs -ls -R /tmp drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:25 /tmp/.cloudera_health_monitoring_canary_files -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /tmp/hosts drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs [root@master ~]# hdfs dfs -ls -R /cmz [root@master ~]# hdfs dfs -cp /tmp/hosts /cmz [root@master ~]# hdfs dfs -ls -R /cmz -rw-r--r-- 3 root supergroup 231 2019-04-01 22:26 /cmz/hosts 2.8 rm \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u8868\u793a\u5220\u9664\u6307\u5b9a\u7684\u6587\u4ef6\u6216\u8005\u7a7a\u76ee\u5f55\u3002 [root@master ~]# hdfs dfs -ls -R /cmz -rw-r--r-- 3 root supergroup 231 2019-04-01 22:26 /cmz/hosts [root@master ~]# hdfs dfs -rm /cmz/hosts 19/04/01 22:27:15 INFO fs.TrashPolicyDefault: Moved: 'hdfs://master:8020/cmz/hosts' to trash at: hdfs://master:8020/user/root/.Trash/Current/cmz/hosts [root@master ~]# hdfs dfs -ls -R /cmz \u4e0d\u80fd\u5220\u9664\u975e\u7a7a\u76ee\u5f55 2.9 rmr \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u8868\u793a\u9012\u5f52\u5220\u9664\u6307\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u5b50\u76ee\u5f55\u548c\u6587\u4ef6 [root@master ~]# hdfs dfs -ls -R /cmz drwxr-xr-x - root supergroup 0 2019-04-01 22:28 /cmz/a -rw-r--r-- 3 root supergroup 231 2019-04-01 22:28 /cmz/a/hosts drwxr-xr-x - root supergroup 0 2019-04-01 22:28 /cmz/b -rw-r--r-- 3 root supergroup 231 2019-04-01 22:28 /cmz/b/hosts [root@master ~]# hdfs dfs -rmr /cmz rmr: DEPRECATED: Please use 'rm -r' instead. ^Crmr: Filesystem closed. Consider using -skipTrash option [root@master ~]# ^C [root@master ~]# hdfs dfs -rm -r /cmz 19/04/01 22:29:26 INFO fs.TrashPolicyDefault: Moved: 'hdfs://master:8020/cmz' to trash at: hdfs://master:8020/user/root/.Trash/Current/cmz1554128966724 [root@master ~]# hdfs dfs -ls -R /cmz ls: `/cmz': No such file or directory 2.10 put \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u8868\u793a\u628alinux\u4e0a\u7684\u6587\u4ef6\u590d\u5236\u5230hdfs\u4e2d\uff0c [root@master ~]# hdfs dfs -ls -R /tmp drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:29 /tmp/.cloudera_health_monitoring_canary_files -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /tmp/hosts drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs [root@master ~]# hdfs dfs -put /etc/passwd /tmp/ [root@master ~]# hdfs dfs -ls -R /tmp drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:31 /tmp/.cloudera_health_monitoring_canary_files -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /tmp/hosts drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs -rw-r--r-- 3 root supergroup 1851 2019-04-01 22:31 /tmp/passwd 2.11 copyFromLocal \u00b6 \u7c7b\u4f3cput\u4e00\u81f4\u3002 2.12 moveFromLocal \u00b6 \u8868\u793a\u628a\u6587\u4ef6\u4ece\u672c\u5730\u79fb\u52a8\u5230hdfs\u4e2d\u3002 [root@master ~]# echo 'test for caimemzhi' > cmz.txt [root@master ~]# ls cmz.txt cmz.txt [root@master ~]# hdfs dfs -moveFromLocal cmz.txt /tmp/ [root@master ~]# ls anaconda-ks.cfg cmz loocha mainfests [root@master ~]# hdfs dfs -ls /tmp Found 6 items drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:34 /tmp/.cloudera_health_monitoring_canary_files -rw-r--r-- 3 root supergroup 19 2019-04-01 22:34 /tmp/cmz.txt -rw-r--r-- 3 root supergroup 231 2019-04-01 22:32 /tmp/cmz_hosts -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /tmp/hosts drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs -rw-r--r-- 3 root supergroup 1851 2019-04-01 22:31 /tmp/passwd 2.13 getmerge \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u7684\u542b\u4e49\u662f\u628ahdfs\u6307\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u5185\u5bb9\u5408\u5e76\u5230\u672c\u5730\u6587\u4ef6\u4e2d\u3002 [root@master ~]# hdfs dfs -ls /tmp Found 6 items drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:34 /tmp/.cloudera_health_monitoring_canary_files -rw-r--r-- 3 root supergroup 19 2019-04-01 22:34 /tmp/cmz.txt -rw-r--r-- 3 root supergroup 231 2019-04-01 22:32 /tmp/cmz_hosts -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /tmp/hosts drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs -rw-r--r-- 3 root supergroup 1851 2019-04-01 22:31 /tmp/passwd [root@master ~]# ls anaconda-ks.cfg cmz loocha mainfests [root@master ~]# hdfs dfs -getmerge /tmp/ local_text.txt [root@master ~]# cat local_text.txt test for caimemzhi 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync mail:x:8:12:mail:/var/spool/mail:/sbin/nologin ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin nobody:x:99:99:Nobody:/:/sbin/nologin systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin dbus:x:81:81:System message bus:/:/sbin/nologin polkitd:x:999:998:User for polkitd:/:/sbin/nologin sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin postfix:x:89:89::/var/spool/postfix:/sbin/nologin chrony:x:998:996::/var/lib/chrony:/sbin/nologin ntp:x:38:38::/etc/ntp:/sbin/nologin nginx:x:1000:1000::/home/nginx:/sbin/nologin mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bash cloudera-scm:x:997:993:Cloudera SCM User:/opt/cloudera-manager/cm-5.13.1/run/cloudera-scm-server/:/bin/false flume:x:996:991:Flume:/var/lib/flume-ng:/bin/false hdfs:x:995:990:Hadoop HDFS:/var/lib/hadoop-hdfs:/bin/bash solr:x:994:989:Solr:/var/lib/solr:/sbin/nologin zookeeper:x:993:988:ZooKeeper:/var/lib/zookeeper:/bin/false llama:x:992:987:Llama:/var/lib/llama:/bin/bash httpfs:x:991:986:Hadoop HTTPFS:/var/lib/hadoop-httpfs:/bin/bash mapred:x:990:985:Hadoop MapReduce:/var/lib/hadoop-mapreduce:/bin/bash sqoop:x:989:984:Sqoop:/var/lib/sqoop:/bin/false yarn:x:988:983:Hadoop Yarn:/var/lib/hadoop-yarn:/bin/bash kms:x:987:982:Hadoop KMS:/var/lib/hadoop-kms:/bin/bash hive:x:986:981:Hive:/var/lib/hive:/bin/false sqoop2:x:985:980:Sqoop 2 User:/var/lib/sqoop2:/sbin/nologin oozie:x:984:979:Oozie User:/var/lib/oozie:/bin/false kudu:x:983:978:Kudu:/var/lib/kudu:/sbin/nologin hbase:x:982:977:HBase:/var/lib/hbase:/bin/false sentry:x:981:976:Sentry:/var/lib/sentry:/sbin/nologin impala:x:980:975:Impala:/var/lib/impala:/bin/bash spark:x:979:974:Spark:/var/lib/spark:/sbin/nologin hue:x:978:973:Hue:/usr/lib/hue:/bin/false 2.14 cat \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u662f\u67e5\u770b\u6587\u4ef6\u5185\u5bb9 [root@master ~]# hdfs dfs -cat /tmp/cmz.txt test for caimemzhi 2.15 text \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u53ef\u4ee5\u8ba4\u4e3a\u4f5c\u7528\u548c\u7528\u6cd5\u4e0e-cat\u76f8\u540c\uff0c\u6b64\u5904\u7565\u3002 2.16 mkdir \u00b6 mkdir \u521b\u5efa\u7a7a\u767d\u6587\u4ef6\u5939\uff0c\u540e\u9762\u8ddf\u7684\u8def\u5f84\u662f\u5728hdfs\u5c06\u8981\u521b\u5efa\u7684\u6587\u4ef6\u5939 [root@master ~]# hdfs dfs -ls / Found 2 items drwxrwxrwt - hdfs supergroup 0 2019-04-01 22:34 /tmp drwxr-xr-x - hdfs supergroup 0 2019-04-01 22:27 /user [root@master ~]# hdfs dfs -mkdir /cmz [root@master ~]# hdfs dfs -ls / Found 3 items drwxr-xr-x - root supergroup 0 2019-04-01 22:39 /cmz drwxrwxrwt - hdfs supergroup 0 2019-04-01 22:34 /tmp drwxr-xr-x - hdfs supergroup 0 2019-04-01 22:27 /user 2.17 setrep \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u662f\u4fee\u6539 \u5df2\u4fdd\u5b58\u6587\u4ef6 \u7684\u526f\u672c\u6570\u91cf\uff0c\u540e\u9762\u8ddf\u526f\u672c\u6570\u91cf\uff0c\u518d\u8ddf\u6587\u4ef6\u8def\u5f84\u3002 [root@master ~]# hdfs dfs -ls / Found 3 items drwxr-xr-x - root supergroup 0 2019-04-01 22:39 /cmz drwxrwxrwt - hdfs supergroup 0 2019-04-01 22:34 /tmp drwxr-xr-x - hdfs supergroup 0 2019-04-01 22:27 /user [root@master ~]# hdfs dfs -put /etc/hosts /cmz/ [root@master ~]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 root supergroup 231 2019-04-01 22:40 /cmz/hosts [root@master ~]# hdfs dfs -setrep 2 /cmz/hosts Replication 2 set: /cmz/hosts [root@master ~]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 2 root supergroup 231 2019-04-01 22:40 /cmz/hosts \u9ed8\u8ba4\u662f3\u4efd\u526f\u672c\uff0c\u6211\u624b\u52a8\u8bbe\u7f6e\u4e3a2\u4efd\u526f\u672c\u3002\u5373\u4f7f\u6211\u6539\u53d8\u6587\u4ef6\u5939\u7684\u526f\u672c\u6570\u662f2\uff0c\u4ee5\u540e\u518d\u65b0\u4e0a\u4f20\u5230\u8be5\u6587\u4ef6\u5939\u4e0b\u7684\u6587\u4ef6\u8fd8\u662f\u9ed8\u8ba4\u662f3\u3002 \u5982\u679c\u6700\u540e\u7684\u8def\u5f84\u8868\u793a\u6587\u4ef6\u5939\uff0c\u90a3\u4e48\u9700\u8981\u8ddf\u9009\u9879-R\uff0c\u8868\u793a\u5bf9\u6587\u4ef6\u5939\u4e2d\u7684\u6240\u6709\u6587\u4ef6\u90fd\u4fee\u6539\u526f\u672c\uff0c\u8fd8\u6709\u4e00\u4e2a\u9009\u9879\u662f-w\uff0c\u8868\u793a\u7b49\u5f85\u526f\u672c\u64cd\u4f5c\u7ed3\u675f\u624d\u9000\u51fa\u547d\u4ee4\uff0c\u5982\u56fe4-18\u6240\u793a 2.18 touch \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u662f\u5728hdfs\u4e2d\u521b\u5efa\u7a7a\u767d\u6587\u4ef6\u3002 [root@master ~]# hdfs dfs -touchz /cmz/leco.txt [root@master ~]# hdfs dfs -ls /cmz Found 4 items -rw-r--r-- 2 root supergroup 7 2019-04-01 22:42 /cmz/hostname -rw-r--r-- 2 root supergroup 231 2019-04-01 22:40 /cmz/hosts -rw-r--r-- 3 root supergroup 0 2019-04-01 22:46 /cmz/leco.txt -rw-r--r-- 3 root supergroup 1851 2019-04-01 22:43 /cmz/passwd 2.19 stat \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u663e\u793a\u6587\u4ef6\u7684\u4e00\u4e9b\u7edf\u8ba1\u4fe1\u606f\u3002 [root@master ~]# hdfs dfs -ls /cmz Found 4 items -rw-r--r-- 2 root supergroup 7 2019-04-01 22:42 /cmz/hostname -rw-r--r-- 2 root supergroup 231 2019-04-01 22:40 /cmz/hosts -rw-r--r-- 3 root supergroup 0 2019-04-01 22:46 /cmz/leco.txt -rw-r--r-- 3 root supergroup 1851 2019-04-01 22:43 /cmz/passwd [root@master ~]# hdfs dfs -stat /cmz 2019-04-01 14:46:10 [root@master ~]# hdfs dfs -stat /cmz/hosts 2019-04-01 14:40:54 [root@master ~]# hdfs dfs -stat '%b %n %o %r %Y' /cmz/hosts 231 hosts 134217728 2 1554129654178 \u547d\u4ee4\u9009\u9879\u540e\u9762\u53ef\u4ee5\u6709\u683c\u5f0f\uff0c\u4f7f\u7528\u5f15\u53f7\u8868\u793a\u3002\u793a\u4f8b\u4e2d\u7684\u683c\u5f0f\u201c%b %n %o %r %Y\u201d\u4f9d\u6b21\u8868\u793a\u6587\u4ef6\u5927\u5c0f\u3001\u6587\u4ef6\u540d\u79f0\u3001\u5757\u5927\u5c0f\u3001\u526f\u672c\u6570\u3001\u8bbf\u95ee\u65f6\u95f4 2.20 tail \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u663e\u793a\u6587\u4ef6\u6700\u540e1K\u5b57\u8282\u7684\u5185\u5bb9\u3002\u4e00\u822c\u7528\u4e8e\u67e5\u770b\u65e5\u5fd7\u3002\u5982\u679c\u5e26\u6709\u9009\u9879-f\uff0c\u90a3\u4e48\u5f53\u6587\u4ef6\u5185\u5bb9\u53d8\u5316\u65f6\uff0c\u4e5f\u4f1a\u81ea\u52a8\u663e\u793a\u3002 [root@master ~]# hdfs dfs -tail /tmp/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 2.21 chmod \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u7684\u4f7f\u7528\u7c7b\u4f3c\u4e8elinux\u7684shell\u4e2d\u7684chmod\u7528\u6cd5 [root@master ~]# hdfs dfs -ls /cmz/hosts -rw-r--r-- 2 root supergroup 231 2019-04-01 22:40 /cmz/hosts [root@master ~]# hdfs dfs -chmod 777 /cmz/hosts [root@master ~]# hdfs dfs -ls /cmz/hosts -rwxrwxrwx 2 root supergroup 231 2019-04-01 22:40 /cmz/hosts \u5982\u679c\u52a0\u4e0a\u9009\u9879-R\uff0c\u53ef\u4ee5\u5bf9\u6587\u4ef6\u5939\u4e2d\u7684\u6240\u6709\u6587\u4ef6\u4fee\u6539\u6743\u9650 2.22 chown \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u8868\u793a\u4fee\u6539\u6587\u4ef6\u7684\u5c5e\u4e3b,\u5982\u679c\u5e26\u6709\u9009\u9879-R\uff0c\u610f\u5473\u7740\u53ef\u4ee5\u9012\u5f52\u4fee\u6539\u6587\u4ef6\u5939\u4e2d\u7684\u6240\u6709\u6587\u4ef6\u7684\u5c5e\u4e3b\u3001\u5c5e\u7ec4\u4fe1\u606f\u3002 2.23 chgrp \u00b6 \u8be5\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u4fee\u6539\u6587\u4ef6\u7684\u5c5e\u7ec4\uff0c\u8be5\u547d\u4ee4\u76f8\u5f53\u4e8e\u201cchown :\u5c5e\u7ec4\u201d\u7684\u7528\u6cd5. 2.24 appendToFile \u00b6 \u5411HDFS\u4e2d\u6307\u5b9a\u7684\u6587\u4ef6\u8ffd\u52a0\u5185\u5bb9\uff0c\u7531\u7528\u6237\u6307\u5b9a\u5185\u5bb9\u8ffd\u52a0\u5230\u539f\u6709\u6587\u4ef6\u7684\u5f00\u5934\u6216\u7ed3\u5c3e [root@master ~]# echo 'test for caimengzhi'>test.txt [root@master ~]# hdfs dfs -cat /cmz/leco.txt [root@master ~]# hdfs dfs -appendToFile test.txt /cmz/leco.txt [root@master ~]# hdfs dfs -cat /cmz/leco.txt test for caimengzhi 2.25 help \u00b6 \u8be5\u547d\u4ee4\u9009\u9879\u4f1a\u663e\u793a\u5e2e\u52a9\u4fe1\u606f\uff0c\u540e\u9762\u8ddf\u4e0a\u9700\u8981\u67e5\u8be2\u7684\u547d\u4ee4\u9009\u9879\u5373\u53ef\u3002 [root@master ~]# hdfs dfs -help chown -chown [-R] [OWNER][:[GROUP]] PATH... : Changes owner and group of a file. This is similar to the shell's chown command with a few exceptions. -R modifies the files recursively. This is the only option currently supported. If only the owner or group is specified, then only the owner or group is modified. The owner and group names may only consist of digits, alphabet, and any of [-_./@a-zA-Z0-9]. The names are case sensitive. WARNING: Avoid using '.' to separate user name and group though Linux allows it. If user names have dots in them and you are using local file system, you might see surprising results since the shell command 'chown' is used for local files.","title":"2. HDFS shell"},{"location":"hadoop/CDH/cdh.hdfs_shell/#1","text":"\u65e2\u7136HDFS\u662f\u5b58\u53d6\u6570\u636e\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u90a3\u4e48\u5bf9HDFS\u7684\u64cd\u4f5c\uff0c\u5c31\u662f\u6587\u4ef6\u7cfb\u7edf\u7684\u57fa\u672c\u64cd\u4f5c\uff0c\u6bd4\u5982\u6587\u4ef6\u7684\u521b\u5efa\u3001\u4fee\u6539\u3001\u5220\u9664\u3001\u4fee\u6539\u6743\u9650\u7b49\uff0c\u6587\u4ef6\u5939\u7684\u521b\u5efa\u3001\u5220\u9664\u3001\u91cd\u547d\u540d\u7b49\u3002\u5bf9HDFS\u7684\u64cd\u4f5c\u547d\u4ee4\u7c7b\u4f3c\u4e8eLinux\u7684shell\u5bf9\u6587\u4ef6\u7684\u64cd\u4f5c\uff0c\u5982ls\u3001mkdir\u3001rm\u7b49\u3002 \u6211\u4eec\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u8981\u786e\u5b9ahadoop\u662f\u6b63\u5e38\u8fd0\u884c\u7684\uff0c\u4f7f\u7528jps\u547d\u4ee4\u786e\u4fdd\u770b\u5230\u5404\u4e2ahadoop\u8fdb\u7a0b\u3002 \u6211\u4eec\u6267\u884chadoop fs\uff0c [root@master ~]# hdfs dfs -ls / Found 3 items drwxr-xr-x - hdfs supergroup 0 2019-04-01 15:09 /cmz drwxrwxrwt - hdfs supergroup 0 2019-04-01 13:34 /tmp drwxr-xr-x - hdfs supergroup 0 2019-04-01 13:33 /user [root@master ~]# hadoop fs Usage: hadoop fs [generic options] [-appendToFile <localsrc> ... <dst>] [-cat [-ignoreCrc] <src> ...] [-checksum <src> ...] [-chgrp [-R] GROUP PATH...] [-chmod [-R] <MODE[,MODE]... | OCTALMODE> PATH...] [-chown [-R] [OWNER][:[GROUP]] PATH...] [-copyFromLocal [-f] [-p] [-l] <localsrc> ... <dst>] [-copyToLocal [-p] [-ignoreCrc] [-crc] <src> ... <localdst>] [-count [-q] [-h] [-v] [-x] <path> ...] [-cp [-f] [-p | -p[topax]] <src> ... <dst>] [-createSnapshot <snapshotDir> [<snapshotName>]] [-deleteSnapshot <snapshotDir> <snapshotName>] [-df [-h] [<path> ...]] [-du [-s] [-h] [-x] <path> ...] [-expunge] [-find <path> ... <expression> ...] [-get [-p] [-ignoreCrc] [-crc] <src> ... <localdst>] [-getfacl [-R] <path>] [-getfattr [-R] {-n name | -d} [-e en] <path>] [-getmerge [-nl] <src> <localdst>] [-help [cmd ...]] [-ls [-C] [-d] [-h] [-q] [-R] [-t] [-S] [-r] [-u] [<path> ...]] [-mkdir [-p] <path> ...] [-moveFromLocal <localsrc> ... <dst>] [-moveToLocal <src> <localdst>] [-mv <src> ... <dst>] [-put [-f] [-p] [-l] <localsrc> ... <dst>] [-renameSnapshot <snapshotDir> <oldName> <newName>] [-rm [-f] [-r|-R] [-skipTrash] <src> ...] [-rmdir [--ignore-fail-on-non-empty] <dir> ...] [-setfacl [-R] [{-b|-k} {-m|-x <acl_spec>} <path>]|[--set <acl_spec> <path>]] [-setfattr {-n name [-v value] | -x name} <path>] [-setrep [-R] [-w] <rep> <path> ...] [-stat [format] <path> ...] [-tail [-f] <file>] [-test -[defsz] <path>] [-text [-ignoreCrc] <src> ...] [-touchz <path> ...] [-usage [cmd ...]] Generic options supported are -conf <configuration file> specify an application configuration file -D <property=value> use value for given property -fs <local|namenode:port> specify a namenode -jt <local|resourcemanager:port> specify a ResourceManager -files <comma separated list of files> specify comma separated files to be copied to the map reduce cluster -libjars <comma separated list of jars> specify comma separated jar files to include in the classpath. -archives <comma separated list of archives> specify comma separated archives to be unarchived on the compute machines. The general command line syntax is bin/hadoop command [genericOptions] [commandOptions]","title":"1. \u4ecb\u7ecd"},{"location":"hadoop/CDH/cdh.hdfs_shell/#2","text":"\u9009\u9879\u540d\u79f0 \u4f7f\u7528\u683c\u5f0f \u542b\u4e49 -ls -ls <\u8def\u5f84> \u67e5\u770b\u6307\u5b9a\u8def\u5f84\u7684\u5f53\u524d\u76ee\u5f55\u7ed3\u6784 -lsr -lsr <\u8def\u5f84> \u9012\u5f52\u67e5\u770b\u6307\u5b9a\u8def\u5f84\u7684\u76ee\u5f55\u7ed3\u6784 -du -du <\u8def\u5f84> \u7edf\u8ba1\u76ee\u5f55\u4e0b\u4e2a\u6587\u4ef6\u5927\u5c0f -dus -dus <\u8def\u5f84> \u6c47\u603b\u7edf\u8ba1\u76ee\u5f55\u4e0b\u6587\u4ef6(\u5939)\u5927\u5c0f -count -count [-q] <\u8def\u5f84> \u7edf\u8ba1\u6587\u4ef6(\u5939)\u6570\u91cf -mv -mv <\u6e90\u8def\u5f84> <\u76ee\u7684\u8def\u5f84> \u79fb\u52a8 -cp -cp <\u6e90\u8def\u5f84> <\u76ee\u7684\u8def\u5f84> \u590d\u5236 -rm -rm [-skipTrash] <\u8def\u5f84> \u5220\u9664\u6587\u4ef6/\u7a7a\u767d\u6587\u4ef6\u5939 -rmr -rmr [-skipTrash] <\u8def\u5f84> \u9012\u5f52\u5220\u9664 -put -put <\u591a\u4e2alinux\u4e0a\u7684\u6587\u4ef6> \u4e0a\u4f20\u6587\u4ef6 -copyFromLocal -copyFromLocal <\u591a\u4e2alinux\u4e0a\u7684\u6587\u4ef6> \u4ece\u672c\u5730\u590d\u5236 -moveFromLocal -moveFromLocal <\u591a\u4e2alinux\u4e0a\u7684\u6587\u4ef6> \u4ece\u672c\u5730\u79fb\u52a8 -getmerge -getmerge <\u6e90\u8def\u5f84> \u5408\u5e76\u5230\u672c\u5730 -cat -cat \u67e5\u770b\u6587\u4ef6\u5185\u5bb9 -text -text \u67e5\u770b\u6587\u4ef6\u5185\u5bb9 -copyToLocal -copyToLocal [-ignoreCrc] [-crc] [hdfs\u6e90\u8def\u5f84] [linux\u76ee\u7684\u8def\u5f84] \u4ece\u672c\u5730\u590d\u5236 -moveToLocal -moveToLocal [-crc] \u4ece\u672c\u5730\u79fb\u52a8 -mkdir -mkdir \u521b\u5efa\u7a7a\u767d\u6587\u4ef6\u5939 -setrep -setrep [-R] [-w] <\u526f\u672c\u6570> <\u8def\u5f84> \u4fee\u6539\u526f\u672c\u6570\u91cf -touchz -touchz <\u6587\u4ef6\u8def\u5f84> \u521b\u5efa\u7a7a\u767d\u6587\u4ef6 -stat -stat [format] <\u8def\u5f84> \u663e\u793a\u6587\u4ef6\u7edf\u8ba1\u4fe1\u606f -tail -tail [-f] <\u6587\u4ef6> \u67e5\u770b\u6587\u4ef6\u5c3e\u90e8\u4fe1\u606f -chmod -chmod [-R] <\u6743\u9650\u6a21\u5f0f> [\u8def\u5f84] \u4fee\u6539\u6743\u9650 -chown -chown [-R] [\u5c5e\u4e3b][:[\u5c5e\u7ec4]] \u8def\u5f84 \u4fee\u6539\u5c5e\u4e3b -chgrp -chgrp [-R] \u5c5e\u7ec4\u540d\u79f0 \u8def\u5f84 \u4fee\u6539\u5c5e\u7ec4 -help -help [\u547d\u4ee4\u9009\u9879] \u5e2e\u52a9","title":"2. \u57fa\u672c\u6307\u4ee4"},{"location":"hadoop/CDH/cdh.hdfs_shell/#21-ls","text":"-ls \u663e\u793a\u5f53\u524d\u76ee\u5f55\u7ed3\u6784,\u547d\u4ee4\u9009\u9879\u8868\u793a\u67e5\u770b\u6307\u5b9a\u8def\u5f84\u7684\u5f53\u524d\u76ee\u5f55\u7ed3\u6784\uff0c\u540e\u9762\u8ddfhdfs\u8def\u5f84 [root@master ~]# hdfs dfs -ls / Found 3 items drwxr-xr-x - hdfs supergroup 0 2019-04-01 15:09 /cmz drwxrwxrwt - hdfs supergroup 0 2019-04-01 13:34 /tmp drwxr-xr-x - hdfs supergroup 0 2019-04-01 13:33 /user \u4e0a\u56fe\u4e2d\u7684\u8def\u5f84\u662fhdfs\u6839\u76ee\u5f55\uff0c\u663e\u793a\u7684\u5185\u5bb9\u683c\u5f0f\u4e0elinux\u7684\u547d\u4ee4ls \u2013l\u663e\u793a\u7684\u5185\u5bb9\u683c\u5f0f\u975e\u5e38\u76f8\u4f3c\uff0c\u4e0b\u9762\u89e3\u6790\u6bcf\u4e00\u884c\u7684\u5185\u5bb9\u683c\u5f0f\uff1a \u89e3\u91ca \u4e0a\u56fe\u4e2d\u7684\u8def\u5f84\u662f hdfs\u6839\u76ee\u5f55 \uff0c\u663e\u793a\u7684\u5185\u5bb9\u683c\u5f0f\u4e0e linux\u7684\u547d\u4ee4ls \u2013 l\u663e\u793a\u7684\u5185\u5bb9\u683c\u5f0f\u975e\u5e38\u76f8\u4f3c \uff0c\u4e0b\u9762\u89e3\u6790\u6bcf\u4e00\u884c\u7684\u5185\u5bb9\u683c\u5f0f\uff1a \u9996\u5b57\u6bcd\u8868\u793a\u6587\u4ef6\u5939 ( \u5982\u679c\u662f\u201c d \u201d ) \u8fd8\u662f\u6587\u4ef6\uff08\u5982\u679c\u662f\u201c - \u201d\uff09\uff1b \u540e\u9762\u7684 9 \u4f4d\u5b57\u7b26\u8868\u793a\u6743\u9650\uff1b \u540e\u9762\u7684\u6570\u5b57\u6216\u8005\u201c - \u201d\u8868\u793a\u526f\u672c\u6570\u3002\u5982\u679c\u662f\u6587\u4ef6\uff0c\u4f7f\u7528\u6570\u5b57\u8868\u793a\u526f\u672c\u6570\uff1b\u6587\u4ef6\u5939\u6ca1\u6709\u526f\u672c\uff1b \u540e\u9762\u7684\u201c root \u201d\u8868\u793a\u5c5e\u4e3b\uff1b \u540e\u9762\u7684\u201c supergroup \u201d\u8868\u793a\u5c5e\u7ec4\uff1b \u540e\u9762\u7684\u201c 0 \u201d\u3001\u201c 6176 \u201d\u3001\u201c 37645 \u201d\u8868\u793a\u6587\u4ef6\u5927\u5c0f\uff0c\u5355\u4f4d\u662f\u5b57\u8282\uff1b \u540e\u9762\u7684\u65f6\u95f4\u8868\u793a\u4fee\u6539\u65f6\u95f4\uff0c\u683c\u5f0f\u662f\u5e74\u6708\u65e5\u65f6\u5206\uff1b \u6700\u540e\u4e00\u9879\u8868\u793a\u6587\u4ef6\u8def\u5f84\u3002 \u53ef\u89c1\u6839\u76ee\u5f55\u4e0b\u9762\u6709\u56db\u4e2a\u6587\u4ef6\u5939\u3001\u4e24\u4e2a\u6587\u4ef6\u3002 \u5982\u679c\u8be5\u547d\u4ee4\u9009\u9879\u540e\u9762\u6ca1\u6709\u8def\u5f84\uff0c\u90a3\u4e48\u5c31\u4f1a\u8bbf\u95ee / user /< \u5f53\u524d\u7528\u6237 > \u76ee\u5f55\u3002","title":"2.1 ls"},{"location":"hadoop/CDH/cdh.hdfs_shell/#22-lsr","text":"\u9012\u5f52\u663e\u793a [root@master ~]# hdfs dfs -ls -R / drwxr-xr-x - hdfs supergroup 0 2019-04-01 15:09 /cmz -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts drwxrwxrwt - hdfs supergroup 0 2019-04-01 13:34 /tmp drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:17 /tmp/.cloudera_health_monitoring_canary_files drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs drwxr-xr-x - hdfs supergroup 0 2019-04-01 13:33 /user drwxrwxrwx - mapred hadoop 0 2019-04-01 13:33 /user/history drwxrwx--- - mapred hadoop 0 2019-04-01 13:33 /user/history/done drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /user/history/done_intermediate","title":"2.2 lsr"},{"location":"hadoop/CDH/cdh.hdfs_shell/#23-du","text":"\u7edf\u8ba1\u76ee\u5f55\u4e0b\u5404\u6587\u4ef6\u5927\u5c0f\uff0c\u8be5\u547d\u4ee4\u9009\u9879\u663e\u793a\u6307\u5b9a\u8def\u5f84\u4e0b\u7684\u6587\u4ef6\u5927\u5c0f\uff0c\u5355\u4f4d\u662f\u5b57\u8282\u3002 [root@master ~]# hdfs dfs -du /cmz 231 693 /cmz/hosts","title":"2.3 du"},{"location":"hadoop/CDH/cdh.hdfs_shell/#24-dus","text":"\u6c47\u603b\u7edf\u8ba1\u76ee\u5f55\u4e0b\u6587\u4ef6\u5927\u5c0f\uff0c\u8be5\u547d\u4ee4\u9009\u9879\u663e\u793a\u6307\u5b9a\u8def\u5f84\u7684\u6587\u4ef6\u5927\u5c0f\uff0c\u5355\u4f4d\u662f\u5b57\u8282\u3002 [root@master ~]# hdfs dfs -du -s /cmz 231 693 /cmz","title":"2.4 dus"},{"location":"hadoop/CDH/cdh.hdfs_shell/#25-count","text":"count \u7edf\u8ba1\u6587\u4ef6(\u5939)\u6570\u91cf\uff0c\u8be5\u547d\u4ee4\u9009\u9879\u663e\u793a\u6307\u5b9a\u8def\u5f84\u4e0b\u7684\u6587\u4ef6\u5939\u6570\u91cf\u3001\u6587\u4ef6\u6570\u91cf\u3001\u6587\u4ef6\u603b\u5927\u5c0f\u4fe1\u606f\u3002 [root@master ~]# hdfs dfs -count /user 4 0 0 /user [root@master ~]# hdfs dfs -ls -R /user drwxrwxrwx - mapred hadoop 0 2019-04-01 13:33 /user/history drwxrwx--- - mapred hadoop 0 2019-04-01 13:33 /user/history/done drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /user/history/done_intermediate","title":"2.5 count"},{"location":"hadoop/CDH/cdh.hdfs_shell/#26-mv","text":"\u8be5\u547d\u4ee4\u9009\u9879\u8868\u793a\u79fb\u52a8hdfs\u7684\u6587\u4ef6\u5230\u6307\u5b9a\u7684hdfs\u76ee\u5f55\u4e2d\u3002\u540e\u9762\u8ddf\u4e24\u4e2a\u8def\u5f84\uff0c\u7b2c\u4e00\u4e2a\u8868\u793a\u6e90\u6587\u4ef6\uff0c\u7b2c\u4e8c\u4e2a\u8868\u793a\u76ee\u7684\u76ee\u5f55\u3002 [root@master ~]# hdfs dfs -ls -R / drwxr-xr-x - hdfs supergroup 0 2019-04-01 15:09 /cmz -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts drwxrwxrwt - hdfs supergroup 0 2019-04-01 13:34 /tmp drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:23 /tmp/.cloudera_health_monitoring_canary_files drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs drwxr-xr-x - hdfs supergroup 0 2019-04-01 13:33 /user drwxrwxrwx - mapred hadoop 0 2019-04-01 13:33 /user/history drwxrwx--- - mapred hadoop 0 2019-04-01 13:33 /user/history/done drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /user/history/done_intermediate [root@master ~]# hdfs dfs -mv /cmz/hosts /tmp/ [root@master ~]# hdfs dfs -ls -R / drwxr-xr-x - hdfs supergroup 0 2019-04-01 22:24 /cmz drwxrwxrwt - hdfs supergroup 0 2019-04-01 22:24 /tmp drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:23 /tmp/.cloudera_health_monitoring_canary_files -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /tmp/hosts drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs drwxr-xr-x - hdfs supergroup 0 2019-04-01 13:33 /user drwxrwxrwx - mapred hadoop 0 2019-04-01 13:33 /user/history drwxrwx--- - mapred hadoop 0 2019-04-01 13:33 /user/history/done drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /user/history/done_intermediate [root@master ~]#","title":"2.6 mv"},{"location":"hadoop/CDH/cdh.hdfs_shell/#27-cp","text":"\u8be5\u547d\u4ee4\u9009\u9879\u8868\u793a\u590d\u5236hdfs\u6307\u5b9a\u7684\u6587\u4ef6\u5230\u6307\u5b9a\u7684hdfs\u76ee\u5f55\u4e2d\u3002\u540e\u9762\u8ddf\u4e24\u4e2a\u8def\u5f84\uff0c\u7b2c\u4e00\u4e2a\u662f\u88ab\u590d\u5236\u7684\u6587\u4ef6\uff0c\u7b2c\u4e8c\u4e2a\u662f\u76ee\u7684\u5730\u3002 [root@master ~]# hdfs dfs -ls -R /tmp drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:25 /tmp/.cloudera_health_monitoring_canary_files -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /tmp/hosts drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs [root@master ~]# hdfs dfs -ls -R /cmz [root@master ~]# hdfs dfs -cp /tmp/hosts /cmz [root@master ~]# hdfs dfs -ls -R /cmz -rw-r--r-- 3 root supergroup 231 2019-04-01 22:26 /cmz/hosts","title":"2.7 cp"},{"location":"hadoop/CDH/cdh.hdfs_shell/#28-rm","text":"\u8be5\u547d\u4ee4\u9009\u9879\u8868\u793a\u5220\u9664\u6307\u5b9a\u7684\u6587\u4ef6\u6216\u8005\u7a7a\u76ee\u5f55\u3002 [root@master ~]# hdfs dfs -ls -R /cmz -rw-r--r-- 3 root supergroup 231 2019-04-01 22:26 /cmz/hosts [root@master ~]# hdfs dfs -rm /cmz/hosts 19/04/01 22:27:15 INFO fs.TrashPolicyDefault: Moved: 'hdfs://master:8020/cmz/hosts' to trash at: hdfs://master:8020/user/root/.Trash/Current/cmz/hosts [root@master ~]# hdfs dfs -ls -R /cmz \u4e0d\u80fd\u5220\u9664\u975e\u7a7a\u76ee\u5f55","title":"2.8 rm"},{"location":"hadoop/CDH/cdh.hdfs_shell/#29-rmr","text":"\u8be5\u547d\u4ee4\u9009\u9879\u8868\u793a\u9012\u5f52\u5220\u9664\u6307\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u5b50\u76ee\u5f55\u548c\u6587\u4ef6 [root@master ~]# hdfs dfs -ls -R /cmz drwxr-xr-x - root supergroup 0 2019-04-01 22:28 /cmz/a -rw-r--r-- 3 root supergroup 231 2019-04-01 22:28 /cmz/a/hosts drwxr-xr-x - root supergroup 0 2019-04-01 22:28 /cmz/b -rw-r--r-- 3 root supergroup 231 2019-04-01 22:28 /cmz/b/hosts [root@master ~]# hdfs dfs -rmr /cmz rmr: DEPRECATED: Please use 'rm -r' instead. ^Crmr: Filesystem closed. Consider using -skipTrash option [root@master ~]# ^C [root@master ~]# hdfs dfs -rm -r /cmz 19/04/01 22:29:26 INFO fs.TrashPolicyDefault: Moved: 'hdfs://master:8020/cmz' to trash at: hdfs://master:8020/user/root/.Trash/Current/cmz1554128966724 [root@master ~]# hdfs dfs -ls -R /cmz ls: `/cmz': No such file or directory","title":"2.9 rmr"},{"location":"hadoop/CDH/cdh.hdfs_shell/#210-put","text":"\u8be5\u547d\u4ee4\u9009\u9879\u8868\u793a\u628alinux\u4e0a\u7684\u6587\u4ef6\u590d\u5236\u5230hdfs\u4e2d\uff0c [root@master ~]# hdfs dfs -ls -R /tmp drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:29 /tmp/.cloudera_health_monitoring_canary_files -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /tmp/hosts drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs [root@master ~]# hdfs dfs -put /etc/passwd /tmp/ [root@master ~]# hdfs dfs -ls -R /tmp drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:31 /tmp/.cloudera_health_monitoring_canary_files -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /tmp/hosts drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs -rw-r--r-- 3 root supergroup 1851 2019-04-01 22:31 /tmp/passwd","title":"2.10 put"},{"location":"hadoop/CDH/cdh.hdfs_shell/#211-copyfromlocal","text":"\u7c7b\u4f3cput\u4e00\u81f4\u3002","title":"2.11 copyFromLocal"},{"location":"hadoop/CDH/cdh.hdfs_shell/#212-movefromlocal","text":"\u8868\u793a\u628a\u6587\u4ef6\u4ece\u672c\u5730\u79fb\u52a8\u5230hdfs\u4e2d\u3002 [root@master ~]# echo 'test for caimemzhi' > cmz.txt [root@master ~]# ls cmz.txt cmz.txt [root@master ~]# hdfs dfs -moveFromLocal cmz.txt /tmp/ [root@master ~]# ls anaconda-ks.cfg cmz loocha mainfests [root@master ~]# hdfs dfs -ls /tmp Found 6 items drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:34 /tmp/.cloudera_health_monitoring_canary_files -rw-r--r-- 3 root supergroup 19 2019-04-01 22:34 /tmp/cmz.txt -rw-r--r-- 3 root supergroup 231 2019-04-01 22:32 /tmp/cmz_hosts -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /tmp/hosts drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs -rw-r--r-- 3 root supergroup 1851 2019-04-01 22:31 /tmp/passwd","title":"2.12 moveFromLocal"},{"location":"hadoop/CDH/cdh.hdfs_shell/#213-getmerge","text":"\u8be5\u547d\u4ee4\u9009\u9879\u7684\u542b\u4e49\u662f\u628ahdfs\u6307\u5b9a\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u5185\u5bb9\u5408\u5e76\u5230\u672c\u5730\u6587\u4ef6\u4e2d\u3002 [root@master ~]# hdfs dfs -ls /tmp Found 6 items drwxrwxrwx - hdfs supergroup 0 2019-04-01 22:34 /tmp/.cloudera_health_monitoring_canary_files -rw-r--r-- 3 root supergroup 19 2019-04-01 22:34 /tmp/cmz.txt -rw-r--r-- 3 root supergroup 231 2019-04-01 22:32 /tmp/cmz_hosts -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /tmp/hosts drwxrwxrwt - mapred hadoop 0 2019-04-01 13:33 /tmp/logs -rw-r--r-- 3 root supergroup 1851 2019-04-01 22:31 /tmp/passwd [root@master ~]# ls anaconda-ks.cfg cmz loocha mainfests [root@master ~]# hdfs dfs -getmerge /tmp/ local_text.txt [root@master ~]# cat local_text.txt test for caimemzhi 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync mail:x:8:12:mail:/var/spool/mail:/sbin/nologin ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin nobody:x:99:99:Nobody:/:/sbin/nologin systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin dbus:x:81:81:System message bus:/:/sbin/nologin polkitd:x:999:998:User for polkitd:/:/sbin/nologin sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin postfix:x:89:89::/var/spool/postfix:/sbin/nologin chrony:x:998:996::/var/lib/chrony:/sbin/nologin ntp:x:38:38::/etc/ntp:/sbin/nologin nginx:x:1000:1000::/home/nginx:/sbin/nologin mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bash cloudera-scm:x:997:993:Cloudera SCM User:/opt/cloudera-manager/cm-5.13.1/run/cloudera-scm-server/:/bin/false flume:x:996:991:Flume:/var/lib/flume-ng:/bin/false hdfs:x:995:990:Hadoop HDFS:/var/lib/hadoop-hdfs:/bin/bash solr:x:994:989:Solr:/var/lib/solr:/sbin/nologin zookeeper:x:993:988:ZooKeeper:/var/lib/zookeeper:/bin/false llama:x:992:987:Llama:/var/lib/llama:/bin/bash httpfs:x:991:986:Hadoop HTTPFS:/var/lib/hadoop-httpfs:/bin/bash mapred:x:990:985:Hadoop MapReduce:/var/lib/hadoop-mapreduce:/bin/bash sqoop:x:989:984:Sqoop:/var/lib/sqoop:/bin/false yarn:x:988:983:Hadoop Yarn:/var/lib/hadoop-yarn:/bin/bash kms:x:987:982:Hadoop KMS:/var/lib/hadoop-kms:/bin/bash hive:x:986:981:Hive:/var/lib/hive:/bin/false sqoop2:x:985:980:Sqoop 2 User:/var/lib/sqoop2:/sbin/nologin oozie:x:984:979:Oozie User:/var/lib/oozie:/bin/false kudu:x:983:978:Kudu:/var/lib/kudu:/sbin/nologin hbase:x:982:977:HBase:/var/lib/hbase:/bin/false sentry:x:981:976:Sentry:/var/lib/sentry:/sbin/nologin impala:x:980:975:Impala:/var/lib/impala:/bin/bash spark:x:979:974:Spark:/var/lib/spark:/sbin/nologin hue:x:978:973:Hue:/usr/lib/hue:/bin/false","title":"2.13 getmerge"},{"location":"hadoop/CDH/cdh.hdfs_shell/#214-cat","text":"\u8be5\u547d\u4ee4\u9009\u9879\u662f\u67e5\u770b\u6587\u4ef6\u5185\u5bb9 [root@master ~]# hdfs dfs -cat /tmp/cmz.txt test for caimemzhi","title":"2.14 cat"},{"location":"hadoop/CDH/cdh.hdfs_shell/#215-text","text":"\u8be5\u547d\u4ee4\u9009\u9879\u53ef\u4ee5\u8ba4\u4e3a\u4f5c\u7528\u548c\u7528\u6cd5\u4e0e-cat\u76f8\u540c\uff0c\u6b64\u5904\u7565\u3002","title":"2.15 text"},{"location":"hadoop/CDH/cdh.hdfs_shell/#216-mkdir","text":"mkdir \u521b\u5efa\u7a7a\u767d\u6587\u4ef6\u5939\uff0c\u540e\u9762\u8ddf\u7684\u8def\u5f84\u662f\u5728hdfs\u5c06\u8981\u521b\u5efa\u7684\u6587\u4ef6\u5939 [root@master ~]# hdfs dfs -ls / Found 2 items drwxrwxrwt - hdfs supergroup 0 2019-04-01 22:34 /tmp drwxr-xr-x - hdfs supergroup 0 2019-04-01 22:27 /user [root@master ~]# hdfs dfs -mkdir /cmz [root@master ~]# hdfs dfs -ls / Found 3 items drwxr-xr-x - root supergroup 0 2019-04-01 22:39 /cmz drwxrwxrwt - hdfs supergroup 0 2019-04-01 22:34 /tmp drwxr-xr-x - hdfs supergroup 0 2019-04-01 22:27 /user","title":"2.16 mkdir"},{"location":"hadoop/CDH/cdh.hdfs_shell/#217-setrep","text":"\u8be5\u547d\u4ee4\u9009\u9879\u662f\u4fee\u6539 \u5df2\u4fdd\u5b58\u6587\u4ef6 \u7684\u526f\u672c\u6570\u91cf\uff0c\u540e\u9762\u8ddf\u526f\u672c\u6570\u91cf\uff0c\u518d\u8ddf\u6587\u4ef6\u8def\u5f84\u3002 [root@master ~]# hdfs dfs -ls / Found 3 items drwxr-xr-x - root supergroup 0 2019-04-01 22:39 /cmz drwxrwxrwt - hdfs supergroup 0 2019-04-01 22:34 /tmp drwxr-xr-x - hdfs supergroup 0 2019-04-01 22:27 /user [root@master ~]# hdfs dfs -put /etc/hosts /cmz/ [root@master ~]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 root supergroup 231 2019-04-01 22:40 /cmz/hosts [root@master ~]# hdfs dfs -setrep 2 /cmz/hosts Replication 2 set: /cmz/hosts [root@master ~]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 2 root supergroup 231 2019-04-01 22:40 /cmz/hosts \u9ed8\u8ba4\u662f3\u4efd\u526f\u672c\uff0c\u6211\u624b\u52a8\u8bbe\u7f6e\u4e3a2\u4efd\u526f\u672c\u3002\u5373\u4f7f\u6211\u6539\u53d8\u6587\u4ef6\u5939\u7684\u526f\u672c\u6570\u662f2\uff0c\u4ee5\u540e\u518d\u65b0\u4e0a\u4f20\u5230\u8be5\u6587\u4ef6\u5939\u4e0b\u7684\u6587\u4ef6\u8fd8\u662f\u9ed8\u8ba4\u662f3\u3002 \u5982\u679c\u6700\u540e\u7684\u8def\u5f84\u8868\u793a\u6587\u4ef6\u5939\uff0c\u90a3\u4e48\u9700\u8981\u8ddf\u9009\u9879-R\uff0c\u8868\u793a\u5bf9\u6587\u4ef6\u5939\u4e2d\u7684\u6240\u6709\u6587\u4ef6\u90fd\u4fee\u6539\u526f\u672c\uff0c\u8fd8\u6709\u4e00\u4e2a\u9009\u9879\u662f-w\uff0c\u8868\u793a\u7b49\u5f85\u526f\u672c\u64cd\u4f5c\u7ed3\u675f\u624d\u9000\u51fa\u547d\u4ee4\uff0c\u5982\u56fe4-18\u6240\u793a","title":"2.17 setrep"},{"location":"hadoop/CDH/cdh.hdfs_shell/#218-touch","text":"\u8be5\u547d\u4ee4\u9009\u9879\u662f\u5728hdfs\u4e2d\u521b\u5efa\u7a7a\u767d\u6587\u4ef6\u3002 [root@master ~]# hdfs dfs -touchz /cmz/leco.txt [root@master ~]# hdfs dfs -ls /cmz Found 4 items -rw-r--r-- 2 root supergroup 7 2019-04-01 22:42 /cmz/hostname -rw-r--r-- 2 root supergroup 231 2019-04-01 22:40 /cmz/hosts -rw-r--r-- 3 root supergroup 0 2019-04-01 22:46 /cmz/leco.txt -rw-r--r-- 3 root supergroup 1851 2019-04-01 22:43 /cmz/passwd","title":"2.18 touch"},{"location":"hadoop/CDH/cdh.hdfs_shell/#219-stat","text":"\u8be5\u547d\u4ee4\u9009\u9879\u663e\u793a\u6587\u4ef6\u7684\u4e00\u4e9b\u7edf\u8ba1\u4fe1\u606f\u3002 [root@master ~]# hdfs dfs -ls /cmz Found 4 items -rw-r--r-- 2 root supergroup 7 2019-04-01 22:42 /cmz/hostname -rw-r--r-- 2 root supergroup 231 2019-04-01 22:40 /cmz/hosts -rw-r--r-- 3 root supergroup 0 2019-04-01 22:46 /cmz/leco.txt -rw-r--r-- 3 root supergroup 1851 2019-04-01 22:43 /cmz/passwd [root@master ~]# hdfs dfs -stat /cmz 2019-04-01 14:46:10 [root@master ~]# hdfs dfs -stat /cmz/hosts 2019-04-01 14:40:54 [root@master ~]# hdfs dfs -stat '%b %n %o %r %Y' /cmz/hosts 231 hosts 134217728 2 1554129654178 \u547d\u4ee4\u9009\u9879\u540e\u9762\u53ef\u4ee5\u6709\u683c\u5f0f\uff0c\u4f7f\u7528\u5f15\u53f7\u8868\u793a\u3002\u793a\u4f8b\u4e2d\u7684\u683c\u5f0f\u201c%b %n %o %r %Y\u201d\u4f9d\u6b21\u8868\u793a\u6587\u4ef6\u5927\u5c0f\u3001\u6587\u4ef6\u540d\u79f0\u3001\u5757\u5927\u5c0f\u3001\u526f\u672c\u6570\u3001\u8bbf\u95ee\u65f6\u95f4","title":"2.19 stat"},{"location":"hadoop/CDH/cdh.hdfs_shell/#220-tail","text":"\u8be5\u547d\u4ee4\u9009\u9879\u663e\u793a\u6587\u4ef6\u6700\u540e1K\u5b57\u8282\u7684\u5185\u5bb9\u3002\u4e00\u822c\u7528\u4e8e\u67e5\u770b\u65e5\u5fd7\u3002\u5982\u679c\u5e26\u6709\u9009\u9879-f\uff0c\u90a3\u4e48\u5f53\u6587\u4ef6\u5185\u5bb9\u53d8\u5316\u65f6\uff0c\u4e5f\u4f1a\u81ea\u52a8\u663e\u793a\u3002 [root@master ~]# hdfs dfs -tail /tmp/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2","title":"2.20 tail"},{"location":"hadoop/CDH/cdh.hdfs_shell/#221-chmod","text":"\u8be5\u547d\u4ee4\u9009\u9879\u7684\u4f7f\u7528\u7c7b\u4f3c\u4e8elinux\u7684shell\u4e2d\u7684chmod\u7528\u6cd5 [root@master ~]# hdfs dfs -ls /cmz/hosts -rw-r--r-- 2 root supergroup 231 2019-04-01 22:40 /cmz/hosts [root@master ~]# hdfs dfs -chmod 777 /cmz/hosts [root@master ~]# hdfs dfs -ls /cmz/hosts -rwxrwxrwx 2 root supergroup 231 2019-04-01 22:40 /cmz/hosts \u5982\u679c\u52a0\u4e0a\u9009\u9879-R\uff0c\u53ef\u4ee5\u5bf9\u6587\u4ef6\u5939\u4e2d\u7684\u6240\u6709\u6587\u4ef6\u4fee\u6539\u6743\u9650","title":"2.21 chmod"},{"location":"hadoop/CDH/cdh.hdfs_shell/#222-chown","text":"\u8be5\u547d\u4ee4\u9009\u9879\u8868\u793a\u4fee\u6539\u6587\u4ef6\u7684\u5c5e\u4e3b,\u5982\u679c\u5e26\u6709\u9009\u9879-R\uff0c\u610f\u5473\u7740\u53ef\u4ee5\u9012\u5f52\u4fee\u6539\u6587\u4ef6\u5939\u4e2d\u7684\u6240\u6709\u6587\u4ef6\u7684\u5c5e\u4e3b\u3001\u5c5e\u7ec4\u4fe1\u606f\u3002","title":"2.22 chown"},{"location":"hadoop/CDH/cdh.hdfs_shell/#223-chgrp","text":"\u8be5\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u4fee\u6539\u6587\u4ef6\u7684\u5c5e\u7ec4\uff0c\u8be5\u547d\u4ee4\u76f8\u5f53\u4e8e\u201cchown :\u5c5e\u7ec4\u201d\u7684\u7528\u6cd5.","title":"2.23 chgrp"},{"location":"hadoop/CDH/cdh.hdfs_shell/#224-appendtofile","text":"\u5411HDFS\u4e2d\u6307\u5b9a\u7684\u6587\u4ef6\u8ffd\u52a0\u5185\u5bb9\uff0c\u7531\u7528\u6237\u6307\u5b9a\u5185\u5bb9\u8ffd\u52a0\u5230\u539f\u6709\u6587\u4ef6\u7684\u5f00\u5934\u6216\u7ed3\u5c3e [root@master ~]# echo 'test for caimengzhi'>test.txt [root@master ~]# hdfs dfs -cat /cmz/leco.txt [root@master ~]# hdfs dfs -appendToFile test.txt /cmz/leco.txt [root@master ~]# hdfs dfs -cat /cmz/leco.txt test for caimengzhi","title":"2.24 appendToFile"},{"location":"hadoop/CDH/cdh.hdfs_shell/#225-help","text":"\u8be5\u547d\u4ee4\u9009\u9879\u4f1a\u663e\u793a\u5e2e\u52a9\u4fe1\u606f\uff0c\u540e\u9762\u8ddf\u4e0a\u9700\u8981\u67e5\u8be2\u7684\u547d\u4ee4\u9009\u9879\u5373\u53ef\u3002 [root@master ~]# hdfs dfs -help chown -chown [-R] [OWNER][:[GROUP]] PATH... : Changes owner and group of a file. This is similar to the shell's chown command with a few exceptions. -R modifies the files recursively. This is the only option currently supported. If only the owner or group is specified, then only the owner or group is modified. The owner and group names may only consist of digits, alphabet, and any of [-_./@a-zA-Z0-9]. The names are case sensitive. WARNING: Avoid using '.' to separate user name and group though Linux allows it. If user names have dots in them and you are using local file system, you might see surprising results since the shell command 'chown' is used for local files.","title":"2.25 help"},{"location":"hadoop/CDH/cdh.hive/","text":"Hive 1. \u4ecb\u7ecd \u00b6 \u4ec0\u4e48\u662fHive Hive\u662f\u57fa\u4e8eHadoop\u7684\u4e00\u4e2a\u6570\u636e\u4ed3\u5e93\u5de5\u5177\uff0c\u53ef\u4ee5\u5c06\u7ed3\u6784\u5316\u7684\u6570\u636e\u6587\u4ef6\u6620\u5c04\u4e3a\u4e00\u5f20\u6570\u636e\u5e93\u8868\uff0c\u5e76\u63d0\u4f9b\u7c7bSQL\u67e5\u8be2\u529f\u80fd\u3002 \u672c\u8d28\u662f\u5c06SQL\u8f6c\u6362\u4e3aMapReduce\u7a0b\u5e8f 1.2 \u7279\u70b9 \u00b6 \u53ef\u6269\u5c55 Hive\u53ef\u4ee5\u81ea\u7531\u7684\u6269\u5c55\u96c6\u7fa4\u7684\u89c4\u6a21\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u4e0d\u9700\u8981\u91cd\u542f\u670d\u52a1 \u5ef6\u5c55\u6027 Hive\u652f\u6301\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u7528\u6237\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u6765\u5b9e\u73b0\u81ea\u5df1\u7684\u51fd\u6570 \u5bb9\u9519 \u826f\u597d\u7684\u5bb9\u9519\u6027\uff0c\u8282\u70b9\u51fa\u73b0\u95ee\u9898SQL\u4ecd\u53ef\u5b8c\u6210\u6267\u884c 1.3 Hive\u4e0eHadoop\u7684\u5173\u7cfb \u00b6 1.4 Hive\u4e0e\u4f20\u7edf\u6570\u636e\u5e93\u5bf9\u6bd4 \u00b6 \u6761\u4ef6 Hive RDBMS \u67e5\u8be2\u8bed\u8a00 HQL SQL \u6570\u636e\u5b58\u50a8 HDFS Raw Device or local FileSystem \u6267\u884c MapReduce Excutor \u6267\u884c\u5ef6\u8fdf \u9ad8 \u4f4e \u5904\u7406\u6570\u636e\u89c4\u6a21 \u5927 \u5c0f \u7d22\u5f15 0.8\u7248\u672c\u540e\u52a0\u5165\u4f4d\u56fe\u7d22\u5f15 \u6709\u590d\u6742\u7684\u7d22\u5f15 2. \u5b89\u88c5 \u00b6 \u6211\u901a\u8fc7cdh\u5b89\u88c5hive,\u4ee5\u4e0b\u8bb0\u5f55cdh\u5b89\u88c5hive\u8fc7\u7a0b\u3002 \u4f60\u7684\u8981\u6839\u636e\u4f60\u7684\u60c5\u51b5\u6765\u586b\u5199\u3002\u6211\u5efa\u8bae\u521b\u5efahive\u7c7b\u4f3c\u8fd9\u6837\u7684\u5e93\u7684\u65f6\u5019\uff0c\u8981\u5355\u72ec\u521b\u5efa\u4e00\u4e2a\u7528\u6237\u7ed9hive\uff0c\u7136\u540e\u6388\u6743hive\uff0c\u522b\u76f4\u63a5\u4f7f\u7528root\u7528\u6237\uff0c\u6211\u8fd9\u91cc\u662f\u6d4b\u8bd5\uff0c\u56fe\u65b9\u4fbf\u4e86\uff0c\u7ebf\u4e0a\u6309\u7167\u6211\u5efa\u8bae\u7684\u53bb\u505a\u3002 \u4f8b\u5982\u4ee5\u4e0b\u3002 create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci; grant all privileges on hive.* to 'hive'@'%' identified by 'hive' # \u6388\u6743\u7684ip\u5730\u5740\u4e5f\u53ef\u4ee5\u9488\u5bf9\u6027\u7684\u505a\u8c03\u6574 mysql\u7684\u7528\u6237\u94fe\u63a5hive\u8fd9\u6837\u7c7b\u4f3chadoop\u5176\u4ed6\u7ec4\u4ef6\u7684\u6570\u636e\u5e93\u4e00\u5b9a\u8981\u914d\u7f6e\u5bc6\u7801\u3002\u5426\u5219\u4f1a\u5b89\u88c5\u7684\u8fc7\u7a0b\u4f1a\u62a5\u9519\u3002jdbc\u53bb\u8fde\u63a5\u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u5e26\u5bc6\u7801\u3002 \u5230\u6b64hive\u5b89\u88c5\u7ed3\u675f\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\uff0c\u53bb\u9875\u9762\u67e5\u770bhive\u7684\u60c5\u51b5\u3002 \u4ececdh\u7684\u7ba1\u7406\u540e\u53f0\u7684\u9875\u9762\u4e0a\u6765\u770b\u3002hive\u5b89\u88c5\u6210\u529f\u3002","title":"1. Hive \u4ecb\u7ecd"},{"location":"hadoop/CDH/cdh.hive/#1","text":"\u4ec0\u4e48\u662fHive Hive\u662f\u57fa\u4e8eHadoop\u7684\u4e00\u4e2a\u6570\u636e\u4ed3\u5e93\u5de5\u5177\uff0c\u53ef\u4ee5\u5c06\u7ed3\u6784\u5316\u7684\u6570\u636e\u6587\u4ef6\u6620\u5c04\u4e3a\u4e00\u5f20\u6570\u636e\u5e93\u8868\uff0c\u5e76\u63d0\u4f9b\u7c7bSQL\u67e5\u8be2\u529f\u80fd\u3002 \u672c\u8d28\u662f\u5c06SQL\u8f6c\u6362\u4e3aMapReduce\u7a0b\u5e8f","title":"1. \u4ecb\u7ecd"},{"location":"hadoop/CDH/cdh.hive/#12","text":"\u53ef\u6269\u5c55 Hive\u53ef\u4ee5\u81ea\u7531\u7684\u6269\u5c55\u96c6\u7fa4\u7684\u89c4\u6a21\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u4e0d\u9700\u8981\u91cd\u542f\u670d\u52a1 \u5ef6\u5c55\u6027 Hive\u652f\u6301\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570\uff0c\u7528\u6237\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u6765\u5b9e\u73b0\u81ea\u5df1\u7684\u51fd\u6570 \u5bb9\u9519 \u826f\u597d\u7684\u5bb9\u9519\u6027\uff0c\u8282\u70b9\u51fa\u73b0\u95ee\u9898SQL\u4ecd\u53ef\u5b8c\u6210\u6267\u884c","title":"1.2 \u7279\u70b9"},{"location":"hadoop/CDH/cdh.hive/#13-hivehadoop","text":"","title":"1.3 Hive\u4e0eHadoop\u7684\u5173\u7cfb"},{"location":"hadoop/CDH/cdh.hive/#14-hive","text":"\u6761\u4ef6 Hive RDBMS \u67e5\u8be2\u8bed\u8a00 HQL SQL \u6570\u636e\u5b58\u50a8 HDFS Raw Device or local FileSystem \u6267\u884c MapReduce Excutor \u6267\u884c\u5ef6\u8fdf \u9ad8 \u4f4e \u5904\u7406\u6570\u636e\u89c4\u6a21 \u5927 \u5c0f \u7d22\u5f15 0.8\u7248\u672c\u540e\u52a0\u5165\u4f4d\u56fe\u7d22\u5f15 \u6709\u590d\u6742\u7684\u7d22\u5f15","title":"1.4 Hive\u4e0e\u4f20\u7edf\u6570\u636e\u5e93\u5bf9\u6bd4"},{"location":"hadoop/CDH/cdh.hive/#2","text":"\u6211\u901a\u8fc7cdh\u5b89\u88c5hive,\u4ee5\u4e0b\u8bb0\u5f55cdh\u5b89\u88c5hive\u8fc7\u7a0b\u3002 \u4f60\u7684\u8981\u6839\u636e\u4f60\u7684\u60c5\u51b5\u6765\u586b\u5199\u3002\u6211\u5efa\u8bae\u521b\u5efahive\u7c7b\u4f3c\u8fd9\u6837\u7684\u5e93\u7684\u65f6\u5019\uff0c\u8981\u5355\u72ec\u521b\u5efa\u4e00\u4e2a\u7528\u6237\u7ed9hive\uff0c\u7136\u540e\u6388\u6743hive\uff0c\u522b\u76f4\u63a5\u4f7f\u7528root\u7528\u6237\uff0c\u6211\u8fd9\u91cc\u662f\u6d4b\u8bd5\uff0c\u56fe\u65b9\u4fbf\u4e86\uff0c\u7ebf\u4e0a\u6309\u7167\u6211\u5efa\u8bae\u7684\u53bb\u505a\u3002 \u4f8b\u5982\u4ee5\u4e0b\u3002 create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci; grant all privileges on hive.* to 'hive'@'%' identified by 'hive' # \u6388\u6743\u7684ip\u5730\u5740\u4e5f\u53ef\u4ee5\u9488\u5bf9\u6027\u7684\u505a\u8c03\u6574 mysql\u7684\u7528\u6237\u94fe\u63a5hive\u8fd9\u6837\u7c7b\u4f3chadoop\u5176\u4ed6\u7ec4\u4ef6\u7684\u6570\u636e\u5e93\u4e00\u5b9a\u8981\u914d\u7f6e\u5bc6\u7801\u3002\u5426\u5219\u4f1a\u5b89\u88c5\u7684\u8fc7\u7a0b\u4f1a\u62a5\u9519\u3002jdbc\u53bb\u8fde\u63a5\u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u5e26\u5bc6\u7801\u3002 \u5230\u6b64hive\u5b89\u88c5\u7ed3\u675f\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\uff0c\u53bb\u9875\u9762\u67e5\u770bhive\u7684\u60c5\u51b5\u3002 \u4ececdh\u7684\u7ba1\u7406\u540e\u53f0\u7684\u9875\u9762\u4e0a\u6765\u770b\u3002hive\u5b89\u88c5\u6210\u529f\u3002","title":"2. \u5b89\u88c5"},{"location":"hadoop/CDH/cdh.index/","text":"Hadoop 1. \u4ecb\u7ecd \u00b6 1.1 \u4ecb\u7ecd \u00b6 Hadoop\u662f\u4e00\u4e2a\u7531Apache\u57fa\u91d1\u4f1a\u6240\u5f00\u53d1\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u57fa\u7840\u67b6\u6784\u3002 \u7528\u6237\u53ef\u4ee5\u5728\u4e0d\u4e86\u89e3\u5206\u5e03\u5f0f\u5e95\u5c42\u7ec6\u8282\u7684\u60c5\u51b5\u4e0b\uff0c\u5f00\u53d1\u5206\u5e03\u5f0f\u7a0b\u5e8f\u3002\u5145\u5206\u5229\u7528\u96c6\u7fa4\u5a01\u529b\u8fdb\u884c\u9ad8\u901f\u8fd0\u7b97\u548c\u5b58\u50a8\u3002 Hadoop\u5b9e\u73b0\u4e86\u4e00\u4e2a\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff08Hadoop Distributed File System\uff09\uff0c\u7b80\u79f0HDFS\u3002HDFS\u6709\u9ad8\u5bb9\u9519\u6027\u7684\u7279\u70b9\uff0c\u5e76\u4e14\u8bbe\u8ba1\u7528\u6765\u90e8\u7f72\u5728\u4f4e\u5ec9\u7684\uff08low-cost\uff09\u786c\u4ef6\u4e0a\uff1b\u800c\u4e14\u5b83\u63d0\u4f9b\u9ad8\u541e\u5410\u91cf\uff08high throughput\uff09\u6765\u8bbf\u95ee\u5e94\u7528\u7a0b\u5e8f\u7684\u6570\u636e\uff0c\u9002\u5408\u90a3\u4e9b\u6709\u7740\u8d85\u5927\u6570\u636e\u96c6\uff08large data set\uff09\u7684\u5e94\u7528\u7a0b\u5e8f\u3002HDFS\u653e\u5bbd\u4e86\uff08relax\uff09POSIX\u7684\u8981\u6c42\uff0c\u53ef\u4ee5\u4ee5\u6d41\u7684\u5f62\u5f0f\u8bbf\u95ee\uff08streaming access\uff09\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u6570\u636e\u3002 Hadoop\u7684\u6846\u67b6\u6700\u6838\u5fc3\u7684\u8bbe\u8ba1\u5c31\u662f\uff1aHDFS\u548cMapReduce\u3002HDFS\u4e3a\u6d77\u91cf\u7684\u6570\u636e\u63d0\u4f9b\u4e86\u5b58\u50a8\uff0c\u5219MapReduce\u4e3a\u6d77\u91cf\u7684\u6570\u636e\u63d0\u4f9b\u4e86\u8ba1\u7b97\u3002 \u4ee5\u4e0a\u6458\u81ea\u767e\u5ea6\u767e\u79d1 1.2 \u5bf9\u6bd4 \u00b6 \u90e8\u7f72hadoop\u96c6\u7fa4\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u624b\u52a8\u90e8\u7f72\u5404\u4e2a\u7ec4\u4ef6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u8f6f\u4ef6\u90e8\u7f72hadoop\u7ec4\u4ef6\uff0c\u8fd9\u6837\u7684\u7b2c\u4e09\u65b9\u90e8\u7f72hadoop\u7684\u8f6f\u4ef6\uff0c\u56fd\u5185\u4f7f\u7528\u6700\u591a\u7684clouder\u516c\u53f8\u7684cdh\u8f6f\u4ef6\u3002 apache hadoop\u548ccdh hadoop\u5bf9\u6bd4 cdh\u6bd4\u539f\u751f\u7684Apache\u53d1\u884c\u7248\u672c\u5305\u542b\u4e86\u66f4\u591a\u7684\u8865\u4e01\uff0c\u7528\u4e8e\u589e\u5f3a\u7a33\u5b9a\u6027\uff0c\u6539\u5584\u529f\u80fd\uff0c\u6709\u65f6\u5019\u8fd8\u589e\u52a0\u529f\u80fd\u7279\u6027 cdh\u7248\u672c\u662f\u7531cloudera\u516c\u53f8\u5f00\u6e90\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528cm\u5e73\u53f0\u8fdb\u884c\u7ba1\u7406\uff0c\u6bd4\u539f\u751f\u7684Apache\u7248\u672c\u5b89\u88c5\u3001\u7ef4\u62a4\u66f4\u52a0\u7701\u529b \u4f46\u662f\u5bf9\u6280\u672f\u4eba\u5458\u7684\u8981\u6c42\u66f4\u9ad8\uff0c\u5fc5\u987b\u5bf9\u539f\u751fapache\u7248\u672c\u7684\u5404\u4e2a\u7ec4\u4ef6\u7406\u89e3\u6e05\u6670 \u5728cm\u7ba1\u7406\u5e73\u53f0\u4e2d\uff0ccdh\u7684parcel\u5305\u4e0d\u5305\u542b\u67d0\u4e9b\u7ec4\u4ef6\uff0c\u9700\u8981\u81ea\u5df1\u4e0b\u8f7d\u5bf9\u5e94\u7684parcel\u5305\uff0c\u6bd4\u5982\u8bf4kafka \u5bf9hdfs\u90e8\u7f72\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u78c1\u76d8\u8fdb\u884clvm\u5377\u8f74\u6216\u8005\u662f\u78c1\u76d8\u76ee\u5f55\u7edf\u4e00\uff0c\u5bf9\u4e8e\u591a\u53f0\u673a\u5668\uff0c\u5426\u5219\u4e4b\u540e\u7ef4\u62a4\u6210\u672c\u9ad8- 1.3 CDH\u80fd\u89e3\u51b3\u54ea\u4e9b\u95ee\u9898 \u00b6 1000\u53f0\u670d\u52a1\u5668\u7684\u96c6\u7fa4\uff0c\u6700\u5c11\u8981\u82b1\u8d39\u591a\u957f\u65f6\u95f4\u6765\u642d\u5efa\u597dHadoop\u96c6\u7fa4\uff0c\u5305\u62ecHive\u3001Hbase\u3001Flume\u3001Kafka\u3001Spark\u7b49\u7b49 \u53ea\u7ed9\u4f60\u4e00\u5929\u65f6\u95f4\uff0c\u5b8c\u6210\u4ee5\u4e0a\u5de5\u4f5c\uff1f \u5bf9\u4e8e\u4ee5\u4e0a\u96c6\u7fa4\u8fdb\u884chadoop\u7248\u672c\u5347\u7ea7\uff0c\u4f60\u4f1a\u9009\u62e9\u4ec0\u4e48\u5347\u7ea7\u65b9\u6848\uff0c\u6700\u5c11\u8981\u82b1\u8d39\u591a\u957f\u65f6\u95f4\uff1f \u65b0\u7248\u672c\u7684Hadoop\uff0c\u4e0eHive\u3001Hbase\u3001Flume\u3001Kafka\u3001Spark\u7b49\u7b49\u517c\u5bb9\uff1f 2. CDH \u4ecb\u7ecd \u00b6 2.1 \u4ecb\u7ecd \u00b6 hadoop\u662f\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u6240\u4ee5\u5f88\u591a\u516c\u53f8\u5728\u8fd9\u4e2a\u57fa\u7840\u8fdb\u884c\u5546\u4e1a\u5316\uff0cCloudera\u5bf9hadoop\u505a\u4e86\u76f8\u5e94\u7684\u6539\u53d8\u3002 CDH (Cloudera's Distribution, including Apache Hadoop)\uff0c\u662fHadoop\u4f17\u591a\u5206\u652f\u4e2d\u7684\u4e00\u79cd\uff0c\u7531Cloudera\u7ef4\u62a4\uff0c\u57fa\u4e8e\u7a33\u5b9a\u7248\u672c\u7684Apache Hadoop\u6784\u5efa\uff0c\u5e76\u96c6\u6210\u4e86\u5f88\u591a\u8865\u4e01\uff0c\u53ef\u76f4\u63a5\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u3002 Cloudera\u516c\u53f8\u7684\u53d1\u884c\u7248\uff0c\u6211\u4eec\u5c06\u8be5\u7248\u672c\u79f0\u4e3aCDH(Cloudera Distribution Hadoop)\u3002\u622a\u81f3\u76ee\u524d\u4e3a\u6b62\uff0cCDH\u5171\u67095\u4e2a\u7248\u672c\uff0c\u5176\u4e2d\uff0c\u524d\u4e24\u4e2a\u5df2\u7ecf\u4e0d\u518d\u66f4\u65b0\uff0c\u6700\u8fd1\u7684\u4e24\u4e2a\uff0c\u5206\u522b\u662fCDH4\uff0c\u5728Apache Hadoop 2.0.0\u7248\u672c\u57fa\u7840\u4e0a\u6f14\u5316\u800c\u6765\u7684\uff0cCDH5\uff0c\u5b83\u4eec\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u4fbf\u4f1a\u66f4\u65b0\u4e00\u6b21\u3002 Cloudera Manager\u5219\u662f\u4e3a\u4e86\u4fbf\u4e8e\u5728\u96c6\u7fa4\u4e2d\u8fdb\u884cHadoop\u7b49\u5927\u6570\u636e\u5904\u7406\u76f8\u5173\u7684\u670d\u52a1\u5b89\u88c5\u548c\u76d1\u63a7\u7ba1\u7406\u7684\u7ec4\u4ef6\uff0c\u5bf9\u96c6\u7fa4\u4e2d\u4e3b\u673a\u3001Hadoop\u3001Hive\u3001Spark\u7b49\u670d\u52a1\u7684\u5b89\u88c5\u914d\u7f6e\u7ba1\u7406\u505a\u4e86\u6781\u5927\u7b80\u5316\u3002 Cloudera's Distribution, including Apache Hadoop \u662fHadoop\u4f17\u591a\u5206\u652f\u4e2d\u7684\u4e00\u79cd\uff0c\u7531Cloudera\u7ef4\u62a4\uff0c\u57fa\u4e8e\u7a33\u5b9a\u7248\u672c\u7684Apache Hadoop\u6784\u5efa \u63d0\u4f9b\u4e86Hadoop\u7684\u6838\u5fc3 \u53ef\u6269\u5c55\u5b58\u50a8 \u5206\u5e03\u5f0f\u8ba1\u7b97 \u57fa\u4e8eWeb\u7684\u7528\u6237\u754c\u9762\u652f\u6301\u5927\u591a\u6570Hadoop\u7ec4\u4ef6\uff0c\u5305\u62ecHDFS\u3001MapReduce\u3001Hive\u3001Pig\u3001 Hbase\u3001Zookeeper\u3001Sqoop,\u7b80\u5316\u4e86\u5927\u6570\u636e\u5e73\u53f0\u7684\u5b89\u88c5\u3001\u4f7f\u7528\u96be\u5ea6\u3002 2.2 \u4f18\u70b9 \u00b6 \u7248\u672c\u5212\u5206\u6e05\u6670 \u7248\u672c\u66f4\u65b0\u901f\u5ea6\u5feb \u652f\u6301Kerberos\u5b89\u5168\u8ba4\u8bc1 \u6587\u6863\u6e05\u6670 \u652f\u6301\u591a\u79cd\u5b89\u88c5\u65b9\u5f0f\uff08Cloudera Manager\u65b9\u5f0f 2.3 \u5b89\u88c5\u65b9\u5f0f \u00b6 Cloudera Manager Yum Rpm Tarball 2.4 \u53c2\u8003\u6587\u6863 \u00b6 CDH \u53c2\u8003\u6587\u6863","title":"1. CDH \u4ecb\u7ecd"},{"location":"hadoop/CDH/cdh.index/#1","text":"","title":"1. \u4ecb\u7ecd"},{"location":"hadoop/CDH/cdh.index/#11","text":"Hadoop\u662f\u4e00\u4e2a\u7531Apache\u57fa\u91d1\u4f1a\u6240\u5f00\u53d1\u7684\u5206\u5e03\u5f0f\u7cfb\u7edf\u57fa\u7840\u67b6\u6784\u3002 \u7528\u6237\u53ef\u4ee5\u5728\u4e0d\u4e86\u89e3\u5206\u5e03\u5f0f\u5e95\u5c42\u7ec6\u8282\u7684\u60c5\u51b5\u4e0b\uff0c\u5f00\u53d1\u5206\u5e03\u5f0f\u7a0b\u5e8f\u3002\u5145\u5206\u5229\u7528\u96c6\u7fa4\u5a01\u529b\u8fdb\u884c\u9ad8\u901f\u8fd0\u7b97\u548c\u5b58\u50a8\u3002 Hadoop\u5b9e\u73b0\u4e86\u4e00\u4e2a\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff08Hadoop Distributed File System\uff09\uff0c\u7b80\u79f0HDFS\u3002HDFS\u6709\u9ad8\u5bb9\u9519\u6027\u7684\u7279\u70b9\uff0c\u5e76\u4e14\u8bbe\u8ba1\u7528\u6765\u90e8\u7f72\u5728\u4f4e\u5ec9\u7684\uff08low-cost\uff09\u786c\u4ef6\u4e0a\uff1b\u800c\u4e14\u5b83\u63d0\u4f9b\u9ad8\u541e\u5410\u91cf\uff08high throughput\uff09\u6765\u8bbf\u95ee\u5e94\u7528\u7a0b\u5e8f\u7684\u6570\u636e\uff0c\u9002\u5408\u90a3\u4e9b\u6709\u7740\u8d85\u5927\u6570\u636e\u96c6\uff08large data set\uff09\u7684\u5e94\u7528\u7a0b\u5e8f\u3002HDFS\u653e\u5bbd\u4e86\uff08relax\uff09POSIX\u7684\u8981\u6c42\uff0c\u53ef\u4ee5\u4ee5\u6d41\u7684\u5f62\u5f0f\u8bbf\u95ee\uff08streaming access\uff09\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u6570\u636e\u3002 Hadoop\u7684\u6846\u67b6\u6700\u6838\u5fc3\u7684\u8bbe\u8ba1\u5c31\u662f\uff1aHDFS\u548cMapReduce\u3002HDFS\u4e3a\u6d77\u91cf\u7684\u6570\u636e\u63d0\u4f9b\u4e86\u5b58\u50a8\uff0c\u5219MapReduce\u4e3a\u6d77\u91cf\u7684\u6570\u636e\u63d0\u4f9b\u4e86\u8ba1\u7b97\u3002 \u4ee5\u4e0a\u6458\u81ea\u767e\u5ea6\u767e\u79d1","title":"1.1 \u4ecb\u7ecd"},{"location":"hadoop/CDH/cdh.index/#12","text":"\u90e8\u7f72hadoop\u96c6\u7fa4\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u624b\u52a8\u90e8\u7f72\u5404\u4e2a\u7ec4\u4ef6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u8f6f\u4ef6\u90e8\u7f72hadoop\u7ec4\u4ef6\uff0c\u8fd9\u6837\u7684\u7b2c\u4e09\u65b9\u90e8\u7f72hadoop\u7684\u8f6f\u4ef6\uff0c\u56fd\u5185\u4f7f\u7528\u6700\u591a\u7684clouder\u516c\u53f8\u7684cdh\u8f6f\u4ef6\u3002 apache hadoop\u548ccdh hadoop\u5bf9\u6bd4 cdh\u6bd4\u539f\u751f\u7684Apache\u53d1\u884c\u7248\u672c\u5305\u542b\u4e86\u66f4\u591a\u7684\u8865\u4e01\uff0c\u7528\u4e8e\u589e\u5f3a\u7a33\u5b9a\u6027\uff0c\u6539\u5584\u529f\u80fd\uff0c\u6709\u65f6\u5019\u8fd8\u589e\u52a0\u529f\u80fd\u7279\u6027 cdh\u7248\u672c\u662f\u7531cloudera\u516c\u53f8\u5f00\u6e90\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528cm\u5e73\u53f0\u8fdb\u884c\u7ba1\u7406\uff0c\u6bd4\u539f\u751f\u7684Apache\u7248\u672c\u5b89\u88c5\u3001\u7ef4\u62a4\u66f4\u52a0\u7701\u529b \u4f46\u662f\u5bf9\u6280\u672f\u4eba\u5458\u7684\u8981\u6c42\u66f4\u9ad8\uff0c\u5fc5\u987b\u5bf9\u539f\u751fapache\u7248\u672c\u7684\u5404\u4e2a\u7ec4\u4ef6\u7406\u89e3\u6e05\u6670 \u5728cm\u7ba1\u7406\u5e73\u53f0\u4e2d\uff0ccdh\u7684parcel\u5305\u4e0d\u5305\u542b\u67d0\u4e9b\u7ec4\u4ef6\uff0c\u9700\u8981\u81ea\u5df1\u4e0b\u8f7d\u5bf9\u5e94\u7684parcel\u5305\uff0c\u6bd4\u5982\u8bf4kafka \u5bf9hdfs\u90e8\u7f72\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u78c1\u76d8\u8fdb\u884clvm\u5377\u8f74\u6216\u8005\u662f\u78c1\u76d8\u76ee\u5f55\u7edf\u4e00\uff0c\u5bf9\u4e8e\u591a\u53f0\u673a\u5668\uff0c\u5426\u5219\u4e4b\u540e\u7ef4\u62a4\u6210\u672c\u9ad8-","title":"1.2 \u5bf9\u6bd4"},{"location":"hadoop/CDH/cdh.index/#13-cdh","text":"1000\u53f0\u670d\u52a1\u5668\u7684\u96c6\u7fa4\uff0c\u6700\u5c11\u8981\u82b1\u8d39\u591a\u957f\u65f6\u95f4\u6765\u642d\u5efa\u597dHadoop\u96c6\u7fa4\uff0c\u5305\u62ecHive\u3001Hbase\u3001Flume\u3001Kafka\u3001Spark\u7b49\u7b49 \u53ea\u7ed9\u4f60\u4e00\u5929\u65f6\u95f4\uff0c\u5b8c\u6210\u4ee5\u4e0a\u5de5\u4f5c\uff1f \u5bf9\u4e8e\u4ee5\u4e0a\u96c6\u7fa4\u8fdb\u884chadoop\u7248\u672c\u5347\u7ea7\uff0c\u4f60\u4f1a\u9009\u62e9\u4ec0\u4e48\u5347\u7ea7\u65b9\u6848\uff0c\u6700\u5c11\u8981\u82b1\u8d39\u591a\u957f\u65f6\u95f4\uff1f \u65b0\u7248\u672c\u7684Hadoop\uff0c\u4e0eHive\u3001Hbase\u3001Flume\u3001Kafka\u3001Spark\u7b49\u7b49\u517c\u5bb9\uff1f","title":"1.3 CDH\u80fd\u89e3\u51b3\u54ea\u4e9b\u95ee\u9898"},{"location":"hadoop/CDH/cdh.index/#2-cdh","text":"","title":"2. CDH \u4ecb\u7ecd"},{"location":"hadoop/CDH/cdh.index/#21","text":"hadoop\u662f\u4e00\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u6240\u4ee5\u5f88\u591a\u516c\u53f8\u5728\u8fd9\u4e2a\u57fa\u7840\u8fdb\u884c\u5546\u4e1a\u5316\uff0cCloudera\u5bf9hadoop\u505a\u4e86\u76f8\u5e94\u7684\u6539\u53d8\u3002 CDH (Cloudera's Distribution, including Apache Hadoop)\uff0c\u662fHadoop\u4f17\u591a\u5206\u652f\u4e2d\u7684\u4e00\u79cd\uff0c\u7531Cloudera\u7ef4\u62a4\uff0c\u57fa\u4e8e\u7a33\u5b9a\u7248\u672c\u7684Apache Hadoop\u6784\u5efa\uff0c\u5e76\u96c6\u6210\u4e86\u5f88\u591a\u8865\u4e01\uff0c\u53ef\u76f4\u63a5\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u3002 Cloudera\u516c\u53f8\u7684\u53d1\u884c\u7248\uff0c\u6211\u4eec\u5c06\u8be5\u7248\u672c\u79f0\u4e3aCDH(Cloudera Distribution Hadoop)\u3002\u622a\u81f3\u76ee\u524d\u4e3a\u6b62\uff0cCDH\u5171\u67095\u4e2a\u7248\u672c\uff0c\u5176\u4e2d\uff0c\u524d\u4e24\u4e2a\u5df2\u7ecf\u4e0d\u518d\u66f4\u65b0\uff0c\u6700\u8fd1\u7684\u4e24\u4e2a\uff0c\u5206\u522b\u662fCDH4\uff0c\u5728Apache Hadoop 2.0.0\u7248\u672c\u57fa\u7840\u4e0a\u6f14\u5316\u800c\u6765\u7684\uff0cCDH5\uff0c\u5b83\u4eec\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u4fbf\u4f1a\u66f4\u65b0\u4e00\u6b21\u3002 Cloudera Manager\u5219\u662f\u4e3a\u4e86\u4fbf\u4e8e\u5728\u96c6\u7fa4\u4e2d\u8fdb\u884cHadoop\u7b49\u5927\u6570\u636e\u5904\u7406\u76f8\u5173\u7684\u670d\u52a1\u5b89\u88c5\u548c\u76d1\u63a7\u7ba1\u7406\u7684\u7ec4\u4ef6\uff0c\u5bf9\u96c6\u7fa4\u4e2d\u4e3b\u673a\u3001Hadoop\u3001Hive\u3001Spark\u7b49\u670d\u52a1\u7684\u5b89\u88c5\u914d\u7f6e\u7ba1\u7406\u505a\u4e86\u6781\u5927\u7b80\u5316\u3002 Cloudera's Distribution, including Apache Hadoop \u662fHadoop\u4f17\u591a\u5206\u652f\u4e2d\u7684\u4e00\u79cd\uff0c\u7531Cloudera\u7ef4\u62a4\uff0c\u57fa\u4e8e\u7a33\u5b9a\u7248\u672c\u7684Apache Hadoop\u6784\u5efa \u63d0\u4f9b\u4e86Hadoop\u7684\u6838\u5fc3 \u53ef\u6269\u5c55\u5b58\u50a8 \u5206\u5e03\u5f0f\u8ba1\u7b97 \u57fa\u4e8eWeb\u7684\u7528\u6237\u754c\u9762\u652f\u6301\u5927\u591a\u6570Hadoop\u7ec4\u4ef6\uff0c\u5305\u62ecHDFS\u3001MapReduce\u3001Hive\u3001Pig\u3001 Hbase\u3001Zookeeper\u3001Sqoop,\u7b80\u5316\u4e86\u5927\u6570\u636e\u5e73\u53f0\u7684\u5b89\u88c5\u3001\u4f7f\u7528\u96be\u5ea6\u3002","title":"2.1 \u4ecb\u7ecd"},{"location":"hadoop/CDH/cdh.index/#22","text":"\u7248\u672c\u5212\u5206\u6e05\u6670 \u7248\u672c\u66f4\u65b0\u901f\u5ea6\u5feb \u652f\u6301Kerberos\u5b89\u5168\u8ba4\u8bc1 \u6587\u6863\u6e05\u6670 \u652f\u6301\u591a\u79cd\u5b89\u88c5\u65b9\u5f0f\uff08Cloudera Manager\u65b9\u5f0f","title":"2.2 \u4f18\u70b9"},{"location":"hadoop/CDH/cdh.index/#23","text":"Cloudera Manager Yum Rpm Tarball","title":"2.3 \u5b89\u88c5\u65b9\u5f0f"},{"location":"hadoop/CDH/cdh.index/#24","text":"CDH \u53c2\u8003\u6587\u6863","title":"2.4 \u53c2\u8003\u6587\u6863"},{"location":"hadoop/CDH/cdh.namenode_ha/","text":"NameNode HA 1. \u4ecb\u7ecd \u00b6 hdfs\u7684namenode\u4f5c\u4e3a\u96c6\u7fa4\u4e2d\u6700\u91cd\u8981\u7684\u6570\u636e\u4e2d\u5fc3'\u5934\u8111' \u9ad8\u53ef\u7528\u662f\u5fc5\u987b\u7684\u3002\u6240\u6709\u673a\u5668\u64cd\u4f5chdfs\u7684\u65f6\u5019\uff0c\u90fd\u662f\u901a\u8fc7hdfs\u7684namenode\u3002\u5355\u8282\u70b9\u7684NameNode\u662f\u975e\u5e38\u53ef\u6015\uff0c\u4e00\u65e6\u8fd9\u4e2a\u8282\u70b9\u6302\u4e86\u4ee5\u540e\uff0c\u6574\u4e2a\u96c6\u7fa4\u7684hdfs\u90fd\u4e0d\u53ef\u7528\uff0c\u4ee5\u4e0b\u662f\u8bb0\u5f55cdh\u5728\u914d\u7f6enamenode\u7684HA\uff0c\u8fc7\u7a0b\u3002 \u9996\u5148\u3002\u65b0\u642d\u5efa\u7684\u673a\u5668\u4e0a\u6ca1\u6709\u6570\u636e\u3002\u6211\u6574\u4e00\u4e9b\u6570\u636e\u4e0a\u53bb [root@master ~]# su - hdfs Last login: Mon Apr 1 11:14:33 CST 2019 on pts/0 [hdfs@master ~]$ hdfs dfs -mkdir /cmz [hdfs@master ~]$ hdfs dfs -ls / Found 3 items drwxr-xr-x - hdfs supergroup 0 2019-04-01 15:08 /cmz drwxrwxrwt - hdfs supergroup 0 2019-04-01 13:34 /tmp drwxr-xr-x - hdfs supergroup 0 2019-04-01 13:33 /user [hdfs@master ~]$ hdfs dfs -put /etc/hosts /cmz/ [hdfs@master ~]$ hdfs dfs -ls /cmz/ Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [hdfs@master ~]$ hdfs dfs -text /cmz/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 hdfs\u4e0a\u521b\u5efa\u4e86\u4e00\u4e2acmz\u6587\u4ef6\u5939\uff0c\u91cc\u9762\u4e0a\u4f20\u4e86hosts\u6587\u4ef6\u3002 2. \u914d\u7f6eHA \u00b6 2.1 \u914d\u7f6e\u6b65\u9aa4 \u00b6 \u4ee5\u4e0a\u51fa\u73b0namenode\u683c\u5f0f\u5316\u5931\u8d25\uff0c\u662f\u56e0\u4e3a\u4e4b\u524d\u6709\u6570\u636e\uff0c\u4e0d\u7528\u7ba1\u3002\u7ee7\u7eed\u3002 \u5230\u6b64\u4e3a\u6b62\uff0cnamenode ha\u914d\u7f6e\u6210\u529f\u3002 namenode ha\uff0chdfs\u7684\u6570\u636e\u8fd8\u5728\u3002 2.2 \u67e5\u770bha \u00b6 \u53ef\u4ee5\u770b\u51fahdfs\u7684namenode\u914d\u7f6e\u6210\u529f\u4e86\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u6d4b\u8bd5namenode\u7684ha\u3002 2.3 \u6d4b\u8bd5 \u00b6 \u5728\u6d4b\u8bd5\u4e4b\u524d\u3002\u6211\u4eec\u4e0b\u4fee\u6539hdfs\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u4fdd\u8bc1\u5728\u7cfb\u7edf\u4e4b\u5185hdfs\u53ef\u4ee5\u901a\u8fc7\u975ehdfs\u7528\u6237\u53bb\u64cd\u4f5chdfs\u3002 2.3.1 \u81ea\u52a8\u5207\u6362 \u00b6 \u505c\u6b62master\u3002\u6302\u8d77master\u5bf9\u5e94\u7684\u865a\u62df\u673a\u4e4b\u524d\u3002 [hdfs@master ~]$ hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@slave1 lib]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@slave2 src]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts \u505c\u6b62master\u3002\u6302\u8d77master\u5bf9\u5e94\u7684\u865a\u62df\u673a\u4e4b\u540e\u3002 [root@slave1 lib]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@slave2 src]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts cd \u8fc7\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u5907namenode\u53d1\u73b0\u4e3bnamenode\u6302\u4e86\u4ee5\u540e\uff0c\u63a5\u7ba1\u4e86\uff0c\u5176\u4ed6\u7684agent\u7684\u7ba1\u7406\u3002 \u5728master\u6709\u95ee\u9898\u4e4b\u540e\uff0c\u5907namenode\u63a5\u7ba1\u4e3bnamenode\u4e4b\u524d\uff0chdfs\u670d\u52a1\u662f\u4e0d\u53ef\u7528\u7684\u3002\u6b64\u65f6\u64cd\u4f5chdfs\u4f1a\u62a5\u9519\u3002\u6211\u865a\u62df\u673a\u53cd\u5e94\u65f6\u95f4\u5927\u698230\u4e0d\u5230\u3002\u5c31\u5207\u6362\u8fc7\u6765\u4e86\u3002 \u624b\u52a8\u6062\u590d\u4e3bnamenode\u673a\u5668\u3002 \u518d\u6b21\u6d4b\u8bd5hdfs [root@master ~]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@master ~]# hdfs dfs -text /cmz/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 [root@slave1 lib]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@slave1 lib]# hdfs dfs -text /cmz/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 [root@slave2 src]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@slave2 src]# hdfs dfs -text /cmz/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 \u4ece\u4ee5\u4e0a\u53ef\u4ee5\u770b\u51fa\u6062\u590d\u4e86\u4e4b\u524d\u6709\u95ee\u9898\u7684\u4e3bnamenode\u4e4b\u540e\u3002cdh\u53d1\u73b0\u7cfb\u7edf\u4e2d\u5df2\u7ecf\u6709\u4e00\u4e2a\u4e3b\u7684namenode[\u4e4b\u524d\u7684\u5907namenode]\u540e\uff0c\u5c06\u539f\u672c\u4e3b\u7684namenode\u964d\u4f4e\u8eab\u4efd\uff0c\u5316\u8eab\u4e3a\u5907namenode\u4e86\u3002 2.3.2 \u624b\u52a8\u5207\u6362 \u00b6 \u6a21\u62df\u4e86namenode\u7684ha\u4e4b\u540e\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u624b\u52a8\u5207\u6362namenode\u3002 \u67e5\u770b\u5207\u6362\u540e\u7684\u60c5\u51b5 \u53ef\u89c1\u624b\u52a8\u5207\u6362OK\u3002 3. \u7981\u7528HA \u00b6 \u82e5\u662f\u6709\u4e2anamenode\u5b9e\u5728\u6709\u95ee\u9898\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u624b\u52a8\u5378\u8f7dnamenode ha\uff0c\u4ee5\u4e0b\u662f\u8bb0\u5f55\u6b65\u9aa4 \u53ef\u4ee5\u770b\u51fa\uff0cnamenode\u53bb\u9664\u4e86ha\u4e86\u3002\u6d4b\u8bd5\u5982\u4e0b [root@master ~]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@slave1 lib]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@slave2 src]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts \u622a\u6b62\u5230\u76ee\u524d\u4e3a\u6b62\uff0cNameNode\u7684HA\uff0c\u542f\u7528\u548c\u7981\u7528\uff0c\u6d4b\u8bd5OK\u3002","title":"3. NameNode HA"},{"location":"hadoop/CDH/cdh.namenode_ha/#1","text":"hdfs\u7684namenode\u4f5c\u4e3a\u96c6\u7fa4\u4e2d\u6700\u91cd\u8981\u7684\u6570\u636e\u4e2d\u5fc3'\u5934\u8111' \u9ad8\u53ef\u7528\u662f\u5fc5\u987b\u7684\u3002\u6240\u6709\u673a\u5668\u64cd\u4f5chdfs\u7684\u65f6\u5019\uff0c\u90fd\u662f\u901a\u8fc7hdfs\u7684namenode\u3002\u5355\u8282\u70b9\u7684NameNode\u662f\u975e\u5e38\u53ef\u6015\uff0c\u4e00\u65e6\u8fd9\u4e2a\u8282\u70b9\u6302\u4e86\u4ee5\u540e\uff0c\u6574\u4e2a\u96c6\u7fa4\u7684hdfs\u90fd\u4e0d\u53ef\u7528\uff0c\u4ee5\u4e0b\u662f\u8bb0\u5f55cdh\u5728\u914d\u7f6enamenode\u7684HA\uff0c\u8fc7\u7a0b\u3002 \u9996\u5148\u3002\u65b0\u642d\u5efa\u7684\u673a\u5668\u4e0a\u6ca1\u6709\u6570\u636e\u3002\u6211\u6574\u4e00\u4e9b\u6570\u636e\u4e0a\u53bb [root@master ~]# su - hdfs Last login: Mon Apr 1 11:14:33 CST 2019 on pts/0 [hdfs@master ~]$ hdfs dfs -mkdir /cmz [hdfs@master ~]$ hdfs dfs -ls / Found 3 items drwxr-xr-x - hdfs supergroup 0 2019-04-01 15:08 /cmz drwxrwxrwt - hdfs supergroup 0 2019-04-01 13:34 /tmp drwxr-xr-x - hdfs supergroup 0 2019-04-01 13:33 /user [hdfs@master ~]$ hdfs dfs -put /etc/hosts /cmz/ [hdfs@master ~]$ hdfs dfs -ls /cmz/ Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [hdfs@master ~]$ hdfs dfs -text /cmz/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 hdfs\u4e0a\u521b\u5efa\u4e86\u4e00\u4e2acmz\u6587\u4ef6\u5939\uff0c\u91cc\u9762\u4e0a\u4f20\u4e86hosts\u6587\u4ef6\u3002","title":"1. \u4ecb\u7ecd"},{"location":"hadoop/CDH/cdh.namenode_ha/#2-ha","text":"","title":"2. \u914d\u7f6eHA"},{"location":"hadoop/CDH/cdh.namenode_ha/#21","text":"\u4ee5\u4e0a\u51fa\u73b0namenode\u683c\u5f0f\u5316\u5931\u8d25\uff0c\u662f\u56e0\u4e3a\u4e4b\u524d\u6709\u6570\u636e\uff0c\u4e0d\u7528\u7ba1\u3002\u7ee7\u7eed\u3002 \u5230\u6b64\u4e3a\u6b62\uff0cnamenode ha\u914d\u7f6e\u6210\u529f\u3002 namenode ha\uff0chdfs\u7684\u6570\u636e\u8fd8\u5728\u3002","title":"2.1 \u914d\u7f6e\u6b65\u9aa4"},{"location":"hadoop/CDH/cdh.namenode_ha/#22-ha","text":"\u53ef\u4ee5\u770b\u51fahdfs\u7684namenode\u914d\u7f6e\u6210\u529f\u4e86\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u6d4b\u8bd5namenode\u7684ha\u3002","title":"2.2 \u67e5\u770bha"},{"location":"hadoop/CDH/cdh.namenode_ha/#23","text":"\u5728\u6d4b\u8bd5\u4e4b\u524d\u3002\u6211\u4eec\u4e0b\u4fee\u6539hdfs\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u4fdd\u8bc1\u5728\u7cfb\u7edf\u4e4b\u5185hdfs\u53ef\u4ee5\u901a\u8fc7\u975ehdfs\u7528\u6237\u53bb\u64cd\u4f5chdfs\u3002","title":"2.3 \u6d4b\u8bd5"},{"location":"hadoop/CDH/cdh.namenode_ha/#231","text":"\u505c\u6b62master\u3002\u6302\u8d77master\u5bf9\u5e94\u7684\u865a\u62df\u673a\u4e4b\u524d\u3002 [hdfs@master ~]$ hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@slave1 lib]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@slave2 src]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts \u505c\u6b62master\u3002\u6302\u8d77master\u5bf9\u5e94\u7684\u865a\u62df\u673a\u4e4b\u540e\u3002 [root@slave1 lib]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@slave2 src]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts cd \u8fc7\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u5907namenode\u53d1\u73b0\u4e3bnamenode\u6302\u4e86\u4ee5\u540e\uff0c\u63a5\u7ba1\u4e86\uff0c\u5176\u4ed6\u7684agent\u7684\u7ba1\u7406\u3002 \u5728master\u6709\u95ee\u9898\u4e4b\u540e\uff0c\u5907namenode\u63a5\u7ba1\u4e3bnamenode\u4e4b\u524d\uff0chdfs\u670d\u52a1\u662f\u4e0d\u53ef\u7528\u7684\u3002\u6b64\u65f6\u64cd\u4f5chdfs\u4f1a\u62a5\u9519\u3002\u6211\u865a\u62df\u673a\u53cd\u5e94\u65f6\u95f4\u5927\u698230\u4e0d\u5230\u3002\u5c31\u5207\u6362\u8fc7\u6765\u4e86\u3002 \u624b\u52a8\u6062\u590d\u4e3bnamenode\u673a\u5668\u3002 \u518d\u6b21\u6d4b\u8bd5hdfs [root@master ~]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@master ~]# hdfs dfs -text /cmz/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 [root@slave1 lib]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@slave1 lib]# hdfs dfs -text /cmz/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 [root@slave2 src]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@slave2 src]# hdfs dfs -text /cmz/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.186.128 master 192.168.186.129 slave1 192.168.186.137 slave2 \u4ece\u4ee5\u4e0a\u53ef\u4ee5\u770b\u51fa\u6062\u590d\u4e86\u4e4b\u524d\u6709\u95ee\u9898\u7684\u4e3bnamenode\u4e4b\u540e\u3002cdh\u53d1\u73b0\u7cfb\u7edf\u4e2d\u5df2\u7ecf\u6709\u4e00\u4e2a\u4e3b\u7684namenode[\u4e4b\u524d\u7684\u5907namenode]\u540e\uff0c\u5c06\u539f\u672c\u4e3b\u7684namenode\u964d\u4f4e\u8eab\u4efd\uff0c\u5316\u8eab\u4e3a\u5907namenode\u4e86\u3002","title":"2.3.1 \u81ea\u52a8\u5207\u6362"},{"location":"hadoop/CDH/cdh.namenode_ha/#232","text":"\u6a21\u62df\u4e86namenode\u7684ha\u4e4b\u540e\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u624b\u52a8\u5207\u6362namenode\u3002 \u67e5\u770b\u5207\u6362\u540e\u7684\u60c5\u51b5 \u53ef\u89c1\u624b\u52a8\u5207\u6362OK\u3002","title":"2.3.2 \u624b\u52a8\u5207\u6362"},{"location":"hadoop/CDH/cdh.namenode_ha/#3-ha","text":"\u82e5\u662f\u6709\u4e2anamenode\u5b9e\u5728\u6709\u95ee\u9898\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u624b\u52a8\u5378\u8f7dnamenode ha\uff0c\u4ee5\u4e0b\u662f\u8bb0\u5f55\u6b65\u9aa4 \u53ef\u4ee5\u770b\u51fa\uff0cnamenode\u53bb\u9664\u4e86ha\u4e86\u3002\u6d4b\u8bd5\u5982\u4e0b [root@master ~]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@slave1 lib]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts [root@slave2 src]# hdfs dfs -ls /cmz Found 1 items -rw-r--r-- 3 hdfs supergroup 231 2019-04-01 15:09 /cmz/hosts \u622a\u6b62\u5230\u76ee\u524d\u4e3a\u6b62\uff0cNameNode\u7684HA\uff0c\u542f\u7528\u548c\u7981\u7528\uff0c\u6d4b\u8bd5OK\u3002","title":"3. \u7981\u7528HA"},{"location":"hadoop/CDH/cdh.secondary_namenode/","text":"Secondary NameNode 1. \u4ecb\u7ecd \u00b6 \u8bb0\u5f97\u521a\u63a5\u89e6Hadoop\u90a3\u4f1a, \u4e00\u76f4\u6ca1\u6709\u5f04\u660e\u767dNameNode\u548cSecondary NameNode\u7684\u533a\u522b\u548c\u5173\u7cfb\u3002\u5f88\u591a\u4eba\u548c\u6211\u5f00\u59cb\u90fd\u8ba4\u4e3a\uff0cSecondary NameNode\u662fNameNode\u7684\u5907\u4efd\uff0c\u662f\u4e3a\u4e86\u9632\u6b62NameNode\u7684\u5355\u70b9\u5931\u8d25\u7684\u3002\u540e\u6765\u6df1\u5165\u4e86\u89e3\u5de5\u4f5c\u539f\u7406\u540e\uff0c\u624d\u53d1\u73b0\u5e76\u4e0d\u662f\u8fd9\u6837\u3002 2. \u4f5c\u7528 \u00b6 \u5728Hadoop\u4e2d\uff0c\u6709\u4e00\u4e9b\u547d\u540d\u4e0d\u597d\u7684\u6a21\u5757\uff0cSecondary NameNode\u662f\u5176\u4e2d\u4e4b\u4e00\u3002\u4ece\u5b83\u7684\u540d\u5b57\u4e0a\u770b\uff0c\u5b83\u7ed9\u4eba\u7684\u611f\u89c9\u5c31\u50cf\u662fNameNode\u7684\u5907\u4efd\u3002\u4f46\u5b83\u5b9e\u9645\u4e0a\u5374\u4e0d\u662f\u3002\u5f88\u591aHadoop\u7684\u521d\u5b66\u8005\u90fd\u5f88\u7591\u60d1\uff0cSecondary NameNode\u7a76\u7adf\u662f\u505a\u4ec0\u4e48\u7684\uff0c\u800c\u4e14\u5b83\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0\u5728HDFS\u4e2d\u3002\u56e0\u6b64\uff0c\u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u60f3\u8981\u89e3\u91ca\u4e0bSecondary NameNode\u5728HDFS\u4e2d\u6240\u626e\u6f14\u7684\u89d2\u8272\u3002 SecondaryNameNode\u6709\u4e24\u4e2a\u4f5c\u7528\uff0c\u4e00\u662f\u955c\u50cf\u5907\u4efd\uff0c\u4e8c\u662f\u65e5\u5fd7\u4e0e\u955c\u50cf\u7684\u5b9a\u671f\u5408\u5e76\u3002\u4e24\u4e2a\u8fc7\u7a0b\u540c\u65f6\u8fdb\u884c\uff0c\u79f0\u4e3acheckpoint. \u955c\u50cf\u5907\u4efd\u7684\u4f5c\u7528:\u5907\u4efdfsimage(fsimage\u662f\u5143\u6570\u636e\u53d1\u9001\u68c0\u67e5\u70b9\u65f6\u5199\u5165\u6587\u4ef6);\u65e5\u5fd7\u4e0e\u955c\u50cf\u7684\u5b9a\u671f\u5408\u5e76\u7684\u4f5c\u7528:\u5c06Namenode\u4e2dedits\u65e5\u5fd7\u548cfsimage\u5408\u5e76,\u9632\u6b62(\u5982\u679cNamenode\u8282\u70b9\u6545\u969c\uff0cnamenode\u4e0b\u6b21\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f1a\u628afsimage\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u5e94\u7528edit log,edit log\u5f80\u5f80\u5f88\u5927\uff0c\u5bfc\u81f4\u64cd\u4f5c\u5f80\u5f80\u5f88\u8017\u65f6\u3002) \u4ece\u5b83\u7684\u540d\u5b57\u6765\u770b\uff0c\u4f60\u53ef\u80fd\u8ba4\u4e3a\u5b83\u8ddfNameNode\u6709\u70b9\u5173\u7cfb\u3002\u6ca1\u9519\uff0c\u4f60\u731c\u5bf9\u4e86\u3002\u56e0\u6b64\u5728\u6211\u4eec\u6df1\u5165\u4e86\u89e3Secondary NameNode\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u770b\u770bNameNode\u662f\u505a\u4ec0\u4e48\u7684\u3002 3. NameNode \u00b6 NameNode\u4e3b\u8981\u662f\u7528\u6765\u4fdd\u5b58HDFS\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u6bd4\u5982\u547d\u540d\u7a7a\u95f4\u4fe1\u606f\uff0c\u5757\u4fe1\u606f\u7b49\u3002\u5f53\u5b83\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u8fd9\u4e9b\u4fe1\u606f\u662f\u5b58\u5728\u5185\u5b58\u4e2d\u7684\u3002\u4f46\u662f\u8fd9\u4e9b\u4fe1\u606f\u4e5f\u53ef\u4ee5\u6301\u4e45\u5316\u5230\u78c1\u76d8\u4e0a\u3002 \u6700\u597d\u7684\u8d44\u6599 \u4e0a\u9762\u7684\u8fd9\u5f20\u56fe\u7247\u5c55\u793a\u4e86NameNode\u600e\u4e48\u628a\u5143\u6570\u636e\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\u3002\u8fd9\u91cc\u6709\u4e24\u4e2a\u4e0d\u540c\u7684\u6587\u4ef6\uff1a fsimage - \u5b83\u662f\u5728NameNode\u542f\u52a8\u65f6\u5bf9\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u5feb\u7167 edit logs - \u5b83\u662f\u5728NameNode\u542f\u52a8\u540e\uff0c\u5bf9\u6587\u4ef6\u7cfb\u7edf\u7684\u6539\u52a8\u5e8f\u5217 \u53ea\u6709\u5728NameNode\u91cd\u542f\u65f6\uff0cedit logs\u624d\u4f1a\u5408\u5e76\u5230fsimage\u6587\u4ef6\u4e2d\uff0c\u4ece\u800c\u5f97\u5230\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u6700\u65b0\u5feb\u7167\u3002\u4f46\u662f\u5728\u4ea7\u54c1\u96c6\u7fa4\u4e2dNameNode\u662f\u5f88\u5c11\u91cd\u542f\u7684\uff0c\u8fd9\u4e5f\u610f\u5473\u7740\u5f53NameNode\u8fd0\u884c\u4e86\u5f88\u957f\u65f6\u95f4\u540e\uff0cedit logs\u6587\u4ef6\u4f1a\u53d8\u5f97\u5f88\u5927\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c31\u4f1a\u51fa\u73b0\u4e0b\u9762\u4e00\u4e9b\u95ee\u9898\uff1a edit logs\u6587\u4ef6\u4f1a\u53d8\u7684\u5f88\u5927\uff0c\u600e\u4e48\u53bb\u7ba1\u7406\u8fd9\u4e2a\u6587\u4ef6\u662f\u4e00\u4e2a\u6311\u6218\u3002 NameNode\u7684\u91cd\u542f\u4f1a\u82b1\u8d39\u5f88\u957f\u65f6\u95f4\uff0c\u56e0\u4e3a\u6709\u5f88\u591a\u6539\u52a8[\u5728edit logs\u4e2d]\u8981\u5408\u5e76\u5230fsimage\u6587\u4ef6\u4e0a\u3002 \u5982\u679cNameNode\u6302\u6389\u4e86\uff0c\u90a3\u6211\u4eec\u5c31\u4e22\u5931\u4e86\u5f88\u591a\u6539\u52a8\u56e0\u4e3a\u6b64\u65f6\u7684fsimage\u6587\u4ef6\u975e\u5e38\u65e7\u3002[\u6211\u8ba4\u4e3a\u5728\u8fd9\u4e2a\u60c5\u51b5\u4e0b\u4e22\u5931\u7684\u6539\u52a8\u4e0d\u4f1a\u5f88\u591a, \u56e0\u4e3a\u4e22\u5931\u7684\u6539\u52a8\u5e94\u8be5\u662f\u8fd8\u5728\u5185\u5b58\u4e2d\u4f46\u662f\u6ca1\u6709\u5199\u5230edit logs\u7684\u8fd9\u90e8\u5206\u3002] \u56e0\u6b64\u4e3a\u4e86\u514b\u670d\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u6613\u4e8e\u7ba1\u7406\u7684\u673a\u5236\u6765\u5e2e\u52a9\u6211\u4eec\u51cf\u5c0fedit logs\u6587\u4ef6\u7684\u5927\u5c0f\u548c\u5f97\u5230\u4e00\u4e2a\u6700\u65b0\u7684fsimage\u6587\u4ef6\uff0c\u8fd9\u6837\u4e5f\u4f1a\u51cf\u5c0f\u5728NameNode\u4e0a\u7684\u538b\u529b\u3002\u8fd9\u8ddfWindows\u7684\u6062\u590d\u70b9\u662f\u975e\u5e38\u50cf\u7684\uff0cWindows\u7684\u6062\u590d\u70b9\u673a\u5236\u5141\u8bb8\u6211\u4eec\u5bf9OS\u8fdb\u884c\u5feb\u7167\uff0c\u8fd9\u6837\u5f53\u7cfb\u7edf\u53d1\u751f\u95ee\u9898\u65f6\uff0c\u6211\u4eec\u80fd\u591f\u56de\u6eda\u5230\u6700\u65b0\u7684\u4e00\u6b21\u6062\u590d\u70b9\u4e0a\u3002 4. Secondary NameNode \u00b6 \u56e0\u6b64\u4e3a\u4e86\u514b\u670d\u8fd9\u4e2a\u95ee\u9898SecondaryNameNode\u5c31\u662f\u6765\u5e2e\u52a9\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u7684\uff0c\u5b83\u7684\u804c\u8d23\u662f\u5408\u5e76NameNode\u7684edit logs\u5230fsimage\u6587\u4ef6\u4e2d\u3002 \u4e0a\u9762\u7684\u56fe\u7247\u5c55\u793a\u4e86Secondary NameNode\u662f\u600e\u4e48\u5de5\u4f5c\u7684\u3002 \u9996\u5148\uff0c\u5b83\u5b9a\u65f6\u5230NameNode\u53bb\u83b7\u53d6edit logs\uff0c\u5e76\u66f4\u65b0\u5230fsimage\u4e0a\u3002[\u7b14\u8005\u6ce8\uff1aSecondary NameNode\u81ea\u5df1\u7684fsimage] \u4e00\u65e6\u5b83\u6709\u4e86\u65b0\u7684fsimage\u6587\u4ef6\uff0c\u5b83\u5c06\u5176\u62f7\u8d1d\u56deNameNode\u4e2d\u3002 NameNode\u5728\u4e0b\u6b21\u91cd\u542f\u65f6\u4f1a\u4f7f\u7528\u8fd9\u4e2a\u65b0\u7684fsimage\u6587\u4ef6\uff0c\u4ece\u800c\u51cf\u5c11\u91cd\u542f\u7684\u65f6\u95f4\u3002 Secondary NameNode\u7684\u6574\u4e2a\u76ee\u7684\u662f\u5728HDFS\u4e2d\u63d0\u4f9b\u4e00\u4e2a\u68c0\u67e5\u70b9\u3002\u5b83\u53ea\u662fNameNode\u7684\u4e00\u4e2a\u52a9\u624b\u8282\u70b9\u3002\u8fd9\u4e5f\u662f\u5b83\u5728\u793e\u533a\u5185\u88ab\u8ba4\u4e3a\u662f\u68c0\u67e5\u70b9\u8282\u70b9\u7684\u539f\u56e0\u3002 \u662f\u5173\u4e8eNameNode\u662f\u4ec0\u4e48\u65f6\u5019\u5c06\u6539\u52a8\u5199\u5230edit logs\u4e2d\u7684\uff1f\u8fd9\u4e2a\u64cd\u4f5c\u5b9e\u9645\u4e0a\u662f\u7531DataNode\u7684\u5199\u64cd\u4f5c\u89e6\u53d1\u7684\uff0c\u5f53\u6211\u4eec\u5f80DataNode\u5199\u6587\u4ef6\u65f6\uff0cDataNode\u4f1a\u8ddfNameNode\u901a\u4fe1\uff0c\u544a\u8bc9NameNode\u4ec0\u4e48\u6587\u4ef6\u7684\u7b2c\u51e0\u4e2ablock\u653e\u5728\u5b83\u90a3\u91cc\uff0cNameNode\u8fd9\u4e2a\u65f6\u5019\u4f1a\u5c06\u8fd9\u4e9b\u5143\u6570\u636e\u4fe1\u606f\u5199\u5230edit logs\u6587\u4ef6\u4e2d\u3002 4. Secondary NameNode\u5de5\u4f5c\u539f\u7406 \u00b6 \u65e5\u5fd7\u4e0e\u955c\u50cf\u7684\u5b9a\u671f\u5408\u5e76\u603b\u5171\u5206\u4e94\u6b65\uff1a SecondaryNameNode\u901a\u77e5NameNode\u51c6\u5907\u63d0\u4ea4edits\u6587\u4ef6\uff0c\u6b64\u65f6\u4e3b\u8282\u70b9\u4ea7\u751fedits.new SecondaryNameNode\u901a\u8fc7http get\u65b9\u5f0f\u83b7\u53d6NameNode\u7684fsimage\u4e0eedits\u6587\u4ef6\uff08\u5728SecondaryNameNode\u7684current\u540c\u7ea7\u76ee\u5f55\u4e0b\u53ef\u89c1\u5230 temp.check-point\u6216\u8005previous-checkpoint\u76ee\u5f55\uff0c\u8fd9\u4e9b\u76ee\u5f55\u4e2d\u5b58\u50a8\u7740\u4ecenamenode\u62f7\u8d1d\u6765\u7684\u955c\u50cf\u6587\u4ef6\uff09 SecondaryNameNode\u5f00\u59cb\u5408\u5e76\u83b7\u53d6\u7684\u4e0a\u8ff0\u4e24\u4e2a\u6587\u4ef6\uff0c\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684fsimage\u6587\u4ef6fsimage.ckpt SecondaryNameNode\u7528http post\u65b9\u5f0f\u53d1\u9001fsimage.ckpt\u81f3NameNode NameNode\u5c06fsimage.ckpt\u4e0eedits.new\u6587\u4ef6\u5206\u522b\u91cd\u547d\u540d\u4e3afsimage\u4e0eedits\uff0c\u7136\u540e\u66f4\u65b0fstime\uff0c\u6574\u4e2acheckpoint\u8fc7\u7a0b\u5230\u6b64\u7ed3\u675f\u3002 \u5728\u65b0\u7248\u672c\u7684hadoop\u4e2d\uff08hadoop0.21.0\uff09,SecondaryNameNode\u4e24\u4e2a\u4f5c\u7528\u88ab\u4e24\u4e2a\u8282\u70b9\u66ff\u6362\uff0c checkpoint node\u4e0ebackup node. SecondaryNameNode\u5907\u4efd\u7531\u4e09\u4e2a\u53c2\u6570\u63a7\u5236fs.checkpoint.period\u63a7\u5236\u5468\u671f\uff0cfs.checkpoint.size\u63a7\u5236\u65e5\u5fd7\u6587\u4ef6\u8d85\u8fc7\u591a\u5c11\u5927\u5c0f\u65f6\u5408\u5e76\uff0c dfs.http.address\u8868\u793ahttp\u5730\u5740\uff0c\u8fd9\u4e2a\u53c2\u6570\u5728SecondaryNameNode\u4e3a\u5355\u72ec\u8282\u70b9\u65f6\u9700\u8981\u8bbe\u7f6e\u3002","title":"3. secondary_namenode"},{"location":"hadoop/CDH/cdh.secondary_namenode/#1","text":"\u8bb0\u5f97\u521a\u63a5\u89e6Hadoop\u90a3\u4f1a, \u4e00\u76f4\u6ca1\u6709\u5f04\u660e\u767dNameNode\u548cSecondary NameNode\u7684\u533a\u522b\u548c\u5173\u7cfb\u3002\u5f88\u591a\u4eba\u548c\u6211\u5f00\u59cb\u90fd\u8ba4\u4e3a\uff0cSecondary NameNode\u662fNameNode\u7684\u5907\u4efd\uff0c\u662f\u4e3a\u4e86\u9632\u6b62NameNode\u7684\u5355\u70b9\u5931\u8d25\u7684\u3002\u540e\u6765\u6df1\u5165\u4e86\u89e3\u5de5\u4f5c\u539f\u7406\u540e\uff0c\u624d\u53d1\u73b0\u5e76\u4e0d\u662f\u8fd9\u6837\u3002","title":"1. \u4ecb\u7ecd"},{"location":"hadoop/CDH/cdh.secondary_namenode/#2","text":"\u5728Hadoop\u4e2d\uff0c\u6709\u4e00\u4e9b\u547d\u540d\u4e0d\u597d\u7684\u6a21\u5757\uff0cSecondary NameNode\u662f\u5176\u4e2d\u4e4b\u4e00\u3002\u4ece\u5b83\u7684\u540d\u5b57\u4e0a\u770b\uff0c\u5b83\u7ed9\u4eba\u7684\u611f\u89c9\u5c31\u50cf\u662fNameNode\u7684\u5907\u4efd\u3002\u4f46\u5b83\u5b9e\u9645\u4e0a\u5374\u4e0d\u662f\u3002\u5f88\u591aHadoop\u7684\u521d\u5b66\u8005\u90fd\u5f88\u7591\u60d1\uff0cSecondary NameNode\u7a76\u7adf\u662f\u505a\u4ec0\u4e48\u7684\uff0c\u800c\u4e14\u5b83\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0\u5728HDFS\u4e2d\u3002\u56e0\u6b64\uff0c\u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u60f3\u8981\u89e3\u91ca\u4e0bSecondary NameNode\u5728HDFS\u4e2d\u6240\u626e\u6f14\u7684\u89d2\u8272\u3002 SecondaryNameNode\u6709\u4e24\u4e2a\u4f5c\u7528\uff0c\u4e00\u662f\u955c\u50cf\u5907\u4efd\uff0c\u4e8c\u662f\u65e5\u5fd7\u4e0e\u955c\u50cf\u7684\u5b9a\u671f\u5408\u5e76\u3002\u4e24\u4e2a\u8fc7\u7a0b\u540c\u65f6\u8fdb\u884c\uff0c\u79f0\u4e3acheckpoint. \u955c\u50cf\u5907\u4efd\u7684\u4f5c\u7528:\u5907\u4efdfsimage(fsimage\u662f\u5143\u6570\u636e\u53d1\u9001\u68c0\u67e5\u70b9\u65f6\u5199\u5165\u6587\u4ef6);\u65e5\u5fd7\u4e0e\u955c\u50cf\u7684\u5b9a\u671f\u5408\u5e76\u7684\u4f5c\u7528:\u5c06Namenode\u4e2dedits\u65e5\u5fd7\u548cfsimage\u5408\u5e76,\u9632\u6b62(\u5982\u679cNamenode\u8282\u70b9\u6545\u969c\uff0cnamenode\u4e0b\u6b21\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f1a\u628afsimage\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u5e94\u7528edit log,edit log\u5f80\u5f80\u5f88\u5927\uff0c\u5bfc\u81f4\u64cd\u4f5c\u5f80\u5f80\u5f88\u8017\u65f6\u3002) \u4ece\u5b83\u7684\u540d\u5b57\u6765\u770b\uff0c\u4f60\u53ef\u80fd\u8ba4\u4e3a\u5b83\u8ddfNameNode\u6709\u70b9\u5173\u7cfb\u3002\u6ca1\u9519\uff0c\u4f60\u731c\u5bf9\u4e86\u3002\u56e0\u6b64\u5728\u6211\u4eec\u6df1\u5165\u4e86\u89e3Secondary NameNode\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u770b\u770bNameNode\u662f\u505a\u4ec0\u4e48\u7684\u3002","title":"2. \u4f5c\u7528"},{"location":"hadoop/CDH/cdh.secondary_namenode/#3-namenode","text":"NameNode\u4e3b\u8981\u662f\u7528\u6765\u4fdd\u5b58HDFS\u7684\u5143\u6570\u636e\u4fe1\u606f\uff0c\u6bd4\u5982\u547d\u540d\u7a7a\u95f4\u4fe1\u606f\uff0c\u5757\u4fe1\u606f\u7b49\u3002\u5f53\u5b83\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u8fd9\u4e9b\u4fe1\u606f\u662f\u5b58\u5728\u5185\u5b58\u4e2d\u7684\u3002\u4f46\u662f\u8fd9\u4e9b\u4fe1\u606f\u4e5f\u53ef\u4ee5\u6301\u4e45\u5316\u5230\u78c1\u76d8\u4e0a\u3002 \u6700\u597d\u7684\u8d44\u6599 \u4e0a\u9762\u7684\u8fd9\u5f20\u56fe\u7247\u5c55\u793a\u4e86NameNode\u600e\u4e48\u628a\u5143\u6570\u636e\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\u3002\u8fd9\u91cc\u6709\u4e24\u4e2a\u4e0d\u540c\u7684\u6587\u4ef6\uff1a fsimage - \u5b83\u662f\u5728NameNode\u542f\u52a8\u65f6\u5bf9\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u5feb\u7167 edit logs - \u5b83\u662f\u5728NameNode\u542f\u52a8\u540e\uff0c\u5bf9\u6587\u4ef6\u7cfb\u7edf\u7684\u6539\u52a8\u5e8f\u5217 \u53ea\u6709\u5728NameNode\u91cd\u542f\u65f6\uff0cedit logs\u624d\u4f1a\u5408\u5e76\u5230fsimage\u6587\u4ef6\u4e2d\uff0c\u4ece\u800c\u5f97\u5230\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u6700\u65b0\u5feb\u7167\u3002\u4f46\u662f\u5728\u4ea7\u54c1\u96c6\u7fa4\u4e2dNameNode\u662f\u5f88\u5c11\u91cd\u542f\u7684\uff0c\u8fd9\u4e5f\u610f\u5473\u7740\u5f53NameNode\u8fd0\u884c\u4e86\u5f88\u957f\u65f6\u95f4\u540e\uff0cedit logs\u6587\u4ef6\u4f1a\u53d8\u5f97\u5f88\u5927\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c31\u4f1a\u51fa\u73b0\u4e0b\u9762\u4e00\u4e9b\u95ee\u9898\uff1a edit logs\u6587\u4ef6\u4f1a\u53d8\u7684\u5f88\u5927\uff0c\u600e\u4e48\u53bb\u7ba1\u7406\u8fd9\u4e2a\u6587\u4ef6\u662f\u4e00\u4e2a\u6311\u6218\u3002 NameNode\u7684\u91cd\u542f\u4f1a\u82b1\u8d39\u5f88\u957f\u65f6\u95f4\uff0c\u56e0\u4e3a\u6709\u5f88\u591a\u6539\u52a8[\u5728edit logs\u4e2d]\u8981\u5408\u5e76\u5230fsimage\u6587\u4ef6\u4e0a\u3002 \u5982\u679cNameNode\u6302\u6389\u4e86\uff0c\u90a3\u6211\u4eec\u5c31\u4e22\u5931\u4e86\u5f88\u591a\u6539\u52a8\u56e0\u4e3a\u6b64\u65f6\u7684fsimage\u6587\u4ef6\u975e\u5e38\u65e7\u3002[\u6211\u8ba4\u4e3a\u5728\u8fd9\u4e2a\u60c5\u51b5\u4e0b\u4e22\u5931\u7684\u6539\u52a8\u4e0d\u4f1a\u5f88\u591a, \u56e0\u4e3a\u4e22\u5931\u7684\u6539\u52a8\u5e94\u8be5\u662f\u8fd8\u5728\u5185\u5b58\u4e2d\u4f46\u662f\u6ca1\u6709\u5199\u5230edit logs\u7684\u8fd9\u90e8\u5206\u3002] \u56e0\u6b64\u4e3a\u4e86\u514b\u670d\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u6613\u4e8e\u7ba1\u7406\u7684\u673a\u5236\u6765\u5e2e\u52a9\u6211\u4eec\u51cf\u5c0fedit logs\u6587\u4ef6\u7684\u5927\u5c0f\u548c\u5f97\u5230\u4e00\u4e2a\u6700\u65b0\u7684fsimage\u6587\u4ef6\uff0c\u8fd9\u6837\u4e5f\u4f1a\u51cf\u5c0f\u5728NameNode\u4e0a\u7684\u538b\u529b\u3002\u8fd9\u8ddfWindows\u7684\u6062\u590d\u70b9\u662f\u975e\u5e38\u50cf\u7684\uff0cWindows\u7684\u6062\u590d\u70b9\u673a\u5236\u5141\u8bb8\u6211\u4eec\u5bf9OS\u8fdb\u884c\u5feb\u7167\uff0c\u8fd9\u6837\u5f53\u7cfb\u7edf\u53d1\u751f\u95ee\u9898\u65f6\uff0c\u6211\u4eec\u80fd\u591f\u56de\u6eda\u5230\u6700\u65b0\u7684\u4e00\u6b21\u6062\u590d\u70b9\u4e0a\u3002","title":"3. NameNode"},{"location":"hadoop/CDH/cdh.secondary_namenode/#4-secondary-namenode","text":"\u56e0\u6b64\u4e3a\u4e86\u514b\u670d\u8fd9\u4e2a\u95ee\u9898SecondaryNameNode\u5c31\u662f\u6765\u5e2e\u52a9\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u7684\uff0c\u5b83\u7684\u804c\u8d23\u662f\u5408\u5e76NameNode\u7684edit logs\u5230fsimage\u6587\u4ef6\u4e2d\u3002 \u4e0a\u9762\u7684\u56fe\u7247\u5c55\u793a\u4e86Secondary NameNode\u662f\u600e\u4e48\u5de5\u4f5c\u7684\u3002 \u9996\u5148\uff0c\u5b83\u5b9a\u65f6\u5230NameNode\u53bb\u83b7\u53d6edit logs\uff0c\u5e76\u66f4\u65b0\u5230fsimage\u4e0a\u3002[\u7b14\u8005\u6ce8\uff1aSecondary NameNode\u81ea\u5df1\u7684fsimage] \u4e00\u65e6\u5b83\u6709\u4e86\u65b0\u7684fsimage\u6587\u4ef6\uff0c\u5b83\u5c06\u5176\u62f7\u8d1d\u56deNameNode\u4e2d\u3002 NameNode\u5728\u4e0b\u6b21\u91cd\u542f\u65f6\u4f1a\u4f7f\u7528\u8fd9\u4e2a\u65b0\u7684fsimage\u6587\u4ef6\uff0c\u4ece\u800c\u51cf\u5c11\u91cd\u542f\u7684\u65f6\u95f4\u3002 Secondary NameNode\u7684\u6574\u4e2a\u76ee\u7684\u662f\u5728HDFS\u4e2d\u63d0\u4f9b\u4e00\u4e2a\u68c0\u67e5\u70b9\u3002\u5b83\u53ea\u662fNameNode\u7684\u4e00\u4e2a\u52a9\u624b\u8282\u70b9\u3002\u8fd9\u4e5f\u662f\u5b83\u5728\u793e\u533a\u5185\u88ab\u8ba4\u4e3a\u662f\u68c0\u67e5\u70b9\u8282\u70b9\u7684\u539f\u56e0\u3002 \u662f\u5173\u4e8eNameNode\u662f\u4ec0\u4e48\u65f6\u5019\u5c06\u6539\u52a8\u5199\u5230edit logs\u4e2d\u7684\uff1f\u8fd9\u4e2a\u64cd\u4f5c\u5b9e\u9645\u4e0a\u662f\u7531DataNode\u7684\u5199\u64cd\u4f5c\u89e6\u53d1\u7684\uff0c\u5f53\u6211\u4eec\u5f80DataNode\u5199\u6587\u4ef6\u65f6\uff0cDataNode\u4f1a\u8ddfNameNode\u901a\u4fe1\uff0c\u544a\u8bc9NameNode\u4ec0\u4e48\u6587\u4ef6\u7684\u7b2c\u51e0\u4e2ablock\u653e\u5728\u5b83\u90a3\u91cc\uff0cNameNode\u8fd9\u4e2a\u65f6\u5019\u4f1a\u5c06\u8fd9\u4e9b\u5143\u6570\u636e\u4fe1\u606f\u5199\u5230edit logs\u6587\u4ef6\u4e2d\u3002","title":"4. Secondary NameNode"},{"location":"hadoop/CDH/cdh.secondary_namenode/#4-secondary-namenode_1","text":"\u65e5\u5fd7\u4e0e\u955c\u50cf\u7684\u5b9a\u671f\u5408\u5e76\u603b\u5171\u5206\u4e94\u6b65\uff1a SecondaryNameNode\u901a\u77e5NameNode\u51c6\u5907\u63d0\u4ea4edits\u6587\u4ef6\uff0c\u6b64\u65f6\u4e3b\u8282\u70b9\u4ea7\u751fedits.new SecondaryNameNode\u901a\u8fc7http get\u65b9\u5f0f\u83b7\u53d6NameNode\u7684fsimage\u4e0eedits\u6587\u4ef6\uff08\u5728SecondaryNameNode\u7684current\u540c\u7ea7\u76ee\u5f55\u4e0b\u53ef\u89c1\u5230 temp.check-point\u6216\u8005previous-checkpoint\u76ee\u5f55\uff0c\u8fd9\u4e9b\u76ee\u5f55\u4e2d\u5b58\u50a8\u7740\u4ecenamenode\u62f7\u8d1d\u6765\u7684\u955c\u50cf\u6587\u4ef6\uff09 SecondaryNameNode\u5f00\u59cb\u5408\u5e76\u83b7\u53d6\u7684\u4e0a\u8ff0\u4e24\u4e2a\u6587\u4ef6\uff0c\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684fsimage\u6587\u4ef6fsimage.ckpt SecondaryNameNode\u7528http post\u65b9\u5f0f\u53d1\u9001fsimage.ckpt\u81f3NameNode NameNode\u5c06fsimage.ckpt\u4e0eedits.new\u6587\u4ef6\u5206\u522b\u91cd\u547d\u540d\u4e3afsimage\u4e0eedits\uff0c\u7136\u540e\u66f4\u65b0fstime\uff0c\u6574\u4e2acheckpoint\u8fc7\u7a0b\u5230\u6b64\u7ed3\u675f\u3002 \u5728\u65b0\u7248\u672c\u7684hadoop\u4e2d\uff08hadoop0.21.0\uff09,SecondaryNameNode\u4e24\u4e2a\u4f5c\u7528\u88ab\u4e24\u4e2a\u8282\u70b9\u66ff\u6362\uff0c checkpoint node\u4e0ebackup node. SecondaryNameNode\u5907\u4efd\u7531\u4e09\u4e2a\u53c2\u6570\u63a7\u5236fs.checkpoint.period\u63a7\u5236\u5468\u671f\uff0cfs.checkpoint.size\u63a7\u5236\u65e5\u5fd7\u6587\u4ef6\u8d85\u8fc7\u591a\u5c11\u5927\u5c0f\u65f6\u5408\u5e76\uff0c dfs.http.address\u8868\u793ahttp\u5730\u5740\uff0c\u8fd9\u4e2a\u53c2\u6570\u5728SecondaryNameNode\u4e3a\u5355\u72ec\u8282\u70b9\u65f6\u9700\u8981\u8bbe\u7f6e\u3002","title":"4. Secondary NameNode\u5de5\u4f5c\u539f\u7406"},{"location":"install/github-pages/","text":"\u901a\u8fc7mkdocs gh-deploy\u81ea\u52a8\u7f16\u8bd1\u51fahtml\u5e76\u53d1\u5e03\u81f3GitHub pages \u521d\u59cb\u5316repo \u00b6 \u5728github\u4e0a\u521b\u5efa\u4e00\u4e2arepo\uff0c\u540d\u5b57\u53ebmy-project \u5c06repo\u540c\u6b65\u5230\u672c\u5730 \u5bfc\u5165\u9879\u76ee \u00b6 \u5c06mkdocs\u6839\u76ee\u5f55(my-project)\u4e0b\u7684\u6240\u6709\u4e1c\u897f\u79fb\u5230\u672c\u5730git\u76ee\u5f55\u4e0b (\u7136\u540e\u53ef\u4ee5\u5c06mkdocs\u6839\u76ee\u5f55\u5220\u9664\u4e86) \u53d1\u5e03 \u00b6 \u5728\u672c\u5730git\u76ee\u5f55\u4e0b\u6267\u884c mkdocs gh-deploy","title":"2. \u53d1\u5e03\u81f3GitHub Pages"},{"location":"install/github-pages/#repo","text":"\u5728github\u4e0a\u521b\u5efa\u4e00\u4e2arepo\uff0c\u540d\u5b57\u53ebmy-project \u5c06repo\u540c\u6b65\u5230\u672c\u5730","title":"\u521d\u59cb\u5316repo"},{"location":"install/github-pages/#_1","text":"\u5c06mkdocs\u6839\u76ee\u5f55(my-project)\u4e0b\u7684\u6240\u6709\u4e1c\u897f\u79fb\u5230\u672c\u5730git\u76ee\u5f55\u4e0b (\u7136\u540e\u53ef\u4ee5\u5c06mkdocs\u6839\u76ee\u5f55\u5220\u9664\u4e86)","title":"\u5bfc\u5165\u9879\u76ee"},{"location":"install/github-pages/#_2","text":"\u5728\u672c\u5730git\u76ee\u5f55\u4e0b\u6267\u884c mkdocs gh-deploy","title":"\u53d1\u5e03"},{"location":"install/http-server/","text":"\u901a\u8fc7mkdocs build\u7f16\u8bd1\u51fahtml\u5e76\u624b\u52a8\u540c\u6b65\u81f3http server\u7684\u6839\u76ee\u5f55 \u751f\u6210\u7ad9\u70b9\u6587\u4ef6 \u00b6 \u5728git\u6839\u76ee\u5f55\u4e0b\u6267\u884c\u547d\u4ee4 mkdocs build \u547d\u4ee4\u6267\u884c\u5b8c\u6bd5\u540e\u53ef\u4ee5\u770b\u5230site\u76ee\u5f55 \u53d1\u5e03\u81f3http server \u00b6 \u5c06site\u76ee\u5f55\u91cc\u7684\u6240\u6709\u4e1c\u897f\u540c\u6b65\u81f3\u81ea\u5df1\u7684http server\u7684\u6839\u76ee\u5f55","title":"3. \u53d1\u5e03\u81f3\u81ea\u5df1\u7684HTTP Server"},{"location":"install/http-server/#_1","text":"\u5728git\u6839\u76ee\u5f55\u4e0b\u6267\u884c\u547d\u4ee4 mkdocs build \u547d\u4ee4\u6267\u884c\u5b8c\u6bd5\u540e\u53ef\u4ee5\u770b\u5230site\u76ee\u5f55","title":"\u751f\u6210\u7ad9\u70b9\u6587\u4ef6"},{"location":"install/http-server/#http-server","text":"\u5c06site\u76ee\u5f55\u91cc\u7684\u6240\u6709\u4e1c\u897f\u540c\u6b65\u81f3\u81ea\u5df1\u7684http server\u7684\u6839\u76ee\u5f55","title":"\u53d1\u5e03\u81f3http server"},{"location":"install/local/","text":"\u73af\u5883\u8bf4\u660e \u00b6 python: 2.7.13 \u4f9d\u8d56\u7684python\u5305: \u5305\u540d \u6a21\u5757\u540d \u7248\u672c mkdocs mkdocs 1.0.4 mkdocs-material material 3.0.6 Markdown markdown 3.0.1 pymdown-extensions pymdownx 6.0 mkdocs-material\u90e8\u7f72 \u00b6 \u5b89\u88c5 \u00b6 pip install mkdocs mkdocs-material \u82e5\u4e0b\u8f7d\u6162\uff0c\u53ef\u66f4\u6362\u5b89\u88c5\u6e90\u4e3a\u8c46\u74e3 sudo pip install --trusted-host pypi.douban.com -i http://pypi.douban.com/simple/ mkdocs mkdocs-material \u521d\u59cb\u5316\u9879\u76ee \u00b6 mkdocs new my-project \u4f1a\u751f\u6210my-project\u76ee\u5f55\uff0c\u8fdb\u5165\u8be5\u76ee\u5f55\u91cc\uff0c\u53ef\u4ee5\u770b\u5230\u9ed8\u8ba4\u653e\u7f6e\u4e86\u4e00\u4e9b\u6587\u4ef6\uff0c\u5305\u62ecmkdocs.yaml\uff0c\u8fd9\u662f\u4e3b\u914d\u7f6e\u6587\u4ef6 \u4fee\u6539\u4e3b\u9898 \u00b6 mkdocs.yml\u91cc\u6dfb\u52a0: theme: name: material \u6dfb\u52a0\u6269\u5c55 \u00b6 mkdocs.yml\u91cc\u6dfb\u52a0: markdown_extensions: - admonition - codehilite: guess_lang: false linenums: false - toc: permalink: true - footnotes - meta - def_list - pymdownx.arithmatex - pymdownx.betterem: smart_enable: all - pymdownx.caret - pymdownx.critic - pymdownx.details - pymdownx.emoji: emoji_generator: !!python/name:pymdownx.emoji.to_png - pymdownx.inlinehilite - pymdownx.magiclink - pymdownx.mark - pymdownx.smartsymbols - pymdownx.superfences - pymdownx.tasklist - pymdownx.tilde [\u53ef\u9009] \u6dfb\u52a0\u767e\u5ea6\u7edf\u8ba1 [\u53ef\u9009] \u6539\u53d8\u9875\u9762\u914d\u8272 [\u63a8\u8350] \u652f\u6301\u4e2d\u6587\u641c\u7d22 \u53ef\u4ee5\u67e5\u770b\u6211\u7684mkdocs.yml\u8303\u4f8b\uff0c\u8be6\u89c1 mkdocs.yml\u8303\u4f8b mkdocs\u670d\u52a1\u542f\u52a8 \u00b6 # \u5728my-project\u76ee\u5f55\u91cc\u6267\u884c mkdocs serve \u901a\u8fc7\u6d4f\u89c8\u5668\u6253\u5f00 http://127.0.0.1:8000/ \u67e5\u770b\u6548\u679c","title":"1. \u672c\u5730\u73af\u5883\u642d\u5efa"},{"location":"install/local/#_1","text":"python: 2.7.13 \u4f9d\u8d56\u7684python\u5305: \u5305\u540d \u6a21\u5757\u540d \u7248\u672c mkdocs mkdocs 1.0.4 mkdocs-material material 3.0.6 Markdown markdown 3.0.1 pymdown-extensions pymdownx 6.0","title":"\u73af\u5883\u8bf4\u660e"},{"location":"install/local/#mkdocs-material","text":"","title":"mkdocs-material\u90e8\u7f72"},{"location":"install/local/#_2","text":"pip install mkdocs mkdocs-material \u82e5\u4e0b\u8f7d\u6162\uff0c\u53ef\u66f4\u6362\u5b89\u88c5\u6e90\u4e3a\u8c46\u74e3 sudo pip install --trusted-host pypi.douban.com -i http://pypi.douban.com/simple/ mkdocs mkdocs-material","title":"\u5b89\u88c5"},{"location":"install/local/#_3","text":"mkdocs new my-project \u4f1a\u751f\u6210my-project\u76ee\u5f55\uff0c\u8fdb\u5165\u8be5\u76ee\u5f55\u91cc\uff0c\u53ef\u4ee5\u770b\u5230\u9ed8\u8ba4\u653e\u7f6e\u4e86\u4e00\u4e9b\u6587\u4ef6\uff0c\u5305\u62ecmkdocs.yaml\uff0c\u8fd9\u662f\u4e3b\u914d\u7f6e\u6587\u4ef6","title":"\u521d\u59cb\u5316\u9879\u76ee"},{"location":"install/local/#_4","text":"mkdocs.yml\u91cc\u6dfb\u52a0: theme: name: material","title":"\u4fee\u6539\u4e3b\u9898"},{"location":"install/local/#_5","text":"mkdocs.yml\u91cc\u6dfb\u52a0: markdown_extensions: - admonition - codehilite: guess_lang: false linenums: false - toc: permalink: true - footnotes - meta - def_list - pymdownx.arithmatex - pymdownx.betterem: smart_enable: all - pymdownx.caret - pymdownx.critic - pymdownx.details - pymdownx.emoji: emoji_generator: !!python/name:pymdownx.emoji.to_png - pymdownx.inlinehilite - pymdownx.magiclink - pymdownx.mark - pymdownx.smartsymbols - pymdownx.superfences - pymdownx.tasklist - pymdownx.tilde [\u53ef\u9009] \u6dfb\u52a0\u767e\u5ea6\u7edf\u8ba1 [\u53ef\u9009] \u6539\u53d8\u9875\u9762\u914d\u8272 [\u63a8\u8350] \u652f\u6301\u4e2d\u6587\u641c\u7d22 \u53ef\u4ee5\u67e5\u770b\u6211\u7684mkdocs.yml\u8303\u4f8b\uff0c\u8be6\u89c1 mkdocs.yml\u8303\u4f8b","title":"\u6dfb\u52a0\u6269\u5c55"},{"location":"install/local/#mkdocs","text":"# \u5728my-project\u76ee\u5f55\u91cc\u6267\u884c mkdocs serve \u901a\u8fc7\u6d4f\u89c8\u5668\u6253\u5f00 http://127.0.0.1:8000/ \u67e5\u770b\u6548\u679c","title":"mkdocs\u670d\u52a1\u542f\u52a8"},{"location":"linux/distributed_storage/distributed_storage.info/","text":"Distributed Storage 1. \u4ecb\u7ecd \u00b6 \u666e\u901a\u5b58\u50a8\u65b9\u6848\uff1aRsync\u3001DAS(IDE/SATA/SAS/SCSI\u7b49\u5757)\u3001NAS(NFS\u3001CIFS\u3001SAMBA\u7b49\u6587\u4ef6\u7cfb\u7edf)\u3001SAN(FibreChannel, iSCSI, FoE\u5b58\u50a8\u7f51\u7edc\u5757)\uff0cOpenfiler\u3001FreeNas(ZFS\u5feb\u7167\u590d\u5236)\u7531\u4e8e\u751f\u4ea7\u73af\u5883\u4e2d\u5f80\u5f80\u7531\u4e8e\u5bf9\u5b58\u50a8\u6570\u636e\u91cf\u5f88\u5927\uff0c\u800cSAN\u5b58\u50a8\u4ef7\u683c\u53c8\u6bd4\u8f83\u6602\u8d35\uff0c\u56e0\u6b64\u5927\u591a\u4f1a\u9009\u62e9\u5206\u5e03\u5f0f,\u5b58\u50a8\u6765\u89e3\u51b3\u4e00\u4e0b\u95ee\u9898\uff1a \u6d77\u91cf\u6570\u636e\u5b58\u50a8\u95ee\u9898 \u6570\u636e\u9ad8\u53ef\u7528\u95ee\u9898(\u5197\u4f59\u5907\u4efd)\u95ee\u9898 \u8f83\u9ad8\u7684\u8bfb\u5199\u6027\u80fd\u548c\u8d1f\u8f7d\u5747\u8861\u95ee\u9898 \u652f\u6301\u591a\u5e73\u53f0\u591a\u8bed\u8a00\u95ee\u9898 \u9ad8\u5e76\u53d1\u95ee\u9898 \u6307\u6807 \u9002\u5408\u7c7b\u578b \u6587\u4ef6\u5206\u5e03 \u7cfb\u7edf\u6027\u80fd \u590d\u6742\u5ea6 FUSE POSIX \u5907\u4efd\u673a\u5236 \u901a\u8baf\u534f\u8bae\u63a5\u53e3 \u652f\u6301 \u5f00\u53d1\u8bed\u8a00 FastDFS 4KB~500MB \u5c0f\u6587\u4ef6\u5408\u5e76\u5b58\u50a8\u4e0d\u5206\u7247\u5904\u7406 \u5f88\u9ad8 \u7b80\u5355 \u4e0d\u652f\u6301 \u4e0d\u652f\u6301 \u7ec4\u5185\u5197\u4f59\u5907\u4efd Api_HTTP \u56fd\u5185\u7528\u6237\u7fa4 C\u8bed\u8a00 TFS \u6240\u6709\u6587\u4ef6 \u5c0f\u6587\u4ef6\u5408\u5e76\uff0c\u4ee5block\u7ec4\u7ec7\u5206\u7247 \u590d\u6742 \u4e0d\u652f\u6301 \u4e0d\u652f\u6301 Block\u5b58\u50a8\u591a\u4efd,\u4e3b\u8f85\u707e\u5907 Api_HTTP \u5c11 C++ MFS \u5927\u4e8e64K \u5206\u7247\u5b58\u50a8 Master\u5360\u5185\u5b58\u591a \u652f\u6301 \u652f\u6301 \u591a\u70b9\u5907\u4efd\u52a8\u6001\u5197\u4f59 \u4f7f\u7528fuse\u6302\u5728 \u8f83\u591a Perl HDFS \u5927\u6587\u4ef6 \u5927\u6587\u4ef6\u5206\u7247\u5206\u5757\u5b58\u50a8 \u7b80\u5355 \u652f\u6301 \u652f\u6301 \u591a\u526f\u672c \u539f\u751fapi \u8f83\u591a java Ceph \u5bf9\u8c61\u6587\u4ef6\u5757 OSD\u4e00\u4e3b\u591a\u4ece \u590d\u6742 \u652f\u6301 \u652f\u6301 \u591a\u526f\u672c \u539f\u751fapi \u8f83\u5c11 C++ MogileFS \u6d77\u91cf\u5c0f\u56fe\u7247 \u9ad8 \u590d\u6742 \u53ef\u4ee5\u652f\u6301 \u4e0d\u652f\u6301 \u52a8\u6001\u5197\u4f59 \u539f\u751fapi \u6587\u6863\u5c11 Perl ClusterFS \u5927\u6587\u4ef6 \u7b80\u5355 \u652f\u6301 \u652f\u6301 \u955c\u50cf \u591a C 1. \u5bf9\u6bd4 \u00b6 \u5e38\u89c1\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u6709FastDFS\uff0cGFS\u3001HDFS\u3001Ceph \u3001GridFS \u3001mogileFS\u3001TFS\u7b49\u3002\u5404\u81ea\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u9886\u57df\u3002\u5b83\u4eec\u90fd\u4e0d\u662f\u7cfb\u7edf\u7ea7\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u800c\u662f\u5e94\u7528\u7ea7\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u5b58\u50a8\u670d\u52a1\u3002 2. GFS \u00b6 GFS\uff08Google File System\uff09,Google\u516c\u53f8\u4e3a\u4e86\u6ee1\u8db3\u672c\u516c\u53f8\u9700\u6c42\u800c\u5f00\u53d1\u7684\u57fa\u4e8eLinux\u7684\u4e13\u6709\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u3002\u3002\u5c3d\u7ba1Google\u516c\u5e03\u4e86\u8be5\u7cfb\u7edf\u7684\u4e00\u4e9b\u6280\u672f\u7ec6\u8282\uff0c\u4f46Google\u5e76\u6ca1\u6709\u5c06\u8be5\u7cfb\u7edf\u7684\u8f6f\u4ef6\u90e8\u5206\u4f5c\u4e3a\u5f00\u6e90\u8f6f\u4ef6\u53d1\u5e03\u3002 \u4e0b\u9762\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u90fd\u662f\u7c7b GFS\u7684\u4ea7\u54c1 3. HDFS \u00b6 HDFS\uff08Hadoop Distributed File System\uff09,Hadoop \u5b9e\u73b0\u4e86\u4e00\u4e2a\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u4e3b\u8981\u7528\u4e8e\u5927\u6570\u636e\u8ba1\u7b97\u5b58\u50a8\uff0c\u7b80\u79f0HDFS\u3002 Hadoop\u662fApache Lucene\u521b\u59cb\u4ebaDoug Cutting\u5f00\u53d1\u7684\u4f7f\u7528\u5e7f\u6cdb\u7684\u6587\u672c\u641c\u7d22\u5e93\u3002\u5b83\u8d77\u6e90\u4e8eApache Nutch\uff0c\u540e\u8005\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u7f51\u7edc\u641c\u7d22\u5f15\u64ce\uff0c\u672c\u8eab\u4e5f\u662fLuene\u9879\u76ee\u7684\u4e00\u90e8\u5206\u3002Aapche Hadoop\u67b6\u6784\u662fMapReduce\u7b97\u6cd5\u7684\u4e00\u79cd\u5f00\u6e90\u5e94\u7528\uff0c\u662fGoogle\u5f00\u521b\u5176\u5e1d\u56fd\u7684\u91cd\u8981\u57fa\u77f3\u3002 4. Ceph \u00b6 \u662f\u52a0\u5dde\u5927\u5b66\u5723\u514b\u9c81\u5179\u5206\u6821\u7684Sage weil\u653b\u8bfb\u535a\u58eb\u65f6\u5f00\u53d1\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u3002Ceph\u80fd\u591f\u5728\u7ef4\u62a4 POSIX \u517c\u5bb9\u6027\u7684\u540c\u65f6\u52a0\u5165\u4e86\u590d\u5236\u548c\u5bb9\u9519\u529f\u80fd\u3002Sage weil\u5e76\u4f7f\u7528Ceph\u5b8c\u6210\u4e86\u4ed6\u7684\u8bba\u6587\u3002\u8bf4 ceph \u6027\u80fd\u6700\u9ad8\uff0cC++\u7f16\u5199\u7684\u4ee3\u7801\uff0c\u652f\u6301Fuse\uff0c\u5e76\u4e14\u6ca1\u6709\u5355\u70b9\u6545\u969c\u4f9d\u8d56\uff0c \u4e8e\u662f\u4e0b\u8f7d\u5b89\u88c5\uff0c \u7531\u4e8e ceph \u4f7f\u7528 btrfs \u6587\u4ef6\u7cfb\u7edf\uff0c \u800cbtrfs \u6587\u4ef6\u7cfb\u7edf\u9700\u8981 Linux 2.6.34 \u4ee5\u4e0a\u7684\u5185\u6838\u624d\u652f\u6301\u3002 5. GridFS \u00b6 MongoDB\u662f\u4e00\u79cd\u77e5\u540d\u7684NoSql\u6570\u636e\u5e93\uff0cGridFS\u662fMongoDB\u7684\u4e00\u4e2a\u5185\u7f6e\u529f\u80fd\uff0c\u5b83\u63d0\u4f9b\u4e00\u7ec4\u6587\u4ef6\u64cd\u4f5c\u7684API\u4ee5\u5229\u7528MongoDB\u5b58\u50a8\u6587\u4ef6\uff0cGridFS\u7684\u57fa\u672c\u539f\u7406\u662f\u5c06\u6587\u4ef6\u4fdd\u5b58\u5728\u4e24\u4e2aCollection\u4e2d\uff0c\u4e00\u4e2a\u4fdd\u5b58\u6587\u4ef6\u7d22\u5f15\uff0c\u4e00\u4e2a\u4fdd\u5b58\u6587\u4ef6\u5185\u5bb9\uff0c\u6587\u4ef6\u5185\u5bb9\u6309\u4e00\u5b9a\u5927\u5c0f\u5206\u6210\u82e5\u5e72\u5757\uff0c\u6bcf\u4e00\u5757\u5b58\u5728\u4e00\u4e2aDocument\u4e2d\uff0c\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u4ec5\u63d0\u4f9b\u4e86\u6587\u4ef6\u5b58\u50a8\uff0c\u8fd8\u63d0\u4f9b\u4e86\u5bf9\u6587\u4ef6\u76f8\u5173\u7684\u4e00\u4e9b\u9644\u52a0\u5c5e\u6027\uff08\u6bd4\u5982MD5\u503c\uff0c\u6587\u4ef6\u540d\u7b49\u7b49\uff09\u7684\u5b58\u50a8\u3002\u6587\u4ef6\u5728GridFS\u4e2d\u4f1a\u63094MB\u4e3a\u5355\u4f4d\u8fdb\u884c\u5206\u5757\u5b58\u50a8\u3002 6. MogileFS \u00b6 \u7531memcahed\u7684\u5f00\u53d1\u516c\u53f8danga\u4e00\u6b3eperl\u5f00\u53d1\u7684\u4ea7\u54c1\uff0c\u76ee\u524d\u56fd\u5185\u4f7f\u7528mogielFS\u7684\u6709\u56fe\u7247\u6258\u7ba1\u7f51\u7ad9yupoo\u7b49\u3002 MogileFS\u662f\u4e00\u5957\u9ad8\u6548\u7684\u6587\u4ef6\u81ea\u52a8\u5907\u4efd\u7ec4\u4ef6\uff0c\u7531Six Apart\u5f00\u53d1\uff0c\u5e7f\u6cdb\u5e94\u7528\u5728\u5305\u62ecLiveJournal\u7b49web2.0\u7ad9\u70b9\u4e0a\u3002 MogileFS\u75313\u4e2a\u90e8\u5206\u7ec4\u6210\uff1a \u7b2c1\u4e2a\u90e8\u5206\u662fserver\u7aef\uff0c\u5305\u62ecmogilefsd\u548cmogstored\u4e24\u4e2a\u7a0b\u5e8f\u3002\u524d\u8005\u5373\u662f mogilefsd\u7684tracker\uff0c\u5b83\u5c06\u4e00\u4e9b\u5168\u5c40\u4fe1\u606f\u4fdd\u5b58\u5728\u6570\u636e\u5e93\u91cc\uff0c\u4f8b\u5982\u7ad9\u70b9domain,class,host\u7b49\u3002\u540e\u8005\u5373\u662f\u5b58\u50a8\u8282\u70b9(store node)\uff0c\u5b83\u5176\u5b9e\u662f\u4e2aHTTP Daemon\uff0c\u9ed8\u8ba4\u4fa6\u542c\u57287500\u7aef\u53e3\uff0c\u63a5\u53d7\u5ba2\u6237\u7aef\u7684\u6587\u4ef6\u5907\u4efd\u8bf7\u6c42\u3002\u5728\u5b89\u88c5\u5b8c\u540e\uff0c\u8981\u8fd0\u884cmogadm\u5de5\u5177\u5c06\u6240\u6709\u7684store node\u6ce8\u518c\u5230mogilefsd\u7684\u6570\u636e\u5e93\u91cc\uff0cmogilefsd\u4f1a\u5bf9\u8fd9\u4e9b\u8282\u70b9\u8fdb\u884c\u7ba1\u7406\u548c\u76d1\u63a7\u3002 \u7b2c2\u4e2a\u90e8\u5206\u662futils\uff08\u5de5\u5177\u96c6\uff09\uff0c\u4e3b\u8981\u662fMogileFS\u7684\u4e00\u4e9b\u7ba1\u7406\u5de5\u5177\uff0c\u4f8b\u5982mogadm\u7b49\u3002 \u7b2c3\u4e2a\u90e8\u5206\u662f\u5ba2\u6237\u7aefAPI\uff0c\u76ee\u524d\u53ea\u6709Perl API(MogileFS.pm)\u3001PHP\uff0c\u7528\u8fd9\u4e2a\u6a21\u5757\u53ef\u4ee5\u7f16\u5199\u5ba2\u6237\u7aef\u7a0b\u5e8f\uff0c\u5b9e\u73b0\u6587\u4ef6\u7684\u5907\u4efd\u7ba1\u7406\u529f\u80fd\u3002 7. TFS \u00b6 TFS\uff08Taobao !FileSystem\uff09\u662f\u4e00\u4e2a\u9ad8\u53ef\u6269\u5c55\u3001\u9ad8\u53ef\u7528\u3001\u9ad8\u6027\u80fd\u3001\u9762\u5411\u4e92\u8054\u7f51\u670d\u52a1\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u4e3b\u8981\u9488\u5bf9\u6d77\u91cf\u7684\u975e\u7ed3\u6784\u5316\u6570\u636e\uff0c\u5b83\u6784\u7b51\u5728\u666e\u901a\u7684Linux\u673a\u5668 \u96c6\u7fa4\u4e0a\uff0c\u53ef\u4e3a\u5916\u90e8\u63d0\u4f9b\u9ad8\u53ef\u9760\u548c\u9ad8\u5e76\u53d1\u7684\u5b58\u50a8\u8bbf\u95ee\u3002TFS\u4e3a\u6dd8\u5b9d\u63d0\u4f9b\u6d77\u91cf\u5c0f\u6587\u4ef6\u5b58\u50a8\uff0c\u901a\u5e38\u6587\u4ef6\u5927\u5c0f\u4e0d\u8d85\u8fc71M\uff0c\u6ee1\u8db3\u4e86\u6dd8\u5b9d\u5bf9\u5c0f\u6587\u4ef6\u5b58\u50a8\u7684\u9700\u6c42\uff0c\u88ab\u5e7f\u6cdb\u5730\u5e94\u7528 \u5728\u6dd8\u5b9d\u5404\u9879\u5e94\u7528\u4e2d\u3002\u5b83\u91c7\u7528\u4e86HA\u67b6\u6784\u548c\u5e73\u6ed1\u6269\u5bb9\uff0c\u4fdd\u8bc1\u4e86\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u53ef\u7528\u6027\u548c\u6269\u5c55\u6027\u3002\u540c\u65f6\u6241\u5e73\u5316\u7684\u6570\u636e\u7ec4\u7ec7\u7ed3\u6784\uff0c\u53ef\u5c06\u6587\u4ef6\u540d\u6620\u5c04\u5230\u6587\u4ef6\u7684\u7269\u7406\u5730\u5740\uff0c\u7b80\u5316 \u4e86\u6587\u4ef6\u7684\u8bbf\u95ee\u6d41\u7a0b\uff0c\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u4e3aTFS\u63d0\u4f9b\u4e86\u826f\u597d\u7684\u8bfb\u5199\u6027\u80fd\u3002","title":"\u5bf9\u6bd4"},{"location":"linux/distributed_storage/distributed_storage.info/#1","text":"\u666e\u901a\u5b58\u50a8\u65b9\u6848\uff1aRsync\u3001DAS(IDE/SATA/SAS/SCSI\u7b49\u5757)\u3001NAS(NFS\u3001CIFS\u3001SAMBA\u7b49\u6587\u4ef6\u7cfb\u7edf)\u3001SAN(FibreChannel, iSCSI, FoE\u5b58\u50a8\u7f51\u7edc\u5757)\uff0cOpenfiler\u3001FreeNas(ZFS\u5feb\u7167\u590d\u5236)\u7531\u4e8e\u751f\u4ea7\u73af\u5883\u4e2d\u5f80\u5f80\u7531\u4e8e\u5bf9\u5b58\u50a8\u6570\u636e\u91cf\u5f88\u5927\uff0c\u800cSAN\u5b58\u50a8\u4ef7\u683c\u53c8\u6bd4\u8f83\u6602\u8d35\uff0c\u56e0\u6b64\u5927\u591a\u4f1a\u9009\u62e9\u5206\u5e03\u5f0f,\u5b58\u50a8\u6765\u89e3\u51b3\u4e00\u4e0b\u95ee\u9898\uff1a \u6d77\u91cf\u6570\u636e\u5b58\u50a8\u95ee\u9898 \u6570\u636e\u9ad8\u53ef\u7528\u95ee\u9898(\u5197\u4f59\u5907\u4efd)\u95ee\u9898 \u8f83\u9ad8\u7684\u8bfb\u5199\u6027\u80fd\u548c\u8d1f\u8f7d\u5747\u8861\u95ee\u9898 \u652f\u6301\u591a\u5e73\u53f0\u591a\u8bed\u8a00\u95ee\u9898 \u9ad8\u5e76\u53d1\u95ee\u9898 \u6307\u6807 \u9002\u5408\u7c7b\u578b \u6587\u4ef6\u5206\u5e03 \u7cfb\u7edf\u6027\u80fd \u590d\u6742\u5ea6 FUSE POSIX \u5907\u4efd\u673a\u5236 \u901a\u8baf\u534f\u8bae\u63a5\u53e3 \u652f\u6301 \u5f00\u53d1\u8bed\u8a00 FastDFS 4KB~500MB \u5c0f\u6587\u4ef6\u5408\u5e76\u5b58\u50a8\u4e0d\u5206\u7247\u5904\u7406 \u5f88\u9ad8 \u7b80\u5355 \u4e0d\u652f\u6301 \u4e0d\u652f\u6301 \u7ec4\u5185\u5197\u4f59\u5907\u4efd Api_HTTP \u56fd\u5185\u7528\u6237\u7fa4 C\u8bed\u8a00 TFS \u6240\u6709\u6587\u4ef6 \u5c0f\u6587\u4ef6\u5408\u5e76\uff0c\u4ee5block\u7ec4\u7ec7\u5206\u7247 \u590d\u6742 \u4e0d\u652f\u6301 \u4e0d\u652f\u6301 Block\u5b58\u50a8\u591a\u4efd,\u4e3b\u8f85\u707e\u5907 Api_HTTP \u5c11 C++ MFS \u5927\u4e8e64K \u5206\u7247\u5b58\u50a8 Master\u5360\u5185\u5b58\u591a \u652f\u6301 \u652f\u6301 \u591a\u70b9\u5907\u4efd\u52a8\u6001\u5197\u4f59 \u4f7f\u7528fuse\u6302\u5728 \u8f83\u591a Perl HDFS \u5927\u6587\u4ef6 \u5927\u6587\u4ef6\u5206\u7247\u5206\u5757\u5b58\u50a8 \u7b80\u5355 \u652f\u6301 \u652f\u6301 \u591a\u526f\u672c \u539f\u751fapi \u8f83\u591a java Ceph \u5bf9\u8c61\u6587\u4ef6\u5757 OSD\u4e00\u4e3b\u591a\u4ece \u590d\u6742 \u652f\u6301 \u652f\u6301 \u591a\u526f\u672c \u539f\u751fapi \u8f83\u5c11 C++ MogileFS \u6d77\u91cf\u5c0f\u56fe\u7247 \u9ad8 \u590d\u6742 \u53ef\u4ee5\u652f\u6301 \u4e0d\u652f\u6301 \u52a8\u6001\u5197\u4f59 \u539f\u751fapi \u6587\u6863\u5c11 Perl ClusterFS \u5927\u6587\u4ef6 \u7b80\u5355 \u652f\u6301 \u652f\u6301 \u955c\u50cf \u591a C","title":"1. \u4ecb\u7ecd"},{"location":"linux/distributed_storage/distributed_storage.info/#1_1","text":"\u5e38\u89c1\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u6709FastDFS\uff0cGFS\u3001HDFS\u3001Ceph \u3001GridFS \u3001mogileFS\u3001TFS\u7b49\u3002\u5404\u81ea\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u9886\u57df\u3002\u5b83\u4eec\u90fd\u4e0d\u662f\u7cfb\u7edf\u7ea7\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u800c\u662f\u5e94\u7528\u7ea7\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u5b58\u50a8\u670d\u52a1\u3002","title":"1. \u5bf9\u6bd4"},{"location":"linux/distributed_storage/distributed_storage.info/#2-gfs","text":"GFS\uff08Google File System\uff09,Google\u516c\u53f8\u4e3a\u4e86\u6ee1\u8db3\u672c\u516c\u53f8\u9700\u6c42\u800c\u5f00\u53d1\u7684\u57fa\u4e8eLinux\u7684\u4e13\u6709\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u3002\u3002\u5c3d\u7ba1Google\u516c\u5e03\u4e86\u8be5\u7cfb\u7edf\u7684\u4e00\u4e9b\u6280\u672f\u7ec6\u8282\uff0c\u4f46Google\u5e76\u6ca1\u6709\u5c06\u8be5\u7cfb\u7edf\u7684\u8f6f\u4ef6\u90e8\u5206\u4f5c\u4e3a\u5f00\u6e90\u8f6f\u4ef6\u53d1\u5e03\u3002 \u4e0b\u9762\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u90fd\u662f\u7c7b GFS\u7684\u4ea7\u54c1","title":"2. GFS"},{"location":"linux/distributed_storage/distributed_storage.info/#3-hdfs","text":"HDFS\uff08Hadoop Distributed File System\uff09,Hadoop \u5b9e\u73b0\u4e86\u4e00\u4e2a\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u4e3b\u8981\u7528\u4e8e\u5927\u6570\u636e\u8ba1\u7b97\u5b58\u50a8\uff0c\u7b80\u79f0HDFS\u3002 Hadoop\u662fApache Lucene\u521b\u59cb\u4ebaDoug Cutting\u5f00\u53d1\u7684\u4f7f\u7528\u5e7f\u6cdb\u7684\u6587\u672c\u641c\u7d22\u5e93\u3002\u5b83\u8d77\u6e90\u4e8eApache Nutch\uff0c\u540e\u8005\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u7f51\u7edc\u641c\u7d22\u5f15\u64ce\uff0c\u672c\u8eab\u4e5f\u662fLuene\u9879\u76ee\u7684\u4e00\u90e8\u5206\u3002Aapche Hadoop\u67b6\u6784\u662fMapReduce\u7b97\u6cd5\u7684\u4e00\u79cd\u5f00\u6e90\u5e94\u7528\uff0c\u662fGoogle\u5f00\u521b\u5176\u5e1d\u56fd\u7684\u91cd\u8981\u57fa\u77f3\u3002","title":"3. HDFS"},{"location":"linux/distributed_storage/distributed_storage.info/#4-ceph","text":"\u662f\u52a0\u5dde\u5927\u5b66\u5723\u514b\u9c81\u5179\u5206\u6821\u7684Sage weil\u653b\u8bfb\u535a\u58eb\u65f6\u5f00\u53d1\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u3002Ceph\u80fd\u591f\u5728\u7ef4\u62a4 POSIX \u517c\u5bb9\u6027\u7684\u540c\u65f6\u52a0\u5165\u4e86\u590d\u5236\u548c\u5bb9\u9519\u529f\u80fd\u3002Sage weil\u5e76\u4f7f\u7528Ceph\u5b8c\u6210\u4e86\u4ed6\u7684\u8bba\u6587\u3002\u8bf4 ceph \u6027\u80fd\u6700\u9ad8\uff0cC++\u7f16\u5199\u7684\u4ee3\u7801\uff0c\u652f\u6301Fuse\uff0c\u5e76\u4e14\u6ca1\u6709\u5355\u70b9\u6545\u969c\u4f9d\u8d56\uff0c \u4e8e\u662f\u4e0b\u8f7d\u5b89\u88c5\uff0c \u7531\u4e8e ceph \u4f7f\u7528 btrfs \u6587\u4ef6\u7cfb\u7edf\uff0c \u800cbtrfs \u6587\u4ef6\u7cfb\u7edf\u9700\u8981 Linux 2.6.34 \u4ee5\u4e0a\u7684\u5185\u6838\u624d\u652f\u6301\u3002","title":"4. Ceph"},{"location":"linux/distributed_storage/distributed_storage.info/#5-gridfs","text":"MongoDB\u662f\u4e00\u79cd\u77e5\u540d\u7684NoSql\u6570\u636e\u5e93\uff0cGridFS\u662fMongoDB\u7684\u4e00\u4e2a\u5185\u7f6e\u529f\u80fd\uff0c\u5b83\u63d0\u4f9b\u4e00\u7ec4\u6587\u4ef6\u64cd\u4f5c\u7684API\u4ee5\u5229\u7528MongoDB\u5b58\u50a8\u6587\u4ef6\uff0cGridFS\u7684\u57fa\u672c\u539f\u7406\u662f\u5c06\u6587\u4ef6\u4fdd\u5b58\u5728\u4e24\u4e2aCollection\u4e2d\uff0c\u4e00\u4e2a\u4fdd\u5b58\u6587\u4ef6\u7d22\u5f15\uff0c\u4e00\u4e2a\u4fdd\u5b58\u6587\u4ef6\u5185\u5bb9\uff0c\u6587\u4ef6\u5185\u5bb9\u6309\u4e00\u5b9a\u5927\u5c0f\u5206\u6210\u82e5\u5e72\u5757\uff0c\u6bcf\u4e00\u5757\u5b58\u5728\u4e00\u4e2aDocument\u4e2d\uff0c\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u4ec5\u63d0\u4f9b\u4e86\u6587\u4ef6\u5b58\u50a8\uff0c\u8fd8\u63d0\u4f9b\u4e86\u5bf9\u6587\u4ef6\u76f8\u5173\u7684\u4e00\u4e9b\u9644\u52a0\u5c5e\u6027\uff08\u6bd4\u5982MD5\u503c\uff0c\u6587\u4ef6\u540d\u7b49\u7b49\uff09\u7684\u5b58\u50a8\u3002\u6587\u4ef6\u5728GridFS\u4e2d\u4f1a\u63094MB\u4e3a\u5355\u4f4d\u8fdb\u884c\u5206\u5757\u5b58\u50a8\u3002","title":"5. GridFS"},{"location":"linux/distributed_storage/distributed_storage.info/#6-mogilefs","text":"\u7531memcahed\u7684\u5f00\u53d1\u516c\u53f8danga\u4e00\u6b3eperl\u5f00\u53d1\u7684\u4ea7\u54c1\uff0c\u76ee\u524d\u56fd\u5185\u4f7f\u7528mogielFS\u7684\u6709\u56fe\u7247\u6258\u7ba1\u7f51\u7ad9yupoo\u7b49\u3002 MogileFS\u662f\u4e00\u5957\u9ad8\u6548\u7684\u6587\u4ef6\u81ea\u52a8\u5907\u4efd\u7ec4\u4ef6\uff0c\u7531Six Apart\u5f00\u53d1\uff0c\u5e7f\u6cdb\u5e94\u7528\u5728\u5305\u62ecLiveJournal\u7b49web2.0\u7ad9\u70b9\u4e0a\u3002 MogileFS\u75313\u4e2a\u90e8\u5206\u7ec4\u6210\uff1a \u7b2c1\u4e2a\u90e8\u5206\u662fserver\u7aef\uff0c\u5305\u62ecmogilefsd\u548cmogstored\u4e24\u4e2a\u7a0b\u5e8f\u3002\u524d\u8005\u5373\u662f mogilefsd\u7684tracker\uff0c\u5b83\u5c06\u4e00\u4e9b\u5168\u5c40\u4fe1\u606f\u4fdd\u5b58\u5728\u6570\u636e\u5e93\u91cc\uff0c\u4f8b\u5982\u7ad9\u70b9domain,class,host\u7b49\u3002\u540e\u8005\u5373\u662f\u5b58\u50a8\u8282\u70b9(store node)\uff0c\u5b83\u5176\u5b9e\u662f\u4e2aHTTP Daemon\uff0c\u9ed8\u8ba4\u4fa6\u542c\u57287500\u7aef\u53e3\uff0c\u63a5\u53d7\u5ba2\u6237\u7aef\u7684\u6587\u4ef6\u5907\u4efd\u8bf7\u6c42\u3002\u5728\u5b89\u88c5\u5b8c\u540e\uff0c\u8981\u8fd0\u884cmogadm\u5de5\u5177\u5c06\u6240\u6709\u7684store node\u6ce8\u518c\u5230mogilefsd\u7684\u6570\u636e\u5e93\u91cc\uff0cmogilefsd\u4f1a\u5bf9\u8fd9\u4e9b\u8282\u70b9\u8fdb\u884c\u7ba1\u7406\u548c\u76d1\u63a7\u3002 \u7b2c2\u4e2a\u90e8\u5206\u662futils\uff08\u5de5\u5177\u96c6\uff09\uff0c\u4e3b\u8981\u662fMogileFS\u7684\u4e00\u4e9b\u7ba1\u7406\u5de5\u5177\uff0c\u4f8b\u5982mogadm\u7b49\u3002 \u7b2c3\u4e2a\u90e8\u5206\u662f\u5ba2\u6237\u7aefAPI\uff0c\u76ee\u524d\u53ea\u6709Perl API(MogileFS.pm)\u3001PHP\uff0c\u7528\u8fd9\u4e2a\u6a21\u5757\u53ef\u4ee5\u7f16\u5199\u5ba2\u6237\u7aef\u7a0b\u5e8f\uff0c\u5b9e\u73b0\u6587\u4ef6\u7684\u5907\u4efd\u7ba1\u7406\u529f\u80fd\u3002","title":"6. MogileFS"},{"location":"linux/distributed_storage/distributed_storage.info/#7-tfs","text":"TFS\uff08Taobao !FileSystem\uff09\u662f\u4e00\u4e2a\u9ad8\u53ef\u6269\u5c55\u3001\u9ad8\u53ef\u7528\u3001\u9ad8\u6027\u80fd\u3001\u9762\u5411\u4e92\u8054\u7f51\u670d\u52a1\u7684\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u4e3b\u8981\u9488\u5bf9\u6d77\u91cf\u7684\u975e\u7ed3\u6784\u5316\u6570\u636e\uff0c\u5b83\u6784\u7b51\u5728\u666e\u901a\u7684Linux\u673a\u5668 \u96c6\u7fa4\u4e0a\uff0c\u53ef\u4e3a\u5916\u90e8\u63d0\u4f9b\u9ad8\u53ef\u9760\u548c\u9ad8\u5e76\u53d1\u7684\u5b58\u50a8\u8bbf\u95ee\u3002TFS\u4e3a\u6dd8\u5b9d\u63d0\u4f9b\u6d77\u91cf\u5c0f\u6587\u4ef6\u5b58\u50a8\uff0c\u901a\u5e38\u6587\u4ef6\u5927\u5c0f\u4e0d\u8d85\u8fc71M\uff0c\u6ee1\u8db3\u4e86\u6dd8\u5b9d\u5bf9\u5c0f\u6587\u4ef6\u5b58\u50a8\u7684\u9700\u6c42\uff0c\u88ab\u5e7f\u6cdb\u5730\u5e94\u7528 \u5728\u6dd8\u5b9d\u5404\u9879\u5e94\u7528\u4e2d\u3002\u5b83\u91c7\u7528\u4e86HA\u67b6\u6784\u548c\u5e73\u6ed1\u6269\u5bb9\uff0c\u4fdd\u8bc1\u4e86\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u53ef\u7528\u6027\u548c\u6269\u5c55\u6027\u3002\u540c\u65f6\u6241\u5e73\u5316\u7684\u6570\u636e\u7ec4\u7ec7\u7ed3\u6784\uff0c\u53ef\u5c06\u6587\u4ef6\u540d\u6620\u5c04\u5230\u6587\u4ef6\u7684\u7269\u7406\u5730\u5740\uff0c\u7b80\u5316 \u4e86\u6587\u4ef6\u7684\u8bbf\u95ee\u6d41\u7a0b\uff0c\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u4e3aTFS\u63d0\u4f9b\u4e86\u826f\u597d\u7684\u8bfb\u5199\u6027\u80fd\u3002","title":"7. TFS"},{"location":"linux/nginx/nginx.conf/","text":"Nginx \u914d\u7f6e\u6587\u4ef6 1. nginx\u6587\u4ef6 \u00b6 [root@master nginx]# tree . . \u251c\u2500\u2500 client_body_temp # \u5ba2\u6237\u7aef\u5185\u5bb9\u4e34\u65f6\u6587\u4ef6 \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 fastcgi.conf # \u52a8\u6001\u914d\u7f6e\u6587\u4ef6 \u2502 \u251c\u2500\u2500 fastcgi.conf.default \u2502 \u251c\u2500\u2500 fastcgi_params # \u52a8\u6001\u53c2\u6570 \u2502 \u251c\u2500\u2500 fastcgi_params.default \u2502 \u251c\u2500\u2500 koi-utf \u2502 \u251c\u2500\u2500 koi-win \u2502 \u251c\u2500\u2500 mime.types \u2502 \u251c\u2500\u2500 mime.types.default \u2502 \u251c\u2500\u2500 nginx.conf # \u76f8\u5f53\u4e8eapache\u7684httpd.conf \uff0c\u9ed8\u8ba4\u4e3b\u914d\u7f6e\u6587\u4ef6\u3002\u9759\u6001\uff0c \u2502 \u251c\u2500\u2500 nginx.conf.default # nginx.conf\u539f\u59cb\u6587\u4ef6 \u2502 \u251c\u2500\u2500 scgi_params \u2502 \u251c\u2500\u2500 scgi_params.default \u2502 \u251c\u2500\u2500 uwsgi_params \u2502 \u251c\u2500\u2500 uwsgi_params.default \u2502 \u2514\u2500\u2500 win-utf \u251c\u2500\u2500 fastcgi_temp \u251c\u2500\u2500 html # \u9ed8\u8ba4\u7ad9\u70b9\u76ee\u5f55\uff0c\u7c7b\u4f3capache\u7684htdoc \u2502 \u251c\u2500\u2500 50x.html # 50x\u9875\u9762 \u2502 \u2514\u2500\u2500 index.html # \u9ed8\u8ba4\u7684\u9996\u9875\u6587\u4ef6\uff0c\u5728\u5b9e\u9645\u73af\u5883\u4e2d\uff0c\u5927\u5bb6\u4e60\u60ef\uff08\u6ce8\u610f\u5b57\u773c\u4e0d\u662f\u5fc5\u987b\u7684\uff09index.html\u3001index.php # index.jsp\u6765\u505a\u7f51\u7ad9\u7684\u9996\u9875\u6587\u4ef6\uff0c\u9996\u9875\u6587\u4ef6\u662f\u5728nginx.conf\u4e2d\u4e8b\u5148\u5b9a\u4e49\u597d\u7684\u3002\u5177\u4f53\u53c2\u6570\u4e3a ind # index index.html index.htm \u6ce8\u610f\u4e0eapache\u7684\u53c2\u6570\u4e0d\u540c\uff0cDirectory index.html index.htm \u251c\u2500\u2500 logs # \u65e5\u5fd7\u6587\u4ef6\u5939 \u2502 \u251c\u2500\u2500 access.log # \u8bbf\u95ee\u65e5\u5fd7 \u2502 \u251c\u2500\u2500 error.log # \u9519\u8bef\u65e5\u5fd7 \u2502 \u2514\u2500\u2500 nginx.pid # nginx pid\u6587\u4ef6 \u251c\u2500\u2500 proxy_temp \u251c\u2500\u2500 sbin \u2502 \u2514\u2500\u2500 nginx # \u542f\u52a8\u6587\u4ef6 \u251c\u2500\u2500 scgi_temp \u2514\u2500\u2500 uwsgi_temp \u89e3\u91ca Nginx\u7684\u914d\u7f6e\u6587\u4ef6\u662f\u4e00\u4e2a\u7eaf\u6587\u4ef6\u6587\u4ef6 \uff0c\u5b83\u4f4d\u4e8e nginx\u7684\u5b89\u88c5\u76ee\u5f55\u7684conf\u76ee\u5f55\u4e0b \uff0c \u6574\u4e2a\u914d\u7f6e\u6587\u4ef6\u662f\u4ee5\u5757\u7684\u5f62\u5f0f\u7ec4\u7ec7\u7684\uff0c\u6bcf\u4e2a\u5757\u4e00\u822c\u662f\u4ee5\u4e00\u4e2a\u201c {} \u201d\u6765\u8868\u793a\uff0c\u5757\u53ef\u4ee5\u5206\u4e3a\u51e0\u4e2a\u5c42\u6b21\uff0c \u6574\u4e2a\u914d\u7f6e\u6587\u4ef6\u4e2d mian\u6307\u4ee4\u4f4d\u4e8e\u6700\u9ad8\u5c42 \uff0c\u5728 mian\u5c42\u4e0b\u9762\u53ef\u4ee5\u6709Events \uff0c HTTP\u7b49\u5c42\u7ea7 \uff0c \u800c\u5728 HTTP\u5c42\u4e2d\u53c8\u5305\u542b\u6709sever\u5c42 \uff0c\u5373\u662f sever block \uff0c sever block\u4e2d\u53c8\u53ef\u4ee5\u5206location\u5c42 \uff0c \u5e76\u4e14\u4e00\u4e2a sever block\u949f\u53ef\u4ee5\u5305\u542b\u591a\u4e2alocation block \u3002 2. nginx \u914d\u7f6e\u6587\u4ef6\u8be6\u89e3 \u00b6 #\u5b9a\u4e49Nginx\u8fd0\u884c\u7684\u7528\u6237\u548c\u7528\u6237\u7ec4 user nginx nginx; # \u9ed8\u8ba4\u7528\u6237\u6570nobody apache\u9ed8\u8ba4\u7528\u6237\u662fdaemon # nginx\u8fdb\u7a0b\u6570\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e3a\u7b49\u4e8eCPU\u603b\u6838\u5fc3\u6570\u3002 #\u770bcpu\u4e2a\u6570cat /proc/cpuinfo |grep processor|wc -l worker_processes 4; #\u5168\u5c40\u9519\u8bef\u65e5\u5fd7\u5b9a\u4e49\u7c7b\u578b\uff0c[ debug | info | notice | warn | error | crit ] error_log logs/loginx/error.log info; # \u8fdb\u7a0b\u6587\u4ef6 pid ar/runinx.pid; # \u4e00\u4e2anginx\u8fdb\u7a0b\u6253\u5f00\u7684\u6700\u591a\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u76ee\uff0c\u7406\u8bba\u503c\u5e94\u8be5\u662f\u6700\u591a\u6253\u5f00\u6587\u4ef6\u6570\uff08\u7cfb\u7edf\u7684\u503culimit -n\uff09\u4e0enginx\u8fdb\u7a0b\u6570\u76f8\u9664\uff0c\u4f46\u662fnginx\u5206\u914d\u8bf7\u6c42\u5e76\u4e0d\u5747\u5300\uff0c\u6240\u4ee5\u5efa\u8bae\u4e0eulimit -n\u7684\u503c\u4fdd\u6301\u4e00\u81f4\u3002 worker_rlimit_nofile 65535; # \u5de5\u4f5c\u6a21\u5f0f\u4e0e\u8fde\u63a5\u6570\u4e0a\u9650 events { #\u53c2\u8003\u4e8b\u4ef6\u6a21\u578b\uff0cuse [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll\u6a21\u578b\u662fLinux 2.6\u4ee5\u4e0a\u7248\u672c\u5185\u6838\u4e2d\u7684\u9ad8\u6027\u80fd\u7f51\u7edcI/O\u6a21\u578b\uff0c\u5982\u679c\u8dd1\u5728FreeBSD\u4e0a\u9762\uff0c\u5c31\u7528kqueue\u6a21\u578b\u3002 use epoll; #\u5355\u4e2a\u8fdb\u7a0b\u6700\u5927\u8fde\u63a5\u6570\uff08\u6700\u5927\u8fde\u63a5\u6570=\u8fde\u63a5\u6570*\u8fdb\u7a0b\u6570\uff09 worker_connections 65535; } #\u8bbe\u5b9ahttp\u670d\u52a1\u5668 http { include mime.types; # \u6587\u4ef6\u6269\u5c55\u540d\u4e0e\u6587\u4ef6\u7c7b\u578b\u6620\u5c04\u8868 default_type application/octet-stream; # \u9ed8\u8ba4\u6587\u4ef6\u7c7b\u578b #charset utf-8; # \u9ed8\u8ba4\u7f16\u7801 server_names_hash_bucket_size 128; # \u670d\u52a1\u5668\u540d\u5b57\u7684hash\u8868\u5927\u5c0f client_header_buffer_size 32k; # \u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\u9650\u5236 large_client_header_buffers 4 64k; # \u8bbe\u5b9a\u8bf7\u6c42\u7f13 client_max_body_size 8m; # \u8bbe\u5b9a\u8bf7\u6c42\u7f13 sendfile on; # \u5f00\u542f\u9ad8\u6548\u6587\u4ef6\u4f20\u8f93\u6a21\u5f0f\uff0csendfile\u6307\u4ee4\u6307\u5b9anginx\u662f\u5426\u8c03\u7528sendfile\u51fd\u6570\u6765\u8f93\u51fa\u6587\u4ef6\uff0c\u5bf9\u4e8e\u666e\u901a\u5e94\u7528\u8bbe\u4e3a on\uff0c\u5982\u679c\u7528\u6765\u8fdb\u884c\u4e0b\u8f7d\u7b49\u5e94\u7528\u78c1\u76d8IO\u91cd\u8d1f\u8f7d\u5e94\u7528\uff0c\u53ef\u8bbe\u7f6e\u4e3aoff\uff0c\u4ee5\u5e73\u8861\u78c1\u76d8\u4e0e\u7f51\u7edcI/O\u5904\u7406\u901f\u5ea6\uff0c\u964d\u4f4e\u7cfb\u7edf\u7684\u8d1f\u8f7d\u3002\u6ce8\u610f\uff1a\u5982\u679c\u56fe\u7247\u663e\u793a\u4e0d\u6b63\u5e38\u628a\u8fd9\u4e2a\u6539\u6210off\u3002 autoindex on; # \u5f00\u542f\u76ee\u5f55\u5217\u8868\u8bbf\u95ee\uff0c\u5408\u9002\u4e0b\u8f7d\u670d\u52a1\u5668\uff0c\u9ed8\u8ba4\u5173\u95ed\u3002 tcp_nopush on; # \u9632\u6b62\u7f51\u7edc\u963b\u585e tcp_nodelay on; # \u9632\u6b62\u7f51\u7edc\u963b\u585e keepalive_timeout 120; # \u957f\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u79d2 # FastCGI\u76f8\u5173\u53c2\u6570\u662f\u4e3a\u4e86\u6539\u5584\u7f51\u7ad9\u7684\u6027\u80fd\uff1a\u51cf\u5c11\u8d44\u6e90\u5360\u7528\uff0c\u63d0\u9ad8\u8bbf\u95ee\u901f\u5ea6\u3002\u4e0b\u9762\u53c2\u6570\u770b\u5b57\u9762\u610f\u601d\u90fd\u80fd\u7406\u89e3\u3002 fastcgi_connect_timeout 300; fastcgi_send_timeout 300; fastcgi_read_timeout 300; fastcgi_buffer_size 64k; fastcgi_buffers 4 64k; fastcgi_busy_buffers_size 128k; fastcgi_temp_file_write_size 128k; # gzip\u6a21\u5757\u8bbe\u7f6e gzip on; # \u5f00\u542fgzip\u538b\u7f29\u8f93\u51fa gzip_min_length 1k; # \u6700\u5c0f\u538b\u7f29\u6587\u4ef6\u5927\u5c0f gzip_buffers 4 16k; # \u538b\u7f29\u7f13\u51b2\u533a gzip_http_version 1.0; # \u538b\u7f29\u7248\u672c\uff08\u9ed8\u8ba41.1\uff0c\u524d\u7aef\u5982\u679c\u662fsquid2.5\u8bf7\u4f7f\u75281.0\uff09 gzip_comp_level 2; # \u538b\u7f29\u7b49\u7ea7 gzip_types text/plain application/x-javascript text/css application/xml; #\u538b\u7f29\u7c7b\u578b\uff0c\u9ed8\u8ba4\u5c31\u5df2\u7ecf\u5305\u542btextml\uff0c\u6240\u4ee5\u4e0b\u9762\u5c31\u4e0d\u7528\u518d\u5199\u4e86\uff0c\u5199\u4e0a\u53bb\u4e5f\u4e0d\u4f1a\u6709\u95ee\u9898\uff0c\u4f46\u662f\u4f1a\u6709\u4e00\u4e2awarn\u3002 gzip_vary on; #limit_zone crawler $binary_remote_addr 10m; # \u5f00\u542f\u9650\u5236IP\u8fde\u63a5\u6570\u7684\u65f6\u5019\u9700\u8981\u4f7f\u7528 upstream blog.ha97.com { # upstream\u7684\u8d1f\u8f7d\u5747\u8861\uff0cweight\u662f\u6743\u91cd\uff0c\u53ef\u4ee5\u6839\u636e\u673a\u5668\u914d\u7f6e\u5b9a\u4e49\u6743\u91cd\u3002weigth\u53c2\u6570\u8868\u793a\u6743\u503c\uff0c\u6743\u503c\u8d8a\u9ad8\u88ab\u5206\u914d\u5230\u7684\u51e0\u7387\u8d8a\u5927\u3002 server 192.168.80.121:80 weight=3; server 192.168.80.122:80 weight=2; server 192.168.80.123:80 weight=3; } # \u865a\u62df\u4e3b\u673a\u7684\u914d\u7f6e server { # \u76d1\u542c\u7aef\u53e3 listen 80; # \u57df\u540d\u53ef\u4ee5\u6709\u591a\u4e2a\uff0c\u7528\u7a7a\u683c\u9694\u5f00 server_name www.ha97.com ha97.com; index index.html index.htm index.php; root /data/www/ha97; location ~ .*.(php|php5)?$ { fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; include fastcgi.conf; } # \u56fe\u7247\u7f13\u5b58\u65f6\u95f4\u8bbe\u7f6e location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$ { expires 10d; } # JS\u548cCSS\u7f13\u5b58\u65f6\u95f4\u8bbe\u7f6e location ~ .*.(js|css)?$ { expires 1h; } # \u65e5\u5fd7\u683c\u5f0f\u8bbe\u5b9a log_format access '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" $http_x_forwarded_for'; # \u5b9a\u4e49\u672c\u865a\u62df\u4e3b\u673a\u7684\u8bbf\u95ee\u65e5\u5fd7 access_log ar/loginx/ha97access.log access; # \u5bf9 \"/\" \u542f\u7528\u53cd\u5411\u4ee3\u7406 location / { proxy_pass http://127.0.0.1:88; proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; # \u540e\u7aef\u7684Web\u670d\u52a1\u5668\u53ef\u4ee5\u901a\u8fc7X-Forwarded-For\u83b7\u53d6\u7528\u6237\u771f\u5b9eIP proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # \u4ee5\u4e0b\u662f\u4e00\u4e9b\u53cd\u5411\u4ee3\u7406\u7684\u914d\u7f6e\uff0c\u53ef\u9009\u3002 proxy_set_header Host $host; client_max_body_size 10m; #\u5141\u8bb8\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u6700\u5927\u5355\u6587\u4ef6\u5b57\u8282\u6570 client_body_buffer_size 128k; #\u7f13\u51b2\u533a\u4ee3\u7406\u7f13\u51b2\u7528\u6237\u7aef\u8bf7\u6c42\u7684\u6700\u5927\u5b57\u8282\u6570\uff0c proxy_connect_timeout 90; #nginx\u8ddf\u540e\u7aef\u670d\u52a1\u5668\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4(\u4ee3\u7406\u8fde\u63a5\u8d85\u65f6) proxy_send_timeout 90; #\u540e\u7aef\u670d\u52a1\u5668\u6570\u636e\u56de\u4f20\u65f6\u95f4(\u4ee3\u7406\u53d1\u9001\u8d85\u65f6) proxy_read_timeout 90; #\u8fde\u63a5\u6210\u529f\u540e\uff0c\u540e\u7aef\u670d\u52a1\u5668\u54cd\u5e94\u65f6\u95f4(\u4ee3\u7406\u63a5\u6536\u8d85\u65f6) proxy_buffer_size 4k; #\u8bbe\u7f6e\u4ee3\u7406\u670d\u52a1\u5668\uff08nginx\uff09\u4fdd\u5b58\u7528\u6237\u5934\u4fe1\u606f\u7684\u7f13\u51b2\u533a\u5927\u5c0f proxy_buffers 4 32k; #proxy_buffers\u7f13\u51b2\u533a\uff0c\u7f51\u9875\u5e73\u5747\u572832k\u4ee5\u4e0b\u7684\u8bbe\u7f6e proxy_busy_buffers_size 64k; #\u9ad8\u8d1f\u8377\u4e0b\u7f13\u51b2\u5927\u5c0f\uff08proxy_buffers*2\uff09 proxy_temp_file_write_size 64k; #\u8bbe\u5b9a\u7f13\u5b58\u6587\u4ef6\u5939\u5927\u5c0f\uff0c\u5927\u4e8e\u8fd9\u4e2a\u503c\uff0c\u5c06\u4eceupstream\u670d\u52a1\u5668\u4f20 } #\u8bbe\u5b9a\u67e5\u770bNginx\u72b6\u6001\u7684\u5730\u5740 location /NginxStatus { stub_status on; access_log on; auth_basic \"NginxStatus\"; auth_basic_user_file confpasswd; #htpasswd\u6587\u4ef6\u7684\u5185\u5bb9\u53ef\u4ee5\u7528apache\u63d0\u4f9b\u7684htpasswd\u5de5\u5177\u6765\u4ea7\u751f\u3002 } #\u672c\u5730\u52a8\u9759\u5206\u79bb\u53cd\u5411\u4ee3\u7406\u914d\u7f6e #\u6240\u6709jsp\u7684\u9875\u9762\u5747\u4ea4\u7531tomcat\u6216resin\u5904\u7406 location ~ .(jsp|jspx|do)?$ { proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://127.0.0.1:8080; } #\u6240\u6709\u9759\u6001\u6587\u4ef6\u7531nginx\u76f4\u63a5\u8bfb\u53d6\u4e0d\u7ecf\u8fc7tomcat\u6216resin location ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$ { expires 15d; } location ~ .*.(js|css)?$ { expires 1h; } }","title":"02. nginx \u914d\u7f6e\u6587\u4ef6"},{"location":"linux/nginx/nginx.conf/#1-nginx","text":"[root@master nginx]# tree . . \u251c\u2500\u2500 client_body_temp # \u5ba2\u6237\u7aef\u5185\u5bb9\u4e34\u65f6\u6587\u4ef6 \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 fastcgi.conf # \u52a8\u6001\u914d\u7f6e\u6587\u4ef6 \u2502 \u251c\u2500\u2500 fastcgi.conf.default \u2502 \u251c\u2500\u2500 fastcgi_params # \u52a8\u6001\u53c2\u6570 \u2502 \u251c\u2500\u2500 fastcgi_params.default \u2502 \u251c\u2500\u2500 koi-utf \u2502 \u251c\u2500\u2500 koi-win \u2502 \u251c\u2500\u2500 mime.types \u2502 \u251c\u2500\u2500 mime.types.default \u2502 \u251c\u2500\u2500 nginx.conf # \u76f8\u5f53\u4e8eapache\u7684httpd.conf \uff0c\u9ed8\u8ba4\u4e3b\u914d\u7f6e\u6587\u4ef6\u3002\u9759\u6001\uff0c \u2502 \u251c\u2500\u2500 nginx.conf.default # nginx.conf\u539f\u59cb\u6587\u4ef6 \u2502 \u251c\u2500\u2500 scgi_params \u2502 \u251c\u2500\u2500 scgi_params.default \u2502 \u251c\u2500\u2500 uwsgi_params \u2502 \u251c\u2500\u2500 uwsgi_params.default \u2502 \u2514\u2500\u2500 win-utf \u251c\u2500\u2500 fastcgi_temp \u251c\u2500\u2500 html # \u9ed8\u8ba4\u7ad9\u70b9\u76ee\u5f55\uff0c\u7c7b\u4f3capache\u7684htdoc \u2502 \u251c\u2500\u2500 50x.html # 50x\u9875\u9762 \u2502 \u2514\u2500\u2500 index.html # \u9ed8\u8ba4\u7684\u9996\u9875\u6587\u4ef6\uff0c\u5728\u5b9e\u9645\u73af\u5883\u4e2d\uff0c\u5927\u5bb6\u4e60\u60ef\uff08\u6ce8\u610f\u5b57\u773c\u4e0d\u662f\u5fc5\u987b\u7684\uff09index.html\u3001index.php # index.jsp\u6765\u505a\u7f51\u7ad9\u7684\u9996\u9875\u6587\u4ef6\uff0c\u9996\u9875\u6587\u4ef6\u662f\u5728nginx.conf\u4e2d\u4e8b\u5148\u5b9a\u4e49\u597d\u7684\u3002\u5177\u4f53\u53c2\u6570\u4e3a ind # index index.html index.htm \u6ce8\u610f\u4e0eapache\u7684\u53c2\u6570\u4e0d\u540c\uff0cDirectory index.html index.htm \u251c\u2500\u2500 logs # \u65e5\u5fd7\u6587\u4ef6\u5939 \u2502 \u251c\u2500\u2500 access.log # \u8bbf\u95ee\u65e5\u5fd7 \u2502 \u251c\u2500\u2500 error.log # \u9519\u8bef\u65e5\u5fd7 \u2502 \u2514\u2500\u2500 nginx.pid # nginx pid\u6587\u4ef6 \u251c\u2500\u2500 proxy_temp \u251c\u2500\u2500 sbin \u2502 \u2514\u2500\u2500 nginx # \u542f\u52a8\u6587\u4ef6 \u251c\u2500\u2500 scgi_temp \u2514\u2500\u2500 uwsgi_temp \u89e3\u91ca Nginx\u7684\u914d\u7f6e\u6587\u4ef6\u662f\u4e00\u4e2a\u7eaf\u6587\u4ef6\u6587\u4ef6 \uff0c\u5b83\u4f4d\u4e8e nginx\u7684\u5b89\u88c5\u76ee\u5f55\u7684conf\u76ee\u5f55\u4e0b \uff0c \u6574\u4e2a\u914d\u7f6e\u6587\u4ef6\u662f\u4ee5\u5757\u7684\u5f62\u5f0f\u7ec4\u7ec7\u7684\uff0c\u6bcf\u4e2a\u5757\u4e00\u822c\u662f\u4ee5\u4e00\u4e2a\u201c {} \u201d\u6765\u8868\u793a\uff0c\u5757\u53ef\u4ee5\u5206\u4e3a\u51e0\u4e2a\u5c42\u6b21\uff0c \u6574\u4e2a\u914d\u7f6e\u6587\u4ef6\u4e2d mian\u6307\u4ee4\u4f4d\u4e8e\u6700\u9ad8\u5c42 \uff0c\u5728 mian\u5c42\u4e0b\u9762\u53ef\u4ee5\u6709Events \uff0c HTTP\u7b49\u5c42\u7ea7 \uff0c \u800c\u5728 HTTP\u5c42\u4e2d\u53c8\u5305\u542b\u6709sever\u5c42 \uff0c\u5373\u662f sever block \uff0c sever block\u4e2d\u53c8\u53ef\u4ee5\u5206location\u5c42 \uff0c \u5e76\u4e14\u4e00\u4e2a sever block\u949f\u53ef\u4ee5\u5305\u542b\u591a\u4e2alocation block \u3002","title":"1. nginx\u6587\u4ef6"},{"location":"linux/nginx/nginx.conf/#2-nginx","text":"#\u5b9a\u4e49Nginx\u8fd0\u884c\u7684\u7528\u6237\u548c\u7528\u6237\u7ec4 user nginx nginx; # \u9ed8\u8ba4\u7528\u6237\u6570nobody apache\u9ed8\u8ba4\u7528\u6237\u662fdaemon # nginx\u8fdb\u7a0b\u6570\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e3a\u7b49\u4e8eCPU\u603b\u6838\u5fc3\u6570\u3002 #\u770bcpu\u4e2a\u6570cat /proc/cpuinfo |grep processor|wc -l worker_processes 4; #\u5168\u5c40\u9519\u8bef\u65e5\u5fd7\u5b9a\u4e49\u7c7b\u578b\uff0c[ debug | info | notice | warn | error | crit ] error_log logs/loginx/error.log info; # \u8fdb\u7a0b\u6587\u4ef6 pid ar/runinx.pid; # \u4e00\u4e2anginx\u8fdb\u7a0b\u6253\u5f00\u7684\u6700\u591a\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u76ee\uff0c\u7406\u8bba\u503c\u5e94\u8be5\u662f\u6700\u591a\u6253\u5f00\u6587\u4ef6\u6570\uff08\u7cfb\u7edf\u7684\u503culimit -n\uff09\u4e0enginx\u8fdb\u7a0b\u6570\u76f8\u9664\uff0c\u4f46\u662fnginx\u5206\u914d\u8bf7\u6c42\u5e76\u4e0d\u5747\u5300\uff0c\u6240\u4ee5\u5efa\u8bae\u4e0eulimit -n\u7684\u503c\u4fdd\u6301\u4e00\u81f4\u3002 worker_rlimit_nofile 65535; # \u5de5\u4f5c\u6a21\u5f0f\u4e0e\u8fde\u63a5\u6570\u4e0a\u9650 events { #\u53c2\u8003\u4e8b\u4ef6\u6a21\u578b\uff0cuse [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll\u6a21\u578b\u662fLinux 2.6\u4ee5\u4e0a\u7248\u672c\u5185\u6838\u4e2d\u7684\u9ad8\u6027\u80fd\u7f51\u7edcI/O\u6a21\u578b\uff0c\u5982\u679c\u8dd1\u5728FreeBSD\u4e0a\u9762\uff0c\u5c31\u7528kqueue\u6a21\u578b\u3002 use epoll; #\u5355\u4e2a\u8fdb\u7a0b\u6700\u5927\u8fde\u63a5\u6570\uff08\u6700\u5927\u8fde\u63a5\u6570=\u8fde\u63a5\u6570*\u8fdb\u7a0b\u6570\uff09 worker_connections 65535; } #\u8bbe\u5b9ahttp\u670d\u52a1\u5668 http { include mime.types; # \u6587\u4ef6\u6269\u5c55\u540d\u4e0e\u6587\u4ef6\u7c7b\u578b\u6620\u5c04\u8868 default_type application/octet-stream; # \u9ed8\u8ba4\u6587\u4ef6\u7c7b\u578b #charset utf-8; # \u9ed8\u8ba4\u7f16\u7801 server_names_hash_bucket_size 128; # \u670d\u52a1\u5668\u540d\u5b57\u7684hash\u8868\u5927\u5c0f client_header_buffer_size 32k; # \u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\u9650\u5236 large_client_header_buffers 4 64k; # \u8bbe\u5b9a\u8bf7\u6c42\u7f13 client_max_body_size 8m; # \u8bbe\u5b9a\u8bf7\u6c42\u7f13 sendfile on; # \u5f00\u542f\u9ad8\u6548\u6587\u4ef6\u4f20\u8f93\u6a21\u5f0f\uff0csendfile\u6307\u4ee4\u6307\u5b9anginx\u662f\u5426\u8c03\u7528sendfile\u51fd\u6570\u6765\u8f93\u51fa\u6587\u4ef6\uff0c\u5bf9\u4e8e\u666e\u901a\u5e94\u7528\u8bbe\u4e3a on\uff0c\u5982\u679c\u7528\u6765\u8fdb\u884c\u4e0b\u8f7d\u7b49\u5e94\u7528\u78c1\u76d8IO\u91cd\u8d1f\u8f7d\u5e94\u7528\uff0c\u53ef\u8bbe\u7f6e\u4e3aoff\uff0c\u4ee5\u5e73\u8861\u78c1\u76d8\u4e0e\u7f51\u7edcI/O\u5904\u7406\u901f\u5ea6\uff0c\u964d\u4f4e\u7cfb\u7edf\u7684\u8d1f\u8f7d\u3002\u6ce8\u610f\uff1a\u5982\u679c\u56fe\u7247\u663e\u793a\u4e0d\u6b63\u5e38\u628a\u8fd9\u4e2a\u6539\u6210off\u3002 autoindex on; # \u5f00\u542f\u76ee\u5f55\u5217\u8868\u8bbf\u95ee\uff0c\u5408\u9002\u4e0b\u8f7d\u670d\u52a1\u5668\uff0c\u9ed8\u8ba4\u5173\u95ed\u3002 tcp_nopush on; # \u9632\u6b62\u7f51\u7edc\u963b\u585e tcp_nodelay on; # \u9632\u6b62\u7f51\u7edc\u963b\u585e keepalive_timeout 120; # \u957f\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u79d2 # FastCGI\u76f8\u5173\u53c2\u6570\u662f\u4e3a\u4e86\u6539\u5584\u7f51\u7ad9\u7684\u6027\u80fd\uff1a\u51cf\u5c11\u8d44\u6e90\u5360\u7528\uff0c\u63d0\u9ad8\u8bbf\u95ee\u901f\u5ea6\u3002\u4e0b\u9762\u53c2\u6570\u770b\u5b57\u9762\u610f\u601d\u90fd\u80fd\u7406\u89e3\u3002 fastcgi_connect_timeout 300; fastcgi_send_timeout 300; fastcgi_read_timeout 300; fastcgi_buffer_size 64k; fastcgi_buffers 4 64k; fastcgi_busy_buffers_size 128k; fastcgi_temp_file_write_size 128k; # gzip\u6a21\u5757\u8bbe\u7f6e gzip on; # \u5f00\u542fgzip\u538b\u7f29\u8f93\u51fa gzip_min_length 1k; # \u6700\u5c0f\u538b\u7f29\u6587\u4ef6\u5927\u5c0f gzip_buffers 4 16k; # \u538b\u7f29\u7f13\u51b2\u533a gzip_http_version 1.0; # \u538b\u7f29\u7248\u672c\uff08\u9ed8\u8ba41.1\uff0c\u524d\u7aef\u5982\u679c\u662fsquid2.5\u8bf7\u4f7f\u75281.0\uff09 gzip_comp_level 2; # \u538b\u7f29\u7b49\u7ea7 gzip_types text/plain application/x-javascript text/css application/xml; #\u538b\u7f29\u7c7b\u578b\uff0c\u9ed8\u8ba4\u5c31\u5df2\u7ecf\u5305\u542btextml\uff0c\u6240\u4ee5\u4e0b\u9762\u5c31\u4e0d\u7528\u518d\u5199\u4e86\uff0c\u5199\u4e0a\u53bb\u4e5f\u4e0d\u4f1a\u6709\u95ee\u9898\uff0c\u4f46\u662f\u4f1a\u6709\u4e00\u4e2awarn\u3002 gzip_vary on; #limit_zone crawler $binary_remote_addr 10m; # \u5f00\u542f\u9650\u5236IP\u8fde\u63a5\u6570\u7684\u65f6\u5019\u9700\u8981\u4f7f\u7528 upstream blog.ha97.com { # upstream\u7684\u8d1f\u8f7d\u5747\u8861\uff0cweight\u662f\u6743\u91cd\uff0c\u53ef\u4ee5\u6839\u636e\u673a\u5668\u914d\u7f6e\u5b9a\u4e49\u6743\u91cd\u3002weigth\u53c2\u6570\u8868\u793a\u6743\u503c\uff0c\u6743\u503c\u8d8a\u9ad8\u88ab\u5206\u914d\u5230\u7684\u51e0\u7387\u8d8a\u5927\u3002 server 192.168.80.121:80 weight=3; server 192.168.80.122:80 weight=2; server 192.168.80.123:80 weight=3; } # \u865a\u62df\u4e3b\u673a\u7684\u914d\u7f6e server { # \u76d1\u542c\u7aef\u53e3 listen 80; # \u57df\u540d\u53ef\u4ee5\u6709\u591a\u4e2a\uff0c\u7528\u7a7a\u683c\u9694\u5f00 server_name www.ha97.com ha97.com; index index.html index.htm index.php; root /data/www/ha97; location ~ .*.(php|php5)?$ { fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; include fastcgi.conf; } # \u56fe\u7247\u7f13\u5b58\u65f6\u95f4\u8bbe\u7f6e location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$ { expires 10d; } # JS\u548cCSS\u7f13\u5b58\u65f6\u95f4\u8bbe\u7f6e location ~ .*.(js|css)?$ { expires 1h; } # \u65e5\u5fd7\u683c\u5f0f\u8bbe\u5b9a log_format access '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" $http_x_forwarded_for'; # \u5b9a\u4e49\u672c\u865a\u62df\u4e3b\u673a\u7684\u8bbf\u95ee\u65e5\u5fd7 access_log ar/loginx/ha97access.log access; # \u5bf9 \"/\" \u542f\u7528\u53cd\u5411\u4ee3\u7406 location / { proxy_pass http://127.0.0.1:88; proxy_redirect off; proxy_set_header X-Real-IP $remote_addr; # \u540e\u7aef\u7684Web\u670d\u52a1\u5668\u53ef\u4ee5\u901a\u8fc7X-Forwarded-For\u83b7\u53d6\u7528\u6237\u771f\u5b9eIP proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # \u4ee5\u4e0b\u662f\u4e00\u4e9b\u53cd\u5411\u4ee3\u7406\u7684\u914d\u7f6e\uff0c\u53ef\u9009\u3002 proxy_set_header Host $host; client_max_body_size 10m; #\u5141\u8bb8\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u6700\u5927\u5355\u6587\u4ef6\u5b57\u8282\u6570 client_body_buffer_size 128k; #\u7f13\u51b2\u533a\u4ee3\u7406\u7f13\u51b2\u7528\u6237\u7aef\u8bf7\u6c42\u7684\u6700\u5927\u5b57\u8282\u6570\uff0c proxy_connect_timeout 90; #nginx\u8ddf\u540e\u7aef\u670d\u52a1\u5668\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4(\u4ee3\u7406\u8fde\u63a5\u8d85\u65f6) proxy_send_timeout 90; #\u540e\u7aef\u670d\u52a1\u5668\u6570\u636e\u56de\u4f20\u65f6\u95f4(\u4ee3\u7406\u53d1\u9001\u8d85\u65f6) proxy_read_timeout 90; #\u8fde\u63a5\u6210\u529f\u540e\uff0c\u540e\u7aef\u670d\u52a1\u5668\u54cd\u5e94\u65f6\u95f4(\u4ee3\u7406\u63a5\u6536\u8d85\u65f6) proxy_buffer_size 4k; #\u8bbe\u7f6e\u4ee3\u7406\u670d\u52a1\u5668\uff08nginx\uff09\u4fdd\u5b58\u7528\u6237\u5934\u4fe1\u606f\u7684\u7f13\u51b2\u533a\u5927\u5c0f proxy_buffers 4 32k; #proxy_buffers\u7f13\u51b2\u533a\uff0c\u7f51\u9875\u5e73\u5747\u572832k\u4ee5\u4e0b\u7684\u8bbe\u7f6e proxy_busy_buffers_size 64k; #\u9ad8\u8d1f\u8377\u4e0b\u7f13\u51b2\u5927\u5c0f\uff08proxy_buffers*2\uff09 proxy_temp_file_write_size 64k; #\u8bbe\u5b9a\u7f13\u5b58\u6587\u4ef6\u5939\u5927\u5c0f\uff0c\u5927\u4e8e\u8fd9\u4e2a\u503c\uff0c\u5c06\u4eceupstream\u670d\u52a1\u5668\u4f20 } #\u8bbe\u5b9a\u67e5\u770bNginx\u72b6\u6001\u7684\u5730\u5740 location /NginxStatus { stub_status on; access_log on; auth_basic \"NginxStatus\"; auth_basic_user_file confpasswd; #htpasswd\u6587\u4ef6\u7684\u5185\u5bb9\u53ef\u4ee5\u7528apache\u63d0\u4f9b\u7684htpasswd\u5de5\u5177\u6765\u4ea7\u751f\u3002 } #\u672c\u5730\u52a8\u9759\u5206\u79bb\u53cd\u5411\u4ee3\u7406\u914d\u7f6e #\u6240\u6709jsp\u7684\u9875\u9762\u5747\u4ea4\u7531tomcat\u6216resin\u5904\u7406 location ~ .(jsp|jspx|do)?$ { proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://127.0.0.1:8080; } #\u6240\u6709\u9759\u6001\u6587\u4ef6\u7531nginx\u76f4\u63a5\u8bfb\u53d6\u4e0d\u7ecf\u8fc7tomcat\u6216resin location ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$ { expires 15d; } location ~ .*.(js|css)?$ { expires 1h; } }","title":"2. nginx \u914d\u7f6e\u6587\u4ef6\u8be6\u89e3"},{"location":"linux/nginx/nginx.hash/","text":"Nginx hash 1. hash \u00b6 nginx\u7684\u8d1f\u8f7d\u5747\u8861\u65f6\u6709\u4e00\u4e2ahash $request_uri\u7684\u9009\u9879\uff0c\u8fd9\u4e2a\u662f\u7c7b\u4f3c\u4e8eLVS\u7684dh\u3002\u662f\u9488\u5bf9\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684uri\u6765\u505a\u7684\u7ed1\u5b9a\u3002\u8fd9\u6837\u5ba2\u6237\u7aef\u8bbf\u95ee\u540c\u4e00\u4e2auri\u7684\u65f6\u5019\uff0c\u4f1a\u88ab\u5206\u914d\u5230\u540c\u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u53bb\u3002\u8fd9\u6837\u63d0\u9ad8\u4e86\u7f13\u5b58\u7684\u547d\u4e2d\u7387\u3002 \u8fc7\u7a0b\uff1a\u6bcf\u4e2auri\u8fdb\u884chash\u8ba1\u7b97\u5f97\u5230\u4e00\u4e2a\u6570\u503c\uff0c\u8fd9\u4e2a\u6570\u503c\u9664\u4ee5\u6574\u4e2a\u8282\u70b9\u6570\u91cf\u53d6\u4f59\u6570\u3002\uff08\u53d6\u6a21\u7b97\u6cd5\uff09 \u7f3a\u70b9\uff1a\u5982\u679c\u4e00\u4e2a\u8282\u70b9\u6302\u4e86\uff0c\u90a3\u4e48\u6574\u4e2a\u5168\u5c40\u90fd\u4f1a\u4e71\u6389\u3002\u56e0\u4e3a\u6574\u4e2a\u7684\u8282\u70b9\u6570\u53d8\u4e86\uff0c\u56e0\u4e3a\u9664\u6570\u53d8\u4e86\u3002 2. \u4e00\u81f4\u6027hash \u00b6 \u4e00\u81f4\u6027hash\u7684\u91c7\u7528\u7684\u662f\u9664\u6570\u7279\u522b\u5927\uff0c\u5047\u8bbe\u6709\u4e00\u4e2ahash\u73af\u3002\u662f\u4e2a\u95ed\u73af\u3002\u628a32\u4f4d\u4e8c\u8fdb\u5236\u7684\u6574\u6570\u8f6c\u6362\u4e3a\u5341\u8fdb\u5236\u540e\u5747\u5300\u5206\u5e03\u5728\u6574\u4e2a\u73af\u4e0a\u3002hash\u7ed3\u679c\u662f\u9664\u4ee52\u768432\u6b21\u65b9-1\uff08hash\u662f\u9664\u4ee5\uff09. \u90a3\u4e48\u7ed3\u679c\u4e00\u5b9a\u662f\u843d\u5728\u73af\u4e0a\u7684\u3002\u90a3\u4e48\uff0c\u8fd9\u4e2a\u70b9\u9760\u8fd1\u8c01\uff0c\u5c31\u7f13\u5b58\u5728\u8c01\u90a3\u91cc\u3002\u5047\u8bbea\u8282\u70b9\u574f\u4e86\u3002\u90a3\u4e48\u4e0b\u4e00\u6b21\u7684\u8ba1\u7b97\u7ed3\u679c\u5c31\u662f\u65c1\u8fb9\u7684\u90bb\u5c45\u3002\u4f46\u662f\u90bb\u5c45\u7684\u7f13\u5b58\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\u3002\u53ea\u662f\u574f\u6389\u7684A\u8282\u70b9\u4f1a\u4ece\u65b0\u53bb\u7f13\u5b58\u3002 \u5f15\u5165\u865a\u62df\u8282\u70b9\u53ef\u4ee5\u89e3\u51b3\u504f\u659c\u95ee\u9898\u3002\u5728tengine\u7684\u5b98\u65b9\u7f51\u7ad9\u6709\u4e00\u81f4\u6027hash\u7684\u4e00\u4e9b\u8be6\u7ec6\u4ecb\u7ecd\u3002 http://tengine.taobao.org/document_cn/http_upstream_consistent_hash_cn.html 3. \u8f6c\u79fb \u00b6 \u5982\u679c\u540e\u7aef\u4e3b\u673a\u5b95\u673a\uff0c\u8bf7\u6c42\u4f1a\u79fb\u52a8\u5230\u5176\u4ed6\u7684\u8282\u70b9\u4e0a\u53bb\u3002 \u6709\u4e09\u79cdhash\u65b9\u5f0f\u3002 consistent_hash $remote_addr\uff1a\u53ef\u4ee5\u6839\u636e\u5ba2\u6237\u7aefip\u6620\u5c04 consistent_hash $request_uri\uff1a \u6839\u636e\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684uri\u6620\u5c04 consistent_hash $args\uff1a\u6839\u636e\u5ba2\u6237\u7aef\u643a\u5e26\u7684\u53c2\u6570\u8fdb\u884c\u6620\u5c04 worker_processes 1; http { upstream test{ consistent_hash $request_uri; server 192.168.1.10:80 id=10 weight=3; server 192.168.1.20:80 id=20 weight=4; server 192.168.1.30:80 id=30 weight=6; } }","title":"08. nginx hash"},{"location":"linux/nginx/nginx.hash/#1-hash","text":"nginx\u7684\u8d1f\u8f7d\u5747\u8861\u65f6\u6709\u4e00\u4e2ahash $request_uri\u7684\u9009\u9879\uff0c\u8fd9\u4e2a\u662f\u7c7b\u4f3c\u4e8eLVS\u7684dh\u3002\u662f\u9488\u5bf9\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684uri\u6765\u505a\u7684\u7ed1\u5b9a\u3002\u8fd9\u6837\u5ba2\u6237\u7aef\u8bbf\u95ee\u540c\u4e00\u4e2auri\u7684\u65f6\u5019\uff0c\u4f1a\u88ab\u5206\u914d\u5230\u540c\u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u53bb\u3002\u8fd9\u6837\u63d0\u9ad8\u4e86\u7f13\u5b58\u7684\u547d\u4e2d\u7387\u3002 \u8fc7\u7a0b\uff1a\u6bcf\u4e2auri\u8fdb\u884chash\u8ba1\u7b97\u5f97\u5230\u4e00\u4e2a\u6570\u503c\uff0c\u8fd9\u4e2a\u6570\u503c\u9664\u4ee5\u6574\u4e2a\u8282\u70b9\u6570\u91cf\u53d6\u4f59\u6570\u3002\uff08\u53d6\u6a21\u7b97\u6cd5\uff09 \u7f3a\u70b9\uff1a\u5982\u679c\u4e00\u4e2a\u8282\u70b9\u6302\u4e86\uff0c\u90a3\u4e48\u6574\u4e2a\u5168\u5c40\u90fd\u4f1a\u4e71\u6389\u3002\u56e0\u4e3a\u6574\u4e2a\u7684\u8282\u70b9\u6570\u53d8\u4e86\uff0c\u56e0\u4e3a\u9664\u6570\u53d8\u4e86\u3002","title":"1. hash"},{"location":"linux/nginx/nginx.hash/#2-hash","text":"\u4e00\u81f4\u6027hash\u7684\u91c7\u7528\u7684\u662f\u9664\u6570\u7279\u522b\u5927\uff0c\u5047\u8bbe\u6709\u4e00\u4e2ahash\u73af\u3002\u662f\u4e2a\u95ed\u73af\u3002\u628a32\u4f4d\u4e8c\u8fdb\u5236\u7684\u6574\u6570\u8f6c\u6362\u4e3a\u5341\u8fdb\u5236\u540e\u5747\u5300\u5206\u5e03\u5728\u6574\u4e2a\u73af\u4e0a\u3002hash\u7ed3\u679c\u662f\u9664\u4ee52\u768432\u6b21\u65b9-1\uff08hash\u662f\u9664\u4ee5\uff09. \u90a3\u4e48\u7ed3\u679c\u4e00\u5b9a\u662f\u843d\u5728\u73af\u4e0a\u7684\u3002\u90a3\u4e48\uff0c\u8fd9\u4e2a\u70b9\u9760\u8fd1\u8c01\uff0c\u5c31\u7f13\u5b58\u5728\u8c01\u90a3\u91cc\u3002\u5047\u8bbea\u8282\u70b9\u574f\u4e86\u3002\u90a3\u4e48\u4e0b\u4e00\u6b21\u7684\u8ba1\u7b97\u7ed3\u679c\u5c31\u662f\u65c1\u8fb9\u7684\u90bb\u5c45\u3002\u4f46\u662f\u90bb\u5c45\u7684\u7f13\u5b58\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\u3002\u53ea\u662f\u574f\u6389\u7684A\u8282\u70b9\u4f1a\u4ece\u65b0\u53bb\u7f13\u5b58\u3002 \u5f15\u5165\u865a\u62df\u8282\u70b9\u53ef\u4ee5\u89e3\u51b3\u504f\u659c\u95ee\u9898\u3002\u5728tengine\u7684\u5b98\u65b9\u7f51\u7ad9\u6709\u4e00\u81f4\u6027hash\u7684\u4e00\u4e9b\u8be6\u7ec6\u4ecb\u7ecd\u3002 http://tengine.taobao.org/document_cn/http_upstream_consistent_hash_cn.html","title":"2. \u4e00\u81f4\u6027hash"},{"location":"linux/nginx/nginx.hash/#3","text":"\u5982\u679c\u540e\u7aef\u4e3b\u673a\u5b95\u673a\uff0c\u8bf7\u6c42\u4f1a\u79fb\u52a8\u5230\u5176\u4ed6\u7684\u8282\u70b9\u4e0a\u53bb\u3002 \u6709\u4e09\u79cdhash\u65b9\u5f0f\u3002 consistent_hash $remote_addr\uff1a\u53ef\u4ee5\u6839\u636e\u5ba2\u6237\u7aefip\u6620\u5c04 consistent_hash $request_uri\uff1a \u6839\u636e\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684uri\u6620\u5c04 consistent_hash $args\uff1a\u6839\u636e\u5ba2\u6237\u7aef\u643a\u5e26\u7684\u53c2\u6570\u8fdb\u884c\u6620\u5c04 worker_processes 1; http { upstream test{ consistent_hash $request_uri; server 192.168.1.10:80 id=10 weight=3; server 192.168.1.20:80 id=20 weight=4; server 192.168.1.30:80 id=30 weight=6; } }","title":"3. \u8f6c\u79fb"},{"location":"linux/nginx/nginx.http2/","text":"Nginx http2\u534f\u8bae 1. \u4ecb\u7ecd \u00b6 HTTP 2.0 \u7684\u4e3b\u8981\u76ee\u6807\u662f\u6539\u8fdb\u4f20\u8f93\u6027\u80fd\uff0c\u5b9e\u73b0\u4f4e\u5ef6\u8fdf\u548c\u9ad8\u541e\u5410\u91cf\u3002\u4ece\u53e6\u4e00\u65b9\u9762\u770b\uff0cHTTP \u7684\u9ad8\u5c42\u534f\u8bae\u8bed\u4e49\u5e76\u4e0d\u4f1a\u56e0\u4e3a\u8fd9\u6b21\u7248\u672c\u5347\u7ea7\u800c\u53d7\u5f71\u54cd\u3002\u6240\u6709HTTP \u9996\u90e8\u3001\u503c\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u4f7f\u7528\u573a\u666f\u90fd\u4e0d\u4f1a\u53d8\u3002 \u73b0\u6709\u7684\u4efb\u4f55\u7f51\u7ad9\u548c\u5e94\u7528\uff0c\u65e0\u9700\u505a\u4efb\u4f55\u4fee\u6539\u90fd\u53ef\u4ee5\u5728HTTP 2.0 \u4e0a\u8dd1\u8d77\u6765\u3002\u4e0d\u7528\u4e3a\u4e86\u5229\u7528HTTP 2.0 \u7684\u597d\u5904\u800c\u4fee\u6539\u6807\u8bb0\u3002HTTP \u670d\u52a1\u5668\u5fc5\u987b\u8fd0\u884cHTTP 2.0 \u534f\u8bae\uff0c\u4f46\u5927\u90e8\u5206\u7528\u6237\u90fd\u4e0d\u4f1a\u56e0\u6b64\u800c\u53d7\u5230\u5f71\u54cd \u4ee5\u4e0b\u90fd\u662f\u57fa\u4e8e\u6211\u7684ubuntu16.04\u4e0a\u64cd\u4f5c\uff0ccentos\u7684\u7a0d\u5fae\u6709\u6240\u4e0d\u540c\u3002 2. \u7f16\u8bd1\u5b89\u88c5nginx \u00b6 1.\u4e0b\u8f7d\u5b89\u88c5 root@leco:~# cd /usr/local/src/ root@leco:/usr/local/src# wget http://nginx.org/download/nginx-1.10.3.tar.gz root@leco:/usr/local/src# tar xf nginx-1.10.3.tar.gz root@leco:/usr/local/src# cd nginx-1.10.3 2.\u7f16\u8bd1\u53c2\u6570 root@leco:/usr/local/src/nginx-1.10.3# ./configure --user=nginx --group=nginx --prefix=/usr/local/nginx-1.10.3 --with-http_stub_status_module --with-http_ssl_module --with-http_v2_module root@leco:/usr/local/src/nginx-1.10.3# make && make install --with-http_v2_module \u652f\u6301http2\u534f\u8bae root@leco:/usr/local/src/nginx-1.10.3# /usr/local/nginx/sbin/nginx -V nginx version: nginx/1.10.3 built by gcc 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC) built with OpenSSL 1.0.2k-fips 26 Jan 2017 TLS SNI support enabled configure arguments: --user=nginx --group=nginx --prefix=/usr/local/nginx-1.10.3 --with-http_stub_status_module --with-http_ssl_module --with-http_v2_module 3. \u751f\u6210\u8bc1\u4e66 \u00b6 \u56e0\u4e3a\u6ca1\u6709\u771f\u7684\u8bc1\u4e66\uff0c\u6240\u4ee5\u751f\u6210\u4e00\u4e2a\u4f2a\u8bc1\u4e66 root@leco:/usr/local/src/nginx-1.10.3# ln -s /usr/local/nginx-1.10.3/ /usr/local/nginx root@leco:/usr/local/src/nginx-1.10.3# cd /usr/local/nginx/conf/ root@leco:/usr/local/nginx/conf# mkdir key root@leco:/usr/local/nginx/conf# cd key/ #\u81ea\u5b9a\u4e49\u5bc6\u7801 root@leco:/usr/local/nginx/conf# openssl genrsa -des3 -out server.key 1024 Generating RSA private key, 1024 bit long modulus ..........++++++ ..........++++++ e is 65537 (0x10001) Enter pass phrase for server.key: Verifying - Enter pass phrase for server.key: #\u7b7e\u53d1\u8bc1\u4e66 [root@leco key]# openssl req -new -key server.key -out server.csr Enter pass phrase for server.key: You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [XX]:CN State or Province Name (full name) []:BJ Locality Name (eg, city) [Default City]:BJ Organization Name (eg, company) [Default Company Ltd]:SDU Organizational Unit Name (eg, section) []:SA Common Name (eg, your name or your server's hostname) []:caimengzhi Email Address []:123@qq.com Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:123456 An optional company name []:123456 [root@hadoop_node1 key]# cp server.key server.key.ori [root@hadoop_node1 key]# openssl rsa -in server.key.ori -out server.key Enter pass phrase for server.key.ori: writing RSA key [root@hadoop_node1 key]# openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt Signature ok subject=/C=CN/ST=BJ/L=BJ/O=SDU/OU=SA/CN=caimengzhi/emailAddress=123@qq.com Getting Private key 4. \u4fee\u6539nginx\u914d\u7f6e \u00b6 root@leco:/usr/local/nginx/conf# cat nginx.conf worker_processes 1; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 70; server_name localhost; location / { root html; index index.html index.htm; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } server { listen 8443 ssl http2 default_server; server_name localhost; ssl_certificate key/server.crt; ssl_certificate_key key/server.key; location / { root html; index index.html index.htm; } location = /50x.html { root html; } } } \u68c0\u67e5\u9632\u706b\u5899\u662f\u5426\u5f00\u542f\uff0c\u662f\u5426\u5f00\u542f8443\u548c80\u7aef\u53e3 root@leco:/usr/local/nginx/conf# netstat -anlt|grep 8443 tcp 0 0 0.0.0.0:8443 0.0.0.0:* LISTEN tcp 0 0 192.168.5.110:45666 180.96.7.201:8443 TIME_WAIT tcp 0 0 192.168.5.110:39098 180.96.7.198:8443 TIME_WAIT 4. curl\u652f\u6301http2 \u00b6 \u82e5\u662f\u652f\u6301\u5c31\u76f4\u63a5\u8df3\u8fc7 root@leco:/usr/local/nginx/conf# /usr/local/bin/curl --version curl 7.46.0 (x86_64-pc-linux-gnu) libcurl/7.46.0 OpenSSL/1.0.2g zlib/1.2.8 libidn/1.32 nghttp2/1.38.0-DEV librtmp/2.3 Protocols: dict file ftp ftps gopher http https imap imaps ldap ldaps pop3 pop3s rtmp rtsp smb smbs smtp smtps telnet tftp Features: IDN IPv6 Largefile NTLM NTLM_WB SSL libz TLS-SRP HTTP2 UnixSockets \u4e0a\u9762\u770b\u5230\u652f\u6301\u4e86HTTP2\u4e86 \u4e00\u822c\u6211\u4eec\u7cfb\u7edf\u9ed8\u8ba4\u662f\u4e0d\u652f\u6301\u7684\uff0c\u6548\u679c\u5982\u4e0b: root@leco:/usr/local/nginx/conf# curl -I https://nghttp2.org HTTP/1.1 200 OK Date: Thu, 21 Mar 2019 03:19:59 GMT Content-Type: text/html Last-Modified: Fri, 08 Mar 2019 12:33:02 GMT Etag: \"5c8260fe-19d8\" Accept-Ranges: bytes Content-Length: 6616 X-Backend-Header-Rtt: 0.00384 Strict-Transport-Security: max-age=31536000 Server: nghttpx Via: 2 nghttpx x-frame-options: SAMEORIGIN x-xss-protection: 1; mode=block x-content-type-options: nosniff root@leco:/usr/local/nginx/conf# curl --http2 -I https://nghttp2.org curl: (1) Unsupported protocol root@leco:/usr/local/nginx/conf# curl --version curl 7.47.0 (x86_64-pc-linux-gnu) libcurl/7.47.0 GnuTLS/3.4.10 zlib/1.2.8 libidn/1.32 librtmp/2.3 Protocols: dict file ftp ftps gopher http https imap imaps ldap ldaps pop3 pop3s rtmp rtsp smb smbs smtp smtps telnet tftp Features: AsynchDNS IDN IPv6 Largefile GSS-API Kerberos SPNEGO NTLM NTLM_WB SSL libz TLS-SRP UnixSockets \u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5f53\u524d curl \u7684\u7248\u672c\u53ca\u652f\u6301\u7684\u534f\u8bae\u4ee5\u53ca\u529f\u80fd\u7279\u6027\u6ca1\u6709\u652f\u6301 HTTP2\u3002 4.1 \u7f16\u8bd1\u5b89\u88c5curl \u00b6 sudo apt-get install git g++ make binutils autoconf automake autotools-dev libtool pkg-config \\ zlib1g-dev libcunit1-dev libssl-dev libxml2-dev libev-dev libevent-dev libjansson-dev \\ libjemalloc-dev cython python3-dev python-setuptools git clone https://github.com/tatsuhiro-t/nghttp2.git cd nghttp2 autoreconf -i automake autoconf ./configure make sudo make install 4.2 \u5347\u7ea7curl\u7248\u672c \u00b6 \u53ef\u4ee5\u5347\u7ea7\u7684\u4f60\u5f53\u524dcurl\u7684\u7248\u672c \u6ce8\u610f \u4e00\u822c ubuntu\u7f16\u8bd1\u5b89\u88c5\u540e\u7684\u8f6f\u4ef6\u547d\u4ee4\u5728 / usr / local / bin / usr / local / sbin\u4e2d \u5347\u7ea7\u5b8c\u7248\u672c\u4e4b\u540e\uff0c\u6211\u4eec\u518d\u67e5\u770b curl \u7248\u672c\u65f6\u4f1a\u53d1\u5e03\u7279\u6027\u4e2d\u4f1a\u589e\u52a0 HTTP2 \u529f\u80fd\u652f\u6301\u3002\u6b64\u65f6 \u2013http2 \u53c2\u6570\u5c31\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u4e86\uff1a root@leco:/usr/local/nginx/conf# /usr/local/bin/curl --http2 -I https://nghttp2.org HTTP/2.0 200 date:Thu, 21 Mar 2019 03:24:21 GMT content-type:text/html last-modified:Fri, 08 Mar 2019 12:33:02 GMT etag:\"5c8260fe-19d8\" accept-ranges:bytes content-length:6616 x-backend-header-rtt:0.002634 strict-transport-security:max-age=31536000 server:nghttpx via:2 nghttpx x-frame-options:SAMEORIGIN x-xss-protection:1; mode=block x-content-type-options:nosniff 5. \u9a8c\u8bc1 \u00b6 root@leco:/usr/local/nginx/html# /usr/local/bin/curl --http2 -k -s -I https://192.168.5.110:8443/loocha.html HTTP/2.0 200 server:nginx/1.10.3 date:Thu, 21 Mar 2019 03:04:43 GMT content-type:text/html content-length:22 last-modified:Thu, 21 Mar 2019 03:04:27 GMT etag:\"5c92ff3b-16\" accept-ranges:bytes root@leco:/usr/local/nginx/html# /usr/local/bin/curl --http2 -k -s https://192.168.5.110:8443/loocha.html <h1>hello nginx from caimengzhi</h1> \u5b8c\u7f8e\u89e3\u51b3","title":"12. nginx http2"},{"location":"linux/nginx/nginx.http2/#1","text":"HTTP 2.0 \u7684\u4e3b\u8981\u76ee\u6807\u662f\u6539\u8fdb\u4f20\u8f93\u6027\u80fd\uff0c\u5b9e\u73b0\u4f4e\u5ef6\u8fdf\u548c\u9ad8\u541e\u5410\u91cf\u3002\u4ece\u53e6\u4e00\u65b9\u9762\u770b\uff0cHTTP \u7684\u9ad8\u5c42\u534f\u8bae\u8bed\u4e49\u5e76\u4e0d\u4f1a\u56e0\u4e3a\u8fd9\u6b21\u7248\u672c\u5347\u7ea7\u800c\u53d7\u5f71\u54cd\u3002\u6240\u6709HTTP \u9996\u90e8\u3001\u503c\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u4f7f\u7528\u573a\u666f\u90fd\u4e0d\u4f1a\u53d8\u3002 \u73b0\u6709\u7684\u4efb\u4f55\u7f51\u7ad9\u548c\u5e94\u7528\uff0c\u65e0\u9700\u505a\u4efb\u4f55\u4fee\u6539\u90fd\u53ef\u4ee5\u5728HTTP 2.0 \u4e0a\u8dd1\u8d77\u6765\u3002\u4e0d\u7528\u4e3a\u4e86\u5229\u7528HTTP 2.0 \u7684\u597d\u5904\u800c\u4fee\u6539\u6807\u8bb0\u3002HTTP \u670d\u52a1\u5668\u5fc5\u987b\u8fd0\u884cHTTP 2.0 \u534f\u8bae\uff0c\u4f46\u5927\u90e8\u5206\u7528\u6237\u90fd\u4e0d\u4f1a\u56e0\u6b64\u800c\u53d7\u5230\u5f71\u54cd \u4ee5\u4e0b\u90fd\u662f\u57fa\u4e8e\u6211\u7684ubuntu16.04\u4e0a\u64cd\u4f5c\uff0ccentos\u7684\u7a0d\u5fae\u6709\u6240\u4e0d\u540c\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nginx/nginx.http2/#2-nginx","text":"1.\u4e0b\u8f7d\u5b89\u88c5 root@leco:~# cd /usr/local/src/ root@leco:/usr/local/src# wget http://nginx.org/download/nginx-1.10.3.tar.gz root@leco:/usr/local/src# tar xf nginx-1.10.3.tar.gz root@leco:/usr/local/src# cd nginx-1.10.3 2.\u7f16\u8bd1\u53c2\u6570 root@leco:/usr/local/src/nginx-1.10.3# ./configure --user=nginx --group=nginx --prefix=/usr/local/nginx-1.10.3 --with-http_stub_status_module --with-http_ssl_module --with-http_v2_module root@leco:/usr/local/src/nginx-1.10.3# make && make install --with-http_v2_module \u652f\u6301http2\u534f\u8bae root@leco:/usr/local/src/nginx-1.10.3# /usr/local/nginx/sbin/nginx -V nginx version: nginx/1.10.3 built by gcc 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC) built with OpenSSL 1.0.2k-fips 26 Jan 2017 TLS SNI support enabled configure arguments: --user=nginx --group=nginx --prefix=/usr/local/nginx-1.10.3 --with-http_stub_status_module --with-http_ssl_module --with-http_v2_module","title":"2. \u7f16\u8bd1\u5b89\u88c5nginx"},{"location":"linux/nginx/nginx.http2/#3","text":"\u56e0\u4e3a\u6ca1\u6709\u771f\u7684\u8bc1\u4e66\uff0c\u6240\u4ee5\u751f\u6210\u4e00\u4e2a\u4f2a\u8bc1\u4e66 root@leco:/usr/local/src/nginx-1.10.3# ln -s /usr/local/nginx-1.10.3/ /usr/local/nginx root@leco:/usr/local/src/nginx-1.10.3# cd /usr/local/nginx/conf/ root@leco:/usr/local/nginx/conf# mkdir key root@leco:/usr/local/nginx/conf# cd key/ #\u81ea\u5b9a\u4e49\u5bc6\u7801 root@leco:/usr/local/nginx/conf# openssl genrsa -des3 -out server.key 1024 Generating RSA private key, 1024 bit long modulus ..........++++++ ..........++++++ e is 65537 (0x10001) Enter pass phrase for server.key: Verifying - Enter pass phrase for server.key: #\u7b7e\u53d1\u8bc1\u4e66 [root@leco key]# openssl req -new -key server.key -out server.csr Enter pass phrase for server.key: You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [XX]:CN State or Province Name (full name) []:BJ Locality Name (eg, city) [Default City]:BJ Organization Name (eg, company) [Default Company Ltd]:SDU Organizational Unit Name (eg, section) []:SA Common Name (eg, your name or your server's hostname) []:caimengzhi Email Address []:123@qq.com Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []:123456 An optional company name []:123456 [root@hadoop_node1 key]# cp server.key server.key.ori [root@hadoop_node1 key]# openssl rsa -in server.key.ori -out server.key Enter pass phrase for server.key.ori: writing RSA key [root@hadoop_node1 key]# openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt Signature ok subject=/C=CN/ST=BJ/L=BJ/O=SDU/OU=SA/CN=caimengzhi/emailAddress=123@qq.com Getting Private key","title":"3. \u751f\u6210\u8bc1\u4e66"},{"location":"linux/nginx/nginx.http2/#4-nginx","text":"root@leco:/usr/local/nginx/conf# cat nginx.conf worker_processes 1; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 70; server_name localhost; location / { root html; index index.html index.htm; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } server { listen 8443 ssl http2 default_server; server_name localhost; ssl_certificate key/server.crt; ssl_certificate_key key/server.key; location / { root html; index index.html index.htm; } location = /50x.html { root html; } } } \u68c0\u67e5\u9632\u706b\u5899\u662f\u5426\u5f00\u542f\uff0c\u662f\u5426\u5f00\u542f8443\u548c80\u7aef\u53e3 root@leco:/usr/local/nginx/conf# netstat -anlt|grep 8443 tcp 0 0 0.0.0.0:8443 0.0.0.0:* LISTEN tcp 0 0 192.168.5.110:45666 180.96.7.201:8443 TIME_WAIT tcp 0 0 192.168.5.110:39098 180.96.7.198:8443 TIME_WAIT","title":"4. \u4fee\u6539nginx\u914d\u7f6e"},{"location":"linux/nginx/nginx.http2/#4-curlhttp2","text":"\u82e5\u662f\u652f\u6301\u5c31\u76f4\u63a5\u8df3\u8fc7 root@leco:/usr/local/nginx/conf# /usr/local/bin/curl --version curl 7.46.0 (x86_64-pc-linux-gnu) libcurl/7.46.0 OpenSSL/1.0.2g zlib/1.2.8 libidn/1.32 nghttp2/1.38.0-DEV librtmp/2.3 Protocols: dict file ftp ftps gopher http https imap imaps ldap ldaps pop3 pop3s rtmp rtsp smb smbs smtp smtps telnet tftp Features: IDN IPv6 Largefile NTLM NTLM_WB SSL libz TLS-SRP HTTP2 UnixSockets \u4e0a\u9762\u770b\u5230\u652f\u6301\u4e86HTTP2\u4e86 \u4e00\u822c\u6211\u4eec\u7cfb\u7edf\u9ed8\u8ba4\u662f\u4e0d\u652f\u6301\u7684\uff0c\u6548\u679c\u5982\u4e0b: root@leco:/usr/local/nginx/conf# curl -I https://nghttp2.org HTTP/1.1 200 OK Date: Thu, 21 Mar 2019 03:19:59 GMT Content-Type: text/html Last-Modified: Fri, 08 Mar 2019 12:33:02 GMT Etag: \"5c8260fe-19d8\" Accept-Ranges: bytes Content-Length: 6616 X-Backend-Header-Rtt: 0.00384 Strict-Transport-Security: max-age=31536000 Server: nghttpx Via: 2 nghttpx x-frame-options: SAMEORIGIN x-xss-protection: 1; mode=block x-content-type-options: nosniff root@leco:/usr/local/nginx/conf# curl --http2 -I https://nghttp2.org curl: (1) Unsupported protocol root@leco:/usr/local/nginx/conf# curl --version curl 7.47.0 (x86_64-pc-linux-gnu) libcurl/7.47.0 GnuTLS/3.4.10 zlib/1.2.8 libidn/1.32 librtmp/2.3 Protocols: dict file ftp ftps gopher http https imap imaps ldap ldaps pop3 pop3s rtmp rtsp smb smbs smtp smtps telnet tftp Features: AsynchDNS IDN IPv6 Largefile GSS-API Kerberos SPNEGO NTLM NTLM_WB SSL libz TLS-SRP UnixSockets \u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5f53\u524d curl \u7684\u7248\u672c\u53ca\u652f\u6301\u7684\u534f\u8bae\u4ee5\u53ca\u529f\u80fd\u7279\u6027\u6ca1\u6709\u652f\u6301 HTTP2\u3002","title":"4. curl\u652f\u6301http2"},{"location":"linux/nginx/nginx.http2/#41-curl","text":"sudo apt-get install git g++ make binutils autoconf automake autotools-dev libtool pkg-config \\ zlib1g-dev libcunit1-dev libssl-dev libxml2-dev libev-dev libevent-dev libjansson-dev \\ libjemalloc-dev cython python3-dev python-setuptools git clone https://github.com/tatsuhiro-t/nghttp2.git cd nghttp2 autoreconf -i automake autoconf ./configure make sudo make install","title":"4.1 \u7f16\u8bd1\u5b89\u88c5curl"},{"location":"linux/nginx/nginx.http2/#42-curl","text":"\u53ef\u4ee5\u5347\u7ea7\u7684\u4f60\u5f53\u524dcurl\u7684\u7248\u672c \u6ce8\u610f \u4e00\u822c ubuntu\u7f16\u8bd1\u5b89\u88c5\u540e\u7684\u8f6f\u4ef6\u547d\u4ee4\u5728 / usr / local / bin / usr / local / sbin\u4e2d \u5347\u7ea7\u5b8c\u7248\u672c\u4e4b\u540e\uff0c\u6211\u4eec\u518d\u67e5\u770b curl \u7248\u672c\u65f6\u4f1a\u53d1\u5e03\u7279\u6027\u4e2d\u4f1a\u589e\u52a0 HTTP2 \u529f\u80fd\u652f\u6301\u3002\u6b64\u65f6 \u2013http2 \u53c2\u6570\u5c31\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u4e86\uff1a root@leco:/usr/local/nginx/conf# /usr/local/bin/curl --http2 -I https://nghttp2.org HTTP/2.0 200 date:Thu, 21 Mar 2019 03:24:21 GMT content-type:text/html last-modified:Fri, 08 Mar 2019 12:33:02 GMT etag:\"5c8260fe-19d8\" accept-ranges:bytes content-length:6616 x-backend-header-rtt:0.002634 strict-transport-security:max-age=31536000 server:nghttpx via:2 nghttpx x-frame-options:SAMEORIGIN x-xss-protection:1; mode=block x-content-type-options:nosniff","title":"4.2 \u5347\u7ea7curl\u7248\u672c"},{"location":"linux/nginx/nginx.http2/#5","text":"root@leco:/usr/local/nginx/html# /usr/local/bin/curl --http2 -k -s -I https://192.168.5.110:8443/loocha.html HTTP/2.0 200 server:nginx/1.10.3 date:Thu, 21 Mar 2019 03:04:43 GMT content-type:text/html content-length:22 last-modified:Thu, 21 Mar 2019 03:04:27 GMT etag:\"5c92ff3b-16\" accept-ranges:bytes root@leco:/usr/local/nginx/html# /usr/local/bin/curl --http2 -k -s https://192.168.5.110:8443/loocha.html <h1>hello nginx from caimengzhi</h1> \u5b8c\u7f8e\u89e3\u51b3","title":"5. \u9a8c\u8bc1"},{"location":"linux/nginx/nginx.index/","text":"Nginx 1. \u4ecb\u7ecd \u00b6 Nginx(Engine x),\u4fc4\u7f57\u65af\u4eba\u5f00\u53d1\u963f\u5fb7\uff0c\u5f00\u6e90\u7684WWW\u670d\u52a1\u8f6f\u4ef6\u3002\u4e00\u5171\u624d780K\uff0c\u800capache\u5927\u69827M\u5de6\u53f3\u3002 Nginx\u672c\u8eab\u662f\u4e00\u6b3e\u9759\u6001\uff08html\uff0ccss\uff0cjs\uff0cjpg\u7b49\uff09www\u8f6f\u4ef6 \u9759\u6001\u5c0f\u6587\u4ef6\u9ad8\u5e76\u53d1\u91cf\uff0c\u540c\u65f6\u5360\u7528\u7684\u8d44\u6e90\u5f88\u5c11\uff0c3W\u5e76\u53d1\u91cf 10\u4e2a\u7ebf\u7a0b150w\u3002 Nginx\u4f7f\u7528\u5e73\u53f0\uff1aunix linux,windows\u90fd\u53ef\u4ee5\u3002 \u4f7f\u7528\u6392\u540d http://w3techs.com/technologies/overview/web_server/all \u4f7f\u7528\u8d8b\u52bf http://news.netcraft.com/ \u56fd\u5185\u7f51\u7ad9\u4f7f\u7528nginx\u66f4\u591a\u4e00\u4e9b 1.1 Nginx\u529f\u80fd \u00b6 www web \u670d\u52a1 http\u534f\u8bae \u7aef\u53e380 \u8d1f\u8f7d\u5747\u8861\uff08\u53cd\u5411\u4ee3\u7406proxy\uff09 Web cache\uff08web\u7f13\u5b58\uff09 1.2 Nginx\u4f18\u70b9 \u00b6 \u9ad8\u5e76\u53d1\uff08\u9759\u6001\u5c0f\u6587\u4ef6\uff09\uff0c\u9759\u60011-2W \u5360\u7528\u8d44\u6e90\u5c11\uff0c2W\u5e76\u53d1 \u5f0010\u4e2a\u7ebf\u7a0b\u670d\u52a1\uff0c\u5185\u5b58\u6d88\u8017\u51e0\u767eM\u3002 \u529f\u80fd\u79cd\u7c7b\u6bd4\u8f83\u591a\uff08web\uff0ccache\uff0cproxy\uff09\uff0c\u4f46\u662f\u6bcf\u4e00\u4e2a\u529f\u80fd\u90fd\u4e0d\u662f\u5f88\u5f3a\u3002 \u652f\u6301epoll\u6a21\u578b\u3002\u4f7f\u5f97nginx\u53ef\u4ee5\u652f\u6301\u9ad8\u5e76\u53d1\u3002 ginx\u914d\u5408\u52a8\u6001\u670d\u52a1\u548capache\u6709\u533a\u522b\u3002 \u5229\u7528nginx\u53ef\u4ee5\u5bf9ip\u9650\u901f\uff0c\u53ef\u4ee5\u9650\u5236\u8fde\u63a5\u6570\uff08\u6709\u8fd9\u6837\u7684\u6a21\u5757\uff0capache\u4e5f\u6709\u53ea\u662f\u7b2c\u4e09\u65b9\u7684\uff09\u3002 \u914d\u7f6e\u66f4\u7b80\u5355\uff0c\u66f4\u7075\u6d3b\u3002 1.3 \u4f7f\u7528\u573a\u666f \u00b6 \u9759\u6001\u670d\u52a1\u5668\uff08\u56fe\u7247\uff0c\u89c6\u9891\u670d\u52a1\uff09html\uff0cjs\uff0ccss\uff0cflv\u7b49\uff0c\u56fd\u5185\u4f7f\u7528\u7684\u9759\u6001\u670d\u52a1\u5668\u5c31\u4e24\u4e2a\uff0c\u4e00\u4e2a\u662fnginx\u4e00\u4e2a\u662flightttpd\u3002 \u9759\u6001\u7684\u8bbf\u95ee\u9ad8\u3002\u5e76\u53d11-3W\u3002 \u52a8\u6001\u670d\u52a1\u3002Nginx+fastcgi\u7684\u65b9\u5f0f\u8fd0\u884cphp\uff0cjsp\u3002\u5e76\u53d1500-1500. \u76f8\u5bf9\u4e8eapache+php,lighttp+fcgi php \u53cd\u5411\u4ee3\u7406\uff0c\u8d1f\u8f7d\u5747\u8861\u3002\u65e5PV2000W\u4ee5\u4e0b\uff0c\u90fd\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528nginx\u4ee3\u7406.haproxy,F5,a10 \u7f13\u5b58\u670d\u52a1.Squid,varnish 1.4 \u5bf9\u6bd4 \u00b6 1.4.1 Apache \u00b6 2.2\u7248\u672c\u975e\u5e38\u5f3a\u5927\u7a33\u5b9a\uff0c\u636e\u5b98\u65b9\u8bf42.4\u672c\u7248\u672c\u6027\u80fd\u8d85\u5f3a Preforx\u6a21\u5f0f\u53d6\u6d88\u4e86\u8fdb\u7a0b\u521b\u5efa\u5f00\u9500\uff0c\u6027\u80fd\u5f88\u9ad8 \u5904\u7406\u52a8\u6001\u4e1a\u52a1\u6570\u636e\u65f6\uff0c\u56e0\u5173\u8054\u5230\u540e\u7aef\u7684\u5f15\u64ce\u548c\u6570\u636e\u5e93\uff0c\u74f6\u9888\u4e0d\u5728Apache\u672c\u8eab \u9ad8\u5e76\u53d1\u65f6\u5019\u6d88\u8017\u7684\u7cfb\u7edf\u8d44\u6e90\u76f8\u5bf9\u591a\u4e00\u4e9b \u57fa\u4e8e\u4f20\u7edf\u7684select\u7684\u6a21\u578b \u6269\u5c55\u5e93\uff0cDSO\u65b9\u6cd5\uff0capxs\u3002 \u529f\u80fd\u591a\u66f4\u7a33\u5b9a\uff0c\u66f4\u5b89\u5168\uff0c\u63d2\u4ef6\u4e5f\u591a 1.4.2 nginx \u00b6 \u57fa\u4e8e\u5f02\u6b65IO\u6a21\u578b(epoll.kqueue)\uff0c\u6027\u80fd\u5f3a\uff0c\u652f\u6301\u4e0a\u4e07\u5e76\u53d1\u91cf \u5bf9\u5c0f\u6587\u4ef6\u652f\u6301\u5f88\u597d\uff0c\u6027\u80fd\u5f88\u9ad8\uff08\u9650\u5c0f\u6587\u4ef6\uff09 \u4ee3\u7801\u4f18\u7f8e\uff0c\u6269\u5c55\u5e93\u5fc5\u987b\u7f16\u8bd1\u4e3b\u8fdb\u7a0b\u7a0b\u5e8f \u6d88\u8017\u7cfb\u7edf\u8d44\u6e90\u76f8\u5bf9\u6bd4\u8f83\u4f4e 1.4.3 Lighttpd \u00b6 \u57fa\u4e8e\u5f02\u6b65IO\u6a21\u578b\uff0c\u6027\u80fd\u548cnginx\u76f8\u8fd1 \u6269\u5c55\u5e93\u662fSO\u6a21\u5f0f\uff0c\u6bd4nginx\u66f4\u7075\u6d3b \u5168\u7403\u4f7f\u7528\u7387\u6bd4\u8f83\u4f4e\uff0c\u5b89\u5168\u6027\u80fd\u6ca1\u6709\u4e0a\u9762\u4e24\u4e2a\u597d \u901a\u8fc7\u63d2\u4ef6\uff08mod_secdowload\uff09\u53ef\u5b9e\u73b0\u6587\u4ef6URL\u5730\u5740\u52a0\u5bc6\u3002 1.5 web\u670d\u52a1\u5efa\u8bae \u00b6 \u9759\u6001\u4e1a\u52a1\uff1a\u9ad8\u5e76\u53d1\uff0c\u91c7\u7528nginx\u540e\u8005lighttpd\u6839\u636e\u81ea\u5df1\u7684\u638c\u63e1\u7a0b\u5ea6\u6216\u516c\u53f8\u8981\u6c42 \u52a8\u6001\u4e1a\u52a1\uff1a\u91c7\u7528nignx\u6216\u8005apache \u65e2\u6709\u9759\u6001\u4e1a\u52a1\u4e5f\u6709\u52a8\u6001\u4e1a\u52a1\uff1anginx\u6216\u8005apache\uff0c\u4e0d\u8981\u591a\u9009\uff0c\u8981\u5355\u9009\u3002 \u52a8\u6001\u4e1a\u52a1\u53ef\u4ee5\u7531\u524d\u7aef\u7684\u4ee3\u7406\uff08haproxy\uff09,\u6839\u636e\u9875\u9762\u5143\u7d20\u7c7b\u578b\uff0c\u5411\u540e\u8f6c\u53d1\u76f8\u5e94\u7684\u670d\u52a1\u5668\u8fdb\u884c\u5904\u7406 \u82e5\u662f\u5e76\u53d1\u4e0d\u662f\u5f88\u5927\uff0c\u53c8\u5bf9apache\u5f88\u719f\uff0c\u91c7\u7528apache\u4e5f\u662f\u53ef\u4ee5\u7684\uff0capache2.4\u7248\u672c\u4e5f\u5f88\u5f3a\u5927\uff0c\u5e76\u53d1\u8fde\u63a5\u6570\u4e5f\u6709\u6240\u589e\u52a0\uff0c \u63d0\u793a\uff1anginx\u505aweb\uff08apache\uff0clighttpd\uff09\uff0c\u53cd\u5411\u4ee3\u7406\uff08haproxy\uff0clvs nat\uff09\u4ee5\u53ca\u7f13\u5b58\u670d\u52a1\uff08squid\uff09 1.6 nginx\u865a\u62df\u4e3b\u673a \u00b6 \u57fa\u4e8e\u57df\u540d\uff0c\u901a\u8fc7\u57df\u540d\u6765\u533a\u5206\u865a\u62df\u4e3b\u673a\u3002 ==>\u5e94\u7528\uff1a\u5916\u90e8\u7f51\u7ad9 \u57fa\u4e8e\u7aef\u53e3\uff0c\u901a\u8fc7\u7aef\u53e3\u6765\u533a\u5206\u865a\u62df\u4e3b\u673a\u3002 ==>\u5e94\u7528\uff1a\u516c\u53f8\u5185\u90e8\u7f51\u7ad9\u3002 \u57fa\u4e8eIP\uff08\u4e0d\u5b8c\u5584\uff09\uff0c\u57fa\u672c\u4e0d\u7528\u3002 2. nginx\u90e8\u7f72 \u00b6 2.1 \u5b89\u88c5pcre \u00b6 PCRE \u4f5c\u7528\u662f\u8ba9 Nginx \u652f\u6301 Rewrite \u529f\u80fd\u3002 \u9996\u5148\u8981\u68c0\u67e5\u673a\u5668\u662f\u5426\u5df2\u7ecf\u5b89\u88c5pcre root@leco:~# pcre-config --version 8.38 \u82e5\u662f\u6ca1\u6709\u5b89\u88c5\u5c31\u5b89\u88c5\u4e00\u4e0b\u6b65\u9aa4\u5b89\u88c5\uff0c\u7f3a\u5c11\u4ec0\u4e48\u4f9d\u8d56\u5c31\u5b89\u88c5\u4f9d\u8d56\u3002 cd /usr/local/src/ wget http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz tar zxvf pcre-8.35.tar.gz cd pcre-8.35 ./configure && make && make install pcre-config --version yum -y install pcre-devel openssl openssl-devel 2.2 \u4e0b\u8f7d\u5b89\u88c5nginx \u00b6 \u4ee5\u4e0b\u6211\u4ee5centos7\u57fa\u7840\u73af\u5883\u3002 2.2.1 \u5728\u7ebf\u5b89\u88c5 \u00b6 centos yum install nginx ubuntu apt-get install nginx \u7531\u4e8e\u5728\u7ebf\u5b89\u88c5nginx\uff0c\u53ef\u80fd\u4e0d\u662f\u6700\u65b0\u7684[\u4f9d\u8d56\u4e8e\u7cfb\u7edf\u7684nginx\u955c\u50cf\u8fdc\u7248\u672c]\u3002 2.2.2 \u79bb\u7ebf\u5b89\u88c5 \u00b6 \u73b0\u5728\u76ee\u524d\u6700\u65b0\u6700\u7a33\u5b9a\u7684\u7248\u672c\u76841.14.2 useradd nginx -s /sbin/nologin -M wget http://nginx.org/download/nginx-1.14.2.tar.gz unzip nginx-1.14.2.zip cd nginx-1.14.2 ./configure \\ --user=nginx \\ --group=nginx \\ --prefix=/app/nginx-1.14.2 \\ --with-http_stub_status_module \\ --with-http_ssl_module make && make install ln -s /app/nginx1.6.2/ /app/nginx \u64cd\u4f5c\u8fc7\u7a0b [root@master ~]# cd /usr/local/src/ [root@master src]# wget http://nginx.org/download/nginx-1.14.2.tar.gz [root@master src]# useradd nginx -s /sbin/nologin -M [root@master src]# ls nginx-1.14.2.zip [root@master src]# tar xf nginx-1.14.2.tar.gz [root@master src]# cd nginx-1.14.2 [root@master nginx-1.14.2]# ./configure \\ --user=nginx \\ --group=nginx \\ --prefix=/app/nginx-1.14.2 \\ --with-http_stub_status_module \\ --with-http_ssl_module [root@master nginx-1.14.2]# ln -sf /app/nginx-1.14.2/ /app/nginx [root@master nginx-1.14.2]# ls /app/ nginx nginx-1.14.2 2.2.3 \u542f\u52a8\u5e76\u68c0\u67e5 \u00b6 [root@master nginx-1.14.2]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful [root@master nginx-1.14.2]# /app/nginx/sbin/nginx [root@master nginx-1.14.2]# ps axf|grep -v grep |grep nginx 25298 ? Ss 0:00 nginx: master process /app/nginx/sbin/nginx 25299 ? S 0:00 \\_ nginx: worker process [root@master nginx-1.14.2]# netstat -lnp|grep -w 80 tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN 25298/nginx: master [root@master nginx-1.14.2]# curl 127.0.0.1 -I HTTP/1.1 200 OK Server: nginx/1.14.2 Date: Wed, 13 Mar 2019 05:30:09 GMT Content-Type: text/html Content-Length: 612 Last-Modified: Wed, 13 Mar 2019 05:27:38 GMT Connection: keep-alive ETag: \"5c8894ca-264\" Accept-Ranges: bytes \u6ce8\u610f \u68c0\u67e5 nginx\u914d\u7f6e\u6587\u4ef6 : / app / nginx / sbin / nginx - t \u542f\u52a8 nginx : / app / nginx / sbin / nginx \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6 : / app / nginx / sbin / nginx - s reload nginx\u4e0d\u901a\u7684\u6392\u9519 1 \u3001 ping ip \u7269\u7406\u901a\u4e0d\u901a 2 \u3001 telnet ip \u6d4f\u89c8\u5668\u5230 web\u670d\u52a1\u5668\u901a\u4e0d\u901a 3 \u3001\u670d\u52a1\u5668\u672c\u5730 curl 127.0 . 0.1 web\u670d\u52a1\u5f00\u6ca1\u5f00","title":"01. nginx \u90e8\u7f72"},{"location":"linux/nginx/nginx.index/#1","text":"Nginx(Engine x),\u4fc4\u7f57\u65af\u4eba\u5f00\u53d1\u963f\u5fb7\uff0c\u5f00\u6e90\u7684WWW\u670d\u52a1\u8f6f\u4ef6\u3002\u4e00\u5171\u624d780K\uff0c\u800capache\u5927\u69827M\u5de6\u53f3\u3002 Nginx\u672c\u8eab\u662f\u4e00\u6b3e\u9759\u6001\uff08html\uff0ccss\uff0cjs\uff0cjpg\u7b49\uff09www\u8f6f\u4ef6 \u9759\u6001\u5c0f\u6587\u4ef6\u9ad8\u5e76\u53d1\u91cf\uff0c\u540c\u65f6\u5360\u7528\u7684\u8d44\u6e90\u5f88\u5c11\uff0c3W\u5e76\u53d1\u91cf 10\u4e2a\u7ebf\u7a0b150w\u3002 Nginx\u4f7f\u7528\u5e73\u53f0\uff1aunix linux,windows\u90fd\u53ef\u4ee5\u3002 \u4f7f\u7528\u6392\u540d http://w3techs.com/technologies/overview/web_server/all \u4f7f\u7528\u8d8b\u52bf http://news.netcraft.com/ \u56fd\u5185\u7f51\u7ad9\u4f7f\u7528nginx\u66f4\u591a\u4e00\u4e9b","title":"1. \u4ecb\u7ecd"},{"location":"linux/nginx/nginx.index/#11-nginx","text":"www web \u670d\u52a1 http\u534f\u8bae \u7aef\u53e380 \u8d1f\u8f7d\u5747\u8861\uff08\u53cd\u5411\u4ee3\u7406proxy\uff09 Web cache\uff08web\u7f13\u5b58\uff09","title":"1.1 Nginx\u529f\u80fd"},{"location":"linux/nginx/nginx.index/#12-nginx","text":"\u9ad8\u5e76\u53d1\uff08\u9759\u6001\u5c0f\u6587\u4ef6\uff09\uff0c\u9759\u60011-2W \u5360\u7528\u8d44\u6e90\u5c11\uff0c2W\u5e76\u53d1 \u5f0010\u4e2a\u7ebf\u7a0b\u670d\u52a1\uff0c\u5185\u5b58\u6d88\u8017\u51e0\u767eM\u3002 \u529f\u80fd\u79cd\u7c7b\u6bd4\u8f83\u591a\uff08web\uff0ccache\uff0cproxy\uff09\uff0c\u4f46\u662f\u6bcf\u4e00\u4e2a\u529f\u80fd\u90fd\u4e0d\u662f\u5f88\u5f3a\u3002 \u652f\u6301epoll\u6a21\u578b\u3002\u4f7f\u5f97nginx\u53ef\u4ee5\u652f\u6301\u9ad8\u5e76\u53d1\u3002 ginx\u914d\u5408\u52a8\u6001\u670d\u52a1\u548capache\u6709\u533a\u522b\u3002 \u5229\u7528nginx\u53ef\u4ee5\u5bf9ip\u9650\u901f\uff0c\u53ef\u4ee5\u9650\u5236\u8fde\u63a5\u6570\uff08\u6709\u8fd9\u6837\u7684\u6a21\u5757\uff0capache\u4e5f\u6709\u53ea\u662f\u7b2c\u4e09\u65b9\u7684\uff09\u3002 \u914d\u7f6e\u66f4\u7b80\u5355\uff0c\u66f4\u7075\u6d3b\u3002","title":"1.2 Nginx\u4f18\u70b9"},{"location":"linux/nginx/nginx.index/#13","text":"\u9759\u6001\u670d\u52a1\u5668\uff08\u56fe\u7247\uff0c\u89c6\u9891\u670d\u52a1\uff09html\uff0cjs\uff0ccss\uff0cflv\u7b49\uff0c\u56fd\u5185\u4f7f\u7528\u7684\u9759\u6001\u670d\u52a1\u5668\u5c31\u4e24\u4e2a\uff0c\u4e00\u4e2a\u662fnginx\u4e00\u4e2a\u662flightttpd\u3002 \u9759\u6001\u7684\u8bbf\u95ee\u9ad8\u3002\u5e76\u53d11-3W\u3002 \u52a8\u6001\u670d\u52a1\u3002Nginx+fastcgi\u7684\u65b9\u5f0f\u8fd0\u884cphp\uff0cjsp\u3002\u5e76\u53d1500-1500. \u76f8\u5bf9\u4e8eapache+php,lighttp+fcgi php \u53cd\u5411\u4ee3\u7406\uff0c\u8d1f\u8f7d\u5747\u8861\u3002\u65e5PV2000W\u4ee5\u4e0b\uff0c\u90fd\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528nginx\u4ee3\u7406.haproxy,F5,a10 \u7f13\u5b58\u670d\u52a1.Squid,varnish","title":"1.3 \u4f7f\u7528\u573a\u666f"},{"location":"linux/nginx/nginx.index/#14","text":"","title":"1.4 \u5bf9\u6bd4"},{"location":"linux/nginx/nginx.index/#141-apache","text":"2.2\u7248\u672c\u975e\u5e38\u5f3a\u5927\u7a33\u5b9a\uff0c\u636e\u5b98\u65b9\u8bf42.4\u672c\u7248\u672c\u6027\u80fd\u8d85\u5f3a Preforx\u6a21\u5f0f\u53d6\u6d88\u4e86\u8fdb\u7a0b\u521b\u5efa\u5f00\u9500\uff0c\u6027\u80fd\u5f88\u9ad8 \u5904\u7406\u52a8\u6001\u4e1a\u52a1\u6570\u636e\u65f6\uff0c\u56e0\u5173\u8054\u5230\u540e\u7aef\u7684\u5f15\u64ce\u548c\u6570\u636e\u5e93\uff0c\u74f6\u9888\u4e0d\u5728Apache\u672c\u8eab \u9ad8\u5e76\u53d1\u65f6\u5019\u6d88\u8017\u7684\u7cfb\u7edf\u8d44\u6e90\u76f8\u5bf9\u591a\u4e00\u4e9b \u57fa\u4e8e\u4f20\u7edf\u7684select\u7684\u6a21\u578b \u6269\u5c55\u5e93\uff0cDSO\u65b9\u6cd5\uff0capxs\u3002 \u529f\u80fd\u591a\u66f4\u7a33\u5b9a\uff0c\u66f4\u5b89\u5168\uff0c\u63d2\u4ef6\u4e5f\u591a","title":"1.4.1 Apache"},{"location":"linux/nginx/nginx.index/#142-nginx","text":"\u57fa\u4e8e\u5f02\u6b65IO\u6a21\u578b(epoll.kqueue)\uff0c\u6027\u80fd\u5f3a\uff0c\u652f\u6301\u4e0a\u4e07\u5e76\u53d1\u91cf \u5bf9\u5c0f\u6587\u4ef6\u652f\u6301\u5f88\u597d\uff0c\u6027\u80fd\u5f88\u9ad8\uff08\u9650\u5c0f\u6587\u4ef6\uff09 \u4ee3\u7801\u4f18\u7f8e\uff0c\u6269\u5c55\u5e93\u5fc5\u987b\u7f16\u8bd1\u4e3b\u8fdb\u7a0b\u7a0b\u5e8f \u6d88\u8017\u7cfb\u7edf\u8d44\u6e90\u76f8\u5bf9\u6bd4\u8f83\u4f4e","title":"1.4.2 nginx"},{"location":"linux/nginx/nginx.index/#143-lighttpd","text":"\u57fa\u4e8e\u5f02\u6b65IO\u6a21\u578b\uff0c\u6027\u80fd\u548cnginx\u76f8\u8fd1 \u6269\u5c55\u5e93\u662fSO\u6a21\u5f0f\uff0c\u6bd4nginx\u66f4\u7075\u6d3b \u5168\u7403\u4f7f\u7528\u7387\u6bd4\u8f83\u4f4e\uff0c\u5b89\u5168\u6027\u80fd\u6ca1\u6709\u4e0a\u9762\u4e24\u4e2a\u597d \u901a\u8fc7\u63d2\u4ef6\uff08mod_secdowload\uff09\u53ef\u5b9e\u73b0\u6587\u4ef6URL\u5730\u5740\u52a0\u5bc6\u3002","title":"1.4.3 Lighttpd"},{"location":"linux/nginx/nginx.index/#15-web","text":"\u9759\u6001\u4e1a\u52a1\uff1a\u9ad8\u5e76\u53d1\uff0c\u91c7\u7528nginx\u540e\u8005lighttpd\u6839\u636e\u81ea\u5df1\u7684\u638c\u63e1\u7a0b\u5ea6\u6216\u516c\u53f8\u8981\u6c42 \u52a8\u6001\u4e1a\u52a1\uff1a\u91c7\u7528nignx\u6216\u8005apache \u65e2\u6709\u9759\u6001\u4e1a\u52a1\u4e5f\u6709\u52a8\u6001\u4e1a\u52a1\uff1anginx\u6216\u8005apache\uff0c\u4e0d\u8981\u591a\u9009\uff0c\u8981\u5355\u9009\u3002 \u52a8\u6001\u4e1a\u52a1\u53ef\u4ee5\u7531\u524d\u7aef\u7684\u4ee3\u7406\uff08haproxy\uff09,\u6839\u636e\u9875\u9762\u5143\u7d20\u7c7b\u578b\uff0c\u5411\u540e\u8f6c\u53d1\u76f8\u5e94\u7684\u670d\u52a1\u5668\u8fdb\u884c\u5904\u7406 \u82e5\u662f\u5e76\u53d1\u4e0d\u662f\u5f88\u5927\uff0c\u53c8\u5bf9apache\u5f88\u719f\uff0c\u91c7\u7528apache\u4e5f\u662f\u53ef\u4ee5\u7684\uff0capache2.4\u7248\u672c\u4e5f\u5f88\u5f3a\u5927\uff0c\u5e76\u53d1\u8fde\u63a5\u6570\u4e5f\u6709\u6240\u589e\u52a0\uff0c \u63d0\u793a\uff1anginx\u505aweb\uff08apache\uff0clighttpd\uff09\uff0c\u53cd\u5411\u4ee3\u7406\uff08haproxy\uff0clvs nat\uff09\u4ee5\u53ca\u7f13\u5b58\u670d\u52a1\uff08squid\uff09","title":"1.5 web\u670d\u52a1\u5efa\u8bae"},{"location":"linux/nginx/nginx.index/#16-nginx","text":"\u57fa\u4e8e\u57df\u540d\uff0c\u901a\u8fc7\u57df\u540d\u6765\u533a\u5206\u865a\u62df\u4e3b\u673a\u3002 ==>\u5e94\u7528\uff1a\u5916\u90e8\u7f51\u7ad9 \u57fa\u4e8e\u7aef\u53e3\uff0c\u901a\u8fc7\u7aef\u53e3\u6765\u533a\u5206\u865a\u62df\u4e3b\u673a\u3002 ==>\u5e94\u7528\uff1a\u516c\u53f8\u5185\u90e8\u7f51\u7ad9\u3002 \u57fa\u4e8eIP\uff08\u4e0d\u5b8c\u5584\uff09\uff0c\u57fa\u672c\u4e0d\u7528\u3002","title":"1.6 nginx\u865a\u62df\u4e3b\u673a"},{"location":"linux/nginx/nginx.index/#2-nginx","text":"","title":"2. nginx\u90e8\u7f72"},{"location":"linux/nginx/nginx.index/#21-pcre","text":"PCRE \u4f5c\u7528\u662f\u8ba9 Nginx \u652f\u6301 Rewrite \u529f\u80fd\u3002 \u9996\u5148\u8981\u68c0\u67e5\u673a\u5668\u662f\u5426\u5df2\u7ecf\u5b89\u88c5pcre root@leco:~# pcre-config --version 8.38 \u82e5\u662f\u6ca1\u6709\u5b89\u88c5\u5c31\u5b89\u88c5\u4e00\u4e0b\u6b65\u9aa4\u5b89\u88c5\uff0c\u7f3a\u5c11\u4ec0\u4e48\u4f9d\u8d56\u5c31\u5b89\u88c5\u4f9d\u8d56\u3002 cd /usr/local/src/ wget http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz tar zxvf pcre-8.35.tar.gz cd pcre-8.35 ./configure && make && make install pcre-config --version yum -y install pcre-devel openssl openssl-devel","title":"2.1 \u5b89\u88c5pcre"},{"location":"linux/nginx/nginx.index/#22-nginx","text":"\u4ee5\u4e0b\u6211\u4ee5centos7\u57fa\u7840\u73af\u5883\u3002","title":"2.2 \u4e0b\u8f7d\u5b89\u88c5nginx"},{"location":"linux/nginx/nginx.index/#221","text":"centos yum install nginx ubuntu apt-get install nginx \u7531\u4e8e\u5728\u7ebf\u5b89\u88c5nginx\uff0c\u53ef\u80fd\u4e0d\u662f\u6700\u65b0\u7684[\u4f9d\u8d56\u4e8e\u7cfb\u7edf\u7684nginx\u955c\u50cf\u8fdc\u7248\u672c]\u3002","title":"2.2.1 \u5728\u7ebf\u5b89\u88c5"},{"location":"linux/nginx/nginx.index/#222","text":"\u73b0\u5728\u76ee\u524d\u6700\u65b0\u6700\u7a33\u5b9a\u7684\u7248\u672c\u76841.14.2 useradd nginx -s /sbin/nologin -M wget http://nginx.org/download/nginx-1.14.2.tar.gz unzip nginx-1.14.2.zip cd nginx-1.14.2 ./configure \\ --user=nginx \\ --group=nginx \\ --prefix=/app/nginx-1.14.2 \\ --with-http_stub_status_module \\ --with-http_ssl_module make && make install ln -s /app/nginx1.6.2/ /app/nginx \u64cd\u4f5c\u8fc7\u7a0b [root@master ~]# cd /usr/local/src/ [root@master src]# wget http://nginx.org/download/nginx-1.14.2.tar.gz [root@master src]# useradd nginx -s /sbin/nologin -M [root@master src]# ls nginx-1.14.2.zip [root@master src]# tar xf nginx-1.14.2.tar.gz [root@master src]# cd nginx-1.14.2 [root@master nginx-1.14.2]# ./configure \\ --user=nginx \\ --group=nginx \\ --prefix=/app/nginx-1.14.2 \\ --with-http_stub_status_module \\ --with-http_ssl_module [root@master nginx-1.14.2]# ln -sf /app/nginx-1.14.2/ /app/nginx [root@master nginx-1.14.2]# ls /app/ nginx nginx-1.14.2","title":"2.2.2 \u79bb\u7ebf\u5b89\u88c5"},{"location":"linux/nginx/nginx.index/#223","text":"[root@master nginx-1.14.2]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful [root@master nginx-1.14.2]# /app/nginx/sbin/nginx [root@master nginx-1.14.2]# ps axf|grep -v grep |grep nginx 25298 ? Ss 0:00 nginx: master process /app/nginx/sbin/nginx 25299 ? S 0:00 \\_ nginx: worker process [root@master nginx-1.14.2]# netstat -lnp|grep -w 80 tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN 25298/nginx: master [root@master nginx-1.14.2]# curl 127.0.0.1 -I HTTP/1.1 200 OK Server: nginx/1.14.2 Date: Wed, 13 Mar 2019 05:30:09 GMT Content-Type: text/html Content-Length: 612 Last-Modified: Wed, 13 Mar 2019 05:27:38 GMT Connection: keep-alive ETag: \"5c8894ca-264\" Accept-Ranges: bytes \u6ce8\u610f \u68c0\u67e5 nginx\u914d\u7f6e\u6587\u4ef6 : / app / nginx / sbin / nginx - t \u542f\u52a8 nginx : / app / nginx / sbin / nginx \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6 : / app / nginx / sbin / nginx - s reload nginx\u4e0d\u901a\u7684\u6392\u9519 1 \u3001 ping ip \u7269\u7406\u901a\u4e0d\u901a 2 \u3001 telnet ip \u6d4f\u89c8\u5668\u5230 web\u670d\u52a1\u5668\u901a\u4e0d\u901a 3 \u3001\u670d\u52a1\u5668\u672c\u5730 curl 127.0 . 0.1 web\u670d\u52a1\u5f00\u6ca1\u5f00","title":"2.2.3 \u542f\u52a8\u5e76\u68c0\u67e5"},{"location":"linux/nginx/nginx.location/","text":"Nginx location 1. \u4f5c\u7528 \u00b6 location\u6307\u4ee4\u7684\u4f5c\u7528\u662f\u53ef\u4ee5\u6839\u636e\u7528\u6237\u8bf7\u6c42\u7684URI\u6765\u6267\u884c\u4e0d\u540c\u7684\u5e94\u7528\uff0c\u5176\u5b9e\u5c31\u662f\u6839\u636e\u7528\u6237\u8bf7\u6c42\u7684 \u7f51\u7ad9\u5730\u5740URL\u5339\u914d\uff0c\u5339\u914d\u6210\u529f\u5373\u8fdb\u884c\u76f8\u5173\u7684\u64cd\u4f5c\u3002 2. \u8bed\u6cd5 \u00b6 location\u4f7f\u7528\u7684\u8bed\u6cd5\u4f8b\u5b50\uff1a location [=|~|~*|^~] uri{ \u2026 } \u89e3\u91ca location [ =|~|~*|^~| @ ] uri { \u2026 } \u6307\u4ee4 \u5339\u914d\u6807\u8bc6 \u5339\u914d\u7684\u7f51\u7ad9\u7f51\u5740 \u5339\u914d URI\u540e\u8981\u6267\u884c\u7684\u914d\u7f6e\u6bb5 \u4e0a\u8ff0\u8bed\u6cd5\u4e2d\u7684URI\u90e8\u5206\u662f\u5173\u952e\uff0c\u8fd9\u4e2aURI\u53ef\u4ee5\u662f\u666e\u901a\u7684\u5b57\u7b26\u4e32\u5730\u5740\u8def\u5f84\u6216\u8005\u662f\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5f53\u5339\u914d\u6210\u529f\u5219\u6267\u884c\u540e\u9762\u5927\u62ec\u53f7\u91cc\u9762\u7684\u76f8\u5173\u6307\u4ee4\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u7b7e\u540d\u8fd8\u53ef\u4ee5\u6709^\u6216 *\u7b49\u7279\u6b8a\u7684\u5b57\u7b26\u3002 \u8fd9\u4e24\u79cd\u7279\u6b8a\u5b57\u7b26 \u6216~*\u5339\u914d\u7684\u533a\u522b\u4e3a\uff1a 1. ~ \u7528\u4e8e\u533a\u5206\u5927\u5c0f\u5199\uff08\u5927\u5c0f\u5199\u654f\u611f\uff09\u7684\u5339\u914d\uff1b 2. ~* \u7528\u4e8e\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u5339\u914d\u3002\u8fd8\u53ef\u4ee5\u7528\u903b\u8f91\u64cd\u4f5c\u7b26\uff01\uff08\u53f9\u53f7\uff09\u5bf9\u4e0a\u9762\u7684\u5339\u914d\u53d6\u53cd\uff0c\u5373!~\u548c!~* 3. ^~ \u4f5c\u7528\u662f\u5728\u5e38\u89c4\u7684\u5b57\u7b26\u4e32\u5339\u914d\u68c0\u67e5\u4e4b\u540e\uff0c\u4e0d\u505a\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u68c0\u67e5\uff0c\u5373\u5982\u679c\u6700\u660e\u786e\u7684\u90a3\u4e2a\u5b57\u7b26\u4e32 \u5339\u914d\u7684location\u5339\u914d\u4e2d\u6709\u6b64\u524d\u7f00\uff0c\u90a3\u4e48\u4e0d\u505a\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u68c0\u67e5\u3002 3. \u5339\u914d\u5b9e\u4f8b \u00b6 \u4e0b\u9762\u662f\u4e00\u7ec4\u5178\u578b\u7684location\u5339\u914d\uff0c\u662f\u5b98\u65b9\u7684\u4f8b\u5b50 location = / { [configuration A] } location / { [configuration B] } location /documents/ { [configuration C] } location ^~ /images/ { [configuration D] } location ~*\\.(gif|jpg|jpeg)${ [configuration E] } \u5728\u4e0a\u8ff0location\u914d\u7f6e\u4e2d\uff0c\u7528\u6237\u8bf7\u6c42\u5bf9\u5e94\u5339\u914d\u5982\u4e0b\u8868\uff1a \u7528\u6237\u8bf7\u6c42\u7684URI \u5b8c\u6574\u7684URL\u5730\u5740 \u5339\u914d\u7684\u914d\u7f6e / http://www.linux.ac.cn/ configuration A /index.html http://www.linux.ac.cn/ configuration B /documents/index.html http://www.linux.ac.cn/documents/index.html configuration C /images/1.gif http://www.linux.ac.cn/images/1.gif configuration D /documents/1.jpg http://www.linux.ac.cn/documents/1.jpg configuration E 4. location\u5b9e\u6218 \u00b6 Nginx\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a server { listen 80; server_name www.linux.ac.cn; location / { return 401; } location =/ { return 402; } location /documents/ { return 403; } location ^~/images/ { return 404; } location ~*\\.(gif|jpg|jpeg)$ { return 500; } access_log logs/www_access.log main; } \u7136\u540e\u4ee5linux\u5ba2\u6237\u7aef\u4e3a\u4f8b\u5bf9\u4e0a\u8ff0location\u5339\u914d\u8fdb\u884c\u771f\u5b9e\u6d4b\u8bd5\uff0c\u914d\u7f6ehosts\u6587\u4ef6\u5982\u4e0b\u3002 [root@web01 web]# tail -1 /etc/hosts 192.168.1.10 www.linux.ac.cn \u5b9e\u9a8c\u7ed3\u679c\u5982\u4e0b [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn 402 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/ 402 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/index.html 401 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/documents/index.html 403 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/documents/1.jpg 500 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/images/1.gif 404 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/kkk/1.gif 500 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/index.html 401 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/kkk 401 \u7528\u6237\u8bf7\u6c42\u8bf4\u660e\uff1a \u4e0a\u8ff0\u4e0d\u7528URI\u53ca\u7279\u6b8a\u5b57\u7b26\u7ec4\u5408\u5339\u914d\u7684\u987a\u5e8f\u8bf4\u660e \u4e0d\u7528URI\u53ca\u7279\u6b8a\u5b57\u7b26\u7ec4\u5408\u7684\u5339\u914d\u987a\u5e8f \u5339\u914d\u8bf4\u660e \u7b2c\u4e00\u540d\uff1alocation =/ { \u7cbe\u786e\u5339\u914d/ \u7b2c\u4e8c\u540d\uff1alocation ^~/images/ { \u5339\u914d\u5e38\u89c4\u5b57\u7b26\u4e32\uff0c\u4e0d\u505a\u6b63\u5219\u5339\u914d\u68c0\u67e5\u3002 \u7b2c\u4e09\u540d\uff1alocation ~*.(gif jpg \u7b2c\u56db\u540d\uff1alocation /documents/ { \u5339\u914d\u5e38\u89c4\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u6709\u6b63\u5219\u5219\u4f18\u5148\u5339\u914d\u6b63\u5219 \u7b2c\u4e94\u540d\uff1alocation / { \u6240 \u6709location\u90fd\u4e0d\u80fd\u5339\u914d\u7684\u65f6\u5019\u9ed8\u8ba4\u5339\u914d\u5b83","title":"09. nginx location"},{"location":"linux/nginx/nginx.location/#1","text":"location\u6307\u4ee4\u7684\u4f5c\u7528\u662f\u53ef\u4ee5\u6839\u636e\u7528\u6237\u8bf7\u6c42\u7684URI\u6765\u6267\u884c\u4e0d\u540c\u7684\u5e94\u7528\uff0c\u5176\u5b9e\u5c31\u662f\u6839\u636e\u7528\u6237\u8bf7\u6c42\u7684 \u7f51\u7ad9\u5730\u5740URL\u5339\u914d\uff0c\u5339\u914d\u6210\u529f\u5373\u8fdb\u884c\u76f8\u5173\u7684\u64cd\u4f5c\u3002","title":"1. \u4f5c\u7528"},{"location":"linux/nginx/nginx.location/#2","text":"location\u4f7f\u7528\u7684\u8bed\u6cd5\u4f8b\u5b50\uff1a location [=|~|~*|^~] uri{ \u2026 } \u89e3\u91ca location [ =|~|~*|^~| @ ] uri { \u2026 } \u6307\u4ee4 \u5339\u914d\u6807\u8bc6 \u5339\u914d\u7684\u7f51\u7ad9\u7f51\u5740 \u5339\u914d URI\u540e\u8981\u6267\u884c\u7684\u914d\u7f6e\u6bb5 \u4e0a\u8ff0\u8bed\u6cd5\u4e2d\u7684URI\u90e8\u5206\u662f\u5173\u952e\uff0c\u8fd9\u4e2aURI\u53ef\u4ee5\u662f\u666e\u901a\u7684\u5b57\u7b26\u4e32\u5730\u5740\u8def\u5f84\u6216\u8005\u662f\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5f53\u5339\u914d\u6210\u529f\u5219\u6267\u884c\u540e\u9762\u5927\u62ec\u53f7\u91cc\u9762\u7684\u76f8\u5173\u6307\u4ee4\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u7b7e\u540d\u8fd8\u53ef\u4ee5\u6709^\u6216 *\u7b49\u7279\u6b8a\u7684\u5b57\u7b26\u3002 \u8fd9\u4e24\u79cd\u7279\u6b8a\u5b57\u7b26 \u6216~*\u5339\u914d\u7684\u533a\u522b\u4e3a\uff1a 1. ~ \u7528\u4e8e\u533a\u5206\u5927\u5c0f\u5199\uff08\u5927\u5c0f\u5199\u654f\u611f\uff09\u7684\u5339\u914d\uff1b 2. ~* \u7528\u4e8e\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u5339\u914d\u3002\u8fd8\u53ef\u4ee5\u7528\u903b\u8f91\u64cd\u4f5c\u7b26\uff01\uff08\u53f9\u53f7\uff09\u5bf9\u4e0a\u9762\u7684\u5339\u914d\u53d6\u53cd\uff0c\u5373!~\u548c!~* 3. ^~ \u4f5c\u7528\u662f\u5728\u5e38\u89c4\u7684\u5b57\u7b26\u4e32\u5339\u914d\u68c0\u67e5\u4e4b\u540e\uff0c\u4e0d\u505a\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u68c0\u67e5\uff0c\u5373\u5982\u679c\u6700\u660e\u786e\u7684\u90a3\u4e2a\u5b57\u7b26\u4e32 \u5339\u914d\u7684location\u5339\u914d\u4e2d\u6709\u6b64\u524d\u7f00\uff0c\u90a3\u4e48\u4e0d\u505a\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u68c0\u67e5\u3002","title":"2. \u8bed\u6cd5"},{"location":"linux/nginx/nginx.location/#3","text":"\u4e0b\u9762\u662f\u4e00\u7ec4\u5178\u578b\u7684location\u5339\u914d\uff0c\u662f\u5b98\u65b9\u7684\u4f8b\u5b50 location = / { [configuration A] } location / { [configuration B] } location /documents/ { [configuration C] } location ^~ /images/ { [configuration D] } location ~*\\.(gif|jpg|jpeg)${ [configuration E] } \u5728\u4e0a\u8ff0location\u914d\u7f6e\u4e2d\uff0c\u7528\u6237\u8bf7\u6c42\u5bf9\u5e94\u5339\u914d\u5982\u4e0b\u8868\uff1a \u7528\u6237\u8bf7\u6c42\u7684URI \u5b8c\u6574\u7684URL\u5730\u5740 \u5339\u914d\u7684\u914d\u7f6e / http://www.linux.ac.cn/ configuration A /index.html http://www.linux.ac.cn/ configuration B /documents/index.html http://www.linux.ac.cn/documents/index.html configuration C /images/1.gif http://www.linux.ac.cn/images/1.gif configuration D /documents/1.jpg http://www.linux.ac.cn/documents/1.jpg configuration E","title":"3. \u5339\u914d\u5b9e\u4f8b"},{"location":"linux/nginx/nginx.location/#4-location","text":"Nginx\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a server { listen 80; server_name www.linux.ac.cn; location / { return 401; } location =/ { return 402; } location /documents/ { return 403; } location ^~/images/ { return 404; } location ~*\\.(gif|jpg|jpeg)$ { return 500; } access_log logs/www_access.log main; } \u7136\u540e\u4ee5linux\u5ba2\u6237\u7aef\u4e3a\u4f8b\u5bf9\u4e0a\u8ff0location\u5339\u914d\u8fdb\u884c\u771f\u5b9e\u6d4b\u8bd5\uff0c\u914d\u7f6ehosts\u6587\u4ef6\u5982\u4e0b\u3002 [root@web01 web]# tail -1 /etc/hosts 192.168.1.10 www.linux.ac.cn \u5b9e\u9a8c\u7ed3\u679c\u5982\u4e0b [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn 402 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/ 402 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/index.html 401 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/documents/index.html 403 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/documents/1.jpg 500 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/images/1.gif 404 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/kkk/1.gif 500 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/index.html 401 [root@web01 web]# curl -s -o /dev/null -I -w \"%{http_code}\\n\" http://www.linux.ac.cn/kkk 401 \u7528\u6237\u8bf7\u6c42\u8bf4\u660e\uff1a \u4e0a\u8ff0\u4e0d\u7528URI\u53ca\u7279\u6b8a\u5b57\u7b26\u7ec4\u5408\u5339\u914d\u7684\u987a\u5e8f\u8bf4\u660e \u4e0d\u7528URI\u53ca\u7279\u6b8a\u5b57\u7b26\u7ec4\u5408\u7684\u5339\u914d\u987a\u5e8f \u5339\u914d\u8bf4\u660e \u7b2c\u4e00\u540d\uff1alocation =/ { \u7cbe\u786e\u5339\u914d/ \u7b2c\u4e8c\u540d\uff1alocation ^~/images/ { \u5339\u914d\u5e38\u89c4\u5b57\u7b26\u4e32\uff0c\u4e0d\u505a\u6b63\u5219\u5339\u914d\u68c0\u67e5\u3002 \u7b2c\u4e09\u540d\uff1alocation ~*.(gif jpg \u7b2c\u56db\u540d\uff1alocation /documents/ { \u5339\u914d\u5e38\u89c4\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u6709\u6b63\u5219\u5219\u4f18\u5148\u5339\u914d\u6b63\u5219 \u7b2c\u4e94\u540d\uff1alocation / { \u6240 \u6709location\u90fd\u4e0d\u80fd\u5339\u914d\u7684\u65f6\u5019\u9ed8\u8ba4\u5339\u914d\u5b83","title":"4. location\u5b9e\u6218"},{"location":"linux/nginx/nginx.log/","text":"Nginx 1. \u65e5\u5fd7 \u00b6 1.1 \u4ecb\u7ecd \u00b6 nginx\u591a\u865a\u62df\u4e3b\u673a\u7684\u65f6\u5019\uff0c\u9700\u8981\u5206\u5f00\u865a\u62df\u4e3b\u673a\u7684\u65e5\u5fd7\u3002\u4e5f\u5c31\u662f\u5355\u72ec\u7ed9\u865a\u62df\u4e3b\u673a\u6307\u5b9a\u65e5\u5fd7\u3002 log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; \u65e5\u5fd7\u751f\u6210\u7684\u5230Nginx\u6839\u76ee\u5f55logs/access.log\u6587\u4ef6\uff0c\u9ed8\u8ba4\u4f7f\u7528\u201cmain\u201d\u65e5\u5fd7\u683c\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u683c\u5f0f \u53c2\u6570 \u8bf4\u660e $remote_addr \u5ba2\u6237\u7aef\u7684ip\u5730\u5740(\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u663e\u793a\u4ee3\u7406\u670d\u52a1ip) $remote_user \u7528\u4e8e\u8bb0\u5f55\u8fdc\u7a0b\u5ba2\u6237\u7aef\u7684\u7528\u6237\u540d\u79f0\uff08\u4e00\u822c\u4e3a\u201c-\u201d\uff09 $time_local \u7528\u4e8e\u8bb0\u5f55\u8bbf\u95ee\u65f6\u95f4\u548c\u65f6\u533a $request \u7528\u4e8e\u8bb0\u5f55\u8bf7\u6c42\u7684url\u4ee5\u53ca\u8bf7\u6c42\u65b9\u6cd5 $status \u54cd\u5e94\u72b6\u6001\u7801\uff0c\u4f8b\u5982\uff1a200\u6210\u529f\u3001404\u9875\u9762\u627e\u4e0d\u5230\u7b49\u3002 $body_bytes_sent \u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6587\u4ef6\u4e3b\u4f53\u5185\u5bb9\u5b57\u8282\u6570 $http_user_agent \u7528\u6237\u6240\u4f7f\u7528\u7684\u4ee3\u7406\uff08\u4e00\u822c\u4e3a\u6d4f\u89c8\u5668\uff09 $http_x_forwarded_for \u53ef\u4ee5\u8bb0\u5f55\u5ba2\u6237\u7aefIP\uff0c\u901a\u8fc7\u4ee3\u7406\u670d\u52a1\u5668\u6765\u8bb0\u5f55\u5ba2\u6237\u7aef\u7684ip\u5730\u5740 $http_referer \u53ef\u4ee5\u8bb0\u5f55\u7528\u6237\u662f\u4ece\u54ea\u4e2a\u94fe\u63a5\u8bbf\u95ee\u8fc7\u6765\u7684 \u5982\u679c\u4e0d\u60f3\u4f7f\u7528Nginx\u9884\u5b9a\u4e49\u7684\u683c\u5f0f\uff0c\u53ef\u4ee5\u901a\u8fc7log_format\u6307\u4ee4\u6765\u81ea\u5b9a\u4e49\u3002 nginx\u81ea\u5b9a\u4e49\u65e5\u5fd7 log_format name [ escape = default | json ] string ... ; 1. name \u683c\u5f0f\u540d\u79f0\u3002\u5728 access_log\u6307\u4ee4\u4e2d\u5f15\u7528 \u3002 2. escape \u8bbe\u7f6e\u53d8\u91cf\u4e2d\u7684\u5b57\u7b26\u7f16\u7801\u65b9\u5f0f\u662f json\u8fd8\u662fdefault \uff0c\u9ed8\u8ba4\u662f default \u3002 3. string \u8981\u5b9a\u4e49\u7684\u65e5\u5fd7\u683c\u5f0f\u5185\u5bb9\u3002\u8be5\u53c2\u6570\u53ef\u4ee5\u6709\u591a\u4e2a\u3002\u53c2\u6570\u4e2d\u53ef\u4ee5\u4f7f\u7528 Nginx\u53d8\u91cf \u3002 1.2 \u65e5\u5fd7\u8c03\u7528 \u00b6 access_log /tmp/test.com.log main\uff1b 2. \u6848\u4f8b \u00b6 [root@master extra]# pwd /app/nginx/conf/extra [root@master extra]# ls bbs.conf blog.conf www.conf [root@master extra]# cat bbs.conf blog.conf www.conf server { listen 80; server_name bbs.caimengzhi.org; root html/bbs; index index.html index.htmi index.php; access_log logs/bbs_access.log main; } server { listen 80; server_name blog.caimengzhi.org; root html/blog; index index.html index.htmi index.php; access_log logs/blog_access.log; } server { listen 80; server_name www.caimengzhi.org; root html/www; index index.html index.htmi index.php; access_log logs/www_access.log; } [root@master extra]# cd .. \u6307\u5b9anginx\u65e5\u5fd7\u683c\u5f0flog_format [root@master conf]# cat nginx.conf error_log logs/error.log error; worker_processes 4; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; include extra/www.conf; include extra/bbs.conf; include extra/blog.conf; #\u6216\u8005\u76f4\u63a5\u5305\u542b\u6240\u6709 # include extra/*.conf; #\u8868\u793a\u5305\u542bextra\u6240\u6709\u7684.conf\u6587\u4ef6 } [root@master nginx]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful [root@master nginx]# /app/nginx/sbin/nginx -s reload [root@master nginx]# [root@master nginx]# pwd /app/nginx [root@master nginx]# ls logs/ access.log bbs_access.log blog_access.log error.log nginx.pid www_access.log [root@master nginx]# cat logs/www_access.log 127.0.0.1 - - [13/Mar/2019:16:48:33 +0800] \"GET / HTTP/1.1\" 200 19 \"-\" \"curl/7.29.0\" \u53ef\u4ee5\u770b\u51fa\u90fd\u751f\u6548\u4e86\u3002 3. \u65e5\u5fd7\u5207\u5272 \u00b6 nginx\u7684\u65e5\u5fd7\u6587\u4ef6\u6ca1\u6709rotate\u529f\u80fd\u3002\u7f16\u5199\u6bcf\u5929\u751f\u6210\u4e00\u4e2a\u65e5\u5fd7\uff0c\u6211\u4eec\u53ef\u4ee5\u5199\u4e00\u4e2anginx\u65e5\u5fd7\u5207\u5272\u811a\u672c\u6765\u81ea\u52a8\u5207\u5272\u65e5\u5fd7\u6587\u4ef6\u3002 \u7b2c\u4e00\u6b65\u5c31\u662f\u91cd\u547d\u540d\u65e5\u5fd7\u6587\u4ef6\uff0c\u4e0d\u7528\u62c5\u5fc3\u91cd\u547d\u540d\u540enginx\u627e\u4e0d\u5230\u65e5\u5fd7\u6587\u4ef6\u800c\u4e22\u5931\u65e5\u5fd7\u3002\u5728\u4f60\u672a\u91cd\u65b0\u6253\u5f00\u539f\u540d\u5b57\u7684\u65e5\u5fd7\u6587\u4ef6\u524d\uff0cnginx\u8fd8\u662f\u4f1a\u5411\u4f60\u91cd\u547d\u540d\u7684\u6587\u4ef6\u5199\u65e5\u5fd7\uff0cLinux\u662f\u9760\u6587\u4ef6\u63cf\u8ff0\u7b26\u800c\u4e0d\u662f\u6587\u4ef6\u540d\u5b9a\u4f4d\u6587\u4ef6\u3002 \u7b2c\u4e8c\u6b65reload nginx\u670d\u52a1\u3002 \u5b9a\u65f6\u811a\u672c cut_nginx_log .sh cd /app/nginx/logs/ && \\ /bin/mv www_access.log www_access_$(date +%F -d -1day).log /application/nginx/sbin/nginx -s reload \u5b9a\u65f6\u4efb\u52a1 Crontab -e 0 0 * * * /bin/sh /server/script/cut_nginx_log.sh >/dev/null 2>&1","title":"04. nginx \u65e5\u5fd7"},{"location":"linux/nginx/nginx.log/#1","text":"","title":"1. \u65e5\u5fd7"},{"location":"linux/nginx/nginx.log/#11","text":"nginx\u591a\u865a\u62df\u4e3b\u673a\u7684\u65f6\u5019\uff0c\u9700\u8981\u5206\u5f00\u865a\u62df\u4e3b\u673a\u7684\u65e5\u5fd7\u3002\u4e5f\u5c31\u662f\u5355\u72ec\u7ed9\u865a\u62df\u4e3b\u673a\u6307\u5b9a\u65e5\u5fd7\u3002 log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; \u65e5\u5fd7\u751f\u6210\u7684\u5230Nginx\u6839\u76ee\u5f55logs/access.log\u6587\u4ef6\uff0c\u9ed8\u8ba4\u4f7f\u7528\u201cmain\u201d\u65e5\u5fd7\u683c\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u683c\u5f0f \u53c2\u6570 \u8bf4\u660e $remote_addr \u5ba2\u6237\u7aef\u7684ip\u5730\u5740(\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u663e\u793a\u4ee3\u7406\u670d\u52a1ip) $remote_user \u7528\u4e8e\u8bb0\u5f55\u8fdc\u7a0b\u5ba2\u6237\u7aef\u7684\u7528\u6237\u540d\u79f0\uff08\u4e00\u822c\u4e3a\u201c-\u201d\uff09 $time_local \u7528\u4e8e\u8bb0\u5f55\u8bbf\u95ee\u65f6\u95f4\u548c\u65f6\u533a $request \u7528\u4e8e\u8bb0\u5f55\u8bf7\u6c42\u7684url\u4ee5\u53ca\u8bf7\u6c42\u65b9\u6cd5 $status \u54cd\u5e94\u72b6\u6001\u7801\uff0c\u4f8b\u5982\uff1a200\u6210\u529f\u3001404\u9875\u9762\u627e\u4e0d\u5230\u7b49\u3002 $body_bytes_sent \u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6587\u4ef6\u4e3b\u4f53\u5185\u5bb9\u5b57\u8282\u6570 $http_user_agent \u7528\u6237\u6240\u4f7f\u7528\u7684\u4ee3\u7406\uff08\u4e00\u822c\u4e3a\u6d4f\u89c8\u5668\uff09 $http_x_forwarded_for \u53ef\u4ee5\u8bb0\u5f55\u5ba2\u6237\u7aefIP\uff0c\u901a\u8fc7\u4ee3\u7406\u670d\u52a1\u5668\u6765\u8bb0\u5f55\u5ba2\u6237\u7aef\u7684ip\u5730\u5740 $http_referer \u53ef\u4ee5\u8bb0\u5f55\u7528\u6237\u662f\u4ece\u54ea\u4e2a\u94fe\u63a5\u8bbf\u95ee\u8fc7\u6765\u7684 \u5982\u679c\u4e0d\u60f3\u4f7f\u7528Nginx\u9884\u5b9a\u4e49\u7684\u683c\u5f0f\uff0c\u53ef\u4ee5\u901a\u8fc7log_format\u6307\u4ee4\u6765\u81ea\u5b9a\u4e49\u3002 nginx\u81ea\u5b9a\u4e49\u65e5\u5fd7 log_format name [ escape = default | json ] string ... ; 1. name \u683c\u5f0f\u540d\u79f0\u3002\u5728 access_log\u6307\u4ee4\u4e2d\u5f15\u7528 \u3002 2. escape \u8bbe\u7f6e\u53d8\u91cf\u4e2d\u7684\u5b57\u7b26\u7f16\u7801\u65b9\u5f0f\u662f json\u8fd8\u662fdefault \uff0c\u9ed8\u8ba4\u662f default \u3002 3. string \u8981\u5b9a\u4e49\u7684\u65e5\u5fd7\u683c\u5f0f\u5185\u5bb9\u3002\u8be5\u53c2\u6570\u53ef\u4ee5\u6709\u591a\u4e2a\u3002\u53c2\u6570\u4e2d\u53ef\u4ee5\u4f7f\u7528 Nginx\u53d8\u91cf \u3002","title":"1.1 \u4ecb\u7ecd"},{"location":"linux/nginx/nginx.log/#12","text":"access_log /tmp/test.com.log main\uff1b","title":"1.2 \u65e5\u5fd7\u8c03\u7528"},{"location":"linux/nginx/nginx.log/#2","text":"[root@master extra]# pwd /app/nginx/conf/extra [root@master extra]# ls bbs.conf blog.conf www.conf [root@master extra]# cat bbs.conf blog.conf www.conf server { listen 80; server_name bbs.caimengzhi.org; root html/bbs; index index.html index.htmi index.php; access_log logs/bbs_access.log main; } server { listen 80; server_name blog.caimengzhi.org; root html/blog; index index.html index.htmi index.php; access_log logs/blog_access.log; } server { listen 80; server_name www.caimengzhi.org; root html/www; index index.html index.htmi index.php; access_log logs/www_access.log; } [root@master extra]# cd .. \u6307\u5b9anginx\u65e5\u5fd7\u683c\u5f0flog_format [root@master conf]# cat nginx.conf error_log logs/error.log error; worker_processes 4; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; include extra/www.conf; include extra/bbs.conf; include extra/blog.conf; #\u6216\u8005\u76f4\u63a5\u5305\u542b\u6240\u6709 # include extra/*.conf; #\u8868\u793a\u5305\u542bextra\u6240\u6709\u7684.conf\u6587\u4ef6 } [root@master nginx]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful [root@master nginx]# /app/nginx/sbin/nginx -s reload [root@master nginx]# [root@master nginx]# pwd /app/nginx [root@master nginx]# ls logs/ access.log bbs_access.log blog_access.log error.log nginx.pid www_access.log [root@master nginx]# cat logs/www_access.log 127.0.0.1 - - [13/Mar/2019:16:48:33 +0800] \"GET / HTTP/1.1\" 200 19 \"-\" \"curl/7.29.0\" \u53ef\u4ee5\u770b\u51fa\u90fd\u751f\u6548\u4e86\u3002","title":"2. \u6848\u4f8b"},{"location":"linux/nginx/nginx.log/#3","text":"nginx\u7684\u65e5\u5fd7\u6587\u4ef6\u6ca1\u6709rotate\u529f\u80fd\u3002\u7f16\u5199\u6bcf\u5929\u751f\u6210\u4e00\u4e2a\u65e5\u5fd7\uff0c\u6211\u4eec\u53ef\u4ee5\u5199\u4e00\u4e2anginx\u65e5\u5fd7\u5207\u5272\u811a\u672c\u6765\u81ea\u52a8\u5207\u5272\u65e5\u5fd7\u6587\u4ef6\u3002 \u7b2c\u4e00\u6b65\u5c31\u662f\u91cd\u547d\u540d\u65e5\u5fd7\u6587\u4ef6\uff0c\u4e0d\u7528\u62c5\u5fc3\u91cd\u547d\u540d\u540enginx\u627e\u4e0d\u5230\u65e5\u5fd7\u6587\u4ef6\u800c\u4e22\u5931\u65e5\u5fd7\u3002\u5728\u4f60\u672a\u91cd\u65b0\u6253\u5f00\u539f\u540d\u5b57\u7684\u65e5\u5fd7\u6587\u4ef6\u524d\uff0cnginx\u8fd8\u662f\u4f1a\u5411\u4f60\u91cd\u547d\u540d\u7684\u6587\u4ef6\u5199\u65e5\u5fd7\uff0cLinux\u662f\u9760\u6587\u4ef6\u63cf\u8ff0\u7b26\u800c\u4e0d\u662f\u6587\u4ef6\u540d\u5b9a\u4f4d\u6587\u4ef6\u3002 \u7b2c\u4e8c\u6b65reload nginx\u670d\u52a1\u3002 \u5b9a\u65f6\u811a\u672c cut_nginx_log .sh cd /app/nginx/logs/ && \\ /bin/mv www_access.log www_access_$(date +%F -d -1day).log /application/nginx/sbin/nginx -s reload \u5b9a\u65f6\u4efb\u52a1 Crontab -e 0 0 * * * /bin/sh /server/script/cut_nginx_log.sh >/dev/null 2>&1","title":"3. \u65e5\u5fd7\u5207\u5272"},{"location":"linux/nginx/nginx.nti_theft_chain/","text":"Nginx\u9632\u76d7\u94fe 1. \u4ecb\u7ecd \u00b6 \u4e00\u822c\uff0c\u6211\u4eec\u505a\u597d\u9632\u76d7\u94fe\u4e4b\u540e\u5176\u4ed6\u7f51\u7ad9\u76d7\u94fe\u7684\u672c\u7ad9\u56fe\u7247\u5c31\u4f1a\u5168\u90e8\u5931\u6548\u65e0\u6cd5\u663e\u793a\uff0c\u4f46\u662f\u60a8\u5982\u679c\u901a\u8fc7\u6d4f\u89c8\u5668\u76f4\u63a5\u8f93\u5165\u56fe\u7247\u5730\u5740\uff0c\u4ecd\u7136\u4f1a\u663e\u793a\u56fe\u7247\uff0c\u4ecd\u7136\u53ef\u4ee5\u53f3\u952e\u56fe\u7247\u53e6\u5b58\u4e3a\u4e0b\u8f7d\u6587\u4ef6\uff01\u4f9d\u7136\u53ef\u4ee5\u4e0b\u8f7d\uff1f\u8fd9\u6837\u5c31\u4e0d\u662f\u5f7b\u5e95\u7684\u9632\u76d7\u4e86\uff01\u90a3\u4e48\uff0cnginx\u5e94\u8be5\u600e\u4e48\u6837\u5f7b\u5e95\u5730\u5b9e\u73b0\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u9632\u76d7\u94fe\u5462\uff1f 2. \u914d\u7f6e \u00b6 [root@master extra]# cat www.conf server { listen 80; server_name www.caimengzhi.org; root html/www; index index.html index.htmi index.php; access_log logs/www_access.log; location ~* \\.(gif|jpg|png|jpeg)$ { expires 30d; valid_referers *.caimengzhi.org www.caimengzhi.org m.caimengzhi.com *.baidu.com *.google.com; if ($invalid_referer) { rewrite ^/ http://ww4.sinaimg.cn/bmiddle/051bbed1gw1egjc4xl7srj20cm08aaa6.jpg; #return 404; } } } \u89e3\u91ca \u7b2c\u4e00\u884c\uff1a location ~ .* \\ . ( gif | jpg | jpeg | png | bmp | swf ) $ \u5176\u4e2d\u201c gif | jpg | jpeg | png | bmp | swf \u201d\u8bbe\u7f6e\u9632\u76d7\u94fe\u6587\u4ef6\u7c7b\u578b\uff0c\u81ea\u884c\u4fee\u6539\uff0c\u6bcf\u4e2a\u540e\u7f00\u7528\u201c | \u201d\u7b26\u53f7\u5206\u5f00\uff01 \u7b2c\u4e09\u884c\uff1a valid_referers *. caimengzhi . org www . caimengzhi . org m . caimengzhi . com *. baidu . com *. google . com ; \u5c31\u662f\u767d\u540d\u5355\uff0c\u5141\u8bb8\u6587\u4ef6\u94fe\u51fa\u7684\u57df\u540d\u767d\u540d\u5355\uff0c\u81ea\u884c\u4fee\u6539\u6210\u60a8\u7684\u57df\u540d\uff01 *. caimengzhi . com\u8fd9\u4e2a\u6307\u7684\u662f\u5b50\u57df\u540d \uff0c\u57df\u540d\u4e0e\u57df\u540d\u4e4b\u95f4\u4f7f\u7528\u7a7a\u683c\u9694\u5f00\uff01 \u7b2c\u4e94\u884c\uff1a rewrite ^/ http : // www . caimengzhi . com / static / images / 404.j pg ; \u8fd9\u4e2a\u56fe\u7247\u662f\u76d7\u94fe\u8fd4\u56de\u7684\u56fe\u7247\uff0c\u4e5f\u5c31\u662f\u66ff\u6362\u76d7\u94fe\u7f51\u7ad9\u6240\u6709\u76d7\u94fe\u7684\u56fe\u7247\u3002\u8fd9\u4e2a\u56fe\u7247\u8981\u653e\u5728\u6ca1\u6709\u8bbe\u7f6e\u9632\u76d7\u94fe\u7684\u7f51\u7ad9\u4e0a\uff0c\u56e0\u4e3a\u9632\u76d7\u94fe\u7684\u4f5c\u7528\uff0c\u8fd9\u4e2a\u56fe\u7247\u5982\u679c\u4e5f\u653e\u5728\u9632\u76d7\u94fe\u7f51\u7ad9\u4e0a\u5c31\u4f1a\u88ab\u5f53\u4f5c\u9632\u76d7\u94fe\u663e\u793a\u4e0d\u51fa\u6765\u4e86\uff0c\u76d7\u94fe\u8005\u7684\u7f51\u7ad9\u6240\u76d7\u94fe\u56fe\u7247\u4f1a\u663e\u793a X\u7b26\u53f7 \u3002 \u8fd9\u6837\u60a8\u5728\u6d4f\u89c8\u5668\u76f4\u63a5\u8f93\u5165\u56fe\u7247\u5730\u5740\u5c31\u4e0d\u4f1a\u518d\u663e\u793a\u56fe\u7247\u51fa\u6765\u4e86\uff0c\u4e5f\u4e0d\u53ef\u80fd\u4f1a\u518d\u53f3\u952e\u53e6\u5b58\u4ec0\u4e48\u7684\u3002 \u7b2c\u4e94\u884c\uff1arewrite ^/ http://www.it300.com/static/images/404.jpg;\u8fd9\u4e2a\u662f\u7ed9\u56fe\u7247\u9632\u76d7\u94fe\u8bbe\u7f6e\u7684\u9632\u76d7\u94fe\u8fd4\u56de\u56fe\u7247 \uff0c\u5982\u679c\u6211\u4eec\u662f\u6587\u4ef6\u9700\u8981\u9632\u76d7\u94fe\u4e0b\u8f7d\uff0c\u628a\u7b2c\u4e94\u884c\uff1a rewrite ^/ http://www.caimengzhi.com/static/images/404.jpg; \u6539\u6210\u4e00\u4e2a\u94fe\u63a5\uff0c\u53ef\u4ee5\u662f\u60a8\u4e3b\u7ad9\u7684\u94fe\u63a5\uff0c\u6bd4\u5982\u628a\u7b2c\u4e94\u884c\u6539\u6210\uff1a rewrite ^/ http://www.caimengzhi.com; \u8fd9\u6837\uff0c\u5f53\u522b\u4eba\u8f93\u5165\u6587\u4ef6\u4e0b\u8f7d\u5730\u5740\uff0c\u7531\u4e8e\u9632\u76d7\u94fe\u4e0b\u8f7d\u7684\u4f5c\u7528\u5c31\u4f1a\u8df3\u8f6c\u5230\u60a8\u8bbe\u7f6e\u7684\u8fd9\u4e2a\u94fe\u63a5\uff01\u6700\u540e\uff0c\u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e\u5b8c\u6210\u522b\u5fd8\u8bb0\u91cd\u542fnginx\u751f\u6548\uff01","title":"05. nginx \u9632\u76d7\u94fe"},{"location":"linux/nginx/nginx.nti_theft_chain/#1","text":"\u4e00\u822c\uff0c\u6211\u4eec\u505a\u597d\u9632\u76d7\u94fe\u4e4b\u540e\u5176\u4ed6\u7f51\u7ad9\u76d7\u94fe\u7684\u672c\u7ad9\u56fe\u7247\u5c31\u4f1a\u5168\u90e8\u5931\u6548\u65e0\u6cd5\u663e\u793a\uff0c\u4f46\u662f\u60a8\u5982\u679c\u901a\u8fc7\u6d4f\u89c8\u5668\u76f4\u63a5\u8f93\u5165\u56fe\u7247\u5730\u5740\uff0c\u4ecd\u7136\u4f1a\u663e\u793a\u56fe\u7247\uff0c\u4ecd\u7136\u53ef\u4ee5\u53f3\u952e\u56fe\u7247\u53e6\u5b58\u4e3a\u4e0b\u8f7d\u6587\u4ef6\uff01\u4f9d\u7136\u53ef\u4ee5\u4e0b\u8f7d\uff1f\u8fd9\u6837\u5c31\u4e0d\u662f\u5f7b\u5e95\u7684\u9632\u76d7\u4e86\uff01\u90a3\u4e48\uff0cnginx\u5e94\u8be5\u600e\u4e48\u6837\u5f7b\u5e95\u5730\u5b9e\u73b0\u771f\u6b63\u610f\u4e49\u4e0a\u7684\u9632\u76d7\u94fe\u5462\uff1f","title":"1. \u4ecb\u7ecd"},{"location":"linux/nginx/nginx.nti_theft_chain/#2","text":"[root@master extra]# cat www.conf server { listen 80; server_name www.caimengzhi.org; root html/www; index index.html index.htmi index.php; access_log logs/www_access.log; location ~* \\.(gif|jpg|png|jpeg)$ { expires 30d; valid_referers *.caimengzhi.org www.caimengzhi.org m.caimengzhi.com *.baidu.com *.google.com; if ($invalid_referer) { rewrite ^/ http://ww4.sinaimg.cn/bmiddle/051bbed1gw1egjc4xl7srj20cm08aaa6.jpg; #return 404; } } } \u89e3\u91ca \u7b2c\u4e00\u884c\uff1a location ~ .* \\ . ( gif | jpg | jpeg | png | bmp | swf ) $ \u5176\u4e2d\u201c gif | jpg | jpeg | png | bmp | swf \u201d\u8bbe\u7f6e\u9632\u76d7\u94fe\u6587\u4ef6\u7c7b\u578b\uff0c\u81ea\u884c\u4fee\u6539\uff0c\u6bcf\u4e2a\u540e\u7f00\u7528\u201c | \u201d\u7b26\u53f7\u5206\u5f00\uff01 \u7b2c\u4e09\u884c\uff1a valid_referers *. caimengzhi . org www . caimengzhi . org m . caimengzhi . com *. baidu . com *. google . com ; \u5c31\u662f\u767d\u540d\u5355\uff0c\u5141\u8bb8\u6587\u4ef6\u94fe\u51fa\u7684\u57df\u540d\u767d\u540d\u5355\uff0c\u81ea\u884c\u4fee\u6539\u6210\u60a8\u7684\u57df\u540d\uff01 *. caimengzhi . com\u8fd9\u4e2a\u6307\u7684\u662f\u5b50\u57df\u540d \uff0c\u57df\u540d\u4e0e\u57df\u540d\u4e4b\u95f4\u4f7f\u7528\u7a7a\u683c\u9694\u5f00\uff01 \u7b2c\u4e94\u884c\uff1a rewrite ^/ http : // www . caimengzhi . com / static / images / 404.j pg ; \u8fd9\u4e2a\u56fe\u7247\u662f\u76d7\u94fe\u8fd4\u56de\u7684\u56fe\u7247\uff0c\u4e5f\u5c31\u662f\u66ff\u6362\u76d7\u94fe\u7f51\u7ad9\u6240\u6709\u76d7\u94fe\u7684\u56fe\u7247\u3002\u8fd9\u4e2a\u56fe\u7247\u8981\u653e\u5728\u6ca1\u6709\u8bbe\u7f6e\u9632\u76d7\u94fe\u7684\u7f51\u7ad9\u4e0a\uff0c\u56e0\u4e3a\u9632\u76d7\u94fe\u7684\u4f5c\u7528\uff0c\u8fd9\u4e2a\u56fe\u7247\u5982\u679c\u4e5f\u653e\u5728\u9632\u76d7\u94fe\u7f51\u7ad9\u4e0a\u5c31\u4f1a\u88ab\u5f53\u4f5c\u9632\u76d7\u94fe\u663e\u793a\u4e0d\u51fa\u6765\u4e86\uff0c\u76d7\u94fe\u8005\u7684\u7f51\u7ad9\u6240\u76d7\u94fe\u56fe\u7247\u4f1a\u663e\u793a X\u7b26\u53f7 \u3002 \u8fd9\u6837\u60a8\u5728\u6d4f\u89c8\u5668\u76f4\u63a5\u8f93\u5165\u56fe\u7247\u5730\u5740\u5c31\u4e0d\u4f1a\u518d\u663e\u793a\u56fe\u7247\u51fa\u6765\u4e86\uff0c\u4e5f\u4e0d\u53ef\u80fd\u4f1a\u518d\u53f3\u952e\u53e6\u5b58\u4ec0\u4e48\u7684\u3002 \u7b2c\u4e94\u884c\uff1arewrite ^/ http://www.it300.com/static/images/404.jpg;\u8fd9\u4e2a\u662f\u7ed9\u56fe\u7247\u9632\u76d7\u94fe\u8bbe\u7f6e\u7684\u9632\u76d7\u94fe\u8fd4\u56de\u56fe\u7247 \uff0c\u5982\u679c\u6211\u4eec\u662f\u6587\u4ef6\u9700\u8981\u9632\u76d7\u94fe\u4e0b\u8f7d\uff0c\u628a\u7b2c\u4e94\u884c\uff1a rewrite ^/ http://www.caimengzhi.com/static/images/404.jpg; \u6539\u6210\u4e00\u4e2a\u94fe\u63a5\uff0c\u53ef\u4ee5\u662f\u60a8\u4e3b\u7ad9\u7684\u94fe\u63a5\uff0c\u6bd4\u5982\u628a\u7b2c\u4e94\u884c\u6539\u6210\uff1a rewrite ^/ http://www.caimengzhi.com; \u8fd9\u6837\uff0c\u5f53\u522b\u4eba\u8f93\u5165\u6587\u4ef6\u4e0b\u8f7d\u5730\u5740\uff0c\u7531\u4e8e\u9632\u76d7\u94fe\u4e0b\u8f7d\u7684\u4f5c\u7528\u5c31\u4f1a\u8df3\u8f6c\u5230\u60a8\u8bbe\u7f6e\u7684\u8fd9\u4e2a\u94fe\u63a5\uff01\u6700\u540e\uff0c\u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e\u5b8c\u6210\u522b\u5fd8\u8bb0\u91cd\u542fnginx\u751f\u6548\uff01","title":"2. \u914d\u7f6e"},{"location":"linux/nginx/nginx.optimization/","text":"Nginx \u4f18\u5316 1. \u4ecb\u7ecd\u76ee\u5f55\u8bbf\u95ee\u6743\u9650 \u00b6 \u6807\u51c6\u60c5\u51b5\u4e0b\uff0c\u8f6f\u4ef6\u9ed8\u8ba4\u7684\u53c2\u6570\u90fd\u662f\u5bf9\u5b89\u88c5\u8f6f\u4ef6\u7684\u786c\u4ef6\u6807\u51c6\u6765\u8bbe\u7f6e\u7684\uff0c\u2f6c\u524d\u6211\u4eec\u670d\u52a1\u5668\u7684\u786c\u4ef6\u8d44\u6e90\u8fdc\u8fdc\u2f24\u4e8e\u8981\u6c42\u7684\u6807\u51c6\uff0c\u6240\u4ee5\u4e3a\u4e86\u8ba9\u670d\u52a1\u5668\u6027\u80fd\u66f4\u52a0\u51fa\u4f17\uff0c\u5145\u5206\u5229\u2f64\u670d \u52a1\u5668\u7684\u786c\u4ef6\u8d44\u6e90\uff0c\u6211\u4eec\u2f00\u822c\u9700\u8981\u4f18\u5316APP\u7684\u5e76\u53d1\u6570\u6765\u63d0\u5347\u670d\u52a1\u5668\u7684\u6027\u80fd\u3002 2. cpu \u00b6 Nginx\u662f\u4e3b\u8fdb\u7a0b+\u2f2f\u4f5c\u8fdb\u7a0b\u6a21\u578b \u2022 worker_processes 1\uff1b \u2f2f\u4f5c\u8fdb\u7a0b\u6570\u91cf \u6309CPU\u7684\u603b\u6838\u2f3c\u8c03\u6574 \u2022 worker_cpu_affinity 0010 0100 1000; CPU\u7684\u4eb2\u548c\u2f12 \u2022 worker_connections 1024\uff1b \u2f00\u4e2a\u2f2f\u4f5c\u8fdb\u7a0b\u7684\u5e76\u53d1\u6570 3. \u957f\u8fde\u63a5 \u00b6 http\u534f\u8bae\u5c5e\u4e8eTCP\u534f\u8bae\uff0c\u4f18\u5316\u2f6c\u6807:\u51cf\u5c11\u4e09\u6b21\u63e1\u2f3f\u548c\u56db\u6b21\u65ad\u5f00\u7684\u6b21\u6570 keepalive_timeout 5; \u2ed3\u8fde\u63a5\u65f6\u95f4 keepalive_requests 8192; \u6bcf\u4e2a\u2ed3\u8fde\u63a5\u63a5\u53d7\u6700\u2f24\u8bf7\u6c42\u6570 4. \u6570\u636e\u538b\u7f29 \u00b6 gzip on; \uff08\u542f\u2f64 gzip \u538b\u7f29\u529f\u80fd\uff09 gzip_proxied any; \uff08nginx \u505a\u524d\u7aef\u4ee3\u7406\u65f6\u542f\u2f64\u8be5\u9009\u9879\uff0c\u8868\u793a\u2f46\u8bba\u540e\u7aef\u670d\u52a1\u5668\u7684headers\u5934\u8fd4\u56de\u4ec0\u4e48\u4fe1\u606f\uff0c\u90fd\u2f46\u6761\u4ef6\u542f\u2f64\u538b\u7f29\uff09 gzip_min_length 1024; \uff08\u6700\u2f29\u538b\u7f29\u7684\u2eda\u2faf\uff0c\u5982\u679c\u2eda\u2faf\u8fc7\u4e8e\u2f29\uff0c\u53ef\u80fd\u4f1a\u8d8a\u538b\u8d8a\u2f24\uff0c\u8fd9\u2fa5\u89c4\u5b9a\u2f24\u4e8e1K\u7684\u2eda\u2faf\u624d\u542f\u2f64\u538b\u7f29\uff09 gzip_buffers 4 8k; \uff08\u8bbe\u7f6e\u7cfb\u7edf\u83b7\u53d6\u2f0f\u4e2a\u5355\u4f4d\u7684\u7f13\u5b58\u2f64\u4e8e\u5b58\u50a8gzip\u7684\u538b\u7f29\u7ed3\u679c\u6570\u636e\u6d41 \u6309\u7167\u539f\u59cb\u6570\u636e\u2f24\u2f29\u4ee58K\u4e3a\u5355\u4f4d\u7533\u8bf74\u500d\u5185\u5b58\u7a7a\u95f4\uff09 gzip_comp_level 3; \uff08\u538b\u7f29\u7ea7\u522b\uff0c1\u538b\u7f29\u2f50\u6700\u2f29\u5904\u7406\u901f\u5ea6\u6700\u5feb\uff0c9\u538b\u7f29\u2f50\u6700\u2f24\u4f46\u5904\u7406\u6700\u6162\uff0c\u540c\u65f6\u4e5f\u6700\u6d88\u8017CPU,\u2f00\u822c\u8bbe\u7f6e\u4e3a3\u5c31\u53ef\u4ee5\u4e86\uff09 gzip_types text/plain text/css application/x-javascript application/javascript application/xml; \uff08\u4ec0\u4e48\u7c7b\u578b\u7684\u2eda\u2faf\u6216\u2f42\u6863\u542f\u2f64\u538b\u7f29\uff09 5. \u5ba2\u6237\u7aef\u7f13\u5b58 \u00b6 \u8bed\u6cd5\uff1a expires [time|epoch|max|off] \u9ed8\u8ba4\u503c\uff1a expires off \u4f5c\u2f64\u57df\uff1a http, server, location location ~.*\\.(js|css)?$ { expires 1h; } 6. \u53c2\u8003 \u00b6 http://www.nginx.cn/doc/","title":"07. nginx \u4f18\u5316"},{"location":"linux/nginx/nginx.optimization/#1","text":"\u6807\u51c6\u60c5\u51b5\u4e0b\uff0c\u8f6f\u4ef6\u9ed8\u8ba4\u7684\u53c2\u6570\u90fd\u662f\u5bf9\u5b89\u88c5\u8f6f\u4ef6\u7684\u786c\u4ef6\u6807\u51c6\u6765\u8bbe\u7f6e\u7684\uff0c\u2f6c\u524d\u6211\u4eec\u670d\u52a1\u5668\u7684\u786c\u4ef6\u8d44\u6e90\u8fdc\u8fdc\u2f24\u4e8e\u8981\u6c42\u7684\u6807\u51c6\uff0c\u6240\u4ee5\u4e3a\u4e86\u8ba9\u670d\u52a1\u5668\u6027\u80fd\u66f4\u52a0\u51fa\u4f17\uff0c\u5145\u5206\u5229\u2f64\u670d \u52a1\u5668\u7684\u786c\u4ef6\u8d44\u6e90\uff0c\u6211\u4eec\u2f00\u822c\u9700\u8981\u4f18\u5316APP\u7684\u5e76\u53d1\u6570\u6765\u63d0\u5347\u670d\u52a1\u5668\u7684\u6027\u80fd\u3002","title":"1. \u4ecb\u7ecd\u76ee\u5f55\u8bbf\u95ee\u6743\u9650"},{"location":"linux/nginx/nginx.optimization/#2-cpu","text":"Nginx\u662f\u4e3b\u8fdb\u7a0b+\u2f2f\u4f5c\u8fdb\u7a0b\u6a21\u578b \u2022 worker_processes 1\uff1b \u2f2f\u4f5c\u8fdb\u7a0b\u6570\u91cf \u6309CPU\u7684\u603b\u6838\u2f3c\u8c03\u6574 \u2022 worker_cpu_affinity 0010 0100 1000; CPU\u7684\u4eb2\u548c\u2f12 \u2022 worker_connections 1024\uff1b \u2f00\u4e2a\u2f2f\u4f5c\u8fdb\u7a0b\u7684\u5e76\u53d1\u6570","title":"2. cpu"},{"location":"linux/nginx/nginx.optimization/#3","text":"http\u534f\u8bae\u5c5e\u4e8eTCP\u534f\u8bae\uff0c\u4f18\u5316\u2f6c\u6807:\u51cf\u5c11\u4e09\u6b21\u63e1\u2f3f\u548c\u56db\u6b21\u65ad\u5f00\u7684\u6b21\u6570 keepalive_timeout 5; \u2ed3\u8fde\u63a5\u65f6\u95f4 keepalive_requests 8192; \u6bcf\u4e2a\u2ed3\u8fde\u63a5\u63a5\u53d7\u6700\u2f24\u8bf7\u6c42\u6570","title":"3. \u957f\u8fde\u63a5"},{"location":"linux/nginx/nginx.optimization/#4","text":"gzip on; \uff08\u542f\u2f64 gzip \u538b\u7f29\u529f\u80fd\uff09 gzip_proxied any; \uff08nginx \u505a\u524d\u7aef\u4ee3\u7406\u65f6\u542f\u2f64\u8be5\u9009\u9879\uff0c\u8868\u793a\u2f46\u8bba\u540e\u7aef\u670d\u52a1\u5668\u7684headers\u5934\u8fd4\u56de\u4ec0\u4e48\u4fe1\u606f\uff0c\u90fd\u2f46\u6761\u4ef6\u542f\u2f64\u538b\u7f29\uff09 gzip_min_length 1024; \uff08\u6700\u2f29\u538b\u7f29\u7684\u2eda\u2faf\uff0c\u5982\u679c\u2eda\u2faf\u8fc7\u4e8e\u2f29\uff0c\u53ef\u80fd\u4f1a\u8d8a\u538b\u8d8a\u2f24\uff0c\u8fd9\u2fa5\u89c4\u5b9a\u2f24\u4e8e1K\u7684\u2eda\u2faf\u624d\u542f\u2f64\u538b\u7f29\uff09 gzip_buffers 4 8k; \uff08\u8bbe\u7f6e\u7cfb\u7edf\u83b7\u53d6\u2f0f\u4e2a\u5355\u4f4d\u7684\u7f13\u5b58\u2f64\u4e8e\u5b58\u50a8gzip\u7684\u538b\u7f29\u7ed3\u679c\u6570\u636e\u6d41 \u6309\u7167\u539f\u59cb\u6570\u636e\u2f24\u2f29\u4ee58K\u4e3a\u5355\u4f4d\u7533\u8bf74\u500d\u5185\u5b58\u7a7a\u95f4\uff09 gzip_comp_level 3; \uff08\u538b\u7f29\u7ea7\u522b\uff0c1\u538b\u7f29\u2f50\u6700\u2f29\u5904\u7406\u901f\u5ea6\u6700\u5feb\uff0c9\u538b\u7f29\u2f50\u6700\u2f24\u4f46\u5904\u7406\u6700\u6162\uff0c\u540c\u65f6\u4e5f\u6700\u6d88\u8017CPU,\u2f00\u822c\u8bbe\u7f6e\u4e3a3\u5c31\u53ef\u4ee5\u4e86\uff09 gzip_types text/plain text/css application/x-javascript application/javascript application/xml; \uff08\u4ec0\u4e48\u7c7b\u578b\u7684\u2eda\u2faf\u6216\u2f42\u6863\u542f\u2f64\u538b\u7f29\uff09","title":"4. \u6570\u636e\u538b\u7f29"},{"location":"linux/nginx/nginx.optimization/#5","text":"\u8bed\u6cd5\uff1a expires [time|epoch|max|off] \u9ed8\u8ba4\u503c\uff1a expires off \u4f5c\u2f64\u57df\uff1a http, server, location location ~.*\\.(js|css)?$ { expires 1h; }","title":"5. \u5ba2\u6237\u7aef\u7f13\u5b58"},{"location":"linux/nginx/nginx.optimization/#6","text":"http://www.nginx.cn/doc/","title":"6. \u53c2\u8003"},{"location":"linux/nginx/nginx.other/","text":"Nginx\u5e38\u89c1\u914d\u7f6e 1. \u4ecb\u7ecd\u76ee\u5f55\u8bbf\u95ee\u6743\u9650 \u00b6 \u4e00\u822c\uff0c\u6211\u4eec\u5bf9\u9700\u8981\u5bf9\u76ee\u5f55\u662f\u5426\u6709\u8bbf\u95ee\u6743\u9650\u505a\u9650\u5236\u3002\u6bd4\u5982a\u76ee\u5f55\u4e0b\u7981\u6b62\u8bbf\u95ee 1.1 \u914d\u7f6e \u00b6 location /a { allow 192.168.1.0/24; deny all; #return 404; return http://www.jd.com; } 2. \u8ba4\u8bc1\u767b\u5f55 \u00b6 location /b { auth_basic \"\u8bf7\u8f93\u5165\u8d26\u53f7\u548c\u5bc6\u7801\"; auth_basic_user_file /etc/nginx/htpasswd; } 3. \u53cd\u5411\u4ee3\u7406 \u00b6 location / { index index.php index.html index.htm; # \u5b9a\u4e49\u2fb8\u2eda\u7d22\u5f15\u2f42\u4ef6\u7684\u540d\u79f0 proxy_pass http://mysvr; # \u8bf7\u6c42\u8f6c\u5411mysvr \u5b9a\u4e49\u7684\u670d\u52a1\u5668\u5217\u8868 proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; client_max_body_size 10m; # \u5141\u8bb8\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u6700\u2f24\u5355\u2f42\u4ef6\u5b57\u8282\u6570 client_body_buffer_size 128k; # \u7f13\u51b2\u533a\u4ee3\u7406\u7f13\u51b2\u2f64\u6237\u7aef\u8bf7\u6c42\u7684\u6700\u2f24\u5b57\u8282\u6570\uff0c proxy_connect_timeout 90; # nginx\u8ddf\u540e\u7aef\u670d\u52a1\u5668\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4(\u4ee3\u7406\u8fde\u63a5\u8d85\u65f6) proxy_send_timeout 90; # \u540e\u7aef\u670d\u52a1\u5668\u6570\u636e\u56de\u4f20\u65f6\u95f4(\u4ee3\u7406\u53d1\u9001\u8d85\u65f6) proxy_read_timeout 90; # \u8fde\u63a5\u6210\u529f\u540e\uff0c\u540e\u7aef\u670d\u52a1\u5668\u54cd\u5e94\u65f6\u95f4(\u4ee3\u7406\u63a5\u6536\u8d85\u65f6) proxy_buffer_size 4k; # \u8bbe\u7f6e\u4ee3\u7406\u670d\u52a1\u5668\uff08nginx\uff09\u4fdd\u5b58\u2f64\u6237\u5934\u4fe1\u606f\u7684\u7f13\u51b2\u533a\u2f24\u2f29 proxy_buffers 4 32k; # proxy_buffers\u7f13\u51b2\u533a\uff0c\u2f79\u2eda\u5e73\u5747\u572832k\u4ee5\u4e0b\u7684\u8bdd\uff0c\u8fd9\u6837\u8bbe\u7f6e proxy_busy_buffers_size 64k; # \u2fbc\u8d1f\u8377\u4e0b\u7f13\u51b2\u2f24\u2f29\uff08proxy_buffers*2\uff09 proxy_temp_file_write_size 64k; # \u8bbe\u5b9a\u7f13\u5b58\u2f42\u4ef6\u5939\u2f24\u2f29\uff0c\u2f24\u4e8e\u8fd9\u4e2a\u503c\uff0c\u5c06\u4eceupstream\u670d\u52a1\u5668\u4f20 4. \u9650\u901f \u00b6 \u9650\u901f\u8be5\u7279\u6027\u53ef\u4ee5\u9650\u5236\u67d0\u4e2a\u2f64\u6237\u5728\u2f00\u4e2a\u7ed9\u5b9a\u65f6\u95f4\u6bb5\u5185\u80fd\u591f\u4ea7\u2f63\u7684HTTP\u8bf7\u6c42\u6570\u3002\u8bf7\u6c42\u53ef\u4ee5\u7b80\u5355\u5230\u5c31\u662f\u2f00\u4e2a\u5bf9\u4e8e\u4e3b\u2eda\u7684GET\u8bf7\u6c42\u6216\u8005\u2f00\u4e2a\u767b\u9646\u8868\u683c\u7684POST\u8bf7\u6c42\u3002 \u9650\u901f\u4e5f\u53ef\u4ee5\u2f64\u4e8e\u5b89\u5168\u2f6c\u7684\u4e0a\uff0c\u2f50\u5982\u66b4\u2f12\u5bc6\u7801\u7834\u89e3\u653b\u51fb\u3002\u901a\u8fc7\u9650\u5236\u8fdb\u6765\u7684\u8bf7\u6c42\u901f\u7387\uff0c\u5e76\u4e14\uff08\u7ed3\u5408\u2f47\u5fd7\uff09\u6807\u8bb0\u51fa\u2f6c\u6807URLs\u6765\u5e2e\u52a9\u9632\u8303DDoS\u653b\u51fb\u3002\u2f00\u822c\u5730\u8bf4\uff0c\u9650\u6d41\u662f\u2f64\u5728 \u4fdd\u62a4\u4e0a\u6e38\u5e94\u2f64\u670d\u52a1\u5668\u4e0d\u88ab\u5728\u540c\u2f00\u65f6\u523b\u7684\u2f24\u91cf\u2f64\u6237\u8bf7\u6c42\u6e6e\u6ca1\u3002 \u5e94\u7528\u5e38\u89c1 DDOS\u9632\u5fa1 \u4e0b\u8f7d\u573a\u666f\u4fdd\u62a4IO Nginx\u5b98\u2f45\u7248\u672c\u9650\u5236IP\u7684\u8fde\u63a5\u548c\u5e76\u53d1\u5206\u522b\u6709\u4e24\u4e2a\u6a21\u5757\uff1a limit_req_zone \u2f64\u6765\u9650\u5236\u5355\u4f4d\u65f6\u95f4\u5185\u7684\u8bf7\u6c42\u6570\uff0c\u5373\u901f\u7387\u9650\u5236 Syntax: limit_req zone=name [burst=number] [nodelay]; Default: \u2014 Context: http, server, locati limit_req_conn \u2f64\u6765\u9650\u5236\u540c\u2f00\u65f6\u95f4\u8fde\u63a5\u6570\uff0c\u5373\u5e76\u53d1\u9650 4.1 \u6848\u4f8b1 \u00b6 \u57fa\u4e8eIP\u5bf9\u4e0b\u8f7d\u901f\u7387\u505a\u9650\u5236 \u9650\u5236\u6bcf\u79d2\u5904\u74061\u6b21\u8bf7\u6c42\uff0c\u5bf9\u7a81\u53d1\u8d85\u8fc75\u4e2a\u4ee5\u540e\u7684\u8bf7\u6c42\u653e\u2f0a\u7f13\u5b58\u533a http { limit_req_zone $binary_remote_addr zone=baism:10m rate=1r/s; server { location /search/ { limit_req zone=baism burst=5 nodelay; } \u53c2\u6570\u8bbe\u7f6e limit_req_zone $ binary_remote_addr zone = baism : 10 m rate = 1 r / s ; \u7b2c\u2f00\u4e2a\u53c2\u6570\uff1a$ binary_remote_addr \u8868\u793a\u901a\u8fc7 remote_addr\u8fd9\u4e2a\u6807\u8bc6\u6765\u505a\u9650\u5236 \uff0c\u201c binary_ \u201d\u7684\u2f6c\u7684\u662f\u7f29\u5199\u5185\u5b58\u5360\u2f64\u91cf\uff0c\u662f\u9650\u5236\u540c\u2f00\u5ba2\u6237\u7aef ip\u5730\u5740 \u3002 \u7b2c\u2f06\u4e2a\u53c2\u6570\uff1a zone = baism : 10 m\u8868\u793a \u2f63\u6210\u2f00\u4e2a\u2f24\u2f29\u4e3a 10 M \uff0c\u540d\u5b57\u4e3a one\u7684\u5185\u5b58\u533a\u57df \uff0c\u2f64\u6765\u5b58\u50a8\u8bbf\u95ee\u7684\u9891\u6b21\u4fe1\u606f\u3002 \u7b2c\u4e09\u4e2a\u53c2\u6570\uff1a rate = 1 r / s\u8868\u793a\u5141\u8bb8\u76f8\u540c\u6807\u8bc6\u7684\u5ba2\u6237\u7aef\u7684\u8bbf\u95ee\u9891\u6b21 \uff0c\u8fd9\u2fa5\u9650\u5236\u7684\u662f\u6bcf\u79d2 1 \u6b21\uff0c\u8fd8\u53ef\u4ee5\u6709\u2f50\u5982 30 r / m\u7684 \u3002 limit_req zone = baism burst = 5 nodelay ; \u7b2c\u2f00\u4e2a\u53c2\u6570\uff1a zone = baism \u8bbe\u7f6e\u4f7f\u2f64\u54ea\u4e2a\u914d\u7f6e\u533a\u57df\u6765\u505a\u9650\u5236\uff0c\u4e0e\u4e0a\u2faf limit_req_zone \u2fa5\u7684 name\u5bf9\u5e94 \u3002 \u7b2c\u2f06\u4e2a\u53c2\u6570\uff1a burst = 5 \uff0c\u91cd\u70b9\u8bf4\u660e\u2f00\u4e0b\u8fd9\u4e2a\u914d\u7f6e\uff0c burst\u7206\u53d1\u7684\u610f\u601d \uff0c\u8fd9\u4e2a\u914d\u7f6e\u7684\u610f\u601d\u662f\u8bbe\u7f6e\u2f00\u4e2a\u2f24\u2f29\u4e3a 5 \u7684\u7f13\u51b2\u533a\u5f53\u6709\u2f24\u91cf\u8bf7\u6c42\uff08\u7206\u53d1\uff09\u8fc7\u6765\u65f6\uff0c\u8d85\u8fc7\u4e86\u8bbf\u95ee\u9891\u6b21\u9650\u5236\u7684\u8bf7 \u6c42\u53ef\u4ee5\u5148\u653e\u5230\u8fd9\u4e2a\u7f13\u51b2\u533a\u5185\u3002 \u7b2c\u4e09\u4e2a\u53c2\u6570\uff1a nodelay \uff0c\u5982\u679c\u8bbe\u7f6e\uff0c\u8d85\u8fc7\u8bbf\u95ee\u9891\u6b21\u2f7d\u4e14\u7f13\u51b2\u533a\u4e5f\u6ee1\u4e86\u7684\u65f6\u5019\u5c31\u4f1a\u76f4\u63a5\u8fd4\u56de 503 \uff0c\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\uff0c\u5219\u6240\u6709\u8bf7\u6c42\u4f1a\u7b49\u5f85\u6392 4.2 \u6848\u4f8b2 \u00b6 \u57fa\u4e8eIP\u505a\u8fde\u63a5\u9650\u5236 \u9650\u5236\u540c\u2f00IP\u5e76\u53d1\u4e3a1 \u4e0b\u8f7d\u901f\u5ea6\u4e3a100K limit_conn_zone $binary_remote_addr zone=addr:10m; server { listen 80; server_name localhost; location / { root html; index index.html index.htm; } location /abc { limit_conn addr 1; limit_rate 100k; } } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; # \u57fa\u4e8eIP\u505a\u8fde\u63a5\u9650\u5236 \u9650\u5236\u540c\u2f00IP\u5e76\u53d1\u4e3a1 \u4e0b\u8f7d\u901f\u5ea6\u4e3a100K limit_conn_zone $binary_remote_addr zone=addr:10m; # \u57fa\u4e8eIP\u5bf9\u4e0b\u8f7d\u901f\u7387\u505a\u9650\u5236 \u9650\u5236\u6bcf\u79d2\u5904\u74061\u6b21\u8bf7\u6c42\uff0c\u5bf9\u7a81\u53d1\u8d85\u8fc75\u4e2a\u4ee5\u540e\u7684\u8bf7\u6c42\u653e\u2f0a\u7f13\u5b58\u533a limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s; server { listen 80; server_name localhost; location / { root html; index index.html index.htm; } location /abc { limit_req zone=one burst=5 nodelay; limit_conn addr 1; limit_rate 100k; } } 5. URL \u91cd\u5199 \u00b6 rewrite\u6a21\u5757\uff08ngx_http_rewrite_module\uff09 Rewrite\u529f\u529f\u80fd\u662fNginx\u670d\u52a1\u5668\u63d0\u4f9b\u7684\u2f00\u4e2a\u91cd\u8981\u529f\u80fd\u3002\u2f0f\u4e4e\u662f\u6240\u6709\u7684web\u4ea7\u54c1\u5fc5\u5907\u6280\u80fd\uff0c\u2f64\u4e8e\u5b9e\u73b0URL\u91cd\u5199\u3002URL\u91cd\u5199\u662f\u2fae\u5e38\u6709\u2f64\u7684\u529f\u80fd\uff0c\u2f50\u5982\u5b83\u53ef\u4ee5\u5728 \u6211\u4eec\u5728\u6539\u53d8\u2f79\u7ad9\u7ed3\u6784\u540e\uff0c\u4e0d\u9700\u8981\u5ba2\u6237\u7aef\u4fee\u6539\u539f\u6765\u7684\u4e66\u7b7e\uff0c\u4e5f\u4e0d\u9700\u8981\u5176\u4ed6\u2f79\u7ad9\u4fee\u6539\u5bf9\u6211\u4eec\u2f79\u7ad9\u7684\u53cb\u60c5\u94fe\u63a5\uff0c\u8fd8\u53ef\u4ee5\u5728\u2f00\u5b9a\u7a0b\u5ea6\u4e0a\u63d0\u2fbc\u2f79\u7ad9\u7684\u5b89\u5168\u6027\uff0c\u80fd\u591f \u8ba9\u6211\u4eec\u7684\u2f79\u7ad9\u663e\u5f97\u66f4\u4e13\u4e1a\u3002 Nginx\u670d\u52a1\u5668Rewrite\u529f\u80fd\u7684\u5b9e\u73b0\u662f\u4f9d\u8d56\u4e8ePCRE\uff08Perl Compatible Regular Expression\u3002Perl\u517c\u5bb9\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\u7684\u2f40\u6301\uff0c\u6240\u4ee5\u5728\u7f16\u8bd1\u5b89\u88c5Nginx\u4e4b\u524d\uff0c \u9700\u8981\u5b89\u88c5PCRE \u5e94\u7528\u573a\u666f \u57df\u540d\u53d8\u66f4 \uff08\u4eac\u4e1c\uff09 \u2f64\u6237\u8df3\u8f6c \uff08\u4ece\u67d0\u4e2a\u8fde\u63a5\u8df3\u5230\u53e6\u2f00\u4e2a\u8fde\u63a5\uff09 \u4f2a\u9759\u6001\u573a\u666f \uff08\u4fbf\u4e8eCDN\u7f13\u5b58\u52a8\u6001\u2eda\u2faf\u6570 URL rewrite \u8bed\u6cd5 rewrite <regex> <replacement> [flag]; \u5173\u952e\u5b57 \u6b63\u5219 \u66ff\u4ee3\u5185\u5bb9 flag\u6807\u8bb0 flag: last # \u672c\u6761\u89c4\u5219\u5339\u914d\u5b8c\u6210\u540e\uff0c\u7ee7\u7eed\u5411\u4e0b\u5339\u914d\u65b0\u7684location URI\u89c4\u5219 break # \u672c\u6761\u89c4\u5219\u5339\u914d\u5b8c\u6210\u5373\u7ec8\u2f4c\uff0c\u4e0d\u518d\u5339\u914d\u540e\u2faf\u7684\u4efb\u4f55\u89c4\u5219 redirect # \u8fd4\u56de302\u4e34\u65f6\u91cd\u5b9a\u5411\uff0c\u6d4f\u89c8\u5668\u5730\u5740\u4f1a\u663e\u793a\u8df3\u8f6c\u540e\u7684URL\u5730\u5740 permanent # \u8fd4\u56de301\u6c38\u4e45\u91cd\u5b9a\u5411\uff0c\u6d4f\u89c8\u5668\u5730\u5740\u680f\u4f1a\u663e\u793a\u8df3\u8f6c\u540e\u7684URL\u5730\u5740 set\u6307\u4ee4 \u2f83\u5b9a\u4e49\u53d8\u91cf Syntax: set $variable value; Default: \u2014 Context: server, location, 1) set \u8bbe\u7f6e\u53d8\u91cf 2) if \u8d1f\u8d23\u8bed\u53e5\u4e2d\u7684\u5224\u65ad 3) return \u8fd4\u56de\u8fd4\u56de\u503c\u6216URL 4) break \u7ec8\u2f4c\u540e\u7eed\u7684rewrite\u89c4\u5219 5) rewrite \u91cd\u5b9a\u5411U 5.1 \u6848\u4f8b1 \u00b6 \u5c06http:// www.caimengzhi.com \u91cd\u5199\u4e3a http://www.caimengzhi.com/blog location / { set $name blog; rewrite ^(.*)$ http://www.caimengzhi.com/$name; } 5.2 \u6848\u4f8b2 \u00b6 if \u6307\u4ee4 \u8d1f\u8d23\u5224\u65ad Syntax: if (condition) { ... } Default: \u2014Context: server, location location / { root html; index index.html index.htm; if ($http_user_agent ~* 'Chrome') { return 403; #return http://www.jd.com; } 5.3 \u6848\u4f8b3 \u00b6 return \u6307\u4ee4 \u5b9a\u4e49\u8fd4\u56de\u6570\u636e Syntax: return code [text]; return code URL; return URL; Default: \u2014Context: server, location, if location / { root html; index index.html index.htm; if ($http_user_agent ~* 'Chrome') { return 403; #return http://www.jd.com; } 5.4 \u6848\u4f8b4 \u00b6 break \u6307\u4ee4 \u505c\u2f4c\u6267\u2f8f\u5f53\u524d\u865a\u62df\u4e3b\u673a\u7684\u540e\u7eedrewrite\u6307\u4ee4\u96c6 Syntax: break; Default:\u2014 Context:server, location, if location / { root html; index index.html index.htm; if ($http_user_agent ~* 'Chrome') { break; return 403; } 5.5 \u6848\u4f8b5 \u00b6 \u57df\u540d\u8df3\u8f6c www.caimengzhi.com \u91cd\u5199\u4e3a www.jd.com server { listen 80; server_name www.caimengzhi.com; location / { rewrite ^/$ http://www.jd.com permanent; } \u6ce8\u610f \u6ce8\u610f : \u91cd\u5b9a\u5411\u5c31\u662f\u5c06\u2f79\u2eda\u2f83\u52a8\u8f6c\u5411\u91cd\u5b9a\u5411 301 \u6c38\u4e45\u6027\u91cd\u5b9a\u5411\uff1a\u65b0\u2f79\u5740\u5b8c\u5168\u7ee7\u627f\u65e7\u2f79\u5740\uff0c\u65e7\u2f79\u5740\u7684\u6392\u540d\u7b49\u5b8c\u5168\u6e05\u96f6 301 \u91cd\u5b9a\u5411\u662f\u2f79\u2eda\u66f4\u6539\u5730\u5740\u540e\u5bf9\u641c\u7d22\u5f15\u64ce\u53cb\u597d\u7684\u6700\u597d\u2f45\u6cd5\uff0c\u53ea\u8981\u4e0d\u662f\u6682\u65f6\u642c\u79fb\u7684\u60c5\u51b5\uff0c\u90fd\u5efa\u8bae\u4f7f\u2f64 301 \u6765\u505a\u8f6c\u5740\u3002 302 \u4e34\u65f6\u6027\u91cd\u5b9a\u5411\uff1a\u5bf9\u65e7\u2f79\u5740\u6ca1\u6709\u5f71\u54cd\uff0c\u4f46\u65b0\u2f79\u5740\u4e0d\u4f1a\u6709\u6392\u540d \u641c\u7d22\u5f15\u64ce\u4f1a\u6293\u53d6\u65b0\u7684\u5185\u5bb9\u2f7d\u4fdd\u7559\u65e7\u7684 break,\u672c\u6761\u89c4\u5219\u5339\u914d\u5b8c\u6210\u5373\u7ec8\u2f4c\uff0c\u4e0d\u518d\u5339\u914d\u540e\u2faf\u7684\u4efb\u4f55\u89c4\u5219,\u7c7b\u4f3c\u4e34\u65f6\u91cd\u5b9a\u5411\uff0c\u8fd4\u56de\u5ba2\u6237\u7aef3 5.6 \u6848\u4f8b6 \u00b6 \u6839\u636e\u2f64\u6237\u6d4f\u89c8\u5668\u91cd\u5199\u8bbf\u95ee\u2f6c\u5f55\uff0c\u5982\u679c\u662fchrome\u6d4f\u89c8\u5668 \u5c31\u5c06 http://192.168.1.30/ URI \u91cd\u5199\u4e3a http://192.168.1.30/chrome/ URI \u91cd\u5199\u4e3a http://192.168.1.30/chrome/ UR location / { ..... if ($http_user_agent ~* 'chrome') { rewrite ^(.*)$ /chrome/$1 last; } location /chrome { root html ; index index.html; } \u89e3\u91ca ^ \u4ee5\u4ec0\u4e48\u5f00\u5934 ^ a $ \u4ee5\u4ec0\u4e48\u7ed3\u5c3e c $ . \u9664\u4e86\u56de\u2ecb\u4ee5\u5916\u7684\u4efb\u610f\u2f00\u4e2a\u5b57\u7b26 * \u524d\u2faf\u7684\u5b57\u7b26\u53ef\u4ee5\u51fa\u73b0\u591a\u6b21\u6216\u8005\u4e0d\u51fa\u73b0 \u66f4\u591a\u5185\u5bb9\u770b\u6b63\u5219\u8868\u8fbe\u5f0f re","title":"06. nginx \u5e38\u89c1\u914d\u7f6e"},{"location":"linux/nginx/nginx.other/#1","text":"\u4e00\u822c\uff0c\u6211\u4eec\u5bf9\u9700\u8981\u5bf9\u76ee\u5f55\u662f\u5426\u6709\u8bbf\u95ee\u6743\u9650\u505a\u9650\u5236\u3002\u6bd4\u5982a\u76ee\u5f55\u4e0b\u7981\u6b62\u8bbf\u95ee","title":"1. \u4ecb\u7ecd\u76ee\u5f55\u8bbf\u95ee\u6743\u9650"},{"location":"linux/nginx/nginx.other/#11","text":"location /a { allow 192.168.1.0/24; deny all; #return 404; return http://www.jd.com; }","title":"1.1 \u914d\u7f6e"},{"location":"linux/nginx/nginx.other/#2","text":"location /b { auth_basic \"\u8bf7\u8f93\u5165\u8d26\u53f7\u548c\u5bc6\u7801\"; auth_basic_user_file /etc/nginx/htpasswd; }","title":"2. \u8ba4\u8bc1\u767b\u5f55"},{"location":"linux/nginx/nginx.other/#3","text":"location / { index index.php index.html index.htm; # \u5b9a\u4e49\u2fb8\u2eda\u7d22\u5f15\u2f42\u4ef6\u7684\u540d\u79f0 proxy_pass http://mysvr; # \u8bf7\u6c42\u8f6c\u5411mysvr \u5b9a\u4e49\u7684\u670d\u52a1\u5668\u5217\u8868 proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; client_max_body_size 10m; # \u5141\u8bb8\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u6700\u2f24\u5355\u2f42\u4ef6\u5b57\u8282\u6570 client_body_buffer_size 128k; # \u7f13\u51b2\u533a\u4ee3\u7406\u7f13\u51b2\u2f64\u6237\u7aef\u8bf7\u6c42\u7684\u6700\u2f24\u5b57\u8282\u6570\uff0c proxy_connect_timeout 90; # nginx\u8ddf\u540e\u7aef\u670d\u52a1\u5668\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4(\u4ee3\u7406\u8fde\u63a5\u8d85\u65f6) proxy_send_timeout 90; # \u540e\u7aef\u670d\u52a1\u5668\u6570\u636e\u56de\u4f20\u65f6\u95f4(\u4ee3\u7406\u53d1\u9001\u8d85\u65f6) proxy_read_timeout 90; # \u8fde\u63a5\u6210\u529f\u540e\uff0c\u540e\u7aef\u670d\u52a1\u5668\u54cd\u5e94\u65f6\u95f4(\u4ee3\u7406\u63a5\u6536\u8d85\u65f6) proxy_buffer_size 4k; # \u8bbe\u7f6e\u4ee3\u7406\u670d\u52a1\u5668\uff08nginx\uff09\u4fdd\u5b58\u2f64\u6237\u5934\u4fe1\u606f\u7684\u7f13\u51b2\u533a\u2f24\u2f29 proxy_buffers 4 32k; # proxy_buffers\u7f13\u51b2\u533a\uff0c\u2f79\u2eda\u5e73\u5747\u572832k\u4ee5\u4e0b\u7684\u8bdd\uff0c\u8fd9\u6837\u8bbe\u7f6e proxy_busy_buffers_size 64k; # \u2fbc\u8d1f\u8377\u4e0b\u7f13\u51b2\u2f24\u2f29\uff08proxy_buffers*2\uff09 proxy_temp_file_write_size 64k; # \u8bbe\u5b9a\u7f13\u5b58\u2f42\u4ef6\u5939\u2f24\u2f29\uff0c\u2f24\u4e8e\u8fd9\u4e2a\u503c\uff0c\u5c06\u4eceupstream\u670d\u52a1\u5668\u4f20","title":"3. \u53cd\u5411\u4ee3\u7406"},{"location":"linux/nginx/nginx.other/#4","text":"\u9650\u901f\u8be5\u7279\u6027\u53ef\u4ee5\u9650\u5236\u67d0\u4e2a\u2f64\u6237\u5728\u2f00\u4e2a\u7ed9\u5b9a\u65f6\u95f4\u6bb5\u5185\u80fd\u591f\u4ea7\u2f63\u7684HTTP\u8bf7\u6c42\u6570\u3002\u8bf7\u6c42\u53ef\u4ee5\u7b80\u5355\u5230\u5c31\u662f\u2f00\u4e2a\u5bf9\u4e8e\u4e3b\u2eda\u7684GET\u8bf7\u6c42\u6216\u8005\u2f00\u4e2a\u767b\u9646\u8868\u683c\u7684POST\u8bf7\u6c42\u3002 \u9650\u901f\u4e5f\u53ef\u4ee5\u2f64\u4e8e\u5b89\u5168\u2f6c\u7684\u4e0a\uff0c\u2f50\u5982\u66b4\u2f12\u5bc6\u7801\u7834\u89e3\u653b\u51fb\u3002\u901a\u8fc7\u9650\u5236\u8fdb\u6765\u7684\u8bf7\u6c42\u901f\u7387\uff0c\u5e76\u4e14\uff08\u7ed3\u5408\u2f47\u5fd7\uff09\u6807\u8bb0\u51fa\u2f6c\u6807URLs\u6765\u5e2e\u52a9\u9632\u8303DDoS\u653b\u51fb\u3002\u2f00\u822c\u5730\u8bf4\uff0c\u9650\u6d41\u662f\u2f64\u5728 \u4fdd\u62a4\u4e0a\u6e38\u5e94\u2f64\u670d\u52a1\u5668\u4e0d\u88ab\u5728\u540c\u2f00\u65f6\u523b\u7684\u2f24\u91cf\u2f64\u6237\u8bf7\u6c42\u6e6e\u6ca1\u3002 \u5e94\u7528\u5e38\u89c1 DDOS\u9632\u5fa1 \u4e0b\u8f7d\u573a\u666f\u4fdd\u62a4IO Nginx\u5b98\u2f45\u7248\u672c\u9650\u5236IP\u7684\u8fde\u63a5\u548c\u5e76\u53d1\u5206\u522b\u6709\u4e24\u4e2a\u6a21\u5757\uff1a limit_req_zone \u2f64\u6765\u9650\u5236\u5355\u4f4d\u65f6\u95f4\u5185\u7684\u8bf7\u6c42\u6570\uff0c\u5373\u901f\u7387\u9650\u5236 Syntax: limit_req zone=name [burst=number] [nodelay]; Default: \u2014 Context: http, server, locati limit_req_conn \u2f64\u6765\u9650\u5236\u540c\u2f00\u65f6\u95f4\u8fde\u63a5\u6570\uff0c\u5373\u5e76\u53d1\u9650","title":"4. \u9650\u901f"},{"location":"linux/nginx/nginx.other/#41-1","text":"\u57fa\u4e8eIP\u5bf9\u4e0b\u8f7d\u901f\u7387\u505a\u9650\u5236 \u9650\u5236\u6bcf\u79d2\u5904\u74061\u6b21\u8bf7\u6c42\uff0c\u5bf9\u7a81\u53d1\u8d85\u8fc75\u4e2a\u4ee5\u540e\u7684\u8bf7\u6c42\u653e\u2f0a\u7f13\u5b58\u533a http { limit_req_zone $binary_remote_addr zone=baism:10m rate=1r/s; server { location /search/ { limit_req zone=baism burst=5 nodelay; } \u53c2\u6570\u8bbe\u7f6e limit_req_zone $ binary_remote_addr zone = baism : 10 m rate = 1 r / s ; \u7b2c\u2f00\u4e2a\u53c2\u6570\uff1a$ binary_remote_addr \u8868\u793a\u901a\u8fc7 remote_addr\u8fd9\u4e2a\u6807\u8bc6\u6765\u505a\u9650\u5236 \uff0c\u201c binary_ \u201d\u7684\u2f6c\u7684\u662f\u7f29\u5199\u5185\u5b58\u5360\u2f64\u91cf\uff0c\u662f\u9650\u5236\u540c\u2f00\u5ba2\u6237\u7aef ip\u5730\u5740 \u3002 \u7b2c\u2f06\u4e2a\u53c2\u6570\uff1a zone = baism : 10 m\u8868\u793a \u2f63\u6210\u2f00\u4e2a\u2f24\u2f29\u4e3a 10 M \uff0c\u540d\u5b57\u4e3a one\u7684\u5185\u5b58\u533a\u57df \uff0c\u2f64\u6765\u5b58\u50a8\u8bbf\u95ee\u7684\u9891\u6b21\u4fe1\u606f\u3002 \u7b2c\u4e09\u4e2a\u53c2\u6570\uff1a rate = 1 r / s\u8868\u793a\u5141\u8bb8\u76f8\u540c\u6807\u8bc6\u7684\u5ba2\u6237\u7aef\u7684\u8bbf\u95ee\u9891\u6b21 \uff0c\u8fd9\u2fa5\u9650\u5236\u7684\u662f\u6bcf\u79d2 1 \u6b21\uff0c\u8fd8\u53ef\u4ee5\u6709\u2f50\u5982 30 r / m\u7684 \u3002 limit_req zone = baism burst = 5 nodelay ; \u7b2c\u2f00\u4e2a\u53c2\u6570\uff1a zone = baism \u8bbe\u7f6e\u4f7f\u2f64\u54ea\u4e2a\u914d\u7f6e\u533a\u57df\u6765\u505a\u9650\u5236\uff0c\u4e0e\u4e0a\u2faf limit_req_zone \u2fa5\u7684 name\u5bf9\u5e94 \u3002 \u7b2c\u2f06\u4e2a\u53c2\u6570\uff1a burst = 5 \uff0c\u91cd\u70b9\u8bf4\u660e\u2f00\u4e0b\u8fd9\u4e2a\u914d\u7f6e\uff0c burst\u7206\u53d1\u7684\u610f\u601d \uff0c\u8fd9\u4e2a\u914d\u7f6e\u7684\u610f\u601d\u662f\u8bbe\u7f6e\u2f00\u4e2a\u2f24\u2f29\u4e3a 5 \u7684\u7f13\u51b2\u533a\u5f53\u6709\u2f24\u91cf\u8bf7\u6c42\uff08\u7206\u53d1\uff09\u8fc7\u6765\u65f6\uff0c\u8d85\u8fc7\u4e86\u8bbf\u95ee\u9891\u6b21\u9650\u5236\u7684\u8bf7 \u6c42\u53ef\u4ee5\u5148\u653e\u5230\u8fd9\u4e2a\u7f13\u51b2\u533a\u5185\u3002 \u7b2c\u4e09\u4e2a\u53c2\u6570\uff1a nodelay \uff0c\u5982\u679c\u8bbe\u7f6e\uff0c\u8d85\u8fc7\u8bbf\u95ee\u9891\u6b21\u2f7d\u4e14\u7f13\u51b2\u533a\u4e5f\u6ee1\u4e86\u7684\u65f6\u5019\u5c31\u4f1a\u76f4\u63a5\u8fd4\u56de 503 \uff0c\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\uff0c\u5219\u6240\u6709\u8bf7\u6c42\u4f1a\u7b49\u5f85\u6392","title":"4.1 \u6848\u4f8b1"},{"location":"linux/nginx/nginx.other/#42-2","text":"\u57fa\u4e8eIP\u505a\u8fde\u63a5\u9650\u5236 \u9650\u5236\u540c\u2f00IP\u5e76\u53d1\u4e3a1 \u4e0b\u8f7d\u901f\u5ea6\u4e3a100K limit_conn_zone $binary_remote_addr zone=addr:10m; server { listen 80; server_name localhost; location / { root html; index index.html index.htm; } location /abc { limit_conn addr 1; limit_rate 100k; } } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; # \u57fa\u4e8eIP\u505a\u8fde\u63a5\u9650\u5236 \u9650\u5236\u540c\u2f00IP\u5e76\u53d1\u4e3a1 \u4e0b\u8f7d\u901f\u5ea6\u4e3a100K limit_conn_zone $binary_remote_addr zone=addr:10m; # \u57fa\u4e8eIP\u5bf9\u4e0b\u8f7d\u901f\u7387\u505a\u9650\u5236 \u9650\u5236\u6bcf\u79d2\u5904\u74061\u6b21\u8bf7\u6c42\uff0c\u5bf9\u7a81\u53d1\u8d85\u8fc75\u4e2a\u4ee5\u540e\u7684\u8bf7\u6c42\u653e\u2f0a\u7f13\u5b58\u533a limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s; server { listen 80; server_name localhost; location / { root html; index index.html index.htm; } location /abc { limit_req zone=one burst=5 nodelay; limit_conn addr 1; limit_rate 100k; } }","title":"4.2 \u6848\u4f8b2"},{"location":"linux/nginx/nginx.other/#5-url","text":"rewrite\u6a21\u5757\uff08ngx_http_rewrite_module\uff09 Rewrite\u529f\u529f\u80fd\u662fNginx\u670d\u52a1\u5668\u63d0\u4f9b\u7684\u2f00\u4e2a\u91cd\u8981\u529f\u80fd\u3002\u2f0f\u4e4e\u662f\u6240\u6709\u7684web\u4ea7\u54c1\u5fc5\u5907\u6280\u80fd\uff0c\u2f64\u4e8e\u5b9e\u73b0URL\u91cd\u5199\u3002URL\u91cd\u5199\u662f\u2fae\u5e38\u6709\u2f64\u7684\u529f\u80fd\uff0c\u2f50\u5982\u5b83\u53ef\u4ee5\u5728 \u6211\u4eec\u5728\u6539\u53d8\u2f79\u7ad9\u7ed3\u6784\u540e\uff0c\u4e0d\u9700\u8981\u5ba2\u6237\u7aef\u4fee\u6539\u539f\u6765\u7684\u4e66\u7b7e\uff0c\u4e5f\u4e0d\u9700\u8981\u5176\u4ed6\u2f79\u7ad9\u4fee\u6539\u5bf9\u6211\u4eec\u2f79\u7ad9\u7684\u53cb\u60c5\u94fe\u63a5\uff0c\u8fd8\u53ef\u4ee5\u5728\u2f00\u5b9a\u7a0b\u5ea6\u4e0a\u63d0\u2fbc\u2f79\u7ad9\u7684\u5b89\u5168\u6027\uff0c\u80fd\u591f \u8ba9\u6211\u4eec\u7684\u2f79\u7ad9\u663e\u5f97\u66f4\u4e13\u4e1a\u3002 Nginx\u670d\u52a1\u5668Rewrite\u529f\u80fd\u7684\u5b9e\u73b0\u662f\u4f9d\u8d56\u4e8ePCRE\uff08Perl Compatible Regular Expression\u3002Perl\u517c\u5bb9\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\u7684\u2f40\u6301\uff0c\u6240\u4ee5\u5728\u7f16\u8bd1\u5b89\u88c5Nginx\u4e4b\u524d\uff0c \u9700\u8981\u5b89\u88c5PCRE \u5e94\u7528\u573a\u666f \u57df\u540d\u53d8\u66f4 \uff08\u4eac\u4e1c\uff09 \u2f64\u6237\u8df3\u8f6c \uff08\u4ece\u67d0\u4e2a\u8fde\u63a5\u8df3\u5230\u53e6\u2f00\u4e2a\u8fde\u63a5\uff09 \u4f2a\u9759\u6001\u573a\u666f \uff08\u4fbf\u4e8eCDN\u7f13\u5b58\u52a8\u6001\u2eda\u2faf\u6570 URL rewrite \u8bed\u6cd5 rewrite <regex> <replacement> [flag]; \u5173\u952e\u5b57 \u6b63\u5219 \u66ff\u4ee3\u5185\u5bb9 flag\u6807\u8bb0 flag: last # \u672c\u6761\u89c4\u5219\u5339\u914d\u5b8c\u6210\u540e\uff0c\u7ee7\u7eed\u5411\u4e0b\u5339\u914d\u65b0\u7684location URI\u89c4\u5219 break # \u672c\u6761\u89c4\u5219\u5339\u914d\u5b8c\u6210\u5373\u7ec8\u2f4c\uff0c\u4e0d\u518d\u5339\u914d\u540e\u2faf\u7684\u4efb\u4f55\u89c4\u5219 redirect # \u8fd4\u56de302\u4e34\u65f6\u91cd\u5b9a\u5411\uff0c\u6d4f\u89c8\u5668\u5730\u5740\u4f1a\u663e\u793a\u8df3\u8f6c\u540e\u7684URL\u5730\u5740 permanent # \u8fd4\u56de301\u6c38\u4e45\u91cd\u5b9a\u5411\uff0c\u6d4f\u89c8\u5668\u5730\u5740\u680f\u4f1a\u663e\u793a\u8df3\u8f6c\u540e\u7684URL\u5730\u5740 set\u6307\u4ee4 \u2f83\u5b9a\u4e49\u53d8\u91cf Syntax: set $variable value; Default: \u2014 Context: server, location, 1) set \u8bbe\u7f6e\u53d8\u91cf 2) if \u8d1f\u8d23\u8bed\u53e5\u4e2d\u7684\u5224\u65ad 3) return \u8fd4\u56de\u8fd4\u56de\u503c\u6216URL 4) break \u7ec8\u2f4c\u540e\u7eed\u7684rewrite\u89c4\u5219 5) rewrite \u91cd\u5b9a\u5411U","title":"5. URL \u91cd\u5199"},{"location":"linux/nginx/nginx.other/#51-1","text":"\u5c06http:// www.caimengzhi.com \u91cd\u5199\u4e3a http://www.caimengzhi.com/blog location / { set $name blog; rewrite ^(.*)$ http://www.caimengzhi.com/$name; }","title":"5.1 \u6848\u4f8b1"},{"location":"linux/nginx/nginx.other/#52-2","text":"if \u6307\u4ee4 \u8d1f\u8d23\u5224\u65ad Syntax: if (condition) { ... } Default: \u2014Context: server, location location / { root html; index index.html index.htm; if ($http_user_agent ~* 'Chrome') { return 403; #return http://www.jd.com; }","title":"5.2 \u6848\u4f8b2"},{"location":"linux/nginx/nginx.other/#53-3","text":"return \u6307\u4ee4 \u5b9a\u4e49\u8fd4\u56de\u6570\u636e Syntax: return code [text]; return code URL; return URL; Default: \u2014Context: server, location, if location / { root html; index index.html index.htm; if ($http_user_agent ~* 'Chrome') { return 403; #return http://www.jd.com; }","title":"5.3 \u6848\u4f8b3"},{"location":"linux/nginx/nginx.other/#54-4","text":"break \u6307\u4ee4 \u505c\u2f4c\u6267\u2f8f\u5f53\u524d\u865a\u62df\u4e3b\u673a\u7684\u540e\u7eedrewrite\u6307\u4ee4\u96c6 Syntax: break; Default:\u2014 Context:server, location, if location / { root html; index index.html index.htm; if ($http_user_agent ~* 'Chrome') { break; return 403; }","title":"5.4 \u6848\u4f8b4"},{"location":"linux/nginx/nginx.other/#55-5","text":"\u57df\u540d\u8df3\u8f6c www.caimengzhi.com \u91cd\u5199\u4e3a www.jd.com server { listen 80; server_name www.caimengzhi.com; location / { rewrite ^/$ http://www.jd.com permanent; } \u6ce8\u610f \u6ce8\u610f : \u91cd\u5b9a\u5411\u5c31\u662f\u5c06\u2f79\u2eda\u2f83\u52a8\u8f6c\u5411\u91cd\u5b9a\u5411 301 \u6c38\u4e45\u6027\u91cd\u5b9a\u5411\uff1a\u65b0\u2f79\u5740\u5b8c\u5168\u7ee7\u627f\u65e7\u2f79\u5740\uff0c\u65e7\u2f79\u5740\u7684\u6392\u540d\u7b49\u5b8c\u5168\u6e05\u96f6 301 \u91cd\u5b9a\u5411\u662f\u2f79\u2eda\u66f4\u6539\u5730\u5740\u540e\u5bf9\u641c\u7d22\u5f15\u64ce\u53cb\u597d\u7684\u6700\u597d\u2f45\u6cd5\uff0c\u53ea\u8981\u4e0d\u662f\u6682\u65f6\u642c\u79fb\u7684\u60c5\u51b5\uff0c\u90fd\u5efa\u8bae\u4f7f\u2f64 301 \u6765\u505a\u8f6c\u5740\u3002 302 \u4e34\u65f6\u6027\u91cd\u5b9a\u5411\uff1a\u5bf9\u65e7\u2f79\u5740\u6ca1\u6709\u5f71\u54cd\uff0c\u4f46\u65b0\u2f79\u5740\u4e0d\u4f1a\u6709\u6392\u540d \u641c\u7d22\u5f15\u64ce\u4f1a\u6293\u53d6\u65b0\u7684\u5185\u5bb9\u2f7d\u4fdd\u7559\u65e7\u7684 break,\u672c\u6761\u89c4\u5219\u5339\u914d\u5b8c\u6210\u5373\u7ec8\u2f4c\uff0c\u4e0d\u518d\u5339\u914d\u540e\u2faf\u7684\u4efb\u4f55\u89c4\u5219,\u7c7b\u4f3c\u4e34\u65f6\u91cd\u5b9a\u5411\uff0c\u8fd4\u56de\u5ba2\u6237\u7aef3","title":"5.5 \u6848\u4f8b5"},{"location":"linux/nginx/nginx.other/#56-6","text":"\u6839\u636e\u2f64\u6237\u6d4f\u89c8\u5668\u91cd\u5199\u8bbf\u95ee\u2f6c\u5f55\uff0c\u5982\u679c\u662fchrome\u6d4f\u89c8\u5668 \u5c31\u5c06 http://192.168.1.30/ URI \u91cd\u5199\u4e3a http://192.168.1.30/chrome/ URI \u91cd\u5199\u4e3a http://192.168.1.30/chrome/ UR location / { ..... if ($http_user_agent ~* 'chrome') { rewrite ^(.*)$ /chrome/$1 last; } location /chrome { root html ; index index.html; } \u89e3\u91ca ^ \u4ee5\u4ec0\u4e48\u5f00\u5934 ^ a $ \u4ee5\u4ec0\u4e48\u7ed3\u5c3e c $ . \u9664\u4e86\u56de\u2ecb\u4ee5\u5916\u7684\u4efb\u610f\u2f00\u4e2a\u5b57\u7b26 * \u524d\u2faf\u7684\u5b57\u7b26\u53ef\u4ee5\u51fa\u73b0\u591a\u6b21\u6216\u8005\u4e0d\u51fa\u73b0 \u66f4\u591a\u5185\u5bb9\u770b\u6b63\u5219\u8868\u8fbe\u5f0f re","title":"5.6 \u6848\u4f8b6"},{"location":"linux/nginx/nginx.rewrite/","text":"Nginx Rewrite 1. \u4ecb\u7ecd \u00b6 \u548cApache\u7b49web\u670d\u52a1\u8f6f\u4ef6\u4e00\u6837\uff0cNginx Rewrite\u7684\u4e3b\u8981\u529f\u80fd\u4e5f\u662f\u5b9e\u73b0URL\u5730\u5740\u91cd\u5199\uff0cNginx\u7684 Rewrite\u89c4\u5219\u9700\u8981PCRE\u8f6f\u4ef6\u7684\u652f\u6301\uff0c\u5373\u901a\u8fc7Perl\u517c\u5bb9\u6b63\u5219\u8868\u8fbe\u5f0f\u8bed\u6cd5\u8fdb\u884c\u89c4\u5219\u5339\u914d\u7684\uff0c\u524d\u6587\u5728\u5b89\u88c5Nginx\u8f6f\u4ef6\u65f6\u5c31\u5df2\u7ecf\u5b89\u88c5\u4e86\u8fd9\u4e2aPCRE\u8f6f\u4ef6\uff0c\u4ee5\u53ca\u8ba9Nginx\u652f\u6301Rewrite\u7684\u529f\u80fd\uff0c\u9ed8\u8ba4\u53c2\u6570\u7f16\u8bd1 Nginx\u5c31\u4f1a\u5b89\u88c5\u652f\u6301Rewrite\u7684\u6a21\u5757\uff0c\u4f46\u662f\uff0c\u4e5f\u5fc5\u987b\u8981PCRE\u8f6f\u4ef6\u7684\u652f\u6301\u3002 2. \u8bed\u6cd5 \u00b6 \u6307\u4ee4\u8bed\u6cd5\uff1arewrite regex replacement [flag]; \u9ed8\u8ba4\u503c:none \u5e94\u7528\u4f4d\u7f6e\uff1aserver\u3001location\u3001if rewrite\u662f\u5b9e\u73b0URL\u91cd\u5199\u7684\u5173\u952e\u6307\u4ee4\uff0c\u6839\u636eregex\uff08\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\u90e8\u5206\u5185\u5bb9\uff0c\u91cd\u5b9a\u5411\u5230replacement\u90e8\u5206\u5185\u5bb9\uff0c\u7ed3\u5c3e\u662fflag\u6807\u8bb0\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u7684URL Rewrite\u8df3\u8f6c\u7684\u4f8b\u5b50\uff1a rewrite ^/(.*) http://www.caimengzhi.org/$1 permanent; \u89e3\u91ca \u5728\u4e0a\u8ff0\u6307\u4ee4\u4e2d\uff0c rewrite\u4e3a\u56fa\u5b9a\u5173\u952e\u5b57 \uff0c\u8868\u793a\u5f00\u542f\u4e00\u6761 rewrite\u5339\u914d\u89c4\u5219 \uff0c regex\u90e8\u5206\u662f ^/ ( .* ), \u8fd9\u662f\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u6240\u6709\uff0c\u5339\u914d\u6210\u529f\u540e\u8df3\u8f6c\u5230 http : // www . caimengzhi . org / $ 1 , \u8fd9\u91cc \u7684$ 1 \u662f\u53d6\u524d\u9762 regex\u90e8\u5206 () \u91cc\u7684\u5185\u5bb9\uff0c\u7ed3\u5c3e permanent ; \u8868\u793a\u6c38\u4e45 301 \u91cd\u5b9a\u5411\u6807\u8bb0\uff0c\u5373\u8df3\u8f6c\u5230\u540e\u9762\u7684 http : // www . caimengzhi . org / $ 1 \u5730\u5740\u4e0a\u3002 2.1 \u4f8b\u5b501 \u00b6 server { listen 80; server_name www.abc.org; location / { rewrite ^/(.*) https://www.caimengzhi.cn/$1 permanent; } access_log logs/www_access.log main; } \u89e3\u91ca \u5f53\u7528\u6237\u8bbf\u95ee www . abc . org\u7684\u5c31\u81ea\u52a8\u8df3\u8f6c\u5230\u4e86https : // www . caimengzhi . cn \u53bb\u4e86\u3002 \u5982\u679c\u8fd9\u6837\u8bbf\u95ee www . abc . org / test . html \u5c31\u8df3\u8f6c\u6210 https : // www . caimengzhi . cn / test . html \u3002 $ 1 \u53d6\u7684\u662f\u62ec\u53f7\uff08 .* \uff09\u91cc\u9762\u7684\u5185\u5bb9\uff0c\u4e5f\u5c31\u662f test . html \u3002 2.2 \u4f8b\u5b502 \u00b6 server { listen 80; server_name www.abc.org; location / { root html/www; index index.html; } location ^~ /images/ { rewrite ^/(.*) https://www.caimengzhi.cn/$1 permanent; } access_log logs/www_access.log main; } \u89e3\u91ca \u7528\u6237\u8bbf\u95ee www . abc . org\u8bbf\u95ee\u7f51\u7ad9\u6b63\u5e38\u663e\u793a \uff0c\u8bbf\u95ee www . abc . org / test . html\u7684\u65f6\u5019\u4e5f\u6b63\u5e38\u663e\u793a \u3002 \u53ea\u6709\u5f53\u7528\u6237\u8bbf\u95ee www . abc . org / images / test . jpg \u7684\u65f6\u5019\uff0c\u53ea\u8981\u5e26\u6709 images\u8fd9\u4e2a\u8def\u5f84\u5c31\u8df3\u8f6c \uff0c\u8fd9\u91cc\u8df3\u8f6c\u5230 https : // www . caimengzhi . cn / images / test . jpg \u3002 3. Rewrite regex\u5e38\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u5b57\u7b26 \u00b6 \u5b57\u7b26 \u63cf\u8ff0 \\ \u5c06\u540e\u9762\u63a5\u7740\u7684\u5b57\u7b26\u6807\u8bb0\u4e3a\u4e00\u4e2a\u7279\u6b8a\u7684\u5b57\u7b26\u6216\u8005\u539f\u4e49\u5b57\u7b26\u6216\u8005\u4e00\u4e2a\u5411\u540e\u7684\u5f15\u7528\uff0c\u4f8b\u5982\"\\n\"\u5339\u914d\u4e00\u4e2a\u6362\u884c\u7b26\u53f7\uff0c\u5e8f\u5217 \"\\\\\" \u548c \"\\$\" \u5219\u5339\u914d \"$\" ^ \u5339\u914d\u8f93\u5165\u5b57\u7b26\u4e32\u7684\u8d77\u59cb\u4f4d\u7f6e\uff0c\u5982\u679c\u8bbe\u7f6eregexp\u5bf9\u8c61\u7684mutiline\u5c5e\u6027\u3002\u4e5f\u5339\u914d \"\\n\" \u6216\u8005 \"r\" \u4e4b\u540e\u7684\u4f4d\u7f6e $ \u5339\u914d\u8f93\u5165\u5b57\u7b26\u4e32\u7684\u7ed3\u675f\u4f4d\u7f6e\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86regexp\u5bf9\u8c61mutiline\u5c5e\u6027\uff0c $ \u4e5f\u5339\u914d \"\\n\" \u6216\u8005 \"\\r\" \u4e4b\u524d\u4f4d\u7f6e * \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u96f6\u6b21\u6216\u8005\u591a\u6b21\uff0c\u4f8b\u5982 cai\\*. \u80fd\u5339\u914dca\u6216\u8005cai\u6216\u8005caii\u7b49,*\u7b49\u4ef7\u4e8e{0,} + \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u4e00\u6b21\u6216\u8005\u591a\u6b21\uff0c\u4f8b\u5982cai+\uff0c\u80fd\u5339\u914dcai\u6216\u8005caii\uff0c\u4f46\u662f\u4e0d\u80fd\u5339\u914dca\uff0c+\u7b49\u4ef7\u4e8e{1\uff0c} ? \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u96f6\u6b21\u6216\u8005\u4e00\u6b21\uff0c\u4f8b\u5982cai?\u53ef\u5339\u914dcai\u6216\u8005ca\uff0c?\u7b49\u4ef7\u4e8e{0,1}\uff0c\u5f53\u8be5\u5b57\u7b26\u7d27\u8ddf\u7740\u4efb\u4f55\u4e00\u4e2a\u5176\u4ed6\u7684\u9650\u5236\u7b26[*,+,?,{n},{m,n}]\u540e\u9762\u65f6\uff0c\u5339\u914d\u6a21\u5f0f\u662f\u975e\u8d2a\u5a6a\u6a21\u5f0f\u3002\u975e\u8d2a\u5a6a\u6a21\u5f0f\u5c3d\u53ef\u80fd\u5c11\u5339\u914d\u6240\u641c\u7d22\u7684\u5b57\u7b26\u4e32\uff0c\u800c\u9ed8\u8ba4\u7684\u8d2a\u5a6a\u5339\u914d\u6a21\u5f0f\u5219\u662f\u5c3d\u53ef\u80fd\u7684\u5339\u914d\u6240\u641c\u7d22\u7684\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982,\u5bf9\u4e8e\u5b57\u7b26\u4e32 \"caiiii\" , \"cai+?\u201d \uff0c\u5c06\u5339\u914d\u5355\u4e2ai\uff0c\u800ci+\u5c06\u5339\u914d\u6240\u6709i . \u5339\u914d\u9664 \"\\n\" \u4e4b\u5916\u7684\u4efb\u4f55\u5355\u4e2a\u5b57\u7b26\uff0c\u8981\u5339\u914d\u5305\u62ec \"\\n\" \u5728\u5185\u7684\u4efb\u4f55\u5b57\u7b26\uff0c\u8bf7\u4f7f\u7528 \"[.\\n]\" \u7684\u6a21\u5f0f (pattern) \u5339\u914d\u62ec\u53f7\u5185pattern\u5e76\u53ef\u4ee5\u5728\u540e\u9762\u83b7\u53d6\u5bf9\u4e8e\u7684\u5339\u914d\uff0c\u5e38\u5e38\u7528 0... 0... 9\u5c5e\u6027\u83b7\u53d6\u5c0f\u62ec\u53f7\u4e2d\u7684\u5339\u914d\u5185\u5bb9\uff0c\u8981\u5339\u914d\u5706\u62ec\u53f7\u5185\u5b57\u7b26\uff0c\u8bf7\u4f7f\u7528 \"\\(\" \u6216 \"\\)\" 4. rewrite\u6307\u4ee4\u7ed3\u5c3eflag\u6807\u8bb0\u8bf4\u660e \u00b6 rewrite\u6307\u4ee4\u6700\u540e\u4e00\u9879\u53c2\u6570\u4e3aflag\u6807\u8bb0\uff0c\u8be5\u6807\u8bb0\u8bf4\u660e\u89c1\u4e0b\u8868\u3002 flag\u6807\u8bb0\u7b26\u53f7 \u8bf4\u660e last \u672c\u6761\u89c4\u5219\u5339\u914d\u5b8c\u6210\u540e\uff0c\u7ee7\u7eed\u5411\u4e0b\u5339\u914d\u65b0\u7684location URI\u89c4\u5219\u3002 break \u672c\u6761\u89c4\u5219\u5339\u914d\u5b8c\u6210\u540e\u5373\u7ec8\u6b62\uff0c\u4e0d\u518d\u5339\u914d\u540e\u9762\u7684\u4efb\u4f55\u89c4\u5219\u3002 redirect \u8fd4\u56de302\u4e34\u65f6\u91cd\u5b9a\u5411\uff0c\u6d4f\u89c8\u5668\u5730\u5740\u680f\u4f1a\u663e\u793a\u8df3\u8f6c\u540e\u7684URL\u5730\u5740\u3002 permanent \u8fd4\u56de301\u6c38\u4e45\u91cd\u5b9a\u5411\uff0c\u6d4f\u89c8\u5668\u5730\u5740\u680f\u4f1a\u663e\u793a\u8df3\u8f6c\u540e\u7684URL\u5730\u5740\u3002 \u5728\u4ee5\u4e0a\u7684flag\u6807\u8bb0\u4e2d\uff0clast\u548cbreak\u7528\u6765\u5b9e\u73b0URL\u91cd\u5199\uff0c\u6d4f\u89c8\u5668\u5730\u5740\u680fURL\u5730\u5740\u4e0d\u53d8\u3002 \u4f46\u5728\u670d\u52a1\u5668\u7aef\u8bbf\u95ee\u7684\u7a0b\u5e8f\u53ca\u8def\u5f84\u53d1\u751f\u4e86\u53d8\u5316\u3002redirect\u548cpermanent\u7528\u6765\u5b9e\u73b0URL\u8df3\u8f6c\uff0c \u6d4f\u89c8\u5668\u5730\u5740\u680f\u4f1a\u663e\u793a\u8df3\u8f6c\u540e\u7684URL\u5730\u5740\u3002 last\u548cbreak\u6807\u8bb0\u7684\u5b9e\u73b0\u529f\u80fd\u7c7b\u4f3c\uff0c\u4f46\u4e8c\u8005\u4e4b\u95f4\u6709\u7ec6\u5fae\u7684\u5dee\u522b\uff0c\u4f7f\u7528alias\u6307\u4ee4\u65f6\u5fc5\u987b \u7528last\u6807\u8bb0\uff0c\u4f7f\u7528proxy_pass\u6307\u4ee4\u65f6\u8981\u4f7f\u7528break\u6807\u8bb0\u3002last\u6807\u8bb0\u5728\u672c\u6761rewrite\u89c4\u5219 \u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u4f1a\u5bf9\u5176\u6240\u5728\u7684server{\u2026\u2026}\u6807\u7b7e\u91cd\u65b0\u53d1\u8d77\u8bf7\u6c42\uff0c\u800cbreak\u6807\u8bb0\u5219\u5728\u672c\u6761\u89c4\u5219\u5339\u914d \u5b8c\u6210\u540e\uff0c\u7ec8\u6b62\u5339\u914d\uff0c\u4e0d\u5728\u5339\u914d\u540e\u9762\u7684\u89c4\u5219\u3002 6. Nginx Rewrite\u7684\u4f01\u4e1a\u5e94\u7528\u573a\u666f \u00b6 Nginx\u7684Rewrite\u529f\u80fd\u5728\u4f01\u4e1a\u91cc\u5e94\u7528\u975e\u5e38\u5e7f\u6cdb\uff1a \u53ef\u4ee5\u8c03\u6574\u7528\u6237\u6d4f\u89c8\u7684URL\uff0c\u770b\u8d77\u6765\u66f4\u89c4\u8303\uff0c\u5408\u4e4e\u5f00\u623f\u53ca\u4ea7\u54c1\u4eba\u5458\u7684\u9700\u6c42\u3002 \u4e3a\u4e86\u8ba9\u641c\u7d22\u5f15\u64ce\u6536\u5f55\u7f51\u7ad9\u5185\u5bb9\u53ca\u7528\u6237\u4f53\u9a8c\u66f4\u597d\uff0c\u4f01\u4e1a\u4f1a\u5c06\u52a8\u6001URL\u5730\u5740\u4f2a\u88c5\u6210\u9759\u6001\u5730\u5740\u63d0\u4f9b\u670d\u52a1 \u7f51\u7ad9\u6362\u65b0\u57df\u540d\u540e\uff0c\u8ba9\u65e7\u7684\u57df\u540d\u7684\u8bbf\u95ee\u8df3\u8f6c\u5230\u65b0\u7684\u57df\u540d\u4e0a\uff0c\u4f8b\u5982\uff1a\u4eac\u4e1c\u7684360buy.com\u6362\u6210jd.com \u6839\u636e\u7279\u6b8a\u53d8\u91cf\u3001\u76ee\u5f55\u3001\u5ba2\u6237\u7aef\u7684\u4fe1\u606f\u8fdb\u884cURL\u8df3\u8f6c\u7b49\u3002 5. \u4f01\u4e1a\u5b9e\u6218301 \u00b6 \u516c\u53f8\u6362\u65b0\u57df\u540d\uff0c\u9700\u8981\u505a301\u6c38\u4e45\u91cd\u5b9a\u5411\uff0c\u8001\u57df\u540d\u4e3a\uff1a www.360buy.com \u65b0\u57df\u540d\u4e3a\uff1a www.jd.com \u914d\u7f6e\u4fe1\u606f\u5982\u4e0b\uff1a server { listen 80; server_name www.360buy.com; rewrite ^/(.*) http://www.jd.com/$1 permanent; } server { listen 80; server_name www.jd.com jd.com; location / { root html/www; index index.php index.html; } } \u5f53\u7528\u6237\u8bbf\u95ee www.360buy.com\u7684\u65f6\u5019 \uff0c\u5c31\u81ea\u52a8\u8df3\u8f6c\u5230\u4e86https:// www.jd.com\u4e0a \uff0c\u5b9e\u73b0\u4e86301\u6c38\u4e45\u91cd\u5b9a\u5411\u3002","title":"10. nginx rewrite"},{"location":"linux/nginx/nginx.rewrite/#1","text":"\u548cApache\u7b49web\u670d\u52a1\u8f6f\u4ef6\u4e00\u6837\uff0cNginx Rewrite\u7684\u4e3b\u8981\u529f\u80fd\u4e5f\u662f\u5b9e\u73b0URL\u5730\u5740\u91cd\u5199\uff0cNginx\u7684 Rewrite\u89c4\u5219\u9700\u8981PCRE\u8f6f\u4ef6\u7684\u652f\u6301\uff0c\u5373\u901a\u8fc7Perl\u517c\u5bb9\u6b63\u5219\u8868\u8fbe\u5f0f\u8bed\u6cd5\u8fdb\u884c\u89c4\u5219\u5339\u914d\u7684\uff0c\u524d\u6587\u5728\u5b89\u88c5Nginx\u8f6f\u4ef6\u65f6\u5c31\u5df2\u7ecf\u5b89\u88c5\u4e86\u8fd9\u4e2aPCRE\u8f6f\u4ef6\uff0c\u4ee5\u53ca\u8ba9Nginx\u652f\u6301Rewrite\u7684\u529f\u80fd\uff0c\u9ed8\u8ba4\u53c2\u6570\u7f16\u8bd1 Nginx\u5c31\u4f1a\u5b89\u88c5\u652f\u6301Rewrite\u7684\u6a21\u5757\uff0c\u4f46\u662f\uff0c\u4e5f\u5fc5\u987b\u8981PCRE\u8f6f\u4ef6\u7684\u652f\u6301\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nginx/nginx.rewrite/#2","text":"\u6307\u4ee4\u8bed\u6cd5\uff1arewrite regex replacement [flag]; \u9ed8\u8ba4\u503c:none \u5e94\u7528\u4f4d\u7f6e\uff1aserver\u3001location\u3001if rewrite\u662f\u5b9e\u73b0URL\u91cd\u5199\u7684\u5173\u952e\u6307\u4ee4\uff0c\u6839\u636eregex\uff08\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\u90e8\u5206\u5185\u5bb9\uff0c\u91cd\u5b9a\u5411\u5230replacement\u90e8\u5206\u5185\u5bb9\uff0c\u7ed3\u5c3e\u662fflag\u6807\u8bb0\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u7684URL Rewrite\u8df3\u8f6c\u7684\u4f8b\u5b50\uff1a rewrite ^/(.*) http://www.caimengzhi.org/$1 permanent; \u89e3\u91ca \u5728\u4e0a\u8ff0\u6307\u4ee4\u4e2d\uff0c rewrite\u4e3a\u56fa\u5b9a\u5173\u952e\u5b57 \uff0c\u8868\u793a\u5f00\u542f\u4e00\u6761 rewrite\u5339\u914d\u89c4\u5219 \uff0c regex\u90e8\u5206\u662f ^/ ( .* ), \u8fd9\u662f\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u6240\u6709\uff0c\u5339\u914d\u6210\u529f\u540e\u8df3\u8f6c\u5230 http : // www . caimengzhi . org / $ 1 , \u8fd9\u91cc \u7684$ 1 \u662f\u53d6\u524d\u9762 regex\u90e8\u5206 () \u91cc\u7684\u5185\u5bb9\uff0c\u7ed3\u5c3e permanent ; \u8868\u793a\u6c38\u4e45 301 \u91cd\u5b9a\u5411\u6807\u8bb0\uff0c\u5373\u8df3\u8f6c\u5230\u540e\u9762\u7684 http : // www . caimengzhi . org / $ 1 \u5730\u5740\u4e0a\u3002","title":"2. \u8bed\u6cd5"},{"location":"linux/nginx/nginx.rewrite/#21-1","text":"server { listen 80; server_name www.abc.org; location / { rewrite ^/(.*) https://www.caimengzhi.cn/$1 permanent; } access_log logs/www_access.log main; } \u89e3\u91ca \u5f53\u7528\u6237\u8bbf\u95ee www . abc . org\u7684\u5c31\u81ea\u52a8\u8df3\u8f6c\u5230\u4e86https : // www . caimengzhi . cn \u53bb\u4e86\u3002 \u5982\u679c\u8fd9\u6837\u8bbf\u95ee www . abc . org / test . html \u5c31\u8df3\u8f6c\u6210 https : // www . caimengzhi . cn / test . html \u3002 $ 1 \u53d6\u7684\u662f\u62ec\u53f7\uff08 .* \uff09\u91cc\u9762\u7684\u5185\u5bb9\uff0c\u4e5f\u5c31\u662f test . html \u3002","title":"2.1 \u4f8b\u5b501"},{"location":"linux/nginx/nginx.rewrite/#22-2","text":"server { listen 80; server_name www.abc.org; location / { root html/www; index index.html; } location ^~ /images/ { rewrite ^/(.*) https://www.caimengzhi.cn/$1 permanent; } access_log logs/www_access.log main; } \u89e3\u91ca \u7528\u6237\u8bbf\u95ee www . abc . org\u8bbf\u95ee\u7f51\u7ad9\u6b63\u5e38\u663e\u793a \uff0c\u8bbf\u95ee www . abc . org / test . html\u7684\u65f6\u5019\u4e5f\u6b63\u5e38\u663e\u793a \u3002 \u53ea\u6709\u5f53\u7528\u6237\u8bbf\u95ee www . abc . org / images / test . jpg \u7684\u65f6\u5019\uff0c\u53ea\u8981\u5e26\u6709 images\u8fd9\u4e2a\u8def\u5f84\u5c31\u8df3\u8f6c \uff0c\u8fd9\u91cc\u8df3\u8f6c\u5230 https : // www . caimengzhi . cn / images / test . jpg \u3002","title":"2.2 \u4f8b\u5b502"},{"location":"linux/nginx/nginx.rewrite/#3-rewrite-regex","text":"\u5b57\u7b26 \u63cf\u8ff0 \\ \u5c06\u540e\u9762\u63a5\u7740\u7684\u5b57\u7b26\u6807\u8bb0\u4e3a\u4e00\u4e2a\u7279\u6b8a\u7684\u5b57\u7b26\u6216\u8005\u539f\u4e49\u5b57\u7b26\u6216\u8005\u4e00\u4e2a\u5411\u540e\u7684\u5f15\u7528\uff0c\u4f8b\u5982\"\\n\"\u5339\u914d\u4e00\u4e2a\u6362\u884c\u7b26\u53f7\uff0c\u5e8f\u5217 \"\\\\\" \u548c \"\\$\" \u5219\u5339\u914d \"$\" ^ \u5339\u914d\u8f93\u5165\u5b57\u7b26\u4e32\u7684\u8d77\u59cb\u4f4d\u7f6e\uff0c\u5982\u679c\u8bbe\u7f6eregexp\u5bf9\u8c61\u7684mutiline\u5c5e\u6027\u3002\u4e5f\u5339\u914d \"\\n\" \u6216\u8005 \"r\" \u4e4b\u540e\u7684\u4f4d\u7f6e $ \u5339\u914d\u8f93\u5165\u5b57\u7b26\u4e32\u7684\u7ed3\u675f\u4f4d\u7f6e\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86regexp\u5bf9\u8c61mutiline\u5c5e\u6027\uff0c $ \u4e5f\u5339\u914d \"\\n\" \u6216\u8005 \"\\r\" \u4e4b\u524d\u4f4d\u7f6e * \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u96f6\u6b21\u6216\u8005\u591a\u6b21\uff0c\u4f8b\u5982 cai\\*. \u80fd\u5339\u914dca\u6216\u8005cai\u6216\u8005caii\u7b49,*\u7b49\u4ef7\u4e8e{0,} + \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u4e00\u6b21\u6216\u8005\u591a\u6b21\uff0c\u4f8b\u5982cai+\uff0c\u80fd\u5339\u914dcai\u6216\u8005caii\uff0c\u4f46\u662f\u4e0d\u80fd\u5339\u914dca\uff0c+\u7b49\u4ef7\u4e8e{1\uff0c} ? \u5339\u914d\u524d\u9762\u7684\u5b57\u7b26\u96f6\u6b21\u6216\u8005\u4e00\u6b21\uff0c\u4f8b\u5982cai?\u53ef\u5339\u914dcai\u6216\u8005ca\uff0c?\u7b49\u4ef7\u4e8e{0,1}\uff0c\u5f53\u8be5\u5b57\u7b26\u7d27\u8ddf\u7740\u4efb\u4f55\u4e00\u4e2a\u5176\u4ed6\u7684\u9650\u5236\u7b26[*,+,?,{n},{m,n}]\u540e\u9762\u65f6\uff0c\u5339\u914d\u6a21\u5f0f\u662f\u975e\u8d2a\u5a6a\u6a21\u5f0f\u3002\u975e\u8d2a\u5a6a\u6a21\u5f0f\u5c3d\u53ef\u80fd\u5c11\u5339\u914d\u6240\u641c\u7d22\u7684\u5b57\u7b26\u4e32\uff0c\u800c\u9ed8\u8ba4\u7684\u8d2a\u5a6a\u5339\u914d\u6a21\u5f0f\u5219\u662f\u5c3d\u53ef\u80fd\u7684\u5339\u914d\u6240\u641c\u7d22\u7684\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982,\u5bf9\u4e8e\u5b57\u7b26\u4e32 \"caiiii\" , \"cai+?\u201d \uff0c\u5c06\u5339\u914d\u5355\u4e2ai\uff0c\u800ci+\u5c06\u5339\u914d\u6240\u6709i . \u5339\u914d\u9664 \"\\n\" \u4e4b\u5916\u7684\u4efb\u4f55\u5355\u4e2a\u5b57\u7b26\uff0c\u8981\u5339\u914d\u5305\u62ec \"\\n\" \u5728\u5185\u7684\u4efb\u4f55\u5b57\u7b26\uff0c\u8bf7\u4f7f\u7528 \"[.\\n]\" \u7684\u6a21\u5f0f (pattern) \u5339\u914d\u62ec\u53f7\u5185pattern\u5e76\u53ef\u4ee5\u5728\u540e\u9762\u83b7\u53d6\u5bf9\u4e8e\u7684\u5339\u914d\uff0c\u5e38\u5e38\u7528 0... 0... 9\u5c5e\u6027\u83b7\u53d6\u5c0f\u62ec\u53f7\u4e2d\u7684\u5339\u914d\u5185\u5bb9\uff0c\u8981\u5339\u914d\u5706\u62ec\u53f7\u5185\u5b57\u7b26\uff0c\u8bf7\u4f7f\u7528 \"\\(\" \u6216 \"\\)\"","title":"3. Rewrite regex\u5e38\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u5b57\u7b26"},{"location":"linux/nginx/nginx.rewrite/#4-rewriteflag","text":"rewrite\u6307\u4ee4\u6700\u540e\u4e00\u9879\u53c2\u6570\u4e3aflag\u6807\u8bb0\uff0c\u8be5\u6807\u8bb0\u8bf4\u660e\u89c1\u4e0b\u8868\u3002 flag\u6807\u8bb0\u7b26\u53f7 \u8bf4\u660e last \u672c\u6761\u89c4\u5219\u5339\u914d\u5b8c\u6210\u540e\uff0c\u7ee7\u7eed\u5411\u4e0b\u5339\u914d\u65b0\u7684location URI\u89c4\u5219\u3002 break \u672c\u6761\u89c4\u5219\u5339\u914d\u5b8c\u6210\u540e\u5373\u7ec8\u6b62\uff0c\u4e0d\u518d\u5339\u914d\u540e\u9762\u7684\u4efb\u4f55\u89c4\u5219\u3002 redirect \u8fd4\u56de302\u4e34\u65f6\u91cd\u5b9a\u5411\uff0c\u6d4f\u89c8\u5668\u5730\u5740\u680f\u4f1a\u663e\u793a\u8df3\u8f6c\u540e\u7684URL\u5730\u5740\u3002 permanent \u8fd4\u56de301\u6c38\u4e45\u91cd\u5b9a\u5411\uff0c\u6d4f\u89c8\u5668\u5730\u5740\u680f\u4f1a\u663e\u793a\u8df3\u8f6c\u540e\u7684URL\u5730\u5740\u3002 \u5728\u4ee5\u4e0a\u7684flag\u6807\u8bb0\u4e2d\uff0clast\u548cbreak\u7528\u6765\u5b9e\u73b0URL\u91cd\u5199\uff0c\u6d4f\u89c8\u5668\u5730\u5740\u680fURL\u5730\u5740\u4e0d\u53d8\u3002 \u4f46\u5728\u670d\u52a1\u5668\u7aef\u8bbf\u95ee\u7684\u7a0b\u5e8f\u53ca\u8def\u5f84\u53d1\u751f\u4e86\u53d8\u5316\u3002redirect\u548cpermanent\u7528\u6765\u5b9e\u73b0URL\u8df3\u8f6c\uff0c \u6d4f\u89c8\u5668\u5730\u5740\u680f\u4f1a\u663e\u793a\u8df3\u8f6c\u540e\u7684URL\u5730\u5740\u3002 last\u548cbreak\u6807\u8bb0\u7684\u5b9e\u73b0\u529f\u80fd\u7c7b\u4f3c\uff0c\u4f46\u4e8c\u8005\u4e4b\u95f4\u6709\u7ec6\u5fae\u7684\u5dee\u522b\uff0c\u4f7f\u7528alias\u6307\u4ee4\u65f6\u5fc5\u987b \u7528last\u6807\u8bb0\uff0c\u4f7f\u7528proxy_pass\u6307\u4ee4\u65f6\u8981\u4f7f\u7528break\u6807\u8bb0\u3002last\u6807\u8bb0\u5728\u672c\u6761rewrite\u89c4\u5219 \u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u4f1a\u5bf9\u5176\u6240\u5728\u7684server{\u2026\u2026}\u6807\u7b7e\u91cd\u65b0\u53d1\u8d77\u8bf7\u6c42\uff0c\u800cbreak\u6807\u8bb0\u5219\u5728\u672c\u6761\u89c4\u5219\u5339\u914d \u5b8c\u6210\u540e\uff0c\u7ec8\u6b62\u5339\u914d\uff0c\u4e0d\u5728\u5339\u914d\u540e\u9762\u7684\u89c4\u5219\u3002","title":"4. rewrite\u6307\u4ee4\u7ed3\u5c3eflag\u6807\u8bb0\u8bf4\u660e"},{"location":"linux/nginx/nginx.rewrite/#6-nginx-rewrite","text":"Nginx\u7684Rewrite\u529f\u80fd\u5728\u4f01\u4e1a\u91cc\u5e94\u7528\u975e\u5e38\u5e7f\u6cdb\uff1a \u53ef\u4ee5\u8c03\u6574\u7528\u6237\u6d4f\u89c8\u7684URL\uff0c\u770b\u8d77\u6765\u66f4\u89c4\u8303\uff0c\u5408\u4e4e\u5f00\u623f\u53ca\u4ea7\u54c1\u4eba\u5458\u7684\u9700\u6c42\u3002 \u4e3a\u4e86\u8ba9\u641c\u7d22\u5f15\u64ce\u6536\u5f55\u7f51\u7ad9\u5185\u5bb9\u53ca\u7528\u6237\u4f53\u9a8c\u66f4\u597d\uff0c\u4f01\u4e1a\u4f1a\u5c06\u52a8\u6001URL\u5730\u5740\u4f2a\u88c5\u6210\u9759\u6001\u5730\u5740\u63d0\u4f9b\u670d\u52a1 \u7f51\u7ad9\u6362\u65b0\u57df\u540d\u540e\uff0c\u8ba9\u65e7\u7684\u57df\u540d\u7684\u8bbf\u95ee\u8df3\u8f6c\u5230\u65b0\u7684\u57df\u540d\u4e0a\uff0c\u4f8b\u5982\uff1a\u4eac\u4e1c\u7684360buy.com\u6362\u6210jd.com \u6839\u636e\u7279\u6b8a\u53d8\u91cf\u3001\u76ee\u5f55\u3001\u5ba2\u6237\u7aef\u7684\u4fe1\u606f\u8fdb\u884cURL\u8df3\u8f6c\u7b49\u3002","title":"6. Nginx Rewrite\u7684\u4f01\u4e1a\u5e94\u7528\u573a\u666f"},{"location":"linux/nginx/nginx.rewrite/#5-301","text":"\u516c\u53f8\u6362\u65b0\u57df\u540d\uff0c\u9700\u8981\u505a301\u6c38\u4e45\u91cd\u5b9a\u5411\uff0c\u8001\u57df\u540d\u4e3a\uff1a www.360buy.com \u65b0\u57df\u540d\u4e3a\uff1a www.jd.com \u914d\u7f6e\u4fe1\u606f\u5982\u4e0b\uff1a server { listen 80; server_name www.360buy.com; rewrite ^/(.*) http://www.jd.com/$1 permanent; } server { listen 80; server_name www.jd.com jd.com; location / { root html/www; index index.php index.html; } } \u5f53\u7528\u6237\u8bbf\u95ee www.360buy.com\u7684\u65f6\u5019 \uff0c\u5c31\u81ea\u52a8\u8df3\u8f6c\u5230\u4e86https:// www.jd.com\u4e0a \uff0c\u5b9e\u73b0\u4e86301\u6c38\u4e45\u91cd\u5b9a\u5411\u3002","title":"5. \u4f01\u4e1a\u5b9e\u6218301"},{"location":"linux/nginx/nginx.slb/","text":"Nginx \u8d1f\u8f7d\u5747\u8861 1. \u4ecb\u7ecd \u00b6 \u5b9e\u73b0Nginx\u8d1f\u8f7d\u5747\u8861\u7684\u7ec4\u4ef6\u4e3b\u8981\u7531\u4e24\u4e2a\uff0c\u89c1\u4e0b\u8868 Nginx http\u529f\u80fd\u6a21\u5757 \u6a21\u5757\u8bf4\u660e ngx_http_proxy_module proxy\u4ee3\u7406\u6a21\u5757\uff0c\u7528\u4e8e\u628a\u8bf7\u6c42\u540e\u629b\u7ed9\u670d\u52a1\u5668\u8282\u70b9\u6216upstream\u670d\u52a1\u5668\u6c60\u3002 ngx_http_upstream_module \u8d1f\u8f7d\u5747\u8861\u6a21\u5757\uff0c\u53ef\u4ee5\u5b9e\u73b0\u7f51\u7ad9\u7684\u8d1f\u8f7d\u5747\u8861\u529f\u80fd\u53ca\u8282\u70b9\u7684\u5065\u5eb7\u68c0\u67e5\u3002 \u5b98\u65b9\u4ecb\u7ecd\u8fde\u63a5\uff1a http://nginx.org/en/docs/http/ngx_http_upstream_module.html 2. \u73af\u5883\u51c6\u5907 \u00b6 2.1 \u786c\u4ef6\u51c6\u5907 \u00b6 \u51c6\u59074\u53f0VM\u865a\u62df\u673a\uff08\u6709\u7269\u7406\u670d\u52a1\u5668\u66f4\u4f73\uff09\uff0c\u4e24\u53f0\u505a\u8d1f\u8f7d\u5747\u8861\uff0c\u4e24\u53f0\u505aRS\uff0c\u5982\u4e0b\u8868\u3002 HOSTNAME IP \u8bf4\u660e lb01 10.0.0.7 Nginx\u4e3b\u8d1f\u8f7d\u5747\u8861\u5668 lb02 10.0.0.8 Nginx\u8f85\u8d1f\u8f7d\u5747\u8861\u5668 web01 10.0.0.9 web01\u670d\u52a1\u5668 web02 10.0.0.10 web02\u670d\u52a1\u5668 2.2 \u5b89\u88c5Nginx\u8f6f\u4ef6 \u00b6 \u4e0b\u9762\u5c06\u5728\u4ee5\u4e0a4\u53f0\u670d\u52a1\u5668\u4e0a\u5b89\u88c5Nginx\u3002\u5b8c\u6574\u7684\u5b89\u88c5\u8fc7\u7a0b\u89c1\u4e0a\u9762\u7684\u8bf4\u660e\uff0c\u8fd9\u91cc\u53ea\u5199\u51fa\u5b89\u88c5\u7684\u547d\u4ee4\u90e8\u5206\u3002 \u5b89\u88c5\u4f9d\u8d56\u8f6f\u4ef6\u5305\u547d\u4ee4\u96c6\u5408\u3002 yum install openssl-devel pcre-devel -y \u5b89\u88c5Nginx\u8f6f\u4ef6\u5305\u7684\u547d\u4ee4\u96c6\u5408 wget http://nginx.org/download/nginx-1.6.3.tar.gz useradd nginx -M -s /sbin/nologin tar xf nginx-1.6.3.tar.gz cd nginx-1.6.3 ./configure --prefix=/app/nginx-1.6.3 --user=nginx --group=nginx --with-http_ssl_module --with-http_stub_status_module --with-pcre make && make install ln -s /app/nginx-1.6.3/ /app/nginx 2.3 Nginx upstream \u00b6 lb01\u548clb02\u7684nginx\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b\uff1a worker_processes 1; pid logs/nginx.pid; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; upstream server_pools { #\u914d\u7f6e\u4e00\u4e2aupstream\u6807\u7b7e\uff0c\u540d\u79f0\u4e3aserver_pools server 172.16.1.7:80 weight=1; #\u540e\u7aef\u4e24\u53f0web\u670d\u52a1\u5668\u7684ip\u5730\u5740\u548c\u7aef\u53e3\uff0cweight=1\u8868\u793a\u6743\u91cd\u90fd\u662f1 server 172.16.1.8:80 weight=1; } server { listen 80; server_name www.caimengzhi.org; location / { proxy_pass http://server_pools; #\u8bbf\u95eewww.etiantian.org \u5c31\u629b\u7ed9\u4e0a\u9762\u7684upstream server_pools proxy_set_header Host $host; #\u628a\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u5934\u4e5f\u4e00\u8d77\u629b\u8fc7\u53bb proxy_set_header X-Forwarded-For $remote_addr; #\u628a\u5ba2\u6237\u7aef\u7684IP\u5730\u5740\u4e5f\u629b\u8fc7\u53bb\uff0cweb\u670d\u52a1\u5668\u7aef\u8bb0\u5f55\u5ba2\u6237\u7aef\u771f\u5b9eIP\u5730\u5740 } } server { listen 80; server_name blog.caimengzhi.org; location / { proxy_pass http://server_pools; proxy_set_header Host $host; proxy_set_header X-Forwarded-For $remote_addr; } } } \u901a\u8fc7\u4e0a\u9762\u7684\u914d\u7f6e\uff0c\u6211\u4eec\u5c31\u5b9e\u73b0\u4e86\u8d1f\u8f7d\u5747\u8861\u4e86\u3002 3. keepalived \u00b6 \u5728lb01\u548clb02\u8d1f\u8f7d\u5747\u8861\u670d\u52a1\u5668\u4e0a\u5b89\u88c5keepalived\uff0c\u5b89\u88c5\u547d\u4ee4\u5982\u4e0b\uff1a yum install keepalived -y keepalived\u7684\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\u5728/etc/keepalived/keepalived.conf 3.1 \u4e3b\u8d1f\u8f7d\u5747\u8861\u914d\u7f6e \u00b6 ! Configuration File for keepalived global_defs { notification_email { 610658552@qq.com #\u7ba1\u7406\u5458\u90ae\u7bb1 } notification_email_from 610658552@qq.com #\u7ba1\u7406\u5458\u90ae\u7bb1 smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id LVS_DEVEL #\u8fd9\u91cc\u662fkeepalived\u7684ID\uff0c\u4e0d\u540c\u670d\u52a1\u5668\u7684id\u4e0d\u80fd\u76f8\u540c } vrrp_instance VI_1 { #\u5b9e\u4f8b state MASTER # MASTER\u4e3b\u7684\u610f\u601d\uff0c\u9ad8\u53ef\u7528\u91cc\u6709\u4e00\u4e3b\u4e00\u5907 interface eth0 #\u7ed1\u5b9aIP\u7684\u7f51\u5361 virtual_router_id 51 #\u4e24\u7aef\u7684route_id \u8981\u4e00\u81f4 priority 150 #\u4f18\u5148\u7ea7\u6570\u503c\u8d8a\u9ad8\u8d8a\u4f18\u5148\uff0c\u4e3b\u7684\u4e00\u5b9a\u8981\u88ab\u5907\u7684\u5927 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 10.0.0.3/24 dev eth0 label eth0:1 #\u8981\u914d\u7f6e\u7684\u865a\u62dfIP\u5730\u5740 } } 3.2 \u5907\u8d1f\u8f7d\u5747\u8861\u914d\u7f6e \u00b6 ! Configuration File for keepalived global_defs { notification_email { 610658552@qq.com #\u7ba1\u7406\u5458\u90ae\u7bb1 } notification_email_from 610658552@qq.com smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id LVS_DEVEL1 #\u8fd9\u91cc\u662fkeepalived\u7684ID\uff0c\u4e0d\u540c\u670d\u52a1\u5668\u7684id\u4e0d\u80fd\u76f8\u540c } vrrp_instance VI_1 { #\u5b9e\u4f8b state BACKUP # \u72b6\u6001\u662f\u5907\u7528\uff0c\u9ad8\u53ef\u7528\u91cc\u6709\u4e00\u4e3b\u4e00\u5907 interface eth0 #\u7ed1\u5b9aIP\u7684\u7f51\u5361 virtual_router_id 51 #\u4e24\u7aef\u7684route_id \u8981\u4e00\u81f4 priority 100 #\u4f18\u5148\u7ea7\u6570\u503c\u8d8a\u9ad8\u8d8a\u4f18\u5148\uff0c\u4e3b\u7684\u4e00\u5b9a\u8981\u88ab\u5907\u7684\u5927 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 10.0.0.3/24 dev eth0 label eth0:1 #\u8981\u914d\u7f6e\u7684\u865a\u62dfIP\u5730\u5740 } } \u542f\u52a8keepalived\uff0c\u7136\u540e\u5c31\u80fd\u6b63\u5e38\u5de5\u4f5c\u4e86\uff0c\u542f\u52a8\u547d\u4ee4\uff1a /etc/init.d/keepalived start \u505aIP\u89e3\u6790\u7684\u65f6\u5019\uff0c\u53ea\u8981\u89e3\u6790\u523010.0.0.3\u8fd9\u4e2aIP\u5373\u53ef","title":"11. nginx \u8d1f\u8f7d\u5747\u8861"},{"location":"linux/nginx/nginx.slb/#1","text":"\u5b9e\u73b0Nginx\u8d1f\u8f7d\u5747\u8861\u7684\u7ec4\u4ef6\u4e3b\u8981\u7531\u4e24\u4e2a\uff0c\u89c1\u4e0b\u8868 Nginx http\u529f\u80fd\u6a21\u5757 \u6a21\u5757\u8bf4\u660e ngx_http_proxy_module proxy\u4ee3\u7406\u6a21\u5757\uff0c\u7528\u4e8e\u628a\u8bf7\u6c42\u540e\u629b\u7ed9\u670d\u52a1\u5668\u8282\u70b9\u6216upstream\u670d\u52a1\u5668\u6c60\u3002 ngx_http_upstream_module \u8d1f\u8f7d\u5747\u8861\u6a21\u5757\uff0c\u53ef\u4ee5\u5b9e\u73b0\u7f51\u7ad9\u7684\u8d1f\u8f7d\u5747\u8861\u529f\u80fd\u53ca\u8282\u70b9\u7684\u5065\u5eb7\u68c0\u67e5\u3002 \u5b98\u65b9\u4ecb\u7ecd\u8fde\u63a5\uff1a http://nginx.org/en/docs/http/ngx_http_upstream_module.html","title":"1. \u4ecb\u7ecd"},{"location":"linux/nginx/nginx.slb/#2","text":"","title":"2. \u73af\u5883\u51c6\u5907"},{"location":"linux/nginx/nginx.slb/#21","text":"\u51c6\u59074\u53f0VM\u865a\u62df\u673a\uff08\u6709\u7269\u7406\u670d\u52a1\u5668\u66f4\u4f73\uff09\uff0c\u4e24\u53f0\u505a\u8d1f\u8f7d\u5747\u8861\uff0c\u4e24\u53f0\u505aRS\uff0c\u5982\u4e0b\u8868\u3002 HOSTNAME IP \u8bf4\u660e lb01 10.0.0.7 Nginx\u4e3b\u8d1f\u8f7d\u5747\u8861\u5668 lb02 10.0.0.8 Nginx\u8f85\u8d1f\u8f7d\u5747\u8861\u5668 web01 10.0.0.9 web01\u670d\u52a1\u5668 web02 10.0.0.10 web02\u670d\u52a1\u5668","title":"2.1 \u786c\u4ef6\u51c6\u5907"},{"location":"linux/nginx/nginx.slb/#22-nginx","text":"\u4e0b\u9762\u5c06\u5728\u4ee5\u4e0a4\u53f0\u670d\u52a1\u5668\u4e0a\u5b89\u88c5Nginx\u3002\u5b8c\u6574\u7684\u5b89\u88c5\u8fc7\u7a0b\u89c1\u4e0a\u9762\u7684\u8bf4\u660e\uff0c\u8fd9\u91cc\u53ea\u5199\u51fa\u5b89\u88c5\u7684\u547d\u4ee4\u90e8\u5206\u3002 \u5b89\u88c5\u4f9d\u8d56\u8f6f\u4ef6\u5305\u547d\u4ee4\u96c6\u5408\u3002 yum install openssl-devel pcre-devel -y \u5b89\u88c5Nginx\u8f6f\u4ef6\u5305\u7684\u547d\u4ee4\u96c6\u5408 wget http://nginx.org/download/nginx-1.6.3.tar.gz useradd nginx -M -s /sbin/nologin tar xf nginx-1.6.3.tar.gz cd nginx-1.6.3 ./configure --prefix=/app/nginx-1.6.3 --user=nginx --group=nginx --with-http_ssl_module --with-http_stub_status_module --with-pcre make && make install ln -s /app/nginx-1.6.3/ /app/nginx","title":"2.2 \u5b89\u88c5Nginx\u8f6f\u4ef6"},{"location":"linux/nginx/nginx.slb/#23-nginx-upstream","text":"lb01\u548clb02\u7684nginx\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b\uff1a worker_processes 1; pid logs/nginx.pid; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; upstream server_pools { #\u914d\u7f6e\u4e00\u4e2aupstream\u6807\u7b7e\uff0c\u540d\u79f0\u4e3aserver_pools server 172.16.1.7:80 weight=1; #\u540e\u7aef\u4e24\u53f0web\u670d\u52a1\u5668\u7684ip\u5730\u5740\u548c\u7aef\u53e3\uff0cweight=1\u8868\u793a\u6743\u91cd\u90fd\u662f1 server 172.16.1.8:80 weight=1; } server { listen 80; server_name www.caimengzhi.org; location / { proxy_pass http://server_pools; #\u8bbf\u95eewww.etiantian.org \u5c31\u629b\u7ed9\u4e0a\u9762\u7684upstream server_pools proxy_set_header Host $host; #\u628a\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u5934\u4e5f\u4e00\u8d77\u629b\u8fc7\u53bb proxy_set_header X-Forwarded-For $remote_addr; #\u628a\u5ba2\u6237\u7aef\u7684IP\u5730\u5740\u4e5f\u629b\u8fc7\u53bb\uff0cweb\u670d\u52a1\u5668\u7aef\u8bb0\u5f55\u5ba2\u6237\u7aef\u771f\u5b9eIP\u5730\u5740 } } server { listen 80; server_name blog.caimengzhi.org; location / { proxy_pass http://server_pools; proxy_set_header Host $host; proxy_set_header X-Forwarded-For $remote_addr; } } } \u901a\u8fc7\u4e0a\u9762\u7684\u914d\u7f6e\uff0c\u6211\u4eec\u5c31\u5b9e\u73b0\u4e86\u8d1f\u8f7d\u5747\u8861\u4e86\u3002","title":"2.3 Nginx upstream"},{"location":"linux/nginx/nginx.slb/#3-keepalived","text":"\u5728lb01\u548clb02\u8d1f\u8f7d\u5747\u8861\u670d\u52a1\u5668\u4e0a\u5b89\u88c5keepalived\uff0c\u5b89\u88c5\u547d\u4ee4\u5982\u4e0b\uff1a yum install keepalived -y keepalived\u7684\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\u5728/etc/keepalived/keepalived.conf","title":"3. keepalived"},{"location":"linux/nginx/nginx.slb/#31","text":"! Configuration File for keepalived global_defs { notification_email { 610658552@qq.com #\u7ba1\u7406\u5458\u90ae\u7bb1 } notification_email_from 610658552@qq.com #\u7ba1\u7406\u5458\u90ae\u7bb1 smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id LVS_DEVEL #\u8fd9\u91cc\u662fkeepalived\u7684ID\uff0c\u4e0d\u540c\u670d\u52a1\u5668\u7684id\u4e0d\u80fd\u76f8\u540c } vrrp_instance VI_1 { #\u5b9e\u4f8b state MASTER # MASTER\u4e3b\u7684\u610f\u601d\uff0c\u9ad8\u53ef\u7528\u91cc\u6709\u4e00\u4e3b\u4e00\u5907 interface eth0 #\u7ed1\u5b9aIP\u7684\u7f51\u5361 virtual_router_id 51 #\u4e24\u7aef\u7684route_id \u8981\u4e00\u81f4 priority 150 #\u4f18\u5148\u7ea7\u6570\u503c\u8d8a\u9ad8\u8d8a\u4f18\u5148\uff0c\u4e3b\u7684\u4e00\u5b9a\u8981\u88ab\u5907\u7684\u5927 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 10.0.0.3/24 dev eth0 label eth0:1 #\u8981\u914d\u7f6e\u7684\u865a\u62dfIP\u5730\u5740 } }","title":"3.1 \u4e3b\u8d1f\u8f7d\u5747\u8861\u914d\u7f6e"},{"location":"linux/nginx/nginx.slb/#32","text":"! Configuration File for keepalived global_defs { notification_email { 610658552@qq.com #\u7ba1\u7406\u5458\u90ae\u7bb1 } notification_email_from 610658552@qq.com smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id LVS_DEVEL1 #\u8fd9\u91cc\u662fkeepalived\u7684ID\uff0c\u4e0d\u540c\u670d\u52a1\u5668\u7684id\u4e0d\u80fd\u76f8\u540c } vrrp_instance VI_1 { #\u5b9e\u4f8b state BACKUP # \u72b6\u6001\u662f\u5907\u7528\uff0c\u9ad8\u53ef\u7528\u91cc\u6709\u4e00\u4e3b\u4e00\u5907 interface eth0 #\u7ed1\u5b9aIP\u7684\u7f51\u5361 virtual_router_id 51 #\u4e24\u7aef\u7684route_id \u8981\u4e00\u81f4 priority 100 #\u4f18\u5148\u7ea7\u6570\u503c\u8d8a\u9ad8\u8d8a\u4f18\u5148\uff0c\u4e3b\u7684\u4e00\u5b9a\u8981\u88ab\u5907\u7684\u5927 advert_int 1 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 10.0.0.3/24 dev eth0 label eth0:1 #\u8981\u914d\u7f6e\u7684\u865a\u62dfIP\u5730\u5740 } } \u542f\u52a8keepalived\uff0c\u7136\u540e\u5c31\u80fd\u6b63\u5e38\u5de5\u4f5c\u4e86\uff0c\u542f\u52a8\u547d\u4ee4\uff1a /etc/init.d/keepalived start \u505aIP\u89e3\u6790\u7684\u65f6\u5019\uff0c\u53ea\u8981\u89e3\u6790\u523010.0.0.3\u8fd9\u4e2aIP\u5373\u53ef","title":"3.2 \u5907\u8d1f\u8f7d\u5747\u8861\u914d\u7f6e"},{"location":"linux/nginx/nginx.virtual_hosts/","text":"Nginx \u865a\u62df\u4e3b\u673a 1. \u4ecb\u7ecd \u00b6 \u4ee5\u4e0b\u6211\u4f1a\u914d\u7f6e\u4e09\u4e2a\u865a\u62df\u4e3b\u673a\u6765\u8bb2\u89e3\u3002 [root@master nginx]# ls client_body_temp conf fastcgi_temp html logs proxy_temp sbin scgi_temp uwsgi_temp [root@master nginx]# mkdir html/{www,blog,bbs} [root@master nginx]# for n in www blog bbs;do echo \"$n.caimengzhi.org\" >html/$n/index.html;done [root@master nginx]# ll html/ total 8 -rw-r--r-- 1 root root 537 Mar 13 13:27 50x.html drwxr-xr-x 2 root root 24 Mar 13 14:22 bbs drwxr-xr-x 2 root root 24 Mar 13 14:22 blog -rw-r--r-- 1 root root 612 Mar 13 13:27 index.html drwxr-xr-x 2 root root 24 Mar 13 14:22 www [root@master nginx]# for n in www blog bbs;do cat html/$n/index.html;done www.caimengzhi.org blog.caimengzhi.org bbs.caimengzhi.org [root@master nginx]# cd conf/ [root@master conf]# egrep -v \"#|^$\" nginx.conf >a.log [root@master conf]# cat a.log worker_processes 1; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name localhost; location / { root html; index index.html index.htm; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } } [root@master conf]# >nginx.conf [root@master conf]# cat nginx.conf cat nginx.conf worker_processes 4; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name www.caimengzhi.org; root html/www; index index.html index.htmi index.php; } server { listen 80; server_name bbs.caimengzhi.org; root html/bbs; index index.html index.htmi index.php; } server { listen 80; server_name blog.caimengzhi.org; root html/blog; index index.html index.htmi index.php; } } \u4ee5\u4e0a\u914d\u7f6e\u4e86\u4e09\u5929\u865a\u62df\u4e3b\u673a\u3002\u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u3002\u6ca1\u6709\u95ee\u9898\u540e\u91cd\u542fnginx [root@master conf]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful \u914d\u7f6e\u865a\u62df\u4e3b\u673a\u7684\u6d41\u7a0b 1 \u3001\u590d\u5236\u4e00\u4e2a\u5b8c\u6574\u7684 serber\u6807\u7b7e\u6bb5 \uff0c\u6ce8\u610f\u8981\u653e\u5728 http\u7684\u7ed3\u675f\u5927\u62ec\u53f7\u524d\u9762 \u3002 2 \u3001\u66f4\u6539 server_name\u53ca\u5bf9\u5e94\u7684\u7f51\u9875root\u6839\u76ee\u5f55 3 \u3001\u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u8bed\u6cd5\uff0c\u5e73\u6ed1\u91cd\u542f\u670d\u52a1 4 \u3001\u521b\u5efa sever_name\u5bf9\u5e94\u7684\u7f51\u9875\u7684\u66f4\u76ee\u5f55 \uff0c\u5e76\u4e14\u521b\u5efa\u6d4b\u8bd5\u6587\u4ef6\uff0c\u82e5\u662f\u6ca1\u6709 index\u9996\u9875\u4f1a\u51fa\u73b0403 . 5 \u3001\u5728\u5ba2\u6237\u7aef\u7684\u5bf9 sever_name\u7684\u4e3b\u673a\u540d\u505ahost\u89e3\u6790\u6216\u8005DNS\u914d\u7f6e \uff0c\u5e76\u68c0\u67e5\uff08 ping\u57df\u540d\u770b\u8fd4\u56de\u7684IP\u5bf9\u4e0d\u5bf9 \uff09 6 \u3001 Win32\u6d4f\u89c8\u5668\u8bbf\u95ee \uff0c\u6216\u8005\u5728 linux\u7684\u5ba2\u6237\u7aef\u7684host\u89e3\u6790 \uff0c\u7528 wget\u6216curl\u8bbf\u95ee \u6d4b\u8bd5 [root@master conf]# egrep caimengzhi /etc/hosts 127.0.0.1 www.caimengzhi.org 127.0.0.1 bbs.caimengzhi.org 127.0.0.1 blog.caimengzhi.org [root@master conf]# curl www.caimengzhi.org www.caimengzhi.org [root@master conf]# curl bbs.caimengzhi.org bbs.caimengzhi.org [root@master conf]# curl blog.caimengzhi.org blog.caimengzhi.org 2. nginx\u72b6\u6001\u4fe1\u606f\u865a\u62df\u4e3b\u673a \u00b6 [root@master conf]# !e egrep caimengzhi /etc/hosts 127.0.0.1 www.caimengzhi.org 127.0.0.1 bbs.caimengzhi.org 127.0.0.1 blog.caimengzhi.org 127.0.0.1 status.caimengzhi.org [root@master conf]# cat nginx.conf worker_processes 4; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name www.caimengzhi.org; root html/www; index index.html index.htmi index.php; } server { listen 80; server_name bbs.caimengzhi.org; root html/bbs; index index.html index.htmi index.php; } server { listen 80; server_name blog.caimengzhi.org; root html/blog; index index.html index.htmi index.php; } server { listen 80; server_name status.caimengzhi.org; location / { stub_status on; access_log off; } } } [root@master conf]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful [root@master conf]# /app/nginx/sbin/nginx -s reload [root@master conf]# curl status.caimengzhi.org Active connections: 1 server accepts handled requests 7 7 7 Reading: 0 Writing: 1 Waiting: 0 \u89e3\u91ca Active connections: 1 #nginx \u6574\u5728\u5904\u7406\u7684\u6d3b\u52a8\u8fde\u63a5\u6570\u662f1\u4e2a server accepts handled requests 7 7 7 \u7b2c\u4e00\u4e2aserver \u8868\u793anginx\u542f\u52a8\u5230\u73b0\u5728\u4e00\u5171\u5904\u7406\u4e867\u4e2a\u8fde\u63a5\u6570 \u7b2c\u4e8c\u4e2aaccept \u8868\u793anginx\u542f\u52a8\u5230\u73b0\u5728\u4e00\u5171\u521b\u5efa\u4e867\u4e2a\u8fde\u63a5\u6570 \u8bf7\u6c42\u4e22\u5931\u6570=\uff08\u63e1\u624b\u6570 - \u8fde\u63a5\u6570\uff09\uff0c\u53ef\u4ee5\u770b\u51fa\uff0c\u672c\u6b21\u72b6\u6001\u663e\u793a\u6ca1\u6709\u4e22\u5931\u8bf7\u6c42\u3002 \u7b2c\u4e09\u4e2aaccepts \u8868\u793a\u4e00\u5171\u5904\u7406\u4e867\u6b21\u8bf7\u6c42 \u4e00\u822cserver accept \u4e24\u4e2a\u4e2a\u8981\u76f8\u7b49\uff0c\u5426\u5219\u8bf7\u6c42\u5fc5\u6709\u4e22\u5931 Reading: 0 Writing: 1 Waiting: 9 #Reading \uff1anginx \u8bfb\u53d6\u5230\u5ba2\u6237\u7aef\u7684Header\u7684\u4fe1\u606f\u6570 #Writing \uff1anginx \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684Heaer\u7684\u4fe1\u606f\u6570 #Waiting \uff1a\u5df2\u7ecf\u5904\u7406\u5b8c\u6b63\u5728\u7b49\u5019\u4e0b\u4e00\u6b21\u8bf7\u6c42\u6307\u4ee4\u7684\u9a7b\u7559\u8fde\u63a5\uff0c\u5f00\u542fkeep_alive\u7684\u60c5\u51b5\u4e0b\uff0c \u8fd9\u4e2a\u503c\u7b49\u4e8eactive -(reading + writing) 3. \u865a\u62df\u4e3b\u673a\u522b\u540d \u00b6 server_name www.caimengzhi.org caimengzhi.org; \u5c31\u662f\u5728server_name\u540e\u9762\u7684\u57df\u540d \u7a7a\u683c\u540e\u5728\u52a0\u4e0a\u4e00\u4e2a\u57df\u540d\uff0c\u8bbf\u95ee\u540e\u9762\u65b0\u589e\u52a0\u7684\u57df\u540d\u5c31\u4f1a\u8df3\u8f6c\u5230\u524d\u9762\u7684\u57df\u540d [root@master conf]# cat nginx.conf worker_processes 4; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name www.caimengzhi.org caimengzhi.org; root html/www; index index.html index.htmi index.php; } server { listen 80; server_name bbs.caimengzhi.org; root html/bbs; index index.html index.htmi index.php; } server { listen 80; server_name blog.caimengzhi.org; root html/blog; index index.html index.htmi index.php; } server { listen 80; server_name status.caimengzhi.org; location / { stub_status on; access_log off; } } } [root@master conf]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful [root@master conf]# /app/nginx/sbin/nginx -s reload [root@master conf]# egrep caimengzhi /etc/hosts 127.0.0.1 www.caimengzhi.org caimengzhi.org 127.0.0.1 bbs.caimengzhi.org 127.0.0.1 blog.caimengzhi.org 127.0.0.1 status.caimengzhi.org [root@master conf]# curl caimengzhi.org www.caimengzhi.org apache \u800c apache\u6307\u5b9a\u522b\u540d\u7684\u662f \uff1a Apache\u522b\u540d SeverAlias \u540e\u9762\u6dfb\u52a0\u57df\u540d 4. 301 \u914d\u7f6e \u00b6 [root@master conf]# vim nginx.conf worker_processes 4; events { worker_connections 1024; } http { include mime.types; keepalive_timeout 65; server { listen 80; server_name www.caimengzhi.org caimengzhi.org; root html/www; index index.html index.htmi index.php; rewrite ^/(.*) http://bbs.caimengzhi.org/$1 permanent; } server { listen 80; server_name bbs.caimengzhi.org; root html/bbs; index index.html index.htmi index.php; } server { listen 80; server_name blog.caimengzhi.org; root html/blog; index index.html index.htmi index.php; } server { listen 80; server_name status.caimengzhi.org; location / { stub_status on; access_log off; } } \"nginx.conf\" 37L, 918C written [root@master conf]# /app/nginx/sbin/nginx -s reload [root@master conf]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful [root@master conf]# curl caimengzhi.org <html> <head><title>301 Moved Permanently</title></head> <body bgcolor=\"white\"> <center><h1>301 Moved Permanently</h1></center> <hr><center>nginx/1.14.2</center> </body> </html> [root@master conf]# elinks www.caimengzhi.org http://bbs.caimengzhi.org/ bbs.caimengzhi.org \u8bbf\u95ee\u8ddf\u540e\u7684\u5185\u5bb9\u4e5f\u5c31\u662f^/(.*)\uff0c$1 \u63a5\u53d7\u6240\u6709,\u4ee5\u4e0a\u8bf4\u660e\u5df2\u7ecf\u8df3\u8f6c\u6210\u529f\u3002 \u6ce8\u610f 1 \u3001\u522b\u540d \u5730\u5740\u8fd8\u662f caimengzhi . org ==> bbs . caimengzhi . org\u7684\u5185\u5bb9 2 \u3001 caimengzhi . org\u8df3\u8f6c\u5730\u5740\u680fbbs . caimengzhi . org ( rewrite ) 3 \u3001 Ip \u8bbf\u95ee\uff0c\u8bbf\u95ee\u7684\u662f\u7b2c\u4e00\u4e2a\u6807\u7b7e\u5185\u5bb9 4 \u3001\u89e3\u51b3\u6076\u610f\u57df\u540d\u7ed1\u5b9a 5. \u7981\u6b62IP\u8bbf\u95ee \u00b6 [root@master conf]# cat nginx.conf worker_processes 4; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; location / { deny all; } } server { listen 80; server_name www.caimengzhi.org caimengzhi.org; root html/www; index index.html index.htmi index.php; rewrite ^/(.*) http://bbs.caimengzhi.org/$1 permanent; } server { listen 80; server_name bbs.caimengzhi.org; root html/bbs; index index.html index.htmi index.php; } server { listen 80; server_name blog.caimengzhi.org; root html/blog; index index.html index.htmi index.php; } server { listen 80; server_name status.caimengzhi.org; location / { stub_status on; access_log off; } } } [root@master conf]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful [root@master conf]# /app/nginx/sbin/nginx -s reload [root@master conf]# curl www.caimengzhi.org <html> <head><title>301 Moved Permanently</title></head> <body bgcolor=\"white\"> <center><h1>301 Moved Permanently</h1></center> <hr><center>nginx/1.14.2</center> </body> </html> [root@master conf]# curl bbs.caimengzhi.org bbs.caimengzhi.org [root@master conf]# curl blog.caimengzhi.org blog.caimengzhi.org [root@master conf]# curl 127.0.0.1 <html> <head><title>403 Forbidden</title></head> <body bgcolor=\"white\"> <center><h1>403 Forbidden</h1></center> <hr><center>nginx/1.14.2</center> </body> </html> nginx\u7684IP\u8bbf\u95ee\uff0c\u9ed8\u8ba4\u662f\u8d70\u7b2c\u4e00\u4e2aserver\u3002\u7b2c\u4e00\u4e2aserver\u662fdeny\u7684\u3002\u6240\u4ee5\u5c31\u7981\u6b62\u4e86ip\u8bbf\u95ee\uff0c\u53ea\u80fd\u901a\u8fc7\u57df\u540d\u4e86\u3002 6. \u865a\u62df\u4e3b\u673a\u5206\u7c7b \u00b6 \u591a\u4e2a\u865a\u62df\u4e3b\u673a\u5199\u5728\u4e00\u4e2anginx.conf\u6587\u4ef6\u4e2d\uff0c\u4e0d\u65b9\u4fbf\u7ef4\u62a4\u4e5f\u6bd4\u8f83\u9ebb\u70e6\u3002\u7c7b\u4f3capache\u7684\u4e5f\u53ef\u4ee5\u5206\u7c7b\u865a\u62df\u4e3b\u673a\u3002 [root@master conf]# cp nginx.conf nginx.conf.ori [root@master conf]# mkdir extra [root@master conf]# cat nginx.conf error_log logs/error.log error; worker_processes 4; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; include extra/www.conf; include extra/bbs.conf; include extra/blog.conf; #\u6216\u8005\u76f4\u63a5\u5305\u542b\u6240\u6709 # include extra/*.conf; #\u8868\u793a\u5305\u542bextra\u6240\u6709\u7684.conf\u6587\u4ef6 } [root@master conf]# ls extra/ bbs.conf blog.conf www.conf [root@master conf]# cat extra/www.conf server { listen 80; server_name www.caimengzhi.org; root html/www; index index.html index.htmi index.php; access_log logs/www_access.log; } [root@master conf]# cat extra/bbs.conf server { listen 80; server_name bbs.caimengzhi.org; root html/bbs; index index.html index.htmi index.php; access_log logs/bbs_access.log; } [root@master conf]# cat extra/blog.conf server { listen 80; server_name blog.caimengzhi.org; root html/blog; index index.html index.htmi index.php; access_log logs/blog_access.log; } [root@master conf]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful [root@master conf]# /app/nginx/sbin/nginx -s reload \u6d4b\u8bd5 [root@master conf]# curl www.caimengzhi.org www.caimengzhi.org [root@master conf]# curl bbs.caimengzhi.org bbs.caimengzhi.org [root@master conf]# curl blog.caimengzhi.org blog.caimengzhi.org","title":"03. nginx \u865a\u62df\u4e3b\u673a"},{"location":"linux/nginx/nginx.virtual_hosts/#1","text":"\u4ee5\u4e0b\u6211\u4f1a\u914d\u7f6e\u4e09\u4e2a\u865a\u62df\u4e3b\u673a\u6765\u8bb2\u89e3\u3002 [root@master nginx]# ls client_body_temp conf fastcgi_temp html logs proxy_temp sbin scgi_temp uwsgi_temp [root@master nginx]# mkdir html/{www,blog,bbs} [root@master nginx]# for n in www blog bbs;do echo \"$n.caimengzhi.org\" >html/$n/index.html;done [root@master nginx]# ll html/ total 8 -rw-r--r-- 1 root root 537 Mar 13 13:27 50x.html drwxr-xr-x 2 root root 24 Mar 13 14:22 bbs drwxr-xr-x 2 root root 24 Mar 13 14:22 blog -rw-r--r-- 1 root root 612 Mar 13 13:27 index.html drwxr-xr-x 2 root root 24 Mar 13 14:22 www [root@master nginx]# for n in www blog bbs;do cat html/$n/index.html;done www.caimengzhi.org blog.caimengzhi.org bbs.caimengzhi.org [root@master nginx]# cd conf/ [root@master conf]# egrep -v \"#|^$\" nginx.conf >a.log [root@master conf]# cat a.log worker_processes 1; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name localhost; location / { root html; index index.html index.htm; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } } [root@master conf]# >nginx.conf [root@master conf]# cat nginx.conf cat nginx.conf worker_processes 4; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name www.caimengzhi.org; root html/www; index index.html index.htmi index.php; } server { listen 80; server_name bbs.caimengzhi.org; root html/bbs; index index.html index.htmi index.php; } server { listen 80; server_name blog.caimengzhi.org; root html/blog; index index.html index.htmi index.php; } } \u4ee5\u4e0a\u914d\u7f6e\u4e86\u4e09\u5929\u865a\u62df\u4e3b\u673a\u3002\u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u3002\u6ca1\u6709\u95ee\u9898\u540e\u91cd\u542fnginx [root@master conf]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful \u914d\u7f6e\u865a\u62df\u4e3b\u673a\u7684\u6d41\u7a0b 1 \u3001\u590d\u5236\u4e00\u4e2a\u5b8c\u6574\u7684 serber\u6807\u7b7e\u6bb5 \uff0c\u6ce8\u610f\u8981\u653e\u5728 http\u7684\u7ed3\u675f\u5927\u62ec\u53f7\u524d\u9762 \u3002 2 \u3001\u66f4\u6539 server_name\u53ca\u5bf9\u5e94\u7684\u7f51\u9875root\u6839\u76ee\u5f55 3 \u3001\u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u8bed\u6cd5\uff0c\u5e73\u6ed1\u91cd\u542f\u670d\u52a1 4 \u3001\u521b\u5efa sever_name\u5bf9\u5e94\u7684\u7f51\u9875\u7684\u66f4\u76ee\u5f55 \uff0c\u5e76\u4e14\u521b\u5efa\u6d4b\u8bd5\u6587\u4ef6\uff0c\u82e5\u662f\u6ca1\u6709 index\u9996\u9875\u4f1a\u51fa\u73b0403 . 5 \u3001\u5728\u5ba2\u6237\u7aef\u7684\u5bf9 sever_name\u7684\u4e3b\u673a\u540d\u505ahost\u89e3\u6790\u6216\u8005DNS\u914d\u7f6e \uff0c\u5e76\u68c0\u67e5\uff08 ping\u57df\u540d\u770b\u8fd4\u56de\u7684IP\u5bf9\u4e0d\u5bf9 \uff09 6 \u3001 Win32\u6d4f\u89c8\u5668\u8bbf\u95ee \uff0c\u6216\u8005\u5728 linux\u7684\u5ba2\u6237\u7aef\u7684host\u89e3\u6790 \uff0c\u7528 wget\u6216curl\u8bbf\u95ee \u6d4b\u8bd5 [root@master conf]# egrep caimengzhi /etc/hosts 127.0.0.1 www.caimengzhi.org 127.0.0.1 bbs.caimengzhi.org 127.0.0.1 blog.caimengzhi.org [root@master conf]# curl www.caimengzhi.org www.caimengzhi.org [root@master conf]# curl bbs.caimengzhi.org bbs.caimengzhi.org [root@master conf]# curl blog.caimengzhi.org blog.caimengzhi.org","title":"1. \u4ecb\u7ecd"},{"location":"linux/nginx/nginx.virtual_hosts/#2-nginx","text":"[root@master conf]# !e egrep caimengzhi /etc/hosts 127.0.0.1 www.caimengzhi.org 127.0.0.1 bbs.caimengzhi.org 127.0.0.1 blog.caimengzhi.org 127.0.0.1 status.caimengzhi.org [root@master conf]# cat nginx.conf worker_processes 4; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name www.caimengzhi.org; root html/www; index index.html index.htmi index.php; } server { listen 80; server_name bbs.caimengzhi.org; root html/bbs; index index.html index.htmi index.php; } server { listen 80; server_name blog.caimengzhi.org; root html/blog; index index.html index.htmi index.php; } server { listen 80; server_name status.caimengzhi.org; location / { stub_status on; access_log off; } } } [root@master conf]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful [root@master conf]# /app/nginx/sbin/nginx -s reload [root@master conf]# curl status.caimengzhi.org Active connections: 1 server accepts handled requests 7 7 7 Reading: 0 Writing: 1 Waiting: 0 \u89e3\u91ca Active connections: 1 #nginx \u6574\u5728\u5904\u7406\u7684\u6d3b\u52a8\u8fde\u63a5\u6570\u662f1\u4e2a server accepts handled requests 7 7 7 \u7b2c\u4e00\u4e2aserver \u8868\u793anginx\u542f\u52a8\u5230\u73b0\u5728\u4e00\u5171\u5904\u7406\u4e867\u4e2a\u8fde\u63a5\u6570 \u7b2c\u4e8c\u4e2aaccept \u8868\u793anginx\u542f\u52a8\u5230\u73b0\u5728\u4e00\u5171\u521b\u5efa\u4e867\u4e2a\u8fde\u63a5\u6570 \u8bf7\u6c42\u4e22\u5931\u6570=\uff08\u63e1\u624b\u6570 - \u8fde\u63a5\u6570\uff09\uff0c\u53ef\u4ee5\u770b\u51fa\uff0c\u672c\u6b21\u72b6\u6001\u663e\u793a\u6ca1\u6709\u4e22\u5931\u8bf7\u6c42\u3002 \u7b2c\u4e09\u4e2aaccepts \u8868\u793a\u4e00\u5171\u5904\u7406\u4e867\u6b21\u8bf7\u6c42 \u4e00\u822cserver accept \u4e24\u4e2a\u4e2a\u8981\u76f8\u7b49\uff0c\u5426\u5219\u8bf7\u6c42\u5fc5\u6709\u4e22\u5931 Reading: 0 Writing: 1 Waiting: 9 #Reading \uff1anginx \u8bfb\u53d6\u5230\u5ba2\u6237\u7aef\u7684Header\u7684\u4fe1\u606f\u6570 #Writing \uff1anginx \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684Heaer\u7684\u4fe1\u606f\u6570 #Waiting \uff1a\u5df2\u7ecf\u5904\u7406\u5b8c\u6b63\u5728\u7b49\u5019\u4e0b\u4e00\u6b21\u8bf7\u6c42\u6307\u4ee4\u7684\u9a7b\u7559\u8fde\u63a5\uff0c\u5f00\u542fkeep_alive\u7684\u60c5\u51b5\u4e0b\uff0c \u8fd9\u4e2a\u503c\u7b49\u4e8eactive -(reading + writing)","title":"2. nginx\u72b6\u6001\u4fe1\u606f\u865a\u62df\u4e3b\u673a"},{"location":"linux/nginx/nginx.virtual_hosts/#3","text":"server_name www.caimengzhi.org caimengzhi.org; \u5c31\u662f\u5728server_name\u540e\u9762\u7684\u57df\u540d \u7a7a\u683c\u540e\u5728\u52a0\u4e0a\u4e00\u4e2a\u57df\u540d\uff0c\u8bbf\u95ee\u540e\u9762\u65b0\u589e\u52a0\u7684\u57df\u540d\u5c31\u4f1a\u8df3\u8f6c\u5230\u524d\u9762\u7684\u57df\u540d [root@master conf]# cat nginx.conf worker_processes 4; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name www.caimengzhi.org caimengzhi.org; root html/www; index index.html index.htmi index.php; } server { listen 80; server_name bbs.caimengzhi.org; root html/bbs; index index.html index.htmi index.php; } server { listen 80; server_name blog.caimengzhi.org; root html/blog; index index.html index.htmi index.php; } server { listen 80; server_name status.caimengzhi.org; location / { stub_status on; access_log off; } } } [root@master conf]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful [root@master conf]# /app/nginx/sbin/nginx -s reload [root@master conf]# egrep caimengzhi /etc/hosts 127.0.0.1 www.caimengzhi.org caimengzhi.org 127.0.0.1 bbs.caimengzhi.org 127.0.0.1 blog.caimengzhi.org 127.0.0.1 status.caimengzhi.org [root@master conf]# curl caimengzhi.org www.caimengzhi.org apache \u800c apache\u6307\u5b9a\u522b\u540d\u7684\u662f \uff1a Apache\u522b\u540d SeverAlias \u540e\u9762\u6dfb\u52a0\u57df\u540d","title":"3. \u865a\u62df\u4e3b\u673a\u522b\u540d"},{"location":"linux/nginx/nginx.virtual_hosts/#4-301","text":"[root@master conf]# vim nginx.conf worker_processes 4; events { worker_connections 1024; } http { include mime.types; keepalive_timeout 65; server { listen 80; server_name www.caimengzhi.org caimengzhi.org; root html/www; index index.html index.htmi index.php; rewrite ^/(.*) http://bbs.caimengzhi.org/$1 permanent; } server { listen 80; server_name bbs.caimengzhi.org; root html/bbs; index index.html index.htmi index.php; } server { listen 80; server_name blog.caimengzhi.org; root html/blog; index index.html index.htmi index.php; } server { listen 80; server_name status.caimengzhi.org; location / { stub_status on; access_log off; } } \"nginx.conf\" 37L, 918C written [root@master conf]# /app/nginx/sbin/nginx -s reload [root@master conf]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful [root@master conf]# curl caimengzhi.org <html> <head><title>301 Moved Permanently</title></head> <body bgcolor=\"white\"> <center><h1>301 Moved Permanently</h1></center> <hr><center>nginx/1.14.2</center> </body> </html> [root@master conf]# elinks www.caimengzhi.org http://bbs.caimengzhi.org/ bbs.caimengzhi.org \u8bbf\u95ee\u8ddf\u540e\u7684\u5185\u5bb9\u4e5f\u5c31\u662f^/(.*)\uff0c$1 \u63a5\u53d7\u6240\u6709,\u4ee5\u4e0a\u8bf4\u660e\u5df2\u7ecf\u8df3\u8f6c\u6210\u529f\u3002 \u6ce8\u610f 1 \u3001\u522b\u540d \u5730\u5740\u8fd8\u662f caimengzhi . org ==> bbs . caimengzhi . org\u7684\u5185\u5bb9 2 \u3001 caimengzhi . org\u8df3\u8f6c\u5730\u5740\u680fbbs . caimengzhi . org ( rewrite ) 3 \u3001 Ip \u8bbf\u95ee\uff0c\u8bbf\u95ee\u7684\u662f\u7b2c\u4e00\u4e2a\u6807\u7b7e\u5185\u5bb9 4 \u3001\u89e3\u51b3\u6076\u610f\u57df\u540d\u7ed1\u5b9a","title":"4. 301 \u914d\u7f6e"},{"location":"linux/nginx/nginx.virtual_hosts/#5-ip","text":"[root@master conf]# cat nginx.conf worker_processes 4; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; location / { deny all; } } server { listen 80; server_name www.caimengzhi.org caimengzhi.org; root html/www; index index.html index.htmi index.php; rewrite ^/(.*) http://bbs.caimengzhi.org/$1 permanent; } server { listen 80; server_name bbs.caimengzhi.org; root html/bbs; index index.html index.htmi index.php; } server { listen 80; server_name blog.caimengzhi.org; root html/blog; index index.html index.htmi index.php; } server { listen 80; server_name status.caimengzhi.org; location / { stub_status on; access_log off; } } } [root@master conf]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful [root@master conf]# /app/nginx/sbin/nginx -s reload [root@master conf]# curl www.caimengzhi.org <html> <head><title>301 Moved Permanently</title></head> <body bgcolor=\"white\"> <center><h1>301 Moved Permanently</h1></center> <hr><center>nginx/1.14.2</center> </body> </html> [root@master conf]# curl bbs.caimengzhi.org bbs.caimengzhi.org [root@master conf]# curl blog.caimengzhi.org blog.caimengzhi.org [root@master conf]# curl 127.0.0.1 <html> <head><title>403 Forbidden</title></head> <body bgcolor=\"white\"> <center><h1>403 Forbidden</h1></center> <hr><center>nginx/1.14.2</center> </body> </html> nginx\u7684IP\u8bbf\u95ee\uff0c\u9ed8\u8ba4\u662f\u8d70\u7b2c\u4e00\u4e2aserver\u3002\u7b2c\u4e00\u4e2aserver\u662fdeny\u7684\u3002\u6240\u4ee5\u5c31\u7981\u6b62\u4e86ip\u8bbf\u95ee\uff0c\u53ea\u80fd\u901a\u8fc7\u57df\u540d\u4e86\u3002","title":"5. \u7981\u6b62IP\u8bbf\u95ee"},{"location":"linux/nginx/nginx.virtual_hosts/#6","text":"\u591a\u4e2a\u865a\u62df\u4e3b\u673a\u5199\u5728\u4e00\u4e2anginx.conf\u6587\u4ef6\u4e2d\uff0c\u4e0d\u65b9\u4fbf\u7ef4\u62a4\u4e5f\u6bd4\u8f83\u9ebb\u70e6\u3002\u7c7b\u4f3capache\u7684\u4e5f\u53ef\u4ee5\u5206\u7c7b\u865a\u62df\u4e3b\u673a\u3002 [root@master conf]# cp nginx.conf nginx.conf.ori [root@master conf]# mkdir extra [root@master conf]# cat nginx.conf error_log logs/error.log error; worker_processes 4; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; include extra/www.conf; include extra/bbs.conf; include extra/blog.conf; #\u6216\u8005\u76f4\u63a5\u5305\u542b\u6240\u6709 # include extra/*.conf; #\u8868\u793a\u5305\u542bextra\u6240\u6709\u7684.conf\u6587\u4ef6 } [root@master conf]# ls extra/ bbs.conf blog.conf www.conf [root@master conf]# cat extra/www.conf server { listen 80; server_name www.caimengzhi.org; root html/www; index index.html index.htmi index.php; access_log logs/www_access.log; } [root@master conf]# cat extra/bbs.conf server { listen 80; server_name bbs.caimengzhi.org; root html/bbs; index index.html index.htmi index.php; access_log logs/bbs_access.log; } [root@master conf]# cat extra/blog.conf server { listen 80; server_name blog.caimengzhi.org; root html/blog; index index.html index.htmi index.php; access_log logs/blog_access.log; } [root@master conf]# /app/nginx/sbin/nginx -t nginx: the configuration file /app/nginx-1.14.2/conf/nginx.conf syntax is ok nginx: configuration file /app/nginx-1.14.2/conf/nginx.conf test is successful [root@master conf]# /app/nginx/sbin/nginx -s reload \u6d4b\u8bd5 [root@master conf]# curl www.caimengzhi.org www.caimengzhi.org [root@master conf]# curl bbs.caimengzhi.org bbs.caimengzhi.org [root@master conf]# curl blog.caimengzhi.org blog.caimengzhi.org","title":"6. \u865a\u62df\u4e3b\u673a\u5206\u7c7b"},{"location":"linux/nosql/memcached/memcached.index/","text":"Memcached 1. \u4ecb\u7ecd \u00b6 Memcached\u662f\u4e00\u4e2a\u81ea\u7531\u5f00\u6e90\u7684\uff0c\u9ad8\u6027\u80fd\uff0c\u5206\u5e03\u5f0f\u5185\u5b58\u5bf9\u8c61\u7f13\u5b58\u7cfb\u7edf\u3002 emcached\u662f\u4ee5LiveJournal\u65d7\u4e0bDanga Interactive\u516c\u53f8\u7684Brad Fitzpatric\u4e3a\u9996\u5f00\u53d1\u7684\u4e00\u6b3e\u8f6f\u4ef6\u3002\u73b0\u5728\u5df2\u6210\u4e3amixi\u3001hatena\u3001Facebook\u3001Vox\u3001LiveJournal\u7b49\u4f17\u591a\u670d\u52a1\u4e2d\u63d0\u9ad8Web\u5e94\u7528\u6269\u5c55\u6027\u7684\u91cd\u8981\u56e0\u7d20\u3002 Memcached\u662f\u4e00\u79cd\u57fa\u4e8e\u5185\u5b58\u7684key-value\u5b58\u50a8\uff0c\u7528\u6765\u5b58\u50a8\u5c0f\u5757\u7684\u4efb\u610f\u6570\u636e\uff08\u5b57\u7b26\u4e32\u3001\u5bf9\u8c61\uff09\u3002\u8fd9\u4e9b\u6570\u636e\u53ef\u4ee5\u662f\u6570\u636e\u5e93\u8c03\u7528\u3001API\u8c03\u7528\u6216\u8005\u662f\u9875\u9762\u6e32\u67d3\u7684\u7ed3\u679c\u3002 Memcached\u7b80\u6d01\u800c\u5f3a\u5927\u3002\u5b83\u7684\u7b80\u6d01\u8bbe\u8ba1\u4fbf\u4e8e\u5feb\u901f\u5f00\u53d1\uff0c\u51cf\u8f7b\u5f00\u53d1\u96be\u5ea6\uff0c\u89e3\u51b3\u4e86\u5927\u6570\u636e\u91cf\u7f13\u5b58\u7684\u5f88\u591a\u95ee\u9898\u3002\u5b83\u7684API\u517c\u5bb9\u5927\u90e8\u5206\u6d41\u884c\u7684\u5f00\u53d1\u8bed\u8a00\u3002 \u672c\u8d28\u4e0a\uff0c\u5b83\u662f\u4e00\u4e2a\u7b80\u6d01\u7684key-value\u5b58\u50a8\u7cfb\u7edf\u3002\u4e00\u822c\u7684\u4f7f\u7528\u76ee\u7684\u662f\uff0c\u901a\u8fc7\u7f13\u5b58\u6570\u636e\u5e93\u67e5\u8be2\u7ed3\u679c\uff0c\u51cf\u5c11\u6570\u636e\u5e93\u8bbf\u95ee\u6b21\u6570\uff0c\u4ee5\u63d0\u9ad8\u52a8\u6001Web\u5e94\u7528\u7684\u901f\u5ea6\u3001\u63d0\u9ad8\u53ef\u6269\u5c55\u6027\u3002 Memcached \u5b98\u7f51\uff1a http://memcached.org/ \u3002 1.Memcached \u662f\u4ec0\u4e48\u3002\u4f5c\u7528\u662f\u4ec0\u4e48\uff1f Memcached \u662f\u5f00\u6e90\u7684\uff0c\u9ad8\u6027\u80fd\u7684\u5185\u5b58\u7f13\u5b58\u7cfb\u7edf\u6216\u8005\u5185\u5b58\u7f13\u5b58\u8f6f\u4ef6\u3002\u4ece\u540d\u5b57\u4e0a\u770bmem\u662f\u5185\u5b58\uff0cchache\u5c31\u662f\u7f13\u5b58\u7684\u610f\u601d\uff0cMemcached\u901a\u8fc7\u5728\u4e8b\u5148\u89c4\u5212\u597d\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\u4e34\u65f6\u7f13\u5b58\u6570\u636e\u5e93\u4e2d\u7684\u5404\u7c7b\u6570\u636e\uff0c\u4ee5\u8fbe\u5230\u51cf\u5c11\u4e1a\u52a1\u5bf9\u6570\u636e\u5e93\u7684\u76f4\u63a5\u9ad8\u5e76\u53d1\u8bbf\u95ee\uff0c\u4ece\u800c\u8fbe\u5230\u63d0\u5347\u6570\u636e\u7684\u8bbf\u95ee\u6027\u80fd\uff0c\u52a0\u901f\u7f51\u7ad9\u52a8\u6001\u5e94\u7528\u670d\u52a1\u5668\u7684\u80fd\u529b\u3002 2.Memcached \u670d\u52a1\u5728\u4f01\u4e1a\u96c6\u6743\u67b6\u6784\u4e2d\u5e94\u7528\u573a\u666f\uff1f 1\uff09 \u4f5c\u4e3a\u6570\u636e\u7684\u524d\u7aef\u7f13\u5b58\u5e94\u7528\u3002 A. \u5b8c\u6574\u7f13\u5b58\uff08\u6613\uff09 \u9759\u6001\u7f13\u5b58 \u4f8b\u5982\uff1a \u5546\u54c1\u5206\u7c7b\uff0c\u5df2\u7ecf\u5546\u54c1\u4fe1\u606f\uff0c\u53ef\u4e8b\u5148\u653e\u5230\u5185\u5b58\u91cc\uff0c\u7136\u540e\u518d\u5bf9\u5916\u63d0\u4f9b\u6570\u636e\u8bbf\u95ee\uff0c\u8fd9\u4e2a\u79f0\u4e4b\u4e3a\u9884\u70ed\uff0c\u7528\u6237\u8ba9\u95ee\u7684\u65f6\u5019\u53ef\u4ee5\u53ea\u8bfb\u53d6memcached\u7f13\u5b58\uff0c\u4e0d\u5728\u8bfb\u53d6\u6570\u636e\u5e93\u3002 B. \u70ed\u70b9\u7f13\u5b58\uff08\u96be\uff09 \u9700\u8981\u524d\u7aefweb\u7a0b\u5e8f\u7684\u914d\u5408\uff0c\u53ea\u7f13\u5b58\u70ed\u70b9\u7684\u6570\u636e\uff0c\u5373\u7f13\u5b58\u7ecf\u5e38\u88ab\u8bbf\u95ee\u7684\u6570\u636e\u3002 \u5148\u9884\u70ed\u6570\u636e\u5e93\u91cc\u7684\u57fa\u7840\u6570\u636e\uff0c\u7136\u540e\u5728\u52a8\u6001\u66f4\u65b0\uff0c\u5148\u8bfb\u53d6\u7f13\u5b58\uff0c\u5982\u679c\u7f13\u5b58\u91cc\u9762\u6ca1\u6709\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u7a0b\u5e8f\u518d\u53bb\u8bfb\u53d6\u6570\u636e\u5e93\uff0c\u7a0b\u5e8f\u7136\u540e\u628a\u8bfb\u53d6\u5230\u6570\u636e\u653e\u5165\u7f13\u5b58\u5b58\u50a8\u3002 \u7279\u6b8a\u8bf4\u660e\uff1a 1.\u5982\u679c\u78b0\u5230\u7535\u5546\u79d2\u6740\u7b49\u9ad8\u5e76\u53d1\u7684\u4e1a\u52a1\uff0c\u4e00\u5b9a\u8981\u5148\u9884\u70ed\uff0c\u6216\u8005\u5176\u4ed6\u601d\u60f3\u5b9e\u73b0\uff0c\u4f8b\u5982\uff0c\u79d2\u6740\u53ea\u662f\u83b7\u53d6\u8d44\u683c\uff0c(JS,node,js),\u800c\u4e0d\u662f\u77ac\u95f4\u79d2\u6740\u5230\u5546\u54c1\u3002 2.\u5982\u679c\u6570\u636e\u66f4\u65b0\uff0c\u540c\u65f6\u89e6\u53d1\u7f13\u5b58\u66f4\u65b0\uff0c\u9632\u6b62\u4e2a\u7528\u6237\u8fc7\u671f\u6570\u636e\u3002 C.\u5bf9\u4e8e\u6301\u4e45\u5316\u7f13\u5b58\u5b58\u50a8\u7cfb\u7edf\uff0c\u4f8b\u5982\uff1bredis\uff0c\u53ef\u4ee5\u66ff\u4ee3\u4e00\u90e8\u5206\u6570\u636e\u7684\u5b58\u50a8\uff0c\u4e00\u4e9b\u7b80\u5355\u6570\u636e\u4e1a\u52a1\uff0c\u6295\u7968\uff0c\u7edf\u8ba1\uff0c\u597d\u53cb\u5173\u6ce8\uff0c\u5546\u54c1\u5206\u7c7b\u7b49\uff0cnosql = not only sql 2\uff09\u4f5c\u4e3a\u96c6\u6743\u7684session\u4f1a\u8bdd\u5171\u4eab\u5b58\u50a8 \u5927\u89c4\u6a21\u7f51\u7ad9sesson\u4f1a\u8bdd\u4fdd\u6301\u601d\u8def\u53ca\u5b9e\u8df5\u914d\u7f6e 3.Memcached \u670d\u52a1\u5728\u4e0d\u540c\u4f01\u4e1a \u4e1a\u52a1\u5e94\u7528\u573a\u666f\u4e2d\u7684\u5de5\u4f5c\u6d41\u7a0b\uff1f 1. \u5f53web\u7a0b\u5e8f\u9700\u8981\u8bbf\u95ee\u540e\u7aef\u6570\u636e\u5e93\u83b7\u53d6\u6570\u636e\u65f6\uff0c\u4f1a\u4f18\u5148\u8bbf\u95eememcached\u5185\u5b58\u7f13\u5b58\uff0c\u5982\u679c\u7f13\u5b58\u4e2d\u6709\u6570\u636e\u5c31\u76f4\u63a5\u83b7\u53d6\u8fd4\u56de\u524d\u7aef\u670d\u52a1\u53ca\u7528\u6237\uff0c\u5982\u679c\u6ca1\u6709\u6570\u636e(\u6ca1\u6709\u547d\u4e2d)\uff0c\u5728\u7531\u7a0b\u5e8f\u8bf7\u6c42\u540e\u7aef\u7684\u6570\u636e\u5e93\u670d\u52a1\u5668\uff0c\u83b7\u53d6\u5230\u5bf9\u5e94\u7684\u6570\u636e\u540e\uff0c\u9664\u4e86\u8fd4\u56de\u7ed9\u524d\u7aef\u670d\u52a1\u53ca\u7528\u6237\u6570\u636e\u5916\uff0c\u8fd8\u4f1a\u628a\u6570\u636e\u653e\u5230memcached\u5185\u5b58\u4e2d\u8fdb\u884c\u7f13\u5b58\uff0c\u7b49\u5f85\u4e0b\u6b21\u8bf7\u6c42\u8bbf\u95ee\uff0cmemcached\u5185\u5b58\u59cb\u7ec8\u662f\u6570\u636e\u5e93\u7684\u6321\u7bad\u724c\uff0c\u4ece\u800c\u5927\u5927\u51cf\u8f7b\u6570\u636e\u5e93\u7684\u8bbf\u95ee\u538b\u529b\uff0c\u63d0\u9ad8\u6574\u4e2a\u7f51\u7ad9\u67b6\u6784\u7684\u54cd\u5e94\u901f\u5ea6\uff0c\u63d0\u5347\u7528\u6237\u4f53\u9a8c\u3002 2. \u5f53\u7a0b\u5e8f\u66f4\u65b0\uff0c\u4fee\u6539\u6216\u8005\u5220\u9664\u6570\u636e\u5e93\u4e2d\u5df2\u6709\u7684\u6570\u636e\u65f6\uff0c\u4f1a\u540c\u65f6\u53d1\u9001\u8bf7\u6c42\u901a\u77e5memcached\u5df2\u7ecf\u7f13\u5b58\u8fc7\u7684\u540c\u4e00\u4e2aID\u7684\u65e7\u6570\u636e\u5931\u6548\uff0c\u4ece\u800c\u4fdd\u8bc1memcache\u4e2d\u7684\u6570\u636e\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e00\u81f4\uff0c\u5982\u679c\u662f\u5728\u9ad8\u5e76\u53d1\u7684\u573a\u5408\uff0c\u9664\u4e86memcached\u8fc7\u671f\u7684\u7f13\u5b58\u5931\u6548\u5916\uff0c\u8fd8\u4f1a\u901a\u8fc7\u76f8\u5173\u673a\u5236\uff0c\u4f7f\u5f97\u5728\u7528\u6237\u8bbf\u95ee\u65b0\u6570\u636e\u524d\uff0c\u901a\u8fc7\u7a0b\u5e8f\u9884\u5148\u628a\u66f4\u65b0\u7684\u8fc7\u7684\u6570\u636e\u63a8\u9001\u5230memcached\u4e2d\u7f13\u5b58\u8d77\u6765\uff0c\u8fd9\u6837\u51cf\u5c11\u6570\u636e\u5e93\u7684\u538b\u529b\uff0c\u63d0\u9ad8\u547d\u4e2d\u7387\u3002 3. \u6570\u636e\u5e93\u63d2\u4ef6\u53ef\u4ee5\u518d\u5199\u5165\u66f4\u65b0\u6570\u636e\u5e93\u540e\uff0c\u81ea\u52a8\u629b\u7ed9MC\u7f13\u5b58\u8d77\u6765\uff0c\u81ea\u8eab\u4e0dcache\u3002 4.Memcached \u670d\u52a1\u5206\u5e03\u5f0f\u96c6\u7fa4\u5982\u4f55\u5b9e\u73b0\uff1f \u7279\u6b8a\u8bf4\u660e\uff1bmemcached\u96c6\u7fa4\u548cweb\u670d\u52a1\u96c6\u7fa4\u662f\u4e0d\u4e00\u6837\u7684\u3002\u6240\u6709memcached\u6570\u636e\u7684\u603b\u548c \u624d\u662f\u6570\u636e\u5e93\u7684\u6570\u636e\u3002 A. \u7a0b\u5e8f\u6bb5\u5b9e\u73b0 \u7a0b\u5e8f\u52a0\u8f7d\u6240\u6709memcached\u7684ip\u5217\u8868\uff0c\u901a\u8fc7key\u505ahash\uff08\u4e00\u81f4\u6027\u54c8\u5e0c\uff0c\u76ee\u7684\u662f\u4fdd\u8bc1\u4e00\u4e2a\u8282\u70b9\u5b95\u673a\u540e\u6570\u636e\u66f4\u65b0\u6700\u4f4e\uff09\uff0c\u6bcf\u5929memcached\u90fd\u662f\u90e8\u5206\u6570\u636e B. \u8d1f\u8f7d\u5747\u8861\u5668 \u901a\u8fc7\u5bf9key\u505ahash\uff08\u4e00\u81f4\u6027hash\uff09 \u4e00\u81f4\u6027hash\u7684\u7b97\u6cd5\u7684\u76ee\u7684\u662f\u4e0d\u4f46\u4fdd\u8bc1\u6bcf\u4e2a\u5bf9\u8c61\u53ea\u8bfb\u6c42\u4e00\u4e2a\u5bf9\u5e94\u7684\u670d\u52a1\u5668\uff0c\u800c\u4e14\u5f53\u8282\u70b9\u5b95\u673a\u540e\u7f13\u5b58\u670d\u52a1\u5668\u7684\u66f4\u65b0\u91cd\u65b0\u5206\u914d\u6bd4\u4f8b\u964d\u5230\u6700\u4f4e\u3002 http://blog.csdn.net/cutesource/article/details/5848253 5.Memcached \u670d\u52a1\u7279\u70b9\u53ca\u5de5\u4f5c\u539f\u7406\u662f\u4ec0\u4e48\uff1f A. \u5168\u90e8\u6570\u636e\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u65e0\u6301\u4e45\u6027\u5b58\u50a8\u8bbe\u7f6e\uff0c\u91cd\u542f\u670d\u52a1\u6570\u636e\u5c31\u4e22\u5931 B. \u8282\u70b9\u4e4b\u95f4\u76f8\u4e92\u72ec\u7acb C. \u5f02\u6b65I/O \u6a21\u578b\uff0c\u57fa\u4e8elibevent\u6a21\u578b\u7684\u4e8b\u4ef6\u901a\u77e5\u673a\u5236 D. \u6570\u636e\u662f\u4ee5Key/value\u952e\u503c\u5bf9\u5f62\u5f0f\u5b58\u5728\u7684 E. C/S\u6a21\u5f0f\u67b6\u6784\uff0cc\u8bed\u8a00\u7f16\u5199\uff0c\u603b\u4ee3\u78012000\u591a\u884c F. \u5f53\u5185\u5b58\u7f13\u5b58\u7684\u6570\u636e\u5bb9\u91cf\u8fbe\u5230\u542f\u52a8\u65f6\u5019\u9884\u8bbe\u5b9a\u7684\u5185\u5b58\u503c\u65f6\u5019\uff0c\u5c31\u81ea\u52a8\u4f7f\u7528LRU\u7b97\u6cd5\u6e05\u9664\u8fc7\u671f\u7684\u7f13\u5b58\u6570\u636e G. \u53ef\u4ee5\u5bf9\u6751\u587e\u7684\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u6837\u8fc7\u671f\u540e\u7684\u6570\u636e\u81ea\u52a8\u88ab\u6e05\u9664\uff0c\u670d\u52a1\u672c\u8eab\u4e0d\u4f1a\u88ab\u76d1\u63a7\u8fc7\u671f\uff0c\u800c\u662f\u5728\u8bbf\u95ee\u7684\u65f6\u5019\u67e5\u770bkey\u7684\u65f6\u95f4\u6233\u5224\u65ad\u662f\u5426\u8fc7\u671f\u3002 H. Memcache\u5185\u5b58\u5206\u914d\u673a\u5668\u662f\u5bf9\u7279\u5b9a\u7684\u5185\u5b58\u8fdb\u884c\u5206\u5757\uff0c\u518d\u628a\u591a\u4e2a\u5757\u5206\u4e3a\u4e00\u7ec4\u3002 2. \u5b89\u88c5\u6d4b\u8bd5 \u00b6 2.1 \u5b89\u88c5 \u00b6 wget http://www.memcached.org/files/memcached-1.5.12.tar.gz tar xf memcached-1.5.12.tar.gz cd memcached-1.5.12 ./configure --prefix=/usr/local/memcached make && sudo make install echo $? \u64cd\u4f5c\u8fc7\u7a0b root@leco:/usr/local/src# wget http://www.memcached.org/files/memcached-1.5.12.tar.gz --2019-02-20 09:55:44-- http://www.memcached.org/files/memcached-1.5.12.tar.gz \u6b63\u5728\u89e3\u6790\u4e3b\u673a www.memcached.org (www.memcached.org)... 107.170.231.145 \u6b63\u5728\u8fde\u63a5 www.memcached.org (www.memcached.org)|107.170.231.145|:80... \u5df2\u8fde\u63a5\u3002 \u7701\u7565\u3002\u3002\u3002 root@leco:/usr/local/src# ls memcached-1.5.12.tar.gz memcached-1.5.12.tar.gz root@leco:/usr/local/src# tar xf memcached-1.5.12.tar.gz root@leco:/usr/local/src# cd memcached-1.5.12 root@leco:/usr/local/src/memcached-1.5.12# ./configure --prefix=/usr/local/memcached root@leco:/usr/local/src/memcached-1.5.12# make && sudo make install root@leco:/usr/local/src/memcached-1.5.12# echo $? 0 # \u6dfb\u52a0\u73af\u5883\u53d8\u91cf root@leco:/usr/local/src/memcached-1.5.12# vim /etc/profile root@leco:/usr/local/src/memcached-1.5.12# tail -1 /etc/profile export PATH=$PATH:/usr/local/memcached/bin root@leco:/usr/local/src/memcached-1.5.12# source /etc/profile \u4ee5\u4e0a\u662f\u6e90\u7801\u5305\u5b89\u88c5\uff0c\u53ef\u4ee5\u5b89\u88c5\u6700\u65b0\u7248\u672c\u7684\uff0c\u8981\u662f\u5728\u7ebf\u5b89\u88c5\uff0c\u90fd\u662f\u57fa\u4e8e\u7cfb\u7edf\u6e90\u5b89\u88c5\u7684\u3002\u63a8\u8350\u6e90\u7801\u5b89\u88c5 2.2 \u542f\u52a8 \u00b6 root@leco:~# memcached -d -m 10 -u root -l 0.0.0.0 -p 11211 -c 256 -P /tmp/memcached.pid root@leco:~# netstat -lnp|grep 11211 tcp 0 0 0.0.0.0:11211 0.0.0.0:* LISTEN 7862/memcached unix 2 [ ACC ] \u6d41 LISTENING 100911211 11507/unity-files-d @leco-com.canonical.Unity.Scope.files.T5294429510698002 root@leco:~# telnet localhost 11211 Trying 127.0.0.1... Connected to localhost. Escape character is '^]'. \u5982\u679c\u51fa\u73b0\u4ee5\u4e0a\u5185\u5bb9\u5c31\u4ee3\u8868\u542f\u52a8\u6210\u529f\uff01 \u53c2\u6570\u8bf4\u660e -d |\u662f\u542f\u52a8\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b -m |\u662f\u5206\u914d\u7ed9Memcache\u4f7f\u7528\u7684\u5185\u5b58\u6570\u91cf\uff0c\u5355\u4f4d\u662fMB -u |\u662f\u8fd0\u884cMemcache\u7684\u7528\u6237 -l |\u662f\u76d1\u542c\u7684\u670d\u52a1\u5668IP\u5730\u5740 -p |\u662f\u8bbe\u7f6eMemcache\u76d1\u542c\u7684\u7aef\u53e3,\u6700\u597d\u662f1024\u4ee5\u4e0a\u7684\u7aef\u53e3 -c |\u9009\u9879\u662f\u6700\u5927\u8fd0\u884c\u7684\u5e76\u53d1\u8fde\u63a5\u6570\uff0c\u9ed8\u8ba4\u662f1024\uff0c\u6309\u7167\u4f60\u670d\u52a1\u5668\u7684\u8d1f\u8f7d\u91cf\u6765\u8bbe\u5b9a -P |\u662f\u8bbe\u7f6e\u4fdd\u5b58Memcache\u7684pid\u6587\u4ef6 2.3 \u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\u52a8 \u00b6 echo 'memcached -d -m 10 -u root -l 0.0.0.0 -p 11211 -c 256 -P /tmp/memcached.pid' >> /etc/rc.local 3. \u547d\u4ee4 \u00b6 \u8bed\u6cd5 command_name key flags exptime bytes value \\r\\n \u53c2\u6570\u89e3\u91ca command_name \u662f set add replace get delete key key \u7528\u4e8e\u67e5\u627e\u7f13\u5b58\u503c flags \u53ef\u4ee5\u5305\u62ec\u952e\u503c\u5bf9\u7684\u6574\u578b\u53c2\u6570\uff0c\u5ba2\u6237\u673a\u4f7f\u7528\u5b83\u5b58\u50a8\u5173\u4e8e\u952e\u503c\u5bf9\u7684\u989d\u5916\u4fe1\u606f expiration time \u5728\u7f13\u5b58\u4e2d\u4fdd\u5b58\u952e\u503c\u5bf9\u7684\u65f6\u95f4\u957f\u5ea6\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0c 0 \u8868\u793a\u6c38\u8fdc\uff09 bytes \u5728\u7f13\u5b58\u4e2d\u5b58\u50a8\u7684\u5b57\u8282\u70b9 value \u5b58\u50a8\u7684\u503c\uff08\u59cb\u7ec8\u4f4d\u4e8e\u7b2c\u4e8c\u884c\uff09 set \u5b58\u50a8\u6b21\u6570\u636e add \u5b58\u50a8\u6b21\u6570\u636e\uff0c\u53ea\u5728\u670d\u52a1\u5668\u672a\u4fdd\u5b58\u6b64\u952e\u503c\u7684\u6570\u636e\u65f6 \u53c2\u6570 \u8bf4\u660e command set\u65e0\u8bba\u5982\u4f55\u90fd\u8fdb\u884c\u5b58\u50a8\uff0cadd\u53ea\u6709\u6570\u636e\u4e0d\u5b58\u5728\u65f6\u8fdb\u884c\u6dfb\u52a0 key \u5b58\u50a8\u7684key\u7684\u540d\u5b57\uff0c\u957f\u5ea6\u6700\u591a\u4e3a250\u4e2a\u5b57\u7b26\uff0c\u4e0d\u5305\u542b\u7a7a\u683c\u548c\u63a7\u5236\u5b57\u7b26 flags \u662f\u4e00\u4e2a16\u4f4d\u7684\u65e0\u7b26\u53f7\u7684\u6574\u6570(\u4ee5\u5341\u8fdb\u5236\u7684\u65b9\u5f0f\u8868\u793a)\u3002\u8be5\u6807\u5fd7\u5c06\u548c\u9700\u8981\u5b58\u50a8\u7684\u6570\u636e\u4e00\u8d77\u5b58\u50a8,\u5e76\u5728\u5ba2\u6237\u7aefget\u6570\u636e\u65f6\u8fd4\u56de exptime \u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2\uff0c0\u4e3a\u6c38\u8fdc\uff0c\u8868\u793a\u7528\u4e0d\u8fc7\u671f\uff0c<30\u592960*60*24*30\u4e3a\u79d2\u6570\uff0c>30\u5929\u4e3aunixtime\u65f6\u95f4\u6233 bytes byte\u5b57\u8282\u6570\uff0c\u4e0d\u5305\u542b\\r\\n\uff0c\u6839\u636e\u957f\u5ea6\u622a\u53d6\u5b58/\u53d6\u7684\u5b57\u7b26\u4e32\uff0c\u53ef\u4ee5\u662f0\uff0c\u5373\u5b58\u7a7a\u4e32 version \u7248\u672c\u53f7\uff0c\u53ef\u9009\u7684\uff0c\u53ef\u4e0d\u5199\uff0c\u8fd9\u4e2a\u5b57\u65ad\u4e3b\u8981\u662f\u7ed9cas\u547d\u4ee4\u7528 datablock \u50a8\u5b58\u7684\u5185\u5bb9value\uff0c\u4ee5\\r\\n\u7ed3\u5c3e\uff0c\u5f53\u7136\u53ef\u4ee5\u5305\u542b\\r\u6216\\n status STORED/NOT_STORED/EXISTS/NOT_FOUND/ERROR/CLIENT_ERROR/SERVER_ERROR\u670d\u52a1\u7aef\u8fd4\u56de\u7684\u72b6\u6001\u6807\u5fd7 3.1 set \u00b6 Memcached set \u547d\u4ee4\u7528\u4e8e\u5c06 value(\u6570\u636e\u503c) \u5b58\u50a8\u5728\u6307\u5b9a\u7684 key(\u952e) \u4e2d\u3002 set \u547d\u4ee4\u7528\u4e8e\u5411\u7f13\u5b58\u6dfb\u52a0\u65b0\u7684\u952e\u503c\u5bf9\u3002\u5982\u679c\u952e\u5df2\u7ecf\u5b58\u5728\uff0c\u5219\u4e4b\u524d\u7684\u503c\u5c06\u88ab\u66ff\u6362\u3002 \u5b58\u50a8cmz(key)\u8fd9\u4e2a\u952e\uff0c\u503c\u662fcaimengzhi\uff0810\u4e2a\u5b57\u7b26\uff09\uff0c\u5426\u4ed6\u6dfb\u52a0\u4e0d\u6210\u529f root@leco:/home/leco# printf \"set cmz 0 0 10\\r\\ncaimengzhi\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get cmz\\r\\n\"|nc 127.0.0.1 11211 VALUE cmz 0 10 caimengzhi END \u4ee5\u4e0b\u662f\u5b58\u50a8\u7684\u5b57\u7b26\u4e0d\u5bf9\u7684\u9519\u8bef\u60c5\u51b5 root@leco:/home/leco# printf \"set cmz1 0 0 10\\r\\nccc\\r\\n \"|nc 127.0.0.1 11211 root@leco:/home/leco# printf \"get cmz1\\r\\n\"|nc 127.0.0.1 11211 END \u5982\u679c\u4f7f\u7528 set \u547d\u4ee4\u6b63\u786e\u8bbe\u5b9a\u4e86\u952e\u503c\u5bf9\uff0c\u670d\u52a1\u5668\u5c06\u4f7f\u7528\u5355\u8bcd STORED \u8fdb\u884c\u54cd\u5e94\u3002\u672c\u793a\u4f8b\u5411\u7f13\u5b58\u4e2d\u6dfb\u52a0\u4e86\u4e00\u4e2a\u952e\u503c\u5bf9\uff0ccmz\uff0c\u5176\u503c\u4e3acaimengzhi\u3002\u5e76\u5c06\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a 0\uff0c\u8fd9\u5c06\u5411 memcached \u901a\u77e5\u60a8\u5e0c\u671b\u5c06\u6b64\u503c\u5b58\u50a8\u5728\u7f13\u5b58\u4e2d\u76f4\u5230\u5220\u9664\u5b83\u4e3a\u6b62\u3002 3.2 add \u00b6 \u4ec5\u5f53\u7f13\u5b58\u4e2d\u4e0d\u5b58\u5728\u952e\u65f6\uff0cadd \u547d\u4ee4\u624d\u4f1a\u5411\u7f13\u5b58\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u952e\u503c\u5bf9\u3002\u5982\u679c\u7f13\u5b58\u4e2d\u5df2\u7ecf\u5b58\u5728\u952e\uff0c\u5219\u4e4b\u524d\u7684\u503c\u5c06\u4ecd\u7136\u4fdd\u6301\u76f8\u540c\uff0c\u5e76\u4e14\u60a8\u5c06\u83b7\u5f97\u54cd\u5e94 NOT_STORED\u3002 root@leco:/home/leco# printf \"add cmz 0 0 10\\r\\ncaimengzhi\\r\\n \"|nc 127.0.0.1 11211 # \u56e0\u4e3a\u4e4b\u524d\u8bbe\u7f6e\u4e86\uff0c\u6240\u4ee5\u4e0d\u5728\u5b58\u50a8 NOT_STORED root@leco:/home/leco# printf \"add cmz1 0 0 10\\r\\ncaimengzhi\\r\\n \"|nc 127.0.0.1 11211 STORED 3.3 replace \u00b6 \u4ec5\u5f53\u952e\u5df2\u7ecf\u5b58\u5728\u65f6\uff0creplace \u547d\u4ee4\u624d\u4f1a\u66ff\u6362\u7f13\u5b58\u4e2d\u7684\u952e\u3002\u5982\u679c\u7f13\u5b58\u4e2d\u4e0d\u5b58\u5728\u952e\uff0c\u90a3\u4e48\u60a8\u5c06\u4ece memcached \u670d\u52a1\u5668\u63a5\u53d7\u5230\u4e00\u6761 NOT_STORED \u54cd\u5e94\u3002 oot@leco:/home/leco# printf \"replace cmz1 0 0 10\\r\\nxaimengzhi\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get cmz1\\r\\n \"|nc 127.0.0.1 11211 VALUE cmz1 0 10 xaimengzhi END 3.4 append \u00b6 \u547d\u4ee4\u7528\u4e8e\u5411\u5df2\u5b58\u5728 key(\u952e) \u7684 value(\u6570\u636e\u503c) \u540e\u9762\u8ffd\u52a0\u6570\u636e\u3002 \u9996\u5148\u6211\u4eec\u5728 Memcached \u4e2d\u5b58\u50a8\u4e00\u4e2a\u952e nosql\uff0c\u5176\u503c\u4e3a memcached\u3002 \u7136\u540e\uff0c\u6211\u4eec\u4f7f\u7528 get \u547d\u4ee4\u68c0\u7d22\u8be5\u503c\u3002 \u7136\u540e\uff0c\u6211\u4eec\u4f7f\u7528 append \u547d\u4ee4\u5728\u952e\u4e3a nosql \u7684\u503c\u540e\u9762\u8ffd\u52a0 \"redis\"\u3002 \u6700\u540e\uff0c\u6211\u4eec\u518d\u4f7f\u7528 get \u547d\u4ee4\u68c0\u7d22\u8be5\u503c\u3002 root@leco:/home/leco# printf \"set nosql 0 0 9\\r\\nmemcached\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get nosql\\r\\n \"|nc 127.0.0.1 11211 VALUE nosql 0 9 memcached END root@leco:/home/leco# printf \"append nosql 0 0 5\\r\\nredis\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get nosql\\r\\n \"|nc 127.0.0.1 11211 VALUE nosql 0 14 memcachedredis END 3.5 prepend \u00b6 \u547d\u4ee4\u7528\u4e8e\u5411\u5df2\u5b58\u5728 key(\u952e) \u7684 value(\u6570\u636e\u503c) \u524d\u9762\u8ffd\u52a0\u6570\u636e \u3002 root@leco:/home/leco# printf \"set nosql2 0 0 9\\r\\nmemcached\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get nosql2\\r\\n \"|nc 127.0.0.1 11211 VALUE nosql2 0 9 memcached END root@leco:/home/leco# printf \"prepend nosql2 0 0 6\\r\\nredis_\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get nosql2\\r\\n \"|nc 127.0.0.1 11211 VALUE nosql2 0 15 redis_memcached END 3.6 CAS \u00b6 3.7 get \u00b6 \u83b7\u53d6\u5b58\u50a8\u5728 key(\u952e) \u4e2d\u7684 value(\u6570\u636e\u503c) \uff0c\u5982\u679c key \u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56de\u7a7a\u3002 root@leco:/home/leco# printf \"get nosql2\\r\\n \"|nc 127.0.0.1 11211 VALUE nosql2 0 15 redis_memcached END 3.8 gets \u00b6 \u83b7\u53d6\u5e26\u6709 CAS \u4ee4\u724c\u5b58 \u7684 value(\u6570\u636e\u503c) \uff0c\u5982\u679c key \u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56de\u7a7a root@leco:/home/leco# printf \"gets nosql\\r\\n \"|nc 127.0.0.1 11211 VALUE nosql 0 20 7 _name_memcachedredis END 3.9 delete \u00b6 \u547d\u4ee4\u7528\u4e8e\u5220\u9664\u5df2\u5b58\u5728\u7684 key(\u952e)\u3002 root@leco:/home/leco# printf \"delete nosql1\\r\\n \"|nc 127.0.0.1 11211 DELETED root@leco:/home/leco# printf \"gets nosql1\\r\\n \"|nc 127.0.0.1 11211 END root@leco:/home/leco# printf \"delete nosql1\\r\\n \"|nc 127.0.0.1 11211 NOT_FOUND \u5220\u9664\u4e0d\u5b58\u5728\u7684key\uff0c\u5c31\u8f93\u51faNOT_FOUND - DELETED\uff1a\u5220\u9664\u6210\u529f\u3002 - ERROR\uff1a\u8bed\u6cd5\u9519\u8bef\u6216\u5220\u9664\u5931\u8d25\u3002 - NOT_FOUND\uff1akey \u4e0d\u5b58\u5728 3.10 incr/decr \u00b6 incr \u4e0e decr \u547d\u4ee4\u7528\u4e8e\u5bf9\u5df2\u5b58\u5728\u7684 key(\u952e) \u7684\u6570\u5b57\u503c\u8fdb\u884c\u81ea\u589e\u6216\u81ea\u51cf\u64cd\u4f5c\u3002incr \u4e0e decr \u547d\u4ee4\u64cd\u4f5c\u7684\u6570\u636e\u5fc5\u987b\u662f\u5341\u8fdb\u5236\u768432\u4f4d\u65e0\u7b26\u53f7\u6574\u6570\u3002\u5982\u679c key \u4e0d\u5b58\u5728\u8fd4\u56de NOT_FOUND \uff0c\u5982\u679c\u952e\u7684\u503c\u4e0d\u4e3a\u6570\u5b57\uff0c\u5219\u8fd4\u56de CLIENT_ERROR \uff0c\u5176\u4ed6\u9519\u8bef\u8fd4\u56de ERROR\u3002 root@leco:/home/leco# printf \"set num 0 0 2\\r\\n20\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get num\\r\\n \"|nc 127.0.0.1 11211 VALUE num 0 2 20 END root@leco:/home/leco# printf \"incr num 5\\r\\n \"|nc 127.0.0.1 11211 25 root@leco:/home/leco# printf \"get num\\r\\n \"|nc 127.0.0.1 11211 VALUE num 0 2 25 END root@leco:/home/leco# printf \"set num2 0 0 2\\r\\n20\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get num2\\r\\n \"|nc 127.0.0.1 11211 VALUE num2 0 2 20 END root@leco:/home/leco# printf \"decr num2 5\\r\\n \"|nc 127.0.0.1 11211 15 root@leco:/home/leco# printf \"get num2\\r\\n \"|nc 127.0.0.1 11211 VALUE num2 0 2 15 END 3.11 stas \u00b6 \u547d\u4ee4\u7528\u4e8e\u8fd4\u56de\u7edf\u8ba1\u4fe1\u606f\u4f8b\u5982 PID(\u8fdb\u7a0b\u53f7)\u3001\u7248\u672c\u53f7\u3001\u8fde\u63a5\u6570\u7b49\u3002 root@leco:/home/leco# printf \"stats\\r\\n \"|nc 127.0.0.1 11211 STAT pid 5991 STAT uptime 41934 STAT time 1552356261 STAT version 1.5.12 STAT libevent 2.0.21-stable STAT pointer_size 64 STAT rusage_user 3.891261 STAT rusage_system 2.563143 STAT max_connections 256 STAT curr_connections 1 STAT total_connections 60 STAT rejected_connections 0 STAT connection_structures 2 STAT reserved_fds 20 STAT cmd_get 28 STAT cmd_set 17 STAT cmd_flush 0 STAT cmd_touch 0 STAT get_hits 20 STAT get_misses 8 STAT get_expired 0 STAT get_flushed 0 STAT delete_misses 1 STAT delete_hits 1 STAT incr_misses 0 STAT incr_hits 1 STAT decr_misses 0 STAT decr_hits 0 STAT cas_misses 0 STAT cas_hits 0 STAT cas_badval 0 STAT touch_hits 0 STAT touch_misses 0 STAT auth_cmds 0 STAT auth_errors 0 STAT bytes_read 1117 STAT bytes_written 3057 STAT limit_maxbytes 10485760 STAT accepting_conns 1 STAT listen_disabled_num 0 STAT time_in_listen_disabled_us 0 STAT threads 4 STAT conn_yields 0 STAT hash_power_level 16 STAT hash_bytes 524288 STAT hash_is_expanding 0 STAT slab_reassign_rescues 0 STAT slab_reassign_chunk_rescues 0 STAT slab_reassign_evictions_nomem 0 STAT slab_reassign_inline_reclaim 0 STAT slab_reassign_busy_items 0 STAT slab_reassign_busy_deletes 0 STAT slab_reassign_running 0 STAT slabs_moved 0 STAT lru_crawler_running 0 STAT lru_crawler_starts 9435 STAT lru_maintainer_juggles 83272 STAT malloc_fails 0 STAT log_worker_dropped 0 STAT log_worker_written 0 STAT log_watcher_skipped 0 STAT log_watcher_sent 0 STAT bytes 438 STAT curr_items 6 STAT total_items 12 STAT slab_global_page_pool 0 STAT expired_unfetched 0 STAT evicted_unfetched 0 STAT evicted_active 0 STAT evictions 0 STAT reclaimed 0 STAT crawler_reclaimed 0 STAT crawler_items_checked 33 STAT lrutail_reflocked 0 STAT moves_to_cold 11 STAT moves_to_warm 5 STAT moves_within_lru 4 STAT direct_reclaims 0 STAT lru_bumps_dropped 0 END \u540d\u8bcd\u89e3\u91ca pid \uff1a memcache\u670d\u52a1\u5668\u8fdb\u7a0bID uptime \uff1a\u670d\u52a1\u5668\u5df2\u8fd0\u884c\u79d2\u6570 time \uff1a\u670d\u52a1\u5668\u5f53\u524d Unix\u65f6\u95f4\u6233 version \uff1a memcache\u7248\u672c pointer_size \uff1a\u64cd\u4f5c\u7cfb\u7edf\u6307\u9488\u5927\u5c0f rusage_user \uff1a\u8fdb\u7a0b\u7d2f\u8ba1\u7528\u6237\u65f6\u95f4 rusage_system \uff1a\u8fdb\u7a0b\u7d2f\u8ba1\u7cfb\u7edf\u65f6\u95f4 curr_connections \uff1a\u5f53\u524d\u8fde\u63a5\u6570\u91cf total_connections \uff1a Memcached\u8fd0\u884c\u4ee5\u6765\u8fde\u63a5\u603b\u6570 connection_structures \uff1a Memcached\u5206\u914d\u7684\u8fde\u63a5\u7ed3\u6784\u6570\u91cf cmd_get \uff1a get\u547d\u4ee4\u8bf7\u6c42\u6b21\u6570 cmd_set \uff1a set\u547d\u4ee4\u8bf7\u6c42\u6b21\u6570 cmd_flush \uff1a flush\u547d\u4ee4\u8bf7\u6c42\u6b21\u6570 get_hits \uff1a get\u547d\u4ee4\u547d\u4e2d\u6b21\u6570 get_misses \uff1a get\u547d\u4ee4\u672a\u547d\u4e2d\u6b21\u6570 delete_misses \uff1a delete\u547d\u4ee4\u672a\u547d\u4e2d\u6b21\u6570 delete_hits \uff1a delete\u547d\u4ee4\u547d\u4e2d\u6b21\u6570 incr_misses \uff1a incr\u547d\u4ee4\u672a\u547d\u4e2d\u6b21\u6570 incr_hits \uff1a incr\u547d\u4ee4\u547d\u4e2d\u6b21\u6570 decr_misses \uff1a decr\u547d\u4ee4\u672a\u547d\u4e2d\u6b21\u6570 decr_hits \uff1a decr\u547d\u4ee4\u547d\u4e2d\u6b21\u6570 cas_misses \uff1a cas\u547d\u4ee4\u672a\u547d\u4e2d\u6b21\u6570 cas_hits \uff1a cas\u547d\u4ee4\u547d\u4e2d\u6b21\u6570 cas_badval \uff1a\u4f7f\u7528\u64e6\u62ed\u6b21\u6570 auth_cmds \uff1a\u8ba4\u8bc1\u547d\u4ee4\u5904\u7406\u7684\u6b21\u6570 auth_errors \uff1a\u8ba4\u8bc1\u5931\u8d25\u6570\u76ee bytes_read \uff1a\u8bfb\u53d6\u603b\u5b57\u8282\u6570 bytes_written \uff1a\u53d1\u9001\u603b\u5b57\u8282\u6570 limit_maxbytes \uff1a\u5206\u914d\u7684\u5185\u5b58\u603b\u5927\u5c0f\uff08\u5b57\u8282\uff09 accepting_conns \uff1a\u670d\u52a1\u5668\u662f\u5426\u8fbe\u5230\u8fc7\u6700\u5927\u8fde\u63a5\uff08 0 / 1 \uff09 listen_disabled_num \uff1a\u5931\u6548\u7684\u76d1\u542c\u6570 threads \uff1a\u5f53\u524d\u7ebf\u7a0b\u6570 conn_yields \uff1a\u8fde\u63a5\u64cd\u4f5c\u4e3b\u52a8\u653e\u5f03\u6570\u76ee bytes \uff1a\u5f53\u524d\u5b58\u50a8\u5360\u7528\u7684\u5b57\u8282\u6570 curr_items \uff1a\u5f53\u524d\u5b58\u50a8\u7684\u6570\u636e\u603b\u6570 total_items \uff1a\u542f\u52a8\u4ee5\u6765\u5b58\u50a8\u7684\u6570\u636e\u603b\u6570 evictions \uff1a LRU\u91ca\u653e\u7684\u5bf9\u8c61\u6570\u76ee reclaimed \uff1a\u5df2\u8fc7\u671f\u7684\u6570\u636e\u6761\u76ee\u6765\u5b58\u50a8\u65b0\u6570\u636e\u7684\u6570\u76ee 3.12 stas items \u00b6 \u547d\u4ee4\u7528\u4e8e\u663e\u793a\u5404\u4e2a slab \u4e2d item \u7684\u6570\u76ee\u548c\u5b58\u50a8\u65f6\u957f(\u6700\u540e\u4e00\u6b21\u8bbf\u95ee\u8ddd\u79bb\u73b0\u5728\u7684\u79d2\u6570)\u3002 root@leco:/home/leco# printf \"stats items\\r\\n \"|nc 127.0.0.1 11211 STAT items:1:number 6 STAT items:1:number_hot 0 STAT items:1:number_warm 2 STAT items:1:number_cold 4 STAT items:1:age_hot 0 STAT items:1:age_warm 463 STAT items:1:age 41411 STAT items:1:evicted 0 STAT items:1:evicted_nonzero 0 STAT items:1:evicted_time 0 STAT items:1:outofmemory 0 STAT items:1:tailrepairs 0 STAT items:1:reclaimed 0 STAT items:1:expired_unfetched 0 STAT items:1:evicted_unfetched 0 STAT items:1:evicted_active 0 STAT items:1:crawler_reclaimed 0 STAT items:1:crawler_items_checked 33 STAT items:1:lrutail_reflocked 0 STAT items:1:moves_to_cold 11 STAT items:1:moves_to_warm 5 STAT items:1:moves_within_lru 4 STAT items:1:direct_reclaims 0 STAT items:1:hits_to_hot 5 STAT items:1:hits_to_warm 5 STAT items:1:hits_to_cold 10 STAT items:1:hits_to_temp 0 END 3.13 stats sizes \u00b6 \u7528\u4e8e\u663e\u793a\u5404\u4e2aslab\u7684\u4fe1\u606f\uff0c\u5305\u62ecchunk\u7684\u5927\u5c0f\u3001\u6570\u76ee\u3001\u4f7f\u7528\u60c5\u51b5\u7b49\u3002 root@leco:/home/leco# printf \"stats slabs\\r\\n \"|nc 127.0.0.1 11211 STAT 1:chunk_size 96 STAT 1:chunks_per_page 10922 STAT 1:total_pages 1 STAT 1:total_chunks 10922 STAT 1:used_chunks 6 STAT 1:free_chunks 10916 STAT 1:free_chunks_end 0 STAT 1:mem_requested 438 STAT 1:get_hits 20 STAT 1:cmd_set 17 STAT 1:delete_hits 1 STAT 1:incr_hits 1 STAT 1:decr_hits 0 STAT 1:cas_hits 0 STAT 1:cas_badval 0 STAT 1:touch_hits 0 STAT active_slabs 1 STAT total_malloced 1048576 END 3.14 stats slabs \u00b6 \u547d\u4ee4\u7528\u4e8e\u663e\u793a\u6240\u6709item\u7684\u5927\u5c0f\u548c\u4e2a\u6570\u3002\u8be5\u4fe1\u606f\u8fd4\u56de\u4e24\u5217\uff0c\u7b2c\u4e00\u5217\u662f item \u7684\u5927\u5c0f\uff0c\u7b2c\u4e8c\u5217\u662f item \u7684\u4e2a\u6570\u3002 root@leco:/home/leco# printf \"stats sizes\\r\\n \"|nc 127.0.0.1 11211 STAT sizes_status disabled END 3.14 flush_all \u00b6 \u547d\u4ee4\u7528\u4e8e\u6e05\u7406\u7f13\u5b58\u4e2d\u7684\u6240\u6709 key=>value(\u952e=>\u503c) \u5bf9\u3002\u8be5\u547d\u4ee4\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53ef\u9009\u53c2\u6570 time\uff0c\u7528\u4e8e\u5728\u5236\u5b9a\u7684\u65f6\u95f4\u540e\u6267\u884c\u6e05\u7406\u7f13\u5b58\u64cd\u4f5c\u3002 root@leco:/home/leco# printf \"stats items\\r\\n \"|nc 127.0.0.1 11211 STAT items:1:number 6 STAT items:1:number_hot 0 STAT items:1:number_warm 2 STAT items:1:number_cold 4 STAT items:1:age_hot 0 STAT items:1:age_warm 620 STAT items:1:age 41568 STAT items:1:evicted 0 STAT items:1:evicted_nonzero 0 STAT items:1:evicted_time 0 STAT items:1:outofmemory 0 STAT items:1:tailrepairs 0 STAT items:1:reclaimed 0 STAT items:1:expired_unfetched 0 STAT items:1:evicted_unfetched 0 STAT items:1:evicted_active 0 STAT items:1:crawler_reclaimed 0 STAT items:1:crawler_items_checked 33 STAT items:1:lrutail_reflocked 0 STAT items:1:moves_to_cold 11 STAT items:1:moves_to_warm 5 STAT items:1:moves_within_lru 4 STAT items:1:direct_reclaims 0 STAT items:1:hits_to_hot 5 STAT items:1:hits_to_warm 5 STAT items:1:hits_to_cold 10 STAT items:1:hits_to_temp 0 END root@leco:/home/leco# printf \"flush_all\\r\\n \"|nc 127.0.0.1 11211 OK root@leco:/home/leco# printf \"stats items\\r\\n \"|nc 127.0.0.1 11211 END","title":"1. memcached"},{"location":"linux/nosql/memcached/memcached.index/#1","text":"Memcached\u662f\u4e00\u4e2a\u81ea\u7531\u5f00\u6e90\u7684\uff0c\u9ad8\u6027\u80fd\uff0c\u5206\u5e03\u5f0f\u5185\u5b58\u5bf9\u8c61\u7f13\u5b58\u7cfb\u7edf\u3002 emcached\u662f\u4ee5LiveJournal\u65d7\u4e0bDanga Interactive\u516c\u53f8\u7684Brad Fitzpatric\u4e3a\u9996\u5f00\u53d1\u7684\u4e00\u6b3e\u8f6f\u4ef6\u3002\u73b0\u5728\u5df2\u6210\u4e3amixi\u3001hatena\u3001Facebook\u3001Vox\u3001LiveJournal\u7b49\u4f17\u591a\u670d\u52a1\u4e2d\u63d0\u9ad8Web\u5e94\u7528\u6269\u5c55\u6027\u7684\u91cd\u8981\u56e0\u7d20\u3002 Memcached\u662f\u4e00\u79cd\u57fa\u4e8e\u5185\u5b58\u7684key-value\u5b58\u50a8\uff0c\u7528\u6765\u5b58\u50a8\u5c0f\u5757\u7684\u4efb\u610f\u6570\u636e\uff08\u5b57\u7b26\u4e32\u3001\u5bf9\u8c61\uff09\u3002\u8fd9\u4e9b\u6570\u636e\u53ef\u4ee5\u662f\u6570\u636e\u5e93\u8c03\u7528\u3001API\u8c03\u7528\u6216\u8005\u662f\u9875\u9762\u6e32\u67d3\u7684\u7ed3\u679c\u3002 Memcached\u7b80\u6d01\u800c\u5f3a\u5927\u3002\u5b83\u7684\u7b80\u6d01\u8bbe\u8ba1\u4fbf\u4e8e\u5feb\u901f\u5f00\u53d1\uff0c\u51cf\u8f7b\u5f00\u53d1\u96be\u5ea6\uff0c\u89e3\u51b3\u4e86\u5927\u6570\u636e\u91cf\u7f13\u5b58\u7684\u5f88\u591a\u95ee\u9898\u3002\u5b83\u7684API\u517c\u5bb9\u5927\u90e8\u5206\u6d41\u884c\u7684\u5f00\u53d1\u8bed\u8a00\u3002 \u672c\u8d28\u4e0a\uff0c\u5b83\u662f\u4e00\u4e2a\u7b80\u6d01\u7684key-value\u5b58\u50a8\u7cfb\u7edf\u3002\u4e00\u822c\u7684\u4f7f\u7528\u76ee\u7684\u662f\uff0c\u901a\u8fc7\u7f13\u5b58\u6570\u636e\u5e93\u67e5\u8be2\u7ed3\u679c\uff0c\u51cf\u5c11\u6570\u636e\u5e93\u8bbf\u95ee\u6b21\u6570\uff0c\u4ee5\u63d0\u9ad8\u52a8\u6001Web\u5e94\u7528\u7684\u901f\u5ea6\u3001\u63d0\u9ad8\u53ef\u6269\u5c55\u6027\u3002 Memcached \u5b98\u7f51\uff1a http://memcached.org/ \u3002 1.Memcached \u662f\u4ec0\u4e48\u3002\u4f5c\u7528\u662f\u4ec0\u4e48\uff1f Memcached \u662f\u5f00\u6e90\u7684\uff0c\u9ad8\u6027\u80fd\u7684\u5185\u5b58\u7f13\u5b58\u7cfb\u7edf\u6216\u8005\u5185\u5b58\u7f13\u5b58\u8f6f\u4ef6\u3002\u4ece\u540d\u5b57\u4e0a\u770bmem\u662f\u5185\u5b58\uff0cchache\u5c31\u662f\u7f13\u5b58\u7684\u610f\u601d\uff0cMemcached\u901a\u8fc7\u5728\u4e8b\u5148\u89c4\u5212\u597d\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\u4e34\u65f6\u7f13\u5b58\u6570\u636e\u5e93\u4e2d\u7684\u5404\u7c7b\u6570\u636e\uff0c\u4ee5\u8fbe\u5230\u51cf\u5c11\u4e1a\u52a1\u5bf9\u6570\u636e\u5e93\u7684\u76f4\u63a5\u9ad8\u5e76\u53d1\u8bbf\u95ee\uff0c\u4ece\u800c\u8fbe\u5230\u63d0\u5347\u6570\u636e\u7684\u8bbf\u95ee\u6027\u80fd\uff0c\u52a0\u901f\u7f51\u7ad9\u52a8\u6001\u5e94\u7528\u670d\u52a1\u5668\u7684\u80fd\u529b\u3002 2.Memcached \u670d\u52a1\u5728\u4f01\u4e1a\u96c6\u6743\u67b6\u6784\u4e2d\u5e94\u7528\u573a\u666f\uff1f 1\uff09 \u4f5c\u4e3a\u6570\u636e\u7684\u524d\u7aef\u7f13\u5b58\u5e94\u7528\u3002 A. \u5b8c\u6574\u7f13\u5b58\uff08\u6613\uff09 \u9759\u6001\u7f13\u5b58 \u4f8b\u5982\uff1a \u5546\u54c1\u5206\u7c7b\uff0c\u5df2\u7ecf\u5546\u54c1\u4fe1\u606f\uff0c\u53ef\u4e8b\u5148\u653e\u5230\u5185\u5b58\u91cc\uff0c\u7136\u540e\u518d\u5bf9\u5916\u63d0\u4f9b\u6570\u636e\u8bbf\u95ee\uff0c\u8fd9\u4e2a\u79f0\u4e4b\u4e3a\u9884\u70ed\uff0c\u7528\u6237\u8ba9\u95ee\u7684\u65f6\u5019\u53ef\u4ee5\u53ea\u8bfb\u53d6memcached\u7f13\u5b58\uff0c\u4e0d\u5728\u8bfb\u53d6\u6570\u636e\u5e93\u3002 B. \u70ed\u70b9\u7f13\u5b58\uff08\u96be\uff09 \u9700\u8981\u524d\u7aefweb\u7a0b\u5e8f\u7684\u914d\u5408\uff0c\u53ea\u7f13\u5b58\u70ed\u70b9\u7684\u6570\u636e\uff0c\u5373\u7f13\u5b58\u7ecf\u5e38\u88ab\u8bbf\u95ee\u7684\u6570\u636e\u3002 \u5148\u9884\u70ed\u6570\u636e\u5e93\u91cc\u7684\u57fa\u7840\u6570\u636e\uff0c\u7136\u540e\u5728\u52a8\u6001\u66f4\u65b0\uff0c\u5148\u8bfb\u53d6\u7f13\u5b58\uff0c\u5982\u679c\u7f13\u5b58\u91cc\u9762\u6ca1\u6709\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u7a0b\u5e8f\u518d\u53bb\u8bfb\u53d6\u6570\u636e\u5e93\uff0c\u7a0b\u5e8f\u7136\u540e\u628a\u8bfb\u53d6\u5230\u6570\u636e\u653e\u5165\u7f13\u5b58\u5b58\u50a8\u3002 \u7279\u6b8a\u8bf4\u660e\uff1a 1.\u5982\u679c\u78b0\u5230\u7535\u5546\u79d2\u6740\u7b49\u9ad8\u5e76\u53d1\u7684\u4e1a\u52a1\uff0c\u4e00\u5b9a\u8981\u5148\u9884\u70ed\uff0c\u6216\u8005\u5176\u4ed6\u601d\u60f3\u5b9e\u73b0\uff0c\u4f8b\u5982\uff0c\u79d2\u6740\u53ea\u662f\u83b7\u53d6\u8d44\u683c\uff0c(JS,node,js),\u800c\u4e0d\u662f\u77ac\u95f4\u79d2\u6740\u5230\u5546\u54c1\u3002 2.\u5982\u679c\u6570\u636e\u66f4\u65b0\uff0c\u540c\u65f6\u89e6\u53d1\u7f13\u5b58\u66f4\u65b0\uff0c\u9632\u6b62\u4e2a\u7528\u6237\u8fc7\u671f\u6570\u636e\u3002 C.\u5bf9\u4e8e\u6301\u4e45\u5316\u7f13\u5b58\u5b58\u50a8\u7cfb\u7edf\uff0c\u4f8b\u5982\uff1bredis\uff0c\u53ef\u4ee5\u66ff\u4ee3\u4e00\u90e8\u5206\u6570\u636e\u7684\u5b58\u50a8\uff0c\u4e00\u4e9b\u7b80\u5355\u6570\u636e\u4e1a\u52a1\uff0c\u6295\u7968\uff0c\u7edf\u8ba1\uff0c\u597d\u53cb\u5173\u6ce8\uff0c\u5546\u54c1\u5206\u7c7b\u7b49\uff0cnosql = not only sql 2\uff09\u4f5c\u4e3a\u96c6\u6743\u7684session\u4f1a\u8bdd\u5171\u4eab\u5b58\u50a8 \u5927\u89c4\u6a21\u7f51\u7ad9sesson\u4f1a\u8bdd\u4fdd\u6301\u601d\u8def\u53ca\u5b9e\u8df5\u914d\u7f6e 3.Memcached \u670d\u52a1\u5728\u4e0d\u540c\u4f01\u4e1a \u4e1a\u52a1\u5e94\u7528\u573a\u666f\u4e2d\u7684\u5de5\u4f5c\u6d41\u7a0b\uff1f 1. \u5f53web\u7a0b\u5e8f\u9700\u8981\u8bbf\u95ee\u540e\u7aef\u6570\u636e\u5e93\u83b7\u53d6\u6570\u636e\u65f6\uff0c\u4f1a\u4f18\u5148\u8bbf\u95eememcached\u5185\u5b58\u7f13\u5b58\uff0c\u5982\u679c\u7f13\u5b58\u4e2d\u6709\u6570\u636e\u5c31\u76f4\u63a5\u83b7\u53d6\u8fd4\u56de\u524d\u7aef\u670d\u52a1\u53ca\u7528\u6237\uff0c\u5982\u679c\u6ca1\u6709\u6570\u636e(\u6ca1\u6709\u547d\u4e2d)\uff0c\u5728\u7531\u7a0b\u5e8f\u8bf7\u6c42\u540e\u7aef\u7684\u6570\u636e\u5e93\u670d\u52a1\u5668\uff0c\u83b7\u53d6\u5230\u5bf9\u5e94\u7684\u6570\u636e\u540e\uff0c\u9664\u4e86\u8fd4\u56de\u7ed9\u524d\u7aef\u670d\u52a1\u53ca\u7528\u6237\u6570\u636e\u5916\uff0c\u8fd8\u4f1a\u628a\u6570\u636e\u653e\u5230memcached\u5185\u5b58\u4e2d\u8fdb\u884c\u7f13\u5b58\uff0c\u7b49\u5f85\u4e0b\u6b21\u8bf7\u6c42\u8bbf\u95ee\uff0cmemcached\u5185\u5b58\u59cb\u7ec8\u662f\u6570\u636e\u5e93\u7684\u6321\u7bad\u724c\uff0c\u4ece\u800c\u5927\u5927\u51cf\u8f7b\u6570\u636e\u5e93\u7684\u8bbf\u95ee\u538b\u529b\uff0c\u63d0\u9ad8\u6574\u4e2a\u7f51\u7ad9\u67b6\u6784\u7684\u54cd\u5e94\u901f\u5ea6\uff0c\u63d0\u5347\u7528\u6237\u4f53\u9a8c\u3002 2. \u5f53\u7a0b\u5e8f\u66f4\u65b0\uff0c\u4fee\u6539\u6216\u8005\u5220\u9664\u6570\u636e\u5e93\u4e2d\u5df2\u6709\u7684\u6570\u636e\u65f6\uff0c\u4f1a\u540c\u65f6\u53d1\u9001\u8bf7\u6c42\u901a\u77e5memcached\u5df2\u7ecf\u7f13\u5b58\u8fc7\u7684\u540c\u4e00\u4e2aID\u7684\u65e7\u6570\u636e\u5931\u6548\uff0c\u4ece\u800c\u4fdd\u8bc1memcache\u4e2d\u7684\u6570\u636e\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e00\u81f4\uff0c\u5982\u679c\u662f\u5728\u9ad8\u5e76\u53d1\u7684\u573a\u5408\uff0c\u9664\u4e86memcached\u8fc7\u671f\u7684\u7f13\u5b58\u5931\u6548\u5916\uff0c\u8fd8\u4f1a\u901a\u8fc7\u76f8\u5173\u673a\u5236\uff0c\u4f7f\u5f97\u5728\u7528\u6237\u8bbf\u95ee\u65b0\u6570\u636e\u524d\uff0c\u901a\u8fc7\u7a0b\u5e8f\u9884\u5148\u628a\u66f4\u65b0\u7684\u8fc7\u7684\u6570\u636e\u63a8\u9001\u5230memcached\u4e2d\u7f13\u5b58\u8d77\u6765\uff0c\u8fd9\u6837\u51cf\u5c11\u6570\u636e\u5e93\u7684\u538b\u529b\uff0c\u63d0\u9ad8\u547d\u4e2d\u7387\u3002 3. \u6570\u636e\u5e93\u63d2\u4ef6\u53ef\u4ee5\u518d\u5199\u5165\u66f4\u65b0\u6570\u636e\u5e93\u540e\uff0c\u81ea\u52a8\u629b\u7ed9MC\u7f13\u5b58\u8d77\u6765\uff0c\u81ea\u8eab\u4e0dcache\u3002 4.Memcached \u670d\u52a1\u5206\u5e03\u5f0f\u96c6\u7fa4\u5982\u4f55\u5b9e\u73b0\uff1f \u7279\u6b8a\u8bf4\u660e\uff1bmemcached\u96c6\u7fa4\u548cweb\u670d\u52a1\u96c6\u7fa4\u662f\u4e0d\u4e00\u6837\u7684\u3002\u6240\u6709memcached\u6570\u636e\u7684\u603b\u548c \u624d\u662f\u6570\u636e\u5e93\u7684\u6570\u636e\u3002 A. \u7a0b\u5e8f\u6bb5\u5b9e\u73b0 \u7a0b\u5e8f\u52a0\u8f7d\u6240\u6709memcached\u7684ip\u5217\u8868\uff0c\u901a\u8fc7key\u505ahash\uff08\u4e00\u81f4\u6027\u54c8\u5e0c\uff0c\u76ee\u7684\u662f\u4fdd\u8bc1\u4e00\u4e2a\u8282\u70b9\u5b95\u673a\u540e\u6570\u636e\u66f4\u65b0\u6700\u4f4e\uff09\uff0c\u6bcf\u5929memcached\u90fd\u662f\u90e8\u5206\u6570\u636e B. \u8d1f\u8f7d\u5747\u8861\u5668 \u901a\u8fc7\u5bf9key\u505ahash\uff08\u4e00\u81f4\u6027hash\uff09 \u4e00\u81f4\u6027hash\u7684\u7b97\u6cd5\u7684\u76ee\u7684\u662f\u4e0d\u4f46\u4fdd\u8bc1\u6bcf\u4e2a\u5bf9\u8c61\u53ea\u8bfb\u6c42\u4e00\u4e2a\u5bf9\u5e94\u7684\u670d\u52a1\u5668\uff0c\u800c\u4e14\u5f53\u8282\u70b9\u5b95\u673a\u540e\u7f13\u5b58\u670d\u52a1\u5668\u7684\u66f4\u65b0\u91cd\u65b0\u5206\u914d\u6bd4\u4f8b\u964d\u5230\u6700\u4f4e\u3002 http://blog.csdn.net/cutesource/article/details/5848253 5.Memcached \u670d\u52a1\u7279\u70b9\u53ca\u5de5\u4f5c\u539f\u7406\u662f\u4ec0\u4e48\uff1f A. \u5168\u90e8\u6570\u636e\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u65e0\u6301\u4e45\u6027\u5b58\u50a8\u8bbe\u7f6e\uff0c\u91cd\u542f\u670d\u52a1\u6570\u636e\u5c31\u4e22\u5931 B. \u8282\u70b9\u4e4b\u95f4\u76f8\u4e92\u72ec\u7acb C. \u5f02\u6b65I/O \u6a21\u578b\uff0c\u57fa\u4e8elibevent\u6a21\u578b\u7684\u4e8b\u4ef6\u901a\u77e5\u673a\u5236 D. \u6570\u636e\u662f\u4ee5Key/value\u952e\u503c\u5bf9\u5f62\u5f0f\u5b58\u5728\u7684 E. C/S\u6a21\u5f0f\u67b6\u6784\uff0cc\u8bed\u8a00\u7f16\u5199\uff0c\u603b\u4ee3\u78012000\u591a\u884c F. \u5f53\u5185\u5b58\u7f13\u5b58\u7684\u6570\u636e\u5bb9\u91cf\u8fbe\u5230\u542f\u52a8\u65f6\u5019\u9884\u8bbe\u5b9a\u7684\u5185\u5b58\u503c\u65f6\u5019\uff0c\u5c31\u81ea\u52a8\u4f7f\u7528LRU\u7b97\u6cd5\u6e05\u9664\u8fc7\u671f\u7684\u7f13\u5b58\u6570\u636e G. \u53ef\u4ee5\u5bf9\u6751\u587e\u7684\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u6837\u8fc7\u671f\u540e\u7684\u6570\u636e\u81ea\u52a8\u88ab\u6e05\u9664\uff0c\u670d\u52a1\u672c\u8eab\u4e0d\u4f1a\u88ab\u76d1\u63a7\u8fc7\u671f\uff0c\u800c\u662f\u5728\u8bbf\u95ee\u7684\u65f6\u5019\u67e5\u770bkey\u7684\u65f6\u95f4\u6233\u5224\u65ad\u662f\u5426\u8fc7\u671f\u3002 H. Memcache\u5185\u5b58\u5206\u914d\u673a\u5668\u662f\u5bf9\u7279\u5b9a\u7684\u5185\u5b58\u8fdb\u884c\u5206\u5757\uff0c\u518d\u628a\u591a\u4e2a\u5757\u5206\u4e3a\u4e00\u7ec4\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/memcached/memcached.index/#2","text":"","title":"2. \u5b89\u88c5\u6d4b\u8bd5"},{"location":"linux/nosql/memcached/memcached.index/#21","text":"wget http://www.memcached.org/files/memcached-1.5.12.tar.gz tar xf memcached-1.5.12.tar.gz cd memcached-1.5.12 ./configure --prefix=/usr/local/memcached make && sudo make install echo $? \u64cd\u4f5c\u8fc7\u7a0b root@leco:/usr/local/src# wget http://www.memcached.org/files/memcached-1.5.12.tar.gz --2019-02-20 09:55:44-- http://www.memcached.org/files/memcached-1.5.12.tar.gz \u6b63\u5728\u89e3\u6790\u4e3b\u673a www.memcached.org (www.memcached.org)... 107.170.231.145 \u6b63\u5728\u8fde\u63a5 www.memcached.org (www.memcached.org)|107.170.231.145|:80... \u5df2\u8fde\u63a5\u3002 \u7701\u7565\u3002\u3002\u3002 root@leco:/usr/local/src# ls memcached-1.5.12.tar.gz memcached-1.5.12.tar.gz root@leco:/usr/local/src# tar xf memcached-1.5.12.tar.gz root@leco:/usr/local/src# cd memcached-1.5.12 root@leco:/usr/local/src/memcached-1.5.12# ./configure --prefix=/usr/local/memcached root@leco:/usr/local/src/memcached-1.5.12# make && sudo make install root@leco:/usr/local/src/memcached-1.5.12# echo $? 0 # \u6dfb\u52a0\u73af\u5883\u53d8\u91cf root@leco:/usr/local/src/memcached-1.5.12# vim /etc/profile root@leco:/usr/local/src/memcached-1.5.12# tail -1 /etc/profile export PATH=$PATH:/usr/local/memcached/bin root@leco:/usr/local/src/memcached-1.5.12# source /etc/profile \u4ee5\u4e0a\u662f\u6e90\u7801\u5305\u5b89\u88c5\uff0c\u53ef\u4ee5\u5b89\u88c5\u6700\u65b0\u7248\u672c\u7684\uff0c\u8981\u662f\u5728\u7ebf\u5b89\u88c5\uff0c\u90fd\u662f\u57fa\u4e8e\u7cfb\u7edf\u6e90\u5b89\u88c5\u7684\u3002\u63a8\u8350\u6e90\u7801\u5b89\u88c5","title":"2.1 \u5b89\u88c5"},{"location":"linux/nosql/memcached/memcached.index/#22","text":"root@leco:~# memcached -d -m 10 -u root -l 0.0.0.0 -p 11211 -c 256 -P /tmp/memcached.pid root@leco:~# netstat -lnp|grep 11211 tcp 0 0 0.0.0.0:11211 0.0.0.0:* LISTEN 7862/memcached unix 2 [ ACC ] \u6d41 LISTENING 100911211 11507/unity-files-d @leco-com.canonical.Unity.Scope.files.T5294429510698002 root@leco:~# telnet localhost 11211 Trying 127.0.0.1... Connected to localhost. Escape character is '^]'. \u5982\u679c\u51fa\u73b0\u4ee5\u4e0a\u5185\u5bb9\u5c31\u4ee3\u8868\u542f\u52a8\u6210\u529f\uff01 \u53c2\u6570\u8bf4\u660e -d |\u662f\u542f\u52a8\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b -m |\u662f\u5206\u914d\u7ed9Memcache\u4f7f\u7528\u7684\u5185\u5b58\u6570\u91cf\uff0c\u5355\u4f4d\u662fMB -u |\u662f\u8fd0\u884cMemcache\u7684\u7528\u6237 -l |\u662f\u76d1\u542c\u7684\u670d\u52a1\u5668IP\u5730\u5740 -p |\u662f\u8bbe\u7f6eMemcache\u76d1\u542c\u7684\u7aef\u53e3,\u6700\u597d\u662f1024\u4ee5\u4e0a\u7684\u7aef\u53e3 -c |\u9009\u9879\u662f\u6700\u5927\u8fd0\u884c\u7684\u5e76\u53d1\u8fde\u63a5\u6570\uff0c\u9ed8\u8ba4\u662f1024\uff0c\u6309\u7167\u4f60\u670d\u52a1\u5668\u7684\u8d1f\u8f7d\u91cf\u6765\u8bbe\u5b9a -P |\u662f\u8bbe\u7f6e\u4fdd\u5b58Memcache\u7684pid\u6587\u4ef6","title":"2.2 \u542f\u52a8"},{"location":"linux/nosql/memcached/memcached.index/#23","text":"echo 'memcached -d -m 10 -u root -l 0.0.0.0 -p 11211 -c 256 -P /tmp/memcached.pid' >> /etc/rc.local","title":"2.3 \u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\u52a8"},{"location":"linux/nosql/memcached/memcached.index/#3","text":"\u8bed\u6cd5 command_name key flags exptime bytes value \\r\\n \u53c2\u6570\u89e3\u91ca command_name \u662f set add replace get delete key key \u7528\u4e8e\u67e5\u627e\u7f13\u5b58\u503c flags \u53ef\u4ee5\u5305\u62ec\u952e\u503c\u5bf9\u7684\u6574\u578b\u53c2\u6570\uff0c\u5ba2\u6237\u673a\u4f7f\u7528\u5b83\u5b58\u50a8\u5173\u4e8e\u952e\u503c\u5bf9\u7684\u989d\u5916\u4fe1\u606f expiration time \u5728\u7f13\u5b58\u4e2d\u4fdd\u5b58\u952e\u503c\u5bf9\u7684\u65f6\u95f4\u957f\u5ea6\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0c 0 \u8868\u793a\u6c38\u8fdc\uff09 bytes \u5728\u7f13\u5b58\u4e2d\u5b58\u50a8\u7684\u5b57\u8282\u70b9 value \u5b58\u50a8\u7684\u503c\uff08\u59cb\u7ec8\u4f4d\u4e8e\u7b2c\u4e8c\u884c\uff09 set \u5b58\u50a8\u6b21\u6570\u636e add \u5b58\u50a8\u6b21\u6570\u636e\uff0c\u53ea\u5728\u670d\u52a1\u5668\u672a\u4fdd\u5b58\u6b64\u952e\u503c\u7684\u6570\u636e\u65f6 \u53c2\u6570 \u8bf4\u660e command set\u65e0\u8bba\u5982\u4f55\u90fd\u8fdb\u884c\u5b58\u50a8\uff0cadd\u53ea\u6709\u6570\u636e\u4e0d\u5b58\u5728\u65f6\u8fdb\u884c\u6dfb\u52a0 key \u5b58\u50a8\u7684key\u7684\u540d\u5b57\uff0c\u957f\u5ea6\u6700\u591a\u4e3a250\u4e2a\u5b57\u7b26\uff0c\u4e0d\u5305\u542b\u7a7a\u683c\u548c\u63a7\u5236\u5b57\u7b26 flags \u662f\u4e00\u4e2a16\u4f4d\u7684\u65e0\u7b26\u53f7\u7684\u6574\u6570(\u4ee5\u5341\u8fdb\u5236\u7684\u65b9\u5f0f\u8868\u793a)\u3002\u8be5\u6807\u5fd7\u5c06\u548c\u9700\u8981\u5b58\u50a8\u7684\u6570\u636e\u4e00\u8d77\u5b58\u50a8,\u5e76\u5728\u5ba2\u6237\u7aefget\u6570\u636e\u65f6\u8fd4\u56de exptime \u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2\uff0c0\u4e3a\u6c38\u8fdc\uff0c\u8868\u793a\u7528\u4e0d\u8fc7\u671f\uff0c<30\u592960*60*24*30\u4e3a\u79d2\u6570\uff0c>30\u5929\u4e3aunixtime\u65f6\u95f4\u6233 bytes byte\u5b57\u8282\u6570\uff0c\u4e0d\u5305\u542b\\r\\n\uff0c\u6839\u636e\u957f\u5ea6\u622a\u53d6\u5b58/\u53d6\u7684\u5b57\u7b26\u4e32\uff0c\u53ef\u4ee5\u662f0\uff0c\u5373\u5b58\u7a7a\u4e32 version \u7248\u672c\u53f7\uff0c\u53ef\u9009\u7684\uff0c\u53ef\u4e0d\u5199\uff0c\u8fd9\u4e2a\u5b57\u65ad\u4e3b\u8981\u662f\u7ed9cas\u547d\u4ee4\u7528 datablock \u50a8\u5b58\u7684\u5185\u5bb9value\uff0c\u4ee5\\r\\n\u7ed3\u5c3e\uff0c\u5f53\u7136\u53ef\u4ee5\u5305\u542b\\r\u6216\\n status STORED/NOT_STORED/EXISTS/NOT_FOUND/ERROR/CLIENT_ERROR/SERVER_ERROR\u670d\u52a1\u7aef\u8fd4\u56de\u7684\u72b6\u6001\u6807\u5fd7","title":"3. \u547d\u4ee4"},{"location":"linux/nosql/memcached/memcached.index/#31-set","text":"Memcached set \u547d\u4ee4\u7528\u4e8e\u5c06 value(\u6570\u636e\u503c) \u5b58\u50a8\u5728\u6307\u5b9a\u7684 key(\u952e) \u4e2d\u3002 set \u547d\u4ee4\u7528\u4e8e\u5411\u7f13\u5b58\u6dfb\u52a0\u65b0\u7684\u952e\u503c\u5bf9\u3002\u5982\u679c\u952e\u5df2\u7ecf\u5b58\u5728\uff0c\u5219\u4e4b\u524d\u7684\u503c\u5c06\u88ab\u66ff\u6362\u3002 \u5b58\u50a8cmz(key)\u8fd9\u4e2a\u952e\uff0c\u503c\u662fcaimengzhi\uff0810\u4e2a\u5b57\u7b26\uff09\uff0c\u5426\u4ed6\u6dfb\u52a0\u4e0d\u6210\u529f root@leco:/home/leco# printf \"set cmz 0 0 10\\r\\ncaimengzhi\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get cmz\\r\\n\"|nc 127.0.0.1 11211 VALUE cmz 0 10 caimengzhi END \u4ee5\u4e0b\u662f\u5b58\u50a8\u7684\u5b57\u7b26\u4e0d\u5bf9\u7684\u9519\u8bef\u60c5\u51b5 root@leco:/home/leco# printf \"set cmz1 0 0 10\\r\\nccc\\r\\n \"|nc 127.0.0.1 11211 root@leco:/home/leco# printf \"get cmz1\\r\\n\"|nc 127.0.0.1 11211 END \u5982\u679c\u4f7f\u7528 set \u547d\u4ee4\u6b63\u786e\u8bbe\u5b9a\u4e86\u952e\u503c\u5bf9\uff0c\u670d\u52a1\u5668\u5c06\u4f7f\u7528\u5355\u8bcd STORED \u8fdb\u884c\u54cd\u5e94\u3002\u672c\u793a\u4f8b\u5411\u7f13\u5b58\u4e2d\u6dfb\u52a0\u4e86\u4e00\u4e2a\u952e\u503c\u5bf9\uff0ccmz\uff0c\u5176\u503c\u4e3acaimengzhi\u3002\u5e76\u5c06\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a 0\uff0c\u8fd9\u5c06\u5411 memcached \u901a\u77e5\u60a8\u5e0c\u671b\u5c06\u6b64\u503c\u5b58\u50a8\u5728\u7f13\u5b58\u4e2d\u76f4\u5230\u5220\u9664\u5b83\u4e3a\u6b62\u3002","title":"3.1 set"},{"location":"linux/nosql/memcached/memcached.index/#32-add","text":"\u4ec5\u5f53\u7f13\u5b58\u4e2d\u4e0d\u5b58\u5728\u952e\u65f6\uff0cadd \u547d\u4ee4\u624d\u4f1a\u5411\u7f13\u5b58\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u952e\u503c\u5bf9\u3002\u5982\u679c\u7f13\u5b58\u4e2d\u5df2\u7ecf\u5b58\u5728\u952e\uff0c\u5219\u4e4b\u524d\u7684\u503c\u5c06\u4ecd\u7136\u4fdd\u6301\u76f8\u540c\uff0c\u5e76\u4e14\u60a8\u5c06\u83b7\u5f97\u54cd\u5e94 NOT_STORED\u3002 root@leco:/home/leco# printf \"add cmz 0 0 10\\r\\ncaimengzhi\\r\\n \"|nc 127.0.0.1 11211 # \u56e0\u4e3a\u4e4b\u524d\u8bbe\u7f6e\u4e86\uff0c\u6240\u4ee5\u4e0d\u5728\u5b58\u50a8 NOT_STORED root@leco:/home/leco# printf \"add cmz1 0 0 10\\r\\ncaimengzhi\\r\\n \"|nc 127.0.0.1 11211 STORED","title":"3.2 add"},{"location":"linux/nosql/memcached/memcached.index/#33-replace","text":"\u4ec5\u5f53\u952e\u5df2\u7ecf\u5b58\u5728\u65f6\uff0creplace \u547d\u4ee4\u624d\u4f1a\u66ff\u6362\u7f13\u5b58\u4e2d\u7684\u952e\u3002\u5982\u679c\u7f13\u5b58\u4e2d\u4e0d\u5b58\u5728\u952e\uff0c\u90a3\u4e48\u60a8\u5c06\u4ece memcached \u670d\u52a1\u5668\u63a5\u53d7\u5230\u4e00\u6761 NOT_STORED \u54cd\u5e94\u3002 oot@leco:/home/leco# printf \"replace cmz1 0 0 10\\r\\nxaimengzhi\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get cmz1\\r\\n \"|nc 127.0.0.1 11211 VALUE cmz1 0 10 xaimengzhi END","title":"3.3 replace"},{"location":"linux/nosql/memcached/memcached.index/#34-append","text":"\u547d\u4ee4\u7528\u4e8e\u5411\u5df2\u5b58\u5728 key(\u952e) \u7684 value(\u6570\u636e\u503c) \u540e\u9762\u8ffd\u52a0\u6570\u636e\u3002 \u9996\u5148\u6211\u4eec\u5728 Memcached \u4e2d\u5b58\u50a8\u4e00\u4e2a\u952e nosql\uff0c\u5176\u503c\u4e3a memcached\u3002 \u7136\u540e\uff0c\u6211\u4eec\u4f7f\u7528 get \u547d\u4ee4\u68c0\u7d22\u8be5\u503c\u3002 \u7136\u540e\uff0c\u6211\u4eec\u4f7f\u7528 append \u547d\u4ee4\u5728\u952e\u4e3a nosql \u7684\u503c\u540e\u9762\u8ffd\u52a0 \"redis\"\u3002 \u6700\u540e\uff0c\u6211\u4eec\u518d\u4f7f\u7528 get \u547d\u4ee4\u68c0\u7d22\u8be5\u503c\u3002 root@leco:/home/leco# printf \"set nosql 0 0 9\\r\\nmemcached\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get nosql\\r\\n \"|nc 127.0.0.1 11211 VALUE nosql 0 9 memcached END root@leco:/home/leco# printf \"append nosql 0 0 5\\r\\nredis\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get nosql\\r\\n \"|nc 127.0.0.1 11211 VALUE nosql 0 14 memcachedredis END","title":"3.4 append"},{"location":"linux/nosql/memcached/memcached.index/#35-prepend","text":"\u547d\u4ee4\u7528\u4e8e\u5411\u5df2\u5b58\u5728 key(\u952e) \u7684 value(\u6570\u636e\u503c) \u524d\u9762\u8ffd\u52a0\u6570\u636e \u3002 root@leco:/home/leco# printf \"set nosql2 0 0 9\\r\\nmemcached\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get nosql2\\r\\n \"|nc 127.0.0.1 11211 VALUE nosql2 0 9 memcached END root@leco:/home/leco# printf \"prepend nosql2 0 0 6\\r\\nredis_\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get nosql2\\r\\n \"|nc 127.0.0.1 11211 VALUE nosql2 0 15 redis_memcached END","title":"3.5 prepend"},{"location":"linux/nosql/memcached/memcached.index/#36-cas","text":"","title":"3.6 CAS"},{"location":"linux/nosql/memcached/memcached.index/#37-get","text":"\u83b7\u53d6\u5b58\u50a8\u5728 key(\u952e) \u4e2d\u7684 value(\u6570\u636e\u503c) \uff0c\u5982\u679c key \u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56de\u7a7a\u3002 root@leco:/home/leco# printf \"get nosql2\\r\\n \"|nc 127.0.0.1 11211 VALUE nosql2 0 15 redis_memcached END","title":"3.7 get"},{"location":"linux/nosql/memcached/memcached.index/#38-gets","text":"\u83b7\u53d6\u5e26\u6709 CAS \u4ee4\u724c\u5b58 \u7684 value(\u6570\u636e\u503c) \uff0c\u5982\u679c key \u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56de\u7a7a root@leco:/home/leco# printf \"gets nosql\\r\\n \"|nc 127.0.0.1 11211 VALUE nosql 0 20 7 _name_memcachedredis END","title":"3.8 gets"},{"location":"linux/nosql/memcached/memcached.index/#39-delete","text":"\u547d\u4ee4\u7528\u4e8e\u5220\u9664\u5df2\u5b58\u5728\u7684 key(\u952e)\u3002 root@leco:/home/leco# printf \"delete nosql1\\r\\n \"|nc 127.0.0.1 11211 DELETED root@leco:/home/leco# printf \"gets nosql1\\r\\n \"|nc 127.0.0.1 11211 END root@leco:/home/leco# printf \"delete nosql1\\r\\n \"|nc 127.0.0.1 11211 NOT_FOUND \u5220\u9664\u4e0d\u5b58\u5728\u7684key\uff0c\u5c31\u8f93\u51faNOT_FOUND - DELETED\uff1a\u5220\u9664\u6210\u529f\u3002 - ERROR\uff1a\u8bed\u6cd5\u9519\u8bef\u6216\u5220\u9664\u5931\u8d25\u3002 - NOT_FOUND\uff1akey \u4e0d\u5b58\u5728","title":"3.9 delete"},{"location":"linux/nosql/memcached/memcached.index/#310-incrdecr","text":"incr \u4e0e decr \u547d\u4ee4\u7528\u4e8e\u5bf9\u5df2\u5b58\u5728\u7684 key(\u952e) \u7684\u6570\u5b57\u503c\u8fdb\u884c\u81ea\u589e\u6216\u81ea\u51cf\u64cd\u4f5c\u3002incr \u4e0e decr \u547d\u4ee4\u64cd\u4f5c\u7684\u6570\u636e\u5fc5\u987b\u662f\u5341\u8fdb\u5236\u768432\u4f4d\u65e0\u7b26\u53f7\u6574\u6570\u3002\u5982\u679c key \u4e0d\u5b58\u5728\u8fd4\u56de NOT_FOUND \uff0c\u5982\u679c\u952e\u7684\u503c\u4e0d\u4e3a\u6570\u5b57\uff0c\u5219\u8fd4\u56de CLIENT_ERROR \uff0c\u5176\u4ed6\u9519\u8bef\u8fd4\u56de ERROR\u3002 root@leco:/home/leco# printf \"set num 0 0 2\\r\\n20\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get num\\r\\n \"|nc 127.0.0.1 11211 VALUE num 0 2 20 END root@leco:/home/leco# printf \"incr num 5\\r\\n \"|nc 127.0.0.1 11211 25 root@leco:/home/leco# printf \"get num\\r\\n \"|nc 127.0.0.1 11211 VALUE num 0 2 25 END root@leco:/home/leco# printf \"set num2 0 0 2\\r\\n20\\r\\n \"|nc 127.0.0.1 11211 STORED root@leco:/home/leco# printf \"get num2\\r\\n \"|nc 127.0.0.1 11211 VALUE num2 0 2 20 END root@leco:/home/leco# printf \"decr num2 5\\r\\n \"|nc 127.0.0.1 11211 15 root@leco:/home/leco# printf \"get num2\\r\\n \"|nc 127.0.0.1 11211 VALUE num2 0 2 15 END","title":"3.10 incr/decr"},{"location":"linux/nosql/memcached/memcached.index/#311-stas","text":"\u547d\u4ee4\u7528\u4e8e\u8fd4\u56de\u7edf\u8ba1\u4fe1\u606f\u4f8b\u5982 PID(\u8fdb\u7a0b\u53f7)\u3001\u7248\u672c\u53f7\u3001\u8fde\u63a5\u6570\u7b49\u3002 root@leco:/home/leco# printf \"stats\\r\\n \"|nc 127.0.0.1 11211 STAT pid 5991 STAT uptime 41934 STAT time 1552356261 STAT version 1.5.12 STAT libevent 2.0.21-stable STAT pointer_size 64 STAT rusage_user 3.891261 STAT rusage_system 2.563143 STAT max_connections 256 STAT curr_connections 1 STAT total_connections 60 STAT rejected_connections 0 STAT connection_structures 2 STAT reserved_fds 20 STAT cmd_get 28 STAT cmd_set 17 STAT cmd_flush 0 STAT cmd_touch 0 STAT get_hits 20 STAT get_misses 8 STAT get_expired 0 STAT get_flushed 0 STAT delete_misses 1 STAT delete_hits 1 STAT incr_misses 0 STAT incr_hits 1 STAT decr_misses 0 STAT decr_hits 0 STAT cas_misses 0 STAT cas_hits 0 STAT cas_badval 0 STAT touch_hits 0 STAT touch_misses 0 STAT auth_cmds 0 STAT auth_errors 0 STAT bytes_read 1117 STAT bytes_written 3057 STAT limit_maxbytes 10485760 STAT accepting_conns 1 STAT listen_disabled_num 0 STAT time_in_listen_disabled_us 0 STAT threads 4 STAT conn_yields 0 STAT hash_power_level 16 STAT hash_bytes 524288 STAT hash_is_expanding 0 STAT slab_reassign_rescues 0 STAT slab_reassign_chunk_rescues 0 STAT slab_reassign_evictions_nomem 0 STAT slab_reassign_inline_reclaim 0 STAT slab_reassign_busy_items 0 STAT slab_reassign_busy_deletes 0 STAT slab_reassign_running 0 STAT slabs_moved 0 STAT lru_crawler_running 0 STAT lru_crawler_starts 9435 STAT lru_maintainer_juggles 83272 STAT malloc_fails 0 STAT log_worker_dropped 0 STAT log_worker_written 0 STAT log_watcher_skipped 0 STAT log_watcher_sent 0 STAT bytes 438 STAT curr_items 6 STAT total_items 12 STAT slab_global_page_pool 0 STAT expired_unfetched 0 STAT evicted_unfetched 0 STAT evicted_active 0 STAT evictions 0 STAT reclaimed 0 STAT crawler_reclaimed 0 STAT crawler_items_checked 33 STAT lrutail_reflocked 0 STAT moves_to_cold 11 STAT moves_to_warm 5 STAT moves_within_lru 4 STAT direct_reclaims 0 STAT lru_bumps_dropped 0 END \u540d\u8bcd\u89e3\u91ca pid \uff1a memcache\u670d\u52a1\u5668\u8fdb\u7a0bID uptime \uff1a\u670d\u52a1\u5668\u5df2\u8fd0\u884c\u79d2\u6570 time \uff1a\u670d\u52a1\u5668\u5f53\u524d Unix\u65f6\u95f4\u6233 version \uff1a memcache\u7248\u672c pointer_size \uff1a\u64cd\u4f5c\u7cfb\u7edf\u6307\u9488\u5927\u5c0f rusage_user \uff1a\u8fdb\u7a0b\u7d2f\u8ba1\u7528\u6237\u65f6\u95f4 rusage_system \uff1a\u8fdb\u7a0b\u7d2f\u8ba1\u7cfb\u7edf\u65f6\u95f4 curr_connections \uff1a\u5f53\u524d\u8fde\u63a5\u6570\u91cf total_connections \uff1a Memcached\u8fd0\u884c\u4ee5\u6765\u8fde\u63a5\u603b\u6570 connection_structures \uff1a Memcached\u5206\u914d\u7684\u8fde\u63a5\u7ed3\u6784\u6570\u91cf cmd_get \uff1a get\u547d\u4ee4\u8bf7\u6c42\u6b21\u6570 cmd_set \uff1a set\u547d\u4ee4\u8bf7\u6c42\u6b21\u6570 cmd_flush \uff1a flush\u547d\u4ee4\u8bf7\u6c42\u6b21\u6570 get_hits \uff1a get\u547d\u4ee4\u547d\u4e2d\u6b21\u6570 get_misses \uff1a get\u547d\u4ee4\u672a\u547d\u4e2d\u6b21\u6570 delete_misses \uff1a delete\u547d\u4ee4\u672a\u547d\u4e2d\u6b21\u6570 delete_hits \uff1a delete\u547d\u4ee4\u547d\u4e2d\u6b21\u6570 incr_misses \uff1a incr\u547d\u4ee4\u672a\u547d\u4e2d\u6b21\u6570 incr_hits \uff1a incr\u547d\u4ee4\u547d\u4e2d\u6b21\u6570 decr_misses \uff1a decr\u547d\u4ee4\u672a\u547d\u4e2d\u6b21\u6570 decr_hits \uff1a decr\u547d\u4ee4\u547d\u4e2d\u6b21\u6570 cas_misses \uff1a cas\u547d\u4ee4\u672a\u547d\u4e2d\u6b21\u6570 cas_hits \uff1a cas\u547d\u4ee4\u547d\u4e2d\u6b21\u6570 cas_badval \uff1a\u4f7f\u7528\u64e6\u62ed\u6b21\u6570 auth_cmds \uff1a\u8ba4\u8bc1\u547d\u4ee4\u5904\u7406\u7684\u6b21\u6570 auth_errors \uff1a\u8ba4\u8bc1\u5931\u8d25\u6570\u76ee bytes_read \uff1a\u8bfb\u53d6\u603b\u5b57\u8282\u6570 bytes_written \uff1a\u53d1\u9001\u603b\u5b57\u8282\u6570 limit_maxbytes \uff1a\u5206\u914d\u7684\u5185\u5b58\u603b\u5927\u5c0f\uff08\u5b57\u8282\uff09 accepting_conns \uff1a\u670d\u52a1\u5668\u662f\u5426\u8fbe\u5230\u8fc7\u6700\u5927\u8fde\u63a5\uff08 0 / 1 \uff09 listen_disabled_num \uff1a\u5931\u6548\u7684\u76d1\u542c\u6570 threads \uff1a\u5f53\u524d\u7ebf\u7a0b\u6570 conn_yields \uff1a\u8fde\u63a5\u64cd\u4f5c\u4e3b\u52a8\u653e\u5f03\u6570\u76ee bytes \uff1a\u5f53\u524d\u5b58\u50a8\u5360\u7528\u7684\u5b57\u8282\u6570 curr_items \uff1a\u5f53\u524d\u5b58\u50a8\u7684\u6570\u636e\u603b\u6570 total_items \uff1a\u542f\u52a8\u4ee5\u6765\u5b58\u50a8\u7684\u6570\u636e\u603b\u6570 evictions \uff1a LRU\u91ca\u653e\u7684\u5bf9\u8c61\u6570\u76ee reclaimed \uff1a\u5df2\u8fc7\u671f\u7684\u6570\u636e\u6761\u76ee\u6765\u5b58\u50a8\u65b0\u6570\u636e\u7684\u6570\u76ee","title":"3.11 stas"},{"location":"linux/nosql/memcached/memcached.index/#312-stas-items","text":"\u547d\u4ee4\u7528\u4e8e\u663e\u793a\u5404\u4e2a slab \u4e2d item \u7684\u6570\u76ee\u548c\u5b58\u50a8\u65f6\u957f(\u6700\u540e\u4e00\u6b21\u8bbf\u95ee\u8ddd\u79bb\u73b0\u5728\u7684\u79d2\u6570)\u3002 root@leco:/home/leco# printf \"stats items\\r\\n \"|nc 127.0.0.1 11211 STAT items:1:number 6 STAT items:1:number_hot 0 STAT items:1:number_warm 2 STAT items:1:number_cold 4 STAT items:1:age_hot 0 STAT items:1:age_warm 463 STAT items:1:age 41411 STAT items:1:evicted 0 STAT items:1:evicted_nonzero 0 STAT items:1:evicted_time 0 STAT items:1:outofmemory 0 STAT items:1:tailrepairs 0 STAT items:1:reclaimed 0 STAT items:1:expired_unfetched 0 STAT items:1:evicted_unfetched 0 STAT items:1:evicted_active 0 STAT items:1:crawler_reclaimed 0 STAT items:1:crawler_items_checked 33 STAT items:1:lrutail_reflocked 0 STAT items:1:moves_to_cold 11 STAT items:1:moves_to_warm 5 STAT items:1:moves_within_lru 4 STAT items:1:direct_reclaims 0 STAT items:1:hits_to_hot 5 STAT items:1:hits_to_warm 5 STAT items:1:hits_to_cold 10 STAT items:1:hits_to_temp 0 END","title":"3.12 stas items"},{"location":"linux/nosql/memcached/memcached.index/#313-stats-sizes","text":"\u7528\u4e8e\u663e\u793a\u5404\u4e2aslab\u7684\u4fe1\u606f\uff0c\u5305\u62ecchunk\u7684\u5927\u5c0f\u3001\u6570\u76ee\u3001\u4f7f\u7528\u60c5\u51b5\u7b49\u3002 root@leco:/home/leco# printf \"stats slabs\\r\\n \"|nc 127.0.0.1 11211 STAT 1:chunk_size 96 STAT 1:chunks_per_page 10922 STAT 1:total_pages 1 STAT 1:total_chunks 10922 STAT 1:used_chunks 6 STAT 1:free_chunks 10916 STAT 1:free_chunks_end 0 STAT 1:mem_requested 438 STAT 1:get_hits 20 STAT 1:cmd_set 17 STAT 1:delete_hits 1 STAT 1:incr_hits 1 STAT 1:decr_hits 0 STAT 1:cas_hits 0 STAT 1:cas_badval 0 STAT 1:touch_hits 0 STAT active_slabs 1 STAT total_malloced 1048576 END","title":"3.13 stats sizes"},{"location":"linux/nosql/memcached/memcached.index/#314-stats-slabs","text":"\u547d\u4ee4\u7528\u4e8e\u663e\u793a\u6240\u6709item\u7684\u5927\u5c0f\u548c\u4e2a\u6570\u3002\u8be5\u4fe1\u606f\u8fd4\u56de\u4e24\u5217\uff0c\u7b2c\u4e00\u5217\u662f item \u7684\u5927\u5c0f\uff0c\u7b2c\u4e8c\u5217\u662f item \u7684\u4e2a\u6570\u3002 root@leco:/home/leco# printf \"stats sizes\\r\\n \"|nc 127.0.0.1 11211 STAT sizes_status disabled END","title":"3.14 stats slabs"},{"location":"linux/nosql/memcached/memcached.index/#314-flush_all","text":"\u547d\u4ee4\u7528\u4e8e\u6e05\u7406\u7f13\u5b58\u4e2d\u7684\u6240\u6709 key=>value(\u952e=>\u503c) \u5bf9\u3002\u8be5\u547d\u4ee4\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53ef\u9009\u53c2\u6570 time\uff0c\u7528\u4e8e\u5728\u5236\u5b9a\u7684\u65f6\u95f4\u540e\u6267\u884c\u6e05\u7406\u7f13\u5b58\u64cd\u4f5c\u3002 root@leco:/home/leco# printf \"stats items\\r\\n \"|nc 127.0.0.1 11211 STAT items:1:number 6 STAT items:1:number_hot 0 STAT items:1:number_warm 2 STAT items:1:number_cold 4 STAT items:1:age_hot 0 STAT items:1:age_warm 620 STAT items:1:age 41568 STAT items:1:evicted 0 STAT items:1:evicted_nonzero 0 STAT items:1:evicted_time 0 STAT items:1:outofmemory 0 STAT items:1:tailrepairs 0 STAT items:1:reclaimed 0 STAT items:1:expired_unfetched 0 STAT items:1:evicted_unfetched 0 STAT items:1:evicted_active 0 STAT items:1:crawler_reclaimed 0 STAT items:1:crawler_items_checked 33 STAT items:1:lrutail_reflocked 0 STAT items:1:moves_to_cold 11 STAT items:1:moves_to_warm 5 STAT items:1:moves_within_lru 4 STAT items:1:direct_reclaims 0 STAT items:1:hits_to_hot 5 STAT items:1:hits_to_warm 5 STAT items:1:hits_to_cold 10 STAT items:1:hits_to_temp 0 END root@leco:/home/leco# printf \"flush_all\\r\\n \"|nc 127.0.0.1 11211 OK root@leco:/home/leco# printf \"stats items\\r\\n \"|nc 127.0.0.1 11211 END","title":"3.14 flush_all"},{"location":"linux/nosql/mongo/mongo.backup_recovery/","text":"MongoDB \u5907\u4efd\u4e0e\u6062\u590d 1. \u4ecb\u7ecd \u00b6 \u5728Mongodb\u4e2d\u6211\u4eec\u4f7f\u7528mongodump\u547d\u4ee4\u6765\u5907\u4efdMongoDB\u6570\u636e\u3002\u8be5\u547d\u4ee4\u53ef\u4ee5\u5bfc\u51fa\u6240\u6709\u6570\u636e\u5230\u6307\u5b9a\u76ee\u5f55\u4e2d\u3002mongodump\u547d\u4ee4\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u6307\u5b9a\u5bfc\u51fa\u7684\u6570\u636e\u91cf\u7ea7\u8f6c\u5b58\u7684\u670d\u52a1\u5668\u3002 2. mongodump \u00b6 MongoDB\u4e2d\u63d0\u4f9b\u4e86mongostat \u548c mongotop \u4e24\u4e2a\u547d\u4ee4\u6765\u76d1\u63a7MongoDB\u7684\u8fd0\u884c\u60c5\u51b5\u3002 \u8bed\u6cd5\u5982\u4e0b: >mongodump -h dbhost -d dbname -o dbdirectory \u53c2\u6570\u89e3\u91ca - h \u6307\u660e\u6570\u636e\u5e93\u5bbf\u4e3b\u673a\u7684 IP -- port \u6307\u660e\u6570\u636e\u5e93\u7684\u7aef\u53e3 - u \u6307\u660e\u6570\u636e\u5e93\u7684\u7528\u6237\u540d - p \u6307\u660e\u6570\u636e\u5e93\u7684\u5bc6\u7801 - d \u6307\u660e\u6570\u636e\u5e93\u7684\u540d\u5b57 - c \u6307\u660e collection\u7684\u540d\u5b57 - o \u6307\u660e\u5230\u8981\u5bfc\u51fa\u7684\u6587\u4ef6\u540d - q \u6307\u660e\u5bfc\u51fa\u6570\u636e\u7684\u8fc7\u6ee4\u6761\u4ef6 -- authenticationDatabase \u9a8c\u8bc1\u6570\u636e\u7684\u540d\u79f0 -- gzip \u5907\u4efd\u65f6\u538b\u7f29 -- oplog use oplog for taking a point - in - time snapshot \u5feb\u901f\u547d\u4ee4 mkdir full # \u5168\u91cf\u5907\u4efd mkdir db_cmz # \u5355\u5e93\u5907\u4efd mkdir db_cmz_col # \u5e93\u4e2d\u8868\u5907\u4efd mkdir db_cmz_gzip # \u5e93\u5907\u4efd\u538b\u7f29 mkdir db_cmz_gzip_col # \u5e93\u4e2d\u8868\u5907\u4efd\u538b\u7f29 mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -o ./full mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -o ./db_cmz/ mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col -o ./db_cmz_col mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -o ./db_cmz_gzip/ --gzip ongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col -o ./db_cmz_gzip_col/ --gzip 2.0 \u51c6\u5907 \u00b6 [root@leco app]# mkdir full # \u5168\u91cf\u5907\u4efd [root@leco app]# mkdir db_cmz # \u5355\u5e93\u5907\u4efd [root@leco app]# mkdir db_cmz_col # \u5e93\u4e2d\u8868\u5907\u4efd [root@leco app]# mkdir db_cmz_gzip # \u5e93\u5907\u4efd\u538b\u7f29 [root@leco app]# mkdir db_cmz_gzip_col # \u5e93\u4e2d\u8868\u5907\u4efd\u538b\u7f29 > use cmz switched to db cmz > show tables; col col2 col3 test > db.col.find() { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } { \"_id\" : ObjectId(\"5c7632efeb4ea775e2693743\"), \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"url\" : \"https://caimengzhi.github.io/books\" } { \"_id\" : ObjectId(\"5c7632efeb4ea775e2693744\"), \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"url\" : \"https://caimengzhi.github.io/books\" } { \"_id\" : ObjectId(\"5c7632efeb4ea775e2693745\"), \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"url\" : \"https://caimengzhi.github.io/books\" } 2.1 \u5168\u5e93\u5907\u4efd \u00b6 [root@leco app]# mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -o ./full 2019-02-27T15:11:23.080+0800 writing admin.system.version to 2019-02-27T15:11:23.095+0800 done dumping admin.system.version (1 document) 2019-02-27T15:11:23.095+0800 writing cmz.col to 2019-02-27T15:11:23.095+0800 writing cmz.col2 to 2019-02-27T15:11:23.095+0800 writing cmz.test to 2019-02-27T15:11:23.095+0800 writing cmz.col3 to 2019-02-27T15:11:23.099+0800 done dumping cmz.col (6 documents) 2019-02-27T15:11:23.099+0800 done dumping cmz.col2 (5 documents) 2019-02-27T15:11:23.100+0800 done dumping cmz.test (1 document) 2019-02-27T15:11:23.100+0800 done dumping cmz.col3 (0 documents) [root@leco app]# ls ./full/ admin cmz 2.2 \u5907\u4efdcmz\u5e93 \u00b6 [root@leco app]# mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -o ./db_cmz/ 2019-02-27T15:12:44.375+0800 writing cmz.col to 2019-02-27T15:12:44.377+0800 writing cmz.col2 to 2019-02-27T15:12:44.377+0800 writing cmz.test to 2019-02-27T15:12:44.378+0800 writing cmz.col3 to 2019-02-27T15:12:44.379+0800 done dumping cmz.col (6 documents) 2019-02-27T15:12:44.380+0800 done dumping cmz.col2 (5 documents) 2019-02-27T15:12:44.380+0800 done dumping cmz.test (1 document) 2019-02-27T15:12:44.381+0800 done dumping cmz.col3 (0 documents) [root@leco app]# ls db_cmz cmz [root@leco app]# ls db_cmz/cmz/ col2.bson col2.metadata.json col3.bson col3.metadata.json col.bson col.metadata.json test.bson test.metadata.json 2.3 \u5907\u4efdcmz\u5e93\u4e0b\u7684col\u96c6\u5408 \u00b6 [root@leco app]# mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col -o ./db_cmz_col 2019-02-27T15:13:15.706+0800 writing cmz.col to 2019-02-27T15:13:15.707+0800 done dumping cmz.col (6 documents) [root@leco app]# ls db_cmz db_cmz/ db_cmz_col/ db_cmz_gzip/ db_cmz_gzip_col/ [root@leco app]# ls db_cmz_col/ cmz [root@leco app]# ls db_cmz_col/cmz/ col.bson col.metadata.json 2.4 \u538b\u7f29\u5907\u4efd\u5e93 \u00b6 [root@leco app]# mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -o ./db_cmz_gzip/ --gzip 2019-02-27T15:13:53.005+0800 writing cmz.col to 2019-02-27T15:13:53.005+0800 writing cmz.col2 to 2019-02-27T15:13:53.005+0800 writing cmz.test to 2019-02-27T15:13:53.005+0800 writing cmz.col3 to 2019-02-27T15:13:53.008+0800 done dumping cmz.col (6 documents) 2019-02-27T15:13:53.009+0800 done dumping cmz.col2 (5 documents) 2019-02-27T15:13:53.011+0800 done dumping cmz.test (1 document) 2019-02-27T15:13:53.012+0800 done dumping cmz.col3 (0 documents) [root@leco app]# ls db_cmz_gzip db_cmz_gzip/ db_cmz_gzip_col/ [root@leco app]# ls db_cmz_gzip/cmz/ col2.bson.gz col2.metadata.json.gz col3.bson.gz col3.metadata.json.gz col.bson.gz col.metadata.json.gz test.bson.gz test.metadata.json.gz 2.5 \u538b\u7f29\u5907\u4efd\u5355\u8868 \u00b6 [root@leco app]# mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col -o ./db_cmz_gzip_col/ --gzip 2019-02-27T15:14:26.475+0800 writing cmz.col to 2019-02-27T15:14:26.476+0800 done dumping cmz.col (6 documents) [root@leco app]# ls db_cmz_gzip_col/cmz/ col.bson.gz col.metadata.json.gz 3. mongorestore \u00b6 mongodb\u4f7f\u7528 mongorestore \u547d\u4ee4\u6765\u6062\u590d\u5907\u4efd\u7684\u6570\u636e\u3002 mongorestore -h <hostname><:port> -d dbname <path> \u53c2\u6570\u89e3\u91ca -- host < : port > , - h < : port > \uff1a ongoDB\u6240\u5728\u670d\u52a1\u5668\u5730\u5740 \uff0c\u9ed8\u8ba4\u4e3a\uff1a localhost : 27017 - h \u6307\u660e\u6570\u636e\u5e93\u5bbf\u4e3b\u673a\u7684 IP - u \u6307\u660e\u6570\u636e\u5e93\u7684\u7528\u6237\u540d - p \u6307\u660e\u6570\u636e\u5e93\u7684\u5bc6\u7801 - d \u6307\u660e\u6570\u636e\u5e93\u7684\u540d\u5b57 - c \u6307\u660e collection\u7684\u540d\u5b57 - o \u6307\u660e\u5230\u8981\u5bfc\u51fa\u7684\u6587\u4ef6\u540d - q \u6307\u660e\u5bfc\u51fa\u6570\u636e\u7684\u8fc7\u6ee4\u6761\u4ef6 -- authenticationDatabase \u9a8c\u8bc1\u6570\u636e\u7684\u540d\u79f0 -- gzip \u5907\u4efd\u65f6\u538b\u7f29 -- oplog use oplog for taking a point - in - time snapshot -- drop \u6062\u590d\u7684\u65f6\u5019\u628a\u4e4b\u524d\u7684\u96c6\u5408 drop\u6389 3.1 \u6574\u4e2a\u6062\u590d \u00b6 3.3.1 \u5168\u5e93\u5907\u4efd\u4e2d\u6062\u590d\u5355\u5e93 \u00b6 [root@leco app]# mongorestore -h 127.0.0.1:27017 --authenticationDatabase admin --drop ./full 2019-02-27T15:16:24.608+0800 preparing collections to restore from 2019-02-27T15:16:24.656+0800 reading metadata for cmz.col from full/cmz/col.metadata.json 2019-02-27T15:16:24.661+0800 reading metadata for cmz.col3 from full/cmz/col3.metadata.json 2019-02-27T15:16:24.670+0800 reading metadata for cmz.test from full/cmz/test.metadata.json 2019-02-27T15:16:24.681+0800 reading metadata for cmz.col2 from full/cmz/col2.metadata.json 2019-02-27T15:16:24.707+0800 restoring cmz.col from full/cmz/col.bson 2019-02-27T15:16:24.724+0800 restoring cmz.col3 from full/cmz/col3.bson 2019-02-27T15:16:24.725+0800 no indexes to restore 2019-02-27T15:16:24.725+0800 finished restoring cmz.col3 (0 documents) 2019-02-27T15:16:24.741+0800 restoring cmz.test from full/cmz/test.bson 2019-02-27T15:16:24.756+0800 restoring cmz.col2 from full/cmz/col2.bson 2019-02-27T15:16:24.768+0800 no indexes to restore 2019-02-27T15:16:24.768+0800 finished restoring cmz.test (1 document) 2019-02-27T15:16:24.768+0800 no indexes to restore 2019-02-27T15:16:24.768+0800 finished restoring cmz.col (6 documents) 2019-02-27T15:16:24.768+0800 no indexes to restore 2019-02-27T15:16:24.768+0800 finished restoring cmz.col2 (5 documents) 2019-02-27T15:16:24.768+0800 done 4. mongoexport \u00b6 Mongodb\u4e2d\u7684mongoexport\u5de5\u5177\u53ef\u4ee5\u628a\u4e00\u4e2acollection\u5bfc\u51fa\u6210JSON\u683c\u5f0f\u6216CSV\u683c\u5f0f\u7684\u6587\u4ef6\u3002\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u6307\u5b9a\u5bfc\u51fa\u7684\u6570\u636e\u9879\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u6307\u5b9a\u7684\u6761\u4ef6\u5bfc\u51fa\u6570\u636e\u3002 mongoexport -h IP --port \u7aef\u53e3 -u \u7528\u6237\u540d -p \u5bc6\u7801 -d \u6570\u636e\u5e93 -c \u8868\u540d -f \u5b57\u6bb5 -q \u6761\u4ef6\u5bfc\u51fa --csv -o \u6587\u4ef6\u540d \u53c2\u6570\u89e3\u91ca - h \u6307\u660e\u6570\u636e\u5e93\u5bbf\u4e3b\u673a\u7684 IP - u \u6307\u660e\u6570\u636e\u5e93\u7684\u7528\u6237\u540d - p \u6307\u660e\u6570\u636e\u5e93\u7684\u5bc6\u7801 - d \u6307\u660e\u6570\u636e\u5e93\u7684\u540d\u5b57 - c \u6307\u660e collection\u7684\u540d\u5b57 - f \u6307\u660e\u8981\u5bfc\u51fa\u90a3\u4e9b\u5217\uff0c\u4ee5\u9017\u53f7\u5206\u5272\uff0c - f uid , name , age\u5bfc\u51fauid , name , age\u8fd9\u4e09\u4e2a\u5b57\u6bb5 - o \u6307\u660e\u5230\u8981\u5bfc\u51fa\u7684\u6587\u4ef6\u540d - q \u6307\u660e\u5bfc\u51fa\u6570\u636e\u7684\u8fc7\u6ee4\u6761\u4ef6\uff0c - q '{ \"uid\" : \"100\" }' \u5bfc\u51fa uid\u4e3a100\u7684\u6570\u636e -- type \u6307\u5b9a\u6587\u4ef6\u7c7b\u578b -- authenticationDatabase \u9a8c\u8bc1\u6570\u636e\u7684\u540d\u79f0 4.1 \u5bfc\u51fa\u6574\u5f20\u8868 \u00b6 [root@leco bak]# mongoexport -d cmz -c col -o ./col.dat 2019-02-27T14:26:12.934+0800 connected to: localhost 2019-02-27T14:26:12.952+0800 exported 3 records [root@leco bak]# ls admin cmz col.dat [root@leco bak]# cat col.dat {\"_id\":{\"$oid\":\"5c76214dfec6d367f28a65db\"},\"title\":\"Books \u6559\u7a0b\",\"description\":\"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\",\"by\":\"cmz\",\"url\":\"https://caimengzhi.github.io/books\",\"tags\":[\"Java\",\"database\",\"web\"],\"likes\":200.0} {\"_id\":{\"$oid\":\"5c76214dfec6d367f28a65dc\"},\"title\":\"Books \u6559\u7a0b\",\"description\":\"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\",\"by\":\"cmz\",\"url\":\"https://caimengzhi.github.io/books\",\"tags\":[\"Python\",\"database\",\"web\"],\"likes\":150.0} {\"_id\":{\"$oid\":\"5c76214efec6d367f28a65dd\"},\"title\":\"Books \u6559\u7a0b\",\"description\":\"MongoDB \u662f\u4e00\u4e2a Nosql\u6570\u636e\u5e93\",\"by\":\"cmz\",\"url\":\"https://caimengzhi.github.io/books\",\"tags\":[\"mongodb\",\"database\",\"NoSQL\"],\"likes\":100.0} 4.2 \u5bfc\u51fa\u8868\u4e2d\u90e8\u5206\u5b57\u6bb5 \u00b6 [root@leco bak]# mongoexport -d cmz -c col --csv -f description,tags,likes -o ./col.csv 2019-02-27T14:28:16.132+0800 csv flag is deprecated; please use --type=csv instead 2019-02-27T14:28:16.134+0800 connected to: localhost 2019-02-27T14:28:16.145+0800 exported 3 records [root@leco bak]# cat col.csv description,tags,likes Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002,\"[\"\"Java\"\",\"\"database\"\",\"\"web\"\"]\",200 Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00,\"[\"\"Python\"\",\"\"database\"\",\"\"web\"\"]\",150 MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93,\"[\"\"mongodb\"\",\"\"database\"\",\"\"NoSQL\"\"]\",100 4.3 \u6839\u636e\u6761\u4ef6\u5bfc\u51fa\u6570\u636e \u00b6 [root@leco bak]# mongoexport -d cmz -c col -q '{likes:{$gt:150}}' -o ./col.json 2019-02-27T14:29:32.399+0800 connected to: localhost 2019-02-27T14:29:32.402+0800 exported 1 record [root@leco bak]# cat col.json {\"_id\":{\"$oid\":\"5c76214dfec6d367f28a65db\"},\"title\":\"Books \u6559\u7a0b\",\"description\":\"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\",\"by\":\"cmz\",\"url\":\"https://caimengzhi.github.io/books\",\"tags\":[\"Java\",\"database\",\"web\"],\"likes\":200.0} 4.4 other \u00b6 [root@leco back]# mongoexport -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col -o ./col.dat 2019-02-27T14:45:13.623+0800 connected to: 127.0.0.1:27017 2019-02-27T14:45:13.643+0800 exported 3 records [root@leco back]# ls col.dat [root@leco back]# cat col.dat {\"_id\":{\"$oid\":\"5c76214dfec6d367f28a65db\"},\"title\":\"Books \u6559\u7a0b\",\"description\":\"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\",\"by\":\"cmz\",\"url\":\"https://caimengzhi.github.io/books\",\"tags\":[\"Java\",\"database\",\"web\"],\"likes\":200.0} {\"_id\":{\"$oid\":\"5c76214dfec6d367f28a65dc\"},\"title\":\"Books \u6559\u7a0b\",\"description\":\"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\",\"by\":\"cmz\",\"url\":\"https://caimengzhi.github.io/books\",\"tags\":[\"Python\",\"database\",\"web\"],\"likes\":150.0} {\"_id\":{\"$oid\":\"5c76214efec6d367f28a65dd\"},\"title\":\"Books \u6559\u7a0b\",\"description\":\"MongoDB \u662f\u4e00\u4e2a Nosql\u6570\u636e\u5e93\",\"by\":\"cmz\",\"url\":\"https://caimengzhi.github.io/books\",\"tags\":[\"mongodb\",\"database\",\"NoSQL\"],\"likes\":100.0} [root@leco back]# mongoexport -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col --type=csv -f description,url -o ./col_csv.dat 2019-02-27T14:47:01.048+0800 connected to: 127.0.0.1:27017 2019-02-27T14:47:01.059+0800 exported 3 records [root@leco back]# cat col_csv.dat description,url Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002,https://caimengzhi.github.io/books Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00,https://caimengzhi.github.io/books MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93,https://caimengzhi.github.io/books 5. mongoimport \u00b6 Mongodb\u4e2d\u7684mongoimport\u5de5\u5177\u53ef\u4ee5\u628a\u4e00\u4e2a\u7279\u5b9a\u683c\u5f0f\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u5bfc\u5165\u5230\u6307\u5b9a\u7684collection\u4e2d\u3002\u8be5\u5de5\u5177\u53ef\u4ee5\u5bfc\u5165JSON\u683c\u5f0f\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u5bfc\u5165CSV\u683c\u5f0f\u6570\u636e\u3002 \u53c2\u6570\u89e3\u91ca - h \u6307\u660e\u6570\u636e\u5e93\u5bbf\u4e3b\u673a\u7684 IP - u \u6307\u660e\u6570\u636e\u5e93\u7684\u7528\u6237\u540d - p \u6307\u660e\u6570\u636e\u5e93\u7684\u5bc6\u7801 - d \u6307\u660e\u6570\u636e\u5e93\u7684\u540d\u5b57 - c \u6307\u660e collection\u7684\u540d\u5b57 - f \u6307\u660e\u8981\u5bfc\u51fa\u90a3\u4e9b\u5217 - o \u6307\u660e\u5230\u8981\u5bfc\u51fa\u7684\u6587\u4ef6\u540d - q \u6307\u660e\u5bfc\u51fa\u6570\u636e\u7684\u8fc7\u6ee4\u6761\u4ef6 -- drop \u63d2\u5165\u4e4b\u524d\u5148\u5220\u9664\u539f\u6709\u7684 -- headerline \u6307\u660e\u7b2c\u4e00\u884c\u662f\u5217\u540d\uff0c\u4e0d\u9700\u8981\u5bfc\u5165\u3002 - j \u540c\u65f6\u8fd0\u884c\u7684\u63d2\u5165\u64cd\u4f5c\u6570\uff08\u9ed8\u8ba4\u4e3a 1 \uff09\uff0c\u5e76\u884c -- authenticationDatabase \u9a8c\u8bc1\u6570\u636e\u7684\u540d\u79f0 5.1 \u6062\u590d\u5bfc\u51fa\u7684\u8868\u6570\u636e \u00b6 [root@leco back]# mongoimport -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col --drop ./col.dat 2019-02-27T14:48:38.415+0800 connected to: 127.0.0.1:27017 2019-02-27T14:48:38.416+0800 dropping: cmz.col 2019-02-27T14:48:38.497+0800 imported 3 documents 5.2 \u90e8\u5206\u5b57\u6bb5\u7684\u8868\u6570\u636e\u5bfc\u5165 \u00b6 mongoimport -d cmz -c col --upsertFields description,tags,likes ./col.dat 5.3 \u6062\u590dcsv\u6587\u4ef6 \u00b6 [root@leco back]# mongoimport -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col --type=csv --headerline --file ./col_csv.dat 2019-02-27T14:49:19.561+0800 connected to: 127.0.0.1:27017 2019-02-27T14:49:19.563+0800 imported 3 documents","title":"10. MonogoDB \u5907\u4efd\u4e0e\u6062\u590d"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#1","text":"\u5728Mongodb\u4e2d\u6211\u4eec\u4f7f\u7528mongodump\u547d\u4ee4\u6765\u5907\u4efdMongoDB\u6570\u636e\u3002\u8be5\u547d\u4ee4\u53ef\u4ee5\u5bfc\u51fa\u6240\u6709\u6570\u636e\u5230\u6307\u5b9a\u76ee\u5f55\u4e2d\u3002mongodump\u547d\u4ee4\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u6307\u5b9a\u5bfc\u51fa\u7684\u6570\u636e\u91cf\u7ea7\u8f6c\u5b58\u7684\u670d\u52a1\u5668\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#2-mongodump","text":"MongoDB\u4e2d\u63d0\u4f9b\u4e86mongostat \u548c mongotop \u4e24\u4e2a\u547d\u4ee4\u6765\u76d1\u63a7MongoDB\u7684\u8fd0\u884c\u60c5\u51b5\u3002 \u8bed\u6cd5\u5982\u4e0b: >mongodump -h dbhost -d dbname -o dbdirectory \u53c2\u6570\u89e3\u91ca - h \u6307\u660e\u6570\u636e\u5e93\u5bbf\u4e3b\u673a\u7684 IP -- port \u6307\u660e\u6570\u636e\u5e93\u7684\u7aef\u53e3 - u \u6307\u660e\u6570\u636e\u5e93\u7684\u7528\u6237\u540d - p \u6307\u660e\u6570\u636e\u5e93\u7684\u5bc6\u7801 - d \u6307\u660e\u6570\u636e\u5e93\u7684\u540d\u5b57 - c \u6307\u660e collection\u7684\u540d\u5b57 - o \u6307\u660e\u5230\u8981\u5bfc\u51fa\u7684\u6587\u4ef6\u540d - q \u6307\u660e\u5bfc\u51fa\u6570\u636e\u7684\u8fc7\u6ee4\u6761\u4ef6 -- authenticationDatabase \u9a8c\u8bc1\u6570\u636e\u7684\u540d\u79f0 -- gzip \u5907\u4efd\u65f6\u538b\u7f29 -- oplog use oplog for taking a point - in - time snapshot \u5feb\u901f\u547d\u4ee4 mkdir full # \u5168\u91cf\u5907\u4efd mkdir db_cmz # \u5355\u5e93\u5907\u4efd mkdir db_cmz_col # \u5e93\u4e2d\u8868\u5907\u4efd mkdir db_cmz_gzip # \u5e93\u5907\u4efd\u538b\u7f29 mkdir db_cmz_gzip_col # \u5e93\u4e2d\u8868\u5907\u4efd\u538b\u7f29 mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -o ./full mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -o ./db_cmz/ mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col -o ./db_cmz_col mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -o ./db_cmz_gzip/ --gzip ongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col -o ./db_cmz_gzip_col/ --gzip","title":"2. mongodump"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#20","text":"[root@leco app]# mkdir full # \u5168\u91cf\u5907\u4efd [root@leco app]# mkdir db_cmz # \u5355\u5e93\u5907\u4efd [root@leco app]# mkdir db_cmz_col # \u5e93\u4e2d\u8868\u5907\u4efd [root@leco app]# mkdir db_cmz_gzip # \u5e93\u5907\u4efd\u538b\u7f29 [root@leco app]# mkdir db_cmz_gzip_col # \u5e93\u4e2d\u8868\u5907\u4efd\u538b\u7f29 > use cmz switched to db cmz > show tables; col col2 col3 test > db.col.find() { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } { \"_id\" : ObjectId(\"5c7632efeb4ea775e2693743\"), \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"url\" : \"https://caimengzhi.github.io/books\" } { \"_id\" : ObjectId(\"5c7632efeb4ea775e2693744\"), \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"url\" : \"https://caimengzhi.github.io/books\" } { \"_id\" : ObjectId(\"5c7632efeb4ea775e2693745\"), \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"url\" : \"https://caimengzhi.github.io/books\" }","title":"2.0 \u51c6\u5907"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#21","text":"[root@leco app]# mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -o ./full 2019-02-27T15:11:23.080+0800 writing admin.system.version to 2019-02-27T15:11:23.095+0800 done dumping admin.system.version (1 document) 2019-02-27T15:11:23.095+0800 writing cmz.col to 2019-02-27T15:11:23.095+0800 writing cmz.col2 to 2019-02-27T15:11:23.095+0800 writing cmz.test to 2019-02-27T15:11:23.095+0800 writing cmz.col3 to 2019-02-27T15:11:23.099+0800 done dumping cmz.col (6 documents) 2019-02-27T15:11:23.099+0800 done dumping cmz.col2 (5 documents) 2019-02-27T15:11:23.100+0800 done dumping cmz.test (1 document) 2019-02-27T15:11:23.100+0800 done dumping cmz.col3 (0 documents) [root@leco app]# ls ./full/ admin cmz","title":"2.1 \u5168\u5e93\u5907\u4efd"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#22-cmz","text":"[root@leco app]# mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -o ./db_cmz/ 2019-02-27T15:12:44.375+0800 writing cmz.col to 2019-02-27T15:12:44.377+0800 writing cmz.col2 to 2019-02-27T15:12:44.377+0800 writing cmz.test to 2019-02-27T15:12:44.378+0800 writing cmz.col3 to 2019-02-27T15:12:44.379+0800 done dumping cmz.col (6 documents) 2019-02-27T15:12:44.380+0800 done dumping cmz.col2 (5 documents) 2019-02-27T15:12:44.380+0800 done dumping cmz.test (1 document) 2019-02-27T15:12:44.381+0800 done dumping cmz.col3 (0 documents) [root@leco app]# ls db_cmz cmz [root@leco app]# ls db_cmz/cmz/ col2.bson col2.metadata.json col3.bson col3.metadata.json col.bson col.metadata.json test.bson test.metadata.json","title":"2.2 \u5907\u4efdcmz\u5e93"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#23-cmzcol","text":"[root@leco app]# mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col -o ./db_cmz_col 2019-02-27T15:13:15.706+0800 writing cmz.col to 2019-02-27T15:13:15.707+0800 done dumping cmz.col (6 documents) [root@leco app]# ls db_cmz db_cmz/ db_cmz_col/ db_cmz_gzip/ db_cmz_gzip_col/ [root@leco app]# ls db_cmz_col/ cmz [root@leco app]# ls db_cmz_col/cmz/ col.bson col.metadata.json","title":"2.3 \u5907\u4efdcmz\u5e93\u4e0b\u7684col\u96c6\u5408"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#24","text":"[root@leco app]# mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -o ./db_cmz_gzip/ --gzip 2019-02-27T15:13:53.005+0800 writing cmz.col to 2019-02-27T15:13:53.005+0800 writing cmz.col2 to 2019-02-27T15:13:53.005+0800 writing cmz.test to 2019-02-27T15:13:53.005+0800 writing cmz.col3 to 2019-02-27T15:13:53.008+0800 done dumping cmz.col (6 documents) 2019-02-27T15:13:53.009+0800 done dumping cmz.col2 (5 documents) 2019-02-27T15:13:53.011+0800 done dumping cmz.test (1 document) 2019-02-27T15:13:53.012+0800 done dumping cmz.col3 (0 documents) [root@leco app]# ls db_cmz_gzip db_cmz_gzip/ db_cmz_gzip_col/ [root@leco app]# ls db_cmz_gzip/cmz/ col2.bson.gz col2.metadata.json.gz col3.bson.gz col3.metadata.json.gz col.bson.gz col.metadata.json.gz test.bson.gz test.metadata.json.gz","title":"2.4 \u538b\u7f29\u5907\u4efd\u5e93"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#25","text":"[root@leco app]# mongodump -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col -o ./db_cmz_gzip_col/ --gzip 2019-02-27T15:14:26.475+0800 writing cmz.col to 2019-02-27T15:14:26.476+0800 done dumping cmz.col (6 documents) [root@leco app]# ls db_cmz_gzip_col/cmz/ col.bson.gz col.metadata.json.gz","title":"2.5 \u538b\u7f29\u5907\u4efd\u5355\u8868"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#3-mongorestore","text":"mongodb\u4f7f\u7528 mongorestore \u547d\u4ee4\u6765\u6062\u590d\u5907\u4efd\u7684\u6570\u636e\u3002 mongorestore -h <hostname><:port> -d dbname <path> \u53c2\u6570\u89e3\u91ca -- host < : port > , - h < : port > \uff1a ongoDB\u6240\u5728\u670d\u52a1\u5668\u5730\u5740 \uff0c\u9ed8\u8ba4\u4e3a\uff1a localhost : 27017 - h \u6307\u660e\u6570\u636e\u5e93\u5bbf\u4e3b\u673a\u7684 IP - u \u6307\u660e\u6570\u636e\u5e93\u7684\u7528\u6237\u540d - p \u6307\u660e\u6570\u636e\u5e93\u7684\u5bc6\u7801 - d \u6307\u660e\u6570\u636e\u5e93\u7684\u540d\u5b57 - c \u6307\u660e collection\u7684\u540d\u5b57 - o \u6307\u660e\u5230\u8981\u5bfc\u51fa\u7684\u6587\u4ef6\u540d - q \u6307\u660e\u5bfc\u51fa\u6570\u636e\u7684\u8fc7\u6ee4\u6761\u4ef6 -- authenticationDatabase \u9a8c\u8bc1\u6570\u636e\u7684\u540d\u79f0 -- gzip \u5907\u4efd\u65f6\u538b\u7f29 -- oplog use oplog for taking a point - in - time snapshot -- drop \u6062\u590d\u7684\u65f6\u5019\u628a\u4e4b\u524d\u7684\u96c6\u5408 drop\u6389","title":"3. mongorestore"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#31","text":"","title":"3.1 \u6574\u4e2a\u6062\u590d"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#331","text":"[root@leco app]# mongorestore -h 127.0.0.1:27017 --authenticationDatabase admin --drop ./full 2019-02-27T15:16:24.608+0800 preparing collections to restore from 2019-02-27T15:16:24.656+0800 reading metadata for cmz.col from full/cmz/col.metadata.json 2019-02-27T15:16:24.661+0800 reading metadata for cmz.col3 from full/cmz/col3.metadata.json 2019-02-27T15:16:24.670+0800 reading metadata for cmz.test from full/cmz/test.metadata.json 2019-02-27T15:16:24.681+0800 reading metadata for cmz.col2 from full/cmz/col2.metadata.json 2019-02-27T15:16:24.707+0800 restoring cmz.col from full/cmz/col.bson 2019-02-27T15:16:24.724+0800 restoring cmz.col3 from full/cmz/col3.bson 2019-02-27T15:16:24.725+0800 no indexes to restore 2019-02-27T15:16:24.725+0800 finished restoring cmz.col3 (0 documents) 2019-02-27T15:16:24.741+0800 restoring cmz.test from full/cmz/test.bson 2019-02-27T15:16:24.756+0800 restoring cmz.col2 from full/cmz/col2.bson 2019-02-27T15:16:24.768+0800 no indexes to restore 2019-02-27T15:16:24.768+0800 finished restoring cmz.test (1 document) 2019-02-27T15:16:24.768+0800 no indexes to restore 2019-02-27T15:16:24.768+0800 finished restoring cmz.col (6 documents) 2019-02-27T15:16:24.768+0800 no indexes to restore 2019-02-27T15:16:24.768+0800 finished restoring cmz.col2 (5 documents) 2019-02-27T15:16:24.768+0800 done","title":"3.3.1 \u5168\u5e93\u5907\u4efd\u4e2d\u6062\u590d\u5355\u5e93"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#4-mongoexport","text":"Mongodb\u4e2d\u7684mongoexport\u5de5\u5177\u53ef\u4ee5\u628a\u4e00\u4e2acollection\u5bfc\u51fa\u6210JSON\u683c\u5f0f\u6216CSV\u683c\u5f0f\u7684\u6587\u4ef6\u3002\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u6307\u5b9a\u5bfc\u51fa\u7684\u6570\u636e\u9879\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e\u6307\u5b9a\u7684\u6761\u4ef6\u5bfc\u51fa\u6570\u636e\u3002 mongoexport -h IP --port \u7aef\u53e3 -u \u7528\u6237\u540d -p \u5bc6\u7801 -d \u6570\u636e\u5e93 -c \u8868\u540d -f \u5b57\u6bb5 -q \u6761\u4ef6\u5bfc\u51fa --csv -o \u6587\u4ef6\u540d \u53c2\u6570\u89e3\u91ca - h \u6307\u660e\u6570\u636e\u5e93\u5bbf\u4e3b\u673a\u7684 IP - u \u6307\u660e\u6570\u636e\u5e93\u7684\u7528\u6237\u540d - p \u6307\u660e\u6570\u636e\u5e93\u7684\u5bc6\u7801 - d \u6307\u660e\u6570\u636e\u5e93\u7684\u540d\u5b57 - c \u6307\u660e collection\u7684\u540d\u5b57 - f \u6307\u660e\u8981\u5bfc\u51fa\u90a3\u4e9b\u5217\uff0c\u4ee5\u9017\u53f7\u5206\u5272\uff0c - f uid , name , age\u5bfc\u51fauid , name , age\u8fd9\u4e09\u4e2a\u5b57\u6bb5 - o \u6307\u660e\u5230\u8981\u5bfc\u51fa\u7684\u6587\u4ef6\u540d - q \u6307\u660e\u5bfc\u51fa\u6570\u636e\u7684\u8fc7\u6ee4\u6761\u4ef6\uff0c - q '{ \"uid\" : \"100\" }' \u5bfc\u51fa uid\u4e3a100\u7684\u6570\u636e -- type \u6307\u5b9a\u6587\u4ef6\u7c7b\u578b -- authenticationDatabase \u9a8c\u8bc1\u6570\u636e\u7684\u540d\u79f0","title":"4. mongoexport"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#41","text":"[root@leco bak]# mongoexport -d cmz -c col -o ./col.dat 2019-02-27T14:26:12.934+0800 connected to: localhost 2019-02-27T14:26:12.952+0800 exported 3 records [root@leco bak]# ls admin cmz col.dat [root@leco bak]# cat col.dat {\"_id\":{\"$oid\":\"5c76214dfec6d367f28a65db\"},\"title\":\"Books \u6559\u7a0b\",\"description\":\"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\",\"by\":\"cmz\",\"url\":\"https://caimengzhi.github.io/books\",\"tags\":[\"Java\",\"database\",\"web\"],\"likes\":200.0} {\"_id\":{\"$oid\":\"5c76214dfec6d367f28a65dc\"},\"title\":\"Books \u6559\u7a0b\",\"description\":\"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\",\"by\":\"cmz\",\"url\":\"https://caimengzhi.github.io/books\",\"tags\":[\"Python\",\"database\",\"web\"],\"likes\":150.0} {\"_id\":{\"$oid\":\"5c76214efec6d367f28a65dd\"},\"title\":\"Books \u6559\u7a0b\",\"description\":\"MongoDB \u662f\u4e00\u4e2a Nosql\u6570\u636e\u5e93\",\"by\":\"cmz\",\"url\":\"https://caimengzhi.github.io/books\",\"tags\":[\"mongodb\",\"database\",\"NoSQL\"],\"likes\":100.0}","title":"4.1 \u5bfc\u51fa\u6574\u5f20\u8868"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#42","text":"[root@leco bak]# mongoexport -d cmz -c col --csv -f description,tags,likes -o ./col.csv 2019-02-27T14:28:16.132+0800 csv flag is deprecated; please use --type=csv instead 2019-02-27T14:28:16.134+0800 connected to: localhost 2019-02-27T14:28:16.145+0800 exported 3 records [root@leco bak]# cat col.csv description,tags,likes Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002,\"[\"\"Java\"\",\"\"database\"\",\"\"web\"\"]\",200 Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00,\"[\"\"Python\"\",\"\"database\"\",\"\"web\"\"]\",150 MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93,\"[\"\"mongodb\"\",\"\"database\"\",\"\"NoSQL\"\"]\",100","title":"4.2 \u5bfc\u51fa\u8868\u4e2d\u90e8\u5206\u5b57\u6bb5"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#43","text":"[root@leco bak]# mongoexport -d cmz -c col -q '{likes:{$gt:150}}' -o ./col.json 2019-02-27T14:29:32.399+0800 connected to: localhost 2019-02-27T14:29:32.402+0800 exported 1 record [root@leco bak]# cat col.json {\"_id\":{\"$oid\":\"5c76214dfec6d367f28a65db\"},\"title\":\"Books \u6559\u7a0b\",\"description\":\"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\",\"by\":\"cmz\",\"url\":\"https://caimengzhi.github.io/books\",\"tags\":[\"Java\",\"database\",\"web\"],\"likes\":200.0}","title":"4.3 \u6839\u636e\u6761\u4ef6\u5bfc\u51fa\u6570\u636e"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#44-other","text":"[root@leco back]# mongoexport -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col -o ./col.dat 2019-02-27T14:45:13.623+0800 connected to: 127.0.0.1:27017 2019-02-27T14:45:13.643+0800 exported 3 records [root@leco back]# ls col.dat [root@leco back]# cat col.dat {\"_id\":{\"$oid\":\"5c76214dfec6d367f28a65db\"},\"title\":\"Books \u6559\u7a0b\",\"description\":\"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\",\"by\":\"cmz\",\"url\":\"https://caimengzhi.github.io/books\",\"tags\":[\"Java\",\"database\",\"web\"],\"likes\":200.0} {\"_id\":{\"$oid\":\"5c76214dfec6d367f28a65dc\"},\"title\":\"Books \u6559\u7a0b\",\"description\":\"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\",\"by\":\"cmz\",\"url\":\"https://caimengzhi.github.io/books\",\"tags\":[\"Python\",\"database\",\"web\"],\"likes\":150.0} {\"_id\":{\"$oid\":\"5c76214efec6d367f28a65dd\"},\"title\":\"Books \u6559\u7a0b\",\"description\":\"MongoDB \u662f\u4e00\u4e2a Nosql\u6570\u636e\u5e93\",\"by\":\"cmz\",\"url\":\"https://caimengzhi.github.io/books\",\"tags\":[\"mongodb\",\"database\",\"NoSQL\"],\"likes\":100.0} [root@leco back]# mongoexport -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col --type=csv -f description,url -o ./col_csv.dat 2019-02-27T14:47:01.048+0800 connected to: 127.0.0.1:27017 2019-02-27T14:47:01.059+0800 exported 3 records [root@leco back]# cat col_csv.dat description,url Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002,https://caimengzhi.github.io/books Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00,https://caimengzhi.github.io/books MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93,https://caimengzhi.github.io/books","title":"4.4 other"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#5-mongoimport","text":"Mongodb\u4e2d\u7684mongoimport\u5de5\u5177\u53ef\u4ee5\u628a\u4e00\u4e2a\u7279\u5b9a\u683c\u5f0f\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u5bfc\u5165\u5230\u6307\u5b9a\u7684collection\u4e2d\u3002\u8be5\u5de5\u5177\u53ef\u4ee5\u5bfc\u5165JSON\u683c\u5f0f\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u5bfc\u5165CSV\u683c\u5f0f\u6570\u636e\u3002 \u53c2\u6570\u89e3\u91ca - h \u6307\u660e\u6570\u636e\u5e93\u5bbf\u4e3b\u673a\u7684 IP - u \u6307\u660e\u6570\u636e\u5e93\u7684\u7528\u6237\u540d - p \u6307\u660e\u6570\u636e\u5e93\u7684\u5bc6\u7801 - d \u6307\u660e\u6570\u636e\u5e93\u7684\u540d\u5b57 - c \u6307\u660e collection\u7684\u540d\u5b57 - f \u6307\u660e\u8981\u5bfc\u51fa\u90a3\u4e9b\u5217 - o \u6307\u660e\u5230\u8981\u5bfc\u51fa\u7684\u6587\u4ef6\u540d - q \u6307\u660e\u5bfc\u51fa\u6570\u636e\u7684\u8fc7\u6ee4\u6761\u4ef6 -- drop \u63d2\u5165\u4e4b\u524d\u5148\u5220\u9664\u539f\u6709\u7684 -- headerline \u6307\u660e\u7b2c\u4e00\u884c\u662f\u5217\u540d\uff0c\u4e0d\u9700\u8981\u5bfc\u5165\u3002 - j \u540c\u65f6\u8fd0\u884c\u7684\u63d2\u5165\u64cd\u4f5c\u6570\uff08\u9ed8\u8ba4\u4e3a 1 \uff09\uff0c\u5e76\u884c -- authenticationDatabase \u9a8c\u8bc1\u6570\u636e\u7684\u540d\u79f0","title":"5. mongoimport"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#51","text":"[root@leco back]# mongoimport -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col --drop ./col.dat 2019-02-27T14:48:38.415+0800 connected to: 127.0.0.1:27017 2019-02-27T14:48:38.416+0800 dropping: cmz.col 2019-02-27T14:48:38.497+0800 imported 3 documents","title":"5.1 \u6062\u590d\u5bfc\u51fa\u7684\u8868\u6570\u636e"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#52","text":"mongoimport -d cmz -c col --upsertFields description,tags,likes ./col.dat","title":"5.2 \u90e8\u5206\u5b57\u6bb5\u7684\u8868\u6570\u636e\u5bfc\u5165"},{"location":"linux/nosql/mongo/mongo.backup_recovery/#53-csv","text":"[root@leco back]# mongoimport -h 127.0.0.1:27017 --authenticationDatabase admin -d cmz -c col --type=csv --headerline --file ./col_csv.dat 2019-02-27T14:49:19.561+0800 connected to: 127.0.0.1:27017 2019-02-27T14:49:19.563+0800 imported 3 documents","title":"5.3 \u6062\u590dcsv\u6587\u4ef6"},{"location":"linux/nosql/mongo/mongo.collection/","text":"MongoDB \u96c6\u5408\u64cd\u4f5c 1. \u96c6\u5408\u8bed\u6cd5 \u00b6 1.1 \u521b\u5efa\u8bed\u6cd5 \u00b6 MongoDB \u4e2d\u4f7f\u7528 createCollection() \u65b9\u6cd5\u6765\u521b\u5efa\u96c6\u5408\u3002\u8bed\u6cd5\u683c\u5f0f\uff1a db.createCollection(name, options) \u53c2\u6570\u8bf4\u660e name : \u8981\u521b\u5efa\u7684\u96c6\u5408\u540d\u79f0 options : \u53ef\u9009\u53c2\u6570 , \u6307\u5b9a\u6709\u5173\u5185\u5b58\u5927\u5c0f\u53ca\u7d22\u5f15\u7684\u9009\u9879 options \u53ef\u4ee5\u662f\u5982\u4e0b\u53c2\u6570\uff1a \u5b57\u6bb5 \u7c7b\u578b \u63cf\u8ff0 capped \u5e03\u5c14 \uff08\u53ef\u9009\uff09\u5982\u679c\u4e3a true\uff0c\u5219\u521b\u5efa\u56fa\u5b9a\u96c6\u5408\u3002\u56fa\u5b9a\u96c6\u5408\u662f\u6307\u6709\u7740\u56fa\u5b9a\u5927\u5c0f\u7684\u96c6\u5408\uff0c\u5f53\u8fbe\u5230\u6700\u5927\u503c\u65f6\uff0c\u5b83\u4f1a\u81ea\u52a8\u8986\u76d6\u6700\u65e9\u7684\u6587\u6863\u3002\u5f53\u8be5\u503c\u4e3a true \u65f6\uff0c\u5fc5\u987b\u6307\u5b9a size \u53c2\u6570\u3002 autoIndexId \u5e03\u5c14 \uff08\u53ef\u9009\uff09\u5982\u4e3a true\uff0c\u81ea\u52a8\u5728 _id \u5b57\u6bb5\u521b\u5efa\u7d22\u5f15\u3002\u9ed8\u8ba4\u4e3a false\u3002 size \u6570\u503c \uff08\u53ef\u9009\uff09\u4e3a\u56fa\u5b9a\u96c6\u5408\u6307\u5b9a\u4e00\u4e2a\u6700\u5927\u503c\uff08\u4ee5\u5b57\u8282\u8ba1\uff09\u3002\u5982\u679c capped \u4e3a true\uff0c\u4e5f\u9700\u8981\u6307\u5b9a\u8be5\u5b57\u6bb5\u3002 max \u6570\u503c \uff08\u53ef\u9009\uff09\u6307\u5b9a\u56fa\u5b9a\u96c6\u5408\u4e2d\u5305\u542b\u6587\u6863\u7684\u6700\u5927\u6570\u91cf\u3002 \u5728\u63d2\u5165\u6587\u6863\u65f6\uff0cMongoDB \u9996\u5148\u68c0\u67e5\u56fa\u5b9a\u96c6\u5408\u7684 size \u5b57\u6bb5\uff0c\u7136\u540e\u68c0\u67e5 max \u5b57\u6bb5\u3002 1.2 \u5220\u9664\u8bed\u6cd5 \u00b6 MongoDB \u4e2d\u4f7f\u7528 drop() \u65b9\u6cd5\u6765\u5220\u9664\u96c6\u5408\u3002 db.collection.drop() \u5982\u679c\u6210\u529f\u5220\u9664\u9009\u5b9a\u96c6\u5408\uff0c\u5219 drop() \u65b9\u6cd5\u8fd4\u56de true\uff0c\u5426\u5219\u8fd4\u56de false\u3002 2. \u521b\u5efa\u64cd\u4f5c \u00b6 2.1 \u521b\u5efa\u96c6\u5408 \u00b6 \u5728 cmz \u6570\u636e\u5e93\u4e2d\u521b\u5efa col \u96c6\u5408\uff1a > show dbs; admin 0.000GB config 0.000GB local 0.000GB > use cmz; switched to db cmz > db.test.insert({\"name\":\"caimengzhi\"}) WriteResult({ \"nInserted\" : 1 }) > db.createCollection('col') { \"ok\" : 1 } > show dbs; admin 0.000GB cmz 0.000GB config 0.000GB local 0.000GB 2.2 \u67e5\u770b\u96c6\u5408 \u00b6 \u5728 cmz \u6570\u636e\u5e93\u4e2d\u521b\u5efa col \u96c6\u5408\uff1a \u5982\u679c\u8981\u67e5\u770b\u5df2\u6709\u96c6\u5408\uff0c\u53ef\u4ee5\u4f7f\u7528 show collections \u547d\u4ee4\uff1a > show collections col test > show tables; col test 2.4 \u81ea\u52a8\u521b\u5efa \u00b6 \u5728 MongoDB \u4e2d\uff0c\u4f60\u4e0d\u9700\u8981\u521b\u5efa\u96c6\u5408\u3002\u5f53\u4f60\u63d2\u5165\u4e00\u4e9b\u6587\u6863\u65f6\uff0cMongoDB \u4f1a\u81ea\u52a8\u521b\u5efa\u96c6\u5408\u3002 > db.col2.insert({\"name\":\"caimengzhi\"}) WriteResult({ \"nInserted\" : 1 }) > show tables col col2 test 3. \u5220\u9664\u64cd\u4f5c \u00b6 3.1 \u5220\u9664\u96c6\u5408 \u00b6 \u5728\u6570\u636e\u5e93 mydb \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u901a\u8fc7 show collections \u547d\u4ee4\u67e5\u770b\u5df2\u5b58\u5728\u7684\u96c6\u5408\uff1a > use cmz switched to db cmz > show tables; col col2 test > db.col2.drop() true > show tables col test \u4ece\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u51fa col2 \u96c6\u5408\u5df2\u88ab\u5220\u9664\u3002","title":"03. MonogoDB \u96c6\u5408"},{"location":"linux/nosql/mongo/mongo.collection/#1","text":"","title":"1. \u96c6\u5408\u8bed\u6cd5"},{"location":"linux/nosql/mongo/mongo.collection/#11","text":"MongoDB \u4e2d\u4f7f\u7528 createCollection() \u65b9\u6cd5\u6765\u521b\u5efa\u96c6\u5408\u3002\u8bed\u6cd5\u683c\u5f0f\uff1a db.createCollection(name, options) \u53c2\u6570\u8bf4\u660e name : \u8981\u521b\u5efa\u7684\u96c6\u5408\u540d\u79f0 options : \u53ef\u9009\u53c2\u6570 , \u6307\u5b9a\u6709\u5173\u5185\u5b58\u5927\u5c0f\u53ca\u7d22\u5f15\u7684\u9009\u9879 options \u53ef\u4ee5\u662f\u5982\u4e0b\u53c2\u6570\uff1a \u5b57\u6bb5 \u7c7b\u578b \u63cf\u8ff0 capped \u5e03\u5c14 \uff08\u53ef\u9009\uff09\u5982\u679c\u4e3a true\uff0c\u5219\u521b\u5efa\u56fa\u5b9a\u96c6\u5408\u3002\u56fa\u5b9a\u96c6\u5408\u662f\u6307\u6709\u7740\u56fa\u5b9a\u5927\u5c0f\u7684\u96c6\u5408\uff0c\u5f53\u8fbe\u5230\u6700\u5927\u503c\u65f6\uff0c\u5b83\u4f1a\u81ea\u52a8\u8986\u76d6\u6700\u65e9\u7684\u6587\u6863\u3002\u5f53\u8be5\u503c\u4e3a true \u65f6\uff0c\u5fc5\u987b\u6307\u5b9a size \u53c2\u6570\u3002 autoIndexId \u5e03\u5c14 \uff08\u53ef\u9009\uff09\u5982\u4e3a true\uff0c\u81ea\u52a8\u5728 _id \u5b57\u6bb5\u521b\u5efa\u7d22\u5f15\u3002\u9ed8\u8ba4\u4e3a false\u3002 size \u6570\u503c \uff08\u53ef\u9009\uff09\u4e3a\u56fa\u5b9a\u96c6\u5408\u6307\u5b9a\u4e00\u4e2a\u6700\u5927\u503c\uff08\u4ee5\u5b57\u8282\u8ba1\uff09\u3002\u5982\u679c capped \u4e3a true\uff0c\u4e5f\u9700\u8981\u6307\u5b9a\u8be5\u5b57\u6bb5\u3002 max \u6570\u503c \uff08\u53ef\u9009\uff09\u6307\u5b9a\u56fa\u5b9a\u96c6\u5408\u4e2d\u5305\u542b\u6587\u6863\u7684\u6700\u5927\u6570\u91cf\u3002 \u5728\u63d2\u5165\u6587\u6863\u65f6\uff0cMongoDB \u9996\u5148\u68c0\u67e5\u56fa\u5b9a\u96c6\u5408\u7684 size \u5b57\u6bb5\uff0c\u7136\u540e\u68c0\u67e5 max \u5b57\u6bb5\u3002","title":"1.1 \u521b\u5efa\u8bed\u6cd5"},{"location":"linux/nosql/mongo/mongo.collection/#12","text":"MongoDB \u4e2d\u4f7f\u7528 drop() \u65b9\u6cd5\u6765\u5220\u9664\u96c6\u5408\u3002 db.collection.drop() \u5982\u679c\u6210\u529f\u5220\u9664\u9009\u5b9a\u96c6\u5408\uff0c\u5219 drop() \u65b9\u6cd5\u8fd4\u56de true\uff0c\u5426\u5219\u8fd4\u56de false\u3002","title":"1.2 \u5220\u9664\u8bed\u6cd5"},{"location":"linux/nosql/mongo/mongo.collection/#2","text":"","title":"2. \u521b\u5efa\u64cd\u4f5c"},{"location":"linux/nosql/mongo/mongo.collection/#21","text":"\u5728 cmz \u6570\u636e\u5e93\u4e2d\u521b\u5efa col \u96c6\u5408\uff1a > show dbs; admin 0.000GB config 0.000GB local 0.000GB > use cmz; switched to db cmz > db.test.insert({\"name\":\"caimengzhi\"}) WriteResult({ \"nInserted\" : 1 }) > db.createCollection('col') { \"ok\" : 1 } > show dbs; admin 0.000GB cmz 0.000GB config 0.000GB local 0.000GB","title":"2.1 \u521b\u5efa\u96c6\u5408"},{"location":"linux/nosql/mongo/mongo.collection/#22","text":"\u5728 cmz \u6570\u636e\u5e93\u4e2d\u521b\u5efa col \u96c6\u5408\uff1a \u5982\u679c\u8981\u67e5\u770b\u5df2\u6709\u96c6\u5408\uff0c\u53ef\u4ee5\u4f7f\u7528 show collections \u547d\u4ee4\uff1a > show collections col test > show tables; col test","title":"2.2 \u67e5\u770b\u96c6\u5408"},{"location":"linux/nosql/mongo/mongo.collection/#24","text":"\u5728 MongoDB \u4e2d\uff0c\u4f60\u4e0d\u9700\u8981\u521b\u5efa\u96c6\u5408\u3002\u5f53\u4f60\u63d2\u5165\u4e00\u4e9b\u6587\u6863\u65f6\uff0cMongoDB \u4f1a\u81ea\u52a8\u521b\u5efa\u96c6\u5408\u3002 > db.col2.insert({\"name\":\"caimengzhi\"}) WriteResult({ \"nInserted\" : 1 }) > show tables col col2 test","title":"2.4 \u81ea\u52a8\u521b\u5efa"},{"location":"linux/nosql/mongo/mongo.collection/#3","text":"","title":"3. \u5220\u9664\u64cd\u4f5c"},{"location":"linux/nosql/mongo/mongo.collection/#31","text":"\u5728\u6570\u636e\u5e93 mydb \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u901a\u8fc7 show collections \u547d\u4ee4\u67e5\u770b\u5df2\u5b58\u5728\u7684\u96c6\u5408\uff1a > use cmz switched to db cmz > show tables; col col2 test > db.col2.drop() true > show tables col test \u4ece\u7ed3\u679c\u4e2d\u53ef\u4ee5\u770b\u51fa col2 \u96c6\u5408\u5df2\u88ab\u5220\u9664\u3002","title":"3.1 \u5220\u9664\u96c6\u5408"},{"location":"linux/nosql/mongo/mongo.conditional_query/","text":"MongoDB \u6761\u4ef6\u67e5\u8be2 1. \u4ecb\u7ecd \u00b6 \u6761\u4ef6\u64cd\u4f5c\u7b26\u7528\u4e8e\u6bd4\u8f83\u4e24\u4e2a\u8868\u8fbe\u5f0f\u5e76\u4ecemongoDB\u96c6\u5408\u4e2d\u83b7\u53d6\u6570\u636e\u3002 MongoDB\u4e2d\u6761\u4ef6\u64cd\u4f5c\u7b26\u6709\uff1a (>) \u5927\u4e8e - $gt (<) \u5c0f\u4e8e - $lt (>=) \u5927\u4e8e\u7b49\u4e8e - $gte (<= ) \u5c0f\u4e8e\u7b49\u4e8e - $lte 2. \u6d4b\u8bd5 \u00b6 2.1 \u6e05\u7a7a \u00b6 \u6211\u4eec\u4f7f\u7528\u7684\u6570\u636e\u5e93\u540d\u79f0\u4e3a\"cmz\" \u6211\u4eec\u7684\u96c6\u5408\u540d\u79f0\u4e3a\"col\"\uff0c\u4ee5\u4e0b\u4e3a\u6211\u4eec\u63d2\u5165\u7684\u6570\u636e\u3002 \u4e3a\u4e86\u65b9\u4fbf\u6d4b\u8bd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u6e05\u7a7a\u96c6\u5408 \"col\" \u7684\u6570\u636e\uff1a > db.col.remove({}) WriteResult({ \"nRemoved\" : 1 }) > db.col.find() > 2.2 \u63d2\u5165\u6570\u636e \u00b6 db.col.insert({ title: 'Books \u6559\u7a0b', description: 'Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['Java', 'database', 'web'], likes: 200 }) db.col.insert({ title: 'Books \u6559\u7a0b', description: 'Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['Python', 'database', 'web'], likes: 150 }) db.col.insert({ title: 'Books \u6559\u7a0b', description: 'MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['mongodb', 'database', 'NoSQL'], likes: 100 }) \u6267\u884c\u8fc7\u7a0b > db.col.insert({ ... title: 'Books \u6559\u7a0b', ... description: 'Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['Java', 'database', 'web'], ... likes: 200 ... }) WriteResult({ \"nInserted\" : 1 }) > > db.col.insert({ ... title: 'Books \u6559\u7a0b', ... description: 'Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['Python', 'database', 'web'], ... likes: 150 ... }) WriteResult({ \"nInserted\" : 1 }) > > db.col.insert({ ... title: 'Books \u6559\u7a0b', ... description: 'MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 100 ... }) WriteResult({ \"nInserted\" : 1 }) > > db.col.find() { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d8\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d9\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65da\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } 2.3 \u5927\u4e8e\u64cd\u4f5c\u7b26 \u00b6 \u5982\u679c\u4f60\u60f3\u83b7\u53d6 \"col\" \u96c6\u5408\u4e2d \"likes\" \u5927\u4e8e 150 \u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a db.col.find({likes : {$gt : 100}}) \u7c7b\u4f3c\u4e8eSQL\u8bed\u53e5\uff1a Select * from col where likes > 100; > db.col.find({likes : {$gt : 150}}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d8\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } 2.3 \u5927\u4e8e\u7b49\u4e8e\u64cd\u4f5c\u7b26 \u00b6 \u5982\u679c\u4f60\u60f3\u83b7\u53d6\"col\"\u96c6\u5408\u4e2d \"likes\" \u5927\u4e8e\u7b49\u4e8e 150 \u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a db.col.find({likes : {$gte : 150}}) \u7c7b\u4f3c\u4e8eSQL\u8bed\u53e5\uff1a Select * from col where likes >=150; \u64cd\u4f5c\u8fc7\u7a0b > db.col.find({likes : {$gte : 150}}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d8\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d9\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } 2.4 \u5c0f\u4e8e\u64cd\u4f5c\u7b26 \u00b6 \u5982\u679c\u4f60\u60f3\u83b7\u53d6\"col\"\u96c6\u5408\u4e2d \"likes\" \u5c0f\u4e8e 150 \u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a db.col.find({likes : {$lt : 150}}) \u7c7b\u4f3c\u4e8eSQL\u8bed\u53e5\uff1a Select * from col where likes < 150; \u64cd\u4f5c\u8fc7\u7a0b > db.col.find({likes : {$lt : 150}}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65da\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } 2.5 \u5c0f\u4e8e\u7b49\u4e8e\u64cd\u4f5c\u7b26 \u00b6 \u5982\u679c\u4f60\u60f3\u83b7\u53d6\"col\"\u96c6\u5408\u4e2d \"likes\" \u5c0f\u4e8e\u7b49\u4e8e 150 \u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a db.col.find({likes : {$lte : 150}}) \u7c7b\u4f3c\u4e8eSQL\u8bed\u53e5\uff1a Select * from col where likes <= 150; \u64cd\u4f5c\u8fc7\u7a0b > db.col.find({likes : {$lte : 150}}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d9\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65da\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } 2.6 \u4e0d\u7b49\u4e8e\u64cd\u4f5c\u7b26 \u00b6 \u5982\u679c\u4f60\u60f3\u83b7\u53d6\"col\"\u96c6\u5408\u4e2d \"likes\" \u5927\u4e8e100\uff0c\u5c0f\u4e8e 200 \u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a db.col.find({likes : {$lt :200, $gt : 100}}) \u7c7b\u4f3c\u4e8eSQL\u8bed\u53e5\uff1a Select * from col where likes>100 AND likes<200; \u64cd\u4f5c\u8fc7\u7a0b > db.col.find({likes : {$lt :200, $gt : 100}}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d9\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 }","title":"05. MonogoDB \u6761\u4ef6\u67e5\u8be2"},{"location":"linux/nosql/mongo/mongo.conditional_query/#1","text":"\u6761\u4ef6\u64cd\u4f5c\u7b26\u7528\u4e8e\u6bd4\u8f83\u4e24\u4e2a\u8868\u8fbe\u5f0f\u5e76\u4ecemongoDB\u96c6\u5408\u4e2d\u83b7\u53d6\u6570\u636e\u3002 MongoDB\u4e2d\u6761\u4ef6\u64cd\u4f5c\u7b26\u6709\uff1a (>) \u5927\u4e8e - $gt (<) \u5c0f\u4e8e - $lt (>=) \u5927\u4e8e\u7b49\u4e8e - $gte (<= ) \u5c0f\u4e8e\u7b49\u4e8e - $lte","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/mongo/mongo.conditional_query/#2","text":"","title":"2. \u6d4b\u8bd5"},{"location":"linux/nosql/mongo/mongo.conditional_query/#21","text":"\u6211\u4eec\u4f7f\u7528\u7684\u6570\u636e\u5e93\u540d\u79f0\u4e3a\"cmz\" \u6211\u4eec\u7684\u96c6\u5408\u540d\u79f0\u4e3a\"col\"\uff0c\u4ee5\u4e0b\u4e3a\u6211\u4eec\u63d2\u5165\u7684\u6570\u636e\u3002 \u4e3a\u4e86\u65b9\u4fbf\u6d4b\u8bd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u6e05\u7a7a\u96c6\u5408 \"col\" \u7684\u6570\u636e\uff1a > db.col.remove({}) WriteResult({ \"nRemoved\" : 1 }) > db.col.find() >","title":"2.1 \u6e05\u7a7a"},{"location":"linux/nosql/mongo/mongo.conditional_query/#22","text":"db.col.insert({ title: 'Books \u6559\u7a0b', description: 'Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['Java', 'database', 'web'], likes: 200 }) db.col.insert({ title: 'Books \u6559\u7a0b', description: 'Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['Python', 'database', 'web'], likes: 150 }) db.col.insert({ title: 'Books \u6559\u7a0b', description: 'MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['mongodb', 'database', 'NoSQL'], likes: 100 }) \u6267\u884c\u8fc7\u7a0b > db.col.insert({ ... title: 'Books \u6559\u7a0b', ... description: 'Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['Java', 'database', 'web'], ... likes: 200 ... }) WriteResult({ \"nInserted\" : 1 }) > > db.col.insert({ ... title: 'Books \u6559\u7a0b', ... description: 'Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['Python', 'database', 'web'], ... likes: 150 ... }) WriteResult({ \"nInserted\" : 1 }) > > db.col.insert({ ... title: 'Books \u6559\u7a0b', ... description: 'MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 100 ... }) WriteResult({ \"nInserted\" : 1 }) > > db.col.find() { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d8\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d9\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65da\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 }","title":"2.2 \u63d2\u5165\u6570\u636e"},{"location":"linux/nosql/mongo/mongo.conditional_query/#23","text":"\u5982\u679c\u4f60\u60f3\u83b7\u53d6 \"col\" \u96c6\u5408\u4e2d \"likes\" \u5927\u4e8e 150 \u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a db.col.find({likes : {$gt : 100}}) \u7c7b\u4f3c\u4e8eSQL\u8bed\u53e5\uff1a Select * from col where likes > 100; > db.col.find({likes : {$gt : 150}}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d8\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 }","title":"2.3 \u5927\u4e8e\u64cd\u4f5c\u7b26"},{"location":"linux/nosql/mongo/mongo.conditional_query/#23_1","text":"\u5982\u679c\u4f60\u60f3\u83b7\u53d6\"col\"\u96c6\u5408\u4e2d \"likes\" \u5927\u4e8e\u7b49\u4e8e 150 \u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a db.col.find({likes : {$gte : 150}}) \u7c7b\u4f3c\u4e8eSQL\u8bed\u53e5\uff1a Select * from col where likes >=150; \u64cd\u4f5c\u8fc7\u7a0b > db.col.find({likes : {$gte : 150}}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d8\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d9\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 }","title":"2.3 \u5927\u4e8e\u7b49\u4e8e\u64cd\u4f5c\u7b26"},{"location":"linux/nosql/mongo/mongo.conditional_query/#24","text":"\u5982\u679c\u4f60\u60f3\u83b7\u53d6\"col\"\u96c6\u5408\u4e2d \"likes\" \u5c0f\u4e8e 150 \u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a db.col.find({likes : {$lt : 150}}) \u7c7b\u4f3c\u4e8eSQL\u8bed\u53e5\uff1a Select * from col where likes < 150; \u64cd\u4f5c\u8fc7\u7a0b > db.col.find({likes : {$lt : 150}}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65da\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 }","title":"2.4 \u5c0f\u4e8e\u64cd\u4f5c\u7b26"},{"location":"linux/nosql/mongo/mongo.conditional_query/#25","text":"\u5982\u679c\u4f60\u60f3\u83b7\u53d6\"col\"\u96c6\u5408\u4e2d \"likes\" \u5c0f\u4e8e\u7b49\u4e8e 150 \u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a db.col.find({likes : {$lte : 150}}) \u7c7b\u4f3c\u4e8eSQL\u8bed\u53e5\uff1a Select * from col where likes <= 150; \u64cd\u4f5c\u8fc7\u7a0b > db.col.find({likes : {$lte : 150}}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d9\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65da\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 }","title":"2.5 \u5c0f\u4e8e\u7b49\u4e8e\u64cd\u4f5c\u7b26"},{"location":"linux/nosql/mongo/mongo.conditional_query/#26","text":"\u5982\u679c\u4f60\u60f3\u83b7\u53d6\"col\"\u96c6\u5408\u4e2d \"likes\" \u5927\u4e8e100\uff0c\u5c0f\u4e8e 200 \u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a db.col.find({likes : {$lt :200, $gt : 100}}) \u7c7b\u4f3c\u4e8eSQL\u8bed\u53e5\uff1a Select * from col where likes>100 AND likes<200; \u64cd\u4f5c\u8fc7\u7a0b > db.col.find({likes : {$lt :200, $gt : 100}}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d9\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 }","title":"2.6 \u4e0d\u7b49\u4e8e\u64cd\u4f5c\u7b26"},{"location":"linux/nosql/mongo/mongo.databases/","text":"MongoDB \u6570\u636e\u5e93\u64cd\u4f5c 1. \u6570\u636e\u8bed\u6cd5 \u00b6 1.1 \u521b\u5efa\u8bed\u6cd5 \u00b6 MongoDB \u521b\u5efa\u6570\u636e\u5e93\u7684\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a use DATABASE_NAME \u5982\u679c\u6570\u636e\u5e93\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u6570\u636e\u5e93\uff0c\u5426\u5219\u5207\u6362\u5230\u6307\u5b9a\u6570\u636e\u5e93\u3002 1.2 \u5220\u9664\u8bed\u6cd5 \u00b6 MongoDB \u5220\u9664\u6570\u636e\u5e93\u7684\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db.dropDatabase() \u5220\u9664\u5f53\u524d\u6570\u636e\u5e93\uff0c\u9ed8\u8ba4\u4e3a test\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 db \u547d\u4ee4\u67e5\u770b\u5f53\u524d\u6570\u636e\u5e93\u540d\u3002 2. \u521b\u5efa\u64cd\u4f5c \u00b6 2.1 \u521b\u5efa\u6570\u636e\u5e93 \u00b6 \u4ee5\u4e0b\u5b9e\u4f8b\u6211\u4eec\u521b\u5efa\u4e86\u6570\u636e\u5e93 cmz: > use cmz; switched to db cmz > db cmz 2.2 \u67e5\u770b\u6570\u636e\u5e93 \u00b6 \u5982\u679c\u4f60\u60f3\u67e5\u770b\u6240\u6709\u6570\u636e\u5e93\uff0c\u53ef\u4ee5\u4f7f\u7528 show dbs \u547d\u4ee4\uff1a > show dbs; admin 0.000GB config 0.000GB local 0.000GB \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u521a\u521b\u5efa\u7684\u6570\u636e\u5e93 cmz \u5e76\u4e0d\u5728\u6570\u636e\u5e93\u7684\u5217\u8868\u4e2d\uff0c \u8981\u663e\u793a\u5b83\uff0c\u6211\u4eec\u9700\u8981\u5411 cmz \u6570\u636e\u5e93\u63d2\u5165\u4e00\u4e9b\u6570\u636e\u3002 > db.cmz.insert({'name':'cmz'}) WriteResult({ \"nInserted\" : 1 }) > show dbs; admin 0.000GB cmz 0.000GB config 0.000GB local 0.000GB > MongoDB \u4e2d\u9ed8\u8ba4\u7684\u6570\u636e\u5e93\u4e3a test\uff0c\u5982\u679c\u4f60\u6ca1\u6709\u521b\u5efa\u65b0\u7684\u6570\u636e\u5e93\uff0c\u96c6\u5408\u5c06\u5b58\u653e\u5728 test \u6570\u636e\u5e93\u4e2d\u3002 \u6ce8\u610f \u5728 MongoDB \u4e2d\uff0c\u96c6\u5408\u53ea\u6709\u5728\u5185\u5bb9\u63d2\u5165\u540e\u624d\u4f1a\u521b\u5efa! \u5c31\u662f\u8bf4\uff0c\u521b\u5efa\u96c6\u5408 ( \u6570\u636e\u8868 ) \u540e\u8981\u518d\u63d2\u5165\u4e00\u4e2a\u6587\u6863 ( \u8bb0\u5f55 ) \uff0c\u96c6\u5408\u624d\u4f1a\u771f\u6b63\u521b\u5efa\u3002 3. \u5220\u9664\u64cd\u4f5c \u00b6 3.1 \u5220\u9664\u6570\u636e\u5e93 \u00b6 \u4ee5\u4e0b\u5b9e\u4f8b\u6211\u4eec\u5220\u9664\u4e86\u6570\u636e\u5e93 cmz\u3002\u9996\u5148\uff0c\u67e5\u770b\u6240\u6709\u6570\u636e\u5e93\uff1a > show dbs; admin 0.000GB cmz 0.000GB config 0.000GB local 0.000GB \u63a5\u4e0b\u6765\u6211\u4eec\u5207\u6362\u5230\u6570\u636e\u5e93 cmz\uff1a > use cmz; switched to db cmz \u6267\u884c\u5220\u9664\u547d\u4ee4\uff1a > db.dropDatabase() { \"dropped\" : \"cmz\", \"ok\" : 1 } \u6700\u540e\uff0c\u6211\u4eec\u518d\u901a\u8fc7 show dbs \u547d\u4ee4\u6570\u636e\u5e93\u662f\u5426\u5220\u9664\u6210\u529f\uff1a > show dbs; admin 0.000GB config 0.000GB local 0.000GB","title":"02. MonogoDB \u6570\u636e\u5e93"},{"location":"linux/nosql/mongo/mongo.databases/#1","text":"","title":"1. \u6570\u636e\u8bed\u6cd5"},{"location":"linux/nosql/mongo/mongo.databases/#11","text":"MongoDB \u521b\u5efa\u6570\u636e\u5e93\u7684\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a use DATABASE_NAME \u5982\u679c\u6570\u636e\u5e93\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u6570\u636e\u5e93\uff0c\u5426\u5219\u5207\u6362\u5230\u6307\u5b9a\u6570\u636e\u5e93\u3002","title":"1.1 \u521b\u5efa\u8bed\u6cd5"},{"location":"linux/nosql/mongo/mongo.databases/#12","text":"MongoDB \u5220\u9664\u6570\u636e\u5e93\u7684\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db.dropDatabase() \u5220\u9664\u5f53\u524d\u6570\u636e\u5e93\uff0c\u9ed8\u8ba4\u4e3a test\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 db \u547d\u4ee4\u67e5\u770b\u5f53\u524d\u6570\u636e\u5e93\u540d\u3002","title":"1.2 \u5220\u9664\u8bed\u6cd5"},{"location":"linux/nosql/mongo/mongo.databases/#2","text":"","title":"2. \u521b\u5efa\u64cd\u4f5c"},{"location":"linux/nosql/mongo/mongo.databases/#21","text":"\u4ee5\u4e0b\u5b9e\u4f8b\u6211\u4eec\u521b\u5efa\u4e86\u6570\u636e\u5e93 cmz: > use cmz; switched to db cmz > db cmz","title":"2.1 \u521b\u5efa\u6570\u636e\u5e93"},{"location":"linux/nosql/mongo/mongo.databases/#22","text":"\u5982\u679c\u4f60\u60f3\u67e5\u770b\u6240\u6709\u6570\u636e\u5e93\uff0c\u53ef\u4ee5\u4f7f\u7528 show dbs \u547d\u4ee4\uff1a > show dbs; admin 0.000GB config 0.000GB local 0.000GB \u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u521a\u521b\u5efa\u7684\u6570\u636e\u5e93 cmz \u5e76\u4e0d\u5728\u6570\u636e\u5e93\u7684\u5217\u8868\u4e2d\uff0c \u8981\u663e\u793a\u5b83\uff0c\u6211\u4eec\u9700\u8981\u5411 cmz \u6570\u636e\u5e93\u63d2\u5165\u4e00\u4e9b\u6570\u636e\u3002 > db.cmz.insert({'name':'cmz'}) WriteResult({ \"nInserted\" : 1 }) > show dbs; admin 0.000GB cmz 0.000GB config 0.000GB local 0.000GB > MongoDB \u4e2d\u9ed8\u8ba4\u7684\u6570\u636e\u5e93\u4e3a test\uff0c\u5982\u679c\u4f60\u6ca1\u6709\u521b\u5efa\u65b0\u7684\u6570\u636e\u5e93\uff0c\u96c6\u5408\u5c06\u5b58\u653e\u5728 test \u6570\u636e\u5e93\u4e2d\u3002 \u6ce8\u610f \u5728 MongoDB \u4e2d\uff0c\u96c6\u5408\u53ea\u6709\u5728\u5185\u5bb9\u63d2\u5165\u540e\u624d\u4f1a\u521b\u5efa! \u5c31\u662f\u8bf4\uff0c\u521b\u5efa\u96c6\u5408 ( \u6570\u636e\u8868 ) \u540e\u8981\u518d\u63d2\u5165\u4e00\u4e2a\u6587\u6863 ( \u8bb0\u5f55 ) \uff0c\u96c6\u5408\u624d\u4f1a\u771f\u6b63\u521b\u5efa\u3002","title":"2.2 \u67e5\u770b\u6570\u636e\u5e93"},{"location":"linux/nosql/mongo/mongo.databases/#3","text":"","title":"3. \u5220\u9664\u64cd\u4f5c"},{"location":"linux/nosql/mongo/mongo.databases/#31","text":"\u4ee5\u4e0b\u5b9e\u4f8b\u6211\u4eec\u5220\u9664\u4e86\u6570\u636e\u5e93 cmz\u3002\u9996\u5148\uff0c\u67e5\u770b\u6240\u6709\u6570\u636e\u5e93\uff1a > show dbs; admin 0.000GB cmz 0.000GB config 0.000GB local 0.000GB \u63a5\u4e0b\u6765\u6211\u4eec\u5207\u6362\u5230\u6570\u636e\u5e93 cmz\uff1a > use cmz; switched to db cmz \u6267\u884c\u5220\u9664\u547d\u4ee4\uff1a > db.dropDatabase() { \"dropped\" : \"cmz\", \"ok\" : 1 } \u6700\u540e\uff0c\u6211\u4eec\u518d\u901a\u8fc7 show dbs \u547d\u4ee4\u6570\u636e\u5e93\u662f\u5426\u5220\u9664\u6210\u529f\uff1a > show dbs; admin 0.000GB config 0.000GB local 0.000GB","title":"3.1 \u5220\u9664\u6570\u636e\u5e93"},{"location":"linux/nosql/mongo/mongo.doc/","text":"MongoDB \u6587\u6863\u64cd\u4f5c 1. \u6587\u6863\u64cd\u4f5c \u00b6 \u6587\u6863\u7684\u6570\u636e\u7ed3\u6784\u548cJSON\u57fa\u672c\u4e00\u6837\u3002\u6240\u6709\u5b58\u50a8\u5728\u96c6\u5408\u4e2d\u7684\u6570\u636e\u90fd\u662fBSON\u683c\u5f0f\u3002BSON\u662f\u4e00\u79cd\u7c7bjson\u7684\u4e00\u79cd\u4e8c\u8fdb\u5236\u5f62\u5f0f\u7684\u5b58\u50a8\u683c\u5f0f,\u7b80\u79f0Binary JSON\u3002 1.1 \u63d2\u5165\u6587\u6863 \u00b6 MongoDB \u4f7f\u7528 insert() \u6216 save() \u65b9\u6cd5\u5411\u96c6\u5408\u4e2d\u63d2\u5165\u6587\u6863\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a db.COLLECTION_NAME.insert(document) 1.2 \u5220\u9664\u6587\u6863 \u00b6 MongoDB remove()\u51fd\u6570\u662f\u7528\u6765\u79fb\u9664\u96c6\u5408\u4e2d\u7684\u6570\u636e\u3002MongoDB\u6570\u636e\u66f4\u65b0\u53ef\u4ee5\u4f7f\u7528update()\u51fd\u6570\u3002\u5728\u6267\u884cremove()\u51fd\u6570\u524d\u5148\u6267\u884cfind()\u547d\u4ee4\u6765\u5224\u65ad\u6267\u884c\u7684\u6761\u4ef6\u662f\u5426\u6b63\u786e\uff0c\u8fd9\u662f\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684\u4e60\u60ef\u3002 2.6 \u4ee5\u524d\u7248\u672c db.collection.remove( <query>, <justOne> ) 2.6 \u4ee5\u540e\u7248\u672c db.collection.remove( <query>, { justOne: <boolean>, writeConcern: <document> } ) \u53c2\u6570\u8bf4\u660e 1. query : \uff08\u53ef\u9009\uff09\u5220\u9664\u7684\u6587\u6863\u7684\u6761\u4ef6\u3002 2. justOne : \uff08\u53ef\u9009\uff09\u5982\u679c\u8bbe\u4e3a true \u6216 1 \uff0c\u5219\u53ea\u5220\u9664\u4e00\u4e2a\u6587\u6863\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u8be5\u53c2\u6570\uff0c\u6216\u4f7f\u7528\u9ed8\u8ba4\u503c false \uff0c\u5219\u5220\u9664\u6240\u6709\u5339\u914d\u6761\u4ef6\u7684\u6587\u6863\u3002 3. writeConcern : \uff08\u53ef\u9009\uff09\u629b\u51fa\u5f02\u5e38\u7684\u7ea7\u522b\u3002 1.3 \u66f4\u65b0\u6587\u6863 \u00b6 MongoDB \u4f7f\u7528 update() \u548c save() \u65b9\u6cd5\u6765\u66f4\u65b0\u96c6\u5408\u4e2d\u7684\u6587\u6863\u3002\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u8be6\u7ec6\u6765\u770b\u4e0b\u4e24\u4e2a\u51fd\u6570\u7684\u5e94\u7528\u53ca\u5176\u533a\u522b\u3002 1.3.1 update() \u00b6 \u65b9\u6cd5\u7528\u4e8e\u66f4\u65b0\u5df2\u5b58\u5728\u7684\u6587\u6863\u3002\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db.collection.update( <query>, <update>, { upsert: <boolean>, multi: <boolean>, writeConcern: <document> } ) \u53c2\u6570\u8bf4\u660e query : update\u7684\u67e5\u8be2\u6761\u4ef6 \uff0c\u7c7b\u4f3c sql update\u67e5\u8be2\u5185where\u540e\u9762\u7684 \u3002 update : update\u7684\u5bf9\u8c61\u548c\u4e00\u4e9b\u66f4\u65b0\u7684\u64cd\u4f5c\u7b26 \uff08\u5982$ , $ inc ... \uff09\u7b49\uff0c\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a sql update\u67e5\u8be2\u5185set\u540e\u9762\u7684 upsert : \u53ef\u9009\uff0c\u8fd9\u4e2a\u53c2\u6570\u7684\u610f\u601d\u662f\uff0c\u5982\u679c\u4e0d\u5b58\u5728 update\u7684\u8bb0\u5f55 \uff0c\u662f\u5426\u63d2\u5165 objNew , true\u4e3a\u63d2\u5165 \uff0c\u9ed8\u8ba4\u662f false \uff0c\u4e0d\u63d2\u5165\u3002 multi : \u53ef\u9009\uff0c mongodb \u9ed8\u8ba4\u662f false , \u53ea\u66f4\u65b0\u627e\u5230\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c\u8fd9\u4e2a\u53c2\u6570\u4e3a true , \u5c31\u628a\u6309\u6761\u4ef6\u67e5\u51fa\u6765\u591a\u6761\u8bb0\u5f55\u5168\u90e8\u66f4\u65b0\u3002 writeConcern : \u53ef\u9009\uff0c\u629b\u51fa\u5f02\u5e38\u7684\u7ea7\u522b\u3002 1.3.2 save() \u65b9\u6cd5 \u00b6 save() \u65b9\u6cd5\u901a\u8fc7\u4f20\u5165\u7684\u6587\u6863\u6765\u66ff\u6362\u5df2\u6709\u6587\u6863\u3002\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a \u53c2\u6570\u8bf4\u660e document : \u6587\u6863\u6570\u636e\u3002 writeConcern : \u53ef\u9009\uff0c\u629b\u51fa\u5f02\u5e38 1.4 \u67e5\u8be2\u6587\u6863 \u00b6 MongoDB \u67e5\u8be2\u6587\u6863\u4f7f\u7528 find() \u65b9\u6cd5\u3002find() \u65b9\u6cd5\u4ee5\u975e\u7ed3\u6784\u5316\u7684\u65b9\u5f0f\u6765\u663e\u793a\u6240\u6709\u6587\u6863\u3002 MongoDB \u67e5\u8be2\u6570\u636e\u7684\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db.collection.find(query, projection) \u53c2\u6570\u8bf4\u660e 1. query \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u67e5\u8be2\u64cd\u4f5c\u7b26\u6307\u5b9a\u67e5\u8be2\u6761\u4ef6 2. projection \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u6295\u5f71\u64cd\u4f5c\u7b26\u6307\u5b9a\u8fd4\u56de\u7684\u952e\u3002\u67e5\u8be2\u65f6\u8fd4\u56de\u6587\u6863\u4e2d\u6240\u6709\u952e\u503c\uff0c \u53ea\u9700\u7701\u7565\u8be5\u53c2\u6570\u5373\u53ef\uff08\u9ed8\u8ba4\u7701\u7565\uff09\u3002 \u5982\u679c\u4f60\u9700\u8981\u4ee5\u6613\u8bfb\u7684\u65b9\u5f0f\u6765\u8bfb\u53d6\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528 pretty() \u65b9\u6cd5\uff0c\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db.col.find().pretty() 2. \u63d2\u5165\u64cd\u4f5c \u00b6 2.1 \u63d2\u5165\u6587\u6863 \u00b6 \u4ee5\u4e0b\u6587\u6863\u53ef\u4ee5\u5b58\u50a8\u5728 MongoDB \u7684 runoob \u6570\u636e\u5e93 \u7684 col \u96c6\u5408\u4e2d\uff1a db.col.insert({title: 'Books \u6559\u7a0b', description: '\u7b14\u8bb0', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['mongodb', 'database', 'NoSQL'], likes: 66 }) \u64cd\u4f5c\u8fc7\u7a0b\u5982\u4e0b > db cmz > show tables; test > db.col.insert({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 66 ... }) WriteResult({ \"nInserted\" : 1 }) > show tables; col test \u4ee5\u4e0a\u5b9e\u4f8b\u4e2d col \u662f\u6211\u4eec\u7684\u96c6\u5408\u540d\uff0c\u5982\u679c\u8be5\u96c6\u5408\u4e0d\u5728\u8be5\u6570\u636e\u5e93\u4e2d\uff0c MongoDB \u4f1a\u81ea\u52a8\u521b\u5efa\u8be5\u96c6\u5408\u5e76\u63d2\u5165\u6587\u6863\u3002 2.2 \u67e5\u770b\u5df2\u63d2\u5165\u6587\u6863\uff1a \u00b6 > db.col.find() { \"_id\" : ObjectId(\"5c7601540a9870df1141b6be\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } > db.col.find().pretty() { \"_id\" : ObjectId(\"5c7601540a9870df1141b6be\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } \u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06\u6570\u636e\u5b9a\u4e49\u4e3a\u4e00\u4e2a\u53d8\u91cf\uff0c\u5982\u4e0b\u6240\u793a\uff1a document = ({title: 'Books \u6559\u7a0b', description: '\u7b14\u8bb0', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['mongodb', 'database', 'NoSQL'], likes: 66 }) \u64cd\u4f5c\u8fc7\u7a0b\u5982\u4e0b > document = ({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 88 ... }) { \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } > db.col.insert(document) WriteResult({ \"nInserted\" : 1 }) > db.col.find() { \"_id\" : ObjectId(\"5c7601540a9870df1141b6be\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } { \"_id\" : ObjectId(\"5c76025e513e73f526b80a4c\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } > \u63d2\u5165\u6587\u6863\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 db.col.save(document) \u547d\u4ee4\u3002\u5982\u679c\u4e0d\u6307\u5b9a _id \u5b57\u6bb5 save() \u65b9\u6cd5\u7c7b\u4f3c\u4e8e insert() \u65b9\u6cd5\u3002\u5982\u679c\u6307\u5b9a _id \u5b57\u6bb5\uff0c\u5219\u4f1a\u66f4\u65b0\u8be5 _id \u7684\u6570\u636e\u3002 2.4 \u81ea\u52a8\u521b\u5efa \u00b6 \u5728 MongoDB \u4e2d\uff0c\u4f60\u4e0d\u9700\u8981\u521b\u5efa\u96c6\u5408\u3002\u5f53\u4f60\u63d2\u5165\u4e00\u4e9b\u6587\u6863\u65f6\uff0cMongoDB \u4f1a\u81ea\u52a8\u521b\u5efa\u96c6\u5408\u3002 > db.col2.insert({\"name\":\"caimengzhi\"}) WriteResult({ \"nInserted\" : 1 }) > show tables col col2 test 3. \u5220\u9664\u64cd\u4f5c \u00b6 3.1 \u5220\u9664\u6587\u6863 \u00b6 \u5148\u67e5\u8be2\u3002 > db.col.find() { \"_id\" : ObjectId(\"5c7601540a9870df1141b6be\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } { \"_id\" : ObjectId(\"5c7602120a9870df1141b6bf\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } { \"_id\" : ObjectId(\"5c76025e513e73f526b80a4c\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } \u63a5\u4e0b\u6765\u6211\u4eec\u79fb\u9664 likes \u4e3a 66 \u7684\u6587\u6863\uff1a > db.col.remove({'likes':66}) WriteResult({ \"nRemoved\" : 2 }) # \u5220\u9664\u4e86\u4e24\u6761\u6570\u636e > db.col.find() { \"_id\" : ObjectId(\"5c76025e513e73f526b80a4c\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } \u5982\u679c\u4f60\u53ea\u60f3\u5220\u9664\u7b2c\u4e00\u6761\u627e\u5230\u7684\u8bb0\u5f55\u53ef\u4ee5\u8bbe\u7f6e justOne \u4e3a 1\uff0c\u5982\u4e0b\u6240\u793a\uff1a > db.col.insert({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 66 ... }) WriteResult({ \"nInserted\" : 1 }) > db.col.insert({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 66 ... }) WriteResult({ \"nInserted\" : 1 }) > db.col.find() { \"_id\" : ObjectId(\"5c76025e513e73f526b80a4c\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } { \"_id\" : ObjectId(\"5c76043e513e73f526b80a4d\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } { \"_id\" : ObjectId(\"5c760441513e73f526b80a4e\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } # \u5220\u9664 > db.col.remove({'likes':66},1) WriteResult({ \"nRemoved\" : 1 }) > db.col.find() { \"_id\" : ObjectId(\"5c76025e513e73f526b80a4c\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } { \"_id\" : ObjectId(\"5c760441513e73f526b80a4e\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } \u5982\u679c\u4f60\u60f3\u5220\u9664\u6240\u6709\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\uff08\u7c7b\u4f3c\u5e38\u89c4 SQL \u7684 truncate \u547d\u4ee4\uff09\uff1a > db.col.find() { \"_id\" : ObjectId(\"5c76025e513e73f526b80a4c\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } { \"_id\" : ObjectId(\"5c760441513e73f526b80a4e\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } > db.col.remove({}) WriteResult({ \"nRemoved\" : 2 }) > db.col.find() 4. \u66f4\u65b0\u64cd\u4f5c \u00b6 4.1 update \u00b6 \u6211\u4eec\u5728\u96c6\u5408 col \u4e2d\u63d2\u5165\u5982\u4e0b\u6570\u636e\uff1a db.col2.insert({title: 'Books \u6559\u7a0b', description: '\u7b14\u8bb0', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['mongodb', 'database', 'NoSQL'], likes: 'update \u65b9\u6cd5' }) \u64cd\u4f5c\u8fc7\u7a0b > db.col2.insert({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 'update \u65b9\u6cd5' ... }) WriteResult({ \"nInserted\" : 1 }) > show tables col col2 test \u63a5\u7740\u6211\u4eec\u901a\u8fc7 update() \u65b9\u6cd5\u6765\u66f4\u65b0\u6807\u9898(title): > db.col2.find() { \"_id\" : ObjectId(\"5c76067e8a8ce9812e5a5980\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"update \u65b9\u6cd5\" } > db.col2.update({'title':'Books \u6559\u7a0b'},{$set:{'title':'cmz noteBooks'}}) WriteResult({ \"nMatched\" : 1, \"nUpserted\" : 0, \"nModified\" : 1 }) > db.col2.find() { \"_id\" : ObjectId(\"5c76067e8a8ce9812e5a5980\"), \"title\" : \"cmz noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"update \u65b9\u6cd5\" } \u53ef\u4ee5\u770b\u5230\u6807\u9898(title)\u7531\u539f\u6765\u7684 \"Books \u6559\u7a0b\" \u66f4\u65b0\u4e3a\u4e86 \"cmz noteBooks\"\u3002 \u4ee5\u4e0a\u8bed\u53e5\u53ea\u4f1a\u4fee\u6539\u7b2c\u4e00\u6761\u53d1\u73b0\u7684\u6587\u6863\uff0c\u5982\u679c\u4f60\u8981\u4fee\u6539\u591a\u6761\u76f8\u540c\u7684\u6587\u6863\uff0c\u5219\u9700\u8981\u8bbe\u7f6e multi \u53c2\u6570\u4e3a true\u3002 db.col.update({'title':'MongoDB \u6559\u7a0b'},{$set:{'title':'MongoDB'}},{multi:true}) \u64cd\u4f5c\u8fc7\u7a0b > db.col2.insert({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 'update \u65b9\u6cd5' ... }) WriteResult({ \"nInserted\" : 1 }) > db.col2.insert({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 'update \u65b9\u6cd5' ... }) WriteResult({ \"nInserted\" : 1 }) > show tables; col col2 test > db.col2.find() { \"_id\" : ObjectId(\"5c76067e8a8ce9812e5a5980\"), \"title\" : \"cmz noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"update \u65b9\u6cd5\" } { \"_id\" : ObjectId(\"5c7607388a8ce9812e5a5981\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"update \u65b9\u6cd5\" } { \"_id\" : ObjectId(\"5c7607398a8ce9812e5a5982\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"update \u65b9\u6cd5\" } # \u4fee\u6539 > db.col2.update({'title':'Books \u6559\u7a0b'},{$set:{'title':'cmz2 noteBooks'}},{multi:true}) WriteResult({ \"nMatched\" : 2, \"nUpserted\" : 0, \"nModified\" : 2 }) 4.2 save \u00b6 \u4ee5\u4e0b\u5b9e\u4f8b\u4e2d\u6211\u4eec\u66ff\u6362\u4e86likes > use cmz switched to db cmz > db.col2.find() { \"_id\" : ObjectId(\"5c76067e8a8ce9812e5a5980\"), \"title\" : \"cmz noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"update \u65b9\u6cd5\" } { \"_id\" : ObjectId(\"5c7607388a8ce9812e5a5981\"), \"title\" : \"cmz2 noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\"], \"likes\" : \"update \u65b9\u6cd5\" } { \"_id\" : ObjectId(\"5c7607398a8ce9812e5a5982\"), \"title\" : \"cmz2 noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\"], \"likes\" : \"update \u65b9\u6cd5\" } # save \u64cd\u4f5c > db.col2.save({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 'save \u65b9\u6cd5' ... }) WriteResult({ \"nInserted\" : 1 }) > db.col2.find() { \"_id\" : ObjectId(\"5c76067e8a8ce9812e5a5980\"), \"title\" : \"cmz noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"update \u65b9\u6cd5\" } { \"_id\" : ObjectId(\"5c7607388a8ce9812e5a5981\"), \"title\" : \"cmz2 noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\"], \"likes\" : \"update \u65b9\u6cd5\" } { \"_id\" : ObjectId(\"5c7607398a8ce9812e5a5982\"), \"title\" : \"cmz2 noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\"], \"likes\" : \"update \u65b9\u6cd5\" } { \"_id\" : ObjectId(\"5c7609352c2b43efe00307bb\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"save \u65b9\u6cd5\" } \u66f4\u591a\u64cd\u4f5c \u53ea\u66f4\u65b0\u7b2c\u4e00\u6761\u8bb0\u5f55\uff1a db . col . update ( { \"count\" : { $ gt : 1 } } , { $ set : { \"test2\" : \"OK\" } } ); \u5168\u90e8\u66f4\u65b0\uff1a db . col . update ( { \"count\" : { $ gt : 3 } } , { $ set : { \"test2\" : \"OK\" } }, false , true ); \u53ea\u6dfb\u52a0\u7b2c\u4e00\u6761\uff1a db . col . update ( { \"count\" : { $ gt : 4 } } , { $ set : { \"test5\" : \"OK\" } }, true , false ); \u5168\u90e8\u6dfb\u52a0\u8fdb\u53bb : db . col . update ( { \"count\" : { $ gt : 5 } } , { $ set : { \"test5\" : \"OK\" } }, true , true ); \u5168\u90e8\u66f4\u65b0\uff1a db . col . update ( { \"count\" : { $ gt : 15 } } , { $ inc : { \"count\" : 1 } }, false , true ); \u53ea\u66f4\u65b0\u7b2c\u4e00\u6761\u8bb0\u5f55\uff1a db . col . update ( { \"count\" : { $ gt : 10 } } , { $ inc : { \"count\" : 1 } }, false , false ); 5. \u67e5\u8be2\u64cd\u4f5c \u00b6 5.1 \u57fa\u672c\u67e5\u8be2 \u00b6 \u6211\u4eec\u5728\u96c6\u5408 col \u4e2d\u5148\u63d2\u5165\u7684\u6570\u636e\uff1a db.col.insert({title: 'Books \u6559\u7a0b', description: '\u7b14\u8bb0', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['mongodb', 'database', 'NoSQL'], likes: 88 }) \u64cd\u4f5c\u8fc7\u7a0b > db.col.insert({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 88 ... }) WriteResult({ \"nInserted\" : 1 }) > db.col.find() { \"_id\" : ObjectId(\"5c761420fec6d367f28a65d4\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } > db.col.find().pretty() { \"_id\" : ObjectId(\"5c761420fec6d367f28a65d4\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } \u9664\u4e86 find() \u65b9\u6cd5\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a findOne() \u65b9\u6cd5\uff0c\u5b83\u53ea\u8fd4\u56de\u4e00\u4e2a\u6587\u6863\u3002 > db.col.findOne() { \"_id\" : ObjectId(\"5c761420fec6d367f28a65d4\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } 5.2 \u67e5\u8be2\u8bed\u53e5\u6761\u4ef6 \u00b6 \u67e5\u8be2\u8bed\u53e5\u6761\u4ef6 \u64cd\u4f5c \u683c\u5f0f \u8303\u4f8b RDBMS\u4e2d\u7684\u7c7b\u4f3c\u8bed\u53e5 \u7b49\u4e8e { : } db.col.find({\"by\":\"cmz\"}).pretty() where by = 'cmz' \u5c0f\u4e8e { :{$lt: }} db.col.find({\"likes\":{$lt:50}}).pretty() where likes < 50 \u5c0f\u4e8e\u6216\u7b49\u4e8e { :{$lte: }} db.col.find({\"likes\":{$lte:50}}).pretty() where likes <= 50 \u5927\u4e8e { :{$gt: }} db.col.find({\"likes\":{$gt:50}}).pretty() where likes > 50 \u5927\u4e8e\u6216\u7b49\u4e8e { :{$gte: }} db.col.find({\"likes\":{$gte:50}}).pretty() where likes >= 50 \u4e0d\u7b49\u4e8e { :{$ne: }} db.col.find({\"likes\":{$ne:50}}).pretty() where likes != 50 5.3 AND\u6761\u4ef6 \u00b6 MongoDB \u7684 find() \u65b9\u6cd5\u53ef\u4ee5\u4f20\u5165\u591a\u4e2a\u952e(key)\uff0c\u6bcf\u4e2a\u952e(key)\u4ee5\u9017\u53f7\u9694\u5f00\uff0c\u5373\u5e38\u89c4 SQL \u7684 AND \u6761\u4ef6\u3002\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a >db.col.find({key1:value1, key2:value2}).pretty() \u64cd\u4f5c\u8fc7\u7a0b > db.col.find({\"by\":\"cmz\", \"title\":\"Books \u6559\u7a0b\"}).pretty() { \"_id\" : ObjectId(\"5c761420fec6d367f28a65d4\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } 5.4 OR\u6761\u4ef6 \u00b6 MongoDB OR \u6761\u4ef6\u8bed\u53e5\u4f7f\u7528\u4e86\u5173\u952e\u5b57 $or,\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a >db.col.find( { $or: [ {key1: value1}, {key2:value2} ] } ).pretty() \u64cd\u4f5c\u8fc7\u7a0b > db.col.find({$or:[{\"by\":\"cmz\"},{\"title\": \"Books \u6559\u7a0b\"}]}).pretty() { \"_id\" : ObjectId(\"5c761420fec6d367f28a65d4\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } 5.5 AND \u548c OR\u6761\u4ef6 \u00b6 \u4ee5\u4e0b\u5b9e\u4f8b\u6f14\u793a\u4e86 AND \u548c OR \u8054\u5408\u4f7f\u7528\uff0c\u7c7b\u4f3c\u5e38\u89c4 SQL \u8bed\u53e5\u4e3a\uff1a 'where likes>50 AND (by = 'cmz' OR title = 'Books \u6559\u7a0b')' > db.col.find({\"likes\": {$gt:50}, $or: [{\"by\": \"cmz\"},{\"title\": \"Books \u6559\u7a0b\"}]}).pretty() { \"_id\" : ObjectId(\"5c761420fec6d367f28a65d4\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 }","title":"04. MonogoDB \u6587\u6863"},{"location":"linux/nosql/mongo/mongo.doc/#1","text":"\u6587\u6863\u7684\u6570\u636e\u7ed3\u6784\u548cJSON\u57fa\u672c\u4e00\u6837\u3002\u6240\u6709\u5b58\u50a8\u5728\u96c6\u5408\u4e2d\u7684\u6570\u636e\u90fd\u662fBSON\u683c\u5f0f\u3002BSON\u662f\u4e00\u79cd\u7c7bjson\u7684\u4e00\u79cd\u4e8c\u8fdb\u5236\u5f62\u5f0f\u7684\u5b58\u50a8\u683c\u5f0f,\u7b80\u79f0Binary JSON\u3002","title":"1. \u6587\u6863\u64cd\u4f5c"},{"location":"linux/nosql/mongo/mongo.doc/#11","text":"MongoDB \u4f7f\u7528 insert() \u6216 save() \u65b9\u6cd5\u5411\u96c6\u5408\u4e2d\u63d2\u5165\u6587\u6863\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a db.COLLECTION_NAME.insert(document)","title":"1.1 \u63d2\u5165\u6587\u6863"},{"location":"linux/nosql/mongo/mongo.doc/#12","text":"MongoDB remove()\u51fd\u6570\u662f\u7528\u6765\u79fb\u9664\u96c6\u5408\u4e2d\u7684\u6570\u636e\u3002MongoDB\u6570\u636e\u66f4\u65b0\u53ef\u4ee5\u4f7f\u7528update()\u51fd\u6570\u3002\u5728\u6267\u884cremove()\u51fd\u6570\u524d\u5148\u6267\u884cfind()\u547d\u4ee4\u6765\u5224\u65ad\u6267\u884c\u7684\u6761\u4ef6\u662f\u5426\u6b63\u786e\uff0c\u8fd9\u662f\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684\u4e60\u60ef\u3002 2.6 \u4ee5\u524d\u7248\u672c db.collection.remove( <query>, <justOne> ) 2.6 \u4ee5\u540e\u7248\u672c db.collection.remove( <query>, { justOne: <boolean>, writeConcern: <document> } ) \u53c2\u6570\u8bf4\u660e 1. query : \uff08\u53ef\u9009\uff09\u5220\u9664\u7684\u6587\u6863\u7684\u6761\u4ef6\u3002 2. justOne : \uff08\u53ef\u9009\uff09\u5982\u679c\u8bbe\u4e3a true \u6216 1 \uff0c\u5219\u53ea\u5220\u9664\u4e00\u4e2a\u6587\u6863\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u8be5\u53c2\u6570\uff0c\u6216\u4f7f\u7528\u9ed8\u8ba4\u503c false \uff0c\u5219\u5220\u9664\u6240\u6709\u5339\u914d\u6761\u4ef6\u7684\u6587\u6863\u3002 3. writeConcern : \uff08\u53ef\u9009\uff09\u629b\u51fa\u5f02\u5e38\u7684\u7ea7\u522b\u3002","title":"1.2 \u5220\u9664\u6587\u6863"},{"location":"linux/nosql/mongo/mongo.doc/#13","text":"MongoDB \u4f7f\u7528 update() \u548c save() \u65b9\u6cd5\u6765\u66f4\u65b0\u96c6\u5408\u4e2d\u7684\u6587\u6863\u3002\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u8be6\u7ec6\u6765\u770b\u4e0b\u4e24\u4e2a\u51fd\u6570\u7684\u5e94\u7528\u53ca\u5176\u533a\u522b\u3002","title":"1.3 \u66f4\u65b0\u6587\u6863"},{"location":"linux/nosql/mongo/mongo.doc/#131-update","text":"\u65b9\u6cd5\u7528\u4e8e\u66f4\u65b0\u5df2\u5b58\u5728\u7684\u6587\u6863\u3002\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db.collection.update( <query>, <update>, { upsert: <boolean>, multi: <boolean>, writeConcern: <document> } ) \u53c2\u6570\u8bf4\u660e query : update\u7684\u67e5\u8be2\u6761\u4ef6 \uff0c\u7c7b\u4f3c sql update\u67e5\u8be2\u5185where\u540e\u9762\u7684 \u3002 update : update\u7684\u5bf9\u8c61\u548c\u4e00\u4e9b\u66f4\u65b0\u7684\u64cd\u4f5c\u7b26 \uff08\u5982$ , $ inc ... \uff09\u7b49\uff0c\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a sql update\u67e5\u8be2\u5185set\u540e\u9762\u7684 upsert : \u53ef\u9009\uff0c\u8fd9\u4e2a\u53c2\u6570\u7684\u610f\u601d\u662f\uff0c\u5982\u679c\u4e0d\u5b58\u5728 update\u7684\u8bb0\u5f55 \uff0c\u662f\u5426\u63d2\u5165 objNew , true\u4e3a\u63d2\u5165 \uff0c\u9ed8\u8ba4\u662f false \uff0c\u4e0d\u63d2\u5165\u3002 multi : \u53ef\u9009\uff0c mongodb \u9ed8\u8ba4\u662f false , \u53ea\u66f4\u65b0\u627e\u5230\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c\u8fd9\u4e2a\u53c2\u6570\u4e3a true , \u5c31\u628a\u6309\u6761\u4ef6\u67e5\u51fa\u6765\u591a\u6761\u8bb0\u5f55\u5168\u90e8\u66f4\u65b0\u3002 writeConcern : \u53ef\u9009\uff0c\u629b\u51fa\u5f02\u5e38\u7684\u7ea7\u522b\u3002","title":"1.3.1 update()"},{"location":"linux/nosql/mongo/mongo.doc/#132-save","text":"save() \u65b9\u6cd5\u901a\u8fc7\u4f20\u5165\u7684\u6587\u6863\u6765\u66ff\u6362\u5df2\u6709\u6587\u6863\u3002\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a \u53c2\u6570\u8bf4\u660e document : \u6587\u6863\u6570\u636e\u3002 writeConcern : \u53ef\u9009\uff0c\u629b\u51fa\u5f02\u5e38","title":"1.3.2 save() \u65b9\u6cd5"},{"location":"linux/nosql/mongo/mongo.doc/#14","text":"MongoDB \u67e5\u8be2\u6587\u6863\u4f7f\u7528 find() \u65b9\u6cd5\u3002find() \u65b9\u6cd5\u4ee5\u975e\u7ed3\u6784\u5316\u7684\u65b9\u5f0f\u6765\u663e\u793a\u6240\u6709\u6587\u6863\u3002 MongoDB \u67e5\u8be2\u6570\u636e\u7684\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db.collection.find(query, projection) \u53c2\u6570\u8bf4\u660e 1. query \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u67e5\u8be2\u64cd\u4f5c\u7b26\u6307\u5b9a\u67e5\u8be2\u6761\u4ef6 2. projection \uff1a\u53ef\u9009\uff0c\u4f7f\u7528\u6295\u5f71\u64cd\u4f5c\u7b26\u6307\u5b9a\u8fd4\u56de\u7684\u952e\u3002\u67e5\u8be2\u65f6\u8fd4\u56de\u6587\u6863\u4e2d\u6240\u6709\u952e\u503c\uff0c \u53ea\u9700\u7701\u7565\u8be5\u53c2\u6570\u5373\u53ef\uff08\u9ed8\u8ba4\u7701\u7565\uff09\u3002 \u5982\u679c\u4f60\u9700\u8981\u4ee5\u6613\u8bfb\u7684\u65b9\u5f0f\u6765\u8bfb\u53d6\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528 pretty() \u65b9\u6cd5\uff0c\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db.col.find().pretty()","title":"1.4 \u67e5\u8be2\u6587\u6863"},{"location":"linux/nosql/mongo/mongo.doc/#2","text":"","title":"2. \u63d2\u5165\u64cd\u4f5c"},{"location":"linux/nosql/mongo/mongo.doc/#21","text":"\u4ee5\u4e0b\u6587\u6863\u53ef\u4ee5\u5b58\u50a8\u5728 MongoDB \u7684 runoob \u6570\u636e\u5e93 \u7684 col \u96c6\u5408\u4e2d\uff1a db.col.insert({title: 'Books \u6559\u7a0b', description: '\u7b14\u8bb0', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['mongodb', 'database', 'NoSQL'], likes: 66 }) \u64cd\u4f5c\u8fc7\u7a0b\u5982\u4e0b > db cmz > show tables; test > db.col.insert({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 66 ... }) WriteResult({ \"nInserted\" : 1 }) > show tables; col test \u4ee5\u4e0a\u5b9e\u4f8b\u4e2d col \u662f\u6211\u4eec\u7684\u96c6\u5408\u540d\uff0c\u5982\u679c\u8be5\u96c6\u5408\u4e0d\u5728\u8be5\u6570\u636e\u5e93\u4e2d\uff0c MongoDB \u4f1a\u81ea\u52a8\u521b\u5efa\u8be5\u96c6\u5408\u5e76\u63d2\u5165\u6587\u6863\u3002","title":"2.1 \u63d2\u5165\u6587\u6863"},{"location":"linux/nosql/mongo/mongo.doc/#22","text":"> db.col.find() { \"_id\" : ObjectId(\"5c7601540a9870df1141b6be\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } > db.col.find().pretty() { \"_id\" : ObjectId(\"5c7601540a9870df1141b6be\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } \u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06\u6570\u636e\u5b9a\u4e49\u4e3a\u4e00\u4e2a\u53d8\u91cf\uff0c\u5982\u4e0b\u6240\u793a\uff1a document = ({title: 'Books \u6559\u7a0b', description: '\u7b14\u8bb0', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['mongodb', 'database', 'NoSQL'], likes: 66 }) \u64cd\u4f5c\u8fc7\u7a0b\u5982\u4e0b > document = ({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 88 ... }) { \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } > db.col.insert(document) WriteResult({ \"nInserted\" : 1 }) > db.col.find() { \"_id\" : ObjectId(\"5c7601540a9870df1141b6be\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } { \"_id\" : ObjectId(\"5c76025e513e73f526b80a4c\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } > \u63d2\u5165\u6587\u6863\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 db.col.save(document) \u547d\u4ee4\u3002\u5982\u679c\u4e0d\u6307\u5b9a _id \u5b57\u6bb5 save() \u65b9\u6cd5\u7c7b\u4f3c\u4e8e insert() \u65b9\u6cd5\u3002\u5982\u679c\u6307\u5b9a _id \u5b57\u6bb5\uff0c\u5219\u4f1a\u66f4\u65b0\u8be5 _id \u7684\u6570\u636e\u3002","title":"2.2 \u67e5\u770b\u5df2\u63d2\u5165\u6587\u6863\uff1a"},{"location":"linux/nosql/mongo/mongo.doc/#24","text":"\u5728 MongoDB \u4e2d\uff0c\u4f60\u4e0d\u9700\u8981\u521b\u5efa\u96c6\u5408\u3002\u5f53\u4f60\u63d2\u5165\u4e00\u4e9b\u6587\u6863\u65f6\uff0cMongoDB \u4f1a\u81ea\u52a8\u521b\u5efa\u96c6\u5408\u3002 > db.col2.insert({\"name\":\"caimengzhi\"}) WriteResult({ \"nInserted\" : 1 }) > show tables col col2 test","title":"2.4 \u81ea\u52a8\u521b\u5efa"},{"location":"linux/nosql/mongo/mongo.doc/#3","text":"","title":"3. \u5220\u9664\u64cd\u4f5c"},{"location":"linux/nosql/mongo/mongo.doc/#31","text":"\u5148\u67e5\u8be2\u3002 > db.col.find() { \"_id\" : ObjectId(\"5c7601540a9870df1141b6be\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } { \"_id\" : ObjectId(\"5c7602120a9870df1141b6bf\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } { \"_id\" : ObjectId(\"5c76025e513e73f526b80a4c\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } \u63a5\u4e0b\u6765\u6211\u4eec\u79fb\u9664 likes \u4e3a 66 \u7684\u6587\u6863\uff1a > db.col.remove({'likes':66}) WriteResult({ \"nRemoved\" : 2 }) # \u5220\u9664\u4e86\u4e24\u6761\u6570\u636e > db.col.find() { \"_id\" : ObjectId(\"5c76025e513e73f526b80a4c\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } \u5982\u679c\u4f60\u53ea\u60f3\u5220\u9664\u7b2c\u4e00\u6761\u627e\u5230\u7684\u8bb0\u5f55\u53ef\u4ee5\u8bbe\u7f6e justOne \u4e3a 1\uff0c\u5982\u4e0b\u6240\u793a\uff1a > db.col.insert({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 66 ... }) WriteResult({ \"nInserted\" : 1 }) > db.col.insert({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 66 ... }) WriteResult({ \"nInserted\" : 1 }) > db.col.find() { \"_id\" : ObjectId(\"5c76025e513e73f526b80a4c\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } { \"_id\" : ObjectId(\"5c76043e513e73f526b80a4d\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } { \"_id\" : ObjectId(\"5c760441513e73f526b80a4e\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } # \u5220\u9664 > db.col.remove({'likes':66},1) WriteResult({ \"nRemoved\" : 1 }) > db.col.find() { \"_id\" : ObjectId(\"5c76025e513e73f526b80a4c\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } { \"_id\" : ObjectId(\"5c760441513e73f526b80a4e\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } \u5982\u679c\u4f60\u60f3\u5220\u9664\u6240\u6709\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\uff08\u7c7b\u4f3c\u5e38\u89c4 SQL \u7684 truncate \u547d\u4ee4\uff09\uff1a > db.col.find() { \"_id\" : ObjectId(\"5c76025e513e73f526b80a4c\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } { \"_id\" : ObjectId(\"5c760441513e73f526b80a4e\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 66 } > db.col.remove({}) WriteResult({ \"nRemoved\" : 2 }) > db.col.find()","title":"3.1 \u5220\u9664\u6587\u6863"},{"location":"linux/nosql/mongo/mongo.doc/#4","text":"","title":"4. \u66f4\u65b0\u64cd\u4f5c"},{"location":"linux/nosql/mongo/mongo.doc/#41-update","text":"\u6211\u4eec\u5728\u96c6\u5408 col \u4e2d\u63d2\u5165\u5982\u4e0b\u6570\u636e\uff1a db.col2.insert({title: 'Books \u6559\u7a0b', description: '\u7b14\u8bb0', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['mongodb', 'database', 'NoSQL'], likes: 'update \u65b9\u6cd5' }) \u64cd\u4f5c\u8fc7\u7a0b > db.col2.insert({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 'update \u65b9\u6cd5' ... }) WriteResult({ \"nInserted\" : 1 }) > show tables col col2 test \u63a5\u7740\u6211\u4eec\u901a\u8fc7 update() \u65b9\u6cd5\u6765\u66f4\u65b0\u6807\u9898(title): > db.col2.find() { \"_id\" : ObjectId(\"5c76067e8a8ce9812e5a5980\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"update \u65b9\u6cd5\" } > db.col2.update({'title':'Books \u6559\u7a0b'},{$set:{'title':'cmz noteBooks'}}) WriteResult({ \"nMatched\" : 1, \"nUpserted\" : 0, \"nModified\" : 1 }) > db.col2.find() { \"_id\" : ObjectId(\"5c76067e8a8ce9812e5a5980\"), \"title\" : \"cmz noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"update \u65b9\u6cd5\" } \u53ef\u4ee5\u770b\u5230\u6807\u9898(title)\u7531\u539f\u6765\u7684 \"Books \u6559\u7a0b\" \u66f4\u65b0\u4e3a\u4e86 \"cmz noteBooks\"\u3002 \u4ee5\u4e0a\u8bed\u53e5\u53ea\u4f1a\u4fee\u6539\u7b2c\u4e00\u6761\u53d1\u73b0\u7684\u6587\u6863\uff0c\u5982\u679c\u4f60\u8981\u4fee\u6539\u591a\u6761\u76f8\u540c\u7684\u6587\u6863\uff0c\u5219\u9700\u8981\u8bbe\u7f6e multi \u53c2\u6570\u4e3a true\u3002 db.col.update({'title':'MongoDB \u6559\u7a0b'},{$set:{'title':'MongoDB'}},{multi:true}) \u64cd\u4f5c\u8fc7\u7a0b > db.col2.insert({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 'update \u65b9\u6cd5' ... }) WriteResult({ \"nInserted\" : 1 }) > db.col2.insert({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 'update \u65b9\u6cd5' ... }) WriteResult({ \"nInserted\" : 1 }) > show tables; col col2 test > db.col2.find() { \"_id\" : ObjectId(\"5c76067e8a8ce9812e5a5980\"), \"title\" : \"cmz noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"update \u65b9\u6cd5\" } { \"_id\" : ObjectId(\"5c7607388a8ce9812e5a5981\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"update \u65b9\u6cd5\" } { \"_id\" : ObjectId(\"5c7607398a8ce9812e5a5982\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"update \u65b9\u6cd5\" } # \u4fee\u6539 > db.col2.update({'title':'Books \u6559\u7a0b'},{$set:{'title':'cmz2 noteBooks'}},{multi:true}) WriteResult({ \"nMatched\" : 2, \"nUpserted\" : 0, \"nModified\" : 2 })","title":"4.1 update"},{"location":"linux/nosql/mongo/mongo.doc/#42-save","text":"\u4ee5\u4e0b\u5b9e\u4f8b\u4e2d\u6211\u4eec\u66ff\u6362\u4e86likes > use cmz switched to db cmz > db.col2.find() { \"_id\" : ObjectId(\"5c76067e8a8ce9812e5a5980\"), \"title\" : \"cmz noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"update \u65b9\u6cd5\" } { \"_id\" : ObjectId(\"5c7607388a8ce9812e5a5981\"), \"title\" : \"cmz2 noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\"], \"likes\" : \"update \u65b9\u6cd5\" } { \"_id\" : ObjectId(\"5c7607398a8ce9812e5a5982\"), \"title\" : \"cmz2 noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\"], \"likes\" : \"update \u65b9\u6cd5\" } # save \u64cd\u4f5c > db.col2.save({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 'save \u65b9\u6cd5' ... }) WriteResult({ \"nInserted\" : 1 }) > db.col2.find() { \"_id\" : ObjectId(\"5c76067e8a8ce9812e5a5980\"), \"title\" : \"cmz noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"update \u65b9\u6cd5\" } { \"_id\" : ObjectId(\"5c7607388a8ce9812e5a5981\"), \"title\" : \"cmz2 noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\"], \"likes\" : \"update \u65b9\u6cd5\" } { \"_id\" : ObjectId(\"5c7607398a8ce9812e5a5982\"), \"title\" : \"cmz2 noteBooks\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\"], \"likes\" : \"update \u65b9\u6cd5\" } { \"_id\" : ObjectId(\"5c7609352c2b43efe00307bb\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : \"save \u65b9\u6cd5\" } \u66f4\u591a\u64cd\u4f5c \u53ea\u66f4\u65b0\u7b2c\u4e00\u6761\u8bb0\u5f55\uff1a db . col . update ( { \"count\" : { $ gt : 1 } } , { $ set : { \"test2\" : \"OK\" } } ); \u5168\u90e8\u66f4\u65b0\uff1a db . col . update ( { \"count\" : { $ gt : 3 } } , { $ set : { \"test2\" : \"OK\" } }, false , true ); \u53ea\u6dfb\u52a0\u7b2c\u4e00\u6761\uff1a db . col . update ( { \"count\" : { $ gt : 4 } } , { $ set : { \"test5\" : \"OK\" } }, true , false ); \u5168\u90e8\u6dfb\u52a0\u8fdb\u53bb : db . col . update ( { \"count\" : { $ gt : 5 } } , { $ set : { \"test5\" : \"OK\" } }, true , true ); \u5168\u90e8\u66f4\u65b0\uff1a db . col . update ( { \"count\" : { $ gt : 15 } } , { $ inc : { \"count\" : 1 } }, false , true ); \u53ea\u66f4\u65b0\u7b2c\u4e00\u6761\u8bb0\u5f55\uff1a db . col . update ( { \"count\" : { $ gt : 10 } } , { $ inc : { \"count\" : 1 } }, false , false );","title":"4.2 save"},{"location":"linux/nosql/mongo/mongo.doc/#5","text":"","title":"5. \u67e5\u8be2\u64cd\u4f5c"},{"location":"linux/nosql/mongo/mongo.doc/#51","text":"\u6211\u4eec\u5728\u96c6\u5408 col \u4e2d\u5148\u63d2\u5165\u7684\u6570\u636e\uff1a db.col.insert({title: 'Books \u6559\u7a0b', description: '\u7b14\u8bb0', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['mongodb', 'database', 'NoSQL'], likes: 88 }) \u64cd\u4f5c\u8fc7\u7a0b > db.col.insert({title: 'Books \u6559\u7a0b', ... description: '\u7b14\u8bb0', ... by: 'cmz', ... url: 'https://caimengzhi.github.io/books', ... tags: ['mongodb', 'database', 'NoSQL'], ... likes: 88 ... }) WriteResult({ \"nInserted\" : 1 }) > db.col.find() { \"_id\" : ObjectId(\"5c761420fec6d367f28a65d4\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\": \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } > db.col.find().pretty() { \"_id\" : ObjectId(\"5c761420fec6d367f28a65d4\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 } \u9664\u4e86 find() \u65b9\u6cd5\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a findOne() \u65b9\u6cd5\uff0c\u5b83\u53ea\u8fd4\u56de\u4e00\u4e2a\u6587\u6863\u3002 > db.col.findOne() { \"_id\" : ObjectId(\"5c761420fec6d367f28a65d4\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 }","title":"5.1 \u57fa\u672c\u67e5\u8be2"},{"location":"linux/nosql/mongo/mongo.doc/#52","text":"\u67e5\u8be2\u8bed\u53e5\u6761\u4ef6 \u64cd\u4f5c \u683c\u5f0f \u8303\u4f8b RDBMS\u4e2d\u7684\u7c7b\u4f3c\u8bed\u53e5 \u7b49\u4e8e { : } db.col.find({\"by\":\"cmz\"}).pretty() where by = 'cmz' \u5c0f\u4e8e { :{$lt: }} db.col.find({\"likes\":{$lt:50}}).pretty() where likes < 50 \u5c0f\u4e8e\u6216\u7b49\u4e8e { :{$lte: }} db.col.find({\"likes\":{$lte:50}}).pretty() where likes <= 50 \u5927\u4e8e { :{$gt: }} db.col.find({\"likes\":{$gt:50}}).pretty() where likes > 50 \u5927\u4e8e\u6216\u7b49\u4e8e { :{$gte: }} db.col.find({\"likes\":{$gte:50}}).pretty() where likes >= 50 \u4e0d\u7b49\u4e8e { :{$ne: }} db.col.find({\"likes\":{$ne:50}}).pretty() where likes != 50","title":"5.2 \u67e5\u8be2\u8bed\u53e5\u6761\u4ef6"},{"location":"linux/nosql/mongo/mongo.doc/#53-and","text":"MongoDB \u7684 find() \u65b9\u6cd5\u53ef\u4ee5\u4f20\u5165\u591a\u4e2a\u952e(key)\uff0c\u6bcf\u4e2a\u952e(key)\u4ee5\u9017\u53f7\u9694\u5f00\uff0c\u5373\u5e38\u89c4 SQL \u7684 AND \u6761\u4ef6\u3002\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a >db.col.find({key1:value1, key2:value2}).pretty() \u64cd\u4f5c\u8fc7\u7a0b > db.col.find({\"by\":\"cmz\", \"title\":\"Books \u6559\u7a0b\"}).pretty() { \"_id\" : ObjectId(\"5c761420fec6d367f28a65d4\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 }","title":"5.3 AND\u6761\u4ef6"},{"location":"linux/nosql/mongo/mongo.doc/#54-or","text":"MongoDB OR \u6761\u4ef6\u8bed\u53e5\u4f7f\u7528\u4e86\u5173\u952e\u5b57 $or,\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a >db.col.find( { $or: [ {key1: value1}, {key2:value2} ] } ).pretty() \u64cd\u4f5c\u8fc7\u7a0b > db.col.find({$or:[{\"by\":\"cmz\"},{\"title\": \"Books \u6559\u7a0b\"}]}).pretty() { \"_id\" : ObjectId(\"5c761420fec6d367f28a65d4\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 }","title":"5.4 OR\u6761\u4ef6"},{"location":"linux/nosql/mongo/mongo.doc/#55-and-or","text":"\u4ee5\u4e0b\u5b9e\u4f8b\u6f14\u793a\u4e86 AND \u548c OR \u8054\u5408\u4f7f\u7528\uff0c\u7c7b\u4f3c\u5e38\u89c4 SQL \u8bed\u53e5\u4e3a\uff1a 'where likes>50 AND (by = 'cmz' OR title = 'Books \u6559\u7a0b')' > db.col.find({\"likes\": {$gt:50}, $or: [{\"by\": \"cmz\"},{\"title\": \"Books \u6559\u7a0b\"}]}).pretty() { \"_id\" : ObjectId(\"5c761420fec6d367f28a65d4\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"\u7b14\u8bb0\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 88 }","title":"5.5 AND \u548c OR\u6761\u4ef6"},{"location":"linux/nosql/mongo/mongo.fuzzy_enquiry/","text":"MongoDB \u6a21\u7cca\u67e5\u8be2 1. \u63d2\u5165\u6570\u636e \u00b6 db.col.remove({}) db.col.find() db.col.insert({ title: 'Books \u6559\u7a0b', description: 'Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['Java', 'database', 'web'], likes: 200 }) db.col.insert({ title: 'Books \u6559\u7a0b', description: 'Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['Python', 'database', 'web'], likes: 150 }) db.col.insert({ title: 'Books \u6559\u7a0b', description: 'MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['mongodb', 'database', 'NoSQL'], likes: 100 }) 2. \u5305\u542b\u67e5\u8be2 \u00b6 \u67e5\u8be2 description \u5305\u542b\"MongoDB\"\u5b57\u7684\u6587\u6863\uff1a > db.col.find({description:/MongoDB/}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65da\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } 3. \u4ee5\u4ec0\u4e48\u5f00\u5934\u67e5\u8be2 \u00b6 \u67e5\u8be2 description \u5b57\u6bb5\u4ee5\"Python\"\u5b57\u5f00\u5934\u7684\u6587\u6863\uff1a > db.col.find({description:/^Python/}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d9\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } 4. \u5df2\u4ec0\u4e48\u7ed3\u5c3e\u67e5\u8be2 \u00b6 \u67e5\u8be2 title\u5b57\u6bb5\u4ee5\"\u6559\"\u5b57\u7ed3\u5c3e\u7684\u6587\u6863\uff1a > db.col.find({description:/\u8bed\u8a00$/}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d9\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 }","title":"06. MonogoDB \u6a21\u7cca\u67e5\u8be2"},{"location":"linux/nosql/mongo/mongo.fuzzy_enquiry/#1","text":"db.col.remove({}) db.col.find() db.col.insert({ title: 'Books \u6559\u7a0b', description: 'Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['Java', 'database', 'web'], likes: 200 }) db.col.insert({ title: 'Books \u6559\u7a0b', description: 'Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['Python', 'database', 'web'], likes: 150 }) db.col.insert({ title: 'Books \u6559\u7a0b', description: 'MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['mongodb', 'database', 'NoSQL'], likes: 100 })","title":"1. \u63d2\u5165\u6570\u636e"},{"location":"linux/nosql/mongo/mongo.fuzzy_enquiry/#2","text":"\u67e5\u8be2 description \u5305\u542b\"MongoDB\"\u5b57\u7684\u6587\u6863\uff1a > db.col.find({description:/MongoDB/}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65da\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 }","title":"2.  \u5305\u542b\u67e5\u8be2"},{"location":"linux/nosql/mongo/mongo.fuzzy_enquiry/#3","text":"\u67e5\u8be2 description \u5b57\u6bb5\u4ee5\"Python\"\u5b57\u5f00\u5934\u7684\u6587\u6863\uff1a > db.col.find({description:/^Python/}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d9\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 }","title":"3. \u4ee5\u4ec0\u4e48\u5f00\u5934\u67e5\u8be2"},{"location":"linux/nosql/mongo/mongo.fuzzy_enquiry/#4","text":"\u67e5\u8be2 title\u5b57\u6bb5\u4ee5\"\u6559\"\u5b57\u7ed3\u5c3e\u7684\u6587\u6863\uff1a > db.col.find({description:/\u8bed\u8a00$/}) { \"_id\" : ObjectId(\"5c761ba5fec6d367f28a65d9\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 }","title":"4. \u5df2\u4ec0\u4e48\u7ed3\u5c3e\u67e5\u8be2"},{"location":"linux/nosql/mongo/mongo.index/","text":"MongoDB \u57fa\u672c\u4ecb\u7ecd 1. \u4ecb\u7ecd \u00b6 1.1 MongoDB \u00b6 MongoDB \u662f\u7531C++\u8bed\u8a00\u7f16\u5199\u7684\uff0c\u662f\u4e00\u4e2a\u57fa\u4e8e\u5206\u5e03\u5f0f\u6587\u4ef6\u5b58\u50a8\u7684\u5f00\u6e90\u6570\u636e\u5e93\u7cfb\u7edf\u3002\u5728\u9ad8\u8d1f\u8f7d\u7684\u60c5\u51b5\u4e0b\uff0c\u6dfb\u52a0\u66f4\u591a\u7684\u8282\u70b9\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u670d\u52a1\u5668\u6027\u80fd\u3002MongoDB \u65e8\u5728\u4e3aWEB\u5e94\u7528\u63d0\u4f9b\u53ef\u6269\u5c55\u7684\u9ad8\u6027\u80fd\u6570\u636e\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\u3002 MongoDB \u5c06\u6570\u636e\u5b58\u50a8\u4e3a\u4e00\u4e2a\u6587\u6863\uff0c\u6570\u636e\u7ed3\u6784\u7531\u952e\u503c(key=>value)\u5bf9\u7ec4\u6210\u3002MongoDB \u6587\u6863\u7c7b\u4f3c\u4e8e JSON \u5bf9\u8c61\u3002\u5b57\u6bb5\u503c\u53ef\u4ee5\u5305\u542b\u5176\u4ed6\u6587\u6863\uff0c\u6570\u7ec4\u53ca\u6587\u6863\u6570\u7ec4\u3002 1.2 \u7279\u70b9 \u00b6 MongoDB \u662f\u4e00\u4e2a\u9762\u5411\u6587\u6863\u5b58\u50a8\u7684\u6570\u636e\u5e93\uff0c\u64cd\u4f5c\u8d77\u6765\u6bd4\u8f83\u7b80\u5355\u548c\u5bb9\u6613\u3002 \u4f60\u53ef\u4ee5\u5728MongoDB\u8bb0\u5f55\u4e2d\u8bbe\u7f6e\u4efb\u4f55\u5c5e\u6027\u7684\u7d22\u5f15 (\u5982\uff1aFirstName=\"Sameer\",Address=\"8 Gandhi Road\")\u6765\u5b9e\u73b0\u66f4\u5feb\u7684\u6392\u5e8f\u3002 \u4f60\u53ef\u4ee5\u901a\u8fc7\u672c\u5730\u6216\u8005\u7f51\u7edc\u521b\u5efa\u6570\u636e\u955c\u50cf\uff0c\u8fd9\u4f7f\u5f97MongoDB\u6709\u66f4\u5f3a\u7684\u6269\u5c55\u6027\u3002 \u5982\u679c\u8d1f\u8f7d\u7684\u589e\u52a0\uff08\u9700\u8981\u66f4\u591a\u7684\u5b58\u50a8\u7a7a\u95f4\u548c\u66f4\u5f3a\u7684\u5904\u7406\u80fd\u529b\uff09 \uff0c\u5b83\u53ef\u4ee5\u5206\u5e03\u5728\u8ba1\u7b97\u673a\u7f51\u7edc\u4e2d\u7684\u5176\u4ed6\u8282\u70b9\u4e0a\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u5206\u7247\u3002 Mongo\u652f\u6301\u4e30\u5bcc\u7684\u67e5\u8be2\u8868\u8fbe\u5f0f\u3002\u67e5\u8be2\u6307\u4ee4\u4f7f\u7528JSON\u5f62\u5f0f\u7684\u6807\u8bb0\uff0c\u53ef\u8f7b\u6613\u67e5\u8be2\u6587\u6863\u4e2d\u5185\u5d4c\u7684\u5bf9\u8c61\u53ca\u6570\u7ec4\u3002 MongoDb \u4f7f\u7528update()\u547d\u4ee4\u53ef\u4ee5\u5b9e\u73b0\u66ff\u6362\u5b8c\u6210\u7684\u6587\u6863\uff08\u6570\u636e\uff09\u6216\u8005\u4e00\u4e9b\u6307\u5b9a\u7684\u6570\u636e\u5b57\u6bb5 \u3002 Mongodb\u4e2d\u7684Map/reduce\u4e3b\u8981\u662f\u7528\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u6279\u91cf\u5904\u7406\u548c\u805a\u5408\u64cd\u4f5c\u3002 Map\u548cReduce\u3002Map\u51fd\u6570\u8c03\u7528emit(key,value)\u904d\u5386\u96c6\u5408\u4e2d\u6240\u6709\u7684\u8bb0\u5f55\uff0c\u5c06key\u4e0evalue\u4f20\u7ed9Reduce\u51fd\u6570\u8fdb\u884c\u5904\u7406\u3002 Map\u51fd\u6570\u548cReduce\u51fd\u6570\u662f\u4f7f\u7528Javascript\u7f16\u5199\u7684\uff0c\u5e76\u53ef\u4ee5\u901a\u8fc7db.runCommand\u6216mapreduce\u547d\u4ee4\u6765\u6267\u884cMapReduce\u64cd\u4f5c\u3002 GridFS\u662fMongoDB\u4e2d\u7684\u4e00\u4e2a\u5185\u7f6e\u529f\u80fd\uff0c\u53ef\u4ee5\u7528\u4e8e\u5b58\u653e\u5927\u91cf\u5c0f\u6587\u4ef6\u3002 MongoDB\u5141\u8bb8\u5728\u670d\u52a1\u7aef\u6267\u884c\u811a\u672c\uff0c\u53ef\u4ee5\u7528Javascript\u7f16\u5199\u67d0\u4e2a\u51fd\u6570\uff0c\u76f4\u63a5\u5728\u670d\u52a1\u7aef\u6267\u884c\uff0c\u4e5f\u53ef\u4ee5\u628a\u51fd\u6570\u7684\u5b9a\u4e49\u5b58\u50a8\u5728\u670d\u52a1\u7aef\uff0c\u4e0b\u6b21\u76f4\u63a5\u8c03\u7528\u5373\u53ef\u3002 MongoDB\u652f\u6301\u5404\u79cd\u7f16\u7a0b\u8bed\u8a00:RUBY\uff0cPYTHON\uff0cJAVA\uff0cC++\uff0cPHP\uff0cC#\u7b49\u591a\u79cd\u8bed\u8a00\u3002 MongoDB\u5b89\u88c5\u7b80\u5355\u3002 2. \u5b89\u88c5 \u00b6 2.1 \u4e0b\u8f7d\u5b89\u88c5 \u00b6 \u4e0b\u8f7d\u5730\u5740: https://www.mongodb.com/download-center/community [root@leco src]# wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-4.0.6.tgz --2019-02-27 09:42:36-- https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-4.0.6.tgz Resolving fastdl.mongodb.org... 13.33.186.136, 13.33.186.26, 13.33.186.247, ... Connecting to fastdl.mongodb.org|13.33.186.136|:443... connected. HTTP request sent, awaiting response... 200 OK Length: 73265692 (70M) [application/x-gzip] Saving to: \u201cmongodb-linux-x86_64-4.0.6.tgz\u201d 100%[=============================================================================================================================================>] 73,265,692 1021K/s in 98s 2019-02-27 09:44:15 (733 KB/s) - \u201cmongodb-linux-x86_64-4.0.6.tgz\u201d saved [73265692/73265692] 2.2 \u5b89\u88c5 \u00b6 [root@leco src]# tar xf mongodb-linux-x86_64-4.0.6.tgz [root@leco src]# cd mongodb-linux-x86_64-4.0.6 [root@leco mongodb-linux-x86_64-4.0.6]# ls bin LICENSE-Community.txt MPL-2 README THIRD-PARTY-NOTICES [root@leco src]# mv mongodb-linux-x86_64-4.0.6 /usr/local/ [root@leco src]# cd /usr/local/ [root@leco local]# ln -sf mongodb-linux-x86_64-4.0.6/ mongo \u6ce8\u610f \u6211\u4f7f\u7528\u7684\u662f\u4e8c\u8fdb\u5236\u5305\uff0c\u76f4\u63a5\u89e3\u538b\u5373\u53ef\u4f7f\u7528\uff0c\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u60c5\u51b5\u5b89\u88c5\u65b9\u5f0f\uff0c 1. \u4e8c\u8fdb\u5236\u5b89\u88c5 2. \u5728\u7ebf\u5b89\u88c5 3. \u79bb\u7ebf\u5b89\u88c5 2.3 \u6dfb\u52a0\u73af\u5883\u53d8\u91cf \u00b6 \u4e34\u65f6\u751f\u6548[\u91cd\u542f\u540e\u5c31\u6ca1\u4e86] [root@leco local]# export PATH=/usr/local/mongo/bin:$PATH \u6c38\u4e45\u751f\u6548 [root@leco mongo]# tail -2 /etc/profile # add by caimengzhi for mongodb 4.0 export PATH=/usr/local/mongo/bin:$PATH [root@leco mongo]# source /etc/profile 2.4 \u914d\u7f6e \u00b6 [root@leco ~]# cd /usr/local/mongo [root@leco mongo]# ls bin LICENSE-Community.txt MPL-2 README THIRD-PARTY-NOTICES [root@leco mongo]# mkdir conf [root@leco mongo]# mkdir -p /usr/local/mongodb/data/db [root@leco mongo]# mkdir -p /usr/local/mongodb/logs [root@leco mongo]# cd conf/ [root@leco conf]# vim mongodb.conf [root@leco conf]# cat mongodb.conf dbpath = /usr/local/mongodb/data/db logpath = /usr/local/mongodb/logs/mongodb.log port = 27017 fork = true bind_ip=0.0.0.0 [root@leco mongo]# tree . . \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 bsondump \u2502 \u251c\u2500\u2500 install_compass \u2502 \u251c\u2500\u2500 mongo \u2502 \u251c\u2500\u2500 mongod \u2502 \u251c\u2500\u2500 mongodump \u2502 \u251c\u2500\u2500 mongoexport \u2502 \u251c\u2500\u2500 mongofiles \u2502 \u251c\u2500\u2500 mongoimport \u2502 \u251c\u2500\u2500 mongoreplay \u2502 \u251c\u2500\u2500 mongorestore \u2502 \u251c\u2500\u2500 mongos \u2502 \u251c\u2500\u2500 mongostat \u2502 \u2514\u2500\u2500 mongotop \u251c\u2500\u2500 conf \u2502 \u2514\u2500\u2500 mongodb.conf \u251c\u2500\u2500 LICENSE-Community.txt \u251c\u2500\u2500 MPL-2 \u251c\u2500\u2500 README \u2514\u2500\u2500 THIRD-PARTY-NOTICES 2 directories, 18 file 2.5 \u542f\u52a8 \u00b6 [root@leco mongo]# mongod -f /usr/local/mongo/conf/mongodb.conf about to fork child process, waiting until server is ready for connections. forked process: 18924 child process started successfully, parent exiting [root@leco mongo]# ps axf|grep mongod 18963 pts/0 S+ 0:00 \\_ grep mongod 18924 ? Sl 0:00 mongod -f /usr/local/mongo/conf/mongodb.conf [root@leco mongo]# netstat -lnp|grep 27017 tcp 0 0 0.0.0.0:27017 0.0.0.0:* LISTEN 18924/mongod unix 2 [ ACC ] STREAM LISTENING 66911078 18924/mongod /tmp/mongodb-27017.sock [root@leco mongo]# \u914d\u7f6e\u6587\u4ef6\u89e3\u91ca dbpath = / usr / local / mongodb / data / db # \u6570\u636e\u6587\u4ef6\u5b58\u653e\u76ee\u5f55 logpath = / usr / local / mongodb / logs / mongodb . log # \u65e5\u5fd7\u6587\u4ef6\u5b58\u653e\u76ee\u5f55 port = 27017 # \u7aef\u53e3 fork = true # \u4ee5\u5b88\u62a4\u7a0b\u5e8f\u7684\u65b9\u5f0f\u542f\u7528\uff0c\u5373\u5728\u540e\u53f0\u8fd0\u884c bind_ip = 0.0 . 0.0 # \u5141\u8bb8\u6240\u6709\u7684\u8fde\u63a5 2.6 docker\u5b89\u88c5 \u00b6 docker pull mongo docker run -itd --name=mongo_test -p 27017:27017 mongo 3. \u6982\u5ff5\u4ecb\u7ecd \u00b6 \u5728mongodb\u4e2d\u57fa\u672c\u7684\u6982\u5ff5\u662f\u6587\u6863\u3001\u96c6\u5408\u3001\u6570\u636e\u5e93\uff0c\u5728\u5176\u4ed6NoSQL\u4e2d\u5bf9\u6bd4 SQL\u672f\u8bed/\u6982\u5ff5 MongoDB\u672f\u8bed/\u6982\u5ff5 \u89e3\u91ca/\u8bf4\u660e database database \u6570\u636e\u5e93 table collection \u6570\u636e\u5e93\u8868/\u96c6\u5408 row document \u6570\u636e\u8bb0\u5f55\u884c/\u6587\u6863 column field \u6570\u636e\u5b57\u6bb5/\u57df index index \u7d22\u5f15 table joins \u8868\u8fde\u63a5,MongoDB\u4e0d\u652f\u6301 primary key primary key \u4e3b\u952e,MongoDB\u81ea\u52a8\u5c06_id\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u4e3b\u952e 3.1 \u6570\u636e\u5e93 \u00b6 \u4e00\u4e2amongodb\u4e2d\u53ef\u4ee5\u5efa\u7acb\u591a\u4e2a\u6570\u636e\u5e93\u3002 MongoDB\u7684\u9ed8\u8ba4\u6570\u636e\u5e93\u4e3a\"db\"\uff0c\u8be5\u6570\u636e\u5e93\u5b58\u50a8\u5728data\u76ee\u5f55\u4e2d\u3002 MongoDB\u7684\u5355\u4e2a\u5b9e\u4f8b\u53ef\u4ee5\u5bb9\u7eb3\u591a\u4e2a\u72ec\u7acb\u7684\u6570\u636e\u5e93\uff0c\u6bcf\u4e00\u4e2a\u90fd\u6709\u81ea\u5df1\u7684\u96c6\u5408\u548c\u6743\u9650\uff0c\u4e0d\u540c\u7684\u6570\u636e\u5e93\u4e5f\u653e\u7f6e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u4e2d\u3002 \"show dbs\" \u547d\u4ee4\u53ef\u4ee5\u663e\u793a\u6240\u6709\u6570\u636e\u7684\u5217\u8868\u3002 [root@leco mongo]# mongo MongoDB shell version v4.0.6 sconnecting to: mongodb://127.0.0.1:27017/?gssapiServiceName=mongodb sho^HsImplicit session: session { \"id\" : UUID(\"6b210996-2e69-4e35-bd6d-7ee0a946cdc5\") } ^H^H^H^H^HMongoDB server version: 4.0.6 Welcome to the MongoDB shell. For interactive help, type \"help\". For more comprehensive documentation, see http://docs.mongodb.org/ Questions? Try the support group http://groups.google.com/group/mongodb-user Server has startup warnings: 2019-02-27T09:59:22.485+0800 I STORAGE [initandlisten] 2019-02-27T09:59:22.485+0800 I STORAGE [initandlisten] ** WARNING: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine 2019-02-27T09:59:22.485+0800 I STORAGE [initandlisten] ** See http://dochub.mongodb.org/core/prodnotes-filesystem 2019-02-27T09:59:23.449+0800 I CONTROL [initandlisten] 2019-02-27T09:59:23.449+0800 I CONTROL [initandlisten] ** WARNING: Access control is not enabled for the database. 2019-02-27T09:59:23.449+0800 I CONTROL [initandlisten] ** Read and write access to data and configuration is unrestricted. 2019-02-27T09:59:23.449+0800 I CONTROL [initandlisten] ** WARNING: You are running this process as the root user, which is not recommended. 2019-02-27T09:59:23.449+0800 I CONTROL [initandlisten] 2019-02-27T09:59:23.450+0800 I CONTROL [initandlisten] 2019-02-27T09:59:23.450+0800 I CONTROL [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/enabled is 'always'. 2019-02-27T09:59:23.450+0800 I CONTROL [initandlisten] ** We suggest setting it to 'never' 2019-02-27T09:59:23.451+0800 I CONTROL [initandlisten] 2019-02-27T09:59:23.451+0800 I CONTROL [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/defrag is 'always'. 2019-02-27T09:59:23.451+0800 I CONTROL [initandlisten] ** We suggest setting it to 'never' 2019-02-27T09:59:23.451+0800 I CONTROL [initandlisten] 2019-02-27T09:59:23.451+0800 I CONTROL [initandlisten] ** WARNING: soft rlimits too low. rlimits set to 7424 processes, 65535 files. Number of processes should be at least 32767.5 : 0.5 times number of files. 2019-02-27T09:59:23.451+0800 I CONTROL [initandlisten] > show dbs; admin 0.000GB config 0.000GB local 0.000GB \u6267\u884c \"db\" \u547d\u4ee4\u53ef\u4ee5\u663e\u793a\u5f53\u524d\u6570\u636e\u5e93\u5bf9\u8c61\u6216\u96c6\u5408\u3002\u8fd0\u884c\"use\"\u547d\u4ee4\uff0c\u53ef\u4ee5\u8fde\u63a5\u5230\u4e00\u4e2a\u6307\u5b9a\u7684\u6570\u636e\u5e93\u3002 > db test > use local switched to db local > db local \u4ee5\u4e0a\u5b9e\u4f8b\u547d\u4ee4\u4e2d\uff0c\"local\" \u662f\u4f60\u8981\u94fe\u63a5\u7684\u6570\u636e\u5e93\u3002 3.2 \u7279\u6b8a\u5e93 \u00b6 admin\uff1a \u4ece\u6743\u9650\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u8fd9\u662f\"root\"\u6570\u636e\u5e93\u3002\u8981\u662f\u5c06\u4e00\u4e2a\u7528\u6237\u6dfb\u52a0\u5230\u8fd9\u4e2a\u6570\u636e\u5e93\uff0c\u8fd9\u4e2a\u7528\u6237\u81ea\u52a8\u7ee7\u627f\u6240\u6709\u6570\u636e\u5e93\u7684\u6743\u9650\u3002\u4e00\u4e9b\u7279\u5b9a\u7684\u670d\u52a1\u5668\u7aef\u547d\u4ee4\u4e5f\u53ea\u80fd\u4ece\u8fd9\u4e2a\u6570\u636e\u5e93\u8fd0\u884c\uff0c\u6bd4\u5982\u5217\u51fa\u6240\u6709\u7684\u6570\u636e\u5e93\u6216\u8005\u5173\u95ed\u670d\u52a1\u5668\u3002 local: \u8fd9\u4e2a\u6570\u636e\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u590d\u5236\uff0c\u53ef\u4ee5\u7528\u6765\u5b58\u50a8\u9650\u4e8e\u672c\u5730\u5355\u53f0\u670d\u52a1\u5668\u7684\u4efb\u610f\u96c6\u5408 config: \u5f53Mongo\u7528\u4e8e\u5206\u7247\u8bbe\u7f6e\u65f6\uff0cconfig\u6570\u636e\u5e93\u5728\u5185\u90e8\u4f7f\u7528\uff0c\u7528\u4e8e\u4fdd\u5b58\u5206\u7247\u7684\u76f8\u5173\u4fe1\u606f\u3002 3.3 \u6587\u6863 \u00b6 \u6587\u6863\u662f\u4e00\u7ec4\u952e\u503c(key-value)\u5bf9(\u5373BSON)\u3002MongoDB \u7684\u6587\u6863\u4e0d\u9700\u8981\u8bbe\u7f6e\u76f8\u540c\u7684\u5b57\u6bb5\uff0c\u5e76\u4e14\u76f8\u540c\u7684\u5b57\u6bb5\u4e0d\u9700\u8981\u76f8\u540c\u7684\u6570\u636e\u7c7b\u578b\uff0c\u8fd9\u4e0e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u6709\u5f88\u5927\u7684\u533a\u522b\uff0c\u4e5f\u662f MongoDB \u975e\u5e38\u7a81\u51fa\u7684\u7279\u70b9\u3002 \u4e00\u4e2a\u7b80\u5355\u7684\u6587\u6863\u4f8b\u5b50\u5982\u4e0b\uff1a {\"site\":\"https://caimengzhi.github.io/books/\", \"name\":\"cmz\"} DBMS \u4e0e MongoDB \u5bf9\u5e94\u7684\u672f\u8bed\uff1a RDBMS MongoDB \u6570\u636e\u5e93 \u6570\u636e\u5e93 \u8868\u683c \u96c6\u5408 \u884c \u6587\u6863 \u5217 \u5b57\u6bb5 \u8868\u8054\u5408 \u5d4c\u5165\u6587\u6863 \u4e3b\u952e \u4e3b\u952e (MongoDB \u63d0\u4f9b\u4e86 key \u4e3a _id ) \u6ce8\u610f 1. \u6587\u6863\u4e2d\u7684\u952e / \u503c\u5bf9\u662f\u6709\u5e8f\u7684\u3002 2. \u6587\u6863\u4e2d\u7684\u503c\u4e0d\u4ec5\u53ef\u4ee5\u662f\u5728\u53cc\u5f15\u53f7\u91cc\u9762\u7684\u5b57\u7b26\u4e32\uff0c\u8fd8\u53ef\u4ee5\u662f\u5176\u4ed6\u51e0\u79cd\u6570\u636e 3. \u7c7b\u578b\uff08\u751a\u81f3\u53ef\u4ee5\u662f\u6574\u4e2a\u5d4c\u5165\u7684\u6587\u6863 ) \u3002 4. MongoDB\u533a\u5206\u7c7b\u578b\u548c\u5927\u5c0f\u5199 \u3002 5. MongoDB\u7684\u6587\u6863\u4e0d\u80fd\u6709\u91cd\u590d\u7684\u952e \u3002 6. \u6587\u6863\u7684\u952e\u662f\u5b57\u7b26\u4e32\u3002\u9664\u4e86\u5c11\u6570\u4f8b\u5916\u60c5\u51b5\uff0c\u952e\u53ef\u4ee5\u4f7f\u7528\u4efb\u610f UTF - 8 \u5b57\u7b26\u3002 7. \u952e\u4e0d\u80fd\u542b\u6709 \\ 0 ( \u7a7a\u5b57\u7b26 ) \u3002\u8fd9\u4e2a\u5b57\u7b26\u7528\u6765\u8868\u793a\u952e\u7684\u7ed3\u5c3e\u3002 8. . \u548c$\u6709\u7279\u522b\u7684\u610f\u4e49\uff0c\u53ea\u6709\u5728\u7279\u5b9a\u73af\u5883\u4e0b\u624d\u80fd\u4f7f\u7528\u3002 9. \u4ee5\u4e0b\u5212\u7ebf \"_\" \u5f00\u5934\u7684\u952e\u662f\u4fdd\u7559\u7684 ( \u4e0d\u662f\u4e25\u683c\u8981\u6c42\u7684 ) 3.4 \u96c6\u5408 \u00b6 3.4.1 \u4ecb\u7ecd \u00b6 \u96c6\u5408\u5c31\u662f MongoDB \u6587\u6863\u7ec4\uff0c\u7c7b\u4f3c\u4e8e RDBMS \uff08\u5173\u7cfb\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff1aRelational Database Management System)\u4e2d\u7684\u8868\u683c\u3002\u96c6\u5408\u5b58\u5728\u4e8e\u6570\u636e\u5e93\u4e2d\uff0c\u96c6\u5408\u6ca1\u6709\u56fa\u5b9a\u7684\u7ed3\u6784\uff0c\u8fd9\u610f\u5473\u7740\u4f60\u5728\u5bf9\u96c6\u5408\u53ef\u4ee5\u63d2\u5165\u4e0d\u540c\u683c\u5f0f\u548c\u7c7b\u578b\u7684\u6570\u636e\uff0c\u4f46\u901a\u5e38\u60c5\u51b5\u4e0b\u6211\u4eec\u63d2\u5165\u96c6\u5408\u7684\u6570\u636e\u90fd\u4f1a\u6709\u4e00\u5b9a\u7684\u5173\u8054\u6027\u3002 \u6bd4\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u4ee5\u4e0b\u4e0d\u540c\u6570\u636e\u7ed3\u6784\u7684\u6587\u6863\u63d2\u5165\u5230\u96c6\u5408\u4e2d\uff1a {\"site\":\"https://caimengzhi.github.io/books/\"} {\"site\":\"https://caimengzhi.github.io/books/\",\"name\":\"cmz\"} {\"site\":\"https://caimengzhi.github.io/books/\",\"name\":\"cmz\",\"num\":66} \u5f53\u7b2c\u4e00\u4e2a\u6587\u6863\u63d2\u5165\u65f6\uff0c\u96c6\u5408\u5c31\u4f1a\u88ab\u521b\u5efa\u3002 3.4.2 \u5408\u6cd5\u7684\u96c6\u5408\u540d \u00b6 \u96c6\u5408\u540d\u4e0d\u80fd\u662f\u7a7a\u5b57\u7b26\u4e32\"\"\u3002 \u96c6\u5408\u540d\u4e0d\u80fd\u542b\u6709\\0\u5b57\u7b26\uff08\u7a7a\u5b57\u7b26)\uff0c\u8fd9\u4e2a\u5b57\u7b26\u8868\u793a\u96c6\u5408\u540d\u7684\u7ed3\u5c3e\u3002 \u96c6\u5408\u540d\u4e0d\u80fd\u4ee5\"system.\"\u5f00\u5934\uff0c\u8fd9\u662f\u4e3a\u7cfb\u7edf\u96c6\u5408\u4fdd\u7559\u7684\u524d\u7f00\u3002 \u7528\u6237\u521b\u5efa\u7684\u96c6\u5408\u540d\u5b57\u4e0d\u80fd\u542b\u6709\u4fdd\u7559\u5b57\u7b26\u3002\u6709\u4e9b\u9a71\u52a8\u7a0b\u5e8f\u7684\u786e\u652f\u6301\u5728\u96c6\u5408\u540d\u91cc\u9762\u5305\u542b\uff0c\u8fd9\u662f\u56e0\u4e3a\u67d0\u4e9b\u7cfb\u7edf\u751f\u6210\u7684\u96c6\u5408\u4e2d\u5305\u542b\u8be5\u5b57\u7b26\u3002\u9664\u975e\u4f60\u8981\u8bbf\u95ee\u8fd9\u79cd\u7cfb\u7edf\u521b\u5efa\u7684\u96c6\u5408\uff0c\u5426\u5219\u5343\u4e07\u4e0d\u8981\u5728\u540d\u5b57\u91cc\u51fa\u73b0$\u3002\u3000 3.5 \u5143\u6570\u636e \u00b6 \u6570\u636e\u5e93\u7684\u4fe1\u606f\u662f\u5b58\u50a8\u5728\u96c6\u5408\u4e2d\u3002\u5b83\u4eec\u4f7f\u7528\u4e86\u7cfb\u7edf\u7684\u547d\u540d\u7a7a\u95f4\uff1a dbname.system.* 4 \u6570\u636e\u7c7b\u578b \u00b6 \u4e0b\u8868\u4e3aMongoDB\u4e2d\u5e38\u7528\u7684\u51e0\u79cd\u6570\u636e\u7c7b\u578b\u3002 \u6570\u636e\u7c7b\u578b \u63cf\u8ff0 String \u5b57\u7b26\u4e32\u3002\u5b58\u50a8\u6570\u636e\u5e38\u7528\u7684\u6570\u636e\u7c7b\u578b\u3002\u5728 MongoDB \u4e2d\uff0cUTF-8 \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u624d\u662f\u5408\u6cd5\u7684\u3002 Integer \u6574\u578b\u6570\u503c\u3002\u7528\u4e8e\u5b58\u50a8\u6570\u503c\u3002\u6839\u636e\u4f60\u6240\u91c7\u7528\u7684\u670d\u52a1\u5668\uff0c\u53ef\u5206\u4e3a 32 \u4f4d\u6216 64 \u4f4d\u3002 Boolean \u5e03\u5c14\u503c\u3002\u7528\u4e8e\u5b58\u50a8\u5e03\u5c14\u503c\uff08\u771f/\u5047\uff09\u3002 Double \u53cc\u7cbe\u5ea6\u6d6e\u70b9\u503c\u3002\u7528\u4e8e\u5b58\u50a8\u6d6e\u70b9\u503c\u3002 Min/Max keys \u5c06\u4e00\u4e2a\u503c\u4e0e BSON\uff08\u4e8c\u8fdb\u5236\u7684 JSON\uff09\u5143\u7d20\u7684\u6700\u4f4e\u503c\u548c\u6700\u9ad8\u503c\u76f8\u5bf9\u6bd4\u3002 Array \u7528\u4e8e\u5c06\u6570\u7ec4\u6216\u5217\u8868\u6216\u591a\u4e2a\u503c\u5b58\u50a8\u4e3a\u4e00\u4e2a\u952e\u3002 Timestamp \u65f6\u95f4\u6233\u3002\u8bb0\u5f55\u6587\u6863\u4fee\u6539\u6216\u6dfb\u52a0\u7684\u5177\u4f53\u65f6\u95f4\u3002 Object \u7528\u4e8e\u5185\u5d4c\u6587\u6863\u3002 Null \u7528\u4e8e\u521b\u5efa\u7a7a\u503c\u3002 Symbol \u7b26\u53f7\u3002\u8be5\u6570\u636e\u7c7b\u578b\u57fa\u672c\u4e0a\u7b49\u540c\u4e8e\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u4f46\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u4e00\u822c\u7528\u4e8e\u91c7\u7528\u7279\u6b8a\u7b26\u53f7\u7c7b\u578b\u7684\u8bed\u8a00\u3002 Date \u65e5\u671f\u65f6\u95f4\u3002\u7528 UNIX \u65f6\u95f4\u683c\u5f0f\u6765\u5b58\u50a8\u5f53\u524d\u65e5\u671f\u6216\u65f6\u95f4\u3002\u4f60\u53ef\u4ee5\u6307\u5b9a\u81ea\u5df1\u7684\u65e5\u671f\u65f6\u95f4\uff1a\u521b\u5efa Date \u5bf9\u8c61\uff0c\u4f20\u5165\u5e74\u6708\u65e5\u4fe1\u606f\u3002 Object ID \u5bf9\u8c61 ID\u3002\u7528\u4e8e\u521b\u5efa\u6587\u6863\u7684 ID\u3002 Binary Data \u4e8c\u8fdb\u5236\u6570\u636e\u3002\u7528\u4e8e\u5b58\u50a8\u4e8c\u8fdb\u5236\u6570\u636e\u3002 Code \u4ee3\u7801\u7c7b\u578b\u3002\u7528\u4e8e\u5728\u6587\u6863\u4e2d\u5b58\u50a8 JavaScript \u4ee3\u7801\u3002 Regular expression \u6b63\u5219\u8868\u8fbe\u5f0f\u7c7b\u578b\u3002\u7528\u4e8e\u5b58\u50a8\u6b63\u5219\u8868\u8fbe\u5f0f\u3002 4.1 ObjectId \u00b6 ObjectId \u7c7b\u4f3c\u552f\u4e00\u4e3b\u952e\uff0c\u53ef\u4ee5\u5f88\u5feb\u7684\u53bb\u751f\u6210\u548c\u6392\u5e8f\uff0c\u5305\u542b 12 bytes\uff0c\u542b\u4e49\u662f\uff1a \u524d 4 \u4e2a\u5b57\u8282\u8868\u793a\u521b\u5efa unix \u65f6\u95f4\u6233,\u683c\u6797\u5c3c\u6cbb\u65f6\u95f4 UTC \u65f6\u95f4\uff0c\u6bd4\u5317\u4eac\u65f6\u95f4\u665a\u4e86 8 \u4e2a\u5c0f\u65f6 \u63a5\u4e0b\u6765\u7684 3 \u4e2a\u5b57\u8282\u662f\u673a\u5668\u6807\u8bc6\u7801 \u7d27\u63a5\u7684\u4e24\u4e2a\u5b57\u8282\u7531\u8fdb\u7a0b id \u7ec4\u6210 PID \u6700\u540e\u4e09\u4e2a\u5b57\u8282\u662f\u968f\u673a\u6570 0|1|2|3|4|5|6|7|8|9|10|11 | | | \u65f6\u95f4\u6233 |\u673a\u5668 |PID|\u8ba1\u6570\u5668 MongoDB \u4e2d\u5b58\u50a8\u7684\u6587\u6863\u5fc5\u987b\u6709\u4e00\u4e2a _id \u952e\u3002\u8fd9\u4e2a\u952e\u7684\u503c\u53ef\u4ee5\u662f\u4efb\u4f55\u7c7b\u578b\u7684\uff0c\u9ed8\u8ba4\u662f\u4e2a ObjectId \u5bf9\u8c61 \u7531\u4e8e ObjectId \u4e2d\u4fdd\u5b58\u4e86\u521b\u5efa\u7684\u65f6\u95f4\u6233\uff0c\u6240\u4ee5\u4f60\u4e0d\u9700\u8981\u4e3a\u4f60\u7684\u6587\u6863\u4fdd\u5b58\u65f6\u95f4\u6233\u5b57\u6bb5\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7 getTimestamp \u51fd\u6570\u6765\u83b7\u53d6\u6587\u6863\u7684\u521b\u5efa\u65f6\u95f4: > var newObject = ObjectId() > newObject.getTimestamp() ISODate(\"2019-02-27T02:24:17Z\") ObjectId \u8f6c\u4e3a\u5b57\u7b26\u4e32 > newObject.str 5c75f4d1970254564966ebd4 4.2 \u5b57\u7b26\u4e32 \u00b6 BSON \u5b57\u7b26\u4e32\u90fd\u662f UTF-8 \u7f16\u7801\u3002 4.3 \u65f6\u95f4\u6233 \u00b6 BSON \u6709\u4e00\u4e2a\u7279\u6b8a\u7684\u65f6\u95f4\u6233\u7c7b\u578b\u7528\u4e8e MongoDB \u5185\u90e8\u4f7f\u7528\uff0c\u4e0e\u666e\u901a\u7684 \u65e5\u671f \u7c7b\u578b\u4e0d\u76f8\u5173\u3002 \u65f6\u95f4\u6233\u503c\u662f\u4e00\u4e2a 64 \u4f4d\u7684\u503c\u3002\u5176\u4e2d\uff1a \u524d32\u4f4d\u662f\u4e00\u4e2a time_t \u503c\uff08\u4e0eUnix\u65b0\u7eaa\u5143\u76f8\u5dee\u7684\u79d2\u6570\uff09 \u540e32\u4f4d\u662f\u5728\u67d0\u79d2\u4e2d\u64cd\u4f5c\u7684\u4e00\u4e2a\u9012\u589e\u7684\u5e8f\u6570 \u5355\u4e2a mongod \u5b9e\u4f8b\u4e2d\uff0c\u65f6\u95f4\u6233\u503c\u901a\u5e38\u662f\u552f\u4e00\u7684\u3002\u5728\u590d\u5236\u96c6\u4e2d\uff0c oplog \u6709\u4e00\u4e2a ts \u5b57\u6bb5\u3002\u8fd9\u4e2a\u5b57\u6bb5\u4e2d\u7684\u503c\u4f7f\u7528BSON\u65f6\u95f4\u6233\u8868\u793a\u4e86\u64cd\u4f5c\u65f6\u95f4\u3002 4.4 \u65e5\u671f \u00b6 \u8868\u793a\u5f53\u524d\u8ddd\u79bb Unix\u65b0\u7eaa\u5143\uff081970\u5e741\u67081\u65e5\uff09\u7684\u6beb\u79d2\u6570\u3002\u65e5\u671f\u7c7b\u578b\u662f\u6709\u7b26\u53f7\u7684, \u8d1f\u6570\u8868\u793a 1970 \u5e74\u4e4b\u524d\u7684\u65e5\u671f\u3002 > var mydate1 = new Date() //\u683c\u6797\u5c3c\u6cbb\u65f6\u95f4 > mydate1 ISODate(\"2019-02-27T02:27:17.952Z\") > typeof mydate1 object \u8fd9\u6837\u521b\u5efa\u7684\u65f6\u95f4\u662f\u65e5\u671f\u7c7b\u578b\uff0c\u53ef\u4ee5\u4f7f\u7528 JS \u4e2d\u7684 Date \u7c7b\u578b\u7684\u65b9\u6cd5\u3002 \u8fd4\u56de\u4e00\u4e2a\u65f6\u95f4\u7c7b\u578b\u7684\u5b57\u7b26\u4e32\uff1a > var mydate1str = mydate1.toString() > mydate1str Wed Feb 27 2019 10:27:17 GMT+0800 (CST) > typeof mydate1str string \u6216\u8005 > Date() Wed Feb 27 2019 10:29:06 GMT+0800 (CST)","title":"01. MonogoDB \u4ecb\u7ecd"},{"location":"linux/nosql/mongo/mongo.index/#1","text":"","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/mongo/mongo.index/#11-mongodb","text":"MongoDB \u662f\u7531C++\u8bed\u8a00\u7f16\u5199\u7684\uff0c\u662f\u4e00\u4e2a\u57fa\u4e8e\u5206\u5e03\u5f0f\u6587\u4ef6\u5b58\u50a8\u7684\u5f00\u6e90\u6570\u636e\u5e93\u7cfb\u7edf\u3002\u5728\u9ad8\u8d1f\u8f7d\u7684\u60c5\u51b5\u4e0b\uff0c\u6dfb\u52a0\u66f4\u591a\u7684\u8282\u70b9\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u670d\u52a1\u5668\u6027\u80fd\u3002MongoDB \u65e8\u5728\u4e3aWEB\u5e94\u7528\u63d0\u4f9b\u53ef\u6269\u5c55\u7684\u9ad8\u6027\u80fd\u6570\u636e\u5b58\u50a8\u89e3\u51b3\u65b9\u6848\u3002 MongoDB \u5c06\u6570\u636e\u5b58\u50a8\u4e3a\u4e00\u4e2a\u6587\u6863\uff0c\u6570\u636e\u7ed3\u6784\u7531\u952e\u503c(key=>value)\u5bf9\u7ec4\u6210\u3002MongoDB \u6587\u6863\u7c7b\u4f3c\u4e8e JSON \u5bf9\u8c61\u3002\u5b57\u6bb5\u503c\u53ef\u4ee5\u5305\u542b\u5176\u4ed6\u6587\u6863\uff0c\u6570\u7ec4\u53ca\u6587\u6863\u6570\u7ec4\u3002","title":"1.1 MongoDB"},{"location":"linux/nosql/mongo/mongo.index/#12","text":"MongoDB \u662f\u4e00\u4e2a\u9762\u5411\u6587\u6863\u5b58\u50a8\u7684\u6570\u636e\u5e93\uff0c\u64cd\u4f5c\u8d77\u6765\u6bd4\u8f83\u7b80\u5355\u548c\u5bb9\u6613\u3002 \u4f60\u53ef\u4ee5\u5728MongoDB\u8bb0\u5f55\u4e2d\u8bbe\u7f6e\u4efb\u4f55\u5c5e\u6027\u7684\u7d22\u5f15 (\u5982\uff1aFirstName=\"Sameer\",Address=\"8 Gandhi Road\")\u6765\u5b9e\u73b0\u66f4\u5feb\u7684\u6392\u5e8f\u3002 \u4f60\u53ef\u4ee5\u901a\u8fc7\u672c\u5730\u6216\u8005\u7f51\u7edc\u521b\u5efa\u6570\u636e\u955c\u50cf\uff0c\u8fd9\u4f7f\u5f97MongoDB\u6709\u66f4\u5f3a\u7684\u6269\u5c55\u6027\u3002 \u5982\u679c\u8d1f\u8f7d\u7684\u589e\u52a0\uff08\u9700\u8981\u66f4\u591a\u7684\u5b58\u50a8\u7a7a\u95f4\u548c\u66f4\u5f3a\u7684\u5904\u7406\u80fd\u529b\uff09 \uff0c\u5b83\u53ef\u4ee5\u5206\u5e03\u5728\u8ba1\u7b97\u673a\u7f51\u7edc\u4e2d\u7684\u5176\u4ed6\u8282\u70b9\u4e0a\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u5206\u7247\u3002 Mongo\u652f\u6301\u4e30\u5bcc\u7684\u67e5\u8be2\u8868\u8fbe\u5f0f\u3002\u67e5\u8be2\u6307\u4ee4\u4f7f\u7528JSON\u5f62\u5f0f\u7684\u6807\u8bb0\uff0c\u53ef\u8f7b\u6613\u67e5\u8be2\u6587\u6863\u4e2d\u5185\u5d4c\u7684\u5bf9\u8c61\u53ca\u6570\u7ec4\u3002 MongoDb \u4f7f\u7528update()\u547d\u4ee4\u53ef\u4ee5\u5b9e\u73b0\u66ff\u6362\u5b8c\u6210\u7684\u6587\u6863\uff08\u6570\u636e\uff09\u6216\u8005\u4e00\u4e9b\u6307\u5b9a\u7684\u6570\u636e\u5b57\u6bb5 \u3002 Mongodb\u4e2d\u7684Map/reduce\u4e3b\u8981\u662f\u7528\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u6279\u91cf\u5904\u7406\u548c\u805a\u5408\u64cd\u4f5c\u3002 Map\u548cReduce\u3002Map\u51fd\u6570\u8c03\u7528emit(key,value)\u904d\u5386\u96c6\u5408\u4e2d\u6240\u6709\u7684\u8bb0\u5f55\uff0c\u5c06key\u4e0evalue\u4f20\u7ed9Reduce\u51fd\u6570\u8fdb\u884c\u5904\u7406\u3002 Map\u51fd\u6570\u548cReduce\u51fd\u6570\u662f\u4f7f\u7528Javascript\u7f16\u5199\u7684\uff0c\u5e76\u53ef\u4ee5\u901a\u8fc7db.runCommand\u6216mapreduce\u547d\u4ee4\u6765\u6267\u884cMapReduce\u64cd\u4f5c\u3002 GridFS\u662fMongoDB\u4e2d\u7684\u4e00\u4e2a\u5185\u7f6e\u529f\u80fd\uff0c\u53ef\u4ee5\u7528\u4e8e\u5b58\u653e\u5927\u91cf\u5c0f\u6587\u4ef6\u3002 MongoDB\u5141\u8bb8\u5728\u670d\u52a1\u7aef\u6267\u884c\u811a\u672c\uff0c\u53ef\u4ee5\u7528Javascript\u7f16\u5199\u67d0\u4e2a\u51fd\u6570\uff0c\u76f4\u63a5\u5728\u670d\u52a1\u7aef\u6267\u884c\uff0c\u4e5f\u53ef\u4ee5\u628a\u51fd\u6570\u7684\u5b9a\u4e49\u5b58\u50a8\u5728\u670d\u52a1\u7aef\uff0c\u4e0b\u6b21\u76f4\u63a5\u8c03\u7528\u5373\u53ef\u3002 MongoDB\u652f\u6301\u5404\u79cd\u7f16\u7a0b\u8bed\u8a00:RUBY\uff0cPYTHON\uff0cJAVA\uff0cC++\uff0cPHP\uff0cC#\u7b49\u591a\u79cd\u8bed\u8a00\u3002 MongoDB\u5b89\u88c5\u7b80\u5355\u3002","title":"1.2 \u7279\u70b9"},{"location":"linux/nosql/mongo/mongo.index/#2","text":"","title":"2. \u5b89\u88c5"},{"location":"linux/nosql/mongo/mongo.index/#21","text":"\u4e0b\u8f7d\u5730\u5740: https://www.mongodb.com/download-center/community [root@leco src]# wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-4.0.6.tgz --2019-02-27 09:42:36-- https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-4.0.6.tgz Resolving fastdl.mongodb.org... 13.33.186.136, 13.33.186.26, 13.33.186.247, ... Connecting to fastdl.mongodb.org|13.33.186.136|:443... connected. HTTP request sent, awaiting response... 200 OK Length: 73265692 (70M) [application/x-gzip] Saving to: \u201cmongodb-linux-x86_64-4.0.6.tgz\u201d 100%[=============================================================================================================================================>] 73,265,692 1021K/s in 98s 2019-02-27 09:44:15 (733 KB/s) - \u201cmongodb-linux-x86_64-4.0.6.tgz\u201d saved [73265692/73265692]","title":"2.1 \u4e0b\u8f7d\u5b89\u88c5"},{"location":"linux/nosql/mongo/mongo.index/#22","text":"[root@leco src]# tar xf mongodb-linux-x86_64-4.0.6.tgz [root@leco src]# cd mongodb-linux-x86_64-4.0.6 [root@leco mongodb-linux-x86_64-4.0.6]# ls bin LICENSE-Community.txt MPL-2 README THIRD-PARTY-NOTICES [root@leco src]# mv mongodb-linux-x86_64-4.0.6 /usr/local/ [root@leco src]# cd /usr/local/ [root@leco local]# ln -sf mongodb-linux-x86_64-4.0.6/ mongo \u6ce8\u610f \u6211\u4f7f\u7528\u7684\u662f\u4e8c\u8fdb\u5236\u5305\uff0c\u76f4\u63a5\u89e3\u538b\u5373\u53ef\u4f7f\u7528\uff0c\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u60c5\u51b5\u5b89\u88c5\u65b9\u5f0f\uff0c 1. \u4e8c\u8fdb\u5236\u5b89\u88c5 2. \u5728\u7ebf\u5b89\u88c5 3. \u79bb\u7ebf\u5b89\u88c5","title":"2.2 \u5b89\u88c5"},{"location":"linux/nosql/mongo/mongo.index/#23","text":"\u4e34\u65f6\u751f\u6548[\u91cd\u542f\u540e\u5c31\u6ca1\u4e86] [root@leco local]# export PATH=/usr/local/mongo/bin:$PATH \u6c38\u4e45\u751f\u6548 [root@leco mongo]# tail -2 /etc/profile # add by caimengzhi for mongodb 4.0 export PATH=/usr/local/mongo/bin:$PATH [root@leco mongo]# source /etc/profile","title":"2.3 \u6dfb\u52a0\u73af\u5883\u53d8\u91cf"},{"location":"linux/nosql/mongo/mongo.index/#24","text":"[root@leco ~]# cd /usr/local/mongo [root@leco mongo]# ls bin LICENSE-Community.txt MPL-2 README THIRD-PARTY-NOTICES [root@leco mongo]# mkdir conf [root@leco mongo]# mkdir -p /usr/local/mongodb/data/db [root@leco mongo]# mkdir -p /usr/local/mongodb/logs [root@leco mongo]# cd conf/ [root@leco conf]# vim mongodb.conf [root@leco conf]# cat mongodb.conf dbpath = /usr/local/mongodb/data/db logpath = /usr/local/mongodb/logs/mongodb.log port = 27017 fork = true bind_ip=0.0.0.0 [root@leco mongo]# tree . . \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 bsondump \u2502 \u251c\u2500\u2500 install_compass \u2502 \u251c\u2500\u2500 mongo \u2502 \u251c\u2500\u2500 mongod \u2502 \u251c\u2500\u2500 mongodump \u2502 \u251c\u2500\u2500 mongoexport \u2502 \u251c\u2500\u2500 mongofiles \u2502 \u251c\u2500\u2500 mongoimport \u2502 \u251c\u2500\u2500 mongoreplay \u2502 \u251c\u2500\u2500 mongorestore \u2502 \u251c\u2500\u2500 mongos \u2502 \u251c\u2500\u2500 mongostat \u2502 \u2514\u2500\u2500 mongotop \u251c\u2500\u2500 conf \u2502 \u2514\u2500\u2500 mongodb.conf \u251c\u2500\u2500 LICENSE-Community.txt \u251c\u2500\u2500 MPL-2 \u251c\u2500\u2500 README \u2514\u2500\u2500 THIRD-PARTY-NOTICES 2 directories, 18 file","title":"2.4 \u914d\u7f6e"},{"location":"linux/nosql/mongo/mongo.index/#25","text":"[root@leco mongo]# mongod -f /usr/local/mongo/conf/mongodb.conf about to fork child process, waiting until server is ready for connections. forked process: 18924 child process started successfully, parent exiting [root@leco mongo]# ps axf|grep mongod 18963 pts/0 S+ 0:00 \\_ grep mongod 18924 ? Sl 0:00 mongod -f /usr/local/mongo/conf/mongodb.conf [root@leco mongo]# netstat -lnp|grep 27017 tcp 0 0 0.0.0.0:27017 0.0.0.0:* LISTEN 18924/mongod unix 2 [ ACC ] STREAM LISTENING 66911078 18924/mongod /tmp/mongodb-27017.sock [root@leco mongo]# \u914d\u7f6e\u6587\u4ef6\u89e3\u91ca dbpath = / usr / local / mongodb / data / db # \u6570\u636e\u6587\u4ef6\u5b58\u653e\u76ee\u5f55 logpath = / usr / local / mongodb / logs / mongodb . log # \u65e5\u5fd7\u6587\u4ef6\u5b58\u653e\u76ee\u5f55 port = 27017 # \u7aef\u53e3 fork = true # \u4ee5\u5b88\u62a4\u7a0b\u5e8f\u7684\u65b9\u5f0f\u542f\u7528\uff0c\u5373\u5728\u540e\u53f0\u8fd0\u884c bind_ip = 0.0 . 0.0 # \u5141\u8bb8\u6240\u6709\u7684\u8fde\u63a5","title":"2.5 \u542f\u52a8"},{"location":"linux/nosql/mongo/mongo.index/#26-docker","text":"docker pull mongo docker run -itd --name=mongo_test -p 27017:27017 mongo","title":"2.6 docker\u5b89\u88c5"},{"location":"linux/nosql/mongo/mongo.index/#3","text":"\u5728mongodb\u4e2d\u57fa\u672c\u7684\u6982\u5ff5\u662f\u6587\u6863\u3001\u96c6\u5408\u3001\u6570\u636e\u5e93\uff0c\u5728\u5176\u4ed6NoSQL\u4e2d\u5bf9\u6bd4 SQL\u672f\u8bed/\u6982\u5ff5 MongoDB\u672f\u8bed/\u6982\u5ff5 \u89e3\u91ca/\u8bf4\u660e database database \u6570\u636e\u5e93 table collection \u6570\u636e\u5e93\u8868/\u96c6\u5408 row document \u6570\u636e\u8bb0\u5f55\u884c/\u6587\u6863 column field \u6570\u636e\u5b57\u6bb5/\u57df index index \u7d22\u5f15 table joins \u8868\u8fde\u63a5,MongoDB\u4e0d\u652f\u6301 primary key primary key \u4e3b\u952e,MongoDB\u81ea\u52a8\u5c06_id\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u4e3b\u952e","title":"3. \u6982\u5ff5\u4ecb\u7ecd"},{"location":"linux/nosql/mongo/mongo.index/#31","text":"\u4e00\u4e2amongodb\u4e2d\u53ef\u4ee5\u5efa\u7acb\u591a\u4e2a\u6570\u636e\u5e93\u3002 MongoDB\u7684\u9ed8\u8ba4\u6570\u636e\u5e93\u4e3a\"db\"\uff0c\u8be5\u6570\u636e\u5e93\u5b58\u50a8\u5728data\u76ee\u5f55\u4e2d\u3002 MongoDB\u7684\u5355\u4e2a\u5b9e\u4f8b\u53ef\u4ee5\u5bb9\u7eb3\u591a\u4e2a\u72ec\u7acb\u7684\u6570\u636e\u5e93\uff0c\u6bcf\u4e00\u4e2a\u90fd\u6709\u81ea\u5df1\u7684\u96c6\u5408\u548c\u6743\u9650\uff0c\u4e0d\u540c\u7684\u6570\u636e\u5e93\u4e5f\u653e\u7f6e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u4e2d\u3002 \"show dbs\" \u547d\u4ee4\u53ef\u4ee5\u663e\u793a\u6240\u6709\u6570\u636e\u7684\u5217\u8868\u3002 [root@leco mongo]# mongo MongoDB shell version v4.0.6 sconnecting to: mongodb://127.0.0.1:27017/?gssapiServiceName=mongodb sho^HsImplicit session: session { \"id\" : UUID(\"6b210996-2e69-4e35-bd6d-7ee0a946cdc5\") } ^H^H^H^H^HMongoDB server version: 4.0.6 Welcome to the MongoDB shell. For interactive help, type \"help\". For more comprehensive documentation, see http://docs.mongodb.org/ Questions? Try the support group http://groups.google.com/group/mongodb-user Server has startup warnings: 2019-02-27T09:59:22.485+0800 I STORAGE [initandlisten] 2019-02-27T09:59:22.485+0800 I STORAGE [initandlisten] ** WARNING: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine 2019-02-27T09:59:22.485+0800 I STORAGE [initandlisten] ** See http://dochub.mongodb.org/core/prodnotes-filesystem 2019-02-27T09:59:23.449+0800 I CONTROL [initandlisten] 2019-02-27T09:59:23.449+0800 I CONTROL [initandlisten] ** WARNING: Access control is not enabled for the database. 2019-02-27T09:59:23.449+0800 I CONTROL [initandlisten] ** Read and write access to data and configuration is unrestricted. 2019-02-27T09:59:23.449+0800 I CONTROL [initandlisten] ** WARNING: You are running this process as the root user, which is not recommended. 2019-02-27T09:59:23.449+0800 I CONTROL [initandlisten] 2019-02-27T09:59:23.450+0800 I CONTROL [initandlisten] 2019-02-27T09:59:23.450+0800 I CONTROL [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/enabled is 'always'. 2019-02-27T09:59:23.450+0800 I CONTROL [initandlisten] ** We suggest setting it to 'never' 2019-02-27T09:59:23.451+0800 I CONTROL [initandlisten] 2019-02-27T09:59:23.451+0800 I CONTROL [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/defrag is 'always'. 2019-02-27T09:59:23.451+0800 I CONTROL [initandlisten] ** We suggest setting it to 'never' 2019-02-27T09:59:23.451+0800 I CONTROL [initandlisten] 2019-02-27T09:59:23.451+0800 I CONTROL [initandlisten] ** WARNING: soft rlimits too low. rlimits set to 7424 processes, 65535 files. Number of processes should be at least 32767.5 : 0.5 times number of files. 2019-02-27T09:59:23.451+0800 I CONTROL [initandlisten] > show dbs; admin 0.000GB config 0.000GB local 0.000GB \u6267\u884c \"db\" \u547d\u4ee4\u53ef\u4ee5\u663e\u793a\u5f53\u524d\u6570\u636e\u5e93\u5bf9\u8c61\u6216\u96c6\u5408\u3002\u8fd0\u884c\"use\"\u547d\u4ee4\uff0c\u53ef\u4ee5\u8fde\u63a5\u5230\u4e00\u4e2a\u6307\u5b9a\u7684\u6570\u636e\u5e93\u3002 > db test > use local switched to db local > db local \u4ee5\u4e0a\u5b9e\u4f8b\u547d\u4ee4\u4e2d\uff0c\"local\" \u662f\u4f60\u8981\u94fe\u63a5\u7684\u6570\u636e\u5e93\u3002","title":"3.1 \u6570\u636e\u5e93"},{"location":"linux/nosql/mongo/mongo.index/#32","text":"admin\uff1a \u4ece\u6743\u9650\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u8fd9\u662f\"root\"\u6570\u636e\u5e93\u3002\u8981\u662f\u5c06\u4e00\u4e2a\u7528\u6237\u6dfb\u52a0\u5230\u8fd9\u4e2a\u6570\u636e\u5e93\uff0c\u8fd9\u4e2a\u7528\u6237\u81ea\u52a8\u7ee7\u627f\u6240\u6709\u6570\u636e\u5e93\u7684\u6743\u9650\u3002\u4e00\u4e9b\u7279\u5b9a\u7684\u670d\u52a1\u5668\u7aef\u547d\u4ee4\u4e5f\u53ea\u80fd\u4ece\u8fd9\u4e2a\u6570\u636e\u5e93\u8fd0\u884c\uff0c\u6bd4\u5982\u5217\u51fa\u6240\u6709\u7684\u6570\u636e\u5e93\u6216\u8005\u5173\u95ed\u670d\u52a1\u5668\u3002 local: \u8fd9\u4e2a\u6570\u636e\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u590d\u5236\uff0c\u53ef\u4ee5\u7528\u6765\u5b58\u50a8\u9650\u4e8e\u672c\u5730\u5355\u53f0\u670d\u52a1\u5668\u7684\u4efb\u610f\u96c6\u5408 config: \u5f53Mongo\u7528\u4e8e\u5206\u7247\u8bbe\u7f6e\u65f6\uff0cconfig\u6570\u636e\u5e93\u5728\u5185\u90e8\u4f7f\u7528\uff0c\u7528\u4e8e\u4fdd\u5b58\u5206\u7247\u7684\u76f8\u5173\u4fe1\u606f\u3002","title":"3.2 \u7279\u6b8a\u5e93"},{"location":"linux/nosql/mongo/mongo.index/#33","text":"\u6587\u6863\u662f\u4e00\u7ec4\u952e\u503c(key-value)\u5bf9(\u5373BSON)\u3002MongoDB \u7684\u6587\u6863\u4e0d\u9700\u8981\u8bbe\u7f6e\u76f8\u540c\u7684\u5b57\u6bb5\uff0c\u5e76\u4e14\u76f8\u540c\u7684\u5b57\u6bb5\u4e0d\u9700\u8981\u76f8\u540c\u7684\u6570\u636e\u7c7b\u578b\uff0c\u8fd9\u4e0e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u6709\u5f88\u5927\u7684\u533a\u522b\uff0c\u4e5f\u662f MongoDB \u975e\u5e38\u7a81\u51fa\u7684\u7279\u70b9\u3002 \u4e00\u4e2a\u7b80\u5355\u7684\u6587\u6863\u4f8b\u5b50\u5982\u4e0b\uff1a {\"site\":\"https://caimengzhi.github.io/books/\", \"name\":\"cmz\"} DBMS \u4e0e MongoDB \u5bf9\u5e94\u7684\u672f\u8bed\uff1a RDBMS MongoDB \u6570\u636e\u5e93 \u6570\u636e\u5e93 \u8868\u683c \u96c6\u5408 \u884c \u6587\u6863 \u5217 \u5b57\u6bb5 \u8868\u8054\u5408 \u5d4c\u5165\u6587\u6863 \u4e3b\u952e \u4e3b\u952e (MongoDB \u63d0\u4f9b\u4e86 key \u4e3a _id ) \u6ce8\u610f 1. \u6587\u6863\u4e2d\u7684\u952e / \u503c\u5bf9\u662f\u6709\u5e8f\u7684\u3002 2. \u6587\u6863\u4e2d\u7684\u503c\u4e0d\u4ec5\u53ef\u4ee5\u662f\u5728\u53cc\u5f15\u53f7\u91cc\u9762\u7684\u5b57\u7b26\u4e32\uff0c\u8fd8\u53ef\u4ee5\u662f\u5176\u4ed6\u51e0\u79cd\u6570\u636e 3. \u7c7b\u578b\uff08\u751a\u81f3\u53ef\u4ee5\u662f\u6574\u4e2a\u5d4c\u5165\u7684\u6587\u6863 ) \u3002 4. MongoDB\u533a\u5206\u7c7b\u578b\u548c\u5927\u5c0f\u5199 \u3002 5. MongoDB\u7684\u6587\u6863\u4e0d\u80fd\u6709\u91cd\u590d\u7684\u952e \u3002 6. \u6587\u6863\u7684\u952e\u662f\u5b57\u7b26\u4e32\u3002\u9664\u4e86\u5c11\u6570\u4f8b\u5916\u60c5\u51b5\uff0c\u952e\u53ef\u4ee5\u4f7f\u7528\u4efb\u610f UTF - 8 \u5b57\u7b26\u3002 7. \u952e\u4e0d\u80fd\u542b\u6709 \\ 0 ( \u7a7a\u5b57\u7b26 ) \u3002\u8fd9\u4e2a\u5b57\u7b26\u7528\u6765\u8868\u793a\u952e\u7684\u7ed3\u5c3e\u3002 8. . \u548c$\u6709\u7279\u522b\u7684\u610f\u4e49\uff0c\u53ea\u6709\u5728\u7279\u5b9a\u73af\u5883\u4e0b\u624d\u80fd\u4f7f\u7528\u3002 9. \u4ee5\u4e0b\u5212\u7ebf \"_\" \u5f00\u5934\u7684\u952e\u662f\u4fdd\u7559\u7684 ( \u4e0d\u662f\u4e25\u683c\u8981\u6c42\u7684 )","title":"3.3 \u6587\u6863"},{"location":"linux/nosql/mongo/mongo.index/#34","text":"","title":"3.4 \u96c6\u5408"},{"location":"linux/nosql/mongo/mongo.index/#341","text":"\u96c6\u5408\u5c31\u662f MongoDB \u6587\u6863\u7ec4\uff0c\u7c7b\u4f3c\u4e8e RDBMS \uff08\u5173\u7cfb\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff1aRelational Database Management System)\u4e2d\u7684\u8868\u683c\u3002\u96c6\u5408\u5b58\u5728\u4e8e\u6570\u636e\u5e93\u4e2d\uff0c\u96c6\u5408\u6ca1\u6709\u56fa\u5b9a\u7684\u7ed3\u6784\uff0c\u8fd9\u610f\u5473\u7740\u4f60\u5728\u5bf9\u96c6\u5408\u53ef\u4ee5\u63d2\u5165\u4e0d\u540c\u683c\u5f0f\u548c\u7c7b\u578b\u7684\u6570\u636e\uff0c\u4f46\u901a\u5e38\u60c5\u51b5\u4e0b\u6211\u4eec\u63d2\u5165\u96c6\u5408\u7684\u6570\u636e\u90fd\u4f1a\u6709\u4e00\u5b9a\u7684\u5173\u8054\u6027\u3002 \u6bd4\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u4ee5\u4e0b\u4e0d\u540c\u6570\u636e\u7ed3\u6784\u7684\u6587\u6863\u63d2\u5165\u5230\u96c6\u5408\u4e2d\uff1a {\"site\":\"https://caimengzhi.github.io/books/\"} {\"site\":\"https://caimengzhi.github.io/books/\",\"name\":\"cmz\"} {\"site\":\"https://caimengzhi.github.io/books/\",\"name\":\"cmz\",\"num\":66} \u5f53\u7b2c\u4e00\u4e2a\u6587\u6863\u63d2\u5165\u65f6\uff0c\u96c6\u5408\u5c31\u4f1a\u88ab\u521b\u5efa\u3002","title":"3.4.1 \u4ecb\u7ecd"},{"location":"linux/nosql/mongo/mongo.index/#342","text":"\u96c6\u5408\u540d\u4e0d\u80fd\u662f\u7a7a\u5b57\u7b26\u4e32\"\"\u3002 \u96c6\u5408\u540d\u4e0d\u80fd\u542b\u6709\\0\u5b57\u7b26\uff08\u7a7a\u5b57\u7b26)\uff0c\u8fd9\u4e2a\u5b57\u7b26\u8868\u793a\u96c6\u5408\u540d\u7684\u7ed3\u5c3e\u3002 \u96c6\u5408\u540d\u4e0d\u80fd\u4ee5\"system.\"\u5f00\u5934\uff0c\u8fd9\u662f\u4e3a\u7cfb\u7edf\u96c6\u5408\u4fdd\u7559\u7684\u524d\u7f00\u3002 \u7528\u6237\u521b\u5efa\u7684\u96c6\u5408\u540d\u5b57\u4e0d\u80fd\u542b\u6709\u4fdd\u7559\u5b57\u7b26\u3002\u6709\u4e9b\u9a71\u52a8\u7a0b\u5e8f\u7684\u786e\u652f\u6301\u5728\u96c6\u5408\u540d\u91cc\u9762\u5305\u542b\uff0c\u8fd9\u662f\u56e0\u4e3a\u67d0\u4e9b\u7cfb\u7edf\u751f\u6210\u7684\u96c6\u5408\u4e2d\u5305\u542b\u8be5\u5b57\u7b26\u3002\u9664\u975e\u4f60\u8981\u8bbf\u95ee\u8fd9\u79cd\u7cfb\u7edf\u521b\u5efa\u7684\u96c6\u5408\uff0c\u5426\u5219\u5343\u4e07\u4e0d\u8981\u5728\u540d\u5b57\u91cc\u51fa\u73b0$\u3002","title":"3.4.2 \u5408\u6cd5\u7684\u96c6\u5408\u540d"},{"location":"linux/nosql/mongo/mongo.index/#35","text":"\u6570\u636e\u5e93\u7684\u4fe1\u606f\u662f\u5b58\u50a8\u5728\u96c6\u5408\u4e2d\u3002\u5b83\u4eec\u4f7f\u7528\u4e86\u7cfb\u7edf\u7684\u547d\u540d\u7a7a\u95f4\uff1a dbname.system.*","title":"3.5 \u5143\u6570\u636e"},{"location":"linux/nosql/mongo/mongo.index/#4","text":"\u4e0b\u8868\u4e3aMongoDB\u4e2d\u5e38\u7528\u7684\u51e0\u79cd\u6570\u636e\u7c7b\u578b\u3002 \u6570\u636e\u7c7b\u578b \u63cf\u8ff0 String \u5b57\u7b26\u4e32\u3002\u5b58\u50a8\u6570\u636e\u5e38\u7528\u7684\u6570\u636e\u7c7b\u578b\u3002\u5728 MongoDB \u4e2d\uff0cUTF-8 \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u624d\u662f\u5408\u6cd5\u7684\u3002 Integer \u6574\u578b\u6570\u503c\u3002\u7528\u4e8e\u5b58\u50a8\u6570\u503c\u3002\u6839\u636e\u4f60\u6240\u91c7\u7528\u7684\u670d\u52a1\u5668\uff0c\u53ef\u5206\u4e3a 32 \u4f4d\u6216 64 \u4f4d\u3002 Boolean \u5e03\u5c14\u503c\u3002\u7528\u4e8e\u5b58\u50a8\u5e03\u5c14\u503c\uff08\u771f/\u5047\uff09\u3002 Double \u53cc\u7cbe\u5ea6\u6d6e\u70b9\u503c\u3002\u7528\u4e8e\u5b58\u50a8\u6d6e\u70b9\u503c\u3002 Min/Max keys \u5c06\u4e00\u4e2a\u503c\u4e0e BSON\uff08\u4e8c\u8fdb\u5236\u7684 JSON\uff09\u5143\u7d20\u7684\u6700\u4f4e\u503c\u548c\u6700\u9ad8\u503c\u76f8\u5bf9\u6bd4\u3002 Array \u7528\u4e8e\u5c06\u6570\u7ec4\u6216\u5217\u8868\u6216\u591a\u4e2a\u503c\u5b58\u50a8\u4e3a\u4e00\u4e2a\u952e\u3002 Timestamp \u65f6\u95f4\u6233\u3002\u8bb0\u5f55\u6587\u6863\u4fee\u6539\u6216\u6dfb\u52a0\u7684\u5177\u4f53\u65f6\u95f4\u3002 Object \u7528\u4e8e\u5185\u5d4c\u6587\u6863\u3002 Null \u7528\u4e8e\u521b\u5efa\u7a7a\u503c\u3002 Symbol \u7b26\u53f7\u3002\u8be5\u6570\u636e\u7c7b\u578b\u57fa\u672c\u4e0a\u7b49\u540c\u4e8e\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u4f46\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u4e00\u822c\u7528\u4e8e\u91c7\u7528\u7279\u6b8a\u7b26\u53f7\u7c7b\u578b\u7684\u8bed\u8a00\u3002 Date \u65e5\u671f\u65f6\u95f4\u3002\u7528 UNIX \u65f6\u95f4\u683c\u5f0f\u6765\u5b58\u50a8\u5f53\u524d\u65e5\u671f\u6216\u65f6\u95f4\u3002\u4f60\u53ef\u4ee5\u6307\u5b9a\u81ea\u5df1\u7684\u65e5\u671f\u65f6\u95f4\uff1a\u521b\u5efa Date \u5bf9\u8c61\uff0c\u4f20\u5165\u5e74\u6708\u65e5\u4fe1\u606f\u3002 Object ID \u5bf9\u8c61 ID\u3002\u7528\u4e8e\u521b\u5efa\u6587\u6863\u7684 ID\u3002 Binary Data \u4e8c\u8fdb\u5236\u6570\u636e\u3002\u7528\u4e8e\u5b58\u50a8\u4e8c\u8fdb\u5236\u6570\u636e\u3002 Code \u4ee3\u7801\u7c7b\u578b\u3002\u7528\u4e8e\u5728\u6587\u6863\u4e2d\u5b58\u50a8 JavaScript \u4ee3\u7801\u3002 Regular expression \u6b63\u5219\u8868\u8fbe\u5f0f\u7c7b\u578b\u3002\u7528\u4e8e\u5b58\u50a8\u6b63\u5219\u8868\u8fbe\u5f0f\u3002","title":"4 \u6570\u636e\u7c7b\u578b"},{"location":"linux/nosql/mongo/mongo.index/#41-objectid","text":"ObjectId \u7c7b\u4f3c\u552f\u4e00\u4e3b\u952e\uff0c\u53ef\u4ee5\u5f88\u5feb\u7684\u53bb\u751f\u6210\u548c\u6392\u5e8f\uff0c\u5305\u542b 12 bytes\uff0c\u542b\u4e49\u662f\uff1a \u524d 4 \u4e2a\u5b57\u8282\u8868\u793a\u521b\u5efa unix \u65f6\u95f4\u6233,\u683c\u6797\u5c3c\u6cbb\u65f6\u95f4 UTC \u65f6\u95f4\uff0c\u6bd4\u5317\u4eac\u65f6\u95f4\u665a\u4e86 8 \u4e2a\u5c0f\u65f6 \u63a5\u4e0b\u6765\u7684 3 \u4e2a\u5b57\u8282\u662f\u673a\u5668\u6807\u8bc6\u7801 \u7d27\u63a5\u7684\u4e24\u4e2a\u5b57\u8282\u7531\u8fdb\u7a0b id \u7ec4\u6210 PID \u6700\u540e\u4e09\u4e2a\u5b57\u8282\u662f\u968f\u673a\u6570 0|1|2|3|4|5|6|7|8|9|10|11 | | | \u65f6\u95f4\u6233 |\u673a\u5668 |PID|\u8ba1\u6570\u5668 MongoDB \u4e2d\u5b58\u50a8\u7684\u6587\u6863\u5fc5\u987b\u6709\u4e00\u4e2a _id \u952e\u3002\u8fd9\u4e2a\u952e\u7684\u503c\u53ef\u4ee5\u662f\u4efb\u4f55\u7c7b\u578b\u7684\uff0c\u9ed8\u8ba4\u662f\u4e2a ObjectId \u5bf9\u8c61 \u7531\u4e8e ObjectId \u4e2d\u4fdd\u5b58\u4e86\u521b\u5efa\u7684\u65f6\u95f4\u6233\uff0c\u6240\u4ee5\u4f60\u4e0d\u9700\u8981\u4e3a\u4f60\u7684\u6587\u6863\u4fdd\u5b58\u65f6\u95f4\u6233\u5b57\u6bb5\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7 getTimestamp \u51fd\u6570\u6765\u83b7\u53d6\u6587\u6863\u7684\u521b\u5efa\u65f6\u95f4: > var newObject = ObjectId() > newObject.getTimestamp() ISODate(\"2019-02-27T02:24:17Z\") ObjectId \u8f6c\u4e3a\u5b57\u7b26\u4e32 > newObject.str 5c75f4d1970254564966ebd4","title":"4.1 ObjectId"},{"location":"linux/nosql/mongo/mongo.index/#42","text":"BSON \u5b57\u7b26\u4e32\u90fd\u662f UTF-8 \u7f16\u7801\u3002","title":"4.2 \u5b57\u7b26\u4e32"},{"location":"linux/nosql/mongo/mongo.index/#43","text":"BSON \u6709\u4e00\u4e2a\u7279\u6b8a\u7684\u65f6\u95f4\u6233\u7c7b\u578b\u7528\u4e8e MongoDB \u5185\u90e8\u4f7f\u7528\uff0c\u4e0e\u666e\u901a\u7684 \u65e5\u671f \u7c7b\u578b\u4e0d\u76f8\u5173\u3002 \u65f6\u95f4\u6233\u503c\u662f\u4e00\u4e2a 64 \u4f4d\u7684\u503c\u3002\u5176\u4e2d\uff1a \u524d32\u4f4d\u662f\u4e00\u4e2a time_t \u503c\uff08\u4e0eUnix\u65b0\u7eaa\u5143\u76f8\u5dee\u7684\u79d2\u6570\uff09 \u540e32\u4f4d\u662f\u5728\u67d0\u79d2\u4e2d\u64cd\u4f5c\u7684\u4e00\u4e2a\u9012\u589e\u7684\u5e8f\u6570 \u5355\u4e2a mongod \u5b9e\u4f8b\u4e2d\uff0c\u65f6\u95f4\u6233\u503c\u901a\u5e38\u662f\u552f\u4e00\u7684\u3002\u5728\u590d\u5236\u96c6\u4e2d\uff0c oplog \u6709\u4e00\u4e2a ts \u5b57\u6bb5\u3002\u8fd9\u4e2a\u5b57\u6bb5\u4e2d\u7684\u503c\u4f7f\u7528BSON\u65f6\u95f4\u6233\u8868\u793a\u4e86\u64cd\u4f5c\u65f6\u95f4\u3002","title":"4.3 \u65f6\u95f4\u6233"},{"location":"linux/nosql/mongo/mongo.index/#44","text":"\u8868\u793a\u5f53\u524d\u8ddd\u79bb Unix\u65b0\u7eaa\u5143\uff081970\u5e741\u67081\u65e5\uff09\u7684\u6beb\u79d2\u6570\u3002\u65e5\u671f\u7c7b\u578b\u662f\u6709\u7b26\u53f7\u7684, \u8d1f\u6570\u8868\u793a 1970 \u5e74\u4e4b\u524d\u7684\u65e5\u671f\u3002 > var mydate1 = new Date() //\u683c\u6797\u5c3c\u6cbb\u65f6\u95f4 > mydate1 ISODate(\"2019-02-27T02:27:17.952Z\") > typeof mydate1 object \u8fd9\u6837\u521b\u5efa\u7684\u65f6\u95f4\u662f\u65e5\u671f\u7c7b\u578b\uff0c\u53ef\u4ee5\u4f7f\u7528 JS \u4e2d\u7684 Date \u7c7b\u578b\u7684\u65b9\u6cd5\u3002 \u8fd4\u56de\u4e00\u4e2a\u65f6\u95f4\u7c7b\u578b\u7684\u5b57\u7b26\u4e32\uff1a > var mydate1str = mydate1.toString() > mydate1str Wed Feb 27 2019 10:27:17 GMT+0800 (CST) > typeof mydate1str string \u6216\u8005 > Date() Wed Feb 27 2019 10:29:06 GMT+0800 (CST)","title":"4.4 \u65e5\u671f"},{"location":"linux/nosql/mongo/mongo.limit_skip/","text":"MongoDB Limit\u4e0eSkip 1. Limit \u00b6 \u5982\u679c\u4f60\u9700\u8981\u5728MongoDB\u4e2d\u8bfb\u53d6\u6307\u5b9a\u6570\u91cf\u7684\u6570\u636e\u8bb0\u5f55\uff0c\u53ef\u4ee5\u4f7f\u7528MongoDB\u7684Limit\u65b9\u6cd5\uff0climit()\u65b9\u6cd5\u63a5\u53d7\u4e00\u4e2a\u6570\u5b57\u53c2\u6570\uff0c\u8be5\u53c2\u6570\u6307\u5b9a\u4eceMongoDB\u4e2d\u8bfb\u53d6\u7684\u8bb0\u5f55\u6761\u6570\u3002 limit()\u65b9\u6cd5\u57fa\u672c\u8bed\u6cd5\u5982\u4e0b\u6240\u793a\uff1a db.COLLECTION_NAME.find().limit(NUMBER) \u64cd\u4f5c\u8fc7\u7a0b > db.col.find() { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } > db.col.find().limit(2) { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } > db.col.find({},{\"title\":1,_id:0}).limit(2) { \"title\" : \"Books \u6559\u7a0b\" } { \"title\" : \"Books \u6559\u7a0b\" } \u6ce8\u610f \u5982\u679c\u4f60\u4eec\u6ca1\u6709\u6307\u5b9a limit () \u65b9\u6cd5\u4e2d\u7684\u53c2\u6570\u5219\u663e\u793a\u96c6\u5408\u4e2d\u7684\u6240\u6709\u6570\u636e\u3002 2. Skip \u00b6 \u6211\u4eec\u9664\u4e86\u53ef\u4ee5\u4f7f\u7528limit()\u65b9\u6cd5\u6765\u8bfb\u53d6\u6307\u5b9a\u6570\u91cf\u7684\u6570\u636e\u5916\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528skip()\u65b9\u6cd5\u6765\u8df3\u8fc7\u6307\u5b9a\u6570\u91cf\u7684\u6570\u636e\uff0cskip\u65b9\u6cd5\u540c\u6837\u63a5\u53d7\u4e00\u4e2a\u6570\u5b57\u53c2\u6570\u4f5c\u4e3a\u8df3\u8fc7\u7684\u8bb0\u5f55\u6761\u6570 skip() \u65b9\u6cd5\u811a\u672c\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db.COLLECTION_NAME.find().limit(NUMBER).skip(NUMBER) \u64cd\u4f5c\u8fc7\u7a0b,\u4ee5\u4e0b\u5b9e\u4f8b\u53ea\u4f1a\u663e\u793a\u7b2c\u4e8c\u6761\u6587\u6863\u6570\u636e > db.col.find() { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } > db.col.find({},{\"description\":1,_id:0}).limit(1).skip(1) { \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\" } \u6ce8\u610f skip () \u65b9\u6cd5\u9ed8\u8ba4\u53c2\u6570\u4e3a 0","title":"08. MonogoDB LS"},{"location":"linux/nosql/mongo/mongo.limit_skip/#1-limit","text":"\u5982\u679c\u4f60\u9700\u8981\u5728MongoDB\u4e2d\u8bfb\u53d6\u6307\u5b9a\u6570\u91cf\u7684\u6570\u636e\u8bb0\u5f55\uff0c\u53ef\u4ee5\u4f7f\u7528MongoDB\u7684Limit\u65b9\u6cd5\uff0climit()\u65b9\u6cd5\u63a5\u53d7\u4e00\u4e2a\u6570\u5b57\u53c2\u6570\uff0c\u8be5\u53c2\u6570\u6307\u5b9a\u4eceMongoDB\u4e2d\u8bfb\u53d6\u7684\u8bb0\u5f55\u6761\u6570\u3002 limit()\u65b9\u6cd5\u57fa\u672c\u8bed\u6cd5\u5982\u4e0b\u6240\u793a\uff1a db.COLLECTION_NAME.find().limit(NUMBER) \u64cd\u4f5c\u8fc7\u7a0b > db.col.find() { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } > db.col.find().limit(2) { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } > db.col.find({},{\"title\":1,_id:0}).limit(2) { \"title\" : \"Books \u6559\u7a0b\" } { \"title\" : \"Books \u6559\u7a0b\" } \u6ce8\u610f \u5982\u679c\u4f60\u4eec\u6ca1\u6709\u6307\u5b9a limit () \u65b9\u6cd5\u4e2d\u7684\u53c2\u6570\u5219\u663e\u793a\u96c6\u5408\u4e2d\u7684\u6240\u6709\u6570\u636e\u3002","title":"1. Limit"},{"location":"linux/nosql/mongo/mongo.limit_skip/#2-skip","text":"\u6211\u4eec\u9664\u4e86\u53ef\u4ee5\u4f7f\u7528limit()\u65b9\u6cd5\u6765\u8bfb\u53d6\u6307\u5b9a\u6570\u91cf\u7684\u6570\u636e\u5916\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528skip()\u65b9\u6cd5\u6765\u8df3\u8fc7\u6307\u5b9a\u6570\u91cf\u7684\u6570\u636e\uff0cskip\u65b9\u6cd5\u540c\u6837\u63a5\u53d7\u4e00\u4e2a\u6570\u5b57\u53c2\u6570\u4f5c\u4e3a\u8df3\u8fc7\u7684\u8bb0\u5f55\u6761\u6570 skip() \u65b9\u6cd5\u811a\u672c\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b\uff1a db.COLLECTION_NAME.find().limit(NUMBER).skip(NUMBER) \u64cd\u4f5c\u8fc7\u7a0b,\u4ee5\u4e0b\u5b9e\u4f8b\u53ea\u4f1a\u663e\u793a\u7b2c\u4e8c\u6761\u6587\u6863\u6570\u636e > db.col.find() { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } > db.col.find({},{\"description\":1,_id:0}).limit(1).skip(1) { \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\" } \u6ce8\u610f skip () \u65b9\u6cd5\u9ed8\u8ba4\u53c2\u6570\u4e3a 0","title":"2. Skip"},{"location":"linux/nosql/mongo/mongo.monitor/","text":"MongoDB \u76d1\u63a7 1. \u4ecb\u7ecd \u00b6 \u5728\u4f60\u5df2\u7ecf\u5b89\u88c5\u90e8\u7f72\u5e76\u5141\u8bb8MongoDB\u670d\u52a1\u540e\uff0c\u4f60\u5fc5\u987b\u8981\u4e86\u89e3MongoDB\u7684\u8fd0\u884c\u60c5\u51b5\uff0c\u5e76\u67e5\u770bMongoDB\u7684\u6027\u80fd\u3002\u8fd9\u6837\u5728\u5927\u6d41\u91cf\u5f97\u60c5\u51b5\u4e0b\u53ef\u4ee5\u5f88\u597d\u7684\u5e94\u5bf9\u5e76\u4fdd\u8bc1MongoDB\u6b63\u5e38\u8fd0\u4f5c\u3002 MongoDB\u4e2d\u63d0\u4f9b\u4e86mongostat \u548c mongotop \u4e24\u4e2a\u547d\u4ee4\u6765\u76d1\u63a7MongoDB\u7684\u8fd0\u884c\u60c5\u51b5\u3002 2. mongostat \u547d\u4ee4 \u00b6 mongostat\u662fmongodb\u81ea\u5e26\u7684\u72b6\u6001\u68c0\u6d4b\u5de5\u5177\uff0c\u5728\u547d\u4ee4\u884c\u4e0b\u4f7f\u7528\u3002\u5b83\u4f1a\u95f4\u9694\u56fa\u5b9a\u65f6\u95f4\u83b7\u53d6mongodb\u7684\u5f53\u524d\u8fd0\u884c\u72b6\u6001\uff0c\u5e76\u8f93\u51fa\u3002\u5982\u679c\u4f60\u53d1\u73b0\u6570\u636e\u5e93\u7a81\u7136\u53d8\u6162\u6216\u8005\u6709\u5176\u4ed6\u95ee\u9898\u7684\u8bdd\uff0c\u4f60\u7b2c\u4e00\u624b\u7684\u64cd\u4f5c\u5c31\u8003\u8651\u91c7\u7528mongostat\u6765\u67e5\u770bmongo\u7684\u72b6\u6001\u3002 \u542f\u52a8\u4f60\u7684Mongod\u670d\u52a1 \u7136\u540e\u8f93\u5165mongostat\u547d\u4ee4\uff0c\u5982\u4e0b\u6240\u793a\uff1a [root@leco ~]# mongostat insert query update delete getmore command dirty used flushes vsize res qrw arw net_in net_out conn time *0 *0 *0 *0 0 2|0 0.0% 0.0% 0 1.00G 43.0M 0|0 1|0 161b 63.5k 5 Feb 27 13:58:31.473 *0 *0 *0 *0 0 1|0 0.0% 0.0% 0 1.00G 43.0M 0|0 1|0 157b 62.2k 5 Feb 27 13:58:32.473 *0 *0 *0 *0 0 1|0 0.0% 0.0% 0 1.00G 43.0M 0|0 1|0 157b 62.1k 5 Feb 27 13:58:33.474 *0 *0 *0 *0 0 2|0 0.0% 0.0% 0 1.00G 43.0M 0|0 1|0 158b 62.3k 5 Feb 27 13:58:34.472 *0 *0 *0 *0 0 2|0 0.0% 0.0% 0 1.00G 43.0M 0|0 1|0 158b 62.2k 5 Feb 27 13:58:35.472 *0 *0 *0 *0 0 1|0 0.0% 0.0% 0 1.00G 43.0M 0|0 1|0 157b 62.1k 5 Feb 27 13:58:36.473 \u53c2\u6570\u8bf4\u660e insert \u6bcf\u79d2\u63d2\u5165\u91cf query \u6bcf\u79d2\u67e5\u8be2\u91cf update \u6bcf\u79d2\u66f4\u65b0\u91cf delete \u6bcf\u79d2\u5220\u9664\u91cf conn \u5f53\u524d\u8fde\u63a5\u6570 qr | qw \u5ba2\u6237\u7aef\u67e5\u8be2\u6392\u961f\u957f\u5ea6\uff08\u8bfb | \u5199\uff09\u6700\u597d\u4e3a 0 \uff0c\u5982\u679c\u6709\u5806\u79ef\uff0c\u6570\u636e\u5e93\u5904\u7406\u6162\u3002 ar | aw \u6d3b\u8dc3\u5ba2\u6237\u7aef\u6570\u91cf\uff08\u8bfb | \u5199\uff09 time \u5f53\u524d\u65f6\u95f4 3. mongotop \u547d\u4ee4 \u00b6 3.1 \u4e0d\u5e26\u53c2\u6570 \u00b6 mongotop\u4e5f\u662fmongodb\u4e0b\u7684\u4e00\u4e2a\u5185\u7f6e\u5de5\u5177\uff0cmongotop\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b9\u6cd5\uff0c\u7528\u6765\u8ddf\u8e2a\u4e00\u4e2aMongoDB\u7684\u5b9e\u4f8b\uff0c\u67e5\u770b\u54ea\u4e9b\u5927\u91cf\u7684\u65f6\u95f4\u82b1\u8d39\u5728\u8bfb\u53d6\u548c\u5199\u5165\u6570\u636e\u3002 mongotop\u63d0\u4f9b\u6bcf\u4e2a\u96c6\u5408\u7684\u6c34\u5e73\u7684\u7edf\u8ba1\u6570\u636e\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cmongotop\u8fd4\u56de\u503c\u7684\u6bcf\u4e00\u79d2\u3002 \u542f\u52a8\u4f60\u7684Mongod\u670d\u52a1,\u7136\u540e\u8f93\u5165mongotop\u547d\u4ee4\uff0c\u5982\u4e0b\u6240\u793a\uff1a [root@leco ~]# mongotop 2019-02-27T13:59:52.914+0800 connected to: 127.0.0.1 ns total read write 2019-02-27T13:59:53+08:00 admin.$cmd.aggregate 0ms 0ms 0ms admin.system.roles 0ms 0ms 0ms admin.system.version 0ms 0ms 0ms cmz.col 0ms 0ms 0ms cmz.col2 0ms 0ms 0ms cmz.col3 0ms 0ms 0ms cmz.test 0ms 0ms 0ms config.system.sessions 0ms 0ms 0ms local.startup_log 0ms 0ms 0ms local.system.replset 0ms 0ms 0ms \u53c2\u6570\u8bf4\u660e ns \uff1a \u6570\u636e\u5e93\u547d\u540d\u7a7a\u95f4\uff0c\u540e\u8005\u7ed3\u5408\u4e86\u6570\u636e\u5e93\u540d\u79f0\u548c\u96c6\u5408\u3002 total \uff1a mongod\u5728\u8fd9\u4e2a\u547d\u4ee4\u7a7a\u95f4\u4e0a\u82b1\u8d39\u7684\u603b\u65f6\u95f4 \u3002 read \uff1a \u5728\u8fd9\u4e2a\u547d\u4ee4\u7a7a\u95f4\u4e0a mongod\u6267\u884c\u8bfb\u64cd\u4f5c\u82b1\u8d39\u7684\u65f6\u95f4 \u3002 write \uff1a \u5728\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u4e0a mongod\u8fdb\u884c\u5199\u64cd\u4f5c\u82b1\u8d39\u7684\u65f6\u95f4 \u3002 3.2 \u5e26\u53c2\u6570 \u00b6 [root@leco ~]# mongotop 10 2019-02-27T14:00:54.803+0800 connected to: 127.0.0.1 ns total read write 2019-02-27T14:01:04+08:00 admin.$cmd.aggregate 0ms 0ms 0ms admin.system.roles 0ms 0ms 0ms admin.system.version 0ms 0ms 0ms cmz.col 0ms 0ms 0ms cmz.col2 0ms 0ms 0ms cmz.col3 0ms 0ms 0ms cmz.test 0ms 0ms 0ms config.system.sessions 0ms 0ms 0ms local.startup_log 0ms 0ms 0ms local.system.replset 0ms 0ms 0ms \u540e\u9762\u768410\u662f \u53c2\u6570 \uff0c\u53ef\u4ee5\u4e0d\u4f7f\u7528\uff0c\u7b49\u5f85\u7684\u65f6\u95f4\u957f\u5ea6\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0cmongotop\u7b49\u5f85\u8c03\u7528\u4e4b\u95f4\u3002\u901a\u8fc7\u7684\u9ed8\u8ba4mongotop\u8fd4\u56de\u6570\u636e\u7684\u6bcf\u4e00\u79d2\u3002 3.3 locks \u00b6 \u62a5\u544a\u6bcf\u4e2a\u6570\u636e\u5e93\u7684\u9501\u7684\u4f7f\u7528\u4e2d\uff0c\u4f7f\u7528mongotop - \u9501\uff0c\u8fd9\u5c06\u4ea7\u751f\u4ee5\u4e0b\u8f93\u51fa\uff1a root@leco:~/book/books/docs/linux/nosql/mongo# mongotop --locks connected to: 127.0.0.1 db total read write 2019-02-27T06:02:29 test 0ms 0ms 0ms local 0ms 0ms 0ms example 0ms 0ms 0ms crawler 0ms 0ms 0ms cmz 0ms 0ms 0ms admin 0ms 0ms 0ms . 0ms 0ms 0ms \u8f93\u51fa\u7ed3\u679c\u5b57\u6bb5\u8bf4\u660e\uff1a ns\uff1a\u5305\u542b\u6570\u636e\u5e93\u547d\u540d\u7a7a\u95f4\uff0c\u540e\u8005\u7ed3\u5408\u4e86\u6570\u636e\u5e93\u540d\u79f0\u548c\u96c6\u5408\u3002 db\uff1a\u5305\u542b\u6570\u636e\u5e93\u7684\u540d\u79f0\u3002\u540d\u4e3a . \u7684\u6570\u636e\u5e93\u9488\u5bf9\u5168\u5c40\u9501\u5b9a\uff0c\u800c\u975e\u7279\u5b9a\u6570\u636e\u5e93\u3002 total\uff1amongod\u82b1\u8d39\u7684\u65f6\u95f4\u5de5\u4f5c\u5728\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u63d0\u4f9b\u603b\u989d\u3002 read\uff1a\u63d0\u4f9b\u4e86\u5927\u91cf\u7684\u65f6\u95f4\uff0c\u8fd9mongod\u82b1\u8d39\u5728\u6267\u884c\u8bfb\u64cd\u4f5c\uff0c\u5728\u6b64\u547d\u540d\u7a7a\u95f4\u3002 write\uff1a\u63d0\u4f9b\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u8fdb\u884c\u5199\u64cd\u4f5c\uff0c\u8fd9mongod\u82b1\u4e86\u5927\u91cf\u7684\u65f6\u95f4\u3002 \u6ce8\u610f \u65b0\u7248\u672c\u4e0d\u5728\u652f\u6301\u8be5\u547d\u4ee4","title":"11. MonogoDB \u76d1\u63a7"},{"location":"linux/nosql/mongo/mongo.monitor/#1","text":"\u5728\u4f60\u5df2\u7ecf\u5b89\u88c5\u90e8\u7f72\u5e76\u5141\u8bb8MongoDB\u670d\u52a1\u540e\uff0c\u4f60\u5fc5\u987b\u8981\u4e86\u89e3MongoDB\u7684\u8fd0\u884c\u60c5\u51b5\uff0c\u5e76\u67e5\u770bMongoDB\u7684\u6027\u80fd\u3002\u8fd9\u6837\u5728\u5927\u6d41\u91cf\u5f97\u60c5\u51b5\u4e0b\u53ef\u4ee5\u5f88\u597d\u7684\u5e94\u5bf9\u5e76\u4fdd\u8bc1MongoDB\u6b63\u5e38\u8fd0\u4f5c\u3002 MongoDB\u4e2d\u63d0\u4f9b\u4e86mongostat \u548c mongotop \u4e24\u4e2a\u547d\u4ee4\u6765\u76d1\u63a7MongoDB\u7684\u8fd0\u884c\u60c5\u51b5\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/mongo/mongo.monitor/#2-mongostat","text":"mongostat\u662fmongodb\u81ea\u5e26\u7684\u72b6\u6001\u68c0\u6d4b\u5de5\u5177\uff0c\u5728\u547d\u4ee4\u884c\u4e0b\u4f7f\u7528\u3002\u5b83\u4f1a\u95f4\u9694\u56fa\u5b9a\u65f6\u95f4\u83b7\u53d6mongodb\u7684\u5f53\u524d\u8fd0\u884c\u72b6\u6001\uff0c\u5e76\u8f93\u51fa\u3002\u5982\u679c\u4f60\u53d1\u73b0\u6570\u636e\u5e93\u7a81\u7136\u53d8\u6162\u6216\u8005\u6709\u5176\u4ed6\u95ee\u9898\u7684\u8bdd\uff0c\u4f60\u7b2c\u4e00\u624b\u7684\u64cd\u4f5c\u5c31\u8003\u8651\u91c7\u7528mongostat\u6765\u67e5\u770bmongo\u7684\u72b6\u6001\u3002 \u542f\u52a8\u4f60\u7684Mongod\u670d\u52a1 \u7136\u540e\u8f93\u5165mongostat\u547d\u4ee4\uff0c\u5982\u4e0b\u6240\u793a\uff1a [root@leco ~]# mongostat insert query update delete getmore command dirty used flushes vsize res qrw arw net_in net_out conn time *0 *0 *0 *0 0 2|0 0.0% 0.0% 0 1.00G 43.0M 0|0 1|0 161b 63.5k 5 Feb 27 13:58:31.473 *0 *0 *0 *0 0 1|0 0.0% 0.0% 0 1.00G 43.0M 0|0 1|0 157b 62.2k 5 Feb 27 13:58:32.473 *0 *0 *0 *0 0 1|0 0.0% 0.0% 0 1.00G 43.0M 0|0 1|0 157b 62.1k 5 Feb 27 13:58:33.474 *0 *0 *0 *0 0 2|0 0.0% 0.0% 0 1.00G 43.0M 0|0 1|0 158b 62.3k 5 Feb 27 13:58:34.472 *0 *0 *0 *0 0 2|0 0.0% 0.0% 0 1.00G 43.0M 0|0 1|0 158b 62.2k 5 Feb 27 13:58:35.472 *0 *0 *0 *0 0 1|0 0.0% 0.0% 0 1.00G 43.0M 0|0 1|0 157b 62.1k 5 Feb 27 13:58:36.473 \u53c2\u6570\u8bf4\u660e insert \u6bcf\u79d2\u63d2\u5165\u91cf query \u6bcf\u79d2\u67e5\u8be2\u91cf update \u6bcf\u79d2\u66f4\u65b0\u91cf delete \u6bcf\u79d2\u5220\u9664\u91cf conn \u5f53\u524d\u8fde\u63a5\u6570 qr | qw \u5ba2\u6237\u7aef\u67e5\u8be2\u6392\u961f\u957f\u5ea6\uff08\u8bfb | \u5199\uff09\u6700\u597d\u4e3a 0 \uff0c\u5982\u679c\u6709\u5806\u79ef\uff0c\u6570\u636e\u5e93\u5904\u7406\u6162\u3002 ar | aw \u6d3b\u8dc3\u5ba2\u6237\u7aef\u6570\u91cf\uff08\u8bfb | \u5199\uff09 time \u5f53\u524d\u65f6\u95f4","title":"2. mongostat \u547d\u4ee4"},{"location":"linux/nosql/mongo/mongo.monitor/#3-mongotop","text":"","title":"3. mongotop \u547d\u4ee4"},{"location":"linux/nosql/mongo/mongo.monitor/#31","text":"mongotop\u4e5f\u662fmongodb\u4e0b\u7684\u4e00\u4e2a\u5185\u7f6e\u5de5\u5177\uff0cmongotop\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b9\u6cd5\uff0c\u7528\u6765\u8ddf\u8e2a\u4e00\u4e2aMongoDB\u7684\u5b9e\u4f8b\uff0c\u67e5\u770b\u54ea\u4e9b\u5927\u91cf\u7684\u65f6\u95f4\u82b1\u8d39\u5728\u8bfb\u53d6\u548c\u5199\u5165\u6570\u636e\u3002 mongotop\u63d0\u4f9b\u6bcf\u4e2a\u96c6\u5408\u7684\u6c34\u5e73\u7684\u7edf\u8ba1\u6570\u636e\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cmongotop\u8fd4\u56de\u503c\u7684\u6bcf\u4e00\u79d2\u3002 \u542f\u52a8\u4f60\u7684Mongod\u670d\u52a1,\u7136\u540e\u8f93\u5165mongotop\u547d\u4ee4\uff0c\u5982\u4e0b\u6240\u793a\uff1a [root@leco ~]# mongotop 2019-02-27T13:59:52.914+0800 connected to: 127.0.0.1 ns total read write 2019-02-27T13:59:53+08:00 admin.$cmd.aggregate 0ms 0ms 0ms admin.system.roles 0ms 0ms 0ms admin.system.version 0ms 0ms 0ms cmz.col 0ms 0ms 0ms cmz.col2 0ms 0ms 0ms cmz.col3 0ms 0ms 0ms cmz.test 0ms 0ms 0ms config.system.sessions 0ms 0ms 0ms local.startup_log 0ms 0ms 0ms local.system.replset 0ms 0ms 0ms \u53c2\u6570\u8bf4\u660e ns \uff1a \u6570\u636e\u5e93\u547d\u540d\u7a7a\u95f4\uff0c\u540e\u8005\u7ed3\u5408\u4e86\u6570\u636e\u5e93\u540d\u79f0\u548c\u96c6\u5408\u3002 total \uff1a mongod\u5728\u8fd9\u4e2a\u547d\u4ee4\u7a7a\u95f4\u4e0a\u82b1\u8d39\u7684\u603b\u65f6\u95f4 \u3002 read \uff1a \u5728\u8fd9\u4e2a\u547d\u4ee4\u7a7a\u95f4\u4e0a mongod\u6267\u884c\u8bfb\u64cd\u4f5c\u82b1\u8d39\u7684\u65f6\u95f4 \u3002 write \uff1a \u5728\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u4e0a mongod\u8fdb\u884c\u5199\u64cd\u4f5c\u82b1\u8d39\u7684\u65f6\u95f4 \u3002","title":"3.1 \u4e0d\u5e26\u53c2\u6570"},{"location":"linux/nosql/mongo/mongo.monitor/#32","text":"[root@leco ~]# mongotop 10 2019-02-27T14:00:54.803+0800 connected to: 127.0.0.1 ns total read write 2019-02-27T14:01:04+08:00 admin.$cmd.aggregate 0ms 0ms 0ms admin.system.roles 0ms 0ms 0ms admin.system.version 0ms 0ms 0ms cmz.col 0ms 0ms 0ms cmz.col2 0ms 0ms 0ms cmz.col3 0ms 0ms 0ms cmz.test 0ms 0ms 0ms config.system.sessions 0ms 0ms 0ms local.startup_log 0ms 0ms 0ms local.system.replset 0ms 0ms 0ms \u540e\u9762\u768410\u662f \u53c2\u6570 \uff0c\u53ef\u4ee5\u4e0d\u4f7f\u7528\uff0c\u7b49\u5f85\u7684\u65f6\u95f4\u957f\u5ea6\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0cmongotop\u7b49\u5f85\u8c03\u7528\u4e4b\u95f4\u3002\u901a\u8fc7\u7684\u9ed8\u8ba4mongotop\u8fd4\u56de\u6570\u636e\u7684\u6bcf\u4e00\u79d2\u3002","title":"3.2 \u5e26\u53c2\u6570"},{"location":"linux/nosql/mongo/mongo.monitor/#33-locks","text":"\u62a5\u544a\u6bcf\u4e2a\u6570\u636e\u5e93\u7684\u9501\u7684\u4f7f\u7528\u4e2d\uff0c\u4f7f\u7528mongotop - \u9501\uff0c\u8fd9\u5c06\u4ea7\u751f\u4ee5\u4e0b\u8f93\u51fa\uff1a root@leco:~/book/books/docs/linux/nosql/mongo# mongotop --locks connected to: 127.0.0.1 db total read write 2019-02-27T06:02:29 test 0ms 0ms 0ms local 0ms 0ms 0ms example 0ms 0ms 0ms crawler 0ms 0ms 0ms cmz 0ms 0ms 0ms admin 0ms 0ms 0ms . 0ms 0ms 0ms \u8f93\u51fa\u7ed3\u679c\u5b57\u6bb5\u8bf4\u660e\uff1a ns\uff1a\u5305\u542b\u6570\u636e\u5e93\u547d\u540d\u7a7a\u95f4\uff0c\u540e\u8005\u7ed3\u5408\u4e86\u6570\u636e\u5e93\u540d\u79f0\u548c\u96c6\u5408\u3002 db\uff1a\u5305\u542b\u6570\u636e\u5e93\u7684\u540d\u79f0\u3002\u540d\u4e3a . \u7684\u6570\u636e\u5e93\u9488\u5bf9\u5168\u5c40\u9501\u5b9a\uff0c\u800c\u975e\u7279\u5b9a\u6570\u636e\u5e93\u3002 total\uff1amongod\u82b1\u8d39\u7684\u65f6\u95f4\u5de5\u4f5c\u5728\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u63d0\u4f9b\u603b\u989d\u3002 read\uff1a\u63d0\u4f9b\u4e86\u5927\u91cf\u7684\u65f6\u95f4\uff0c\u8fd9mongod\u82b1\u8d39\u5728\u6267\u884c\u8bfb\u64cd\u4f5c\uff0c\u5728\u6b64\u547d\u540d\u7a7a\u95f4\u3002 write\uff1a\u63d0\u4f9b\u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u8fdb\u884c\u5199\u64cd\u4f5c\uff0c\u8fd9mongod\u82b1\u4e86\u5927\u91cf\u7684\u65f6\u95f4\u3002 \u6ce8\u610f \u65b0\u7248\u672c\u4e0d\u5728\u652f\u6301\u8be5\u547d\u4ee4","title":"3.3 locks"},{"location":"linux/nosql/mongo/mongo.replication/","text":"mongod\u526f\u672c\u96c6 1. \u4ecb\u7ecd \u00b6 MongoDB \u526f\u672c\u96c6\uff08Replica Set\uff09\u662f\u6709\u81ea\u52a8\u6545\u969c\u6062\u590d\u529f\u80fd\u7684\u4e3b\u4ece\u96c6\u7fa4\uff0c\u6709\u4e00\u4e2aPrimary\u8282\u70b9\u548c\u4e00\u4e2a\u6216\u591a\u4e2aSecondary\u8282\u70b9\u7ec4\u6210\u3002\u7c7b\u4f3c\u4e8eMySQL\u7684MMM\u67b6\u6784\u3002\u66f4\u591a\u5173\u4e8e\u526f\u672c\u96c6\u7684\u4ecb\u7ecd\u8bf7\u89c1 \u5b98\u7f51 \u3002\u4e5f\u53ef\u4ee5\u5728google\u3001baidu\u4e0a\u67e5\u9605\u3002mongodb\u662f\u4e00\u6b3e\u4f18\u79c0\u7684nosql\u8f6f\u4ef6\u3002\u56e0\u4e3a\u8d77\u70b9\u665a\uff0c\u5438\u53d6\u4e86\u524d\u8f88\u4eec\u7684\u4f18\u70b9\uff0c 2. \u539f\u7406 \u00b6 \u526f\u672c\u96c6\u4e2d\u6570\u636e\u540c\u6b65\u8fc7\u7a0b\uff1aPrimary\u8282\u70b9\u5199\u5165\u6570\u636e\uff0cSecondary\u901a\u8fc7\u8bfb\u53d6Primary\u7684oplog\u5f97\u5230\u590d\u5236\u4fe1\u606f\uff0c\u5f00\u59cb\u590d\u5236\u6570\u636e\u5e76\u4e14\u5c06\u590d\u5236\u4fe1\u606f\u5199\u5165\u5230\u81ea\u5df1\u7684oplog\u3002\u5982\u679c\u67d0\u4e2a\u64cd\u4f5c\u5931\u8d25\uff0c\u5219\u5907\u4efd\u8282\u70b9\u505c\u6b62\u4ece\u5f53\u524d\u6570\u636e\u6e90\u590d\u5236\u6570\u636e\u3002\u5982\u679c\u67d0\u4e2a\u5907\u4efd\u8282\u70b9\u7531\u4e8e\u67d0\u4e9b\u539f\u56e0\u6302\u6389\u4e86\uff0c\u5f53\u91cd\u65b0\u542f\u52a8\u540e\uff0c\u5c31\u4f1a\u81ea\u52a8\u4eceoplog\u7684\u6700\u540e\u4e00\u4e2a\u64cd\u4f5c\u5f00\u59cb\u540c\u6b65\uff0c\u540c\u6b65\u5b8c\u6210\u540e\uff0c\u5c06\u4fe1\u606f\u5199\u5165\u81ea\u5df1\u7684oplog\uff0c\u7531\u4e8e\u590d\u5236\u64cd\u4f5c\u662f\u5148\u590d\u5236\u6570\u636e\uff0c\u590d\u5236\u5b8c\u6210\u540e\u518d\u5199\u5165oplog\uff0c\u6709\u53ef\u80fd\u76f8\u540c\u7684\u64cd\u4f5c\u4f1a\u540c\u6b65\u4e24\u4efd\uff0c\u4e0d\u8fc7MongoDB\u5728\u8bbe\u8ba1\u4e4b\u521d\u5c31\u8003\u8651\u5230\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c06oplog\u7684\u540c\u4e00\u4e2a\u64cd\u4f5c\u6267\u884c\u591a\u6b21\uff0c\u4e0e\u6267\u884c\u4e00\u6b21\u7684\u6548\u679c\u662f\u4e00\u6837\u7684\u3002\u7b80\u5355\u7684\u8bf4\u5c31\u662f\uff1a \u5f53Primary\u8282\u70b9\u5b8c\u6210\u6570\u636e\u64cd\u4f5c\u540e\uff0cSecondary\u4f1a\u505a\u51fa\u4e00\u7cfb\u5217\u7684\u52a8\u4f5c\u4fdd\u8bc1\u6570\u636e\u7684\u540c\u6b65 1\uff1a\u68c0\u67e5\u81ea\u5df1local\u5e93\u7684oplog.rs\u96c6\u5408\u627e\u51fa\u6700\u8fd1\u7684\u65f6\u95f4\u6233\u3002 2\uff1a\u68c0\u67e5Primary\u8282\u70b9local\u5e93oplog.rs\u96c6\u5408\uff0c\u627e\u51fa\u5927\u4e8e\u6b64\u65f6\u95f4\u6233\u7684\u8bb0\u5f55\u3002 3\uff1a\u5c06\u627e\u5230\u7684\u8bb0\u5f55\u63d2\u5165\u5230\u81ea\u5df1\u7684oplog.rs\u96c6\u5408\u4e2d\uff0c\u5e76\u6267\u884c\u8fd9\u4e9b\u64cd\u4f5c\u3002 \u526f\u672c\u96c6\u7684\u540c\u6b65\u548c\u4e3b\u4ece\u540c\u6b65\u4e00\u6837\uff0c\u90fd\u662f\u5f02\u6b65\u540c\u6b65\u7684\u8fc7\u7a0b\uff0c\u4e0d\u540c\u7684\u662f\u526f\u672c\u96c6\u6709\u4e2a\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\u7684\u529f\u80fd\u3002\u5176\u539f\u7406\u662f\uff1aslave\u7aef\u4eceprimary\u7aef\u83b7\u53d6\u65e5\u5fd7\uff0c\u7136\u540e\u5728\u81ea\u5df1\u8eab\u4e0a\u5b8c\u5168\u987a\u5e8f\u7684\u6267\u884c\u65e5\u5fd7\u6240\u8bb0\u5f55\u7684\u5404\u79cd\u64cd\u4f5c\uff08\u8be5\u65e5\u5fd7\u662f\u4e0d\u8bb0\u5f55\u67e5\u8be2\u64cd\u4f5c\u7684\uff09\uff0c\u8fd9\u4e2a\u65e5\u5fd7\u5c31\u662flocal\u6570\u636e \u5e93\u4e2d\u7684oplog.rs\u8868\uff0c\u9ed8\u8ba4\u572864\u4f4d\u673a\u5668\u4e0a\u8fd9\u4e2a\u8868\u662f\u6bd4\u8f83\u5927\u7684\uff0c\u5360\u78c1\u76d8\u5927\u5c0f\u76845%\uff0coplog.rs\u7684\u5927\u5c0f\u53ef\u4ee5\u5728\u542f\u52a8\u53c2\u6570\u4e2d\u8bbe \u5b9a\uff1a--oplogSize 1000,\u5355\u4f4d\u662fM\u3002 \u6ce8\u610f\uff1a\u5728\u526f\u672c\u96c6\u7684\u73af\u5883\u4e2d\uff0c\u8981\u662f\u6240\u6709\u7684Secondary\u90fd\u5b95\u673a\u4e86\uff0c\u53ea\u5269\u4e0bPrimary\u3002\u6700\u540ePrimary\u4f1a\u53d8\u6210Secondary\uff0c\u4e0d\u80fd\u63d0\u4f9b\u670d\u52a1\u3002 2.1 \u81ea\u52a8\u5207\u6362 \u00b6 \u96c6\u7fa4\u5f00\u59cb\uff0c\u5982\u4e0b primary\u6302\u4e86\u4ee5\u540e 3. \u90e8\u7f72\u642d\u5efa \u00b6 3.1 \u73af\u5883\u51c6\u5907 \u00b6 IP \u4e3b\u673a\u540d \u7cfb\u7edf \u5b89\u88c5\u8f6f\u4ef6 192.168.178.128 node3 ubuntu16 mongodb 192.168.178.129 node2 ubuntu16 mongodb 192.168.178.130 node1 ubuntu16 mongodb 3.2 \u5b89\u88c5 \u00b6 \u5b98\u7f51\u5305 \u79bb\u7ebf\u5b89\u88c5\u6587\u6863 \u5728\u7ebf\u5b89\u88c5\u6587\u6863 \u5b89\u88c5 sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4 echo \"deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/4.0 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list sudo apt-get update sudo apt-get install -y mongodb-org systemctl start mongod.service cp /etc/mongod.conf /etc/mongod.conf.ori sed -i 's/bindIp: 127.0.0.1/bindIp: 0.0.0.0/' /etc/mongod.conf grep -i 'bindIp' /etc/mongod.conf systemctl start mongod.service \u5378\u8f7d sudo service mongod stop sudo apt-get purge mongodb-org* sudo rm -r /var/log/mongodb sudo rm -r /var/lib/mongodb \u5b89\u88c5\u8fc7\u7a0b root@node1:~# sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4 Executing: /tmp/tmp.KG9f1TH9ct/gpg.1.sh --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4 gpg: requesting key E52529D4 from hkp server keyserver.ubuntu.com gpg: key E52529D4: public key \"MongoDB 4.0 Release Signing Key <packaging@mongodb.com>\" imported gpg: Total number processed: 1 gpg: imported: 1 (RSA: 1) root@node1:~# echo \"deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/4.0 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/4.0 multiverse root@node1:~# sudo apt-get install -y mongodb-org Reading package lists... Done ........ root@node1:~# systemctl start mongod.service Display all 159 possibilities? (y or n) root@node1:~# systemctl start mongod.service root@node1:~# systemctl status mongod.service \u25cf mongod.service - MongoDB Database Server Loaded: loaded (/lib/systemd/system/mongod.service; disabled; vendor preset: enabled) Active: active (running) since Wed 2019-04-03 09:56:57 CST; 6s ago Docs: https://docs.mongodb.org/manual Main PID: 3301 (mongod) CGroup: /system.slice/mongod.service \u2514\u25003301 /usr/bin/mongod --config /etc/mongod.conf Apr 03 09:56:57 node1 systemd[1]: Started MongoDB Database Server. root@node1:~# mongo MongoDB shell version v4.0.6 connecting to: mongodb://127.0.0.1:27017/?gssapiServiceName=mongodb Implicit session: session { \"id\" : UUID(\"acf7e437-8b69-4892-8e8c-cba85de600a0\") } MongoDB server version: 4.0.8 Welcome to the MongoDB shell. For interactive help, type \"help\". For more comprehensive documentation, see http://docs.mongodb.org/ Questions? Try the support group http://groups.google.com/group/mongodb-user Server has startup warnings: 2019-04-02T18:56:57.640-0700 I STORAGE [initandlisten] 2019-04-02T18:56:57.640-0700 I STORAGE [initandlisten] ** WARNING: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine 2019-04-02T18:56:57.640-0700 I STORAGE [initandlisten] ** See http://dochub.mongodb.org/core/prodnotes-filesystem 2019-04-02T18:56:58.353-0700 I CONTROL [initandlisten] 2019-04-02T18:56:58.353-0700 I CONTROL [initandlisten] ** WARNING: Access control is not enabled for the database. 2019-04-02T18:56:58.353-0700 I CONTROL [initandlisten] ** Read and write access to data and configuration is unrestricted. 2019-04-02T18:56:58.353-0700 I CONTROL [initandlisten] --- Enable MongoDB's free cloud-based monitoring service, which will then receive and display metrics about your deployment (disk utilization, CPU, operation statistics, etc). The monitoring data will be available on a MongoDB website with a unique URL accessible to you and anyone you share the URL with. MongoDB may use this information to make product improvements and to suggest MongoDB products and deployment options to you. To enable free monitoring, run the following command: db.enableFreeMonitoring() To permanently disable this reminder, run the following command: db.disableFreeMonitoring() --- > bye root@node1:~# mongo --help MongoDB shell version v4.0.6 usage: mongo [options] [db address] [file names (ending in .js)] db address can be: foo foo database on local machine 192.168.0.5/foo foo database on 192.168.0.5 machine 192.168.0.5:9999/foo foo database on 192.168.0.5 machine on port 9999 Options: --shell run the shell after executing files --nodb don't connect to mongod on startup - no 'db address' arg expected --norc will not run the \".mongorc.js\" file on start up --quiet be less chatty --port arg port to connect to --host arg server to connect to --eval arg evaluate javascript -h [ --help ] show this usage information --version show version information --verbose increase verbosity --ipv6 enable IPv6 support (disabled by default) --disableJavaScriptJIT disable the Javascript Just In Time compiler --enableJavaScriptJIT enable the Javascript Just In Time compiler --disableJavaScriptProtection allow automatic JavaScript function marshalling --retryWrites automatically retry write operations upon transient network errors --disableImplicitSessions do not automatically create and use implicit sessions --jsHeapLimitMB arg set the js scope's heap size limit Authentication Options: -u [ --username ] arg username for authentication -p [ --password ] arg password for authentication --authenticationDatabase arg user source (defaults to dbname) --authenticationMechanism arg authentication mechanism --gssapiServiceName arg (=mongodb) Service name to use when authenticating using GSSAPI/Kerberos --gssapiHostName arg Remote host name to use for purpose of GSSAPI/Kerberos authentication file names: a list of files to run. files have to end in .js and will exit after unless --shell is specified root@node1:~# mongo --quiet # \u9759\u6001\u8f93\u51fa\uff0c\u51cf\u5c11\u6253\u5370 > show dbs; admin 0.000GB config 0.000GB local 0.000GB root@node1:~# cp /etc/mongod.conf /etc/mongod.conf.ori root@node1:~# egrep -v '#|^$' /etc/mongod.conf storage: dbPath: /var/lib/mongodb journal: enabled: true systemLog: destination: file logAppend: true path: /var/log/mongodb/mongod.log net: port: 27017 bindIp: 127.0.0.1 processManagement: timeZoneInfo: /usr/share/zoneinfo root@node1:~# sed -i 's/bindIp: 127.0.0.1/bindIp: 0.0.0.0/' /etc/mongod.conf root@node1:~# grep -i 'bindIp' /etc/mongod.conf bindIp: 0.0.0.0 root@node1:~# systemctl restart mongod \u5b89\u88c5mingodb\u6bcf\u4e2a\u673a\u5668\u90fd\u8981\u5b89\u88c5\u3002\u5176\u4ed6\u673a\u5668\u5b89\u88c5\u7701\u7565\u3002 3.3 \u914d\u7f6e \u00b6 3.3.1 \u914d\u7f6e\u6587\u4ef6 \u00b6 \u914d\u7f6e\u6587\u4ef6\u6700\u540e\u52a0 replication: replSetName: repset mongodb\u901a\u8fc7\u8fd9\u4e2a\u6765\u7ec4\u6210\u96c6\u7fa4\u3002 \u586b\u5751 1. mongod\u7684\u914d\u7f6e\u6587\u4ef6 \uff0c\u6709 yaml\u683c\u5f0f\u4e5f\u6709\u666e\u901a\u7684 = \u683c\u5f0f\u3002 2. yaml\u683c\u5f0f\u7684\u53c2\u8003 https : // docs . mongodb . com / manual / reference / configuration - options / #replication.replSetName node1 \u914d\u7f6e\u6587\u4ef6 root @node1 : ~ # egrep -v '#|^$' /etc/mongod.conf storage : dbPath : / var / lib / mongodb journal : enabled : true systemLog : destination : file logAppend : true path : / var / log / mongodb / mongod . log net : port : 27017 bindIp : 0.0 . 0.0 processManagement : timeZoneInfo : / usr / share / zoneinfo replication : replSetName : repset node2 \u914d\u7f6e\u6587\u4ef6 root @node2 : ~ # egrep -v '#|^$' /etc/mongod.conf storage : dbPath : / var / lib / mongodb journal : enabled : true systemLog : destination : file logAppend : true path : / var / log / mongodb / mongod . log net : port : 27017 bindIp : 0.0 . 0.0 processManagement : timeZoneInfo : / usr / share / zoneinfo replication : replSetName : repset node3 \u914d\u7f6e\u6587\u4ef6 root @node3 : / usr / local / mongo / conf # egrep -v '#|^$' /etc/mongod.conf storage : dbPath : / var / lib / mongodb journal : enabled : true systemLog : destination : file logAppend : true path : / var / log / mongodb / mongod . log net : port : 27017 bindIp : 0.0 . 0.0 processManagement : timeZoneInfo : / usr / share / zoneinfo replication : replSetName : repset 3.3.2 \u521d\u59cb\u5316 \u00b6 \u5feb\u901f\u547d\u4ee4 rs.initiate() rs.conf() rs.add(\"node1:27017\") # \u96c6\u7fa4\u4e2d\u6dfb\u52a0\u673a\u5668 rs.add(\"node3:27017\") \u8be6\u7ec6\u8fc7\u7a0b > rs.initiate() { \"info2\" : \"no configuration specified. Using a default configuration for the set\", \"me\" : \"node2:27017\", \"ok\" : 1, \"operationTime\" : Timestamp(1554258330, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554258330, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:SECONDARY> rs.conf() { \"_id\" : \"repset\", \"version\" : 1, \"protocolVersion\" : NumberLong(1), \"writeConcernMajorityJournalDefault\" : true, \"members\" : [ { \"_id\" : 0, \"host\" : \"node2:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true, \"heartbeatIntervalMillis\" : 2000, \"heartbeatTimeoutSecs\" : 10, \"electionTimeoutMillis\" : 10000, \"catchUpTimeoutMillis\" : -1, \"catchUpTakeoverDelayMillis\" : 30000, \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1, \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId(\"5ca419993f98997dbf343825\") } } repset:PRIMARY> rs.add(\"node1:27017\") { \"ok\" : 1, \"operationTime\" : Timestamp(1554258349, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554258349, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> rs.add(\"node3:27017\") { \"ok\" : 1, \"operationTime\" : Timestamp(1554258369, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554258369, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> rs.status() { \"set\" : \"repset\", \"date\" : ISODate(\"2019-04-03T02:26:16.610Z\"), \"myState\" : 1, \"term\" : NumberLong(1), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"heartbeatIntervalMillis\" : NumberLong(2000), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"readConcernMajorityOpTime\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"appliedOpTime\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"durableOpTime\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) } }, \"lastStableCheckpointTimestamp\" : Timestamp(1554258332, 2), \"members\" : [ { \"_id\" : 0, \"name\" : \"node2:27017\", \"health\" : 1, \"state\" : 1, \"stateStr\" : \"PRIMARY\", \"uptime\" : 82, \"optime\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"optimeDate\" : ISODate(\"2019-04-03T02:26:09Z\"), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"could not find member to sync from\", \"electionTime\" : Timestamp(1554258330, 2), \"electionDate\" : ISODate(\"2019-04-03T02:25:30Z\"), \"configVersion\" : 3, \"self\" : true, \"lastHeartbeatMessage\" : \"\" }, { \"_id\" : 1, \"name\" : \"node1:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 26, \"optime\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"optimeDurable\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"optimeDate\" : ISODate(\"2019-04-03T02:26:09Z\"), \"optimeDurableDate\" : ISODate(\"2019-04-03T02:26:09Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T02:26:15.703Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T02:26:16.227Z\"), \"pingMs\" : NumberLong(1), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"configVersion\" : 3 }, { \"_id\" : 2, \"name\" : \"node3:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 6, \"optime\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"optimeDurable\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"optimeDate\" : ISODate(\"2019-04-03T02:26:09Z\"), \"optimeDurableDate\" : ISODate(\"2019-04-03T02:26:09Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T02:26:15.704Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T02:26:16.231Z\"), \"pingMs\" : NumberLong(1), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"configVersion\" : 3 } ], \"ok\" : 1, \"operationTime\" : Timestamp(1554258369, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554258369, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> bye \u89e3\u91ca \"_id\" : \u526f\u672c\u96c6\u7684\u540d\u79f0 \"members\" : \u526f\u672c\u96c6\u7684\u670d\u52a1\u5668\u5217\u8868 \"_id\" : \u670d\u52a1\u5668\u7684\u552f\u4e00 ID \"host\" : \u670d\u52a1\u5668\u4e3b\u673a \"priority\" : \u662f\u4f18\u5148\u7ea7\uff0c\u9ed8\u8ba4\u4e3a 1 \uff0c\u4f18\u5148\u7ea7 0 \u4e3a\u88ab\u52a8\u8282\u70b9\uff0c\u4e0d\u80fd\u6210\u4e3a\u6d3b\u8dc3\u8282\u70b9\u3002\u4f18\u5148\u7ea7\u4e0d\u4f4d 0 \u5219\u6309\u7167\u6709\u5927\u5230\u5c0f\u9009\u51fa\u6d3b\u8dc3\u8282\u70b9\u3002 \"arbiterOnly\" : \u4ef2\u88c1\u8282\u70b9\uff0c\u53ea\u53c2\u4e0e\u6295\u7968\uff0c\u4e0d\u63a5\u6536\u6570\u636e\uff0c\u4e5f\u4e0d\u80fd\u6210\u4e3a\u6d3b\u8dc3\u8282\u70b9\u3002 3.3.3 \u5176\u4ed6\u547d\u4ee4 \u00b6 repset:PRIMARY> rs. rs.add( rs.conf( rs.help( rs.prototype rs.syncFrom( rs.addArb( rs.config( rs.initiate( rs.reconfig( rs.toLocaleString( rs.apply( rs.constructor rs.isMaster( rs.remove( rs.toString( rs.bind( rs.debug rs.printReplicationInfo( rs.slaveOk( rs.valueOf( rs.call( rs.freeze( rs.printSlaveReplicationInfo( rs.status( rs.compareOpTimes( rs.hasOwnProperty( rs.propertyIsEnumerable( rs.stepDown( repset:PRIMARY> rs.help() rs.status() { replSetGetStatus : 1 } checks repl set status rs.initiate() { replSetInitiate : null } initiates set with default settings rs.initiate(cfg) { replSetInitiate : cfg } initiates set with configuration cfg rs.conf() get the current configuration object from local.system.replset rs.reconfig(cfg) updates the configuration of a running replica set with cfg (disconnects) rs.add(hostportstr) add a new member to the set with default attributes (disconnects) rs.add(membercfgobj) add a new member to the set with extra attributes (disconnects) rs.addArb(hostportstr) add a new member which is arbiterOnly:true (disconnects) rs.stepDown([stepdownSecs, catchUpSecs]) step down as primary (disconnects) rs.syncFrom(hostportstr) make a secondary sync from the given member rs.freeze(secs) make a node ineligible to become primary for the time specified rs.remove(hostportstr) remove a host from the replica set (disconnects) rs.slaveOk() allow queries on secondary nodes rs.printReplicationInfo() check oplog size and time range rs.printSlaveReplicationInfo() check replica set members and replication lag db.isMaster() check who is primary reconfiguration helpers disconnect from the database so the shell will display an error, even if the command succeeds. 3.4 \u6d4b\u8bd5 \u00b6 3.4.1 \u7b80\u5355\u6d4b\u8bd5 \u00b6 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u91cd\u542fmongo\u3002\u767b\u5f55\u6d4b\u8bd5\u3002 root@node1:~# mongo --quiet repset:SECONDARY> root@node2:~# mongo --quiet repset:PRIMARY> root@node3:~# mongo --quiet repset:SECONDARY> \u53ef\u4ee5\u770b\u51fanode2\u662fprimary\uff0c\u4e5f\u5c31\u662f\u4e3b\u3002\u5176\u4ed6\u4e24\u4e2anode1\uff0cnode3\u662fsecondary\u4e5f\u5c31\u662f\u4ece\u3002\u63a5\u4e0b\u6765\u6d4b\u8bd5\u3002 3.4.3 \u526f\u672c\u6d4b\u8bd5 \u00b6 \u4e3b\u6dfb\u52a0\u6570\u636e\uff0c\u4e0d\u9009\u62e9\u5e93\uff0c\u9ed8\u8ba4\u6dfb\u52a0\u5230test\u5e93\u4e2d\u3002 repset:PRIMARY> show dbs; admin 0.000GB config 0.000GB local 0.000GB test 0.000GB repset:PRIMARY> use test; switched to db test repset:PRIMARY> for(var i=0;i<10000;i++){db.test.insert({\"name\":\"caimengzhi\"+i,\"age\":123})} WriteResult({ \"nInserted\" : 1 }) repset:PRIMARY> show tables; col2 test repset:PRIMARY> db.test.count() 10000 \u4ece\u67e5\u770b repset:SECONDARY> use test; switched to db test repset:SECONDARY> db.test.count() 2019-04-03T13:19:39.080+0800 E QUERY [js] Error: count failed: { \"operationTime\" : Timestamp(1554268771, 1), \"ok\" : 0, \"errmsg\" : \"not master and slaveOk=false\", \"code\" : 13435, \"codeName\" : \"NotMasterNoSlaveOk\", \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554268771, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } : _getErrorWithCode@src/mongo/shell/utils.js:25:13 DBQuery.prototype.count@src/mongo/shell/query.js:383:11 DBCollection.prototype.count@src/mongo/shell/collection.js:1431:12 @(shell):1:1 repset:SECONDARY> rs.slaveOk() repset:SECONDARY> db.test.count() 10000 \u6ce8\u610f \u9ed8\u8ba4\u4ece\uff0c\u4e0d\u80fd\u8bfb\u548c\u5199\u7684 [ rs . slaveOk () \u4ece\u624d\u53ef\u4ee5\u8bfb ] \uff0c\u5426\u5219\u62a5\u9519\u5982\u4e0b : repset : SECONDARY > show dbs ; 2019 - 04 - 02 T19 : 46 : 28.450 - 0700 E QUERY [ js ] Error : listDatabases failed :{ \"operationTime\" : Timestamp ( 1554259582 , 1 ), \"ok\" : 0 , \"errmsg\" : \"not master and slaveOk=false\" , \"code\" : 13435 , \"codeName\" : \"NotMasterNoSlaveOk\" , \"$clusterTime\" : { \"clusterTime\" : Timestamp ( 1554259582 , 1 ), \"signature\" : { \"hash\" : BinData ( 0 , \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\" ), \"keyId\" : NumberLong ( 0 ) } } } : _getErrorWithCode @src / mongo / shell / utils . js : 25 : 13 Mongo . prototype . getDBs @src / mongo / shell / mongo . js : 139 : 1 shellHelper . show @src / mongo / shell / utils . js : 882 : 13 shellHelper @src / mongo / shell / utils . js : 766 : 15 @ ( shellhelp2 ): 1 : 1 3.4.3 \u9ad8\u53ef\u7528\u6d4b\u8bd5 \u00b6 \u5173\u95edprimary mongo repset:PRIMARY> db.col2.find() { \"_id\" : ObjectId(\"5ca41e317b1bb7f26e3fb62b\"), \"name\" : \"caimengzhi\" } repset:PRIMARY> root@node2:~# systemctl stop mongod.service \u67e5\u770b\u5176\u4ed6\u7684\uff0c\u671f\u4e2dnode1\u4e0amongodb\u81ea\u52a8\u5207\u6362\u4e3aprimary\u4e86\u3002node3\u8fd8\u662fSECONDARY\u3002 repset:SECONDARY> show dbs; admin 0.000GB config 0.000GB local 0.000GB test 0.000GB repset:PRIMARY> \u7ee7\u7eed\u6d4b\u8bd5 repset:PRIMARY> db.col2.insert({\"name\":\"\u53ef\u53ef\"}) WriteResult({ \"nInserted\" : 1 }) repset:PRIMARY> db.col2.find() { \"_id\" : ObjectId(\"5ca41e317b1bb7f26e3fb62b\"), \"name\" : \"caimengzhi\" } { \"_id\" : ObjectId(\"5ca4234d03595133e357b7e7\"), \"name\" : \"\u53ef\u53ef\" } repset:SECONDARY> db.col2.find() { \"_id\" : ObjectId(\"5ca41e317b1bb7f26e3fb62b\"), \"name\" : \"caimengzhi\" } { \"_id\" : ObjectId(\"5ca4234d03595133e357b7e7\"), \"name\" : \"\u53ef\u53ef\" } \u8bf4\u660e\u5b8c\u7f8e\u81ea\u52a8\u5207\u6362\u4e86\u3002\u6211\u518d\u8d77\u8d77\u70b9\u4e4b\u524d\u7684primary mongo\uff0c\u81ea\u52a8\u4f1a\u53d8\u6210secondary\u3002 secondary mongo\u662f\u4e0d\u5141\u8bb8\u5199\u6570\u636e\u7684 root@node2:~# mongo --quiet repset:SECONDARY> db.col2.insert({\"name\":\"\u6570\u636e\u6765\u81easecondary\"}) WriteCommandError({ \"operationTime\" : Timestamp(1554262271, 1), \"ok\" : 0, \"errmsg\" : \"not master\", \"code\" : 10107, \"codeName\" : \"NotMaster\", \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554262271, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } }) repset:SECONDARY> db.col2.find() Error: error: { \"operationTime\" : Timestamp(1554262281, 1), \"ok\" : 0, \"errmsg\" : \"not master and slaveOk=false\", \"code\" : 13435, \"codeName\" : \"NotMasterNoSlaveOk\", \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554262281, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:SECONDARY> rs.slaveOk() repset:SECONDARY> db.col2.find() { \"_id\" : ObjectId(\"5ca41e317b1bb7f26e3fb62b\"), \"name\" : \"caimengzhi\" } { \"_id\" : ObjectId(\"5ca4234d03595133e357b7e7\"), \"name\" : \"\u53ef\u53ef\" } 4. \u5176\u4ed6\u6d4b\u8bd5 \u00b6 4.1 \u5220\u9664 \u00b6 rs.remove('node2:27017') \u64cd\u4f5c repset:PRIMARY> rs.remove('node2:27017') { \"ok\" : 1, \"operationTime\" : Timestamp(1554262658, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554262658, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> rs.status() { \"set\" : \"repset\", \"date\" : ISODate(\"2019-04-03T03:37:41.088Z\"), \"myState\" : 1, \"term\" : NumberLong(2), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"heartbeatIntervalMillis\" : NumberLong(2000), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp(1554262658, 1), \"t\" : NumberLong(2) }, \"readConcernMajorityOpTime\" : { \"ts\" : Timestamp(1554262658, 1), \"t\" : NumberLong(2) }, \"appliedOpTime\" : { \"ts\" : Timestamp(1554262658, 1), \"t\" : NumberLong(2) }, \"durableOpTime\" : { \"ts\" : Timestamp(1554262658, 1), \"t\" : NumberLong(2) } }, \"lastStableCheckpointTimestamp\" : Timestamp(1554262621, 1), \"members\" : [ { \"_id\" : 1, \"name\" : \"node1:27017\", \"health\" : 1, \"state\" : 1, \"stateStr\" : \"PRIMARY\", \"uptime\" : 4382, \"optime\" : { \"ts\" : Timestamp(1554262658, 1), \"t\" : NumberLong(2) }, \"optimeDate\" : ISODate(\"2019-04-03T03:37:38Z\"), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"electionTime\" : Timestamp(1554260529, 1), \"electionDate\" : ISODate(\"2019-04-03T03:02:09Z\"), \"configVersion\" : 4, \"self\" : true, \"lastHeartbeatMessage\" : \"\" }, { \"_id\" : 2, \"name\" : \"node3:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 2822, \"optime\" : { \"ts\" : Timestamp(1554262658, 1), \"t\" : NumberLong(2) }, \"optimeDurable\" : { \"ts\" : Timestamp(1554262658, 1), \"t\" : NumberLong(2) }, \"optimeDate\" : ISODate(\"2019-04-03T03:37:38Z\"), \"optimeDurableDate\" : ISODate(\"2019-04-03T03:37:38Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T03:37:40.489Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T03:37:40.999Z\"), \"pingMs\" : NumberLong(1), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"configVersion\" : 4 } ], \"ok\" : 1, \"operationTime\" : Timestamp(1554262658, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554262658, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } 4.2 \u6dfb\u52a0 \u00b6 \u8981\u662f\u65b0\u7684\u673a\u5668\u60f3\u6dfb\u52a0\u5230\u96c6\u7fa4\u4e2d\uff0c\u53ea\u6709\u914d\u7f6e\u597d\u914d\u7f6e\u6587\u4ef6\uff0c\u7136\u540e\u542f\u52a8\u5728primary mongodb\u4e0a\u52a0\u5165\u8be5\u673a\u5668\u5373\u53ef\u3002 \u4e0a\u8282\u5427node2\u5254\u9664\u96c6\u7fa4\u4e86\u3002\u73b0\u5728\u6211\u4eec\u5047\u8bbenode2\u662f\u65b0\u7684\u673a\u5668\u3002\u7136\u540e\u52a0\u5165\u96c6\u7fa4\u5373\u53ef\u3002 rs.add(\"node2:27017\") \u64cd\u4f5c repset:PRIMARY> rs.add(\"node2:27017\") { \"ok\" : 1, \"operationTime\" : Timestamp(1554262759, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554262759, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> rs.status() { \"set\" : \"repset\", \"date\" : ISODate(\"2019-04-03T03:39:21.715Z\"), \"myState\" : 1, \"term\" : NumberLong(2), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"heartbeatIntervalMillis\" : NumberLong(2000), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp(1554262751, 1), \"t\" : NumberLong(2) }, \"appliedOpTime\" : { \"ts\" : Timestamp(1554262759, 1), \"t\" : NumberLong(2) }, \"durableOpTime\" : { \"ts\" : Timestamp(1554262759, 1), \"t\" : NumberLong(2) } }, \"lastStableCheckpointTimestamp\" : Timestamp(1554262741, 1), \"members\" : [ { \"_id\" : 1, \"name\" : \"node1:27017\", \"health\" : 1, \"state\" : 1, \"stateStr\" : \"PRIMARY\", \"uptime\" : 4482, \"optime\" : { \"ts\" : Timestamp(1554262759, 1), \"t\" : NumberLong(2) }, \"optimeDate\" : ISODate(\"2019-04-03T03:39:19Z\"), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"electionTime\" : Timestamp(1554260529, 1), \"electionDate\" : ISODate(\"2019-04-03T03:02:09Z\"), \"configVersion\" : 5, \"self\" : true, \"lastHeartbeatMessage\" : \"\" }, { \"_id\" : 2, \"name\" : \"node3:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 2923, \"optime\" : { \"ts\" : Timestamp(1554262751, 1), \"t\" : NumberLong(2) }, \"optimeDurable\" : { \"ts\" : Timestamp(1554262751, 1), \"t\" : NumberLong(2) }, \"optimeDate\" : ISODate(\"2019-04-03T03:39:11Z\"), \"optimeDurableDate\" : ISODate(\"2019-04-03T03:39:11Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T03:39:19.762Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T03:39:21.274Z\"), \"pingMs\" : NumberLong(18), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"node1:27017\", \"syncSourceHost\" : \"node1:27017\", \"syncSourceId\" : 1, \"infoMessage\" : \"\", \"configVersion\" : 4 }, { \"_id\" : 3, \"name\" : \"node2:27017\", \"health\" : 0, \"state\" : 8, \"stateStr\" : \"(not reachable/healthy)\", \"uptime\" : 0, \"optime\" : { \"ts\" : Timestamp(0, 0), \"t\" : NumberLong(-1) }, \"optimeDurable\" : { \"ts\" : Timestamp(0, 0), \"t\" : NumberLong(-1) }, \"optimeDate\" : ISODate(\"1970-01-01T00:00:00Z\"), \"optimeDurableDate\" : ISODate(\"1970-01-01T00:00:00Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T03:39:19.765Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T03:39:21.534Z\"), \"pingMs\" : NumberLong(0), \"lastHeartbeatMessage\" : \"Our replica set configuration is invalid or does not include us\", \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"configVersion\" : -1 } ], \"ok\" : 1, \"operationTime\" : Timestamp(1554262759, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554262759, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } 4.3 \u67e5\u770b\u590d\u5236\u7684\u60c5\u51b5 \u00b6 repset:PRIMARY> db.printSlaveReplicationInfo() source: node3:27017 syncedTo: Wed Apr 03 2019 13:10:21 GMT+0800 (CST) 0 secs (0 hrs) behind the primary source: node2:27017 syncedTo: Wed Apr 03 2019 13:10:21 GMT+0800 (CST) 0 secs (0 hrs) behind the primary \u89e3\u91ca source \uff1a\u4ece\u5e93\u7684 ip\u548c\u7aef\u53e3 \u3002 syncedTo \uff1a\u76ee\u524d\u7684\u540c\u6b65\u60c5\u51b5\uff0c\u4ee5\u53ca\u6700\u540e\u4e00\u6b21\u540c\u6b65\u7684\u65f6\u95f4\u3002 \u4ece\u4e0a\u9762\u53ef\u4ee5\u770b\u51fa\uff0c\u5728\u6570\u636e\u5e93\u5185\u5bb9\u4e0d\u53d8\u7684\u60c5\u51b5\u4e0b\u4ed6\u662f\u4e0d\u540c\u6b65\u7684\uff0c\u6570\u636e\u5e93\u53d8\u52a8\u5c31\u4f1a\u9a6c\u4e0a\u540c\u6b65 4.4 \u67e5\u770b\u526f\u672c\u96c6\u914d\u7f6e \u00b6 repset:PRIMARY> rs.conf() { \"_id\" : \"repset\", \"version\" : 5, \"protocolVersion\" : NumberLong(1), \"writeConcernMajorityJournalDefault\" : true, \"members\" : [ { \"_id\" : 1, \"host\" : \"node1:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 2, \"host\" : \"node3:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 3, \"host\" : \"node2:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true, \"heartbeatIntervalMillis\" : 2000, \"heartbeatTimeoutSecs\" : 10, \"electionTimeoutMillis\" : 10000, \"catchUpTimeoutMillis\" : -1, \"catchUpTakeoverDelayMillis\" : 30000, \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1, \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId(\"5ca419993f98997dbf343825\") } } 4.5 \u6ce8\u610f \u00b6 \u6240\u6709\u7684Secondary\u90fd\u5b95\u673a\u3001\u6216\u5219\u526f\u672c\u96c6\u4e2d\u53ea\u5269\u4e0b\u4e00\u4e2a\u8282\u70b9\uff0c\u5219\u8be5\u8282\u70b9\u53ea\u80fd\u4e3aSecondary\u8282\u70b9\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u6574\u4e2a\u96c6\u7fa4\u667a\u80fd\u8fdb\u884c\u8bfb\u64cd\u4f5c\u800c\u4e0d\u80fd\u8fdb\u884c\u5199\u64cd\u4f5c\uff0c\u5f53\u5176\u4ed6\u7684\u6062\u590d\u65f6\uff0c\u4e4b\u524d\u7684primary\u8282\u70b9\u4ecd\u7136\u662fprimary\u8282\u70b9\u3002 \u5f53\u67d0\u4e2a\u8282\u70b9\u5b95\u673a\u540e\u91cd\u65b0\u542f\u52a8\u8be5\u8282\u70b9\u4f1a\u6709\u4e00\u6bb5\u7684\u65f6\u95f4\uff08\u65f6\u95f4\u957f\u77ed\u89c6\u96c6\u7fa4\u7684\u6570\u636e\u91cf\u548c\u5b95\u673a\u65f6\u95f4\u800c\u5b9a\uff09\u5bfc\u81f4\u6574\u4e2a\u96c6\u7fa4\u4e2d\u6240\u6709\u8282\u70b9\u90fd\u6210\u4e3asecondary\u800c\u65e0\u6cd5\u8fdb\u884c\u5199\u64cd\u4f5c\uff08\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709\u8bbe\u7f6e\u76f8\u5e94\u7684ReadReference\u4e5f\u53ef\u80fd\u4e0d\u80fd\u8fdb\u884c\u8bfb\u53d6\u64cd\u4f5c\uff09\u3002 \u5b98\u65b9\u63a8\u8350\u7684\u6700\u5c0f\u7684\u526f\u672c\u96c6\u4e5f\u5e94\u8be5\u5177\u5907\u4e00\u4e2aprimary\u8282\u70b9\u548c\u4e24\u4e2asecondary\u8282\u70b9\u3002\u4e24\u4e2a\u8282\u70b9\u7684\u526f\u672c\u96c6\u4e0d\u5177\u5907\u771f\u6b63\u7684\u6545\u969c\u8f6c\u79fb\u80fd\u529b\u3002 5. \u5e94\u7528 \u00b6 5.1 \u624b\u52a8\u5207\u6362 \u00b6 \u624b\u52a8\u5207\u6362Primary\u8282\u70b9\u5230\u81ea\u5df1\u7ed9\u5b9a\u7684\u8282\u70b9\uff0c\u4e0a\u9762\u5df2\u7ecf\u63d0\u5230\u8fc7\u4e86\u4f18\u5148\u96c6priority\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u7684\u90fd\u662f1\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u628a\u7ed9\u5b9a\u7684\u670d\u52a1\u5668\u7684priority\u52a0\u5230\u6700\u5927\u5373\u53ef\u3002 \u67e5\u770bpriority repset : SECONDARY > rs . conf () { \"_id\" : \"repset\" , \"version\" : 5 , \"protocolVersion\" : NumberLong ( 1 ), \"writeConcernMajorityJournalDefault\" : true , \"members\" : [ { \"_id\" : 1 , \"host\" : \"node1:27017\" , \"arbiterOnly\" : false , \"buildIndexes\" : true , \"hidden\" : false , \"priority\" : 1 , \"tags\" : { }, \"slaveDelay\" : NumberLong ( 0 ), \"votes\" : 1 }, { \"_id\" : 2 , \"host\" : \"node3:27017\" , \"arbiterOnly\" : false , \"buildIndexes\" : true , \"hidden\" : false , \"priority\" : 1 , \"tags\" : { }, \"slaveDelay\" : NumberLong ( 0 ), \"votes\" : 1 }, { \"_id\" : 3 , \"host\" : \"node2:27017\" , \"arbiterOnly\" : false , \"buildIndexes\" : true , \"hidden\" : false , \"priority\" : 1 , \"tags\" : { }, \"slaveDelay\" : NumberLong ( 0 ), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true , \"heartbeatIntervalMillis\" : 2000 , \"heartbeatTimeoutSecs\" : 10 , \"electionTimeoutMillis\" : 10000 , \"catchUpTimeoutMillis\" : - 1 , \"catchUpTakeoverDelayMillis\" : 30000 , \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1 , \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId ( \"5ca419993f98997dbf343825\" ) } } \u5148\u67e5\u770b\u8c01\u662fprimary \u67e5\u770b\u8c01\u662fprimary repset : SECONDARY > rs . isMaster () { \"hosts\" : [ \"node1:27017\" , \"node3:27017\" , \"node2:27017\" ], \"setName\" : \"repset\" , \"setVersion\" : 5 , \"ismaster\" : false , \"secondary\" : true , \"primary\" : \"node1:27017\" , \"me\" : \"node2:27017\" , \"lastWrite\" : { \"opTime\" : { \"ts\" : Timestamp ( 1554269251 , 1 ), \"t\" : NumberLong ( 2 ) }, \"lastWriteDate\" : ISODate ( \"2019-04-03T05:27:31Z\" ), \"majorityOpTime\" : { \"ts\" : Timestamp ( 1554269251 , 1 ), \"t\" : NumberLong ( 2 ) }, \"majorityWriteDate\" : ISODate ( \"2019-04-03T05:27:31Z\" ) }, \"maxBsonObjectSize\" : 16777216 , \"maxMessageSizeBytes\" : 48000000 , \"maxWriteBatchSize\" : 100000 , \"localTime\" : ISODate ( \"2019-04-03T05:27:34.165Z\" ), \"logicalSessionTimeoutMinutes\" : 30 , \"minWireVersion\" : 0 , \"maxWireVersion\" : 7 , \"readOnly\" : false , \"ok\" : 1 , \"operationTime\" : Timestamp ( 1554269251 , 1 ), \"$clusterTime\" : { \"clusterTime\" : Timestamp ( 1554269251 , 1 ), \"signature\" : { \"hash\" : BinData ( 0 , \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\" ), \"keyId\" : NumberLong ( 0 ) } } } \u53ef\u4ee5\u770b\u51fa node1\u6b64\u65f6\u4e3aprimary\u8eab\u4efd \u3002 \u6b64\u65f6\u6211\u4eec\u8ba9\u624b\u52a8\u8ba9node2\u4f4dprimary \u600e\u4e48\u5206\u8fa8node2\u7684\u662f\u54ea\u4e2a 1. cfg . members [ 2 ] . priority = 2 \u662f\u4fee\u6539 node2\u7684\u4f18\u5148\u7ea7\u662f2 [ \u9ed8\u8ba4\u5927\u5bb6\u90fd\u662f 1 ] \uff0c\u8fd9\u6837 node2\u662f > 1 \u7684\u8bdd\uff0c\u4f18\u5148\u7ea7\u5c31\u9ad8\uff0c\u8fd9\u6837\u5c31\u91cd\u65b0\u9009\u4e3e\u540e node2\u4f1a\u662fparimary 2. \u600e\u4e48\u770b\u51fa node2\u662f2\u5462 ? rs . status () \u67e5\u770b\u7ed3\u679c\u7684\u65f6\u5019\u671f\u4e2d \"members\" \u540e\u9762\u662f\u6570\u7ec4\uff0c node2\u5728\u7b2c\u4e09\u4f4d\u6240\u4ee5\u662f2 [ \u4e0b\u6807\u662f 0 \u5f00\u59cb\u8ba1\u7b97 ] \u64cd\u4f5c\u8fc7\u7a0b repset:PRIMARY> cfg=rs.conf() { \"_id\" : \"repset\", \"version\" : 5, \"protocolVersion\" : NumberLong(1), \"writeConcernMajorityJournalDefault\" : true, \"members\" : [ { \"_id\" : 1, \"host\" : \"node1:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 2, \"host\" : \"node3:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 3, \"host\" : \"node2:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true, \"heartbeatIntervalMillis\" : 2000, \"heartbeatTimeoutSecs\" : 10, \"electionTimeoutMillis\" : 10000, \"catchUpTimeoutMillis\" : -1, \"catchUpTakeoverDelayMillis\" : 30000, \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1, \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId(\"5ca419993f98997dbf343825\") } } repset:PRIMARY> cfg.members[2].priority=2 2 repset:PRIMARY> rs.reconfig(cfg) { \"ok\" : 1, \"operationTime\" : Timestamp(1554270041, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554270041, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:SECONDARY> rs.isMaster() { \"hosts\" : [ \"node1:27017\", \"node3:27017\", \"node2:27017\" ], \"setName\" : \"repset\", \"setVersion\" : 6, \"ismaster\" : false, \"secondary\" : true, \"primary\" : \"node2:27017\", \"me\" : \"node1:27017\", \"lastWrite\" : { \"opTime\" : { \"ts\" : Timestamp(1554270083, 1), \"t\" : NumberLong(3) }, \"lastWriteDate\" : ISODate(\"2019-04-03T05:41:23Z\"), \"majorityOpTime\" : { \"ts\" : Timestamp(1554270083, 1), \"t\" : NumberLong(3) }, \"majorityWriteDate\" : ISODate(\"2019-04-03T05:41:23Z\") }, \"maxBsonObjectSize\" : 16777216, \"maxMessageSizeBytes\" : 48000000, \"maxWriteBatchSize\" : 100000, \"localTime\" : ISODate(\"2019-04-03T05:41:31.133Z\"), \"logicalSessionTimeoutMinutes\" : 30, \"minWireVersion\" : 0, \"maxWireVersion\" : 7, \"readOnly\" : false, \"ok\" : 1, \"operationTime\" : Timestamp(1554270083, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554270083, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } \u7ed9\u5b9a\u7684node2\u670d\u52a1\u5668\u5c31\u6210\u4e3a\u4e86primary\u8282\u70b9\u3002 5.2 \u6dfb\u52a0\u5907\u4efd\u8282\u70b9 \u00b6 hidden\uff08\u6210\u5458\u7528\u4e8e\u652f\u6301\u4e13\u7528\u529f\u80fd\uff09\uff1a\u8fd9\u6837\u8bbe\u7f6e\u540e\u6b64\u673a\u5668\u5728\u8bfb\u5199\u4e2d\u90fd\u4e0d\u53ef\u89c1\uff0c\u5e76\u4e14\u4e0d\u4f1a\u88ab\u9009\u4e3e\u4e3aPrimary\uff0c\u4f46\u662f\u53ef\u4ee5\u6295\u7968\uff0c\u4e00\u822c\u7528\u4e8e\u5907\u4efd\u6570\u636e\u3002\u628anode3\u8282\u70b9\u5220\u9664\uff0c\u91cd\u542f\u3002\u518d\u6dfb\u52a0\u8ba9\u5176\u4e3ahidden\u8282\u70b9\uff1a \u5220\u9664node3 repset:PRIMARY> rs.status() { \"set\" : \"repset\", \"date\" : ISODate(\"2019-04-03T05:49:19.032Z\"), \"myState\" : 1, \"term\" : NumberLong(3), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"heartbeatIntervalMillis\" : NumberLong(2000), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"readConcernMajorityOpTime\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"appliedOpTime\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"durableOpTime\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) } }, \"lastStableCheckpointTimestamp\" : Timestamp(1554270513, 1), \"members\" : [ { \"_id\" : 1, \"name\" : \"node1:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 7799, \"optime\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"optimeDurable\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"optimeDate\" : ISODate(\"2019-04-03T05:49:13Z\"), \"optimeDurableDate\" : ISODate(\"2019-04-03T05:49:13Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T05:49:17.784Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T05:49:18.505Z\"), \"pingMs\" : NumberLong(0), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"node2:27017\", \"syncSourceHost\" : \"node2:27017\", \"syncSourceId\" : 3, \"infoMessage\" : \"\", \"configVersion\" : 6 }, { \"_id\" : 2, \"name\" : \"node3:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 7799, \"optime\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"optimeDurable\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"optimeDate\" : ISODate(\"2019-04-03T05:49:13Z\"), \"optimeDurableDate\" : ISODate(\"2019-04-03T05:49:13Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T05:49:17.780Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T05:49:18.574Z\"), \"pingMs\" : NumberLong(1), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"node2:27017\", \"syncSourceHost\" : \"node2:27017\", \"syncSourceId\" : 3, \"infoMessage\" : \"\", \"configVersion\" : 6 }, { \"_id\" : 3, \"name\" : \"node2:27017\", \"health\" : 1, \"state\" : 1, \"stateStr\" : \"PRIMARY\", \"uptime\" : 8506, \"optime\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"optimeDate\" : ISODate(\"2019-04-03T05:49:13Z\"), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"electionTime\" : Timestamp(1554270051, 1), \"electionDate\" : ISODate(\"2019-04-03T05:40:51Z\"), \"configVersion\" : 6, \"self\" : true, \"lastHeartbeatMessage\" : \"\" } ], \"ok\" : 1, \"operationTime\" : Timestamp(1554270553, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554270553, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> rs.remove('node3:27017') { \"ok\" : 1, \"operationTime\" : Timestamp(1554270578, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554270578, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> rs.status() { \"set\" : \"repset\", \"date\" : ISODate(\"2019-04-03T05:49:40.382Z\"), \"myState\" : 1, \"term\" : NumberLong(3), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"heartbeatIntervalMillis\" : NumberLong(2000), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp(1554270578, 1), \"t\" : NumberLong(3) }, \"readConcernMajorityOpTime\" : { \"ts\" : Timestamp(1554270578, 1), \"t\" : NumberLong(3) }, \"appliedOpTime\" : { \"ts\" : Timestamp(1554270578, 1), \"t\" : NumberLong(3) }, \"durableOpTime\" : { \"ts\" : Timestamp(1554270578, 1), \"t\" : NumberLong(3) } }, \"lastStableCheckpointTimestamp\" : Timestamp(1554270573, 1), \"members\" : [ { \"_id\" : 1, \"name\" : \"node1:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 7820, \"optime\" : { \"ts\" : Timestamp(1554270573, 1), \"t\" : NumberLong(3) }, \"optimeDurable\" : { \"ts\" : Timestamp(1554270573, 1), \"t\" : NumberLong(3) }, \"optimeDate\" : ISODate(\"2019-04-03T05:49:33Z\"), \"optimeDurableDate\" : ISODate(\"2019-04-03T05:49:33Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T05:49:38.560Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T05:49:38.565Z\"), \"pingMs\" : NumberLong(0), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"node2:27017\", \"syncSourceHost\" : \"node2:27017\", \"syncSourceId\" : 3, \"infoMessage\" : \"\", \"configVersion\" : 6 }, { \"_id\" : 3, \"name\" : \"node2:27017\", \"health\" : 1, \"state\" : 1, \"stateStr\" : \"PRIMARY\", \"uptime\" : 8527, \"optime\" : { \"ts\" : Timestamp(1554270578, 1), \"t\" : NumberLong(3) }, \"optimeDate\" : ISODate(\"2019-04-03T05:49:38Z\"), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"electionTime\" : Timestamp(1554270051, 1), \"electionDate\" : ISODate(\"2019-04-03T05:40:51Z\"), \"configVersion\" : 7, \"self\" : true, \"lastHeartbeatMessage\" : \"\" } ], \"ok\" : 1, \"operationTime\" : Timestamp(1554270578, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554270578, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } \u6dfb\u52a0\u5907\u7528\u8282\u70b9[hidden\u9690\u85cf] repset:PRIMARY> rs.add({\"host\":\"node3:27017\",\"priority\":0,\"hidden\":true}) { \"ok\" : 1, \"operationTime\" : Timestamp(1554270639, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554270639, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } \u67e5\u770b\u72b6\u6001 repset:PRIMARY> rs.conf() { \"_id\" : \"repset\", \"version\" : 8, \"protocolVersion\" : NumberLong(1), \"writeConcernMajorityJournalDefault\" : true, \"members\" : [ { \"_id\" : 1, \"host\" : \"node1:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 3, \"host\" : \"node2:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 2, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 4, \"host\" : \"node3:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : true, \"priority\" : 0, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true, \"heartbeatIntervalMillis\" : 2000, \"heartbeatTimeoutSecs\" : 10, \"electionTimeoutMillis\" : 10000, \"catchUpTimeoutMillis\" : -1, \"catchUpTakeoverDelayMillis\" : 30000, \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1, \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId(\"5ca419993f98997dbf343825\") } } \u6d4b\u8bd5\u5176\u80fd\u5426\u53c2\u4e0e\u6295\u7968\uff1a\u5173\u95ed\u5f53\u524d\u7684Primary\uff0c\u67e5\u770b\u662f\u5426\u81ea\u52a8\u8f6c\u79fbPrimary repset:PRIMARY> use admin switched to db admin repset:PRIMARY> db.shutdownServer() server should be down... 2019-04-03T13:57:22.020+0800 I NETWORK [js] trying reconnect to 127.0.0.1:27017 failed 2019-04-03T13:57:22.601+0800 I NETWORK [js] reconnect 127.0.0.1:27017 failed failed 2019-04-03T13:57:22.604+0800 I NETWORK [js] trying reconnect to 127.0.0.1:27017 failed 2019-04-03T13:57:22.604+0800 I NETWORK [js] reconnect 127.0.0.1:27017 failed failed \u94fe\u63a5\u53e6\u4e00\u4e2a\u670d\u52a1\u5668[\u968f\u4fbf\u54ea\u4e2asecondary\u8282\u70b9]\u770b\u770b \u67e5\u770bnode1 repset : SECONDARY > rs . status () { \"set\" : \"repset\" , \"date\" : ISODate ( \"2019-04-03T05:57:43.329Z\" ), \"myState\" : 1 , \"term\" : NumberLong ( 4 ), \"syncingTo\" : \"\" , \"syncSourceHost\" : \"\" , \"syncSourceId\" : - 1 , \"heartbeatIntervalMillis\" : NumberLong ( 2000 ), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp ( 1554271063 , 1 ), \"t\" : NumberLong ( 4 ) }, \"readConcernMajorityOpTime\" : { \"ts\" : Timestamp ( 1554271063 , 1 ), \"t\" : NumberLong ( 4 ) }, \"appliedOpTime\" : { \"ts\" : Timestamp ( 1554271063 , 1 ), \"t\" : NumberLong ( 4 ) }, \"durableOpTime\" : { \"ts\" : Timestamp ( 1554271063 , 1 ), \"t\" : NumberLong ( 4 ) } }, \"lastStableCheckpointTimestamp\" : Timestamp ( 1554271023 , 1 ), \"members\" : [ { \"_id\" : 1 , \"name\" : \"node1:27017\" , \"health\" : 1 , \"state\" : 1 , \"stateStr\" : \"PRIMARY\" , \"uptime\" : 12784 , \"optime\" : { \"ts\" : Timestamp ( 1554271063 , 1 ), \"t\" : NumberLong ( 4 ) }, \"optimeDate\" : ISODate ( \"2019-04-03T05:57:43Z\" ), \"syncingTo\" : \"\" , \"syncSourceHost\" : \"\" , \"syncSourceId\" : - 1 , \"infoMessage\" : \"\" , \"electionTime\" : Timestamp ( 1554271042 , 1 ), \"electionDate\" : ISODate ( \"2019-04-03T05:57:22Z\" ), \"configVersion\" : 8 , \"self\" : true , \"lastHeartbeatMessage\" : \"\" }, { \"_id\" : 3 , \"name\" : \"node2:27017\" , \"health\" : 0 , \"state\" : 8 , \"stateStr\" : \"(not reachable/healthy)\" , \"uptime\" : 0 , \"optime\" : { \"ts\" : Timestamp ( 0 , 0 ), \"t\" : NumberLong ( - 1 ) }, \"optimeDurable\" : { \"ts\" : Timestamp ( 0 , 0 ), \"t\" : NumberLong ( - 1 ) }, \"optimeDate\" : ISODate ( \"1970-01-01T00:00:00Z\" ), \"optimeDurableDate\" : ISODate ( \"1970-01-01T00:00:00Z\" ), \"lastHeartbeat\" : ISODate ( \"2019-04-03T05:57:42.073Z\" ), \"lastHeartbeatRecv\" : ISODate ( \"2019-04-03T05:57:21.280Z\" ), \"pingMs\" : NumberLong ( 0 ), \"lastHeartbeatMessage\" : \"Error connecting to node2:27017 (192.168.178.129:27017) :: caused by :: Connection refused\" , \"syncingTo\" : \"\" , \"syncSourceHost\" : \"\" , \"syncSourceId\" : - 1 , \"infoMessage\" : \"\" , \"configVersion\" : - 1 }, { \"_id\" : 4 , \"name\" : \"node3:27017\" , \"health\" : 1 , \"state\" : 2 , \"stateStr\" : \"SECONDARY\" , \"uptime\" : 423 , \"optime\" : { \"ts\" : Timestamp ( 1554271053 , 1 ), \"t\" : NumberLong ( 4 ) }, \"optimeDurable\" : { \"ts\" : Timestamp ( 1554271053 , 1 ), \"t\" : NumberLong ( 4 ) }, \"optimeDate\" : ISODate ( \"2019-04-03T05:57:33Z\" ), \"optimeDurableDate\" : ISODate ( \"2019-04-03T05:57:33Z\" ), \"lastHeartbeat\" : ISODate ( \"2019-04-03T05:57:42.033Z\" ), \"lastHeartbeatRecv\" : ISODate ( \"2019-04-03T05:57:42.614Z\" ), \"pingMs\" : NumberLong ( 0 ), \"lastHeartbeatMessage\" : \"\" , \"syncingTo\" : \"node1:27017\" , \"syncSourceHost\" : \"node1:27017\" , \"syncSourceId\" : 1 , \"infoMessage\" : \"\" , \"configVersion\" : 8 } ], \"ok\" : 1 , \"operationTime\" : Timestamp ( 1554271063 , 1 ), \"$clusterTime\" : { \"clusterTime\" : Timestamp ( 1554271063 , 1 ), \"signature\" : { \"hash\" : BinData ( 0 , \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\" ), \"keyId\" : NumberLong ( 0 ) } } } \u4e0a\u9762\u8bf4\u660ePrimary\u5df2\u7ecf\u8f6c\u79fb\uff0c\u8bf4\u660ehidden\u5177\u6709\u6295\u7968\u7684\u6743\u5229\uff0c\u7ee7\u7eed\u67e5\u770b\u662f\u5426\u6709\u6570\u636e\u590d\u5236\u7684\u529f\u80fd\u3002 \u5728\u770b\u4e0b\u662f\u5426\u590d\u5236 repset:PRIMARY> db.test.count() 10000 repset:PRIMARY> use test switched to db test repset:PRIMARY> for(var i=0;i<90;i++){db.test.insert({\"name\":\"keke\"+i,\"age\":123})} WriteResult({ \"nInserted\" : 1 }) repset:PRIMARY> db.test.count() 10090 \u67e5\u770b repset:SECONDARY> use test; switched to db test repset:SECONDARY> db.test.count() 10090 \u4e0a\u9762\u8bf4\u660ehidden\u5177\u6709\u6570\u636e\u590d\u5236\u7684\u529f\u80fd\u3002 5.3 \u6dfb\u52a0\u5ef6\u65f6\u8282\u70b9 \u00b6 5.3.1 \u64cd\u4f5c \u00b6 Delayed\uff08\u6210\u5458\u7528\u4e8e\u652f\u6301\u4e13\u7528\u529f\u80fd\uff09\uff1a\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u65f6\u95f4\u5ef6\u8fdf\u4eceprimary\u8282\u70b9\u540c\u6b65\u6570\u636e\u3002\u4e3b\u8981\u7528\u4e8e\u5904\u7406\u8bef\u5220\u9664\u6570\u636e\u9a6c\u4e0a\u540c\u6b65\u5230\u4ece\u8282\u70b9\u5bfc\u81f4\u7684\u4e0d\u4e00\u81f4\u95ee\u9898\u3002 \u6211\u4eec\u628anode3\uff0c\u4e5f\u5c31\u662f\u4e0a\u9762\u7684\u9690\u85cf\u8282\u70b9\u5220\u9664\uff0c\u7136\u540e\u518d\u4ee5\u5ef6\u65f6\u8282\u70b9\u6dfb\u52a0\u8fdb\u6765\u3002 \u5220\u9664node3 repset : PRIMARY > rs . remove ( 'node3:27017' ) { \"ok\" : 1 , \"operationTime\" : Timestamp ( 1554271650 , 1 ), \"$clusterTime\" : { \"clusterTime\" : Timestamp ( 1554271650 , 1 ), \"signature\" : { \"hash\" : BinData ( 0 , \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\" ), \"keyId\" : NumberLong ( 0 ) } } } repset : PRIMARY > rs . conf () { \"_id\" : \"repset\" , \"version\" : 9 , \"protocolVersion\" : NumberLong ( 1 ), \"writeConcernMajorityJournalDefault\" : true , \"members\" : [ { \"_id\" : 1 , \"host\" : \"node1:27017\" , \"arbiterOnly\" : false , \"buildIndexes\" : true , \"hidden\" : false , \"priority\" : 1 , \"tags\" : { }, \"slaveDelay\" : NumberLong ( 0 ), \"votes\" : 1 }, { \"_id\" : 3 , \"host\" : \"node2:27017\" , \"arbiterOnly\" : false , \"buildIndexes\" : true , \"hidden\" : false , \"priority\" : 2 , \"tags\" : { }, \"slaveDelay\" : NumberLong ( 0 ), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true , \"heartbeatIntervalMillis\" : 2000 , \"heartbeatTimeoutSecs\" : 10 , \"electionTimeoutMillis\" : 10000 , \"catchUpTimeoutMillis\" : - 1 , \"catchUpTakeoverDelayMillis\" : 30000 , \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1 , \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId ( \"5ca419993f98997dbf343825\" ) } } \u6dfb\u52a0node3\u4ee5\u5ef6\u65f6\u8282\u70b9\u65b9\u5f0f\u6dfb\u52a0\u5230\u96c6\u7fa4 rs.add({\"host\":\"node3:27017\",\"priority\":0,\"hidden\":false,\"slaveDelay\":120}) \u671f\u4e2dpriority\u5fc5\u987b\u4e3a0,\u5426\u5219\u4f1a\u62a5\u9519\u3002\u62a5\u9519\u5982\u4e0b \"errmsg\" : \"priority must be 0 when slaveDelay is used\" \u6dfb\u52a0\u5ef6\u65f6node3\u8282\u70b9 repset:PRIMARY> rs.add({\"host\":\"node3:27017\",\"priority\":0,\"hidden\":false,\"slaveDelay\":120}) { \"ok\" : 1, \"operationTime\" : Timestamp(1554271789, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554271789, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> rs.conf() { \"_id\" : \"repset\", \"version\" : 10, \"protocolVersion\" : NumberLong(1), \"writeConcernMajorityJournalDefault\" : true, \"members\" : [ { \"_id\" : 1, \"host\" : \"node1:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 3, \"host\" : \"node2:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 2, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 4, \"host\" : \"node3:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 0, \"tags\" : { }, \"slaveDelay\" : NumberLong(120), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true, \"heartbeatIntervalMillis\" : 2000, \"heartbeatTimeoutSecs\" : 10, \"electionTimeoutMillis\" : 10000, \"catchUpTimeoutMillis\" : -1, \"catchUpTakeoverDelayMillis\" : 30000, \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1, \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId(\"5ca419993f98997dbf343825\") } } 5.3.2 \u6d4b\u8bd5 \u00b6 \u9996\u5148\u5728primary\u4e0a\u6dfb\u52a0\u6570\u636e\uff0c\u7136\u540e\u53bb\u5ef6\u65f6\u8282\u70b9\u4e0a\u67e5\u770b\u3002 primary\u4e0a\u67e5\u770b repset:PRIMARY> db.test.count() 11000 \u6b64\u65f6\u7acb\u9a6c\u67e5\u770bsecondary\u4e0a\u4fe1\u606f repset:SECONDARY> db.test.count() 11000 \u4ece\u4e0a\u53ef\u89c1\uff0csecondary\u662fprimary\u4e00\u6837\u6570\u636e\uff0c\u6b64\u65f6\u5f00\u59cb\u5411primary\u603c\u6570\u636e\u3002 repset:PRIMARY> for(var i=0;i<1000;i++){db.test.insert({\"name\":\"cmz\"+i,\"age\":10})} WriteResult({ \"nInserted\" : 1 }) repset:PRIMARY> db.test.count() 12000 \u65f6\u67e5\u770b\u6ca1\u6709\u5ef6\u65f6\u8282\u70b9secondary\u6570\u636e repset:SECONDARY> db.test.count() 12000 \u8bf4\u660e\u6570\u636e\u7acb\u9a6c\u540c\u6b65\u8fc7\u6765\u4e86\u3002 \u7d27\u63a5\u7740\u6b64\u65f6\u7acb\u9a6c\u67e5\u770b\u5ef6\u65f6\u8282\u70b9\u7684secondary\u6570\u636e\u3002 repset:SECONDARY> db.test.count() 11000 \u6ca1\u6709\u7acb\u9a6c\u540c\u6b65\u3002\u5728\u7b49\u7b49\u5427\uff0c\u6211\u4e0a\u9762\u914d\u7f6e\u4e86120\u79d2\u6570\u636e\u624d\u540c\u6b65\u3002\u65f6\u95f4\u5230\u4e86\u518d\u6b21\u67e5\u770b\u5ef6\u65f6\u8282\u70b9\u3002 repset:SECONDARY> db.test.count() 12000 nice\uff0c\u65f6\u95f4\u5230\u4e86\uff0c\u6570\u636e\u8fc7\u6765\u4e86\u3002\u4e0a\u9762\u8bf4\u660edelayed\u80fd\u591f\u6210\u529f\u7684\u628a\u540c\u6b65\u64cd\u4f5c\u5ef6\u8fdf120\u79d2\u6267\u884c\u3002\u9664\u4e86\u4e0a\u9762\u7684\u6210\u5458\u4e4b\u5916\uff0c Secondary-Only:\u4e0d\u80fd\u6210\u4e3aprimary\u8282\u70b9\uff0c\u53ea\u80fd\u4f5c\u4e3asecondary\u526f\u672c\u8282\u70b9\uff0c\u9632\u6b62\u4e00\u4e9b\u6027\u80fd\u4e0d\u9ad8\u7684\u8282\u70b9\u6210\u4e3a\u4e3b\u8282\u70b9\u3002 Non-Voting\uff1a\u6ca1\u6709\u9009\u4e3e\u6743\u7684secondary\u8282\u70b9\uff0c\u7eaf\u7cb9\u7684\u5907\u4efd\u6570\u636e\u8282\u70b9\u3002 \u5177\u4f53\u6210\u5458\u4fe1\u606f\u5982\u4e0b\uff1a \u529f\u80fd \u6210\u4e3aprimary \u5bf9\u5ba2\u6237\u7aef\u53ef\u89c1 \u53c2\u4e0e\u6295\u7968 \u5ef6\u8fdf\u540c\u6b65 \u590d\u5236\u6570\u636e Default \u221a \u221a \u221a \u2215 \u221a Secondary-Only / \u221a \u221a \u2215 \u221a Hidden / / \u221a \u2215 \u221a Delayed / \u221a \u221a \u221a \u221a Arbiters / / \u221a \u2215 / Non-Voting \u221a \u221a / \u2215 \u221a 5.4 \u8bfb\u5199\u5206\u79bb \u00b6 MongoDB\u526f\u672c\u96c6\u5bf9\u8bfb\u5199\u5206\u79bb\u7684\u652f\u6301\u662f\u901a\u8fc7Read Preferences\u7279\u6027\u8fdb\u884c\u652f\u6301\u7684\uff0c\u8fd9\u4e2a\u7279\u6027\u975e\u5e38\u590d\u6742\u548c\u7075\u6d3b\u3002 \u5e94\u7528\u7a0b\u5e8f\u9a71\u52a8\u901a\u8fc7read reference\u6765\u8bbe\u5b9a\u5982\u4f55\u5bf9\u526f\u672c\u96c6\u8fdb\u884c\u8bfb\u53d6\u64cd\u4f5c\uff0c\u9ed8\u8ba4\u7684,\u5ba2\u6237\u7aef\u9a71\u52a8\u6240\u6709\u7684\u8bfb\u64cd\u4f5c\u90fd\u662f\u76f4\u63a5\u8bbf\u95eeprimary\u8282\u70b9\u7684\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u4e25\u683c\u4e00\u81f4\u6027\u3002 \u652f\u6301\u4e94\u79cd\u7684read preference\u6a21\u5f0f \u5b98\u7f51\u4f20\u9001\u95e8 primary \uff1a \u4e3b\u8282\u70b9\uff0c\u9ed8\u8ba4\u6a21\u5f0f\uff0c\u8bfb\u64cd\u4f5c\u53ea\u5728\u4e3b\u8282\u70b9\uff0c\u5982\u679c\u4e3b\u8282\u70b9\u4e0d\u53ef\u7528\uff0c\u62a5\u9519\u6216\u8005\u629b\u51fa\u5f02\u5e38\u3002 primaryPreferred \uff1a \u9996\u9009\u4e3b\u8282\u70b9\uff0c\u5927\u591a\u60c5\u51b5\u4e0b\u8bfb\u64cd\u4f5c\u5728\u4e3b\u8282\u70b9\uff0c\u5982\u679c\u4e3b\u8282\u70b9\u4e0d\u53ef\u7528\uff0c\u5982\u6545\u969c\u8f6c\u79fb\uff0c\u8bfb\u64cd\u4f5c\u5728\u4ece\u8282\u70b9\u3002 secondary \uff1a\u4ece\u8282\u70b9\uff0c\u8bfb\u64cd\u4f5c\u53ea\u5728\u4ece\u8282\u70b9\uff0c \u5982\u679c\u4ece\u8282\u70b9\u4e0d\u53ef\u7528\uff0c\u62a5\u9519\u6216\u8005\u629b\u51fa\u5f02\u5e38\u3002 secondaryPreferred \uff1a \u9996\u9009\u4ece\u8282\u70b9\uff0c\u5927\u591a\u60c5\u51b5\u4e0b\u8bfb\u64cd\u4f5c\u5728\u4ece\u8282\u70b9\uff0c\u7279\u6b8a\u60c5\u51b5\uff08\u5982\u5355\u4e3b\u8282\u70b9\u67b6\u6784\uff09\u8bfb\u64cd\u4f5c\u5728\u4e3b\u8282\u70b9\u3002 nearest \uff1a \u6700\u90bb\u8fd1\u8282\u70b9\uff0c\u8bfb\u64cd\u4f5c\u5728\u6700\u90bb\u8fd1\u7684\u6210\u5458\uff0c\u53ef\u80fd\u662f\u4e3b\u8282\u70b9\u6216\u8005\u4ece\u8282\u70b9\uff0c\u5173\u4e8e\u6700\u90bb\u8fd1\u7684\u6210\u5458\u8bf7\u53c2\u8003","title":"12. MonogoDB \u526f\u672c\u96c6"},{"location":"linux/nosql/mongo/mongo.replication/#1","text":"MongoDB \u526f\u672c\u96c6\uff08Replica Set\uff09\u662f\u6709\u81ea\u52a8\u6545\u969c\u6062\u590d\u529f\u80fd\u7684\u4e3b\u4ece\u96c6\u7fa4\uff0c\u6709\u4e00\u4e2aPrimary\u8282\u70b9\u548c\u4e00\u4e2a\u6216\u591a\u4e2aSecondary\u8282\u70b9\u7ec4\u6210\u3002\u7c7b\u4f3c\u4e8eMySQL\u7684MMM\u67b6\u6784\u3002\u66f4\u591a\u5173\u4e8e\u526f\u672c\u96c6\u7684\u4ecb\u7ecd\u8bf7\u89c1 \u5b98\u7f51 \u3002\u4e5f\u53ef\u4ee5\u5728google\u3001baidu\u4e0a\u67e5\u9605\u3002mongodb\u662f\u4e00\u6b3e\u4f18\u79c0\u7684nosql\u8f6f\u4ef6\u3002\u56e0\u4e3a\u8d77\u70b9\u665a\uff0c\u5438\u53d6\u4e86\u524d\u8f88\u4eec\u7684\u4f18\u70b9\uff0c","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/mongo/mongo.replication/#2","text":"\u526f\u672c\u96c6\u4e2d\u6570\u636e\u540c\u6b65\u8fc7\u7a0b\uff1aPrimary\u8282\u70b9\u5199\u5165\u6570\u636e\uff0cSecondary\u901a\u8fc7\u8bfb\u53d6Primary\u7684oplog\u5f97\u5230\u590d\u5236\u4fe1\u606f\uff0c\u5f00\u59cb\u590d\u5236\u6570\u636e\u5e76\u4e14\u5c06\u590d\u5236\u4fe1\u606f\u5199\u5165\u5230\u81ea\u5df1\u7684oplog\u3002\u5982\u679c\u67d0\u4e2a\u64cd\u4f5c\u5931\u8d25\uff0c\u5219\u5907\u4efd\u8282\u70b9\u505c\u6b62\u4ece\u5f53\u524d\u6570\u636e\u6e90\u590d\u5236\u6570\u636e\u3002\u5982\u679c\u67d0\u4e2a\u5907\u4efd\u8282\u70b9\u7531\u4e8e\u67d0\u4e9b\u539f\u56e0\u6302\u6389\u4e86\uff0c\u5f53\u91cd\u65b0\u542f\u52a8\u540e\uff0c\u5c31\u4f1a\u81ea\u52a8\u4eceoplog\u7684\u6700\u540e\u4e00\u4e2a\u64cd\u4f5c\u5f00\u59cb\u540c\u6b65\uff0c\u540c\u6b65\u5b8c\u6210\u540e\uff0c\u5c06\u4fe1\u606f\u5199\u5165\u81ea\u5df1\u7684oplog\uff0c\u7531\u4e8e\u590d\u5236\u64cd\u4f5c\u662f\u5148\u590d\u5236\u6570\u636e\uff0c\u590d\u5236\u5b8c\u6210\u540e\u518d\u5199\u5165oplog\uff0c\u6709\u53ef\u80fd\u76f8\u540c\u7684\u64cd\u4f5c\u4f1a\u540c\u6b65\u4e24\u4efd\uff0c\u4e0d\u8fc7MongoDB\u5728\u8bbe\u8ba1\u4e4b\u521d\u5c31\u8003\u8651\u5230\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c06oplog\u7684\u540c\u4e00\u4e2a\u64cd\u4f5c\u6267\u884c\u591a\u6b21\uff0c\u4e0e\u6267\u884c\u4e00\u6b21\u7684\u6548\u679c\u662f\u4e00\u6837\u7684\u3002\u7b80\u5355\u7684\u8bf4\u5c31\u662f\uff1a \u5f53Primary\u8282\u70b9\u5b8c\u6210\u6570\u636e\u64cd\u4f5c\u540e\uff0cSecondary\u4f1a\u505a\u51fa\u4e00\u7cfb\u5217\u7684\u52a8\u4f5c\u4fdd\u8bc1\u6570\u636e\u7684\u540c\u6b65 1\uff1a\u68c0\u67e5\u81ea\u5df1local\u5e93\u7684oplog.rs\u96c6\u5408\u627e\u51fa\u6700\u8fd1\u7684\u65f6\u95f4\u6233\u3002 2\uff1a\u68c0\u67e5Primary\u8282\u70b9local\u5e93oplog.rs\u96c6\u5408\uff0c\u627e\u51fa\u5927\u4e8e\u6b64\u65f6\u95f4\u6233\u7684\u8bb0\u5f55\u3002 3\uff1a\u5c06\u627e\u5230\u7684\u8bb0\u5f55\u63d2\u5165\u5230\u81ea\u5df1\u7684oplog.rs\u96c6\u5408\u4e2d\uff0c\u5e76\u6267\u884c\u8fd9\u4e9b\u64cd\u4f5c\u3002 \u526f\u672c\u96c6\u7684\u540c\u6b65\u548c\u4e3b\u4ece\u540c\u6b65\u4e00\u6837\uff0c\u90fd\u662f\u5f02\u6b65\u540c\u6b65\u7684\u8fc7\u7a0b\uff0c\u4e0d\u540c\u7684\u662f\u526f\u672c\u96c6\u6709\u4e2a\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\u7684\u529f\u80fd\u3002\u5176\u539f\u7406\u662f\uff1aslave\u7aef\u4eceprimary\u7aef\u83b7\u53d6\u65e5\u5fd7\uff0c\u7136\u540e\u5728\u81ea\u5df1\u8eab\u4e0a\u5b8c\u5168\u987a\u5e8f\u7684\u6267\u884c\u65e5\u5fd7\u6240\u8bb0\u5f55\u7684\u5404\u79cd\u64cd\u4f5c\uff08\u8be5\u65e5\u5fd7\u662f\u4e0d\u8bb0\u5f55\u67e5\u8be2\u64cd\u4f5c\u7684\uff09\uff0c\u8fd9\u4e2a\u65e5\u5fd7\u5c31\u662flocal\u6570\u636e \u5e93\u4e2d\u7684oplog.rs\u8868\uff0c\u9ed8\u8ba4\u572864\u4f4d\u673a\u5668\u4e0a\u8fd9\u4e2a\u8868\u662f\u6bd4\u8f83\u5927\u7684\uff0c\u5360\u78c1\u76d8\u5927\u5c0f\u76845%\uff0coplog.rs\u7684\u5927\u5c0f\u53ef\u4ee5\u5728\u542f\u52a8\u53c2\u6570\u4e2d\u8bbe \u5b9a\uff1a--oplogSize 1000,\u5355\u4f4d\u662fM\u3002 \u6ce8\u610f\uff1a\u5728\u526f\u672c\u96c6\u7684\u73af\u5883\u4e2d\uff0c\u8981\u662f\u6240\u6709\u7684Secondary\u90fd\u5b95\u673a\u4e86\uff0c\u53ea\u5269\u4e0bPrimary\u3002\u6700\u540ePrimary\u4f1a\u53d8\u6210Secondary\uff0c\u4e0d\u80fd\u63d0\u4f9b\u670d\u52a1\u3002","title":"2. \u539f\u7406"},{"location":"linux/nosql/mongo/mongo.replication/#21","text":"\u96c6\u7fa4\u5f00\u59cb\uff0c\u5982\u4e0b primary\u6302\u4e86\u4ee5\u540e","title":"2.1 \u81ea\u52a8\u5207\u6362"},{"location":"linux/nosql/mongo/mongo.replication/#3","text":"","title":"3. \u90e8\u7f72\u642d\u5efa"},{"location":"linux/nosql/mongo/mongo.replication/#31","text":"IP \u4e3b\u673a\u540d \u7cfb\u7edf \u5b89\u88c5\u8f6f\u4ef6 192.168.178.128 node3 ubuntu16 mongodb 192.168.178.129 node2 ubuntu16 mongodb 192.168.178.130 node1 ubuntu16 mongodb","title":"3.1 \u73af\u5883\u51c6\u5907"},{"location":"linux/nosql/mongo/mongo.replication/#32","text":"\u5b98\u7f51\u5305 \u79bb\u7ebf\u5b89\u88c5\u6587\u6863 \u5728\u7ebf\u5b89\u88c5\u6587\u6863 \u5b89\u88c5 sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4 echo \"deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/4.0 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list sudo apt-get update sudo apt-get install -y mongodb-org systemctl start mongod.service cp /etc/mongod.conf /etc/mongod.conf.ori sed -i 's/bindIp: 127.0.0.1/bindIp: 0.0.0.0/' /etc/mongod.conf grep -i 'bindIp' /etc/mongod.conf systemctl start mongod.service \u5378\u8f7d sudo service mongod stop sudo apt-get purge mongodb-org* sudo rm -r /var/log/mongodb sudo rm -r /var/lib/mongodb \u5b89\u88c5\u8fc7\u7a0b root@node1:~# sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4 Executing: /tmp/tmp.KG9f1TH9ct/gpg.1.sh --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4 gpg: requesting key E52529D4 from hkp server keyserver.ubuntu.com gpg: key E52529D4: public key \"MongoDB 4.0 Release Signing Key <packaging@mongodb.com>\" imported gpg: Total number processed: 1 gpg: imported: 1 (RSA: 1) root@node1:~# echo \"deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/4.0 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/4.0 multiverse root@node1:~# sudo apt-get install -y mongodb-org Reading package lists... Done ........ root@node1:~# systemctl start mongod.service Display all 159 possibilities? (y or n) root@node1:~# systemctl start mongod.service root@node1:~# systemctl status mongod.service \u25cf mongod.service - MongoDB Database Server Loaded: loaded (/lib/systemd/system/mongod.service; disabled; vendor preset: enabled) Active: active (running) since Wed 2019-04-03 09:56:57 CST; 6s ago Docs: https://docs.mongodb.org/manual Main PID: 3301 (mongod) CGroup: /system.slice/mongod.service \u2514\u25003301 /usr/bin/mongod --config /etc/mongod.conf Apr 03 09:56:57 node1 systemd[1]: Started MongoDB Database Server. root@node1:~# mongo MongoDB shell version v4.0.6 connecting to: mongodb://127.0.0.1:27017/?gssapiServiceName=mongodb Implicit session: session { \"id\" : UUID(\"acf7e437-8b69-4892-8e8c-cba85de600a0\") } MongoDB server version: 4.0.8 Welcome to the MongoDB shell. For interactive help, type \"help\". For more comprehensive documentation, see http://docs.mongodb.org/ Questions? Try the support group http://groups.google.com/group/mongodb-user Server has startup warnings: 2019-04-02T18:56:57.640-0700 I STORAGE [initandlisten] 2019-04-02T18:56:57.640-0700 I STORAGE [initandlisten] ** WARNING: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine 2019-04-02T18:56:57.640-0700 I STORAGE [initandlisten] ** See http://dochub.mongodb.org/core/prodnotes-filesystem 2019-04-02T18:56:58.353-0700 I CONTROL [initandlisten] 2019-04-02T18:56:58.353-0700 I CONTROL [initandlisten] ** WARNING: Access control is not enabled for the database. 2019-04-02T18:56:58.353-0700 I CONTROL [initandlisten] ** Read and write access to data and configuration is unrestricted. 2019-04-02T18:56:58.353-0700 I CONTROL [initandlisten] --- Enable MongoDB's free cloud-based monitoring service, which will then receive and display metrics about your deployment (disk utilization, CPU, operation statistics, etc). The monitoring data will be available on a MongoDB website with a unique URL accessible to you and anyone you share the URL with. MongoDB may use this information to make product improvements and to suggest MongoDB products and deployment options to you. To enable free monitoring, run the following command: db.enableFreeMonitoring() To permanently disable this reminder, run the following command: db.disableFreeMonitoring() --- > bye root@node1:~# mongo --help MongoDB shell version v4.0.6 usage: mongo [options] [db address] [file names (ending in .js)] db address can be: foo foo database on local machine 192.168.0.5/foo foo database on 192.168.0.5 machine 192.168.0.5:9999/foo foo database on 192.168.0.5 machine on port 9999 Options: --shell run the shell after executing files --nodb don't connect to mongod on startup - no 'db address' arg expected --norc will not run the \".mongorc.js\" file on start up --quiet be less chatty --port arg port to connect to --host arg server to connect to --eval arg evaluate javascript -h [ --help ] show this usage information --version show version information --verbose increase verbosity --ipv6 enable IPv6 support (disabled by default) --disableJavaScriptJIT disable the Javascript Just In Time compiler --enableJavaScriptJIT enable the Javascript Just In Time compiler --disableJavaScriptProtection allow automatic JavaScript function marshalling --retryWrites automatically retry write operations upon transient network errors --disableImplicitSessions do not automatically create and use implicit sessions --jsHeapLimitMB arg set the js scope's heap size limit Authentication Options: -u [ --username ] arg username for authentication -p [ --password ] arg password for authentication --authenticationDatabase arg user source (defaults to dbname) --authenticationMechanism arg authentication mechanism --gssapiServiceName arg (=mongodb) Service name to use when authenticating using GSSAPI/Kerberos --gssapiHostName arg Remote host name to use for purpose of GSSAPI/Kerberos authentication file names: a list of files to run. files have to end in .js and will exit after unless --shell is specified root@node1:~# mongo --quiet # \u9759\u6001\u8f93\u51fa\uff0c\u51cf\u5c11\u6253\u5370 > show dbs; admin 0.000GB config 0.000GB local 0.000GB root@node1:~# cp /etc/mongod.conf /etc/mongod.conf.ori root@node1:~# egrep -v '#|^$' /etc/mongod.conf storage: dbPath: /var/lib/mongodb journal: enabled: true systemLog: destination: file logAppend: true path: /var/log/mongodb/mongod.log net: port: 27017 bindIp: 127.0.0.1 processManagement: timeZoneInfo: /usr/share/zoneinfo root@node1:~# sed -i 's/bindIp: 127.0.0.1/bindIp: 0.0.0.0/' /etc/mongod.conf root@node1:~# grep -i 'bindIp' /etc/mongod.conf bindIp: 0.0.0.0 root@node1:~# systemctl restart mongod \u5b89\u88c5mingodb\u6bcf\u4e2a\u673a\u5668\u90fd\u8981\u5b89\u88c5\u3002\u5176\u4ed6\u673a\u5668\u5b89\u88c5\u7701\u7565\u3002","title":"3.2 \u5b89\u88c5"},{"location":"linux/nosql/mongo/mongo.replication/#33","text":"","title":"3.3 \u914d\u7f6e"},{"location":"linux/nosql/mongo/mongo.replication/#331","text":"\u914d\u7f6e\u6587\u4ef6\u6700\u540e\u52a0 replication: replSetName: repset mongodb\u901a\u8fc7\u8fd9\u4e2a\u6765\u7ec4\u6210\u96c6\u7fa4\u3002 \u586b\u5751 1. mongod\u7684\u914d\u7f6e\u6587\u4ef6 \uff0c\u6709 yaml\u683c\u5f0f\u4e5f\u6709\u666e\u901a\u7684 = \u683c\u5f0f\u3002 2. yaml\u683c\u5f0f\u7684\u53c2\u8003 https : // docs . mongodb . com / manual / reference / configuration - options / #replication.replSetName node1 \u914d\u7f6e\u6587\u4ef6 root @node1 : ~ # egrep -v '#|^$' /etc/mongod.conf storage : dbPath : / var / lib / mongodb journal : enabled : true systemLog : destination : file logAppend : true path : / var / log / mongodb / mongod . log net : port : 27017 bindIp : 0.0 . 0.0 processManagement : timeZoneInfo : / usr / share / zoneinfo replication : replSetName : repset node2 \u914d\u7f6e\u6587\u4ef6 root @node2 : ~ # egrep -v '#|^$' /etc/mongod.conf storage : dbPath : / var / lib / mongodb journal : enabled : true systemLog : destination : file logAppend : true path : / var / log / mongodb / mongod . log net : port : 27017 bindIp : 0.0 . 0.0 processManagement : timeZoneInfo : / usr / share / zoneinfo replication : replSetName : repset node3 \u914d\u7f6e\u6587\u4ef6 root @node3 : / usr / local / mongo / conf # egrep -v '#|^$' /etc/mongod.conf storage : dbPath : / var / lib / mongodb journal : enabled : true systemLog : destination : file logAppend : true path : / var / log / mongodb / mongod . log net : port : 27017 bindIp : 0.0 . 0.0 processManagement : timeZoneInfo : / usr / share / zoneinfo replication : replSetName : repset","title":"3.3.1 \u914d\u7f6e\u6587\u4ef6"},{"location":"linux/nosql/mongo/mongo.replication/#332","text":"\u5feb\u901f\u547d\u4ee4 rs.initiate() rs.conf() rs.add(\"node1:27017\") # \u96c6\u7fa4\u4e2d\u6dfb\u52a0\u673a\u5668 rs.add(\"node3:27017\") \u8be6\u7ec6\u8fc7\u7a0b > rs.initiate() { \"info2\" : \"no configuration specified. Using a default configuration for the set\", \"me\" : \"node2:27017\", \"ok\" : 1, \"operationTime\" : Timestamp(1554258330, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554258330, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:SECONDARY> rs.conf() { \"_id\" : \"repset\", \"version\" : 1, \"protocolVersion\" : NumberLong(1), \"writeConcernMajorityJournalDefault\" : true, \"members\" : [ { \"_id\" : 0, \"host\" : \"node2:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true, \"heartbeatIntervalMillis\" : 2000, \"heartbeatTimeoutSecs\" : 10, \"electionTimeoutMillis\" : 10000, \"catchUpTimeoutMillis\" : -1, \"catchUpTakeoverDelayMillis\" : 30000, \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1, \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId(\"5ca419993f98997dbf343825\") } } repset:PRIMARY> rs.add(\"node1:27017\") { \"ok\" : 1, \"operationTime\" : Timestamp(1554258349, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554258349, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> rs.add(\"node3:27017\") { \"ok\" : 1, \"operationTime\" : Timestamp(1554258369, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554258369, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> rs.status() { \"set\" : \"repset\", \"date\" : ISODate(\"2019-04-03T02:26:16.610Z\"), \"myState\" : 1, \"term\" : NumberLong(1), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"heartbeatIntervalMillis\" : NumberLong(2000), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"readConcernMajorityOpTime\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"appliedOpTime\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"durableOpTime\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) } }, \"lastStableCheckpointTimestamp\" : Timestamp(1554258332, 2), \"members\" : [ { \"_id\" : 0, \"name\" : \"node2:27017\", \"health\" : 1, \"state\" : 1, \"stateStr\" : \"PRIMARY\", \"uptime\" : 82, \"optime\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"optimeDate\" : ISODate(\"2019-04-03T02:26:09Z\"), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"could not find member to sync from\", \"electionTime\" : Timestamp(1554258330, 2), \"electionDate\" : ISODate(\"2019-04-03T02:25:30Z\"), \"configVersion\" : 3, \"self\" : true, \"lastHeartbeatMessage\" : \"\" }, { \"_id\" : 1, \"name\" : \"node1:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 26, \"optime\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"optimeDurable\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"optimeDate\" : ISODate(\"2019-04-03T02:26:09Z\"), \"optimeDurableDate\" : ISODate(\"2019-04-03T02:26:09Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T02:26:15.703Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T02:26:16.227Z\"), \"pingMs\" : NumberLong(1), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"configVersion\" : 3 }, { \"_id\" : 2, \"name\" : \"node3:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 6, \"optime\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"optimeDurable\" : { \"ts\" : Timestamp(1554258369, 1), \"t\" : NumberLong(1) }, \"optimeDate\" : ISODate(\"2019-04-03T02:26:09Z\"), \"optimeDurableDate\" : ISODate(\"2019-04-03T02:26:09Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T02:26:15.704Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T02:26:16.231Z\"), \"pingMs\" : NumberLong(1), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"configVersion\" : 3 } ], \"ok\" : 1, \"operationTime\" : Timestamp(1554258369, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554258369, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> bye \u89e3\u91ca \"_id\" : \u526f\u672c\u96c6\u7684\u540d\u79f0 \"members\" : \u526f\u672c\u96c6\u7684\u670d\u52a1\u5668\u5217\u8868 \"_id\" : \u670d\u52a1\u5668\u7684\u552f\u4e00 ID \"host\" : \u670d\u52a1\u5668\u4e3b\u673a \"priority\" : \u662f\u4f18\u5148\u7ea7\uff0c\u9ed8\u8ba4\u4e3a 1 \uff0c\u4f18\u5148\u7ea7 0 \u4e3a\u88ab\u52a8\u8282\u70b9\uff0c\u4e0d\u80fd\u6210\u4e3a\u6d3b\u8dc3\u8282\u70b9\u3002\u4f18\u5148\u7ea7\u4e0d\u4f4d 0 \u5219\u6309\u7167\u6709\u5927\u5230\u5c0f\u9009\u51fa\u6d3b\u8dc3\u8282\u70b9\u3002 \"arbiterOnly\" : \u4ef2\u88c1\u8282\u70b9\uff0c\u53ea\u53c2\u4e0e\u6295\u7968\uff0c\u4e0d\u63a5\u6536\u6570\u636e\uff0c\u4e5f\u4e0d\u80fd\u6210\u4e3a\u6d3b\u8dc3\u8282\u70b9\u3002","title":"3.3.2 \u521d\u59cb\u5316"},{"location":"linux/nosql/mongo/mongo.replication/#333","text":"repset:PRIMARY> rs. rs.add( rs.conf( rs.help( rs.prototype rs.syncFrom( rs.addArb( rs.config( rs.initiate( rs.reconfig( rs.toLocaleString( rs.apply( rs.constructor rs.isMaster( rs.remove( rs.toString( rs.bind( rs.debug rs.printReplicationInfo( rs.slaveOk( rs.valueOf( rs.call( rs.freeze( rs.printSlaveReplicationInfo( rs.status( rs.compareOpTimes( rs.hasOwnProperty( rs.propertyIsEnumerable( rs.stepDown( repset:PRIMARY> rs.help() rs.status() { replSetGetStatus : 1 } checks repl set status rs.initiate() { replSetInitiate : null } initiates set with default settings rs.initiate(cfg) { replSetInitiate : cfg } initiates set with configuration cfg rs.conf() get the current configuration object from local.system.replset rs.reconfig(cfg) updates the configuration of a running replica set with cfg (disconnects) rs.add(hostportstr) add a new member to the set with default attributes (disconnects) rs.add(membercfgobj) add a new member to the set with extra attributes (disconnects) rs.addArb(hostportstr) add a new member which is arbiterOnly:true (disconnects) rs.stepDown([stepdownSecs, catchUpSecs]) step down as primary (disconnects) rs.syncFrom(hostportstr) make a secondary sync from the given member rs.freeze(secs) make a node ineligible to become primary for the time specified rs.remove(hostportstr) remove a host from the replica set (disconnects) rs.slaveOk() allow queries on secondary nodes rs.printReplicationInfo() check oplog size and time range rs.printSlaveReplicationInfo() check replica set members and replication lag db.isMaster() check who is primary reconfiguration helpers disconnect from the database so the shell will display an error, even if the command succeeds.","title":"3.3.3 \u5176\u4ed6\u547d\u4ee4"},{"location":"linux/nosql/mongo/mongo.replication/#34","text":"","title":"3.4 \u6d4b\u8bd5"},{"location":"linux/nosql/mongo/mongo.replication/#341","text":"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u91cd\u542fmongo\u3002\u767b\u5f55\u6d4b\u8bd5\u3002 root@node1:~# mongo --quiet repset:SECONDARY> root@node2:~# mongo --quiet repset:PRIMARY> root@node3:~# mongo --quiet repset:SECONDARY> \u53ef\u4ee5\u770b\u51fanode2\u662fprimary\uff0c\u4e5f\u5c31\u662f\u4e3b\u3002\u5176\u4ed6\u4e24\u4e2anode1\uff0cnode3\u662fsecondary\u4e5f\u5c31\u662f\u4ece\u3002\u63a5\u4e0b\u6765\u6d4b\u8bd5\u3002","title":"3.4.1 \u7b80\u5355\u6d4b\u8bd5"},{"location":"linux/nosql/mongo/mongo.replication/#343","text":"\u4e3b\u6dfb\u52a0\u6570\u636e\uff0c\u4e0d\u9009\u62e9\u5e93\uff0c\u9ed8\u8ba4\u6dfb\u52a0\u5230test\u5e93\u4e2d\u3002 repset:PRIMARY> show dbs; admin 0.000GB config 0.000GB local 0.000GB test 0.000GB repset:PRIMARY> use test; switched to db test repset:PRIMARY> for(var i=0;i<10000;i++){db.test.insert({\"name\":\"caimengzhi\"+i,\"age\":123})} WriteResult({ \"nInserted\" : 1 }) repset:PRIMARY> show tables; col2 test repset:PRIMARY> db.test.count() 10000 \u4ece\u67e5\u770b repset:SECONDARY> use test; switched to db test repset:SECONDARY> db.test.count() 2019-04-03T13:19:39.080+0800 E QUERY [js] Error: count failed: { \"operationTime\" : Timestamp(1554268771, 1), \"ok\" : 0, \"errmsg\" : \"not master and slaveOk=false\", \"code\" : 13435, \"codeName\" : \"NotMasterNoSlaveOk\", \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554268771, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } : _getErrorWithCode@src/mongo/shell/utils.js:25:13 DBQuery.prototype.count@src/mongo/shell/query.js:383:11 DBCollection.prototype.count@src/mongo/shell/collection.js:1431:12 @(shell):1:1 repset:SECONDARY> rs.slaveOk() repset:SECONDARY> db.test.count() 10000 \u6ce8\u610f \u9ed8\u8ba4\u4ece\uff0c\u4e0d\u80fd\u8bfb\u548c\u5199\u7684 [ rs . slaveOk () \u4ece\u624d\u53ef\u4ee5\u8bfb ] \uff0c\u5426\u5219\u62a5\u9519\u5982\u4e0b : repset : SECONDARY > show dbs ; 2019 - 04 - 02 T19 : 46 : 28.450 - 0700 E QUERY [ js ] Error : listDatabases failed :{ \"operationTime\" : Timestamp ( 1554259582 , 1 ), \"ok\" : 0 , \"errmsg\" : \"not master and slaveOk=false\" , \"code\" : 13435 , \"codeName\" : \"NotMasterNoSlaveOk\" , \"$clusterTime\" : { \"clusterTime\" : Timestamp ( 1554259582 , 1 ), \"signature\" : { \"hash\" : BinData ( 0 , \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\" ), \"keyId\" : NumberLong ( 0 ) } } } : _getErrorWithCode @src / mongo / shell / utils . js : 25 : 13 Mongo . prototype . getDBs @src / mongo / shell / mongo . js : 139 : 1 shellHelper . show @src / mongo / shell / utils . js : 882 : 13 shellHelper @src / mongo / shell / utils . js : 766 : 15 @ ( shellhelp2 ): 1 : 1","title":"3.4.3 \u526f\u672c\u6d4b\u8bd5"},{"location":"linux/nosql/mongo/mongo.replication/#343_1","text":"\u5173\u95edprimary mongo repset:PRIMARY> db.col2.find() { \"_id\" : ObjectId(\"5ca41e317b1bb7f26e3fb62b\"), \"name\" : \"caimengzhi\" } repset:PRIMARY> root@node2:~# systemctl stop mongod.service \u67e5\u770b\u5176\u4ed6\u7684\uff0c\u671f\u4e2dnode1\u4e0amongodb\u81ea\u52a8\u5207\u6362\u4e3aprimary\u4e86\u3002node3\u8fd8\u662fSECONDARY\u3002 repset:SECONDARY> show dbs; admin 0.000GB config 0.000GB local 0.000GB test 0.000GB repset:PRIMARY> \u7ee7\u7eed\u6d4b\u8bd5 repset:PRIMARY> db.col2.insert({\"name\":\"\u53ef\u53ef\"}) WriteResult({ \"nInserted\" : 1 }) repset:PRIMARY> db.col2.find() { \"_id\" : ObjectId(\"5ca41e317b1bb7f26e3fb62b\"), \"name\" : \"caimengzhi\" } { \"_id\" : ObjectId(\"5ca4234d03595133e357b7e7\"), \"name\" : \"\u53ef\u53ef\" } repset:SECONDARY> db.col2.find() { \"_id\" : ObjectId(\"5ca41e317b1bb7f26e3fb62b\"), \"name\" : \"caimengzhi\" } { \"_id\" : ObjectId(\"5ca4234d03595133e357b7e7\"), \"name\" : \"\u53ef\u53ef\" } \u8bf4\u660e\u5b8c\u7f8e\u81ea\u52a8\u5207\u6362\u4e86\u3002\u6211\u518d\u8d77\u8d77\u70b9\u4e4b\u524d\u7684primary mongo\uff0c\u81ea\u52a8\u4f1a\u53d8\u6210secondary\u3002 secondary mongo\u662f\u4e0d\u5141\u8bb8\u5199\u6570\u636e\u7684 root@node2:~# mongo --quiet repset:SECONDARY> db.col2.insert({\"name\":\"\u6570\u636e\u6765\u81easecondary\"}) WriteCommandError({ \"operationTime\" : Timestamp(1554262271, 1), \"ok\" : 0, \"errmsg\" : \"not master\", \"code\" : 10107, \"codeName\" : \"NotMaster\", \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554262271, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } }) repset:SECONDARY> db.col2.find() Error: error: { \"operationTime\" : Timestamp(1554262281, 1), \"ok\" : 0, \"errmsg\" : \"not master and slaveOk=false\", \"code\" : 13435, \"codeName\" : \"NotMasterNoSlaveOk\", \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554262281, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:SECONDARY> rs.slaveOk() repset:SECONDARY> db.col2.find() { \"_id\" : ObjectId(\"5ca41e317b1bb7f26e3fb62b\"), \"name\" : \"caimengzhi\" } { \"_id\" : ObjectId(\"5ca4234d03595133e357b7e7\"), \"name\" : \"\u53ef\u53ef\" }","title":"3.4.3 \u9ad8\u53ef\u7528\u6d4b\u8bd5"},{"location":"linux/nosql/mongo/mongo.replication/#4","text":"","title":"4. \u5176\u4ed6\u6d4b\u8bd5"},{"location":"linux/nosql/mongo/mongo.replication/#41","text":"rs.remove('node2:27017') \u64cd\u4f5c repset:PRIMARY> rs.remove('node2:27017') { \"ok\" : 1, \"operationTime\" : Timestamp(1554262658, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554262658, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> rs.status() { \"set\" : \"repset\", \"date\" : ISODate(\"2019-04-03T03:37:41.088Z\"), \"myState\" : 1, \"term\" : NumberLong(2), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"heartbeatIntervalMillis\" : NumberLong(2000), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp(1554262658, 1), \"t\" : NumberLong(2) }, \"readConcernMajorityOpTime\" : { \"ts\" : Timestamp(1554262658, 1), \"t\" : NumberLong(2) }, \"appliedOpTime\" : { \"ts\" : Timestamp(1554262658, 1), \"t\" : NumberLong(2) }, \"durableOpTime\" : { \"ts\" : Timestamp(1554262658, 1), \"t\" : NumberLong(2) } }, \"lastStableCheckpointTimestamp\" : Timestamp(1554262621, 1), \"members\" : [ { \"_id\" : 1, \"name\" : \"node1:27017\", \"health\" : 1, \"state\" : 1, \"stateStr\" : \"PRIMARY\", \"uptime\" : 4382, \"optime\" : { \"ts\" : Timestamp(1554262658, 1), \"t\" : NumberLong(2) }, \"optimeDate\" : ISODate(\"2019-04-03T03:37:38Z\"), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"electionTime\" : Timestamp(1554260529, 1), \"electionDate\" : ISODate(\"2019-04-03T03:02:09Z\"), \"configVersion\" : 4, \"self\" : true, \"lastHeartbeatMessage\" : \"\" }, { \"_id\" : 2, \"name\" : \"node3:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 2822, \"optime\" : { \"ts\" : Timestamp(1554262658, 1), \"t\" : NumberLong(2) }, \"optimeDurable\" : { \"ts\" : Timestamp(1554262658, 1), \"t\" : NumberLong(2) }, \"optimeDate\" : ISODate(\"2019-04-03T03:37:38Z\"), \"optimeDurableDate\" : ISODate(\"2019-04-03T03:37:38Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T03:37:40.489Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T03:37:40.999Z\"), \"pingMs\" : NumberLong(1), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"configVersion\" : 4 } ], \"ok\" : 1, \"operationTime\" : Timestamp(1554262658, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554262658, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } }","title":"4.1 \u5220\u9664"},{"location":"linux/nosql/mongo/mongo.replication/#42","text":"\u8981\u662f\u65b0\u7684\u673a\u5668\u60f3\u6dfb\u52a0\u5230\u96c6\u7fa4\u4e2d\uff0c\u53ea\u6709\u914d\u7f6e\u597d\u914d\u7f6e\u6587\u4ef6\uff0c\u7136\u540e\u542f\u52a8\u5728primary mongodb\u4e0a\u52a0\u5165\u8be5\u673a\u5668\u5373\u53ef\u3002 \u4e0a\u8282\u5427node2\u5254\u9664\u96c6\u7fa4\u4e86\u3002\u73b0\u5728\u6211\u4eec\u5047\u8bbenode2\u662f\u65b0\u7684\u673a\u5668\u3002\u7136\u540e\u52a0\u5165\u96c6\u7fa4\u5373\u53ef\u3002 rs.add(\"node2:27017\") \u64cd\u4f5c repset:PRIMARY> rs.add(\"node2:27017\") { \"ok\" : 1, \"operationTime\" : Timestamp(1554262759, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554262759, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> rs.status() { \"set\" : \"repset\", \"date\" : ISODate(\"2019-04-03T03:39:21.715Z\"), \"myState\" : 1, \"term\" : NumberLong(2), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"heartbeatIntervalMillis\" : NumberLong(2000), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp(1554262751, 1), \"t\" : NumberLong(2) }, \"appliedOpTime\" : { \"ts\" : Timestamp(1554262759, 1), \"t\" : NumberLong(2) }, \"durableOpTime\" : { \"ts\" : Timestamp(1554262759, 1), \"t\" : NumberLong(2) } }, \"lastStableCheckpointTimestamp\" : Timestamp(1554262741, 1), \"members\" : [ { \"_id\" : 1, \"name\" : \"node1:27017\", \"health\" : 1, \"state\" : 1, \"stateStr\" : \"PRIMARY\", \"uptime\" : 4482, \"optime\" : { \"ts\" : Timestamp(1554262759, 1), \"t\" : NumberLong(2) }, \"optimeDate\" : ISODate(\"2019-04-03T03:39:19Z\"), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"electionTime\" : Timestamp(1554260529, 1), \"electionDate\" : ISODate(\"2019-04-03T03:02:09Z\"), \"configVersion\" : 5, \"self\" : true, \"lastHeartbeatMessage\" : \"\" }, { \"_id\" : 2, \"name\" : \"node3:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 2923, \"optime\" : { \"ts\" : Timestamp(1554262751, 1), \"t\" : NumberLong(2) }, \"optimeDurable\" : { \"ts\" : Timestamp(1554262751, 1), \"t\" : NumberLong(2) }, \"optimeDate\" : ISODate(\"2019-04-03T03:39:11Z\"), \"optimeDurableDate\" : ISODate(\"2019-04-03T03:39:11Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T03:39:19.762Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T03:39:21.274Z\"), \"pingMs\" : NumberLong(18), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"node1:27017\", \"syncSourceHost\" : \"node1:27017\", \"syncSourceId\" : 1, \"infoMessage\" : \"\", \"configVersion\" : 4 }, { \"_id\" : 3, \"name\" : \"node2:27017\", \"health\" : 0, \"state\" : 8, \"stateStr\" : \"(not reachable/healthy)\", \"uptime\" : 0, \"optime\" : { \"ts\" : Timestamp(0, 0), \"t\" : NumberLong(-1) }, \"optimeDurable\" : { \"ts\" : Timestamp(0, 0), \"t\" : NumberLong(-1) }, \"optimeDate\" : ISODate(\"1970-01-01T00:00:00Z\"), \"optimeDurableDate\" : ISODate(\"1970-01-01T00:00:00Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T03:39:19.765Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T03:39:21.534Z\"), \"pingMs\" : NumberLong(0), \"lastHeartbeatMessage\" : \"Our replica set configuration is invalid or does not include us\", \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"configVersion\" : -1 } ], \"ok\" : 1, \"operationTime\" : Timestamp(1554262759, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554262759, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } }","title":"4.2 \u6dfb\u52a0"},{"location":"linux/nosql/mongo/mongo.replication/#43","text":"repset:PRIMARY> db.printSlaveReplicationInfo() source: node3:27017 syncedTo: Wed Apr 03 2019 13:10:21 GMT+0800 (CST) 0 secs (0 hrs) behind the primary source: node2:27017 syncedTo: Wed Apr 03 2019 13:10:21 GMT+0800 (CST) 0 secs (0 hrs) behind the primary \u89e3\u91ca source \uff1a\u4ece\u5e93\u7684 ip\u548c\u7aef\u53e3 \u3002 syncedTo \uff1a\u76ee\u524d\u7684\u540c\u6b65\u60c5\u51b5\uff0c\u4ee5\u53ca\u6700\u540e\u4e00\u6b21\u540c\u6b65\u7684\u65f6\u95f4\u3002 \u4ece\u4e0a\u9762\u53ef\u4ee5\u770b\u51fa\uff0c\u5728\u6570\u636e\u5e93\u5185\u5bb9\u4e0d\u53d8\u7684\u60c5\u51b5\u4e0b\u4ed6\u662f\u4e0d\u540c\u6b65\u7684\uff0c\u6570\u636e\u5e93\u53d8\u52a8\u5c31\u4f1a\u9a6c\u4e0a\u540c\u6b65","title":"4.3 \u67e5\u770b\u590d\u5236\u7684\u60c5\u51b5"},{"location":"linux/nosql/mongo/mongo.replication/#44","text":"repset:PRIMARY> rs.conf() { \"_id\" : \"repset\", \"version\" : 5, \"protocolVersion\" : NumberLong(1), \"writeConcernMajorityJournalDefault\" : true, \"members\" : [ { \"_id\" : 1, \"host\" : \"node1:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 2, \"host\" : \"node3:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 3, \"host\" : \"node2:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true, \"heartbeatIntervalMillis\" : 2000, \"heartbeatTimeoutSecs\" : 10, \"electionTimeoutMillis\" : 10000, \"catchUpTimeoutMillis\" : -1, \"catchUpTakeoverDelayMillis\" : 30000, \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1, \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId(\"5ca419993f98997dbf343825\") } }","title":"4.4 \u67e5\u770b\u526f\u672c\u96c6\u914d\u7f6e"},{"location":"linux/nosql/mongo/mongo.replication/#45","text":"\u6240\u6709\u7684Secondary\u90fd\u5b95\u673a\u3001\u6216\u5219\u526f\u672c\u96c6\u4e2d\u53ea\u5269\u4e0b\u4e00\u4e2a\u8282\u70b9\uff0c\u5219\u8be5\u8282\u70b9\u53ea\u80fd\u4e3aSecondary\u8282\u70b9\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u6574\u4e2a\u96c6\u7fa4\u667a\u80fd\u8fdb\u884c\u8bfb\u64cd\u4f5c\u800c\u4e0d\u80fd\u8fdb\u884c\u5199\u64cd\u4f5c\uff0c\u5f53\u5176\u4ed6\u7684\u6062\u590d\u65f6\uff0c\u4e4b\u524d\u7684primary\u8282\u70b9\u4ecd\u7136\u662fprimary\u8282\u70b9\u3002 \u5f53\u67d0\u4e2a\u8282\u70b9\u5b95\u673a\u540e\u91cd\u65b0\u542f\u52a8\u8be5\u8282\u70b9\u4f1a\u6709\u4e00\u6bb5\u7684\u65f6\u95f4\uff08\u65f6\u95f4\u957f\u77ed\u89c6\u96c6\u7fa4\u7684\u6570\u636e\u91cf\u548c\u5b95\u673a\u65f6\u95f4\u800c\u5b9a\uff09\u5bfc\u81f4\u6574\u4e2a\u96c6\u7fa4\u4e2d\u6240\u6709\u8282\u70b9\u90fd\u6210\u4e3asecondary\u800c\u65e0\u6cd5\u8fdb\u884c\u5199\u64cd\u4f5c\uff08\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709\u8bbe\u7f6e\u76f8\u5e94\u7684ReadReference\u4e5f\u53ef\u80fd\u4e0d\u80fd\u8fdb\u884c\u8bfb\u53d6\u64cd\u4f5c\uff09\u3002 \u5b98\u65b9\u63a8\u8350\u7684\u6700\u5c0f\u7684\u526f\u672c\u96c6\u4e5f\u5e94\u8be5\u5177\u5907\u4e00\u4e2aprimary\u8282\u70b9\u548c\u4e24\u4e2asecondary\u8282\u70b9\u3002\u4e24\u4e2a\u8282\u70b9\u7684\u526f\u672c\u96c6\u4e0d\u5177\u5907\u771f\u6b63\u7684\u6545\u969c\u8f6c\u79fb\u80fd\u529b\u3002","title":"4.5 \u6ce8\u610f"},{"location":"linux/nosql/mongo/mongo.replication/#5","text":"","title":"5. \u5e94\u7528"},{"location":"linux/nosql/mongo/mongo.replication/#51","text":"\u624b\u52a8\u5207\u6362Primary\u8282\u70b9\u5230\u81ea\u5df1\u7ed9\u5b9a\u7684\u8282\u70b9\uff0c\u4e0a\u9762\u5df2\u7ecf\u63d0\u5230\u8fc7\u4e86\u4f18\u5148\u96c6priority\uff0c\u56e0\u4e3a\u9ed8\u8ba4\u7684\u90fd\u662f1\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u628a\u7ed9\u5b9a\u7684\u670d\u52a1\u5668\u7684priority\u52a0\u5230\u6700\u5927\u5373\u53ef\u3002 \u67e5\u770bpriority repset : SECONDARY > rs . conf () { \"_id\" : \"repset\" , \"version\" : 5 , \"protocolVersion\" : NumberLong ( 1 ), \"writeConcernMajorityJournalDefault\" : true , \"members\" : [ { \"_id\" : 1 , \"host\" : \"node1:27017\" , \"arbiterOnly\" : false , \"buildIndexes\" : true , \"hidden\" : false , \"priority\" : 1 , \"tags\" : { }, \"slaveDelay\" : NumberLong ( 0 ), \"votes\" : 1 }, { \"_id\" : 2 , \"host\" : \"node3:27017\" , \"arbiterOnly\" : false , \"buildIndexes\" : true , \"hidden\" : false , \"priority\" : 1 , \"tags\" : { }, \"slaveDelay\" : NumberLong ( 0 ), \"votes\" : 1 }, { \"_id\" : 3 , \"host\" : \"node2:27017\" , \"arbiterOnly\" : false , \"buildIndexes\" : true , \"hidden\" : false , \"priority\" : 1 , \"tags\" : { }, \"slaveDelay\" : NumberLong ( 0 ), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true , \"heartbeatIntervalMillis\" : 2000 , \"heartbeatTimeoutSecs\" : 10 , \"electionTimeoutMillis\" : 10000 , \"catchUpTimeoutMillis\" : - 1 , \"catchUpTakeoverDelayMillis\" : 30000 , \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1 , \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId ( \"5ca419993f98997dbf343825\" ) } } \u5148\u67e5\u770b\u8c01\u662fprimary \u67e5\u770b\u8c01\u662fprimary repset : SECONDARY > rs . isMaster () { \"hosts\" : [ \"node1:27017\" , \"node3:27017\" , \"node2:27017\" ], \"setName\" : \"repset\" , \"setVersion\" : 5 , \"ismaster\" : false , \"secondary\" : true , \"primary\" : \"node1:27017\" , \"me\" : \"node2:27017\" , \"lastWrite\" : { \"opTime\" : { \"ts\" : Timestamp ( 1554269251 , 1 ), \"t\" : NumberLong ( 2 ) }, \"lastWriteDate\" : ISODate ( \"2019-04-03T05:27:31Z\" ), \"majorityOpTime\" : { \"ts\" : Timestamp ( 1554269251 , 1 ), \"t\" : NumberLong ( 2 ) }, \"majorityWriteDate\" : ISODate ( \"2019-04-03T05:27:31Z\" ) }, \"maxBsonObjectSize\" : 16777216 , \"maxMessageSizeBytes\" : 48000000 , \"maxWriteBatchSize\" : 100000 , \"localTime\" : ISODate ( \"2019-04-03T05:27:34.165Z\" ), \"logicalSessionTimeoutMinutes\" : 30 , \"minWireVersion\" : 0 , \"maxWireVersion\" : 7 , \"readOnly\" : false , \"ok\" : 1 , \"operationTime\" : Timestamp ( 1554269251 , 1 ), \"$clusterTime\" : { \"clusterTime\" : Timestamp ( 1554269251 , 1 ), \"signature\" : { \"hash\" : BinData ( 0 , \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\" ), \"keyId\" : NumberLong ( 0 ) } } } \u53ef\u4ee5\u770b\u51fa node1\u6b64\u65f6\u4e3aprimary\u8eab\u4efd \u3002 \u6b64\u65f6\u6211\u4eec\u8ba9\u624b\u52a8\u8ba9node2\u4f4dprimary \u600e\u4e48\u5206\u8fa8node2\u7684\u662f\u54ea\u4e2a 1. cfg . members [ 2 ] . priority = 2 \u662f\u4fee\u6539 node2\u7684\u4f18\u5148\u7ea7\u662f2 [ \u9ed8\u8ba4\u5927\u5bb6\u90fd\u662f 1 ] \uff0c\u8fd9\u6837 node2\u662f > 1 \u7684\u8bdd\uff0c\u4f18\u5148\u7ea7\u5c31\u9ad8\uff0c\u8fd9\u6837\u5c31\u91cd\u65b0\u9009\u4e3e\u540e node2\u4f1a\u662fparimary 2. \u600e\u4e48\u770b\u51fa node2\u662f2\u5462 ? rs . status () \u67e5\u770b\u7ed3\u679c\u7684\u65f6\u5019\u671f\u4e2d \"members\" \u540e\u9762\u662f\u6570\u7ec4\uff0c node2\u5728\u7b2c\u4e09\u4f4d\u6240\u4ee5\u662f2 [ \u4e0b\u6807\u662f 0 \u5f00\u59cb\u8ba1\u7b97 ] \u64cd\u4f5c\u8fc7\u7a0b repset:PRIMARY> cfg=rs.conf() { \"_id\" : \"repset\", \"version\" : 5, \"protocolVersion\" : NumberLong(1), \"writeConcernMajorityJournalDefault\" : true, \"members\" : [ { \"_id\" : 1, \"host\" : \"node1:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 2, \"host\" : \"node3:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 3, \"host\" : \"node2:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true, \"heartbeatIntervalMillis\" : 2000, \"heartbeatTimeoutSecs\" : 10, \"electionTimeoutMillis\" : 10000, \"catchUpTimeoutMillis\" : -1, \"catchUpTakeoverDelayMillis\" : 30000, \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1, \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId(\"5ca419993f98997dbf343825\") } } repset:PRIMARY> cfg.members[2].priority=2 2 repset:PRIMARY> rs.reconfig(cfg) { \"ok\" : 1, \"operationTime\" : Timestamp(1554270041, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554270041, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:SECONDARY> rs.isMaster() { \"hosts\" : [ \"node1:27017\", \"node3:27017\", \"node2:27017\" ], \"setName\" : \"repset\", \"setVersion\" : 6, \"ismaster\" : false, \"secondary\" : true, \"primary\" : \"node2:27017\", \"me\" : \"node1:27017\", \"lastWrite\" : { \"opTime\" : { \"ts\" : Timestamp(1554270083, 1), \"t\" : NumberLong(3) }, \"lastWriteDate\" : ISODate(\"2019-04-03T05:41:23Z\"), \"majorityOpTime\" : { \"ts\" : Timestamp(1554270083, 1), \"t\" : NumberLong(3) }, \"majorityWriteDate\" : ISODate(\"2019-04-03T05:41:23Z\") }, \"maxBsonObjectSize\" : 16777216, \"maxMessageSizeBytes\" : 48000000, \"maxWriteBatchSize\" : 100000, \"localTime\" : ISODate(\"2019-04-03T05:41:31.133Z\"), \"logicalSessionTimeoutMinutes\" : 30, \"minWireVersion\" : 0, \"maxWireVersion\" : 7, \"readOnly\" : false, \"ok\" : 1, \"operationTime\" : Timestamp(1554270083, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554270083, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } \u7ed9\u5b9a\u7684node2\u670d\u52a1\u5668\u5c31\u6210\u4e3a\u4e86primary\u8282\u70b9\u3002","title":"5.1 \u624b\u52a8\u5207\u6362"},{"location":"linux/nosql/mongo/mongo.replication/#52","text":"hidden\uff08\u6210\u5458\u7528\u4e8e\u652f\u6301\u4e13\u7528\u529f\u80fd\uff09\uff1a\u8fd9\u6837\u8bbe\u7f6e\u540e\u6b64\u673a\u5668\u5728\u8bfb\u5199\u4e2d\u90fd\u4e0d\u53ef\u89c1\uff0c\u5e76\u4e14\u4e0d\u4f1a\u88ab\u9009\u4e3e\u4e3aPrimary\uff0c\u4f46\u662f\u53ef\u4ee5\u6295\u7968\uff0c\u4e00\u822c\u7528\u4e8e\u5907\u4efd\u6570\u636e\u3002\u628anode3\u8282\u70b9\u5220\u9664\uff0c\u91cd\u542f\u3002\u518d\u6dfb\u52a0\u8ba9\u5176\u4e3ahidden\u8282\u70b9\uff1a \u5220\u9664node3 repset:PRIMARY> rs.status() { \"set\" : \"repset\", \"date\" : ISODate(\"2019-04-03T05:49:19.032Z\"), \"myState\" : 1, \"term\" : NumberLong(3), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"heartbeatIntervalMillis\" : NumberLong(2000), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"readConcernMajorityOpTime\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"appliedOpTime\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"durableOpTime\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) } }, \"lastStableCheckpointTimestamp\" : Timestamp(1554270513, 1), \"members\" : [ { \"_id\" : 1, \"name\" : \"node1:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 7799, \"optime\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"optimeDurable\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"optimeDate\" : ISODate(\"2019-04-03T05:49:13Z\"), \"optimeDurableDate\" : ISODate(\"2019-04-03T05:49:13Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T05:49:17.784Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T05:49:18.505Z\"), \"pingMs\" : NumberLong(0), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"node2:27017\", \"syncSourceHost\" : \"node2:27017\", \"syncSourceId\" : 3, \"infoMessage\" : \"\", \"configVersion\" : 6 }, { \"_id\" : 2, \"name\" : \"node3:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 7799, \"optime\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"optimeDurable\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"optimeDate\" : ISODate(\"2019-04-03T05:49:13Z\"), \"optimeDurableDate\" : ISODate(\"2019-04-03T05:49:13Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T05:49:17.780Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T05:49:18.574Z\"), \"pingMs\" : NumberLong(1), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"node2:27017\", \"syncSourceHost\" : \"node2:27017\", \"syncSourceId\" : 3, \"infoMessage\" : \"\", \"configVersion\" : 6 }, { \"_id\" : 3, \"name\" : \"node2:27017\", \"health\" : 1, \"state\" : 1, \"stateStr\" : \"PRIMARY\", \"uptime\" : 8506, \"optime\" : { \"ts\" : Timestamp(1554270553, 1), \"t\" : NumberLong(3) }, \"optimeDate\" : ISODate(\"2019-04-03T05:49:13Z\"), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"electionTime\" : Timestamp(1554270051, 1), \"electionDate\" : ISODate(\"2019-04-03T05:40:51Z\"), \"configVersion\" : 6, \"self\" : true, \"lastHeartbeatMessage\" : \"\" } ], \"ok\" : 1, \"operationTime\" : Timestamp(1554270553, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554270553, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> rs.remove('node3:27017') { \"ok\" : 1, \"operationTime\" : Timestamp(1554270578, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554270578, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> rs.status() { \"set\" : \"repset\", \"date\" : ISODate(\"2019-04-03T05:49:40.382Z\"), \"myState\" : 1, \"term\" : NumberLong(3), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"heartbeatIntervalMillis\" : NumberLong(2000), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp(1554270578, 1), \"t\" : NumberLong(3) }, \"readConcernMajorityOpTime\" : { \"ts\" : Timestamp(1554270578, 1), \"t\" : NumberLong(3) }, \"appliedOpTime\" : { \"ts\" : Timestamp(1554270578, 1), \"t\" : NumberLong(3) }, \"durableOpTime\" : { \"ts\" : Timestamp(1554270578, 1), \"t\" : NumberLong(3) } }, \"lastStableCheckpointTimestamp\" : Timestamp(1554270573, 1), \"members\" : [ { \"_id\" : 1, \"name\" : \"node1:27017\", \"health\" : 1, \"state\" : 2, \"stateStr\" : \"SECONDARY\", \"uptime\" : 7820, \"optime\" : { \"ts\" : Timestamp(1554270573, 1), \"t\" : NumberLong(3) }, \"optimeDurable\" : { \"ts\" : Timestamp(1554270573, 1), \"t\" : NumberLong(3) }, \"optimeDate\" : ISODate(\"2019-04-03T05:49:33Z\"), \"optimeDurableDate\" : ISODate(\"2019-04-03T05:49:33Z\"), \"lastHeartbeat\" : ISODate(\"2019-04-03T05:49:38.560Z\"), \"lastHeartbeatRecv\" : ISODate(\"2019-04-03T05:49:38.565Z\"), \"pingMs\" : NumberLong(0), \"lastHeartbeatMessage\" : \"\", \"syncingTo\" : \"node2:27017\", \"syncSourceHost\" : \"node2:27017\", \"syncSourceId\" : 3, \"infoMessage\" : \"\", \"configVersion\" : 6 }, { \"_id\" : 3, \"name\" : \"node2:27017\", \"health\" : 1, \"state\" : 1, \"stateStr\" : \"PRIMARY\", \"uptime\" : 8527, \"optime\" : { \"ts\" : Timestamp(1554270578, 1), \"t\" : NumberLong(3) }, \"optimeDate\" : ISODate(\"2019-04-03T05:49:38Z\"), \"syncingTo\" : \"\", \"syncSourceHost\" : \"\", \"syncSourceId\" : -1, \"infoMessage\" : \"\", \"electionTime\" : Timestamp(1554270051, 1), \"electionDate\" : ISODate(\"2019-04-03T05:40:51Z\"), \"configVersion\" : 7, \"self\" : true, \"lastHeartbeatMessage\" : \"\" } ], \"ok\" : 1, \"operationTime\" : Timestamp(1554270578, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554270578, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } \u6dfb\u52a0\u5907\u7528\u8282\u70b9[hidden\u9690\u85cf] repset:PRIMARY> rs.add({\"host\":\"node3:27017\",\"priority\":0,\"hidden\":true}) { \"ok\" : 1, \"operationTime\" : Timestamp(1554270639, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554270639, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } \u67e5\u770b\u72b6\u6001 repset:PRIMARY> rs.conf() { \"_id\" : \"repset\", \"version\" : 8, \"protocolVersion\" : NumberLong(1), \"writeConcernMajorityJournalDefault\" : true, \"members\" : [ { \"_id\" : 1, \"host\" : \"node1:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 3, \"host\" : \"node2:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 2, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 4, \"host\" : \"node3:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : true, \"priority\" : 0, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true, \"heartbeatIntervalMillis\" : 2000, \"heartbeatTimeoutSecs\" : 10, \"electionTimeoutMillis\" : 10000, \"catchUpTimeoutMillis\" : -1, \"catchUpTakeoverDelayMillis\" : 30000, \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1, \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId(\"5ca419993f98997dbf343825\") } } \u6d4b\u8bd5\u5176\u80fd\u5426\u53c2\u4e0e\u6295\u7968\uff1a\u5173\u95ed\u5f53\u524d\u7684Primary\uff0c\u67e5\u770b\u662f\u5426\u81ea\u52a8\u8f6c\u79fbPrimary repset:PRIMARY> use admin switched to db admin repset:PRIMARY> db.shutdownServer() server should be down... 2019-04-03T13:57:22.020+0800 I NETWORK [js] trying reconnect to 127.0.0.1:27017 failed 2019-04-03T13:57:22.601+0800 I NETWORK [js] reconnect 127.0.0.1:27017 failed failed 2019-04-03T13:57:22.604+0800 I NETWORK [js] trying reconnect to 127.0.0.1:27017 failed 2019-04-03T13:57:22.604+0800 I NETWORK [js] reconnect 127.0.0.1:27017 failed failed \u94fe\u63a5\u53e6\u4e00\u4e2a\u670d\u52a1\u5668[\u968f\u4fbf\u54ea\u4e2asecondary\u8282\u70b9]\u770b\u770b \u67e5\u770bnode1 repset : SECONDARY > rs . status () { \"set\" : \"repset\" , \"date\" : ISODate ( \"2019-04-03T05:57:43.329Z\" ), \"myState\" : 1 , \"term\" : NumberLong ( 4 ), \"syncingTo\" : \"\" , \"syncSourceHost\" : \"\" , \"syncSourceId\" : - 1 , \"heartbeatIntervalMillis\" : NumberLong ( 2000 ), \"optimes\" : { \"lastCommittedOpTime\" : { \"ts\" : Timestamp ( 1554271063 , 1 ), \"t\" : NumberLong ( 4 ) }, \"readConcernMajorityOpTime\" : { \"ts\" : Timestamp ( 1554271063 , 1 ), \"t\" : NumberLong ( 4 ) }, \"appliedOpTime\" : { \"ts\" : Timestamp ( 1554271063 , 1 ), \"t\" : NumberLong ( 4 ) }, \"durableOpTime\" : { \"ts\" : Timestamp ( 1554271063 , 1 ), \"t\" : NumberLong ( 4 ) } }, \"lastStableCheckpointTimestamp\" : Timestamp ( 1554271023 , 1 ), \"members\" : [ { \"_id\" : 1 , \"name\" : \"node1:27017\" , \"health\" : 1 , \"state\" : 1 , \"stateStr\" : \"PRIMARY\" , \"uptime\" : 12784 , \"optime\" : { \"ts\" : Timestamp ( 1554271063 , 1 ), \"t\" : NumberLong ( 4 ) }, \"optimeDate\" : ISODate ( \"2019-04-03T05:57:43Z\" ), \"syncingTo\" : \"\" , \"syncSourceHost\" : \"\" , \"syncSourceId\" : - 1 , \"infoMessage\" : \"\" , \"electionTime\" : Timestamp ( 1554271042 , 1 ), \"electionDate\" : ISODate ( \"2019-04-03T05:57:22Z\" ), \"configVersion\" : 8 , \"self\" : true , \"lastHeartbeatMessage\" : \"\" }, { \"_id\" : 3 , \"name\" : \"node2:27017\" , \"health\" : 0 , \"state\" : 8 , \"stateStr\" : \"(not reachable/healthy)\" , \"uptime\" : 0 , \"optime\" : { \"ts\" : Timestamp ( 0 , 0 ), \"t\" : NumberLong ( - 1 ) }, \"optimeDurable\" : { \"ts\" : Timestamp ( 0 , 0 ), \"t\" : NumberLong ( - 1 ) }, \"optimeDate\" : ISODate ( \"1970-01-01T00:00:00Z\" ), \"optimeDurableDate\" : ISODate ( \"1970-01-01T00:00:00Z\" ), \"lastHeartbeat\" : ISODate ( \"2019-04-03T05:57:42.073Z\" ), \"lastHeartbeatRecv\" : ISODate ( \"2019-04-03T05:57:21.280Z\" ), \"pingMs\" : NumberLong ( 0 ), \"lastHeartbeatMessage\" : \"Error connecting to node2:27017 (192.168.178.129:27017) :: caused by :: Connection refused\" , \"syncingTo\" : \"\" , \"syncSourceHost\" : \"\" , \"syncSourceId\" : - 1 , \"infoMessage\" : \"\" , \"configVersion\" : - 1 }, { \"_id\" : 4 , \"name\" : \"node3:27017\" , \"health\" : 1 , \"state\" : 2 , \"stateStr\" : \"SECONDARY\" , \"uptime\" : 423 , \"optime\" : { \"ts\" : Timestamp ( 1554271053 , 1 ), \"t\" : NumberLong ( 4 ) }, \"optimeDurable\" : { \"ts\" : Timestamp ( 1554271053 , 1 ), \"t\" : NumberLong ( 4 ) }, \"optimeDate\" : ISODate ( \"2019-04-03T05:57:33Z\" ), \"optimeDurableDate\" : ISODate ( \"2019-04-03T05:57:33Z\" ), \"lastHeartbeat\" : ISODate ( \"2019-04-03T05:57:42.033Z\" ), \"lastHeartbeatRecv\" : ISODate ( \"2019-04-03T05:57:42.614Z\" ), \"pingMs\" : NumberLong ( 0 ), \"lastHeartbeatMessage\" : \"\" , \"syncingTo\" : \"node1:27017\" , \"syncSourceHost\" : \"node1:27017\" , \"syncSourceId\" : 1 , \"infoMessage\" : \"\" , \"configVersion\" : 8 } ], \"ok\" : 1 , \"operationTime\" : Timestamp ( 1554271063 , 1 ), \"$clusterTime\" : { \"clusterTime\" : Timestamp ( 1554271063 , 1 ), \"signature\" : { \"hash\" : BinData ( 0 , \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\" ), \"keyId\" : NumberLong ( 0 ) } } } \u4e0a\u9762\u8bf4\u660ePrimary\u5df2\u7ecf\u8f6c\u79fb\uff0c\u8bf4\u660ehidden\u5177\u6709\u6295\u7968\u7684\u6743\u5229\uff0c\u7ee7\u7eed\u67e5\u770b\u662f\u5426\u6709\u6570\u636e\u590d\u5236\u7684\u529f\u80fd\u3002 \u5728\u770b\u4e0b\u662f\u5426\u590d\u5236 repset:PRIMARY> db.test.count() 10000 repset:PRIMARY> use test switched to db test repset:PRIMARY> for(var i=0;i<90;i++){db.test.insert({\"name\":\"keke\"+i,\"age\":123})} WriteResult({ \"nInserted\" : 1 }) repset:PRIMARY> db.test.count() 10090 \u67e5\u770b repset:SECONDARY> use test; switched to db test repset:SECONDARY> db.test.count() 10090 \u4e0a\u9762\u8bf4\u660ehidden\u5177\u6709\u6570\u636e\u590d\u5236\u7684\u529f\u80fd\u3002","title":"5.2 \u6dfb\u52a0\u5907\u4efd\u8282\u70b9"},{"location":"linux/nosql/mongo/mongo.replication/#53","text":"","title":"5.3 \u6dfb\u52a0\u5ef6\u65f6\u8282\u70b9"},{"location":"linux/nosql/mongo/mongo.replication/#531","text":"Delayed\uff08\u6210\u5458\u7528\u4e8e\u652f\u6301\u4e13\u7528\u529f\u80fd\uff09\uff1a\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u65f6\u95f4\u5ef6\u8fdf\u4eceprimary\u8282\u70b9\u540c\u6b65\u6570\u636e\u3002\u4e3b\u8981\u7528\u4e8e\u5904\u7406\u8bef\u5220\u9664\u6570\u636e\u9a6c\u4e0a\u540c\u6b65\u5230\u4ece\u8282\u70b9\u5bfc\u81f4\u7684\u4e0d\u4e00\u81f4\u95ee\u9898\u3002 \u6211\u4eec\u628anode3\uff0c\u4e5f\u5c31\u662f\u4e0a\u9762\u7684\u9690\u85cf\u8282\u70b9\u5220\u9664\uff0c\u7136\u540e\u518d\u4ee5\u5ef6\u65f6\u8282\u70b9\u6dfb\u52a0\u8fdb\u6765\u3002 \u5220\u9664node3 repset : PRIMARY > rs . remove ( 'node3:27017' ) { \"ok\" : 1 , \"operationTime\" : Timestamp ( 1554271650 , 1 ), \"$clusterTime\" : { \"clusterTime\" : Timestamp ( 1554271650 , 1 ), \"signature\" : { \"hash\" : BinData ( 0 , \"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\" ), \"keyId\" : NumberLong ( 0 ) } } } repset : PRIMARY > rs . conf () { \"_id\" : \"repset\" , \"version\" : 9 , \"protocolVersion\" : NumberLong ( 1 ), \"writeConcernMajorityJournalDefault\" : true , \"members\" : [ { \"_id\" : 1 , \"host\" : \"node1:27017\" , \"arbiterOnly\" : false , \"buildIndexes\" : true , \"hidden\" : false , \"priority\" : 1 , \"tags\" : { }, \"slaveDelay\" : NumberLong ( 0 ), \"votes\" : 1 }, { \"_id\" : 3 , \"host\" : \"node2:27017\" , \"arbiterOnly\" : false , \"buildIndexes\" : true , \"hidden\" : false , \"priority\" : 2 , \"tags\" : { }, \"slaveDelay\" : NumberLong ( 0 ), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true , \"heartbeatIntervalMillis\" : 2000 , \"heartbeatTimeoutSecs\" : 10 , \"electionTimeoutMillis\" : 10000 , \"catchUpTimeoutMillis\" : - 1 , \"catchUpTakeoverDelayMillis\" : 30000 , \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1 , \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId ( \"5ca419993f98997dbf343825\" ) } } \u6dfb\u52a0node3\u4ee5\u5ef6\u65f6\u8282\u70b9\u65b9\u5f0f\u6dfb\u52a0\u5230\u96c6\u7fa4 rs.add({\"host\":\"node3:27017\",\"priority\":0,\"hidden\":false,\"slaveDelay\":120}) \u671f\u4e2dpriority\u5fc5\u987b\u4e3a0,\u5426\u5219\u4f1a\u62a5\u9519\u3002\u62a5\u9519\u5982\u4e0b \"errmsg\" : \"priority must be 0 when slaveDelay is used\" \u6dfb\u52a0\u5ef6\u65f6node3\u8282\u70b9 repset:PRIMARY> rs.add({\"host\":\"node3:27017\",\"priority\":0,\"hidden\":false,\"slaveDelay\":120}) { \"ok\" : 1, \"operationTime\" : Timestamp(1554271789, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554271789, 1), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } repset:PRIMARY> rs.conf() { \"_id\" : \"repset\", \"version\" : 10, \"protocolVersion\" : NumberLong(1), \"writeConcernMajorityJournalDefault\" : true, \"members\" : [ { \"_id\" : 1, \"host\" : \"node1:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 1, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 3, \"host\" : \"node2:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 2, \"tags\" : { }, \"slaveDelay\" : NumberLong(0), \"votes\" : 1 }, { \"_id\" : 4, \"host\" : \"node3:27017\", \"arbiterOnly\" : false, \"buildIndexes\" : true, \"hidden\" : false, \"priority\" : 0, \"tags\" : { }, \"slaveDelay\" : NumberLong(120), \"votes\" : 1 } ], \"settings\" : { \"chainingAllowed\" : true, \"heartbeatIntervalMillis\" : 2000, \"heartbeatTimeoutSecs\" : 10, \"electionTimeoutMillis\" : 10000, \"catchUpTimeoutMillis\" : -1, \"catchUpTakeoverDelayMillis\" : 30000, \"getLastErrorModes\" : { }, \"getLastErrorDefaults\" : { \"w\" : 1, \"wtimeout\" : 0 }, \"replicaSetId\" : ObjectId(\"5ca419993f98997dbf343825\") } }","title":"5.3.1 \u64cd\u4f5c"},{"location":"linux/nosql/mongo/mongo.replication/#532","text":"\u9996\u5148\u5728primary\u4e0a\u6dfb\u52a0\u6570\u636e\uff0c\u7136\u540e\u53bb\u5ef6\u65f6\u8282\u70b9\u4e0a\u67e5\u770b\u3002 primary\u4e0a\u67e5\u770b repset:PRIMARY> db.test.count() 11000 \u6b64\u65f6\u7acb\u9a6c\u67e5\u770bsecondary\u4e0a\u4fe1\u606f repset:SECONDARY> db.test.count() 11000 \u4ece\u4e0a\u53ef\u89c1\uff0csecondary\u662fprimary\u4e00\u6837\u6570\u636e\uff0c\u6b64\u65f6\u5f00\u59cb\u5411primary\u603c\u6570\u636e\u3002 repset:PRIMARY> for(var i=0;i<1000;i++){db.test.insert({\"name\":\"cmz\"+i,\"age\":10})} WriteResult({ \"nInserted\" : 1 }) repset:PRIMARY> db.test.count() 12000 \u65f6\u67e5\u770b\u6ca1\u6709\u5ef6\u65f6\u8282\u70b9secondary\u6570\u636e repset:SECONDARY> db.test.count() 12000 \u8bf4\u660e\u6570\u636e\u7acb\u9a6c\u540c\u6b65\u8fc7\u6765\u4e86\u3002 \u7d27\u63a5\u7740\u6b64\u65f6\u7acb\u9a6c\u67e5\u770b\u5ef6\u65f6\u8282\u70b9\u7684secondary\u6570\u636e\u3002 repset:SECONDARY> db.test.count() 11000 \u6ca1\u6709\u7acb\u9a6c\u540c\u6b65\u3002\u5728\u7b49\u7b49\u5427\uff0c\u6211\u4e0a\u9762\u914d\u7f6e\u4e86120\u79d2\u6570\u636e\u624d\u540c\u6b65\u3002\u65f6\u95f4\u5230\u4e86\u518d\u6b21\u67e5\u770b\u5ef6\u65f6\u8282\u70b9\u3002 repset:SECONDARY> db.test.count() 12000 nice\uff0c\u65f6\u95f4\u5230\u4e86\uff0c\u6570\u636e\u8fc7\u6765\u4e86\u3002\u4e0a\u9762\u8bf4\u660edelayed\u80fd\u591f\u6210\u529f\u7684\u628a\u540c\u6b65\u64cd\u4f5c\u5ef6\u8fdf120\u79d2\u6267\u884c\u3002\u9664\u4e86\u4e0a\u9762\u7684\u6210\u5458\u4e4b\u5916\uff0c Secondary-Only:\u4e0d\u80fd\u6210\u4e3aprimary\u8282\u70b9\uff0c\u53ea\u80fd\u4f5c\u4e3asecondary\u526f\u672c\u8282\u70b9\uff0c\u9632\u6b62\u4e00\u4e9b\u6027\u80fd\u4e0d\u9ad8\u7684\u8282\u70b9\u6210\u4e3a\u4e3b\u8282\u70b9\u3002 Non-Voting\uff1a\u6ca1\u6709\u9009\u4e3e\u6743\u7684secondary\u8282\u70b9\uff0c\u7eaf\u7cb9\u7684\u5907\u4efd\u6570\u636e\u8282\u70b9\u3002 \u5177\u4f53\u6210\u5458\u4fe1\u606f\u5982\u4e0b\uff1a \u529f\u80fd \u6210\u4e3aprimary \u5bf9\u5ba2\u6237\u7aef\u53ef\u89c1 \u53c2\u4e0e\u6295\u7968 \u5ef6\u8fdf\u540c\u6b65 \u590d\u5236\u6570\u636e Default \u221a \u221a \u221a \u2215 \u221a Secondary-Only / \u221a \u221a \u2215 \u221a Hidden / / \u221a \u2215 \u221a Delayed / \u221a \u221a \u221a \u221a Arbiters / / \u221a \u2215 / Non-Voting \u221a \u221a / \u2215 \u221a","title":"5.3.2 \u6d4b\u8bd5"},{"location":"linux/nosql/mongo/mongo.replication/#54","text":"MongoDB\u526f\u672c\u96c6\u5bf9\u8bfb\u5199\u5206\u79bb\u7684\u652f\u6301\u662f\u901a\u8fc7Read Preferences\u7279\u6027\u8fdb\u884c\u652f\u6301\u7684\uff0c\u8fd9\u4e2a\u7279\u6027\u975e\u5e38\u590d\u6742\u548c\u7075\u6d3b\u3002 \u5e94\u7528\u7a0b\u5e8f\u9a71\u52a8\u901a\u8fc7read reference\u6765\u8bbe\u5b9a\u5982\u4f55\u5bf9\u526f\u672c\u96c6\u8fdb\u884c\u8bfb\u53d6\u64cd\u4f5c\uff0c\u9ed8\u8ba4\u7684,\u5ba2\u6237\u7aef\u9a71\u52a8\u6240\u6709\u7684\u8bfb\u64cd\u4f5c\u90fd\u662f\u76f4\u63a5\u8bbf\u95eeprimary\u8282\u70b9\u7684\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u4e25\u683c\u4e00\u81f4\u6027\u3002 \u652f\u6301\u4e94\u79cd\u7684read preference\u6a21\u5f0f \u5b98\u7f51\u4f20\u9001\u95e8 primary \uff1a \u4e3b\u8282\u70b9\uff0c\u9ed8\u8ba4\u6a21\u5f0f\uff0c\u8bfb\u64cd\u4f5c\u53ea\u5728\u4e3b\u8282\u70b9\uff0c\u5982\u679c\u4e3b\u8282\u70b9\u4e0d\u53ef\u7528\uff0c\u62a5\u9519\u6216\u8005\u629b\u51fa\u5f02\u5e38\u3002 primaryPreferred \uff1a \u9996\u9009\u4e3b\u8282\u70b9\uff0c\u5927\u591a\u60c5\u51b5\u4e0b\u8bfb\u64cd\u4f5c\u5728\u4e3b\u8282\u70b9\uff0c\u5982\u679c\u4e3b\u8282\u70b9\u4e0d\u53ef\u7528\uff0c\u5982\u6545\u969c\u8f6c\u79fb\uff0c\u8bfb\u64cd\u4f5c\u5728\u4ece\u8282\u70b9\u3002 secondary \uff1a\u4ece\u8282\u70b9\uff0c\u8bfb\u64cd\u4f5c\u53ea\u5728\u4ece\u8282\u70b9\uff0c \u5982\u679c\u4ece\u8282\u70b9\u4e0d\u53ef\u7528\uff0c\u62a5\u9519\u6216\u8005\u629b\u51fa\u5f02\u5e38\u3002 secondaryPreferred \uff1a \u9996\u9009\u4ece\u8282\u70b9\uff0c\u5927\u591a\u60c5\u51b5\u4e0b\u8bfb\u64cd\u4f5c\u5728\u4ece\u8282\u70b9\uff0c\u7279\u6b8a\u60c5\u51b5\uff08\u5982\u5355\u4e3b\u8282\u70b9\u67b6\u6784\uff09\u8bfb\u64cd\u4f5c\u5728\u4e3b\u8282\u70b9\u3002 nearest \uff1a \u6700\u90bb\u8fd1\u8282\u70b9\uff0c\u8bfb\u64cd\u4f5c\u5728\u6700\u90bb\u8fd1\u7684\u6210\u5458\uff0c\u53ef\u80fd\u662f\u4e3b\u8282\u70b9\u6216\u8005\u4ece\u8282\u70b9\uff0c\u5173\u4e8e\u6700\u90bb\u8fd1\u7684\u6210\u5458\u8bf7\u53c2\u8003","title":"5.4 \u8bfb\u5199\u5206\u79bb"},{"location":"linux/nosql/mongo/mongo.shard_info/","text":"mongod sharding 1. \u4ecb\u7ecd \u00b6 MongoDB\u7684\u53e6\u4e00\u4e2a\u96c6\u7fa4\u5c31\u662fsharding\u3002\u6240\u8c13sharding\u5c31\u662f\u5c06\u540c\u4e00\u4e2a\u96c6\u5408\u7684\u4e0d\u540c\u5b50\u96c6\u5206\u53d1\u5b58\u50a8\u5230\u4e0d\u540c\u7684\u673a\u5668\uff08shard\uff09\u4e0a\uff0cMongodb\u4f7f\u7528sharding\u673a\u5236\u6765\u652f\u6301\u8d85\u5927\u6570\u636e\u91cf\uff0c\u5c06\u4e0d\u540c\u7684CRUD\u8def\u7531\u5230\u4e0d\u540c\u7684\u673a\u5668\u4e0a\u6267\u884c\uff0c\u63d0\u5230\u4e86\u6570\u636e\u5e93\u7684\u541e\u5410\u6027\u80fd\u3002\u7531\u6b64\u53ef\u89c1\uff0csharding\u662f\u975e\u5e38\u5e38\u89c1\u7684scale out\u65b9\u6cd5\u3002 \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u4e00\u4e2a\u96c6\u5408\uff08Collection1\uff09\u67091T\u7684\u6570\u636e\uff0c\u539f\u672c\u653e\u5728\u4e00\u4e2a\u5355\u72ec\u7684\u6570\u636e\u5e93\u4e2d\uff0c\u901a\u8fc7sharding\uff0c\u5c06\u8fd9\u4e2a\u96c6\u5408\u7684\u6570\u636e\u653e\u5728\u56db\u4e2a\u72ec\u7acb\u7684shard\u4e2d\uff0c\u6bcf\u4e00\u4e2ashard\u5b58\u50a8\u8fd9\u4e2a\u96c6\u5408256G\u7684\u6570\u636e\u3002\u6bcf\u4e2ashard\u7269\u7406\u4e0a\u662f\u72ec\u7acb\u7684\u6570\u636e\u5e93\uff0c\u4f46\u903b\u8f91\u4e0a\u5171\u540c\u7ec4\u6210\u4e00\u4e2a\u6570\u636e\u5e93\u3002 \u4e00\u4e2asharded cluster\u7531\u4e00\u4e0b\u4e09\u90e8\u5206\u7ec4\u6210\uff1aconfig server\uff0cshards\uff0crouter\u3002\u5982\u56fe\u6240\u793a\uff1a 1.1 \u89d2\u8272\u5212\u5206 \u00b6 1.1.1 \u6570\u636e\u5206\u7247[shards] \u00b6 \u5b58\u50a8\u6570\u636e\uff0c\u53ef\u4ee5\u662f\u5355\u4e2a\u7684mongod\uff0c\u4e5f\u53ef\u4ee5\u662freplica set\u3002\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u4e3a\u4e86\u63d0\u9ad8\u9ad8\u53ef\u7528\u6027\uff0c\u90fd\u4f1a\u4f7f\u7528replica set\u3002\u5b58\u50a8\u5728mongod\u4e0a\u7684\u6570\u636e\u4ee5chunk\u4e3a\u57fa\u672c\u5355\u4f4d\uff0c\u9ed8\u8ba4\u7684\u5927\u5c0f\u4e3a64M\uff0c\u540e\u9762\u4f1a\u4ecb\u7ecdshard\u4e0a\u6570\u636e\u7684\u5206\u88c2\uff08split\uff09\u4e0e\u8fc1\u79fb\uff08migration\uff09,\u4e00\u53f0\u673a\u5668\u7684\u4e00\u4e2a\u6570\u636e\u8868 Collection1 \u5b58\u50a8\u4e86 1T \u6570\u636e\uff0c\u538b\u529b\u592a\u5927\u4e86\uff01\u5728\u5206\u7ed94\u4e2a\u673a\u5668\u540e\uff0c\u6bcf\u4e2a\u673a\u5668\u90fd\u662f256G\uff0c\u5219\u5206\u644a\u4e86\u96c6\u4e2d\u5728\u4e00\u53f0\u673a\u5668\u7684\u538b\u529b\u3002\u4e5f\u8bb8\u6709\u4eba\u95ee\u4e00\u53f0\u673a\u5668\u786c\u76d8\u52a0\u5927\u4e00\u70b9\u4e0d\u5c31\u53ef\u4ee5\u4e86\uff0c\u4e3a\u4ec0\u4e48\u8981\u5206\u7ed9\u56db\u53f0\u673a\u5668\u5462\uff1f\u4e0d\u8981\u5149\u60f3\u5230\u5b58\u50a8\u7a7a\u95f4\uff0c\u5b9e\u9645\u8fd0\u884c\u7684\u6570\u636e\u5e93\u8fd8\u6709\u786c\u76d8\u7684\u8bfb\u5199\u3001\u7f51\u7edc\u7684IO\u3001CPU\u548c\u5185\u5b58\u7684\u74f6\u9888\u3002\u5728mongodb\u96c6\u7fa4\u53ea\u8981\u8bbe\u7f6e\u597d\u4e86\u5206\u7247\u89c4\u5219\uff0c\u901a\u8fc7mongos\u64cd\u4f5c\u6570\u636e\u5e93\u5c31\u80fd\u81ea\u52a8\u628a\u5bf9\u5e94\u7684\u6570\u636e\u64cd\u4f5c\u8bf7\u6c42\u8f6c\u53d1\u5230\u5bf9\u5e94\u7684\u5206\u7247\u673a\u5668\u4e0a\u3002\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5206\u7247\u7684\u7247\u952e\u53ef\u8981\u597d\u597d\u8bbe\u7f6e\uff0c\u8fd9\u4e2a\u5f71\u54cd\u5230\u4e86\u600e\u4e48\u628a\u6570\u636e\u5747\u5300\u5206\u5230\u591a\u4e2a\u5206\u7247\u673a\u5668\u4e0a\uff0c\u4e0d\u8981\u51fa\u73b0\u5176\u4e2d\u4e00\u53f0\u673a\u5668\u5206\u4e861T\uff0c\u5176\u4ed6\u673a\u5668\u6ca1\u6709\u5206\u5230\u7684\u60c5\u51b5\uff0c\u8fd9\u6837\u8fd8\u4e0d\u5982\u4e0d\u5206\u7247\uff01 1.1.2 \u914d\u7f6e\u670d\u52a1\u5668[configserver] \u00b6 \u987e\u540d\u601d\u4e49\u4e3a\u914d\u7f6e\u670d\u52a1\u5668\uff0c\u5b58\u50a8\u6240\u6709\u6570\u636e\u5e93\u5143\u4fe1\u606f\uff08\u8def\u7531\u3001\u5206\u7247\uff09\u7684\u914d\u7f6e\u3002mongos\u672c\u8eab\u6ca1\u6709\u7269\u7406\u5b58\u50a8\u5206\u7247\u670d\u52a1\u5668\u548c\u6570\u636e\u8def\u7531\u4fe1\u606f\uff0c\u53ea\u662f\u7f13\u5b58\u5728\u5185\u5b58\u91cc\uff0c\u914d\u7f6e\u670d\u52a1\u5668\u5219\u5b9e\u9645\u5b58\u50a8\u8fd9\u4e9b\u6570\u636e\u3002mongos\u7b2c\u4e00\u6b21\u542f\u52a8\u6216\u8005\u5173\u6389\u91cd\u542f\u5c31\u4f1a\u4ece config server \u52a0\u8f7d\u914d\u7f6e\u4fe1\u606f\uff0c\u4ee5\u540e\u5982\u679c\u914d\u7f6e\u670d\u52a1\u5668\u4fe1\u606f\u53d8\u5316\u4f1a\u901a\u77e5\u5230\u6240\u6709\u7684 mongos \u66f4\u65b0\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u8fd9\u6837 mongos \u5c31\u80fd\u7ee7\u7eed\u51c6\u786e\u8def\u7531\u3002\u5728\u751f\u4ea7\u73af\u5883\u901a\u5e38\u6709\u591a\u4e2a config server \u914d\u7f6e\u670d\u52a1\u5668\uff0c\u56e0\u4e3a\u5b83\u5b58\u50a8\u4e86\u5206\u7247\u8def\u7531\u7684\u5143\u6570\u636e\uff0c\u8fd9\u4e2a\u53ef\u4e0d\u80fd\u4e22\u5931\uff01\u5c31\u7b97\u6302\u6389\u5176\u4e2d\u4e00\u53f0\uff0c\u53ea\u8981\u8fd8\u6709\u5b58\u8d27\uff0c mongodb\u96c6\u7fa4\u5c31\u4e0d\u4f1a\u6302\u6389\u3002\u5b58\u50a8\u96c6\u7fa4\u7684\u5143\u6570\u636e\uff08metadata\uff09\uff0c\u5373\u6570\u636e\u7684\u54ea\u4e00\u90e8\u5206\u653e\u5728\u54ea\u4e00\u4e2ashard\u4e0a\uff0crouter\u5c06\u4f1a\u5229\u7528\u8fd9\u4e9b\u5143\u6570\u636e\u5c06\u8bf7\u6c42\u5206\u53d1\u5230\u5bf9\u5e94\u7684shards\u4e0a\uff0cshards\u4e0achunk\u7684\u8fc1\u79fb\u4e5f\u662fconfig server\u6765\u63a7\u5236\u7684\u3002 1.1.3 \u67e5\u8be2\u8def\u7531router[mongos] \u00b6 mongos\u5b9e\u4f8b\uff0c\u5728\u4e00\u4e2a\u96c6\u7fa4\u4e2d\u76f4\u63a5\u4e3a\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u670d\u52a1\uff0c\u5229\u7528config server\u4e0a\u7684\u5143\u6570\u636e\u6765\u5236\u5b9a\u6700\u4f73\u7684\u67e5\u8be2\u8ba1\u5212\u3002\u6570\u636e\u8def\u7531,\u548c\u5ba2\u6237\u7aef\u6253\u4ea4\u9053\u7684\u6a21\u5757,mongos\u81ea\u8eab\u6ca1\u6709\u4efb\u4f55\u6570\u636e,\u4e5f\u4e0d\u77e5\u9053\u8be5\u5982\u4f55\u5904\u7406\u6570\u636e,\u8fd9\u4e9b\u90fd\u9700\u8981config-server\u6765\u544a\u8bc9\u4ed6\u3002 1.2 \u8def\u7531 \u00b6 \u5f53\u6570\u636e\u5199\u5165\u65f6,MongoDB Cluster\u6839\u636e\u5206\u7247\u952e\u8bbe\u8ba1\u5199\u5165\u6570\u636e \u5f53\u5916\u90e8\u8bed\u53e5\u53d1\u8d77\u6570\u636e\u67e5\u8be2\u65f6,MongoDB\u6839\u636e\u6570\u636e\u5206\u5e03\u81ea\u52a8\u8def\u7531\u81f3\u6307\u5b9a\u8282\u70b9\u8fd4\u56de\u6570\u636e 1.3 \u96c6\u7fa4\u4e2d\u6570\u636e\u7684\u5206\u5e03 \u00b6 1.3.1 Chunk \u00b6 \u5728\u4e00\u4e2ashard-server\u5185\u90e8,MongoDB\u8fd8\u662f\u4f1a\u628a\u6570\u636e\u5206\u4e3achunks,\u6bcf\u4e2achunk\u4ee3\u8868\u8fd9\u4e2ashard-server\u5185\u90e8\u4e00\u5206\u90e8\u6570\u636e,chunk\u7684\u4ea7\u751f,\u4f1a\u6709\u4ee5\u4e0b\u4e24\u4e2a\u7528\u9014: Splitting \u5f53\u4e00\u4e2achunk\u7684\u5927\u5c0f\u8d85\u8fc7\u914d\u7f6e\u4e2d\u7684chunk size\u65f6,MongoDB\u7684\u540e\u53f0\u8fdb\u7a0b\u4f1a\u628a\u8fd9\u4e2achunk\u5207\u5206\u6210\u66f4\u5c0f\u7684chunk,\u4ece\u800c\u907f\u514dchunk\u8fc7\u5927\u7684\u60c5\u51b5 Balancing \u5f53MongoDB\u4e2d,balance\u662f\u4e00\u4e2a\u540e\u53f0\u8fdb\u7a0b,\u8d1f\u8d23chunk\u7684\u8fc1\u79fb,\u4ece\u800c\u5747\u8861\u5404\u4e2ashard-server\u8d1f\u8f7d,\u7cfb\u7edf\u521d\u8bc61\u4e2achunk,chunk size\u9ed8\u8ba4\u503c\u662f64M,\u751f\u4ea7\u5e93\u4e0a\u9009\u62e9\u9002\u5408\u4e1a\u52a1\u7684chunk size\u662f\u6700\u597d\u7684,MongoDB\u4f1a\u81ea\u52a8\u62c6\u5206\u548c\u8fc1\u79fbchunks 1.3.2 shard\u8282\u70b9 \u00b6 \u4f7f\u7528chunk\u6765\u5b58\u50a8\u6570\u636e \u8fdb\u7a0b\u642d\u5efa\u5b8c\u6210\u4e4b\u540e,\u9ed8\u8ba4\u5f00\u542f\u4e00\u4e2achunk,\u5927\u5c0f\u662f64M \u5b58\u50a8\u9700\u6c42\u8d85\u8fc764M,chunk\u4f1a\u8fdb\u884c\u5206\u5217,\u5982\u679c\u5355\u4f4d\u65f6\u95f4\u5b58\u50a8\u9700\u6c42\u5f88\u5927,\u8bbe\u7f6e\u66f4\u5927\u7684chunk chunk\u4f1a\u81ea\u52a8\u5747\u8861\u8fc1\u79fb 1.4 chunk size \u00b6 \u9002\u5408\u4e1a\u52a1\u7684chunk size\u662f\u6700\u597d\u7684\uff0cchunk\u7684\u5206\u88c2\u548c\u8fc1\u79fb\u975e\u5e38\u6d88\u8017IO\u8d44\u6e90,chunk\u5206\u88c2\u7684\u65f6\u673a:\u5728\u63d2\u5165\u548c\u66f4\u65b0,\u8bfb\u6570\u636e\u4e0d\u4f1a\u5206\u88c2 1.4.1 chunk size\u9009\u62e9 \u00b6 \u5c0f\u7684chunk size : \u6570\u636e\u5747\u8861\u65f6\u8fc1\u79fb\u5feb,\u6570\u636e\u5206\u5e03\u66f4\u52a0\u5747\u5300,\u6570\u636e\u5206\u88c2\u9891\u7e41,\u8def\u7531\u8282\u70b9\u6d88\u8017\u66f4\u591a\u8d44\u6e90 \u5927\u7684chunk size : \u6570\u636e\u5206\u88c2\u5c11,\u6570\u636e\u5757\u79fb\u52a8\u96c6\u4e2d\u6d88\u8017IO\u8d44\u6e90,\u901a\u5e38100-200M 1.4.2 chunk\u5206\u88c2\u548c\u8fc1\u79fb \u00b6 \u968f\u7740\u6570\u636e\u7684\u589e\u957f,\u5176\u4e2d\u7684\u6570\u636e\u5927\u5c0f\u8d85\u8fc7\u4e86\u914d\u5408\u7684chunk size,\u9ed8\u8ba4\u503c\u65f664M,\u5219\u8fd9\u4e2achunk\u5206\u88c2\u6210\u4e24\u4e2a,\u6570\u636e\u7684\u589e\u957f\u4f1a\u8ba9chunk\u5206\u88c2\u7684\u8d8a\u6765\u8d8a\u591a \u8fd9\u65f6\u5019,\u5404\u4e2ashard\u4e0a\u7684chunk\u6570\u91cf\u4f1a\u4e0d\u5e73\u8861\uff0cmongos\u4e2d\u7684\u4e00\u4e2a\u7ec4\u4ef6balancer\u5c31\u4f1a\u6267\u884c\u81ea\u52a8\u5e73\u8861,\u628achunk\u4ecechunk\u6570\u91cf\u6700\u591a\u7684shard\u8282\u70b9\u632a\u52a8\u5230\u6570\u91cf\u6700\u5c11\u7684\u8282\u70b9 chunkSize \u5bf9\u5206\u88c2\u53ca\u8fc1\u79fb\u7684\u5f71\u54cd MongoDB \u9ed8\u8ba4\u7684 chunkSize \u4e3a64MB\uff0c\u5982\u65e0\u7279\u6b8a\u9700\u6c42\uff0c\u5efa\u8bae\u4fdd\u6301\u9ed8\u8ba4\u503c\uff1bchunkSize \u4f1a\u76f4\u63a5\u5f71\u54cd\u5230 chunk \u5206\u88c2\u3001\u8fc1\u79fb\u7684\u884c\u4e3a\u3002 chunkSize \u8d8a\u5c0f\uff0cchunk \u5206\u88c2\u53ca\u8fc1\u79fb\u8d8a\u591a\uff0c\u6570\u636e\u5206\u5e03\u8d8a\u5747\u8861\uff1b\u53cd\u4e4b\uff0cchunkSize \u8d8a\u5927\uff0cchunk \u5206\u88c2\u53ca\u8fc1\u79fb\u4f1a\u66f4\u5c11\uff0c\u4f46\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u5206\u5e03\u4e0d\u5747\u3002 chunkSize \u592a\u5c0f\uff0c\u5bb9\u6613\u51fa\u73b0 jumbo chunk\uff08\u5373shardKey \u7684\u67d0\u4e2a\u53d6\u503c\u51fa\u73b0\u9891\u7387\u5f88\u9ad8\uff0c\u8fd9\u4e9b\u6587\u6863\u53ea\u80fd\u653e\u5230\u4e00\u4e2a chunk \u91cc\uff0c\u65e0\u6cd5\u518d\u5206\u88c2\uff09\u800c\u65e0\u6cd5\u8fc1\u79fb\uff1bchunkSize \u8d8a\u5927\uff0c\u5219\u53ef\u80fd\u51fa\u73b0 chunk \u5185\u6587\u6863\u6570\u592a\u591a\uff08chunk \u5185\u6587\u6863\u6570\u4e0d\u80fd\u8d85\u8fc7 250000 \uff09\u800c\u65e0\u6cd5\u8fc1\u79fb\u3002 chunk \u81ea\u52a8\u5206\u88c2\u53ea\u4f1a\u5728\u6570\u636e\u5199\u5165\u65f6\u89e6\u53d1\uff0c\u6240\u4ee5\u5982\u679c\u5c06 chunkSize \u6539\u5c0f\uff0c\u7cfb\u7edf\u9700\u8981\u4e00\u5b9a\u7684\u65f6\u95f4\u6765\u5c06 chunk \u5206\u88c2\u5230\u6307\u5b9a\u7684\u5927\u5c0f\u3002 chunk \u53ea\u4f1a\u5206\u88c2\uff0c\u4e0d\u4f1a\u5408\u5e76\uff0c\u6240\u4ee5\u5373\u4f7f\u5c06 chunkSize \u6539\u5927\uff0c\u73b0\u6709\u7684 chunk \u6570\u91cf\u4e0d\u4f1a\u51cf\u5c11\uff0c\u4f46 chunk \u5927\u5c0f\u4f1a\u968f\u7740\u5199\u5165\u4e0d\u65ad\u589e\u957f\uff0c\u76f4\u5230\u8fbe\u5230\u76ee\u6807\u5927\u5c0f\u3002 1.5 \u5206\u7247\u952eshard key \u00b6 MongoDB\u4e2d\u6570\u636e\u7684\u5206\u7247\u662f\u3001\u4ee5\u96c6\u5408\u4e3a\u57fa\u672c\u5355\u4f4d\u7684\uff0c\u96c6\u5408\u4e2d\u7684\u6570\u636e\u901a\u8fc7\u7247\u952e\uff08Shard key\uff09\u88ab\u5206\u6210\u591a\u90e8\u5206\u3002\u5176\u5b9e\u7247\u952e\u5c31\u662f\u5728\u96c6\u5408\u4e2d\u9009\u4e00\u4e2a\u952e\uff0c\u7528\u8be5\u952e\u7684\u503c\u4f5c\u4e3a\u6570\u636e\u62c6\u5206\u7684\u4f9d\u636e\u3002\u6240\u4ee5\u4e00\u4e2a\u597d\u7684\u7247\u952e\u5bf9\u5206\u7247\u81f3\u5173\u91cd\u8981\u3002\u7247\u952e\u5fc5\u987b\u662f\u4e00\u4e2a\u7d22\u5f15\uff0c\u901a\u8fc7sh.shardCollection\u52a0\u4f1a\u81ea\u52a8\u521b\u5efa\u7d22\u5f15\uff08\u524d\u63d0\u662f\u6b64\u96c6\u5408\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\uff09\u3002\u4e00\u4e2a\u81ea\u589e\u7684\u7247\u952e\u5bf9\u5199\u5165\u548c\u6570\u636e\u5747\u5300\u5206\u5e03\u5c31\u4e0d\u662f\u5f88\u597d\uff0c\u56e0\u4e3a\u81ea\u589e\u7684\u7247\u952e\u603b\u4f1a\u5728\u4e00\u4e2a\u5206\u7247\u4e0a\u5199\u5165\uff0c\u540e\u7eed\u8fbe\u5230\u67d0\u4e2a\u9600\u503c\u53ef\u80fd\u4f1a\u5199\u5230\u522b\u7684\u5206\u7247\u3002\u4f46\u662f\u6309\u7167\u7247\u952e\u67e5\u8be2\u4f1a\u975e\u5e38\u9ad8\u6548\u3002 \u968f\u673a\u7247\u952e\u5bf9\u6570\u636e\u7684\u5747\u5300\u5206\u5e03\u6548\u679c\u5f88\u597d\u3002\u6ce8\u610f\u5c3d\u91cf\u907f\u514d\u5728\u591a\u4e2a\u5206\u7247\u4e0a\u8fdb\u884c\u67e5\u8be2\u3002\u5728\u6240\u6709\u5206\u7247\u4e0a\u67e5\u8be2\uff0cmongos\u4f1a\u5bf9\u7ed3\u679c\u8fdb\u884c\u5f52\u5e76\u6392\u5e8f\u3002 \u5bf9\u96c6\u5408\u8fdb\u884c\u5206\u7247\u65f6\uff0c\u4f60\u9700\u8981\u9009\u62e9\u4e00\u4e2a\u7247\u952e\uff0c\u7247\u952e\u662f\u6bcf\u6761\u8bb0\u5f55\u90fd\u5fc5\u987b\u5305\u542b\u7684\uff0c\u4e14\u5efa\u7acb\u4e86\u7d22\u5f15\u7684\u5355\u4e2a\u5b57\u6bb5\u6216\u590d\u5408\u5b57\u6bb5\uff0cMongoDB\u6309\u7167\u7247\u952e\u5c06\u6570\u636e\u5212\u5206\u5230\u4e0d\u540c\u7684\u6570\u636e\u5757\u4e2d\uff0c\u5e76\u5c06\u6570\u636e\u5757\u5747\u8861\u5730\u5206\u5e03\u5230\u6240\u6709\u5206\u7247\u4e2d\u3002 \u6ce8\u610f 1. \u5206\u7247\u952e\u662f\u4e0d\u53ef\u53d8\u3002 2. \u5206\u7247\u952e\u5fc5\u987b\u6709\u7d22\u5f15\u3002 3. \u5206\u7247\u952e\u5927\u5c0f\u9650\u5236 512 bytes \u3002 4. \u5206\u7247\u952e\u7528\u4e8e\u8def\u7531\u67e5\u8be2\u3002 5. MongoDB\u4e0d\u63a5\u53d7\u5df2\u8fdb\u884ccollection\u7ea7\u5206\u7247\u7684collection\u4e0a\u63d2\u5165\u65e0\u5206\u7247 6. \u952e\u7684\u6587\u6863\uff08\u4e5f\u4e0d\u652f\u6301\u7a7a\u503c\u63d2\u5165\uff09 1.6 \u6570\u636e\u5206\u5272 \u00b6 \u4ece\u524d\u6587\u77e5\u9053\uff0cMongoDB\u5728collection\u8fd9\u4e2a\u7ea7\u522b\u8fdb\u884c\u6570\u636e\u7684\u5207\u5757\uff0c\u79f0\u4e4b\u4e3asharding\u3002\u5757\u7684\u6700\u5c0f\u7c92\u5ea6\u662fchunk\uff0c\u5176\u5927\u5c0f\uff08chunkSize\uff09\u9ed8\u8ba4\u4e3a64M\u3002 \u5f53\u4e00\u4e2a\u96c6\u5408\u7684\u6570\u636e\u91cf\u8d85\u8fc7chunkSize\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u88ab\u62c6\u5206\u6210\u4e24\u4e2achunk\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3asplitting\u3002\u90a3\u4e48\u6309\u7167\u4ec0\u4e48\u539f\u5219\u5c06\u4e00\u4e2achunk\u4e0a\u7684\u6570\u636e\u62c6\u5206\u6210\u4e24\u4e2achunk\uff0c\u8fd9\u5c31\u662fSharding key\u7684\u4f5c\u7528\uff0cSharding key\u662f\u88ab\u7d22\u5f15\u7684\u5b57\u6bb5\uff0c\u901a\u8fc7sharding key\uff0c\u5c31\u53ef\u4ee5\u628a\u6570\u636e\u5747\u5206\u5230\u4e24\u4e2achunk\uff0c\u6bcf\u4e00\u4e2adocument\u5728\u54ea\u4e00\u4e2achunk\u4e0a\uff0c\u8fd9\u5c31\u662f\u5143\u6570\u636e\u4fe1\u606f\u3002\u5143\u6570\u636e\u4fe1\u606f\u5b58\u653e\u5728config server\u4e0a\uff0c\u65b9\u4fbfrouter\u4f7f\u7528\u3002 \u5982\u679csharding cluster\u4e2d\u6709\u591a\u4e2ashard\uff0c\u90a3\u4e48\u4e0d\u540cshard\u4e0a\u7684chunk\u6570\u76ee\u53ef\u80fd\u662f\u4e0d\u4e00\u81f4\u7684\uff0c\u8fd9\u4e2a\u65f6\u5019\u4f1a\u6709\u4e00\u4e2a\u540e\u53f0\u8fdb\u7a0b\uff08balancer\uff09\u6765\u8fc1\u79fb\uff08migrate\uff09chunk\uff0c\u4ecechunk\u6570\u76ee\u6700\u591a\u7684shard\u8fc1\u79fb\u5230chunk\u6570\u76ee\u6700\u5c11\u7684chunk\uff0c\u76f4\u5230\u8fbe\u5230\u5747\u8861\u7684\u72b6\u6001\u3002\u8fc1\u79fb\u7684\u8fc7\u7a0b\u5bf9\u5e94\u7528\u7a0b\u5e8f\u6765\u8bf4\u662f\u900f\u660e\u7684\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8fc1\u79fb\u4e4b\u524dShardA ShardB\u4e0a\u90fd\u67093\u4e2achunk\uff0c\u800cShard C\u4e0a\u53ea\u6709\u4e00\u4e2aChunk\u3002\u901a\u8fc7\u4eceShardB\u4e0a\u8fc1\u79fb\u4e00\u4e2achunk\u5230ShardC\uff0c\u5c31\u8fbe\u5230\u4e86\u4e00\u4e2a\u5747\u8861\u7684\u72b6\u6001\u3002 splitting\u548cmigration \u7684\u76ee\u7684\u662f\u4e3a\u4e86\u8ba9\u6570\u636e\u5728shards\u4e4b\u95f4\u5747\u5300\u5206\u5e03\uff0c\u5176\u6839\u672c\u76ee\u6807\u662f\u4e3a\u4e86\u5c06\u5bf9\u6570\u636e\u7684CRUD\u64cd\u4f5c\u5747\u8861\u5730\u5206\u53d1\u5230\u5404\u4e2ashard\uff0c\u63d0\u9ad8\u96c6\u7fa4\u7684\u5e76\u53d1\u6027\u80fd\u3002","title":"13. MonogoDB \u5206\u7247\u96c6"},{"location":"linux/nosql/mongo/mongo.shard_info/#1","text":"MongoDB\u7684\u53e6\u4e00\u4e2a\u96c6\u7fa4\u5c31\u662fsharding\u3002\u6240\u8c13sharding\u5c31\u662f\u5c06\u540c\u4e00\u4e2a\u96c6\u5408\u7684\u4e0d\u540c\u5b50\u96c6\u5206\u53d1\u5b58\u50a8\u5230\u4e0d\u540c\u7684\u673a\u5668\uff08shard\uff09\u4e0a\uff0cMongodb\u4f7f\u7528sharding\u673a\u5236\u6765\u652f\u6301\u8d85\u5927\u6570\u636e\u91cf\uff0c\u5c06\u4e0d\u540c\u7684CRUD\u8def\u7531\u5230\u4e0d\u540c\u7684\u673a\u5668\u4e0a\u6267\u884c\uff0c\u63d0\u5230\u4e86\u6570\u636e\u5e93\u7684\u541e\u5410\u6027\u80fd\u3002\u7531\u6b64\u53ef\u89c1\uff0csharding\u662f\u975e\u5e38\u5e38\u89c1\u7684scale out\u65b9\u6cd5\u3002 \u5982\u4e0a\u56fe\u6240\u793a\uff0c\u4e00\u4e2a\u96c6\u5408\uff08Collection1\uff09\u67091T\u7684\u6570\u636e\uff0c\u539f\u672c\u653e\u5728\u4e00\u4e2a\u5355\u72ec\u7684\u6570\u636e\u5e93\u4e2d\uff0c\u901a\u8fc7sharding\uff0c\u5c06\u8fd9\u4e2a\u96c6\u5408\u7684\u6570\u636e\u653e\u5728\u56db\u4e2a\u72ec\u7acb\u7684shard\u4e2d\uff0c\u6bcf\u4e00\u4e2ashard\u5b58\u50a8\u8fd9\u4e2a\u96c6\u5408256G\u7684\u6570\u636e\u3002\u6bcf\u4e2ashard\u7269\u7406\u4e0a\u662f\u72ec\u7acb\u7684\u6570\u636e\u5e93\uff0c\u4f46\u903b\u8f91\u4e0a\u5171\u540c\u7ec4\u6210\u4e00\u4e2a\u6570\u636e\u5e93\u3002 \u4e00\u4e2asharded cluster\u7531\u4e00\u4e0b\u4e09\u90e8\u5206\u7ec4\u6210\uff1aconfig server\uff0cshards\uff0crouter\u3002\u5982\u56fe\u6240\u793a\uff1a","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/mongo/mongo.shard_info/#11","text":"","title":"1.1 \u89d2\u8272\u5212\u5206"},{"location":"linux/nosql/mongo/mongo.shard_info/#111-shards","text":"\u5b58\u50a8\u6570\u636e\uff0c\u53ef\u4ee5\u662f\u5355\u4e2a\u7684mongod\uff0c\u4e5f\u53ef\u4ee5\u662freplica set\u3002\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u4e3a\u4e86\u63d0\u9ad8\u9ad8\u53ef\u7528\u6027\uff0c\u90fd\u4f1a\u4f7f\u7528replica set\u3002\u5b58\u50a8\u5728mongod\u4e0a\u7684\u6570\u636e\u4ee5chunk\u4e3a\u57fa\u672c\u5355\u4f4d\uff0c\u9ed8\u8ba4\u7684\u5927\u5c0f\u4e3a64M\uff0c\u540e\u9762\u4f1a\u4ecb\u7ecdshard\u4e0a\u6570\u636e\u7684\u5206\u88c2\uff08split\uff09\u4e0e\u8fc1\u79fb\uff08migration\uff09,\u4e00\u53f0\u673a\u5668\u7684\u4e00\u4e2a\u6570\u636e\u8868 Collection1 \u5b58\u50a8\u4e86 1T \u6570\u636e\uff0c\u538b\u529b\u592a\u5927\u4e86\uff01\u5728\u5206\u7ed94\u4e2a\u673a\u5668\u540e\uff0c\u6bcf\u4e2a\u673a\u5668\u90fd\u662f256G\uff0c\u5219\u5206\u644a\u4e86\u96c6\u4e2d\u5728\u4e00\u53f0\u673a\u5668\u7684\u538b\u529b\u3002\u4e5f\u8bb8\u6709\u4eba\u95ee\u4e00\u53f0\u673a\u5668\u786c\u76d8\u52a0\u5927\u4e00\u70b9\u4e0d\u5c31\u53ef\u4ee5\u4e86\uff0c\u4e3a\u4ec0\u4e48\u8981\u5206\u7ed9\u56db\u53f0\u673a\u5668\u5462\uff1f\u4e0d\u8981\u5149\u60f3\u5230\u5b58\u50a8\u7a7a\u95f4\uff0c\u5b9e\u9645\u8fd0\u884c\u7684\u6570\u636e\u5e93\u8fd8\u6709\u786c\u76d8\u7684\u8bfb\u5199\u3001\u7f51\u7edc\u7684IO\u3001CPU\u548c\u5185\u5b58\u7684\u74f6\u9888\u3002\u5728mongodb\u96c6\u7fa4\u53ea\u8981\u8bbe\u7f6e\u597d\u4e86\u5206\u7247\u89c4\u5219\uff0c\u901a\u8fc7mongos\u64cd\u4f5c\u6570\u636e\u5e93\u5c31\u80fd\u81ea\u52a8\u628a\u5bf9\u5e94\u7684\u6570\u636e\u64cd\u4f5c\u8bf7\u6c42\u8f6c\u53d1\u5230\u5bf9\u5e94\u7684\u5206\u7247\u673a\u5668\u4e0a\u3002\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5206\u7247\u7684\u7247\u952e\u53ef\u8981\u597d\u597d\u8bbe\u7f6e\uff0c\u8fd9\u4e2a\u5f71\u54cd\u5230\u4e86\u600e\u4e48\u628a\u6570\u636e\u5747\u5300\u5206\u5230\u591a\u4e2a\u5206\u7247\u673a\u5668\u4e0a\uff0c\u4e0d\u8981\u51fa\u73b0\u5176\u4e2d\u4e00\u53f0\u673a\u5668\u5206\u4e861T\uff0c\u5176\u4ed6\u673a\u5668\u6ca1\u6709\u5206\u5230\u7684\u60c5\u51b5\uff0c\u8fd9\u6837\u8fd8\u4e0d\u5982\u4e0d\u5206\u7247\uff01","title":"1.1.1 \u6570\u636e\u5206\u7247[shards]"},{"location":"linux/nosql/mongo/mongo.shard_info/#112-configserver","text":"\u987e\u540d\u601d\u4e49\u4e3a\u914d\u7f6e\u670d\u52a1\u5668\uff0c\u5b58\u50a8\u6240\u6709\u6570\u636e\u5e93\u5143\u4fe1\u606f\uff08\u8def\u7531\u3001\u5206\u7247\uff09\u7684\u914d\u7f6e\u3002mongos\u672c\u8eab\u6ca1\u6709\u7269\u7406\u5b58\u50a8\u5206\u7247\u670d\u52a1\u5668\u548c\u6570\u636e\u8def\u7531\u4fe1\u606f\uff0c\u53ea\u662f\u7f13\u5b58\u5728\u5185\u5b58\u91cc\uff0c\u914d\u7f6e\u670d\u52a1\u5668\u5219\u5b9e\u9645\u5b58\u50a8\u8fd9\u4e9b\u6570\u636e\u3002mongos\u7b2c\u4e00\u6b21\u542f\u52a8\u6216\u8005\u5173\u6389\u91cd\u542f\u5c31\u4f1a\u4ece config server \u52a0\u8f7d\u914d\u7f6e\u4fe1\u606f\uff0c\u4ee5\u540e\u5982\u679c\u914d\u7f6e\u670d\u52a1\u5668\u4fe1\u606f\u53d8\u5316\u4f1a\u901a\u77e5\u5230\u6240\u6709\u7684 mongos \u66f4\u65b0\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u8fd9\u6837 mongos \u5c31\u80fd\u7ee7\u7eed\u51c6\u786e\u8def\u7531\u3002\u5728\u751f\u4ea7\u73af\u5883\u901a\u5e38\u6709\u591a\u4e2a config server \u914d\u7f6e\u670d\u52a1\u5668\uff0c\u56e0\u4e3a\u5b83\u5b58\u50a8\u4e86\u5206\u7247\u8def\u7531\u7684\u5143\u6570\u636e\uff0c\u8fd9\u4e2a\u53ef\u4e0d\u80fd\u4e22\u5931\uff01\u5c31\u7b97\u6302\u6389\u5176\u4e2d\u4e00\u53f0\uff0c\u53ea\u8981\u8fd8\u6709\u5b58\u8d27\uff0c mongodb\u96c6\u7fa4\u5c31\u4e0d\u4f1a\u6302\u6389\u3002\u5b58\u50a8\u96c6\u7fa4\u7684\u5143\u6570\u636e\uff08metadata\uff09\uff0c\u5373\u6570\u636e\u7684\u54ea\u4e00\u90e8\u5206\u653e\u5728\u54ea\u4e00\u4e2ashard\u4e0a\uff0crouter\u5c06\u4f1a\u5229\u7528\u8fd9\u4e9b\u5143\u6570\u636e\u5c06\u8bf7\u6c42\u5206\u53d1\u5230\u5bf9\u5e94\u7684shards\u4e0a\uff0cshards\u4e0achunk\u7684\u8fc1\u79fb\u4e5f\u662fconfig server\u6765\u63a7\u5236\u7684\u3002","title":"1.1.2 \u914d\u7f6e\u670d\u52a1\u5668[configserver]"},{"location":"linux/nosql/mongo/mongo.shard_info/#113-routermongos","text":"mongos\u5b9e\u4f8b\uff0c\u5728\u4e00\u4e2a\u96c6\u7fa4\u4e2d\u76f4\u63a5\u4e3a\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u670d\u52a1\uff0c\u5229\u7528config server\u4e0a\u7684\u5143\u6570\u636e\u6765\u5236\u5b9a\u6700\u4f73\u7684\u67e5\u8be2\u8ba1\u5212\u3002\u6570\u636e\u8def\u7531,\u548c\u5ba2\u6237\u7aef\u6253\u4ea4\u9053\u7684\u6a21\u5757,mongos\u81ea\u8eab\u6ca1\u6709\u4efb\u4f55\u6570\u636e,\u4e5f\u4e0d\u77e5\u9053\u8be5\u5982\u4f55\u5904\u7406\u6570\u636e,\u8fd9\u4e9b\u90fd\u9700\u8981config-server\u6765\u544a\u8bc9\u4ed6\u3002","title":"1.1.3 \u67e5\u8be2\u8def\u7531router[mongos]"},{"location":"linux/nosql/mongo/mongo.shard_info/#12","text":"\u5f53\u6570\u636e\u5199\u5165\u65f6,MongoDB Cluster\u6839\u636e\u5206\u7247\u952e\u8bbe\u8ba1\u5199\u5165\u6570\u636e \u5f53\u5916\u90e8\u8bed\u53e5\u53d1\u8d77\u6570\u636e\u67e5\u8be2\u65f6,MongoDB\u6839\u636e\u6570\u636e\u5206\u5e03\u81ea\u52a8\u8def\u7531\u81f3\u6307\u5b9a\u8282\u70b9\u8fd4\u56de\u6570\u636e","title":"1.2 \u8def\u7531"},{"location":"linux/nosql/mongo/mongo.shard_info/#13","text":"","title":"1.3 \u96c6\u7fa4\u4e2d\u6570\u636e\u7684\u5206\u5e03"},{"location":"linux/nosql/mongo/mongo.shard_info/#131-chunk","text":"\u5728\u4e00\u4e2ashard-server\u5185\u90e8,MongoDB\u8fd8\u662f\u4f1a\u628a\u6570\u636e\u5206\u4e3achunks,\u6bcf\u4e2achunk\u4ee3\u8868\u8fd9\u4e2ashard-server\u5185\u90e8\u4e00\u5206\u90e8\u6570\u636e,chunk\u7684\u4ea7\u751f,\u4f1a\u6709\u4ee5\u4e0b\u4e24\u4e2a\u7528\u9014: Splitting \u5f53\u4e00\u4e2achunk\u7684\u5927\u5c0f\u8d85\u8fc7\u914d\u7f6e\u4e2d\u7684chunk size\u65f6,MongoDB\u7684\u540e\u53f0\u8fdb\u7a0b\u4f1a\u628a\u8fd9\u4e2achunk\u5207\u5206\u6210\u66f4\u5c0f\u7684chunk,\u4ece\u800c\u907f\u514dchunk\u8fc7\u5927\u7684\u60c5\u51b5 Balancing \u5f53MongoDB\u4e2d,balance\u662f\u4e00\u4e2a\u540e\u53f0\u8fdb\u7a0b,\u8d1f\u8d23chunk\u7684\u8fc1\u79fb,\u4ece\u800c\u5747\u8861\u5404\u4e2ashard-server\u8d1f\u8f7d,\u7cfb\u7edf\u521d\u8bc61\u4e2achunk,chunk size\u9ed8\u8ba4\u503c\u662f64M,\u751f\u4ea7\u5e93\u4e0a\u9009\u62e9\u9002\u5408\u4e1a\u52a1\u7684chunk size\u662f\u6700\u597d\u7684,MongoDB\u4f1a\u81ea\u52a8\u62c6\u5206\u548c\u8fc1\u79fbchunks","title":"1.3.1 Chunk"},{"location":"linux/nosql/mongo/mongo.shard_info/#132-shard","text":"\u4f7f\u7528chunk\u6765\u5b58\u50a8\u6570\u636e \u8fdb\u7a0b\u642d\u5efa\u5b8c\u6210\u4e4b\u540e,\u9ed8\u8ba4\u5f00\u542f\u4e00\u4e2achunk,\u5927\u5c0f\u662f64M \u5b58\u50a8\u9700\u6c42\u8d85\u8fc764M,chunk\u4f1a\u8fdb\u884c\u5206\u5217,\u5982\u679c\u5355\u4f4d\u65f6\u95f4\u5b58\u50a8\u9700\u6c42\u5f88\u5927,\u8bbe\u7f6e\u66f4\u5927\u7684chunk chunk\u4f1a\u81ea\u52a8\u5747\u8861\u8fc1\u79fb","title":"1.3.2 shard\u8282\u70b9"},{"location":"linux/nosql/mongo/mongo.shard_info/#14-chunk-size","text":"\u9002\u5408\u4e1a\u52a1\u7684chunk size\u662f\u6700\u597d\u7684\uff0cchunk\u7684\u5206\u88c2\u548c\u8fc1\u79fb\u975e\u5e38\u6d88\u8017IO\u8d44\u6e90,chunk\u5206\u88c2\u7684\u65f6\u673a:\u5728\u63d2\u5165\u548c\u66f4\u65b0,\u8bfb\u6570\u636e\u4e0d\u4f1a\u5206\u88c2","title":"1.4 chunk size"},{"location":"linux/nosql/mongo/mongo.shard_info/#141-chunk-size","text":"\u5c0f\u7684chunk size : \u6570\u636e\u5747\u8861\u65f6\u8fc1\u79fb\u5feb,\u6570\u636e\u5206\u5e03\u66f4\u52a0\u5747\u5300,\u6570\u636e\u5206\u88c2\u9891\u7e41,\u8def\u7531\u8282\u70b9\u6d88\u8017\u66f4\u591a\u8d44\u6e90 \u5927\u7684chunk size : \u6570\u636e\u5206\u88c2\u5c11,\u6570\u636e\u5757\u79fb\u52a8\u96c6\u4e2d\u6d88\u8017IO\u8d44\u6e90,\u901a\u5e38100-200M","title":"1.4.1 chunk size\u9009\u62e9"},{"location":"linux/nosql/mongo/mongo.shard_info/#142-chunk","text":"\u968f\u7740\u6570\u636e\u7684\u589e\u957f,\u5176\u4e2d\u7684\u6570\u636e\u5927\u5c0f\u8d85\u8fc7\u4e86\u914d\u5408\u7684chunk size,\u9ed8\u8ba4\u503c\u65f664M,\u5219\u8fd9\u4e2achunk\u5206\u88c2\u6210\u4e24\u4e2a,\u6570\u636e\u7684\u589e\u957f\u4f1a\u8ba9chunk\u5206\u88c2\u7684\u8d8a\u6765\u8d8a\u591a \u8fd9\u65f6\u5019,\u5404\u4e2ashard\u4e0a\u7684chunk\u6570\u91cf\u4f1a\u4e0d\u5e73\u8861\uff0cmongos\u4e2d\u7684\u4e00\u4e2a\u7ec4\u4ef6balancer\u5c31\u4f1a\u6267\u884c\u81ea\u52a8\u5e73\u8861,\u628achunk\u4ecechunk\u6570\u91cf\u6700\u591a\u7684shard\u8282\u70b9\u632a\u52a8\u5230\u6570\u91cf\u6700\u5c11\u7684\u8282\u70b9 chunkSize \u5bf9\u5206\u88c2\u53ca\u8fc1\u79fb\u7684\u5f71\u54cd MongoDB \u9ed8\u8ba4\u7684 chunkSize \u4e3a64MB\uff0c\u5982\u65e0\u7279\u6b8a\u9700\u6c42\uff0c\u5efa\u8bae\u4fdd\u6301\u9ed8\u8ba4\u503c\uff1bchunkSize \u4f1a\u76f4\u63a5\u5f71\u54cd\u5230 chunk \u5206\u88c2\u3001\u8fc1\u79fb\u7684\u884c\u4e3a\u3002 chunkSize \u8d8a\u5c0f\uff0cchunk \u5206\u88c2\u53ca\u8fc1\u79fb\u8d8a\u591a\uff0c\u6570\u636e\u5206\u5e03\u8d8a\u5747\u8861\uff1b\u53cd\u4e4b\uff0cchunkSize \u8d8a\u5927\uff0cchunk \u5206\u88c2\u53ca\u8fc1\u79fb\u4f1a\u66f4\u5c11\uff0c\u4f46\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u5206\u5e03\u4e0d\u5747\u3002 chunkSize \u592a\u5c0f\uff0c\u5bb9\u6613\u51fa\u73b0 jumbo chunk\uff08\u5373shardKey \u7684\u67d0\u4e2a\u53d6\u503c\u51fa\u73b0\u9891\u7387\u5f88\u9ad8\uff0c\u8fd9\u4e9b\u6587\u6863\u53ea\u80fd\u653e\u5230\u4e00\u4e2a chunk \u91cc\uff0c\u65e0\u6cd5\u518d\u5206\u88c2\uff09\u800c\u65e0\u6cd5\u8fc1\u79fb\uff1bchunkSize \u8d8a\u5927\uff0c\u5219\u53ef\u80fd\u51fa\u73b0 chunk \u5185\u6587\u6863\u6570\u592a\u591a\uff08chunk \u5185\u6587\u6863\u6570\u4e0d\u80fd\u8d85\u8fc7 250000 \uff09\u800c\u65e0\u6cd5\u8fc1\u79fb\u3002 chunk \u81ea\u52a8\u5206\u88c2\u53ea\u4f1a\u5728\u6570\u636e\u5199\u5165\u65f6\u89e6\u53d1\uff0c\u6240\u4ee5\u5982\u679c\u5c06 chunkSize \u6539\u5c0f\uff0c\u7cfb\u7edf\u9700\u8981\u4e00\u5b9a\u7684\u65f6\u95f4\u6765\u5c06 chunk \u5206\u88c2\u5230\u6307\u5b9a\u7684\u5927\u5c0f\u3002 chunk \u53ea\u4f1a\u5206\u88c2\uff0c\u4e0d\u4f1a\u5408\u5e76\uff0c\u6240\u4ee5\u5373\u4f7f\u5c06 chunkSize \u6539\u5927\uff0c\u73b0\u6709\u7684 chunk \u6570\u91cf\u4e0d\u4f1a\u51cf\u5c11\uff0c\u4f46 chunk \u5927\u5c0f\u4f1a\u968f\u7740\u5199\u5165\u4e0d\u65ad\u589e\u957f\uff0c\u76f4\u5230\u8fbe\u5230\u76ee\u6807\u5927\u5c0f\u3002","title":"1.4.2 chunk\u5206\u88c2\u548c\u8fc1\u79fb"},{"location":"linux/nosql/mongo/mongo.shard_info/#15-shard-key","text":"MongoDB\u4e2d\u6570\u636e\u7684\u5206\u7247\u662f\u3001\u4ee5\u96c6\u5408\u4e3a\u57fa\u672c\u5355\u4f4d\u7684\uff0c\u96c6\u5408\u4e2d\u7684\u6570\u636e\u901a\u8fc7\u7247\u952e\uff08Shard key\uff09\u88ab\u5206\u6210\u591a\u90e8\u5206\u3002\u5176\u5b9e\u7247\u952e\u5c31\u662f\u5728\u96c6\u5408\u4e2d\u9009\u4e00\u4e2a\u952e\uff0c\u7528\u8be5\u952e\u7684\u503c\u4f5c\u4e3a\u6570\u636e\u62c6\u5206\u7684\u4f9d\u636e\u3002\u6240\u4ee5\u4e00\u4e2a\u597d\u7684\u7247\u952e\u5bf9\u5206\u7247\u81f3\u5173\u91cd\u8981\u3002\u7247\u952e\u5fc5\u987b\u662f\u4e00\u4e2a\u7d22\u5f15\uff0c\u901a\u8fc7sh.shardCollection\u52a0\u4f1a\u81ea\u52a8\u521b\u5efa\u7d22\u5f15\uff08\u524d\u63d0\u662f\u6b64\u96c6\u5408\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\uff09\u3002\u4e00\u4e2a\u81ea\u589e\u7684\u7247\u952e\u5bf9\u5199\u5165\u548c\u6570\u636e\u5747\u5300\u5206\u5e03\u5c31\u4e0d\u662f\u5f88\u597d\uff0c\u56e0\u4e3a\u81ea\u589e\u7684\u7247\u952e\u603b\u4f1a\u5728\u4e00\u4e2a\u5206\u7247\u4e0a\u5199\u5165\uff0c\u540e\u7eed\u8fbe\u5230\u67d0\u4e2a\u9600\u503c\u53ef\u80fd\u4f1a\u5199\u5230\u522b\u7684\u5206\u7247\u3002\u4f46\u662f\u6309\u7167\u7247\u952e\u67e5\u8be2\u4f1a\u975e\u5e38\u9ad8\u6548\u3002 \u968f\u673a\u7247\u952e\u5bf9\u6570\u636e\u7684\u5747\u5300\u5206\u5e03\u6548\u679c\u5f88\u597d\u3002\u6ce8\u610f\u5c3d\u91cf\u907f\u514d\u5728\u591a\u4e2a\u5206\u7247\u4e0a\u8fdb\u884c\u67e5\u8be2\u3002\u5728\u6240\u6709\u5206\u7247\u4e0a\u67e5\u8be2\uff0cmongos\u4f1a\u5bf9\u7ed3\u679c\u8fdb\u884c\u5f52\u5e76\u6392\u5e8f\u3002 \u5bf9\u96c6\u5408\u8fdb\u884c\u5206\u7247\u65f6\uff0c\u4f60\u9700\u8981\u9009\u62e9\u4e00\u4e2a\u7247\u952e\uff0c\u7247\u952e\u662f\u6bcf\u6761\u8bb0\u5f55\u90fd\u5fc5\u987b\u5305\u542b\u7684\uff0c\u4e14\u5efa\u7acb\u4e86\u7d22\u5f15\u7684\u5355\u4e2a\u5b57\u6bb5\u6216\u590d\u5408\u5b57\u6bb5\uff0cMongoDB\u6309\u7167\u7247\u952e\u5c06\u6570\u636e\u5212\u5206\u5230\u4e0d\u540c\u7684\u6570\u636e\u5757\u4e2d\uff0c\u5e76\u5c06\u6570\u636e\u5757\u5747\u8861\u5730\u5206\u5e03\u5230\u6240\u6709\u5206\u7247\u4e2d\u3002 \u6ce8\u610f 1. \u5206\u7247\u952e\u662f\u4e0d\u53ef\u53d8\u3002 2. \u5206\u7247\u952e\u5fc5\u987b\u6709\u7d22\u5f15\u3002 3. \u5206\u7247\u952e\u5927\u5c0f\u9650\u5236 512 bytes \u3002 4. \u5206\u7247\u952e\u7528\u4e8e\u8def\u7531\u67e5\u8be2\u3002 5. MongoDB\u4e0d\u63a5\u53d7\u5df2\u8fdb\u884ccollection\u7ea7\u5206\u7247\u7684collection\u4e0a\u63d2\u5165\u65e0\u5206\u7247 6. \u952e\u7684\u6587\u6863\uff08\u4e5f\u4e0d\u652f\u6301\u7a7a\u503c\u63d2\u5165\uff09","title":"1.5 \u5206\u7247\u952eshard key"},{"location":"linux/nosql/mongo/mongo.shard_info/#16","text":"\u4ece\u524d\u6587\u77e5\u9053\uff0cMongoDB\u5728collection\u8fd9\u4e2a\u7ea7\u522b\u8fdb\u884c\u6570\u636e\u7684\u5207\u5757\uff0c\u79f0\u4e4b\u4e3asharding\u3002\u5757\u7684\u6700\u5c0f\u7c92\u5ea6\u662fchunk\uff0c\u5176\u5927\u5c0f\uff08chunkSize\uff09\u9ed8\u8ba4\u4e3a64M\u3002 \u5f53\u4e00\u4e2a\u96c6\u5408\u7684\u6570\u636e\u91cf\u8d85\u8fc7chunkSize\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u88ab\u62c6\u5206\u6210\u4e24\u4e2achunk\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3asplitting\u3002\u90a3\u4e48\u6309\u7167\u4ec0\u4e48\u539f\u5219\u5c06\u4e00\u4e2achunk\u4e0a\u7684\u6570\u636e\u62c6\u5206\u6210\u4e24\u4e2achunk\uff0c\u8fd9\u5c31\u662fSharding key\u7684\u4f5c\u7528\uff0cSharding key\u662f\u88ab\u7d22\u5f15\u7684\u5b57\u6bb5\uff0c\u901a\u8fc7sharding key\uff0c\u5c31\u53ef\u4ee5\u628a\u6570\u636e\u5747\u5206\u5230\u4e24\u4e2achunk\uff0c\u6bcf\u4e00\u4e2adocument\u5728\u54ea\u4e00\u4e2achunk\u4e0a\uff0c\u8fd9\u5c31\u662f\u5143\u6570\u636e\u4fe1\u606f\u3002\u5143\u6570\u636e\u4fe1\u606f\u5b58\u653e\u5728config server\u4e0a\uff0c\u65b9\u4fbfrouter\u4f7f\u7528\u3002 \u5982\u679csharding cluster\u4e2d\u6709\u591a\u4e2ashard\uff0c\u90a3\u4e48\u4e0d\u540cshard\u4e0a\u7684chunk\u6570\u76ee\u53ef\u80fd\u662f\u4e0d\u4e00\u81f4\u7684\uff0c\u8fd9\u4e2a\u65f6\u5019\u4f1a\u6709\u4e00\u4e2a\u540e\u53f0\u8fdb\u7a0b\uff08balancer\uff09\u6765\u8fc1\u79fb\uff08migrate\uff09chunk\uff0c\u4ecechunk\u6570\u76ee\u6700\u591a\u7684shard\u8fc1\u79fb\u5230chunk\u6570\u76ee\u6700\u5c11\u7684chunk\uff0c\u76f4\u5230\u8fbe\u5230\u5747\u8861\u7684\u72b6\u6001\u3002\u8fc1\u79fb\u7684\u8fc7\u7a0b\u5bf9\u5e94\u7528\u7a0b\u5e8f\u6765\u8bf4\u662f\u900f\u660e\u7684\u3002 \u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8fc1\u79fb\u4e4b\u524dShardA ShardB\u4e0a\u90fd\u67093\u4e2achunk\uff0c\u800cShard C\u4e0a\u53ea\u6709\u4e00\u4e2aChunk\u3002\u901a\u8fc7\u4eceShardB\u4e0a\u8fc1\u79fb\u4e00\u4e2achunk\u5230ShardC\uff0c\u5c31\u8fbe\u5230\u4e86\u4e00\u4e2a\u5747\u8861\u7684\u72b6\u6001\u3002 splitting\u548cmigration \u7684\u76ee\u7684\u662f\u4e3a\u4e86\u8ba9\u6570\u636e\u5728shards\u4e4b\u95f4\u5747\u5300\u5206\u5e03\uff0c\u5176\u6839\u672c\u76ee\u6807\u662f\u4e3a\u4e86\u5c06\u5bf9\u6570\u636e\u7684CRUD\u64cd\u4f5c\u5747\u8861\u5730\u5206\u53d1\u5230\u5404\u4e2ashard\uff0c\u63d0\u9ad8\u96c6\u7fa4\u7684\u5e76\u53d1\u6027\u80fd\u3002","title":"1.6 \u6570\u636e\u5206\u5272"},{"location":"linux/nosql/mongo/mongo.shard_replicat/","text":"\u590d\u5236\u96c6_\u5206\u7247\u96c6 1. sharded+replicat\u90e8\u7f72\u642d\u5efa \u00b6 \u4e00\u4e2a\u5178\u578b\u7684\u751f\u4ea7\u4e0a\u7684mongodb\u7684\u96c6\u5408\u662f\uff0c\u590d\u5236\u96c6\u5408\u7ed3\u548c\u5206\u7247\u96c6\uff0cSharded Cluster\u5305\u62ecrouter(mongos)\u3001config server\u548cshards\uff0c\u5176\u4e2d\u6bcf\u4e2ashard\u90fd\u53ef\u4ee5\u662f\u5355\u70b9(standalone)\u6216\u8005\u590d\u5236\u96c6(replica set\uff09\u3002\u63a5\u4e0b\u6765\u7684\u6f14\u793a\u5305\u62ec\u4e00\u4e2arouter\uff0c \u4e09\u4e2aconfig server\uff0c\u4e24\u4e2ashard\u3002\u6bcf\u4e00\u4e2ashard\u90fd\u662f\u6709\u4e00\u4e2aprimary\u3001\u4e00\u4e2asecondary\u548c\u4e00\u4e2aarbiter\u7ec4\u6210\u7684replica set\u3002 2. \u73af\u5883\u51c6\u5907 \u00b6 IP \u4e3b\u673a\u540d \u7cfb\u7edf \u5b89\u88c5\u8f6f\u4ef6 \u89d2\u8272 192.168.178.128 node3 ubuntu16 mongodb4.0.8 sharde31\uff0csharde32,sharde33\uff0cconfigure3,mongos3 192.168.178.129 node2 ubuntu16 mongodb4.0.8 sharde21\uff0csharde22,sharde23\uff0cconfigure2,mongos2 192.168.178.130 node1 ubuntu16 mongodb4.0.8 sharde11\uff0csharde12,sharde13\uff0cconfigure1,mongos1 \u8be6\u7ec6\u53c2\u6570 \u4e3b\u673a \u7aef\u53e3\u4fe1\u606f node1 mongo shard1 : 27018 ( replicat set1 ) mongo shard2 : 27019 ( replicat set2 ) mongo shard3 : 27020 ( replicat set3 ) mongo config : 20000 mongos : 27017 node2 mongo shard1 : 27018 ( replicat set1 ) mongo shard2 : 27019 ( replicat set2 ) mongo shard3 : 27020 ( replicat set3 ) mongo config : 20000 mongos : 27017 node3 mongo shard1 : 27018 ( replicat set1 ) mongo shard2 : 27019 ( replicat set2 ) mongo shard3 : 27020 ( replicat set3 ) mongo config : 20000 mongos : 27017 \u4e00\u5b9a\u8981\u8ba4\u771f\u770b\u5b8c\uff0c\u4ee5\u4e0b\u64cd\u4f5c\uff0c\u867d\u7136\u6709\u70b9\u70e6\u3002\u6211\u5c3d\u91cf\u5199\u7684\u975e\u5e38\u8be6\u7ec6\u3002 3. \u90e8\u7f72 \u00b6 \u4ee5\u4e0b\u811a\u672c\u8fd0\u884c\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa\u526f\u672c\u96c6\uff0cshard\u96c6\uff0cconfig server\uff0cmongo\u8fd9\u4e00\u6574\u5957\u96c6\u7fa4[\u770b\u811a\u672c\u5185\u5bb9\u914d\u7f6e]\u3002 \u524d\u63d0\u662f\u9700\u8981\u5b89\u88c5\u597dmongdb4.x \u5728\u8fd0\u884c\u4e0b\u9762\u8fd9\u4e2a\u811a\u672c\u3002 \u4e09\u53f0\u57fa\u672c\u90fd\u4f7f\u7528\u8fd9\u4e00\u4e2a\u811a\u672c \u811a\u672c # \u89d2\u8272 \u7aef\u53e3 # shard1 27018 # shard2 27019 # shard3 27020 # configsvr 20000 # mongos 27107 pkill mongo pkill mongo pkill mongo mkdir / app / mongo / services / { shard1 / db , shard2 / db , shard3 / db , configsvr / db , mongos } - p # 1. shard1\u7684\u914d\u7f6e\u6587\u4ef6 # shard1 mongod.conf cat >/ app / mongo / services / shard1 / mongod . conf << EOF storage : dbPath : / app / mongo / services / shard1 / db journal : enabled : true systemLog : destination : file logAppend : true path : / app / mongo / services / shard1 / mongod . log net : port : 27018 bindIp : 0.0 . 0.0 processManagement : fork : true pidFilePath : / app / mongo / services / shard1 / pid replication : replSetName : shard1 sharding : clusterRole : shardsvr EOF # 2. shard 2\u7684\u914d\u7f6e\u6587\u4ef6 # shard2 mongod.conf cat >/ app / mongo / services / shard2 / mongod . conf << EOF storage : dbPath : / app / mongo / services / shard2 / db journal : enabled : true systemLog : destination : file logAppend : true path : / app / mongo / services / shard2 / mongod . log net : port : 27019 bindIp : 0.0 . 0.0 processManagement : fork : true pidFilePath : / app / mongo / services / shard2 / pid replication : replSetName : shard2 sharding : clusterRole : shardsvr EOF # 3. shard 3\u7684\u914d\u7f6e\u6587\u4ef6 #shard2 mongod.conf cat >/ app / mongo / services / shard3 / mongod . conf << EOF storage : dbPath : / app / mongo / services / shard3 / db journal : enabled : true systemLog : destination : file logAppend : true path : / app / mongo / services / shard3 / mongod . log net : port : 27020 bindIp : 0.0 . 0.0 processManagement : fork : true pidFilePath : / app / mongo / services / shard3 / pid replication : replSetName : shard3 sharding : clusterRole : shardsvr EOF # 4. configsvr \u7684\u914d\u7f6e\u6587\u4ef6 cat >/ app / mongo / services / configsvr / cfg . conf << EOF #configsvr cfg.conf storage : dbPath : / app / mongo / services / configsvr / db journal : enabled : true systemLog : destination : file logAppend : true path : / app / mongo / services / configsvr / mongod . log net : port : 20000 bindIp : 0.0 . 0.0 processManagement : fork : true pidFilePath : / app / mongo / services / configsvr / pid replication : replSetName : cfg sharding : clusterRole : configsvr EOF #mongos mongos.conf cat >/ app / mongo / services / mongos / mongos . conf << EOF systemLog : destination : file logAppend : true path : / app / mongo / services / mongos / mongos . log net : port : 27017 bindIp : 0.0 . 0.0 processManagement : fork : true pidFilePath : / app / mongo / services / mongos / pid sharding : configDB : cfg / node1 : 20000 , node2 : 20000 , node3 : 20000 EOF # 2. start \u542f\u52a8\u670d\u52a1 mongod - f / app / mongo / services / shard1 / mongod . conf mongod - f / app / mongo / services / shard2 / mongod . conf mongod - f / app / mongo / services / shard3 / mongod . conf mongod - f / app / mongo / services / configsvr / cfg . conf # 3. check ps axf | grep - v grep | egrep 'mongod|configsvr' netstat - lnp | egrep '27018|27019|27020|20000' # 4. set replicat \u8bbe\u7f6e\u526f\u672c\u96c6 mongo -- port 27018 -- quiet << EOF rs . initiate ({ \"_id\" : \"shard1\" , \"members\" :[ { \"_id\" : 0 , \"host\" : \"node1:27018\" }, { \"_id\" : 1 , \"host\" : \"node2:27018\" }, { \"_id\" : 2 , \"host\" : \"node3:27018\" } ] }) EOF mongo -- port 27019 -- quiet << EOF rs . initiate ({ \"_id\" : \"shard2\" , \"members\" :[ { \"_id\" : 0 , \"host\" : \"node1:27019\" }, { \"_id\" : 1 , \"host\" : \"node2:27019\" }, { \"_id\" : 2 , \"host\" : \"node3:27019\" } ] }) EOF mongo -- port 27020 -- quiet << EOF rs . initiate ({ \"_id\" : \"shard3\" , \"members\" :[ { \"_id\" : 0 , \"host\" : \"node1:27020\" }, { \"_id\" : 1 , \"host\" : \"node2:27020\" }, { \"_id\" : 2 , \"host\" : \"node3:27020\" } ] }) EOF # 5. init replicat \u521d\u59cb\u5316\u526f\u672c\u96c6[\u544a\u8bc9configure server\u5b83\u7684\u526f\u672c\u96c6\u6709\u54ea\u4e9b] mongo -- port 20000 -- quiet << EOF rs . initiate ({ \"_id\" : \"cfg\" , \"members\" :[ { \"_id\" : 0 , \"host\" : \"node1:20000\" }, { \"_id\" : 1 , \"host\" : \"node2:20000\" }, { \"_id\" : 2 , \"host\" : \"node3:20000\" } ] }) EOF mongos - f / app / mongo / services / mongos / mongos . conf # 6. set shard # \u4e3amongo configsvr \u6dfb\u52a0shard\u8282\u70b9 mongo -- port 27017 -- quiet << EOF sh . addShard ( \"shard1/node1:27018,node2:27018,node3:27018\" ) sh . addShard ( \"shard2/node1:27019,node2:27019,node3:27019\" ) sh . addShard ( \"shard3/node1:27020,node2:27020,node3:27020\" ) sh . status () EOF # 7. check process ps axf | grep - v grep | grep \"mongo\" netstat - lnp | egrep '27018|27019|27020|20000' 4. \u6d4b\u8bd5 \u00b6 4.1 \u8fdb\u7a0b\u548c\u7aef\u53e3 \u00b6 \u5148\u68c0\u67e5\u4e0a\u9762\u811a\u672c\u7684\u8fd0\u884c\u60c5\u51b5\u662f\u5426\u6b63\u5e38\u3002 root@node1:~# ps axf|grep -v grep | grep \"mongo\" 11840 pts/0 Sl+ 0:00 | \\_ mongo --port 27018 12098 pts/1 Sl+ 1:28 | \\_ mongo 9867 ? Sl 3:28 mongod -f /app/mongo/services/shard1/mongod.conf 9899 ? Sl 3:03 mongod -f /app/mongo/services/shard2/mongod.conf 9931 ? Sl 7:16 mongod -f /app/mongo/services/shard3/mongod.conf 9963 ? Sl 2:12 mongod -f /app/mongo/services/configsvr/cfg.conf 10221 ? Sl 5:09 mongos -f /app/mongo/services/mongos/mongos.conf root@node1:~# netstat -lnp|egrep '27018|27019|27020|20000|27017' tcp 0 0 0.0.0.0:27017 0.0.0.0:* LISTEN 10221/mongos tcp 0 0 0.0.0.0:27018 0.0.0.0:* LISTEN 9867/mongod tcp 0 0 0.0.0.0:27019 0.0.0.0:* LISTEN 9899/mongod tcp 0 0 0.0.0.0:27020 0.0.0.0:* LISTEN 9931/mongod tcp 0 0 0.0.0.0:20000 0.0.0.0:* LISTEN 9963/mongod unix 2 [ ACC ] STREAM LISTENING 67939 9867/mongod /tmp/mongodb-27018.sock unix 2 [ ACC ] STREAM LISTENING 67941 9899/mongod /tmp/mongodb-27019.sock unix 2 [ ACC ] STREAM LISTENING 69099 9931/mongod /tmp/mongodb-27020.sock unix 2 [ ACC ] STREAM LISTENING 69101 9963/mongod /tmp/mongodb-20000.sock unix 2 [ ACC ] STREAM LISTENING 68122 10221/mongos /tmp/mongodb-27017.sock \u5fc5\u987b\u6709\u4ee5\u4e0a5\u4e2a\u8fdb\u7a0b\uff0c5\u4e2a\u7aef\u53e3\uff0c\u8fd9\u662fnode1\u4e0a\u7684\uff0c\u5176\u4ed6\u6240\u6709\u4e09\u53f0\u673a\u5668\u90fd\u662f\u8fd9\u6837\u3002 4.2 \u6d4b\u8bd5 \u00b6 \u6211\u4eec\u5f00\u59cb\u6d4b\u8bd5\u590d\u5236\u96c6\u548c\u5206\u7247\u96c6\uff0c\u6211\u4eec\u4f7f\u7528\u9884\u5148\u5206\u7247,\u624b\u52a8\u9884\u5148\u5206\u7247\u662f\u4e3a\u4e86\u9632\u6b62\u672a\u6765chunk\u7684\u79fb\u52a8\uff0c\u51cf\u5c11IO\u3002 # 8. \u5b9a\u4e49\u5206\u7247\u89c4\u5219\uff0c\u6dfb\u52a0\u5206\u7247\u7684\u5e93 # Field\u662fcollection\u7684\u4e00\u4e2a\u5b57\u6bb5\uff0c\u7cfb\u7edf\u5c06\u4f1a\u5229\u7528filed\u7684\u503c\u6765\u8ba1\u7b97\u5e94\u8be5\u5206\u7247\u5230\u54ea\u4e2a\u7247\u4e0a\uff0c # \u8fd9\u4e2afiled\u662f\u7247\u952e\uff0cshard key # \u4fee\u6539chunkserver # db.settings.save({'_id':'chunksize','value':1}); # db.settings.find() sh.enableSharding(\"caimengzhi\"); sh.shardCollection('caimengzhi.goods',{'goods_id':1}); for (var i=1;i<=30000;i++){ db.goods.insert({goods_id:i,good_name:'summer'}); } # 9. \u624b\u52a8\u9884\u5148\u5206\u7247 sh.shardCollection('caimengzhi.cmz',{'userid':1}); # \u5148\u5206\u5757,\u5148\u520640\u4e2a\u5757\uff0c\u9884\u5148\u57281K,2K,...40K\u8fd9\u6837\u7684\u754c\u9650\u5207\u597dchunk\uff08\u867d\u7136chunk\u8fd8\u662f\u7a7a\u7684\uff09 # \u4f46\u662fchunk\u4f1a\u5747\u5300\u7684\u79fb\u52a8\u5230\u5404\u7247\u4e0a for(var i=1;i<=40;i++){ sh.splitAt('caimengzhi.cmz',{userid:i*1000}) } # \u63d2\u5165\u6570\u636e for(var i=1;i<=10000;i++){ db.cmz.insert({userid:i,name:'cmz'+i}) } sh.shardCollection(\"caimengzhi.users\",{\"userId\": 1 }) for(var i=1; i<=30; i++){ sh.splitAt(\"caimengzhi.users\", {userId: i*1000}) } for(var i=1; i<30000; i++){ db.users.insert({userId: i,name: 'hello'}) } use shop; sh.enableSharding(\"shop\"); sh.shardCollection(\"shop.users\",{\"userId\": 1 }); for(var i=1; i<=30; i++){ sh.splitAt(\"shop.users\", {userId: i*1000}) }; for(var i=1; i<30000; i++){ db.users.insert({userId: i,name: 'cmz'})}; \u8be6\u7ec6\u8fc7\u7a0b root@node1:~# mongo --port 27017 --quiet mongos> show dbs; admin 0.000GB config 0.002GB mongos> use shop; switched to db shop mongos> sh.enableSharding(\"shop\"); { \"ok\" : 1, \"operationTime\" : Timestamp(1554373413, 6), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554373413, 6), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } \u67e5\u770b mongos> sh.status() --- Sharding Status --- sharding version: { \"_id\" : 1, \"minCompatibleVersion\" : 5, \"currentVersion\" : 6, \"clusterId\" : ObjectId(\"5ca5b83091d62b328099a7b5\") } shards: { \"_id\" : \"shard1\", \"host\" : \"shard1/node1:27018,node2:27018,node3:27018\", \"state\" : 1 } { \"_id\" : \"shard2\", \"host\" : \"shard2/node1:27019,node2:27019,node3:27019\", \"state\" : 1 } { \"_id\" : \"shard3\", \"host\" : \"shard3/node1:27020,node2:27020,node3:27020\", \"state\" : 1 } active mongoses: \"4.0.8\" : 3 autosplit: Currently enabled: yes balancer: Currently enabled: yes Currently running: no Failed balancer rounds in last 5 attempts: 0 Migration Results for the last 24 hours: 172 : Success databases: { \"_id\" : \"config\", \"primary\" : \"config\", \"partitioned\" : true } config.system.sessions shard key: { \"_id\" : 1 } unique: false balancing: true chunks: shard1 1 { \"_id\" : { \"$minKey\" : 1 } } -->> { \"_id\" : { \"$maxKey\" : 1 } } on : shard1 Timestamp(1, 0) { \"_id\" : \"shop\", \"primary\" : \"shard2\", \"partitioned\" : true, \"version\" : { \"uuid\" : UUID(\"69b0fc8c-4332-489c-bf20-5a2e6ae774a7\"), \"lastMod\" : 1 } } \u4ece\u4e0a\u9762\u53ef\u4ee5\u770b\u51fa\u6570\u636e\u9ed8\u8ba4\u662f\u5728shard1\u4e0a\u7684\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u8bbe\u7f6eshop\u5e93\u662f\u8981\u5206\u7247\u7684\u3002[\u4e5f\u5c31\u662fpartitioned=true] 4.2.1 \u4f7f\u80fd\u5e93 \u00b6 \u8ba9shop\u5e93\uff0c\u5f00\u59cb\u5206\u7247\u3002 mongos> sh.enableSharding(\"shop\"); { \"ok\" : 1, \"operationTime\" : Timestamp(1554373497, 2), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554373497, 2), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } 4.2.2 \u8bbe\u7f6e\u7247\u952e \u00b6 mongos> sh.shardCollection(\"shop.users\",{\"userId\": 1 }); { \"collectionsharded\" : \"shop.users\", \"collectionUUID\" : UUID(\"867fb471-f2e9-4fb0-a4ac-6a8a6eac7687\"), \"ok\" : 1, \"operationTime\" : Timestamp(1554373542, 9), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554373542, 9), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } mongos> sh.status() --- Sharding Status --- sharding version: { \"_id\" : 1, \"minCompatibleVersion\" : 5, \"currentVersion\" : 6, \"clusterId\" : ObjectId(\"5ca5b83091d62b328099a7b5\") } shards: { \"_id\" : \"shard1\", \"host\" : \"shard1/node1:27018,node2:27018,node3:27018\", \"state\" : 1 } { \"_id\" : \"shard2\", \"host\" : \"shard2/node1:27019,node2:27019,node3:27019\", \"state\" : 1 } { \"_id\" : \"shard3\", \"host\" : \"shard3/node1:27020,node2:27020,node3:27020\", \"state\" : 1 } active mongoses: \"4.0.8\" : 3 autosplit: Currently enabled: yes balancer: Currently enabled: yes Currently running: no Failed balancer rounds in last 5 attempts: 0 Migration Results for the last 24 hours: 172 : Success databases: { \"_id\" : \"config\", \"primary\" : \"config\", \"partitioned\" : true } config.system.sessions shard key: { \"_id\" : 1 } unique: false balancing: true chunks: shard1 1 { \"_id\" : { \"$minKey\" : 1 } } -->> { \"_id\" : { \"$maxKey\" : 1 } } on : shard1 Timestamp(1, 0) { \"_id\" : \"shop\", \"primary\" : \"shard2\", \"partitioned\" : true, \"version\" : { \"uuid\" : UUID(\"69b0fc8c-4332-489c-bf20-5a2e6ae774a7\"), \"lastMod\" : 1 } } shop.users shard key: { \"userId\" : 1 } unique: false balancing: true chunks: shard2 1 { \"userId\" : { \"$minKey\" : 1 } } -->> { \"userId\" : { \"$maxKey\" : 1 } } on : shard2 Timestamp(1, 0) shard key: { \"userId\" : 1 } \u53ef\u4ee5\u770b\u51fa\u5c31\u662f\u6211\u8bbe\u7f6e\u7684\u7247\u952e 4.2.3 \u8bbe\u7f6e\u5757 \u00b6 mongos> for(var i=1; i<=30; i++){ sh.splitAt(\"shop.users\", {userId: i*1000})}; { \"ok\" : 1, \"operationTime\" : Timestamp(1554373605, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554373613, 56), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } \u5f00\u59cb\u624b\u52a8\u5206\u5757 mongos> sh.shardCollection(\"shop.users\",{\"userId\": 1 }); { \"collectionsharded\" : \"shop.users\", \"collectionUUID\" : UUID(\"867fb471-f2e9-4fb0-a4ac-6a8a6eac7687\"), \"ok\" : 1, \"operationTime\" : Timestamp(1554373542, 9), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554373542, 9), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } \u6b64\u65f6\u770b\u51fa\u72b6\u6001 mongos> sh.status() \u3002\u3002\u3002\u3002\u3002 { \"_id\" : \"shop\", \"primary\" : \"shard2\", \"partitioned\" : true, \"version\" : { \"uuid\" : UUID(\"69b0fc8c-4332-489c-bf20-5a2e6ae774a7\"), \"lastMod\" : 1 } } shop.users shard key: { \"userId\" : 1 } unique: false balancing: true chunks: shard1 1 # \u8fd9\u4e09\u4e2a\u5757\u5f00\u59cb\u5728\u8df3\u6574\uff0c\u4e00\u76f4\u5230\u5747\u8861\u4e3a\u6b62 shard2 28 shard3 2 too many chunks to print, use verbose if you want to force print \u8c03\u6574\u597d\u7684\u60c5\u51b5 { \"_id\" : \"shop\", \"primary\" : \"shard2\", \"partitioned\" : true, \"version\" : { \"uuid\" : UUID(\"69b0fc8c-4332-489c-bf20-5a2e6ae774a7\"), \"lastMod\" : 1 } } shop.users shard key: { \"userId\" : 1 } unique: false balancing: true chunks: shard1 10 shard2 11 shard3 10 too many chunks to print, use verbose if you want to force print 4.2.3 \u63d2\u5165\u6570\u636e \u00b6 mongos> for(var i=1; i<30000; i++){ db.users.insert({userId: i,name: 'cmz'})}; WriteResult({ \"nInserted\" : 1 }) mongos> show dbs; admin 0.000GB config 0.002GB shop 0.001GB mongos> use shop; switched to db shop mongos> show tables; users mongos> db.users.count() 29999 \u67e5\u770b root@node1:/etc# mongo --port 27018 --quiet shard1:PRIMARY> rs.slaveOk() shard1:PRIMARY> show dbs; admin 0.000GB config 0.000GB local 0.006GB shop 0.000GB shard1:PRIMARY> use shop; switched to db shop shard1:PRIMARY> show tables; users shard1:PRIMARY> db.users.count() 9999 shard2:SECONDARY> rs.slaveOk() shard2:SECONDARY> use shop; switched to db shop shard2:SECONDARY> show tables; users shard2:SECONDARY> db.users.count() 10000 root@node3:/app/mongo/services/mongos# mongo --port 27020 --quiet shard3:SECONDARY> rs.slaveOk() shard3:SECONDARY> use bad use parameter shard3:SECONDARY> use shop switched to db shop shard3:SECONDARY> db.users.count(); 10000 \u67e5\u770b\u6bcf\u4e2ashard\uff0c\u5206\u7247\u4e86\uff0c\u5747\u8861\u7684\u5206\u5e03\u3002","title":"14. MonogoDB \u5206\u7247\u96c6\u5b9e\u6218"},{"location":"linux/nosql/mongo/mongo.shard_replicat/#1-shardedreplicat","text":"\u4e00\u4e2a\u5178\u578b\u7684\u751f\u4ea7\u4e0a\u7684mongodb\u7684\u96c6\u5408\u662f\uff0c\u590d\u5236\u96c6\u5408\u7ed3\u548c\u5206\u7247\u96c6\uff0cSharded Cluster\u5305\u62ecrouter(mongos)\u3001config server\u548cshards\uff0c\u5176\u4e2d\u6bcf\u4e2ashard\u90fd\u53ef\u4ee5\u662f\u5355\u70b9(standalone)\u6216\u8005\u590d\u5236\u96c6(replica set\uff09\u3002\u63a5\u4e0b\u6765\u7684\u6f14\u793a\u5305\u62ec\u4e00\u4e2arouter\uff0c \u4e09\u4e2aconfig server\uff0c\u4e24\u4e2ashard\u3002\u6bcf\u4e00\u4e2ashard\u90fd\u662f\u6709\u4e00\u4e2aprimary\u3001\u4e00\u4e2asecondary\u548c\u4e00\u4e2aarbiter\u7ec4\u6210\u7684replica set\u3002","title":"1. sharded+replicat\u90e8\u7f72\u642d\u5efa"},{"location":"linux/nosql/mongo/mongo.shard_replicat/#2","text":"IP \u4e3b\u673a\u540d \u7cfb\u7edf \u5b89\u88c5\u8f6f\u4ef6 \u89d2\u8272 192.168.178.128 node3 ubuntu16 mongodb4.0.8 sharde31\uff0csharde32,sharde33\uff0cconfigure3,mongos3 192.168.178.129 node2 ubuntu16 mongodb4.0.8 sharde21\uff0csharde22,sharde23\uff0cconfigure2,mongos2 192.168.178.130 node1 ubuntu16 mongodb4.0.8 sharde11\uff0csharde12,sharde13\uff0cconfigure1,mongos1 \u8be6\u7ec6\u53c2\u6570 \u4e3b\u673a \u7aef\u53e3\u4fe1\u606f node1 mongo shard1 : 27018 ( replicat set1 ) mongo shard2 : 27019 ( replicat set2 ) mongo shard3 : 27020 ( replicat set3 ) mongo config : 20000 mongos : 27017 node2 mongo shard1 : 27018 ( replicat set1 ) mongo shard2 : 27019 ( replicat set2 ) mongo shard3 : 27020 ( replicat set3 ) mongo config : 20000 mongos : 27017 node3 mongo shard1 : 27018 ( replicat set1 ) mongo shard2 : 27019 ( replicat set2 ) mongo shard3 : 27020 ( replicat set3 ) mongo config : 20000 mongos : 27017 \u4e00\u5b9a\u8981\u8ba4\u771f\u770b\u5b8c\uff0c\u4ee5\u4e0b\u64cd\u4f5c\uff0c\u867d\u7136\u6709\u70b9\u70e6\u3002\u6211\u5c3d\u91cf\u5199\u7684\u975e\u5e38\u8be6\u7ec6\u3002","title":"2. \u73af\u5883\u51c6\u5907"},{"location":"linux/nosql/mongo/mongo.shard_replicat/#3","text":"\u4ee5\u4e0b\u811a\u672c\u8fd0\u884c\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa\u526f\u672c\u96c6\uff0cshard\u96c6\uff0cconfig server\uff0cmongo\u8fd9\u4e00\u6574\u5957\u96c6\u7fa4[\u770b\u811a\u672c\u5185\u5bb9\u914d\u7f6e]\u3002 \u524d\u63d0\u662f\u9700\u8981\u5b89\u88c5\u597dmongdb4.x \u5728\u8fd0\u884c\u4e0b\u9762\u8fd9\u4e2a\u811a\u672c\u3002 \u4e09\u53f0\u57fa\u672c\u90fd\u4f7f\u7528\u8fd9\u4e00\u4e2a\u811a\u672c \u811a\u672c # \u89d2\u8272 \u7aef\u53e3 # shard1 27018 # shard2 27019 # shard3 27020 # configsvr 20000 # mongos 27107 pkill mongo pkill mongo pkill mongo mkdir / app / mongo / services / { shard1 / db , shard2 / db , shard3 / db , configsvr / db , mongos } - p # 1. shard1\u7684\u914d\u7f6e\u6587\u4ef6 # shard1 mongod.conf cat >/ app / mongo / services / shard1 / mongod . conf << EOF storage : dbPath : / app / mongo / services / shard1 / db journal : enabled : true systemLog : destination : file logAppend : true path : / app / mongo / services / shard1 / mongod . log net : port : 27018 bindIp : 0.0 . 0.0 processManagement : fork : true pidFilePath : / app / mongo / services / shard1 / pid replication : replSetName : shard1 sharding : clusterRole : shardsvr EOF # 2. shard 2\u7684\u914d\u7f6e\u6587\u4ef6 # shard2 mongod.conf cat >/ app / mongo / services / shard2 / mongod . conf << EOF storage : dbPath : / app / mongo / services / shard2 / db journal : enabled : true systemLog : destination : file logAppend : true path : / app / mongo / services / shard2 / mongod . log net : port : 27019 bindIp : 0.0 . 0.0 processManagement : fork : true pidFilePath : / app / mongo / services / shard2 / pid replication : replSetName : shard2 sharding : clusterRole : shardsvr EOF # 3. shard 3\u7684\u914d\u7f6e\u6587\u4ef6 #shard2 mongod.conf cat >/ app / mongo / services / shard3 / mongod . conf << EOF storage : dbPath : / app / mongo / services / shard3 / db journal : enabled : true systemLog : destination : file logAppend : true path : / app / mongo / services / shard3 / mongod . log net : port : 27020 bindIp : 0.0 . 0.0 processManagement : fork : true pidFilePath : / app / mongo / services / shard3 / pid replication : replSetName : shard3 sharding : clusterRole : shardsvr EOF # 4. configsvr \u7684\u914d\u7f6e\u6587\u4ef6 cat >/ app / mongo / services / configsvr / cfg . conf << EOF #configsvr cfg.conf storage : dbPath : / app / mongo / services / configsvr / db journal : enabled : true systemLog : destination : file logAppend : true path : / app / mongo / services / configsvr / mongod . log net : port : 20000 bindIp : 0.0 . 0.0 processManagement : fork : true pidFilePath : / app / mongo / services / configsvr / pid replication : replSetName : cfg sharding : clusterRole : configsvr EOF #mongos mongos.conf cat >/ app / mongo / services / mongos / mongos . conf << EOF systemLog : destination : file logAppend : true path : / app / mongo / services / mongos / mongos . log net : port : 27017 bindIp : 0.0 . 0.0 processManagement : fork : true pidFilePath : / app / mongo / services / mongos / pid sharding : configDB : cfg / node1 : 20000 , node2 : 20000 , node3 : 20000 EOF # 2. start \u542f\u52a8\u670d\u52a1 mongod - f / app / mongo / services / shard1 / mongod . conf mongod - f / app / mongo / services / shard2 / mongod . conf mongod - f / app / mongo / services / shard3 / mongod . conf mongod - f / app / mongo / services / configsvr / cfg . conf # 3. check ps axf | grep - v grep | egrep 'mongod|configsvr' netstat - lnp | egrep '27018|27019|27020|20000' # 4. set replicat \u8bbe\u7f6e\u526f\u672c\u96c6 mongo -- port 27018 -- quiet << EOF rs . initiate ({ \"_id\" : \"shard1\" , \"members\" :[ { \"_id\" : 0 , \"host\" : \"node1:27018\" }, { \"_id\" : 1 , \"host\" : \"node2:27018\" }, { \"_id\" : 2 , \"host\" : \"node3:27018\" } ] }) EOF mongo -- port 27019 -- quiet << EOF rs . initiate ({ \"_id\" : \"shard2\" , \"members\" :[ { \"_id\" : 0 , \"host\" : \"node1:27019\" }, { \"_id\" : 1 , \"host\" : \"node2:27019\" }, { \"_id\" : 2 , \"host\" : \"node3:27019\" } ] }) EOF mongo -- port 27020 -- quiet << EOF rs . initiate ({ \"_id\" : \"shard3\" , \"members\" :[ { \"_id\" : 0 , \"host\" : \"node1:27020\" }, { \"_id\" : 1 , \"host\" : \"node2:27020\" }, { \"_id\" : 2 , \"host\" : \"node3:27020\" } ] }) EOF # 5. init replicat \u521d\u59cb\u5316\u526f\u672c\u96c6[\u544a\u8bc9configure server\u5b83\u7684\u526f\u672c\u96c6\u6709\u54ea\u4e9b] mongo -- port 20000 -- quiet << EOF rs . initiate ({ \"_id\" : \"cfg\" , \"members\" :[ { \"_id\" : 0 , \"host\" : \"node1:20000\" }, { \"_id\" : 1 , \"host\" : \"node2:20000\" }, { \"_id\" : 2 , \"host\" : \"node3:20000\" } ] }) EOF mongos - f / app / mongo / services / mongos / mongos . conf # 6. set shard # \u4e3amongo configsvr \u6dfb\u52a0shard\u8282\u70b9 mongo -- port 27017 -- quiet << EOF sh . addShard ( \"shard1/node1:27018,node2:27018,node3:27018\" ) sh . addShard ( \"shard2/node1:27019,node2:27019,node3:27019\" ) sh . addShard ( \"shard3/node1:27020,node2:27020,node3:27020\" ) sh . status () EOF # 7. check process ps axf | grep - v grep | grep \"mongo\" netstat - lnp | egrep '27018|27019|27020|20000'","title":"3. \u90e8\u7f72"},{"location":"linux/nosql/mongo/mongo.shard_replicat/#4","text":"","title":"4. \u6d4b\u8bd5"},{"location":"linux/nosql/mongo/mongo.shard_replicat/#41","text":"\u5148\u68c0\u67e5\u4e0a\u9762\u811a\u672c\u7684\u8fd0\u884c\u60c5\u51b5\u662f\u5426\u6b63\u5e38\u3002 root@node1:~# ps axf|grep -v grep | grep \"mongo\" 11840 pts/0 Sl+ 0:00 | \\_ mongo --port 27018 12098 pts/1 Sl+ 1:28 | \\_ mongo 9867 ? Sl 3:28 mongod -f /app/mongo/services/shard1/mongod.conf 9899 ? Sl 3:03 mongod -f /app/mongo/services/shard2/mongod.conf 9931 ? Sl 7:16 mongod -f /app/mongo/services/shard3/mongod.conf 9963 ? Sl 2:12 mongod -f /app/mongo/services/configsvr/cfg.conf 10221 ? Sl 5:09 mongos -f /app/mongo/services/mongos/mongos.conf root@node1:~# netstat -lnp|egrep '27018|27019|27020|20000|27017' tcp 0 0 0.0.0.0:27017 0.0.0.0:* LISTEN 10221/mongos tcp 0 0 0.0.0.0:27018 0.0.0.0:* LISTEN 9867/mongod tcp 0 0 0.0.0.0:27019 0.0.0.0:* LISTEN 9899/mongod tcp 0 0 0.0.0.0:27020 0.0.0.0:* LISTEN 9931/mongod tcp 0 0 0.0.0.0:20000 0.0.0.0:* LISTEN 9963/mongod unix 2 [ ACC ] STREAM LISTENING 67939 9867/mongod /tmp/mongodb-27018.sock unix 2 [ ACC ] STREAM LISTENING 67941 9899/mongod /tmp/mongodb-27019.sock unix 2 [ ACC ] STREAM LISTENING 69099 9931/mongod /tmp/mongodb-27020.sock unix 2 [ ACC ] STREAM LISTENING 69101 9963/mongod /tmp/mongodb-20000.sock unix 2 [ ACC ] STREAM LISTENING 68122 10221/mongos /tmp/mongodb-27017.sock \u5fc5\u987b\u6709\u4ee5\u4e0a5\u4e2a\u8fdb\u7a0b\uff0c5\u4e2a\u7aef\u53e3\uff0c\u8fd9\u662fnode1\u4e0a\u7684\uff0c\u5176\u4ed6\u6240\u6709\u4e09\u53f0\u673a\u5668\u90fd\u662f\u8fd9\u6837\u3002","title":"4.1 \u8fdb\u7a0b\u548c\u7aef\u53e3"},{"location":"linux/nosql/mongo/mongo.shard_replicat/#42","text":"\u6211\u4eec\u5f00\u59cb\u6d4b\u8bd5\u590d\u5236\u96c6\u548c\u5206\u7247\u96c6\uff0c\u6211\u4eec\u4f7f\u7528\u9884\u5148\u5206\u7247,\u624b\u52a8\u9884\u5148\u5206\u7247\u662f\u4e3a\u4e86\u9632\u6b62\u672a\u6765chunk\u7684\u79fb\u52a8\uff0c\u51cf\u5c11IO\u3002 # 8. \u5b9a\u4e49\u5206\u7247\u89c4\u5219\uff0c\u6dfb\u52a0\u5206\u7247\u7684\u5e93 # Field\u662fcollection\u7684\u4e00\u4e2a\u5b57\u6bb5\uff0c\u7cfb\u7edf\u5c06\u4f1a\u5229\u7528filed\u7684\u503c\u6765\u8ba1\u7b97\u5e94\u8be5\u5206\u7247\u5230\u54ea\u4e2a\u7247\u4e0a\uff0c # \u8fd9\u4e2afiled\u662f\u7247\u952e\uff0cshard key # \u4fee\u6539chunkserver # db.settings.save({'_id':'chunksize','value':1}); # db.settings.find() sh.enableSharding(\"caimengzhi\"); sh.shardCollection('caimengzhi.goods',{'goods_id':1}); for (var i=1;i<=30000;i++){ db.goods.insert({goods_id:i,good_name:'summer'}); } # 9. \u624b\u52a8\u9884\u5148\u5206\u7247 sh.shardCollection('caimengzhi.cmz',{'userid':1}); # \u5148\u5206\u5757,\u5148\u520640\u4e2a\u5757\uff0c\u9884\u5148\u57281K,2K,...40K\u8fd9\u6837\u7684\u754c\u9650\u5207\u597dchunk\uff08\u867d\u7136chunk\u8fd8\u662f\u7a7a\u7684\uff09 # \u4f46\u662fchunk\u4f1a\u5747\u5300\u7684\u79fb\u52a8\u5230\u5404\u7247\u4e0a for(var i=1;i<=40;i++){ sh.splitAt('caimengzhi.cmz',{userid:i*1000}) } # \u63d2\u5165\u6570\u636e for(var i=1;i<=10000;i++){ db.cmz.insert({userid:i,name:'cmz'+i}) } sh.shardCollection(\"caimengzhi.users\",{\"userId\": 1 }) for(var i=1; i<=30; i++){ sh.splitAt(\"caimengzhi.users\", {userId: i*1000}) } for(var i=1; i<30000; i++){ db.users.insert({userId: i,name: 'hello'}) } use shop; sh.enableSharding(\"shop\"); sh.shardCollection(\"shop.users\",{\"userId\": 1 }); for(var i=1; i<=30; i++){ sh.splitAt(\"shop.users\", {userId: i*1000}) }; for(var i=1; i<30000; i++){ db.users.insert({userId: i,name: 'cmz'})}; \u8be6\u7ec6\u8fc7\u7a0b root@node1:~# mongo --port 27017 --quiet mongos> show dbs; admin 0.000GB config 0.002GB mongos> use shop; switched to db shop mongos> sh.enableSharding(\"shop\"); { \"ok\" : 1, \"operationTime\" : Timestamp(1554373413, 6), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554373413, 6), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } \u67e5\u770b mongos> sh.status() --- Sharding Status --- sharding version: { \"_id\" : 1, \"minCompatibleVersion\" : 5, \"currentVersion\" : 6, \"clusterId\" : ObjectId(\"5ca5b83091d62b328099a7b5\") } shards: { \"_id\" : \"shard1\", \"host\" : \"shard1/node1:27018,node2:27018,node3:27018\", \"state\" : 1 } { \"_id\" : \"shard2\", \"host\" : \"shard2/node1:27019,node2:27019,node3:27019\", \"state\" : 1 } { \"_id\" : \"shard3\", \"host\" : \"shard3/node1:27020,node2:27020,node3:27020\", \"state\" : 1 } active mongoses: \"4.0.8\" : 3 autosplit: Currently enabled: yes balancer: Currently enabled: yes Currently running: no Failed balancer rounds in last 5 attempts: 0 Migration Results for the last 24 hours: 172 : Success databases: { \"_id\" : \"config\", \"primary\" : \"config\", \"partitioned\" : true } config.system.sessions shard key: { \"_id\" : 1 } unique: false balancing: true chunks: shard1 1 { \"_id\" : { \"$minKey\" : 1 } } -->> { \"_id\" : { \"$maxKey\" : 1 } } on : shard1 Timestamp(1, 0) { \"_id\" : \"shop\", \"primary\" : \"shard2\", \"partitioned\" : true, \"version\" : { \"uuid\" : UUID(\"69b0fc8c-4332-489c-bf20-5a2e6ae774a7\"), \"lastMod\" : 1 } } \u4ece\u4e0a\u9762\u53ef\u4ee5\u770b\u51fa\u6570\u636e\u9ed8\u8ba4\u662f\u5728shard1\u4e0a\u7684\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u8bbe\u7f6eshop\u5e93\u662f\u8981\u5206\u7247\u7684\u3002[\u4e5f\u5c31\u662fpartitioned=true]","title":"4.2 \u6d4b\u8bd5"},{"location":"linux/nosql/mongo/mongo.shard_replicat/#421","text":"\u8ba9shop\u5e93\uff0c\u5f00\u59cb\u5206\u7247\u3002 mongos> sh.enableSharding(\"shop\"); { \"ok\" : 1, \"operationTime\" : Timestamp(1554373497, 2), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554373497, 2), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } }","title":"4.2.1 \u4f7f\u80fd\u5e93"},{"location":"linux/nosql/mongo/mongo.shard_replicat/#422","text":"mongos> sh.shardCollection(\"shop.users\",{\"userId\": 1 }); { \"collectionsharded\" : \"shop.users\", \"collectionUUID\" : UUID(\"867fb471-f2e9-4fb0-a4ac-6a8a6eac7687\"), \"ok\" : 1, \"operationTime\" : Timestamp(1554373542, 9), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554373542, 9), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } mongos> sh.status() --- Sharding Status --- sharding version: { \"_id\" : 1, \"minCompatibleVersion\" : 5, \"currentVersion\" : 6, \"clusterId\" : ObjectId(\"5ca5b83091d62b328099a7b5\") } shards: { \"_id\" : \"shard1\", \"host\" : \"shard1/node1:27018,node2:27018,node3:27018\", \"state\" : 1 } { \"_id\" : \"shard2\", \"host\" : \"shard2/node1:27019,node2:27019,node3:27019\", \"state\" : 1 } { \"_id\" : \"shard3\", \"host\" : \"shard3/node1:27020,node2:27020,node3:27020\", \"state\" : 1 } active mongoses: \"4.0.8\" : 3 autosplit: Currently enabled: yes balancer: Currently enabled: yes Currently running: no Failed balancer rounds in last 5 attempts: 0 Migration Results for the last 24 hours: 172 : Success databases: { \"_id\" : \"config\", \"primary\" : \"config\", \"partitioned\" : true } config.system.sessions shard key: { \"_id\" : 1 } unique: false balancing: true chunks: shard1 1 { \"_id\" : { \"$minKey\" : 1 } } -->> { \"_id\" : { \"$maxKey\" : 1 } } on : shard1 Timestamp(1, 0) { \"_id\" : \"shop\", \"primary\" : \"shard2\", \"partitioned\" : true, \"version\" : { \"uuid\" : UUID(\"69b0fc8c-4332-489c-bf20-5a2e6ae774a7\"), \"lastMod\" : 1 } } shop.users shard key: { \"userId\" : 1 } unique: false balancing: true chunks: shard2 1 { \"userId\" : { \"$minKey\" : 1 } } -->> { \"userId\" : { \"$maxKey\" : 1 } } on : shard2 Timestamp(1, 0) shard key: { \"userId\" : 1 } \u53ef\u4ee5\u770b\u51fa\u5c31\u662f\u6211\u8bbe\u7f6e\u7684\u7247\u952e","title":"4.2.2 \u8bbe\u7f6e\u7247\u952e"},{"location":"linux/nosql/mongo/mongo.shard_replicat/#423","text":"mongos> for(var i=1; i<=30; i++){ sh.splitAt(\"shop.users\", {userId: i*1000})}; { \"ok\" : 1, \"operationTime\" : Timestamp(1554373605, 1), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554373613, 56), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } \u5f00\u59cb\u624b\u52a8\u5206\u5757 mongos> sh.shardCollection(\"shop.users\",{\"userId\": 1 }); { \"collectionsharded\" : \"shop.users\", \"collectionUUID\" : UUID(\"867fb471-f2e9-4fb0-a4ac-6a8a6eac7687\"), \"ok\" : 1, \"operationTime\" : Timestamp(1554373542, 9), \"$clusterTime\" : { \"clusterTime\" : Timestamp(1554373542, 9), \"signature\" : { \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"), \"keyId\" : NumberLong(0) } } } \u6b64\u65f6\u770b\u51fa\u72b6\u6001 mongos> sh.status() \u3002\u3002\u3002\u3002\u3002 { \"_id\" : \"shop\", \"primary\" : \"shard2\", \"partitioned\" : true, \"version\" : { \"uuid\" : UUID(\"69b0fc8c-4332-489c-bf20-5a2e6ae774a7\"), \"lastMod\" : 1 } } shop.users shard key: { \"userId\" : 1 } unique: false balancing: true chunks: shard1 1 # \u8fd9\u4e09\u4e2a\u5757\u5f00\u59cb\u5728\u8df3\u6574\uff0c\u4e00\u76f4\u5230\u5747\u8861\u4e3a\u6b62 shard2 28 shard3 2 too many chunks to print, use verbose if you want to force print \u8c03\u6574\u597d\u7684\u60c5\u51b5 { \"_id\" : \"shop\", \"primary\" : \"shard2\", \"partitioned\" : true, \"version\" : { \"uuid\" : UUID(\"69b0fc8c-4332-489c-bf20-5a2e6ae774a7\"), \"lastMod\" : 1 } } shop.users shard key: { \"userId\" : 1 } unique: false balancing: true chunks: shard1 10 shard2 11 shard3 10 too many chunks to print, use verbose if you want to force print","title":"4.2.3 \u8bbe\u7f6e\u5757"},{"location":"linux/nosql/mongo/mongo.shard_replicat/#423_1","text":"mongos> for(var i=1; i<30000; i++){ db.users.insert({userId: i,name: 'cmz'})}; WriteResult({ \"nInserted\" : 1 }) mongos> show dbs; admin 0.000GB config 0.002GB shop 0.001GB mongos> use shop; switched to db shop mongos> show tables; users mongos> db.users.count() 29999 \u67e5\u770b root@node1:/etc# mongo --port 27018 --quiet shard1:PRIMARY> rs.slaveOk() shard1:PRIMARY> show dbs; admin 0.000GB config 0.000GB local 0.006GB shop 0.000GB shard1:PRIMARY> use shop; switched to db shop shard1:PRIMARY> show tables; users shard1:PRIMARY> db.users.count() 9999 shard2:SECONDARY> rs.slaveOk() shard2:SECONDARY> use shop; switched to db shop shard2:SECONDARY> show tables; users shard2:SECONDARY> db.users.count() 10000 root@node3:/app/mongo/services/mongos# mongo --port 27020 --quiet shard3:SECONDARY> rs.slaveOk() shard3:SECONDARY> use bad use parameter shard3:SECONDARY> use shop switched to db shop shard3:SECONDARY> db.users.count(); 10000 \u67e5\u770b\u6bcf\u4e2ashard\uff0c\u5206\u7247\u4e86\uff0c\u5747\u8861\u7684\u5206\u5e03\u3002","title":"4.2.3 \u63d2\u5165\u6570\u636e"},{"location":"linux/nosql/mongo/mongo.sort/","text":"MongoDB \u6392\u5e8f 1. sort \u00b6 \u5728 MongoDB \u4e2d\u4f7f\u7528 sort() \u65b9\u6cd5\u5bf9\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0csort() \u65b9\u6cd5\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u6307\u5b9a\u6392\u5e8f\u7684\u5b57\u6bb5 1 \u4e3a\u5347\u5e8f\u6392\u5217 1 \u662f\u7528\u4e8e\u964d\u5e8f\u6392\u5217\u3002 sort()\u65b9\u6cd5\u57fa\u672c\u8bed\u6cd5\u5982\u4e0b\u6240\u793a\uff1a db.COLLECTION_NAME.find().sort({KEY:1}) 1.1 \u6b63\u5e38\u6392\u5217 \u00b6 > db.col.find() { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } 1.2 \u964d\u5e8f\u6392\u5217 \u00b6 > db.col.find().sort({\"likes\":-1}) { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } 1.3 \u5347\u5e8f\u6392\u5217 \u00b6 > db.col.find().sort({\"likes\":1}) { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } \u6ce8\u610f\u5148\u540e\u987a\u5e8f skip (), limilt (), sort () \u4e09\u4e2a\u653e\u5728\u4e00\u8d77\u6267\u884c\u7684\u65f6\u5019\uff0c\u6267\u884c\u7684\u987a\u5e8f\u662f\u5148 sort (), \u7136\u540e\u662f skip () \uff0c\u6700\u540e\u662f\u663e\u793a\u7684 limit () \u3002","title":"09. MonogoDB \u6392\u5e8f"},{"location":"linux/nosql/mongo/mongo.sort/#1-sort","text":"\u5728 MongoDB \u4e2d\u4f7f\u7528 sort() \u65b9\u6cd5\u5bf9\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0csort() \u65b9\u6cd5\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u6307\u5b9a\u6392\u5e8f\u7684\u5b57\u6bb5 1 \u4e3a\u5347\u5e8f\u6392\u5217 1 \u662f\u7528\u4e8e\u964d\u5e8f\u6392\u5217\u3002 sort()\u65b9\u6cd5\u57fa\u672c\u8bed\u6cd5\u5982\u4e0b\u6240\u793a\uff1a db.COLLECTION_NAME.find().sort({KEY:1})","title":"1. sort"},{"location":"linux/nosql/mongo/mongo.sort/#11","text":"> db.col.find() { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 }","title":"1.1 \u6b63\u5e38\u6392\u5217"},{"location":"linux/nosql/mongo/mongo.sort/#12","text":"> db.col.find().sort({\"likes\":-1}) { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 }","title":"1.2 \u964d\u5e8f\u6392\u5217"},{"location":"linux/nosql/mongo/mongo.sort/#13","text":"> db.col.find().sort({\"likes\":1}) { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } \u6ce8\u610f\u5148\u540e\u987a\u5e8f skip (), limilt (), sort () \u4e09\u4e2a\u653e\u5728\u4e00\u8d77\u6267\u884c\u7684\u65f6\u5019\uff0c\u6267\u884c\u7684\u987a\u5e8f\u662f\u5148 sort (), \u7136\u540e\u662f skip () \uff0c\u6700\u540e\u662f\u663e\u793a\u7684 limit () \u3002","title":"1.3 \u5347\u5e8f\u6392\u5217"},{"location":"linux/nosql/mongo/mongo.type/","text":"MongoDB $type \u64cd\u4f5c\u7b26 1. \u63cf\u8ff0 \u00b6 $type\u64cd\u4f5c\u7b26\u662f\u57fa\u4e8eBSON\u7c7b\u578b\u6765\u68c0\u7d22\u96c6\u5408\u4e2d\u5339\u914d\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5e76\u8fd4\u56de\u7ed3\u679c\u3002 MongoDB \u4e2d\u53ef\u4ee5\u4f7f\u7528\u7684\u7c7b\u578b\u5982\u4e0b\u8868\u6240\u793a\uff1a \u7c7b\u578b \u6570\u5b57 \u63cf\u8ff0 Double 1 String 2 Object 3 Array 4 Binary data 5 Undefined 6 \u5df2\u5e9f\u5f03\u3002 Object id 7 Boolean 8 Date 9 Null 10 Regular Expression 11 JavaScript 13 Symbol 14 JavaScript (with scope) 15 32-bit integer 16 Timestamp 17 64-bit integer 18 Min key 255 Query with -1. Max key 127 2. \u64cd\u4f5c\u8fc7\u7a0b \u00b6 2.1 \u51c6\u5907\u73af\u5883 \u00b6 \u6211\u4eec\u4f7f\u7528\u7684\u6570\u636e\u5e93\u540d\u79f0\u4e3a\"cmz\" \u6211\u4eec\u7684\u96c6\u5408\u540d\u79f0\u4e3a\"col\"\uff0c\u4ee5\u4e0b\u4e3a\u6211\u4eec\u63d2\u5165\u7684\u6570\u636e\u3002 \u96c6\u5408\"col\"\uff1a db.col.remove({}) db.col.find() db.col.insert({ title: 'Books \u6559\u7a0b', description: 'Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['Java', 'database', 'web'], likes: 200 }) db.col.insert({ title: 'Books \u6559\u7a0b', description: 'Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['Python', 'database', 'web'], likes: 150 }) db.col.insert({ title: 'Books \u6559\u7a0b', description: 'MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['mongodb', 'database', 'NoSQL'], likes: 100 }) \u64cd\u4f5c\u8fc7\u7a0b > db.col.find() { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } 2.2 MongoDB \u64cd\u4f5c\u7b26 - $type \u5b9e\u4f8b \u00b6 \u5982\u679c\u60f3\u83b7\u53d6 \"col\" \u96c6\u5408\u4e2d title \u4e3a String \u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a db.col.find({\"title\" : {$type : 2}}) \u6216 db.col.find({\"title\" : {$type : 'string'}}) \u64cd\u4f5c\u8fc7\u7a0b > db.col.find({\"title\" : {$type : 2}}) { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 }","title":"07. MonogoDB $type"},{"location":"linux/nosql/mongo/mongo.type/#1","text":"$type\u64cd\u4f5c\u7b26\u662f\u57fa\u4e8eBSON\u7c7b\u578b\u6765\u68c0\u7d22\u96c6\u5408\u4e2d\u5339\u914d\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5e76\u8fd4\u56de\u7ed3\u679c\u3002 MongoDB \u4e2d\u53ef\u4ee5\u4f7f\u7528\u7684\u7c7b\u578b\u5982\u4e0b\u8868\u6240\u793a\uff1a \u7c7b\u578b \u6570\u5b57 \u63cf\u8ff0 Double 1 String 2 Object 3 Array 4 Binary data 5 Undefined 6 \u5df2\u5e9f\u5f03\u3002 Object id 7 Boolean 8 Date 9 Null 10 Regular Expression 11 JavaScript 13 Symbol 14 JavaScript (with scope) 15 32-bit integer 16 Timestamp 17 64-bit integer 18 Min key 255 Query with -1. Max key 127","title":"1. \u63cf\u8ff0"},{"location":"linux/nosql/mongo/mongo.type/#2","text":"","title":"2.  \u64cd\u4f5c\u8fc7\u7a0b"},{"location":"linux/nosql/mongo/mongo.type/#21","text":"\u6211\u4eec\u4f7f\u7528\u7684\u6570\u636e\u5e93\u540d\u79f0\u4e3a\"cmz\" \u6211\u4eec\u7684\u96c6\u5408\u540d\u79f0\u4e3a\"col\"\uff0c\u4ee5\u4e0b\u4e3a\u6211\u4eec\u63d2\u5165\u7684\u6570\u636e\u3002 \u96c6\u5408\"col\"\uff1a db.col.remove({}) db.col.find() db.col.insert({ title: 'Books \u6559\u7a0b', description: 'Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['Java', 'database', 'web'], likes: 200 }) db.col.insert({ title: 'Books \u6559\u7a0b', description: 'Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['Python', 'database', 'web'], likes: 150 }) db.col.insert({ title: 'Books \u6559\u7a0b', description: 'MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93', by: 'cmz', url: 'https://caimengzhi.github.io/books', tags: ['mongodb', 'database', 'NoSQL'], likes: 100 }) \u64cd\u4f5c\u8fc7\u7a0b > db.col.find() { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 }","title":"2.1 \u51c6\u5907\u73af\u5883"},{"location":"linux/nosql/mongo/mongo.type/#22-mongodb-type","text":"\u5982\u679c\u60f3\u83b7\u53d6 \"col\" \u96c6\u5408\u4e2d title \u4e3a String \u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a db.col.find({\"title\" : {$type : 2}}) \u6216 db.col.find({\"title\" : {$type : 'string'}}) \u64cd\u4f5c\u8fc7\u7a0b > db.col.find({\"title\" : {$type : 2}}) { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65db\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Java \u662f\u7531Sun Microsystems\u516c\u53f8\u4e8e1995\u5e745\u6708\u63a8\u51fa\u7684\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\u3002\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Java\", \"database\", \"web\" ], \"likes\" : 200 } { \"_id\" : ObjectId(\"5c76214dfec6d367f28a65dc\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"Python \u8bed\u8a00\u662f\u6700\u8fd1\u6bd4\u8f83\u6d41\u884c\u7684\u8bed\u8a00\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"Python\", \"database\", \"web\" ], \"likes\" : 150 } { \"_id\" : ObjectId(\"5c76214efec6d367f28a65dd\"), \"title\" : \"Books \u6559\u7a0b\", \"description\" : \"MongoDB \u662f\u4e00\u4e2a Nosql \u6570\u636e\u5e93\", \"by\" : \"cmz\", \"url\" : \"https://caimengzhi.github.io/books\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 }","title":"2.2 MongoDB \u64cd\u4f5c\u7b26 - $type \u5b9e\u4f8b"},{"location":"linux/nosql/redis/redis.arrairs/","text":"Redis \u4e8b\u52a1 1. \u4ecb\u7ecd \u00b6 Redis \u4e8b\u52a1\u53ef\u4ee5\u4e00\u6b21\u6267\u884c\u591a\u4e2a\u547d\u4ee4\uff0c \u5e76\u4e14\u5e26\u6709\u4ee5\u4e0b\u4e24\u4e2a\u91cd\u8981\u7684\u4fdd\u8bc1\uff1a \u6279\u91cf\u64cd\u4f5c\u5728\u53d1\u9001 EXEC \u547d\u4ee4\u524d\u88ab\u653e\u5165\u961f\u5217\u7f13\u5b58\u3002 \u6536\u5230 EXEC \u547d\u4ee4\u540e\u8fdb\u5165\u4e8b\u52a1\u6267\u884c\uff0c\u4e8b\u52a1\u4e2d\u4efb\u610f\u547d\u4ee4\u6267\u884c\u5931\u8d25\uff0c\u5176\u4f59\u7684\u547d\u4ee4\u4f9d\u7136\u88ab\u6267\u884c\u3002 \u5728\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\uff0c\u5176\u4ed6\u5ba2\u6237\u7aef\u63d0\u4ea4\u7684\u547d\u4ee4\u8bf7\u6c42\u4e0d\u4f1a\u63d2\u5165\u5230\u4e8b\u52a1\u6267\u884c\u547d\u4ee4\u5e8f\u5217\u4e2d\u3002 \u4e00\u4e2a\u4e8b\u52a1\u4ece\u5f00\u59cb\u5230\u6267\u884c\u4f1a\u7ecf\u5386\u4ee5\u4e0b\u4e09\u4e2a\u9636\u6bb5 \u5f00\u59cb\u4e8b\u52a1\u3002 \u547d\u4ee4\u5165\u961f\u3002 \u6267\u884c\u4e8b\u52a1\u3002 2. \u4e8b\u52a1\u547d\u4ee4 \u00b6 \u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 DISCARD \u53d6\u6d88\u4e8b\u52a1\uff0c\u653e\u5f03\u6267\u884c\u4e8b\u52a1\u5757\u5185\u7684\u6240\u6709\u547d\u4ee4\u3002 2 EXEC \u6267\u884c\u6240\u6709\u4e8b\u52a1\u5757\u5185\u7684\u547d\u4ee4\u3002 3 MULTI \u6807\u8bb0\u4e00\u4e2a\u4e8b\u52a1\u5757\u7684\u5f00\u59cb\u3002 4 UNWATCH \u53d6\u6d88 WATCH \u547d\u4ee4\u5bf9\u6240\u6709 key \u7684\u76d1\u89c6\u3002 5 WATCH key [key ...] \u76d1\u89c6\u4e00\u4e2a(\u6216\u591a\u4e2a) key \uff0c\u5982\u679c\u5728\u4e8b\u52a1\u6267\u884c\u4e4b\u524d\u8fd9\u4e2a(\u6216\u8fd9\u4e9b) key \u88ab\u5176\u4ed6\u547d\u4ee4\u6240\u6539\u52a8\uff0c\u90a3\u4e48\u4e8b\u52a1\u5c06\u88ab\u6253\u65ad\u3002 3. \u5b9e\u4f8b \u00b6 \u4ee5\u4e0b\u662f\u4e00\u4e2a\u4e8b\u52a1\u7684\u4f8b\u5b50\uff0c \u5b83\u5148\u4ee5 MULTI \u5f00\u59cb\u4e00\u4e2a\u4e8b\u52a1\uff0c \u7136\u540e\u5c06\u591a\u4e2a\u547d\u4ee4\u5165\u961f\u5230\u4e8b\u52a1\u4e2d\uff0c \u6700\u540e\u7531 EXEC \u547d\u4ee4\u89e6\u53d1\u4e8b\u52a1\uff0c \u4e00\u5e76\u6267\u884c\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u547d\u4ee4\uff1a 127.0.0.1:6379> select 6 (error) NOAUTH Authentication required. 127.0.0.1:6379> AUTH cmz OK 127.0.0.1:6379> select 6 OK 127.0.0.1:6379[6]> MULTI OK 127.0.0.1:6379[6]> EXEC (empty list or set) 127.0.0.1:6379[6]> set k1 1 OK 127.0.0.1:6379[6]> set k2 2 OK 127.0.0.1:6379[6]> set k3 3 OK 127.0.0.1:6379[6]> keys * 1) \"k3\" 2) \"k2\" 3) \"k1\" 127.0.0.1:6379[6]> MGET k1 k2 k3 1) \"1\" 2) \"2\" 3) \"3\" 127.0.0.1:6379[6]> MULTI OK 127.0.0.1:6379[6]> set k1 11 QUEUED 127.0.0.1:6379[6]> set k2 22 QUEUED 127.0.0.1:6379[6]> set k3 33 QUEUED 127.0.0.1:6379[6]> EXEC 1) OK 2) OK 3) OK 127.0.0.1:6379[6]> MGET k1 k2 k3 1) \"11\" 2) \"22\" 3) \"33\" \u6ce8\u610f \u5355\u4e2a Redis \u547d\u4ee4\u7684\u6267\u884c\u662f\u539f\u5b50\u6027\u7684\uff0c\u4f46 Redis \u6ca1\u6709\u5728\u4e8b\u52a1\u4e0a\u589e\u52a0\u4efb\u4f55\u7ef4\u6301\u539f\u5b50\u6027\u7684\u673a\u5236\uff0c\u6240\u4ee5 Redis \u4e8b\u52a1\u7684\u6267\u884c\u5e76\u4e0d\u662f\u539f\u5b50\u6027\u7684\u3002 \u4e8b\u52a1\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u6253\u5305\u7684\u6279\u91cf\u6267\u884c\u811a\u672c\uff0c\u4f46\u6279\u91cf\u6307\u4ee4\u5e76\u975e\u539f\u5b50\u5316\u7684\u64cd\u4f5c\uff0c\u4e2d\u95f4\u67d0\u6761\u6307\u4ee4\u7684\u5931\u8d25\u4e0d\u4f1a\u5bfc\u81f4\u524d\u9762\u5df2\u505a\u6307\u4ee4\u7684\u56de\u6eda\uff0c\u4e5f\u4e0d\u4f1a\u9020\u6210\u540e\u7eed\u7684\u6307\u4ee4\u4e0d\u505a\u3002 127.0.0.1:6379[6]> MULTI OK 127.0.0.1:6379[6]> set a aaa QUEUED 127.0.0.1:6379[6]> set b bbb QUEUED 127.0.0.1:6379[6]> set c ccc QUEUED 127.0.0.1:6379[6]> exec 1) OK 2) OK 3) OK \u5982\u679c\u5728 set b bbb \u5904\u5931\u8d25\uff0cset a \u5df2\u6210\u529f\u4e0d\u4f1a\u56de\u6eda\uff0cset c \u8fd8\u4f1a\u7ee7\u7eed\u6267\u884c\u3002","title":"06. redis \u4e8b\u52a1"},{"location":"linux/nosql/redis/redis.arrairs/#1","text":"Redis \u4e8b\u52a1\u53ef\u4ee5\u4e00\u6b21\u6267\u884c\u591a\u4e2a\u547d\u4ee4\uff0c \u5e76\u4e14\u5e26\u6709\u4ee5\u4e0b\u4e24\u4e2a\u91cd\u8981\u7684\u4fdd\u8bc1\uff1a \u6279\u91cf\u64cd\u4f5c\u5728\u53d1\u9001 EXEC \u547d\u4ee4\u524d\u88ab\u653e\u5165\u961f\u5217\u7f13\u5b58\u3002 \u6536\u5230 EXEC \u547d\u4ee4\u540e\u8fdb\u5165\u4e8b\u52a1\u6267\u884c\uff0c\u4e8b\u52a1\u4e2d\u4efb\u610f\u547d\u4ee4\u6267\u884c\u5931\u8d25\uff0c\u5176\u4f59\u7684\u547d\u4ee4\u4f9d\u7136\u88ab\u6267\u884c\u3002 \u5728\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\uff0c\u5176\u4ed6\u5ba2\u6237\u7aef\u63d0\u4ea4\u7684\u547d\u4ee4\u8bf7\u6c42\u4e0d\u4f1a\u63d2\u5165\u5230\u4e8b\u52a1\u6267\u884c\u547d\u4ee4\u5e8f\u5217\u4e2d\u3002 \u4e00\u4e2a\u4e8b\u52a1\u4ece\u5f00\u59cb\u5230\u6267\u884c\u4f1a\u7ecf\u5386\u4ee5\u4e0b\u4e09\u4e2a\u9636\u6bb5 \u5f00\u59cb\u4e8b\u52a1\u3002 \u547d\u4ee4\u5165\u961f\u3002 \u6267\u884c\u4e8b\u52a1\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.arrairs/#2","text":"\u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 DISCARD \u53d6\u6d88\u4e8b\u52a1\uff0c\u653e\u5f03\u6267\u884c\u4e8b\u52a1\u5757\u5185\u7684\u6240\u6709\u547d\u4ee4\u3002 2 EXEC \u6267\u884c\u6240\u6709\u4e8b\u52a1\u5757\u5185\u7684\u547d\u4ee4\u3002 3 MULTI \u6807\u8bb0\u4e00\u4e2a\u4e8b\u52a1\u5757\u7684\u5f00\u59cb\u3002 4 UNWATCH \u53d6\u6d88 WATCH \u547d\u4ee4\u5bf9\u6240\u6709 key \u7684\u76d1\u89c6\u3002 5 WATCH key [key ...] \u76d1\u89c6\u4e00\u4e2a(\u6216\u591a\u4e2a) key \uff0c\u5982\u679c\u5728\u4e8b\u52a1\u6267\u884c\u4e4b\u524d\u8fd9\u4e2a(\u6216\u8fd9\u4e9b) key \u88ab\u5176\u4ed6\u547d\u4ee4\u6240\u6539\u52a8\uff0c\u90a3\u4e48\u4e8b\u52a1\u5c06\u88ab\u6253\u65ad\u3002","title":"2. \u4e8b\u52a1\u547d\u4ee4"},{"location":"linux/nosql/redis/redis.arrairs/#3","text":"\u4ee5\u4e0b\u662f\u4e00\u4e2a\u4e8b\u52a1\u7684\u4f8b\u5b50\uff0c \u5b83\u5148\u4ee5 MULTI \u5f00\u59cb\u4e00\u4e2a\u4e8b\u52a1\uff0c \u7136\u540e\u5c06\u591a\u4e2a\u547d\u4ee4\u5165\u961f\u5230\u4e8b\u52a1\u4e2d\uff0c \u6700\u540e\u7531 EXEC \u547d\u4ee4\u89e6\u53d1\u4e8b\u52a1\uff0c \u4e00\u5e76\u6267\u884c\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u547d\u4ee4\uff1a 127.0.0.1:6379> select 6 (error) NOAUTH Authentication required. 127.0.0.1:6379> AUTH cmz OK 127.0.0.1:6379> select 6 OK 127.0.0.1:6379[6]> MULTI OK 127.0.0.1:6379[6]> EXEC (empty list or set) 127.0.0.1:6379[6]> set k1 1 OK 127.0.0.1:6379[6]> set k2 2 OK 127.0.0.1:6379[6]> set k3 3 OK 127.0.0.1:6379[6]> keys * 1) \"k3\" 2) \"k2\" 3) \"k1\" 127.0.0.1:6379[6]> MGET k1 k2 k3 1) \"1\" 2) \"2\" 3) \"3\" 127.0.0.1:6379[6]> MULTI OK 127.0.0.1:6379[6]> set k1 11 QUEUED 127.0.0.1:6379[6]> set k2 22 QUEUED 127.0.0.1:6379[6]> set k3 33 QUEUED 127.0.0.1:6379[6]> EXEC 1) OK 2) OK 3) OK 127.0.0.1:6379[6]> MGET k1 k2 k3 1) \"11\" 2) \"22\" 3) \"33\" \u6ce8\u610f \u5355\u4e2a Redis \u547d\u4ee4\u7684\u6267\u884c\u662f\u539f\u5b50\u6027\u7684\uff0c\u4f46 Redis \u6ca1\u6709\u5728\u4e8b\u52a1\u4e0a\u589e\u52a0\u4efb\u4f55\u7ef4\u6301\u539f\u5b50\u6027\u7684\u673a\u5236\uff0c\u6240\u4ee5 Redis \u4e8b\u52a1\u7684\u6267\u884c\u5e76\u4e0d\u662f\u539f\u5b50\u6027\u7684\u3002 \u4e8b\u52a1\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u6253\u5305\u7684\u6279\u91cf\u6267\u884c\u811a\u672c\uff0c\u4f46\u6279\u91cf\u6307\u4ee4\u5e76\u975e\u539f\u5b50\u5316\u7684\u64cd\u4f5c\uff0c\u4e2d\u95f4\u67d0\u6761\u6307\u4ee4\u7684\u5931\u8d25\u4e0d\u4f1a\u5bfc\u81f4\u524d\u9762\u5df2\u505a\u6307\u4ee4\u7684\u56de\u6eda\uff0c\u4e5f\u4e0d\u4f1a\u9020\u6210\u540e\u7eed\u7684\u6307\u4ee4\u4e0d\u505a\u3002 127.0.0.1:6379[6]> MULTI OK 127.0.0.1:6379[6]> set a aaa QUEUED 127.0.0.1:6379[6]> set b bbb QUEUED 127.0.0.1:6379[6]> set c ccc QUEUED 127.0.0.1:6379[6]> exec 1) OK 2) OK 3) OK \u5982\u679c\u5728 set b bbb \u5904\u5931\u8d25\uff0cset a \u5df2\u6210\u529f\u4e0d\u4f1a\u56de\u6eda\uff0cset c \u8fd8\u4f1a\u7ee7\u7eed\u6267\u884c\u3002","title":"3. \u5b9e\u4f8b"},{"location":"linux/nosql/redis/redis.auth/","text":"Redis \u8ba4\u8bc1 1. \u4ecb\u7ecd \u00b6 redis\u6ca1\u6709\u5b9e\u73b0\u8bbf\u95ee\u63a7\u5236\u8fd9\u4e2a\u529f\u80fd\uff0c\u4f46\u662f\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u53ef\u4ee5\u7f16\u8f91redis.conf\u914d\u7f6e\u6765\u542f\u7528\u8ba4\u8bc1\u3002 2. \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 \u00b6 root@manage01:/usr/local/redis# cat conf/redis.conf daemonize yes pidfile \"/usr/local/redis/log/redis.pid\" port 6379 timeout 300 loglevel debug logfile \"/usr/local/redis/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/redis/data\" appendonly no appendfsync always bind 0.0.0.0 requirepass cmz root@manage01:/usr/local/redis# egrep requirepass conf/redis.conf requirepass cmz \u91cd\u542fredis\u3002 3. \u6d4b\u8bd5 \u00b6 3.1 \u542f\u52a8\u5e26\u5bc6\u7801 \u00b6 root@manage01:/home/loocha# source /etc/profile root@manage01:/home/loocha# redis-cli 127.0.0.1:6379> keys * (error) NOAUTH Authentication required. 127.0.0.1:6379> root@manage01:/home/loocha# redis-cli -a cmz Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. 127.0.0.1:6379> keys * 1) \"k1\" \u7ec8\u7aef\u83b7\u53d6\u5bc6\u7801 127.0.0.1:6379> config get requirepass 1) \"requirepass\" 2) \"cmz\" 3.2 \u7ec8\u7aef\u8ba4\u8bc1 \u00b6 root@manage01:/home/loocha# redis-cli 127.0.0.1:6379> AUTH cmz OK 127.0.0.1:6379> keys * 1) \"k1\" \u6ce8\u610f \u542f\u52a8\u811a\u672c\u9700\u8981\u6839\u636e\u662f\u5426\u6709\u5bc6\u7801\u6765\u914d\u7f6e\u3002","title":"03. redis \u8ba4\u8bc1"},{"location":"linux/nosql/redis/redis.auth/#1","text":"redis\u6ca1\u6709\u5b9e\u73b0\u8bbf\u95ee\u63a7\u5236\u8fd9\u4e2a\u529f\u80fd\uff0c\u4f46\u662f\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u7684\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u53ef\u4ee5\u7f16\u8f91redis.conf\u914d\u7f6e\u6765\u542f\u7528\u8ba4\u8bc1\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.auth/#2","text":"root@manage01:/usr/local/redis# cat conf/redis.conf daemonize yes pidfile \"/usr/local/redis/log/redis.pid\" port 6379 timeout 300 loglevel debug logfile \"/usr/local/redis/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/redis/data\" appendonly no appendfsync always bind 0.0.0.0 requirepass cmz root@manage01:/usr/local/redis# egrep requirepass conf/redis.conf requirepass cmz \u91cd\u542fredis\u3002","title":"2. \u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},{"location":"linux/nosql/redis/redis.auth/#3","text":"","title":"3. \u6d4b\u8bd5"},{"location":"linux/nosql/redis/redis.auth/#31","text":"root@manage01:/home/loocha# source /etc/profile root@manage01:/home/loocha# redis-cli 127.0.0.1:6379> keys * (error) NOAUTH Authentication required. 127.0.0.1:6379> root@manage01:/home/loocha# redis-cli -a cmz Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. 127.0.0.1:6379> keys * 1) \"k1\" \u7ec8\u7aef\u83b7\u53d6\u5bc6\u7801 127.0.0.1:6379> config get requirepass 1) \"requirepass\" 2) \"cmz\"","title":"3.1 \u542f\u52a8\u5e26\u5bc6\u7801"},{"location":"linux/nosql/redis/redis.auth/#32","text":"root@manage01:/home/loocha# redis-cli 127.0.0.1:6379> AUTH cmz OK 127.0.0.1:6379> keys * 1) \"k1\" \u6ce8\u610f \u542f\u52a8\u811a\u672c\u9700\u8981\u6839\u636e\u662f\u5426\u6709\u5bc6\u7801\u6765\u914d\u7f6e\u3002","title":"3.2 \u7ec8\u7aef\u8ba4\u8bc1"},{"location":"linux/nosql/redis/redis.avalanche/","text":"Redis \u96ea\u5d29 1. \u4ecb\u7ecd \u00b6 \u7f13\u5b58\u96ea\u5d29\u901a\u4fd7\u7b80\u5355\u7684\u7406\u89e3\u5c31\u662f\uff1a\u7531\u4e8e\u539f\u6709\u7f13\u5b58\u5931\u6548\uff08\u6216\u8005\u6570\u636e\u672a\u52a0\u8f7d\u5230\u7f13\u5b58\u4e2d\uff09\uff0c\u65b0\u7f13\u5b58\u672a\u5230\u671f\u95f4\uff08\u7f13\u5b58\u6b63\u5e38\u4eceRedis\u4e2d\u83b7\u53d6\uff0c\u5982\u4e0b\u56fe\uff09\u6240\u6709\u539f\u672c\u5e94\u8be5\u8bbf\u95ee\u7f13\u5b58\u7684\u8bf7\u6c42\u90fd\u53bb\u67e5\u8be2\u6570\u636e\u5e93\u4e86\uff0c\u800c\u5bf9\u6570\u636e\u5e93CPU\u548c\u5185\u5b58\u9020\u6210\u5de8\u5927\u538b\u529b\uff0c\u4e25\u91cd\u7684\u4f1a\u9020\u6210\u6570\u636e\u5e93\u5b95\u673a\uff0c\u9020\u6210\u7cfb\u7edf\u7684\u5d29\u6e83\u3002 \u6b63\u5e38\u8bbf\u95ee: \u7f13\u5b58\u5931\u6548\u8bbf\u95ee: 2. \u5206\u6790 \u00b6 \u7f13\u5b58\u5931\u6548\u65f6\u7684\u96ea\u5d29\u6548\u5e94\u5bf9\u5e95\u5c42\u7cfb\u7edf\u7684\u51b2\u51fb\u975e\u5e38\u53ef\u6015\uff01\u90a3\u6709\u4ec0\u4e48\u529e\u6cd5\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f\u57fa\u672c\u89e3\u51b3\u601d\u8def\u5982\u4e0b\uff1a \u7b2c\u4e00\uff0c\u5927\u591a\u6570\u7cfb\u7edf\u8bbe\u8ba1\u8005\u8003\u8651\u7528\u52a0\u9501\u6216\u8005\u961f\u5217\u7684\u65b9\u5f0f\u4fdd\u8bc1\u6765\u4fdd\u8bc1\u4e0d\u4f1a\u6709\u5927\u91cf\u7684\u7ebf\u7a0b\u5bf9\u6570\u636e\u5e93\u4e00\u6b21\u6027\u8fdb\u884c\u8bfb\u5199\uff0c\u907f\u514d\u7f13\u5b58\u5931\u6548\u65f6\u5bf9\u6570\u636e\u5e93\u9020\u6210\u592a\u5927\u7684\u538b\u529b\uff0c\u867d\u7136\u80fd\u591f\u5728\u4e00\u5b9a\u7684\u7a0b\u5ea6\u4e0a\u7f13\u89e3\u4e86\u6570\u636e\u5e93\u7684\u538b\u529b\u4f46\u662f\u4e0e\u6b64\u540c\u65f6\u53c8\u964d\u4f4e\u4e86\u7cfb\u7edf\u7684\u541e\u5410\u91cf\u3002 \u7b2c\u4e8c\uff0c\u5206\u6790\u7528\u6237\u7684\u884c\u4e3a\uff0c\u5c3d\u91cf\u8ba9\u7f13\u5b58\u5931\u6548\u7684\u65f6\u95f4\u5747\u5300\u5206\u5e03\u3002 \u7b2c\u4e09\uff0c\u5982\u679c\u662f\u56e0\u4e3a\u67d0\u53f0\u7f13\u5b58\u670d\u52a1\u5668\u5b95\u673a\uff0c\u53ef\u4ee5\u8003\u8651\u505a\u4e3b\u5907\uff0c\u6bd4\u5982\uff1aredis\u4e3b\u5907\uff0c\u4f46\u662f\u53cc\u7f13\u5b58\u6d89\u53ca\u5230\u66f4\u65b0\u4e8b\u52a1\u7684\u95ee\u9898\uff0cupdate\u53ef\u80fd\u8bfb\u5230\u810f\u6570\u636e\uff0c\u9700\u8981\u597d\u597d\u89e3\u51b3\u3002 3. \u89e3\u51b3\u65b9\u6848 \u00b6 1. \u5728\u7f13\u5b58\u5931\u6548\u540e\uff0c\u901a\u8fc7\u52a0\u9501\u6216\u8005\u961f\u5217\u6765\u63a7\u5236\u8bfb\u6570\u636e\u5e93\u5199\u7f13\u5b58\u7684\u7ebf\u7a0b\u6570\u91cf\u3002\u6bd4\u5982\u5bf9\u67d0\u4e2akey\u53ea\u5141\u8bb8\u4e00\u4e2a\u7ebf\u7a0b\u67e5\u8be2\u6570\u636e\u548c\u5199\u7f13\u5b58\uff0c\u5176\u4ed6\u7ebf\u7a0b\u7b49\u5f85\u3002 \u6ce8\u610f:\u52a0\u9501\u6392\u961f\u53ea\u662f\u4e3a\u4e86\u51cf\u8f7b\u6570\u636e\u5e93\u7684\u538b\u529b\uff0c\u5e76\u6ca1\u6709\u63d0\u9ad8\u7cfb\u7edf\u541e\u5410\u91cf\u3002\u5047\u8bbe\u5728\u9ad8\u5e76\u53d1\u4e0b\uff0c\u7f13\u5b58\u91cd\u5efa\u671f\u95f4key\u662f\u9501\u7740\u7684\uff0c\u8fd9\u662f\u8fc7\u67651000\u4e2a\u8bf7\u6c42999\u4e2a\u90fd\u5728\u963b\u585e\u7684\u3002\u540c\u6837\u4f1a\u5bfc\u81f4\u7528\u6237\u7b49\u5f85\u8d85\u65f6\uff0c\u8fd9\u662f\u4e2a\u6cbb\u6807\u4e0d\u6cbb\u672c\u7684\u65b9\u6cd5\u3002 2. \u4e0d\u540c\u7684key\uff0c\u8bbe\u7f6e\u4e0d\u540c\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u8ba9\u7f13\u5b58\u5931\u6548\u7684\u65f6\u95f4\u70b9\u5c3d\u91cf\u5747\u5300\u3002 3. \u505a\u4e8c\u7ea7\u7f13\u5b58\uff0cA1\u4e3a\u539f\u59cb\u7f13\u5b58\uff0cA2\u4e3a\u62f7\u8d1d\u7f13\u5b58\uff0cA1\u5931\u6548\u65f6\uff0c\u53ef\u4ee5\u8bbf\u95eeA2\uff0cA1\u7f13\u5b58\u5931\u6548\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u77ed\u671f\uff0cA2\u8bbe\u7f6e\u4e3a\u957f\u671f\u3002","title":"15. redis \u96ea\u5d29"},{"location":"linux/nosql/redis/redis.avalanche/#1","text":"\u7f13\u5b58\u96ea\u5d29\u901a\u4fd7\u7b80\u5355\u7684\u7406\u89e3\u5c31\u662f\uff1a\u7531\u4e8e\u539f\u6709\u7f13\u5b58\u5931\u6548\uff08\u6216\u8005\u6570\u636e\u672a\u52a0\u8f7d\u5230\u7f13\u5b58\u4e2d\uff09\uff0c\u65b0\u7f13\u5b58\u672a\u5230\u671f\u95f4\uff08\u7f13\u5b58\u6b63\u5e38\u4eceRedis\u4e2d\u83b7\u53d6\uff0c\u5982\u4e0b\u56fe\uff09\u6240\u6709\u539f\u672c\u5e94\u8be5\u8bbf\u95ee\u7f13\u5b58\u7684\u8bf7\u6c42\u90fd\u53bb\u67e5\u8be2\u6570\u636e\u5e93\u4e86\uff0c\u800c\u5bf9\u6570\u636e\u5e93CPU\u548c\u5185\u5b58\u9020\u6210\u5de8\u5927\u538b\u529b\uff0c\u4e25\u91cd\u7684\u4f1a\u9020\u6210\u6570\u636e\u5e93\u5b95\u673a\uff0c\u9020\u6210\u7cfb\u7edf\u7684\u5d29\u6e83\u3002 \u6b63\u5e38\u8bbf\u95ee: \u7f13\u5b58\u5931\u6548\u8bbf\u95ee:","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.avalanche/#2","text":"\u7f13\u5b58\u5931\u6548\u65f6\u7684\u96ea\u5d29\u6548\u5e94\u5bf9\u5e95\u5c42\u7cfb\u7edf\u7684\u51b2\u51fb\u975e\u5e38\u53ef\u6015\uff01\u90a3\u6709\u4ec0\u4e48\u529e\u6cd5\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f\u57fa\u672c\u89e3\u51b3\u601d\u8def\u5982\u4e0b\uff1a \u7b2c\u4e00\uff0c\u5927\u591a\u6570\u7cfb\u7edf\u8bbe\u8ba1\u8005\u8003\u8651\u7528\u52a0\u9501\u6216\u8005\u961f\u5217\u7684\u65b9\u5f0f\u4fdd\u8bc1\u6765\u4fdd\u8bc1\u4e0d\u4f1a\u6709\u5927\u91cf\u7684\u7ebf\u7a0b\u5bf9\u6570\u636e\u5e93\u4e00\u6b21\u6027\u8fdb\u884c\u8bfb\u5199\uff0c\u907f\u514d\u7f13\u5b58\u5931\u6548\u65f6\u5bf9\u6570\u636e\u5e93\u9020\u6210\u592a\u5927\u7684\u538b\u529b\uff0c\u867d\u7136\u80fd\u591f\u5728\u4e00\u5b9a\u7684\u7a0b\u5ea6\u4e0a\u7f13\u89e3\u4e86\u6570\u636e\u5e93\u7684\u538b\u529b\u4f46\u662f\u4e0e\u6b64\u540c\u65f6\u53c8\u964d\u4f4e\u4e86\u7cfb\u7edf\u7684\u541e\u5410\u91cf\u3002 \u7b2c\u4e8c\uff0c\u5206\u6790\u7528\u6237\u7684\u884c\u4e3a\uff0c\u5c3d\u91cf\u8ba9\u7f13\u5b58\u5931\u6548\u7684\u65f6\u95f4\u5747\u5300\u5206\u5e03\u3002 \u7b2c\u4e09\uff0c\u5982\u679c\u662f\u56e0\u4e3a\u67d0\u53f0\u7f13\u5b58\u670d\u52a1\u5668\u5b95\u673a\uff0c\u53ef\u4ee5\u8003\u8651\u505a\u4e3b\u5907\uff0c\u6bd4\u5982\uff1aredis\u4e3b\u5907\uff0c\u4f46\u662f\u53cc\u7f13\u5b58\u6d89\u53ca\u5230\u66f4\u65b0\u4e8b\u52a1\u7684\u95ee\u9898\uff0cupdate\u53ef\u80fd\u8bfb\u5230\u810f\u6570\u636e\uff0c\u9700\u8981\u597d\u597d\u89e3\u51b3\u3002","title":"2. \u5206\u6790"},{"location":"linux/nosql/redis/redis.avalanche/#3","text":"1. \u5728\u7f13\u5b58\u5931\u6548\u540e\uff0c\u901a\u8fc7\u52a0\u9501\u6216\u8005\u961f\u5217\u6765\u63a7\u5236\u8bfb\u6570\u636e\u5e93\u5199\u7f13\u5b58\u7684\u7ebf\u7a0b\u6570\u91cf\u3002\u6bd4\u5982\u5bf9\u67d0\u4e2akey\u53ea\u5141\u8bb8\u4e00\u4e2a\u7ebf\u7a0b\u67e5\u8be2\u6570\u636e\u548c\u5199\u7f13\u5b58\uff0c\u5176\u4ed6\u7ebf\u7a0b\u7b49\u5f85\u3002 \u6ce8\u610f:\u52a0\u9501\u6392\u961f\u53ea\u662f\u4e3a\u4e86\u51cf\u8f7b\u6570\u636e\u5e93\u7684\u538b\u529b\uff0c\u5e76\u6ca1\u6709\u63d0\u9ad8\u7cfb\u7edf\u541e\u5410\u91cf\u3002\u5047\u8bbe\u5728\u9ad8\u5e76\u53d1\u4e0b\uff0c\u7f13\u5b58\u91cd\u5efa\u671f\u95f4key\u662f\u9501\u7740\u7684\uff0c\u8fd9\u662f\u8fc7\u67651000\u4e2a\u8bf7\u6c42999\u4e2a\u90fd\u5728\u963b\u585e\u7684\u3002\u540c\u6837\u4f1a\u5bfc\u81f4\u7528\u6237\u7b49\u5f85\u8d85\u65f6\uff0c\u8fd9\u662f\u4e2a\u6cbb\u6807\u4e0d\u6cbb\u672c\u7684\u65b9\u6cd5\u3002 2. \u4e0d\u540c\u7684key\uff0c\u8bbe\u7f6e\u4e0d\u540c\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u8ba9\u7f13\u5b58\u5931\u6548\u7684\u65f6\u95f4\u70b9\u5c3d\u91cf\u5747\u5300\u3002 3. \u505a\u4e8c\u7ea7\u7f13\u5b58\uff0cA1\u4e3a\u539f\u59cb\u7f13\u5b58\uff0cA2\u4e3a\u62f7\u8d1d\u7f13\u5b58\uff0cA1\u5931\u6548\u65f6\uff0c\u53ef\u4ee5\u8bbf\u95eeA2\uff0cA1\u7f13\u5b58\u5931\u6548\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u77ed\u671f\uff0cA2\u8bbe\u7f6e\u4e3a\u957f\u671f\u3002","title":"3. \u89e3\u51b3\u65b9\u6848"},{"location":"linux/nosql/redis/redis.breakdown/","text":"Redis \u7f13\u5b58\u51fb\u7a7f 1. \u4ecb\u7ecd \u00b6 \u5728\u8c08\u8bba\u7f13\u5b58\u51fb\u7a7f\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u56de\u5fc6\u4e0b\u4ece\u7f13\u5b58\u4e2d\u52a0\u8f7d\u6570\u636e\u7684\u903b\u8f91\uff0c\u5982\u4e0b\u56fe\u6240\u793a \u56e0\u6b64\uff0c\u5982\u679c\u9ed1\u5ba2\u6bcf\u6b21\u6545\u610f\u67e5\u8be2\u4e00\u4e2a\u5728\u7f13\u5b58\u5185\u5fc5\u7136\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u5bfc\u81f4\u6bcf\u6b21\u8bf7\u6c42\u90fd\u8981\u53bb\u5b58\u50a8\u5c42\u53bb\u67e5\u8be2\uff0c\u8fd9\u6837\u7f13\u5b58\u5c31\u5931\u53bb\u4e86\u610f\u4e49\u3002\u5982\u679c\u5728\u5927\u6d41\u91cf\u4e0b\u6570\u636e\u5e93\u53ef\u80fd\u6302\u6389\u3002\u8fd9\u5c31\u662f\u7f13\u5b58\u51fb\u7a7f\u3002 \u573a\u666f\u5982\u4e0b\u56fe\u6240\u793a \u6211\u4eec\u6b63\u5e38\u4eba\u5728\u767b\u5f55\u9996\u9875\u7684\u65f6\u5019\uff0c\u90fd\u662f\u6839\u636euserID\u6765\u547d\u4e2d\u6570\u636e\uff0c\u7136\u800c\u9ed1\u5ba2\u7684\u76ee\u7684\u662f\u7834\u574f\u4f60\u7684\u7cfb\u7edf\uff0c\u9ed1\u5ba2\u53ef\u4ee5\u968f\u673a\u751f\u6210\u4e00\u5806userID,\u7136\u540e\u5c06\u8fd9\u4e9b\u8bf7\u6c42\u603c\u5230\u4f60\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u8fd9\u4e9b\u8bf7\u6c42\u5728\u7f13\u5b58\u4e2d\u4e0d\u5b58\u5728\uff0c\u5c31\u4f1a\u7a7f\u8fc7\u7f13\u5b58\uff0c\u76f4\u63a5\u603c\u5230\u6570\u636e\u5e93\u4e0a,\u4ece\u800c\u9020\u6210\u6570\u636e\u5e93\u8fde\u63a5\u5f02\u5e38\u3002 2. \u89e3\u51b3\u65b9\u6848 \u00b6 \u5728\u8fd9\u91cc\u6211\u4eec\u7ed9\u51fa\u4e09\u5957\u89e3\u51b3\u65b9\u6848\uff0c\u5927\u5bb6\u6839\u636e\u9879\u76ee\u4e2d\u7684\u5b9e\u9645\u60c5\u51b5\uff0c\u9009\u62e9\u4f7f\u7528. \u8bb2\u4e0b\u8ff0\u4e09\u79cd\u65b9\u6848\u524d\uff0c\u6211\u4eec\u5148\u56de\u5fc6\u4e0bredis\u7684setnx\u65b9\u6cd5 SETNX key value \u5c06 key \u7684\u503c\u8bbe\u4e3a value \uff0c\u5f53\u4e14\u4ec5\u5f53 key \u4e0d\u5b58\u5728\u3002 \u82e5\u7ed9\u5b9a\u7684 key \u5df2\u7ecf\u5b58\u5728\uff0c\u5219 SETNX \u4e0d\u505a\u4efb\u4f55\u52a8\u4f5c\u3002 SETNX \u662f\u300eSET if Not eXists\u300f(\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5219 SET)\u7684\u7b80\u5199\u3002 \u53ef\u7528\u7248\u672c\uff1a>= 1.0.0 \u65f6\u95f4\u590d\u6742\u5ea6\uff1a O(1) \u8fd4\u56de\u503c\uff1a \u8bbe\u7f6e\u6210\u529f\uff0c\u8fd4\u56de 1\u3002\u8bbe\u7f6e\u5931\u8d25\uff0c\u8fd4\u56de 0 \u3002 2.1 \u65b9\u6cd51-\u4e92\u65a5\u9501 \u00b6 \u8be5\u65b9\u6cd5\u662f\u6bd4\u8f83\u666e\u904d\u7684\u505a\u6cd5\uff0c\u5373\uff0c\u5728\u6839\u636ekey\u83b7\u5f97\u7684value\u503c\u4e3a\u7a7a\u65f6\uff0c\u5148\u9501\u4e0a\uff0c\u518d\u4ece\u6570\u636e\u5e93\u52a0\u8f7d\uff0c\u52a0\u8f7d\u5b8c\u6bd5\uff0c\u91ca\u653e\u9501\u3002\u82e5\u5176\u4ed6\u7ebf\u7a0b\u53d1\u73b0\u83b7\u53d6\u9501\u5931\u8d25\uff0c\u5219\u7761\u772050ms\u540e\u91cd\u8bd5\uff0c\u81f3\u4e8e\u9501\u7684\u7c7b\u578b\uff0c\u5355\u673a\u73af\u5883\u7528\u5e76\u53d1\u5305\u7684Lock\u7c7b\u578b\u5c31\u884c\uff0c\u96c6\u7fa4\u73af\u5883\u5219\u4f7f\u7528\u5206\u5e03\u5f0f\u9501( redis\u7684setnx) 2.2 \u65b9\u6cd52-\u5f02\u6b65\u6784\u5efa\u7f13\u5b58 \u00b6 \u5728\u8fd9\u79cd\u65b9\u6848\u4e0b\uff0c\u6784\u5efa\u7f13\u5b58\u91c7\u53d6\u5f02\u6b65\u7b56\u7565\uff0c\u4f1a\u4ece\u7ebf\u7a0b\u6c60\u4e2d\u53d6\u7ebf\u7a0b\u6765\u5f02\u6b65\u6784\u5efa\u7f13\u5b58\uff0c\u4ece\u800c\u4e0d\u4f1a\u8ba9\u6240\u6709\u7684\u8bf7\u6c42\u76f4\u63a5\u603c\u5230\u6570\u636e\u5e93\u4e0a\u3002\u8be5\u65b9\u6848redis\u81ea\u5df1\u7ef4\u62a4\u4e00\u4e2atimeout\uff0c\u5f53timeout\u5c0f\u4e8eSystem.currentTimeMillis()\u65f6\uff0c\u5219\u8fdb\u884c\u7f13\u5b58\u66f4\u65b0\uff0c\u5426\u5219\u76f4\u63a5\u8fd4\u56devalue\u503c\u3002 2.3 \u65b9\u6cd53-\u5e03\u9686\u8fc7\u6ee4\u5668 \u00b6 \u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u5de8\u5927\u7528\u5904\u5c31\u662f\uff0c\u80fd\u591f\u8fc5\u901f\u5224\u65ad\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u5728\u4e00\u4e2a\u96c6\u5408\u4e2d","title":"14. redis \u51fb\u7a7f"},{"location":"linux/nosql/redis/redis.breakdown/#1","text":"\u5728\u8c08\u8bba\u7f13\u5b58\u51fb\u7a7f\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u56de\u5fc6\u4e0b\u4ece\u7f13\u5b58\u4e2d\u52a0\u8f7d\u6570\u636e\u7684\u903b\u8f91\uff0c\u5982\u4e0b\u56fe\u6240\u793a \u56e0\u6b64\uff0c\u5982\u679c\u9ed1\u5ba2\u6bcf\u6b21\u6545\u610f\u67e5\u8be2\u4e00\u4e2a\u5728\u7f13\u5b58\u5185\u5fc5\u7136\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u5bfc\u81f4\u6bcf\u6b21\u8bf7\u6c42\u90fd\u8981\u53bb\u5b58\u50a8\u5c42\u53bb\u67e5\u8be2\uff0c\u8fd9\u6837\u7f13\u5b58\u5c31\u5931\u53bb\u4e86\u610f\u4e49\u3002\u5982\u679c\u5728\u5927\u6d41\u91cf\u4e0b\u6570\u636e\u5e93\u53ef\u80fd\u6302\u6389\u3002\u8fd9\u5c31\u662f\u7f13\u5b58\u51fb\u7a7f\u3002 \u573a\u666f\u5982\u4e0b\u56fe\u6240\u793a \u6211\u4eec\u6b63\u5e38\u4eba\u5728\u767b\u5f55\u9996\u9875\u7684\u65f6\u5019\uff0c\u90fd\u662f\u6839\u636euserID\u6765\u547d\u4e2d\u6570\u636e\uff0c\u7136\u800c\u9ed1\u5ba2\u7684\u76ee\u7684\u662f\u7834\u574f\u4f60\u7684\u7cfb\u7edf\uff0c\u9ed1\u5ba2\u53ef\u4ee5\u968f\u673a\u751f\u6210\u4e00\u5806userID,\u7136\u540e\u5c06\u8fd9\u4e9b\u8bf7\u6c42\u603c\u5230\u4f60\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u8fd9\u4e9b\u8bf7\u6c42\u5728\u7f13\u5b58\u4e2d\u4e0d\u5b58\u5728\uff0c\u5c31\u4f1a\u7a7f\u8fc7\u7f13\u5b58\uff0c\u76f4\u63a5\u603c\u5230\u6570\u636e\u5e93\u4e0a,\u4ece\u800c\u9020\u6210\u6570\u636e\u5e93\u8fde\u63a5\u5f02\u5e38\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.breakdown/#2","text":"\u5728\u8fd9\u91cc\u6211\u4eec\u7ed9\u51fa\u4e09\u5957\u89e3\u51b3\u65b9\u6848\uff0c\u5927\u5bb6\u6839\u636e\u9879\u76ee\u4e2d\u7684\u5b9e\u9645\u60c5\u51b5\uff0c\u9009\u62e9\u4f7f\u7528. \u8bb2\u4e0b\u8ff0\u4e09\u79cd\u65b9\u6848\u524d\uff0c\u6211\u4eec\u5148\u56de\u5fc6\u4e0bredis\u7684setnx\u65b9\u6cd5 SETNX key value \u5c06 key \u7684\u503c\u8bbe\u4e3a value \uff0c\u5f53\u4e14\u4ec5\u5f53 key \u4e0d\u5b58\u5728\u3002 \u82e5\u7ed9\u5b9a\u7684 key \u5df2\u7ecf\u5b58\u5728\uff0c\u5219 SETNX \u4e0d\u505a\u4efb\u4f55\u52a8\u4f5c\u3002 SETNX \u662f\u300eSET if Not eXists\u300f(\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5219 SET)\u7684\u7b80\u5199\u3002 \u53ef\u7528\u7248\u672c\uff1a>= 1.0.0 \u65f6\u95f4\u590d\u6742\u5ea6\uff1a O(1) \u8fd4\u56de\u503c\uff1a \u8bbe\u7f6e\u6210\u529f\uff0c\u8fd4\u56de 1\u3002\u8bbe\u7f6e\u5931\u8d25\uff0c\u8fd4\u56de 0 \u3002","title":"2. \u89e3\u51b3\u65b9\u6848"},{"location":"linux/nosql/redis/redis.breakdown/#21-1-","text":"\u8be5\u65b9\u6cd5\u662f\u6bd4\u8f83\u666e\u904d\u7684\u505a\u6cd5\uff0c\u5373\uff0c\u5728\u6839\u636ekey\u83b7\u5f97\u7684value\u503c\u4e3a\u7a7a\u65f6\uff0c\u5148\u9501\u4e0a\uff0c\u518d\u4ece\u6570\u636e\u5e93\u52a0\u8f7d\uff0c\u52a0\u8f7d\u5b8c\u6bd5\uff0c\u91ca\u653e\u9501\u3002\u82e5\u5176\u4ed6\u7ebf\u7a0b\u53d1\u73b0\u83b7\u53d6\u9501\u5931\u8d25\uff0c\u5219\u7761\u772050ms\u540e\u91cd\u8bd5\uff0c\u81f3\u4e8e\u9501\u7684\u7c7b\u578b\uff0c\u5355\u673a\u73af\u5883\u7528\u5e76\u53d1\u5305\u7684Lock\u7c7b\u578b\u5c31\u884c\uff0c\u96c6\u7fa4\u73af\u5883\u5219\u4f7f\u7528\u5206\u5e03\u5f0f\u9501( redis\u7684setnx)","title":"2.1 \u65b9\u6cd51-\u4e92\u65a5\u9501"},{"location":"linux/nosql/redis/redis.breakdown/#22-2-","text":"\u5728\u8fd9\u79cd\u65b9\u6848\u4e0b\uff0c\u6784\u5efa\u7f13\u5b58\u91c7\u53d6\u5f02\u6b65\u7b56\u7565\uff0c\u4f1a\u4ece\u7ebf\u7a0b\u6c60\u4e2d\u53d6\u7ebf\u7a0b\u6765\u5f02\u6b65\u6784\u5efa\u7f13\u5b58\uff0c\u4ece\u800c\u4e0d\u4f1a\u8ba9\u6240\u6709\u7684\u8bf7\u6c42\u76f4\u63a5\u603c\u5230\u6570\u636e\u5e93\u4e0a\u3002\u8be5\u65b9\u6848redis\u81ea\u5df1\u7ef4\u62a4\u4e00\u4e2atimeout\uff0c\u5f53timeout\u5c0f\u4e8eSystem.currentTimeMillis()\u65f6\uff0c\u5219\u8fdb\u884c\u7f13\u5b58\u66f4\u65b0\uff0c\u5426\u5219\u76f4\u63a5\u8fd4\u56devalue\u503c\u3002","title":"2.2 \u65b9\u6cd52-\u5f02\u6b65\u6784\u5efa\u7f13\u5b58"},{"location":"linux/nosql/redis/redis.breakdown/#23-3-","text":"\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u5de8\u5927\u7528\u5904\u5c31\u662f\uff0c\u80fd\u591f\u8fc5\u901f\u5224\u65ad\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u5728\u4e00\u4e2a\u96c6\u5408\u4e2d","title":"2.3 \u65b9\u6cd53-\u5e03\u9686\u8fc7\u6ee4\u5668"},{"location":"linux/nosql/redis/redis.cache_policy/","text":"Redis\u7f13\u5b58\u6dd8\u6c70\u7b56\u7565 1. \u4ecb\u7ecd \u00b6 \u53c2\u8003\u5b98\u7f51 \u5f53\u5b9e\u9645\u5185\u5b58\u8d85\u51fa maxmemory \u65f6\uff0cRedis \u63d0\u4f9b\u4e86\u51e0\u79cd\u53ef\u9009\u7b56\u7565 (maxmemory-policy) \u6765\u8ba9\u7528\u6237\u81ea\u5df1\u51b3\u5b9a\u6dd8\u6c70\u54ea\u4e9bkey\u3002\u603b\u7ed3\u5982\u4e0b\uff1a maxmemory \u7528\u4e8e\u6307\u5b9a Redis \u80fd\u4f7f\u7528\u7684\u6700\u5927\u5185\u5b58\u3002\u65e2\u53ef\u4ee5\u5728 redis.conf \u6587\u4ef6\u4e2d\u8bbe\u7f6e, \u4e5f\u53ef\u4ee5\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u901a\u8fc7 CONFIG SET \u547d\u4ee4\u52a8\u6001\u4fee\u6539\u3002\u4f8b\u5982, \u8981\u8bbe\u7f6e 100MB \u7684\u5185\u5b58\u9650\u5236, \u53ef\u4ee5\u5728 redis.conf \u6587\u4ef6\u4e2d\u8fd9\u6837\u914d\u7f6e\uff1a maxmemory 100mb \u5c06maxmemory\u8bbe\u7f6e\u4e3a0, \u5219\u8868\u793a\u4e0d\u8fdb\u884c\u5185\u5b58\u9650\u5236\u3002\u5f53\u7136, \u5bf932\u4f4d\u7cfb\u7edf\u6765\u8bf4\u6709\u4e00\u4e2a\u9690\u6027\u7684\u9650\u5236\u6761\u4ef6: \u6700\u591a 3GB \u5185\u5b58\u3002 \u5f53\u5185\u5b58\u4f7f\u7528\u8fbe\u5230\u6700\u5927\u9650\u5236\u65f6, \u5982\u679c\u9700\u8981\u5b58\u50a8\u65b0\u6570\u636e, \u6839\u636e\u914d\u7f6e\u7684\u7b56\u7565(policies)\u7684\u4e0d\u540c, Redis\u53ef\u80fd\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u4fe1\u606f, \u6216\u8005\u5220\u9664\u90e8\u5206\u8001\u7684\u6570\u636e\u3002 2. \u7b56\u7565 \u00b6 Redis\u63d0\u4f9b\u4e86\u4e0b\u9762\u51e0\u79cd\u6dd8\u6c70\u7b56\u7565\u4f9b\u7528\u6237\u9009\u62e9\uff0c\u5176\u4e2d\u9ed8\u8ba4\u7684\u7b56\u7565\u4e3anoeviction\u7b56\u7565\uff1a noeviction\uff1a\u5f53\u5185\u5b58\u4f7f\u7528\u8fbe\u5230\u9608\u503c\u7684\u65f6\u5019\uff0c\u6240\u6709\u5f15\u8d77\u7533\u8bf7\u5185\u5b58\u7684\u547d\u4ee4\u4f1a\u62a5\u9519\u3002 allkeys-lru\uff1a\u5728\u4e3b\u952e\u7a7a\u95f4\u4e2d\uff0c\u4f18\u5148\u79fb\u9664\u6700\u8fd1\u672a\u4f7f\u7528\u7684key\u3002 volatile-lru\uff1a\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u7a7a\u95f4\u4e2d\uff0c\u4f18\u5148\u79fb\u9664\u6700\u8fd1\u672a\u4f7f\u7528\u7684key\u3002 allkeys-random\uff1a\u5728\u4e3b\u952e\u7a7a\u95f4\u4e2d\uff0c\u968f\u673a\u79fb\u9664\u67d0\u4e2akey\u3002 volatile-random\uff1a\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u7a7a\u95f4\u4e2d\uff0c\u968f\u673a\u79fb\u9664\u67d0\u4e2akey\u3002 volatile-ttl\uff1a\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u7a7a\u95f4\u4e2d\uff0c\u5177\u6709\u66f4\u65e9\u8fc7\u671f\u65f6\u95f4\u7684key\u4f18\u5148\u79fb\u9664\u3002 allkeys-lru\uff1a\u5982\u679c\u6211\u4eec\u7684\u5e94\u7528\u5bf9\u7f13\u5b58\u7684\u8bbf\u95ee\u7b26\u5408\u5e42\u5f8b\u5206\u5e03\uff08\u4e5f\u5c31\u662f\u5b58\u5728\u76f8\u5bf9\u70ed\u70b9\u6570\u636e\uff09\uff0c\u6216\u8005\u6211\u4eec\u4e0d\u592a\u6e05\u695a\u6211\u4eec\u5e94\u7528\u7684\u7f13\u5b58\u8bbf\u95ee\u5206\u5e03\u72b6\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9allkeys-lru\u7b56\u7565\u3002 allkeys-random\uff1a\u5982\u679c\u6211\u4eec\u7684\u5e94\u7528\u5bf9\u4e8e\u7f13\u5b58key\u7684\u8bbf\u95ee\u6982\u7387\u76f8\u7b49\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u7b56\u7565\u3002 volatile-ttl\uff1a\u8fd9\u79cd\u7b56\u7565\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u5411Redis\u63d0\u793a\u54ea\u4e9bkey\u66f4\u9002\u5408\u88abeviction\u3002 volatile-lru\u7b56\u7565\u548cvolatile-random\u7b56\u7565\u9002\u5408\u6211\u4eec\u5c06\u4e00\u4e2aRedis\u5b9e\u4f8b\u65e2\u5e94\u7528\u4e8e\u7f13\u5b58\u548c\u53c8\u5e94\u7528\u4e8e\u6301\u4e45\u5316\u5b58\u50a8\u7684\u65f6\u5019\uff0c\u7136\u800c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u4e24\u4e2aRedis\u5b9e\u4f8b\u6765\u8fbe\u5230\u76f8\u540c\u7684\u6548\u679c\uff0c\u503c\u5f97\u4e00\u63d0\u7684\u662f\u5c06key\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u5b9e\u9645\u4e0a\u4f1a\u6d88\u8017\u66f4\u591a\u7684\u5185\u5b58\uff0c\u56e0\u6b64\u6211\u4eec\u5efa\u8bae\u4f7f\u7528allkeys-lru\u7b56\u7565\u4ece\u800c\u66f4\u6709\u6548\u7387\u7684\u4f7f\u7528\u5185\u5b58\u3002 \u5982\u679c\u6ca1\u6709\u8bbe\u7f6e expire \u7684key, \u4e0d\u6ee1\u8db3\u5148\u51b3\u6761\u4ef6(prerequisites); \u90a3\u4e48 volatile-lru , volatile-random \u548c volatile-ttl \u7b56\u7565\u7684\u884c\u4e3a, \u548c noeviction (\u4e0d\u5220\u9664)\u57fa\u672c\u4e0a\u4e00\u81f4\u3002 \u60a8\u9700\u8981\u6839\u636e\u7cfb\u7edf\u7684\u7279\u5f81, \u6765\u9009\u62e9\u5408\u9002\u7684\u9a71\u9010\u7b56\u7565\u3002 \u5f53\u7136, \u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4e5f\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u52a8\u6001\u8bbe\u7f6e\u9a71\u9010\u7b56\u7565, \u5e76\u901a\u8fc7 INFO \u547d\u4ee4\u76d1\u63a7\u7f13\u5b58\u7684 miss \u548c hit, \u6765\u8fdb\u884c\u8c03\u4f18\u3002 \u4e00\u822c\u6765\u8bf4: \u5982\u679c\u5206\u4e3a\u70ed\u6570\u636e\u4e0e\u51b7\u6570\u636e, \u63a8\u8350\u4f7f\u7528 allkeys-lru \u7b56\u7565\u3002 \u4e5f\u5c31\u662f, \u5176\u4e2d\u4e00\u90e8\u5206key\u7ecf\u5e38\u88ab\u8bfb\u5199. \u5982\u679c\u4e0d\u786e\u5b9a\u5177\u4f53\u7684\u4e1a\u52a1\u7279\u5f81, \u90a3\u4e48 allkeys-lru \u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\u3002 \u5982\u679c\u9700\u8981\u5faa\u73af\u8bfb\u5199\u6240\u6709\u7684key, \u6216\u8005\u5404\u4e2akey\u7684\u8bbf\u95ee\u9891\u7387\u5dee\u4e0d\u591a, \u53ef\u4ee5\u4f7f\u7528 allkeys-random \u7b56\u7565, \u5373\u8bfb\u5199\u6240\u6709\u5143\u7d20\u7684\u6982\u7387\u5dee\u4e0d\u591a\u3002 \u5047\u5982\u8981\u8ba9 Redis \u6839\u636e TTL \u6765\u7b5b\u9009\u9700\u8981\u5220\u9664\u7684key, \u8bf7\u4f7f\u7528 volatile-ttl \u7b56\u7565\u3002 volatile-lru\u548cvolatile-random\u7b56\u7565\u4e3b\u8981\u5e94\u7528\u573a\u666f\u662f: \u65e2\u6709\u7f13\u5b58,\u53c8\u6709\u6301\u4e45key\u7684\u5b9e\u4f8b\u4e2d\u3002 \u4e00\u822c\u6765\u8bf4, \u50cf\u8fd9\u7c7b\u573a\u666f, \u5e94\u8be5\u4f7f\u7528\u4e24\u4e2a\u5355\u72ec\u7684 Redis \u5b9e\u4f8b\u3002 \u503c\u5f97\u4e00\u63d0\u7684\u662f, \u8bbe\u7f6eexpire\u4f1a\u6d88\u8017\u989d\u5916\u7684\u5185\u5b58, \u6240\u4ee5\u4f7f\u7528allkeys-lru\u7b56\u7565, \u53ef\u4ee5\u66f4\u9ad8\u6548\u5730\u5229\u7528\u5185\u5b58, \u56e0\u4e3a\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e0d\u518d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u4e86\u3002 3. \u7f13\u5b58\u66f4\u65b0\u7b56\u7565 \u00b6 3.1 LRU/LFU/FIFO\u7b97\u6cd5\u5254\u9664 \u00b6 \u4f7f\u7528\u573a\u666f\u3002 \u5254\u9664\u7b97\u6cd5\u901a\u5e38\u7528\u4e8e\u7f13\u5b58\u4f7f\u7528\u91cf\u8d85\u8fc7\u4e86\u9884\u8bbe\u7684\u6700\u5927\u503c\u65f6\u5019\uff0c \u5982 \u4f55\u5bf9\u73b0\u6709\u7684\u6570\u636e\u8fdb\u884c\u5254\u9664\u3002 \u4f8b\u5982Redis\u4f7f\u7528maxmemory-policy\u8fd9\u4e2a\u914d\u7f6e\u4f5c\u4e3a\u5185 \u5b58\u6700\u5927\u503c\u540e\u5bf9\u4e8e\u6570\u636e\u7684\u5254\u9664\u7b56\u7565\u3002 \u4e00\u81f4\u6027\u3002 \u8981\u6e05\u7406\u54ea\u4e9b\u6570\u636e\u662f\u7531\u5177\u4f53\u7b97\u6cd5\u51b3\u5b9a\uff0c \u5f00\u53d1\u4eba\u5458\u53ea\u80fd\u51b3\u5b9a\u4f7f\u7528\u54ea \u79cd\u7b97\u6cd5\uff0c \u6240\u4ee5\u6570\u636e\u7684\u4e00\u81f4\u6027\u662f\u6700\u5dee\u7684\u3002 \u7ef4\u62a4\u6210\u672c\u3002 \u7b97\u6cd5\u4e0d\u9700\u8981\u5f00\u53d1\u4eba\u5458\u81ea\u5df1\u6765\u5b9e\u73b0\uff0c \u901a\u5e38\u53ea\u9700\u8981\u914d\u7f6e\u6700\u5927 maxmemory\u548c\u5bf9\u5e94\u7684\u7b56\u7565\u5373\u53ef\u3002 \u5f00\u53d1\u4eba\u5458\u53ea\u9700\u8981\u77e5\u9053\u6bcf\u79cd\u7b97\u6cd5\u7684\u542b\u4e49\uff0c \u9009\u62e9 \u9002\u5408\u81ea\u5df1\u7684\u7b97\u6cd5\u5373\u53ef\u3002 3.2 \u8d85\u65f6\u5254\u9664 \u00b6 \u4f7f\u7528\u573a\u666f\u3002 \u8d85\u65f6\u5254\u9664\u901a\u8fc7\u7ed9\u7f13\u5b58\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c \u8ba9\u5176\u5728\u8fc7\u671f\u65f6\u95f4\u540e \u81ea\u52a8\u5220\u9664\uff0c \u4f8b\u5982Redis\u63d0\u4f9b\u7684expire\u547d\u4ee4\u3002 \u5982\u679c\u4e1a\u52a1\u53ef\u4ee5\u5bb9\u5fcd\u4e00\u6bb5\u65f6\u95f4\u5185\uff0c \u7f13 \u5b58\u5c42\u6570\u636e\u548c\u5b58\u50a8\u5c42\u6570\u636e\u4e0d\u4e00\u81f4\uff0c \u90a3\u4e48\u53ef\u4ee5\u4e3a\u5176\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u5728\u6570\u636e\u8fc7\u671f \u540e\uff0c \u518d\u4ece\u771f\u5b9e\u6570\u636e\u6e90\u83b7\u53d6\u6570\u636e\uff0c \u91cd\u65b0\u653e\u5230\u7f13\u5b58\u5e76\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u4f8b\u5982\u4e00\u4e2a\u89c6 \u9891\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c \u53ef\u4ee5\u5bb9\u5fcd\u51e0\u5206\u949f\u5185\u6570\u636e\u4e0d\u4e00\u81f4\uff0c \u4f46\u662f\u6d89\u53ca\u4ea4\u6613\u65b9\u9762\u7684\u4e1a\u52a1\uff0c \u540e\u679c\u53ef\u60f3\u800c\u77e5\u3002 \u4e00\u81f4\u6027\u3002 \u4e00\u6bb5\u65f6\u95f4\u7a97\u53e3\u5185\uff08\u53d6\u51b3\u4e8e\u8fc7\u671f\u65f6\u95f4\u957f\u77ed\uff09 \u5b58\u5728\u4e00\u81f4\u6027\u95ee\u9898\uff0c \u5373 \u7f13\u5b58\u6570\u636e\u548c\u771f\u5b9e\u6570\u636e\u6e90\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u3002 \u7ef4\u62a4\u6210\u672c\u3002 \u7ef4\u62a4\u6210\u672c\u4e0d\u662f\u5f88\u9ad8\uff0c \u53ea\u9700\u8bbe\u7f6eexpire\u8fc7\u671f\u65f6\u95f4\u5373\u53ef\uff0c \u5f53\u7136\u524d \u63d0\u662f\u5e94\u7528\u65b9\u5141\u8bb8\u8fd9\u6bb5\u65f6\u95f4\u53ef\u80fd\u53d1\u751f\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u3002 3.3 \u4e3b\u52a8\u66f4\u65b0 \u00b6 \u4f7f\u7528\u573a\u666f\u3002 \u5e94\u7528\u65b9\u5bf9\u4e8e\u6570\u636e\u7684\u4e00\u81f4\u6027\u8981\u6c42\u9ad8\uff0c \u9700\u8981\u5728\u771f\u5b9e\u6570\u636e\u66f4\u65b0\u540e\uff0c \u7acb\u5373\u66f4\u65b0\u7f13\u5b58\u6570\u636e\u3002 \u4f8b\u5982\u53ef\u4ee5\u5229\u7528\u6d88\u606f\u7cfb\u7edf\u6216\u8005\u5176\u4ed6\u65b9\u5f0f\u901a\u77e5\u7f13\u5b58\u66f4\u65b0\u3002 \u4e00\u81f4\u6027\u3002 \u4e00\u81f4\u6027\u6700\u9ad8\uff0c \u4f46\u5982\u679c\u4e3b\u52a8\u66f4\u65b0\u53d1\u751f\u4e86\u95ee\u9898\uff0c \u90a3\u4e48\u8fd9\u6761\u6570\u636e\u5f88\u53ef \u80fd\u5f88\u957f\u65f6\u95f4\u4e0d\u4f1a\u66f4\u65b0\uff0c \u6240\u4ee5\u5efa\u8bae\u7ed3\u5408\u8d85\u65f6\u5254\u9664\u4e00\u8d77\u4f7f\u7528\u6548\u679c\u4f1a\u66f4\u597d\u3002 \u7ef4\u62a4\u6210\u672c\u3002 \u7ef4\u62a4\u6210\u672c\u4f1a\u6bd4\u8f83\u9ad8\uff0c \u5f00\u53d1\u8005\u9700\u8981\u81ea\u5df1\u6765\u5b8c\u6210\u66f4\u65b0\uff0c \u5e76\u4fdd\u8bc1\u66f4 \u65b0\u64cd\u4f5c\u7684\u6b63\u786e\u6027","title":"13. redis \u7f13\u5b58\u7b56\u7565"},{"location":"linux/nosql/redis/redis.cache_policy/#1","text":"\u53c2\u8003\u5b98\u7f51 \u5f53\u5b9e\u9645\u5185\u5b58\u8d85\u51fa maxmemory \u65f6\uff0cRedis \u63d0\u4f9b\u4e86\u51e0\u79cd\u53ef\u9009\u7b56\u7565 (maxmemory-policy) \u6765\u8ba9\u7528\u6237\u81ea\u5df1\u51b3\u5b9a\u6dd8\u6c70\u54ea\u4e9bkey\u3002\u603b\u7ed3\u5982\u4e0b\uff1a maxmemory \u7528\u4e8e\u6307\u5b9a Redis \u80fd\u4f7f\u7528\u7684\u6700\u5927\u5185\u5b58\u3002\u65e2\u53ef\u4ee5\u5728 redis.conf \u6587\u4ef6\u4e2d\u8bbe\u7f6e, \u4e5f\u53ef\u4ee5\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u901a\u8fc7 CONFIG SET \u547d\u4ee4\u52a8\u6001\u4fee\u6539\u3002\u4f8b\u5982, \u8981\u8bbe\u7f6e 100MB \u7684\u5185\u5b58\u9650\u5236, \u53ef\u4ee5\u5728 redis.conf \u6587\u4ef6\u4e2d\u8fd9\u6837\u914d\u7f6e\uff1a maxmemory 100mb \u5c06maxmemory\u8bbe\u7f6e\u4e3a0, \u5219\u8868\u793a\u4e0d\u8fdb\u884c\u5185\u5b58\u9650\u5236\u3002\u5f53\u7136, \u5bf932\u4f4d\u7cfb\u7edf\u6765\u8bf4\u6709\u4e00\u4e2a\u9690\u6027\u7684\u9650\u5236\u6761\u4ef6: \u6700\u591a 3GB \u5185\u5b58\u3002 \u5f53\u5185\u5b58\u4f7f\u7528\u8fbe\u5230\u6700\u5927\u9650\u5236\u65f6, \u5982\u679c\u9700\u8981\u5b58\u50a8\u65b0\u6570\u636e, \u6839\u636e\u914d\u7f6e\u7684\u7b56\u7565(policies)\u7684\u4e0d\u540c, Redis\u53ef\u80fd\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u4fe1\u606f, \u6216\u8005\u5220\u9664\u90e8\u5206\u8001\u7684\u6570\u636e\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.cache_policy/#2","text":"Redis\u63d0\u4f9b\u4e86\u4e0b\u9762\u51e0\u79cd\u6dd8\u6c70\u7b56\u7565\u4f9b\u7528\u6237\u9009\u62e9\uff0c\u5176\u4e2d\u9ed8\u8ba4\u7684\u7b56\u7565\u4e3anoeviction\u7b56\u7565\uff1a noeviction\uff1a\u5f53\u5185\u5b58\u4f7f\u7528\u8fbe\u5230\u9608\u503c\u7684\u65f6\u5019\uff0c\u6240\u6709\u5f15\u8d77\u7533\u8bf7\u5185\u5b58\u7684\u547d\u4ee4\u4f1a\u62a5\u9519\u3002 allkeys-lru\uff1a\u5728\u4e3b\u952e\u7a7a\u95f4\u4e2d\uff0c\u4f18\u5148\u79fb\u9664\u6700\u8fd1\u672a\u4f7f\u7528\u7684key\u3002 volatile-lru\uff1a\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u7a7a\u95f4\u4e2d\uff0c\u4f18\u5148\u79fb\u9664\u6700\u8fd1\u672a\u4f7f\u7528\u7684key\u3002 allkeys-random\uff1a\u5728\u4e3b\u952e\u7a7a\u95f4\u4e2d\uff0c\u968f\u673a\u79fb\u9664\u67d0\u4e2akey\u3002 volatile-random\uff1a\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u7a7a\u95f4\u4e2d\uff0c\u968f\u673a\u79fb\u9664\u67d0\u4e2akey\u3002 volatile-ttl\uff1a\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u7a7a\u95f4\u4e2d\uff0c\u5177\u6709\u66f4\u65e9\u8fc7\u671f\u65f6\u95f4\u7684key\u4f18\u5148\u79fb\u9664\u3002 allkeys-lru\uff1a\u5982\u679c\u6211\u4eec\u7684\u5e94\u7528\u5bf9\u7f13\u5b58\u7684\u8bbf\u95ee\u7b26\u5408\u5e42\u5f8b\u5206\u5e03\uff08\u4e5f\u5c31\u662f\u5b58\u5728\u76f8\u5bf9\u70ed\u70b9\u6570\u636e\uff09\uff0c\u6216\u8005\u6211\u4eec\u4e0d\u592a\u6e05\u695a\u6211\u4eec\u5e94\u7528\u7684\u7f13\u5b58\u8bbf\u95ee\u5206\u5e03\u72b6\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9allkeys-lru\u7b56\u7565\u3002 allkeys-random\uff1a\u5982\u679c\u6211\u4eec\u7684\u5e94\u7528\u5bf9\u4e8e\u7f13\u5b58key\u7684\u8bbf\u95ee\u6982\u7387\u76f8\u7b49\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u7b56\u7565\u3002 volatile-ttl\uff1a\u8fd9\u79cd\u7b56\u7565\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u5411Redis\u63d0\u793a\u54ea\u4e9bkey\u66f4\u9002\u5408\u88abeviction\u3002 volatile-lru\u7b56\u7565\u548cvolatile-random\u7b56\u7565\u9002\u5408\u6211\u4eec\u5c06\u4e00\u4e2aRedis\u5b9e\u4f8b\u65e2\u5e94\u7528\u4e8e\u7f13\u5b58\u548c\u53c8\u5e94\u7528\u4e8e\u6301\u4e45\u5316\u5b58\u50a8\u7684\u65f6\u5019\uff0c\u7136\u800c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u4e24\u4e2aRedis\u5b9e\u4f8b\u6765\u8fbe\u5230\u76f8\u540c\u7684\u6548\u679c\uff0c\u503c\u5f97\u4e00\u63d0\u7684\u662f\u5c06key\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u5b9e\u9645\u4e0a\u4f1a\u6d88\u8017\u66f4\u591a\u7684\u5185\u5b58\uff0c\u56e0\u6b64\u6211\u4eec\u5efa\u8bae\u4f7f\u7528allkeys-lru\u7b56\u7565\u4ece\u800c\u66f4\u6709\u6548\u7387\u7684\u4f7f\u7528\u5185\u5b58\u3002 \u5982\u679c\u6ca1\u6709\u8bbe\u7f6e expire \u7684key, \u4e0d\u6ee1\u8db3\u5148\u51b3\u6761\u4ef6(prerequisites); \u90a3\u4e48 volatile-lru , volatile-random \u548c volatile-ttl \u7b56\u7565\u7684\u884c\u4e3a, \u548c noeviction (\u4e0d\u5220\u9664)\u57fa\u672c\u4e0a\u4e00\u81f4\u3002 \u60a8\u9700\u8981\u6839\u636e\u7cfb\u7edf\u7684\u7279\u5f81, \u6765\u9009\u62e9\u5408\u9002\u7684\u9a71\u9010\u7b56\u7565\u3002 \u5f53\u7136, \u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4e5f\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u52a8\u6001\u8bbe\u7f6e\u9a71\u9010\u7b56\u7565, \u5e76\u901a\u8fc7 INFO \u547d\u4ee4\u76d1\u63a7\u7f13\u5b58\u7684 miss \u548c hit, \u6765\u8fdb\u884c\u8c03\u4f18\u3002 \u4e00\u822c\u6765\u8bf4: \u5982\u679c\u5206\u4e3a\u70ed\u6570\u636e\u4e0e\u51b7\u6570\u636e, \u63a8\u8350\u4f7f\u7528 allkeys-lru \u7b56\u7565\u3002 \u4e5f\u5c31\u662f, \u5176\u4e2d\u4e00\u90e8\u5206key\u7ecf\u5e38\u88ab\u8bfb\u5199. \u5982\u679c\u4e0d\u786e\u5b9a\u5177\u4f53\u7684\u4e1a\u52a1\u7279\u5f81, \u90a3\u4e48 allkeys-lru \u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\u3002 \u5982\u679c\u9700\u8981\u5faa\u73af\u8bfb\u5199\u6240\u6709\u7684key, \u6216\u8005\u5404\u4e2akey\u7684\u8bbf\u95ee\u9891\u7387\u5dee\u4e0d\u591a, \u53ef\u4ee5\u4f7f\u7528 allkeys-random \u7b56\u7565, \u5373\u8bfb\u5199\u6240\u6709\u5143\u7d20\u7684\u6982\u7387\u5dee\u4e0d\u591a\u3002 \u5047\u5982\u8981\u8ba9 Redis \u6839\u636e TTL \u6765\u7b5b\u9009\u9700\u8981\u5220\u9664\u7684key, \u8bf7\u4f7f\u7528 volatile-ttl \u7b56\u7565\u3002 volatile-lru\u548cvolatile-random\u7b56\u7565\u4e3b\u8981\u5e94\u7528\u573a\u666f\u662f: \u65e2\u6709\u7f13\u5b58,\u53c8\u6709\u6301\u4e45key\u7684\u5b9e\u4f8b\u4e2d\u3002 \u4e00\u822c\u6765\u8bf4, \u50cf\u8fd9\u7c7b\u573a\u666f, \u5e94\u8be5\u4f7f\u7528\u4e24\u4e2a\u5355\u72ec\u7684 Redis \u5b9e\u4f8b\u3002 \u503c\u5f97\u4e00\u63d0\u7684\u662f, \u8bbe\u7f6eexpire\u4f1a\u6d88\u8017\u989d\u5916\u7684\u5185\u5b58, \u6240\u4ee5\u4f7f\u7528allkeys-lru\u7b56\u7565, \u53ef\u4ee5\u66f4\u9ad8\u6548\u5730\u5229\u7528\u5185\u5b58, \u56e0\u4e3a\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e0d\u518d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u4e86\u3002","title":"2. \u7b56\u7565"},{"location":"linux/nosql/redis/redis.cache_policy/#3","text":"","title":"3. \u7f13\u5b58\u66f4\u65b0\u7b56\u7565"},{"location":"linux/nosql/redis/redis.cache_policy/#31-lrulfufifo","text":"\u4f7f\u7528\u573a\u666f\u3002 \u5254\u9664\u7b97\u6cd5\u901a\u5e38\u7528\u4e8e\u7f13\u5b58\u4f7f\u7528\u91cf\u8d85\u8fc7\u4e86\u9884\u8bbe\u7684\u6700\u5927\u503c\u65f6\u5019\uff0c \u5982 \u4f55\u5bf9\u73b0\u6709\u7684\u6570\u636e\u8fdb\u884c\u5254\u9664\u3002 \u4f8b\u5982Redis\u4f7f\u7528maxmemory-policy\u8fd9\u4e2a\u914d\u7f6e\u4f5c\u4e3a\u5185 \u5b58\u6700\u5927\u503c\u540e\u5bf9\u4e8e\u6570\u636e\u7684\u5254\u9664\u7b56\u7565\u3002 \u4e00\u81f4\u6027\u3002 \u8981\u6e05\u7406\u54ea\u4e9b\u6570\u636e\u662f\u7531\u5177\u4f53\u7b97\u6cd5\u51b3\u5b9a\uff0c \u5f00\u53d1\u4eba\u5458\u53ea\u80fd\u51b3\u5b9a\u4f7f\u7528\u54ea \u79cd\u7b97\u6cd5\uff0c \u6240\u4ee5\u6570\u636e\u7684\u4e00\u81f4\u6027\u662f\u6700\u5dee\u7684\u3002 \u7ef4\u62a4\u6210\u672c\u3002 \u7b97\u6cd5\u4e0d\u9700\u8981\u5f00\u53d1\u4eba\u5458\u81ea\u5df1\u6765\u5b9e\u73b0\uff0c \u901a\u5e38\u53ea\u9700\u8981\u914d\u7f6e\u6700\u5927 maxmemory\u548c\u5bf9\u5e94\u7684\u7b56\u7565\u5373\u53ef\u3002 \u5f00\u53d1\u4eba\u5458\u53ea\u9700\u8981\u77e5\u9053\u6bcf\u79cd\u7b97\u6cd5\u7684\u542b\u4e49\uff0c \u9009\u62e9 \u9002\u5408\u81ea\u5df1\u7684\u7b97\u6cd5\u5373\u53ef\u3002","title":"3.1 LRU/LFU/FIFO\u7b97\u6cd5\u5254\u9664"},{"location":"linux/nosql/redis/redis.cache_policy/#32","text":"\u4f7f\u7528\u573a\u666f\u3002 \u8d85\u65f6\u5254\u9664\u901a\u8fc7\u7ed9\u7f13\u5b58\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c \u8ba9\u5176\u5728\u8fc7\u671f\u65f6\u95f4\u540e \u81ea\u52a8\u5220\u9664\uff0c \u4f8b\u5982Redis\u63d0\u4f9b\u7684expire\u547d\u4ee4\u3002 \u5982\u679c\u4e1a\u52a1\u53ef\u4ee5\u5bb9\u5fcd\u4e00\u6bb5\u65f6\u95f4\u5185\uff0c \u7f13 \u5b58\u5c42\u6570\u636e\u548c\u5b58\u50a8\u5c42\u6570\u636e\u4e0d\u4e00\u81f4\uff0c \u90a3\u4e48\u53ef\u4ee5\u4e3a\u5176\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u5728\u6570\u636e\u8fc7\u671f \u540e\uff0c \u518d\u4ece\u771f\u5b9e\u6570\u636e\u6e90\u83b7\u53d6\u6570\u636e\uff0c \u91cd\u65b0\u653e\u5230\u7f13\u5b58\u5e76\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u4f8b\u5982\u4e00\u4e2a\u89c6 \u9891\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c \u53ef\u4ee5\u5bb9\u5fcd\u51e0\u5206\u949f\u5185\u6570\u636e\u4e0d\u4e00\u81f4\uff0c \u4f46\u662f\u6d89\u53ca\u4ea4\u6613\u65b9\u9762\u7684\u4e1a\u52a1\uff0c \u540e\u679c\u53ef\u60f3\u800c\u77e5\u3002 \u4e00\u81f4\u6027\u3002 \u4e00\u6bb5\u65f6\u95f4\u7a97\u53e3\u5185\uff08\u53d6\u51b3\u4e8e\u8fc7\u671f\u65f6\u95f4\u957f\u77ed\uff09 \u5b58\u5728\u4e00\u81f4\u6027\u95ee\u9898\uff0c \u5373 \u7f13\u5b58\u6570\u636e\u548c\u771f\u5b9e\u6570\u636e\u6e90\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u3002 \u7ef4\u62a4\u6210\u672c\u3002 \u7ef4\u62a4\u6210\u672c\u4e0d\u662f\u5f88\u9ad8\uff0c \u53ea\u9700\u8bbe\u7f6eexpire\u8fc7\u671f\u65f6\u95f4\u5373\u53ef\uff0c \u5f53\u7136\u524d \u63d0\u662f\u5e94\u7528\u65b9\u5141\u8bb8\u8fd9\u6bb5\u65f6\u95f4\u53ef\u80fd\u53d1\u751f\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u3002","title":"3.2 \u8d85\u65f6\u5254\u9664"},{"location":"linux/nosql/redis/redis.cache_policy/#33","text":"\u4f7f\u7528\u573a\u666f\u3002 \u5e94\u7528\u65b9\u5bf9\u4e8e\u6570\u636e\u7684\u4e00\u81f4\u6027\u8981\u6c42\u9ad8\uff0c \u9700\u8981\u5728\u771f\u5b9e\u6570\u636e\u66f4\u65b0\u540e\uff0c \u7acb\u5373\u66f4\u65b0\u7f13\u5b58\u6570\u636e\u3002 \u4f8b\u5982\u53ef\u4ee5\u5229\u7528\u6d88\u606f\u7cfb\u7edf\u6216\u8005\u5176\u4ed6\u65b9\u5f0f\u901a\u77e5\u7f13\u5b58\u66f4\u65b0\u3002 \u4e00\u81f4\u6027\u3002 \u4e00\u81f4\u6027\u6700\u9ad8\uff0c \u4f46\u5982\u679c\u4e3b\u52a8\u66f4\u65b0\u53d1\u751f\u4e86\u95ee\u9898\uff0c \u90a3\u4e48\u8fd9\u6761\u6570\u636e\u5f88\u53ef \u80fd\u5f88\u957f\u65f6\u95f4\u4e0d\u4f1a\u66f4\u65b0\uff0c \u6240\u4ee5\u5efa\u8bae\u7ed3\u5408\u8d85\u65f6\u5254\u9664\u4e00\u8d77\u4f7f\u7528\u6548\u679c\u4f1a\u66f4\u597d\u3002 \u7ef4\u62a4\u6210\u672c\u3002 \u7ef4\u62a4\u6210\u672c\u4f1a\u6bd4\u8f83\u9ad8\uff0c \u5f00\u53d1\u8005\u9700\u8981\u81ea\u5df1\u6765\u5b8c\u6210\u66f4\u65b0\uff0c \u5e76\u4fdd\u8bc1\u66f4 \u65b0\u64cd\u4f5c\u7684\u6b63\u786e\u6027","title":"3.3 \u4e3b\u52a8\u66f4\u65b0"},{"location":"linux/nosql/redis/redis.cluster/","text":"redis cluster 1. cluster \u00b6 1.1 \u4ecb\u7ecd \u00b6 Redis\u96c6\u7fa4\u642d\u5efa\u7684\u65b9\u5f0f\u6709\u591a\u79cd\uff0c\u4f8b\u5982\u4f7f\u7528zookeeper\u7b49\uff0c\u4f46\u4eceredis 3.0\u4e4b\u540e\u7248\u672c\u652f\u6301redis-cluster\u96c6\u7fa4\uff0cRedis-Cluster\u91c7\u7528\u65e0\u4e2d\u5fc3\u7ed3\u6784\uff0c\u6bcf\u4e2a\u8282\u70b9\u4fdd\u5b58\u6570\u636e\u548c\u6574\u4e2a\u96c6\u7fa4\u72b6\u6001,\u6bcf\u4e2a\u8282\u70b9\u90fd\u548c\u5176\u4ed6\u6240\u6709\u8282\u70b9\u8fde\u63a5\u3002\u5176redis-cluster\u67b6\u6784\u56fe\u5982\u4e0b\uff1a 1.2 \u5176\u7ed3\u6784\u7279\u70b9\uff1a \u00b6 1\u3001\u6240\u6709\u7684redis\u8282\u70b9\u5f7c\u6b64\u4e92\u8054(PING-PONG\u673a\u5236),\u5185\u90e8\u4f7f\u7528\u4e8c\u8fdb\u5236\u534f\u8bae\u4f18\u5316\u4f20\u8f93\u901f\u5ea6\u548c\u5e26\u5bbd\u3002 2\u3001\u8282\u70b9\u7684fail\u662f\u901a\u8fc7\u96c6\u7fa4\u4e2d\u8d85\u8fc7\u534a\u6570\u7684\u8282\u70b9\u68c0\u6d4b\u5931\u6548\u65f6\u624d\u751f\u6548\u3002 3\u3001\u5ba2\u6237\u7aef\u4e0eredis\u8282\u70b9\u76f4\u8fde,\u4e0d\u9700\u8981\u4e2d\u95f4proxy\u5c42.\u5ba2\u6237\u7aef\u4e0d\u9700\u8981\u8fde\u63a5\u96c6\u7fa4\u6240\u6709\u8282\u70b9,\u8fde\u63a5\u96c6\u7fa4\u4e2d\u4efb\u4f55\u4e00\u4e2a\u53ef\u7528\u8282\u70b9\u5373\u53ef\u3002 4\u3001redis-cluster\u628a\u6240\u6709\u7684\u7269\u7406\u8282\u70b9\u6620\u5c04\u5230[0-16383]slot\u4e0a\uff08\u4e0d\u4e00\u5b9a\u662f\u5e73\u5747\u5206\u914d\uff09,cluster \u8d1f\u8d23\u7ef4\u62a4node<->slot<->value\u3002 5\u3001Redis\u96c6\u7fa4\u9884\u5206\u597d16384\u4e2a\u6876\uff0c\u5f53\u9700\u8981\u5728 Redis \u96c6\u7fa4\u4e2d\u653e\u7f6e\u4e00\u4e2a key-value \u65f6\uff0c\u6839\u636e CRC16(key) mod 16384\u7684\u503c\uff0c\u51b3\u5b9a\u5c06\u4e00\u4e2akey\u653e\u5230\u54ea\u4e2a\u6876\u4e2d\u3002 1.2 \u8282\u70b9\u5206\u914d \u00b6 \u73b0\u5728\u6211\u4eec\u662f\u4e09\u4e2a\u4e3b\u8282\u70b9\u5206\u522b\u662f\uff1aA, B, C \u4e09\u4e2a\u8282\u70b9\uff0c\u5b83\u4eec\u53ef\u4ee5\u662f\u4e00\u53f0\u673a\u5668\u4e0a\u7684\u4e09\u4e2a\u7aef\u53e3\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e09\u53f0\u4e0d\u540c\u7684\u670d\u52a1\u5668\u3002\u90a3\u4e48\uff0c\u91c7\u7528\u54c8\u5e0c\u69fd (hash slot)\u7684\u65b9\u5f0f\u6765\u5206\u914d16384\u4e2aslot \u7684\u8bdd\uff0c\u5b83\u4eec\u4e09\u4e2a\u8282\u70b9\u5206\u522b\u627f\u62c5\u7684slot \u533a\u95f4\u662f\uff1a \u8282\u70b9A\u8986\u76d60\uff0d5460 \u8282\u70b9B\u8986\u76d65461\uff0d10922 \u8282\u70b9C\u8986\u76d610923\uff0d16383 \u83b7\u53d6\u6570\u636e\uff1a \u5982\u679c\u5b58\u5165\u4e00\u4e2a\u503c\uff0c\u6309\u7167redis cluster\u54c8\u5e0c\u69fd\u7684\u7b97\u6cd5\uff1a CRC16('key')%16384 = 6782\u3002 \u90a3\u4e48\u5c31\u4f1a\u628a\u8fd9\u4e2akey \u7684\u5b58\u50a8\u5206\u914d\u5230 B \u4e0a\u4e86\u3002\u540c\u6837\uff0c\u5f53\u6211\u8fde\u63a5(A,B,C)\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u60f3\u83b7\u53d6'key'\u8fd9\u4e2akey\u65f6\uff0c\u4e5f\u4f1a\u8fd9\u6837\u7684\u7b97\u6cd5\uff0c\u7136\u540e\u5185\u90e8\u8df3\u8f6c\u5230B\u8282\u70b9\u4e0a\u83b7\u53d6\u6570\u636e \u65b0\u589e\u4e00\u4e2a\u4e3b\u8282\u70b9\uff1a \u65b0\u589e\u4e00\u4e2a\u8282\u70b9D\uff0credis cluster\u7684\u8fd9\u79cd\u505a\u6cd5\u662f\u4ece\u5404\u4e2a\u8282\u70b9\u7684\u524d\u9762\u5404\u62ff\u53d6\u4e00\u90e8\u5206slot\u5230D\u4e0a\uff0c\u6211\u4f1a\u5728\u63a5\u4e0b\u6765\u7684\u5b9e\u8df5\u4e2d\u5b9e\u9a8c\u3002\u5927\u81f4\u5c31\u4f1a\u53d8\u6210\u8fd9\u6837\uff1a \u8282\u70b9A\u8986\u76d61365-5460 \u8282\u70b9B\u8986\u76d66827-10922 \u8282\u70b9C\u8986\u76d612288-16383 \u8282\u70b9D\u8986\u76d60-1364,5461-6826,10923-12287 \u540c\u6837\u5220\u9664\u4e00\u4e2a\u8282\u70b9\u4e5f\u662f\u7c7b\u4f3c\uff0c\u79fb\u52a8\u5b8c\u6210\u540e\u5c31\u53ef\u4ee5\u5220\u9664\u8fd9\u4e2a\u8282\u70b9\u4e86\u3002 1.3 Redis Cluster\u4e3b\u4ece\u6a21\u5f0f \u00b6 redis cluster \u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u7684\u9ad8\u53ef\u7528\u6027\uff0c\u52a0\u5165\u4e86\u4e3b\u4ece\u6a21\u5f0f\uff0c\u4e00\u4e2a\u4e3b\u8282\u70b9\u5bf9\u5e94\u4e00\u4e2a\u6216\u591a\u4e2a\u4ece\u8282\u70b9\uff0c\u4e3b\u8282\u70b9\u63d0\u4f9b\u6570\u636e\u5b58\u53d6\uff0c\u4ece\u8282\u70b9\u5219\u662f\u4ece\u4e3b\u8282\u70b9\u62c9\u53d6\u6570\u636e\u5907\u4efd\uff0c\u5f53\u8fd9\u4e2a\u4e3b\u8282\u70b9\u6302\u6389\u540e\uff0c\u5c31\u4f1a\u6709\u8fd9\u4e2a\u4ece\u8282\u70b9\u9009\u53d6\u4e00\u4e2a\u6765\u5145\u5f53\u4e3b\u8282\u70b9\uff0c\u4ece\u800c\u4fdd\u8bc1\u96c6\u7fa4\u4e0d\u4f1a\u6302\u6389\u3002 \u4e0a\u9762\u90a3\u4e2a\u4f8b\u5b50\u91cc, \u96c6\u7fa4\u6709ABC\u4e09\u4e2a\u4e3b\u8282\u70b9, \u5982\u679c\u8fd93\u4e2a\u8282\u70b9\u90fd\u6ca1\u6709\u52a0\u5165\u4ece\u8282\u70b9\uff0c\u5982\u679cB\u6302\u6389\u4e86\uff0c\u6211\u4eec\u5c31\u65e0\u6cd5\u8bbf\u95ee\u6574\u4e2a\u96c6\u7fa4\u4e86\u3002A\u548cC\u7684slot\u4e5f\u65e0\u6cd5\u8bbf\u95ee\u3002 \u6240\u4ee5\u6211\u4eec\u5728\u96c6\u7fa4\u5efa\u7acb\u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u8981\u4e3a\u6bcf\u4e2a\u4e3b\u8282\u70b9\u90fd\u6dfb\u52a0\u4e86\u4ece\u8282\u70b9, \u6bd4\u5982\u50cf\u8fd9\u6837, \u96c6\u7fa4\u5305\u542b\u4e3b\u8282\u70b9A\u3001B\u3001C, \u4ee5\u53ca\u4ece\u8282\u70b9A1\u3001B1\u3001C1, \u90a3\u4e48\u5373\u4f7fB\u6302\u6389\u7cfb\u7edf\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u6b63\u786e\u5de5\u4f5c\u3002B1\u8282\u70b9\u66ff\u4ee3\u4e86B\u8282\u70b9\uff0c\u6240\u4ee5Redis\u96c6\u7fa4\u5c06\u4f1a\u9009\u62e9B1\u8282\u70b9\u4f5c\u4e3a\u65b0\u7684\u4e3b\u8282\u70b9\uff0c\u96c6\u7fa4\u5c06\u4f1a\u7ee7\u7eed\u6b63\u786e\u5730\u63d0\u4f9b\u670d\u52a1\u3002 \u5f53B\u91cd\u65b0\u5f00\u542f\u540e\uff0c\u5b83\u5c31\u4f1a\u53d8\u6210B1\u7684\u4ece\u8282\u70b9\u3002 \u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\uff0c\u5982\u679c\u8282\u70b9B\u548cB1\u540c\u65f6\u6302\u4e86\uff0cRedis\u96c6\u7fa4\u5c31\u65e0\u6cd5\u7ee7\u7eed\u6b63\u786e\u5730\u63d0\u4f9b\u670d\u52a1\u4e86\u3002 2. \u90e8\u7f72 \u00b6 2.1 \u4ecb\u7ecd \u00b6 \u96c6\u7fa4\u4e2d\u81f3\u5c11\u5e94\u8be5\u6709\u5947\u6570\u4e2a\u8282\u70b9\uff0c\u6240\u4ee5\u81f3\u5c11\u6709\u4e09\u4e2a\u8282\u70b9\uff0c\u6bcf\u4e2a\u8282\u70b9\u81f3\u5c11\u6709\u4e00\u4e2a\u5907\u4efd\u8282\u70b9\uff0c\u6240\u4ee5\u4e0b\u9762\u4f7f\u75286\u8282\u70b9\uff08\u4e3b\u8282\u70b9\u3001\u5907\u4efd\u8282\u70b9\u7531redis-cluster\u96c6\u7fa4\u786e\u5b9a\uff09\u3002 \u671f\u4e2d\u5b89\u88c5\u597d\u4e00\u4e2aredis\u3002\u5176\u4ed65\u4e2a\u590d\u5236\uff0c\u4fee\u6539\u53c2\u6570\u5373\u53ef\u3002 2.2 \u914d\u7f6e \u00b6 root@manage01:/usr/local/cmz# tree . . \u251c\u2500\u2500 redis01 \u2502 \u251c\u2500\u2500 bin \u2502 \u2502 \u251c\u2500\u2500 redis-benchmark \u2502 \u2502 \u251c\u2500\u2500 redis-check-aof \u2502 \u2502 \u251c\u2500\u2500 redis-check-rdb \u2502 \u2502 \u251c\u2500\u2500 redis-cli \u2502 \u2502 \u251c\u2500\u2500 redis-sentinel \u2502 \u2502 \u251c\u2500\u2500 redis-server \u2502 \u2502 \u2514\u2500\u2500 redis-trib.rb \u2502 \u251c\u2500\u2500 conf \u2502 \u2502 \u251c\u2500\u2500 redis.conf \u2502 \u2502 \u2514\u2500\u2500 redis.conf.ori \u2502 \u251c\u2500\u2500 data \u2502 \u2502 \u251c\u2500\u2500 appendonly.aof \u2502 \u2502 \u251c\u2500\u2500 dump.rdb \u2502 \u2502 \u2514\u2500\u2500 nodes.conf \u2502 \u251c\u2500\u2500 log \u2502 \u2502 \u2514\u2500\u2500 redis.log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis02 \u2502 \u251c\u2500\u2500 bin \u2502 \u2502 \u251c\u2500\u2500 redis-benchmark \u2502 \u2502 \u251c\u2500\u2500 redis-check-aof \u2502 \u2502 \u251c\u2500\u2500 redis-check-rdb \u2502 \u2502 \u251c\u2500\u2500 redis-cli \u2502 \u2502 \u251c\u2500\u2500 redis-sentinel \u2502 \u2502 \u251c\u2500\u2500 redis-server \u2502 \u2502 \u2514\u2500\u2500 redis-trib.rb \u2502 \u251c\u2500\u2500 conf \u2502 \u2502 \u251c\u2500\u2500 redis.conf \u2502 \u2502 \u2514\u2500\u2500 redis.conf.ori \u2502 \u251c\u2500\u2500 data \u2502 \u2502 \u251c\u2500\u2500 appendonly.aof \u2502 \u2502 \u251c\u2500\u2500 dump.rdb \u2502 \u2502 \u2514\u2500\u2500 nodes.conf \u2502 \u251c\u2500\u2500 log \u2502 \u2502 \u2514\u2500\u2500 redis.log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis03 \u2502 \u251c\u2500\u2500 bin \u2502 \u2502 \u251c\u2500\u2500 redis-benchmark \u2502 \u2502 \u251c\u2500\u2500 redis-check-aof \u2502 \u2502 \u251c\u2500\u2500 redis-check-rdb \u2502 \u2502 \u251c\u2500\u2500 redis-cli \u2502 \u2502 \u251c\u2500\u2500 redis-sentinel \u2502 \u2502 \u251c\u2500\u2500 redis-server \u2502 \u2502 \u2514\u2500\u2500 redis-trib.rb \u2502 \u251c\u2500\u2500 conf \u2502 \u2502 \u251c\u2500\u2500 redis.conf \u2502 \u2502 \u2514\u2500\u2500 redis.conf.ori \u2502 \u251c\u2500\u2500 data \u2502 \u2502 \u251c\u2500\u2500 appendonly.aof \u2502 \u2502 \u251c\u2500\u2500 dump.rdb \u2502 \u2502 \u2514\u2500\u2500 nodes.conf \u2502 \u251c\u2500\u2500 log \u2502 \u2502 \u2514\u2500\u2500 redis.log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis04 \u2502 \u251c\u2500\u2500 bin \u2502 \u2502 \u251c\u2500\u2500 redis-benchmark \u2502 \u2502 \u251c\u2500\u2500 redis-check-aof \u2502 \u2502 \u251c\u2500\u2500 redis-check-rdb \u2502 \u2502 \u251c\u2500\u2500 redis-cli \u2502 \u2502 \u251c\u2500\u2500 redis-sentinel \u2502 \u2502 \u251c\u2500\u2500 redis-server \u2502 \u2502 \u2514\u2500\u2500 redis-trib.rb \u2502 \u251c\u2500\u2500 conf \u2502 \u2502 \u251c\u2500\u2500 redis.conf \u2502 \u2502 \u2514\u2500\u2500 redis.conf.ori \u2502 \u251c\u2500\u2500 data \u2502 \u2502 \u251c\u2500\u2500 appendonly.aof \u2502 \u2502 \u251c\u2500\u2500 dump.rdb \u2502 \u2502 \u2514\u2500\u2500 nodes.conf \u2502 \u251c\u2500\u2500 log \u2502 \u2502 \u2514\u2500\u2500 redis.log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis05 \u2502 \u251c\u2500\u2500 bin \u2502 \u2502 \u251c\u2500\u2500 redis-benchmark \u2502 \u2502 \u251c\u2500\u2500 redis-check-aof \u2502 \u2502 \u251c\u2500\u2500 redis-check-rdb \u2502 \u2502 \u251c\u2500\u2500 redis-cli \u2502 \u2502 \u251c\u2500\u2500 redis-sentinel \u2502 \u2502 \u251c\u2500\u2500 redis-server \u2502 \u2502 \u2514\u2500\u2500 redis-trib.rb \u2502 \u251c\u2500\u2500 conf \u2502 \u2502 \u251c\u2500\u2500 redis.conf \u2502 \u2502 \u2514\u2500\u2500 redis.conf.ori \u2502 \u251c\u2500\u2500 data \u2502 \u2502 \u251c\u2500\u2500 appendonly.aof \u2502 \u2502 \u251c\u2500\u2500 dump.rdb \u2502 \u2502 \u2514\u2500\u2500 nodes.conf \u2502 \u251c\u2500\u2500 log \u2502 \u2502 \u2514\u2500\u2500 redis.log \u2502 \u2514\u2500\u2500 nodes.conf \u2514\u2500\u2500 redis06 \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 redis-benchmark \u2502 \u251c\u2500\u2500 redis-check-aof \u2502 \u251c\u2500\u2500 redis-check-rdb \u2502 \u251c\u2500\u2500 redis-cli \u2502 \u251c\u2500\u2500 redis-sentinel \u2502 \u251c\u2500\u2500 redis-server \u2502 \u2514\u2500\u2500 redis-trib.rb \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 redis.conf \u2502 \u2514\u2500\u2500 redis.conf.ori \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 appendonly.aof \u2502 \u251c\u2500\u2500 dump.rdb \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 log \u2502 \u2514\u2500\u2500 redis.log \u2514\u2500\u2500 nodes.conf 30 directories, 84 files root@manage01:/usr/local/cmz# tree ./ -L 2 ./ \u251c\u2500\u2500 redis01 \u2502 \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis02 \u2502 \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis03 \u2502 \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis04 \u2502 \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis05 \u2502 \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 log \u2502 \u2514\u2500\u2500 nodes.conf \u2514\u2500\u2500 redis06 \u251c\u2500\u2500 bin \u251c\u2500\u2500 conf \u251c\u2500\u2500 data \u251c\u2500\u2500 log \u2514\u2500\u2500 nodes.conf \u914d\u7f6e\u6587\u4ef6 root@manage01:/usr/local/cmz# cat redis01/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis01/log/redis.pid\" port 7001 timeout 300 cluster-enabled yes cluster-config-file /usr/local/cmz/redis01/nodes.conf cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis01/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis01/data\" appendonly yes appendfsync always bind 0.0.0.0 root@manage01:/usr/local/cmz# cat redis02/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis02/log/redis.pid\" port 7002 timeout 300 cluster-enabled yes cluster-config-file '/usr/local/cmz/redis02/nodes.conf' cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis02/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis02/data\" appendonly yes appendfsync always bind 0.0.0.0 root@manage01:/usr/local/cmz# cat redis03/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis03/log/redis.pid\" port 7003 timeout 300 cluster-enabled yes cluster-config-file '/usr/local/cmz/redis03/nodes.conf' cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis03/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis03/data\" appendonly yes appendfsync always bind 0.0.0.0 root@manage01:/usr/local/cmz# cat redis04/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis04/log/redis.pid\" port 7004 timeout 300 cluster-enabled yes cluster-config-file '/usr/local/cmz/redis04/nodes.conf' cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis04/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis04/data\" appendonly yes appendfsync always bind 0.0.0.0 root@manage01:/usr/local/cmz# cat redis05/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis05/log/redis.pid\" port 7005 timeout 300 cluster-enabled yes cluster-config-file '/usr/local/cmz/redis05/nodes.conf' cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis05/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis05/data\" appendonly yes appendfsync always bind 0.0.0.0 root@manage01:/usr/local/cmz# cat redis06/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis06/log/redis.pid\" port 7006 timeout 300 cluster-enabled yes cluster-config-file '/usr/local/cmz/redis06/nodes.conf' cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis06/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis06/data\" appendonly yes appendfsync always bind 0.0.0.0 \u542f\u52a8\u6d4b\u8bd5 root@manage01:/usr/local/cmz# pkill redis root@manage01:/usr/local/cmz# ps axf|grep redis 9716 pts/18 S+ 0:00 \\_ grep --color=auto redis root@manage01:/usr/local/cmz# cat allstart.sh #!/bin/bash ./redis01/bin/redis-server redis01/conf/redis.conf ./redis02/bin/redis-server redis02/conf/redis.conf ./redis03/bin/redis-server redis03/conf/redis.conf ./redis04/bin/redis-server redis04/conf/redis.conf ./redis05/bin/redis-server redis05/conf/redis.conf ./redis06/bin/redis-server redis06/conf/redis.conf root@manage01:/usr/local/cmz# sh allstart.sh root@manage01:/usr/local/cmz# ps axu|grep redis root 9724 0.0 0.2 56448 4440 ? Ssl 11:20 0:00 ./redis01/bin/redis-server 0.0.0.0:7001 [cluster] root 9729 0.0 0.2 56448 4376 ? Ssl 11:20 0:00 ./redis02/bin/redis-server 0.0.0.0:7002 [cluster] root 9734 0.0 0.2 56448 4428 ? Ssl 11:20 0:00 ./redis03/bin/redis-server 0.0.0.0:7003 [cluster] root 9739 0.0 0.2 56448 4448 ? Ssl 11:20 0:00 ./redis04/bin/redis-server 0.0.0.0:7004 [cluster] root 9744 0.0 0.2 56448 4420 ? Ssl 11:20 0:00 ./redis05/bin/redis-server 0.0.0.0:7005 [cluster] root 9749 0.0 0.2 56448 4428 ? Ssl 11:20 0:00 ./redis06/bin/redis-server 0.0.0.0:7006 [cluster] root 9755 0.0 0.0 14228 944 pts/18 S+ 11:21 0:00 grep --color=auto redis \u53ef\u4ee5\u770b\u5230redis\u76846\u4e2a\u8282\u70b9\u5df2\u7ecf\u542f\u52a8\u6210\u529f 2.3 \u521b\u5efa\u96c6\u7fa4 \u00b6 \u5148\u5b89\u88c5ruby root@manage01:/usr/local/cmz# apt-get install ruby \u4f7f\u7528redis-trib.rb\u521b\u5efa\u96c6\u7fa4\uff0c\u5148\u62f7\u8d1d\u521b\u5efa\u96c6\u7fa4\u7684\u547d\u4ee4\u8fc7\u6765 root@manage01:/usr/local/cmz# cp /usr/local/redis-5.0.3/src/redis-trib.rb . # \u4ece\u6e90\u7801\u5305\u4e2d\u62f7\u8d1d root@manage01:/usr/local/cmz# l allstart.sh redis01/ redis02/ redis03/ redis04/ redis05/ redis06/ redis-trib.rb* \u4f7f\u7528create\u547d\u4ee4 --replicas 1 \u53c2\u6570\u8868\u793a\u4e3a\u6bcf\u4e2a\u4e3b\u8282\u70b9\u521b\u5efa\u4e00\u4e2a\u4ece\u8282\u70b9\uff0c\u5176\u4ed6\u53c2\u6570\u662f\u5b9e\u4f8b\u7684\u5730\u5740\u96c6\u5408\u3002 root@manage01:/usr/local/cmz# ./redis-trib.rb create --replicas 1 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006 WARNING: redis-trib.rb is not longer available! You should use redis-cli instead. All commands and features belonging to redis-trib.rb have been moved to redis-cli. In order to use them you should call redis-cli with the --cluster option followed by the subcommand name, arguments and options. Use the following syntax: redis-cli --cluster SUBCOMMAND [ARGUMENTS] [OPTIONS] Example: redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1 To get help about all subcommands, type: redis-cli --cluster help root@manage01:/usr/local/cmz# redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1 The program 'redis-cli' is currently not installed. You can install it by typing: apt install redis-tools root@manage01:/usr/local/cmz# ./redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1 >>> Performing hash slots allocation on 6 nodes... Master[0] -> Slots 0 - 5460 Master[1] -> Slots 5461 - 10922 Master[2] -> Slots 10923 - 16383 Adding replica 127.0.0.1:7004 to 127.0.0.1:7001 Adding replica 127.0.0.1:7005 to 127.0.0.1:7002 Adding replica 127.0.0.1:7006 to 127.0.0.1:7003 >>> Trying to optimize slaves allocation for anti-affinity [WARNING] Some slaves are in the same host as their master M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master M: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots:[5461-10922] (5462 slots) master M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 S: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 replicates 35ab300b706b5614d9484b07dd019ac363fe05eb S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 Can I set the above configuration? (type 'yes' to accept): yes >>> Nodes configuration updated >>> Assign a different config epoch to each node >>> Sending CLUSTER MEET messages to join the cluster Waiting for the cluster to join .... >>> Performing Cluster Check (using node 127.0.0.1:7001) M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master 1 additional replica(s) S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 M: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots:[5461-10922] (5462 slots) master 1 additional replica(s) S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 S: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots: (0 slots) slave replicates 35ab300b706b5614d9484b07dd019ac363fe05eb M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master 1 additional replica(s) [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. \u4e0a\u9762\u663e\u793a\u521b\u5efa\u6210\u529f\uff0c\u67093\u4e2a\u4e3b\u8282\u70b9\uff0c3\u4e2a\u4ece\u8282\u70b9\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u6210\u529f\u8fde\u63a5\u72b6\u6001\u3002 \u4e4b\u524d\u7248\u672c\u662fredis-trib.rb \u65b0\u7248\u672c\u6539\u4e86 You should use redis-cli instead. 3\u4e2a\u4e3b\u8282\u70b9[M]\u4ee5\u53ca\u5206\u914d\u7684\u54c8\u5e0c\u5361\u69fd\u5982\u4e0b\uff1a M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master M: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots:[5461-10922] (5462 slots) master M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master 3\u4e2a\u4ece\u8282\u70b9[S]\u4ee5\u53ca\u9644\u5c5e\u7684\u4e3b\u8282\u70b9\u5982\u4e0b\uff1a S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave S: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots: (0 slots) slave \u6ce8\u610f \u4ee5\u4e0a\u96c6\u7fa4\u5b89\u88c5\u6210\u529f\u4e86\uff0c\u5982\u679c\u5b89\u88c5\u672a\u6210\u529f\u62a5\u5982\u4e0b\u9519\u8bef >>> Creating cluster [ ERR ] Sorry , can 't connect to node ... \u90a3\u5fc5\u987b\u5b89\u88c5 ruby\u4e86 3. \u6d4b\u8bd5 \u00b6 3.1 \u6d4b\u8bd5\u5b58\u53d6\u503c \u00b6 root@manage01:/usr/local/cmz# ./redis-cli -c -p 7001 127.0.0.1:7001> set name caimengzhi -> Redirected to slot [5798] located at 127.0.0.1:7002 OK 127.0.0.1:7002> get name \"caimengzhi\" 127.0.0.1:7002> \u6839\u636eredis-cluster\u7684key\u503c\u5206\u914d\uff0cname\u5e94\u8be5\u5206\u914d\u5230\u8282\u70b97002[5461-10922]\u4e0a\uff0c\u4e0a\u9762\u663e\u793aredis cluster\u81ea\u52a8\u4ece7001\u8df3\u8f6c\u5230\u4e867002\u8282\u70b9\u3002\u6211\u4eec\u53ef\u4ee5\u6d4b\u8bd5\u4e00\u4e0b7006\u4ece\u8282\u70b9\u83b7\u53d6name\u503c root@manage01:/usr/local/cmz# ./redis-cli -c -p 7006 127.0.0.1:7006> get name -> Redirected to slot [5798] located at 127.0.0.1:7002 \"caimengzhi\" 127.0.0.1:7002> root@manage01:/usr/local/cmz# ./redis-cli -c -p 7005 127.0.0.1:7005> get name -> Redirected to slot [5798] located at 127.0.0.1:7002 \"caimengzhi\" 127.0.0.1:7002> root@manage01:/usr/local/cmz# ./redis-cli -c -p 7004 127.0.0.1:7004> get name -> Redirected to slot [5798] located at 127.0.0.1:7002 \"caimengzhi\" 127.0.0.1:7002> root@manage01:/usr/local/cmz# ./redis-cli -c -p 7003 127.0.0.1:7003> get name -> Redirected to slot [5798] located at 127.0.0.1:7002 \"caimengzhi\" 127.0.0.1:7002> root@manage01:/usr/local/cmz# ./redis-cli -c -p 7002 127.0.0.1:700 7006\u4f4d7003\u7684\u4ece\u8282\u70b9\uff0c\u4ece\u4e0a\u9762\u4e5f\u662f\u81ea\u52a8\u8df3\u8f6c\u81f37002\u83b7\u53d6\u503c\uff0c\u8fd9\u4e5f\u662fredis cluster\u7684\u7279\u70b9\uff0c\u5b83\u662f\u53bb\u4e2d\u5fc3\u5316\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u5bf9\u7b49\u7684\uff0c\u8fde\u63a5\u54ea\u4e2a\u8282\u70b9\u90fd\u53ef\u4ee5\u83b7\u53d6\u548c\u8bbe\u7f6e\u6570\u636e\u3002 3.2 \u67e5\u770b\u96c6\u7fa4\u4fe1\u606f \u00b6 root@manage01:/usr/local/cmz# ./redis-cli --cluster check 127.0.0.1:7002 127.0.0.1:7002 (35ab300b...) -> 1 keys | 5462 slots | 1 slaves. 127.0.0.1:7003 (cc2ba863...) -> 0 keys | 5461 slots | 1 slaves. 127.0.0.1:7001 (48d02dac...) -> 0 keys | 5461 slots | 1 slaves. [OK] 1 keys in 3 masters. 0.00 keys per slot on average. >>> Performing Cluster Check (using node 127.0.0.1:7002) M: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots:[5461-10922] (5462 slots) master 1 additional replica(s) S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master 1 additional replica(s) S: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots: (0 slots) slave replicates 35ab300b706b5614d9484b07dd019ac363fe05eb S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master 1 additional replica(s) [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. 4. \u96c6\u7fa4\u6d4b\u8bd5 \u00b6 4.1 \u5b95\u673a7002 \u8282\u70b9 \u00b6 \u73b0\u5728\u6a21\u62df\u5c067002\u8282\u70b9\u6302\u6389\uff0c\u6309\u7167redis-cluster\u539f\u7406\u4f1a\u9009\u4e3e\u4f1a\u5c06 7002\u7684\u4ece\u8282\u70b97005\u9009\u4e3e\u4e3a\u4e3b\u8282\u70b9\u3002 root@manage01:/usr/local/cmz# ps axf|grep redis 10355 pts/18 S+ 0:00 \\_ grep --color=auto redis 9724 ? Ssl 0:01 ./redis01/bin/redis-server 0.0.0.0:7001 [cluster] 9729 ? Ssl 0:01 ./redis02/bin/redis-server 0.0.0.0:7002 [cluster] 9734 ? Ssl 0:01 ./redis03/bin/redis-server 0.0.0.0:7003 [cluster] 9739 ? Ssl 0:01 ./redis04/bin/redis-server 0.0.0.0:7004 [cluster] 9744 ? Ssl 0:01 ./redis05/bin/redis-server 0.0.0.0:7005 [cluster] 9749 ? Ssl 0:01 ./redis06/bin/redis-server 0.0.0.0:7006 [cluster] You have new mail in /var/mail/root root@manage01:/usr/local/cmz# kill 9729 root@manage01:/usr/local/cmz# ps axf|grep redis 10358 pts/18 S+ 0:00 \\_ grep --color=auto redis 9724 ? Ssl 0:01 ./redis01/bin/redis-server 0.0.0.0:7001 [cluster] 9734 ? Ssl 0:01 ./redis03/bin/redis-server 0.0.0.0:7003 [cluster] 9739 ? Ssl 0:01 ./redis04/bin/redis-server 0.0.0.0:7004 [cluster] 9744 ? Ssl 0:01 ./redis05/bin/redis-server 0.0.0.0:7005 [cluster] 9749 ? Ssl 0:01 ./redis06/bin/redis-server 0.0.0.0:7006 [cluster] root@manage01:/usr/local/cmz# ./redis-cli --cluster check 127.0.0.1:7002 Could not connect to Redis at 127.0.0.1:7002: Connection refused root@manage01:/usr/local/cmz# ./redis-cli --cluster check 127.0.0.1:7005 Could not connect to Redis at 127.0.0.1:7002: Connection refused 127.0.0.1:7005 (a62e648a...) -> 1 keys | 5462 slots | 0 slaves. 127.0.0.1:7001 (48d02dac...) -> 0 keys | 5461 slots | 1 slaves. 127.0.0.1:7003 (cc2ba863...) -> 0 keys | 5461 slots | 1 slaves. [OK] 1 keys in 3 masters. 0.00 keys per slot on average. >>> Performing Cluster Check (using node 127.0.0.1:7005) M: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots:[5461-10922] (5462 slots) master M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master 1 additional replica(s) M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master 1 additional replica(s) S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. \u53ef\u4ee5\u770b\u5230\u96c6\u7fa4\u8fde\u63a5\u4e0d\u4e867002\u8282\u70b9\uff0c\u800c7005\u6709\u539f\u6765\u7684S\u8f6c\u6362\u4e3aM\u8282\u70b9\uff0c\u4ee3\u66ff\u4e86\u539f\u6765\u76847002\u8282\u70b9\u3002\u6211\u4eec\u53ef\u4ee5\u83b7\u53d6name\u503c\uff1a root@manage01:/usr/local/cmz# ./redis-cli -c -p 7005 127.0.0.1:7005> get name \"caimengzhi\" 4.2 \u6062\u590d7002\u8282\u70b9 \u00b6 \u73b0\u5728\u6211\u4eec\u5c067002\u8282\u70b9\u6062\u590d\uff0c\u770b\u662f\u5426\u4f1a\u81ea\u52a8\u52a0\u5165\u96c6\u7fa4\u4e2d\u4ee5\u53ca\u5145\u5f53\u7684M\u8fd8\u662fS\u8282\u70b9\u3002 root@manage01:/usr/local/cmz# ./redis02/bin/redis-server redis02/conf/redis.conf root@manage01:/usr/local/cmz# !ps ps axf|grep redis 10405 pts/18 S+ 0:00 \\_ grep --color=auto redis 9724 ? Ssl 0:02 ./redis01/bin/redis-server 0.0.0.0:7001 [cluster] 9734 ? Ssl 0:02 ./redis03/bin/redis-server 0.0.0.0:7003 [cluster] 9739 ? Ssl 0:02 ./redis04/bin/redis-server 0.0.0.0:7004 [cluster] 9744 ? Ssl 0:02 ./redis05/bin/redis-server 0.0.0.0:7005 [cluster] 9749 ? Ssl 0:02 ./redis06/bin/redis-server 0.0.0.0:7006 [cluster] 10398 ? Ssl 0:00 ./redis02/bin/redis-server 0.0.0.0:7002 [cluster] root@manage01:/usr/local/cmz# ./redis-cli --cluster check 127.0.0.1:7002 127.0.0.1:7005 (a62e648a...) -> 1 keys | 5462 slots | 1 slaves. 127.0.0.1:7001 (48d02dac...) -> 0 keys | 5461 slots | 1 slaves. 127.0.0.1:7003 (cc2ba863...) -> 0 keys | 5461 slots | 1 slaves. [OK] 1 keys in 3 masters. 0.00 keys per slot on average. >>> Performing Cluster Check (using node 127.0.0.1:7002) S: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots: (0 slots) slave replicates a62e648a1a13d95f993fd06819d001aa97e7916b M: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots:[5461-10922] (5462 slots) master 1 additional replica(s) S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master 1 additional replica(s) M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master 1 additional replica(s) [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. \u53ef\u4ee5\u770b\u52307002\u8282\u70b9\u53d8\u6210\u4e86a5db243087d8bd423b9285fa8513eddee9bb59a6 7005\u7684\u4ece\u8282\u70b9\u3002 5. \u96c6\u7fa4\u6dfb\u52a0\u4e3b\u8282\u70b9 \u00b6 \u8282\u70b9\u65b0\u589e\u5305\u62ec\u65b0\u589e\u4e3b\u8282\u70b9\u3001\u4ece\u8282\u70b9\u4e24\u79cd\u60c5\u51b5\u3002\u4ee5\u4e0b\u5206\u522b\u505a\u4e00\u4e0b\u6d4b\u8bd5\uff1a 5.1 \u65b0\u589e\u8282\u70b9 \u00b6 \u65b0\u589e\u4e00\u4e2a\u8282\u70b97007\u4f5c\u4e3a\u4e3b\u8282\u70b9\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 root@manage01:/usr/local/cmz# cat redis07/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis07/log/redis.pid\" port 7007 timeout 300 cluster-enabled yes cluster-config-file /usr/local/cmz/redis07/nodes.conf cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis07/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis07/data\" appendonly yes appendfsync always bind 0.0.0.0 root@manage01:/usr/local/cmz# ./redis07/bin/redis-server redis07/conf/redis.conf root@manage01:/usr/local/cmz# ps axf|grep redis 10582 pts/18 S+ 0:00 \\_ grep --color=auto redis 9724 ? Ssl 0:02 ./redis01/bin/redis-server 0.0.0.0:7001 [cluster] 9734 ? Ssl 0:02 ./redis03/bin/redis-server 0.0.0.0:7003 [cluster] 9739 ? Ssl 0:02 ./redis04/bin/redis-server 0.0.0.0:7004 [cluster] 9744 ? Ssl 0:02 ./redis05/bin/redis-server 0.0.0.0:7005 [cluster] 9749 ? Ssl 0:02 ./redis06/bin/redis-server 0.0.0.0:7006 [cluster] 10398 ? Ssl 0:00 ./redis02/bin/redis-server 0.0.0.0:7002 [cluster] 10575 ? Ssl 0:00 ./redis07/bin/redis-server 0.0.0.0:7007 [cluster] \u5c067007\u8282\u70b9\u6dfb\u52a0\u5230\u96c6\u7fa4\u4e2d root@manage01:/usr/local/cmz# ./redis07/bin/redis-server redis07/conf/redis.conf root@manage01:/usr/local/cmz# ./redis-cli --cluster add-node 127.0.0.1:7007 127.0.0.1:7002 >>> Adding node 127.0.0.1:7007 to cluster 127.0.0.1:7002 >>> Performing Cluster Check (using node 127.0.0.1:7002) S: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots: (0 slots) slave replicates a62e648a1a13d95f993fd06819d001aa97e7916b M: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots:[5461-10922] (5462 slots) master 1 additional replica(s) S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master 1 additional replica(s) M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master 1 additional replica(s) [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. >>> Send CLUSTER MEET to node 127.0.0.1:7007 to make it join the cluster. [OK] New node added correctly. add-node\u662f\u52a0\u5165\u96c6\u7fa4\u8282\u70b9\uff0c127.0.0.1:7007\u4e3a\u8981\u52a0\u5165\u7684\u8282\u70b9\uff0c127.0.0.1:7002 \u8868\u793a\u52a0\u5165\u7684\u96c6\u7fa4\u7684\u4e00\u4e2a\u8282\u70b9\uff0c\u7528\u6765\u8fa8\u8bc6\u662f\u54ea\u4e2a\u96c6\u7fa4\uff0c\u7406\u8bba\u4e0a\u90a3\u4e2a\u96c6\u7fa4\u7684\u8282\u70b9\u90fd\u53ef\u4ee5\u3002 \u6ce8\u610f \u8981\u5220\u9664\u4e4b\u524d\u62f7\u8d1d\u6587\u4ef6\u4e2d\u7684 nodes . conf \uff0c\u5426\u5219\u4f1a\u62a5\u9519 [ ERR ] Node 127.0 . 0.1 : 7007 is not empty . Either the node already knows other nodes ( check with CLUSTER NODES ) or contains some key in database 0 \u53ef\u4ee5\u770b\u52307007\u52a0\u5165\u8fd9\u4e2aCluster\uff0c\u5e76\u6210\u4e3a\u4e00\u4e2a\u65b0\u7684\u8282\u70b9\u3002\u53ef\u4ee5check\u4ee5\u4e0b7007\u8282\u70b9\u72b6\u6001 5.3 \u67e5\u770b\u65b0\u8282\u70b9\u60c5\u51b5 \u00b6 root@manage01:/usr/local/cmz# ./redis-cli --cluster check 127.0.0.1:7007 127.0.0.1:7007 (c3b7f31a...) -> 0 keys | 0 slots | 0 slaves. 127.0.0.1:7005 (a62e648a...) -> 1 keys | 5462 slots | 1 slaves. 127.0.0.1:7001 (48d02dac...) -> 0 keys | 5461 slots | 1 slaves. 127.0.0.1:7003 (cc2ba863...) -> 0 keys | 5461 slots | 1 slaves. [OK] 1 keys in 4 masters. 0.00 keys per slot on average. >>> Performing Cluster Check (using node 127.0.0.1:7007) M: c3b7f31a4ed3754c816f316afc6934572cfcb767 127.0.0.1:7007 slots: (0 slots) master S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 M: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots:[5461-10922] (5462 slots) master 1 additional replica(s) M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master 1 additional replica(s) M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master 1 additional replica(s) S: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots: (0 slots) slave replicates a62e648a1a13d95f993fd06819d001aa97e7916b [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. \u4e0a\u9762\u4fe1\u606f\u53ef\u4ee5\u770b\u5230\u67094\u4e2aM\u8282\u70b9\uff0c3\u4e2aS\u8282\u70b9\uff0c7007\u6210\u4e3a\u4e86M\u4e3b\u8282\u70b9\uff0c\u5b83\u6ca1\u6709\u9644\u5c5e\u7684\u4ece\u8282\u70b9\uff0c\u800c\u4e14Cluster\u5e76\u672a\u7ed97007\u5206\u914d\u54c8\u5e0c\u5361\u69fd\uff080 slots\uff09\u3002 \u67e5\u770b\u94fe\u63a5\u60c5\u51b5 root@manage01:/usr/local/cmz# ./redis-cli -c -p 7007 127.0.0.1:7007> CLUSTER NODES e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004@17004 slave 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 0 1553572416000 1 connected 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006@17006 slave cc2ba863bdbed282a02d240ec074c99919d6ce10 0 1553572415652 3 connected a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005@17005 master - 0 1553572417657 7 connected 5461-10922 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001@17001 master - 0 1553572413647 1 connected 0-5460 c3b7f31a4ed3754c816f316afc6934572cfcb767 127.0.0.1:7007@17007 myself,master - 0 1553572415000 0 connected cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003@17003 master - 0 1553572416000 3 connected 10923-16383 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002@17002 slave a62e648a1a13d95f993fd06819d001aa97e7916b 0 1553572416655 7 connected 127.0.0.1:7007> redis-cluster\u5728\u65b0\u589e\u8282\u70b9\u65f6\u5e76\u672a\u5206\u914d\u5361\u69fd\uff0c\u9700\u8981\u6211\u4eec\u624b\u52a8\u5bf9\u96c6\u7fa4\u8fdb\u884c\u91cd\u65b0\u5206\u7247\u8fc1\u79fb\u6570\u636e\uff0c\u9700\u8981\u91cd\u65b0\u5206\u7247\u547d\u4ee4 reshard redis-trib.rb reshard 127.0.0.1:7005 \u8fd9\u4e2a\u547d\u4ee4\u662f\u7528\u6765\u8fc1\u79fbslot\u8282\u70b9\u7684\uff0c\u540e\u9762\u7684127.0.0.1:7005\u662f\u8868\u793a\u662f\u54ea\u4e2a\u96c6\u7fa4\uff0c\u7aef\u53e3\u586b\uff3b7000-7007\uff3d\u90fd\u53ef\u4ee5\uff0c\u6267\u884c\u7ed3\u679c\u5982\u4e0b\uff1a root@manage01:/usr/local/cmz# ./redis-cli --cluster reshard 127.0.0.1:7005 [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. How many slots do you want to move (from 1 to 16384)? \u5b83\u63d0\u793a\u6211\u4eec\u9700\u8981\u8fc1\u79fb\u591a\u5c11slot\u52307007\u4e0a\uff0c\u6211\u4eec\u5e73\u520616384\u4e2a\u54c8\u5e0c\u69fd\u7ed94\u4e2a\u8282\u70b9\uff1a16384/4 = 4096\uff0c\u6211\u4eec\u9700\u8981\u79fb\u52a84096\u4e2a\u69fd\u70b9\u52307007\u4e0a\u3002 [OK] All 16384 slots covered. How many slots do you want to move (from 1 to 16384)? 4096 What is the receiving node ID? \u9700\u8981\u8f93\u51657007\u7684\u8282\u70b9id\uff0cc3b7f31a4ed3754c816f316afc6934572cfcb767 Please enter all the source node IDs. Type 'all' to use all the nodes as source nodes for the hash slots. Type 'done' once you entered all the source nodes IDs. Source node #1: redis-cli \u4f1a\u5411\u4f60\u8be2\u95ee\u91cd\u65b0\u5206\u7247\u7684\u6e90\u8282\u70b9\uff08source node\uff09\uff0c\u5373\uff0c\u8981\u4ece\u7279\u70b9\u7684\u54ea\u4e2a\u8282\u70b9\u4e2d\u53d6\u51fa 4096 \u4e2a\u54c8\u5e0c\u69fd\uff0c\u8fd8\u662f\u4ece\u5168\u90e8\u8282\u70b9\u63d0\u53d64096\u4e2a\u54c8\u5e0c\u69fd\uff0c \u5e76\u5c06\u8fd9\u4e9b\u69fd\u79fb\u52a8\u52307007\u8282\u70b9\u4e0a\u9762\u3002 \u5982\u679c\u6211\u4eec\u4e0d\u6253\u7b97\u4ece\u7279\u5b9a\u7684\u8282\u70b9\u4e0a\u53d6\u51fa\u6307\u5b9a\u6570\u91cf\u7684\u54c8\u5e0c\u69fd\uff0c\u90a3\u4e48\u53ef\u4ee5\u5411redis-trib\u8f93\u5165 all\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c \u96c6\u7fa4\u4e2d\u7684\u6240\u6709\u4e3b\u8282\u70b9\u90fd\u4f1a\u6210\u4e3a\u6e90\u8282\u70b9\uff0credis-trib\u4ece\u5404\u4e2a\u6e90\u8282\u70b9\u4e2d\u5404\u53d6\u51fa\u4e00\u90e8\u5206\u54c8\u5e0c\u69fd\uff0c\u51d1\u591f4096\u4e2a\uff0c\u7136\u540e\u79fb\u52a8\u52307007\u8282\u70b9\u4e0a\uff1a Source node #1:all \u786e\u8ba4\u4e4b\u540e\uff0credis-trib\u5c31\u5f00\u59cb\u6267\u884c\u5206\u7247\u64cd\u4f5c\uff0c\u5c06\u54c8\u5e0c\u69fd\u4e00\u4e2a\u4e00\u4e2a\u4ece\u6e90\u4e3b\u8282\u70b9\u79fb\u52a8\u52307007\u76ee\u6807\u4e3b\u8282\u70b9\u3002\u91cd\u65b0\u5206\u7247\u7ed3\u675f\u540e\u6211\u4eec\u53ef\u4ee5check\u4ee5\u4e0b\u8282\u70b9\u7684\u5206\u914d\u60c5\u51b5\u3002 >>> Performing Cluster Check (using node 127.0.0.1:7001) M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[1365-5460] (4096 slots) master 1 additional replica(s) S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 S: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots: (0 slots) slave replicates a62e648a1a13d95f993fd06819d001aa97e7916b M: c3b7f31a4ed3754c816f316afc6934572cfcb767 127.0.0.1:7007 slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 M: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots:[6827-10922] (4096 slots) master 1 additional replica(s) M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[12288-16383] (4096 slots) master 1 additional replica(s) [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. slots:0-1364,5461-6826,10923-12287 (4096 slots) master,\u53ef\u4ee5\u770b\u52307007\u8282\u70b9\u5206\u7247\u7684\u54c8\u5e0c\u69fd\u7247\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u95f4\u9694\u7684\u79fb\u52a8\u3002 root@manage01:/usr/local/cmz# ./redis-cli -c -p 7007 127.0.0.1:7007> set age 30 OK 127.0.0.1:7007> get age \"30\" 127.0.0.1:7007> root@manage01:/usr/local/cmz# ./redis-cli -c -p 7007 127.0.0.1:7007> get age \"30\" 127.0.0.1:7007> root@manage01:/usr/local/cmz# ./redis-cli -c -p 7001 127.0.0.1:7001> get age -> Redirected to slot [741] located at 127.0.0.1:7007 \"30\" \u53ef\u4ee5\u770b\u5230\u5c067001\u7684age[741]\u79fb\u52a8\u52307007\u8282\u70b9\u4e0a\uff0c\u4e3b\u8282\u70b97007\u6dfb\u52a0\u6210\u529f\u3002 6. \u96c6\u7fa4\u6dfb\u52a0\u4ece\u8282\u70b9 \u00b6 \u65b0\u589e\u4e00\u4e2a\u8282\u70b97008\u8282\u70b9\uff0c\u4f7f\u7528add-node --slave\u547d\u4ee4\u3002 root@manage01:/usr/local/cmz# cp -aR redis01 redis08 root@manage01:/usr/local/cmz# rm redis08/data/nodes.conf root@manage01:/usr/local/cmz# vim redis08/conf/redis.conf root@manage01:/usr/local/cmz# cat !$ cat redis08/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis08/log/redis.pid\" port 7008 timeout 300 cluster-enabled yes cluster-config-file /usr/local/cmz/redis08/nodes.conf cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis08/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis08/data\" appendonly yes appendfsync always bind 0.0.0.0 \u542f\u52a8redis 7008\u5b9e\u4f8b root@manage01:/usr/local/cmz# ./redis08/bin/redis-server redis08/conf/redis.conf root@manage01:/usr/local/cmz# !ps ps axf|grep redis 11291 pts/18 S+ 0:00 \\_ grep --color=auto redis 9724 ? Ssl 0:07 ./redis01/bin/redis-server 0.0.0.0:7001 [cluster] 9734 ? Ssl 0:07 ./redis03/bin/redis-server 0.0.0.0:7003 [cluster] 9739 ? Ssl 0:06 ./redis04/bin/redis-server 0.0.0.0:7004 [cluster] 9744 ? Ssl 0:07 ./redis05/bin/redis-server 0.0.0.0:7005 [cluster] 9749 ? Ssl 0:06 ./redis06/bin/redis-server 0.0.0.0:7006 [cluster] 10398 ? Ssl 0:03 ./redis02/bin/redis-server 0.0.0.0:7002 [cluster] 10695 ? Ssl 0:05 ./redis07/bin/redis-server 0.0.0.0:7007 [cluster] 11286 ? Ssl 0:00 ./redis08/bin/redis-server 0.0.0.0:7008 [cluster]","title":"12. redis cluster"},{"location":"linux/nosql/redis/redis.cluster/#1-cluster","text":"","title":"1. cluster"},{"location":"linux/nosql/redis/redis.cluster/#11","text":"Redis\u96c6\u7fa4\u642d\u5efa\u7684\u65b9\u5f0f\u6709\u591a\u79cd\uff0c\u4f8b\u5982\u4f7f\u7528zookeeper\u7b49\uff0c\u4f46\u4eceredis 3.0\u4e4b\u540e\u7248\u672c\u652f\u6301redis-cluster\u96c6\u7fa4\uff0cRedis-Cluster\u91c7\u7528\u65e0\u4e2d\u5fc3\u7ed3\u6784\uff0c\u6bcf\u4e2a\u8282\u70b9\u4fdd\u5b58\u6570\u636e\u548c\u6574\u4e2a\u96c6\u7fa4\u72b6\u6001,\u6bcf\u4e2a\u8282\u70b9\u90fd\u548c\u5176\u4ed6\u6240\u6709\u8282\u70b9\u8fde\u63a5\u3002\u5176redis-cluster\u67b6\u6784\u56fe\u5982\u4e0b\uff1a","title":"1.1 \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.cluster/#12","text":"1\u3001\u6240\u6709\u7684redis\u8282\u70b9\u5f7c\u6b64\u4e92\u8054(PING-PONG\u673a\u5236),\u5185\u90e8\u4f7f\u7528\u4e8c\u8fdb\u5236\u534f\u8bae\u4f18\u5316\u4f20\u8f93\u901f\u5ea6\u548c\u5e26\u5bbd\u3002 2\u3001\u8282\u70b9\u7684fail\u662f\u901a\u8fc7\u96c6\u7fa4\u4e2d\u8d85\u8fc7\u534a\u6570\u7684\u8282\u70b9\u68c0\u6d4b\u5931\u6548\u65f6\u624d\u751f\u6548\u3002 3\u3001\u5ba2\u6237\u7aef\u4e0eredis\u8282\u70b9\u76f4\u8fde,\u4e0d\u9700\u8981\u4e2d\u95f4proxy\u5c42.\u5ba2\u6237\u7aef\u4e0d\u9700\u8981\u8fde\u63a5\u96c6\u7fa4\u6240\u6709\u8282\u70b9,\u8fde\u63a5\u96c6\u7fa4\u4e2d\u4efb\u4f55\u4e00\u4e2a\u53ef\u7528\u8282\u70b9\u5373\u53ef\u3002 4\u3001redis-cluster\u628a\u6240\u6709\u7684\u7269\u7406\u8282\u70b9\u6620\u5c04\u5230[0-16383]slot\u4e0a\uff08\u4e0d\u4e00\u5b9a\u662f\u5e73\u5747\u5206\u914d\uff09,cluster \u8d1f\u8d23\u7ef4\u62a4node<->slot<->value\u3002 5\u3001Redis\u96c6\u7fa4\u9884\u5206\u597d16384\u4e2a\u6876\uff0c\u5f53\u9700\u8981\u5728 Redis \u96c6\u7fa4\u4e2d\u653e\u7f6e\u4e00\u4e2a key-value \u65f6\uff0c\u6839\u636e CRC16(key) mod 16384\u7684\u503c\uff0c\u51b3\u5b9a\u5c06\u4e00\u4e2akey\u653e\u5230\u54ea\u4e2a\u6876\u4e2d\u3002","title":"1.2 \u5176\u7ed3\u6784\u7279\u70b9\uff1a"},{"location":"linux/nosql/redis/redis.cluster/#12_1","text":"\u73b0\u5728\u6211\u4eec\u662f\u4e09\u4e2a\u4e3b\u8282\u70b9\u5206\u522b\u662f\uff1aA, B, C \u4e09\u4e2a\u8282\u70b9\uff0c\u5b83\u4eec\u53ef\u4ee5\u662f\u4e00\u53f0\u673a\u5668\u4e0a\u7684\u4e09\u4e2a\u7aef\u53e3\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e09\u53f0\u4e0d\u540c\u7684\u670d\u52a1\u5668\u3002\u90a3\u4e48\uff0c\u91c7\u7528\u54c8\u5e0c\u69fd (hash slot)\u7684\u65b9\u5f0f\u6765\u5206\u914d16384\u4e2aslot \u7684\u8bdd\uff0c\u5b83\u4eec\u4e09\u4e2a\u8282\u70b9\u5206\u522b\u627f\u62c5\u7684slot \u533a\u95f4\u662f\uff1a \u8282\u70b9A\u8986\u76d60\uff0d5460 \u8282\u70b9B\u8986\u76d65461\uff0d10922 \u8282\u70b9C\u8986\u76d610923\uff0d16383 \u83b7\u53d6\u6570\u636e\uff1a \u5982\u679c\u5b58\u5165\u4e00\u4e2a\u503c\uff0c\u6309\u7167redis cluster\u54c8\u5e0c\u69fd\u7684\u7b97\u6cd5\uff1a CRC16('key')%16384 = 6782\u3002 \u90a3\u4e48\u5c31\u4f1a\u628a\u8fd9\u4e2akey \u7684\u5b58\u50a8\u5206\u914d\u5230 B \u4e0a\u4e86\u3002\u540c\u6837\uff0c\u5f53\u6211\u8fde\u63a5(A,B,C)\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u60f3\u83b7\u53d6'key'\u8fd9\u4e2akey\u65f6\uff0c\u4e5f\u4f1a\u8fd9\u6837\u7684\u7b97\u6cd5\uff0c\u7136\u540e\u5185\u90e8\u8df3\u8f6c\u5230B\u8282\u70b9\u4e0a\u83b7\u53d6\u6570\u636e \u65b0\u589e\u4e00\u4e2a\u4e3b\u8282\u70b9\uff1a \u65b0\u589e\u4e00\u4e2a\u8282\u70b9D\uff0credis cluster\u7684\u8fd9\u79cd\u505a\u6cd5\u662f\u4ece\u5404\u4e2a\u8282\u70b9\u7684\u524d\u9762\u5404\u62ff\u53d6\u4e00\u90e8\u5206slot\u5230D\u4e0a\uff0c\u6211\u4f1a\u5728\u63a5\u4e0b\u6765\u7684\u5b9e\u8df5\u4e2d\u5b9e\u9a8c\u3002\u5927\u81f4\u5c31\u4f1a\u53d8\u6210\u8fd9\u6837\uff1a \u8282\u70b9A\u8986\u76d61365-5460 \u8282\u70b9B\u8986\u76d66827-10922 \u8282\u70b9C\u8986\u76d612288-16383 \u8282\u70b9D\u8986\u76d60-1364,5461-6826,10923-12287 \u540c\u6837\u5220\u9664\u4e00\u4e2a\u8282\u70b9\u4e5f\u662f\u7c7b\u4f3c\uff0c\u79fb\u52a8\u5b8c\u6210\u540e\u5c31\u53ef\u4ee5\u5220\u9664\u8fd9\u4e2a\u8282\u70b9\u4e86\u3002","title":"1.2 \u8282\u70b9\u5206\u914d"},{"location":"linux/nosql/redis/redis.cluster/#13-redis-cluster","text":"redis cluster \u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u7684\u9ad8\u53ef\u7528\u6027\uff0c\u52a0\u5165\u4e86\u4e3b\u4ece\u6a21\u5f0f\uff0c\u4e00\u4e2a\u4e3b\u8282\u70b9\u5bf9\u5e94\u4e00\u4e2a\u6216\u591a\u4e2a\u4ece\u8282\u70b9\uff0c\u4e3b\u8282\u70b9\u63d0\u4f9b\u6570\u636e\u5b58\u53d6\uff0c\u4ece\u8282\u70b9\u5219\u662f\u4ece\u4e3b\u8282\u70b9\u62c9\u53d6\u6570\u636e\u5907\u4efd\uff0c\u5f53\u8fd9\u4e2a\u4e3b\u8282\u70b9\u6302\u6389\u540e\uff0c\u5c31\u4f1a\u6709\u8fd9\u4e2a\u4ece\u8282\u70b9\u9009\u53d6\u4e00\u4e2a\u6765\u5145\u5f53\u4e3b\u8282\u70b9\uff0c\u4ece\u800c\u4fdd\u8bc1\u96c6\u7fa4\u4e0d\u4f1a\u6302\u6389\u3002 \u4e0a\u9762\u90a3\u4e2a\u4f8b\u5b50\u91cc, \u96c6\u7fa4\u6709ABC\u4e09\u4e2a\u4e3b\u8282\u70b9, \u5982\u679c\u8fd93\u4e2a\u8282\u70b9\u90fd\u6ca1\u6709\u52a0\u5165\u4ece\u8282\u70b9\uff0c\u5982\u679cB\u6302\u6389\u4e86\uff0c\u6211\u4eec\u5c31\u65e0\u6cd5\u8bbf\u95ee\u6574\u4e2a\u96c6\u7fa4\u4e86\u3002A\u548cC\u7684slot\u4e5f\u65e0\u6cd5\u8bbf\u95ee\u3002 \u6240\u4ee5\u6211\u4eec\u5728\u96c6\u7fa4\u5efa\u7acb\u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u8981\u4e3a\u6bcf\u4e2a\u4e3b\u8282\u70b9\u90fd\u6dfb\u52a0\u4e86\u4ece\u8282\u70b9, \u6bd4\u5982\u50cf\u8fd9\u6837, \u96c6\u7fa4\u5305\u542b\u4e3b\u8282\u70b9A\u3001B\u3001C, \u4ee5\u53ca\u4ece\u8282\u70b9A1\u3001B1\u3001C1, \u90a3\u4e48\u5373\u4f7fB\u6302\u6389\u7cfb\u7edf\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u6b63\u786e\u5de5\u4f5c\u3002B1\u8282\u70b9\u66ff\u4ee3\u4e86B\u8282\u70b9\uff0c\u6240\u4ee5Redis\u96c6\u7fa4\u5c06\u4f1a\u9009\u62e9B1\u8282\u70b9\u4f5c\u4e3a\u65b0\u7684\u4e3b\u8282\u70b9\uff0c\u96c6\u7fa4\u5c06\u4f1a\u7ee7\u7eed\u6b63\u786e\u5730\u63d0\u4f9b\u670d\u52a1\u3002 \u5f53B\u91cd\u65b0\u5f00\u542f\u540e\uff0c\u5b83\u5c31\u4f1a\u53d8\u6210B1\u7684\u4ece\u8282\u70b9\u3002 \u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\uff0c\u5982\u679c\u8282\u70b9B\u548cB1\u540c\u65f6\u6302\u4e86\uff0cRedis\u96c6\u7fa4\u5c31\u65e0\u6cd5\u7ee7\u7eed\u6b63\u786e\u5730\u63d0\u4f9b\u670d\u52a1\u4e86\u3002","title":"1.3 Redis Cluster\u4e3b\u4ece\u6a21\u5f0f"},{"location":"linux/nosql/redis/redis.cluster/#2","text":"","title":"2. \u90e8\u7f72"},{"location":"linux/nosql/redis/redis.cluster/#21","text":"\u96c6\u7fa4\u4e2d\u81f3\u5c11\u5e94\u8be5\u6709\u5947\u6570\u4e2a\u8282\u70b9\uff0c\u6240\u4ee5\u81f3\u5c11\u6709\u4e09\u4e2a\u8282\u70b9\uff0c\u6bcf\u4e2a\u8282\u70b9\u81f3\u5c11\u6709\u4e00\u4e2a\u5907\u4efd\u8282\u70b9\uff0c\u6240\u4ee5\u4e0b\u9762\u4f7f\u75286\u8282\u70b9\uff08\u4e3b\u8282\u70b9\u3001\u5907\u4efd\u8282\u70b9\u7531redis-cluster\u96c6\u7fa4\u786e\u5b9a\uff09\u3002 \u671f\u4e2d\u5b89\u88c5\u597d\u4e00\u4e2aredis\u3002\u5176\u4ed65\u4e2a\u590d\u5236\uff0c\u4fee\u6539\u53c2\u6570\u5373\u53ef\u3002","title":"2.1 \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.cluster/#22","text":"root@manage01:/usr/local/cmz# tree . . \u251c\u2500\u2500 redis01 \u2502 \u251c\u2500\u2500 bin \u2502 \u2502 \u251c\u2500\u2500 redis-benchmark \u2502 \u2502 \u251c\u2500\u2500 redis-check-aof \u2502 \u2502 \u251c\u2500\u2500 redis-check-rdb \u2502 \u2502 \u251c\u2500\u2500 redis-cli \u2502 \u2502 \u251c\u2500\u2500 redis-sentinel \u2502 \u2502 \u251c\u2500\u2500 redis-server \u2502 \u2502 \u2514\u2500\u2500 redis-trib.rb \u2502 \u251c\u2500\u2500 conf \u2502 \u2502 \u251c\u2500\u2500 redis.conf \u2502 \u2502 \u2514\u2500\u2500 redis.conf.ori \u2502 \u251c\u2500\u2500 data \u2502 \u2502 \u251c\u2500\u2500 appendonly.aof \u2502 \u2502 \u251c\u2500\u2500 dump.rdb \u2502 \u2502 \u2514\u2500\u2500 nodes.conf \u2502 \u251c\u2500\u2500 log \u2502 \u2502 \u2514\u2500\u2500 redis.log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis02 \u2502 \u251c\u2500\u2500 bin \u2502 \u2502 \u251c\u2500\u2500 redis-benchmark \u2502 \u2502 \u251c\u2500\u2500 redis-check-aof \u2502 \u2502 \u251c\u2500\u2500 redis-check-rdb \u2502 \u2502 \u251c\u2500\u2500 redis-cli \u2502 \u2502 \u251c\u2500\u2500 redis-sentinel \u2502 \u2502 \u251c\u2500\u2500 redis-server \u2502 \u2502 \u2514\u2500\u2500 redis-trib.rb \u2502 \u251c\u2500\u2500 conf \u2502 \u2502 \u251c\u2500\u2500 redis.conf \u2502 \u2502 \u2514\u2500\u2500 redis.conf.ori \u2502 \u251c\u2500\u2500 data \u2502 \u2502 \u251c\u2500\u2500 appendonly.aof \u2502 \u2502 \u251c\u2500\u2500 dump.rdb \u2502 \u2502 \u2514\u2500\u2500 nodes.conf \u2502 \u251c\u2500\u2500 log \u2502 \u2502 \u2514\u2500\u2500 redis.log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis03 \u2502 \u251c\u2500\u2500 bin \u2502 \u2502 \u251c\u2500\u2500 redis-benchmark \u2502 \u2502 \u251c\u2500\u2500 redis-check-aof \u2502 \u2502 \u251c\u2500\u2500 redis-check-rdb \u2502 \u2502 \u251c\u2500\u2500 redis-cli \u2502 \u2502 \u251c\u2500\u2500 redis-sentinel \u2502 \u2502 \u251c\u2500\u2500 redis-server \u2502 \u2502 \u2514\u2500\u2500 redis-trib.rb \u2502 \u251c\u2500\u2500 conf \u2502 \u2502 \u251c\u2500\u2500 redis.conf \u2502 \u2502 \u2514\u2500\u2500 redis.conf.ori \u2502 \u251c\u2500\u2500 data \u2502 \u2502 \u251c\u2500\u2500 appendonly.aof \u2502 \u2502 \u251c\u2500\u2500 dump.rdb \u2502 \u2502 \u2514\u2500\u2500 nodes.conf \u2502 \u251c\u2500\u2500 log \u2502 \u2502 \u2514\u2500\u2500 redis.log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis04 \u2502 \u251c\u2500\u2500 bin \u2502 \u2502 \u251c\u2500\u2500 redis-benchmark \u2502 \u2502 \u251c\u2500\u2500 redis-check-aof \u2502 \u2502 \u251c\u2500\u2500 redis-check-rdb \u2502 \u2502 \u251c\u2500\u2500 redis-cli \u2502 \u2502 \u251c\u2500\u2500 redis-sentinel \u2502 \u2502 \u251c\u2500\u2500 redis-server \u2502 \u2502 \u2514\u2500\u2500 redis-trib.rb \u2502 \u251c\u2500\u2500 conf \u2502 \u2502 \u251c\u2500\u2500 redis.conf \u2502 \u2502 \u2514\u2500\u2500 redis.conf.ori \u2502 \u251c\u2500\u2500 data \u2502 \u2502 \u251c\u2500\u2500 appendonly.aof \u2502 \u2502 \u251c\u2500\u2500 dump.rdb \u2502 \u2502 \u2514\u2500\u2500 nodes.conf \u2502 \u251c\u2500\u2500 log \u2502 \u2502 \u2514\u2500\u2500 redis.log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis05 \u2502 \u251c\u2500\u2500 bin \u2502 \u2502 \u251c\u2500\u2500 redis-benchmark \u2502 \u2502 \u251c\u2500\u2500 redis-check-aof \u2502 \u2502 \u251c\u2500\u2500 redis-check-rdb \u2502 \u2502 \u251c\u2500\u2500 redis-cli \u2502 \u2502 \u251c\u2500\u2500 redis-sentinel \u2502 \u2502 \u251c\u2500\u2500 redis-server \u2502 \u2502 \u2514\u2500\u2500 redis-trib.rb \u2502 \u251c\u2500\u2500 conf \u2502 \u2502 \u251c\u2500\u2500 redis.conf \u2502 \u2502 \u2514\u2500\u2500 redis.conf.ori \u2502 \u251c\u2500\u2500 data \u2502 \u2502 \u251c\u2500\u2500 appendonly.aof \u2502 \u2502 \u251c\u2500\u2500 dump.rdb \u2502 \u2502 \u2514\u2500\u2500 nodes.conf \u2502 \u251c\u2500\u2500 log \u2502 \u2502 \u2514\u2500\u2500 redis.log \u2502 \u2514\u2500\u2500 nodes.conf \u2514\u2500\u2500 redis06 \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 redis-benchmark \u2502 \u251c\u2500\u2500 redis-check-aof \u2502 \u251c\u2500\u2500 redis-check-rdb \u2502 \u251c\u2500\u2500 redis-cli \u2502 \u251c\u2500\u2500 redis-sentinel \u2502 \u251c\u2500\u2500 redis-server \u2502 \u2514\u2500\u2500 redis-trib.rb \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 redis.conf \u2502 \u2514\u2500\u2500 redis.conf.ori \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 appendonly.aof \u2502 \u251c\u2500\u2500 dump.rdb \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 log \u2502 \u2514\u2500\u2500 redis.log \u2514\u2500\u2500 nodes.conf 30 directories, 84 files root@manage01:/usr/local/cmz# tree ./ -L 2 ./ \u251c\u2500\u2500 redis01 \u2502 \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis02 \u2502 \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis03 \u2502 \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis04 \u2502 \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 log \u2502 \u2514\u2500\u2500 nodes.conf \u251c\u2500\u2500 redis05 \u2502 \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 data \u2502 \u251c\u2500\u2500 log \u2502 \u2514\u2500\u2500 nodes.conf \u2514\u2500\u2500 redis06 \u251c\u2500\u2500 bin \u251c\u2500\u2500 conf \u251c\u2500\u2500 data \u251c\u2500\u2500 log \u2514\u2500\u2500 nodes.conf \u914d\u7f6e\u6587\u4ef6 root@manage01:/usr/local/cmz# cat redis01/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis01/log/redis.pid\" port 7001 timeout 300 cluster-enabled yes cluster-config-file /usr/local/cmz/redis01/nodes.conf cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis01/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis01/data\" appendonly yes appendfsync always bind 0.0.0.0 root@manage01:/usr/local/cmz# cat redis02/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis02/log/redis.pid\" port 7002 timeout 300 cluster-enabled yes cluster-config-file '/usr/local/cmz/redis02/nodes.conf' cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis02/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis02/data\" appendonly yes appendfsync always bind 0.0.0.0 root@manage01:/usr/local/cmz# cat redis03/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis03/log/redis.pid\" port 7003 timeout 300 cluster-enabled yes cluster-config-file '/usr/local/cmz/redis03/nodes.conf' cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis03/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis03/data\" appendonly yes appendfsync always bind 0.0.0.0 root@manage01:/usr/local/cmz# cat redis04/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis04/log/redis.pid\" port 7004 timeout 300 cluster-enabled yes cluster-config-file '/usr/local/cmz/redis04/nodes.conf' cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis04/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis04/data\" appendonly yes appendfsync always bind 0.0.0.0 root@manage01:/usr/local/cmz# cat redis05/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis05/log/redis.pid\" port 7005 timeout 300 cluster-enabled yes cluster-config-file '/usr/local/cmz/redis05/nodes.conf' cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis05/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis05/data\" appendonly yes appendfsync always bind 0.0.0.0 root@manage01:/usr/local/cmz# cat redis06/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis06/log/redis.pid\" port 7006 timeout 300 cluster-enabled yes cluster-config-file '/usr/local/cmz/redis06/nodes.conf' cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis06/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis06/data\" appendonly yes appendfsync always bind 0.0.0.0 \u542f\u52a8\u6d4b\u8bd5 root@manage01:/usr/local/cmz# pkill redis root@manage01:/usr/local/cmz# ps axf|grep redis 9716 pts/18 S+ 0:00 \\_ grep --color=auto redis root@manage01:/usr/local/cmz# cat allstart.sh #!/bin/bash ./redis01/bin/redis-server redis01/conf/redis.conf ./redis02/bin/redis-server redis02/conf/redis.conf ./redis03/bin/redis-server redis03/conf/redis.conf ./redis04/bin/redis-server redis04/conf/redis.conf ./redis05/bin/redis-server redis05/conf/redis.conf ./redis06/bin/redis-server redis06/conf/redis.conf root@manage01:/usr/local/cmz# sh allstart.sh root@manage01:/usr/local/cmz# ps axu|grep redis root 9724 0.0 0.2 56448 4440 ? Ssl 11:20 0:00 ./redis01/bin/redis-server 0.0.0.0:7001 [cluster] root 9729 0.0 0.2 56448 4376 ? Ssl 11:20 0:00 ./redis02/bin/redis-server 0.0.0.0:7002 [cluster] root 9734 0.0 0.2 56448 4428 ? Ssl 11:20 0:00 ./redis03/bin/redis-server 0.0.0.0:7003 [cluster] root 9739 0.0 0.2 56448 4448 ? Ssl 11:20 0:00 ./redis04/bin/redis-server 0.0.0.0:7004 [cluster] root 9744 0.0 0.2 56448 4420 ? Ssl 11:20 0:00 ./redis05/bin/redis-server 0.0.0.0:7005 [cluster] root 9749 0.0 0.2 56448 4428 ? Ssl 11:20 0:00 ./redis06/bin/redis-server 0.0.0.0:7006 [cluster] root 9755 0.0 0.0 14228 944 pts/18 S+ 11:21 0:00 grep --color=auto redis \u53ef\u4ee5\u770b\u5230redis\u76846\u4e2a\u8282\u70b9\u5df2\u7ecf\u542f\u52a8\u6210\u529f","title":"2.2 \u914d\u7f6e"},{"location":"linux/nosql/redis/redis.cluster/#23","text":"\u5148\u5b89\u88c5ruby root@manage01:/usr/local/cmz# apt-get install ruby \u4f7f\u7528redis-trib.rb\u521b\u5efa\u96c6\u7fa4\uff0c\u5148\u62f7\u8d1d\u521b\u5efa\u96c6\u7fa4\u7684\u547d\u4ee4\u8fc7\u6765 root@manage01:/usr/local/cmz# cp /usr/local/redis-5.0.3/src/redis-trib.rb . # \u4ece\u6e90\u7801\u5305\u4e2d\u62f7\u8d1d root@manage01:/usr/local/cmz# l allstart.sh redis01/ redis02/ redis03/ redis04/ redis05/ redis06/ redis-trib.rb* \u4f7f\u7528create\u547d\u4ee4 --replicas 1 \u53c2\u6570\u8868\u793a\u4e3a\u6bcf\u4e2a\u4e3b\u8282\u70b9\u521b\u5efa\u4e00\u4e2a\u4ece\u8282\u70b9\uff0c\u5176\u4ed6\u53c2\u6570\u662f\u5b9e\u4f8b\u7684\u5730\u5740\u96c6\u5408\u3002 root@manage01:/usr/local/cmz# ./redis-trib.rb create --replicas 1 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006 WARNING: redis-trib.rb is not longer available! You should use redis-cli instead. All commands and features belonging to redis-trib.rb have been moved to redis-cli. In order to use them you should call redis-cli with the --cluster option followed by the subcommand name, arguments and options. Use the following syntax: redis-cli --cluster SUBCOMMAND [ARGUMENTS] [OPTIONS] Example: redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1 To get help about all subcommands, type: redis-cli --cluster help root@manage01:/usr/local/cmz# redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1 The program 'redis-cli' is currently not installed. You can install it by typing: apt install redis-tools root@manage01:/usr/local/cmz# ./redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 127.0.0.1:7006 --cluster-replicas 1 >>> Performing hash slots allocation on 6 nodes... Master[0] -> Slots 0 - 5460 Master[1] -> Slots 5461 - 10922 Master[2] -> Slots 10923 - 16383 Adding replica 127.0.0.1:7004 to 127.0.0.1:7001 Adding replica 127.0.0.1:7005 to 127.0.0.1:7002 Adding replica 127.0.0.1:7006 to 127.0.0.1:7003 >>> Trying to optimize slaves allocation for anti-affinity [WARNING] Some slaves are in the same host as their master M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master M: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots:[5461-10922] (5462 slots) master M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 S: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 replicates 35ab300b706b5614d9484b07dd019ac363fe05eb S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 Can I set the above configuration? (type 'yes' to accept): yes >>> Nodes configuration updated >>> Assign a different config epoch to each node >>> Sending CLUSTER MEET messages to join the cluster Waiting for the cluster to join .... >>> Performing Cluster Check (using node 127.0.0.1:7001) M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master 1 additional replica(s) S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 M: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots:[5461-10922] (5462 slots) master 1 additional replica(s) S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 S: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots: (0 slots) slave replicates 35ab300b706b5614d9484b07dd019ac363fe05eb M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master 1 additional replica(s) [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. \u4e0a\u9762\u663e\u793a\u521b\u5efa\u6210\u529f\uff0c\u67093\u4e2a\u4e3b\u8282\u70b9\uff0c3\u4e2a\u4ece\u8282\u70b9\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u6210\u529f\u8fde\u63a5\u72b6\u6001\u3002 \u4e4b\u524d\u7248\u672c\u662fredis-trib.rb \u65b0\u7248\u672c\u6539\u4e86 You should use redis-cli instead. 3\u4e2a\u4e3b\u8282\u70b9[M]\u4ee5\u53ca\u5206\u914d\u7684\u54c8\u5e0c\u5361\u69fd\u5982\u4e0b\uff1a M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master M: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots:[5461-10922] (5462 slots) master M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master 3\u4e2a\u4ece\u8282\u70b9[S]\u4ee5\u53ca\u9644\u5c5e\u7684\u4e3b\u8282\u70b9\u5982\u4e0b\uff1a S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave S: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots: (0 slots) slave \u6ce8\u610f \u4ee5\u4e0a\u96c6\u7fa4\u5b89\u88c5\u6210\u529f\u4e86\uff0c\u5982\u679c\u5b89\u88c5\u672a\u6210\u529f\u62a5\u5982\u4e0b\u9519\u8bef >>> Creating cluster [ ERR ] Sorry , can 't connect to node ... \u90a3\u5fc5\u987b\u5b89\u88c5 ruby\u4e86","title":"2.3 \u521b\u5efa\u96c6\u7fa4"},{"location":"linux/nosql/redis/redis.cluster/#3","text":"","title":"3. \u6d4b\u8bd5"},{"location":"linux/nosql/redis/redis.cluster/#31","text":"root@manage01:/usr/local/cmz# ./redis-cli -c -p 7001 127.0.0.1:7001> set name caimengzhi -> Redirected to slot [5798] located at 127.0.0.1:7002 OK 127.0.0.1:7002> get name \"caimengzhi\" 127.0.0.1:7002> \u6839\u636eredis-cluster\u7684key\u503c\u5206\u914d\uff0cname\u5e94\u8be5\u5206\u914d\u5230\u8282\u70b97002[5461-10922]\u4e0a\uff0c\u4e0a\u9762\u663e\u793aredis cluster\u81ea\u52a8\u4ece7001\u8df3\u8f6c\u5230\u4e867002\u8282\u70b9\u3002\u6211\u4eec\u53ef\u4ee5\u6d4b\u8bd5\u4e00\u4e0b7006\u4ece\u8282\u70b9\u83b7\u53d6name\u503c root@manage01:/usr/local/cmz# ./redis-cli -c -p 7006 127.0.0.1:7006> get name -> Redirected to slot [5798] located at 127.0.0.1:7002 \"caimengzhi\" 127.0.0.1:7002> root@manage01:/usr/local/cmz# ./redis-cli -c -p 7005 127.0.0.1:7005> get name -> Redirected to slot [5798] located at 127.0.0.1:7002 \"caimengzhi\" 127.0.0.1:7002> root@manage01:/usr/local/cmz# ./redis-cli -c -p 7004 127.0.0.1:7004> get name -> Redirected to slot [5798] located at 127.0.0.1:7002 \"caimengzhi\" 127.0.0.1:7002> root@manage01:/usr/local/cmz# ./redis-cli -c -p 7003 127.0.0.1:7003> get name -> Redirected to slot [5798] located at 127.0.0.1:7002 \"caimengzhi\" 127.0.0.1:7002> root@manage01:/usr/local/cmz# ./redis-cli -c -p 7002 127.0.0.1:700 7006\u4f4d7003\u7684\u4ece\u8282\u70b9\uff0c\u4ece\u4e0a\u9762\u4e5f\u662f\u81ea\u52a8\u8df3\u8f6c\u81f37002\u83b7\u53d6\u503c\uff0c\u8fd9\u4e5f\u662fredis cluster\u7684\u7279\u70b9\uff0c\u5b83\u662f\u53bb\u4e2d\u5fc3\u5316\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u5bf9\u7b49\u7684\uff0c\u8fde\u63a5\u54ea\u4e2a\u8282\u70b9\u90fd\u53ef\u4ee5\u83b7\u53d6\u548c\u8bbe\u7f6e\u6570\u636e\u3002","title":"3.1 \u6d4b\u8bd5\u5b58\u53d6\u503c"},{"location":"linux/nosql/redis/redis.cluster/#32","text":"root@manage01:/usr/local/cmz# ./redis-cli --cluster check 127.0.0.1:7002 127.0.0.1:7002 (35ab300b...) -> 1 keys | 5462 slots | 1 slaves. 127.0.0.1:7003 (cc2ba863...) -> 0 keys | 5461 slots | 1 slaves. 127.0.0.1:7001 (48d02dac...) -> 0 keys | 5461 slots | 1 slaves. [OK] 1 keys in 3 masters. 0.00 keys per slot on average. >>> Performing Cluster Check (using node 127.0.0.1:7002) M: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots:[5461-10922] (5462 slots) master 1 additional replica(s) S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master 1 additional replica(s) S: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots: (0 slots) slave replicates 35ab300b706b5614d9484b07dd019ac363fe05eb S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master 1 additional replica(s) [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered.","title":"3.2 \u67e5\u770b\u96c6\u7fa4\u4fe1\u606f"},{"location":"linux/nosql/redis/redis.cluster/#4","text":"","title":"4. \u96c6\u7fa4\u6d4b\u8bd5"},{"location":"linux/nosql/redis/redis.cluster/#41-7002","text":"\u73b0\u5728\u6a21\u62df\u5c067002\u8282\u70b9\u6302\u6389\uff0c\u6309\u7167redis-cluster\u539f\u7406\u4f1a\u9009\u4e3e\u4f1a\u5c06 7002\u7684\u4ece\u8282\u70b97005\u9009\u4e3e\u4e3a\u4e3b\u8282\u70b9\u3002 root@manage01:/usr/local/cmz# ps axf|grep redis 10355 pts/18 S+ 0:00 \\_ grep --color=auto redis 9724 ? Ssl 0:01 ./redis01/bin/redis-server 0.0.0.0:7001 [cluster] 9729 ? Ssl 0:01 ./redis02/bin/redis-server 0.0.0.0:7002 [cluster] 9734 ? Ssl 0:01 ./redis03/bin/redis-server 0.0.0.0:7003 [cluster] 9739 ? Ssl 0:01 ./redis04/bin/redis-server 0.0.0.0:7004 [cluster] 9744 ? Ssl 0:01 ./redis05/bin/redis-server 0.0.0.0:7005 [cluster] 9749 ? Ssl 0:01 ./redis06/bin/redis-server 0.0.0.0:7006 [cluster] You have new mail in /var/mail/root root@manage01:/usr/local/cmz# kill 9729 root@manage01:/usr/local/cmz# ps axf|grep redis 10358 pts/18 S+ 0:00 \\_ grep --color=auto redis 9724 ? Ssl 0:01 ./redis01/bin/redis-server 0.0.0.0:7001 [cluster] 9734 ? Ssl 0:01 ./redis03/bin/redis-server 0.0.0.0:7003 [cluster] 9739 ? Ssl 0:01 ./redis04/bin/redis-server 0.0.0.0:7004 [cluster] 9744 ? Ssl 0:01 ./redis05/bin/redis-server 0.0.0.0:7005 [cluster] 9749 ? Ssl 0:01 ./redis06/bin/redis-server 0.0.0.0:7006 [cluster] root@manage01:/usr/local/cmz# ./redis-cli --cluster check 127.0.0.1:7002 Could not connect to Redis at 127.0.0.1:7002: Connection refused root@manage01:/usr/local/cmz# ./redis-cli --cluster check 127.0.0.1:7005 Could not connect to Redis at 127.0.0.1:7002: Connection refused 127.0.0.1:7005 (a62e648a...) -> 1 keys | 5462 slots | 0 slaves. 127.0.0.1:7001 (48d02dac...) -> 0 keys | 5461 slots | 1 slaves. 127.0.0.1:7003 (cc2ba863...) -> 0 keys | 5461 slots | 1 slaves. [OK] 1 keys in 3 masters. 0.00 keys per slot on average. >>> Performing Cluster Check (using node 127.0.0.1:7005) M: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots:[5461-10922] (5462 slots) master M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master 1 additional replica(s) M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master 1 additional replica(s) S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. \u53ef\u4ee5\u770b\u5230\u96c6\u7fa4\u8fde\u63a5\u4e0d\u4e867002\u8282\u70b9\uff0c\u800c7005\u6709\u539f\u6765\u7684S\u8f6c\u6362\u4e3aM\u8282\u70b9\uff0c\u4ee3\u66ff\u4e86\u539f\u6765\u76847002\u8282\u70b9\u3002\u6211\u4eec\u53ef\u4ee5\u83b7\u53d6name\u503c\uff1a root@manage01:/usr/local/cmz# ./redis-cli -c -p 7005 127.0.0.1:7005> get name \"caimengzhi\"","title":"4.1 \u5b95\u673a7002 \u8282\u70b9"},{"location":"linux/nosql/redis/redis.cluster/#42-7002","text":"\u73b0\u5728\u6211\u4eec\u5c067002\u8282\u70b9\u6062\u590d\uff0c\u770b\u662f\u5426\u4f1a\u81ea\u52a8\u52a0\u5165\u96c6\u7fa4\u4e2d\u4ee5\u53ca\u5145\u5f53\u7684M\u8fd8\u662fS\u8282\u70b9\u3002 root@manage01:/usr/local/cmz# ./redis02/bin/redis-server redis02/conf/redis.conf root@manage01:/usr/local/cmz# !ps ps axf|grep redis 10405 pts/18 S+ 0:00 \\_ grep --color=auto redis 9724 ? Ssl 0:02 ./redis01/bin/redis-server 0.0.0.0:7001 [cluster] 9734 ? Ssl 0:02 ./redis03/bin/redis-server 0.0.0.0:7003 [cluster] 9739 ? Ssl 0:02 ./redis04/bin/redis-server 0.0.0.0:7004 [cluster] 9744 ? Ssl 0:02 ./redis05/bin/redis-server 0.0.0.0:7005 [cluster] 9749 ? Ssl 0:02 ./redis06/bin/redis-server 0.0.0.0:7006 [cluster] 10398 ? Ssl 0:00 ./redis02/bin/redis-server 0.0.0.0:7002 [cluster] root@manage01:/usr/local/cmz# ./redis-cli --cluster check 127.0.0.1:7002 127.0.0.1:7005 (a62e648a...) -> 1 keys | 5462 slots | 1 slaves. 127.0.0.1:7001 (48d02dac...) -> 0 keys | 5461 slots | 1 slaves. 127.0.0.1:7003 (cc2ba863...) -> 0 keys | 5461 slots | 1 slaves. [OK] 1 keys in 3 masters. 0.00 keys per slot on average. >>> Performing Cluster Check (using node 127.0.0.1:7002) S: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots: (0 slots) slave replicates a62e648a1a13d95f993fd06819d001aa97e7916b M: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots:[5461-10922] (5462 slots) master 1 additional replica(s) S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master 1 additional replica(s) M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master 1 additional replica(s) [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. \u53ef\u4ee5\u770b\u52307002\u8282\u70b9\u53d8\u6210\u4e86a5db243087d8bd423b9285fa8513eddee9bb59a6 7005\u7684\u4ece\u8282\u70b9\u3002","title":"4.2 \u6062\u590d7002\u8282\u70b9"},{"location":"linux/nosql/redis/redis.cluster/#5","text":"\u8282\u70b9\u65b0\u589e\u5305\u62ec\u65b0\u589e\u4e3b\u8282\u70b9\u3001\u4ece\u8282\u70b9\u4e24\u79cd\u60c5\u51b5\u3002\u4ee5\u4e0b\u5206\u522b\u505a\u4e00\u4e0b\u6d4b\u8bd5\uff1a","title":"5. \u96c6\u7fa4\u6dfb\u52a0\u4e3b\u8282\u70b9"},{"location":"linux/nosql/redis/redis.cluster/#51","text":"\u65b0\u589e\u4e00\u4e2a\u8282\u70b97007\u4f5c\u4e3a\u4e3b\u8282\u70b9\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 root@manage01:/usr/local/cmz# cat redis07/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis07/log/redis.pid\" port 7007 timeout 300 cluster-enabled yes cluster-config-file /usr/local/cmz/redis07/nodes.conf cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis07/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis07/data\" appendonly yes appendfsync always bind 0.0.0.0 root@manage01:/usr/local/cmz# ./redis07/bin/redis-server redis07/conf/redis.conf root@manage01:/usr/local/cmz# ps axf|grep redis 10582 pts/18 S+ 0:00 \\_ grep --color=auto redis 9724 ? Ssl 0:02 ./redis01/bin/redis-server 0.0.0.0:7001 [cluster] 9734 ? Ssl 0:02 ./redis03/bin/redis-server 0.0.0.0:7003 [cluster] 9739 ? Ssl 0:02 ./redis04/bin/redis-server 0.0.0.0:7004 [cluster] 9744 ? Ssl 0:02 ./redis05/bin/redis-server 0.0.0.0:7005 [cluster] 9749 ? Ssl 0:02 ./redis06/bin/redis-server 0.0.0.0:7006 [cluster] 10398 ? Ssl 0:00 ./redis02/bin/redis-server 0.0.0.0:7002 [cluster] 10575 ? Ssl 0:00 ./redis07/bin/redis-server 0.0.0.0:7007 [cluster] \u5c067007\u8282\u70b9\u6dfb\u52a0\u5230\u96c6\u7fa4\u4e2d root@manage01:/usr/local/cmz# ./redis07/bin/redis-server redis07/conf/redis.conf root@manage01:/usr/local/cmz# ./redis-cli --cluster add-node 127.0.0.1:7007 127.0.0.1:7002 >>> Adding node 127.0.0.1:7007 to cluster 127.0.0.1:7002 >>> Performing Cluster Check (using node 127.0.0.1:7002) S: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots: (0 slots) slave replicates a62e648a1a13d95f993fd06819d001aa97e7916b M: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots:[5461-10922] (5462 slots) master 1 additional replica(s) S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master 1 additional replica(s) M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master 1 additional replica(s) [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. >>> Send CLUSTER MEET to node 127.0.0.1:7007 to make it join the cluster. [OK] New node added correctly. add-node\u662f\u52a0\u5165\u96c6\u7fa4\u8282\u70b9\uff0c127.0.0.1:7007\u4e3a\u8981\u52a0\u5165\u7684\u8282\u70b9\uff0c127.0.0.1:7002 \u8868\u793a\u52a0\u5165\u7684\u96c6\u7fa4\u7684\u4e00\u4e2a\u8282\u70b9\uff0c\u7528\u6765\u8fa8\u8bc6\u662f\u54ea\u4e2a\u96c6\u7fa4\uff0c\u7406\u8bba\u4e0a\u90a3\u4e2a\u96c6\u7fa4\u7684\u8282\u70b9\u90fd\u53ef\u4ee5\u3002 \u6ce8\u610f \u8981\u5220\u9664\u4e4b\u524d\u62f7\u8d1d\u6587\u4ef6\u4e2d\u7684 nodes . conf \uff0c\u5426\u5219\u4f1a\u62a5\u9519 [ ERR ] Node 127.0 . 0.1 : 7007 is not empty . Either the node already knows other nodes ( check with CLUSTER NODES ) or contains some key in database 0 \u53ef\u4ee5\u770b\u52307007\u52a0\u5165\u8fd9\u4e2aCluster\uff0c\u5e76\u6210\u4e3a\u4e00\u4e2a\u65b0\u7684\u8282\u70b9\u3002\u53ef\u4ee5check\u4ee5\u4e0b7007\u8282\u70b9\u72b6\u6001","title":"5.1  \u65b0\u589e\u8282\u70b9"},{"location":"linux/nosql/redis/redis.cluster/#53","text":"root@manage01:/usr/local/cmz# ./redis-cli --cluster check 127.0.0.1:7007 127.0.0.1:7007 (c3b7f31a...) -> 0 keys | 0 slots | 0 slaves. 127.0.0.1:7005 (a62e648a...) -> 1 keys | 5462 slots | 1 slaves. 127.0.0.1:7001 (48d02dac...) -> 0 keys | 5461 slots | 1 slaves. 127.0.0.1:7003 (cc2ba863...) -> 0 keys | 5461 slots | 1 slaves. [OK] 1 keys in 4 masters. 0.00 keys per slot on average. >>> Performing Cluster Check (using node 127.0.0.1:7007) M: c3b7f31a4ed3754c816f316afc6934572cfcb767 127.0.0.1:7007 slots: (0 slots) master S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 M: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots:[5461-10922] (5462 slots) master 1 additional replica(s) M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[0-5460] (5461 slots) master 1 additional replica(s) M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[10923-16383] (5461 slots) master 1 additional replica(s) S: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots: (0 slots) slave replicates a62e648a1a13d95f993fd06819d001aa97e7916b [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. \u4e0a\u9762\u4fe1\u606f\u53ef\u4ee5\u770b\u5230\u67094\u4e2aM\u8282\u70b9\uff0c3\u4e2aS\u8282\u70b9\uff0c7007\u6210\u4e3a\u4e86M\u4e3b\u8282\u70b9\uff0c\u5b83\u6ca1\u6709\u9644\u5c5e\u7684\u4ece\u8282\u70b9\uff0c\u800c\u4e14Cluster\u5e76\u672a\u7ed97007\u5206\u914d\u54c8\u5e0c\u5361\u69fd\uff080 slots\uff09\u3002 \u67e5\u770b\u94fe\u63a5\u60c5\u51b5 root@manage01:/usr/local/cmz# ./redis-cli -c -p 7007 127.0.0.1:7007> CLUSTER NODES e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004@17004 slave 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 0 1553572416000 1 connected 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006@17006 slave cc2ba863bdbed282a02d240ec074c99919d6ce10 0 1553572415652 3 connected a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005@17005 master - 0 1553572417657 7 connected 5461-10922 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001@17001 master - 0 1553572413647 1 connected 0-5460 c3b7f31a4ed3754c816f316afc6934572cfcb767 127.0.0.1:7007@17007 myself,master - 0 1553572415000 0 connected cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003@17003 master - 0 1553572416000 3 connected 10923-16383 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002@17002 slave a62e648a1a13d95f993fd06819d001aa97e7916b 0 1553572416655 7 connected 127.0.0.1:7007> redis-cluster\u5728\u65b0\u589e\u8282\u70b9\u65f6\u5e76\u672a\u5206\u914d\u5361\u69fd\uff0c\u9700\u8981\u6211\u4eec\u624b\u52a8\u5bf9\u96c6\u7fa4\u8fdb\u884c\u91cd\u65b0\u5206\u7247\u8fc1\u79fb\u6570\u636e\uff0c\u9700\u8981\u91cd\u65b0\u5206\u7247\u547d\u4ee4 reshard redis-trib.rb reshard 127.0.0.1:7005 \u8fd9\u4e2a\u547d\u4ee4\u662f\u7528\u6765\u8fc1\u79fbslot\u8282\u70b9\u7684\uff0c\u540e\u9762\u7684127.0.0.1:7005\u662f\u8868\u793a\u662f\u54ea\u4e2a\u96c6\u7fa4\uff0c\u7aef\u53e3\u586b\uff3b7000-7007\uff3d\u90fd\u53ef\u4ee5\uff0c\u6267\u884c\u7ed3\u679c\u5982\u4e0b\uff1a root@manage01:/usr/local/cmz# ./redis-cli --cluster reshard 127.0.0.1:7005 [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. How many slots do you want to move (from 1 to 16384)? \u5b83\u63d0\u793a\u6211\u4eec\u9700\u8981\u8fc1\u79fb\u591a\u5c11slot\u52307007\u4e0a\uff0c\u6211\u4eec\u5e73\u520616384\u4e2a\u54c8\u5e0c\u69fd\u7ed94\u4e2a\u8282\u70b9\uff1a16384/4 = 4096\uff0c\u6211\u4eec\u9700\u8981\u79fb\u52a84096\u4e2a\u69fd\u70b9\u52307007\u4e0a\u3002 [OK] All 16384 slots covered. How many slots do you want to move (from 1 to 16384)? 4096 What is the receiving node ID? \u9700\u8981\u8f93\u51657007\u7684\u8282\u70b9id\uff0cc3b7f31a4ed3754c816f316afc6934572cfcb767 Please enter all the source node IDs. Type 'all' to use all the nodes as source nodes for the hash slots. Type 'done' once you entered all the source nodes IDs. Source node #1: redis-cli \u4f1a\u5411\u4f60\u8be2\u95ee\u91cd\u65b0\u5206\u7247\u7684\u6e90\u8282\u70b9\uff08source node\uff09\uff0c\u5373\uff0c\u8981\u4ece\u7279\u70b9\u7684\u54ea\u4e2a\u8282\u70b9\u4e2d\u53d6\u51fa 4096 \u4e2a\u54c8\u5e0c\u69fd\uff0c\u8fd8\u662f\u4ece\u5168\u90e8\u8282\u70b9\u63d0\u53d64096\u4e2a\u54c8\u5e0c\u69fd\uff0c \u5e76\u5c06\u8fd9\u4e9b\u69fd\u79fb\u52a8\u52307007\u8282\u70b9\u4e0a\u9762\u3002 \u5982\u679c\u6211\u4eec\u4e0d\u6253\u7b97\u4ece\u7279\u5b9a\u7684\u8282\u70b9\u4e0a\u53d6\u51fa\u6307\u5b9a\u6570\u91cf\u7684\u54c8\u5e0c\u69fd\uff0c\u90a3\u4e48\u53ef\u4ee5\u5411redis-trib\u8f93\u5165 all\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c \u96c6\u7fa4\u4e2d\u7684\u6240\u6709\u4e3b\u8282\u70b9\u90fd\u4f1a\u6210\u4e3a\u6e90\u8282\u70b9\uff0credis-trib\u4ece\u5404\u4e2a\u6e90\u8282\u70b9\u4e2d\u5404\u53d6\u51fa\u4e00\u90e8\u5206\u54c8\u5e0c\u69fd\uff0c\u51d1\u591f4096\u4e2a\uff0c\u7136\u540e\u79fb\u52a8\u52307007\u8282\u70b9\u4e0a\uff1a Source node #1:all \u786e\u8ba4\u4e4b\u540e\uff0credis-trib\u5c31\u5f00\u59cb\u6267\u884c\u5206\u7247\u64cd\u4f5c\uff0c\u5c06\u54c8\u5e0c\u69fd\u4e00\u4e2a\u4e00\u4e2a\u4ece\u6e90\u4e3b\u8282\u70b9\u79fb\u52a8\u52307007\u76ee\u6807\u4e3b\u8282\u70b9\u3002\u91cd\u65b0\u5206\u7247\u7ed3\u675f\u540e\u6211\u4eec\u53ef\u4ee5check\u4ee5\u4e0b\u8282\u70b9\u7684\u5206\u914d\u60c5\u51b5\u3002 >>> Performing Cluster Check (using node 127.0.0.1:7001) M: 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 127.0.0.1:7001 slots:[1365-5460] (4096 slots) master 1 additional replica(s) S: 39ab11b086c444a8fe04c5e917c98bc69c3add50 127.0.0.1:7006 slots: (0 slots) slave replicates cc2ba863bdbed282a02d240ec074c99919d6ce10 S: 35ab300b706b5614d9484b07dd019ac363fe05eb 127.0.0.1:7002 slots: (0 slots) slave replicates a62e648a1a13d95f993fd06819d001aa97e7916b M: c3b7f31a4ed3754c816f316afc6934572cfcb767 127.0.0.1:7007 slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master S: e9c3cfa422cb7c666c9b739598b5c3871ee8c1e3 127.0.0.1:7004 slots: (0 slots) slave replicates 48d02dac3a0b52d58fc1351392bb656e4a3c9f66 M: a62e648a1a13d95f993fd06819d001aa97e7916b 127.0.0.1:7005 slots:[6827-10922] (4096 slots) master 1 additional replica(s) M: cc2ba863bdbed282a02d240ec074c99919d6ce10 127.0.0.1:7003 slots:[12288-16383] (4096 slots) master 1 additional replica(s) [OK] All nodes agree about slots configuration. >>> Check for open slots... >>> Check slots coverage... [OK] All 16384 slots covered. slots:0-1364,5461-6826,10923-12287 (4096 slots) master,\u53ef\u4ee5\u770b\u52307007\u8282\u70b9\u5206\u7247\u7684\u54c8\u5e0c\u69fd\u7247\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u95f4\u9694\u7684\u79fb\u52a8\u3002 root@manage01:/usr/local/cmz# ./redis-cli -c -p 7007 127.0.0.1:7007> set age 30 OK 127.0.0.1:7007> get age \"30\" 127.0.0.1:7007> root@manage01:/usr/local/cmz# ./redis-cli -c -p 7007 127.0.0.1:7007> get age \"30\" 127.0.0.1:7007> root@manage01:/usr/local/cmz# ./redis-cli -c -p 7001 127.0.0.1:7001> get age -> Redirected to slot [741] located at 127.0.0.1:7007 \"30\" \u53ef\u4ee5\u770b\u5230\u5c067001\u7684age[741]\u79fb\u52a8\u52307007\u8282\u70b9\u4e0a\uff0c\u4e3b\u8282\u70b97007\u6dfb\u52a0\u6210\u529f\u3002","title":"5.3 \u67e5\u770b\u65b0\u8282\u70b9\u60c5\u51b5"},{"location":"linux/nosql/redis/redis.cluster/#6","text":"\u65b0\u589e\u4e00\u4e2a\u8282\u70b97008\u8282\u70b9\uff0c\u4f7f\u7528add-node --slave\u547d\u4ee4\u3002 root@manage01:/usr/local/cmz# cp -aR redis01 redis08 root@manage01:/usr/local/cmz# rm redis08/data/nodes.conf root@manage01:/usr/local/cmz# vim redis08/conf/redis.conf root@manage01:/usr/local/cmz# cat !$ cat redis08/conf/redis.conf daemonize yes pidfile \"/usr/local/cmz/redis08/log/redis.pid\" port 7008 timeout 300 cluster-enabled yes cluster-config-file /usr/local/cmz/redis08/nodes.conf cluster-node-timeout 15000 loglevel debug logfile \"/usr/local/cmz/redis08/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/cmz/redis08/data\" appendonly yes appendfsync always bind 0.0.0.0 \u542f\u52a8redis 7008\u5b9e\u4f8b root@manage01:/usr/local/cmz# ./redis08/bin/redis-server redis08/conf/redis.conf root@manage01:/usr/local/cmz# !ps ps axf|grep redis 11291 pts/18 S+ 0:00 \\_ grep --color=auto redis 9724 ? Ssl 0:07 ./redis01/bin/redis-server 0.0.0.0:7001 [cluster] 9734 ? Ssl 0:07 ./redis03/bin/redis-server 0.0.0.0:7003 [cluster] 9739 ? Ssl 0:06 ./redis04/bin/redis-server 0.0.0.0:7004 [cluster] 9744 ? Ssl 0:07 ./redis05/bin/redis-server 0.0.0.0:7005 [cluster] 9749 ? Ssl 0:06 ./redis06/bin/redis-server 0.0.0.0:7006 [cluster] 10398 ? Ssl 0:03 ./redis02/bin/redis-server 0.0.0.0:7002 [cluster] 10695 ? Ssl 0:05 ./redis07/bin/redis-server 0.0.0.0:7007 [cluster] 11286 ? Ssl 0:00 ./redis08/bin/redis-server 0.0.0.0:7008 [cluster]","title":"6. \u96c6\u7fa4\u6dfb\u52a0\u4ece\u8282\u70b9"},{"location":"linux/nosql/redis/redis.index/","text":"Redis \u4ecb\u7ecd 1. \u4ecb\u7ecd \u00b6 Redis \u662f\u5b8c\u5168\u5f00\u6e90\u514d\u8d39\u7684\uff0c\u9075\u5b88BSD\u534f\u8bae\uff0c\u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684key-value\u6570\u636e\u5e93\u3002Redis \u4e0e\u5176\u4ed6 key - value \u7f13\u5b58\u4ea7\u54c1\u6709\u4ee5\u4e0b\u4e09\u4e2a\u7279\u70b9\uff1a Redis\u652f\u6301\u6570\u636e\u7684\u6301\u4e45\u5316\uff0c\u53ef\u4ee5\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4fdd\u5b58\u5728\u78c1\u76d8\u4e2d\uff0c\u91cd\u542f\u7684\u65f6\u5019\u53ef\u4ee5\u518d\u6b21\u52a0\u8f7d\u8fdb\u884c\u4f7f\u7528\u3002 Redis\u4e0d\u4ec5\u4ec5\u652f\u6301\u7b80\u5355\u7684key-value\u7c7b\u578b\u7684\u6570\u636e\uff0c\u540c\u65f6\u8fd8\u63d0\u4f9blist\uff0cset\uff0czset\uff0chash\u7b49\u6570\u636e\u7ed3\u6784\u7684\u5b58\u50a8\u3002 Redis\u652f\u6301\u6570\u636e\u7684\u5907\u4efd\uff0c\u5373master-slave\u6a21\u5f0f\u7684\u6570\u636e\u5907\u4efd\u3002 2. \u4f18\u52bf \u00b6 \u6027\u80fd\u6781\u9ad8 \u2013 Redis\u80fd\u8bfb\u7684\u901f\u5ea6\u662f110000\u6b21/s,\u5199\u7684\u901f\u5ea6\u662f81000\u6b21/s \u3002 \u4e30\u5bcc\u7684\u6570\u636e\u7c7b\u578b \u2013 Redis\u652f\u6301\u4e8c\u8fdb\u5236\u6848\u4f8b\u7684 Strings, Lists, Hashes, Sets \u53ca Ordered Sets \u6570\u636e\u7c7b\u578b\u64cd\u4f5c\u3002 \u539f\u5b50 \u2013 Redis\u7684\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027\u7684\uff0c\u610f\u601d\u5c31\u662f\u8981\u4e48\u6210\u529f\u6267\u884c\u8981\u4e48\u5931\u8d25\u5b8c\u5168\u4e0d\u6267\u884c\u3002\u5355\u4e2a\u64cd\u4f5c\u662f\u539f\u5b50\u6027\u7684\u3002\u591a\u4e2a\u64cd\u4f5c\u4e5f\u652f\u6301\u4e8b\u52a1\uff0c\u5373\u539f\u5b50\u6027\uff0c\u901a\u8fc7MULTI\u548cEXEC\u6307\u4ee4\u5305\u8d77\u6765\u3002 \u4e30\u5bcc\u7684\u7279\u6027 \u2013 Redis\u8fd8\u652f\u6301 publish/subscribe, \u901a\u77e5, key \u8fc7\u671f\u7b49\u7b49\u7279\u6027\u3002 3. \u533a\u522b \u00b6 Redis\u6709\u7740\u66f4\u4e3a\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\u5e76\u4e14\u63d0\u4f9b\u5bf9\u4ed6\u4eec\u7684\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u8fd9\u662f\u4e00\u4e2a\u4e0d\u540c\u4e8e\u5176\u4ed6\u6570\u636e\u5e93\u7684\u8fdb\u5316\u8def\u5f84\u3002Redis\u7684\u6570\u636e\u7c7b\u578b\u90fd\u662f\u57fa\u4e8e\u57fa\u672c\u6570\u636e\u7ed3\u6784\u7684\u540c\u65f6\u5bf9\u7a0b\u5e8f\u5458\u900f\u660e\uff0c\u65e0\u9700\u8fdb\u884c\u989d\u5916\u7684\u62bd\u8c61\u3002 Redis\u8fd0\u884c\u5728\u5185\u5b58\u4e2d\u4f46\u662f\u53ef\u4ee5\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u6240\u4ee5\u5728\u5bf9\u4e0d\u540c\u6570\u636e\u96c6\u8fdb\u884c\u9ad8\u901f\u8bfb\u5199\u65f6\u9700\u8981\u6743\u8861\u5185\u5b58\uff0c\u56e0\u4e3a\u6570\u636e\u91cf\u4e0d\u80fd\u5927\u4e8e\u786c\u4ef6\u5185\u5b58\u3002\u5728\u5185\u5b58\u6570\u636e\u5e93\u65b9\u9762\u7684\u53e6\u4e00\u4e2a\u4f18\u70b9\u662f\uff0c\u76f8\u6bd4\u5728\u78c1\u76d8\u4e0a\u76f8\u540c\u7684\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5728\u5185\u5b58\u4e2d\u64cd\u4f5c\u8d77\u6765\u975e\u5e38\u7b80\u5355\uff0c\u8fd9\u6837Redis\u53ef\u4ee5\u505a\u5f88\u591a\u5185\u90e8\u590d\u6742\u6027\u5f88\u5f3a\u7684\u4e8b\u60c5\u3002\u540c\u65f6\uff0c\u5728\u78c1\u76d8\u683c\u5f0f\u65b9\u9762\u4ed6\u4eec\u662f\u7d27\u51d1\u7684\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u4ea7\u751f\u7684\uff0c\u56e0\u4e3a\u4ed6\u4eec\u5e76\u4e0d\u9700\u8981\u8fdb\u884c\u968f\u673a\u8bbf\u95ee\u3002","title":"01. redis \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.index/#1","text":"Redis \u662f\u5b8c\u5168\u5f00\u6e90\u514d\u8d39\u7684\uff0c\u9075\u5b88BSD\u534f\u8bae\uff0c\u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684key-value\u6570\u636e\u5e93\u3002Redis \u4e0e\u5176\u4ed6 key - value \u7f13\u5b58\u4ea7\u54c1\u6709\u4ee5\u4e0b\u4e09\u4e2a\u7279\u70b9\uff1a Redis\u652f\u6301\u6570\u636e\u7684\u6301\u4e45\u5316\uff0c\u53ef\u4ee5\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4fdd\u5b58\u5728\u78c1\u76d8\u4e2d\uff0c\u91cd\u542f\u7684\u65f6\u5019\u53ef\u4ee5\u518d\u6b21\u52a0\u8f7d\u8fdb\u884c\u4f7f\u7528\u3002 Redis\u4e0d\u4ec5\u4ec5\u652f\u6301\u7b80\u5355\u7684key-value\u7c7b\u578b\u7684\u6570\u636e\uff0c\u540c\u65f6\u8fd8\u63d0\u4f9blist\uff0cset\uff0czset\uff0chash\u7b49\u6570\u636e\u7ed3\u6784\u7684\u5b58\u50a8\u3002 Redis\u652f\u6301\u6570\u636e\u7684\u5907\u4efd\uff0c\u5373master-slave\u6a21\u5f0f\u7684\u6570\u636e\u5907\u4efd\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.index/#2","text":"\u6027\u80fd\u6781\u9ad8 \u2013 Redis\u80fd\u8bfb\u7684\u901f\u5ea6\u662f110000\u6b21/s,\u5199\u7684\u901f\u5ea6\u662f81000\u6b21/s \u3002 \u4e30\u5bcc\u7684\u6570\u636e\u7c7b\u578b \u2013 Redis\u652f\u6301\u4e8c\u8fdb\u5236\u6848\u4f8b\u7684 Strings, Lists, Hashes, Sets \u53ca Ordered Sets \u6570\u636e\u7c7b\u578b\u64cd\u4f5c\u3002 \u539f\u5b50 \u2013 Redis\u7684\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027\u7684\uff0c\u610f\u601d\u5c31\u662f\u8981\u4e48\u6210\u529f\u6267\u884c\u8981\u4e48\u5931\u8d25\u5b8c\u5168\u4e0d\u6267\u884c\u3002\u5355\u4e2a\u64cd\u4f5c\u662f\u539f\u5b50\u6027\u7684\u3002\u591a\u4e2a\u64cd\u4f5c\u4e5f\u652f\u6301\u4e8b\u52a1\uff0c\u5373\u539f\u5b50\u6027\uff0c\u901a\u8fc7MULTI\u548cEXEC\u6307\u4ee4\u5305\u8d77\u6765\u3002 \u4e30\u5bcc\u7684\u7279\u6027 \u2013 Redis\u8fd8\u652f\u6301 publish/subscribe, \u901a\u77e5, key \u8fc7\u671f\u7b49\u7b49\u7279\u6027\u3002","title":"2. \u4f18\u52bf"},{"location":"linux/nosql/redis/redis.index/#3","text":"Redis\u6709\u7740\u66f4\u4e3a\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\u5e76\u4e14\u63d0\u4f9b\u5bf9\u4ed6\u4eec\u7684\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u8fd9\u662f\u4e00\u4e2a\u4e0d\u540c\u4e8e\u5176\u4ed6\u6570\u636e\u5e93\u7684\u8fdb\u5316\u8def\u5f84\u3002Redis\u7684\u6570\u636e\u7c7b\u578b\u90fd\u662f\u57fa\u4e8e\u57fa\u672c\u6570\u636e\u7ed3\u6784\u7684\u540c\u65f6\u5bf9\u7a0b\u5e8f\u5458\u900f\u660e\uff0c\u65e0\u9700\u8fdb\u884c\u989d\u5916\u7684\u62bd\u8c61\u3002 Redis\u8fd0\u884c\u5728\u5185\u5b58\u4e2d\u4f46\u662f\u53ef\u4ee5\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u6240\u4ee5\u5728\u5bf9\u4e0d\u540c\u6570\u636e\u96c6\u8fdb\u884c\u9ad8\u901f\u8bfb\u5199\u65f6\u9700\u8981\u6743\u8861\u5185\u5b58\uff0c\u56e0\u4e3a\u6570\u636e\u91cf\u4e0d\u80fd\u5927\u4e8e\u786c\u4ef6\u5185\u5b58\u3002\u5728\u5185\u5b58\u6570\u636e\u5e93\u65b9\u9762\u7684\u53e6\u4e00\u4e2a\u4f18\u70b9\u662f\uff0c\u76f8\u6bd4\u5728\u78c1\u76d8\u4e0a\u76f8\u540c\u7684\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5728\u5185\u5b58\u4e2d\u64cd\u4f5c\u8d77\u6765\u975e\u5e38\u7b80\u5355\uff0c\u8fd9\u6837Redis\u53ef\u4ee5\u505a\u5f88\u591a\u5185\u90e8\u590d\u6742\u6027\u5f88\u5f3a\u7684\u4e8b\u60c5\u3002\u540c\u65f6\uff0c\u5728\u78c1\u76d8\u683c\u5f0f\u65b9\u9762\u4ed6\u4eec\u662f\u7d27\u51d1\u7684\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u4ea7\u751f\u7684\uff0c\u56e0\u4e3a\u4ed6\u4eec\u5e76\u4e0d\u9700\u8981\u8fdb\u884c\u968f\u673a\u8bbf\u95ee\u3002","title":"3. \u533a\u522b"},{"location":"linux/nosql/redis/redis.install/","text":"Redis \u4ecb\u7ecd 1. \u4ecb\u7ecd \u00b6 \u4e0b\u8f7d\u5b89\u88c5,\u5728\u5b98\u7f51\u627e\u5230\u6700\u65b0\u6700\u7a33\u5b9a\u7684\u4e0b\u8f7d\u5730\u5740 redis\u5b89\u88c5\u53c2\u8003\u6307\u5357 root@manage01:/usr/local/src# wget http://download.redis.io/releases/redis-5.0.3.tar.gz --2019-03-11 11:11:06-- http://download.redis.io/releases/redis-5.0.3.tar.gz Resolving download.redis.io (download.redis.io)... 109.74.203.151 Connecting to download.redis.io (download.redis.io)|109.74.203.151|:80... connected. HTTP request sent, awaiting response... 200 OK Length: 1959445 (1,9M) [application/x-gzip] Saving to: \u2018redis-5.0.3.tar.gz\u2019 redis-5.0.3.tar.gz 100%[====================================================================================================>] 1,87M 643KB/s in 3,0s 2019-03-11 11:11:10 (643 KB/s) - \u2018redis-5.0.3.tar.gz\u2019 saved [1959445/1959445] root@manage01:/usr/local/src# ls redis-5.0.3.tar.gz redis-5.0.3.tar.gz root@manage01:/usr/local/src# tar xf redis-5.0.3.tar.gz -C /usr/local ccroot@manage01:/usr/local/src# cd /usr/local root@manage01:/usr/local# ln -sf redis-5.0.3/ redis root@manage01:/usr/local# cd redis root@manage01:/usr/local/redis# make root@manage01:/usr/local/redis# echo $? 0 \u7b49\u4e8e0 \u5c31\u8868\u793a\u7f16\u7801\u6ca1\u6709\u9519\u8bef\u3002 root@manage01:/usr/local/redis# mkdir bin conf data log root@manage01:/usr/local/redis# ls bin conf data log make\u5b8c\u540e redis-5.0.3\u76ee\u5f55\u4e0b\u4f1a\u51fa\u73b0\u7f16\u8bd1\u540e\u7684redis\u670d\u52a1\u7a0b\u5e8fredis-server,\u8fd8\u6709\u7528\u4e8e\u6d4b\u8bd5\u7684\u5ba2\u6237\u7aef\u7a0b\u5e8fredis-cli,\u4e24\u4e2a\u7a0b\u5e8f\u4f4d\u4e8e\u5b89\u88c5\u76ee\u5f55 src \u76ee\u5f55\u4e0b\uff1a\u4e0b\u9762\u542f\u52a8redis\u670d\u52a1. 2. \u914d\u7f6e \u00b6 root@manage01:/usr/local/redis-s/src# cp -aR redis-check-aof redis-check-rdb redis-cli redis-sentinel redis-server redis-trib.rb redis-benchmark /usr/local/redis/bin/ root@manage01:/usr/local/redis-s/src# cp ../redis.conf /usr/local/redis/conf/ root@manage01:~# cat /usr/local/redis/conf/redis.conf daemonize yes pidfile \"/usr/local/redis/log/redis.pid\" port 6379 timeout 300 loglevel debug logfile \"/usr/local/redis/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/redis/data\" appendonly no appendfsync always bind 0.0.0.0 \u53c2\u6570\u89e3\u91ca daemonize no \uff08\u9ed8\u8ba4\uff09\uff0c\u6539\u6210 yes \uff0c\u610f\u601d\u662f\u662f\u5426\u8981\u540e\u53f0\u542f\u52a8\u3002 root@manage01:~# cd /usr/local/redis root@manage01:/usr/local/redis# tree . . \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 redis-benchmark \u2502 \u251c\u2500\u2500 redis-check-aof \u2502 \u251c\u2500\u2500 redis-check-rdb \u2502 \u251c\u2500\u2500 redis-cli \u2502 \u251c\u2500\u2500 redis-sentinel \u2502 \u251c\u2500\u2500 redis-server \u2502 \u2514\u2500\u2500 redis-trib.rb \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 redis.conf \u2502 \u2514\u2500\u2500 redis.conf.ori \u251c\u2500\u2500 data \u2502 \u2514\u2500\u2500 dump.rdb \u2514\u2500\u2500 log \u251c\u2500\u2500 redis.log \u2514\u2500\u2500 redis.pid 4 directories, 12 files \u4e2d\u95f4\u6709\u7701\u7565\uff0c\u6700\u7ec8\u662f\u8fd9\u6837 3. \u914d\u7f6e\u73af\u5883\u53d8\u91cf \u00b6 root@manage01:~# grep redis /etc/profile export PATH=$PATH:/usr/local/redis/bin root@manage01:~# source /etc/profile 4. \u542f\u52a8\u811a\u672c \u00b6 root@manage01:/usr/local/redis/conf# cat /etc/init.d/redis #!/bin/sh # # Simple Redis init.d script conceived to work on Linux systems # as it does use of the /proc filesystem. # chkconfig: 2345 90 10 # description: Redis is a persistent key-value database # REDISPORT=6379 EXEC=/usr/local/redis/bin/redis-server CLIEXEC=/usr/local/redis/bin/redis-cli PIDFILE=/usr/local/redis/log/redis.pid CONF=\"/usr/local/redis/conf/redis.conf\" case \"$1\" in start) if [ -f $PIDFILE ] then echo \"$PIDFILE exists, process is already running or crashed\" else echo \"Starting Redis server...\" $EXEC $CONF echo $(ps aux|grep redis|grep -v grep|grep 6379|awk '{print $2}')>$PIDFILE fi ;; stop) if [ ! -f $PIDFILE ] then echo \"$PIDFILE does not exist, process is not running\" else PID=$(cat $PIDFILE) echo \"Stopping ...\" $CLIEXEC -p $REDISPORT shutdown while [ -x /proc/${PID} ] do echo \"Waiting for Redis to shutdown ...\" sleep 1 done echo \"Redis stopped\" cd /usr/local/redis/log/ && rm -f redis.pid fi ;; *) echo \"Please use start or stop as first argument\" ;; esac root@manage01:/usr/local/redis/conf# chmod +x /etc/init.d/redis 5. \u542f\u52a8\u4e0e\u505c\u6b62 \u00b6 root@manage01:/usr/local/redis/conf# /etc/init.d/redis stop Stopping ... Redis stopped root@manage01:/usr/local/redis/conf# !p pwd /usr/local/redis/conf root@manage01:/usr/local/redis/conf# !ps ps axf|grep redis 11619 pts/18 S+ 0:00 | \\_ grep --color=auto redis root@manage01:/usr/local/redis/conf# /etc/init.d/redis start Starting Redis server... root@manage01:/usr/local/redis/conf# !ps ps axf|grep redis 11634 pts/18 S+ 0:00 | \\_ grep --color=auto redis 11622 ? Ssl 0:00 /usr/local/redis/bin/redis-server 0.0.0.0:6379 6. \u57fa\u672c\u6d4b\u8bd5 \u00b6 root@manage01:~# redis-cli 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> set k1 v1 OK 127.0.0.1:6379> get k1 \"v1\" 127.0.0.1:6379> root@manage01:~# redis-cli 127.0.0.1:6379> get k1 \"v1\" 127.0.0.1:6379> root@manage01:~# pkill redis root@manage01:~# !ps ps axf|grep redis 11273 pts/18 S+ 0:00 | \\_ grep --color=auto redis root@manage01:~# redis-server /usr/local/redis/conf/redis.conf root@manage01:~# ps axf|grep redis 11282 pts/18 S+ 0:00 | \\_ grep --color=auto redis 11277 ? Ssl 0:00 redis-server 0.0.0.0:6379 root@manage01:~# redis-cli 127.0.0.1:6379> keys * 1) \"k1\" 127.0.0.1:6379> get k1 \"v1\"","title":"02. redis \u5b89\u88c5"},{"location":"linux/nosql/redis/redis.install/#1","text":"\u4e0b\u8f7d\u5b89\u88c5,\u5728\u5b98\u7f51\u627e\u5230\u6700\u65b0\u6700\u7a33\u5b9a\u7684\u4e0b\u8f7d\u5730\u5740 redis\u5b89\u88c5\u53c2\u8003\u6307\u5357 root@manage01:/usr/local/src# wget http://download.redis.io/releases/redis-5.0.3.tar.gz --2019-03-11 11:11:06-- http://download.redis.io/releases/redis-5.0.3.tar.gz Resolving download.redis.io (download.redis.io)... 109.74.203.151 Connecting to download.redis.io (download.redis.io)|109.74.203.151|:80... connected. HTTP request sent, awaiting response... 200 OK Length: 1959445 (1,9M) [application/x-gzip] Saving to: \u2018redis-5.0.3.tar.gz\u2019 redis-5.0.3.tar.gz 100%[====================================================================================================>] 1,87M 643KB/s in 3,0s 2019-03-11 11:11:10 (643 KB/s) - \u2018redis-5.0.3.tar.gz\u2019 saved [1959445/1959445] root@manage01:/usr/local/src# ls redis-5.0.3.tar.gz redis-5.0.3.tar.gz root@manage01:/usr/local/src# tar xf redis-5.0.3.tar.gz -C /usr/local ccroot@manage01:/usr/local/src# cd /usr/local root@manage01:/usr/local# ln -sf redis-5.0.3/ redis root@manage01:/usr/local# cd redis root@manage01:/usr/local/redis# make root@manage01:/usr/local/redis# echo $? 0 \u7b49\u4e8e0 \u5c31\u8868\u793a\u7f16\u7801\u6ca1\u6709\u9519\u8bef\u3002 root@manage01:/usr/local/redis# mkdir bin conf data log root@manage01:/usr/local/redis# ls bin conf data log make\u5b8c\u540e redis-5.0.3\u76ee\u5f55\u4e0b\u4f1a\u51fa\u73b0\u7f16\u8bd1\u540e\u7684redis\u670d\u52a1\u7a0b\u5e8fredis-server,\u8fd8\u6709\u7528\u4e8e\u6d4b\u8bd5\u7684\u5ba2\u6237\u7aef\u7a0b\u5e8fredis-cli,\u4e24\u4e2a\u7a0b\u5e8f\u4f4d\u4e8e\u5b89\u88c5\u76ee\u5f55 src \u76ee\u5f55\u4e0b\uff1a\u4e0b\u9762\u542f\u52a8redis\u670d\u52a1.","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.install/#2","text":"root@manage01:/usr/local/redis-s/src# cp -aR redis-check-aof redis-check-rdb redis-cli redis-sentinel redis-server redis-trib.rb redis-benchmark /usr/local/redis/bin/ root@manage01:/usr/local/redis-s/src# cp ../redis.conf /usr/local/redis/conf/ root@manage01:~# cat /usr/local/redis/conf/redis.conf daemonize yes pidfile \"/usr/local/redis/log/redis.pid\" port 6379 timeout 300 loglevel debug logfile \"/usr/local/redis/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/redis/data\" appendonly no appendfsync always bind 0.0.0.0 \u53c2\u6570\u89e3\u91ca daemonize no \uff08\u9ed8\u8ba4\uff09\uff0c\u6539\u6210 yes \uff0c\u610f\u601d\u662f\u662f\u5426\u8981\u540e\u53f0\u542f\u52a8\u3002 root@manage01:~# cd /usr/local/redis root@manage01:/usr/local/redis# tree . . \u251c\u2500\u2500 bin \u2502 \u251c\u2500\u2500 redis-benchmark \u2502 \u251c\u2500\u2500 redis-check-aof \u2502 \u251c\u2500\u2500 redis-check-rdb \u2502 \u251c\u2500\u2500 redis-cli \u2502 \u251c\u2500\u2500 redis-sentinel \u2502 \u251c\u2500\u2500 redis-server \u2502 \u2514\u2500\u2500 redis-trib.rb \u251c\u2500\u2500 conf \u2502 \u251c\u2500\u2500 redis.conf \u2502 \u2514\u2500\u2500 redis.conf.ori \u251c\u2500\u2500 data \u2502 \u2514\u2500\u2500 dump.rdb \u2514\u2500\u2500 log \u251c\u2500\u2500 redis.log \u2514\u2500\u2500 redis.pid 4 directories, 12 files \u4e2d\u95f4\u6709\u7701\u7565\uff0c\u6700\u7ec8\u662f\u8fd9\u6837","title":"2. \u914d\u7f6e"},{"location":"linux/nosql/redis/redis.install/#3","text":"root@manage01:~# grep redis /etc/profile export PATH=$PATH:/usr/local/redis/bin root@manage01:~# source /etc/profile","title":"3. \u914d\u7f6e\u73af\u5883\u53d8\u91cf"},{"location":"linux/nosql/redis/redis.install/#4","text":"root@manage01:/usr/local/redis/conf# cat /etc/init.d/redis #!/bin/sh # # Simple Redis init.d script conceived to work on Linux systems # as it does use of the /proc filesystem. # chkconfig: 2345 90 10 # description: Redis is a persistent key-value database # REDISPORT=6379 EXEC=/usr/local/redis/bin/redis-server CLIEXEC=/usr/local/redis/bin/redis-cli PIDFILE=/usr/local/redis/log/redis.pid CONF=\"/usr/local/redis/conf/redis.conf\" case \"$1\" in start) if [ -f $PIDFILE ] then echo \"$PIDFILE exists, process is already running or crashed\" else echo \"Starting Redis server...\" $EXEC $CONF echo $(ps aux|grep redis|grep -v grep|grep 6379|awk '{print $2}')>$PIDFILE fi ;; stop) if [ ! -f $PIDFILE ] then echo \"$PIDFILE does not exist, process is not running\" else PID=$(cat $PIDFILE) echo \"Stopping ...\" $CLIEXEC -p $REDISPORT shutdown while [ -x /proc/${PID} ] do echo \"Waiting for Redis to shutdown ...\" sleep 1 done echo \"Redis stopped\" cd /usr/local/redis/log/ && rm -f redis.pid fi ;; *) echo \"Please use start or stop as first argument\" ;; esac root@manage01:/usr/local/redis/conf# chmod +x /etc/init.d/redis","title":"4. \u542f\u52a8\u811a\u672c"},{"location":"linux/nosql/redis/redis.install/#5","text":"root@manage01:/usr/local/redis/conf# /etc/init.d/redis stop Stopping ... Redis stopped root@manage01:/usr/local/redis/conf# !p pwd /usr/local/redis/conf root@manage01:/usr/local/redis/conf# !ps ps axf|grep redis 11619 pts/18 S+ 0:00 | \\_ grep --color=auto redis root@manage01:/usr/local/redis/conf# /etc/init.d/redis start Starting Redis server... root@manage01:/usr/local/redis/conf# !ps ps axf|grep redis 11634 pts/18 S+ 0:00 | \\_ grep --color=auto redis 11622 ? Ssl 0:00 /usr/local/redis/bin/redis-server 0.0.0.0:6379","title":"5. \u542f\u52a8\u4e0e\u505c\u6b62"},{"location":"linux/nosql/redis/redis.install/#6","text":"root@manage01:~# redis-cli 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> set k1 v1 OK 127.0.0.1:6379> get k1 \"v1\" 127.0.0.1:6379> root@manage01:~# redis-cli 127.0.0.1:6379> get k1 \"v1\" 127.0.0.1:6379> root@manage01:~# pkill redis root@manage01:~# !ps ps axf|grep redis 11273 pts/18 S+ 0:00 | \\_ grep --color=auto redis root@manage01:~# redis-server /usr/local/redis/conf/redis.conf root@manage01:~# ps axf|grep redis 11282 pts/18 S+ 0:00 | \\_ grep --color=auto redis 11277 ? Ssl 0:00 redis-server 0.0.0.0:6379 root@manage01:~# redis-cli 127.0.0.1:6379> keys * 1) \"k1\" 127.0.0.1:6379> get k1 \"v1\"","title":"6. \u57fa\u672c\u6d4b\u8bd5"},{"location":"linux/nosql/redis/redis.k_v/","text":"Redis \u952e\u503c\u5bf9 1. \u4ecb\u7ecd \u00b6 Redis \u952e\u547d\u4ee4\u7528\u4e8e\u7ba1\u7406 redis \u7684\u952e\u3002 1.1 \u8bed\u6cd5 \u00b6 COMMAND KEY_NAME 1.2 \u547d\u4ee4 \u00b6 Redis keys \u547d\u4ee4 \u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 del key \u8be5\u547d\u4ee4\u7528\u4e8e\u5728 key \u5b58\u5728\u65f6\u5220\u9664 key 2 dump key \u5e8f\u5217\u5316\u7ed9\u5b9a key \uff0c\u5e76\u8fd4\u56de\u88ab\u5e8f\u5217\u5316\u7684\u503c 3 EXISTS key \u68c0\u67e5\u7ed9\u5b9a key \u662f\u5426\u5b58\u5728\u3002 4 EXPIRE key seconds \u4e3a\u7ed9\u5b9a key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u79d2\u8ba1 5 EXPIREAT key timestamp EXPIREAT \u7684\u4f5c\u7528\u548c EXPIRE \u7c7b\u4f3c\uff0c\u90fd\u7528\u4e8e\u4e3a key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u4e0d\u540c\u5728\u4e8e EXPIREAT \u547d\u4ee4\u63a5\u53d7\u7684\u65f6\u95f4\u53c2\u6570\u662f UNIX \u65f6\u95f4\u6233(unix timestamp)\u3002 6 PEXPIRE key milliseconds \u8bbe\u7f6e key \u7684\u8fc7\u671f\u65f6\u95f4\u4ee5\u6beb\u79d2\u8ba1\u3002 7 PEXPIREAT key milliseconds-timestamp \u8bbe\u7f6e key \u8fc7\u671f\u65f6\u95f4\u7684\u65f6\u95f4\u6233(unix timestamp) \u4ee5\u6beb\u79d2\u8ba1 8 KEYS pattern \u67e5\u627e\u6240\u6709\u7b26\u5408\u7ed9\u5b9a\u6a21\u5f0f( pattern)\u7684 key \u3002 9 MOVE key db \u5c06\u5f53\u524d\u6570\u636e\u5e93\u7684 key \u79fb\u52a8\u5230\u7ed9\u5b9a\u7684\u6570\u636e\u5e93 db \u5f53\u4e2d\u3002 10 PERSIST key \u79fb\u9664 key \u7684\u8fc7\u671f\u65f6\u95f4\uff0ckey \u5c06\u6301\u4e45\u4fdd\u6301\u3002 11 PTTL key \u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u8fd4\u56de key \u7684\u5269\u4f59\u7684\u8fc7\u671f\u65f6\u95f4\u3002 12 TTL key \u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0c\u8fd4\u56de\u7ed9\u5b9a key \u7684\u5269\u4f59\u751f\u5b58\u65f6\u95f4(TTL, time to live)\u3002 13 RANDOMKEY \u4ece\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u968f\u673a\u8fd4\u56de\u4e00\u4e2a key \u3002 14 RENAME key newkey \u4fee\u6539 key \u7684\u540d\u79f0 15 RENAMENX key newkey \u4ec5\u5f53 newkey \u4e0d\u5b58\u5728\u65f6\uff0c\u5c06 key \u6539\u540d\u4e3a newkey \u3002 16 TYPE key \u8fd4\u56de key \u6240\u50a8\u5b58\u7684\u503c\u7684\u7c7b\u578b\u3002 1.3 \u5b9e\u4f8b \u00b6 root@manage01:/home/loocha# redis-cli 127.0.0.1:6379> AUTH cmz OK 127.0.0.1:6379> keys * # \u67e5\u770b\u6240\u6709key 1) \"k1\" 127.0.0.1:6379> set k2 v2 (error) NOAUTH Authentication required. 127.0.0.1:6379> auth cmz # \u8ba4\u8bc1 OK 127.0.0.1:6379> keys * 1) \"k1\" 127.0.0.1:6379> del k1 # \u5220\u9664k1 (integer) 1 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> set k1 v1 OK 127.0.0.1:6379> get v1 (nil) 127.0.0.1:6379> DUMP k1 \"\\x00\\x02v1\\t\\x00\\x8f\\x17\\xe1\\x92\\x9f\\xd6\\x1a\\xea\" 127.0.0.1:6379> EXISTS k1 # \u5224\u65adk1\u662f\u5426\u5b58\u5728 (integer) 1 127.0.0.1:6379> EXISTS k12 (integer) 0 127.0.0.1:6379> EXPIRE k1 10 (integer) 1 127.0.0.1:6379> keys * 1) \"k1\" # \u7b49\u5f85\u5341\u79d2 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> set k1 v1 OK 127.0.0.1:6379> EXPIRE k1 100 (integer) 1 127.0.0.1:6379> TTL k1 (integer) 95 127.0.0.1:6379> RANDOMKEY \"k1\" 127.0.0.1:6379> set k2 v2 OK 127.0.0.1:6379> set 3 v3 OK 127.0.0.1:6379> RANDOMKEY \"3\" 127.0.0.1:6379> RANDOMKEY \"k1\" 127.0.0.1:6379> RANDOMKEY \"k2\" 127.0.0.1:6379> mv 3 k3 (error) ERR unknown command `mv`, with args beginning with: `3`, `k3`, 127.0.0.1:6379> keys * 1) \"3\" 2) \"k2\" 3) \"k1\" 2. \u5b57\u7b26\u4e32(String) \u00b6 2.1 \u8bed\u6cd5 \u00b6 Redis \u5b57\u7b26\u4e32\u6570\u636e\u7c7b\u578b\u7684\u76f8\u5173\u547d\u4ee4\u7528\u4e8e\u7ba1\u7406 redis \u5b57\u7b26\u4e32\u503c\uff0c\u57fa\u672c\u8bed\u6cd5\u5982\u4e0b\uff1a COMMAND KEY_NAME 2.2 \u547d\u4ee4 \u00b6 Redis \u5b57\u7b26\u4e32\u547d\u4ee4 \u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 SET key value \u8bbe\u7f6e\u6307\u5b9a key \u7684\u503c 2 GET key \u83b7\u53d6\u6307\u5b9a key \u7684\u503c\u3002 3 GETRANGE key start end \u8fd4\u56de key \u4e2d\u5b57\u7b26\u4e32\u503c\u7684\u5b50\u5b57\u7b26 4 GETSET key value \u5c06\u7ed9\u5b9a key \u7684\u503c\u8bbe\u4e3a value \uff0c\u5e76\u8fd4\u56de key \u7684\u65e7\u503c(old value)\u3002 5 GETBIT key offset \u5bf9 key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\uff0c\u83b7\u53d6\u6307\u5b9a\u504f\u79fb\u91cf\u4e0a\u7684\u4f4d(bit)\u3002 6 MGET key1 [key2..] \u83b7\u53d6\u6240\u6709(\u4e00\u4e2a\u6216\u591a\u4e2a)\u7ed9\u5b9a key \u7684\u503c\u3002 7 SETBIT key offset value \u5bf9 key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\uff0c\u8bbe\u7f6e\u6216\u6e05\u9664\u6307\u5b9a\u504f\u79fb\u91cf\u4e0a\u7684\u4f4d(bit)\u3002 8 SETEX key seconds value \u5c06\u503c value \u5173\u8054\u5230 key \uff0c\u5e76\u5c06 key \u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u4e3a seconds (\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002 9 SETNX key value \u53ea\u6709\u5728 key \u4e0d\u5b58\u5728\u65f6\u8bbe\u7f6e key \u7684\u503c\u3002 10 SETRANGE key offset value \u7528 value \u53c2\u6570\u8986\u5199\u7ed9\u5b9a key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\uff0c\u4ece\u504f\u79fb\u91cf offset \u5f00\u59cb\u3002 11 STRLEN key \u8fd4\u56de key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\u7684\u957f\u5ea6\u3002 12 MSET key value [key value ...] \u540c\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u6216\u591a\u4e2a key-value \u5bf9\u3002 13 MSETNX key value [key value ...] \u540c\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u6216\u591a\u4e2a key-value \u5bf9\uff0c\u5f53\u4e14\u4ec5\u5f53\u6240\u6709\u7ed9\u5b9a key \u90fd\u4e0d\u5b58\u5728\u3002 14 PSETEX key milliseconds value \u8fd9\u4e2a\u547d\u4ee4\u548c SETEX \u547d\u4ee4\u76f8\u4f3c\uff0c\u4f46\u5b83\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u8bbe\u7f6e key \u7684\u751f\u5b58\u65f6\u95f4\uff0c\u800c\u4e0d\u662f\u50cf SETEX \u547d\u4ee4\u90a3\u6837\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002 15 INCR key \u5c06 key \u4e2d\u50a8\u5b58\u7684\u6570\u5b57\u503c\u589e\u4e00\u3002 16 INCRBY key increment \u5c06 key \u6240\u50a8\u5b58\u7684\u503c\u52a0\u4e0a\u7ed9\u5b9a\u7684\u589e\u91cf\u503c\uff08increment\uff09 \u3002 17 INCRBYFLOAT key increment \u5c06 key \u6240\u50a8\u5b58\u7684\u503c\u52a0\u4e0a\u7ed9\u5b9a\u7684\u6d6e\u70b9\u589e\u91cf\u503c\uff08increment\uff09 \u3002 18 DECR key \u5c06 key \u4e2d\u50a8\u5b58\u7684\u6570\u5b57\u503c\u51cf\u4e00\u3002 19 DECRBY key decrement key \u6240\u50a8\u5b58\u7684\u503c\u51cf\u53bb\u7ed9\u5b9a\u7684\u51cf\u91cf\u503c\uff08decrement\uff09 \u3002 20 APPEND key value \u5982\u679c key \u5df2\u7ecf\u5b58\u5728\u5e76\u4e14\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c APPEND \u547d\u4ee4\u5c06\u6307\u5b9a\u7684 value \u8ffd\u52a0\u5230\u8be5 key \u539f\u6765\u503c\uff08value\uff09\u7684\u672b\u5c3e\u3002 2.3 \u5b9e\u4f8b \u00b6 127.0.0.1:6379> FLUSHALL OK 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> set name cmz OK 127.0.0.1:6379> set age 10 OK 127.0.0.1:6379> set sex male OK 127.0.0.1:6379> keys * 1) \"sex\" 2) \"age\" 3) \"name\" 127.0.0.1:6379> type sex string 127.0.0.1:6379> type name string 127.0.0.1:6379> type age string 127.0.0.1:6379> MGET name age sex 1) \"cmz\" 2) \"10\" 3) \"male\" 127.0.0.1:6379> mset k1 v1 k2 v2 OK 127.0.0.1:6379> keys * 1) \"age\" 2) \"k1\" 3) \"sex\" 4) \"name\" 5) \"k2\" 127.0.0.1:6379> get age \"10\" 127.0.0.1:6379> INCR age (integer) 11 127.0.0.1:6379> get age \"11\" 127.0.0.1:6379> DECR age (integer) 10 127.0.0.1:6379> get age \"10\" 127.0.0.1:6379> get name \"cmz\" 127.0.0.1:6379> APPEND name _caimengzhi (integer) 14 127.0.0.1:6379> get name \"cmz_caimengzhi\" 3. \u54c8\u5e0c(Hash) \u00b6 Redis hash \u662f\u4e00\u4e2astring\u7c7b\u578b\u7684field\u548cvalue\u7684\u6620\u5c04\u8868\uff0chash\u7279\u522b\u9002\u5408\u7528\u4e8e\u5b58\u50a8\u5bf9\u8c61\u3002Redis \u4e2d\u6bcf\u4e2a hash \u53ef\u4ee5\u5b58\u50a8 232 - 1 \u952e\u503c\u5bf9\uff0840\u591a\u4ebf\uff09\u3002 3.1 \u8bed\u6cd5 \u00b6 COMMAND KEY_NAME 3.2 \u547d\u4ee4 \u00b6 \u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 HDEL key field1 [field2] \u5220\u9664\u4e00\u4e2a\u6216\u591a\u4e2a\u54c8\u5e0c\u8868\u5b57\u6bb5 2 HEXISTS key field \u67e5\u770b\u54c8\u5e0c\u8868 key \u4e2d\uff0c\u6307\u5b9a\u7684\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u3002 3 HGET key field \u83b7\u53d6\u5b58\u50a8\u5728\u54c8\u5e0c\u8868\u4e2d\u6307\u5b9a\u5b57\u6bb5\u7684\u503c\u3002 4 HGETALL key \u83b7\u53d6\u5728\u54c8\u5e0c\u8868\u4e2d\u6307\u5b9a key \u7684\u6240\u6709\u5b57\u6bb5\u548c\u503c 5 HINCRBY key field increment \u4e3a\u54c8\u5e0c\u8868 key \u4e2d\u7684\u6307\u5b9a\u5b57\u6bb5\u7684\u6574\u6570\u503c\u52a0\u4e0a\u589e\u91cf increment \u3002 6 HINCRBYFLOAT key field increment \u4e3a\u54c8\u5e0c\u8868 key \u4e2d\u7684\u6307\u5b9a\u5b57\u6bb5\u7684\u6d6e\u70b9\u6570\u503c\u52a0\u4e0a\u589e\u91cf increment \u3002 7 HKEYS key \u83b7\u53d6\u6240\u6709\u54c8\u5e0c\u8868\u4e2d\u7684\u5b57\u6bb5 8 HLEN key \u83b7\u53d6\u54c8\u5e0c\u8868\u4e2d\u5b57\u6bb5\u7684\u6570\u91cf 9 HMGET key field1 [field2] \u83b7\u53d6\u6240\u6709\u7ed9\u5b9a\u5b57\u6bb5\u7684\u503c 10 HMSET key field1 value1 [field2 value2 ] \u540c\u65f6\u5c06\u591a\u4e2a field-value (\u57df-\u503c)\u5bf9\u8bbe\u7f6e\u5230\u54c8\u5e0c\u8868 key \u4e2d\u3002 11 HSET key field value \u5c06\u54c8\u5e0c\u8868 key \u4e2d\u7684\u5b57\u6bb5 field \u7684\u503c\u8bbe\u4e3a value \u3002 12 HSETNX key field value \u53ea\u6709\u5728\u5b57\u6bb5 field \u4e0d\u5b58\u5728\u65f6\uff0c\u8bbe\u7f6e\u54c8\u5e0c\u8868\u5b57\u6bb5\u7684\u503c\u3002 13 HVALS key \u83b7\u53d6\u54c8\u5e0c\u8868\u4e2d\u6240\u6709\u503c 14 HSCAN key cursor [MATCH pattern] [COUNT count] \u8fed\u4ee3\u54c8\u5e0c\u8868\u4e2d\u7684\u952e\u503c\u5bf9\u3002 3.3 \u5b9e\u4f8b \u00b6 127.0.0.1:6379> select 1 OK 127.0.0.1:6379[1]> keys * (empty list or set) 127.0.0.1:6379[1]> HMSET cmz name caimengzhi age 30 description \"I love python.\" OK 127.0.0.1:6379[1]> keys * 1) \"cmz\" 127.0.0.1:6379[1]> HGETALL cmz 1) \"name\" 2) \"caimengzhi\" 3) \"age\" 4) \"30\" 5) \"description\" 6) \"I love python.\" 127.0.0.1:6379[1]> hget cmz name \"caimengzhi\" 127.0.0.1:6379[1]> hget cmz age \"30\" 127.0.0.1:6379[1]> hget cmz description \"I love python.\" 127.0.0.1:6379[1]> HKEYS cmz 1) \"name\" 2) \"age\" 3) \"description\" 127.0.0.1:6379[1]> HLEN cmz (integer) 3 127.0.0.1:6379[1]> hset cmz age 32 (integer) 0 127.0.0.1:6379[1]> hget cmz age \"32\" 127.0.0.1:6379[1]> HDEL cmz age (integer) 1 127.0.0.1:6379[1]> HGETALL cmz 1) \"name\" 2) \"caimengzhi\" 3) \"description\" 4) \"I love python. 4. \u5217\u8868(List) \u00b6 Redis\u5217\u8868\u662f\u7b80\u5355\u7684\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u6309\u7167\u63d2\u5165\u987a\u5e8f\u6392\u5e8f\u3002\u4f60\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20\u5230\u5217\u8868\u7684\u5934\u90e8\uff08\u5de6\u8fb9\uff09\u6216\u8005\u5c3e\u90e8\uff08\u53f3\u8fb9\uff09\uff0c\u4e00\u4e2a\u5217\u8868\u6700\u591a\u53ef\u4ee5\u5305\u542b 232 - 1 \u4e2a\u5143\u7d20 (4294967295, \u6bcf\u4e2a\u5217\u8868\u8d85\u8fc740\u4ebf\u4e2a\u5143\u7d20)\u3002 4.1 \u8bed\u6cd5 \u00b6 COMMAND KEY_NAME 4.2 \u547d\u4ee4 \u00b6 \u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 BLPOP key1 [key2 ] timeout \u79fb\u51fa\u5e76\u83b7\u53d6\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c \u5982\u679c\u5217\u8868\u6ca1\u6709\u5143\u7d20\u4f1a\u963b\u585e\u5217\u8868\u76f4\u5230\u7b49\u5f85\u8d85\u65f6\u6216\u53d1\u73b0\u53ef\u5f39\u51fa\u5143\u7d20\u4e3a\u6b62\u3002 2 BRPOP key1 [key2 ] timeout \u79fb\u51fa\u5e76\u83b7\u53d6\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c \u5982\u679c\u5217\u8868\u6ca1\u6709\u5143\u7d20\u4f1a\u963b\u585e\u5217\u8868\u76f4\u5230\u7b49\u5f85\u8d85\u65f6\u6216\u53d1\u73b0\u53ef\u5f39\u51fa\u5143\u7d20\u4e3a\u6b62\u3002 3 BRPOPLPUSH source destination timeout \u4ece\u5217\u8868\u4e2d\u5f39\u51fa\u4e00\u4e2a\u503c\uff0c\u5c06\u5f39\u51fa\u7684\u5143\u7d20\u63d2\u5165\u5230\u53e6\u5916\u4e00\u4e2a\u5217\u8868\u4e2d\u5e76\u8fd4\u56de\u5b83\uff1b \u5982\u679c\u5217\u8868\u6ca1\u6709\u5143\u7d20\u4f1a\u963b\u585e\u5217\u8868\u76f4\u5230\u7b49\u5f85\u8d85\u65f6\u6216\u53d1\u73b0\u53ef\u5f39\u51fa\u5143\u7d20\u4e3a\u6b62\u3002 4 LINDEX key index \u901a\u8fc7\u7d22\u5f15\u83b7\u53d6\u5217\u8868\u4e2d\u7684\u5143\u7d20 5 LINSERT key BEFORE|AFTER pivot value \u5728\u5217\u8868\u7684\u5143\u7d20\u524d\u6216\u8005\u540e\u63d2\u5165\u5143\u7d20 6 LLEN key \u83b7\u53d6\u5217\u8868\u957f\u5ea6 7 LPOP key \u79fb\u51fa\u5e76\u83b7\u53d6\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20 8 LPUSH key value1 [value2] \u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u503c\u63d2\u5165\u5230\u5217\u8868\u5934\u90e8 9 LPUSHX key value \u5c06\u4e00\u4e2a\u503c\u63d2\u5165\u5230\u5df2\u5b58\u5728\u7684\u5217\u8868\u5934\u90e8 10 LRANGE key start stop \u83b7\u53d6\u5217\u8868\u6307\u5b9a\u8303\u56f4\u5185\u7684\u5143\u7d20 11 LREM key count value \u79fb\u9664\u5217\u8868\u5143\u7d20 12 LSET key index value \u901a\u8fc7\u7d22\u5f15\u8bbe\u7f6e\u5217\u8868\u5143\u7d20\u7684\u503c 13 LTRIM key start stop \u5bf9\u4e00\u4e2a\u5217\u8868\u8fdb\u884c\u4fee\u526a(trim)\uff0c\u5c31\u662f\u8bf4\uff0c\u8ba9\u5217\u8868\u53ea\u4fdd\u7559\u6307\u5b9a\u533a\u95f4\u5185\u7684\u5143\u7d20\uff0c\u4e0d\u5728\u6307\u5b9a\u533a\u95f4\u4e4b\u5185\u7684\u5143\u7d20\u90fd\u5c06\u88ab\u5220\u9664\u3002 14 RPOP key \u79fb\u9664\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u8fd4\u56de\u503c\u4e3a\u79fb\u9664\u7684\u5143\u7d20\u3002 15 RPOPLPUSH source destination \u79fb\u9664\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u5e76\u5c06\u8be5\u5143\u7d20\u6dfb\u52a0\u5230\u53e6\u4e00\u4e2a\u5217\u8868\u5e76\u8fd4\u56de 16 RPUSH key value1 [value2] \u5728\u5217\u8868\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u503c 17 RPUSHX key value \u4e3a\u5df2\u5b58\u5728\u7684\u5217\u8868\u6dfb\u52a0\u503c 4.3 \u5b9e\u4f8b \u00b6 127.0.0.1:6379[1]> select 2 OK 127.0.0.1:6379[2]> keys * (empty list or set) 127.0.0.1:6379[2]> LPUSH caimengzhi 185cm 80kg it nanjing (integer) 4 127.0.0.1:6379[2]> keys * 1) \"caimengzhi\" 127.0.0.1:6379[2]> type caimengzhi list 127.0.0.1:6379[2]> LRANGE caimengzhi 0 -1 1) \"nanjing\" 2) \"it\" 3) \"80kg\" 4) \"185cm\" 127.0.0.1:6379[2]> LINDEX caimengzhi 0 \"nanjing\" 127.0.0.1:6379[2]> LINDEX caimengzhi 1 \"it\" 127.0.0.1:6379[2]> LINDEX caimengzhi 2 \"80kg\" 127.0.0.1:6379[2]> LINDEX caimengzhi 3 \"185cm\" 127.0.0.1:6379[2]> LLEN caimengzhi (integer) 4 127.0.0.1:6379[2]> LPOP caimengzhi \"nanjing\" 127.0.0.1:6379[2]> LRANGE caimengzhi 0 -1 1) \"it\" 2) \"80kg\" 3) \"185cm\" 127.0.0.1:6379[2]> LPUSHX caimengzhi name cmz (integer) 5 127.0.0.1:6379[2]> LRANGE caimengzhi 0 -1 1) \"cmz\" 2) \"name\" 3) \"it\" 4) \"80kg\" 5) \"185cm\" 5. \u96c6\u5408(Set) \u00b6 Redis \u7684 Set \u662f String \u7c7b\u578b\u7684\u65e0\u5e8f\u96c6\u5408\u3002\u96c6\u5408\u6210\u5458\u662f\u552f\u4e00\u7684\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u96c6\u5408\u4e2d\u4e0d\u80fd\u51fa\u73b0\u91cd\u590d\u7684\u6570\u636e\u3002 Redis \u4e2d\u96c6\u5408\u662f\u901a\u8fc7\u54c8\u5e0c\u8868\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u6dfb\u52a0\uff0c\u5220\u9664\uff0c\u67e5\u627e\u7684\u590d\u6742\u5ea6\u90fd\u662f O(1)\u3002 \u96c6\u5408\u4e2d\u6700\u5927\u7684\u6210\u5458\u6570\u4e3a 232 - 1 (4294967295, \u6bcf\u4e2a\u96c6\u5408\u53ef\u5b58\u50a840\u591a\u4ebf\u4e2a\u6210\u5458)\u3002 5.1 \u8bed\u6cd5 \u00b6 COMMAND KEY_NAME 5.2 \u547d\u4ee4 \u00b6 \u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 SADD key member1 [member2] \u5411\u96c6\u5408\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458 2 SCARD key \u83b7\u53d6\u96c6\u5408\u7684\u6210\u5458\u6570 3 SDIFF key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u5dee\u96c6 4 SDIFFSTORE destination key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u5dee\u96c6\u5e76\u5b58\u50a8\u5728 destination \u4e2d 5 SINTER key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u4ea4\u96c6 6 SINTERSTORE destination key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u4ea4\u96c6\u5e76\u5b58\u50a8\u5728 destination \u4e2d 7 SISMEMBER key member \u5224\u65ad member \u5143\u7d20\u662f\u5426\u662f\u96c6\u5408 key \u7684\u6210\u5458 8 SMEMBERS key \u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u6240\u6709\u6210\u5458 9 SMOVE source destination member \u5c06 member \u5143\u7d20\u4ece source \u96c6\u5408\u79fb\u52a8\u5230 destination \u96c6\u5408 10 SPOP key \u79fb\u9664\u5e76\u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u968f\u673a\u5143\u7d20 11 SRANDMEMBER key [count] \u8fd4\u56de\u96c6\u5408\u4e2d\u4e00\u4e2a\u6216\u591a\u4e2a\u968f\u673a\u6570 12 SREM key member1 [member2] \u79fb\u9664\u96c6\u5408\u4e2d\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458 13 SUNION key1 [key2] \u8fd4\u56de\u6240\u6709\u7ed9\u5b9a\u96c6\u5408\u7684\u5e76\u96c6 14 SUNIONSTORE destination key1 [key2] \u6240\u6709\u7ed9\u5b9a\u96c6\u5408\u7684\u5e76\u96c6\u5b58\u50a8\u5728 destination \u96c6\u5408\u4e2d 15 SSCAN key cursor [MATCH pattern] [COUNT count] \u8fed\u4ee3\u96c6\u5408\u4e2d\u7684\u5143\u7d20 5.3 \u5b9e\u4f8b \u00b6 127.0.0.1:6379[2]> select 4 OK 127.0.0.1:6379[4]> keys * (empty list or set) 127.0.0.1:6379[4]> SADD nosql redis (integer) 1 127.0.0.1:6379[4]> SADD nosql mongodb memecache (integer) 2 127.0.0.1:6379[4]> keys * 1) \"nosql\" 127.0.0.1:6379[4]> SCARD nosql (integer) 3 127.0.0.1:6379[4]> SMEMBERS nosql 1) \"redis\" 2) \"mongodb\" 3) \"memecache\" 127.0.0.1:6379[4]> SPOP nosql \"mongodb\" 127.0.0.1:6379[4]> SMEMBERS nosql 1) \"redis\" 2) \"memecache\" 6. \u6709\u5e8f\u96c6\u5408(sorted set) \u00b6 Redis \u6709\u5e8f\u96c6\u5408\u548c\u96c6\u5408\u4e00\u6837\u4e5f\u662fstring\u7c7b\u578b\u5143\u7d20\u7684\u96c6\u5408,\u4e14\u4e0d\u5141\u8bb8\u91cd\u590d\u7684\u6210\u5458\u3002\u4e0d\u540c\u7684\u662f\u6bcf\u4e2a\u5143\u7d20\u90fd\u4f1a\u5173\u8054\u4e00\u4e2adouble\u7c7b\u578b\u7684\u5206\u6570\u3002redis\u6b63\u662f\u901a\u8fc7\u5206\u6570\u6765\u4e3a\u96c6\u5408\u4e2d\u7684\u6210\u5458\u8fdb\u884c\u4ece\u5c0f\u5230\u5927\u7684\u6392\u5e8f\u3002\u6709\u5e8f\u96c6\u5408\u7684\u6210\u5458\u662f\u552f\u4e00\u7684,\u4f46\u5206\u6570(score)\u5374\u53ef\u4ee5\u91cd\u590d\u3002 \u96c6\u5408\u662f\u901a\u8fc7\u54c8\u5e0c\u8868\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u6dfb\u52a0\uff0c\u5220\u9664\uff0c\u67e5\u627e\u7684\u590d\u6742\u5ea6\u90fd\u662fO(1)\u3002 \u96c6\u5408\u4e2d\u6700\u5927\u7684\u6210\u5458\u6570\u4e3a 232 - 1 (4294967295, \u6bcf\u4e2a\u96c6\u5408\u53ef\u5b58\u50a840\u591a\u4ebf\u4e2a\u6210\u5458)\u3002 6.1 \u8bed\u6cd5 \u00b6 COMMAND KEY_NAME 6.2 \u547d\u4ee4 \u00b6 \u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 ZADD key score1 member1 [score2 member2] \u5411\u6709\u5e8f\u96c6\u5408\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458\uff0c\u6216\u8005\u66f4\u65b0\u5df2\u5b58\u5728\u6210\u5458\u7684\u5206\u6570 2 ZCARD key \u83b7\u53d6\u6709\u5e8f\u96c6\u5408\u7684\u6210\u5458\u6570 3 ZCOUNT key min max \u8ba1\u7b97\u5728\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u533a\u95f4\u5206\u6570\u7684\u6210\u5458\u6570 4 ZINCRBY key increment member \u6709\u5e8f\u96c6\u5408\u4e2d\u5bf9\u6307\u5b9a\u6210\u5458\u7684\u5206\u6570\u52a0\u4e0a\u589e\u91cf increment 5 ZINTERSTORE destination numkeys key [key ...] \u8ba1\u7b97\u7ed9\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6709\u5e8f\u96c6\u7684\u4ea4\u96c6\u5e76\u5c06\u7ed3\u679c\u96c6\u5b58\u50a8\u5728\u65b0\u7684\u6709\u5e8f\u96c6\u5408 key \u4e2d 6 ZLEXCOUNT key min max \u5728\u6709\u5e8f\u96c6\u5408\u4e2d\u8ba1\u7b97\u6307\u5b9a\u5b57\u5178\u533a\u95f4\u5185\u6210\u5458\u6570\u91cf 7 ZRANGE key start stop [WITHSCORES] \u901a\u8fc7\u7d22\u5f15\u533a\u95f4\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u6210\u6307\u5b9a\u533a\u95f4\u5185\u7684\u6210\u5458 8 ZRANGEBYLEX key min max [LIMIT offset count] \u901a\u8fc7\u5b57\u5178\u533a\u95f4\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u7684\u6210\u5458 9 ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT] \u901a\u8fc7\u5206\u6570\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u6307\u5b9a\u533a\u95f4\u5185\u7684\u6210\u5458 10 ZRANK key member \u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u6210\u5458\u7684\u7d22\u5f15 11 ZREM key member [member ...] \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458 12 ZREMRANGEBYLEX key min max \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7ed9\u5b9a\u7684\u5b57\u5178\u533a\u95f4\u7684\u6240\u6709\u6210\u5458 13 ZREMRANGEBYRANK key start stop \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7ed9\u5b9a\u7684\u6392\u540d\u533a\u95f4\u7684\u6240\u6709\u6210\u5458 14 ZREMRANGEBYSCORE key min max \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7ed9\u5b9a\u7684\u5206\u6570\u533a\u95f4\u7684\u6240\u6709\u6210\u5458 15 ZREVRANGE key start stop [WITHSCORES] \u8fd4\u56de\u6709\u5e8f\u96c6\u4e2d\u6307\u5b9a\u533a\u95f4\u5185\u7684\u6210\u5458\uff0c\u901a\u8fc7\u7d22\u5f15\uff0c\u5206\u6570\u4ece\u9ad8\u5230\u5e95 16 ZREVRANGEBYSCORE key max min [WITHSCORES] \u8fd4\u56de\u6709\u5e8f\u96c6\u4e2d\u6307\u5b9a\u5206\u6570\u533a\u95f4\u5185\u7684\u6210\u5458\uff0c\u5206\u6570\u4ece\u9ad8\u5230\u4f4e\u6392\u5e8f 17 ZREVRANK key member \u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u6210\u5458\u7684\u6392\u540d\uff0c\u6709\u5e8f\u96c6\u6210\u5458\u6309\u5206\u6570\u503c\u9012\u51cf(\u4ece\u5927\u5230\u5c0f)\u6392\u5e8f 18 ZSCORE key member \u8fd4\u56de\u6709\u5e8f\u96c6\u4e2d\uff0c\u6210\u5458\u7684\u5206\u6570\u503c 19 ZUNIONSTORE destination numkeys key [key ...] \u8ba1\u7b97\u7ed9\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6709\u5e8f\u96c6\u7684\u5e76\u96c6\uff0c\u5e76\u5b58\u50a8\u5728\u65b0\u7684 key \u4e2d 20 ZSCAN key cursor [MATCH pattern] [COUNT count] \u8fed\u4ee3\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u5143\u7d20\uff08\u5305\u62ec\u5143\u7d20\u6210\u5458\u548c\u5143\u7d20\u5206\u503c\uff09 6.3 \u5b9e\u4f8b \u00b6 127.0.0.1:6379[4]> select 5 OK 127.0.0.1:6379[5]> zadd city 1 beijing (integer) 1 127.0.0.1:6379[5]> zadd city 2 nanjing (integer) 1 127.0.0.1:6379[5]> zadd city 3 shanghai (integer) 1 127.0.0.1:6379[5]> zadd city 4 suqian (integer) 1 127.0.0.1:6379[5]> keys * 1) \"city\" 127.0.0.1:6379[5]> ZRANGE city 0 -1 1) \"beijing\" 2) \"nanjing\" 3) \"shanghai\" 4) \"suqian\"","title":"04. redis \u952e\u503c\u5bf9"},{"location":"linux/nosql/redis/redis.k_v/#1","text":"Redis \u952e\u547d\u4ee4\u7528\u4e8e\u7ba1\u7406 redis \u7684\u952e\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.k_v/#11","text":"COMMAND KEY_NAME","title":"1.1 \u8bed\u6cd5"},{"location":"linux/nosql/redis/redis.k_v/#12","text":"Redis keys \u547d\u4ee4 \u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 del key \u8be5\u547d\u4ee4\u7528\u4e8e\u5728 key \u5b58\u5728\u65f6\u5220\u9664 key 2 dump key \u5e8f\u5217\u5316\u7ed9\u5b9a key \uff0c\u5e76\u8fd4\u56de\u88ab\u5e8f\u5217\u5316\u7684\u503c 3 EXISTS key \u68c0\u67e5\u7ed9\u5b9a key \u662f\u5426\u5b58\u5728\u3002 4 EXPIRE key seconds \u4e3a\u7ed9\u5b9a key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u79d2\u8ba1 5 EXPIREAT key timestamp EXPIREAT \u7684\u4f5c\u7528\u548c EXPIRE \u7c7b\u4f3c\uff0c\u90fd\u7528\u4e8e\u4e3a key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u4e0d\u540c\u5728\u4e8e EXPIREAT \u547d\u4ee4\u63a5\u53d7\u7684\u65f6\u95f4\u53c2\u6570\u662f UNIX \u65f6\u95f4\u6233(unix timestamp)\u3002 6 PEXPIRE key milliseconds \u8bbe\u7f6e key \u7684\u8fc7\u671f\u65f6\u95f4\u4ee5\u6beb\u79d2\u8ba1\u3002 7 PEXPIREAT key milliseconds-timestamp \u8bbe\u7f6e key \u8fc7\u671f\u65f6\u95f4\u7684\u65f6\u95f4\u6233(unix timestamp) \u4ee5\u6beb\u79d2\u8ba1 8 KEYS pattern \u67e5\u627e\u6240\u6709\u7b26\u5408\u7ed9\u5b9a\u6a21\u5f0f( pattern)\u7684 key \u3002 9 MOVE key db \u5c06\u5f53\u524d\u6570\u636e\u5e93\u7684 key \u79fb\u52a8\u5230\u7ed9\u5b9a\u7684\u6570\u636e\u5e93 db \u5f53\u4e2d\u3002 10 PERSIST key \u79fb\u9664 key \u7684\u8fc7\u671f\u65f6\u95f4\uff0ckey \u5c06\u6301\u4e45\u4fdd\u6301\u3002 11 PTTL key \u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u8fd4\u56de key \u7684\u5269\u4f59\u7684\u8fc7\u671f\u65f6\u95f4\u3002 12 TTL key \u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0c\u8fd4\u56de\u7ed9\u5b9a key \u7684\u5269\u4f59\u751f\u5b58\u65f6\u95f4(TTL, time to live)\u3002 13 RANDOMKEY \u4ece\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u968f\u673a\u8fd4\u56de\u4e00\u4e2a key \u3002 14 RENAME key newkey \u4fee\u6539 key \u7684\u540d\u79f0 15 RENAMENX key newkey \u4ec5\u5f53 newkey \u4e0d\u5b58\u5728\u65f6\uff0c\u5c06 key \u6539\u540d\u4e3a newkey \u3002 16 TYPE key \u8fd4\u56de key \u6240\u50a8\u5b58\u7684\u503c\u7684\u7c7b\u578b\u3002","title":"1.2 \u547d\u4ee4"},{"location":"linux/nosql/redis/redis.k_v/#13","text":"root@manage01:/home/loocha# redis-cli 127.0.0.1:6379> AUTH cmz OK 127.0.0.1:6379> keys * # \u67e5\u770b\u6240\u6709key 1) \"k1\" 127.0.0.1:6379> set k2 v2 (error) NOAUTH Authentication required. 127.0.0.1:6379> auth cmz # \u8ba4\u8bc1 OK 127.0.0.1:6379> keys * 1) \"k1\" 127.0.0.1:6379> del k1 # \u5220\u9664k1 (integer) 1 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> set k1 v1 OK 127.0.0.1:6379> get v1 (nil) 127.0.0.1:6379> DUMP k1 \"\\x00\\x02v1\\t\\x00\\x8f\\x17\\xe1\\x92\\x9f\\xd6\\x1a\\xea\" 127.0.0.1:6379> EXISTS k1 # \u5224\u65adk1\u662f\u5426\u5b58\u5728 (integer) 1 127.0.0.1:6379> EXISTS k12 (integer) 0 127.0.0.1:6379> EXPIRE k1 10 (integer) 1 127.0.0.1:6379> keys * 1) \"k1\" # \u7b49\u5f85\u5341\u79d2 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> set k1 v1 OK 127.0.0.1:6379> EXPIRE k1 100 (integer) 1 127.0.0.1:6379> TTL k1 (integer) 95 127.0.0.1:6379> RANDOMKEY \"k1\" 127.0.0.1:6379> set k2 v2 OK 127.0.0.1:6379> set 3 v3 OK 127.0.0.1:6379> RANDOMKEY \"3\" 127.0.0.1:6379> RANDOMKEY \"k1\" 127.0.0.1:6379> RANDOMKEY \"k2\" 127.0.0.1:6379> mv 3 k3 (error) ERR unknown command `mv`, with args beginning with: `3`, `k3`, 127.0.0.1:6379> keys * 1) \"3\" 2) \"k2\" 3) \"k1\"","title":"1.3 \u5b9e\u4f8b"},{"location":"linux/nosql/redis/redis.k_v/#2-string","text":"","title":"2. \u5b57\u7b26\u4e32(String)"},{"location":"linux/nosql/redis/redis.k_v/#21","text":"Redis \u5b57\u7b26\u4e32\u6570\u636e\u7c7b\u578b\u7684\u76f8\u5173\u547d\u4ee4\u7528\u4e8e\u7ba1\u7406 redis \u5b57\u7b26\u4e32\u503c\uff0c\u57fa\u672c\u8bed\u6cd5\u5982\u4e0b\uff1a COMMAND KEY_NAME","title":"2.1 \u8bed\u6cd5"},{"location":"linux/nosql/redis/redis.k_v/#22","text":"Redis \u5b57\u7b26\u4e32\u547d\u4ee4 \u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 SET key value \u8bbe\u7f6e\u6307\u5b9a key \u7684\u503c 2 GET key \u83b7\u53d6\u6307\u5b9a key \u7684\u503c\u3002 3 GETRANGE key start end \u8fd4\u56de key \u4e2d\u5b57\u7b26\u4e32\u503c\u7684\u5b50\u5b57\u7b26 4 GETSET key value \u5c06\u7ed9\u5b9a key \u7684\u503c\u8bbe\u4e3a value \uff0c\u5e76\u8fd4\u56de key \u7684\u65e7\u503c(old value)\u3002 5 GETBIT key offset \u5bf9 key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\uff0c\u83b7\u53d6\u6307\u5b9a\u504f\u79fb\u91cf\u4e0a\u7684\u4f4d(bit)\u3002 6 MGET key1 [key2..] \u83b7\u53d6\u6240\u6709(\u4e00\u4e2a\u6216\u591a\u4e2a)\u7ed9\u5b9a key \u7684\u503c\u3002 7 SETBIT key offset value \u5bf9 key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\uff0c\u8bbe\u7f6e\u6216\u6e05\u9664\u6307\u5b9a\u504f\u79fb\u91cf\u4e0a\u7684\u4f4d(bit)\u3002 8 SETEX key seconds value \u5c06\u503c value \u5173\u8054\u5230 key \uff0c\u5e76\u5c06 key \u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u4e3a seconds (\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002 9 SETNX key value \u53ea\u6709\u5728 key \u4e0d\u5b58\u5728\u65f6\u8bbe\u7f6e key \u7684\u503c\u3002 10 SETRANGE key offset value \u7528 value \u53c2\u6570\u8986\u5199\u7ed9\u5b9a key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\uff0c\u4ece\u504f\u79fb\u91cf offset \u5f00\u59cb\u3002 11 STRLEN key \u8fd4\u56de key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\u7684\u957f\u5ea6\u3002 12 MSET key value [key value ...] \u540c\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u6216\u591a\u4e2a key-value \u5bf9\u3002 13 MSETNX key value [key value ...] \u540c\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u6216\u591a\u4e2a key-value \u5bf9\uff0c\u5f53\u4e14\u4ec5\u5f53\u6240\u6709\u7ed9\u5b9a key \u90fd\u4e0d\u5b58\u5728\u3002 14 PSETEX key milliseconds value \u8fd9\u4e2a\u547d\u4ee4\u548c SETEX \u547d\u4ee4\u76f8\u4f3c\uff0c\u4f46\u5b83\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u8bbe\u7f6e key \u7684\u751f\u5b58\u65f6\u95f4\uff0c\u800c\u4e0d\u662f\u50cf SETEX \u547d\u4ee4\u90a3\u6837\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002 15 INCR key \u5c06 key \u4e2d\u50a8\u5b58\u7684\u6570\u5b57\u503c\u589e\u4e00\u3002 16 INCRBY key increment \u5c06 key \u6240\u50a8\u5b58\u7684\u503c\u52a0\u4e0a\u7ed9\u5b9a\u7684\u589e\u91cf\u503c\uff08increment\uff09 \u3002 17 INCRBYFLOAT key increment \u5c06 key \u6240\u50a8\u5b58\u7684\u503c\u52a0\u4e0a\u7ed9\u5b9a\u7684\u6d6e\u70b9\u589e\u91cf\u503c\uff08increment\uff09 \u3002 18 DECR key \u5c06 key \u4e2d\u50a8\u5b58\u7684\u6570\u5b57\u503c\u51cf\u4e00\u3002 19 DECRBY key decrement key \u6240\u50a8\u5b58\u7684\u503c\u51cf\u53bb\u7ed9\u5b9a\u7684\u51cf\u91cf\u503c\uff08decrement\uff09 \u3002 20 APPEND key value \u5982\u679c key \u5df2\u7ecf\u5b58\u5728\u5e76\u4e14\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c APPEND \u547d\u4ee4\u5c06\u6307\u5b9a\u7684 value \u8ffd\u52a0\u5230\u8be5 key \u539f\u6765\u503c\uff08value\uff09\u7684\u672b\u5c3e\u3002","title":"2.2 \u547d\u4ee4"},{"location":"linux/nosql/redis/redis.k_v/#23","text":"127.0.0.1:6379> FLUSHALL OK 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> set name cmz OK 127.0.0.1:6379> set age 10 OK 127.0.0.1:6379> set sex male OK 127.0.0.1:6379> keys * 1) \"sex\" 2) \"age\" 3) \"name\" 127.0.0.1:6379> type sex string 127.0.0.1:6379> type name string 127.0.0.1:6379> type age string 127.0.0.1:6379> MGET name age sex 1) \"cmz\" 2) \"10\" 3) \"male\" 127.0.0.1:6379> mset k1 v1 k2 v2 OK 127.0.0.1:6379> keys * 1) \"age\" 2) \"k1\" 3) \"sex\" 4) \"name\" 5) \"k2\" 127.0.0.1:6379> get age \"10\" 127.0.0.1:6379> INCR age (integer) 11 127.0.0.1:6379> get age \"11\" 127.0.0.1:6379> DECR age (integer) 10 127.0.0.1:6379> get age \"10\" 127.0.0.1:6379> get name \"cmz\" 127.0.0.1:6379> APPEND name _caimengzhi (integer) 14 127.0.0.1:6379> get name \"cmz_caimengzhi\"","title":"2.3 \u5b9e\u4f8b"},{"location":"linux/nosql/redis/redis.k_v/#3-hash","text":"Redis hash \u662f\u4e00\u4e2astring\u7c7b\u578b\u7684field\u548cvalue\u7684\u6620\u5c04\u8868\uff0chash\u7279\u522b\u9002\u5408\u7528\u4e8e\u5b58\u50a8\u5bf9\u8c61\u3002Redis \u4e2d\u6bcf\u4e2a hash \u53ef\u4ee5\u5b58\u50a8 232 - 1 \u952e\u503c\u5bf9\uff0840\u591a\u4ebf\uff09\u3002","title":"3. \u54c8\u5e0c(Hash)"},{"location":"linux/nosql/redis/redis.k_v/#31","text":"COMMAND KEY_NAME","title":"3.1 \u8bed\u6cd5"},{"location":"linux/nosql/redis/redis.k_v/#32","text":"\u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 HDEL key field1 [field2] \u5220\u9664\u4e00\u4e2a\u6216\u591a\u4e2a\u54c8\u5e0c\u8868\u5b57\u6bb5 2 HEXISTS key field \u67e5\u770b\u54c8\u5e0c\u8868 key \u4e2d\uff0c\u6307\u5b9a\u7684\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u3002 3 HGET key field \u83b7\u53d6\u5b58\u50a8\u5728\u54c8\u5e0c\u8868\u4e2d\u6307\u5b9a\u5b57\u6bb5\u7684\u503c\u3002 4 HGETALL key \u83b7\u53d6\u5728\u54c8\u5e0c\u8868\u4e2d\u6307\u5b9a key \u7684\u6240\u6709\u5b57\u6bb5\u548c\u503c 5 HINCRBY key field increment \u4e3a\u54c8\u5e0c\u8868 key \u4e2d\u7684\u6307\u5b9a\u5b57\u6bb5\u7684\u6574\u6570\u503c\u52a0\u4e0a\u589e\u91cf increment \u3002 6 HINCRBYFLOAT key field increment \u4e3a\u54c8\u5e0c\u8868 key \u4e2d\u7684\u6307\u5b9a\u5b57\u6bb5\u7684\u6d6e\u70b9\u6570\u503c\u52a0\u4e0a\u589e\u91cf increment \u3002 7 HKEYS key \u83b7\u53d6\u6240\u6709\u54c8\u5e0c\u8868\u4e2d\u7684\u5b57\u6bb5 8 HLEN key \u83b7\u53d6\u54c8\u5e0c\u8868\u4e2d\u5b57\u6bb5\u7684\u6570\u91cf 9 HMGET key field1 [field2] \u83b7\u53d6\u6240\u6709\u7ed9\u5b9a\u5b57\u6bb5\u7684\u503c 10 HMSET key field1 value1 [field2 value2 ] \u540c\u65f6\u5c06\u591a\u4e2a field-value (\u57df-\u503c)\u5bf9\u8bbe\u7f6e\u5230\u54c8\u5e0c\u8868 key \u4e2d\u3002 11 HSET key field value \u5c06\u54c8\u5e0c\u8868 key \u4e2d\u7684\u5b57\u6bb5 field \u7684\u503c\u8bbe\u4e3a value \u3002 12 HSETNX key field value \u53ea\u6709\u5728\u5b57\u6bb5 field \u4e0d\u5b58\u5728\u65f6\uff0c\u8bbe\u7f6e\u54c8\u5e0c\u8868\u5b57\u6bb5\u7684\u503c\u3002 13 HVALS key \u83b7\u53d6\u54c8\u5e0c\u8868\u4e2d\u6240\u6709\u503c 14 HSCAN key cursor [MATCH pattern] [COUNT count] \u8fed\u4ee3\u54c8\u5e0c\u8868\u4e2d\u7684\u952e\u503c\u5bf9\u3002","title":"3.2 \u547d\u4ee4"},{"location":"linux/nosql/redis/redis.k_v/#33","text":"127.0.0.1:6379> select 1 OK 127.0.0.1:6379[1]> keys * (empty list or set) 127.0.0.1:6379[1]> HMSET cmz name caimengzhi age 30 description \"I love python.\" OK 127.0.0.1:6379[1]> keys * 1) \"cmz\" 127.0.0.1:6379[1]> HGETALL cmz 1) \"name\" 2) \"caimengzhi\" 3) \"age\" 4) \"30\" 5) \"description\" 6) \"I love python.\" 127.0.0.1:6379[1]> hget cmz name \"caimengzhi\" 127.0.0.1:6379[1]> hget cmz age \"30\" 127.0.0.1:6379[1]> hget cmz description \"I love python.\" 127.0.0.1:6379[1]> HKEYS cmz 1) \"name\" 2) \"age\" 3) \"description\" 127.0.0.1:6379[1]> HLEN cmz (integer) 3 127.0.0.1:6379[1]> hset cmz age 32 (integer) 0 127.0.0.1:6379[1]> hget cmz age \"32\" 127.0.0.1:6379[1]> HDEL cmz age (integer) 1 127.0.0.1:6379[1]> HGETALL cmz 1) \"name\" 2) \"caimengzhi\" 3) \"description\" 4) \"I love python.","title":"3.3 \u5b9e\u4f8b"},{"location":"linux/nosql/redis/redis.k_v/#4-list","text":"Redis\u5217\u8868\u662f\u7b80\u5355\u7684\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u6309\u7167\u63d2\u5165\u987a\u5e8f\u6392\u5e8f\u3002\u4f60\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20\u5230\u5217\u8868\u7684\u5934\u90e8\uff08\u5de6\u8fb9\uff09\u6216\u8005\u5c3e\u90e8\uff08\u53f3\u8fb9\uff09\uff0c\u4e00\u4e2a\u5217\u8868\u6700\u591a\u53ef\u4ee5\u5305\u542b 232 - 1 \u4e2a\u5143\u7d20 (4294967295, \u6bcf\u4e2a\u5217\u8868\u8d85\u8fc740\u4ebf\u4e2a\u5143\u7d20)\u3002","title":"4. \u5217\u8868(List)"},{"location":"linux/nosql/redis/redis.k_v/#41","text":"COMMAND KEY_NAME","title":"4.1 \u8bed\u6cd5"},{"location":"linux/nosql/redis/redis.k_v/#42","text":"\u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 BLPOP key1 [key2 ] timeout \u79fb\u51fa\u5e76\u83b7\u53d6\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c \u5982\u679c\u5217\u8868\u6ca1\u6709\u5143\u7d20\u4f1a\u963b\u585e\u5217\u8868\u76f4\u5230\u7b49\u5f85\u8d85\u65f6\u6216\u53d1\u73b0\u53ef\u5f39\u51fa\u5143\u7d20\u4e3a\u6b62\u3002 2 BRPOP key1 [key2 ] timeout \u79fb\u51fa\u5e76\u83b7\u53d6\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c \u5982\u679c\u5217\u8868\u6ca1\u6709\u5143\u7d20\u4f1a\u963b\u585e\u5217\u8868\u76f4\u5230\u7b49\u5f85\u8d85\u65f6\u6216\u53d1\u73b0\u53ef\u5f39\u51fa\u5143\u7d20\u4e3a\u6b62\u3002 3 BRPOPLPUSH source destination timeout \u4ece\u5217\u8868\u4e2d\u5f39\u51fa\u4e00\u4e2a\u503c\uff0c\u5c06\u5f39\u51fa\u7684\u5143\u7d20\u63d2\u5165\u5230\u53e6\u5916\u4e00\u4e2a\u5217\u8868\u4e2d\u5e76\u8fd4\u56de\u5b83\uff1b \u5982\u679c\u5217\u8868\u6ca1\u6709\u5143\u7d20\u4f1a\u963b\u585e\u5217\u8868\u76f4\u5230\u7b49\u5f85\u8d85\u65f6\u6216\u53d1\u73b0\u53ef\u5f39\u51fa\u5143\u7d20\u4e3a\u6b62\u3002 4 LINDEX key index \u901a\u8fc7\u7d22\u5f15\u83b7\u53d6\u5217\u8868\u4e2d\u7684\u5143\u7d20 5 LINSERT key BEFORE|AFTER pivot value \u5728\u5217\u8868\u7684\u5143\u7d20\u524d\u6216\u8005\u540e\u63d2\u5165\u5143\u7d20 6 LLEN key \u83b7\u53d6\u5217\u8868\u957f\u5ea6 7 LPOP key \u79fb\u51fa\u5e76\u83b7\u53d6\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20 8 LPUSH key value1 [value2] \u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u503c\u63d2\u5165\u5230\u5217\u8868\u5934\u90e8 9 LPUSHX key value \u5c06\u4e00\u4e2a\u503c\u63d2\u5165\u5230\u5df2\u5b58\u5728\u7684\u5217\u8868\u5934\u90e8 10 LRANGE key start stop \u83b7\u53d6\u5217\u8868\u6307\u5b9a\u8303\u56f4\u5185\u7684\u5143\u7d20 11 LREM key count value \u79fb\u9664\u5217\u8868\u5143\u7d20 12 LSET key index value \u901a\u8fc7\u7d22\u5f15\u8bbe\u7f6e\u5217\u8868\u5143\u7d20\u7684\u503c 13 LTRIM key start stop \u5bf9\u4e00\u4e2a\u5217\u8868\u8fdb\u884c\u4fee\u526a(trim)\uff0c\u5c31\u662f\u8bf4\uff0c\u8ba9\u5217\u8868\u53ea\u4fdd\u7559\u6307\u5b9a\u533a\u95f4\u5185\u7684\u5143\u7d20\uff0c\u4e0d\u5728\u6307\u5b9a\u533a\u95f4\u4e4b\u5185\u7684\u5143\u7d20\u90fd\u5c06\u88ab\u5220\u9664\u3002 14 RPOP key \u79fb\u9664\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u8fd4\u56de\u503c\u4e3a\u79fb\u9664\u7684\u5143\u7d20\u3002 15 RPOPLPUSH source destination \u79fb\u9664\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u5e76\u5c06\u8be5\u5143\u7d20\u6dfb\u52a0\u5230\u53e6\u4e00\u4e2a\u5217\u8868\u5e76\u8fd4\u56de 16 RPUSH key value1 [value2] \u5728\u5217\u8868\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u503c 17 RPUSHX key value \u4e3a\u5df2\u5b58\u5728\u7684\u5217\u8868\u6dfb\u52a0\u503c","title":"4.2 \u547d\u4ee4"},{"location":"linux/nosql/redis/redis.k_v/#43","text":"127.0.0.1:6379[1]> select 2 OK 127.0.0.1:6379[2]> keys * (empty list or set) 127.0.0.1:6379[2]> LPUSH caimengzhi 185cm 80kg it nanjing (integer) 4 127.0.0.1:6379[2]> keys * 1) \"caimengzhi\" 127.0.0.1:6379[2]> type caimengzhi list 127.0.0.1:6379[2]> LRANGE caimengzhi 0 -1 1) \"nanjing\" 2) \"it\" 3) \"80kg\" 4) \"185cm\" 127.0.0.1:6379[2]> LINDEX caimengzhi 0 \"nanjing\" 127.0.0.1:6379[2]> LINDEX caimengzhi 1 \"it\" 127.0.0.1:6379[2]> LINDEX caimengzhi 2 \"80kg\" 127.0.0.1:6379[2]> LINDEX caimengzhi 3 \"185cm\" 127.0.0.1:6379[2]> LLEN caimengzhi (integer) 4 127.0.0.1:6379[2]> LPOP caimengzhi \"nanjing\" 127.0.0.1:6379[2]> LRANGE caimengzhi 0 -1 1) \"it\" 2) \"80kg\" 3) \"185cm\" 127.0.0.1:6379[2]> LPUSHX caimengzhi name cmz (integer) 5 127.0.0.1:6379[2]> LRANGE caimengzhi 0 -1 1) \"cmz\" 2) \"name\" 3) \"it\" 4) \"80kg\" 5) \"185cm\"","title":"4.3 \u5b9e\u4f8b"},{"location":"linux/nosql/redis/redis.k_v/#5-set","text":"Redis \u7684 Set \u662f String \u7c7b\u578b\u7684\u65e0\u5e8f\u96c6\u5408\u3002\u96c6\u5408\u6210\u5458\u662f\u552f\u4e00\u7684\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u96c6\u5408\u4e2d\u4e0d\u80fd\u51fa\u73b0\u91cd\u590d\u7684\u6570\u636e\u3002 Redis \u4e2d\u96c6\u5408\u662f\u901a\u8fc7\u54c8\u5e0c\u8868\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u6dfb\u52a0\uff0c\u5220\u9664\uff0c\u67e5\u627e\u7684\u590d\u6742\u5ea6\u90fd\u662f O(1)\u3002 \u96c6\u5408\u4e2d\u6700\u5927\u7684\u6210\u5458\u6570\u4e3a 232 - 1 (4294967295, \u6bcf\u4e2a\u96c6\u5408\u53ef\u5b58\u50a840\u591a\u4ebf\u4e2a\u6210\u5458)\u3002","title":"5. \u96c6\u5408(Set)"},{"location":"linux/nosql/redis/redis.k_v/#51","text":"COMMAND KEY_NAME","title":"5.1 \u8bed\u6cd5"},{"location":"linux/nosql/redis/redis.k_v/#52","text":"\u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 SADD key member1 [member2] \u5411\u96c6\u5408\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458 2 SCARD key \u83b7\u53d6\u96c6\u5408\u7684\u6210\u5458\u6570 3 SDIFF key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u5dee\u96c6 4 SDIFFSTORE destination key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u5dee\u96c6\u5e76\u5b58\u50a8\u5728 destination \u4e2d 5 SINTER key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u4ea4\u96c6 6 SINTERSTORE destination key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u4ea4\u96c6\u5e76\u5b58\u50a8\u5728 destination \u4e2d 7 SISMEMBER key member \u5224\u65ad member \u5143\u7d20\u662f\u5426\u662f\u96c6\u5408 key \u7684\u6210\u5458 8 SMEMBERS key \u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u6240\u6709\u6210\u5458 9 SMOVE source destination member \u5c06 member \u5143\u7d20\u4ece source \u96c6\u5408\u79fb\u52a8\u5230 destination \u96c6\u5408 10 SPOP key \u79fb\u9664\u5e76\u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u968f\u673a\u5143\u7d20 11 SRANDMEMBER key [count] \u8fd4\u56de\u96c6\u5408\u4e2d\u4e00\u4e2a\u6216\u591a\u4e2a\u968f\u673a\u6570 12 SREM key member1 [member2] \u79fb\u9664\u96c6\u5408\u4e2d\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458 13 SUNION key1 [key2] \u8fd4\u56de\u6240\u6709\u7ed9\u5b9a\u96c6\u5408\u7684\u5e76\u96c6 14 SUNIONSTORE destination key1 [key2] \u6240\u6709\u7ed9\u5b9a\u96c6\u5408\u7684\u5e76\u96c6\u5b58\u50a8\u5728 destination \u96c6\u5408\u4e2d 15 SSCAN key cursor [MATCH pattern] [COUNT count] \u8fed\u4ee3\u96c6\u5408\u4e2d\u7684\u5143\u7d20","title":"5.2 \u547d\u4ee4"},{"location":"linux/nosql/redis/redis.k_v/#53","text":"127.0.0.1:6379[2]> select 4 OK 127.0.0.1:6379[4]> keys * (empty list or set) 127.0.0.1:6379[4]> SADD nosql redis (integer) 1 127.0.0.1:6379[4]> SADD nosql mongodb memecache (integer) 2 127.0.0.1:6379[4]> keys * 1) \"nosql\" 127.0.0.1:6379[4]> SCARD nosql (integer) 3 127.0.0.1:6379[4]> SMEMBERS nosql 1) \"redis\" 2) \"mongodb\" 3) \"memecache\" 127.0.0.1:6379[4]> SPOP nosql \"mongodb\" 127.0.0.1:6379[4]> SMEMBERS nosql 1) \"redis\" 2) \"memecache\"","title":"5.3 \u5b9e\u4f8b"},{"location":"linux/nosql/redis/redis.k_v/#6-sorted-set","text":"Redis \u6709\u5e8f\u96c6\u5408\u548c\u96c6\u5408\u4e00\u6837\u4e5f\u662fstring\u7c7b\u578b\u5143\u7d20\u7684\u96c6\u5408,\u4e14\u4e0d\u5141\u8bb8\u91cd\u590d\u7684\u6210\u5458\u3002\u4e0d\u540c\u7684\u662f\u6bcf\u4e2a\u5143\u7d20\u90fd\u4f1a\u5173\u8054\u4e00\u4e2adouble\u7c7b\u578b\u7684\u5206\u6570\u3002redis\u6b63\u662f\u901a\u8fc7\u5206\u6570\u6765\u4e3a\u96c6\u5408\u4e2d\u7684\u6210\u5458\u8fdb\u884c\u4ece\u5c0f\u5230\u5927\u7684\u6392\u5e8f\u3002\u6709\u5e8f\u96c6\u5408\u7684\u6210\u5458\u662f\u552f\u4e00\u7684,\u4f46\u5206\u6570(score)\u5374\u53ef\u4ee5\u91cd\u590d\u3002 \u96c6\u5408\u662f\u901a\u8fc7\u54c8\u5e0c\u8868\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u6dfb\u52a0\uff0c\u5220\u9664\uff0c\u67e5\u627e\u7684\u590d\u6742\u5ea6\u90fd\u662fO(1)\u3002 \u96c6\u5408\u4e2d\u6700\u5927\u7684\u6210\u5458\u6570\u4e3a 232 - 1 (4294967295, \u6bcf\u4e2a\u96c6\u5408\u53ef\u5b58\u50a840\u591a\u4ebf\u4e2a\u6210\u5458)\u3002","title":"6. \u6709\u5e8f\u96c6\u5408(sorted set)"},{"location":"linux/nosql/redis/redis.k_v/#61","text":"COMMAND KEY_NAME","title":"6.1 \u8bed\u6cd5"},{"location":"linux/nosql/redis/redis.k_v/#62","text":"\u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 ZADD key score1 member1 [score2 member2] \u5411\u6709\u5e8f\u96c6\u5408\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458\uff0c\u6216\u8005\u66f4\u65b0\u5df2\u5b58\u5728\u6210\u5458\u7684\u5206\u6570 2 ZCARD key \u83b7\u53d6\u6709\u5e8f\u96c6\u5408\u7684\u6210\u5458\u6570 3 ZCOUNT key min max \u8ba1\u7b97\u5728\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u533a\u95f4\u5206\u6570\u7684\u6210\u5458\u6570 4 ZINCRBY key increment member \u6709\u5e8f\u96c6\u5408\u4e2d\u5bf9\u6307\u5b9a\u6210\u5458\u7684\u5206\u6570\u52a0\u4e0a\u589e\u91cf increment 5 ZINTERSTORE destination numkeys key [key ...] \u8ba1\u7b97\u7ed9\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6709\u5e8f\u96c6\u7684\u4ea4\u96c6\u5e76\u5c06\u7ed3\u679c\u96c6\u5b58\u50a8\u5728\u65b0\u7684\u6709\u5e8f\u96c6\u5408 key \u4e2d 6 ZLEXCOUNT key min max \u5728\u6709\u5e8f\u96c6\u5408\u4e2d\u8ba1\u7b97\u6307\u5b9a\u5b57\u5178\u533a\u95f4\u5185\u6210\u5458\u6570\u91cf 7 ZRANGE key start stop [WITHSCORES] \u901a\u8fc7\u7d22\u5f15\u533a\u95f4\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u6210\u6307\u5b9a\u533a\u95f4\u5185\u7684\u6210\u5458 8 ZRANGEBYLEX key min max [LIMIT offset count] \u901a\u8fc7\u5b57\u5178\u533a\u95f4\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u7684\u6210\u5458 9 ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT] \u901a\u8fc7\u5206\u6570\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u6307\u5b9a\u533a\u95f4\u5185\u7684\u6210\u5458 10 ZRANK key member \u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u6210\u5458\u7684\u7d22\u5f15 11 ZREM key member [member ...] \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458 12 ZREMRANGEBYLEX key min max \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7ed9\u5b9a\u7684\u5b57\u5178\u533a\u95f4\u7684\u6240\u6709\u6210\u5458 13 ZREMRANGEBYRANK key start stop \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7ed9\u5b9a\u7684\u6392\u540d\u533a\u95f4\u7684\u6240\u6709\u6210\u5458 14 ZREMRANGEBYSCORE key min max \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7ed9\u5b9a\u7684\u5206\u6570\u533a\u95f4\u7684\u6240\u6709\u6210\u5458 15 ZREVRANGE key start stop [WITHSCORES] \u8fd4\u56de\u6709\u5e8f\u96c6\u4e2d\u6307\u5b9a\u533a\u95f4\u5185\u7684\u6210\u5458\uff0c\u901a\u8fc7\u7d22\u5f15\uff0c\u5206\u6570\u4ece\u9ad8\u5230\u5e95 16 ZREVRANGEBYSCORE key max min [WITHSCORES] \u8fd4\u56de\u6709\u5e8f\u96c6\u4e2d\u6307\u5b9a\u5206\u6570\u533a\u95f4\u5185\u7684\u6210\u5458\uff0c\u5206\u6570\u4ece\u9ad8\u5230\u4f4e\u6392\u5e8f 17 ZREVRANK key member \u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u6210\u5458\u7684\u6392\u540d\uff0c\u6709\u5e8f\u96c6\u6210\u5458\u6309\u5206\u6570\u503c\u9012\u51cf(\u4ece\u5927\u5230\u5c0f)\u6392\u5e8f 18 ZSCORE key member \u8fd4\u56de\u6709\u5e8f\u96c6\u4e2d\uff0c\u6210\u5458\u7684\u5206\u6570\u503c 19 ZUNIONSTORE destination numkeys key [key ...] \u8ba1\u7b97\u7ed9\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6709\u5e8f\u96c6\u7684\u5e76\u96c6\uff0c\u5e76\u5b58\u50a8\u5728\u65b0\u7684 key \u4e2d 20 ZSCAN key cursor [MATCH pattern] [COUNT count] \u8fed\u4ee3\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u5143\u7d20\uff08\u5305\u62ec\u5143\u7d20\u6210\u5458\u548c\u5143\u7d20\u5206\u503c\uff09","title":"6.2 \u547d\u4ee4"},{"location":"linux/nosql/redis/redis.k_v/#63","text":"127.0.0.1:6379[4]> select 5 OK 127.0.0.1:6379[5]> zadd city 1 beijing (integer) 1 127.0.0.1:6379[5]> zadd city 2 nanjing (integer) 1 127.0.0.1:6379[5]> zadd city 3 shanghai (integer) 1 127.0.0.1:6379[5]> zadd city 4 suqian (integer) 1 127.0.0.1:6379[5]> keys * 1) \"city\" 127.0.0.1:6379[5]> ZRANGE city 0 -1 1) \"beijing\" 2) \"nanjing\" 3) \"shanghai\" 4) \"suqian\"","title":"6.3 \u5b9e\u4f8b"},{"location":"linux/nosql/redis/redis.master-slave/","text":"Redis\u4e3b\u4ece 1. \u4ecb\u7ecd \u00b6 REmote DIctionary Server(Redis) \u662f\u4e00\u4e2a\u7531Salvatore Sanfilippo\u5199\u7684key-value\u5b58\u50a8\u7cfb\u7edf\u3002 Redis\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u4f7f\u7528ANSI C\u8bed\u8a00\u7f16\u5199\u3001\u9075\u5b88BSD\u534f\u8bae\u3001\u652f\u6301\u7f51\u7edc\u3001\u53ef\u57fa\u4e8e\u5185\u5b58\u4ea6\u53ef\u6301\u4e45\u5316\u7684\u65e5\u5fd7\u578b\u3001Key-Value\u6570\u636e\u5e93\uff0c\u5e76\u63d0\u4f9b\u591a\u79cd\u8bed\u8a00\u7684API\u3002 \u5b83\u901a\u5e38\u88ab\u79f0\u4e3a\u6570\u636e\u7ed3\u6784\u670d\u52a1\u5668\uff0c\u56e0\u4e3a\u503c\uff08value\uff09\u53ef\u4ee5\u662f \u5b57\u7b26\u4e32(String), \u54c8\u5e0c(Hash), \u5217\u8868(list), \u96c6\u5408(sets) \u548c \u6709\u5e8f\u96c6\u5408(sorted sets)\u7b49\u7c7b\u578b\u3002 2. \u90e8\u7f72 \u00b6 2.1 Redis \u4e3b\u4ece \u00b6 Redis\u652f\u6301\u4e3b\u4ece\u540c\u6b65\u3002\u6570\u636e\u53ef\u4ee5\u4ece\u4e3b\u670d\u52a1\u5668\u5411\u4efb\u610f\u6570\u91cf\u7684\u4ece\u670d\u52a1\u5668\u4e0a\u540c\u6b65\uff0c\u540c\u6b65\u4f7f\u7528\u7684\u662f\u53d1\u5e03/\u8ba2\u9605\u673a\u5236\u3002 2.2 \u914d\u7f6e \u00b6 Mater Slave\u7684\u6a21\u5f0f\uff0c\u4eceSlave\u5411Master\u53d1\u8d77SYNC\u547d\u4ee4\u3002 Master \u591aSlave\uff0c\u53ef\u4ee5\u5206\u5c42\uff0cSlave\u4e0b\u53ef\u4ee5\u518d\u63a5Slave\uff0c\u53ef\u6269\u5c55\u6210\u6811\u72b6\u7ed3\u6784\u3002 \u914d\u7f6e\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u5728slave\u7684\u8bbe\u5b9a\u6587\u4ef6\u4e2d\u6307\u5b9amaster\u7684ip\u548cport root@leco:/usr/local/redis# mkdir redis1/{etc,var,log} -p root@leco:/usr/local/redis# tree . . \u2514\u2500\u2500 redis1 \u251c\u2500\u2500 etc \u251c\u2500\u2500 log \u2514\u2500\u2500 var 4 directories, 0 files root@leco:/usr/local/redis# cp -aR redis1/ redis2 root@leco:/usr/local/redis# vim redis1/etc/redis.conf root@leco:/usr/local/redis# cat redis1/etc/redis.conf 2.3 master\u914d\u7f6e \u00b6 root@leco:/usr/local/redis# cat redis1/etc/redis.conf daemonize yes pidfile \"/usr/local/redis/redis1/log/redis.pid\" port 8379 timeout 300 loglevel debug logfile \"/usr/local/redis/redis1/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/redis/redis1/var\" appendonly no appendfsync always bind 0.0.0.0 2.4 slave\u914d\u7f6e \u00b6 root@leco:/usr/local/redis# cat redis2/etc/redis.conf daemonize yes pidfile \"/usr/local/redis/redis1/log/redis.pid\" port 8380 timeout 300 loglevel debug logfile \"/usr/local/redis/redis1/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/redis/redis1/var\" appendonly no appendfsync always bind 0.0.0.0 slaveof 172.17.0.2 8379 \u624b\u52a8\u914d\u7f6e\u4e3b \u5728\u4ece\u4e0a\u914d\u7f6e\u8981\u540c\u6b65\u7684\u4e3b 127.0 . 0.1 : 8380 > slaveof localhost 6380 \u53ea\u8bfb\u6a21\u5f0f slave - read - only yes \u8bbe\u7f6e slave\u4e3a\u53ea\u8bfb\u6a21\u5f0f 2.5 \u542f\u52a8 \u00b6 root@leco:/usr/local/redis# redis-server /usr/local/redis/redis1/etc/redis.conf root@leco:/usr/local/redis# redis-server /usr/local/redis/redis2/etc/redis.conf root@leco:/usr/local/redis# ps axf|egrep '8379|8380' | grep -v grep 5796 ? Ssl 0:00 redis-server 0.0.0.0:8379 6663 ? Ssl 0:00 redis-server 0.0.0.0:8380 2.6 \u68c0\u67e5\u4e3b\u4ece \u00b6 root@leco:/usr/local/redis# redis-cli -p 8379 127.0.0.1:8379> keys * (empty list or set) 127.0.0.1:8379> set name 'cmz' OK 127.0.0.1:8379> quit root@leco:/usr/local/redis# redis-cli -p 8380 127.0.0.1:8380> keys* (error) ERR unknown command 'keys*' 127.0.0.1:8380> keys * 1) \"name\" 127.0.0.1:8380> get name \"cmz\" root@leco:/usr/local/redis# redis-cli -p 8379 127.0.0.1:8379> info # Server redis_version:3.0.6 redis_git_sha1:00000000 redis_git_dirty:0 redis_build_id:28b6715d3583bf8e redis_mode:standalone os:Linux 4.15.0-45-generic x86_64 arch_bits:64 multiplexing_api:epoll gcc_version:5.4.0 process_id:5796 run_id:32ac4a621301f8c8398439b074ff3cf7b7e0d0f9 tcp_port:8379 uptime_in_seconds:557 uptime_in_days:0 hz:10 lru_clock:7649260 config_file:/usr/local/redis/redis1/etc/redis.conf # Clients connected_clients:1 client_longest_output_list:0 client_biggest_input_buf:0 blocked_clients:0 # Memory used_memory:1884808 used_memory_human:1.80M used_memory_rss:3731456 used_memory_peak:1884808 used_memory_peak_human:1.80M used_memory_lua:36864 mem_fragmentation_ratio:1.98 mem_allocator:jemalloc-3.6.0 # Persistence loading:0 rdb_changes_since_last_save:1 rdb_bgsave_in_progress:0 rdb_last_save_time:1551152980 rdb_last_bgsave_status:ok rdb_last_bgsave_time_sec:0 rdb_current_bgsave_time_sec:-1 aof_enabled:0 aof_rewrite_in_progress:0 aof_rewrite_scheduled:0 aof_last_rewrite_time_sec:-1 aof_current_rewrite_time_sec:-1 aof_last_bgrewrite_status:ok aof_last_write_status:ok # Stats total_connections_received:4 total_commands_processed:158 instantaneous_ops_per_sec:0 total_net_input_bytes:5511 total_net_output_bytes:318 instantaneous_input_kbps:0.02 instantaneous_output_kbps:0.00 rejected_connections:0 sync_full:1 sync_partial_ok:0 sync_partial_err:0 expired_keys:0 evicted_keys:0 keyspace_hits:0 keyspace_misses:0 pubsub_channels:0 pubsub_patterns:0 latest_fork_usec:154 migrate_cached_sockets:0 # Replication role:master connected_slaves:1 slave0:ip=127.0.0.1,port=8380,state=online,offset=266,lag=1 master_repl_offset:266 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:2 repl_backlog_histlen:265 # CPU used_cpu_sys:0.40 used_cpu_user:0.11 used_cpu_sys_children:0.00 used_cpu_user_children:0.00 # Cluster cluster_enabled:0 # Keyspace db0:keys=1,expires=0,avg_ttl=0 2.7 \u67e5\u770bslave \u00b6 \u5728\u4e3b\u4e0a\u6267\u884c info repliaction 127.0.0.1:8379> INFO replication # Replication role:master connected_slaves:1 slave0:ip=127.0.0.1,port=8380,state=online,offset=308,lag=0 master_repl_offset:308 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:2 repl_backlog_histlen:307 2.8 \u624b\u52a8\u5207\u6362\u8eab\u4efd \u00b6 Master\u4e0d\u53ef\u7528\u7684\u60c5\u51b5\u4e0b\uff0c\u505c\u6b62Master\uff0c\u5c06Slave\u7684\u8bbe\u5b9a\u65e0\u6548\u5316\u540e\uff0cSlave\u5347\u7ea7\u4e3aMaster root@leco:/usr/local/redis# redis-cli -p 8380 127.0.0.1:8380> info # Server redis_version:3.0.6 redis_git_sha1:00000000 redis_git_dirty:0 redis_build_id:28b6715d3583bf8e redis_mode:standalone os:Linux 4.15.0-45-generic x86_64 arch_bits:64 multiplexing_api:epoll gcc_version:5.4.0 process_id:7666 run_id:5e077def1cd19dee9f3a379cc889b363f20b8305 tcp_port:8380 uptime_in_seconds:64 uptime_in_days:0 hz:10 lru_clock:7649736 config_file:/usr/local/redis/redis2/etc/redis.conf # Clients connected_clients:2 client_longest_output_list:0 client_biggest_input_buf:0 blocked_clients:0 # Memory used_memory:837232 used_memory_human:817.61K used_memory_rss:3686400 used_memory_peak:837232 used_memory_peak_human:817.61K used_memory_lua:36864 mem_fragmentation_ratio:4.40 mem_allocator:jemalloc-3.6.0 # Persistence loading:0 rdb_changes_since_last_save:0 rdb_bgsave_in_progress:0 rdb_last_save_time:1551153544 rdb_last_bgsave_status:ok rdb_last_bgsave_time_sec:-1 rdb_current_bgsave_time_sec:-1 aof_enabled:0 aof_rewrite_in_progress:0 aof_rewrite_scheduled:0 aof_last_rewrite_time_sec:-1 aof_current_rewrite_time_sec:-1 aof_last_bgrewrite_status:ok aof_last_write_status:ok # Stats total_connections_received:3 total_commands_processed:4 instantaneous_ops_per_sec:0 total_net_input_bytes:130 total_net_output_bytes:1540 instantaneous_input_kbps:0.00 instantaneous_output_kbps:0.04 rejected_connections:0 sync_full:0 sync_partial_ok:0 sync_partial_err:0 expired_keys:0 evicted_keys:0 keyspace_hits:0 keyspace_misses:0 pubsub_channels:0 pubsub_patterns:0 latest_fork_usec:0 migrate_cached_sockets:0 # Replication role:slave # \u662f\u4ece master_host:127.0.0.1 master_port:8379 master_link_status:up master_last_io_seconds_ago:6 master_sync_in_progress:0 slave_repl_offset:43 slave_priority:100 slave_read_only:1 connected_slaves:0 master_repl_offset:0 repl_backlog_active:0 repl_backlog_size:1048576 repl_backlog_first_byte_offset:0 repl_backlog_histlen:0 # CPU used_cpu_sys:0.06 used_cpu_user:0.01 used_cpu_sys_children:0.00 used_cpu_user_children:0.00 # Cluster cluster_enabled:0 # Keyspace db0:keys=1,expires=0,avg_ttl=0 127.0.0.1:8380> SLAVEOF no one \u914d\u7f6e\u6ca1\u6709\u4e3b OK 127.0.0.1:8380> info # Server redis_version:3.0.6 redis_git_sha1:00000000 redis_git_dirty:0 redis_build_id:28b6715d3583bf8e redis_mode:standalone os:Linux 4.15.0-45-generic x86_64 arch_bits:64 multiplexing_api:epoll gcc_version:5.4.0 process_id:7666 run_id:5e077def1cd19dee9f3a379cc889b363f20b8305 tcp_port:8380 uptime_in_seconds:103 uptime_in_days:0 hz:10 lru_clock:7649775 config_file:/usr/local/redis/redis2/etc/redis.conf # Clients connected_clients:1 client_longest_output_list:0 client_biggest_input_buf:0 blocked_clients:0 # Memory used_memory:816360 used_memory_human:797.23K used_memory_rss:3686400 used_memory_peak:837232 used_memory_peak_human:817.61K used_memory_lua:36864 mem_fragmentation_ratio:4.52 mem_allocator:jemalloc-3.6.0 # Persistence loading:0 rdb_changes_since_last_save:0 rdb_bgsave_in_progress:0 rdb_last_save_time:1551153544 rdb_last_bgsave_status:ok rdb_last_bgsave_time_sec:-1 rdb_current_bgsave_time_sec:-1 aof_enabled:0 aof_rewrite_in_progress:0 aof_rewrite_scheduled:0 aof_last_rewrite_time_sec:-1 aof_current_rewrite_time_sec:-1 aof_last_bgrewrite_status:ok aof_last_write_status:ok # Stats total_connections_received:3 total_commands_processed:11 instantaneous_ops_per_sec:0 total_net_input_bytes:268 total_net_output_bytes:4961 instantaneous_input_kbps:0.00 instantaneous_output_kbps:0.00 rejected_connections:0 sync_full:0 sync_partial_ok:0 sync_partial_err:0 expired_keys:0 evicted_keys:0 keyspace_hits:0 keyspace_misses:0 pubsub_channels:0 pubsub_patterns:0 latest_fork_usec:0 migrate_cached_sockets:0 # Replication role:master # \u53d8\u6210\u4e86master\u4e86 connected_slaves:0 master_repl_offset:99 repl_backlog_active:0 repl_backlog_size:1048576 repl_backlog_first_byte_offset:0 repl_backlog_histlen:0 # CPU used_cpu_sys:0.09 used_cpu_user:0.02 used_cpu_sys_children:0.00 used_cpu_user_children:0.00 # Cluster cluster_enabled:0 # Keyspace db0:keys=1,expires=0,avg_ttl=0 127.0.0.1:8380> 2.9 \u5065\u5eb7\u68c0\u67e5 \u00b6 Slave\u6309\u7167repl-ping-slave-period\u7684\u95f4\u9694\uff08\u9ed8\u8ba410\u79d2\uff09\uff0c\u5411Master\u53d1\u9001ping\u3002 \u5982\u679c\u4e3b\u4ece\u95f4\u7684\u94fe\u63a5\u4e2d\u65ad\u540e\uff0c\u518d\u6b21\u8fde\u63a5\u7684\u65f6\u5019\uff0c2.8\u4ee5\u524d\u6309\u7167full sync\u518d\u540c\u671f\u30022.8\u4ee5\u540e\uff0c\u56e0\u4e3a\u6709backlog\u7684\u8bbe\u5b9a\uff0cbacklog\u5b58\u5728master\u7684\u5185\u5b58\u91cc\uff0c\u91cd\u65b0\u8fde\u63a5\u4e4b\u524d\uff0c\u5982\u679credis\u6ca1\u6709\u91cd\u542f\uff0c\u5e76\u4e14offset\u5728backlog\u4fdd\u5b58\u7684\u8303\u56f4\u5185\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4ece\u65ad\u5f00\u5730\u65b9\u540c\u671f\uff0c\u4e0d\u7b26\u5408\u8fd9\u4e2a\u6761\u4ef6\uff0c\u8fd8\u662ffull sync \u7528monitor\u547d\u4ee4\uff0c\u53ef\u4ee5\u770b\u5230slave\u5728\u53d1\u9001ping 127.0.0.1:8380> slaveof localhost 8379 OK 127.0.0.1:8380> MONITOR OK 1551153843.193225 [0 127.0.0.1:8379] \"PING\" \u7528ping\u547d\u4ee4\uff0c\u53ef\u4ee5\u770b\u5230slave\u5728\u53d1\u9001ping root@leco:/usr/local/redis# redis-cli -p 8380 127.0.0.1:8380> ping PONG \u6ce8\u610f \u4ee5\u4e0a\u914d\u7f6e master\u4e3b\u4ece\u662f\u5355\u4e2a\u673a\u5668\u4e0a\u542f\u52a8\u7684\u591a\u5c11\u5b9e\u4f8b \uff0c\u591a\u673a\u4e3b\u4ece\uff0c\u7c7b\u4f3c\uff0c\u914d\u7f6e\u6587\u4ef6\u7a0d\u5fae\u4fee\u6539\u3002","title":"10. redis \u4e3b\u4ece"},{"location":"linux/nosql/redis/redis.master-slave/#1","text":"REmote DIctionary Server(Redis) \u662f\u4e00\u4e2a\u7531Salvatore Sanfilippo\u5199\u7684key-value\u5b58\u50a8\u7cfb\u7edf\u3002 Redis\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u4f7f\u7528ANSI C\u8bed\u8a00\u7f16\u5199\u3001\u9075\u5b88BSD\u534f\u8bae\u3001\u652f\u6301\u7f51\u7edc\u3001\u53ef\u57fa\u4e8e\u5185\u5b58\u4ea6\u53ef\u6301\u4e45\u5316\u7684\u65e5\u5fd7\u578b\u3001Key-Value\u6570\u636e\u5e93\uff0c\u5e76\u63d0\u4f9b\u591a\u79cd\u8bed\u8a00\u7684API\u3002 \u5b83\u901a\u5e38\u88ab\u79f0\u4e3a\u6570\u636e\u7ed3\u6784\u670d\u52a1\u5668\uff0c\u56e0\u4e3a\u503c\uff08value\uff09\u53ef\u4ee5\u662f \u5b57\u7b26\u4e32(String), \u54c8\u5e0c(Hash), \u5217\u8868(list), \u96c6\u5408(sets) \u548c \u6709\u5e8f\u96c6\u5408(sorted sets)\u7b49\u7c7b\u578b\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.master-slave/#2","text":"","title":"2. \u90e8\u7f72"},{"location":"linux/nosql/redis/redis.master-slave/#21-redis","text":"Redis\u652f\u6301\u4e3b\u4ece\u540c\u6b65\u3002\u6570\u636e\u53ef\u4ee5\u4ece\u4e3b\u670d\u52a1\u5668\u5411\u4efb\u610f\u6570\u91cf\u7684\u4ece\u670d\u52a1\u5668\u4e0a\u540c\u6b65\uff0c\u540c\u6b65\u4f7f\u7528\u7684\u662f\u53d1\u5e03/\u8ba2\u9605\u673a\u5236\u3002","title":"2.1 Redis \u4e3b\u4ece"},{"location":"linux/nosql/redis/redis.master-slave/#22","text":"Mater Slave\u7684\u6a21\u5f0f\uff0c\u4eceSlave\u5411Master\u53d1\u8d77SYNC\u547d\u4ee4\u3002 Master \u591aSlave\uff0c\u53ef\u4ee5\u5206\u5c42\uff0cSlave\u4e0b\u53ef\u4ee5\u518d\u63a5Slave\uff0c\u53ef\u6269\u5c55\u6210\u6811\u72b6\u7ed3\u6784\u3002 \u914d\u7f6e\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u5728slave\u7684\u8bbe\u5b9a\u6587\u4ef6\u4e2d\u6307\u5b9amaster\u7684ip\u548cport root@leco:/usr/local/redis# mkdir redis1/{etc,var,log} -p root@leco:/usr/local/redis# tree . . \u2514\u2500\u2500 redis1 \u251c\u2500\u2500 etc \u251c\u2500\u2500 log \u2514\u2500\u2500 var 4 directories, 0 files root@leco:/usr/local/redis# cp -aR redis1/ redis2 root@leco:/usr/local/redis# vim redis1/etc/redis.conf root@leco:/usr/local/redis# cat redis1/etc/redis.conf","title":"2.2 \u914d\u7f6e"},{"location":"linux/nosql/redis/redis.master-slave/#23-master","text":"root@leco:/usr/local/redis# cat redis1/etc/redis.conf daemonize yes pidfile \"/usr/local/redis/redis1/log/redis.pid\" port 8379 timeout 300 loglevel debug logfile \"/usr/local/redis/redis1/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/redis/redis1/var\" appendonly no appendfsync always bind 0.0.0.0","title":"2.3 master\u914d\u7f6e"},{"location":"linux/nosql/redis/redis.master-slave/#24-slave","text":"root@leco:/usr/local/redis# cat redis2/etc/redis.conf daemonize yes pidfile \"/usr/local/redis/redis1/log/redis.pid\" port 8380 timeout 300 loglevel debug logfile \"/usr/local/redis/redis1/log/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/redis/redis1/var\" appendonly no appendfsync always bind 0.0.0.0 slaveof 172.17.0.2 8379 \u624b\u52a8\u914d\u7f6e\u4e3b \u5728\u4ece\u4e0a\u914d\u7f6e\u8981\u540c\u6b65\u7684\u4e3b 127.0 . 0.1 : 8380 > slaveof localhost 6380 \u53ea\u8bfb\u6a21\u5f0f slave - read - only yes \u8bbe\u7f6e slave\u4e3a\u53ea\u8bfb\u6a21\u5f0f","title":"2.4 slave\u914d\u7f6e"},{"location":"linux/nosql/redis/redis.master-slave/#25","text":"root@leco:/usr/local/redis# redis-server /usr/local/redis/redis1/etc/redis.conf root@leco:/usr/local/redis# redis-server /usr/local/redis/redis2/etc/redis.conf root@leco:/usr/local/redis# ps axf|egrep '8379|8380' | grep -v grep 5796 ? Ssl 0:00 redis-server 0.0.0.0:8379 6663 ? Ssl 0:00 redis-server 0.0.0.0:8380","title":"2.5 \u542f\u52a8"},{"location":"linux/nosql/redis/redis.master-slave/#26","text":"root@leco:/usr/local/redis# redis-cli -p 8379 127.0.0.1:8379> keys * (empty list or set) 127.0.0.1:8379> set name 'cmz' OK 127.0.0.1:8379> quit root@leco:/usr/local/redis# redis-cli -p 8380 127.0.0.1:8380> keys* (error) ERR unknown command 'keys*' 127.0.0.1:8380> keys * 1) \"name\" 127.0.0.1:8380> get name \"cmz\" root@leco:/usr/local/redis# redis-cli -p 8379 127.0.0.1:8379> info # Server redis_version:3.0.6 redis_git_sha1:00000000 redis_git_dirty:0 redis_build_id:28b6715d3583bf8e redis_mode:standalone os:Linux 4.15.0-45-generic x86_64 arch_bits:64 multiplexing_api:epoll gcc_version:5.4.0 process_id:5796 run_id:32ac4a621301f8c8398439b074ff3cf7b7e0d0f9 tcp_port:8379 uptime_in_seconds:557 uptime_in_days:0 hz:10 lru_clock:7649260 config_file:/usr/local/redis/redis1/etc/redis.conf # Clients connected_clients:1 client_longest_output_list:0 client_biggest_input_buf:0 blocked_clients:0 # Memory used_memory:1884808 used_memory_human:1.80M used_memory_rss:3731456 used_memory_peak:1884808 used_memory_peak_human:1.80M used_memory_lua:36864 mem_fragmentation_ratio:1.98 mem_allocator:jemalloc-3.6.0 # Persistence loading:0 rdb_changes_since_last_save:1 rdb_bgsave_in_progress:0 rdb_last_save_time:1551152980 rdb_last_bgsave_status:ok rdb_last_bgsave_time_sec:0 rdb_current_bgsave_time_sec:-1 aof_enabled:0 aof_rewrite_in_progress:0 aof_rewrite_scheduled:0 aof_last_rewrite_time_sec:-1 aof_current_rewrite_time_sec:-1 aof_last_bgrewrite_status:ok aof_last_write_status:ok # Stats total_connections_received:4 total_commands_processed:158 instantaneous_ops_per_sec:0 total_net_input_bytes:5511 total_net_output_bytes:318 instantaneous_input_kbps:0.02 instantaneous_output_kbps:0.00 rejected_connections:0 sync_full:1 sync_partial_ok:0 sync_partial_err:0 expired_keys:0 evicted_keys:0 keyspace_hits:0 keyspace_misses:0 pubsub_channels:0 pubsub_patterns:0 latest_fork_usec:154 migrate_cached_sockets:0 # Replication role:master connected_slaves:1 slave0:ip=127.0.0.1,port=8380,state=online,offset=266,lag=1 master_repl_offset:266 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:2 repl_backlog_histlen:265 # CPU used_cpu_sys:0.40 used_cpu_user:0.11 used_cpu_sys_children:0.00 used_cpu_user_children:0.00 # Cluster cluster_enabled:0 # Keyspace db0:keys=1,expires=0,avg_ttl=0","title":"2.6 \u68c0\u67e5\u4e3b\u4ece"},{"location":"linux/nosql/redis/redis.master-slave/#27-slave","text":"\u5728\u4e3b\u4e0a\u6267\u884c info repliaction 127.0.0.1:8379> INFO replication # Replication role:master connected_slaves:1 slave0:ip=127.0.0.1,port=8380,state=online,offset=308,lag=0 master_repl_offset:308 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:2 repl_backlog_histlen:307","title":"2.7 \u67e5\u770bslave"},{"location":"linux/nosql/redis/redis.master-slave/#28","text":"Master\u4e0d\u53ef\u7528\u7684\u60c5\u51b5\u4e0b\uff0c\u505c\u6b62Master\uff0c\u5c06Slave\u7684\u8bbe\u5b9a\u65e0\u6548\u5316\u540e\uff0cSlave\u5347\u7ea7\u4e3aMaster root@leco:/usr/local/redis# redis-cli -p 8380 127.0.0.1:8380> info # Server redis_version:3.0.6 redis_git_sha1:00000000 redis_git_dirty:0 redis_build_id:28b6715d3583bf8e redis_mode:standalone os:Linux 4.15.0-45-generic x86_64 arch_bits:64 multiplexing_api:epoll gcc_version:5.4.0 process_id:7666 run_id:5e077def1cd19dee9f3a379cc889b363f20b8305 tcp_port:8380 uptime_in_seconds:64 uptime_in_days:0 hz:10 lru_clock:7649736 config_file:/usr/local/redis/redis2/etc/redis.conf # Clients connected_clients:2 client_longest_output_list:0 client_biggest_input_buf:0 blocked_clients:0 # Memory used_memory:837232 used_memory_human:817.61K used_memory_rss:3686400 used_memory_peak:837232 used_memory_peak_human:817.61K used_memory_lua:36864 mem_fragmentation_ratio:4.40 mem_allocator:jemalloc-3.6.0 # Persistence loading:0 rdb_changes_since_last_save:0 rdb_bgsave_in_progress:0 rdb_last_save_time:1551153544 rdb_last_bgsave_status:ok rdb_last_bgsave_time_sec:-1 rdb_current_bgsave_time_sec:-1 aof_enabled:0 aof_rewrite_in_progress:0 aof_rewrite_scheduled:0 aof_last_rewrite_time_sec:-1 aof_current_rewrite_time_sec:-1 aof_last_bgrewrite_status:ok aof_last_write_status:ok # Stats total_connections_received:3 total_commands_processed:4 instantaneous_ops_per_sec:0 total_net_input_bytes:130 total_net_output_bytes:1540 instantaneous_input_kbps:0.00 instantaneous_output_kbps:0.04 rejected_connections:0 sync_full:0 sync_partial_ok:0 sync_partial_err:0 expired_keys:0 evicted_keys:0 keyspace_hits:0 keyspace_misses:0 pubsub_channels:0 pubsub_patterns:0 latest_fork_usec:0 migrate_cached_sockets:0 # Replication role:slave # \u662f\u4ece master_host:127.0.0.1 master_port:8379 master_link_status:up master_last_io_seconds_ago:6 master_sync_in_progress:0 slave_repl_offset:43 slave_priority:100 slave_read_only:1 connected_slaves:0 master_repl_offset:0 repl_backlog_active:0 repl_backlog_size:1048576 repl_backlog_first_byte_offset:0 repl_backlog_histlen:0 # CPU used_cpu_sys:0.06 used_cpu_user:0.01 used_cpu_sys_children:0.00 used_cpu_user_children:0.00 # Cluster cluster_enabled:0 # Keyspace db0:keys=1,expires=0,avg_ttl=0 127.0.0.1:8380> SLAVEOF no one \u914d\u7f6e\u6ca1\u6709\u4e3b OK 127.0.0.1:8380> info # Server redis_version:3.0.6 redis_git_sha1:00000000 redis_git_dirty:0 redis_build_id:28b6715d3583bf8e redis_mode:standalone os:Linux 4.15.0-45-generic x86_64 arch_bits:64 multiplexing_api:epoll gcc_version:5.4.0 process_id:7666 run_id:5e077def1cd19dee9f3a379cc889b363f20b8305 tcp_port:8380 uptime_in_seconds:103 uptime_in_days:0 hz:10 lru_clock:7649775 config_file:/usr/local/redis/redis2/etc/redis.conf # Clients connected_clients:1 client_longest_output_list:0 client_biggest_input_buf:0 blocked_clients:0 # Memory used_memory:816360 used_memory_human:797.23K used_memory_rss:3686400 used_memory_peak:837232 used_memory_peak_human:817.61K used_memory_lua:36864 mem_fragmentation_ratio:4.52 mem_allocator:jemalloc-3.6.0 # Persistence loading:0 rdb_changes_since_last_save:0 rdb_bgsave_in_progress:0 rdb_last_save_time:1551153544 rdb_last_bgsave_status:ok rdb_last_bgsave_time_sec:-1 rdb_current_bgsave_time_sec:-1 aof_enabled:0 aof_rewrite_in_progress:0 aof_rewrite_scheduled:0 aof_last_rewrite_time_sec:-1 aof_current_rewrite_time_sec:-1 aof_last_bgrewrite_status:ok aof_last_write_status:ok # Stats total_connections_received:3 total_commands_processed:11 instantaneous_ops_per_sec:0 total_net_input_bytes:268 total_net_output_bytes:4961 instantaneous_input_kbps:0.00 instantaneous_output_kbps:0.00 rejected_connections:0 sync_full:0 sync_partial_ok:0 sync_partial_err:0 expired_keys:0 evicted_keys:0 keyspace_hits:0 keyspace_misses:0 pubsub_channels:0 pubsub_patterns:0 latest_fork_usec:0 migrate_cached_sockets:0 # Replication role:master # \u53d8\u6210\u4e86master\u4e86 connected_slaves:0 master_repl_offset:99 repl_backlog_active:0 repl_backlog_size:1048576 repl_backlog_first_byte_offset:0 repl_backlog_histlen:0 # CPU used_cpu_sys:0.09 used_cpu_user:0.02 used_cpu_sys_children:0.00 used_cpu_user_children:0.00 # Cluster cluster_enabled:0 # Keyspace db0:keys=1,expires=0,avg_ttl=0 127.0.0.1:8380>","title":"2.8 \u624b\u52a8\u5207\u6362\u8eab\u4efd"},{"location":"linux/nosql/redis/redis.master-slave/#29","text":"Slave\u6309\u7167repl-ping-slave-period\u7684\u95f4\u9694\uff08\u9ed8\u8ba410\u79d2\uff09\uff0c\u5411Master\u53d1\u9001ping\u3002 \u5982\u679c\u4e3b\u4ece\u95f4\u7684\u94fe\u63a5\u4e2d\u65ad\u540e\uff0c\u518d\u6b21\u8fde\u63a5\u7684\u65f6\u5019\uff0c2.8\u4ee5\u524d\u6309\u7167full sync\u518d\u540c\u671f\u30022.8\u4ee5\u540e\uff0c\u56e0\u4e3a\u6709backlog\u7684\u8bbe\u5b9a\uff0cbacklog\u5b58\u5728master\u7684\u5185\u5b58\u91cc\uff0c\u91cd\u65b0\u8fde\u63a5\u4e4b\u524d\uff0c\u5982\u679credis\u6ca1\u6709\u91cd\u542f\uff0c\u5e76\u4e14offset\u5728backlog\u4fdd\u5b58\u7684\u8303\u56f4\u5185\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4ece\u65ad\u5f00\u5730\u65b9\u540c\u671f\uff0c\u4e0d\u7b26\u5408\u8fd9\u4e2a\u6761\u4ef6\uff0c\u8fd8\u662ffull sync \u7528monitor\u547d\u4ee4\uff0c\u53ef\u4ee5\u770b\u5230slave\u5728\u53d1\u9001ping 127.0.0.1:8380> slaveof localhost 8379 OK 127.0.0.1:8380> MONITOR OK 1551153843.193225 [0 127.0.0.1:8379] \"PING\" \u7528ping\u547d\u4ee4\uff0c\u53ef\u4ee5\u770b\u5230slave\u5728\u53d1\u9001ping root@leco:/usr/local/redis# redis-cli -p 8380 127.0.0.1:8380> ping PONG \u6ce8\u610f \u4ee5\u4e0a\u914d\u7f6e master\u4e3b\u4ece\u662f\u5355\u4e2a\u673a\u5668\u4e0a\u542f\u52a8\u7684\u591a\u5c11\u5b9e\u4f8b \uff0c\u591a\u673a\u4e3b\u4ece\uff0c\u7c7b\u4f3c\uff0c\u914d\u7f6e\u6587\u4ef6\u7a0d\u5fae\u4fee\u6539\u3002","title":"2.9 \u5065\u5eb7\u68c0\u67e5"},{"location":"linux/nosql/redis/redis.publish/","text":"Redis \u53d1\u5e03\u8ba2\u9605 1. \u4ecb\u7ecd \u00b6 Redis \u53d1\u5e03\u8ba2\u9605(pub/sub)\u662f\u4e00\u79cd\u6d88\u606f\u901a\u4fe1\u6a21\u5f0f\uff1a\u53d1\u9001\u8005(pub)\u53d1\u9001\u6d88\u606f\uff0c\u8ba2\u9605\u8005(sub)\u63a5\u6536\u6d88\u606f\u3002 Redis \u5ba2\u6237\u7aef\u53ef\u4ee5\u8ba2\u9605\u4efb\u610f\u6570\u91cf\u7684\u9891\u9053\u3002 \u4e0b\u56fe\u5c55\u793a\u4e86\u9891\u9053 channel1 \uff0c \u4ee5\u53ca\u8ba2\u9605\u8fd9\u4e2a\u9891\u9053\u7684\u4e09\u4e2a\u5ba2\u6237\u7aef \u2014\u2014 client2 \u3001 client5 \u548c client1 \u4e4b\u95f4\u7684\u5173\u7cfb\uff1a \u5f53\u6709\u65b0\u6d88\u606f\u901a\u8fc7 PUBLISH \u547d\u4ee4\u53d1\u9001\u7ed9\u9891\u9053 channel1 \u65f6\uff0c \u8fd9\u4e2a\u6d88\u606f\u5c31\u4f1a\u88ab\u53d1\u9001\u7ed9\u8ba2\u9605\u5b83\u7684\u4e09\u4e2a\u5ba2\u6237\u7aef 2. \u53d1\u5e03\u8ba2\u9605\u547d\u4ee4 \u00b6 \u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 PSUBSCRIBE pattern [pattern ...] \u8ba2\u9605\u4e00\u4e2a\u6216\u591a\u4e2a\u7b26\u5408\u7ed9\u5b9a\u6a21\u5f0f\u7684\u9891\u9053\u3002 2 PUBSUB subcommand [argument [argument ...]] \u67e5\u770b\u8ba2\u9605\u4e0e\u53d1\u5e03\u7cfb\u7edf\u72b6\u6001\u3002 3 PUBLISH channel message \u5c06\u4fe1\u606f\u53d1\u9001\u5230\u6307\u5b9a\u7684\u9891\u9053\u3002 4 PUNSUBSCRIBE [pattern [pattern ...]] \u9000\u8ba2\u6240\u6709\u7ed9\u5b9a\u6a21\u5f0f\u7684\u9891\u9053\u3002 5 SUBSCRIBE channel [channel ...] \u8ba2\u9605\u7ed9\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u9891\u9053\u7684\u4fe1\u606f\u3002 6 UNSUBSCRIBE [channel [channel ...]] \u6307\u9000\u8ba2\u7ed9\u5b9a\u7684\u9891\u9053\u3002 3. \u5b9e\u4f8b \u00b6 \u4ee5\u4e0b\u5b9e\u4f8b\u6f14\u793a\u4e86\u53d1\u5e03\u8ba2\u9605\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u3002\u5728\u6211\u4eec\u5b9e\u4f8b\u4e2d\u6211\u4eec\u521b\u5efa\u4e86\u8ba2\u9605\u9891\u9053\u540d\u4e3a chat: root@manage01:/home/loocha# redis-cli 127.0.0.1:6379> AUTH cmz OK 127.0.0.1:6379> SUBSCRIBE chat Reading messages... (press Ctrl-C to quit) 1) \"subscribe\" 2) \"chat\" 3) (integer) 1 \u73b0\u5728\uff0c\u6211\u4eec\u5148\u91cd\u65b0\u5f00\u542f\u4e2a redis \u5ba2\u6237\u7aef\uff0c\u7136\u540e\u5728\u540c\u4e00\u4e2a\u9891\u9053 chat \u53d1\u5e03\u4e24\u6b21\u6d88\u606f\uff0c\u8ba2\u9605\u8005\u5c31\u80fd\u63a5\u6536\u5230\u6d88\u606f\u3002 127.0.0.1:6379> PUBLISH chat 'my name is caimengzhi' (integer) 1 127.0.0.1:6379> PUBLISH chat 'my age 20' (integer) 1 127.0.0.1:6379> PUBLISH chat 'my hobby python' (integer) 1 127.0.0.1:6379> \u8ba2\u9605\u8005\u7684\u5ba2\u6237\u7aef\u4f1a\u663e\u793a\u5982\u4e0b\u6d88\u606f 127.0.0.1:6379> SUBSCRIBE chat Reading messages... (press Ctrl-C to quit) 1) \"subscribe\" 2) \"chat\" 3) (integer) 1 1) \"message\" 2) \"chat\" 3) \"my name is caimengzhi\" 1) \"message\" 2) \"chat\" 3) \"my age 20\" 1) \"message\" 2) \"chat\" 3) \"my hobby python\"","title":"05. redis \u53d1\u5e03\u8ba2\u9605"},{"location":"linux/nosql/redis/redis.publish/#1","text":"Redis \u53d1\u5e03\u8ba2\u9605(pub/sub)\u662f\u4e00\u79cd\u6d88\u606f\u901a\u4fe1\u6a21\u5f0f\uff1a\u53d1\u9001\u8005(pub)\u53d1\u9001\u6d88\u606f\uff0c\u8ba2\u9605\u8005(sub)\u63a5\u6536\u6d88\u606f\u3002 Redis \u5ba2\u6237\u7aef\u53ef\u4ee5\u8ba2\u9605\u4efb\u610f\u6570\u91cf\u7684\u9891\u9053\u3002 \u4e0b\u56fe\u5c55\u793a\u4e86\u9891\u9053 channel1 \uff0c \u4ee5\u53ca\u8ba2\u9605\u8fd9\u4e2a\u9891\u9053\u7684\u4e09\u4e2a\u5ba2\u6237\u7aef \u2014\u2014 client2 \u3001 client5 \u548c client1 \u4e4b\u95f4\u7684\u5173\u7cfb\uff1a \u5f53\u6709\u65b0\u6d88\u606f\u901a\u8fc7 PUBLISH \u547d\u4ee4\u53d1\u9001\u7ed9\u9891\u9053 channel1 \u65f6\uff0c \u8fd9\u4e2a\u6d88\u606f\u5c31\u4f1a\u88ab\u53d1\u9001\u7ed9\u8ba2\u9605\u5b83\u7684\u4e09\u4e2a\u5ba2\u6237\u7aef","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.publish/#2","text":"\u5e8f\u53f7 \u547d\u4ee4 \u63cf\u8ff0 1 PSUBSCRIBE pattern [pattern ...] \u8ba2\u9605\u4e00\u4e2a\u6216\u591a\u4e2a\u7b26\u5408\u7ed9\u5b9a\u6a21\u5f0f\u7684\u9891\u9053\u3002 2 PUBSUB subcommand [argument [argument ...]] \u67e5\u770b\u8ba2\u9605\u4e0e\u53d1\u5e03\u7cfb\u7edf\u72b6\u6001\u3002 3 PUBLISH channel message \u5c06\u4fe1\u606f\u53d1\u9001\u5230\u6307\u5b9a\u7684\u9891\u9053\u3002 4 PUNSUBSCRIBE [pattern [pattern ...]] \u9000\u8ba2\u6240\u6709\u7ed9\u5b9a\u6a21\u5f0f\u7684\u9891\u9053\u3002 5 SUBSCRIBE channel [channel ...] \u8ba2\u9605\u7ed9\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u9891\u9053\u7684\u4fe1\u606f\u3002 6 UNSUBSCRIBE [channel [channel ...]] \u6307\u9000\u8ba2\u7ed9\u5b9a\u7684\u9891\u9053\u3002","title":"2. \u53d1\u5e03\u8ba2\u9605\u547d\u4ee4"},{"location":"linux/nosql/redis/redis.publish/#3","text":"\u4ee5\u4e0b\u5b9e\u4f8b\u6f14\u793a\u4e86\u53d1\u5e03\u8ba2\u9605\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u3002\u5728\u6211\u4eec\u5b9e\u4f8b\u4e2d\u6211\u4eec\u521b\u5efa\u4e86\u8ba2\u9605\u9891\u9053\u540d\u4e3a chat: root@manage01:/home/loocha# redis-cli 127.0.0.1:6379> AUTH cmz OK 127.0.0.1:6379> SUBSCRIBE chat Reading messages... (press Ctrl-C to quit) 1) \"subscribe\" 2) \"chat\" 3) (integer) 1 \u73b0\u5728\uff0c\u6211\u4eec\u5148\u91cd\u65b0\u5f00\u542f\u4e2a redis \u5ba2\u6237\u7aef\uff0c\u7136\u540e\u5728\u540c\u4e00\u4e2a\u9891\u9053 chat \u53d1\u5e03\u4e24\u6b21\u6d88\u606f\uff0c\u8ba2\u9605\u8005\u5c31\u80fd\u63a5\u6536\u5230\u6d88\u606f\u3002 127.0.0.1:6379> PUBLISH chat 'my name is caimengzhi' (integer) 1 127.0.0.1:6379> PUBLISH chat 'my age 20' (integer) 1 127.0.0.1:6379> PUBLISH chat 'my hobby python' (integer) 1 127.0.0.1:6379> \u8ba2\u9605\u8005\u7684\u5ba2\u6237\u7aef\u4f1a\u663e\u793a\u5982\u4e0b\u6d88\u606f 127.0.0.1:6379> SUBSCRIBE chat Reading messages... (press Ctrl-C to quit) 1) \"subscribe\" 2) \"chat\" 3) (integer) 1 1) \"message\" 2) \"chat\" 3) \"my name is caimengzhi\" 1) \"message\" 2) \"chat\" 3) \"my age 20\" 1) \"message\" 2) \"chat\" 3) \"my hobby python\"","title":"3. \u5b9e\u4f8b"},{"location":"linux/nosql/redis/redis.save/","text":"Redis \u5907\u4efd\u4e0e\u6062\u590d 1. \u4ecb\u7ecd \u00b6 Redis SAVE \u547d\u4ee4\u7528\u4e8e\u521b\u5efa\u5f53\u524d\u6570\u636e\u5e93\u7684\u5907\u4efd\u3002 2. save \u00b6 SAVE \u5b9e\u4f8b root@manage01:/home/loocha# redis-cli 127.0.0.1:6379> AUTH cmz OK 127.0.0.1:6379> save OK root@manage01:/home/loocha# ls /usr/local/redis/data/ dump.rdb \u8be5\u547d\u4ee4\u5c06\u5728 redis \u4f1a\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u7684\u5730\u65b9\u521b\u5efadump.rdb\u6587\u4ef6\u3002 root@manage01:/home/loocha# egrep dir /usr/local/redis/conf/redis.conf dir \"/usr/local/redis/data\" \u6216\u8005 root@manage01:/home/loocha# redis-cli 127.0.0.1:6379> AUTH cmz OK 127.0.0.1:6379> CONFIG GET dir 1) \"dir\" 2) \"/usr/local/redis/data\" 3. bgsave \u00b6 \u521b\u5efa redis \u5907\u4efd\u6587\u4ef6\u4e5f\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4 BGSAVE\uff0c\u8be5\u547d\u4ee4\u5728\u540e\u53f0\u6267\u884c\u3002 127.0.0.1:6379> BGSAVE Background saving started 4. \u6570\u636e\u6062\u590d \u00b6 \u5982\u679c\u9700\u8981\u6062\u590d\u6570\u636e\uff0c\u53ea\u9700\u5c06\u5907\u4efd\u6587\u4ef6 (dump.rdb) \u79fb\u52a8\u5230 redis \u6307\u5b9a\u7684\u90a3\u76ee\u5f55\u4e0b\u5e76\u542f\u52a8\u670d\u52a1\u5373\u53ef\u3002","title":"08. redis \u5907\u4efd\u4e0e\u6062\u590d"},{"location":"linux/nosql/redis/redis.save/#1","text":"Redis SAVE \u547d\u4ee4\u7528\u4e8e\u521b\u5efa\u5f53\u524d\u6570\u636e\u5e93\u7684\u5907\u4efd\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.save/#2-save","text":"SAVE \u5b9e\u4f8b root@manage01:/home/loocha# redis-cli 127.0.0.1:6379> AUTH cmz OK 127.0.0.1:6379> save OK root@manage01:/home/loocha# ls /usr/local/redis/data/ dump.rdb \u8be5\u547d\u4ee4\u5c06\u5728 redis \u4f1a\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u7684\u5730\u65b9\u521b\u5efadump.rdb\u6587\u4ef6\u3002 root@manage01:/home/loocha# egrep dir /usr/local/redis/conf/redis.conf dir \"/usr/local/redis/data\" \u6216\u8005 root@manage01:/home/loocha# redis-cli 127.0.0.1:6379> AUTH cmz OK 127.0.0.1:6379> CONFIG GET dir 1) \"dir\" 2) \"/usr/local/redis/data\"","title":"2. save"},{"location":"linux/nosql/redis/redis.save/#3-bgsave","text":"\u521b\u5efa redis \u5907\u4efd\u6587\u4ef6\u4e5f\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4 BGSAVE\uff0c\u8be5\u547d\u4ee4\u5728\u540e\u53f0\u6267\u884c\u3002 127.0.0.1:6379> BGSAVE Background saving started","title":"3. bgsave"},{"location":"linux/nosql/redis/redis.save/#4","text":"\u5982\u679c\u9700\u8981\u6062\u590d\u6570\u636e\uff0c\u53ea\u9700\u5c06\u5907\u4efd\u6587\u4ef6 (dump.rdb) \u79fb\u52a8\u5230 redis \u6307\u5b9a\u7684\u90a3\u76ee\u5f55\u4e0b\u5e76\u542f\u52a8\u670d\u52a1\u5373\u53ef\u3002","title":"4. \u6570\u636e\u6062\u590d"},{"location":"linux/nosql/redis/redis.sentinel/","text":"Redis Sentinel 1. \u4ecb\u7ecd \u00b6 REmote DIctionary Server(Redis) \u662f\u4e00\u4e2a\u7531Salvatore Sanfilippo\u5199\u7684key-value\u5b58\u50a8\u7cfb\u7edf\u3002Redis\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u4f7f\u7528ANSI C\u8bed\u8a00\u7f16\u5199\u3001\u9075\u5b88BSD\u534f\u8bae\u3001\u652f\u6301\u7f51\u7edc\u3001\u53ef\u57fa\u4e8e\u5185\u5b58\u4ea6\u53ef\u6301\u4e45\u5316\u7684\u65e5\u5fd7\u578b\u3001Key-Value\u6570\u636e\u5e93\uff0c\u5e76\u63d0\u4f9b\u591a\u79cd\u8bed\u8a00\u7684API\u3002\u5b83\u901a\u5e38\u88ab\u79f0\u4e3a\u6570\u636e\u7ed3\u6784\u670d\u52a1\u5668\uff0c\u56e0\u4e3a\u503c\uff08value\uff09\u53ef\u4ee5\u662f \u5b57\u7b26\u4e32(String), \u54c8\u5e0c(Map), \u5217\u8868(list), \u96c6\u5408(sets) \u548c \u6709\u5e8f\u96c6\u5408(sorted sets)\u7b49\u7c7b\u578b\u3002Redis \u662f\u5b8c\u5168\u5f00\u6e90\u514d\u8d39\u7684\uff0c\u9075\u5b88BSD\u534f\u8bae\uff0c\u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684key-value\u6570\u636e\u5e93\u3002Redis \u4e0e\u5176\u4ed6 key - value \u7f13\u5b58\u4ea7\u54c1\u6709\u4ee5\u4e0b\u4e09\u4e2a\u7279\u70b9\uff1a Redis\u652f\u6301\u6570\u636e\u7684\u6301\u4e45\u5316\uff0c\u53ef\u4ee5\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4fdd\u6301\u5728\u78c1\u76d8\u4e2d\uff0c\u91cd\u542f\u7684\u65f6\u5019\u53ef\u4ee5\u518d\u6b21\u52a0\u8f7d\u8fdb\u884c\u4f7f\u7528\u3002 Redis\u4e0d\u4ec5\u4ec5\u652f\u6301\u7b80\u5355\u7684key-value\u7c7b\u578b\u7684\u6570\u636e\uff0c\u540c\u65f6\u8fd8\u63d0\u4f9blist\uff0cset\uff0czset\uff0chash\u7b49\u6570\u636e\u7ed3\u6784\u7684\u5b58\u50a8\u3002 Redis\u652f\u6301\u6570\u636e\u7684\u5907\u4efd\uff0c\u5373master-slave\u6a21\u5f0f\u7684\u6570\u636e\u5907\u4efd\u3002 1.1 \u4f18\u52bf \u00b6 \u6027\u80fd\u6781\u9ad8 \u2013 Redis\u80fd\u8bfb\u7684\u901f\u5ea6\u662f110000\u6b21/s,\u5199\u7684\u901f\u5ea6\u662f81000\u6b21/s \u3002 \u4e30\u5bcc\u7684\u6570\u636e\u7c7b\u578b\u2013Redis\u652f\u6301\u4e8c\u8fdb\u5236\u6848\u4f8b\u7684 Strings, Lists, Hashes, Sets \u53ca Ordered Sets \u6570\u636e\u7c7b\u578b\u64cd\u4f5c\u3002 \u539f\u5b50 \u2013 Redis\u7684\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027\u7684\uff0c\u540c\u65f6Redis\u8fd8\u652f\u6301\u5bf9\u51e0\u4e2a\u64cd\u4f5c\u5168\u5e76\u540e\u7684\u539f\u5b50\u6027\u6267\u884c\u3002 \u4e30\u5bcc\u7684\u7279\u6027 \u2013 Redis\u8fd8\u652f\u6301 publish/subscribe, \u901a\u77e5, key \u8fc7\u671f\u7b49\u7b49\u7279\u6027\u3002 1.2 \u6bd4\u8f83 \u00b6 Redis\u4e0e\u5176\u4ed6key-value\u5b58\u50a8\u6709\u4ec0\u4e48\u4e0d\u540c - Redis\u6709\u7740\u66f4\u4e3a\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\u5e76\u4e14\u63d0\u4f9b\u5bf9\u4ed6\u4eec\u7684\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u8fd9\u662f\u4e00\u4e2a\u4e0d\u540c\u4e8e\u5176\u4ed6\u6570\u636e\u5e93\u7684\u8fdb\u5316\u8def\u5f84\u3002Redis\u7684\u6570\u636e\u7c7b\u578b\u90fd\u662f\u57fa\u4e8e\u57fa\u672c\u6570\u636e\u7ed3\u6784\u7684\u540c\u65f6\u5bf9\u7a0b\u5e8f\u5458\u900f\u660e\uff0c\u65e0\u9700\u8fdb\u884c\u989d\u5916\u7684\u62bd\u8c61\u3002 - Redis\u8fd0\u884c\u5728\u5185\u5b58\u4e2d\u4f46\u662f\u53ef\u4ee5\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u6240\u4ee5\u5728\u5bf9\u4e0d\u540c\u6570\u636e\u96c6\u8fdb\u884c\u9ad8\u901f\u8bfb\u5199\u65f6\u9700\u8981\u6743\u8861\u5185\u5b58\uff0c\u5e94\u4e3a\u6570\u636e\u91cf\u4e0d\u80fd\u5927\u4e8e\u786c\u4ef6\u5185\u5b58\u3002\u5728\u5185\u5b58\u6570\u636e\u5e93\u65b9\u9762\u7684\u53e6\u4e00\u4e2a\u4f18\u70b9\u662f\uff0c \u76f8\u6bd4\u5728\u78c1\u76d8\u4e0a\u76f8\u540c\u7684\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5728\u5185\u5b58\u4e2d\u64cd\u4f5c\u8d77\u6765\u975e\u5e38\u7b80\u5355\uff0c\u8fd9\u6837Redis\u53ef\u4ee5\u505a\u5f88\u591a\u5185\u90e8\u590d\u6742\u6027\u5f88\u5f3a\u7684\u4e8b\u60c5\u3002 \u540c\u65f6\uff0c\u5728\u78c1\u76d8\u683c\u5f0f\u65b9\u9762\u4ed6\u4eec\u662f\u7d27\u51d1\u7684\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u4ea7\u751f\u7684\uff0c\u56e0\u4e3a\u4ed6\u4eec\u5e76\u4e0d\u9700\u8981\u8fdb\u884c\u968f\u673a\u8bbf\u95ee\u3002 2. redis sentinel \u4ecb\u7ecd \u00b6 2.1 Sentinel\u662f\u4ec0\u4e48 \u00b6 \u7528\u4e8e\u76d1\u89c6master\u662f\u5426\u6b63\u5e38\u5728\u7ebf\uff0c\u82e5\u679c\u8bf4master\u6302\u6389\u4e86\uff0cSentinel\u4f1a\u8ba9\u5176\u4e2d\u4e00\u4e2aslave\u9876\u4e0a\u53bb\u3002 2.2 \u5f00\u591a\u5c11\u4e2aSentinel\u5408\u9002 \u00b6 \u5f003\u4e2aSentinel\uff0c\u6216\u8005\u8bf4\u5f00\u5947\u6570\u4e2a\uff0cSentinel\u7684\u539f\u7406\u5c31\u662f\u4e00\u76f4\u76d1\u89c6\u7740master\u662f\u5426\u5728\u7ebf\uff0c\u5982\u679c\u662f\u6302\u6389\uff0cSentinel\u7684\u96c6\u7fa4\u8ffd\u9009\u4e3e\u5176\u4e2d\u4e00\u4e2a\u9886\u5934Sentinel\uff0c\u7136\u540e\u7531\u4e8e\u9886\u5934\u7684Sentinel\u6267\u884cslaveof\u547d\u4ee4\u8ba9slave\u4f5c\u4e3amaster\uff0c\u7136\u540eSentinel\u96c6\u7fa4\u673a\u9009\u76d1\u89c6\u65b0\u7684master\uff0c\u8001\u7684master\u8fd8\u662f\u4f1a\u4e00\u76f4\u76d1\u89c6\u7740\u5982\u679c\u542f\u52a8\u4e86\u90a3\u4e48\u8001\u7684master\u4f1a\u505a\u4e3a\u65b0\u7684master\u7684slave 2.3 Sentinel\u5224\u65admaster\u4e0b\u7ebf\u7684\u4e24\u79cd\u6807\u51c6 \u00b6 \u4e3b\u89c2\u4e0b\u7ebf Sentinel\u53d1\u73b0master\u6ca1\u6709\u5728\u6307\u5b9a\u65f6\u95f4\u8fd4\u56de\u4fe1\u606f\uff0c\u8fd9\u79cd\u60c5\u51b5\u5457\u8ba4\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\u3002[\u6307\u5b9a\u65f6\u95f4\uff1a\u8fd9\u4e2a\u65f6\u95f4\u662f\u6211\u4eec\u8bbe\u7f6e\u7684] \u5ba2\u89c2\u4e0b\u7ebf sentinel\u8be2\u95eeSentinel\u96c6\u7fa4\uff0c\u7bee\u4e0b\u5176\u4ed6\u7684Sentinel\u662f\u5426\u4e5f\u6807\u8bb0\u8fd9\u4e2amaster\u662f\u5426\u4e0b\u7ebf\u5982\u679c\u6807\u8bb0Sentinel\u4e0b\u7ebf\u7684\u4e2a\u6570\u8fbe\u5230\u4e00\u4e2a\u9608\u503c\uff0cSentinel\u4f1a\u5c06master\u6807\u8bb0\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\uff0c\u8fd9\u65f6\u5019\u4f1a\u9009\u53d6\u9886\u5934\u7684Sentinel\uff0c\u7531Sentinel\u9009\u53d6master\u4e0b\u9762\u7684\u4e00\u4e2aslave\u53bb\u4f5c\u4e3a\u65b0\u7684master\u3002 3. \u51c6\u5907 \u00b6 3.1 \u6761\u4ef6 \u00b6 \u5b9e\u9a8c\u73af\u5883: 1\u4e3b\u4e24\u4ece\uff0c3\u4e2aSentinel 3.2 \u914d\u7f6e \u00b6 \u8bbe\u7f6eSentinel\u56db\u4e2a\u6761\u4ef6: IP \u4e0b\u7ebf\u9600\u503c slave\u4e2a\u6570 \u6062\u590d\u65f6\u957f 3.2.1 ip\u5730\u5740 \u00b6 \u4f60\u8981\u76d1\u89c6\u4e3b\u670d\u52a1\u5668\u7684ip\u5730\u5740\uff0c\u4ee5\u53ca\u8bbe\u7f6eSentinel\u6807\u8bb0\u5ba2\u89c2\u4e0b\u7ebf\u7684\u9608\u503c Note sentinel monitor < \u88ab\u76d1\u63a7\u7684\u540d\u5b57\u4e5f\u5c31\u662f run_id > < ip > < port > < \u56e2\u4f53\u53f7 > sentinel monitor mymaster 127.0 . 0.1 6379 2 3.2.2 \u4e0b\u7ebf\u9600\u503c \u00b6 Note Sentinel\u8ba4\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\u7684\u4e00\u4e2a\u9608\u503c sentinel down - after - milliseconds mymaster 30000 3.2.3 slave\u4e2a\u6570 \u00b6 Note \u6545\u969c\u6062\u590d\u671f\u95f4\u53ef\u4ee5\u540c\u65f6 slave\u7684\u4e2a\u6570 sentinel parallel - syncs mymaster 1 3.2.3 \u6062\u590d\u65f6\u957f \u00b6 Note \u6545\u969c\u6062\u590d\u5141\u8bb8\u7684\u6700\u5927\u65f6\u957f sentinel failover - timeout mymaster 180000 4. redis sentinel \u00b6 4.1 \u73af\u5883\u51c6\u5907 \u00b6 \u91c7\u7528\u540c\u4e00\u7f51\u7edc\u5185\u7684\u4e09\u53f0docker\u4e3b\u673a\uff08\u53ef\u4ee5\u662f\u7269\u7406\u4e3b\u673a\u3001\u865a\u62df\u673a\u6216docker\u5bb9\u5668\uff09\uff0c\u8981\u6c42\u4e09\u53f0\u4e3b\u673a\u4e4b\u95f4\u90fd\u80fd\u76f8\u4e92\u8bbf\u95ee\uff0c\u6bcf\u4e00\u53f0\u4e3b\u673a\u4e0a\u90fd\u5b89\u88c5redis-server\u3001redis-sentinel\u3002redis-server\u8d1f\u8d23\u63d0\u4f9bRedis\u7f13\u5b58\u670d\u52a1\uff0c\u4e09\u53f0\u4e3b\u673a\u95f4\u7684\u5173\u7cfb\u662fmaster-slave-slave,redis-sentinel\u8d1f\u8d23\u63d0\u4f9bRedis\u9ad8\u53ef\u7528\uff0cVIP\u59cb\u7ec8\u5728redis-server master\u4e0a\uff0c\u4fdd\u8bc1\u5bf9\u4e0a\u5c42\u5e94\u7528\u53ef\u5199\u53ef\u8bfb\u3002\u4e09\u53f0\u4e3b\u673a\u7684\u5197\u4f59\u5ea6\u662f1\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f53\u6709\u4e00\u53f0\u4e3b\u673a\u5b95\u673a\u65f6\u53e6\u5916\u4e24\u53f0\u4e2d\u81f3\u5c11\u6709\u4e00\u53f0\u4e3b\u673a\u53ef\u4ee5\u63d0\u4f9bRedis\u7f13\u5b58\u670d\u52a1\u3002 \u5982\u56fe\u6240\u793a\uff0c\u6709\u4e09\u53f0\u4e3b\u673a\uff0c\u5206\u522b\u6807\u8bc6\u4e3aRedis1\u3001Redis2\u3001Redis3\uff0c\u5b83\u4eec\u7684\u89d2\u8272\u548c\u914d\u7f6e\u7b49\u4fe1\u606f\u5982\u4e0b\uff1a \u4e3b\u673a\u6807\u8bc6 IP\u5730\u5740 \u9884\u8bbe\u89d2\u8272 172.17.0.6 redis-server redis-sentinel vip 172.17.0.14 redis-server redis-sentinel 172.17.0.16 redis-server redis-sentinel Redis\u4e3b\u4ece\u7cfb\u7edf\uff0c\u9664\u4e86\u505a\u6570\u636e\u5197\u4f59\uff0c\u5f00\u53ef\u4ee5\u505a\u9ad8\u53ef\u7528\u6027\u707e\u5907\u3002Reids\u63d0\u4f9b\u4e86Sentinel\u5de5\u5177\u6765\u76d1\u63a7\u5404Master\u7684\u72b6\u6001\uff0c\u5982\u679cMaster\u5f02\u5e38\uff0c\u5219\u4f1a\u505a\u4e3b\u4ece\u5207\u6362\uff0c\u5c06slave\u4f5c\u4e3amaster\uff0c\u5c06master\u4f5c\u4e3aslave\u3002\u4e3b\u4ece\u5207\u6362\u4e4b\u540e\uff0cmaster_redis.conf\u3001slave_redis.conf\u548csentinel.conf\u7684\u5185\u5bb9\u90fd\u4f1a\u53d1\u751f\u6539\u53d8\u3002master_redis.conf\u4e2d\u4f1a\u591a\u4e86\u4e00\u53e5slaveof\u7684\u914d\u7f6e\uff0csentinel.conf\u7684\u76d1\u63a7\u76ee\u6807\u4e5f\u968f\u4e4b\u8c03\u6362\uff0c\u8fd9\u4e00\u70b9\u8981\u6ce8\u610f\u3002 4.2 \u64cd\u4f5c\u6d41\u7a0b \u00b6 \u6574\u4f53\u6d41\u7a0b\u5982\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff0c\u4ee5\u4e0b\u6211\u4f7f\u7528docker\u5b89\u88c5\uff0c\u5bbf\u4e3b\u673a\u7c7b\u4f3c\u3002 - \u542f\u52a8\u4e09\u53f0ubuntu12.04 64\u4f4d\u955c\u50cf\u4f5c\u4e3adocker\u5bb9\u5668 - \u5b89\u88c5\u4f9d\u8d56\u5305 - \u5b89\u88c5tcl8.6.1 - \u5b89\u88c5redis3.0.2 - \u914d\u7f6eredis\u4e00\u4e3b\u4e24\u4ece\u6a21\u5f0f - \u6d4b\u8bd5redis\u4e00\u4e3b\u4e24\u4ece - \u914d\u7f6esentinel\u76d1\u63a7 - \u6d4b\u8bd5sentinel\u76d1\u63a7\u6a21\u5f0f - \u542f\u52a8redis\u7a0b\u5e8f - \u542f\u52a8sentinel\u76d1\u63a7\u7a0b\u5e8f - \u6d4b\u8bd5\u53ca\u6392\u9519 4.3 \u62d3\u6251\u6f14\u53d8 \u00b6 4.3.1 \u5f00\u59cb\u6a21\u5f0f \u00b6 \u5f00\u59cb\u7684\u4e09\u4e2asentinel\u76d1\u63a7\u4e00\u4e2aredis\u7684\u4e3b\u3002\u5f53redis\u4e3b\u5b95\u673a\u4ee5\u540e\uff0c\u67b6\u6784\u56fe\u53c8\u53d8\u4e86\u6a21\u5f0f\u3002 4.3.2 master\u5b95\u673a \u00b6 Master redis\u5b95\u673a\u540e\uff0c\u65b0\u4e3b\u542f\u52a8\uff0c\u5728master redis\u5728\u6307\u5b9a\u65f6\u95f4\u6ca1\u6709\u54cd\u5e94\uff0c\u4e09\u4e2asentinel\u4ef2\u88c1\u6709\u4e24\u4eba\u8ba4\u4e3a\u4e0b\u7ebf\u6b64\u65f6\u4ef2\u88c1\u5904\u65b0\u4e3bredis\uff0c\u542f\u52a8\u65b0\u7684master redis\u540e\uff0csentinel\u540c\u65f6\u76d1\u63a7\u8001\u7684master redis\u3002 4.3.3 master\u4fee\u590d\u540e \u00b6 \u5f53\u539f\u6765\u7684master redis\u6062\u590d\u540e\uff0c\u6b64\u65f6\u539f\u6765\u7684\u4e3b\u5c31\u81ea\u52a8\u53d8\u6210\u4ece\u53bb\u81ea\u52a8\u540c\u6b65\u65b0\u7684\u4e3b\uff0c\u67b6\u6784\u6a21\u5f0f\u6062\u590d\u6210\u4ee5\u4e0b\u3002 4.4 \u542f\u52a8\u955c\u50cf \u00b6 \u542f\u52a8\u955c\u50cf root@leco:~# docker run -itd --privileged -p 36379:6379 -p 36380:26379 -v /usr/local/src/ sentienl1 bash root@leco:~# docker run -itd --privileged -p 36381:6379 -p 36382:26379 -v /usr/local/src/ sentienl2 bash root@leco:~# docker run -itd --privileged -p 36383:6379 -p 36384:26379 -v /usr/local/src/ sentienl3 bash Note \u6b64\u65f6\u7aef\u53e3\u6620\u5c04\u51fa redis\u7684\u7aef\u53e36379\u548csentinel\u7684\u7aef\u53e326379\u5230\u5bbf\u4e3b\u673a \u3002 -- privileged \u662f\u83b7\u53d6\u81f3\u9ad8\u65e0\u4e0a\u7684 root\u6743\u9650 \u3002 - v\u662f\u6570\u636e\u5377\u7ba1\u7406 \u3002 - d\u662f\u540e\u53f0\u65b9\u5f0f\u8fd0\u884c \uff0c\u4e3a\u4e86\u5728\u5bb9\u5668\u5185 exit\u540e\u5bb9\u5668\u4e0d\u9000\u51fa \u3002 \u6ce8\u610f \u6211\u53ea\u5217\u51fa\u5b89\u88c5\u4e86\u5176\u4e2d\u4e00\u4e2a docker\u91cc\u9762\u7684\u4f9d\u8d56\u5305\u5176\u4ed6\u4e24docker\u5b89\u88c5\u4e00\u6837 \u3002\u76ee\u7684\u662f\u5229\u4e8e\u6d4b\u8bd5\uff0c\u6700\u540e\u53ef\u4ee5\u5378\u8f7d\u5728\u5236\u4f5c\u6210\u65b0\u7684\u955c\u50cf\u65f6\u5019\u3002 4.5.2 \u5b89\u88c5tcl \u5305 \u00b6 root@8d7240ab9c47:~# tar xzvf tcl8.6.1-src.tar.gz -C /usr/local/ root@8d7240ab9c47:~# cd /usr/local/tcl8.6.1/unix root@8d7240ab9c47:~# ./configure root@8d7240ab9c47:~# make root@8d7240ab9c47:~# make install 4.5.3 \u5b89\u88c5redis \u00b6 root@8d7240ab9c47:~# tar xvfz redis-3.0.2.tar.gz root@8d7240ab9c47:~# cd redis-3.0.2 root@8d7240ab9c47:~# make root@8d7240ab9c47:~# cd src root@8d7240ab9c47:~# make install root@8d7240ab9c47:~# make PREFIX=/usr/local/redis install root@8d7240ab9c47:~# useradd -s /sbin/nologin redis root@8d7240ab9c47:~# mkdir /usr/local/redis/var root@8d7240ab9c47:~# chmod 777 /usr/local/redis/var/ root@8d7240ab9c47:~# mkdir -p /usr/local/redis/etc #\u653e\u7f6e\u914d\u7f6e\u6587\u4ef6\u5730\u65b9 \u6ce8\u610f \u6211\u53ea\u5217\u51fa\u5b89\u88c5\u4e86\u5176\u4e2d\u4e00\u4e2a docker\u91cc\u9762\u7684redis , tcl \uff0c\u6b64\u65f6\u5148\u505a\u4e3a\u4e3b\uff0c\u5176\u4ed6\u4e24\u4ece redis docker\u5b89\u88c5\u4e00\u6837 \u3002 4.6 \u914d\u7f6e\u4e3b\u4ece \u00b6 4.6.1 \u4e3b\u4ece\u914d\u7f6e \u00b6 Master redis.conf\u914d\u7f6e\u6587\u4ef6\u4fee\u6539 root@8d7240ab9c47:~# cat /usr/local/redis/etc/redis.conf daemonize yes # \u540e\u53f0\u8fd0\u884c pidfile \"/usr/local/redis/var/redis.pid\" # \u8fd0\u884cpid\u6587\u4ef6 port 6379 # \u7aef\u53e3 timeout 300 # \u8d85\u65f6 loglevel debug # debug\u6a21\u5f0f logfile \"/usr/local/redis/var/redis.log\" # \u65e5\u5fd7\u6587\u4ef6 databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/redis/var\" appendonly no appendfsync always bind 0.0.0.0 # \u65b9\u5f0fip\u9650\u5236 Slave1 redis.conf\u914d\u7f6e\u6587\u4ef6\u4fee\u6539 root@38b072848ccd:/# cat /usr/local/redis/etc/redis.conf daemonize yes pidfile \"/usr/local/redis/var/redis.pid\" port 6379 timeout 300 loglevel debug logfile \"/usr/local/redis/var/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/redis/var\" appendonly no appendfsync always bind 0.0.0.0 slaveof 172.17.0.2 6379 # master ip Slave2 redis.conf\u914d\u7f6e\u6587\u4ef6\u4fee\u6539 root@56c0344c59a0:/# cat /usr/local/redis/etc/redis.conf daemonize yes pidfile \"/usr/local/redis/var/redis.pid\" port 6379 timeout 300 loglevel debug logfile \"/usr/local/redis/var/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/redis/var\" appendonly no appendfsync always bind 0.0.0.0 slaveof 172.17.0.2 6379 \u7279\u522b\u6ce8\u610f \u4e00\u5b9a\u8981\u4fee\u8fd9\u4e2a\u4e3a 0.0 . 0.0 \u5426\u5219\u5bbf\u4e3b\u673a\u8fde\u63a5\u4e0d\u5230 docker\u5bb9\u5668\u91cc\u9762\u7684redis \u542f\u52a8\u811a\u672c [root@linux-node2 init.d]# cat /etc/init.d/redis #!/bin/sh # # Simple Redis init.d script conceived to work on Linux systems # as it does use of the /proc filesystem. # chkconfig: 2345 90 10 # description: Redis is a persistent key-value database # REDISPORT=6379 EXEC=/usr/local/bin/redis-server CLIEXEC=/usr/local/bin/redis-cli PIDFILE=/var/run/redis_${REDISPORT}.pid #CONF=\"/etc/redis/${REDISPORT}.conf\" CONF=\"/usr/local/redis/etc/redis.conf\" case \"$1\" in start) if [ -f $PIDFILE ] then echo \"$PIDFILE exists, process is already running or crashed\" else echo \"Starting Redis server...\" $EXEC $CONF echo $(ps aux|grep redis|grep -v grep|grep 6379|awk '{print $2}')>$PIDFILE fi ;; stop) if [ ! -f $PIDFILE ] then echo \"$PIDFILE does not exist, process is not running\" else PID=$(cat $PIDFILE) echo \"Stopping ...\" $CLIEXEC -p $REDISPORT shutdown while [ -x /proc/${PID} ] do echo \"Waiting for Redis to shutdown ...\" sleep 1 done echo \"Redis stopped\" cd /var/run/ && rm -f redis_${REDISPORT}.pid fi ;; *) echo \"Please use start or stop as first argument\" ;; esac [root@linux-node2 init.d]# chmod +x /etc/init.d/redis 4.7 \u542f\u52a8 \u00b6 4.7.1 \u542f\u52a8 \u00b6 #root@8d7240ab9c47:~# redis-server /usr/local/redis/etc/redis.conf root@8d7240ab9c47:~# /etc/init.d/redis start Starting Redis server... 4.7.2 \u505c\u6b62 \u00b6 #root@8d7240ab9c47:~# redis-cli shutdown root@8d7240ab9c47:~# /etc/init.d/redis stop \u6ce8\u610f \u5176\u4ed6\u4e24\u4e2a\u4ece redis\u542f\u52a8\u65b9\u5f0f\u4e00\u6837 \u3002 4.8 \u6d4b\u8bd5\u4e3b\u4ece \u00b6 \u4fdd\u8bc1\u4e09\u53f0redis\u90fd\u542f\u52a8\u540e\uff0c\u67e5\u770b 127.0.0.1:6379> info \u3002\u3002\u3002\u3002\u3002\u3002 # Replication role:master connected_slaves:2 slave0:ip=172.17.0.6,port=6379,state=online,offset=10912,lag=0 slave1:ip=172.17.0.4,port=6379,state=online,offset=10912,lag=0 \u3002\u3002\u3002\u3002\u3002\u3002 \u6bcf\u4e2aredis\u90fd\u4f1a\u6709\u8be5info\uff0c\u53ef\u770b\u51fa\u5176\u4e2d\u6bcf\u4e2aredis\u7684\u8eab\u4efdrole\u3002\u5176\u4e2dmaster\u53ef\u4ee5\u770b\u51fa\u5b83\u7684\u4e24\u4e2aslave\u60c5\u51b5\u3002 4.8.1 \u4e3b\u4e0a\u8bbe\u7f6e\u4e00\u4e2a\u952e\u503c\u5bf9 \u00b6 127.0.0.1:6379> set realcloud 1234 OK 127.0.0.1:6379> get realcloud \"1234\" 4.8.2 Redis slave1\u67e5\u770b \u00b6 127.0.0.1:6379> get realcloud \"1234\" 4.8.2 Redis slave2\u67e5\u770b \u00b6 127.0.0.1:6379> get realcloud \"1234\" \u4ece\u4e0a\u53ef\u4ee5\u770b\u51faredis\u4e00\u4e3b\u4e24\u4ece\uff0c\u5b89\u88c5\uff0c\u6d4b\u8bd5OK\u3002 4.8 \u914d\u7f6esentinel \u00b6 \u4e09\u53f0\u673a\u5668\u7684\u914d\u7f6e\u6587\u4ef6\u90fd\u4e00\u6837\u3002 4.8.1 \u914d\u7f6esentinel \u00b6 root@8d7240ab9c47:~# cat /usr/local/redis/etc/sentinel.conf port 26379 dir /usr/local/redis/var_sentinel sentinel monitor mymaster 172.17.0.2 6379 2 #\u8be5IP\u662fredis\u4e3b\u7684IP\u3002\u6839\u636e\u60c5\u51b5\u6539\u5199\u3002 sentinel down-after-milliseconds mymaster 10000 sentinel parallel-syncs mymaster 1 sentinel failover-timeout mymaster 60000 #sentinel client-reconfig-script mymaster /script/failover.sh 4.8.2 \u542f\u52a8 sentinel \u00b6 root@8d7240ab9c47:~#mkdir /usr/local/redis/var_sentinel root@8d7240ab9c47:~# redis-sentinel /usr/local/redis/etc/sentinel.conf >/usr/local/redis/var_sentinel/sentinel.log & 4.8.3 \u67e5\u770b \u00b6 \u5728\u4e3bredis\u4e0a\u8fdb\u5165sentinel\u3002 root@8d7240ab9c47:~# redis-cli -p 26379 127.0.0.1:26379> sentinel master mymaster 1) \"name\" 2) \"mymaster\" 3) \"ip\" 4) \"172.17.0.2\" 5) \"port\" 6) \"6379\" 7) \"runid\" 8) \"eb05e2906f6e3f916fbca5f3f3e421560f2bbf21\" 9) \"flags\" 10) \"master\" 11) \"pending-commands\" 12) \"0\" 13) \"last-ping-sent\" 14) \"0\" 15) \"last-ok-ping-reply\" 16) \"451\" 17) \"last-ping-reply\" 18) \"451\" 19) \"down-after-milliseconds\" 20) \"10000\" 21) \"info-refresh\" 22) \"3492\" 23) \"role-reported\" 24) \"master\" 25) \"role-reported-time\" 26) \"5854962\" 27) \"config-epoch\" 28) \"0\" 29) \"num-slaves\" 30) \"2\" 31) \"num-other-sentinels\" 32) \"2\" 33) \"quorum\" 34) \"2\" 35) \"failover-timeout\" 36) \"60000\" 37) \"parallel-syncs\" 38) \"1\" 127.0.0.1:26379> \u6ce8\u610f redis\u7684\u9ed8\u8ba4\u7aef\u53e3\u662f6379 redis - sentinel \u9ed8\u8ba4\u7aef\u53e3\u662f 26379 4.9 \u6545\u969c\u6a21\u62df \u00b6 4.9.1 master\u5b95\u673a \u00b6 root@8d7240ab9c47:~# redis-cli shutdown #\u4e3b\u5b95\u673a 4.9.2 \u67e5\u770bredis\u4e3b\u4ece\u60c5\u51b5 \u00b6 root@38b072848ccd:~# redis-cli info #\u6b64\u65f6\u4e3amaster root@56c0344c59a0:~# redis-cli info 4.9.3 \u67e5\u770bsentinel\u60c5\u51b5 \u00b6 root@38b072848ccd:~# redis-cli -p 26379 127.0.0.1:26379> sentinel master mymaster 1) \"name\" 2) \"mymaster\" 3) \"ip\" 4) \"172.17.0.4\" 5) \"port\" 6) \"6379\" \u6b64\u65f6\u5728kill\u5f53\u524d\u7684master\u3002Sentinel\u5728\u6307\u5b9a\u65f6\u95f4\u5185\u53c8\u4f17\u7b79\u51fa\u5f53\u524d\u65b0\u7684master\u3002\u5f53\u4e4b\u524d\u7684master \u53c8\u542f\u52a8\u597d\u4ee5\u540esentinel\u53c8\u4e3b\u52a8\u5c06\u4e4b\u524d\u7684master\u6dfb\u52a0\u5230\u65b0\u7684master\u4e2d\uff0c\u4f5c\u4e3aslave\u3002\u76ee\u524d\u4e3a\u6b62redis\u7684sentinel\u6d4b\u8bd5OK\u3002","title":"11. redis \u54e8\u5175"},{"location":"linux/nosql/redis/redis.sentinel/#1","text":"REmote DIctionary Server(Redis) \u662f\u4e00\u4e2a\u7531Salvatore Sanfilippo\u5199\u7684key-value\u5b58\u50a8\u7cfb\u7edf\u3002Redis\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u4f7f\u7528ANSI C\u8bed\u8a00\u7f16\u5199\u3001\u9075\u5b88BSD\u534f\u8bae\u3001\u652f\u6301\u7f51\u7edc\u3001\u53ef\u57fa\u4e8e\u5185\u5b58\u4ea6\u53ef\u6301\u4e45\u5316\u7684\u65e5\u5fd7\u578b\u3001Key-Value\u6570\u636e\u5e93\uff0c\u5e76\u63d0\u4f9b\u591a\u79cd\u8bed\u8a00\u7684API\u3002\u5b83\u901a\u5e38\u88ab\u79f0\u4e3a\u6570\u636e\u7ed3\u6784\u670d\u52a1\u5668\uff0c\u56e0\u4e3a\u503c\uff08value\uff09\u53ef\u4ee5\u662f \u5b57\u7b26\u4e32(String), \u54c8\u5e0c(Map), \u5217\u8868(list), \u96c6\u5408(sets) \u548c \u6709\u5e8f\u96c6\u5408(sorted sets)\u7b49\u7c7b\u578b\u3002Redis \u662f\u5b8c\u5168\u5f00\u6e90\u514d\u8d39\u7684\uff0c\u9075\u5b88BSD\u534f\u8bae\uff0c\u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684key-value\u6570\u636e\u5e93\u3002Redis \u4e0e\u5176\u4ed6 key - value \u7f13\u5b58\u4ea7\u54c1\u6709\u4ee5\u4e0b\u4e09\u4e2a\u7279\u70b9\uff1a Redis\u652f\u6301\u6570\u636e\u7684\u6301\u4e45\u5316\uff0c\u53ef\u4ee5\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4fdd\u6301\u5728\u78c1\u76d8\u4e2d\uff0c\u91cd\u542f\u7684\u65f6\u5019\u53ef\u4ee5\u518d\u6b21\u52a0\u8f7d\u8fdb\u884c\u4f7f\u7528\u3002 Redis\u4e0d\u4ec5\u4ec5\u652f\u6301\u7b80\u5355\u7684key-value\u7c7b\u578b\u7684\u6570\u636e\uff0c\u540c\u65f6\u8fd8\u63d0\u4f9blist\uff0cset\uff0czset\uff0chash\u7b49\u6570\u636e\u7ed3\u6784\u7684\u5b58\u50a8\u3002 Redis\u652f\u6301\u6570\u636e\u7684\u5907\u4efd\uff0c\u5373master-slave\u6a21\u5f0f\u7684\u6570\u636e\u5907\u4efd\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.sentinel/#11","text":"\u6027\u80fd\u6781\u9ad8 \u2013 Redis\u80fd\u8bfb\u7684\u901f\u5ea6\u662f110000\u6b21/s,\u5199\u7684\u901f\u5ea6\u662f81000\u6b21/s \u3002 \u4e30\u5bcc\u7684\u6570\u636e\u7c7b\u578b\u2013Redis\u652f\u6301\u4e8c\u8fdb\u5236\u6848\u4f8b\u7684 Strings, Lists, Hashes, Sets \u53ca Ordered Sets \u6570\u636e\u7c7b\u578b\u64cd\u4f5c\u3002 \u539f\u5b50 \u2013 Redis\u7684\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027\u7684\uff0c\u540c\u65f6Redis\u8fd8\u652f\u6301\u5bf9\u51e0\u4e2a\u64cd\u4f5c\u5168\u5e76\u540e\u7684\u539f\u5b50\u6027\u6267\u884c\u3002 \u4e30\u5bcc\u7684\u7279\u6027 \u2013 Redis\u8fd8\u652f\u6301 publish/subscribe, \u901a\u77e5, key \u8fc7\u671f\u7b49\u7b49\u7279\u6027\u3002","title":"1.1 \u4f18\u52bf"},{"location":"linux/nosql/redis/redis.sentinel/#12","text":"Redis\u4e0e\u5176\u4ed6key-value\u5b58\u50a8\u6709\u4ec0\u4e48\u4e0d\u540c - Redis\u6709\u7740\u66f4\u4e3a\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\u5e76\u4e14\u63d0\u4f9b\u5bf9\u4ed6\u4eec\u7684\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u8fd9\u662f\u4e00\u4e2a\u4e0d\u540c\u4e8e\u5176\u4ed6\u6570\u636e\u5e93\u7684\u8fdb\u5316\u8def\u5f84\u3002Redis\u7684\u6570\u636e\u7c7b\u578b\u90fd\u662f\u57fa\u4e8e\u57fa\u672c\u6570\u636e\u7ed3\u6784\u7684\u540c\u65f6\u5bf9\u7a0b\u5e8f\u5458\u900f\u660e\uff0c\u65e0\u9700\u8fdb\u884c\u989d\u5916\u7684\u62bd\u8c61\u3002 - Redis\u8fd0\u884c\u5728\u5185\u5b58\u4e2d\u4f46\u662f\u53ef\u4ee5\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u6240\u4ee5\u5728\u5bf9\u4e0d\u540c\u6570\u636e\u96c6\u8fdb\u884c\u9ad8\u901f\u8bfb\u5199\u65f6\u9700\u8981\u6743\u8861\u5185\u5b58\uff0c\u5e94\u4e3a\u6570\u636e\u91cf\u4e0d\u80fd\u5927\u4e8e\u786c\u4ef6\u5185\u5b58\u3002\u5728\u5185\u5b58\u6570\u636e\u5e93\u65b9\u9762\u7684\u53e6\u4e00\u4e2a\u4f18\u70b9\u662f\uff0c \u76f8\u6bd4\u5728\u78c1\u76d8\u4e0a\u76f8\u540c\u7684\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5728\u5185\u5b58\u4e2d\u64cd\u4f5c\u8d77\u6765\u975e\u5e38\u7b80\u5355\uff0c\u8fd9\u6837Redis\u53ef\u4ee5\u505a\u5f88\u591a\u5185\u90e8\u590d\u6742\u6027\u5f88\u5f3a\u7684\u4e8b\u60c5\u3002 \u540c\u65f6\uff0c\u5728\u78c1\u76d8\u683c\u5f0f\u65b9\u9762\u4ed6\u4eec\u662f\u7d27\u51d1\u7684\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u4ea7\u751f\u7684\uff0c\u56e0\u4e3a\u4ed6\u4eec\u5e76\u4e0d\u9700\u8981\u8fdb\u884c\u968f\u673a\u8bbf\u95ee\u3002","title":"1.2 \u6bd4\u8f83"},{"location":"linux/nosql/redis/redis.sentinel/#2-redis-sentinel","text":"","title":"2. redis sentinel \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.sentinel/#21-sentinel","text":"\u7528\u4e8e\u76d1\u89c6master\u662f\u5426\u6b63\u5e38\u5728\u7ebf\uff0c\u82e5\u679c\u8bf4master\u6302\u6389\u4e86\uff0cSentinel\u4f1a\u8ba9\u5176\u4e2d\u4e00\u4e2aslave\u9876\u4e0a\u53bb\u3002","title":"2.1 Sentinel\u662f\u4ec0\u4e48"},{"location":"linux/nosql/redis/redis.sentinel/#22-sentinel","text":"\u5f003\u4e2aSentinel\uff0c\u6216\u8005\u8bf4\u5f00\u5947\u6570\u4e2a\uff0cSentinel\u7684\u539f\u7406\u5c31\u662f\u4e00\u76f4\u76d1\u89c6\u7740master\u662f\u5426\u5728\u7ebf\uff0c\u5982\u679c\u662f\u6302\u6389\uff0cSentinel\u7684\u96c6\u7fa4\u8ffd\u9009\u4e3e\u5176\u4e2d\u4e00\u4e2a\u9886\u5934Sentinel\uff0c\u7136\u540e\u7531\u4e8e\u9886\u5934\u7684Sentinel\u6267\u884cslaveof\u547d\u4ee4\u8ba9slave\u4f5c\u4e3amaster\uff0c\u7136\u540eSentinel\u96c6\u7fa4\u673a\u9009\u76d1\u89c6\u65b0\u7684master\uff0c\u8001\u7684master\u8fd8\u662f\u4f1a\u4e00\u76f4\u76d1\u89c6\u7740\u5982\u679c\u542f\u52a8\u4e86\u90a3\u4e48\u8001\u7684master\u4f1a\u505a\u4e3a\u65b0\u7684master\u7684slave","title":"2.2 \u5f00\u591a\u5c11\u4e2aSentinel\u5408\u9002"},{"location":"linux/nosql/redis/redis.sentinel/#23-sentinelmaster","text":"\u4e3b\u89c2\u4e0b\u7ebf Sentinel\u53d1\u73b0master\u6ca1\u6709\u5728\u6307\u5b9a\u65f6\u95f4\u8fd4\u56de\u4fe1\u606f\uff0c\u8fd9\u79cd\u60c5\u51b5\u5457\u8ba4\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\u3002[\u6307\u5b9a\u65f6\u95f4\uff1a\u8fd9\u4e2a\u65f6\u95f4\u662f\u6211\u4eec\u8bbe\u7f6e\u7684] \u5ba2\u89c2\u4e0b\u7ebf sentinel\u8be2\u95eeSentinel\u96c6\u7fa4\uff0c\u7bee\u4e0b\u5176\u4ed6\u7684Sentinel\u662f\u5426\u4e5f\u6807\u8bb0\u8fd9\u4e2amaster\u662f\u5426\u4e0b\u7ebf\u5982\u679c\u6807\u8bb0Sentinel\u4e0b\u7ebf\u7684\u4e2a\u6570\u8fbe\u5230\u4e00\u4e2a\u9608\u503c\uff0cSentinel\u4f1a\u5c06master\u6807\u8bb0\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\uff0c\u8fd9\u65f6\u5019\u4f1a\u9009\u53d6\u9886\u5934\u7684Sentinel\uff0c\u7531Sentinel\u9009\u53d6master\u4e0b\u9762\u7684\u4e00\u4e2aslave\u53bb\u4f5c\u4e3a\u65b0\u7684master\u3002","title":"2.3 Sentinel\u5224\u65admaster\u4e0b\u7ebf\u7684\u4e24\u79cd\u6807\u51c6"},{"location":"linux/nosql/redis/redis.sentinel/#3","text":"","title":"3. \u51c6\u5907"},{"location":"linux/nosql/redis/redis.sentinel/#31","text":"\u5b9e\u9a8c\u73af\u5883: 1\u4e3b\u4e24\u4ece\uff0c3\u4e2aSentinel","title":"3.1 \u6761\u4ef6"},{"location":"linux/nosql/redis/redis.sentinel/#32","text":"\u8bbe\u7f6eSentinel\u56db\u4e2a\u6761\u4ef6: IP \u4e0b\u7ebf\u9600\u503c slave\u4e2a\u6570 \u6062\u590d\u65f6\u957f","title":"3.2 \u914d\u7f6e"},{"location":"linux/nosql/redis/redis.sentinel/#321-ip","text":"\u4f60\u8981\u76d1\u89c6\u4e3b\u670d\u52a1\u5668\u7684ip\u5730\u5740\uff0c\u4ee5\u53ca\u8bbe\u7f6eSentinel\u6807\u8bb0\u5ba2\u89c2\u4e0b\u7ebf\u7684\u9608\u503c Note sentinel monitor < \u88ab\u76d1\u63a7\u7684\u540d\u5b57\u4e5f\u5c31\u662f run_id > < ip > < port > < \u56e2\u4f53\u53f7 > sentinel monitor mymaster 127.0 . 0.1 6379 2","title":"3.2.1 ip\u5730\u5740"},{"location":"linux/nosql/redis/redis.sentinel/#322","text":"Note Sentinel\u8ba4\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\u7684\u4e00\u4e2a\u9608\u503c sentinel down - after - milliseconds mymaster 30000","title":"3.2.2 \u4e0b\u7ebf\u9600\u503c"},{"location":"linux/nosql/redis/redis.sentinel/#323-slave","text":"Note \u6545\u969c\u6062\u590d\u671f\u95f4\u53ef\u4ee5\u540c\u65f6 slave\u7684\u4e2a\u6570 sentinel parallel - syncs mymaster 1","title":"3.2.3 slave\u4e2a\u6570"},{"location":"linux/nosql/redis/redis.sentinel/#323","text":"Note \u6545\u969c\u6062\u590d\u5141\u8bb8\u7684\u6700\u5927\u65f6\u957f sentinel failover - timeout mymaster 180000","title":"3.2.3 \u6062\u590d\u65f6\u957f"},{"location":"linux/nosql/redis/redis.sentinel/#4-redis-sentinel","text":"","title":"4. redis sentinel"},{"location":"linux/nosql/redis/redis.sentinel/#41","text":"\u91c7\u7528\u540c\u4e00\u7f51\u7edc\u5185\u7684\u4e09\u53f0docker\u4e3b\u673a\uff08\u53ef\u4ee5\u662f\u7269\u7406\u4e3b\u673a\u3001\u865a\u62df\u673a\u6216docker\u5bb9\u5668\uff09\uff0c\u8981\u6c42\u4e09\u53f0\u4e3b\u673a\u4e4b\u95f4\u90fd\u80fd\u76f8\u4e92\u8bbf\u95ee\uff0c\u6bcf\u4e00\u53f0\u4e3b\u673a\u4e0a\u90fd\u5b89\u88c5redis-server\u3001redis-sentinel\u3002redis-server\u8d1f\u8d23\u63d0\u4f9bRedis\u7f13\u5b58\u670d\u52a1\uff0c\u4e09\u53f0\u4e3b\u673a\u95f4\u7684\u5173\u7cfb\u662fmaster-slave-slave,redis-sentinel\u8d1f\u8d23\u63d0\u4f9bRedis\u9ad8\u53ef\u7528\uff0cVIP\u59cb\u7ec8\u5728redis-server master\u4e0a\uff0c\u4fdd\u8bc1\u5bf9\u4e0a\u5c42\u5e94\u7528\u53ef\u5199\u53ef\u8bfb\u3002\u4e09\u53f0\u4e3b\u673a\u7684\u5197\u4f59\u5ea6\u662f1\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f53\u6709\u4e00\u53f0\u4e3b\u673a\u5b95\u673a\u65f6\u53e6\u5916\u4e24\u53f0\u4e2d\u81f3\u5c11\u6709\u4e00\u53f0\u4e3b\u673a\u53ef\u4ee5\u63d0\u4f9bRedis\u7f13\u5b58\u670d\u52a1\u3002 \u5982\u56fe\u6240\u793a\uff0c\u6709\u4e09\u53f0\u4e3b\u673a\uff0c\u5206\u522b\u6807\u8bc6\u4e3aRedis1\u3001Redis2\u3001Redis3\uff0c\u5b83\u4eec\u7684\u89d2\u8272\u548c\u914d\u7f6e\u7b49\u4fe1\u606f\u5982\u4e0b\uff1a \u4e3b\u673a\u6807\u8bc6 IP\u5730\u5740 \u9884\u8bbe\u89d2\u8272 172.17.0.6 redis-server redis-sentinel vip 172.17.0.14 redis-server redis-sentinel 172.17.0.16 redis-server redis-sentinel Redis\u4e3b\u4ece\u7cfb\u7edf\uff0c\u9664\u4e86\u505a\u6570\u636e\u5197\u4f59\uff0c\u5f00\u53ef\u4ee5\u505a\u9ad8\u53ef\u7528\u6027\u707e\u5907\u3002Reids\u63d0\u4f9b\u4e86Sentinel\u5de5\u5177\u6765\u76d1\u63a7\u5404Master\u7684\u72b6\u6001\uff0c\u5982\u679cMaster\u5f02\u5e38\uff0c\u5219\u4f1a\u505a\u4e3b\u4ece\u5207\u6362\uff0c\u5c06slave\u4f5c\u4e3amaster\uff0c\u5c06master\u4f5c\u4e3aslave\u3002\u4e3b\u4ece\u5207\u6362\u4e4b\u540e\uff0cmaster_redis.conf\u3001slave_redis.conf\u548csentinel.conf\u7684\u5185\u5bb9\u90fd\u4f1a\u53d1\u751f\u6539\u53d8\u3002master_redis.conf\u4e2d\u4f1a\u591a\u4e86\u4e00\u53e5slaveof\u7684\u914d\u7f6e\uff0csentinel.conf\u7684\u76d1\u63a7\u76ee\u6807\u4e5f\u968f\u4e4b\u8c03\u6362\uff0c\u8fd9\u4e00\u70b9\u8981\u6ce8\u610f\u3002","title":"4.1 \u73af\u5883\u51c6\u5907"},{"location":"linux/nosql/redis/redis.sentinel/#42","text":"\u6574\u4f53\u6d41\u7a0b\u5982\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff0c\u4ee5\u4e0b\u6211\u4f7f\u7528docker\u5b89\u88c5\uff0c\u5bbf\u4e3b\u673a\u7c7b\u4f3c\u3002 - \u542f\u52a8\u4e09\u53f0ubuntu12.04 64\u4f4d\u955c\u50cf\u4f5c\u4e3adocker\u5bb9\u5668 - \u5b89\u88c5\u4f9d\u8d56\u5305 - \u5b89\u88c5tcl8.6.1 - \u5b89\u88c5redis3.0.2 - \u914d\u7f6eredis\u4e00\u4e3b\u4e24\u4ece\u6a21\u5f0f - \u6d4b\u8bd5redis\u4e00\u4e3b\u4e24\u4ece - \u914d\u7f6esentinel\u76d1\u63a7 - \u6d4b\u8bd5sentinel\u76d1\u63a7\u6a21\u5f0f - \u542f\u52a8redis\u7a0b\u5e8f - \u542f\u52a8sentinel\u76d1\u63a7\u7a0b\u5e8f - \u6d4b\u8bd5\u53ca\u6392\u9519","title":"4.2 \u64cd\u4f5c\u6d41\u7a0b"},{"location":"linux/nosql/redis/redis.sentinel/#43","text":"","title":"4.3 \u62d3\u6251\u6f14\u53d8"},{"location":"linux/nosql/redis/redis.sentinel/#431","text":"\u5f00\u59cb\u7684\u4e09\u4e2asentinel\u76d1\u63a7\u4e00\u4e2aredis\u7684\u4e3b\u3002\u5f53redis\u4e3b\u5b95\u673a\u4ee5\u540e\uff0c\u67b6\u6784\u56fe\u53c8\u53d8\u4e86\u6a21\u5f0f\u3002","title":"4.3.1 \u5f00\u59cb\u6a21\u5f0f"},{"location":"linux/nosql/redis/redis.sentinel/#432-master","text":"Master redis\u5b95\u673a\u540e\uff0c\u65b0\u4e3b\u542f\u52a8\uff0c\u5728master redis\u5728\u6307\u5b9a\u65f6\u95f4\u6ca1\u6709\u54cd\u5e94\uff0c\u4e09\u4e2asentinel\u4ef2\u88c1\u6709\u4e24\u4eba\u8ba4\u4e3a\u4e0b\u7ebf\u6b64\u65f6\u4ef2\u88c1\u5904\u65b0\u4e3bredis\uff0c\u542f\u52a8\u65b0\u7684master redis\u540e\uff0csentinel\u540c\u65f6\u76d1\u63a7\u8001\u7684master redis\u3002","title":"4.3.2 master\u5b95\u673a"},{"location":"linux/nosql/redis/redis.sentinel/#433-master","text":"\u5f53\u539f\u6765\u7684master redis\u6062\u590d\u540e\uff0c\u6b64\u65f6\u539f\u6765\u7684\u4e3b\u5c31\u81ea\u52a8\u53d8\u6210\u4ece\u53bb\u81ea\u52a8\u540c\u6b65\u65b0\u7684\u4e3b\uff0c\u67b6\u6784\u6a21\u5f0f\u6062\u590d\u6210\u4ee5\u4e0b\u3002","title":"4.3.3 master\u4fee\u590d\u540e"},{"location":"linux/nosql/redis/redis.sentinel/#44","text":"\u542f\u52a8\u955c\u50cf root@leco:~# docker run -itd --privileged -p 36379:6379 -p 36380:26379 -v /usr/local/src/ sentienl1 bash root@leco:~# docker run -itd --privileged -p 36381:6379 -p 36382:26379 -v /usr/local/src/ sentienl2 bash root@leco:~# docker run -itd --privileged -p 36383:6379 -p 36384:26379 -v /usr/local/src/ sentienl3 bash Note \u6b64\u65f6\u7aef\u53e3\u6620\u5c04\u51fa redis\u7684\u7aef\u53e36379\u548csentinel\u7684\u7aef\u53e326379\u5230\u5bbf\u4e3b\u673a \u3002 -- privileged \u662f\u83b7\u53d6\u81f3\u9ad8\u65e0\u4e0a\u7684 root\u6743\u9650 \u3002 - v\u662f\u6570\u636e\u5377\u7ba1\u7406 \u3002 - d\u662f\u540e\u53f0\u65b9\u5f0f\u8fd0\u884c \uff0c\u4e3a\u4e86\u5728\u5bb9\u5668\u5185 exit\u540e\u5bb9\u5668\u4e0d\u9000\u51fa \u3002 \u6ce8\u610f \u6211\u53ea\u5217\u51fa\u5b89\u88c5\u4e86\u5176\u4e2d\u4e00\u4e2a docker\u91cc\u9762\u7684\u4f9d\u8d56\u5305\u5176\u4ed6\u4e24docker\u5b89\u88c5\u4e00\u6837 \u3002\u76ee\u7684\u662f\u5229\u4e8e\u6d4b\u8bd5\uff0c\u6700\u540e\u53ef\u4ee5\u5378\u8f7d\u5728\u5236\u4f5c\u6210\u65b0\u7684\u955c\u50cf\u65f6\u5019\u3002","title":"4.4 \u542f\u52a8\u955c\u50cf"},{"location":"linux/nosql/redis/redis.sentinel/#452-tcl","text":"root@8d7240ab9c47:~# tar xzvf tcl8.6.1-src.tar.gz -C /usr/local/ root@8d7240ab9c47:~# cd /usr/local/tcl8.6.1/unix root@8d7240ab9c47:~# ./configure root@8d7240ab9c47:~# make root@8d7240ab9c47:~# make install","title":"4.5.2 \u5b89\u88c5tcl \u5305"},{"location":"linux/nosql/redis/redis.sentinel/#453-redis","text":"root@8d7240ab9c47:~# tar xvfz redis-3.0.2.tar.gz root@8d7240ab9c47:~# cd redis-3.0.2 root@8d7240ab9c47:~# make root@8d7240ab9c47:~# cd src root@8d7240ab9c47:~# make install root@8d7240ab9c47:~# make PREFIX=/usr/local/redis install root@8d7240ab9c47:~# useradd -s /sbin/nologin redis root@8d7240ab9c47:~# mkdir /usr/local/redis/var root@8d7240ab9c47:~# chmod 777 /usr/local/redis/var/ root@8d7240ab9c47:~# mkdir -p /usr/local/redis/etc #\u653e\u7f6e\u914d\u7f6e\u6587\u4ef6\u5730\u65b9 \u6ce8\u610f \u6211\u53ea\u5217\u51fa\u5b89\u88c5\u4e86\u5176\u4e2d\u4e00\u4e2a docker\u91cc\u9762\u7684redis , tcl \uff0c\u6b64\u65f6\u5148\u505a\u4e3a\u4e3b\uff0c\u5176\u4ed6\u4e24\u4ece redis docker\u5b89\u88c5\u4e00\u6837 \u3002","title":"4.5.3 \u5b89\u88c5redis"},{"location":"linux/nosql/redis/redis.sentinel/#46","text":"","title":"4.6 \u914d\u7f6e\u4e3b\u4ece"},{"location":"linux/nosql/redis/redis.sentinel/#461","text":"Master redis.conf\u914d\u7f6e\u6587\u4ef6\u4fee\u6539 root@8d7240ab9c47:~# cat /usr/local/redis/etc/redis.conf daemonize yes # \u540e\u53f0\u8fd0\u884c pidfile \"/usr/local/redis/var/redis.pid\" # \u8fd0\u884cpid\u6587\u4ef6 port 6379 # \u7aef\u53e3 timeout 300 # \u8d85\u65f6 loglevel debug # debug\u6a21\u5f0f logfile \"/usr/local/redis/var/redis.log\" # \u65e5\u5fd7\u6587\u4ef6 databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/redis/var\" appendonly no appendfsync always bind 0.0.0.0 # \u65b9\u5f0fip\u9650\u5236 Slave1 redis.conf\u914d\u7f6e\u6587\u4ef6\u4fee\u6539 root@38b072848ccd:/# cat /usr/local/redis/etc/redis.conf daemonize yes pidfile \"/usr/local/redis/var/redis.pid\" port 6379 timeout 300 loglevel debug logfile \"/usr/local/redis/var/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/redis/var\" appendonly no appendfsync always bind 0.0.0.0 slaveof 172.17.0.2 6379 # master ip Slave2 redis.conf\u914d\u7f6e\u6587\u4ef6\u4fee\u6539 root@56c0344c59a0:/# cat /usr/local/redis/etc/redis.conf daemonize yes pidfile \"/usr/local/redis/var/redis.pid\" port 6379 timeout 300 loglevel debug logfile \"/usr/local/redis/var/redis.log\" databases 16 save 900 1 save 300 10 save 60 10000 rdbcompression yes dbfilename \"dump.rdb\" dir \"/usr/local/redis/var\" appendonly no appendfsync always bind 0.0.0.0 slaveof 172.17.0.2 6379 \u7279\u522b\u6ce8\u610f \u4e00\u5b9a\u8981\u4fee\u8fd9\u4e2a\u4e3a 0.0 . 0.0 \u5426\u5219\u5bbf\u4e3b\u673a\u8fde\u63a5\u4e0d\u5230 docker\u5bb9\u5668\u91cc\u9762\u7684redis \u542f\u52a8\u811a\u672c [root@linux-node2 init.d]# cat /etc/init.d/redis #!/bin/sh # # Simple Redis init.d script conceived to work on Linux systems # as it does use of the /proc filesystem. # chkconfig: 2345 90 10 # description: Redis is a persistent key-value database # REDISPORT=6379 EXEC=/usr/local/bin/redis-server CLIEXEC=/usr/local/bin/redis-cli PIDFILE=/var/run/redis_${REDISPORT}.pid #CONF=\"/etc/redis/${REDISPORT}.conf\" CONF=\"/usr/local/redis/etc/redis.conf\" case \"$1\" in start) if [ -f $PIDFILE ] then echo \"$PIDFILE exists, process is already running or crashed\" else echo \"Starting Redis server...\" $EXEC $CONF echo $(ps aux|grep redis|grep -v grep|grep 6379|awk '{print $2}')>$PIDFILE fi ;; stop) if [ ! -f $PIDFILE ] then echo \"$PIDFILE does not exist, process is not running\" else PID=$(cat $PIDFILE) echo \"Stopping ...\" $CLIEXEC -p $REDISPORT shutdown while [ -x /proc/${PID} ] do echo \"Waiting for Redis to shutdown ...\" sleep 1 done echo \"Redis stopped\" cd /var/run/ && rm -f redis_${REDISPORT}.pid fi ;; *) echo \"Please use start or stop as first argument\" ;; esac [root@linux-node2 init.d]# chmod +x /etc/init.d/redis","title":"4.6.1 \u4e3b\u4ece\u914d\u7f6e"},{"location":"linux/nosql/redis/redis.sentinel/#47","text":"","title":"4.7 \u542f\u52a8"},{"location":"linux/nosql/redis/redis.sentinel/#471","text":"#root@8d7240ab9c47:~# redis-server /usr/local/redis/etc/redis.conf root@8d7240ab9c47:~# /etc/init.d/redis start Starting Redis server...","title":"4.7.1 \u542f\u52a8"},{"location":"linux/nosql/redis/redis.sentinel/#472","text":"#root@8d7240ab9c47:~# redis-cli shutdown root@8d7240ab9c47:~# /etc/init.d/redis stop \u6ce8\u610f \u5176\u4ed6\u4e24\u4e2a\u4ece redis\u542f\u52a8\u65b9\u5f0f\u4e00\u6837 \u3002","title":"4.7.2 \u505c\u6b62"},{"location":"linux/nosql/redis/redis.sentinel/#48","text":"\u4fdd\u8bc1\u4e09\u53f0redis\u90fd\u542f\u52a8\u540e\uff0c\u67e5\u770b 127.0.0.1:6379> info \u3002\u3002\u3002\u3002\u3002\u3002 # Replication role:master connected_slaves:2 slave0:ip=172.17.0.6,port=6379,state=online,offset=10912,lag=0 slave1:ip=172.17.0.4,port=6379,state=online,offset=10912,lag=0 \u3002\u3002\u3002\u3002\u3002\u3002 \u6bcf\u4e2aredis\u90fd\u4f1a\u6709\u8be5info\uff0c\u53ef\u770b\u51fa\u5176\u4e2d\u6bcf\u4e2aredis\u7684\u8eab\u4efdrole\u3002\u5176\u4e2dmaster\u53ef\u4ee5\u770b\u51fa\u5b83\u7684\u4e24\u4e2aslave\u60c5\u51b5\u3002","title":"4.8 \u6d4b\u8bd5\u4e3b\u4ece"},{"location":"linux/nosql/redis/redis.sentinel/#481","text":"127.0.0.1:6379> set realcloud 1234 OK 127.0.0.1:6379> get realcloud \"1234\"","title":"4.8.1 \u4e3b\u4e0a\u8bbe\u7f6e\u4e00\u4e2a\u952e\u503c\u5bf9"},{"location":"linux/nosql/redis/redis.sentinel/#482-redis-slave1","text":"127.0.0.1:6379> get realcloud \"1234\"","title":"4.8.2 Redis slave1\u67e5\u770b"},{"location":"linux/nosql/redis/redis.sentinel/#482-redis-slave2","text":"127.0.0.1:6379> get realcloud \"1234\" \u4ece\u4e0a\u53ef\u4ee5\u770b\u51faredis\u4e00\u4e3b\u4e24\u4ece\uff0c\u5b89\u88c5\uff0c\u6d4b\u8bd5OK\u3002","title":"4.8.2 Redis slave2\u67e5\u770b"},{"location":"linux/nosql/redis/redis.sentinel/#48-sentinel","text":"\u4e09\u53f0\u673a\u5668\u7684\u914d\u7f6e\u6587\u4ef6\u90fd\u4e00\u6837\u3002","title":"4.8 \u914d\u7f6esentinel"},{"location":"linux/nosql/redis/redis.sentinel/#481-sentinel","text":"root@8d7240ab9c47:~# cat /usr/local/redis/etc/sentinel.conf port 26379 dir /usr/local/redis/var_sentinel sentinel monitor mymaster 172.17.0.2 6379 2 #\u8be5IP\u662fredis\u4e3b\u7684IP\u3002\u6839\u636e\u60c5\u51b5\u6539\u5199\u3002 sentinel down-after-milliseconds mymaster 10000 sentinel parallel-syncs mymaster 1 sentinel failover-timeout mymaster 60000 #sentinel client-reconfig-script mymaster /script/failover.sh","title":"4.8.1 \u914d\u7f6esentinel"},{"location":"linux/nosql/redis/redis.sentinel/#482-sentinel","text":"root@8d7240ab9c47:~#mkdir /usr/local/redis/var_sentinel root@8d7240ab9c47:~# redis-sentinel /usr/local/redis/etc/sentinel.conf >/usr/local/redis/var_sentinel/sentinel.log &","title":"4.8.2 \u542f\u52a8 sentinel"},{"location":"linux/nosql/redis/redis.sentinel/#483","text":"\u5728\u4e3bredis\u4e0a\u8fdb\u5165sentinel\u3002 root@8d7240ab9c47:~# redis-cli -p 26379 127.0.0.1:26379> sentinel master mymaster 1) \"name\" 2) \"mymaster\" 3) \"ip\" 4) \"172.17.0.2\" 5) \"port\" 6) \"6379\" 7) \"runid\" 8) \"eb05e2906f6e3f916fbca5f3f3e421560f2bbf21\" 9) \"flags\" 10) \"master\" 11) \"pending-commands\" 12) \"0\" 13) \"last-ping-sent\" 14) \"0\" 15) \"last-ok-ping-reply\" 16) \"451\" 17) \"last-ping-reply\" 18) \"451\" 19) \"down-after-milliseconds\" 20) \"10000\" 21) \"info-refresh\" 22) \"3492\" 23) \"role-reported\" 24) \"master\" 25) \"role-reported-time\" 26) \"5854962\" 27) \"config-epoch\" 28) \"0\" 29) \"num-slaves\" 30) \"2\" 31) \"num-other-sentinels\" 32) \"2\" 33) \"quorum\" 34) \"2\" 35) \"failover-timeout\" 36) \"60000\" 37) \"parallel-syncs\" 38) \"1\" 127.0.0.1:26379> \u6ce8\u610f redis\u7684\u9ed8\u8ba4\u7aef\u53e3\u662f6379 redis - sentinel \u9ed8\u8ba4\u7aef\u53e3\u662f 26379","title":"4.8.3 \u67e5\u770b"},{"location":"linux/nosql/redis/redis.sentinel/#49","text":"","title":"4.9 \u6545\u969c\u6a21\u62df"},{"location":"linux/nosql/redis/redis.sentinel/#491-master","text":"root@8d7240ab9c47:~# redis-cli shutdown #\u4e3b\u5b95\u673a","title":"4.9.1 master\u5b95\u673a"},{"location":"linux/nosql/redis/redis.sentinel/#492-redis","text":"root@38b072848ccd:~# redis-cli info #\u6b64\u65f6\u4e3amaster root@56c0344c59a0:~# redis-cli info","title":"4.9.2 \u67e5\u770bredis\u4e3b\u4ece\u60c5\u51b5"},{"location":"linux/nosql/redis/redis.sentinel/#493-sentinel","text":"root@38b072848ccd:~# redis-cli -p 26379 127.0.0.1:26379> sentinel master mymaster 1) \"name\" 2) \"mymaster\" 3) \"ip\" 4) \"172.17.0.4\" 5) \"port\" 6) \"6379\" \u6b64\u65f6\u5728kill\u5f53\u524d\u7684master\u3002Sentinel\u5728\u6307\u5b9a\u65f6\u95f4\u5185\u53c8\u4f17\u7b79\u51fa\u5f53\u524d\u65b0\u7684master\u3002\u5f53\u4e4b\u524d\u7684master \u53c8\u542f\u52a8\u597d\u4ee5\u540esentinel\u53c8\u4e3b\u52a8\u5c06\u4e4b\u524d\u7684master\u6dfb\u52a0\u5230\u65b0\u7684master\u4e2d\uff0c\u4f5c\u4e3aslave\u3002\u76ee\u524d\u4e3a\u6b62redis\u7684sentinel\u6d4b\u8bd5OK\u3002","title":"4.9.3 \u67e5\u770bsentinel\u60c5\u51b5"},{"location":"linux/nosql/redis/redis.sentinel_cluster/","text":"redis\u96c6\u7fa4\u5bf9\u6bd4 1. \u4ecb\u7ecd \u00b6 \u4e92\u8054\u7f51\u9ad8\u901f\u53d1\u5c55\u7684\u4eca\u5929\uff0c\u5bf9\u5e94\u7528\u7cfb\u7edf\u7684\u6297\u538b\u80fd\u529b\u8981\u6c42\u8d8a\u6765\u8d8a\u9ad8\uff0c\u4f20\u7edf\u7684\u5e94\u7528\u5c42+\u6570\u636e\u5e93\u5df2\u7ecf\u4e0d\u80fd\u6ee1\u8db3\u5f53\u524d\u7684\u9700\u8981\u3002\u6240\u4ee5\u4e00\u5927\u6279\u5185\u5b58\u5f0f\u6570\u636e\u5e93\u548cNosql\u6570\u636e\u5e93\u5e94\u8fd0\u800c\u751f\uff0c\u5176\u4e2dredis,memcache,mongodb,hbase\u7b49\u88ab\u5e7f\u6cdb\u7684\u4f7f\u7528\u6765\u63d0\u9ad8\u7cfb\u7edf\u7684\u541e\u5410\u6027\uff0c\u6240\u4ee5\u5982\u4f55\u6b63\u786e\u4f7f\u7528cache\u662f\u4f5c\u4e3a\u5f00\u53d1\u7684\u4e00\u9879\u57fa\u6280\u80fd\u3002\u672c\u6587\u4e3b\u8981\u4ecb\u7ecdRedis Sentinel \u53ca Redis Cluster\u7684\u533a\u522b\u53ca\u7528\u6cd5\uff0cRedis\u7684\u57fa\u672c\u64cd\u4f5c\u53ef\u4ee5\u81ea\u884c\u53bb\u53c2\u770b\u5176\u5b98\u65b9\u6587\u6863\u3002 \u53ef\u4ee5\u5148\u770b\u4ee5\u4e0b\u8fd9\u4e24\u4e2a\u6587\u7ae0 \u54e8\u5175: Redis_sentinel \u5206\u533a: Redis_cluster 2.\u5bf9\u6bd4 \u00b6 2.1 Redis Sentinel \u00b6 Redis-Sentinel(\u54e8\u5175\u6a21\u5f0f)\u662fRedis\u5b98\u65b9\u63a8\u8350\u7684\u9ad8\u53ef\u7528\u6027(HA)\u89e3\u51b3\u65b9\u6848\uff0c\u5f53\u7528Redis\u505aMaster-slave\u7684\u9ad8\u53ef\u7528\u65b9\u6848\u65f6\uff0c\u5047\u5982master\u5b95\u673a\u4e86\uff0cRedis\u672c\u8eab(\u5305\u62ec\u5b83\u7684\u5f88\u591a\u5ba2\u6237\u7aef)\u90fd\u6ca1\u6709\u5b9e\u73b0\u81ea\u52a8\u8fdb\u884c\u4e3b\u5907\u5207\u6362\uff0c\u800cRedis-sentinel\u672c\u8eab\u4e5f\u662f\u4e00\u4e2a\u72ec\u7acb\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u5b83\u80fd\u76d1\u63a7\u591a\u4e2amaster-slave\u96c6\u7fa4\uff0c\u53d1\u73b0master\u5b95\u673a\u540e\u80fd\u8fdb\u884c\u81ea\u884c\u5207\u6362\u3002\u5b83\u7684\u4e3b\u8981\u529f\u80fd\u6709\u4ee5\u4e0b\u51e0\u70b9\uff1a \u4e0d\u65f6\u5730\u76d1\u63a7redis\u662f\u5426\u6309\u7167\u9884\u671f\u826f\u597d\u5730\u8fd0\u884c; \u5982\u679c\u53d1\u73b0\u67d0\u4e2aredis\u8282\u70b9\u8fd0\u884c\u51fa\u73b0\u72b6\u51b5\uff0c\u80fd\u591f\u901a\u77e5\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b(\u4f8b\u5982\u5b83\u7684\u5ba2\u6237\u7aef); \u80fd\u591f\u8fdb\u884c\u81ea\u52a8\u5207\u6362\u3002\u5f53\u4e00\u4e2amaster\u8282\u70b9\u4e0d\u53ef\u7528\u65f6\uff0c\u80fd\u591f\u9009\u4e3e\u51famaster\u7684\u591a\u4e2aslave(\u5982\u679c\u6709\u8d85\u8fc7\u4e00\u4e2aslave\u7684\u8bdd)\u4e2d\u7684\u4e00\u4e2a\u6765\u4f5c\u4e3a\u65b0\u7684master,\u5176\u5b83\u7684slave\u8282\u70b9\u4f1a\u5c06\u5b83\u6240\u8ffd\u968f\u7684master\u7684\u5730\u5740\u6539\u4e3a\u88ab\u63d0\u5347\u4e3amaster\u7684slave\u7684\u65b0\u5730\u5740\u3002 Redis \u4e3b\u4ece\u6a21\u5f0f\u5982\u4e0b\u56fe\uff1a \u4ece\u4e0a\u56fe\u7247\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u4e00\u4e2amaster \u8282\u70b9\u53ef\u4ee5\u6302\u591a\u4e2aslave \uff0cRedis Sentinel \u7ba1\u7406Redis \u8282\u70b9\u7ed3\u6784\u5982\u4e0b\uff1a \u4ece\u4e0a\u56fe\u4e2d\u53ef\u4ee5\u5f97\u51faSentinel\u5176\u5b9e\u5c31\u662fClient\u548cRedis\u4e4b\u95f4\u7684\u6865\u6881\uff0c\u6240\u6709\u7684\u5ba2\u6237\u7aef\u90fd\u901a\u8fc7Sentinel\u7a0b\u5e8f\u83b7\u53d6Redis\u7684Master\u670d\u52a1\u3002\u9996\u5148Sentinel\u662f\u96c6\u7fa4\u90e8\u7f72\u7684\uff0cClient\u53ef\u4ee5\u94fe\u63a5\u4efb\u4f55\u4e00\u4e2aSentinel\u670d\u52a1\u6240\u83b7\u7684\u7ed3\u679c\u90fd\u662f\u4e00\u81f4\u7684\u3002\u5176\u6b21\uff0c\u6240\u6709\u7684Sentinel\u670d\u52a1\u90fd\u4f1a\u5bf9Redis\u7684\u4e3b\u4ece\u670d\u52a1\u8fdb\u884c\u76d1\u63a7\uff0c\u5f53\u76d1\u63a7\u5230Master\u670d\u52a1\u65e0\u54cd\u5e94\u7684\u65f6\u5019\uff0cSentinel\u5185\u90e8\u8fdb\u884c\u4ef2\u88c1\uff0c\u4ece\u6240\u6709\u7684 Slave\u9009\u4e3e\u51fa\u4e00\u4e2a\u505a\u4e3a\u65b0\u7684Master\u3002\u5e76\u4e14\u628a\u5176\u4ed6\u7684slave\u4f5c\u4e3a\u65b0\u7684Master\u7684Slave\u3002\u6700\u540e\u901a\u77e5\u6240\u6709\u7684\u5ba2\u6237\u7aef\u65b0\u7684Master\u670d\u52a1\u5730\u5740\u3002\u5982\u679c\u65e7\u7684Master\u670d\u52a1\u5730\u5740\u91cd\u65b0\u542f\u52a8\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u5b83\u5c06\u88ab\u8bbe\u7f6e\u4e3aSlave\u670d\u52a1\u3002 Sentinel \u53ef\u4ee5\u7ba1\u7406master-slave\u8282\u70b9\uff0c\u770b\u4f3cRedis\u7684\u7a33\u5b9a\u6027\u5f97\u5230\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684\u4fdd\u969c\u3002\u4f46\u662f\u5982\u679cSentinel\u662f\u5355\u8282\u70b9\u7684\u8bdd\uff0c\u5982\u679cSentinel\u5b95\u673a\u4e86\uff0c\u90a3master-slave\u8fd9\u79cd\u6a21\u5f0f\u5c31\u4e0d\u80fd\u53d1\u6325\u5176\u4f5c\u7528\u4e86\u3002\u5e78\u597dSentinel\u4e5f\u652f\u6301\u96c6\u7fa4\u6a21\u5f0f\uff0cSentinel\u7684\u96c6\u7fa4\u6a21\u5f0f\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u4e2a\u597d\u5904\uff1a \u5373\u4f7f\u6709\u4e00\u4e9bsentinel\u8fdb\u7a0b\u5b95\u6389\u4e86\uff0c\u4f9d\u7136\u53ef\u4ee5\u8fdb\u884credis\u96c6\u7fa4\u7684\u4e3b\u5907\u5207\u6362\uff1b \u5982\u679c\u53ea\u6709\u4e00\u4e2asentinel\u8fdb\u7a0b\uff0c\u5982\u679c\u8fd9\u4e2a\u8fdb\u7a0b\u8fd0\u884c\u51fa\u9519\uff0c\u6216\u8005\u662f\u7f51\u7edc\u5835\u585e\uff0c\u90a3\u4e48\u5c06\u65e0\u6cd5\u5b9e\u73b0redis\u96c6\u7fa4\u7684\u4e3b\u5907\u5207\u6362\uff08\u5355\u70b9\u95ee\u9898\uff09; \u5982\u679c\u6709\u591a\u4e2asentinel\uff0credis\u7684\u5ba2\u6237\u7aef\u53ef\u4ee5\u968f\u610f\u5730\u8fde\u63a5\u4efb\u610f\u4e00\u4e2asentinel\u6765\u83b7\u5f97\u5173\u4e8eredis\u96c6\u7fa4\u4e2d\u7684\u4fe1\u606f\u3002 Redis Sentinel \u96c6\u7fa4\u6a21\u5f0f\u53ef\u4ee5\u589e\u5f3a\u6574\u4e2aRedis\u96c6\u7fa4\u7684\u7a33\u5b9a\u6027\u4e0e\u53ef\u9760\u6027\uff0c\u4f46\u662f\u5f53\u67d0\u4e2a\u8282\u70b9\u7684master\u8282\u70b9\u6302\u4e86\u8981\u91cd\u65b0\u9009\u53d6\u51fa\u65b0\u7684master\u8282\u70b9\u65f6\uff0cRedis Sentinel\u7684\u96c6\u7fa4\u6a21\u5f0f\u9009\u53d6\u7684\u590d\u6742\u5ea6\u663e\u7136\u9ad8\u4e8e\u5355\u70b9\u7684Redis Sentinel \u6a21\u5f0f\uff0c\u6b64\u65f6\u9700\u8981\u4e00\u4e2a\u6bd4\u8f83\u9760\u8c31\u7684\u9009\u53d6\u7b97\u6cd5\u3002\u4e0b\u9762\u5c31\u6765\u4ecb\u7ecdRedis Sentinel \u96c6\u7fa4\u6a21\u5f0f\u7684 \u201c\u4ef2\u88c1\u4f1a\u201d(\u591a\u4e2aRedis Sentinel\u5171\u540c\u5546\u91cf\u8c01\u662fRedis \u7684 master\u8282\u70b9) Redis Sentinel \u96c6\u7fa4\u6a21\u5f0f\u7684 \u201c\u4ef2\u88c1\u4f1a\u201d \u5f53\u4e00\u4e2amaster\u88absentinel\u96c6\u7fa4\u76d1\u63a7\u65f6\uff0c\u9700\u8981\u4e3a\u5b83\u6307\u5b9a\u4e00\u4e2a\u53c2\u6570\uff0c\u8fd9\u4e2a\u53c2\u6570\u6307\u5b9a\u4e86\u5f53\u9700\u8981\u5224\u51b3master\u4e3a\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u8fdb\u884cfailover\u65f6\uff0c\u6240\u9700\u8981\u7684sentinel\u6570\u91cf\uff0c\u672c\u6587\u4e2d\u6211\u4eec\u6682\u65f6\u79f0\u8fd9\u4e2a\u53c2\u6570\u4e3a\u7968\u6570,\u4e0d\u8fc7\uff0c\u5f53failover\u4e3b\u5907\u5207\u6362\u771f\u6b63\u88ab\u89e6\u53d1\u540e\uff0cfailover\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u8fdb\u884c\uff0c\u8fd8\u9700\u8981sentinel\u4e2d\u7684\u5927\u591a\u6570sentinel\u6388\u6743\u540e\u624d\u53ef\u4ee5\u8fdb\u884cfailover\u3002\u5f53ODOWN\u65f6\uff0cfailover\u88ab\u89e6\u53d1\u3002failover\u4e00\u65e6\u88ab\u89e6\u53d1\uff0c\u5c1d\u8bd5\u53bb\u8fdb\u884cfailover\u7684sentinel\u4f1a\u53bb\u83b7\u5f97\u201c\u5927\u591a\u6570\u201dsentinel\u7684\u6388\u6743\uff08\u5982\u679c\u7968\u6570\u6bd4\u5927\u591a\u6570\u8fd8\u8981\u5927\u7684\u65f6\u5019\uff0c\u5219\u8be2\u95ee\u66f4\u591a\u7684sentinel)\u8fd9\u4e2a\u533a\u522b\u770b\u8d77\u6765\u5f88\u5fae\u5999\uff0c\u4f46\u662f\u5f88\u5bb9\u6613\u7406\u89e3\u548c\u4f7f\u7528\u3002\u4f8b\u5982\uff0c\u96c6\u7fa4\u4e2d\u67095\u4e2asentinel\uff0c\u7968\u6570\u88ab\u8bbe\u7f6e\u4e3a2\uff0c\u5f532\u4e2asentinel\u8ba4\u4e3a\u4e00\u4e2amaster\u5df2\u7ecf\u4e0d\u53ef\u7528\u4e86\u4ee5\u540e\uff0c\u5c06\u4f1a\u89e6\u53d1failover\uff0c\u4f46\u662f\uff0c\u8fdb\u884cfailover\u7684\u90a3\u4e2asentinel\u5fc5\u987b\u5148\u83b7\u5f97\u81f3\u5c113\u4e2asentinel\u7684\u6388\u6743\u624d\u53ef\u4ee5\u5b9e\u884cfailover\u3002\u5982\u679c\u7968\u6570\u88ab\u8bbe\u7f6e\u4e3a5\uff0c\u8981\u8fbe\u5230ODOWN\u72b6\u6001\uff0c\u5fc5\u987b\u6240\u67095\u4e2asentinel\u90fd\u4e3b\u89c2\u8ba4\u4e3amaster\u4e3a\u4e0d\u53ef\u7528\uff0c\u8981\u8fdb\u884cfailover\uff0c\u90a3\u4e48\u5f97\u83b7\u5f97\u6240\u67095\u4e2asentinel\u7684\u6388\u6743\u3002 2.2 Redis Cluster \u00b6 \u4f7f\u7528Redis Sentinel \u6a21\u5f0f\u67b6\u6784\u7684\u7f13\u5b58\u4f53\u7cfb\uff0c\u5728\u4f7f\u7528\u7684\u8fc7\u7a0b\u4e2d\uff0c\u968f\u7740\u4e1a\u52a1\u7684\u589e\u52a0\u4e0d\u53ef\u907f\u514d\u7684\u8981\u5bf9Redis\u8fdb\u884c\u6269\u5bb9\uff0c\u719f\u77e5\u7684\u6269\u5bb9\u65b9\u5f0f\u6709\u4e24\u79cd\uff0c\u4e00\u79cd\u662f\u5782\u76f4\u6269\u5bb9\uff0c\u4e00\u79cd\u662f\u6c34\u5e73\u6269\u5bb9\u3002\u5782\u76f4\u6269\u5bb9\u8868\u793a\u901a\u8fc7\u52a0\u5185\u5b58\u65b9\u5f0f\u6765\u589e\u52a0\u6574\u4e2a\u7f13\u5b58\u4f53\u7cfb\u7684\u5bb9\u91cf\u6bd4\u5982\u5c06\u7f13\u5b58\u5927\u5c0f\u75312G\u8c03\u6574\u52304G,\u8fd9\u79cd\u6269\u5bb9\u4e0d\u9700\u8981\u5e94\u7528\u7a0b\u5e8f\u652f\u6301\uff1b\u6c34\u5e73\u6269\u5bb9\u8868\u793a\u8868\u793a\u901a\u8fc7\u589e\u52a0\u8282\u70b9\u7684\u65b9\u5f0f\u6765\u589e\u52a0\u6574\u4e2a\u7f13\u5b58\u4f53\u7cfb\u7684\u5bb9\u91cf\u6bd4\u5982\u672c\u6765\u67091\u4e2a\u8282\u70b9\u53d8\u62102\u4e2a\u8282\u70b9\uff0c\u8fd9\u79cd\u6269\u5bb9\u65b9\u5f0f\u9700\u8981\u5e94\u7528\u7a0b\u5e8f\u652f\u6301\u3002\u5782\u76f4\u6269\u5bb9\u770b\u4f3c\u6700\u4fbf\u6377\u7684\u6269\u5bb9\uff0c\u4f46\u662f\u53d7\u5230\u673a\u5668\u7684\u9650\u5236\uff0c\u4e00\u4e2a\u673a\u5668\u7684\u5185\u5b58\u662f\u6709\u9650\u7684\uff0c\u6240\u4ee5\u5782\u76f4\u6269\u5bb9\u5230\u4e00\u5b9a\u9636\u6bb5\u4e0d\u53ef\u907f\u514d\u7684\u8981\u8fdb\u884c\u6c34\u5e73\u6269\u5bb9\uff0c\u5982\u679c\u9884\u7559\u51fa\u5f88\u591a\u8282\u70b9\u611f\u89c9\u53c8\u662f\u5bf9\u8d44\u6e90\u7684\u4e00\u79cd\u6d6a\u8d39\u56e0\u4e3a\u5bf9\u4e1a\u52a1\u7684\u53d1\u5c55\u8d8b\u52bf\u5f88\u5feb\u9884\u6d4b\u3002Redis Sentinel \u6c34\u5e73\u6269\u5bb9\u4e00\u76f4\u90fd\u662f\u7a0b\u5e8f\u733f\u5fc3\u4e2d\u7684\u75db\u70b9\uff0c\u56e0\u4e3a\u6c34\u5e73\u6269\u5bb9\u7275\u6d89\u5230\u6570\u636e\u7684\u8fc1\u79fb\u3002\u8fc1\u79fb\u8fc7\u7a0b\u4e00\u65b9\u9762\u8981\u4fdd\u8bc1\u81ea\u5df1\u7684\u4e1a\u52a1\u662f\u53ef\u7528\u7684\uff0c\u4e00\u65b9\u9762\u8981\u4fdd\u8bc1\u5c3d\u91cf\u4e0d\u4e22\u5931\u6570\u636e\u6240\u4ee5\u6570\u636e\u80fd\u4e0d\u8fc1\u79fb\u5c31\u5c3d\u91cf\u4e0d\u8fc1\u79fb\u3002\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0cRedis Cluster\u5c31\u5e94\u8fd0\u800c\u751f\u4e86\uff0c\u4e0b\u9762\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0bRedisCluster\u3002 Redis Cluster\u662fRedis\u7684\u5206\u5e03\u5f0f\u89e3\u51b3\u65b9\u6848\uff0c\u5728Redis 3.0\u7248\u672c\u6b63\u5f0f\u63a8\u51fa\u7684\uff0c\u6709\u6548\u89e3\u51b3\u4e86Redis\u5206\u5e03\u5f0f\u65b9\u9762\u7684\u9700\u6c42\u3002\u5f53\u9047\u5230\u5355\u673a\u5185\u5b58\u3001\u5e76\u53d1\u3001\u6d41\u91cf\u7b49\u74f6\u9888\u65f6\uff0c\u53ef\u4ee5\u91c7\u7528Cluster\u67b6\u6784\u8fbe\u5230\u8d1f\u8f7d\u5747\u8861\u7684\u76ee\u7684\u3002\u5206\u5e03\u5f0f\u96c6\u7fa4\u9996\u8981\u89e3\u51b3\u628a\u6574\u4e2a\u6570\u636e\u96c6\u6309\u7167\u5206\u533a\u89c4\u5219\u6620\u5c04\u5230\u591a\u4e2a\u8282\u70b9\u7684\u95ee\u9898\uff0c\u5373\u628a\u6570\u636e\u96c6\u5212\u5206\u5230\u591a\u4e2a\u8282\u70b9\u4e0a\uff0c\u6bcf\u4e2a\u8282\u70b9\u8d1f\u8d23\u6574\u4e2a\u6570\u636e\u7684\u4e00\u4e2a\u5b50\u96c6\u3002Redis Cluster\u91c7\u7528\u54c8\u5e0c\u5206\u533a\u89c4\u5219\u4e2d\u7684\u865a\u62df\u69fd\u5206\u533a\u3002\u865a\u62df\u69fd\u5206\u533a\u5de7\u5999\u5730\u4f7f\u7528\u4e86\u54c8\u5e0c\u7a7a\u95f4\uff0c\u4f7f\u7528\u5206\u6563\u5ea6\u826f\u597d\u7684\u54c8\u5e0c\u51fd\u6570\u628a\u6240\u6709\u7684\u6570\u636e\u6620\u5c04\u5230\u4e00\u4e2a\u56fa\u5b9a\u8303\u56f4\u5185\u7684\u6574\u6570\u96c6\u5408\uff0c\u6574\u6570\u5b9a\u4e49\u4e3a\u69fd\uff08slot\uff09\u3002Redis Cluster\u69fd\u7684\u8303\u56f4\u662f0 \uff5e 16383\u3002\u69fd\u662f\u96c6\u7fa4\u5185\u6570\u636e\u7ba1\u7406\u548c\u8fc1\u79fb\u7684\u57fa\u672c\u5355\u4f4d\u3002\u91c7\u7528\u5927\u8303\u56f4\u7684\u69fd\u7684\u4e3b\u8981\u76ee\u7684\u662f\u4e3a\u4e86\u65b9\u4fbf\u6570\u636e\u7684\u62c6\u5206\u548c\u96c6\u7fa4\u7684\u6269\u5c55\uff0c\u6bcf\u4e2a\u8282\u70b9\u8d1f\u8d23\u4e00\u5b9a\u6570\u91cf\u7684\u69fd\u3002Redis Cluster\u91c7\u7528\u865a\u62df\u69fd\u5206\u533a\uff0c\u6240\u6709\u7684\u952e\u6839\u636e\u54c8\u5e0c\u51fd\u6570\u6620\u5c04\u52300 \uff5e 16383\uff0c\u8ba1\u7b97\u516c\u5f0f\uff1aslot = CRC16(key)&16383\u3002\u6bcf\u4e00\u4e2a\u5b9e\u8282\u70b9\u8d1f\u8d23\u7ef4\u62a4\u4e00\u90e8\u5206\u69fd\u4ee5\u53ca\u69fd\u6240\u6620\u5c04\u7684\u952e\u503c\u6570\u636e\u3002\u4e0b\u56fe\u5c55\u73b0\u4e00\u4e2a\u4e94\u4e2a\u8282\u70b9\u6784\u6210\u7684\u96c6\u7fa4\uff0c\u6bcf\u4e2a\u8282\u70b9\u5e73\u5747\u5927\u7ea6\u8d1f\u8d233276\u4e2a\u69fd\uff0c\u4ee5\u53ca\u901a\u8fc7\u8ba1\u7b97\u516c\u5f0f\u6620\u5c04\u5230\u5bf9\u5e94\u8282\u70b9\u7684\u5bf9\u5e94\u69fd\u7684\u8fc7\u7a0b\u3002 Redis Cluster\u8282\u70b9\u76f8\u4e92\u4e4b\u524d\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a","title":"09. redis \u96c6\u7fa4"},{"location":"linux/nosql/redis/redis.sentinel_cluster/#1","text":"\u4e92\u8054\u7f51\u9ad8\u901f\u53d1\u5c55\u7684\u4eca\u5929\uff0c\u5bf9\u5e94\u7528\u7cfb\u7edf\u7684\u6297\u538b\u80fd\u529b\u8981\u6c42\u8d8a\u6765\u8d8a\u9ad8\uff0c\u4f20\u7edf\u7684\u5e94\u7528\u5c42+\u6570\u636e\u5e93\u5df2\u7ecf\u4e0d\u80fd\u6ee1\u8db3\u5f53\u524d\u7684\u9700\u8981\u3002\u6240\u4ee5\u4e00\u5927\u6279\u5185\u5b58\u5f0f\u6570\u636e\u5e93\u548cNosql\u6570\u636e\u5e93\u5e94\u8fd0\u800c\u751f\uff0c\u5176\u4e2dredis,memcache,mongodb,hbase\u7b49\u88ab\u5e7f\u6cdb\u7684\u4f7f\u7528\u6765\u63d0\u9ad8\u7cfb\u7edf\u7684\u541e\u5410\u6027\uff0c\u6240\u4ee5\u5982\u4f55\u6b63\u786e\u4f7f\u7528cache\u662f\u4f5c\u4e3a\u5f00\u53d1\u7684\u4e00\u9879\u57fa\u6280\u80fd\u3002\u672c\u6587\u4e3b\u8981\u4ecb\u7ecdRedis Sentinel \u53ca Redis Cluster\u7684\u533a\u522b\u53ca\u7528\u6cd5\uff0cRedis\u7684\u57fa\u672c\u64cd\u4f5c\u53ef\u4ee5\u81ea\u884c\u53bb\u53c2\u770b\u5176\u5b98\u65b9\u6587\u6863\u3002 \u53ef\u4ee5\u5148\u770b\u4ee5\u4e0b\u8fd9\u4e24\u4e2a\u6587\u7ae0 \u54e8\u5175: Redis_sentinel \u5206\u533a: Redis_cluster","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.sentinel_cluster/#2","text":"","title":"2.\u5bf9\u6bd4"},{"location":"linux/nosql/redis/redis.sentinel_cluster/#21-redis-sentinel","text":"Redis-Sentinel(\u54e8\u5175\u6a21\u5f0f)\u662fRedis\u5b98\u65b9\u63a8\u8350\u7684\u9ad8\u53ef\u7528\u6027(HA)\u89e3\u51b3\u65b9\u6848\uff0c\u5f53\u7528Redis\u505aMaster-slave\u7684\u9ad8\u53ef\u7528\u65b9\u6848\u65f6\uff0c\u5047\u5982master\u5b95\u673a\u4e86\uff0cRedis\u672c\u8eab(\u5305\u62ec\u5b83\u7684\u5f88\u591a\u5ba2\u6237\u7aef)\u90fd\u6ca1\u6709\u5b9e\u73b0\u81ea\u52a8\u8fdb\u884c\u4e3b\u5907\u5207\u6362\uff0c\u800cRedis-sentinel\u672c\u8eab\u4e5f\u662f\u4e00\u4e2a\u72ec\u7acb\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u5b83\u80fd\u76d1\u63a7\u591a\u4e2amaster-slave\u96c6\u7fa4\uff0c\u53d1\u73b0master\u5b95\u673a\u540e\u80fd\u8fdb\u884c\u81ea\u884c\u5207\u6362\u3002\u5b83\u7684\u4e3b\u8981\u529f\u80fd\u6709\u4ee5\u4e0b\u51e0\u70b9\uff1a \u4e0d\u65f6\u5730\u76d1\u63a7redis\u662f\u5426\u6309\u7167\u9884\u671f\u826f\u597d\u5730\u8fd0\u884c; \u5982\u679c\u53d1\u73b0\u67d0\u4e2aredis\u8282\u70b9\u8fd0\u884c\u51fa\u73b0\u72b6\u51b5\uff0c\u80fd\u591f\u901a\u77e5\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b(\u4f8b\u5982\u5b83\u7684\u5ba2\u6237\u7aef); \u80fd\u591f\u8fdb\u884c\u81ea\u52a8\u5207\u6362\u3002\u5f53\u4e00\u4e2amaster\u8282\u70b9\u4e0d\u53ef\u7528\u65f6\uff0c\u80fd\u591f\u9009\u4e3e\u51famaster\u7684\u591a\u4e2aslave(\u5982\u679c\u6709\u8d85\u8fc7\u4e00\u4e2aslave\u7684\u8bdd)\u4e2d\u7684\u4e00\u4e2a\u6765\u4f5c\u4e3a\u65b0\u7684master,\u5176\u5b83\u7684slave\u8282\u70b9\u4f1a\u5c06\u5b83\u6240\u8ffd\u968f\u7684master\u7684\u5730\u5740\u6539\u4e3a\u88ab\u63d0\u5347\u4e3amaster\u7684slave\u7684\u65b0\u5730\u5740\u3002 Redis \u4e3b\u4ece\u6a21\u5f0f\u5982\u4e0b\u56fe\uff1a \u4ece\u4e0a\u56fe\u7247\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u4e00\u4e2amaster \u8282\u70b9\u53ef\u4ee5\u6302\u591a\u4e2aslave \uff0cRedis Sentinel \u7ba1\u7406Redis \u8282\u70b9\u7ed3\u6784\u5982\u4e0b\uff1a \u4ece\u4e0a\u56fe\u4e2d\u53ef\u4ee5\u5f97\u51faSentinel\u5176\u5b9e\u5c31\u662fClient\u548cRedis\u4e4b\u95f4\u7684\u6865\u6881\uff0c\u6240\u6709\u7684\u5ba2\u6237\u7aef\u90fd\u901a\u8fc7Sentinel\u7a0b\u5e8f\u83b7\u53d6Redis\u7684Master\u670d\u52a1\u3002\u9996\u5148Sentinel\u662f\u96c6\u7fa4\u90e8\u7f72\u7684\uff0cClient\u53ef\u4ee5\u94fe\u63a5\u4efb\u4f55\u4e00\u4e2aSentinel\u670d\u52a1\u6240\u83b7\u7684\u7ed3\u679c\u90fd\u662f\u4e00\u81f4\u7684\u3002\u5176\u6b21\uff0c\u6240\u6709\u7684Sentinel\u670d\u52a1\u90fd\u4f1a\u5bf9Redis\u7684\u4e3b\u4ece\u670d\u52a1\u8fdb\u884c\u76d1\u63a7\uff0c\u5f53\u76d1\u63a7\u5230Master\u670d\u52a1\u65e0\u54cd\u5e94\u7684\u65f6\u5019\uff0cSentinel\u5185\u90e8\u8fdb\u884c\u4ef2\u88c1\uff0c\u4ece\u6240\u6709\u7684 Slave\u9009\u4e3e\u51fa\u4e00\u4e2a\u505a\u4e3a\u65b0\u7684Master\u3002\u5e76\u4e14\u628a\u5176\u4ed6\u7684slave\u4f5c\u4e3a\u65b0\u7684Master\u7684Slave\u3002\u6700\u540e\u901a\u77e5\u6240\u6709\u7684\u5ba2\u6237\u7aef\u65b0\u7684Master\u670d\u52a1\u5730\u5740\u3002\u5982\u679c\u65e7\u7684Master\u670d\u52a1\u5730\u5740\u91cd\u65b0\u542f\u52a8\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u5b83\u5c06\u88ab\u8bbe\u7f6e\u4e3aSlave\u670d\u52a1\u3002 Sentinel \u53ef\u4ee5\u7ba1\u7406master-slave\u8282\u70b9\uff0c\u770b\u4f3cRedis\u7684\u7a33\u5b9a\u6027\u5f97\u5230\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684\u4fdd\u969c\u3002\u4f46\u662f\u5982\u679cSentinel\u662f\u5355\u8282\u70b9\u7684\u8bdd\uff0c\u5982\u679cSentinel\u5b95\u673a\u4e86\uff0c\u90a3master-slave\u8fd9\u79cd\u6a21\u5f0f\u5c31\u4e0d\u80fd\u53d1\u6325\u5176\u4f5c\u7528\u4e86\u3002\u5e78\u597dSentinel\u4e5f\u652f\u6301\u96c6\u7fa4\u6a21\u5f0f\uff0cSentinel\u7684\u96c6\u7fa4\u6a21\u5f0f\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u4e2a\u597d\u5904\uff1a \u5373\u4f7f\u6709\u4e00\u4e9bsentinel\u8fdb\u7a0b\u5b95\u6389\u4e86\uff0c\u4f9d\u7136\u53ef\u4ee5\u8fdb\u884credis\u96c6\u7fa4\u7684\u4e3b\u5907\u5207\u6362\uff1b \u5982\u679c\u53ea\u6709\u4e00\u4e2asentinel\u8fdb\u7a0b\uff0c\u5982\u679c\u8fd9\u4e2a\u8fdb\u7a0b\u8fd0\u884c\u51fa\u9519\uff0c\u6216\u8005\u662f\u7f51\u7edc\u5835\u585e\uff0c\u90a3\u4e48\u5c06\u65e0\u6cd5\u5b9e\u73b0redis\u96c6\u7fa4\u7684\u4e3b\u5907\u5207\u6362\uff08\u5355\u70b9\u95ee\u9898\uff09; \u5982\u679c\u6709\u591a\u4e2asentinel\uff0credis\u7684\u5ba2\u6237\u7aef\u53ef\u4ee5\u968f\u610f\u5730\u8fde\u63a5\u4efb\u610f\u4e00\u4e2asentinel\u6765\u83b7\u5f97\u5173\u4e8eredis\u96c6\u7fa4\u4e2d\u7684\u4fe1\u606f\u3002 Redis Sentinel \u96c6\u7fa4\u6a21\u5f0f\u53ef\u4ee5\u589e\u5f3a\u6574\u4e2aRedis\u96c6\u7fa4\u7684\u7a33\u5b9a\u6027\u4e0e\u53ef\u9760\u6027\uff0c\u4f46\u662f\u5f53\u67d0\u4e2a\u8282\u70b9\u7684master\u8282\u70b9\u6302\u4e86\u8981\u91cd\u65b0\u9009\u53d6\u51fa\u65b0\u7684master\u8282\u70b9\u65f6\uff0cRedis Sentinel\u7684\u96c6\u7fa4\u6a21\u5f0f\u9009\u53d6\u7684\u590d\u6742\u5ea6\u663e\u7136\u9ad8\u4e8e\u5355\u70b9\u7684Redis Sentinel \u6a21\u5f0f\uff0c\u6b64\u65f6\u9700\u8981\u4e00\u4e2a\u6bd4\u8f83\u9760\u8c31\u7684\u9009\u53d6\u7b97\u6cd5\u3002\u4e0b\u9762\u5c31\u6765\u4ecb\u7ecdRedis Sentinel \u96c6\u7fa4\u6a21\u5f0f\u7684 \u201c\u4ef2\u88c1\u4f1a\u201d(\u591a\u4e2aRedis Sentinel\u5171\u540c\u5546\u91cf\u8c01\u662fRedis \u7684 master\u8282\u70b9) Redis Sentinel \u96c6\u7fa4\u6a21\u5f0f\u7684 \u201c\u4ef2\u88c1\u4f1a\u201d \u5f53\u4e00\u4e2amaster\u88absentinel\u96c6\u7fa4\u76d1\u63a7\u65f6\uff0c\u9700\u8981\u4e3a\u5b83\u6307\u5b9a\u4e00\u4e2a\u53c2\u6570\uff0c\u8fd9\u4e2a\u53c2\u6570\u6307\u5b9a\u4e86\u5f53\u9700\u8981\u5224\u51b3master\u4e3a\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u8fdb\u884cfailover\u65f6\uff0c\u6240\u9700\u8981\u7684sentinel\u6570\u91cf\uff0c\u672c\u6587\u4e2d\u6211\u4eec\u6682\u65f6\u79f0\u8fd9\u4e2a\u53c2\u6570\u4e3a\u7968\u6570,\u4e0d\u8fc7\uff0c\u5f53failover\u4e3b\u5907\u5207\u6362\u771f\u6b63\u88ab\u89e6\u53d1\u540e\uff0cfailover\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u8fdb\u884c\uff0c\u8fd8\u9700\u8981sentinel\u4e2d\u7684\u5927\u591a\u6570sentinel\u6388\u6743\u540e\u624d\u53ef\u4ee5\u8fdb\u884cfailover\u3002\u5f53ODOWN\u65f6\uff0cfailover\u88ab\u89e6\u53d1\u3002failover\u4e00\u65e6\u88ab\u89e6\u53d1\uff0c\u5c1d\u8bd5\u53bb\u8fdb\u884cfailover\u7684sentinel\u4f1a\u53bb\u83b7\u5f97\u201c\u5927\u591a\u6570\u201dsentinel\u7684\u6388\u6743\uff08\u5982\u679c\u7968\u6570\u6bd4\u5927\u591a\u6570\u8fd8\u8981\u5927\u7684\u65f6\u5019\uff0c\u5219\u8be2\u95ee\u66f4\u591a\u7684sentinel)\u8fd9\u4e2a\u533a\u522b\u770b\u8d77\u6765\u5f88\u5fae\u5999\uff0c\u4f46\u662f\u5f88\u5bb9\u6613\u7406\u89e3\u548c\u4f7f\u7528\u3002\u4f8b\u5982\uff0c\u96c6\u7fa4\u4e2d\u67095\u4e2asentinel\uff0c\u7968\u6570\u88ab\u8bbe\u7f6e\u4e3a2\uff0c\u5f532\u4e2asentinel\u8ba4\u4e3a\u4e00\u4e2amaster\u5df2\u7ecf\u4e0d\u53ef\u7528\u4e86\u4ee5\u540e\uff0c\u5c06\u4f1a\u89e6\u53d1failover\uff0c\u4f46\u662f\uff0c\u8fdb\u884cfailover\u7684\u90a3\u4e2asentinel\u5fc5\u987b\u5148\u83b7\u5f97\u81f3\u5c113\u4e2asentinel\u7684\u6388\u6743\u624d\u53ef\u4ee5\u5b9e\u884cfailover\u3002\u5982\u679c\u7968\u6570\u88ab\u8bbe\u7f6e\u4e3a5\uff0c\u8981\u8fbe\u5230ODOWN\u72b6\u6001\uff0c\u5fc5\u987b\u6240\u67095\u4e2asentinel\u90fd\u4e3b\u89c2\u8ba4\u4e3amaster\u4e3a\u4e0d\u53ef\u7528\uff0c\u8981\u8fdb\u884cfailover\uff0c\u90a3\u4e48\u5f97\u83b7\u5f97\u6240\u67095\u4e2asentinel\u7684\u6388\u6743\u3002","title":"2.1 Redis Sentinel"},{"location":"linux/nosql/redis/redis.sentinel_cluster/#22-redis-cluster","text":"\u4f7f\u7528Redis Sentinel \u6a21\u5f0f\u67b6\u6784\u7684\u7f13\u5b58\u4f53\u7cfb\uff0c\u5728\u4f7f\u7528\u7684\u8fc7\u7a0b\u4e2d\uff0c\u968f\u7740\u4e1a\u52a1\u7684\u589e\u52a0\u4e0d\u53ef\u907f\u514d\u7684\u8981\u5bf9Redis\u8fdb\u884c\u6269\u5bb9\uff0c\u719f\u77e5\u7684\u6269\u5bb9\u65b9\u5f0f\u6709\u4e24\u79cd\uff0c\u4e00\u79cd\u662f\u5782\u76f4\u6269\u5bb9\uff0c\u4e00\u79cd\u662f\u6c34\u5e73\u6269\u5bb9\u3002\u5782\u76f4\u6269\u5bb9\u8868\u793a\u901a\u8fc7\u52a0\u5185\u5b58\u65b9\u5f0f\u6765\u589e\u52a0\u6574\u4e2a\u7f13\u5b58\u4f53\u7cfb\u7684\u5bb9\u91cf\u6bd4\u5982\u5c06\u7f13\u5b58\u5927\u5c0f\u75312G\u8c03\u6574\u52304G,\u8fd9\u79cd\u6269\u5bb9\u4e0d\u9700\u8981\u5e94\u7528\u7a0b\u5e8f\u652f\u6301\uff1b\u6c34\u5e73\u6269\u5bb9\u8868\u793a\u8868\u793a\u901a\u8fc7\u589e\u52a0\u8282\u70b9\u7684\u65b9\u5f0f\u6765\u589e\u52a0\u6574\u4e2a\u7f13\u5b58\u4f53\u7cfb\u7684\u5bb9\u91cf\u6bd4\u5982\u672c\u6765\u67091\u4e2a\u8282\u70b9\u53d8\u62102\u4e2a\u8282\u70b9\uff0c\u8fd9\u79cd\u6269\u5bb9\u65b9\u5f0f\u9700\u8981\u5e94\u7528\u7a0b\u5e8f\u652f\u6301\u3002\u5782\u76f4\u6269\u5bb9\u770b\u4f3c\u6700\u4fbf\u6377\u7684\u6269\u5bb9\uff0c\u4f46\u662f\u53d7\u5230\u673a\u5668\u7684\u9650\u5236\uff0c\u4e00\u4e2a\u673a\u5668\u7684\u5185\u5b58\u662f\u6709\u9650\u7684\uff0c\u6240\u4ee5\u5782\u76f4\u6269\u5bb9\u5230\u4e00\u5b9a\u9636\u6bb5\u4e0d\u53ef\u907f\u514d\u7684\u8981\u8fdb\u884c\u6c34\u5e73\u6269\u5bb9\uff0c\u5982\u679c\u9884\u7559\u51fa\u5f88\u591a\u8282\u70b9\u611f\u89c9\u53c8\u662f\u5bf9\u8d44\u6e90\u7684\u4e00\u79cd\u6d6a\u8d39\u56e0\u4e3a\u5bf9\u4e1a\u52a1\u7684\u53d1\u5c55\u8d8b\u52bf\u5f88\u5feb\u9884\u6d4b\u3002Redis Sentinel \u6c34\u5e73\u6269\u5bb9\u4e00\u76f4\u90fd\u662f\u7a0b\u5e8f\u733f\u5fc3\u4e2d\u7684\u75db\u70b9\uff0c\u56e0\u4e3a\u6c34\u5e73\u6269\u5bb9\u7275\u6d89\u5230\u6570\u636e\u7684\u8fc1\u79fb\u3002\u8fc1\u79fb\u8fc7\u7a0b\u4e00\u65b9\u9762\u8981\u4fdd\u8bc1\u81ea\u5df1\u7684\u4e1a\u52a1\u662f\u53ef\u7528\u7684\uff0c\u4e00\u65b9\u9762\u8981\u4fdd\u8bc1\u5c3d\u91cf\u4e0d\u4e22\u5931\u6570\u636e\u6240\u4ee5\u6570\u636e\u80fd\u4e0d\u8fc1\u79fb\u5c31\u5c3d\u91cf\u4e0d\u8fc1\u79fb\u3002\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0cRedis Cluster\u5c31\u5e94\u8fd0\u800c\u751f\u4e86\uff0c\u4e0b\u9762\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0bRedisCluster\u3002 Redis Cluster\u662fRedis\u7684\u5206\u5e03\u5f0f\u89e3\u51b3\u65b9\u6848\uff0c\u5728Redis 3.0\u7248\u672c\u6b63\u5f0f\u63a8\u51fa\u7684\uff0c\u6709\u6548\u89e3\u51b3\u4e86Redis\u5206\u5e03\u5f0f\u65b9\u9762\u7684\u9700\u6c42\u3002\u5f53\u9047\u5230\u5355\u673a\u5185\u5b58\u3001\u5e76\u53d1\u3001\u6d41\u91cf\u7b49\u74f6\u9888\u65f6\uff0c\u53ef\u4ee5\u91c7\u7528Cluster\u67b6\u6784\u8fbe\u5230\u8d1f\u8f7d\u5747\u8861\u7684\u76ee\u7684\u3002\u5206\u5e03\u5f0f\u96c6\u7fa4\u9996\u8981\u89e3\u51b3\u628a\u6574\u4e2a\u6570\u636e\u96c6\u6309\u7167\u5206\u533a\u89c4\u5219\u6620\u5c04\u5230\u591a\u4e2a\u8282\u70b9\u7684\u95ee\u9898\uff0c\u5373\u628a\u6570\u636e\u96c6\u5212\u5206\u5230\u591a\u4e2a\u8282\u70b9\u4e0a\uff0c\u6bcf\u4e2a\u8282\u70b9\u8d1f\u8d23\u6574\u4e2a\u6570\u636e\u7684\u4e00\u4e2a\u5b50\u96c6\u3002Redis Cluster\u91c7\u7528\u54c8\u5e0c\u5206\u533a\u89c4\u5219\u4e2d\u7684\u865a\u62df\u69fd\u5206\u533a\u3002\u865a\u62df\u69fd\u5206\u533a\u5de7\u5999\u5730\u4f7f\u7528\u4e86\u54c8\u5e0c\u7a7a\u95f4\uff0c\u4f7f\u7528\u5206\u6563\u5ea6\u826f\u597d\u7684\u54c8\u5e0c\u51fd\u6570\u628a\u6240\u6709\u7684\u6570\u636e\u6620\u5c04\u5230\u4e00\u4e2a\u56fa\u5b9a\u8303\u56f4\u5185\u7684\u6574\u6570\u96c6\u5408\uff0c\u6574\u6570\u5b9a\u4e49\u4e3a\u69fd\uff08slot\uff09\u3002Redis Cluster\u69fd\u7684\u8303\u56f4\u662f0 \uff5e 16383\u3002\u69fd\u662f\u96c6\u7fa4\u5185\u6570\u636e\u7ba1\u7406\u548c\u8fc1\u79fb\u7684\u57fa\u672c\u5355\u4f4d\u3002\u91c7\u7528\u5927\u8303\u56f4\u7684\u69fd\u7684\u4e3b\u8981\u76ee\u7684\u662f\u4e3a\u4e86\u65b9\u4fbf\u6570\u636e\u7684\u62c6\u5206\u548c\u96c6\u7fa4\u7684\u6269\u5c55\uff0c\u6bcf\u4e2a\u8282\u70b9\u8d1f\u8d23\u4e00\u5b9a\u6570\u91cf\u7684\u69fd\u3002Redis Cluster\u91c7\u7528\u865a\u62df\u69fd\u5206\u533a\uff0c\u6240\u6709\u7684\u952e\u6839\u636e\u54c8\u5e0c\u51fd\u6570\u6620\u5c04\u52300 \uff5e 16383\uff0c\u8ba1\u7b97\u516c\u5f0f\uff1aslot = CRC16(key)&16383\u3002\u6bcf\u4e00\u4e2a\u5b9e\u8282\u70b9\u8d1f\u8d23\u7ef4\u62a4\u4e00\u90e8\u5206\u69fd\u4ee5\u53ca\u69fd\u6240\u6620\u5c04\u7684\u952e\u503c\u6570\u636e\u3002\u4e0b\u56fe\u5c55\u73b0\u4e00\u4e2a\u4e94\u4e2a\u8282\u70b9\u6784\u6210\u7684\u96c6\u7fa4\uff0c\u6bcf\u4e2a\u8282\u70b9\u5e73\u5747\u5927\u7ea6\u8d1f\u8d233276\u4e2a\u69fd\uff0c\u4ee5\u53ca\u901a\u8fc7\u8ba1\u7b97\u516c\u5f0f\u6620\u5c04\u5230\u5bf9\u5e94\u8282\u70b9\u7684\u5bf9\u5e94\u69fd\u7684\u8fc7\u7a0b\u3002 Redis Cluster\u8282\u70b9\u76f8\u4e92\u4e4b\u524d\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a","title":"2.2 Redis Cluster"},{"location":"linux/nosql/redis/redis.store/","text":"Redis \u6301\u4e45\u5316 1. \u4ecb\u7ecd \u00b6 Redis\u662f\u4e00\u79cd\u9ad8\u7ea7key-value\u6570\u636e\u5e93\u3002\u5b83\u8ddfmemcached\u7c7b\u4f3c\uff0c\u4e0d\u8fc7\u6570\u636e\u53ef\u4ee5\u6301\u4e45\u5316\uff0c\u800c\u4e14\u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\u5f88\u4e30\u5bcc\u3002\u6709\u5b57\u7b26\u4e32\uff0c\u94fe\u8868\uff0c\u96c6 \u5408\u548c\u6709\u5e8f\u96c6\u5408\u3002\u652f\u6301\u5728\u670d\u52a1\u5668\u7aef\u8ba1\u7b97\u96c6\u5408\u7684\u5e76\uff0c\u4ea4\u548c\u8865\u96c6(difference)\u7b49\uff0c\u8fd8\u652f\u6301\u591a\u79cd\u6392\u5e8f\u529f\u80fd\u3002\u6240\u4ee5Redis\u4e5f\u53ef\u4ee5\u88ab\u770b\u6210\u662f\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u670d\u52a1 \u5668\u3002 Redis\u7684\u6240\u6709\u6570\u636e\u90fd\u662f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u4e0d\u5b9a\u671f\u7684\u901a\u8fc7\u5f02\u6b65\u65b9\u5f0f\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a(\u8fd9\u79f0\u4e3a\u201c\u534a\u6301\u4e45\u5316\u6a21\u5f0f\u201d)\uff1b\u4e5f\u53ef\u4ee5\u628a\u6bcf\u4e00\u6b21\u6570\u636e\u53d8\u5316\u90fd\u5199\u5165\u5230\u4e00\u4e2aappend only file(aof)\u91cc\u9762(\u8fd9\u79f0\u4e3a\u201c\u5168\u6301\u4e45\u5316\u6a21\u5f0f\u201d)\u3002 \u7531\u4e8eRedis\u7684\u6570\u636e\u90fd\u5b58\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u5982\u679c\u6ca1\u6709\u914d\u7f6e\u6301\u4e45\u5316\uff0credis\u91cd\u542f\u540e\u6570\u636e\u5c31\u5168\u4e22\u5931\u4e86\uff0c\u4e8e\u662f\u9700\u8981\u5f00\u542fredis\u7684\u6301\u4e45\u5316\u529f\u80fd\uff0c\u5c06\u6570\u636e\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\uff0c\u5f53redis\u91cd\u542f\u540e\uff0c\u53ef\u4ee5\u4ece\u78c1\u76d8\u4e2d\u6062\u590d\u6570\u636e\u3002redis\u63d0\u4f9b\u4e24\u79cd\u65b9\u5f0f\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u4e00\u79cd\u662fRDB\u6301\u4e45\u5316\uff08\u539f\u7406\u662f\u5c06Reids\u5728\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5e93\u8bb0\u5f55\u5b9a\u65f6dump\u5230\u78c1\u76d8\u4e0a\u7684RDB\u6301\u4e45\u5316\uff09\uff0c\u53e6\u5916\u4e00\u79cd\u662fAOF\uff08append only file\uff09\u6301\u4e45\u5316\uff08\u539f\u7406\u662f\u5c06Reids\u7684\u64cd\u4f5c\u65e5\u5fd7\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u5199\u5165\u6587\u4ef6\uff09\u3002\u90a3\u4e48\u8fd9\u4e24\u79cd\u6301\u4e45\u5316\u65b9\u5f0f\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff0c\u6539\u5982\u4f55\u9009\u62e9\u5462\uff1f\u7f51\u4e0a\u770b\u4e86\u5927\u591a\u6570\u90fd\u662f\u4ecb\u7ecd\u8fd9\u4e24\u79cd\u65b9\u5f0f\u600e\u4e48\u914d\u7f6e\uff0c\u600e\u4e48\u4f7f\u7528\uff0c\u5c31\u662f\u6ca1\u6709\u4ecb\u7ecd\u4e8c\u8005\u7684\u533a\u522b\uff0c\u5728\u4ec0\u4e48\u5e94\u7528\u573a\u666f\u4e0b\u4f7f\u7528\u3002 2. \u533a\u522b \u00b6 RDB\u6301\u4e45\u5316\u662f\u6307\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u5185\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u96c6\u5feb\u7167\u5199\u5165\u78c1\u76d8\uff0c\u5b9e\u9645\u64cd\u4f5c\u8fc7\u7a0b\u662ffork\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u5148\u5c06\u6570\u636e\u96c6\u5199\u5165\u4e34\u65f6\u6587\u4ef6\uff0c\u5199\u5165\u6210\u529f\u540e\uff0c\u518d\u66ff\u6362\u4e4b\u524d\u7684\u6587\u4ef6\uff0c\u7528\u4e8c\u8fdb\u5236\u538b\u7f29\u5b58\u50a8\u3002 AOF\u6301\u4e45\u5316\u4ee5\u65e5\u5fd7\u7684\u5f62\u5f0f\u8bb0\u5f55\u670d\u52a1\u5668\u6240\u5904\u7406\u7684\u6bcf\u4e00\u4e2a\u5199\u3001\u5220\u9664\u64cd\u4f5c\uff0c\u67e5\u8be2\u64cd\u4f5c\u4e0d\u4f1a\u8bb0\u5f55\uff0c\u4ee5\u6587\u672c\u7684\u65b9\u5f0f\u8bb0\u5f55\uff0c\u53ef\u4ee5\u6253\u5f00\u6587\u4ef6\u770b\u5230\u8be6\u7ec6\u7684\u64cd\u4f5c\u8bb0\u5f55\u3002 3. \u4f18\u7f3a\u70b9 \u00b6 3.1 RDB\u4f18\u52bf \u00b6 \u4e00\u65e6\u91c7\u7528\u8be5\u65b9\u5f0f\uff0c\u90a3\u4e48\u4f60\u7684\u6574\u4e2aRedis\u6570\u636e\u5e93\u5c06\u53ea\u5305\u542b\u4e00\u4e2a\u6587\u4ef6\uff0c\u8fd9\u5bf9\u4e8e\u6587\u4ef6\u5907\u4efd\u800c\u8a00\u662f\u975e\u5e38\u5b8c\u7f8e\u7684\u3002\u6bd4\u5982\uff0c\u4f60\u53ef\u80fd\u6253\u7b97\u6bcf\u4e2a\u5c0f\u65f6\u5f52\u6863\u4e00\u6b21\u6700\u8fd124\u5c0f\u65f6\u7684\u6570\u636e\uff0c\u540c\u65f6\u8fd8\u8981\u6bcf\u5929\u5f52\u6863\u4e00\u6b21\u6700\u8fd130\u5929\u7684\u6570\u636e\u3002\u901a\u8fc7\u8fd9\u6837\u7684\u5907\u4efd\u7b56\u7565\uff0c\u4e00\u65e6\u7cfb\u7edf\u51fa\u73b0\u707e\u96be\u6027\u6545\u969c\uff0c\u6211\u4eec\u53ef\u4ee5\u975e\u5e38\u5bb9\u6613\u7684\u8fdb\u884c\u6062\u590d\u3002 \u5bf9\u4e8e\u707e\u96be\u6062\u590d\u800c\u8a00\uff0cRDB\u662f\u975e\u5e38\u4e0d\u9519\u7684\u9009\u62e9\u3002\u56e0\u4e3a\u6211\u4eec\u53ef\u4ee5\u975e\u5e38\u8f7b\u677e\u7684\u5c06\u4e00\u4e2a\u5355\u72ec\u7684\u6587\u4ef6\u538b\u7f29\u540e\u518d\u8f6c\u79fb\u5230\u5176\u5b83\u5b58\u50a8\u4ecb\u8d28\u4e0a\u3002 \u6027\u80fd\u6700\u5927\u5316\u3002\u5bf9\u4e8eRedis\u7684\u670d\u52a1\u8fdb\u7a0b\u800c\u8a00\uff0c\u5728\u5f00\u59cb\u6301\u4e45\u5316\u65f6\uff0c\u5b83\u552f\u4e00\u9700\u8981\u505a\u7684\u53ea\u662ffork\u51fa\u5b50\u8fdb\u7a0b\uff0c\u4e4b\u540e\u518d\u7531\u5b50\u8fdb\u7a0b\u5b8c\u6210\u8fd9\u4e9b\u6301\u4e45\u5316\u7684\u5de5\u4f5c\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u6781\u5927\u7684\u907f\u514d\u670d\u52a1\u8fdb\u7a0b\u6267\u884cIO\u64cd\u4f5c\u4e86\u3002 \u76f8\u6bd4\u4e8eAOF\u673a\u5236\uff0c\u5982\u679c\u6570\u636e\u96c6\u5f88\u5927\uff0cRDB\u7684\u542f\u52a8\u6548\u7387\u4f1a\u66f4\u9ad8\u3002 3.2 RDB\u52a3\u52bf \u00b6 \u5982\u679c\u4f60\u60f3\u4fdd\u8bc1\u6570\u636e\u7684\u9ad8\u53ef\u7528\u6027\uff0c\u5373\u6700\u5927\u9650\u5ea6\u7684\u907f\u514d\u6570\u636e\u4e22\u5931\uff0c\u90a3\u4e48RDB\u5c06\u4e0d\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\u3002\u56e0\u4e3a\u7cfb\u7edf\u4e00\u65e6\u5728\u5b9a\u65f6\u6301\u4e45\u5316\u4e4b\u524d\u51fa\u73b0\u5b95\u673a\u73b0\u8c61\uff0c\u6b64\u524d\u6ca1\u6709\u6765\u5f97\u53ca\u5199\u5165\u78c1\u76d8\u7684\u6570\u636e\u90fd\u5c06\u4e22\u5931\u3002 \u7531\u4e8eRDB\u662f\u901a\u8fc7fork\u5b50\u8fdb\u7a0b\u6765\u534f\u52a9\u5b8c\u6210\u6570\u636e\u6301\u4e45\u5316\u5de5\u4f5c\u7684\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u5f53\u6570\u636e\u96c6\u8f83\u5927\u65f6\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6574\u4e2a\u670d\u52a1\u5668\u505c\u6b62\u670d\u52a1\u51e0\u767e\u6beb\u79d2\uff0c\u751a\u81f3\u662f1\u79d2\u949f\u3002 AOF\u7684\u4f18\u52bf\u6709\u54ea\u4e9b\u5462\uff1f 3.3 AOF\u7684\u4f18\u52bf \u00b6 \u8be5\u673a\u5236\u53ef\u4ee5\u5e26\u6765\u66f4\u9ad8\u7684\u6570\u636e\u5b89\u5168\u6027\uff0c\u5373\u6570\u636e\u6301\u4e45\u6027\u3002Redis\u4e2d\u63d0\u4f9b\u4e863\u4e2d\u540c\u6b65\u7b56\u7565\uff0c\u5373\u6bcf\u79d2\u540c\u6b65\u3001\u6bcf\u4fee\u6539\u540c\u6b65\u548c\u4e0d\u540c\u6b65\u3002\u4e8b\u5b9e\u4e0a\uff0c\u6bcf\u79d2\u540c\u6b65\u4e5f\u662f\u5f02\u6b65\u5b8c\u6210\u7684\uff0c\u5176\u6548\u7387\u4e5f\u662f\u975e\u5e38\u9ad8\u7684\uff0c\u6240\u5dee\u7684\u662f\u4e00\u65e6\u7cfb\u7edf\u51fa\u73b0\u5b95\u673a\u73b0\u8c61\uff0c\u90a3\u4e48\u8fd9\u4e00\u79d2\u949f\u4e4b\u5185\u4fee\u6539\u7684\u6570\u636e\u5c06\u4f1a\u4e22\u5931\u3002\u800c\u6bcf\u4fee\u6539\u540c\u6b65\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u89c6\u4e3a\u540c\u6b65\u6301\u4e45\u5316\uff0c\u5373\u6bcf\u6b21\u53d1\u751f\u7684\u6570\u636e\u53d8\u5316\u90fd\u4f1a\u88ab\u7acb\u5373\u8bb0\u5f55\u5230\u78c1\u76d8\u4e2d\u3002\u53ef\u4ee5\u9884\u89c1\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5728\u6548\u7387\u4e0a\u662f\u6700\u4f4e\u7684\u3002\u81f3\u4e8e\u65e0\u540c\u6b65\uff0c\u65e0\u9700\u591a\u8a00\uff0c\u6211\u60f3\u5927\u5bb6\u90fd\u80fd\u6b63\u786e\u7684\u7406\u89e3\u5b83\u3002 \u7531\u4e8e\u8be5\u673a\u5236\u5bf9\u65e5\u5fd7\u6587\u4ef6\u7684\u5199\u5165\u64cd\u4f5c\u91c7\u7528\u7684\u662fappend\u6a21\u5f0f\uff0c\u56e0\u6b64\u5728\u5199\u5165\u8fc7\u7a0b\u4e2d\u5373\u4f7f\u51fa\u73b0\u5b95\u673a\u73b0\u8c61\uff0c\u4e5f\u4e0d\u4f1a\u7834\u574f\u65e5\u5fd7\u6587\u4ef6\u4e2d\u5df2\u7ecf\u5b58\u5728\u7684\u5185\u5bb9\u3002\u7136\u800c\u5982\u679c\u6211\u4eec\u672c\u6b21\u64cd\u4f5c\u53ea\u662f\u5199\u5165\u4e86\u4e00\u534a\u6570\u636e\u5c31\u51fa\u73b0\u4e86\u7cfb\u7edf\u5d29\u6e83\u95ee\u9898\uff0c\u4e0d\u7528\u62c5\u5fc3\uff0c\u5728Redis\u4e0b\u4e00\u6b21\u542f\u52a8\u4e4b\u524d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7redis-check-aof\u5de5\u5177\u6765\u5e2e\u52a9\u6211\u4eec\u89e3\u51b3\u6570\u636e\u4e00\u81f4\u6027\u7684\u95ee\u9898\u3002 \u5982\u679c\u65e5\u5fd7\u8fc7\u5927\uff0cRedis\u53ef\u4ee5\u81ea\u52a8\u542f\u7528rewrite\u673a\u5236\u3002\u5373Redis\u4ee5append\u6a21\u5f0f\u4e0d\u65ad\u7684\u5c06\u4fee\u6539\u6570\u636e\u5199\u5165\u5230\u8001\u7684\u78c1\u76d8\u6587\u4ef6\u4e2d\uff0c\u540c\u65f6Redis\u8fd8\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6\u7528\u4e8e\u8bb0\u5f55\u6b64\u671f\u95f4\u6709\u54ea\u4e9b\u4fee\u6539\u547d\u4ee4\u88ab\u6267\u884c\u3002\u56e0\u6b64\u5728\u8fdb\u884crewrite\u5207\u6362\u65f6\u53ef\u4ee5\u66f4\u597d\u7684\u4fdd\u8bc1\u6570\u636e\u5b89\u5168\u6027\u3002 AOF\u5305\u542b\u4e00\u4e2a\u683c\u5f0f\u6e05\u6670\u3001\u6613\u4e8e\u7406\u89e3\u7684\u65e5\u5fd7\u6587\u4ef6\u7528\u4e8e\u8bb0\u5f55\u6240\u6709\u7684\u4fee\u6539\u64cd\u4f5c\u3002\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8be5\u6587\u4ef6\u5b8c\u6210\u6570\u636e\u7684\u91cd\u5efa\u3002 3.4 AOF\u7684\u52a3\u52bf \u00b6 \u5bf9\u4e8e\u76f8\u540c\u6570\u91cf\u7684\u6570\u636e\u96c6\u800c\u8a00\uff0cAOF\u6587\u4ef6\u901a\u5e38\u8981\u5927\u4e8eRDB\u6587\u4ef6\u3002RDB \u5728\u6062\u590d\u5927\u6570\u636e\u96c6\u65f6\u7684\u901f\u5ea6\u6bd4 AOF \u7684\u6062\u590d\u901f\u5ea6\u8981\u5feb\u3002 \u6839\u636e\u540c\u6b65\u7b56\u7565\u7684\u4e0d\u540c\uff0cAOF\u5728\u8fd0\u884c\u6548\u7387\u4e0a\u5f80\u5f80\u4f1a\u6162\u4e8eRDB\u3002\u603b\u4e4b\uff0c\u6bcf\u79d2\u540c\u6b65\u7b56\u7565\u7684\u6548\u7387\u662f\u6bd4\u8f83\u9ad8\u7684\uff0c\u540c\u6b65\u7981\u7528\u7b56\u7565\u7684\u6548\u7387\u548cRDB\u4e00\u6837\u9ad8\u6548\u3002 \u4e8c\u8005\u9009\u62e9\u7684\u6807\u51c6\uff0c\u5c31\u662f\u770b\u7cfb\u7edf\u662f\u613f\u610f\u727a\u7272\u4e00\u4e9b\u6027\u80fd\uff0c\u6362\u53d6\u66f4\u9ad8\u7684\u7f13\u5b58\u4e00\u81f4\u6027\uff08aof\uff09\uff0c\u8fd8\u662f\u613f\u610f\u5199\u64cd\u4f5c\u9891\u7e41\u7684\u65f6\u5019\uff0c\u4e0d\u542f\u7528\u5907\u4efd\u6765\u6362\u53d6\u66f4\u9ad8\u7684\u6027\u80fd\uff0c\u5f85\u624b\u52a8\u8fd0\u884csave\u7684\u65f6\u5019\uff0c\u518d\u505a\u5907\u4efd\uff08rdb\uff09\u3002rdb\u8fd9\u4e2a\u5c31\u66f4\u6709\u4e9b eventually consistent\u7684\u610f\u601d\u4e86\u3002 4. \u5e38\u89c1\u914d\u7f6e \u00b6 4.1 RDB \u00b6 Redis\u4f1a\u5c06\u6570\u636e\u96c6\u7684\u5feb\u7167dump\u5230dump.rdb\u6587\u4ef6\u4e2d\u3002\u6b64\u5916\uff0c \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6765\u4fee\u6539Redis\u670d\u52a1\u5668dump\u5feb\u7167\u7684\u9891\u7387, \u5728\u6253\u5f006379.conf\u6587\u4ef6\u4e4b\u540e\uff0c\u6211\u4eec\u641c\u7d22save\uff0c\u53ef\u4ee5\u770b\u5230\u4e0b\u9762\u7684\u914d\u7f6e\u4fe1\u606f\uff1a save 900 1 #\u5728900\u79d2(15\u5206\u949f)\u4e4b\u540e\uff0c\u5982\u679c\u81f3\u5c11\u67091\u4e2akey\u53d1\u751f\u53d8\u5316\uff0c\u5219dump\u5185\u5b58\u5feb\u7167\u3002 save 300 10 #\u5728300\u79d2(5\u5206\u949f)\u4e4b\u540e\uff0c\u5982\u679c\u81f3\u5c11\u670910\u4e2akey\u53d1\u751f\u53d8\u5316\uff0c\u5219dump\u5185\u5b58\u5feb\u7167\u3002 save 60 10000 #\u572860\u79d2(1\u5206\u949f)\u4e4b\u540e\uff0c\u5982\u679c\u81f3\u5c11\u670910000\u4e2akey\u53d1\u751f\u53d8\u5316\uff0c\u5219dump\u5185\u5b58\u5feb\u7167\u3002 4.2 AOF \u00b6 \u5728Redis\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u5b58\u5728\u4e09\u79cd\u540c\u6b65\u65b9\u5f0f\uff0c\u5b83\u4eec\u5206\u522b\u662f\uff1a appendfsync always #\u6bcf\u6b21\u6709\u6570\u636e\u4fee\u6539\u53d1\u751f\u65f6\u90fd\u4f1a\u5199\u5165AOF\u6587\u4ef6\u3002 appendfsync everysec #\u6bcf\u79d2\u949f\u540c\u6b65\u4e00\u6b21\uff0c\u8be5\u7b56\u7565\u4e3aAOF\u7684\u7f3a\u7701\u7b56\u7565\u3002 appendfsync no #\u4ece\u4e0d\u540c\u6b65\u3002\u9ad8\u6548\u4f46\u662f\u6570\u636e\u4e0d\u4f1a\u88ab\u6301\u4e45\u5316\u3002","title":"07. redis \u6301\u4e45\u5316\u5b58\u50a8"},{"location":"linux/nosql/redis/redis.store/#1","text":"Redis\u662f\u4e00\u79cd\u9ad8\u7ea7key-value\u6570\u636e\u5e93\u3002\u5b83\u8ddfmemcached\u7c7b\u4f3c\uff0c\u4e0d\u8fc7\u6570\u636e\u53ef\u4ee5\u6301\u4e45\u5316\uff0c\u800c\u4e14\u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\u5f88\u4e30\u5bcc\u3002\u6709\u5b57\u7b26\u4e32\uff0c\u94fe\u8868\uff0c\u96c6 \u5408\u548c\u6709\u5e8f\u96c6\u5408\u3002\u652f\u6301\u5728\u670d\u52a1\u5668\u7aef\u8ba1\u7b97\u96c6\u5408\u7684\u5e76\uff0c\u4ea4\u548c\u8865\u96c6(difference)\u7b49\uff0c\u8fd8\u652f\u6301\u591a\u79cd\u6392\u5e8f\u529f\u80fd\u3002\u6240\u4ee5Redis\u4e5f\u53ef\u4ee5\u88ab\u770b\u6210\u662f\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u670d\u52a1 \u5668\u3002 Redis\u7684\u6240\u6709\u6570\u636e\u90fd\u662f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u4e0d\u5b9a\u671f\u7684\u901a\u8fc7\u5f02\u6b65\u65b9\u5f0f\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a(\u8fd9\u79f0\u4e3a\u201c\u534a\u6301\u4e45\u5316\u6a21\u5f0f\u201d)\uff1b\u4e5f\u53ef\u4ee5\u628a\u6bcf\u4e00\u6b21\u6570\u636e\u53d8\u5316\u90fd\u5199\u5165\u5230\u4e00\u4e2aappend only file(aof)\u91cc\u9762(\u8fd9\u79f0\u4e3a\u201c\u5168\u6301\u4e45\u5316\u6a21\u5f0f\u201d)\u3002 \u7531\u4e8eRedis\u7684\u6570\u636e\u90fd\u5b58\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u5982\u679c\u6ca1\u6709\u914d\u7f6e\u6301\u4e45\u5316\uff0credis\u91cd\u542f\u540e\u6570\u636e\u5c31\u5168\u4e22\u5931\u4e86\uff0c\u4e8e\u662f\u9700\u8981\u5f00\u542fredis\u7684\u6301\u4e45\u5316\u529f\u80fd\uff0c\u5c06\u6570\u636e\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\uff0c\u5f53redis\u91cd\u542f\u540e\uff0c\u53ef\u4ee5\u4ece\u78c1\u76d8\u4e2d\u6062\u590d\u6570\u636e\u3002redis\u63d0\u4f9b\u4e24\u79cd\u65b9\u5f0f\u8fdb\u884c\u6301\u4e45\u5316\uff0c\u4e00\u79cd\u662fRDB\u6301\u4e45\u5316\uff08\u539f\u7406\u662f\u5c06Reids\u5728\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5e93\u8bb0\u5f55\u5b9a\u65f6dump\u5230\u78c1\u76d8\u4e0a\u7684RDB\u6301\u4e45\u5316\uff09\uff0c\u53e6\u5916\u4e00\u79cd\u662fAOF\uff08append only file\uff09\u6301\u4e45\u5316\uff08\u539f\u7406\u662f\u5c06Reids\u7684\u64cd\u4f5c\u65e5\u5fd7\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u5199\u5165\u6587\u4ef6\uff09\u3002\u90a3\u4e48\u8fd9\u4e24\u79cd\u6301\u4e45\u5316\u65b9\u5f0f\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff0c\u6539\u5982\u4f55\u9009\u62e9\u5462\uff1f\u7f51\u4e0a\u770b\u4e86\u5927\u591a\u6570\u90fd\u662f\u4ecb\u7ecd\u8fd9\u4e24\u79cd\u65b9\u5f0f\u600e\u4e48\u914d\u7f6e\uff0c\u600e\u4e48\u4f7f\u7528\uff0c\u5c31\u662f\u6ca1\u6709\u4ecb\u7ecd\u4e8c\u8005\u7684\u533a\u522b\uff0c\u5728\u4ec0\u4e48\u5e94\u7528\u573a\u666f\u4e0b\u4f7f\u7528\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/nosql/redis/redis.store/#2","text":"RDB\u6301\u4e45\u5316\u662f\u6307\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u5185\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u96c6\u5feb\u7167\u5199\u5165\u78c1\u76d8\uff0c\u5b9e\u9645\u64cd\u4f5c\u8fc7\u7a0b\u662ffork\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u5148\u5c06\u6570\u636e\u96c6\u5199\u5165\u4e34\u65f6\u6587\u4ef6\uff0c\u5199\u5165\u6210\u529f\u540e\uff0c\u518d\u66ff\u6362\u4e4b\u524d\u7684\u6587\u4ef6\uff0c\u7528\u4e8c\u8fdb\u5236\u538b\u7f29\u5b58\u50a8\u3002 AOF\u6301\u4e45\u5316\u4ee5\u65e5\u5fd7\u7684\u5f62\u5f0f\u8bb0\u5f55\u670d\u52a1\u5668\u6240\u5904\u7406\u7684\u6bcf\u4e00\u4e2a\u5199\u3001\u5220\u9664\u64cd\u4f5c\uff0c\u67e5\u8be2\u64cd\u4f5c\u4e0d\u4f1a\u8bb0\u5f55\uff0c\u4ee5\u6587\u672c\u7684\u65b9\u5f0f\u8bb0\u5f55\uff0c\u53ef\u4ee5\u6253\u5f00\u6587\u4ef6\u770b\u5230\u8be6\u7ec6\u7684\u64cd\u4f5c\u8bb0\u5f55\u3002","title":"2. \u533a\u522b"},{"location":"linux/nosql/redis/redis.store/#3","text":"","title":"3. \u4f18\u7f3a\u70b9"},{"location":"linux/nosql/redis/redis.store/#31-rdb","text":"\u4e00\u65e6\u91c7\u7528\u8be5\u65b9\u5f0f\uff0c\u90a3\u4e48\u4f60\u7684\u6574\u4e2aRedis\u6570\u636e\u5e93\u5c06\u53ea\u5305\u542b\u4e00\u4e2a\u6587\u4ef6\uff0c\u8fd9\u5bf9\u4e8e\u6587\u4ef6\u5907\u4efd\u800c\u8a00\u662f\u975e\u5e38\u5b8c\u7f8e\u7684\u3002\u6bd4\u5982\uff0c\u4f60\u53ef\u80fd\u6253\u7b97\u6bcf\u4e2a\u5c0f\u65f6\u5f52\u6863\u4e00\u6b21\u6700\u8fd124\u5c0f\u65f6\u7684\u6570\u636e\uff0c\u540c\u65f6\u8fd8\u8981\u6bcf\u5929\u5f52\u6863\u4e00\u6b21\u6700\u8fd130\u5929\u7684\u6570\u636e\u3002\u901a\u8fc7\u8fd9\u6837\u7684\u5907\u4efd\u7b56\u7565\uff0c\u4e00\u65e6\u7cfb\u7edf\u51fa\u73b0\u707e\u96be\u6027\u6545\u969c\uff0c\u6211\u4eec\u53ef\u4ee5\u975e\u5e38\u5bb9\u6613\u7684\u8fdb\u884c\u6062\u590d\u3002 \u5bf9\u4e8e\u707e\u96be\u6062\u590d\u800c\u8a00\uff0cRDB\u662f\u975e\u5e38\u4e0d\u9519\u7684\u9009\u62e9\u3002\u56e0\u4e3a\u6211\u4eec\u53ef\u4ee5\u975e\u5e38\u8f7b\u677e\u7684\u5c06\u4e00\u4e2a\u5355\u72ec\u7684\u6587\u4ef6\u538b\u7f29\u540e\u518d\u8f6c\u79fb\u5230\u5176\u5b83\u5b58\u50a8\u4ecb\u8d28\u4e0a\u3002 \u6027\u80fd\u6700\u5927\u5316\u3002\u5bf9\u4e8eRedis\u7684\u670d\u52a1\u8fdb\u7a0b\u800c\u8a00\uff0c\u5728\u5f00\u59cb\u6301\u4e45\u5316\u65f6\uff0c\u5b83\u552f\u4e00\u9700\u8981\u505a\u7684\u53ea\u662ffork\u51fa\u5b50\u8fdb\u7a0b\uff0c\u4e4b\u540e\u518d\u7531\u5b50\u8fdb\u7a0b\u5b8c\u6210\u8fd9\u4e9b\u6301\u4e45\u5316\u7684\u5de5\u4f5c\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u6781\u5927\u7684\u907f\u514d\u670d\u52a1\u8fdb\u7a0b\u6267\u884cIO\u64cd\u4f5c\u4e86\u3002 \u76f8\u6bd4\u4e8eAOF\u673a\u5236\uff0c\u5982\u679c\u6570\u636e\u96c6\u5f88\u5927\uff0cRDB\u7684\u542f\u52a8\u6548\u7387\u4f1a\u66f4\u9ad8\u3002","title":"3.1 RDB\u4f18\u52bf"},{"location":"linux/nosql/redis/redis.store/#32-rdb","text":"\u5982\u679c\u4f60\u60f3\u4fdd\u8bc1\u6570\u636e\u7684\u9ad8\u53ef\u7528\u6027\uff0c\u5373\u6700\u5927\u9650\u5ea6\u7684\u907f\u514d\u6570\u636e\u4e22\u5931\uff0c\u90a3\u4e48RDB\u5c06\u4e0d\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\u3002\u56e0\u4e3a\u7cfb\u7edf\u4e00\u65e6\u5728\u5b9a\u65f6\u6301\u4e45\u5316\u4e4b\u524d\u51fa\u73b0\u5b95\u673a\u73b0\u8c61\uff0c\u6b64\u524d\u6ca1\u6709\u6765\u5f97\u53ca\u5199\u5165\u78c1\u76d8\u7684\u6570\u636e\u90fd\u5c06\u4e22\u5931\u3002 \u7531\u4e8eRDB\u662f\u901a\u8fc7fork\u5b50\u8fdb\u7a0b\u6765\u534f\u52a9\u5b8c\u6210\u6570\u636e\u6301\u4e45\u5316\u5de5\u4f5c\u7684\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u5f53\u6570\u636e\u96c6\u8f83\u5927\u65f6\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6574\u4e2a\u670d\u52a1\u5668\u505c\u6b62\u670d\u52a1\u51e0\u767e\u6beb\u79d2\uff0c\u751a\u81f3\u662f1\u79d2\u949f\u3002 AOF\u7684\u4f18\u52bf\u6709\u54ea\u4e9b\u5462\uff1f","title":"3.2 RDB\u52a3\u52bf"},{"location":"linux/nosql/redis/redis.store/#33-aof","text":"\u8be5\u673a\u5236\u53ef\u4ee5\u5e26\u6765\u66f4\u9ad8\u7684\u6570\u636e\u5b89\u5168\u6027\uff0c\u5373\u6570\u636e\u6301\u4e45\u6027\u3002Redis\u4e2d\u63d0\u4f9b\u4e863\u4e2d\u540c\u6b65\u7b56\u7565\uff0c\u5373\u6bcf\u79d2\u540c\u6b65\u3001\u6bcf\u4fee\u6539\u540c\u6b65\u548c\u4e0d\u540c\u6b65\u3002\u4e8b\u5b9e\u4e0a\uff0c\u6bcf\u79d2\u540c\u6b65\u4e5f\u662f\u5f02\u6b65\u5b8c\u6210\u7684\uff0c\u5176\u6548\u7387\u4e5f\u662f\u975e\u5e38\u9ad8\u7684\uff0c\u6240\u5dee\u7684\u662f\u4e00\u65e6\u7cfb\u7edf\u51fa\u73b0\u5b95\u673a\u73b0\u8c61\uff0c\u90a3\u4e48\u8fd9\u4e00\u79d2\u949f\u4e4b\u5185\u4fee\u6539\u7684\u6570\u636e\u5c06\u4f1a\u4e22\u5931\u3002\u800c\u6bcf\u4fee\u6539\u540c\u6b65\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u89c6\u4e3a\u540c\u6b65\u6301\u4e45\u5316\uff0c\u5373\u6bcf\u6b21\u53d1\u751f\u7684\u6570\u636e\u53d8\u5316\u90fd\u4f1a\u88ab\u7acb\u5373\u8bb0\u5f55\u5230\u78c1\u76d8\u4e2d\u3002\u53ef\u4ee5\u9884\u89c1\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5728\u6548\u7387\u4e0a\u662f\u6700\u4f4e\u7684\u3002\u81f3\u4e8e\u65e0\u540c\u6b65\uff0c\u65e0\u9700\u591a\u8a00\uff0c\u6211\u60f3\u5927\u5bb6\u90fd\u80fd\u6b63\u786e\u7684\u7406\u89e3\u5b83\u3002 \u7531\u4e8e\u8be5\u673a\u5236\u5bf9\u65e5\u5fd7\u6587\u4ef6\u7684\u5199\u5165\u64cd\u4f5c\u91c7\u7528\u7684\u662fappend\u6a21\u5f0f\uff0c\u56e0\u6b64\u5728\u5199\u5165\u8fc7\u7a0b\u4e2d\u5373\u4f7f\u51fa\u73b0\u5b95\u673a\u73b0\u8c61\uff0c\u4e5f\u4e0d\u4f1a\u7834\u574f\u65e5\u5fd7\u6587\u4ef6\u4e2d\u5df2\u7ecf\u5b58\u5728\u7684\u5185\u5bb9\u3002\u7136\u800c\u5982\u679c\u6211\u4eec\u672c\u6b21\u64cd\u4f5c\u53ea\u662f\u5199\u5165\u4e86\u4e00\u534a\u6570\u636e\u5c31\u51fa\u73b0\u4e86\u7cfb\u7edf\u5d29\u6e83\u95ee\u9898\uff0c\u4e0d\u7528\u62c5\u5fc3\uff0c\u5728Redis\u4e0b\u4e00\u6b21\u542f\u52a8\u4e4b\u524d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7redis-check-aof\u5de5\u5177\u6765\u5e2e\u52a9\u6211\u4eec\u89e3\u51b3\u6570\u636e\u4e00\u81f4\u6027\u7684\u95ee\u9898\u3002 \u5982\u679c\u65e5\u5fd7\u8fc7\u5927\uff0cRedis\u53ef\u4ee5\u81ea\u52a8\u542f\u7528rewrite\u673a\u5236\u3002\u5373Redis\u4ee5append\u6a21\u5f0f\u4e0d\u65ad\u7684\u5c06\u4fee\u6539\u6570\u636e\u5199\u5165\u5230\u8001\u7684\u78c1\u76d8\u6587\u4ef6\u4e2d\uff0c\u540c\u65f6Redis\u8fd8\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6\u7528\u4e8e\u8bb0\u5f55\u6b64\u671f\u95f4\u6709\u54ea\u4e9b\u4fee\u6539\u547d\u4ee4\u88ab\u6267\u884c\u3002\u56e0\u6b64\u5728\u8fdb\u884crewrite\u5207\u6362\u65f6\u53ef\u4ee5\u66f4\u597d\u7684\u4fdd\u8bc1\u6570\u636e\u5b89\u5168\u6027\u3002 AOF\u5305\u542b\u4e00\u4e2a\u683c\u5f0f\u6e05\u6670\u3001\u6613\u4e8e\u7406\u89e3\u7684\u65e5\u5fd7\u6587\u4ef6\u7528\u4e8e\u8bb0\u5f55\u6240\u6709\u7684\u4fee\u6539\u64cd\u4f5c\u3002\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8be5\u6587\u4ef6\u5b8c\u6210\u6570\u636e\u7684\u91cd\u5efa\u3002","title":"3.3 AOF\u7684\u4f18\u52bf"},{"location":"linux/nosql/redis/redis.store/#34-aof","text":"\u5bf9\u4e8e\u76f8\u540c\u6570\u91cf\u7684\u6570\u636e\u96c6\u800c\u8a00\uff0cAOF\u6587\u4ef6\u901a\u5e38\u8981\u5927\u4e8eRDB\u6587\u4ef6\u3002RDB \u5728\u6062\u590d\u5927\u6570\u636e\u96c6\u65f6\u7684\u901f\u5ea6\u6bd4 AOF \u7684\u6062\u590d\u901f\u5ea6\u8981\u5feb\u3002 \u6839\u636e\u540c\u6b65\u7b56\u7565\u7684\u4e0d\u540c\uff0cAOF\u5728\u8fd0\u884c\u6548\u7387\u4e0a\u5f80\u5f80\u4f1a\u6162\u4e8eRDB\u3002\u603b\u4e4b\uff0c\u6bcf\u79d2\u540c\u6b65\u7b56\u7565\u7684\u6548\u7387\u662f\u6bd4\u8f83\u9ad8\u7684\uff0c\u540c\u6b65\u7981\u7528\u7b56\u7565\u7684\u6548\u7387\u548cRDB\u4e00\u6837\u9ad8\u6548\u3002 \u4e8c\u8005\u9009\u62e9\u7684\u6807\u51c6\uff0c\u5c31\u662f\u770b\u7cfb\u7edf\u662f\u613f\u610f\u727a\u7272\u4e00\u4e9b\u6027\u80fd\uff0c\u6362\u53d6\u66f4\u9ad8\u7684\u7f13\u5b58\u4e00\u81f4\u6027\uff08aof\uff09\uff0c\u8fd8\u662f\u613f\u610f\u5199\u64cd\u4f5c\u9891\u7e41\u7684\u65f6\u5019\uff0c\u4e0d\u542f\u7528\u5907\u4efd\u6765\u6362\u53d6\u66f4\u9ad8\u7684\u6027\u80fd\uff0c\u5f85\u624b\u52a8\u8fd0\u884csave\u7684\u65f6\u5019\uff0c\u518d\u505a\u5907\u4efd\uff08rdb\uff09\u3002rdb\u8fd9\u4e2a\u5c31\u66f4\u6709\u4e9b eventually consistent\u7684\u610f\u601d\u4e86\u3002","title":"3.4 AOF\u7684\u52a3\u52bf"},{"location":"linux/nosql/redis/redis.store/#4","text":"","title":"4. \u5e38\u89c1\u914d\u7f6e"},{"location":"linux/nosql/redis/redis.store/#41-rdb","text":"Redis\u4f1a\u5c06\u6570\u636e\u96c6\u7684\u5feb\u7167dump\u5230dump.rdb\u6587\u4ef6\u4e2d\u3002\u6b64\u5916\uff0c \u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6765\u4fee\u6539Redis\u670d\u52a1\u5668dump\u5feb\u7167\u7684\u9891\u7387, \u5728\u6253\u5f006379.conf\u6587\u4ef6\u4e4b\u540e\uff0c\u6211\u4eec\u641c\u7d22save\uff0c\u53ef\u4ee5\u770b\u5230\u4e0b\u9762\u7684\u914d\u7f6e\u4fe1\u606f\uff1a save 900 1 #\u5728900\u79d2(15\u5206\u949f)\u4e4b\u540e\uff0c\u5982\u679c\u81f3\u5c11\u67091\u4e2akey\u53d1\u751f\u53d8\u5316\uff0c\u5219dump\u5185\u5b58\u5feb\u7167\u3002 save 300 10 #\u5728300\u79d2(5\u5206\u949f)\u4e4b\u540e\uff0c\u5982\u679c\u81f3\u5c11\u670910\u4e2akey\u53d1\u751f\u53d8\u5316\uff0c\u5219dump\u5185\u5b58\u5feb\u7167\u3002 save 60 10000 #\u572860\u79d2(1\u5206\u949f)\u4e4b\u540e\uff0c\u5982\u679c\u81f3\u5c11\u670910000\u4e2akey\u53d1\u751f\u53d8\u5316\uff0c\u5219dump\u5185\u5b58\u5feb\u7167\u3002","title":"4.1 RDB"},{"location":"linux/nosql/redis/redis.store/#42-aof","text":"\u5728Redis\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u5b58\u5728\u4e09\u79cd\u540c\u6b65\u65b9\u5f0f\uff0c\u5b83\u4eec\u5206\u522b\u662f\uff1a appendfsync always #\u6bcf\u6b21\u6709\u6570\u636e\u4fee\u6539\u53d1\u751f\u65f6\u90fd\u4f1a\u5199\u5165AOF\u6587\u4ef6\u3002 appendfsync everysec #\u6bcf\u79d2\u949f\u540c\u6b65\u4e00\u6b21\uff0c\u8be5\u7b56\u7565\u4e3aAOF\u7684\u7f3a\u7701\u7b56\u7565\u3002 appendfsync no #\u4ece\u4e0d\u540c\u6b65\u3002\u9ad8\u6548\u4f46\u662f\u6570\u636e\u4e0d\u4f1a\u88ab\u6301\u4e45\u5316\u3002","title":"4.2 AOF"},{"location":"linux/raid/raid.card/","text":"Raid\u5b9e\u6218 1. \u9635\u5217\u5361 \u00b6 \u7b80\u5355\u7684\u8bf4\uff0cRAID\u662f\u4e00\u79cd\u628a\u591a\u5757\u72ec\u7acb\u7684\u7269\u7406\u786c\u76d8\u6309\u4e0d\u540c\u65b9\u5f0f\u7ec4\u5408\u8d77\u6765\u5f62\u6210\u4e00\u4e2a\u903b\u8f91\u786c\u76d8\uff0c\u4ece\u800c\u63d0\u4f9b\u6bd4\u5355\u4e2a\u786c\u76d8\u6709\u7740\u66f4\u9ad8\u7684\u6027\u80fd\u548c\u63d0\u4f9b\u6570\u636e\u5197\u4f59\u7684\u6280\u672f\u3002 RAID\u5361\u4e00\u822c\u5206\u4e3a\u786cRAID\u5361\u548c\u8f6fRAID\u5361\u4e24\u79cd\uff0c\u901a\u8fc7\u7528\u786c\u4ef6\u6765\u5b9e\u73b0RAID\u529f\u80fd\u7684\u5c31\u662f\u786cRAID\uff0c\u72ec\u7acb\u7684RAID\u5361\uff0c\u4e3b\u677f\u96c6\u6210\u7684RAID\u82af\u7247\u90fd\u662f\u786cRAID\u3002\u901a\u8fc7\u8f6f\u4ef6\u5e76\u4f7f\u7528CPU\u7684RAID\u5361\u662f\u6307\u4f7f\u7528CPU\u6765\u5b8c\u6210RAID\u7684\u5e38\u7528\u8ba1\u7b97\uff0c\u8f6f\u4ef6RAID\u5360\u7528CPU\u8d44\u6e90\u8f83\u9ad8\uff0c\u7edd\u5927\u90e8\u5206\u670d\u52a1\u5668\u8bbe\u5907\u662f\u786c\u4ef6RAID\u3002 2. \u9635\u5217\u5361\u63a5\u53e3 \u00b6 \u63a5\u53e3\u662f\u6307\u652f\u6301\u7684\u63a5\u53e3\uff0c\u76ee\u524d\u4e3b\u8981\u6709\u56db\u79cd\uff1aIDE\u63a5\u53e3\u3001SCSI\u63a5\u53e3\u3001SATA\u63a5\u53e3\u548cSAS\u63a5\u53e3\u3002 IDE\u63a5\u53e3\uff08\u5df2\u88ab\u6dd8\u6c70\uff09 IDE\u7684\u82f1\u6587\u5168\u79f0\u4e3a\u201cIntegrated Drive Electronics\u201d\uff0c\u5373\u201c\u7535\u5b50\u96c6\u6210\u9a71\u52a8\u5668\u201d\uff0c\u5b83\u7684\u672c\u610f\u662f\u6307\u628a\u201c\u786c\u76d8\u63a7\u5236\u5668\u201d\u4e0e\u201c\u76d8\u4f53\u201d\u96c6\u6210\u5728\u4e00\u8d77\u7684\u786c\u76d8\u9a71\u52a8\u5668\u3002\u628a\u76d8\u4f53\u4e0e\u63a7\u5236\u5668\u96c6\u6210\u5728\u4e00\u8d77\u7684\u505a\u6cd5\u51cf\u5c11\u4e86\u786c\u76d8\u63a5\u53e3\u7684\u7535\u7f06\u6570\u76ee\u4e0e\u957f\u5ea6\uff0c\u6570\u636e\u4f20\u8f93\u7684\u53ef\u9760\u6027\u5f97\u5230\u4e86\u589e\u5f3a\uff0c\u786c\u76d8\u5236\u9020\u8d77\u6765\u53d8\u5f97\u66f4\u5bb9\u6613\uff0c\u56e0\u4e3a\u786c\u76d8\u751f\u4ea7\u5382\u5546\u4e0d\u9700\u8981\u518d\u62c5\u5fc3\u81ea\u5df1\u7684\u786c\u76d8\u662f\u5426\u4e0e\u5176\u5b83\u5382\u5546\u751f\u4ea7\u7684\u63a7\u5236\u5668\u517c\u5bb9\uff0c\u5bf9\u7528\u6237\u800c\u8a00\uff0c\u786c\u76d8\u5b89\u88c5\u8d77\u6765\u4e5f\u66f4\u4e3a\u65b9\u4fbf\u3002IDE\u8fd9\u4e00\u63a5\u53e3\u6280\u672f\u4ece\u8bde\u751f\u81f3\u4eca\u5c31\u4e00\u76f4\u5728\u4e0d\u65ad\u53d1\u5c55\uff0c\u6027\u80fd\u4e5f\u4e0d\u65ad\u7684\u63d0\u9ad8\uff0c\u5176\u62e5\u6709\u7684\u4ef7\u683c\u4f4e\u5ec9\u3001\u517c\u5bb9\u6027\u5f3a\u7684\u7279\u70b9\uff0c\u4e3a\u5176\u9020\u5c31\u4e86\u5176\u5b83\u7c7b\u578b\u786c\u76d8\u65e0\u6cd5\u66ff\u4ee3\u7684\u5730\u4f4d\u3002 IDE\u4ee3\u8868\u7740\u786c\u76d8\u7684\u4e00\u79cd\u7c7b\u578b\uff0c\u4f46\u5728\u5b9e\u9645\u7684\u5e94\u7528\u4e2d\uff0c\u4eba\u4eec\u4e5f\u4e60\u60ef\u7528IDE\u6765\u79f0\u547c\u6700\u65e9\u51fa\u73b0IDE\u7c7b\u578b\u786c\u76d8ATA-1\uff0c\u8fd9\u79cd\u7c7b\u578b\u7684\u63a5\u53e3\u968f\u7740\u63a5\u53e3\u6280\u672f\u7684\u53d1\u5c55\u5df2\u7ecf\u88ab\u6dd8\u6c70\u4e86\uff0c\u800c\u5176\u540e\u53d1\u5c55\u5206\u652f\u51fa\u66f4\u591a\u7c7b\u578b\u7684\u786c\u76d8\u63a5\u53e3\uff0c\u6bd4\u5982ATA\u3001Ultra ATA\u3001DMA\u3001Ultra DMA\u7b49\u63a5\u53e3\u90fd\u5c5e\u4e8eIDE\u786c\u76d8\u3002\u6b64\u5916\uff0c\u7531\u4e8eIDE\u53e3\u5c5e\u4e8e\u5e76\u884c\u63a5\u53e3\uff0c\u56e0\u6b64\u4e3a\u4e86\u548cSATA\u53e3\u786c\u76d8\u76f8\u533a\u522b\uff0cIDE\u53e3\u786c\u76d8\u4e5f\u53ebPATA\u53e3\u786c\u76d8\u3002 SCSI\u63a5\u53e3 SCSI\u7684\u82f1\u6587\u5168\u79f0\u4e3a\u201cSmall Computer System Interface\u201d\uff08\u5c0f\u578b\u8ba1\u7b97\u673a\u7cfb\u7edf\u63a5\u53e3\uff09\uff0c\u662f\u540cIDE\u5b8c\u5168\u4e0d\u540c\u7684\u63a5\u53e3\uff0cIDE\u63a5\u53e3\u662f\u666e\u901aPC\u7684\u6807\u51c6\u63a5\u53e3\uff0c\u800cSCSI\u5e76\u4e0d\u662f\u4e13\u95e8\u4e3a\u786c\u76d8\u8bbe\u8ba1\u7684\u63a5\u53e3\uff0c\u662f\u4e00\u79cd\u5e7f\u6cdb\u5e94\u7528\u4e8e\u5c0f\u578b\u673a\u4e0a\u7684\u9ad8\u901f\u6570\u636e\u4f20\u8f93\u6280\u672f\u3002SCSI\u63a5\u53e3\u5177\u6709\u5e94\u7528\u8303\u56f4\u5e7f\u3001\u591a\u4efb\u52a1\u3001\u5e26\u5bbd\u5927\u3001CPU\u5360\u7528\u7387\u4f4e\uff0c\u4ee5\u53ca\u652f\u6301\u70ed\u63d2\u62d4\u7b49\u4f18\u70b9\uff0c\u4f46\u8f83\u9ad8\u7684\u4ef7\u683c\u4f7f\u5f97\u5b83\u5f88\u96be\u5982IDE\u786c\u76d8\u822c\u666e\u53ca\uff0c\u56e0\u6b64SCSI\u786c\u76d8\u4e3b\u8981\u5e94\u7528\u4e8e\u4e2d\u3001\u9ad8\u7aef\u548c\u9ad8\u6863\u5de5\u4f5c\u7ad9\u4e2d\u3002SCSI\u786c\u76d8\u548c\u666e\u901aIDE\u786c\u76d8\u76f8\u6bd4\u6709\u5f88\u591a\u4f18\u70b9\uff1a\u63a5\u53e3\u901f\u5ea6\u5feb\uff0c\u5e76\u4e14\u7531\u4e8e\u4e3b\u8981\u7528\u4e8e\u670d\u52a1\u5668\uff0c\u56e0\u6b64\u786c\u76d8\u672c\u8eab\u7684\u6027\u80fd\u4e5f\u6bd4\u8f83\u9ad8\uff0c\u786c\u76d8\u8f6c\u901f\u5feb\uff0c\u7f13\u5b58\u5bb9\u91cf\u5927\uff0cCPU\u5360\u7528\u7387\u4f4e\uff0c\u6269\u5c55\u6027\u8fdc\u4f18\u4e8eIDE\u786c\u76d8\uff0c\u5e76\u4e14\u652f\u6301\u70ed\u63d2\u62d4\u3002 SATA\u63a5\u53e3 \u4f7f\u7528SATA\uff08Serial ATA\uff09\u53e3\u7684\u786c\u76d8\u53c8\u53eb\u4e32\u53e3\u786c\u76d8\uff0c\u662f\u76ee\u524dPC\u786c\u76d8\u7684\u4e3b\u6d41\u30022001\u5e74\uff0c\u7531Intel\u3001APT\u3001Dell\u3001IBM\u3001\u5e0c\u6377\u3001\u8fc8\u62d3\u8fd9\u51e0\u5927\u5382\u5546\u7ec4\u6210\u7684Serial ATA\u59d4\u5458\u4f1a\u6b63\u5f0f\u786e\u7acb\u4e86Serial ATA 1.0\u89c4\u8303\uff0c2002\u5e74\uff0c\u867d\u7136\u4e32\u884cATA\u7684\u76f8\u5173\u8bbe\u5907\u8fd8\u672a\u6b63\u5f0f\u4e0a\u5e02\uff0c\u4f46Serial ATA\u59d4\u5458\u4f1a\u5df2\u62a2\u5148\u786e\u7acb\u4e86Serial ATA 2.0\u89c4\u8303\u3002Serial ATA\u91c7\u7528\u4e32\u884c\u8fde\u63a5\u65b9\u5f0f\uff0c\u4e32\u884cATA\u603b\u7ebf\u4f7f\u7528\u5d4c\u5165\u5f0f\u65f6\u949f\u4fe1\u53f7\uff0c\u5177\u5907\u4e86\u66f4\u5f3a\u7684\u7ea0\u9519\u80fd\u529b\uff0c\u4e0e\u4ee5\u5f80\u76f8\u6bd4\u5176\u6700\u5927\u7684\u533a\u522b\u5728\u4e8e\u80fd\u5bf9\u4f20\u8f93\u6307\u4ee4\uff08\u4e0d\u4ec5\u4ec5\u662f\u6570\u636e\uff09\u8fdb\u884c\u68c0\u67e5\uff0c\u5982\u679c\u53d1\u73b0\u9519\u8bef\u4f1a\u81ea\u52a8\u77eb\u6b63\uff0c\u8fd9\u5728\u5f88\u5927\u7a0b\u5ea6\u4e0a\u63d0\u9ad8\u4e86\u6570\u636e\u4f20\u8f93\u7684\u53ef\u9760\u6027\u3002\u4e32\u884c\u63a5\u53e3\u8fd8\u5177\u6709\u7ed3\u6784\u7b80\u5355\u3001\u652f\u6301\u70ed\u63d2\u62d4\u7684\u4f18\u70b9\u3002 \u4e32\u53e3\u786c\u76d8\u662f\u4e00\u79cd\u5b8c\u5168\u4e0d\u540c\u4e8e\u5e76\u884cATA\u7684\u786c\u76d8\u63a5\u53e3\u7c7b\u578b\uff0c\u7531\u4e8e\u91c7\u7528\u4e32\u884c\u65b9\u5f0f\u4f20\u8f93\u6570\u636e\u800c\u77e5\u540d\u3002\u76f8\u5bf9\u4e8e\u5e76\u884cATA\u6765\u8bf4\uff0c\u5c31\u5177\u6709\u975e\u5e38\u591a\u7684\u4f18\u52bf\u3002\u9996\u5148\uff0cSerial ATA\u4ee5\u8fde\u7eed\u4e32\u884c\u7684\u65b9\u5f0f\u4f20\u9001\u6570\u636e\uff0c\u4e00\u6b21\u53ea\u4f1a\u4f20\u90011\u4f4d\u6570\u636e\u3002\u8fd9\u6837\u80fd\u51cf\u5c11SATA\u63a5\u53e3\u7684\u9488\u811a\u6570\u76ee\uff0c\u4f7f\u8fde\u63a5\u7535\u7f06\u6570\u76ee\u53d8\u5c11\uff0c\u6548\u7387\u4e5f\u4f1a\u66f4\u9ad8\u3002\u5b9e\u9645\u4e0a\uff0cSerial ATA \u4ec5\u7528\u56db\u652f\u9488\u811a\u5c31\u80fd\u5b8c\u6210\u6240\u6709\u7684\u5de5\u4f5c\uff0c\u5206\u522b\u7528\u4e8e\u8fde\u63a5\u7535\u7f06\u3001\u8fde\u63a5\u5730\u7ebf\u3001\u53d1\u9001\u6570\u636e\u548c\u63a5\u6536\u6570\u636e\uff0c\u540c\u65f6\u8fd9\u6837\u7684\u67b6\u6784\u8fd8\u80fd\u964d\u4f4e\u7cfb\u7edf\u80fd\u8017\u548c\u51cf\u5c0f\u7cfb\u7edf\u590d\u6742\u6027\u3002\u5176\u6b21\uff0cSerial ATA\u7684\u8d77\u70b9\u66f4\u9ad8\u3001\u53d1\u5c55\u6f5c\u529b\u66f4\u5927\uff0cSerial ATA 1.0\u5b9a\u4e49\u7684\u6570\u636e\u4f20\u8f93\u7387\u4e3a150MB/s\uff0c\u8fd9\u6bd4\u5e76\u884cATA\uff08\u5373ATA/133\uff09\u6240\u80fd\u8fbe\u5230133MB/s\u7684\u6700\u9ad8\u6570\u636e\u4f20\u8f93\u7387\u8fd8\u9ad8\uff0c\u800c\u5728Serial ATA 2.0\u7684\u6570\u636e\u4f20\u8f93\u7387\u8fbe\u5230300MB/s\uff0cSATA Revision 3.0\u53ef\u8fbe\u5230750 MB/s\u7684\u6700\u9ad8\u6570\u636e\u4f20\u8f93\u7387\u3002 [1] SAS\u63a5\u53e3 SAS\u662f\u65b0\u4e00\u4ee3\u7684SCSI\u6280\u672f\uff0c\u548c\u73b0\u5728\u6d41\u884c\u7684Serial ATA(SATA)\u786c\u76d8\u76f8\u540c\uff0c\u90fd\u662f\u91c7\u7528\u4e32\u884c\u6280\u672f\u4ee5\u83b7\u5f97\u66f4\u9ad8\u7684\u4f20\u8f93\u901f\u5ea6\uff0c\u5e76\u901a\u8fc7\u7f29\u77ed\u8fde\u7ed3\u7ebf\u6539\u5584\u5185\u90e8\u7a7a\u95f4\u7b49\u3002SAS\u662f\u5e76\u884cSCSI\u63a5\u53e3\u4e4b\u540e\u5f00\u53d1\u51fa\u7684\u5168\u65b0\u63a5\u53e3\u3002\u6b64\u63a5\u53e3\u7684\u8bbe\u8ba1\u662f\u4e3a\u4e86\u6539\u5584\u5b58\u50a8\u7cfb\u7edf\u7684\u6548\u80fd\u3001\u53ef\u7528\u6027\u548c\u6269\u5145\u6027\uff0c\u63d0\u4f9b\u4e0e\u4e32\u884cATA (Serial ATA\uff0c\u7f29\u5199\u4e3aSATA)\u786c\u76d8\u7684\u517c\u5bb9\u6027\u3002 SAS\u7684\u63a5\u53e3\u6280\u672f\u53ef\u4ee5\u5411\u4e0b\u517c\u5bb9SATA\u3002SAS\u7cfb\u7edf\u7684\u80cc\u677f(Backpanel)\u65e2\u53ef\u4ee5\u8fde\u63a5\u5177\u6709\u53cc\u7aef\u53e3\u3001\u9ad8\u6027\u80fd\u7684SAS\u9a71\u52a8\u5668\uff0c\u4e5f\u53ef\u4ee5\u8fde\u63a5\u9ad8\u5bb9\u91cf\u3001\u4f4e\u6210\u672c\u7684SATA\u9a71\u52a8\u5668\u3002\u56e0\u4e3aSAS\u9a71\u52a8\u5668\u7684\u7aef\u53e3\u4e0eSATA\u9a71\u52a8\u5668\u7684\u7aef\u53e3\u5f62\u72b6\u770b\u4e0a\u53bb\u7c7b\u4f3c\uff0c\u6240\u4ee5SAS\u9a71\u52a8\u5668\u548cSATA\u9a71\u52a8\u5668\u53ef\u4ee5\u540c\u65f6\u5b58\u5728\u4e8e\u4e00\u4e2a\u5b58\u50a8\u7cfb\u7edf\u4e4b\u4e2d\u3002\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cSATA\u7cfb\u7edf\u5e76\u4e0d\u517c\u5bb9SAS\uff0c\u6240\u4ee5SAS\u9a71\u52a8\u5668\u4e0d\u80fd\u8fde\u63a5\u5230SATA\u80cc\u677f\u4e0a\u3002\u7531\u4e8eSAS\u7cfb\u7edf\u7684\u517c\u5bb9\u6027\uff0cIT\u4eba\u5458\u80fd\u591f\u8fd0\u7528\u4e0d\u540c\u63a5\u53e3\u7684\u786c\u76d8\u6765\u6ee1\u8db3\u5404\u7c7b\u5e94\u7528\u5728\u5bb9\u91cf\u4e0a\u6216\u6548\u80fd\u4e0a\u7684\u9700\u6c42\uff0c\u56e0\u6b64\u5728\u6269\u5145\u5b58\u50a8\u7cfb\u7edf\u65f6\u62e5\u6709\u66f4\u591a\u7684\u5f39\u6027\uff0c\u8ba9\u5b58\u50a8\u8bbe\u5907\u53d1\u6325\u6700\u5927\u7684\u6295\u8d44\u6548\u76ca\u3002 3. \u751f\u4ea7 \u00b6 \u6211\u4ee5\u751f\u6210\u7ebf\u4e0a\u4f7f\u7528\u7684\u9635\u5217\u5361\u4e3a\u4f8b\uff0c\u6765\u8bb2\u8ff0\u5982\u4f55\u4f7f\u7528\u3002\u6211\u4eec\u5b89\u88c5\u597dpcie\u63a5\u53e3[ PCIE ]\u7684\u9635\u5217\u5361\u3002\u7136\u540e\u5f00\u673a\uff0c\u8fdb\u5165\u9635\u5217\u5361\u914d\u7f6e\u754c\u9762\u914d\u7f6e[ \u67d0\u9635\u5217\u5361\u914d\u7f6e\u6559\u7a0b ]. \u914d\u7f6e\u5b8craid\u5361\u4ee5\u540e\u3002\u5f00\u673a\uff0c\u5b89\u88c5\u7cfb\u7edf\u3002\u7136\u540e\u90e8\u7f72\u9488\u5bf9\u81ea\u5df1raid\u5361\u54c1\u724c\u7684\u811a\u672c\u6765\u76d1\u63a7\u548c\u68c0\u67e5\u78c1\u76d8\u9635\u5217\u91cc\u9762\u78c1\u76d8\u7684\u60c5\u51b5\u3002 root@root:/opt/3ware/CLI# /opt/3ware/CLI/tw_cli show Ctl Model (V)Ports Drives Units NotOpt RRate VRate BBU ------------------------------------------------------------------------ c0 9750-24i4e 24 24 5 0 1 1 - root@root:/opt/3ware/CLI# /opt/3ware/CLI/tw_cli /c0 show all /c0 Driver Version = 3.26.02.000 /c0 Model = 9750-24i4e /c0 Available Memory = 488MB /c0 Firmware Version = FH9X 5.12.00.007 /c0 Bios Version = BE9X 5.11.00.006 /c0 Boot Loader Version = BT9X 6.00.00.004 /c0 Serial Number = SV05217695 /c0 PCB Version = Rev 001 /c0 PCHIP Version = B4 /c0 ACHIP Version = 05000e00 /c0 Controller Phys = 28 /c0 Connections = 24 of 128 /c0 Drives = 24 of 127 /c0 Units = 5 of 127 /c0 Active Drives = 24 of 127 /c0 Active Units = 3 of 32 /c0 Max Drives Per Unit = 32 /c0 Total Optimal Units = 5 /c0 Not Optimal Units = 0 /c0 Disk Spinup Policy = 8 /c0 Spinup Stagger Time Policy (sec) = 0 /c0 Auto-Carving Policy = off /c0 Auto-Carving Size = 2048 GB /c0 Auto-Rebuild Policy = on /c0 Rebuild Mode = Adaptive /c0 Rebuild Rate = 1 /c0 Verify Mode = Adaptive /c0 Verify Rate = 1 /c0 Controller Bus Type = PCIe /c0 Controller Bus Width = 8 lanes /c0 Controller Bus Speed = 5.0 Gbps/lane Unit UnitType Status %RCmpl %V/I/M Stripe Size(GB) Cache AVrfy ------------------------------------------------------------------------------ u0 RAID-1 OK - - - 1862.63 Ri ON u1 RAID-10 OK - - 256K 3725.27 Ri ON u2 RAID-10 OK - - 256K 14901.1 Ri ON u3 SPARE OK - - - 1863.01 - OFF u4 SPARE OK - - - 1863.01 - OFF VPort Status Unit Size Type Phy Encl-Slot Model ------------------------------------------------------------------------------ p0 OK u1 1.82 TB SATA 0 - WDC WD2003FYYS-02W0 p1 OK u1 1.82 TB SATA 1 - WDC WD2003FYYS-02W0 p2 OK u1 1.82 TB SATA 2 - WDC WD2003FYYS-02W0 p3 OK u3 1.82 TB SATA 3 - WDC WD2004FBYZ-01YC p4 OK u4 1.82 TB SATA 4 - WDC WD2004FBYZ-01YC p5 OK u2 1.82 TB SATA 5 - WDC WD2003FYYS-02W0 p6 OK u2 1.82 TB SATA 6 - WDC WD2003FYYS-02W0 p7 OK u2 1.82 TB SATA 7 - WDC WD2003FYYS-02W0 p8 OK u2 1.82 TB SATA 8 - WDC WD2003FYYS-02W0 p9 OK u2 1.82 TB SATA 9 - WDC WD2003FYYS-02W0 p10 OK u2 1.82 TB SATA 10 - WDC WD2003FYYS-02W0 p11 OK u2 1.82 TB SATA 11 - WDC WD2003FYYS-02W0 p12 OK u0 1.82 TB SATA 12 - WDC WD2003FYYS-02W0 p13 OK u0 1.82 TB SATA 13 - WDC WD2003FYYS-02W0 p14 OK u2 1.82 TB SATA 14 - WDC WD2003FYYS-02W0 p15 OK u2 1.82 TB SATA 15 - WDC WD2003FYYS-02W0 p16 OK u2 1.82 TB SATA 16 - WDC WD2003FYYS-02W0 p17 OK u2 1.82 TB SATA 17 - WDC WD2003FYYS-02W0 p18 OK u2 1.82 TB SATA 18 - WDC WD2003FYYS-02W0 p19 OK u2 1.82 TB SATA 19 - WDC WD2003FYYS-02W0 p20 OK u2 1.82 TB SATA 20 - WDC WD2003FYYS-02W0 p21 OK u2 1.82 TB SATA 21 - WDC WD2003FYYS-02W0 p22 OK u1 1.82 TB SATA 22 - WDC WD2003FYYS-02W0 p23 OK u2 1.82 TB SATA 23 - WDC WD2003FYYS-02W0 \u89e3\u91ca 1. \u6211\u4eec\u80fd\u4ece\u4e0a\u9762\u7684\u547d\u4ee4\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\u7cfb\u7edf\u6709\u591a\u5c11\u4e2a\u786c\u76d8\uff0c raid\u7684\u6a21\u5f0f \uff0c\u78c1\u76d8\u76f8\u5173\u4fe1\u606f 2. \u53ef\u4ee5\u901a\u8fc7\u8be5\u547d\u4ee4\u7f16\u5199\u5bf9\u5e94\u7684\u811a\u672c 4. \u811a\u672c \u00b6 #!/bin/bash # ============================================================================== # Disk smart and raid Statistics plugin for Nagios # # Written by : caimengzhi # Release : 1.0 # Description : shows detail raid info and checkded smart reeult for all disk # USAGE : ./check_raid_smart.sh # # ---------------------------------------------------------------------------------------- # Nagios return codes STATE_OK=0 STATE_WARNING=1 STATE_CRITICAL=2 STATE_UNKOWN=3 #Plugin variable description PRONAME=$(basename $0) RELEASE=\"Version 1.0\" AUTHOR=\"caimengzhi\" #Tools used in plugin TW_CLI=\"/usr/sbin/tw_cli_64\" SMARTCTL=\"/usr/sbin/smartctl\" #TMP file used in plugin TMP_DIR=\"/usr/local/nagios/disk_smart\" TMP_CONTROL=\"/usr/local/nagios/disk_smart/tmp_control.txt\" TMP_DISK=\"/usr/local/nagios/disk_smart/tmp_disk.txt\" TMP_VIRTUAL_DISK=\"/usr/local/nagios/disk_smart/tmp_virtual_disk.txt\" TMP_DISK_RESULT=\"/usr/local/nagios/disk_smart/tmp_disk_result.txt\" TMP_DISK_HTML_U=\"/usr/local/nagios/disk_smart/tmp_disk_html_u.txt\" TMP_DISK_HTML_P=\"/usr/local/nagios/disk_smart/tmp_disk_html_p.txt\" #check tool if [ ! -f $TW_CLI ] || [ ! -f $SMARTCTL ];then echo \"can't command tw_cli_64 or smartctl used in script !\" exit $STATE_UNKOWN fi #check dir if [ ! -d $TMP_DIR ];then mkdir $TMP_DIR fi u_html(){ printf \"<div>\" printf \"<table border=1>\" printf \"<tr>\" printf \"<th>Unit</th>\" printf \"<th>UnitType</th>\" printf \"<th>Status</th>\" printf \"<th>%%RCmpl</th>\" printf \"<th>%%V/I/M</th>\" printf \"<th>Stripe</th>\" printf \"<th>Size(GB)</th>\" printf \"<th>Cache</th>\" printf \"<th>AVrfy</th>\" printf \"</tr>\" local unum=`cat $TMP_DISK_HTML_U | wc -l` for (( i=1; i<=$unum; i++));do uinfo=(`cat $TMP_DISK_HTML_U | sed -n \"$i\"p`) printf \"<tr>\" for ((j=0; j<=8; j++));do printf \"<td>${uinfo[$j]}</td>\" done printf \"</tr>\" done printf \"</table>\" printf \"</div>\" } p_html(){ printf \"<div>\" printf \"<table border=1>\" printf \"<tr>\" printf \"<th>VPort</th>\" printf \"<th>Status</th>\" printf \"<th>Unit</th>\" printf \"<th>Size</th>\" printf \"<th>Type</th>\" printf \"<th>Phy</th>\" printf \"<th>Encl-Slot</th>\" printf \"<th>Model</th>\" printf \"<th>Health</th>\" printf \"</tr>\" local pnum=`cat $TMP_DISK_HTML_P | wc -l` for (( i=1; i<=$pnum; i++));do pinfo=(`cat $TMP_DISK_HTML_P | sed -n \"$i\"p`) printf \"<tr>\" content=\"\" for ((j=0; j<=10; j++));do content=${pinfo[$j]} if [ $j -eq 3 ] || [ $j -eq 8 ];then content=${pinfo[$j]}${pinfo[ $j + 1 ]} else if [ $j -eq 4 ] || [ $j -eq 9 ];then continue fi fi printf \"<td>$content</td>\" done done printf \"</tr>\" printf \"</table>\" printf \"</div>\" } #start to get raid and smart info CONTROL_LIST=`$TW_CLI show | grep '^c[0-9].*'|awk '{print $1}' > $TMP_CONTROL` CONTROL_NUM=`cat $TMP_CONTROL | wc -l` c=1 while [ $c -le $CONTROL_NUM ] do cname[$c]=`cat $TMP_CONTROL | sed -n \"${c}p\"| awk '{print $1}'` let c++ done ERRCOUNT=0 declare -a DISK_ERR_ARRAY ERRFLAG=0 DISK_TOTAL=0 i=1 while [ $i -le $CONTROL_NUM ] do RR=`$TW_CLI /${cname[$i]} show | grep '^p[0-9].*' > $TMP_DISK_RESULT` PHY_LIST=`$TW_CLI /${cname[$i]} show | grep '^p[0-9].*' |awk '{print $7}' > $TMP_DISK` PHY_COUNT=`cat $TMP_DISK | wc -l` DISK_TOTAL=$[$DISK_TOTAL + $PHY_COUNT] $TW_CLI /${cname[$i]} show |grep '^u[0-9].*' >> $TMP_DISK_HTML_U j=1 while [ $j -le $PHY_COUNT ] do PHYS=`cat $TMP_DISK | sed -n \"${j}p\"` if [ \"$PHYS\" == \"-\" ] then DISK_TOTAL=$[$DISK_TOTAL - 1 ] let j++ continue fi RAID_INFO=`cat $TMP_DISK_RESULT | grep \" $PHYS \"` RAID_HEALTH=`cat $TMP_DISK_RESULT | grep \" $PHYS \" | awk '{print $2}'` SMART_HEALTH=`$SMARTCTL -H -d 3ware,${PHYS} /dev/twl0|sed -n '5p' | awk '{print $6}'` if [ \"$SMART_HEALTH\" != \"PASSED\" ] || [ \"$RAID_HEALTH\" != \"OK\" ];then ERR_COUNTROL=`cat $TMP_CONTROL | sed -n \"${i}p\"| awk '{print $1}'` ERRFLAG=1 DISK_ERR_ARRAY[$ERRCOUNT]=\"disk ${PHYS} on controller $ERR_COUNTROL \" let ERRCOUNT++ attribute=`/usr/sbin/smartctl -H -d 3ware,${PHYS} /dev/twl0 | sed -n '4,$p'` echo -e \"$attribute\" fi if [ $ERRFLAG -eq 1 ];then RAID_INFO=$RAID_INFO\" FAILED\" else RAID_INFO=$RAID_INFO\" PASSED\" fi echo \"$RAID_INFO\" >> $TMP_DISK_HTML_P let j++ done let i++ done # get html output echo \"DISK Raid&Smart Statistics\" u_html p_html # clear tmp file echo \"\" > $TMP_DISK_HTML_U echo \"\" > $TMP_DISK_HTML_P if [ $ERRFLAG -eq 0 ] then echo \"SMART OK - All disk OK ($DISK_TOTAL checked on $CONTROL_NUM controller) | TotalDisk=$DISK_TOTAL HealthDisk=$DISK_TOTAL FaildDisk=$ERRCOUNT\" exit $OK else k=0 ERR=\"\" while [ $k -le $ERRCOUNT ];do ERR=${ERR}\"${DISK_ERR_ARRAY[$k]}\" let k++ done echo -e \"SMART CRITICAL - $ERRCOUNT of $DISK_TOTAL disk failed! ($ERR) | TotalDisk=$DISK_TOTAL HealthDisk=$[ $DISK_TOTAL - ERRCOUNT ] FailedDisk=$ERRCOUNT\" exit $CRITICAL fi 5. nagios\u56fe \u00b6 :","title":"2. raid \u5b9e\u6218"},{"location":"linux/raid/raid.card/#1","text":"\u7b80\u5355\u7684\u8bf4\uff0cRAID\u662f\u4e00\u79cd\u628a\u591a\u5757\u72ec\u7acb\u7684\u7269\u7406\u786c\u76d8\u6309\u4e0d\u540c\u65b9\u5f0f\u7ec4\u5408\u8d77\u6765\u5f62\u6210\u4e00\u4e2a\u903b\u8f91\u786c\u76d8\uff0c\u4ece\u800c\u63d0\u4f9b\u6bd4\u5355\u4e2a\u786c\u76d8\u6709\u7740\u66f4\u9ad8\u7684\u6027\u80fd\u548c\u63d0\u4f9b\u6570\u636e\u5197\u4f59\u7684\u6280\u672f\u3002 RAID\u5361\u4e00\u822c\u5206\u4e3a\u786cRAID\u5361\u548c\u8f6fRAID\u5361\u4e24\u79cd\uff0c\u901a\u8fc7\u7528\u786c\u4ef6\u6765\u5b9e\u73b0RAID\u529f\u80fd\u7684\u5c31\u662f\u786cRAID\uff0c\u72ec\u7acb\u7684RAID\u5361\uff0c\u4e3b\u677f\u96c6\u6210\u7684RAID\u82af\u7247\u90fd\u662f\u786cRAID\u3002\u901a\u8fc7\u8f6f\u4ef6\u5e76\u4f7f\u7528CPU\u7684RAID\u5361\u662f\u6307\u4f7f\u7528CPU\u6765\u5b8c\u6210RAID\u7684\u5e38\u7528\u8ba1\u7b97\uff0c\u8f6f\u4ef6RAID\u5360\u7528CPU\u8d44\u6e90\u8f83\u9ad8\uff0c\u7edd\u5927\u90e8\u5206\u670d\u52a1\u5668\u8bbe\u5907\u662f\u786c\u4ef6RAID\u3002","title":"1. \u9635\u5217\u5361"},{"location":"linux/raid/raid.card/#2","text":"\u63a5\u53e3\u662f\u6307\u652f\u6301\u7684\u63a5\u53e3\uff0c\u76ee\u524d\u4e3b\u8981\u6709\u56db\u79cd\uff1aIDE\u63a5\u53e3\u3001SCSI\u63a5\u53e3\u3001SATA\u63a5\u53e3\u548cSAS\u63a5\u53e3\u3002 IDE\u63a5\u53e3\uff08\u5df2\u88ab\u6dd8\u6c70\uff09 IDE\u7684\u82f1\u6587\u5168\u79f0\u4e3a\u201cIntegrated Drive Electronics\u201d\uff0c\u5373\u201c\u7535\u5b50\u96c6\u6210\u9a71\u52a8\u5668\u201d\uff0c\u5b83\u7684\u672c\u610f\u662f\u6307\u628a\u201c\u786c\u76d8\u63a7\u5236\u5668\u201d\u4e0e\u201c\u76d8\u4f53\u201d\u96c6\u6210\u5728\u4e00\u8d77\u7684\u786c\u76d8\u9a71\u52a8\u5668\u3002\u628a\u76d8\u4f53\u4e0e\u63a7\u5236\u5668\u96c6\u6210\u5728\u4e00\u8d77\u7684\u505a\u6cd5\u51cf\u5c11\u4e86\u786c\u76d8\u63a5\u53e3\u7684\u7535\u7f06\u6570\u76ee\u4e0e\u957f\u5ea6\uff0c\u6570\u636e\u4f20\u8f93\u7684\u53ef\u9760\u6027\u5f97\u5230\u4e86\u589e\u5f3a\uff0c\u786c\u76d8\u5236\u9020\u8d77\u6765\u53d8\u5f97\u66f4\u5bb9\u6613\uff0c\u56e0\u4e3a\u786c\u76d8\u751f\u4ea7\u5382\u5546\u4e0d\u9700\u8981\u518d\u62c5\u5fc3\u81ea\u5df1\u7684\u786c\u76d8\u662f\u5426\u4e0e\u5176\u5b83\u5382\u5546\u751f\u4ea7\u7684\u63a7\u5236\u5668\u517c\u5bb9\uff0c\u5bf9\u7528\u6237\u800c\u8a00\uff0c\u786c\u76d8\u5b89\u88c5\u8d77\u6765\u4e5f\u66f4\u4e3a\u65b9\u4fbf\u3002IDE\u8fd9\u4e00\u63a5\u53e3\u6280\u672f\u4ece\u8bde\u751f\u81f3\u4eca\u5c31\u4e00\u76f4\u5728\u4e0d\u65ad\u53d1\u5c55\uff0c\u6027\u80fd\u4e5f\u4e0d\u65ad\u7684\u63d0\u9ad8\uff0c\u5176\u62e5\u6709\u7684\u4ef7\u683c\u4f4e\u5ec9\u3001\u517c\u5bb9\u6027\u5f3a\u7684\u7279\u70b9\uff0c\u4e3a\u5176\u9020\u5c31\u4e86\u5176\u5b83\u7c7b\u578b\u786c\u76d8\u65e0\u6cd5\u66ff\u4ee3\u7684\u5730\u4f4d\u3002 IDE\u4ee3\u8868\u7740\u786c\u76d8\u7684\u4e00\u79cd\u7c7b\u578b\uff0c\u4f46\u5728\u5b9e\u9645\u7684\u5e94\u7528\u4e2d\uff0c\u4eba\u4eec\u4e5f\u4e60\u60ef\u7528IDE\u6765\u79f0\u547c\u6700\u65e9\u51fa\u73b0IDE\u7c7b\u578b\u786c\u76d8ATA-1\uff0c\u8fd9\u79cd\u7c7b\u578b\u7684\u63a5\u53e3\u968f\u7740\u63a5\u53e3\u6280\u672f\u7684\u53d1\u5c55\u5df2\u7ecf\u88ab\u6dd8\u6c70\u4e86\uff0c\u800c\u5176\u540e\u53d1\u5c55\u5206\u652f\u51fa\u66f4\u591a\u7c7b\u578b\u7684\u786c\u76d8\u63a5\u53e3\uff0c\u6bd4\u5982ATA\u3001Ultra ATA\u3001DMA\u3001Ultra DMA\u7b49\u63a5\u53e3\u90fd\u5c5e\u4e8eIDE\u786c\u76d8\u3002\u6b64\u5916\uff0c\u7531\u4e8eIDE\u53e3\u5c5e\u4e8e\u5e76\u884c\u63a5\u53e3\uff0c\u56e0\u6b64\u4e3a\u4e86\u548cSATA\u53e3\u786c\u76d8\u76f8\u533a\u522b\uff0cIDE\u53e3\u786c\u76d8\u4e5f\u53ebPATA\u53e3\u786c\u76d8\u3002 SCSI\u63a5\u53e3 SCSI\u7684\u82f1\u6587\u5168\u79f0\u4e3a\u201cSmall Computer System Interface\u201d\uff08\u5c0f\u578b\u8ba1\u7b97\u673a\u7cfb\u7edf\u63a5\u53e3\uff09\uff0c\u662f\u540cIDE\u5b8c\u5168\u4e0d\u540c\u7684\u63a5\u53e3\uff0cIDE\u63a5\u53e3\u662f\u666e\u901aPC\u7684\u6807\u51c6\u63a5\u53e3\uff0c\u800cSCSI\u5e76\u4e0d\u662f\u4e13\u95e8\u4e3a\u786c\u76d8\u8bbe\u8ba1\u7684\u63a5\u53e3\uff0c\u662f\u4e00\u79cd\u5e7f\u6cdb\u5e94\u7528\u4e8e\u5c0f\u578b\u673a\u4e0a\u7684\u9ad8\u901f\u6570\u636e\u4f20\u8f93\u6280\u672f\u3002SCSI\u63a5\u53e3\u5177\u6709\u5e94\u7528\u8303\u56f4\u5e7f\u3001\u591a\u4efb\u52a1\u3001\u5e26\u5bbd\u5927\u3001CPU\u5360\u7528\u7387\u4f4e\uff0c\u4ee5\u53ca\u652f\u6301\u70ed\u63d2\u62d4\u7b49\u4f18\u70b9\uff0c\u4f46\u8f83\u9ad8\u7684\u4ef7\u683c\u4f7f\u5f97\u5b83\u5f88\u96be\u5982IDE\u786c\u76d8\u822c\u666e\u53ca\uff0c\u56e0\u6b64SCSI\u786c\u76d8\u4e3b\u8981\u5e94\u7528\u4e8e\u4e2d\u3001\u9ad8\u7aef\u548c\u9ad8\u6863\u5de5\u4f5c\u7ad9\u4e2d\u3002SCSI\u786c\u76d8\u548c\u666e\u901aIDE\u786c\u76d8\u76f8\u6bd4\u6709\u5f88\u591a\u4f18\u70b9\uff1a\u63a5\u53e3\u901f\u5ea6\u5feb\uff0c\u5e76\u4e14\u7531\u4e8e\u4e3b\u8981\u7528\u4e8e\u670d\u52a1\u5668\uff0c\u56e0\u6b64\u786c\u76d8\u672c\u8eab\u7684\u6027\u80fd\u4e5f\u6bd4\u8f83\u9ad8\uff0c\u786c\u76d8\u8f6c\u901f\u5feb\uff0c\u7f13\u5b58\u5bb9\u91cf\u5927\uff0cCPU\u5360\u7528\u7387\u4f4e\uff0c\u6269\u5c55\u6027\u8fdc\u4f18\u4e8eIDE\u786c\u76d8\uff0c\u5e76\u4e14\u652f\u6301\u70ed\u63d2\u62d4\u3002 SATA\u63a5\u53e3 \u4f7f\u7528SATA\uff08Serial ATA\uff09\u53e3\u7684\u786c\u76d8\u53c8\u53eb\u4e32\u53e3\u786c\u76d8\uff0c\u662f\u76ee\u524dPC\u786c\u76d8\u7684\u4e3b\u6d41\u30022001\u5e74\uff0c\u7531Intel\u3001APT\u3001Dell\u3001IBM\u3001\u5e0c\u6377\u3001\u8fc8\u62d3\u8fd9\u51e0\u5927\u5382\u5546\u7ec4\u6210\u7684Serial ATA\u59d4\u5458\u4f1a\u6b63\u5f0f\u786e\u7acb\u4e86Serial ATA 1.0\u89c4\u8303\uff0c2002\u5e74\uff0c\u867d\u7136\u4e32\u884cATA\u7684\u76f8\u5173\u8bbe\u5907\u8fd8\u672a\u6b63\u5f0f\u4e0a\u5e02\uff0c\u4f46Serial ATA\u59d4\u5458\u4f1a\u5df2\u62a2\u5148\u786e\u7acb\u4e86Serial ATA 2.0\u89c4\u8303\u3002Serial ATA\u91c7\u7528\u4e32\u884c\u8fde\u63a5\u65b9\u5f0f\uff0c\u4e32\u884cATA\u603b\u7ebf\u4f7f\u7528\u5d4c\u5165\u5f0f\u65f6\u949f\u4fe1\u53f7\uff0c\u5177\u5907\u4e86\u66f4\u5f3a\u7684\u7ea0\u9519\u80fd\u529b\uff0c\u4e0e\u4ee5\u5f80\u76f8\u6bd4\u5176\u6700\u5927\u7684\u533a\u522b\u5728\u4e8e\u80fd\u5bf9\u4f20\u8f93\u6307\u4ee4\uff08\u4e0d\u4ec5\u4ec5\u662f\u6570\u636e\uff09\u8fdb\u884c\u68c0\u67e5\uff0c\u5982\u679c\u53d1\u73b0\u9519\u8bef\u4f1a\u81ea\u52a8\u77eb\u6b63\uff0c\u8fd9\u5728\u5f88\u5927\u7a0b\u5ea6\u4e0a\u63d0\u9ad8\u4e86\u6570\u636e\u4f20\u8f93\u7684\u53ef\u9760\u6027\u3002\u4e32\u884c\u63a5\u53e3\u8fd8\u5177\u6709\u7ed3\u6784\u7b80\u5355\u3001\u652f\u6301\u70ed\u63d2\u62d4\u7684\u4f18\u70b9\u3002 \u4e32\u53e3\u786c\u76d8\u662f\u4e00\u79cd\u5b8c\u5168\u4e0d\u540c\u4e8e\u5e76\u884cATA\u7684\u786c\u76d8\u63a5\u53e3\u7c7b\u578b\uff0c\u7531\u4e8e\u91c7\u7528\u4e32\u884c\u65b9\u5f0f\u4f20\u8f93\u6570\u636e\u800c\u77e5\u540d\u3002\u76f8\u5bf9\u4e8e\u5e76\u884cATA\u6765\u8bf4\uff0c\u5c31\u5177\u6709\u975e\u5e38\u591a\u7684\u4f18\u52bf\u3002\u9996\u5148\uff0cSerial ATA\u4ee5\u8fde\u7eed\u4e32\u884c\u7684\u65b9\u5f0f\u4f20\u9001\u6570\u636e\uff0c\u4e00\u6b21\u53ea\u4f1a\u4f20\u90011\u4f4d\u6570\u636e\u3002\u8fd9\u6837\u80fd\u51cf\u5c11SATA\u63a5\u53e3\u7684\u9488\u811a\u6570\u76ee\uff0c\u4f7f\u8fde\u63a5\u7535\u7f06\u6570\u76ee\u53d8\u5c11\uff0c\u6548\u7387\u4e5f\u4f1a\u66f4\u9ad8\u3002\u5b9e\u9645\u4e0a\uff0cSerial ATA \u4ec5\u7528\u56db\u652f\u9488\u811a\u5c31\u80fd\u5b8c\u6210\u6240\u6709\u7684\u5de5\u4f5c\uff0c\u5206\u522b\u7528\u4e8e\u8fde\u63a5\u7535\u7f06\u3001\u8fde\u63a5\u5730\u7ebf\u3001\u53d1\u9001\u6570\u636e\u548c\u63a5\u6536\u6570\u636e\uff0c\u540c\u65f6\u8fd9\u6837\u7684\u67b6\u6784\u8fd8\u80fd\u964d\u4f4e\u7cfb\u7edf\u80fd\u8017\u548c\u51cf\u5c0f\u7cfb\u7edf\u590d\u6742\u6027\u3002\u5176\u6b21\uff0cSerial ATA\u7684\u8d77\u70b9\u66f4\u9ad8\u3001\u53d1\u5c55\u6f5c\u529b\u66f4\u5927\uff0cSerial ATA 1.0\u5b9a\u4e49\u7684\u6570\u636e\u4f20\u8f93\u7387\u4e3a150MB/s\uff0c\u8fd9\u6bd4\u5e76\u884cATA\uff08\u5373ATA/133\uff09\u6240\u80fd\u8fbe\u5230133MB/s\u7684\u6700\u9ad8\u6570\u636e\u4f20\u8f93\u7387\u8fd8\u9ad8\uff0c\u800c\u5728Serial ATA 2.0\u7684\u6570\u636e\u4f20\u8f93\u7387\u8fbe\u5230300MB/s\uff0cSATA Revision 3.0\u53ef\u8fbe\u5230750 MB/s\u7684\u6700\u9ad8\u6570\u636e\u4f20\u8f93\u7387\u3002 [1] SAS\u63a5\u53e3 SAS\u662f\u65b0\u4e00\u4ee3\u7684SCSI\u6280\u672f\uff0c\u548c\u73b0\u5728\u6d41\u884c\u7684Serial ATA(SATA)\u786c\u76d8\u76f8\u540c\uff0c\u90fd\u662f\u91c7\u7528\u4e32\u884c\u6280\u672f\u4ee5\u83b7\u5f97\u66f4\u9ad8\u7684\u4f20\u8f93\u901f\u5ea6\uff0c\u5e76\u901a\u8fc7\u7f29\u77ed\u8fde\u7ed3\u7ebf\u6539\u5584\u5185\u90e8\u7a7a\u95f4\u7b49\u3002SAS\u662f\u5e76\u884cSCSI\u63a5\u53e3\u4e4b\u540e\u5f00\u53d1\u51fa\u7684\u5168\u65b0\u63a5\u53e3\u3002\u6b64\u63a5\u53e3\u7684\u8bbe\u8ba1\u662f\u4e3a\u4e86\u6539\u5584\u5b58\u50a8\u7cfb\u7edf\u7684\u6548\u80fd\u3001\u53ef\u7528\u6027\u548c\u6269\u5145\u6027\uff0c\u63d0\u4f9b\u4e0e\u4e32\u884cATA (Serial ATA\uff0c\u7f29\u5199\u4e3aSATA)\u786c\u76d8\u7684\u517c\u5bb9\u6027\u3002 SAS\u7684\u63a5\u53e3\u6280\u672f\u53ef\u4ee5\u5411\u4e0b\u517c\u5bb9SATA\u3002SAS\u7cfb\u7edf\u7684\u80cc\u677f(Backpanel)\u65e2\u53ef\u4ee5\u8fde\u63a5\u5177\u6709\u53cc\u7aef\u53e3\u3001\u9ad8\u6027\u80fd\u7684SAS\u9a71\u52a8\u5668\uff0c\u4e5f\u53ef\u4ee5\u8fde\u63a5\u9ad8\u5bb9\u91cf\u3001\u4f4e\u6210\u672c\u7684SATA\u9a71\u52a8\u5668\u3002\u56e0\u4e3aSAS\u9a71\u52a8\u5668\u7684\u7aef\u53e3\u4e0eSATA\u9a71\u52a8\u5668\u7684\u7aef\u53e3\u5f62\u72b6\u770b\u4e0a\u53bb\u7c7b\u4f3c\uff0c\u6240\u4ee5SAS\u9a71\u52a8\u5668\u548cSATA\u9a71\u52a8\u5668\u53ef\u4ee5\u540c\u65f6\u5b58\u5728\u4e8e\u4e00\u4e2a\u5b58\u50a8\u7cfb\u7edf\u4e4b\u4e2d\u3002\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cSATA\u7cfb\u7edf\u5e76\u4e0d\u517c\u5bb9SAS\uff0c\u6240\u4ee5SAS\u9a71\u52a8\u5668\u4e0d\u80fd\u8fde\u63a5\u5230SATA\u80cc\u677f\u4e0a\u3002\u7531\u4e8eSAS\u7cfb\u7edf\u7684\u517c\u5bb9\u6027\uff0cIT\u4eba\u5458\u80fd\u591f\u8fd0\u7528\u4e0d\u540c\u63a5\u53e3\u7684\u786c\u76d8\u6765\u6ee1\u8db3\u5404\u7c7b\u5e94\u7528\u5728\u5bb9\u91cf\u4e0a\u6216\u6548\u80fd\u4e0a\u7684\u9700\u6c42\uff0c\u56e0\u6b64\u5728\u6269\u5145\u5b58\u50a8\u7cfb\u7edf\u65f6\u62e5\u6709\u66f4\u591a\u7684\u5f39\u6027\uff0c\u8ba9\u5b58\u50a8\u8bbe\u5907\u53d1\u6325\u6700\u5927\u7684\u6295\u8d44\u6548\u76ca\u3002","title":"2. \u9635\u5217\u5361\u63a5\u53e3"},{"location":"linux/raid/raid.card/#3","text":"\u6211\u4ee5\u751f\u6210\u7ebf\u4e0a\u4f7f\u7528\u7684\u9635\u5217\u5361\u4e3a\u4f8b\uff0c\u6765\u8bb2\u8ff0\u5982\u4f55\u4f7f\u7528\u3002\u6211\u4eec\u5b89\u88c5\u597dpcie\u63a5\u53e3[ PCIE ]\u7684\u9635\u5217\u5361\u3002\u7136\u540e\u5f00\u673a\uff0c\u8fdb\u5165\u9635\u5217\u5361\u914d\u7f6e\u754c\u9762\u914d\u7f6e[ \u67d0\u9635\u5217\u5361\u914d\u7f6e\u6559\u7a0b ]. \u914d\u7f6e\u5b8craid\u5361\u4ee5\u540e\u3002\u5f00\u673a\uff0c\u5b89\u88c5\u7cfb\u7edf\u3002\u7136\u540e\u90e8\u7f72\u9488\u5bf9\u81ea\u5df1raid\u5361\u54c1\u724c\u7684\u811a\u672c\u6765\u76d1\u63a7\u548c\u68c0\u67e5\u78c1\u76d8\u9635\u5217\u91cc\u9762\u78c1\u76d8\u7684\u60c5\u51b5\u3002 root@root:/opt/3ware/CLI# /opt/3ware/CLI/tw_cli show Ctl Model (V)Ports Drives Units NotOpt RRate VRate BBU ------------------------------------------------------------------------ c0 9750-24i4e 24 24 5 0 1 1 - root@root:/opt/3ware/CLI# /opt/3ware/CLI/tw_cli /c0 show all /c0 Driver Version = 3.26.02.000 /c0 Model = 9750-24i4e /c0 Available Memory = 488MB /c0 Firmware Version = FH9X 5.12.00.007 /c0 Bios Version = BE9X 5.11.00.006 /c0 Boot Loader Version = BT9X 6.00.00.004 /c0 Serial Number = SV05217695 /c0 PCB Version = Rev 001 /c0 PCHIP Version = B4 /c0 ACHIP Version = 05000e00 /c0 Controller Phys = 28 /c0 Connections = 24 of 128 /c0 Drives = 24 of 127 /c0 Units = 5 of 127 /c0 Active Drives = 24 of 127 /c0 Active Units = 3 of 32 /c0 Max Drives Per Unit = 32 /c0 Total Optimal Units = 5 /c0 Not Optimal Units = 0 /c0 Disk Spinup Policy = 8 /c0 Spinup Stagger Time Policy (sec) = 0 /c0 Auto-Carving Policy = off /c0 Auto-Carving Size = 2048 GB /c0 Auto-Rebuild Policy = on /c0 Rebuild Mode = Adaptive /c0 Rebuild Rate = 1 /c0 Verify Mode = Adaptive /c0 Verify Rate = 1 /c0 Controller Bus Type = PCIe /c0 Controller Bus Width = 8 lanes /c0 Controller Bus Speed = 5.0 Gbps/lane Unit UnitType Status %RCmpl %V/I/M Stripe Size(GB) Cache AVrfy ------------------------------------------------------------------------------ u0 RAID-1 OK - - - 1862.63 Ri ON u1 RAID-10 OK - - 256K 3725.27 Ri ON u2 RAID-10 OK - - 256K 14901.1 Ri ON u3 SPARE OK - - - 1863.01 - OFF u4 SPARE OK - - - 1863.01 - OFF VPort Status Unit Size Type Phy Encl-Slot Model ------------------------------------------------------------------------------ p0 OK u1 1.82 TB SATA 0 - WDC WD2003FYYS-02W0 p1 OK u1 1.82 TB SATA 1 - WDC WD2003FYYS-02W0 p2 OK u1 1.82 TB SATA 2 - WDC WD2003FYYS-02W0 p3 OK u3 1.82 TB SATA 3 - WDC WD2004FBYZ-01YC p4 OK u4 1.82 TB SATA 4 - WDC WD2004FBYZ-01YC p5 OK u2 1.82 TB SATA 5 - WDC WD2003FYYS-02W0 p6 OK u2 1.82 TB SATA 6 - WDC WD2003FYYS-02W0 p7 OK u2 1.82 TB SATA 7 - WDC WD2003FYYS-02W0 p8 OK u2 1.82 TB SATA 8 - WDC WD2003FYYS-02W0 p9 OK u2 1.82 TB SATA 9 - WDC WD2003FYYS-02W0 p10 OK u2 1.82 TB SATA 10 - WDC WD2003FYYS-02W0 p11 OK u2 1.82 TB SATA 11 - WDC WD2003FYYS-02W0 p12 OK u0 1.82 TB SATA 12 - WDC WD2003FYYS-02W0 p13 OK u0 1.82 TB SATA 13 - WDC WD2003FYYS-02W0 p14 OK u2 1.82 TB SATA 14 - WDC WD2003FYYS-02W0 p15 OK u2 1.82 TB SATA 15 - WDC WD2003FYYS-02W0 p16 OK u2 1.82 TB SATA 16 - WDC WD2003FYYS-02W0 p17 OK u2 1.82 TB SATA 17 - WDC WD2003FYYS-02W0 p18 OK u2 1.82 TB SATA 18 - WDC WD2003FYYS-02W0 p19 OK u2 1.82 TB SATA 19 - WDC WD2003FYYS-02W0 p20 OK u2 1.82 TB SATA 20 - WDC WD2003FYYS-02W0 p21 OK u2 1.82 TB SATA 21 - WDC WD2003FYYS-02W0 p22 OK u1 1.82 TB SATA 22 - WDC WD2003FYYS-02W0 p23 OK u2 1.82 TB SATA 23 - WDC WD2003FYYS-02W0 \u89e3\u91ca 1. \u6211\u4eec\u80fd\u4ece\u4e0a\u9762\u7684\u547d\u4ee4\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\u7cfb\u7edf\u6709\u591a\u5c11\u4e2a\u786c\u76d8\uff0c raid\u7684\u6a21\u5f0f \uff0c\u78c1\u76d8\u76f8\u5173\u4fe1\u606f 2. \u53ef\u4ee5\u901a\u8fc7\u8be5\u547d\u4ee4\u7f16\u5199\u5bf9\u5e94\u7684\u811a\u672c","title":"3. \u751f\u4ea7"},{"location":"linux/raid/raid.card/#4","text":"#!/bin/bash # ============================================================================== # Disk smart and raid Statistics plugin for Nagios # # Written by : caimengzhi # Release : 1.0 # Description : shows detail raid info and checkded smart reeult for all disk # USAGE : ./check_raid_smart.sh # # ---------------------------------------------------------------------------------------- # Nagios return codes STATE_OK=0 STATE_WARNING=1 STATE_CRITICAL=2 STATE_UNKOWN=3 #Plugin variable description PRONAME=$(basename $0) RELEASE=\"Version 1.0\" AUTHOR=\"caimengzhi\" #Tools used in plugin TW_CLI=\"/usr/sbin/tw_cli_64\" SMARTCTL=\"/usr/sbin/smartctl\" #TMP file used in plugin TMP_DIR=\"/usr/local/nagios/disk_smart\" TMP_CONTROL=\"/usr/local/nagios/disk_smart/tmp_control.txt\" TMP_DISK=\"/usr/local/nagios/disk_smart/tmp_disk.txt\" TMP_VIRTUAL_DISK=\"/usr/local/nagios/disk_smart/tmp_virtual_disk.txt\" TMP_DISK_RESULT=\"/usr/local/nagios/disk_smart/tmp_disk_result.txt\" TMP_DISK_HTML_U=\"/usr/local/nagios/disk_smart/tmp_disk_html_u.txt\" TMP_DISK_HTML_P=\"/usr/local/nagios/disk_smart/tmp_disk_html_p.txt\" #check tool if [ ! -f $TW_CLI ] || [ ! -f $SMARTCTL ];then echo \"can't command tw_cli_64 or smartctl used in script !\" exit $STATE_UNKOWN fi #check dir if [ ! -d $TMP_DIR ];then mkdir $TMP_DIR fi u_html(){ printf \"<div>\" printf \"<table border=1>\" printf \"<tr>\" printf \"<th>Unit</th>\" printf \"<th>UnitType</th>\" printf \"<th>Status</th>\" printf \"<th>%%RCmpl</th>\" printf \"<th>%%V/I/M</th>\" printf \"<th>Stripe</th>\" printf \"<th>Size(GB)</th>\" printf \"<th>Cache</th>\" printf \"<th>AVrfy</th>\" printf \"</tr>\" local unum=`cat $TMP_DISK_HTML_U | wc -l` for (( i=1; i<=$unum; i++));do uinfo=(`cat $TMP_DISK_HTML_U | sed -n \"$i\"p`) printf \"<tr>\" for ((j=0; j<=8; j++));do printf \"<td>${uinfo[$j]}</td>\" done printf \"</tr>\" done printf \"</table>\" printf \"</div>\" } p_html(){ printf \"<div>\" printf \"<table border=1>\" printf \"<tr>\" printf \"<th>VPort</th>\" printf \"<th>Status</th>\" printf \"<th>Unit</th>\" printf \"<th>Size</th>\" printf \"<th>Type</th>\" printf \"<th>Phy</th>\" printf \"<th>Encl-Slot</th>\" printf \"<th>Model</th>\" printf \"<th>Health</th>\" printf \"</tr>\" local pnum=`cat $TMP_DISK_HTML_P | wc -l` for (( i=1; i<=$pnum; i++));do pinfo=(`cat $TMP_DISK_HTML_P | sed -n \"$i\"p`) printf \"<tr>\" content=\"\" for ((j=0; j<=10; j++));do content=${pinfo[$j]} if [ $j -eq 3 ] || [ $j -eq 8 ];then content=${pinfo[$j]}${pinfo[ $j + 1 ]} else if [ $j -eq 4 ] || [ $j -eq 9 ];then continue fi fi printf \"<td>$content</td>\" done done printf \"</tr>\" printf \"</table>\" printf \"</div>\" } #start to get raid and smart info CONTROL_LIST=`$TW_CLI show | grep '^c[0-9].*'|awk '{print $1}' > $TMP_CONTROL` CONTROL_NUM=`cat $TMP_CONTROL | wc -l` c=1 while [ $c -le $CONTROL_NUM ] do cname[$c]=`cat $TMP_CONTROL | sed -n \"${c}p\"| awk '{print $1}'` let c++ done ERRCOUNT=0 declare -a DISK_ERR_ARRAY ERRFLAG=0 DISK_TOTAL=0 i=1 while [ $i -le $CONTROL_NUM ] do RR=`$TW_CLI /${cname[$i]} show | grep '^p[0-9].*' > $TMP_DISK_RESULT` PHY_LIST=`$TW_CLI /${cname[$i]} show | grep '^p[0-9].*' |awk '{print $7}' > $TMP_DISK` PHY_COUNT=`cat $TMP_DISK | wc -l` DISK_TOTAL=$[$DISK_TOTAL + $PHY_COUNT] $TW_CLI /${cname[$i]} show |grep '^u[0-9].*' >> $TMP_DISK_HTML_U j=1 while [ $j -le $PHY_COUNT ] do PHYS=`cat $TMP_DISK | sed -n \"${j}p\"` if [ \"$PHYS\" == \"-\" ] then DISK_TOTAL=$[$DISK_TOTAL - 1 ] let j++ continue fi RAID_INFO=`cat $TMP_DISK_RESULT | grep \" $PHYS \"` RAID_HEALTH=`cat $TMP_DISK_RESULT | grep \" $PHYS \" | awk '{print $2}'` SMART_HEALTH=`$SMARTCTL -H -d 3ware,${PHYS} /dev/twl0|sed -n '5p' | awk '{print $6}'` if [ \"$SMART_HEALTH\" != \"PASSED\" ] || [ \"$RAID_HEALTH\" != \"OK\" ];then ERR_COUNTROL=`cat $TMP_CONTROL | sed -n \"${i}p\"| awk '{print $1}'` ERRFLAG=1 DISK_ERR_ARRAY[$ERRCOUNT]=\"disk ${PHYS} on controller $ERR_COUNTROL \" let ERRCOUNT++ attribute=`/usr/sbin/smartctl -H -d 3ware,${PHYS} /dev/twl0 | sed -n '4,$p'` echo -e \"$attribute\" fi if [ $ERRFLAG -eq 1 ];then RAID_INFO=$RAID_INFO\" FAILED\" else RAID_INFO=$RAID_INFO\" PASSED\" fi echo \"$RAID_INFO\" >> $TMP_DISK_HTML_P let j++ done let i++ done # get html output echo \"DISK Raid&Smart Statistics\" u_html p_html # clear tmp file echo \"\" > $TMP_DISK_HTML_U echo \"\" > $TMP_DISK_HTML_P if [ $ERRFLAG -eq 0 ] then echo \"SMART OK - All disk OK ($DISK_TOTAL checked on $CONTROL_NUM controller) | TotalDisk=$DISK_TOTAL HealthDisk=$DISK_TOTAL FaildDisk=$ERRCOUNT\" exit $OK else k=0 ERR=\"\" while [ $k -le $ERRCOUNT ];do ERR=${ERR}\"${DISK_ERR_ARRAY[$k]}\" let k++ done echo -e \"SMART CRITICAL - $ERRCOUNT of $DISK_TOTAL disk failed! ($ERR) | TotalDisk=$DISK_TOTAL HealthDisk=$[ $DISK_TOTAL - ERRCOUNT ] FailedDisk=$ERRCOUNT\" exit $CRITICAL fi","title":"4. \u811a\u672c"},{"location":"linux/raid/raid.card/#5-nagios","text":":","title":"5. nagios\u56fe"},{"location":"linux/raid/raid.index/","text":"Raid\u77e5\u8bc6\u70b9 1. Raid\u77e5\u8bc6 \u00b6 \u78c1\u76d8\u9635\u5217\uff08Redundant Arrays of Independent Disks\uff0cRAID\uff09\uff0c\u6709\u201c\u72ec\u7acb\u78c1\u76d8\u6784\u6210\u7684\u5177\u6709\u5197\u4f59\u80fd\u529b\u7684\u9635\u5217\u201d\u4e4b\u610f\u3002 \u78c1\u76d8\u9635\u5217\u662f\u7531\u5f88\u591a\u4ef7\u683c\u8f83\u4fbf\u5b9c\u7684\u78c1\u76d8\uff0c\u7ec4\u5408\u6210\u4e00\u4e2a\u5bb9\u91cf\u5de8\u5927\u7684\u78c1\u76d8\u7ec4\uff0c\u5229\u7528\u4e2a\u522b\u78c1\u76d8\u63d0\u4f9b\u6570\u636e\u6240\u4ea7\u751f\u52a0\u6210\u6548\u679c\u63d0\u5347\u6574\u4e2a\u78c1\u76d8\u7cfb\u7edf\u6548\u80fd\u3002\u5229\u7528\u8fd9\u9879\u6280\u672f\uff0c\u5c06\u6570\u636e\u5207\u5272\u6210\u8bb8\u591a\u533a\u6bb5\uff0c\u5206\u522b\u5b58\u653e\u5728\u5404\u4e2a\u786c\u76d8\u4e0a\u3002 \u78c1\u76d8\u9635\u5217\u8fd8\u80fd\u5229\u7528\u540c\u4f4d\u68c0\u67e5\uff08Parity Check\uff09\u7684\u89c2\u5ff5\uff0c\u5728\u6570\u7ec4\u4e2d\u4efb\u610f\u4e00\u4e2a\u786c\u76d8\u6545\u969c\u65f6\uff0c\u4ecd\u53ef\u8bfb\u51fa\u6570\u636e\uff0c\u5728\u6570\u636e\u91cd\u6784\u65f6\uff0c\u5c06\u6570\u636e\u7ecf\u8ba1\u7b97\u540e\u91cd\u65b0\u7f6e\u5165\u65b0\u786c\u76d8\u4e2d\u3002 1.1 \u57fa\u672c\u4ecb\u7ecd \u00b6 \u72ec\u7acb\u78c1\u76d8\u5197\u4f59\u9635\u5217\uff08RAID\uff0credundant array of independent disks\uff09\u662f\u628a\u76f8\u540c\u7684\u6570\u636e\u5b58\u50a8\u5728\u591a\u4e2a\u786c\u76d8\u7684\u4e0d\u540c\u7684\u5730\u65b9\uff08\u56e0\u6b64\uff0c\u5197\u4f59\u5730\uff09\u7684\u65b9\u6cd5\u3002\u901a\u8fc7\u628a\u6570\u636e\u653e\u5728\u591a\u4e2a\u786c\u76d8\u4e0a\uff0c\u8f93\u5165\u8f93\u51fa\u64cd\u4f5c\u80fd\u4ee5\u5e73\u8861\u7684\u65b9\u5f0f\u4ea4\u53e0\uff0c\u6539\u826f\u6027\u80fd\u3002\u56e0\u4e3a\u591a\u4e2a\u786c\u76d8\u589e\u52a0\u4e86\u5e73\u5747\u6545\u969c\u95f4\u9694\u65f6\u95f4\uff08MTBF\uff09\uff0c\u50a8\u5b58\u5197\u4f59\u6570\u636e\u4e5f\u589e\u52a0\u4e86\u5bb9\u9519\u3002 1.2 \u9635\u5217\u5206\u7c7b \u00b6 \u78c1\u76d8\u9635\u5217\u5176\u6837\u5f0f\u6709\u4e09\u79cd\uff0c\u4e00\u662f\u5916\u63a5\u5f0f\u78c1\u76d8\u9635\u5217\u67dc\u3001\u4e8c\u662f\u5185\u63a5\u5f0f\u78c1\u76d8\u9635\u5217\u5361\uff0c\u4e09\u662f\u5229\u7528\u8f6f\u4ef6\u6765\u4eff\u771f\u3002 \u5916\u63a5\u5f0f\u78c1\u76d8\u9635\u5217\u67dc\u6700\u5e38\u88ab\u4f7f\u7528\u5927\u578b\u670d\u52a1\u5668\u4e0a\uff0c\u5177\u53ef\u70ed\u4ea4\u6362\uff08Hot Swap\uff09\u7684\u7279\u6027\uff0c\u4e0d\u8fc7\u8fd9\u7c7b\u4ea7\u54c1\u7684\u4ef7\u683c\u90fd\u5f88\u8d35\u3002 \u5185\u63a5\u5f0f\u78c1\u76d8\u9635\u5217\u5361\uff0c\u56e0\u4e3a\u4ef7\u683c\u4fbf\u5b9c\uff0c\u4f46\u9700\u8981\u8f83\u9ad8\u7684\u5b89\u88c5\u6280\u672f\uff0c\u9002\u5408\u6280\u672f\u4eba\u5458\u4f7f\u7528\u64cd\u4f5c\u3002\u786c\u4ef6\u9635\u5217\u80fd\u591f\u63d0\u4f9b\u5728\u7ebf\u6269\u5bb9\u3001\u52a8\u6001\u4fee\u6539\u9635\u5217\u7ea7\u522b\u3001\u81ea\u52a8\u6570\u636e\u6062\u590d\u3001\u9a71\u52a8\u5668\u6f2b\u6e38\u3001\u8d85\u9ad8\u901f\u7f13\u51b2\u7b49\u529f\u80fd\u3002\u5b83\u80fd\u63d0\u4f9b\u6027\u80fd\u3001\u6570\u636e\u4fdd\u62a4\u3001\u53ef\u9760\u6027\u3001\u53ef\u7528\u6027\u548c\u53ef\u7ba1\u7406\u6027\u7684\u89e3\u51b3\u65b9\u6848\u3002\u9635\u5217\u5361\u4e13\u7528\u7684\u5904\u7406\u5355\u5143\u6765\u8fdb\u884c\u64cd\u4f5c\u3002 \u5229\u7528\u8f6f\u4ef6\u4eff\u771f\u7684\u65b9\u5f0f\uff0c\u662f\u6307\u901a\u8fc7\u7f51\u7edc\u64cd\u4f5c\u7cfb\u7edf\u81ea\u8eab\u63d0\u4f9b\u7684\u78c1\u76d8\u7ba1\u7406\u529f\u80fd\u5c06\u8fde\u63a5\u7684\u666e\u901aSCSI\u5361\u4e0a\u7684\u591a\u5757\u786c\u76d8\u914d\u7f6e\u6210\u903b\u8f91\u76d8\uff0c\u7ec4\u6210\u9635\u5217\u3002\u8f6f\u4ef6\u9635\u5217\u53ef\u4ee5\u63d0\u4f9b\u6570\u636e\u5197\u4f59\u529f\u80fd\uff0c\u4f46\u662f\u78c1\u76d8\u5b50\u7cfb\u7edf\u7684\u6027\u80fd\u4f1a\u6709\u6240\u964d\u4f4e\uff0c\u6709\u7684\u964d\u4f4e\u5e45\u5ea6\u8fd8\u6bd4\u8f83\u5927\uff0c\u8fbe30%\u5de6\u53f3\u3002\u56e0\u6b64\u4f1a\u62d6\u7d2f\u673a\u5668\u7684\u901f\u5ea6\uff0c\u4e0d\u9002\u5408\u5927\u6570\u636e\u6d41\u91cf\u7684\u670d\u52a1\u5668\u3002 1.3 \u4f18\u7f3a\u70b9 \u00b6 1.3.1 \u4f18\u70b9 \u00b6 \u63d0\u9ad8\u4f20\u8f93\u901f\u7387\u3002RAID\u901a\u8fc7\u5728\u591a\u4e2a\u78c1\u76d8\u4e0a\u540c\u65f6\u5b58\u50a8\u548c\u8bfb\u53d6\u6570\u636e\u6765\u5927\u5e45\u63d0\u9ad8\u5b58\u50a8\u7cfb\u7edf\u7684\u6570\u636e\u541e\u5410\u91cf\uff08Throughput\uff09\u3002\u5728RAID\u4e2d\uff0c\u53ef\u4ee5\u8ba9\u5f88\u591a\u78c1\u76d8\u9a71\u52a8\u5668\u540c\u65f6\u4f20\u8f93\u6570\u636e\uff0c\u800c\u8fd9\u4e9b\u78c1\u76d8\u9a71\u52a8\u5668\u5728\u903b\u8f91\u4e0a\u53c8\u662f\u4e00\u4e2a\u78c1\u76d8\u9a71\u52a8\u5668\uff0c\u6240\u4ee5\u4f7f\u7528RAID\u53ef\u4ee5\u8fbe\u5230\u5355\u4e2a\u78c1\u76d8\u9a71\u52a8\u5668\u51e0\u500d\u3001\u51e0\u5341\u500d\u751a\u81f3\u4e0a\u767e\u500d\u7684\u901f\u7387\u3002\u8fd9\u4e5f\u662fRAID\u6700\u521d\u60f3\u8981\u89e3\u51b3\u7684\u95ee\u9898\u3002\u56e0\u4e3a\u5f53\u65f6CPU\u7684\u901f\u5ea6\u589e\u957f\u5f88\u5feb\uff0c\u800c\u78c1\u76d8\u9a71\u52a8\u5668\u7684\u6570\u636e\u4f20\u8f93\u901f\u7387\u65e0\u6cd5\u5927\u5e45\u63d0\u9ad8\uff0c\u6240\u4ee5\u9700\u8981\u6709\u4e00\u79cd\u65b9\u6848\u89e3\u51b3\u4e8c\u8005\u4e4b\u95f4\u7684\u77db\u76fe\u3002RAID\u6700\u540e\u6210\u529f\u4e86\u3002 \u901a\u8fc7\u6570\u636e\u6821\u9a8c\u63d0\u4f9b\u5bb9\u9519\u529f\u80fd\u3002\u666e\u901a\u78c1\u76d8\u9a71\u52a8\u5668\u65e0\u6cd5\u63d0\u4f9b\u5bb9\u9519\u529f\u80fd\uff0c\u5982\u679c\u4e0d\u5305\u62ec\u5199\u5728\u78c1\u76d8\u4e0a\u7684CRC\uff08\u5faa\u73af\u5197\u4f59\u6821\u9a8c\uff09\u7801\u7684\u8bdd\u3002RAID\u5bb9\u9519\u662f\u5efa\u7acb\u5728\u6bcf\u4e2a\u78c1\u76d8\u9a71\u52a8\u5668\u7684\u786c\u4ef6\u5bb9\u9519\u529f\u80fd\u4e4b\u4e0a\u7684\uff0c\u6240\u4ee5\u5b83\u63d0\u4f9b\u66f4\u9ad8\u7684\u5b89\u5168\u6027\u3002\u5728\u5f88\u591aRAID\u6a21\u5f0f\u4e2d\u90fd\u6709\u8f83\u4e3a\u5b8c\u5907\u7684\u76f8\u4e92\u6821\u9a8c/\u6062\u590d\u7684\u63aa\u65bd\uff0c\u751a\u81f3\u662f\u76f4\u63a5\u76f8\u4e92\u7684\u955c\u50cf\u5907\u4efd\uff0c\u4ece\u800c\u5927\u5927\u63d0\u9ad8\u4e86RAID\u7cfb\u7edf\u7684\u5bb9\u9519\u5ea6\uff0c\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u7a33\u5b9a\u5197\u4f59\u6027\u3002 1.3.2 \u7f3a\u70b9 \u00b6 RAID0\u6ca1\u6709\u5197\u4f59\u529f\u80fd\uff0c\u5982\u679c\u4e00\u4e2a\u78c1\u76d8\uff08\u7269\u7406\uff09\u635f\u574f\uff0c\u5219\u6240\u6709\u7684\u6570\u636e\u90fd\u65e0\u6cd5\u4f7f\u7528\u3002 RAID1\u78c1\u76d8\u7684\u5229\u7528\u7387\u6700\u9ad8\u53ea\u80fd\u8fbe\u523050%(\u4f7f\u7528\u4e24\u5757\u76d8\u7684\u60c5\u51b5\u4e0b)\uff0c\u662f\u6240\u6709RAID\u7ea7\u522b\u4e2d\u6700\u4f4e\u7684\u3002 RAID0+1\u4ee5\u7406\u89e3\u4e3a\u662fRAID 0\u548cRAID 1\u7684\u6298\u4e2d\u65b9\u6848\u3002RAID 0+1\u53ef\u4ee5\u4e3a\u7cfb\u7edf\u63d0\u4f9b\u6570\u636e\u5b89\u5168\u4fdd\u969c\uff0c\u4f46\u4fdd\u969c\u7a0b\u5ea6\u8981\u6bd4 Mirror\u4f4e\u800c\u78c1\u76d8\u7a7a\u95f4\u5229\u7528\u7387\u8981\u6bd4Mirror\u9ad8\u3002 2. Raid\u79cd\u7c7b\u4ecb\u7ecd \u00b6 \u4ee5\u4e0b\u4e3b\u8981\u4ecb\u7ecdraid0\uff0craid1,raid5\uff0craid10\u56db\u79cd\u4ecb\u7ecd\u3002 2.1 raid0 \u00b6 RAID 0\u662f\u6700\u65e9\u51fa\u73b0\u7684RAID\u6a21\u5f0f\uff0c\u5373Data Stripping\u6570\u636e\u5206\u6761\u6280\u672f\u3002RAID 0\u662f\u7ec4\u5efa\u78c1\u76d8\u9635\u5217\u4e2d\u6700\u7b80\u5355\u7684\u4e00\u79cd\u5f62\u5f0f\uff0c\u53ea\u9700\u89812\u5757\u4ee5\u4e0a\u7684\u786c\u76d8\u5373\u53ef\uff0c\u6210\u672c\u4f4e\uff0c\u53ef\u4ee5\u63d0\u9ad8\u6574\u4e2a\u78c1\u76d8\u7684\u6027\u80fd\u548c\u541e\u5410\u91cf\u3002RAID 0\u6ca1\u6709\u63d0\u4f9b\u5197\u4f59\u6216\u9519\u8bef\u4fee\u590d\u80fd\u529b\uff0c\u4f46\u5b9e\u73b0\u6210\u672c\u662f\u6700\u4f4e\u7684\u3002 RAID 0\u6700\u7b80\u5355\u7684\u5b9e\u73b0\u65b9\u5f0f\u5c31\u662f\u628aN\u5757\u540c\u6837\u7684\u786c\u76d8\u7528\u786c\u4ef6\u7684\u5f62\u5f0f\u901a\u8fc7\u667a\u80fd\u78c1\u76d8\u63a7\u5236\u5668\u6216\u7528\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u78c1\u76d8\u9a71\u52a8\u7a0b\u5e8f\u4ee5\u8f6f\u4ef6\u7684\u65b9\u5f0f\u4e32\u8054\u5728\u4e00\u8d77\u521b\u5efa\u4e00\u4e2a\u5927\u7684\u5377\u96c6\u3002\u5728\u4f7f\u7528\u4e2d\u7535\u8111\u6570\u636e\u4f9d\u6b21\u5199\u5165\u5230\u5404\u5757\u786c\u76d8\u4e2d\uff0c\u5b83\u7684\u6700\u5927\u4f18\u70b9\u5c31\u662f\u53ef\u4ee5\u6574\u500d\u7684\u63d0\u9ad8\u786c\u76d8\u7684\u5bb9\u91cf\u3002\u5982\u4f7f\u7528\u4e86\u4e09\u575780GB\u7684\u786c\u76d8\u7ec4\u5efa\u6210RAID 0\u6a21\u5f0f\uff0c\u90a3\u4e48\u78c1\u76d8\u5bb9\u91cf\u5c31\u4f1a\u662f240GB\u3002\u5176\u901f\u5ea6\u65b9\u9762\uff0c\u5404\u5355\u72ec\u4e00\u5757\u786c\u76d8\u7684\u901f\u5ea6\u5b8c\u5168\u76f8\u540c\u3002\u6700\u5927\u7684\u7f3a\u70b9\u5728\u4e8e\u4efb\u4f55\u4e00\u5757\u786c\u76d8\u51fa\u73b0\u6545\u969c\uff0c\u6574\u4e2a\u7cfb\u7edf\u5c06\u4f1a\u53d7\u5230\u7834\u574f\uff0c\u53ef\u9760\u6027\u4ec5\u4e3a\u5355\u72ec\u4e00\u5757\u786c\u76d8\u76841/N\u3002 \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0c\u4fbf\u51fa\u73b0\u4e86RAID 0\u7684\u53e6\u4e00\u79cd\u6a21\u5f0f\u3002\u5373\u5728N\u5757\u786c\u76d8\u4e0a\u9009\u62e9\u5408\u7406\u7684\u5e26\u533a\u6765\u521b\u5efa\u5e26\u533a\u96c6\u3002\u5176\u539f\u7406\u5c31\u662f\u5c06\u539f\u5148\u987a\u5e8f\u5199\u5165\u7684\u6570\u636e\u88ab\u5206\u6563\u5230\u6240\u6709\u7684\u56db\u5757\u786c\u76d8\u4e2d\u540c\u65f6\u8fdb\u884c\u8bfb\u5199\u3002\u56db\u5757\u786c\u76d8\u7684\u5e76\u884c\u64cd\u4f5c\u4f7f\u540c\u4e00\u65f6\u95f4\u5185\u78c1\u76d8\u8bfb\u5199\u7684\u901f\u5ea6\u63d0\u5347\u4e864\u500d\u3002 \u5728\u521b\u5efa\u5e26\u533a\u96c6\u65f6\uff0c\u5408\u7406\u7684\u9009\u62e9\u5e26\u533a\u7684\u5927\u5c0f\u975e\u5e38\u91cd\u8981\u3002\u5982\u679c\u5e26\u533a\u8fc7\u5927\uff0c\u53ef\u80fd\u4e00\u5757\u78c1\u76d8\u4e0a\u7684\u5e26\u533a\u7a7a\u95f4\u5c31\u53ef\u4ee5\u6ee1\u8db3\u5927\u90e8\u5206\u7684I/O\u64cd\u4f5c\uff0c\u4f7f\u6570\u636e\u7684\u8bfb\u5199\u4ecd\u7136\u53ea\u5c40\u9650\u5728\u5c11\u6570\u7684\u4e00\u3001\u4e24\u5757\u786c\u76d8\u4e0a\uff0c\u4e0d\u80fd\u5145\u5206\u7684\u53d1\u6325\u51fa\u5e76\u884c\u64cd\u4f5c\u7684\u4f18\u52bf\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c\u5e26\u533a\u8fc7\u5c0f\uff0c\u4efb\u4f55I/O\u6307\u4ee4\u90fd\u53ef\u80fd\u5f15\u53d1\u5927\u91cf\u7684\u8bfb\u5199\u64cd\u4f5c\uff0c\u5360\u7528\u8fc7\u591a\u7684\u63a7\u5236\u5668\u603b\u7ebf\u5e26\u5bbd\u3002\u56e0\u6b64\uff0c\u5728\u521b\u5efa\u5e26\u533a\u96c6\u65f6\uff0c\u6211\u4eec\u5e94\u5f53\u6839\u636e\u5b9e\u9645\u5e94\u7528\u7684\u9700\u8981\uff0c\u614e\u91cd\u7684\u9009\u62e9\u5e26\u533a\u7684\u5927\u5c0f\u3002 \u5e26\u533a\u96c6\u867d\u7136\u53ef\u4ee5\u628a\u6570\u636e\u5747\u5300\u7684\u5206\u914d\u5230\u6240\u6709\u7684\u78c1\u76d8\u4e0a\u8fdb\u884c\u8bfb\u5199\u3002\u4f46\u5982\u679c\u6211\u4eec\u628a\u6240\u6709\u7684\u786c\u76d8\u90fd\u8fde\u63a5\u5230\u4e00\u4e2a\u63a7\u5236\u5668\u4e0a\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u5e26\u6765\u6f5c\u5728\u7684\u5371\u5bb3\u3002\u8fd9\u662f\u56e0\u4e3a\u5f53\u6211\u4eec\u9891\u7e41\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\u65f6\uff0c\u5f88\u5bb9\u6613\u4f7f\u63a7\u5236\u5668\u6216\u603b\u7ebf\u7684\u8d1f\u8377 \u8d85\u8f7d\u3002\u4e3a\u4e86\u907f\u514d\u51fa\u73b0\u4e0a\u8ff0\u95ee\u9898\uff0c\u5efa\u8bae\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u78c1\u76d8\u63a7\u5236\u5668\u3002\u6700\u597d\u89e3\u51b3\u65b9\u6cd5\u8fd8\u662f\u4e3a\u6bcf\u4e00\u5757\u786c\u76d8\u90fd\u914d\u5907\u4e00\u4e2a\u4e13\u95e8\u7684\u78c1\u76d8\u63a7\u5236\u5668\u3002 \u867d\u7136RAID 0\u53ef\u4ee5\u63d0\u4f9b\u66f4\u591a\u7684\u7a7a\u95f4\u548c\u66f4\u597d\u7684\u6027\u80fd\uff0c\u4f46\u662f\u6574\u4e2a\u7cfb\u7edf\u662f\u975e\u5e38\u4e0d\u53ef\u9760\u7684\uff0c\u5982\u679c\u51fa\u73b0\u6545\u969c\uff0c\u65e0\u6cd5\u8fdb\u884c\u4efb\u4f55\u8865\u6551\u3002\u6240\u4ee5\uff0cRAID 0\u4e00\u822c\u53ea\u662f\u5728\u90a3\u4e9b\u5bf9\u6570\u636e\u5b89\u5168\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\u60c5\u51b5\u4e0b\u624d\u88ab\u4eba\u4eec\u4f7f\u7528 \u4f18\u70b9 1. \u8bfb\u5199\u6027\u80fd\u662f\u6240\u6709RAID\u7ea7\u522b\u4e2d\u6700\u9ad8\u7684\u3002 2. RAID0\u7684\u7f3a\u70b9\u662f\u4e0d\u63d0\u4f9b\u6570\u636e\u5197\u4f59\uff0c\u56e0\u6b64\u4e00\u65e6\u7528\u6237\u6570\u636e\u635f\u574f\uff0c\u635f\u574f\u7684\u6570\u636e\u5c06\u65e0\u6cd5\u5f97\u5230\u6062\u590d\u3002RAID0\u8fd0\u884c\u65f6\u53ea\u8981\u5176\u4e2d\u4efb\u4e00\u5757\u786c\u76d8\u51fa\u73b0\u95ee\u9898\u5c31\u4f1a\u5bfc\u81f4\u6574\u4e2a\u6570\u636e\u7684\u6545\u969c\u3002\u4e00\u822c\u4e0d\u5efa\u8bae\u4f01\u4e1a\u7528\u6237\u5355\u72ec\u4f7f\u7528\u3002 \u7f3a\u70b9 1. \u78c1\u76d8\u7a7a\u95f4\u4f7f\u7528\u7387\uff1a100%\uff0c\u6545\u6210\u672c\u6700\u4f4e\u3002 2. \u8bfb\u6027\u80fd\uff1aN*\u5355\u5757\u78c1\u76d8\u7684\u8bfb\u6027\u80fd 3. \u5199\u6027\u80fd\uff1aN*\u5355\u5757\u78c1\u76d8\u7684\u5199\u6027\u80fd 4. \u5197\u4f59\uff1a\u65e0\uff0c\u4efb\u4f55\u4e00\u5757\u78c1\u76d8\u635f\u574f\u90fd\u5c06\u5bfc\u81f4\u6570\u636e\u4e0d\u53ef\u7528\u3002 2.2 raid1 \u00b6 RAID 1\u79f0\u4e3a\u78c1\u76d8\u955c\u50cf\uff0c\u539f\u7406\u662f\u628a\u4e00\u4e2a\u78c1\u76d8\u7684\u6570\u636e\u955c\u50cf\u5230\u53e6\u4e00\u4e2a\u78c1\u76d8\u4e0a\uff0c\u4e5f\u5c31\u662f\u8bf4\u6570\u636e\u5728\u5199\u5165\u4e00\u5757\u78c1\u76d8\u7684\u540c\u65f6\uff0c\u4f1a\u5728\u53e6\u4e00\u5757\u95f2\u7f6e\u7684\u78c1\u76d8\u4e0a\u751f\u6210\u955c\u50cf\u6587\u4ef6\uff0c\u5728\u4e0d\u5f71\u54cd\u6027\u80fd\u60c5\u51b5\u4e0b\u6700\u5927\u9650\u5ea6\u7684\u4fdd\u8bc1\u7cfb\u7edf\u7684\u53ef\u9760\u6027\u548c\u53ef\u4fee\u590d\u6027\u4e0a\uff0c\u53ea\u8981\u7cfb\u7edf\u4e2d\u4efb\u4f55\u4e00\u5bf9\u955c\u50cf\u76d8\u4e2d\u81f3\u5c11\u6709\u4e00\u5757\u78c1\u76d8\u53ef\u4ee5\u4f7f\u7528\uff0c\u751a\u81f3\u53ef\u4ee5\u5728\u4e00\u534a\u6570\u91cf\u7684\u786c\u76d8\u51fa\u73b0\u95ee\u9898\u65f6\u7cfb\u7edf\u90fd\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c,\u5f53\u4e00\u5757\u786c\u76d8\u5931\u6548\u65f6\uff0c\u7cfb\u7edf\u4f1a\u5ffd\u7565\u8be5\u786c\u76d8\uff0c\u8f6c\u800c\u4f7f\u7528\u5269\u4f59\u7684\u955c\u50cf\u76d8\u8bfb\u5199\u6570\u636e\uff0c\u5177\u5907\u5f88\u597d\u7684\u78c1\u76d8\u5197\u4f59\u80fd\u529b\u3002\u867d\u7136\u8fd9\u6837\u5bf9\u6570\u636e\u6765\u8bb2\u7edd\u5bf9\u5b89\u5168\uff0c\u4f46\u662f\u6210\u672c\u4e5f\u4f1a\u660e\u663e\u589e\u52a0\uff0c\u78c1\u76d8\u5229\u7528\u7387\u4e3a50%\uff0c\u4ee5\u56db\u575780GB\u5bb9\u91cf\u7684\u786c\u76d8\u6765\u8bb2\uff0c\u53ef\u5229\u7528\u7684\u78c1\u76d8\u7a7a\u95f4\u4ec5\u4e3a160GB\u3002\u53e6\u5916\uff0c\u51fa\u73b0\u786c\u76d8\u6545\u969c\u7684RAID\u7cfb\u7edf\u4e0d\u518d\u53ef\u9760\uff0c\u5e94\u5f53\u53ca\u65f6\u7684\u66f4\u6362\u635f\u574f\u7684\u786c\u76d8\uff0c\u5426\u5219\u5269\u4f59\u7684\u955c\u50cf\u76d8\u4e5f\u51fa\u73b0\u95ee\u9898\uff0c\u90a3\u4e48\u6574\u4e2a\u7cfb\u7edf\u5c31\u4f1a\u5d29\u6e83\u3002\u66f4\u6362\u65b0\u76d8\u540e\u539f\u6709\u6570\u636e\u4f1a\u9700\u8981\u5f88\u957f\u65f6\u95f4\u540c\u6b65\u955c\u50cf\uff0c\u5916\u754c\u5bf9\u6570\u636e\u7684\u8bbf\u95ee\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u53ea\u662f\u8fd9\u65f6\u6574\u4e2a\u7cfb\u7edf\u7684\u6027\u80fd\u6709\u6240\u4e0b\u964d\u3002\u56e0\u6b64\uff0cRAID 1\u591a\u7528\u5728\u4fdd\u5b58\u5173\u952e\u6027\u7684\u91cd\u8981\u6570\u636e\u7684\u573a\u5408\u3002 RAID 1\u4e3b\u8981\u662f\u901a\u8fc7\u4e8c\u6b21\u8bfb\u5199\u5b9e\u73b0\u78c1\u76d8\u955c\u50cf\uff0c\u6240\u4ee5\u78c1\u76d8\u63a7\u5236\u5668\u7684\u8d1f\u8f7d\u4e5f\u76f8\u5f53\u5927\uff0c\u5c24\u5176\u662f\u5728\u9700\u8981\u9891\u7e41\u5199\u5165\u6570\u636e\u7684\u73af\u5883\u4e2d\u3002\u4e3a\u4e86\u907f\u514d\u51fa\u73b0\u6027\u80fd\u74f6\u9888\uff0c\u4f7f\u7528\u591a\u4e2a\u78c1\u76d8\u63a7\u5236\u5668\u5c31\u663e\u5f97\u5f88\u6709\u5fc5\u8981\u3002 \u4f18\u70b9 RAID1\u901a\u8fc7\u786c\u76d8\u6570\u636e\u955c\u50cf\u5b9e\u73b0\u6570\u636e\u7684\u5197\u4f59\uff0c\u4fdd\u62a4\u6570\u636e\u5b89\u5168\uff0c\u5728\u4e24\u5757\u76d8\u4e0a\u4ea7\u751f\u4e92\u4e3a\u5907\u4efd\u7684\u6570\u636e\uff0c\u5f53\u539f\u59cb\u6570\u636e\u7e41\u5fd9\u65f6\uff0c\u53ef\u76f4\u63a5\u4ece\u955c\u50cf\u5907\u4efd\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u56e0\u6b64RAID1\u53ef\u4ee5\u63d0\u4f9b\u8bfb\u53d6\u6027\u80fd\u3002 RAID1\u662f\u786c\u76d8\u4e2d\u5355\u4f4d\u6210\u672c\u6700\u9ad8\u7684\uff0c\u4f46\u63d0\u4f9b\u4e86\u5f88\u9ad8\u7684\u6570\u636e\u5b89\u5168\u6027\u548c\u53ef\u7528\u6027\uff0c\u5f53\u4e00\u4e2a\u786c\u76d8\u5931\u6548\u65f6\uff0c\u7cfb\u7edf\u53ef\u4ee5\u81ea\u52a8\u5207\u6362\u5230\u955c\u50cf\u786c\u76d8\u4e0a\u8bfb/\u5199\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u91cd\u7ec4\u5931\u6548\u7684\u6570\u636e\u3002 \u7f3a\u70b9 1. \u78c1\u76d8\u7a7a\u95f4\u4f7f\u7528\u7387\uff1a50%\uff0c\u6545\u6210\u672c\u6700\u9ad8\u3002 2. \u8bfb\u6027\u80fd\uff1a\u53ea\u80fd\u5728\u4e00\u4e2a\u78c1\u76d8\u4e0a\u8bfb\u53d6\uff0c\u53d6\u51b3\u4e8e\u78c1\u76d8\u4e2d\u8f83\u5feb\u7684\u90a3\u5757\u76d8 3. \u5199\u6027\u80fd\uff1a\u4e24\u5757\u78c1\u76d8\u90fd\u8981\u5199\u5165\uff0c\u867d\u7136\u662f\u5e76\u884c\u5199\u5165\uff0c\u4f46\u56e0\u4e3a\u8981\u6bd4\u5bf9\uff0c\u6545\u6027\u80fd\u5355\u5757\u78c1\u76d8\u6162\u3002 4. \u5197\u4f59\uff1a\u53ea\u8981\u7cfb\u7edf\u4e2d\u4efb\u4f55\u4e00\u5bf9\u955c\u50cf\u76d8\u4e2d\u6709\u4e00\u5757\u78c1\u76d8\u53ef\u4ee5\u4f7f\u7528\uff0c\u751a\u81f3\u53ef\u4ee5\u5728\u4e00\u534a\u6570\u91cf\u7684\u786c\u76d8\u51fa\u73b0\u95ee\u9898\u65f6\u7cfb\u7edf\u90fd\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u3002 2.3 raid5 \u00b6 \u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u7684\u5947\u5076\u6821\u9a8c\u7801\u5b58\u5728\u4e8e\u6240\u6709\u78c1\u76d8\u4e0a\uff0c\u5176\u4e2d\u7684p[a,b,c..]\u4ee3\u8868\u7b2ca\u5e26\u533a\u7684\u5947\u5076\u6821\u9a8c\u503c\uff0c\u5176\u5b83\u7684\u610f\u601d\u4e5f\u76f8\u540c\u3002RAID5\u7684\u8bfb\u51fa\u6548\u7387\u5f88\u9ad8\uff0c\u5199\u5165\u6548\u7387\u4e00\u822c\uff0c\u5757\u5f0f\u7684\u96c6\u4f53\u8bbf\u95ee\u6548\u7387\u4e0d\u9519\u3002\u56e0\u4e3a\u5947\u5076\u6821\u9a8c\u7801\u5728\u4e0d\u540c\u7684\u78c1\u76d8\u4e0a\uff0c\u6240\u4ee5\u63d0\u9ad8\u4e86\u53ef\u9760\u6027\u3002\u4f46\u662f\u5b83\u5bf9\u6570\u636e\u4f20\u8f93\u7684\u5e76\u884c\u6027\u89e3\u51b3\u4e0d\u597d\uff0c\u800c\u4e14\u63a7\u5236\u5668\u7684\u8bbe\u8ba1\u4e5f\u76f8\u5f53\u56f0\u96be\u3002RAID 3 \u4e0eRAID 5\u76f8\u6bd4\uff0c\u91cd\u8981\u7684\u533a\u522b\u5728\u4e8eRAID 3\u6bcf\u8fdb\u884c\u4e00\u6b21\u6570\u636e\u4f20\u8f93\uff0c\u9700\u6d89\u53ca\u5230\u6240\u6709\u7684\u9635\u5217\u76d8\u3002\u800c\u5bf9\u4e8eRAID 5\u6765\u8bf4\uff0c\u5927\u90e8\u5206\u6570\u636e\u4f20\u8f93\u53ea\u5bf9\u4e00\u5757\u78c1\u76d8\u64cd\u4f5c\uff0c\u53ef\u8fdb\u884c\u5e76\u884c\u64cd\u4f5c\u3002\u5728RAID 5\u4e2d\u6709\u201c\u5199\u635f\u5931\u201d\uff0c\u5373\u6bcf\u4e00\u6b21\u5199\u64cd\u4f5c\uff0c\u5c06\u4ea7\u751f\u56db\u4e2a\u5b9e\u9645\u7684\u8bfb/\u5199\u64cd\u4f5c\uff0c\u5176\u4e2d\u4e24\u6b21\u8bfb\u65e7\u7684\u6570\u636e\u53ca\u5947\u5076\u4fe1\u606f\uff0c\u4e24\u6b21\u5199\u65b0\u7684\u6570\u636e\u53ca\u5947\u5076\u4fe1\u606f\u3002 \u603b\u7ed3 1. \u78c1\u76d8\u7a7a\u95f4\u5229\u7528\u7387\uff1a(N-1)/N\uff0c\u5373\u53ea\u6d6a\u8d39\u4e00\u5757\u78c1\u76d8\u7528\u4e8e\u5947\u5076\u6821\u9a8c\u3002 2. \u8bfb\u6027\u80fd\uff1a(n-1)*\u5355\u5757\u78c1\u76d8\u7684\u8bfb\u6027\u80fd\uff0c\u63a5\u8fd1RAID0\u7684\u8bfb\u6027\u80fd\u3002 3. \u5199\u6027\u80fd\uff1a\u6bd4\u5355\u5757\u78c1\u76d8\u7684\u5199\u6027\u80fd\u8981\u5dee 4. \u5197\u4f59\uff1a\u53ea\u5141\u8bb8\u4e00\u5757\u78c1\u76d8\u635f\u574f\u3002 2.4 raid10 \u00b6 \u8fd9\u79cd\u7ed3\u6784\u65e0\u975e\u662f\u4e00\u4e2a\u5e26\u533a\u7ed3\u6784\u52a0\u4e00\u4e2a\u955c\u8c61\u7ed3\u6784\uff0c\u56e0\u4e3a\u4e24\u79cd\u7ed3\u6784\u5404\u6709\u4f18\u7f3a\u70b9\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f8\u4e92\u8865\u5145\uff0c\u8fbe\u5230\u65e2\u9ad8\u6548\u53c8\u9ad8\u901f\u7684\u76ee\u7684\u3002\u5927\u5bb6\u53ef\u4ee5\u7ed3\u5408\u4e24\u79cd\u7ed3\u6784\u7684\u4f18\u70b9\u548c\u7f3a\u70b9\u6765\u7406\u89e3\u8fd9\u79cd\u65b0\u7ed3\u6784\u3002\u8fd9\u79cd\u65b0\u7ed3\u6784\u7684\u4ef7\u683c\u9ad8\uff0c\u53ef\u6269\u5145\u6027\u4e0d\u597d\u3002\u4e3b\u8981\u7528\u4e8e\u6570\u636e\u5bb9\u91cf\u4e0d\u5927\uff0c\u4f46\u8981\u6c42\u901f\u5ea6\u548c\u5dee\u9519\u63a7\u5236\u7684\u6570\u636e\u5e93\u4e2d\u3002 \u603b\u7ed3 1. \u78c1\u76d8\u7a7a\u95f4\u5229\u7528\u7387\uff1a50%\u3002 2. \u8bfb\u6027\u80fd\uff1aN/2*\u5355\u5757\u786c\u76d8\u7684\u8bfb\u6027\u80fd 3. \u5199\u6027\u80fd\uff1aN/2*\u5355\u5757\u786c\u76d8\u7684\u5199\u6027\u80fd 4. \u5197\u4f59\uff1a\u53ea\u8981\u4e00\u5bf9\u955c\u50cf\u76d8\u4e2d\u6709\u4e00\u5757\u78c1\u76d8\u53ef\u4ee5\u4f7f\u7528\u5c31\u6ca1\u95ee\u9898\u3002","title":"1. raid \u4ecb\u7ecd"},{"location":"linux/raid/raid.index/#1-raid","text":"\u78c1\u76d8\u9635\u5217\uff08Redundant Arrays of Independent Disks\uff0cRAID\uff09\uff0c\u6709\u201c\u72ec\u7acb\u78c1\u76d8\u6784\u6210\u7684\u5177\u6709\u5197\u4f59\u80fd\u529b\u7684\u9635\u5217\u201d\u4e4b\u610f\u3002 \u78c1\u76d8\u9635\u5217\u662f\u7531\u5f88\u591a\u4ef7\u683c\u8f83\u4fbf\u5b9c\u7684\u78c1\u76d8\uff0c\u7ec4\u5408\u6210\u4e00\u4e2a\u5bb9\u91cf\u5de8\u5927\u7684\u78c1\u76d8\u7ec4\uff0c\u5229\u7528\u4e2a\u522b\u78c1\u76d8\u63d0\u4f9b\u6570\u636e\u6240\u4ea7\u751f\u52a0\u6210\u6548\u679c\u63d0\u5347\u6574\u4e2a\u78c1\u76d8\u7cfb\u7edf\u6548\u80fd\u3002\u5229\u7528\u8fd9\u9879\u6280\u672f\uff0c\u5c06\u6570\u636e\u5207\u5272\u6210\u8bb8\u591a\u533a\u6bb5\uff0c\u5206\u522b\u5b58\u653e\u5728\u5404\u4e2a\u786c\u76d8\u4e0a\u3002 \u78c1\u76d8\u9635\u5217\u8fd8\u80fd\u5229\u7528\u540c\u4f4d\u68c0\u67e5\uff08Parity Check\uff09\u7684\u89c2\u5ff5\uff0c\u5728\u6570\u7ec4\u4e2d\u4efb\u610f\u4e00\u4e2a\u786c\u76d8\u6545\u969c\u65f6\uff0c\u4ecd\u53ef\u8bfb\u51fa\u6570\u636e\uff0c\u5728\u6570\u636e\u91cd\u6784\u65f6\uff0c\u5c06\u6570\u636e\u7ecf\u8ba1\u7b97\u540e\u91cd\u65b0\u7f6e\u5165\u65b0\u786c\u76d8\u4e2d\u3002","title":"1. Raid\u77e5\u8bc6"},{"location":"linux/raid/raid.index/#11","text":"\u72ec\u7acb\u78c1\u76d8\u5197\u4f59\u9635\u5217\uff08RAID\uff0credundant array of independent disks\uff09\u662f\u628a\u76f8\u540c\u7684\u6570\u636e\u5b58\u50a8\u5728\u591a\u4e2a\u786c\u76d8\u7684\u4e0d\u540c\u7684\u5730\u65b9\uff08\u56e0\u6b64\uff0c\u5197\u4f59\u5730\uff09\u7684\u65b9\u6cd5\u3002\u901a\u8fc7\u628a\u6570\u636e\u653e\u5728\u591a\u4e2a\u786c\u76d8\u4e0a\uff0c\u8f93\u5165\u8f93\u51fa\u64cd\u4f5c\u80fd\u4ee5\u5e73\u8861\u7684\u65b9\u5f0f\u4ea4\u53e0\uff0c\u6539\u826f\u6027\u80fd\u3002\u56e0\u4e3a\u591a\u4e2a\u786c\u76d8\u589e\u52a0\u4e86\u5e73\u5747\u6545\u969c\u95f4\u9694\u65f6\u95f4\uff08MTBF\uff09\uff0c\u50a8\u5b58\u5197\u4f59\u6570\u636e\u4e5f\u589e\u52a0\u4e86\u5bb9\u9519\u3002","title":"1.1 \u57fa\u672c\u4ecb\u7ecd"},{"location":"linux/raid/raid.index/#12","text":"\u78c1\u76d8\u9635\u5217\u5176\u6837\u5f0f\u6709\u4e09\u79cd\uff0c\u4e00\u662f\u5916\u63a5\u5f0f\u78c1\u76d8\u9635\u5217\u67dc\u3001\u4e8c\u662f\u5185\u63a5\u5f0f\u78c1\u76d8\u9635\u5217\u5361\uff0c\u4e09\u662f\u5229\u7528\u8f6f\u4ef6\u6765\u4eff\u771f\u3002 \u5916\u63a5\u5f0f\u78c1\u76d8\u9635\u5217\u67dc\u6700\u5e38\u88ab\u4f7f\u7528\u5927\u578b\u670d\u52a1\u5668\u4e0a\uff0c\u5177\u53ef\u70ed\u4ea4\u6362\uff08Hot Swap\uff09\u7684\u7279\u6027\uff0c\u4e0d\u8fc7\u8fd9\u7c7b\u4ea7\u54c1\u7684\u4ef7\u683c\u90fd\u5f88\u8d35\u3002 \u5185\u63a5\u5f0f\u78c1\u76d8\u9635\u5217\u5361\uff0c\u56e0\u4e3a\u4ef7\u683c\u4fbf\u5b9c\uff0c\u4f46\u9700\u8981\u8f83\u9ad8\u7684\u5b89\u88c5\u6280\u672f\uff0c\u9002\u5408\u6280\u672f\u4eba\u5458\u4f7f\u7528\u64cd\u4f5c\u3002\u786c\u4ef6\u9635\u5217\u80fd\u591f\u63d0\u4f9b\u5728\u7ebf\u6269\u5bb9\u3001\u52a8\u6001\u4fee\u6539\u9635\u5217\u7ea7\u522b\u3001\u81ea\u52a8\u6570\u636e\u6062\u590d\u3001\u9a71\u52a8\u5668\u6f2b\u6e38\u3001\u8d85\u9ad8\u901f\u7f13\u51b2\u7b49\u529f\u80fd\u3002\u5b83\u80fd\u63d0\u4f9b\u6027\u80fd\u3001\u6570\u636e\u4fdd\u62a4\u3001\u53ef\u9760\u6027\u3001\u53ef\u7528\u6027\u548c\u53ef\u7ba1\u7406\u6027\u7684\u89e3\u51b3\u65b9\u6848\u3002\u9635\u5217\u5361\u4e13\u7528\u7684\u5904\u7406\u5355\u5143\u6765\u8fdb\u884c\u64cd\u4f5c\u3002 \u5229\u7528\u8f6f\u4ef6\u4eff\u771f\u7684\u65b9\u5f0f\uff0c\u662f\u6307\u901a\u8fc7\u7f51\u7edc\u64cd\u4f5c\u7cfb\u7edf\u81ea\u8eab\u63d0\u4f9b\u7684\u78c1\u76d8\u7ba1\u7406\u529f\u80fd\u5c06\u8fde\u63a5\u7684\u666e\u901aSCSI\u5361\u4e0a\u7684\u591a\u5757\u786c\u76d8\u914d\u7f6e\u6210\u903b\u8f91\u76d8\uff0c\u7ec4\u6210\u9635\u5217\u3002\u8f6f\u4ef6\u9635\u5217\u53ef\u4ee5\u63d0\u4f9b\u6570\u636e\u5197\u4f59\u529f\u80fd\uff0c\u4f46\u662f\u78c1\u76d8\u5b50\u7cfb\u7edf\u7684\u6027\u80fd\u4f1a\u6709\u6240\u964d\u4f4e\uff0c\u6709\u7684\u964d\u4f4e\u5e45\u5ea6\u8fd8\u6bd4\u8f83\u5927\uff0c\u8fbe30%\u5de6\u53f3\u3002\u56e0\u6b64\u4f1a\u62d6\u7d2f\u673a\u5668\u7684\u901f\u5ea6\uff0c\u4e0d\u9002\u5408\u5927\u6570\u636e\u6d41\u91cf\u7684\u670d\u52a1\u5668\u3002","title":"1.2 \u9635\u5217\u5206\u7c7b"},{"location":"linux/raid/raid.index/#13","text":"","title":"1.3 \u4f18\u7f3a\u70b9"},{"location":"linux/raid/raid.index/#131","text":"\u63d0\u9ad8\u4f20\u8f93\u901f\u7387\u3002RAID\u901a\u8fc7\u5728\u591a\u4e2a\u78c1\u76d8\u4e0a\u540c\u65f6\u5b58\u50a8\u548c\u8bfb\u53d6\u6570\u636e\u6765\u5927\u5e45\u63d0\u9ad8\u5b58\u50a8\u7cfb\u7edf\u7684\u6570\u636e\u541e\u5410\u91cf\uff08Throughput\uff09\u3002\u5728RAID\u4e2d\uff0c\u53ef\u4ee5\u8ba9\u5f88\u591a\u78c1\u76d8\u9a71\u52a8\u5668\u540c\u65f6\u4f20\u8f93\u6570\u636e\uff0c\u800c\u8fd9\u4e9b\u78c1\u76d8\u9a71\u52a8\u5668\u5728\u903b\u8f91\u4e0a\u53c8\u662f\u4e00\u4e2a\u78c1\u76d8\u9a71\u52a8\u5668\uff0c\u6240\u4ee5\u4f7f\u7528RAID\u53ef\u4ee5\u8fbe\u5230\u5355\u4e2a\u78c1\u76d8\u9a71\u52a8\u5668\u51e0\u500d\u3001\u51e0\u5341\u500d\u751a\u81f3\u4e0a\u767e\u500d\u7684\u901f\u7387\u3002\u8fd9\u4e5f\u662fRAID\u6700\u521d\u60f3\u8981\u89e3\u51b3\u7684\u95ee\u9898\u3002\u56e0\u4e3a\u5f53\u65f6CPU\u7684\u901f\u5ea6\u589e\u957f\u5f88\u5feb\uff0c\u800c\u78c1\u76d8\u9a71\u52a8\u5668\u7684\u6570\u636e\u4f20\u8f93\u901f\u7387\u65e0\u6cd5\u5927\u5e45\u63d0\u9ad8\uff0c\u6240\u4ee5\u9700\u8981\u6709\u4e00\u79cd\u65b9\u6848\u89e3\u51b3\u4e8c\u8005\u4e4b\u95f4\u7684\u77db\u76fe\u3002RAID\u6700\u540e\u6210\u529f\u4e86\u3002 \u901a\u8fc7\u6570\u636e\u6821\u9a8c\u63d0\u4f9b\u5bb9\u9519\u529f\u80fd\u3002\u666e\u901a\u78c1\u76d8\u9a71\u52a8\u5668\u65e0\u6cd5\u63d0\u4f9b\u5bb9\u9519\u529f\u80fd\uff0c\u5982\u679c\u4e0d\u5305\u62ec\u5199\u5728\u78c1\u76d8\u4e0a\u7684CRC\uff08\u5faa\u73af\u5197\u4f59\u6821\u9a8c\uff09\u7801\u7684\u8bdd\u3002RAID\u5bb9\u9519\u662f\u5efa\u7acb\u5728\u6bcf\u4e2a\u78c1\u76d8\u9a71\u52a8\u5668\u7684\u786c\u4ef6\u5bb9\u9519\u529f\u80fd\u4e4b\u4e0a\u7684\uff0c\u6240\u4ee5\u5b83\u63d0\u4f9b\u66f4\u9ad8\u7684\u5b89\u5168\u6027\u3002\u5728\u5f88\u591aRAID\u6a21\u5f0f\u4e2d\u90fd\u6709\u8f83\u4e3a\u5b8c\u5907\u7684\u76f8\u4e92\u6821\u9a8c/\u6062\u590d\u7684\u63aa\u65bd\uff0c\u751a\u81f3\u662f\u76f4\u63a5\u76f8\u4e92\u7684\u955c\u50cf\u5907\u4efd\uff0c\u4ece\u800c\u5927\u5927\u63d0\u9ad8\u4e86RAID\u7cfb\u7edf\u7684\u5bb9\u9519\u5ea6\uff0c\u63d0\u9ad8\u4e86\u7cfb\u7edf\u7684\u7a33\u5b9a\u5197\u4f59\u6027\u3002","title":"1.3.1 \u4f18\u70b9"},{"location":"linux/raid/raid.index/#132","text":"RAID0\u6ca1\u6709\u5197\u4f59\u529f\u80fd\uff0c\u5982\u679c\u4e00\u4e2a\u78c1\u76d8\uff08\u7269\u7406\uff09\u635f\u574f\uff0c\u5219\u6240\u6709\u7684\u6570\u636e\u90fd\u65e0\u6cd5\u4f7f\u7528\u3002 RAID1\u78c1\u76d8\u7684\u5229\u7528\u7387\u6700\u9ad8\u53ea\u80fd\u8fbe\u523050%(\u4f7f\u7528\u4e24\u5757\u76d8\u7684\u60c5\u51b5\u4e0b)\uff0c\u662f\u6240\u6709RAID\u7ea7\u522b\u4e2d\u6700\u4f4e\u7684\u3002 RAID0+1\u4ee5\u7406\u89e3\u4e3a\u662fRAID 0\u548cRAID 1\u7684\u6298\u4e2d\u65b9\u6848\u3002RAID 0+1\u53ef\u4ee5\u4e3a\u7cfb\u7edf\u63d0\u4f9b\u6570\u636e\u5b89\u5168\u4fdd\u969c\uff0c\u4f46\u4fdd\u969c\u7a0b\u5ea6\u8981\u6bd4 Mirror\u4f4e\u800c\u78c1\u76d8\u7a7a\u95f4\u5229\u7528\u7387\u8981\u6bd4Mirror\u9ad8\u3002","title":"1.3.2 \u7f3a\u70b9"},{"location":"linux/raid/raid.index/#2-raid","text":"\u4ee5\u4e0b\u4e3b\u8981\u4ecb\u7ecdraid0\uff0craid1,raid5\uff0craid10\u56db\u79cd\u4ecb\u7ecd\u3002","title":"2. Raid\u79cd\u7c7b\u4ecb\u7ecd"},{"location":"linux/raid/raid.index/#21-raid0","text":"RAID 0\u662f\u6700\u65e9\u51fa\u73b0\u7684RAID\u6a21\u5f0f\uff0c\u5373Data Stripping\u6570\u636e\u5206\u6761\u6280\u672f\u3002RAID 0\u662f\u7ec4\u5efa\u78c1\u76d8\u9635\u5217\u4e2d\u6700\u7b80\u5355\u7684\u4e00\u79cd\u5f62\u5f0f\uff0c\u53ea\u9700\u89812\u5757\u4ee5\u4e0a\u7684\u786c\u76d8\u5373\u53ef\uff0c\u6210\u672c\u4f4e\uff0c\u53ef\u4ee5\u63d0\u9ad8\u6574\u4e2a\u78c1\u76d8\u7684\u6027\u80fd\u548c\u541e\u5410\u91cf\u3002RAID 0\u6ca1\u6709\u63d0\u4f9b\u5197\u4f59\u6216\u9519\u8bef\u4fee\u590d\u80fd\u529b\uff0c\u4f46\u5b9e\u73b0\u6210\u672c\u662f\u6700\u4f4e\u7684\u3002 RAID 0\u6700\u7b80\u5355\u7684\u5b9e\u73b0\u65b9\u5f0f\u5c31\u662f\u628aN\u5757\u540c\u6837\u7684\u786c\u76d8\u7528\u786c\u4ef6\u7684\u5f62\u5f0f\u901a\u8fc7\u667a\u80fd\u78c1\u76d8\u63a7\u5236\u5668\u6216\u7528\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u78c1\u76d8\u9a71\u52a8\u7a0b\u5e8f\u4ee5\u8f6f\u4ef6\u7684\u65b9\u5f0f\u4e32\u8054\u5728\u4e00\u8d77\u521b\u5efa\u4e00\u4e2a\u5927\u7684\u5377\u96c6\u3002\u5728\u4f7f\u7528\u4e2d\u7535\u8111\u6570\u636e\u4f9d\u6b21\u5199\u5165\u5230\u5404\u5757\u786c\u76d8\u4e2d\uff0c\u5b83\u7684\u6700\u5927\u4f18\u70b9\u5c31\u662f\u53ef\u4ee5\u6574\u500d\u7684\u63d0\u9ad8\u786c\u76d8\u7684\u5bb9\u91cf\u3002\u5982\u4f7f\u7528\u4e86\u4e09\u575780GB\u7684\u786c\u76d8\u7ec4\u5efa\u6210RAID 0\u6a21\u5f0f\uff0c\u90a3\u4e48\u78c1\u76d8\u5bb9\u91cf\u5c31\u4f1a\u662f240GB\u3002\u5176\u901f\u5ea6\u65b9\u9762\uff0c\u5404\u5355\u72ec\u4e00\u5757\u786c\u76d8\u7684\u901f\u5ea6\u5b8c\u5168\u76f8\u540c\u3002\u6700\u5927\u7684\u7f3a\u70b9\u5728\u4e8e\u4efb\u4f55\u4e00\u5757\u786c\u76d8\u51fa\u73b0\u6545\u969c\uff0c\u6574\u4e2a\u7cfb\u7edf\u5c06\u4f1a\u53d7\u5230\u7834\u574f\uff0c\u53ef\u9760\u6027\u4ec5\u4e3a\u5355\u72ec\u4e00\u5757\u786c\u76d8\u76841/N\u3002 \u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0c\u4fbf\u51fa\u73b0\u4e86RAID 0\u7684\u53e6\u4e00\u79cd\u6a21\u5f0f\u3002\u5373\u5728N\u5757\u786c\u76d8\u4e0a\u9009\u62e9\u5408\u7406\u7684\u5e26\u533a\u6765\u521b\u5efa\u5e26\u533a\u96c6\u3002\u5176\u539f\u7406\u5c31\u662f\u5c06\u539f\u5148\u987a\u5e8f\u5199\u5165\u7684\u6570\u636e\u88ab\u5206\u6563\u5230\u6240\u6709\u7684\u56db\u5757\u786c\u76d8\u4e2d\u540c\u65f6\u8fdb\u884c\u8bfb\u5199\u3002\u56db\u5757\u786c\u76d8\u7684\u5e76\u884c\u64cd\u4f5c\u4f7f\u540c\u4e00\u65f6\u95f4\u5185\u78c1\u76d8\u8bfb\u5199\u7684\u901f\u5ea6\u63d0\u5347\u4e864\u500d\u3002 \u5728\u521b\u5efa\u5e26\u533a\u96c6\u65f6\uff0c\u5408\u7406\u7684\u9009\u62e9\u5e26\u533a\u7684\u5927\u5c0f\u975e\u5e38\u91cd\u8981\u3002\u5982\u679c\u5e26\u533a\u8fc7\u5927\uff0c\u53ef\u80fd\u4e00\u5757\u78c1\u76d8\u4e0a\u7684\u5e26\u533a\u7a7a\u95f4\u5c31\u53ef\u4ee5\u6ee1\u8db3\u5927\u90e8\u5206\u7684I/O\u64cd\u4f5c\uff0c\u4f7f\u6570\u636e\u7684\u8bfb\u5199\u4ecd\u7136\u53ea\u5c40\u9650\u5728\u5c11\u6570\u7684\u4e00\u3001\u4e24\u5757\u786c\u76d8\u4e0a\uff0c\u4e0d\u80fd\u5145\u5206\u7684\u53d1\u6325\u51fa\u5e76\u884c\u64cd\u4f5c\u7684\u4f18\u52bf\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c\u5e26\u533a\u8fc7\u5c0f\uff0c\u4efb\u4f55I/O\u6307\u4ee4\u90fd\u53ef\u80fd\u5f15\u53d1\u5927\u91cf\u7684\u8bfb\u5199\u64cd\u4f5c\uff0c\u5360\u7528\u8fc7\u591a\u7684\u63a7\u5236\u5668\u603b\u7ebf\u5e26\u5bbd\u3002\u56e0\u6b64\uff0c\u5728\u521b\u5efa\u5e26\u533a\u96c6\u65f6\uff0c\u6211\u4eec\u5e94\u5f53\u6839\u636e\u5b9e\u9645\u5e94\u7528\u7684\u9700\u8981\uff0c\u614e\u91cd\u7684\u9009\u62e9\u5e26\u533a\u7684\u5927\u5c0f\u3002 \u5e26\u533a\u96c6\u867d\u7136\u53ef\u4ee5\u628a\u6570\u636e\u5747\u5300\u7684\u5206\u914d\u5230\u6240\u6709\u7684\u78c1\u76d8\u4e0a\u8fdb\u884c\u8bfb\u5199\u3002\u4f46\u5982\u679c\u6211\u4eec\u628a\u6240\u6709\u7684\u786c\u76d8\u90fd\u8fde\u63a5\u5230\u4e00\u4e2a\u63a7\u5236\u5668\u4e0a\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u5e26\u6765\u6f5c\u5728\u7684\u5371\u5bb3\u3002\u8fd9\u662f\u56e0\u4e3a\u5f53\u6211\u4eec\u9891\u7e41\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\u65f6\uff0c\u5f88\u5bb9\u6613\u4f7f\u63a7\u5236\u5668\u6216\u603b\u7ebf\u7684\u8d1f\u8377 \u8d85\u8f7d\u3002\u4e3a\u4e86\u907f\u514d\u51fa\u73b0\u4e0a\u8ff0\u95ee\u9898\uff0c\u5efa\u8bae\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u78c1\u76d8\u63a7\u5236\u5668\u3002\u6700\u597d\u89e3\u51b3\u65b9\u6cd5\u8fd8\u662f\u4e3a\u6bcf\u4e00\u5757\u786c\u76d8\u90fd\u914d\u5907\u4e00\u4e2a\u4e13\u95e8\u7684\u78c1\u76d8\u63a7\u5236\u5668\u3002 \u867d\u7136RAID 0\u53ef\u4ee5\u63d0\u4f9b\u66f4\u591a\u7684\u7a7a\u95f4\u548c\u66f4\u597d\u7684\u6027\u80fd\uff0c\u4f46\u662f\u6574\u4e2a\u7cfb\u7edf\u662f\u975e\u5e38\u4e0d\u53ef\u9760\u7684\uff0c\u5982\u679c\u51fa\u73b0\u6545\u969c\uff0c\u65e0\u6cd5\u8fdb\u884c\u4efb\u4f55\u8865\u6551\u3002\u6240\u4ee5\uff0cRAID 0\u4e00\u822c\u53ea\u662f\u5728\u90a3\u4e9b\u5bf9\u6570\u636e\u5b89\u5168\u6027\u8981\u6c42\u4e0d\u9ad8\u7684\u60c5\u51b5\u4e0b\u624d\u88ab\u4eba\u4eec\u4f7f\u7528 \u4f18\u70b9 1. \u8bfb\u5199\u6027\u80fd\u662f\u6240\u6709RAID\u7ea7\u522b\u4e2d\u6700\u9ad8\u7684\u3002 2. RAID0\u7684\u7f3a\u70b9\u662f\u4e0d\u63d0\u4f9b\u6570\u636e\u5197\u4f59\uff0c\u56e0\u6b64\u4e00\u65e6\u7528\u6237\u6570\u636e\u635f\u574f\uff0c\u635f\u574f\u7684\u6570\u636e\u5c06\u65e0\u6cd5\u5f97\u5230\u6062\u590d\u3002RAID0\u8fd0\u884c\u65f6\u53ea\u8981\u5176\u4e2d\u4efb\u4e00\u5757\u786c\u76d8\u51fa\u73b0\u95ee\u9898\u5c31\u4f1a\u5bfc\u81f4\u6574\u4e2a\u6570\u636e\u7684\u6545\u969c\u3002\u4e00\u822c\u4e0d\u5efa\u8bae\u4f01\u4e1a\u7528\u6237\u5355\u72ec\u4f7f\u7528\u3002 \u7f3a\u70b9 1. \u78c1\u76d8\u7a7a\u95f4\u4f7f\u7528\u7387\uff1a100%\uff0c\u6545\u6210\u672c\u6700\u4f4e\u3002 2. \u8bfb\u6027\u80fd\uff1aN*\u5355\u5757\u78c1\u76d8\u7684\u8bfb\u6027\u80fd 3. \u5199\u6027\u80fd\uff1aN*\u5355\u5757\u78c1\u76d8\u7684\u5199\u6027\u80fd 4. \u5197\u4f59\uff1a\u65e0\uff0c\u4efb\u4f55\u4e00\u5757\u78c1\u76d8\u635f\u574f\u90fd\u5c06\u5bfc\u81f4\u6570\u636e\u4e0d\u53ef\u7528\u3002","title":"2.1 raid0"},{"location":"linux/raid/raid.index/#22-raid1","text":"RAID 1\u79f0\u4e3a\u78c1\u76d8\u955c\u50cf\uff0c\u539f\u7406\u662f\u628a\u4e00\u4e2a\u78c1\u76d8\u7684\u6570\u636e\u955c\u50cf\u5230\u53e6\u4e00\u4e2a\u78c1\u76d8\u4e0a\uff0c\u4e5f\u5c31\u662f\u8bf4\u6570\u636e\u5728\u5199\u5165\u4e00\u5757\u78c1\u76d8\u7684\u540c\u65f6\uff0c\u4f1a\u5728\u53e6\u4e00\u5757\u95f2\u7f6e\u7684\u78c1\u76d8\u4e0a\u751f\u6210\u955c\u50cf\u6587\u4ef6\uff0c\u5728\u4e0d\u5f71\u54cd\u6027\u80fd\u60c5\u51b5\u4e0b\u6700\u5927\u9650\u5ea6\u7684\u4fdd\u8bc1\u7cfb\u7edf\u7684\u53ef\u9760\u6027\u548c\u53ef\u4fee\u590d\u6027\u4e0a\uff0c\u53ea\u8981\u7cfb\u7edf\u4e2d\u4efb\u4f55\u4e00\u5bf9\u955c\u50cf\u76d8\u4e2d\u81f3\u5c11\u6709\u4e00\u5757\u78c1\u76d8\u53ef\u4ee5\u4f7f\u7528\uff0c\u751a\u81f3\u53ef\u4ee5\u5728\u4e00\u534a\u6570\u91cf\u7684\u786c\u76d8\u51fa\u73b0\u95ee\u9898\u65f6\u7cfb\u7edf\u90fd\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c,\u5f53\u4e00\u5757\u786c\u76d8\u5931\u6548\u65f6\uff0c\u7cfb\u7edf\u4f1a\u5ffd\u7565\u8be5\u786c\u76d8\uff0c\u8f6c\u800c\u4f7f\u7528\u5269\u4f59\u7684\u955c\u50cf\u76d8\u8bfb\u5199\u6570\u636e\uff0c\u5177\u5907\u5f88\u597d\u7684\u78c1\u76d8\u5197\u4f59\u80fd\u529b\u3002\u867d\u7136\u8fd9\u6837\u5bf9\u6570\u636e\u6765\u8bb2\u7edd\u5bf9\u5b89\u5168\uff0c\u4f46\u662f\u6210\u672c\u4e5f\u4f1a\u660e\u663e\u589e\u52a0\uff0c\u78c1\u76d8\u5229\u7528\u7387\u4e3a50%\uff0c\u4ee5\u56db\u575780GB\u5bb9\u91cf\u7684\u786c\u76d8\u6765\u8bb2\uff0c\u53ef\u5229\u7528\u7684\u78c1\u76d8\u7a7a\u95f4\u4ec5\u4e3a160GB\u3002\u53e6\u5916\uff0c\u51fa\u73b0\u786c\u76d8\u6545\u969c\u7684RAID\u7cfb\u7edf\u4e0d\u518d\u53ef\u9760\uff0c\u5e94\u5f53\u53ca\u65f6\u7684\u66f4\u6362\u635f\u574f\u7684\u786c\u76d8\uff0c\u5426\u5219\u5269\u4f59\u7684\u955c\u50cf\u76d8\u4e5f\u51fa\u73b0\u95ee\u9898\uff0c\u90a3\u4e48\u6574\u4e2a\u7cfb\u7edf\u5c31\u4f1a\u5d29\u6e83\u3002\u66f4\u6362\u65b0\u76d8\u540e\u539f\u6709\u6570\u636e\u4f1a\u9700\u8981\u5f88\u957f\u65f6\u95f4\u540c\u6b65\u955c\u50cf\uff0c\u5916\u754c\u5bf9\u6570\u636e\u7684\u8bbf\u95ee\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u53ea\u662f\u8fd9\u65f6\u6574\u4e2a\u7cfb\u7edf\u7684\u6027\u80fd\u6709\u6240\u4e0b\u964d\u3002\u56e0\u6b64\uff0cRAID 1\u591a\u7528\u5728\u4fdd\u5b58\u5173\u952e\u6027\u7684\u91cd\u8981\u6570\u636e\u7684\u573a\u5408\u3002 RAID 1\u4e3b\u8981\u662f\u901a\u8fc7\u4e8c\u6b21\u8bfb\u5199\u5b9e\u73b0\u78c1\u76d8\u955c\u50cf\uff0c\u6240\u4ee5\u78c1\u76d8\u63a7\u5236\u5668\u7684\u8d1f\u8f7d\u4e5f\u76f8\u5f53\u5927\uff0c\u5c24\u5176\u662f\u5728\u9700\u8981\u9891\u7e41\u5199\u5165\u6570\u636e\u7684\u73af\u5883\u4e2d\u3002\u4e3a\u4e86\u907f\u514d\u51fa\u73b0\u6027\u80fd\u74f6\u9888\uff0c\u4f7f\u7528\u591a\u4e2a\u78c1\u76d8\u63a7\u5236\u5668\u5c31\u663e\u5f97\u5f88\u6709\u5fc5\u8981\u3002 \u4f18\u70b9 RAID1\u901a\u8fc7\u786c\u76d8\u6570\u636e\u955c\u50cf\u5b9e\u73b0\u6570\u636e\u7684\u5197\u4f59\uff0c\u4fdd\u62a4\u6570\u636e\u5b89\u5168\uff0c\u5728\u4e24\u5757\u76d8\u4e0a\u4ea7\u751f\u4e92\u4e3a\u5907\u4efd\u7684\u6570\u636e\uff0c\u5f53\u539f\u59cb\u6570\u636e\u7e41\u5fd9\u65f6\uff0c\u53ef\u76f4\u63a5\u4ece\u955c\u50cf\u5907\u4efd\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u56e0\u6b64RAID1\u53ef\u4ee5\u63d0\u4f9b\u8bfb\u53d6\u6027\u80fd\u3002 RAID1\u662f\u786c\u76d8\u4e2d\u5355\u4f4d\u6210\u672c\u6700\u9ad8\u7684\uff0c\u4f46\u63d0\u4f9b\u4e86\u5f88\u9ad8\u7684\u6570\u636e\u5b89\u5168\u6027\u548c\u53ef\u7528\u6027\uff0c\u5f53\u4e00\u4e2a\u786c\u76d8\u5931\u6548\u65f6\uff0c\u7cfb\u7edf\u53ef\u4ee5\u81ea\u52a8\u5207\u6362\u5230\u955c\u50cf\u786c\u76d8\u4e0a\u8bfb/\u5199\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u91cd\u7ec4\u5931\u6548\u7684\u6570\u636e\u3002 \u7f3a\u70b9 1. \u78c1\u76d8\u7a7a\u95f4\u4f7f\u7528\u7387\uff1a50%\uff0c\u6545\u6210\u672c\u6700\u9ad8\u3002 2. \u8bfb\u6027\u80fd\uff1a\u53ea\u80fd\u5728\u4e00\u4e2a\u78c1\u76d8\u4e0a\u8bfb\u53d6\uff0c\u53d6\u51b3\u4e8e\u78c1\u76d8\u4e2d\u8f83\u5feb\u7684\u90a3\u5757\u76d8 3. \u5199\u6027\u80fd\uff1a\u4e24\u5757\u78c1\u76d8\u90fd\u8981\u5199\u5165\uff0c\u867d\u7136\u662f\u5e76\u884c\u5199\u5165\uff0c\u4f46\u56e0\u4e3a\u8981\u6bd4\u5bf9\uff0c\u6545\u6027\u80fd\u5355\u5757\u78c1\u76d8\u6162\u3002 4. \u5197\u4f59\uff1a\u53ea\u8981\u7cfb\u7edf\u4e2d\u4efb\u4f55\u4e00\u5bf9\u955c\u50cf\u76d8\u4e2d\u6709\u4e00\u5757\u78c1\u76d8\u53ef\u4ee5\u4f7f\u7528\uff0c\u751a\u81f3\u53ef\u4ee5\u5728\u4e00\u534a\u6570\u91cf\u7684\u786c\u76d8\u51fa\u73b0\u95ee\u9898\u65f6\u7cfb\u7edf\u90fd\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u3002","title":"2.2 raid1"},{"location":"linux/raid/raid.index/#23-raid5","text":"\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u7684\u5947\u5076\u6821\u9a8c\u7801\u5b58\u5728\u4e8e\u6240\u6709\u78c1\u76d8\u4e0a\uff0c\u5176\u4e2d\u7684p[a,b,c..]\u4ee3\u8868\u7b2ca\u5e26\u533a\u7684\u5947\u5076\u6821\u9a8c\u503c\uff0c\u5176\u5b83\u7684\u610f\u601d\u4e5f\u76f8\u540c\u3002RAID5\u7684\u8bfb\u51fa\u6548\u7387\u5f88\u9ad8\uff0c\u5199\u5165\u6548\u7387\u4e00\u822c\uff0c\u5757\u5f0f\u7684\u96c6\u4f53\u8bbf\u95ee\u6548\u7387\u4e0d\u9519\u3002\u56e0\u4e3a\u5947\u5076\u6821\u9a8c\u7801\u5728\u4e0d\u540c\u7684\u78c1\u76d8\u4e0a\uff0c\u6240\u4ee5\u63d0\u9ad8\u4e86\u53ef\u9760\u6027\u3002\u4f46\u662f\u5b83\u5bf9\u6570\u636e\u4f20\u8f93\u7684\u5e76\u884c\u6027\u89e3\u51b3\u4e0d\u597d\uff0c\u800c\u4e14\u63a7\u5236\u5668\u7684\u8bbe\u8ba1\u4e5f\u76f8\u5f53\u56f0\u96be\u3002RAID 3 \u4e0eRAID 5\u76f8\u6bd4\uff0c\u91cd\u8981\u7684\u533a\u522b\u5728\u4e8eRAID 3\u6bcf\u8fdb\u884c\u4e00\u6b21\u6570\u636e\u4f20\u8f93\uff0c\u9700\u6d89\u53ca\u5230\u6240\u6709\u7684\u9635\u5217\u76d8\u3002\u800c\u5bf9\u4e8eRAID 5\u6765\u8bf4\uff0c\u5927\u90e8\u5206\u6570\u636e\u4f20\u8f93\u53ea\u5bf9\u4e00\u5757\u78c1\u76d8\u64cd\u4f5c\uff0c\u53ef\u8fdb\u884c\u5e76\u884c\u64cd\u4f5c\u3002\u5728RAID 5\u4e2d\u6709\u201c\u5199\u635f\u5931\u201d\uff0c\u5373\u6bcf\u4e00\u6b21\u5199\u64cd\u4f5c\uff0c\u5c06\u4ea7\u751f\u56db\u4e2a\u5b9e\u9645\u7684\u8bfb/\u5199\u64cd\u4f5c\uff0c\u5176\u4e2d\u4e24\u6b21\u8bfb\u65e7\u7684\u6570\u636e\u53ca\u5947\u5076\u4fe1\u606f\uff0c\u4e24\u6b21\u5199\u65b0\u7684\u6570\u636e\u53ca\u5947\u5076\u4fe1\u606f\u3002 \u603b\u7ed3 1. \u78c1\u76d8\u7a7a\u95f4\u5229\u7528\u7387\uff1a(N-1)/N\uff0c\u5373\u53ea\u6d6a\u8d39\u4e00\u5757\u78c1\u76d8\u7528\u4e8e\u5947\u5076\u6821\u9a8c\u3002 2. \u8bfb\u6027\u80fd\uff1a(n-1)*\u5355\u5757\u78c1\u76d8\u7684\u8bfb\u6027\u80fd\uff0c\u63a5\u8fd1RAID0\u7684\u8bfb\u6027\u80fd\u3002 3. \u5199\u6027\u80fd\uff1a\u6bd4\u5355\u5757\u78c1\u76d8\u7684\u5199\u6027\u80fd\u8981\u5dee 4. \u5197\u4f59\uff1a\u53ea\u5141\u8bb8\u4e00\u5757\u78c1\u76d8\u635f\u574f\u3002","title":"2.3 raid5"},{"location":"linux/raid/raid.index/#24-raid10","text":"\u8fd9\u79cd\u7ed3\u6784\u65e0\u975e\u662f\u4e00\u4e2a\u5e26\u533a\u7ed3\u6784\u52a0\u4e00\u4e2a\u955c\u8c61\u7ed3\u6784\uff0c\u56e0\u4e3a\u4e24\u79cd\u7ed3\u6784\u5404\u6709\u4f18\u7f3a\u70b9\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f8\u4e92\u8865\u5145\uff0c\u8fbe\u5230\u65e2\u9ad8\u6548\u53c8\u9ad8\u901f\u7684\u76ee\u7684\u3002\u5927\u5bb6\u53ef\u4ee5\u7ed3\u5408\u4e24\u79cd\u7ed3\u6784\u7684\u4f18\u70b9\u548c\u7f3a\u70b9\u6765\u7406\u89e3\u8fd9\u79cd\u65b0\u7ed3\u6784\u3002\u8fd9\u79cd\u65b0\u7ed3\u6784\u7684\u4ef7\u683c\u9ad8\uff0c\u53ef\u6269\u5145\u6027\u4e0d\u597d\u3002\u4e3b\u8981\u7528\u4e8e\u6570\u636e\u5bb9\u91cf\u4e0d\u5927\uff0c\u4f46\u8981\u6c42\u901f\u5ea6\u548c\u5dee\u9519\u63a7\u5236\u7684\u6570\u636e\u5e93\u4e2d\u3002 \u603b\u7ed3 1. \u78c1\u76d8\u7a7a\u95f4\u5229\u7528\u7387\uff1a50%\u3002 2. \u8bfb\u6027\u80fd\uff1aN/2*\u5355\u5757\u786c\u76d8\u7684\u8bfb\u6027\u80fd 3. \u5199\u6027\u80fd\uff1aN/2*\u5355\u5757\u786c\u76d8\u7684\u5199\u6027\u80fd 4. \u5197\u4f59\uff1a\u53ea\u8981\u4e00\u5bf9\u955c\u50cf\u76d8\u4e2d\u6709\u4e00\u5757\u78c1\u76d8\u53ef\u4ee5\u4f7f\u7528\u5c31\u6ca1\u95ee\u9898\u3002","title":"2.4 raid10"},{"location":"linux/server/certificate/tomcat.index/","text":"Tomcat\u751f\u6210https+ssl\u53cc\u5411\u8bc1\u4e66\u8ba4\u8bc1 1. \u4ecb\u7ecd \u00b6 Q: \u4ec0\u4e48\u662fhttps? A: \u767e\u5ea6\u767e\u79d1\u8db3\u591f\u89e3\u91ca\u5b83\uff1a http://baike.baidu.com/view/14121.htm 2. \u73af\u5883\u51c6\u5907 \u00b6 \u5de5\u5177\uff1akeytool \uff08java\u81ea\u5e26\u7684\u5de5\u5177\uff09 \u73af\u5883\uff1aCentOS release 6.9 jdk1.8 3. \u4e3a\u670d\u52a1\u5668\u751f\u6210\u8bc1\u4e66 \u00b6 root@lt4:/ssl# keytool -genkey -v -alias tomcat -keyalg RSA -keystore /ssl/tomcat.keystore -validity 36500 Enter keystore password: #\u8f93\u5165\u5bc6\u7801111111 Re-enter new password: #\u8f93\u5165\u5bc6\u7801111111 What is your first and last name? [Unknown]: loocha What is the name of your organizational unit? [Unknown]: loocha What is the name of your organization? [Unknown]: loocha What is the name of your City or Locality? [Unknown]: js What is the name of your State or Province? [Unknown]: js What is the two-letter country code for this unit? [Unknown]: cn Is CN=loocha, OU=loocha, O=loocha, L=js, ST=js, C=cn correct? [no]: y Generating 2,048 bit RSA key pair and self-signed certificate (SHA256withRSA) with a validity of 36,500 days for: CN=loocha, OU=loocha, O=loocha, L=js, ST=js, C=cn Enter key password for <tomcat> (RETURN if same as keystore password): #\u8f93\u5165\u5bc6\u7801111111 [Storing /ssl/tomcat.keystore] #\u8f93\u5165\u5bc6\u7801111111 \u6ce8\u610f\u8bc1\u4e66\u6709\u6548\u671f /ssl/tomcat.keystore\u542b\u4e49\u662f\u5c06\u8bc1\u4e66\u6587\u4ef6\u7684\u4fdd\u5b58\u8def\u5f84\uff0c\u8bc1\u4e66\u6587\u4ef6\u540d\u79f0\u662ftomcat.keystore(\u53ef\u81ea\u5b9a\u4e49\u540d\u79f0)\uff1b -validity 36500 \u542b\u4e49\u662f\u8bc1\u4e66\u6709\u6548\u671f\uff0c36500\u8868\u793a100\u5e74\uff0c\u9ed8\u8ba4\u503c\u662f90\u5929\uff1b 4. \u4e3a\u5ba2\u6237\u7aef\u751f\u6210\u8bc1\u4e66 \u00b6 root@lt4:/ssl# keytool -genkey -v -alias mykey -keyalg RSA -storetype PKCS12 -keystore /ssl/client.key.p12 -validity 36500 Enter keystore password: Re-enter new password: What is your first and last name? [Unknown]: loocha What is the name of your organizational unit? [Unknown]: loocha What is the name of your organization? [Unknown]: loocha What is the name of your City or Locality? [Unknown]: js What is the name of your State or Province? [Unknown]: js What is the two-letter country code for this unit? [Unknown]: cn Is CN=loocha, OU=loocha, O=loocha, L=js, ST=js, C=cn correct? [no]: y Generating 2,048 bit RSA key pair and self-signed certificate (SHA256withRSA) with a validity of 90 days for: CN=loocha, OU=loocha, O=loocha, L=js, ST=js, C=cn [Storing /ssl/client.key.p12] root@lt4:/ssl# ll total 16 drwxr-xr-x 2 root root 4096 Oct 25 13:24 ./ drwxr-xr-x 25 999 root 4096 Oct 25 13:23 ../ -rw-r--r-- 1 root root 2546 Oct 25 13:24 client.key.p12 -rw-r--r-- 1 root root 2209 Oct 25 13:24 tomcat.keystore 5. \u5ba2\u6237\u7aef\u5b89\u88c5 \u00b6 \u627e\u4e00\u4e2a\u673a\u5668\u5b89\u88c5\uff0c\u6d4f\u89c8\u5668\u8bc1\u4e66 \u67e5\u770b\u5b89\u88c5\u7684\u8bc1\u4e66,\u5f00\u59cb\uff08win+R \u5feb\u6377\u6309\u952e\uff09\u8fd0\u884c\u4e2d\u8f93\u5165certmgr.msc 6. \u8ba9\u670d\u52a1\u5668\u4fe1\u4efb\u5ba2\u6237\u7aef\u8bc1\u4e66 \u00b6 6.1 \u5ba2\u6237\u7aef\u8bc1\u4e66\u5bfc\u51fa\u4e3aCER\u6587\u4ef6 \u00b6 \u7531\u4e8e\u662f\u53cc\u5411SSL\u8ba4\u8bc1\uff0c\u670d\u52a1\u5668\u5fc5\u987b\u8981\u4fe1\u4efb\u5ba2\u6237\u7aef\u8bc1\u4e66\uff0c\u56e0\u6b64\uff0c\u5fc5\u987b\u628a\u5ba2\u6237\u7aef\u8bc1\u4e66\u6dfb\u52a0\u4e3a\u670d\u52a1\u5668\u7684\u4fe1\u4efb\u8ba4\u8bc1\u3002\u56e0\u4e0d\u80fd\u76f4\u63a5\u5c06PKCS12\u683c\u5f0f\u7684\u8bc1\u4e66\u5e93\u5bfc\u5165\u670d\u52a1\u5668\u8bc1\u4e66\u5e93\uff0c\u5c06\u5ba2\u6237\u7aef\u8bc1\u4e66\u5bfc\u51fa\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684CER\u6587\u4ef6 root@lt4:/ssl# keytool -export -alias mykey -keystore /ssl/client.key.p12 -storetype PKCS12 -storepass 111111 -rfc -file /ssl/client.key.cer Certificate stored in file </ssl/client.key.cer> \u8bc1\u4e66\u5bc6\u7801 password\u4e3a\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684\u5bc6\u7801 6.2 CER\u6587\u4ef6\u5bfc\u5165\u670d\u52a1\u5668\u8bc1\u4e66\u5e93 \u00b6 root@lt4:/ssl# keytool -import -v -file /ssl/client.key.cer -keystore /ssl/tomcat.keystore Enter keystore password: #\u8f93\u5165\u5bc6\u7801111111 Owner: CN=loocha, OU=loocha, O=loocha, L=js, ST=js, C=cn Issuer: CN=loocha, OU=loocha, O=loocha, L=js, ST=js, C=cn Serial number: 22ec582e Valid from: Wed Oct 25 13:24:37 CST 2017 until: Tue Jan 23 13:24:37 CST 2018 Certificate fingerprints: MD5: 1C:BC:C9:7E:BA:06:1C:4F:37:78:96:3D:7B:76:5B:F8 SHA1: E9:A0:65:DB:60:B6:87:0F:60:85:47:8D:41:57:0F:FC:99:E2:6C:4E SHA256: CC:2D:B9:41:C1:70:60:F2:E6:11:B8:E5:6A:E9:1D:D9:EB:52:38:69:30:F9:8D:B2:A0:E1:9D:10:09:42:F9:EF Signature algorithm name: SHA256withRSA Version: 3 Extensions: #1: ObjectId: 2.5.29.14 Criticality=false SubjectKeyIdentifier [ KeyIdentifier [ 0000: 30 3C 89 80 90 44 88 DD 33 29 A5 3C EF 52 6C 79 0<...D..3).<.Rly 0010: 20 C4 F0 A4 ... ] ] Trust this certificate? [no]: y Certificate was added to keystore [Storing /ssl/tomcat.keystore] 7. \u68c0\u67e5 \u00b6 \u901a\u8fc7list\u547d\u4ee4\u67e5\u770b\u670d\u52a1\u5668\u7684\u8bc1\u4e66\u5e93\uff0c\u53ef\u4ee5\u770b\u5230\u4e24\u4e2a\u8bc1\u4e66\uff0c\u4e00\u4e2a\u662f\u670d\u52a1\u5668\u8bc1\u4e66\uff0c\u4e00\u4e2a\u662f\u53d7\u4fe1\u4efb\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66 keytool -list -keystore /ssl/tomcat.keystore (tomcat\u4e3a\u4f60\u8bbe\u7f6e\u670d\u52a1\u5668\u7aef\u7684\u8bc1\u4e66\u540d)\u3002 8. \u670d\u52a1\u5668\u7aef\u4fe1\u4efb\u5ba2\u6237\u7aef\u8bc1\u4e66 \u00b6 root@lt4:/ssl# keytool -list -keystore /ssl/tomcat.keystore Enter keystore password: #\u8f93\u5165\u5bc6\u7801111111 Keystore type: JKS Keystore provider: SUN Your keystore contains 2 entries tomcat, Oct 25, 2017, PrivateKeyEntry, Certificate fingerprint (SHA1): 2E:3B:52:F3:6C:B8:E7:4E:67:F5:15:55:80:70:24:58:57:F6:79:29 mykey, Oct 25, 2017, trustedCertEntry, Certificate fingerprint (SHA1): E9:A0:65:DB:60:B6:87:0F:60:85:47:8D:41:57:0F:FC:99:E2:6C:4E 8.1 \u670d\u52a1\u5668\u8bc1\u4e66\u5bfc\u51fa\u4e3aCER\u6587\u4ef6 \u00b6 \u7531\u4e8e\u662f\u53cc\u5411SSL\u8ba4\u8bc1\uff0c\u5ba2\u6237\u7aef\u4e5f\u8981\u9a8c\u8bc1\u670d\u52a1\u5668\u8bc1\u4e66\uff0c\u56e0\u6b64\uff0c\u5fc5\u987b\u628a\u670d\u52a1\u5668\u8bc1\u4e66\u6dfb\u52a0\u5230\u6d4f\u89c8\u7684\u201c\u53d7\u4fe1\u4efb\u7684\u6839\u8bc1\u4e66\u9881\u53d1\u673a\u6784\u201d\u3002\u7531\u4e8e\u4e0d\u80fd\u76f4\u63a5\u5c06keystore\u683c\u5f0f\u7684\u8bc1\u4e66\u5e93\u5bfc\u5165\uff0c\u5fc5\u987b\u5148\u628a\u670d\u52a1\u5668\u8bc1\u4e66\u5bfc\u51fa\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684CER\u6587\u4ef6\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a keytool -keystore /ssl/tomcat.keystore -export -alias tomcat -file /ssl/tomcat.cer \u8bc1\u4e66\u540d tomcat\u4e3a\u4f60\u8bbe\u7f6e\u670d\u52a1\u5668\u7aef\u7684\u8bc1\u4e66\u540d root@lt4:/ssl# keytool -keystore /ssl/tomcat.keystore -export -alias tomcat -file /ssl/tomcat.cer Enter keystore password: #\u8f93\u5165\u5bc6\u7801111111 Certificate stored in file </ssl/tomcat.cer> root@lt4:/ssl# ls client.key.cer client.key.p12 tomcat.cer tomcat.keystore root@lt4:/ssl# vim README.d root@lt4:/ssl# cat README.d password=111111 8.2 \u68c0\u67e5\u7ed3\u679c \u00b6 \u901a\u8fc7list\u547d\u4ee4\u67e5\u770b\u670d\u52a1\u5668\u7684\u8bc1\u4e66\u5e93\uff0c\u53ef\u4ee5\u770b\u5230\u4e24\u4e2a\u8bc1\u4e66\uff0c\u4e00\u4e2a\u662f\u670d\u52a1\u5668\u8bc1\u4e66\uff0c\u4e00\u4e2a\u662f\u53d7\u4fe1\u4efb\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66 root@lt4:/ssl# keytool -list -keystore /ssl/tomcat.keystore (tomcat\u4e3a\u4f60\u8bbe\u7f6e\u670d\u52a1\u5668\u7aef\u7684\u8bc1\u4e66\u540d)\u3002 root@lt4:/ssl# keytool -list -keystore /ssl/tomcat.keystore Enter keystore password: #\u8f93\u5165\u5bc6\u7801111111 Keystore type: JKS Keystore provider: SUN Your keystore contains 2 entries tomcat, Oct 25, 2017, PrivateKeyEntry, Certificate fingerprint (SHA1): 2E:3B:52:F3:6C:B8:E7:4E:67:F5:15:55:80:70:24:58:57:F6:79:29 mykey, Oct 25, 2017, trustedCertEntry, Certificate fingerprint (SHA1): E9:A0:65:DB:60:B6:87:0F:60:85:47:8D:41:57:0F:FC:99:E2:6C:4E 9. \u5ba2\u6237\u7aef\u4fe1\u4efb\u670d\u52a1\u5668\u8bc1\u4e66 \u00b6 9.1 \u670d\u52a1\u5668\u8bc1\u4e66\u5bfc\u51fa\u4e3aCER\u6587\u4ef6 \u00b6 \u7531\u4e8e\u662f\u53cc\u5411SSL\u8ba4\u8bc1\uff0c\u5ba2\u6237\u7aef\u4e5f\u8981\u9a8c\u8bc1\u670d\u52a1\u5668\u8bc1\u4e66\uff0c\u56e0\u6b64\uff0c\u5fc5\u987b\u628a\u670d\u52a1\u5668\u8bc1\u4e66\u6dfb\u52a0\u5230\u6d4f\u89c8\u7684\u201c\u53d7\u4fe1\u4efb\u7684\u6839\u8bc1\u4e66\u9881\u53d1\u673a\u6784\u201d\u3002\u7531\u4e8e\u4e0d\u80fd\u76f4\u63a5\u5c06keystore\u683c\u5f0f\u7684\u8bc1\u4e66\u5e93\u5bfc\u5165\uff0c\u5fc5\u987b\u5148\u628a\u670d\u52a1\u5668\u8bc1\u4e66\u5bfc\u51fa\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684CER\u6587\u4ef6\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a keytool -keystore /ssl/tomcat.keystore -export -alias tomcat -file /ssl/tomcat.cer !!! info '\u8bc1\u4e66\u540d' tomcat\u4e3a\u4f60\u8bbe\u7f6e\u670d\u52a1\u5668\u7aef\u7684\u8bc1\u4e66\u540d root@lt4:/ssl# keytool -keystore /ssl/tomcat.keystore -export -alias tomcat -file /ssl/tomcat.cer Enter keystore password: #\u8f93\u5165\u5bc6\u7801111111 Certificate stored in file </ssl/tomcat.cer> root@lt4:/ssl# ls client.key.cer client.key.p12 tomcat.cer tomcat.keystore root@lt4:/ssl# vim README.d root@lt4:/ssl# cat README.d password=111111 10. \u5728\u5ba2\u6237\u7aef\u5b89\u88c5\u670d\u52a1\u5668\u8bc1\u4e66 \u00b6 \u53cc\u51fbtomcat.cer\uff0c\u6309\u7167\u63d0\u793a\u5b89\u88c5\u8bc1\u4e66\uff0c\u5c06\u8bc1\u4e66\u586b\u5165\u5230 '\u53d7\u4fe1\u4efb\u7684\u6839\u8bc1\u4e66\u9881\u53d1\u673a\u6784'\u3002 11. \u6d4f\u89c8\u5668\u68c0\u67e5 \u00b6 IE -> Internet\u9009\u9879 -> \u5185\u5bb9 -> \u8bc1\u4e66 12. tomcat\u670d\u52a1\u914d\u7f6e \u00b6 server.xml \u914d\u7f6e <?xml version='1.0' encoding='utf-8'?> <!-- Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. --> <!-- Note: A \"Server\" is not itself a \"Container\", so you may not define subcomponents such as \"Valves\" at this level. Documentation at /docs/config/server.html --> <Server port=\"8005\" shutdown=\"SHUTDOWN\"> <Listener className=\"org.apache.catalina.startup.VersionLoggerListener\" /> <!-- Security listener. Documentation at /docs/config/listeners.html <Listener className=\"org.apache.catalina.security.SecurityListener\" /> --> <!--APR library loader. Documentation at /docs/apr.html --> <Listener className=\"org.apache.catalina.core.AprLifecycleListener\" SSLEngine=\"on\" /> <!--Initialize Jasper prior to webapps are loaded. Documentation at /docs/jasper-howto.html --> <Listener className=\"org.apache.catalina.core.JasperListener\" /> <!-- Prevent memory leaks due to use of particular java/javax APIs--> <Listener className=\"org.apache.catalina.core.JreMemoryLeakPreventionListener\" /> <Listener className=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\" /> <Listener className=\"org.apache.catalina.core.ThreadLocalLeakPreventionListener\" /> <!-- Global JNDI resources Documentation at /docs/jndi-resources-howto.html --> <GlobalNamingResources> <!-- Editable user database that can also be used by UserDatabaseRealm to authenticate users --> <Resource name=\"UserDatabase\" auth=\"Container\" type=\"org.apache.catalina.UserDatabase\" description=\"User database that can be updated and saved\" factory=\"org.apache.catalina.users.MemoryUserDatabaseFactory\" pathname=\"conf/tomcat-users.xml\" /> </GlobalNamingResources> <!-- A \"Service\" is a collection of one or more \"Connectors\" that share a single \"Container\" Note: A \"Service\" is not itself a \"Container\", so you may not define subcomponents such as \"Valves\" at this level. Documentation at /docs/config/service.html --> <Service name=\"Catalina\"> <!--The connectors can use a shared executor, you can define one or more named thread pools--> <!-- <Executor name=\"tomcatThreadPool\" namePrefix=\"catalina-exec-\" maxThreads=\"150\" minSpareThreads=\"4\"/> --> <!-- A \"Connector\" represents an endpoint by which requests are received and responses are returned. Documentation at : Java HTTP Connector: /docs/config/http.html (blocking & non-blocking) Java AJP Connector: /docs/config/ajp.html APR (HTTP/AJP) Connector: /docs/apr.html Define a non-SSL HTTP/1.1 Connector on port 8080 --> <!-- <Connector port=\"8080\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\" redirectPort=\"8443\" /> --> <!-- A \"Connector\" using the shared thread pool--> <!-- <Connector executor=\"tomcatThreadPool\" port=\"8080\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\" redirectPort=\"8443\" /> --> <!-- Define a SSL HTTP/1.1 Connector on port 8443 This connector uses the BIO implementation that requires the JSSE style configuration. When using the APR/native implementation, the OpenSSL style configuration is required as described in the APR/native documentation --> <Connector port=\"8443\" protocol=\"HTTP/1.1\" maxThreads=\"150\" SSLEnabled=\"true\" scheme=\"https\" secure=\"true\" clientAuth=\"true\" sslProtocol=\"TLS\" keystoreFile=\"/ssl/tomcat.keystore\" keystorePass=\"111111\" truststoreFile=\"/ssl/tomcat.keystore\" truststorePass=\"111111\" /> <!-- Define an AJP 1.3 Connector on port 8009 --> <Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" /> <!-- An Engine represents the entry point (within Catalina) that processes every request. The Engine implementation for Tomcat stand alone analyzes the HTTP headers included with the request, and passes them on to the appropriate Host (virtual host). Documentation at /docs/config/engine.html --> <!-- You should set jvmRoute to support load-balancing via AJP ie : <Engine name=\"Catalina\" defaultHost=\"localhost\" jvmRoute=\"jvm1\"> --> <Engine name=\"Catalina\" defaultHost=\"localhost\"> <!--For clustering, please take a look at documentation at: /docs/cluster-howto.html (simple how to) /docs/config/cluster.html (reference documentation) --> <!-- <Cluster className=\"org.apache.catalina.ha.tcp.SimpleTcpCluster\"/> --> <!-- Use the LockOutRealm to prevent attempts to guess user passwords via a brute-force attack --> <Realm className=\"org.apache.catalina.realm.LockOutRealm\"> <!-- This Realm uses the UserDatabase configured in the global JNDI resources under the key \"UserDatabase\". Any edits that are performed against this UserDatabase are immediately available for use by the Realm. --> <Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\" resourceName=\"UserDatabase\"/> </Realm> <Host name=\"localhost\" appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\"> <!-- SingleSignOn valve, share authentication between web applications Documentation at: /docs/config/valve.html --> <!-- <Valve className=\"org.apache.catalina.authenticator.SingleSignOn\" /> --> <!-- Access log processes all example. Documentation at: /docs/config/valve.html Note: The pattern used is equivalent to using pattern=\"common\" --> <Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\" prefix=\"localhost_access_log.\" suffix=\".txt\" pattern=\"%h %l %u %t &quot;%r&quot; %s %b\" /> </Host> </Engine> </Service> </Server> \u8fd9\u91cc\uff0c\u5bc6\u7801\u548c\u8bc1\u4e66\u7684\u4f4d\u7f6e\u6839\u636e\u4e2a\u4eba\u7684\u5177\u4f53\u73af\u5883\u800c\u8bbe\u7f6e\uff0c\u5c5e\u6027\u53c2\u6570\u5982\u4e0b\u6240\u8ff0\uff1a \u53c2\u6570 \u89e3\u91ca clientAuth \u5982\u679c\u8bbe\u4e3atrue\uff0c\u8868\u793aTomcat\u8981\u6c42\u6240\u6709\u7684SSL\u5ba2\u6237\u51fa\u793a\u5b89\u5168\u8bc1\u4e66\uff0c\u5bf9SSL\u5ba2\u6237\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1 keystoreFile \u6307\u5b9akeystore\u6587\u4ef6\u7684\u5b58\u653e\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u6307\u5b9a\u7edd\u5bf9\u8def\u5f84\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u76f8\u5bf9\u4e8e \uff08Tomcat\u5b89\u88c5\u76ee\u5f55\uff09\u73af\u5883\u53d8\u91cf \u7684\u76f8\u5bf9\u8def\u5f84\u3002\u5982\u679c\u6b64\u9879\u6ca1\u6709\u8bbe\u5b9a\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cTomcat\u5c06\u4ece\u5f53\u524d\u64cd\u4f5c\u7cfb\u7edf\u7528\u6237\u7684\u7528\u6237\u76ee\u5f55\u4e0b\u8bfb\u53d6\u540d\u4e3a\u201c.keystore\u201d\u7684\u6587\u4ef6\u3002 keystorePass \u6307\u5b9akeystore\u7684\u5bc6\u7801\uff0c\u5982\u679c\u6b64\u9879\u6ca1\u6709\u8bbe\u5b9a\uff0c\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cTomcat\u5c06\u4f7f\u7528\u201cchangeit\u201d\u4f5c\u4e3a\u9ed8\u8ba4\u5bc6\u7801\u3002 sslProtocol \u6307\u5b9a\u5957\u63a5\u5b57\uff08Socket\uff09\u4f7f\u7528\u7684\u52a0\u5bc6/\u89e3\u5bc6\u534f\u8bae\uff0c\u9ed8\u8ba4\u503c\u4e3aTLS\uff0c\u7528\u6237\u4e0d\u5e94\u8be5\u4fee\u6539\u8fd9\u4e2a\u9ed8\u8ba4\u503c\u3002 ciphers \u6307\u5b9a\u5957\u63a5\u5b57\u53ef\u7528\u7684\u7528\u4e8e\u52a0\u5bc6\u7684\u5bc6\u7801\u6e05\u5355\uff0c\u591a\u4e2a\u5bc6\u7801\u95f4\u4ee5\u9017\u53f7\uff08,\uff09\u5206\u9694\u3002\u5982\u679c\u6b64\u9879\u6ca1\u6709\u8bbe\u5b9a\uff0c\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5957\u63a5\u5b57\u53ef\u4ee5\u4f7f\u7528\u4efb\u610f\u4e00\u4e2a\u53ef\u7528\u7684\u5bc6\u7801\u3002 13. \u5ba2\u670d\u7aef\u6d4b\u8bd5 \u00b6","title":"1. Tomcat"},{"location":"linux/server/certificate/tomcat.index/#1","text":"Q: \u4ec0\u4e48\u662fhttps? A: \u767e\u5ea6\u767e\u79d1\u8db3\u591f\u89e3\u91ca\u5b83\uff1a http://baike.baidu.com/view/14121.htm","title":"1. \u4ecb\u7ecd"},{"location":"linux/server/certificate/tomcat.index/#2","text":"\u5de5\u5177\uff1akeytool \uff08java\u81ea\u5e26\u7684\u5de5\u5177\uff09 \u73af\u5883\uff1aCentOS release 6.9 jdk1.8","title":"2. \u73af\u5883\u51c6\u5907"},{"location":"linux/server/certificate/tomcat.index/#3","text":"root@lt4:/ssl# keytool -genkey -v -alias tomcat -keyalg RSA -keystore /ssl/tomcat.keystore -validity 36500 Enter keystore password: #\u8f93\u5165\u5bc6\u7801111111 Re-enter new password: #\u8f93\u5165\u5bc6\u7801111111 What is your first and last name? [Unknown]: loocha What is the name of your organizational unit? [Unknown]: loocha What is the name of your organization? [Unknown]: loocha What is the name of your City or Locality? [Unknown]: js What is the name of your State or Province? [Unknown]: js What is the two-letter country code for this unit? [Unknown]: cn Is CN=loocha, OU=loocha, O=loocha, L=js, ST=js, C=cn correct? [no]: y Generating 2,048 bit RSA key pair and self-signed certificate (SHA256withRSA) with a validity of 36,500 days for: CN=loocha, OU=loocha, O=loocha, L=js, ST=js, C=cn Enter key password for <tomcat> (RETURN if same as keystore password): #\u8f93\u5165\u5bc6\u7801111111 [Storing /ssl/tomcat.keystore] #\u8f93\u5165\u5bc6\u7801111111 \u6ce8\u610f\u8bc1\u4e66\u6709\u6548\u671f /ssl/tomcat.keystore\u542b\u4e49\u662f\u5c06\u8bc1\u4e66\u6587\u4ef6\u7684\u4fdd\u5b58\u8def\u5f84\uff0c\u8bc1\u4e66\u6587\u4ef6\u540d\u79f0\u662ftomcat.keystore(\u53ef\u81ea\u5b9a\u4e49\u540d\u79f0)\uff1b -validity 36500 \u542b\u4e49\u662f\u8bc1\u4e66\u6709\u6548\u671f\uff0c36500\u8868\u793a100\u5e74\uff0c\u9ed8\u8ba4\u503c\u662f90\u5929\uff1b","title":"3. \u4e3a\u670d\u52a1\u5668\u751f\u6210\u8bc1\u4e66"},{"location":"linux/server/certificate/tomcat.index/#4","text":"root@lt4:/ssl# keytool -genkey -v -alias mykey -keyalg RSA -storetype PKCS12 -keystore /ssl/client.key.p12 -validity 36500 Enter keystore password: Re-enter new password: What is your first and last name? [Unknown]: loocha What is the name of your organizational unit? [Unknown]: loocha What is the name of your organization? [Unknown]: loocha What is the name of your City or Locality? [Unknown]: js What is the name of your State or Province? [Unknown]: js What is the two-letter country code for this unit? [Unknown]: cn Is CN=loocha, OU=loocha, O=loocha, L=js, ST=js, C=cn correct? [no]: y Generating 2,048 bit RSA key pair and self-signed certificate (SHA256withRSA) with a validity of 90 days for: CN=loocha, OU=loocha, O=loocha, L=js, ST=js, C=cn [Storing /ssl/client.key.p12] root@lt4:/ssl# ll total 16 drwxr-xr-x 2 root root 4096 Oct 25 13:24 ./ drwxr-xr-x 25 999 root 4096 Oct 25 13:23 ../ -rw-r--r-- 1 root root 2546 Oct 25 13:24 client.key.p12 -rw-r--r-- 1 root root 2209 Oct 25 13:24 tomcat.keystore","title":"4. \u4e3a\u5ba2\u6237\u7aef\u751f\u6210\u8bc1\u4e66"},{"location":"linux/server/certificate/tomcat.index/#5","text":"\u627e\u4e00\u4e2a\u673a\u5668\u5b89\u88c5\uff0c\u6d4f\u89c8\u5668\u8bc1\u4e66 \u67e5\u770b\u5b89\u88c5\u7684\u8bc1\u4e66,\u5f00\u59cb\uff08win+R \u5feb\u6377\u6309\u952e\uff09\u8fd0\u884c\u4e2d\u8f93\u5165certmgr.msc","title":"5. \u5ba2\u6237\u7aef\u5b89\u88c5"},{"location":"linux/server/certificate/tomcat.index/#6","text":"","title":"6. \u8ba9\u670d\u52a1\u5668\u4fe1\u4efb\u5ba2\u6237\u7aef\u8bc1\u4e66"},{"location":"linux/server/certificate/tomcat.index/#61-cer","text":"\u7531\u4e8e\u662f\u53cc\u5411SSL\u8ba4\u8bc1\uff0c\u670d\u52a1\u5668\u5fc5\u987b\u8981\u4fe1\u4efb\u5ba2\u6237\u7aef\u8bc1\u4e66\uff0c\u56e0\u6b64\uff0c\u5fc5\u987b\u628a\u5ba2\u6237\u7aef\u8bc1\u4e66\u6dfb\u52a0\u4e3a\u670d\u52a1\u5668\u7684\u4fe1\u4efb\u8ba4\u8bc1\u3002\u56e0\u4e0d\u80fd\u76f4\u63a5\u5c06PKCS12\u683c\u5f0f\u7684\u8bc1\u4e66\u5e93\u5bfc\u5165\u670d\u52a1\u5668\u8bc1\u4e66\u5e93\uff0c\u5c06\u5ba2\u6237\u7aef\u8bc1\u4e66\u5bfc\u51fa\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684CER\u6587\u4ef6 root@lt4:/ssl# keytool -export -alias mykey -keystore /ssl/client.key.p12 -storetype PKCS12 -storepass 111111 -rfc -file /ssl/client.key.cer Certificate stored in file </ssl/client.key.cer> \u8bc1\u4e66\u5bc6\u7801 password\u4e3a\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684\u5bc6\u7801","title":"6.1 \u5ba2\u6237\u7aef\u8bc1\u4e66\u5bfc\u51fa\u4e3aCER\u6587\u4ef6"},{"location":"linux/server/certificate/tomcat.index/#62-cer","text":"root@lt4:/ssl# keytool -import -v -file /ssl/client.key.cer -keystore /ssl/tomcat.keystore Enter keystore password: #\u8f93\u5165\u5bc6\u7801111111 Owner: CN=loocha, OU=loocha, O=loocha, L=js, ST=js, C=cn Issuer: CN=loocha, OU=loocha, O=loocha, L=js, ST=js, C=cn Serial number: 22ec582e Valid from: Wed Oct 25 13:24:37 CST 2017 until: Tue Jan 23 13:24:37 CST 2018 Certificate fingerprints: MD5: 1C:BC:C9:7E:BA:06:1C:4F:37:78:96:3D:7B:76:5B:F8 SHA1: E9:A0:65:DB:60:B6:87:0F:60:85:47:8D:41:57:0F:FC:99:E2:6C:4E SHA256: CC:2D:B9:41:C1:70:60:F2:E6:11:B8:E5:6A:E9:1D:D9:EB:52:38:69:30:F9:8D:B2:A0:E1:9D:10:09:42:F9:EF Signature algorithm name: SHA256withRSA Version: 3 Extensions: #1: ObjectId: 2.5.29.14 Criticality=false SubjectKeyIdentifier [ KeyIdentifier [ 0000: 30 3C 89 80 90 44 88 DD 33 29 A5 3C EF 52 6C 79 0<...D..3).<.Rly 0010: 20 C4 F0 A4 ... ] ] Trust this certificate? [no]: y Certificate was added to keystore [Storing /ssl/tomcat.keystore]","title":"6.2 CER\u6587\u4ef6\u5bfc\u5165\u670d\u52a1\u5668\u8bc1\u4e66\u5e93"},{"location":"linux/server/certificate/tomcat.index/#7","text":"\u901a\u8fc7list\u547d\u4ee4\u67e5\u770b\u670d\u52a1\u5668\u7684\u8bc1\u4e66\u5e93\uff0c\u53ef\u4ee5\u770b\u5230\u4e24\u4e2a\u8bc1\u4e66\uff0c\u4e00\u4e2a\u662f\u670d\u52a1\u5668\u8bc1\u4e66\uff0c\u4e00\u4e2a\u662f\u53d7\u4fe1\u4efb\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66 keytool -list -keystore /ssl/tomcat.keystore (tomcat\u4e3a\u4f60\u8bbe\u7f6e\u670d\u52a1\u5668\u7aef\u7684\u8bc1\u4e66\u540d)\u3002","title":"7. \u68c0\u67e5"},{"location":"linux/server/certificate/tomcat.index/#8","text":"root@lt4:/ssl# keytool -list -keystore /ssl/tomcat.keystore Enter keystore password: #\u8f93\u5165\u5bc6\u7801111111 Keystore type: JKS Keystore provider: SUN Your keystore contains 2 entries tomcat, Oct 25, 2017, PrivateKeyEntry, Certificate fingerprint (SHA1): 2E:3B:52:F3:6C:B8:E7:4E:67:F5:15:55:80:70:24:58:57:F6:79:29 mykey, Oct 25, 2017, trustedCertEntry, Certificate fingerprint (SHA1): E9:A0:65:DB:60:B6:87:0F:60:85:47:8D:41:57:0F:FC:99:E2:6C:4E","title":"8. \u670d\u52a1\u5668\u7aef\u4fe1\u4efb\u5ba2\u6237\u7aef\u8bc1\u4e66"},{"location":"linux/server/certificate/tomcat.index/#81-cer","text":"\u7531\u4e8e\u662f\u53cc\u5411SSL\u8ba4\u8bc1\uff0c\u5ba2\u6237\u7aef\u4e5f\u8981\u9a8c\u8bc1\u670d\u52a1\u5668\u8bc1\u4e66\uff0c\u56e0\u6b64\uff0c\u5fc5\u987b\u628a\u670d\u52a1\u5668\u8bc1\u4e66\u6dfb\u52a0\u5230\u6d4f\u89c8\u7684\u201c\u53d7\u4fe1\u4efb\u7684\u6839\u8bc1\u4e66\u9881\u53d1\u673a\u6784\u201d\u3002\u7531\u4e8e\u4e0d\u80fd\u76f4\u63a5\u5c06keystore\u683c\u5f0f\u7684\u8bc1\u4e66\u5e93\u5bfc\u5165\uff0c\u5fc5\u987b\u5148\u628a\u670d\u52a1\u5668\u8bc1\u4e66\u5bfc\u51fa\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684CER\u6587\u4ef6\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a keytool -keystore /ssl/tomcat.keystore -export -alias tomcat -file /ssl/tomcat.cer \u8bc1\u4e66\u540d tomcat\u4e3a\u4f60\u8bbe\u7f6e\u670d\u52a1\u5668\u7aef\u7684\u8bc1\u4e66\u540d root@lt4:/ssl# keytool -keystore /ssl/tomcat.keystore -export -alias tomcat -file /ssl/tomcat.cer Enter keystore password: #\u8f93\u5165\u5bc6\u7801111111 Certificate stored in file </ssl/tomcat.cer> root@lt4:/ssl# ls client.key.cer client.key.p12 tomcat.cer tomcat.keystore root@lt4:/ssl# vim README.d root@lt4:/ssl# cat README.d password=111111","title":"8.1 \u670d\u52a1\u5668\u8bc1\u4e66\u5bfc\u51fa\u4e3aCER\u6587\u4ef6"},{"location":"linux/server/certificate/tomcat.index/#82","text":"\u901a\u8fc7list\u547d\u4ee4\u67e5\u770b\u670d\u52a1\u5668\u7684\u8bc1\u4e66\u5e93\uff0c\u53ef\u4ee5\u770b\u5230\u4e24\u4e2a\u8bc1\u4e66\uff0c\u4e00\u4e2a\u662f\u670d\u52a1\u5668\u8bc1\u4e66\uff0c\u4e00\u4e2a\u662f\u53d7\u4fe1\u4efb\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66 root@lt4:/ssl# keytool -list -keystore /ssl/tomcat.keystore (tomcat\u4e3a\u4f60\u8bbe\u7f6e\u670d\u52a1\u5668\u7aef\u7684\u8bc1\u4e66\u540d)\u3002 root@lt4:/ssl# keytool -list -keystore /ssl/tomcat.keystore Enter keystore password: #\u8f93\u5165\u5bc6\u7801111111 Keystore type: JKS Keystore provider: SUN Your keystore contains 2 entries tomcat, Oct 25, 2017, PrivateKeyEntry, Certificate fingerprint (SHA1): 2E:3B:52:F3:6C:B8:E7:4E:67:F5:15:55:80:70:24:58:57:F6:79:29 mykey, Oct 25, 2017, trustedCertEntry, Certificate fingerprint (SHA1): E9:A0:65:DB:60:B6:87:0F:60:85:47:8D:41:57:0F:FC:99:E2:6C:4E","title":"8.2 \u68c0\u67e5\u7ed3\u679c"},{"location":"linux/server/certificate/tomcat.index/#9","text":"","title":"9. \u5ba2\u6237\u7aef\u4fe1\u4efb\u670d\u52a1\u5668\u8bc1\u4e66"},{"location":"linux/server/certificate/tomcat.index/#91-cer","text":"\u7531\u4e8e\u662f\u53cc\u5411SSL\u8ba4\u8bc1\uff0c\u5ba2\u6237\u7aef\u4e5f\u8981\u9a8c\u8bc1\u670d\u52a1\u5668\u8bc1\u4e66\uff0c\u56e0\u6b64\uff0c\u5fc5\u987b\u628a\u670d\u52a1\u5668\u8bc1\u4e66\u6dfb\u52a0\u5230\u6d4f\u89c8\u7684\u201c\u53d7\u4fe1\u4efb\u7684\u6839\u8bc1\u4e66\u9881\u53d1\u673a\u6784\u201d\u3002\u7531\u4e8e\u4e0d\u80fd\u76f4\u63a5\u5c06keystore\u683c\u5f0f\u7684\u8bc1\u4e66\u5e93\u5bfc\u5165\uff0c\u5fc5\u987b\u5148\u628a\u670d\u52a1\u5668\u8bc1\u4e66\u5bfc\u51fa\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684CER\u6587\u4ef6\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a keytool -keystore /ssl/tomcat.keystore -export -alias tomcat -file /ssl/tomcat.cer !!! info '\u8bc1\u4e66\u540d' tomcat\u4e3a\u4f60\u8bbe\u7f6e\u670d\u52a1\u5668\u7aef\u7684\u8bc1\u4e66\u540d root@lt4:/ssl# keytool -keystore /ssl/tomcat.keystore -export -alias tomcat -file /ssl/tomcat.cer Enter keystore password: #\u8f93\u5165\u5bc6\u7801111111 Certificate stored in file </ssl/tomcat.cer> root@lt4:/ssl# ls client.key.cer client.key.p12 tomcat.cer tomcat.keystore root@lt4:/ssl# vim README.d root@lt4:/ssl# cat README.d password=111111","title":"9.1 \u670d\u52a1\u5668\u8bc1\u4e66\u5bfc\u51fa\u4e3aCER\u6587\u4ef6"},{"location":"linux/server/certificate/tomcat.index/#10","text":"\u53cc\u51fbtomcat.cer\uff0c\u6309\u7167\u63d0\u793a\u5b89\u88c5\u8bc1\u4e66\uff0c\u5c06\u8bc1\u4e66\u586b\u5165\u5230 '\u53d7\u4fe1\u4efb\u7684\u6839\u8bc1\u4e66\u9881\u53d1\u673a\u6784'\u3002","title":"10. \u5728\u5ba2\u6237\u7aef\u5b89\u88c5\u670d\u52a1\u5668\u8bc1\u4e66"},{"location":"linux/server/certificate/tomcat.index/#11","text":"IE -> Internet\u9009\u9879 -> \u5185\u5bb9 -> \u8bc1\u4e66","title":"11. \u6d4f\u89c8\u5668\u68c0\u67e5"},{"location":"linux/server/certificate/tomcat.index/#12-tomcat","text":"server.xml \u914d\u7f6e <?xml version='1.0' encoding='utf-8'?> <!-- Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. --> <!-- Note: A \"Server\" is not itself a \"Container\", so you may not define subcomponents such as \"Valves\" at this level. Documentation at /docs/config/server.html --> <Server port=\"8005\" shutdown=\"SHUTDOWN\"> <Listener className=\"org.apache.catalina.startup.VersionLoggerListener\" /> <!-- Security listener. Documentation at /docs/config/listeners.html <Listener className=\"org.apache.catalina.security.SecurityListener\" /> --> <!--APR library loader. Documentation at /docs/apr.html --> <Listener className=\"org.apache.catalina.core.AprLifecycleListener\" SSLEngine=\"on\" /> <!--Initialize Jasper prior to webapps are loaded. Documentation at /docs/jasper-howto.html --> <Listener className=\"org.apache.catalina.core.JasperListener\" /> <!-- Prevent memory leaks due to use of particular java/javax APIs--> <Listener className=\"org.apache.catalina.core.JreMemoryLeakPreventionListener\" /> <Listener className=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\" /> <Listener className=\"org.apache.catalina.core.ThreadLocalLeakPreventionListener\" /> <!-- Global JNDI resources Documentation at /docs/jndi-resources-howto.html --> <GlobalNamingResources> <!-- Editable user database that can also be used by UserDatabaseRealm to authenticate users --> <Resource name=\"UserDatabase\" auth=\"Container\" type=\"org.apache.catalina.UserDatabase\" description=\"User database that can be updated and saved\" factory=\"org.apache.catalina.users.MemoryUserDatabaseFactory\" pathname=\"conf/tomcat-users.xml\" /> </GlobalNamingResources> <!-- A \"Service\" is a collection of one or more \"Connectors\" that share a single \"Container\" Note: A \"Service\" is not itself a \"Container\", so you may not define subcomponents such as \"Valves\" at this level. Documentation at /docs/config/service.html --> <Service name=\"Catalina\"> <!--The connectors can use a shared executor, you can define one or more named thread pools--> <!-- <Executor name=\"tomcatThreadPool\" namePrefix=\"catalina-exec-\" maxThreads=\"150\" minSpareThreads=\"4\"/> --> <!-- A \"Connector\" represents an endpoint by which requests are received and responses are returned. Documentation at : Java HTTP Connector: /docs/config/http.html (blocking & non-blocking) Java AJP Connector: /docs/config/ajp.html APR (HTTP/AJP) Connector: /docs/apr.html Define a non-SSL HTTP/1.1 Connector on port 8080 --> <!-- <Connector port=\"8080\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\" redirectPort=\"8443\" /> --> <!-- A \"Connector\" using the shared thread pool--> <!-- <Connector executor=\"tomcatThreadPool\" port=\"8080\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\" redirectPort=\"8443\" /> --> <!-- Define a SSL HTTP/1.1 Connector on port 8443 This connector uses the BIO implementation that requires the JSSE style configuration. When using the APR/native implementation, the OpenSSL style configuration is required as described in the APR/native documentation --> <Connector port=\"8443\" protocol=\"HTTP/1.1\" maxThreads=\"150\" SSLEnabled=\"true\" scheme=\"https\" secure=\"true\" clientAuth=\"true\" sslProtocol=\"TLS\" keystoreFile=\"/ssl/tomcat.keystore\" keystorePass=\"111111\" truststoreFile=\"/ssl/tomcat.keystore\" truststorePass=\"111111\" /> <!-- Define an AJP 1.3 Connector on port 8009 --> <Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" /> <!-- An Engine represents the entry point (within Catalina) that processes every request. The Engine implementation for Tomcat stand alone analyzes the HTTP headers included with the request, and passes them on to the appropriate Host (virtual host). Documentation at /docs/config/engine.html --> <!-- You should set jvmRoute to support load-balancing via AJP ie : <Engine name=\"Catalina\" defaultHost=\"localhost\" jvmRoute=\"jvm1\"> --> <Engine name=\"Catalina\" defaultHost=\"localhost\"> <!--For clustering, please take a look at documentation at: /docs/cluster-howto.html (simple how to) /docs/config/cluster.html (reference documentation) --> <!-- <Cluster className=\"org.apache.catalina.ha.tcp.SimpleTcpCluster\"/> --> <!-- Use the LockOutRealm to prevent attempts to guess user passwords via a brute-force attack --> <Realm className=\"org.apache.catalina.realm.LockOutRealm\"> <!-- This Realm uses the UserDatabase configured in the global JNDI resources under the key \"UserDatabase\". Any edits that are performed against this UserDatabase are immediately available for use by the Realm. --> <Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\" resourceName=\"UserDatabase\"/> </Realm> <Host name=\"localhost\" appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\"> <!-- SingleSignOn valve, share authentication between web applications Documentation at: /docs/config/valve.html --> <!-- <Valve className=\"org.apache.catalina.authenticator.SingleSignOn\" /> --> <!-- Access log processes all example. Documentation at: /docs/config/valve.html Note: The pattern used is equivalent to using pattern=\"common\" --> <Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\" prefix=\"localhost_access_log.\" suffix=\".txt\" pattern=\"%h %l %u %t &quot;%r&quot; %s %b\" /> </Host> </Engine> </Service> </Server> \u8fd9\u91cc\uff0c\u5bc6\u7801\u548c\u8bc1\u4e66\u7684\u4f4d\u7f6e\u6839\u636e\u4e2a\u4eba\u7684\u5177\u4f53\u73af\u5883\u800c\u8bbe\u7f6e\uff0c\u5c5e\u6027\u53c2\u6570\u5982\u4e0b\u6240\u8ff0\uff1a \u53c2\u6570 \u89e3\u91ca clientAuth \u5982\u679c\u8bbe\u4e3atrue\uff0c\u8868\u793aTomcat\u8981\u6c42\u6240\u6709\u7684SSL\u5ba2\u6237\u51fa\u793a\u5b89\u5168\u8bc1\u4e66\uff0c\u5bf9SSL\u5ba2\u6237\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1 keystoreFile \u6307\u5b9akeystore\u6587\u4ef6\u7684\u5b58\u653e\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u6307\u5b9a\u7edd\u5bf9\u8def\u5f84\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u76f8\u5bf9\u4e8e \uff08Tomcat\u5b89\u88c5\u76ee\u5f55\uff09\u73af\u5883\u53d8\u91cf \u7684\u76f8\u5bf9\u8def\u5f84\u3002\u5982\u679c\u6b64\u9879\u6ca1\u6709\u8bbe\u5b9a\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cTomcat\u5c06\u4ece\u5f53\u524d\u64cd\u4f5c\u7cfb\u7edf\u7528\u6237\u7684\u7528\u6237\u76ee\u5f55\u4e0b\u8bfb\u53d6\u540d\u4e3a\u201c.keystore\u201d\u7684\u6587\u4ef6\u3002 keystorePass \u6307\u5b9akeystore\u7684\u5bc6\u7801\uff0c\u5982\u679c\u6b64\u9879\u6ca1\u6709\u8bbe\u5b9a\uff0c\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cTomcat\u5c06\u4f7f\u7528\u201cchangeit\u201d\u4f5c\u4e3a\u9ed8\u8ba4\u5bc6\u7801\u3002 sslProtocol \u6307\u5b9a\u5957\u63a5\u5b57\uff08Socket\uff09\u4f7f\u7528\u7684\u52a0\u5bc6/\u89e3\u5bc6\u534f\u8bae\uff0c\u9ed8\u8ba4\u503c\u4e3aTLS\uff0c\u7528\u6237\u4e0d\u5e94\u8be5\u4fee\u6539\u8fd9\u4e2a\u9ed8\u8ba4\u503c\u3002 ciphers \u6307\u5b9a\u5957\u63a5\u5b57\u53ef\u7528\u7684\u7528\u4e8e\u52a0\u5bc6\u7684\u5bc6\u7801\u6e05\u5355\uff0c\u591a\u4e2a\u5bc6\u7801\u95f4\u4ee5\u9017\u53f7\uff08,\uff09\u5206\u9694\u3002\u5982\u679c\u6b64\u9879\u6ca1\u6709\u8bbe\u5b9a\uff0c\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5957\u63a5\u5b57\u53ef\u4ee5\u4f7f\u7528\u4efb\u610f\u4e00\u4e2a\u53ef\u7528\u7684\u5bc6\u7801\u3002","title":"12. tomcat\u670d\u52a1\u914d\u7f6e"},{"location":"linux/server/certificate/tomcat.index/#13","text":"","title":"13. \u5ba2\u670d\u7aef\u6d4b\u8bd5"},{"location":"linux/server/deploy_django/deploy_django.index/","text":"Django\u9879\u76ee\u90e8\u7f72 1. \u4ecb\u7ecd \u00b6 uWSGI\u662f\u4e00\u4e2aWeb\u670d\u52a1\u5668\uff0c\u5b83\u5b9e\u73b0\u4e86WSGI\u534f\u8bae\u3001uwsgi\u3001http\u7b49\u534f\u8bae\u3002Nginx\u4e2dHttpUwsgiModule\u7684\u4f5c\u7528\u662f\u4e0euWSGI\u670d\u52a1\u5668\u8fdb\u884c\u4ea4\u6362\u3002 \u8981\u6ce8\u610f WSGI / uwsgi / uWSGI \u8fd9\u4e09\u4e2a\u6982\u5ff5\u7684\u533a\u5206\u3002 WSGI\u662f\u4e00\u79cdWeb\u670d\u52a1\u5668\u7f51\u5173\u63a5\u53e3\u3002\u5b83\u662f\u4e00\u4e2aWeb\u670d\u52a1\u5668\uff08\u5982nginx\uff0cuWSGI\u7b49\u670d\u52a1\u5668\uff09\u4e0eweb\u5e94\u7528\uff08\u5982\u7528Flask\u6846\u67b6\u5199\u7684\u7a0b\u5e8f\uff09\u901a\u4fe1\u7684\u4e00\u79cd\u89c4\u8303\u3002 uwsgi\u662f\u4e00\u79cd\u7ebf\u8def\u534f\u8bae\u800c\u4e0d\u662f\u901a\u4fe1\u534f\u8bae\uff0c\u5728\u6b64\u5e38\u7528\u4e8e\u5728uWSGI\u670d\u52a1\u5668\u4e0e\u5176\u4ed6\u7f51\u7edc\u670d\u52a1\u5668\u7684\u6570\u636e\u901a\u4fe1\u3002\u800cuWSGI\u662f\u5b9e\u73b0\u4e86uwsgi\u548cWSGI\u4e24\u79cd\u534f\u8bae\u7684Web\u670d\u52a1\u5668\u3002 uwsgi\u534f\u8bae\u662f\u4e00\u4e2auWSGI\u670d\u52a1\u5668\u81ea\u6709\u7684\u534f\u8bae\uff0c\u5b83\u7528\u4e8e\u5b9a\u4e49\u4f20\u8f93\u4fe1\u606f\u7684\u7c7b\u578b\uff08type of information\uff09\uff0c\u6bcf\u4e00\u4e2auwsgi packet\u524d4byte\u4e3a\u4f20\u8f93\u4fe1\u606f\u7c7b\u578b\u63cf\u8ff0\uff0c\u5b83\u4e0eWSGI\u76f8\u6bd4\u662f\u4e24\u6837\u4e1c\u897f\u3002 2. \u539f\u7406 \u00b6 \u9996\u5148\u5ba2\u6237\u7aef\u8bf7\u6c42\u670d\u52a1\u8d44\u6e90\uff0c nginx\u4f5c\u4e3a\u76f4\u63a5\u5bf9\u5916\u7684\u670d\u52a1\u63a5\u53e3,\u63a5\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u6765\u7684http\u8bf7\u6c42,\u4f1a\u89e3\u5305\u3001\u5206\u6790\uff0c \u5982\u679c\u662f\u9759\u6001\u6587\u4ef6\u8bf7\u6c42\u5c31\u6839\u636enginx\u914d\u7f6e\u7684\u9759\u6001\u6587\u4ef6\u76ee\u5f55\uff0c\u8fd4\u56de\u8bf7\u6c42\u7684\u8d44\u6e90\uff0c \u5982\u679c\u662f\u52a8\u6001\u7684\u8bf7\u6c42,nginx\u5c31\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6,\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9uWSGI\uff1buWSGI \u5c06\u63a5\u6536\u5230\u7684\u5305\u8fdb\u884c\u5904\u7406\uff0c\u5e76\u8f6c\u53d1\u7ed9wsgi\uff0c wsgi\u6839\u636e\u8bf7\u6c42\u8c03\u7528django\u5de5\u7a0b\u7684\u67d0\u4e2a\u6587\u4ef6\u6216\u51fd\u6570\uff0c\u5904\u7406\u5b8c\u540edjango\u5c06\u8fd4\u56de\u503c\u4ea4\u7ed9wsgi\uff0c wsgi\u5c06\u8fd4\u56de\u503c\u8fdb\u884c\u6253\u5305\uff0c\u8f6c\u53d1\u7ed9uWSGI\uff0c uWSGI\u63a5\u6536\u540e\u8f6c\u53d1\u7ed9nginx,nginx\u6700\u7ec8\u5c06\u8fd4\u56de\u503c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef(\u5982\u6d4f\u89c8\u5668)\u3002 3. windows\u7aef\u64cd\u4f5c \u00b6 3.1 \u9879\u76ee\u6253\u5305 \u00b6 3.2 \u5bfc\u51fa\u4f9d\u8d56 \u00b6 pip freeze > requirements.txt \uff08windows\u6211\u6d4b\u8bd5\u5931\u8d25\u3002\u6211\u76f4\u63a5pip list \u7136\u540e\u7f16\u8f91\u6587\u4ef6\u5230 requirements.txt\uff09 \u683c\u5f0f\u5982\u4e0b\uff1a (venv) [root@leco bookms]# cat requirements.txt asn1crypto==0.24.0 cffi==1.11.5 cryptography==2.4.2 Django==2.1.4 idna==2.8 pycparser==2.19 PyMySQL==0.9.2 pytz==2018.7 setuptools==39.1.0 six==1.12.0 3.3 \u4e0a\u4f20\u5230\u670d\u52a1\u5668 \u00b6 \u6700\u597d\u662f\u653e\u5728nginx\u7684\u6307\u5b9a\u7684\u5bb6\u76ee\u5f55\u4e0b\uff0c\u6211\u653e\u5728\u4e86\u5982\u4e0b\u8def\u5f84\u3002 (venv) [root@leco bookms]# pwd /usr/share/nginx/html/bookms 4. Linux\u7aef\u64cd\u4f5c \u00b6 4.1 \u5b89\u88c5nginx \u00b6 ubuntu \u7cfb\u7edf [root@leco etc]# apt-get install nginx centos\u7cfb\u7edf [root@leco etc]# yum install nginx 4.2 \u5b89\u88c5python \u00b6 4.2.1 \u4e0b\u8f7d \u00b6 [root@leco ~]# wget https://www.python.org/ftp/python/3.7.1/Python-3.7.1.tgz 4.2.2 \u89e3\u538b \u00b6 [root@leco ~]# tar xf Python-3.7.1.tgz 4.2.2 \u7f16\u8bd1\u5b89\u88c5 \u00b6 [root@leco ~]# cd Python-3.7.1 [root@leco Python-3.7.1]# ./configure && make && make install 4.2.3 \u6d4b\u8bd5 \u00b6 [root@leco Python-3.7.1]# python3 -V Python 3.7.1 [root@leco Python-3.7.1]# pip3 -V pip 10.0.1 from /usr/local/lib/python3.7/site-packages/pip (python 3.7) 4.3 \u5b89\u88c5\u865a\u62df\u73af\u5883 \u00b6 [root@leco Python-3.7.1]# pip3 install virtualenv 4.4 \u865a\u62df\u73af\u5883 \u00b6 \u627e\u5230\u9879\u76ee\u7684\u6839\u76ee\u5f55\uff0c\u5220\u9664windows\u81ea\u5e26\u7684\u865a\u62df\u73af\u5883\uff0c\u91cd\u65b0\u521b\u5efa\u548c\u5b89\u88c5\u5305 [root@leco bookms]# ls book bookms_02 db.sqlite3 manage.py requirements.txt static templates venv \u5220\u9664windows\u7684\u865a\u62df\u73af\u5883\uff0c\u82e5\u662f\u672c\u8eab\u5728linux\u4e0a\u7684\u5c31\u4e0d\u7528\u5220\u9664\u3002Windows\u7684\u6709\u70b9\u95ee\u9898 [root@leco bookms]# rm -rf venv [root@leco bookms]# virtualenv venv \u8fdb\u5165\u865a\u62df\u73af\u5883\uff0c\u6b64\u65f6\u5b89\u88c5\u7684\u5305\u90fd\u662f\u5728\u672c\u9879\u76ee\u7684\u865a\u62df\u73af\u5883\u4e2d\u3002 [root@cairui bookms]# source venv/bin/activate (venv) [root@cairui bookms]# \u8fdb\u5165\u865a\u62df\u73af\u5883\u540e\u524d\u9762\u4f1a\u591a(venv),(venv)\u662f\u865a\u62df\u73af\u5883\u7684\u540d\u5b57\u3002 (venv) [root@leco bookms]# pip install -r requirements.txt (venv) [root@leco bookms]# pip list Package Version ------------ ------- asn1crypto 0.24.0 cffi 1.11.5 cryptography 2.4.2 Django 2.1.4 idna 2.8 pip 18.1 pycparser 2.19 PyMySQL 0.9.2 pytz 2018.7 setuptools 39.1.0 six 1.12.0 wheel 0.32.3 5. \u914d\u7f6e \u00b6 5.1 \u8bbf\u95ee\u8bbe\u7f6e \u00b6 (venv) [root@leco bookms]# vim bookms_02/settings.py ALLOWED_HOSTS = ['*'] \u5730\u5740\u9650\u5236 \u661f\u53f7\u8868\u793a\u4e0d\u9650\u5236\u8bbf\u95ee\u7684IP\u5730\u5740 5.2 \u6570\u636e\u914d\u7f6e \u00b6 (venv) [root@leco bookms]# vim bookms_02/settings.py DATABASES = { 'default': { 'ENGINE': 'django.db.backends.mysql', 'NAME': 'book_orm', 'USER':'root', 'PASSWORD':'root', 'HOST':'127.0.0.1', 'PORT':'3306', } } \u914d\u7f6e\u53c2\u6570\u8be6\u89e3 'ENGINE' : 'django.db.backends.mysql' , \u4f7f\u7528 mysql\u6570\u636e\u5e93 'NAME' : 'book_orm' , \u6307\u5b9a\u6570\u636e\u5e93\u540d\uff0c\u9700\u8981\u624b\u52a8\u5148\u521b\u5efa 'USER' : 'root' , \u6570\u636e\u5e93\u767b\u5f55\u7528\u6237\u540d 'PASSWORD' : 'root' , \u6570\u636e\u5e93\u767b\u5f55\u7528\u6237\u540d\u5bf9\u5e94\u7684\u5bc6\u7801 'HOST' : '127.0.0.1' , mysql\u6570\u636e\u5e93\u7684IP\u5730\u5740 \u3002 'PORT' : '3306' , mysql\u7aef\u53e3 6.\u521b\u5efa\u6570\u636e\u5e93 \u00b6 6.1 \u521b\u5efa\u6570\u636e\u5e93 \u00b6 [root@leco Python-3.7.1]# mysql -uroot -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 4 Server version: 5.6.42 MySQL Community Server (GPL) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> create database book_orm DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci; 6.2 \u6570\u636e\u8fc1\u79fb \u00b6 \u6570\u636e\u8868\u521b\u5efa (venv) [root@leco bookms]# ls book bookms_02 db.sqlite3 manage.py requirements.txt static templates venv (venv) [root@leco bookms]# python3 manage.py makemigrations (venv) [root@leco bookms]# python3 manage.py migrate \u533a\u522b python manage . py makemigrations makemigrations\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u4e2amigrations\u6587\u4ef6\u5939 \uff0c\u8be5\u6587\u4ef6\u5939\u7684\u5185\u5bb9\u5c31\u662f\u6570\u636e\u5e93\u8981\u6267\u884c\u7684\u5185\u5bb9 python manage . py migrate migrate\u5c31\u662f\u6267\u884c\u4e4b\u524d\u751f\u6210\u7684migrations\u6587\u4ef6 \uff0c\u8fd9\u4e00\u6b65\u624d\u662f\u64cd\u4f5c\u6570\u636e\u5e93\u7684\u4e00\u6b65 6.3 \u6d4b\u8bd5 \u00b6 (venv) [root@leco bookms]# python3 manage.py runserver 0.0.0.0:7000 Performing system checks... System check identified no issues (0 silenced). (0.000) SELECT @@SQL_AUTO_IS_NULL; args=None (0.000) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None (0.001) SHOW FULL TABLES; args=None (0.003) SELECT `django_migrations`.`app`, `django_migrations`.`name` FROM `django_migrations`; args=() December 24, 2018 - 07:16:02 Django version 2.1.4, using settings 'bookms_02.settings' Starting development server at http://0.0.0.0:7000/ Quit the server with CONTROL-C. \u65b0\u5f00\u4e00\u4e2a\u7ec8\u7aef\u6d4b\u8bd5 [root@leco Python-3.7.1]# curl 127.0.0.1:7000 <!DOCTYPE html> <html lang=\"en\"> <head> <meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\"> <title>Page not found at /</title> <meta name=\"robots\" content=\"NONE,NOARCHIVE\"> <style type=\"text/css\"> html * { padding:0; margin:0; } body * { padding:10px 20px; } body * * { padding:0; } body { font:small sans-serif; background:#eee; color:#000; } body>div { border-bottom:1px solid #ddd; } h1 { font-weight:normal; margin-bottom:.4em; } h1 span { font-size:60%; color:#666; font-weight:normal; } table { border:none; border-collapse: collapse; width:100%; } td, th { vertical-align:top; padding:2px 3px; } th { width:12em; text-align:right; color:#666; padding-right:.5em; } #info { background:#f6f6f6; } #info ol { margin: 0.5em 4em; } #info ol li { font-family: monospace; } #summary { background: #ffc; } #explanation { background:#eee; border-bottom: 0px none; } </style> </head> <body> <div id=\"summary\"> <h1>Page not found <span>(404)</span></h1> <table class=\"meta\"> <tr> <th>Request Method:</th> <td>GET</td> </tr> <tr> <th>Request URL:</th> <td>http://127.0.0.1:7000/</td> </tr> </table> </div> <div id=\"info\"> <p> Using the URLconf defined in <code>bookms_02.urls</code>, Django tried these URL patterns, in this order: </p> <ol> <li> admin/ </li> <li> books/add/$ </li> <li> books/$ </li> <li> books/(\\d+)/change </li> <li> books/(\\d+)/delete </li> </ol> <p> The empty path didn't match any of these. </p> </div> <div id=\"explanation\"> <p> You're seeing this error because you have <code>DEBUG = True</code> in your Django settings file. Change that to <code>False</code>, and Django will display a standard 404 page. </p> </div> </body> </html> \u4ee5\u4e0a\u6d4b\u8bd5OK\u3002 6.4 \u521b\u5efa\u914d\u7f6e\u6587\u4ef6 \u00b6 (venv) [root@leco bookms]# mkdir conf (venv) [root@leco bookms]# mv bookms.conf socket.xml uwsgi.ini uwsgi_params conf/ (venv) [root@leco conf]# cat bookms.conf upstream django { # server unix:///path/to/your/mysite/mysite.sock; # for a file socket # \u8bbe\u7f6e\u672c\u5730\u670d\u52a1\u7684\u7aef\u53e3 server 127.0.0.1:8000; # for a web port socket (we'll use this first) } server{ listen 80; server_name localhost; charset utf-8; access_log off; location /static { alias /usr/share/nginx/html/bookms/static; # \u8981\u4e0e\u4e4b\u524ddjango\u7684setting.py\u4e2d\u6dfb\u52a0\u7684static\u9759\u6001\u6587\u4ef6\u8f6c\u79fb\u76ee\u5f55\u4e00\u81f4 } location / { uwsgi_pass django; include /usr/share/nginx/html/bookms/conf/uwsgi_params; } } (venv) [root@leco conf]# cat socket.xml <uwsgi> <socket>:8000</socket> <chdir>/usr/share/nginx/html/HelloWorld</chdir> <module>hello.wsgi</module> <processes>4</processes> <!-- \u8fdb\u7a0b\u6570 --> <daemonize>uwsgi.log</daemonize> </uwsgi> (venv) [root@leco conf]# cat uwsgi.ini [uwsgi] # Django-related settings # Django\u9879\u76ee\u672c\u5730\u7aef\u53e3 socket = :8000 # \u9879\u76ee\u6839\u76ee\u5f55\u4f4d\u7f6e chdir = /usr/share/nginx/html/bookms # wsgi.py\u6587\u4ef6\u5728\u9879\u76ee\u7684\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e wsgi-file = /usr/share/nginx/html/bookms/bookms_02/wsgi.py module =bookms.wsgi # \u8fdb\u7a0b\u8bbe\u7f6e\uff0c\u65e0\u9700\u53d8\u52a8 # master master = true # maximum number of worker processes # \u542f\u52a84\u4e2auwsgi\u8fdb\u7a0b processes = 4 # ... with appropriate permissions - may be needed # chmod-socket = 664 # clear environment on exit vacuum = true pidfile=uwsgi.pid daemonize=uwsgi.log (venv) [root@leco conf]# cat uwsgi_params # \u8fd9\u4e2a\u662f\u56fa\u5b9a\u7684\u6587\u4ef6\uff0c uwsgi_param QUERY_STRING $query_string; uwsgi_param REQUEST_METHOD $request_method; uwsgi_param CONTENT_TYPE $content_type; uwsgi_param CONTENT_LENGTH $content_length; uwsgi_param REQUEST_URI $request_uri; uwsgi_param PATH_INFO $document_uri; uwsgi_param DOCUMENT_ROOT $document_root; uwsgi_param SERVER_PROTOCOL $server_protocol; uwsgi_param REQUEST_SCHEME $scheme; uwsgi_param HTTPS $https if_not_empty; uwsgi_param REMOTE_ADDR $remote_addr; uwsgi_param REMOTE_PORT $remote_port; uwsgi_param SERVER_PORT $server_port; uwsgi_param SERVER_NAME $server_name (venv) [root@leco conf]# ls bookms.conf socket.xml uwsgi.ini uwsgi_params (venv) [root@leco conf]# pwd /usr/share/nginx/html/bookms/conf 7. \u5b89\u88c5\u8c03\u8bd5uwsgi \u00b6 (venv) [root@leco conf]# pip3 install uwsgi Looking in indexes: http://mirrors.cloud.aliyuncs.com/pypi/simple/ Collecting uwsgi Installing collected packages: uwsgi Successfully installed uwsgi-2.0.17.1 (venv) [root@leco conf]# uwsgi --ini uwsgi.ini [uWSGI] getting INI configuration from uwsgi.ini (venv) [root@leco conf]# ls bookms.conf socket.xml uwsgi.ini uwsgi.log uwsgi_params uwsgi.pid (venv) [root@leco conf]# ps axf|grep uwsgi 2589 pts/0 S+ 0:00 | \\_ grep uwsgi 31935 ? S 0:00 uwsgi --ini uwsgi.ini 31936 ? S 0:00 \\_ uwsgi --ini uwsgi.ini 31937 ? S 0:00 \\_ uwsgi --ini uwsgi.ini 31938 ? S 0:00 \\_ uwsgi --ini uwsgi.ini 31939 ? S 0:00 \\_ uwsgi --ini uwsgi.ini \u6ce8\u610f uwsgi\u5728\u54ea\u4e2a\u76ee\u5f55\u542f\u52a8 \uff0c\u5c31\u4f1a\u5728\u54ea\u4e2a\u76ee\u5f55\u751f\u6210 uwsgi . pid\u548cuswgi . log\u6587\u4ef6 \u3002 \u542f\u52a8\uff1a uwsgi -- ini uwsgi . ini \u505c\u6b62\uff1a uwsgi -- stop uwsgi . pid \u91cd\u542f\uff1a uwsgi -- reload uwsgi . pid \u5f3a\u5236\u505c\u6b62\uff1a killall - 9 uwsgi \u8fd9\u91cc\u6211\u4eec\u542f\u52a8 uwsgi\u670d\u52a1 \uff0c\u53ef\u4ee5\u901a\u8fc7 ps - ef | grep uwsgi\u770b\u5230\u5df2\u7ecf\u6709\u56db\u4e2auwsgi\u670d\u52a1\u542f\u52a8 \u3002 /usr/share/nginx/html/bookms/conf (venv) [root@leco conf]# pwd /usr/share/nginx/html/bookms/conf (venv) [root@leco conf]# ln -sf /usr/share/nginx/html/bookms/conf/bookms.conf /etc/nginx/conf.d/ (venv) [root@leco conf]# ll /etc/nginx/conf.d/ total 8 lrwxrwxrwx 1 root root 45 Dec 24 15:27 bookms.conf -> /usr/share/nginx/html/bookms/conf/bookms.conf (venv) [root@leco conf]# /etc/init.d/nginx configtest nginx: the configuration file /etc/nginx/nginx.conf syntax is ok nginx: configuration file /etc/nginx/nginx.conf test is successful (venv) [root@leco conf]# /etc/init.d/nginx restart Stopping nginx: [ OK ] Starting nginx: [ OK ] (venv) [root@leco conf]# 8. \u6d4f\u89c8\u5668\u6d4b\u8bd5 \u00b6 9. \u6c47\u603b\u914d\u7f6e\u6587\u4ef6 \u00b6 9.1 books.conf \u00b6 upstream django { # server unix:///path/to/your/mysite/mysite.sock; # for a file socket # \u8bbe\u7f6e\u672c\u5730\u670d\u52a1\u7684\u7aef\u53e3 server 127.0.0.1:8000; # for a web port socket (we'll use this first) } server{ listen 80; server_name localhost; charset utf-8; access_log off; location /static { alias /usr/share/nginx/html/bookms/static; #\u8981\u4e0e\u4e4b\u524ddjango\u7684setting.py\u4e2d\u6dfb\u52a0\u7684static\u9759\u6001\u6587\u4ef6\u8f6c\u79fb\u76ee\u5f55\u4e00\u81f4 } location / { uwsgi_pass django; include /usr/share/nginx/html/bookms/conf/uwsgi_params; } } 9.2 socket.xml \u00b6 <uwsgi> <socket>:8000</socket> <chdir>/usr/share/nginx/html/HelloWorld</chdir> <module>hello.wsgi</module> <processes>4</processes> <!-- \u8fdb\u7a0b\u6570 --> <daemonize>uwsgi.log</daemonize> </uwsgi> 9.3 uwsgi.ini \u00b6 [uwsgi] # Django-related settings # Django\u9879\u76ee\u672c\u5730\u7aef\u53e3 socket = :8000 # \u9879\u76ee\u6839\u76ee\u5f55\u4f4d\u7f6e chdir = /usr/share/nginx/html/bookms # wsgi.py\u6587\u4ef6\u5728\u9879\u76ee\u7684\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e wsgi-file = /usr/share/nginx/html/bookms/bookms_02/wsgi.py module =booksms.wsgi # \u8fdb\u7a0b\u8bbe\u7f6e\uff0c\u65e0\u9700\u53d8\u52a8 # master master = true # maximum number of worker processes # \u542f\u52a84\u4e2auwsgi\u8fdb\u7a0b processes = 4 # ... with appropriate permissions - may be needed # chmod-socket = 664 # clear environment on exit vacuum = true pidfile=uwsgi.pid daemonize=uwsgi.log 9.4 uwsgi_params \u00b6 uwsgi_param QUERY_STRING $query_string; uwsgi_param REQUEST_METHOD $request_method; uwsgi_param CONTENT_TYPE $content_type; uwsgi_param CONTENT_LENGTH $content_length; uwsgi_param REQUEST_URI $request_uri; uwsgi_param PATH_INFO $document_uri; uwsgi_param DOCUMENT_ROOT $document_root; uwsgi_param SERVER_PROTOCOL $server_protocol; uwsgi_param REQUEST_SCHEME $scheme; uwsgi_param HTTPS $https if_not_empty; uwsgi_param REMOTE_ADDR $remote_addr; uwsgi_param REMOTE_PORT $remote_port; uwsgi_param SERVER_PORT $server_port; uwsgi_param SERVER_NAME $server_name;","title":"3. django\u9879\u76ee\u90e8\u7f72"},{"location":"linux/server/deploy_django/deploy_django.index/#1","text":"uWSGI\u662f\u4e00\u4e2aWeb\u670d\u52a1\u5668\uff0c\u5b83\u5b9e\u73b0\u4e86WSGI\u534f\u8bae\u3001uwsgi\u3001http\u7b49\u534f\u8bae\u3002Nginx\u4e2dHttpUwsgiModule\u7684\u4f5c\u7528\u662f\u4e0euWSGI\u670d\u52a1\u5668\u8fdb\u884c\u4ea4\u6362\u3002 \u8981\u6ce8\u610f WSGI / uwsgi / uWSGI \u8fd9\u4e09\u4e2a\u6982\u5ff5\u7684\u533a\u5206\u3002 WSGI\u662f\u4e00\u79cdWeb\u670d\u52a1\u5668\u7f51\u5173\u63a5\u53e3\u3002\u5b83\u662f\u4e00\u4e2aWeb\u670d\u52a1\u5668\uff08\u5982nginx\uff0cuWSGI\u7b49\u670d\u52a1\u5668\uff09\u4e0eweb\u5e94\u7528\uff08\u5982\u7528Flask\u6846\u67b6\u5199\u7684\u7a0b\u5e8f\uff09\u901a\u4fe1\u7684\u4e00\u79cd\u89c4\u8303\u3002 uwsgi\u662f\u4e00\u79cd\u7ebf\u8def\u534f\u8bae\u800c\u4e0d\u662f\u901a\u4fe1\u534f\u8bae\uff0c\u5728\u6b64\u5e38\u7528\u4e8e\u5728uWSGI\u670d\u52a1\u5668\u4e0e\u5176\u4ed6\u7f51\u7edc\u670d\u52a1\u5668\u7684\u6570\u636e\u901a\u4fe1\u3002\u800cuWSGI\u662f\u5b9e\u73b0\u4e86uwsgi\u548cWSGI\u4e24\u79cd\u534f\u8bae\u7684Web\u670d\u52a1\u5668\u3002 uwsgi\u534f\u8bae\u662f\u4e00\u4e2auWSGI\u670d\u52a1\u5668\u81ea\u6709\u7684\u534f\u8bae\uff0c\u5b83\u7528\u4e8e\u5b9a\u4e49\u4f20\u8f93\u4fe1\u606f\u7684\u7c7b\u578b\uff08type of information\uff09\uff0c\u6bcf\u4e00\u4e2auwsgi packet\u524d4byte\u4e3a\u4f20\u8f93\u4fe1\u606f\u7c7b\u578b\u63cf\u8ff0\uff0c\u5b83\u4e0eWSGI\u76f8\u6bd4\u662f\u4e24\u6837\u4e1c\u897f\u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/server/deploy_django/deploy_django.index/#2","text":"\u9996\u5148\u5ba2\u6237\u7aef\u8bf7\u6c42\u670d\u52a1\u8d44\u6e90\uff0c nginx\u4f5c\u4e3a\u76f4\u63a5\u5bf9\u5916\u7684\u670d\u52a1\u63a5\u53e3,\u63a5\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u9001\u8fc7\u6765\u7684http\u8bf7\u6c42,\u4f1a\u89e3\u5305\u3001\u5206\u6790\uff0c \u5982\u679c\u662f\u9759\u6001\u6587\u4ef6\u8bf7\u6c42\u5c31\u6839\u636enginx\u914d\u7f6e\u7684\u9759\u6001\u6587\u4ef6\u76ee\u5f55\uff0c\u8fd4\u56de\u8bf7\u6c42\u7684\u8d44\u6e90\uff0c \u5982\u679c\u662f\u52a8\u6001\u7684\u8bf7\u6c42,nginx\u5c31\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6,\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9uWSGI\uff1buWSGI \u5c06\u63a5\u6536\u5230\u7684\u5305\u8fdb\u884c\u5904\u7406\uff0c\u5e76\u8f6c\u53d1\u7ed9wsgi\uff0c wsgi\u6839\u636e\u8bf7\u6c42\u8c03\u7528django\u5de5\u7a0b\u7684\u67d0\u4e2a\u6587\u4ef6\u6216\u51fd\u6570\uff0c\u5904\u7406\u5b8c\u540edjango\u5c06\u8fd4\u56de\u503c\u4ea4\u7ed9wsgi\uff0c wsgi\u5c06\u8fd4\u56de\u503c\u8fdb\u884c\u6253\u5305\uff0c\u8f6c\u53d1\u7ed9uWSGI\uff0c uWSGI\u63a5\u6536\u540e\u8f6c\u53d1\u7ed9nginx,nginx\u6700\u7ec8\u5c06\u8fd4\u56de\u503c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef(\u5982\u6d4f\u89c8\u5668)\u3002","title":"2. \u539f\u7406"},{"location":"linux/server/deploy_django/deploy_django.index/#3-windows","text":"","title":"3. windows\u7aef\u64cd\u4f5c"},{"location":"linux/server/deploy_django/deploy_django.index/#31","text":"","title":"3.1 \u9879\u76ee\u6253\u5305"},{"location":"linux/server/deploy_django/deploy_django.index/#32","text":"pip freeze > requirements.txt \uff08windows\u6211\u6d4b\u8bd5\u5931\u8d25\u3002\u6211\u76f4\u63a5pip list \u7136\u540e\u7f16\u8f91\u6587\u4ef6\u5230 requirements.txt\uff09 \u683c\u5f0f\u5982\u4e0b\uff1a (venv) [root@leco bookms]# cat requirements.txt asn1crypto==0.24.0 cffi==1.11.5 cryptography==2.4.2 Django==2.1.4 idna==2.8 pycparser==2.19 PyMySQL==0.9.2 pytz==2018.7 setuptools==39.1.0 six==1.12.0","title":"3.2 \u5bfc\u51fa\u4f9d\u8d56"},{"location":"linux/server/deploy_django/deploy_django.index/#33","text":"\u6700\u597d\u662f\u653e\u5728nginx\u7684\u6307\u5b9a\u7684\u5bb6\u76ee\u5f55\u4e0b\uff0c\u6211\u653e\u5728\u4e86\u5982\u4e0b\u8def\u5f84\u3002 (venv) [root@leco bookms]# pwd /usr/share/nginx/html/bookms","title":"3.3 \u4e0a\u4f20\u5230\u670d\u52a1\u5668"},{"location":"linux/server/deploy_django/deploy_django.index/#4-linux","text":"","title":"4. Linux\u7aef\u64cd\u4f5c"},{"location":"linux/server/deploy_django/deploy_django.index/#41-nginx","text":"ubuntu \u7cfb\u7edf [root@leco etc]# apt-get install nginx centos\u7cfb\u7edf [root@leco etc]# yum install nginx","title":"4.1 \u5b89\u88c5nginx"},{"location":"linux/server/deploy_django/deploy_django.index/#42-python","text":"","title":"4.2 \u5b89\u88c5python"},{"location":"linux/server/deploy_django/deploy_django.index/#421","text":"[root@leco ~]# wget https://www.python.org/ftp/python/3.7.1/Python-3.7.1.tgz","title":"4.2.1 \u4e0b\u8f7d"},{"location":"linux/server/deploy_django/deploy_django.index/#422","text":"[root@leco ~]# tar xf Python-3.7.1.tgz","title":"4.2.2 \u89e3\u538b"},{"location":"linux/server/deploy_django/deploy_django.index/#422_1","text":"[root@leco ~]# cd Python-3.7.1 [root@leco Python-3.7.1]# ./configure && make && make install","title":"4.2.2 \u7f16\u8bd1\u5b89\u88c5"},{"location":"linux/server/deploy_django/deploy_django.index/#423","text":"[root@leco Python-3.7.1]# python3 -V Python 3.7.1 [root@leco Python-3.7.1]# pip3 -V pip 10.0.1 from /usr/local/lib/python3.7/site-packages/pip (python 3.7)","title":"4.2.3 \u6d4b\u8bd5"},{"location":"linux/server/deploy_django/deploy_django.index/#43","text":"[root@leco Python-3.7.1]# pip3 install virtualenv","title":"4.3 \u5b89\u88c5\u865a\u62df\u73af\u5883"},{"location":"linux/server/deploy_django/deploy_django.index/#44","text":"\u627e\u5230\u9879\u76ee\u7684\u6839\u76ee\u5f55\uff0c\u5220\u9664windows\u81ea\u5e26\u7684\u865a\u62df\u73af\u5883\uff0c\u91cd\u65b0\u521b\u5efa\u548c\u5b89\u88c5\u5305 [root@leco bookms]# ls book bookms_02 db.sqlite3 manage.py requirements.txt static templates venv \u5220\u9664windows\u7684\u865a\u62df\u73af\u5883\uff0c\u82e5\u662f\u672c\u8eab\u5728linux\u4e0a\u7684\u5c31\u4e0d\u7528\u5220\u9664\u3002Windows\u7684\u6709\u70b9\u95ee\u9898 [root@leco bookms]# rm -rf venv [root@leco bookms]# virtualenv venv \u8fdb\u5165\u865a\u62df\u73af\u5883\uff0c\u6b64\u65f6\u5b89\u88c5\u7684\u5305\u90fd\u662f\u5728\u672c\u9879\u76ee\u7684\u865a\u62df\u73af\u5883\u4e2d\u3002 [root@cairui bookms]# source venv/bin/activate (venv) [root@cairui bookms]# \u8fdb\u5165\u865a\u62df\u73af\u5883\u540e\u524d\u9762\u4f1a\u591a(venv),(venv)\u662f\u865a\u62df\u73af\u5883\u7684\u540d\u5b57\u3002 (venv) [root@leco bookms]# pip install -r requirements.txt (venv) [root@leco bookms]# pip list Package Version ------------ ------- asn1crypto 0.24.0 cffi 1.11.5 cryptography 2.4.2 Django 2.1.4 idna 2.8 pip 18.1 pycparser 2.19 PyMySQL 0.9.2 pytz 2018.7 setuptools 39.1.0 six 1.12.0 wheel 0.32.3","title":"4.4 \u865a\u62df\u73af\u5883"},{"location":"linux/server/deploy_django/deploy_django.index/#5","text":"","title":"5. \u914d\u7f6e"},{"location":"linux/server/deploy_django/deploy_django.index/#51","text":"(venv) [root@leco bookms]# vim bookms_02/settings.py ALLOWED_HOSTS = ['*'] \u5730\u5740\u9650\u5236 \u661f\u53f7\u8868\u793a\u4e0d\u9650\u5236\u8bbf\u95ee\u7684IP\u5730\u5740","title":"5.1 \u8bbf\u95ee\u8bbe\u7f6e"},{"location":"linux/server/deploy_django/deploy_django.index/#52","text":"(venv) [root@leco bookms]# vim bookms_02/settings.py DATABASES = { 'default': { 'ENGINE': 'django.db.backends.mysql', 'NAME': 'book_orm', 'USER':'root', 'PASSWORD':'root', 'HOST':'127.0.0.1', 'PORT':'3306', } } \u914d\u7f6e\u53c2\u6570\u8be6\u89e3 'ENGINE' : 'django.db.backends.mysql' , \u4f7f\u7528 mysql\u6570\u636e\u5e93 'NAME' : 'book_orm' , \u6307\u5b9a\u6570\u636e\u5e93\u540d\uff0c\u9700\u8981\u624b\u52a8\u5148\u521b\u5efa 'USER' : 'root' , \u6570\u636e\u5e93\u767b\u5f55\u7528\u6237\u540d 'PASSWORD' : 'root' , \u6570\u636e\u5e93\u767b\u5f55\u7528\u6237\u540d\u5bf9\u5e94\u7684\u5bc6\u7801 'HOST' : '127.0.0.1' , mysql\u6570\u636e\u5e93\u7684IP\u5730\u5740 \u3002 'PORT' : '3306' , mysql\u7aef\u53e3","title":"5.2 \u6570\u636e\u914d\u7f6e"},{"location":"linux/server/deploy_django/deploy_django.index/#6","text":"","title":"6.\u521b\u5efa\u6570\u636e\u5e93"},{"location":"linux/server/deploy_django/deploy_django.index/#61","text":"[root@leco Python-3.7.1]# mysql -uroot -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 4 Server version: 5.6.42 MySQL Community Server (GPL) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> create database book_orm DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;","title":"6.1 \u521b\u5efa\u6570\u636e\u5e93"},{"location":"linux/server/deploy_django/deploy_django.index/#62","text":"\u6570\u636e\u8868\u521b\u5efa (venv) [root@leco bookms]# ls book bookms_02 db.sqlite3 manage.py requirements.txt static templates venv (venv) [root@leco bookms]# python3 manage.py makemigrations (venv) [root@leco bookms]# python3 manage.py migrate \u533a\u522b python manage . py makemigrations makemigrations\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u4e2amigrations\u6587\u4ef6\u5939 \uff0c\u8be5\u6587\u4ef6\u5939\u7684\u5185\u5bb9\u5c31\u662f\u6570\u636e\u5e93\u8981\u6267\u884c\u7684\u5185\u5bb9 python manage . py migrate migrate\u5c31\u662f\u6267\u884c\u4e4b\u524d\u751f\u6210\u7684migrations\u6587\u4ef6 \uff0c\u8fd9\u4e00\u6b65\u624d\u662f\u64cd\u4f5c\u6570\u636e\u5e93\u7684\u4e00\u6b65","title":"6.2 \u6570\u636e\u8fc1\u79fb"},{"location":"linux/server/deploy_django/deploy_django.index/#63","text":"(venv) [root@leco bookms]# python3 manage.py runserver 0.0.0.0:7000 Performing system checks... System check identified no issues (0 silenced). (0.000) SELECT @@SQL_AUTO_IS_NULL; args=None (0.000) SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED; args=None (0.001) SHOW FULL TABLES; args=None (0.003) SELECT `django_migrations`.`app`, `django_migrations`.`name` FROM `django_migrations`; args=() December 24, 2018 - 07:16:02 Django version 2.1.4, using settings 'bookms_02.settings' Starting development server at http://0.0.0.0:7000/ Quit the server with CONTROL-C. \u65b0\u5f00\u4e00\u4e2a\u7ec8\u7aef\u6d4b\u8bd5 [root@leco Python-3.7.1]# curl 127.0.0.1:7000 <!DOCTYPE html> <html lang=\"en\"> <head> <meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\"> <title>Page not found at /</title> <meta name=\"robots\" content=\"NONE,NOARCHIVE\"> <style type=\"text/css\"> html * { padding:0; margin:0; } body * { padding:10px 20px; } body * * { padding:0; } body { font:small sans-serif; background:#eee; color:#000; } body>div { border-bottom:1px solid #ddd; } h1 { font-weight:normal; margin-bottom:.4em; } h1 span { font-size:60%; color:#666; font-weight:normal; } table { border:none; border-collapse: collapse; width:100%; } td, th { vertical-align:top; padding:2px 3px; } th { width:12em; text-align:right; color:#666; padding-right:.5em; } #info { background:#f6f6f6; } #info ol { margin: 0.5em 4em; } #info ol li { font-family: monospace; } #summary { background: #ffc; } #explanation { background:#eee; border-bottom: 0px none; } </style> </head> <body> <div id=\"summary\"> <h1>Page not found <span>(404)</span></h1> <table class=\"meta\"> <tr> <th>Request Method:</th> <td>GET</td> </tr> <tr> <th>Request URL:</th> <td>http://127.0.0.1:7000/</td> </tr> </table> </div> <div id=\"info\"> <p> Using the URLconf defined in <code>bookms_02.urls</code>, Django tried these URL patterns, in this order: </p> <ol> <li> admin/ </li> <li> books/add/$ </li> <li> books/$ </li> <li> books/(\\d+)/change </li> <li> books/(\\d+)/delete </li> </ol> <p> The empty path didn't match any of these. </p> </div> <div id=\"explanation\"> <p> You're seeing this error because you have <code>DEBUG = True</code> in your Django settings file. Change that to <code>False</code>, and Django will display a standard 404 page. </p> </div> </body> </html> \u4ee5\u4e0a\u6d4b\u8bd5OK\u3002","title":"6.3 \u6d4b\u8bd5"},{"location":"linux/server/deploy_django/deploy_django.index/#64","text":"(venv) [root@leco bookms]# mkdir conf (venv) [root@leco bookms]# mv bookms.conf socket.xml uwsgi.ini uwsgi_params conf/ (venv) [root@leco conf]# cat bookms.conf upstream django { # server unix:///path/to/your/mysite/mysite.sock; # for a file socket # \u8bbe\u7f6e\u672c\u5730\u670d\u52a1\u7684\u7aef\u53e3 server 127.0.0.1:8000; # for a web port socket (we'll use this first) } server{ listen 80; server_name localhost; charset utf-8; access_log off; location /static { alias /usr/share/nginx/html/bookms/static; # \u8981\u4e0e\u4e4b\u524ddjango\u7684setting.py\u4e2d\u6dfb\u52a0\u7684static\u9759\u6001\u6587\u4ef6\u8f6c\u79fb\u76ee\u5f55\u4e00\u81f4 } location / { uwsgi_pass django; include /usr/share/nginx/html/bookms/conf/uwsgi_params; } } (venv) [root@leco conf]# cat socket.xml <uwsgi> <socket>:8000</socket> <chdir>/usr/share/nginx/html/HelloWorld</chdir> <module>hello.wsgi</module> <processes>4</processes> <!-- \u8fdb\u7a0b\u6570 --> <daemonize>uwsgi.log</daemonize> </uwsgi> (venv) [root@leco conf]# cat uwsgi.ini [uwsgi] # Django-related settings # Django\u9879\u76ee\u672c\u5730\u7aef\u53e3 socket = :8000 # \u9879\u76ee\u6839\u76ee\u5f55\u4f4d\u7f6e chdir = /usr/share/nginx/html/bookms # wsgi.py\u6587\u4ef6\u5728\u9879\u76ee\u7684\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e wsgi-file = /usr/share/nginx/html/bookms/bookms_02/wsgi.py module =bookms.wsgi # \u8fdb\u7a0b\u8bbe\u7f6e\uff0c\u65e0\u9700\u53d8\u52a8 # master master = true # maximum number of worker processes # \u542f\u52a84\u4e2auwsgi\u8fdb\u7a0b processes = 4 # ... with appropriate permissions - may be needed # chmod-socket = 664 # clear environment on exit vacuum = true pidfile=uwsgi.pid daemonize=uwsgi.log (venv) [root@leco conf]# cat uwsgi_params # \u8fd9\u4e2a\u662f\u56fa\u5b9a\u7684\u6587\u4ef6\uff0c uwsgi_param QUERY_STRING $query_string; uwsgi_param REQUEST_METHOD $request_method; uwsgi_param CONTENT_TYPE $content_type; uwsgi_param CONTENT_LENGTH $content_length; uwsgi_param REQUEST_URI $request_uri; uwsgi_param PATH_INFO $document_uri; uwsgi_param DOCUMENT_ROOT $document_root; uwsgi_param SERVER_PROTOCOL $server_protocol; uwsgi_param REQUEST_SCHEME $scheme; uwsgi_param HTTPS $https if_not_empty; uwsgi_param REMOTE_ADDR $remote_addr; uwsgi_param REMOTE_PORT $remote_port; uwsgi_param SERVER_PORT $server_port; uwsgi_param SERVER_NAME $server_name (venv) [root@leco conf]# ls bookms.conf socket.xml uwsgi.ini uwsgi_params (venv) [root@leco conf]# pwd /usr/share/nginx/html/bookms/conf","title":"6.4 \u521b\u5efa\u914d\u7f6e\u6587\u4ef6"},{"location":"linux/server/deploy_django/deploy_django.index/#7-uwsgi","text":"(venv) [root@leco conf]# pip3 install uwsgi Looking in indexes: http://mirrors.cloud.aliyuncs.com/pypi/simple/ Collecting uwsgi Installing collected packages: uwsgi Successfully installed uwsgi-2.0.17.1 (venv) [root@leco conf]# uwsgi --ini uwsgi.ini [uWSGI] getting INI configuration from uwsgi.ini (venv) [root@leco conf]# ls bookms.conf socket.xml uwsgi.ini uwsgi.log uwsgi_params uwsgi.pid (venv) [root@leco conf]# ps axf|grep uwsgi 2589 pts/0 S+ 0:00 | \\_ grep uwsgi 31935 ? S 0:00 uwsgi --ini uwsgi.ini 31936 ? S 0:00 \\_ uwsgi --ini uwsgi.ini 31937 ? S 0:00 \\_ uwsgi --ini uwsgi.ini 31938 ? S 0:00 \\_ uwsgi --ini uwsgi.ini 31939 ? S 0:00 \\_ uwsgi --ini uwsgi.ini \u6ce8\u610f uwsgi\u5728\u54ea\u4e2a\u76ee\u5f55\u542f\u52a8 \uff0c\u5c31\u4f1a\u5728\u54ea\u4e2a\u76ee\u5f55\u751f\u6210 uwsgi . pid\u548cuswgi . log\u6587\u4ef6 \u3002 \u542f\u52a8\uff1a uwsgi -- ini uwsgi . ini \u505c\u6b62\uff1a uwsgi -- stop uwsgi . pid \u91cd\u542f\uff1a uwsgi -- reload uwsgi . pid \u5f3a\u5236\u505c\u6b62\uff1a killall - 9 uwsgi \u8fd9\u91cc\u6211\u4eec\u542f\u52a8 uwsgi\u670d\u52a1 \uff0c\u53ef\u4ee5\u901a\u8fc7 ps - ef | grep uwsgi\u770b\u5230\u5df2\u7ecf\u6709\u56db\u4e2auwsgi\u670d\u52a1\u542f\u52a8 \u3002 /usr/share/nginx/html/bookms/conf (venv) [root@leco conf]# pwd /usr/share/nginx/html/bookms/conf (venv) [root@leco conf]# ln -sf /usr/share/nginx/html/bookms/conf/bookms.conf /etc/nginx/conf.d/ (venv) [root@leco conf]# ll /etc/nginx/conf.d/ total 8 lrwxrwxrwx 1 root root 45 Dec 24 15:27 bookms.conf -> /usr/share/nginx/html/bookms/conf/bookms.conf (venv) [root@leco conf]# /etc/init.d/nginx configtest nginx: the configuration file /etc/nginx/nginx.conf syntax is ok nginx: configuration file /etc/nginx/nginx.conf test is successful (venv) [root@leco conf]# /etc/init.d/nginx restart Stopping nginx: [ OK ] Starting nginx: [ OK ] (venv) [root@leco conf]#","title":"7. \u5b89\u88c5\u8c03\u8bd5uwsgi"},{"location":"linux/server/deploy_django/deploy_django.index/#8","text":"","title":"8. \u6d4f\u89c8\u5668\u6d4b\u8bd5"},{"location":"linux/server/deploy_django/deploy_django.index/#9","text":"","title":"9. \u6c47\u603b\u914d\u7f6e\u6587\u4ef6"},{"location":"linux/server/deploy_django/deploy_django.index/#91-booksconf","text":"upstream django { # server unix:///path/to/your/mysite/mysite.sock; # for a file socket # \u8bbe\u7f6e\u672c\u5730\u670d\u52a1\u7684\u7aef\u53e3 server 127.0.0.1:8000; # for a web port socket (we'll use this first) } server{ listen 80; server_name localhost; charset utf-8; access_log off; location /static { alias /usr/share/nginx/html/bookms/static; #\u8981\u4e0e\u4e4b\u524ddjango\u7684setting.py\u4e2d\u6dfb\u52a0\u7684static\u9759\u6001\u6587\u4ef6\u8f6c\u79fb\u76ee\u5f55\u4e00\u81f4 } location / { uwsgi_pass django; include /usr/share/nginx/html/bookms/conf/uwsgi_params; } }","title":"9.1 books.conf"},{"location":"linux/server/deploy_django/deploy_django.index/#92-socketxml","text":"<uwsgi> <socket>:8000</socket> <chdir>/usr/share/nginx/html/HelloWorld</chdir> <module>hello.wsgi</module> <processes>4</processes> <!-- \u8fdb\u7a0b\u6570 --> <daemonize>uwsgi.log</daemonize> </uwsgi>","title":"9.2 socket.xml"},{"location":"linux/server/deploy_django/deploy_django.index/#93-uwsgiini","text":"[uwsgi] # Django-related settings # Django\u9879\u76ee\u672c\u5730\u7aef\u53e3 socket = :8000 # \u9879\u76ee\u6839\u76ee\u5f55\u4f4d\u7f6e chdir = /usr/share/nginx/html/bookms # wsgi.py\u6587\u4ef6\u5728\u9879\u76ee\u7684\u4e2d\u7684\u76f8\u5bf9\u4f4d\u7f6e wsgi-file = /usr/share/nginx/html/bookms/bookms_02/wsgi.py module =booksms.wsgi # \u8fdb\u7a0b\u8bbe\u7f6e\uff0c\u65e0\u9700\u53d8\u52a8 # master master = true # maximum number of worker processes # \u542f\u52a84\u4e2auwsgi\u8fdb\u7a0b processes = 4 # ... with appropriate permissions - may be needed # chmod-socket = 664 # clear environment on exit vacuum = true pidfile=uwsgi.pid daemonize=uwsgi.log","title":"9.3 uwsgi.ini"},{"location":"linux/server/deploy_django/deploy_django.index/#94-uwsgi_params","text":"uwsgi_param QUERY_STRING $query_string; uwsgi_param REQUEST_METHOD $request_method; uwsgi_param CONTENT_TYPE $content_type; uwsgi_param CONTENT_LENGTH $content_length; uwsgi_param REQUEST_URI $request_uri; uwsgi_param PATH_INFO $document_uri; uwsgi_param DOCUMENT_ROOT $document_root; uwsgi_param SERVER_PROTOCOL $server_protocol; uwsgi_param REQUEST_SCHEME $scheme; uwsgi_param HTTPS $https if_not_empty; uwsgi_param REMOTE_ADDR $remote_addr; uwsgi_param REMOTE_PORT $remote_port; uwsgi_param SERVER_PORT $server_port; uwsgi_param SERVER_NAME $server_name;","title":"9.4 uwsgi_params"},{"location":"linux/server/harbor/harbor.index/","text":"Docker\u4f01\u4e1a\u7ea7\u79c1\u6709\u4ed3\u5e93 1. Harbor\u7b80\u4ecb \u00b6 Harbor\u662f\u4e00\u4e2a\u7528\u4e8e\u5b58\u50a8\u548c\u5206\u53d1Docker\u955c\u50cf\u7684\u4f01\u4e1a\u7ea7Registry\u670d\u52a1\u5668\u3002 \u955c\u50cf\u7684\u5b58\u50a8harbor\u4f7f\u7528\u7684\u662f\u5b98\u65b9\u7684docker registry(v2\u547d\u540d\u662fdistribution)\u670d\u52a1\u53bb\u5b8c\u6210\u3002harbor\u5728docker distribution\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u4e00\u4e9b\u5b89\u5168\u3001\u8bbf\u95ee\u63a7\u5236\u3001\u7ba1\u7406\u7684\u529f\u80fd\u4ee5\u6ee1\u8db3\u4f01\u4e1a\u5bf9\u4e8e\u955c\u50cf\u4ed3\u5e93\u7684\u9700\u6c42\u3002harbor\u4ee5docker-compose\u7684\u89c4\u8303\u5f62\u5f0f\u7ec4\u7ec7\u5404\u4e2a\u7ec4\u4ef6\uff0c\u5e76\u901a\u8fc7docker-compose\u5de5\u5177\u8fdb\u884c\u542f\u505c\u3002 docker\u7684registry\u662f\u7528\u672c\u5730\u5b58\u50a8\u6216\u8005s3\u90fd\u662f\u53ef\u4ee5\u7684\uff0charbor\u7684\u529f\u80fd\u662f\u5728\u6b64\u4e4b\u4e0a\u63d0\u4f9b\u7528\u6237\u6743\u9650\u7ba1\u7406\u3001\u955c\u50cf\u590d\u5236\u7b49\u529f\u80fd\uff0c\u63d0\u9ad8\u4f7f\u7528\u7684registry\u7684\u6548\u7387\u3002Harbor\u7684\u955c\u50cf\u62f7\u8d1d\u529f\u80fd\u662f\u901a\u8fc7docker registry\u7684API\u53bb\u62f7\u8d1d\uff0c\u8fd9\u79cd\u505a\u6cd5\u5c4f\u853d\u4e86\u7e41\u7410\u7684\u5e95\u5c42\u6587\u4ef6\u64cd\u4f5c\u3001\u4e0d\u4ec5\u53ef\u4ee5\u5229\u7528\u73b0\u6709docker registry\u529f\u80fd\u4e0d\u5fc5\u91cd\u590d\u9020\u8f6e\u5b50\uff0c\u800c\u4e14\u53ef\u4ee5\u89e3\u51b3\u51b2\u7a81\u548c\u4e00\u81f4\u6027\u7684\u95ee\u9898\u3002 1.1 Harbor\u67b6\u6784 \u00b6 \u4e3b\u8981\u7ec4\u4ef6\u5305\u62ec: Proxy\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6nginx\u3002\u5b83\u662f\u4e00\u4e2anginx\u53cd\u5411\u4ee3\u7406\uff0c\u4ee3\u7406Notary client\uff08\u955c\u50cf\u8ba4\u8bc1\uff09\u3001Docker client\uff08\u955c\u50cf\u4e0a\u4f20\u4e0b\u8f7d\u7b49\uff09\u548c\u6d4f\u89c8\u5668\u7684\u8bbf\u95ee\u8bf7\u6c42\uff08Core Service\uff09\u7ed9\u540e\u7aef\u7684\u5404\u670d\u52a1\uff1b UI\uff08Core Service\uff09\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6harbor-ui\u3002\u5e95\u5c42\u6570\u636e\u5b58\u50a8\u4f7f\u7528mysql\u6570\u636e\u5e93\uff0c\u4e3b\u8981\u63d0\u4f9b\u4e86\u56db\u4e2a\u5b50\u529f\u80fd\uff1a UI\uff1a\u4e00\u4e2aweb\u7ba1\u7406\u9875\u9762ui\uff1b API\uff1aHarbor\u66b4\u9732\u7684API\u670d\u52a1\uff1b Auth\uff1a\u7528\u6237\u8ba4\u8bc1\u670d\u52a1\uff0cdecode\u540e\u7684token\u4e2d\u7684\u7528\u6237\u4fe1\u606f\u5728\u8fd9\u91cc\u8fdb\u884c\u8ba4\u8bc1\uff1bauth\u540e\u7aef\u53ef\u4ee5\u63a5db\u3001ldap\u3001uaa\u4e09\u79cd\u8ba4\u8bc1\u5b9e\u73b0\uff1b Token\u670d\u52a1\uff08\u4e0a\u56fe\u4e2d\u672a\u4f53\u73b0\uff09\uff1a\u8d1f\u8d23\u6839\u636e\u7528\u6237\u5728\u6bcf\u4e2aproject\u4e2d\u7684role\u6765\u4e3a\u6bcf\u4e00\u4e2adocker push/pull\u547d\u4ee4issuing\u4e00\u4e2atoken\uff0c\u5982\u679c\u4ecedocker client\u53d1\u9001\u7ed9registry\u7684\u8bf7\u6c42\u6ca1\u6709\u5e26token\uff0cregistry\u4f1a\u91cd\u5b9a\u5411\u8bf7\u6c42\u5230token\u670d\u52a1\u521b\u5efatoken\u3002 Registry\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6registry\u3002\u8d1f\u8d23\u5b58\u50a8\u955c\u50cf\u6587\u4ef6\uff0c\u548c\u5904\u7406\u955c\u50cf\u7684pull/push\u547d\u4ee4\u3002Harbor\u5bf9\u955c\u50cf\u8fdb\u884c\u5f3a\u5236\u7684\u8bbf\u95ee\u63a7\u5236\uff0cRegistry\u4f1a\u5c06\u5ba2\u6237\u7aef\u7684\u6bcf\u4e2apull\u3001push\u8bf7\u6c42\u8f6c\u53d1\u5230token\u670d\u52a1\u6765\u83b7\u53d6\u6709\u6548\u7684token\u3002 Admin Service\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6harbor-adminserver\u3002\u662f\u7cfb\u7edf\u7684\u914d\u7f6e\u7ba1\u7406\u4e2d\u5fc3\u9644\u5e26\u68c0\u67e5\u5b58\u50a8\u7528\u91cf\uff0cui\u548cjobserver\u542f\u52a8\u65f6\u5019\u9700\u8981\u52a0\u8f7dadminserver\u7684\u914d\u7f6e\uff1b Job Sevice\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6harbor-jobservice\u3002\u8d1f\u8d23\u955c\u50cf\u590d\u5236\u5de5\u4f5c\u7684\uff0c\u4ed6\u548cregistry\u901a\u4fe1\uff0c\u4ece\u4e00\u4e2aregistry pull\u955c\u50cf\u7136\u540epush\u5230\u53e6\u4e00\u4e2aregistry\uff0c\u5e76\u8bb0\u5f55job_log\uff1b Log Collector\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6harbor-log\u3002\u65e5\u5fd7\u6c47\u603b\u7ec4\u4ef6\uff0c\u901a\u8fc7docker\u7684log-driver\u628a\u65e5\u5fd7\u6c47\u603b\u5230\u4e00\u8d77\uff1b Volnerability Scanning\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6clair\u3002\u8d1f\u8d23\u955c\u50cf\u626b\u63cf Notary\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6notary\u3002\u8d1f\u8d23\u955c\u50cf\u8ba4\u8bc1 DB\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6harbor-db\uff0c\u8d1f\u8d23\u5b58\u50a8project\u3001 user\u3001 role\u3001replication\u3001image_scan\u3001access\u7b49\u7684metadata\u6570\u636e\u3002 1.2 Docker Registery \u00b6 1.Registry\u7528\u4e8e\u4fdd\u5b58docker\u955c\u50cf\uff0c\u5305\u62ec\u955c\u50cf\u7684\u5c42\u6b21\u7ed3\u6784\u548c\u5143\u6570\u636e 2.\u7528\u6237\u53ef\u81ea\u5efaRegistry\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5b98\u65b9\u7684Docker Hub Docker Registery \u5206\u7c7b 1.Sponsor Registry \u7b2c\u4e09\u65b9Registry\uff0c\u4f9b\u5ba2\u6237\u548cDocker\u793e\u533a\u4f7f\u7528 2.Mirror Registry \u7b2c\u4e09\u65b9Registry\uff0c\u53ea\u8ba9\u5ba2\u6237\u4f7f\u7528 3.Vendor Registry \u7531\u53d1\u5e03Docker\u955c\u50cf\u7684\u4f9b\u5e94\u5546\u63d0\u4f9b\u7684Registry 4.Private Registry \u901a\u8fc7\u8bbe\u6709\u9632\u706b\u5899\u548c\u989d\u5916\u7684\u5b89\u5168\u5c42\u7684\u79c1\u6709\u5b9e\u4f53\u63d0\u4f9b\u7684Registry 2. \u7cfb\u7edf\u90e8\u7f72\u57fa\u7840 \u00b6 \u670d\u52a1\u5668\u7684ip\u89c4\u5212 \u673a\u5668 IP \u7cfb\u7edf Docker Registry 192.168.183.134 Centos 7\uff08\u968f\u4fbf\u4f60\u4ec0\u4e48\u7cfb\u7edf\uff09 Docker Client 192.168.183.133 Centos 7\uff08\u968f\u4fbf\u4f60\u4ec0\u4e48\u7cfb\u7edf\uff09\u63a8\u9001\u955c\u50cf Docker Client 192.168.183.135 Centos 7\uff08\u968f\u4fbf\u4f60\u4ec0\u4e48\u7cfb\u7edf\uff09\u62c9\u53d6\u955c\u50cf \u540d\u8bcd\u89e3\u91ca No \u540d\u8bcd \u89e3\u91ca 1 Docker Registry Docker\u79c1\u6709\u4ed3\u5e93\uff08\u672c\u5730\uff09 2 Docker Client \u4e0a\u4f20\u548c\u4e0b\u8f7d\u7684docker\u5ba2\u6237\u7aef 3. Docker\u81ea\u5e26\u4ed3\u5e93 \u00b6 3.1 \u5b89\u88c5\u5b98\u65b9\u81ea\u5e26\u4ed3\u5e93 \u00b6 3.1.1 \u5b89\u88c5 \u00b6 [root@leco ~]# yum install docker-registry [root@leco ~]# yum info docker-registry Loaded plugins: fastestmirror Loading mirror speeds from cached hostfile * base: mirrors.aliyun.com * epel: mirrors.aliyun.com * extras: mirrors.aliyun.com * updates: mirrors.aliyun.com Available Packages Name : docker-registry Arch : x86_64 Version : 0.9.1 Release : 7.el7 Size : 123 k Repo : extras/7/x86_64 Summary : Registry server for Docker URL : https://github.com/docker/docker-registry License : ASL 2.0 Description : Registry server for Docker (hosting/delivering of repositories and images). 3.1.2 \u67e5\u770b\u5b89\u88c5\u4fe1\u606f \u00b6 [root@leco ~]# rpm -ql docker-distribution /etc/docker-distribution/registry/config.yml /usr/bin/registry /usr/lib/systemd/system/docker-distribution.service /usr/share/doc/docker-distribution-2.6.2 /usr/share/doc/docker-distribution-2.6.2/AUTHORS /usr/share/doc/docker-distribution-2.6.2/CONTRIBUTING.md /usr/share/doc/docker-distribution-2.6.2/LICENSE /usr/share/doc/docker-distribution-2.6.2/MAINTAINERS /usr/share/doc/docker-distribution-2.6.2/README.md /var/lib/registry [root@leco registry]# pwd /etc/docker-distribution/registry [root@leco registry]# cat config.yml version: 0.1 log: fields: service: registry storage: cache: layerinfo: inmemory filesystem: rootdirectory: /var/lib/registry # \u4ed3\u5e93\u7684\u5b58\u50a8\u8def\u5f84\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u4fee\u6539\uff08\u627e\u5927\u70b9\u7684\u7a7a\u95f4\u914d\u7f6e\uff09 http: # \u4ed3\u5e93\u534f\u8bae addr: :5000 # \u4ed3\u5e93\u7aef\u53e3 3.1.3 \u542f\u52a8\u4ed3\u5e93 \u00b6 [root@leco registry]# systemctl start docker-distribution.service 3.1.4 \u5f00\u673a\u81ea\u542f\u52a8 \u00b6 [root@leco registry]# systemctl enable docker-distribution.service Created symlink from /etc/systemd/system/multi-user.target.wants/docker-distribution.service to /usr/lib/systemd/system/docker-distribution.service. 3.1.5 \u67e5\u770b\u670d\u52a1 \u00b6 [root@leco registry]# ss -tnl State Recv-Q Send-Q Local Address:Port Peer Address:Port LISTEN 0 100 127.0.0.1:25 *:* LISTEN 0 128 *:22 *:* LISTEN 0 100 ::1:25 :::* LISTEN 0 128 :::5000 :::* LISTEN 0 128 :::22 :::* 3.2 Docker\u5ba2\u6237\u7aef\u64cd\u4f5c \u00b6 \u627e\u4e00\u4e2a\u65b0\u7684docker\u5ba2\u6237\u7aef\u6d4b\u8bd5\u63a8\u62c9 3.2.1 \u6253tag \u00b6 \u73b0\u5728\u5ba2\u6237\u7aef\u6807\u7b7edocker\u79c1\u6709\u4ed3\u5e93\u5730\u5740\u3002\u4e0d\u6253\u6807\u7b7e\u9ed8\u8ba4\u63a8\u9001\u5230docker github\u4e0a [root@localhost img4]# docker tag myweb:v0.3-11 192.168.183.134:5000/myweb:v0.3-11 3.2.2 \u67e5\u770btag\u4fe1\u606f \u00b6 [root@localhost img4]# docker images |grep 5000 192.168.183.134:5000/myweb v0.3-11 44ef73a3a19b 39 minutes ago 18MB [root@localhost img4]# docker push 192.168.183.134:5000/myweb:v0.3-11 The push refers to repository [192.168.183.134:5000/myweb] Get https://192.168.183.134:5000/v2/: http: server gave HTTP response to HTTPS client \u6b64\u65f6\u8981\u5728\u5ba2\u6237\u7aef\u6539\u53d8\u914d\u7f6e\uff0c\u53d8\u6210http\u534f\u8bae\uff08docker \u4ed3\u5e93\u9ed8\u8ba4\u662fhttps\u534f\u8bae\uff0c\u6211\u4eec\u4f7f\u7528http\u534f\u8bae\uff09 [root@localhost img4]# cat !$ cat /etc/docker/daemon.json { \"registry-mirrors\": [\"http://3e930982.m.daocloud.io\"], \"insecure-registries\":[\"192.168.183.134:5000\"] } \u5176\u4e2dinsecure-registries\u540e\u9762\u662fdocker\u4ed3\u5e93\u7684\u5730\u5740\u548c\u7aef\u53e3\u3002 [root@localhost img4]# systemctl restart docker 3.2.3 push \u00b6 \u4fee\u6539\u534f\u8bae\u540e\u91cd\u542fdocker\u7136\u540e\u5728push\u955c\u50cf\u5230\u79c1\u6709\u4ed3\u5e93\u91cc\u9762 [root@localhost img4]# docker push 192.168.183.134:5000/myweb:v0.3-11 The push refers to repository [192.168.183.134:5000/myweb] 347a19806329: Pushed 20555723c54b: Pushed a79fe6dff072: Pushed 87deea508850: Pushed 90c4db1d5ef5: Pushed cd7100a72410: Pushed v0.3-11: digest: sha256:be593f8f6e45181416242b37183b3c5429745e3623424a1a9b672afab898714e size: 1568 3.2.4 \u4ed3\u5e93\u67e5\u770b \u00b6 docker\u79c1\u6709\u4ed3\u5e93\u7aef\u67e5\u770b [root@leco registry]# ls /var/lib/registry/docker/registry/v2/repositories/myweb/_layers/sha256/ 44ef73a3a19b95ae6f7e0c4bf92f0fcc876dce929340455c591430203b4bc151 4b15fa862ac67691a8bc682937be38197ebebe580f01b1bcc0ee823fc43709aa 5e38f0c1e3e667d4fd01ac85ebcd4337579471d841a925d4be81bde53a482614 7d4e05a01906143afc15671a53151ea9755dac230db376a8b8364b21ca774dbc 8aeac9a3205fce5e21ab65ccce330fe389a9aaf47e4b682970b1772ae25a1d73 b430473be128c1302a75e8381dfbaa45182fec81db4f75b749e4896d7816c2ea ff3a5c916c92643ff77519ffa742d3ec61b7f591b6b7504599d95a4a41134e28 \u53ef\u89c1\u4ecedocker\u5ba2\u6237\u7aefpush\u4e0a\u7684\u955c\u50cf\u5df2\u7ecf\u63a8\u9001\u8fc7\u6765\uff0c\u7ecf\u8fc7hash\u4e86\u3002 3.2.5 pull \u00b6 \u5728\u5176\u4ed6\u673a\u5668\u4e0a\u6d4b\u8bd5\uff08pull\u955c\u50cf\uff09 [root@leco registry]# cat /etc/docker/daemon.json { \"registry-mirrors\": [\"http://3e930982.m.daocloud.io\"], \"bip\": \"10.0.0.1/16\", \"insecure-registries\":[\"192.168.183.134:5000\"] } [root@leco registry]# systemctl restart docker [root@leco registry]# docker pull 192.168.183.134:5000/myweb:v0.3-11 v0.3-11: Pulling from myweb ff3a5c916c92: Pull complete b430473be128: Pull complete 7d4e05a01906: Pull complete 8aeac9a3205f: Pull complete 5e38f0c1e3e6: Pull complete 4b15fa862ac6: Pull complete Digest: sha256:be593f8f6e45181416242b37183b3c5429745e3623424a1a9b672afab898714e Status: Downloaded newer image for 192.168.183.134:5000/myweb:v0.3-11 [root@leco registry]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE 192.168.183.134:5000/myweb v0.3-11 44ef73a3a19b About an hour ago 18MB 4. Harbor \u00b6 4.1 \u53c2\u8003\u6587\u6863 \u00b6 \u5b98\u65b9\u6587\u6863 \u5b89\u88c5\u6b65\u9aa4 4.2 \u4e0b\u8f7d\u5b89\u88c5 \u00b6 \u4e0b\u8f7d\u5b89\u88c5\u540e\u4e0a\u4f20\u5230\u670d\u52a1\u5668\u4e0a\uff0c\u89e3\u538b\u914d\u7f6e\u5b89\u88c5\u3002 4.2.1 \u5173\u95ed\u4ed3\u5e93 \u00b6 \u5173\u95ed\u4e4b\u524d\u81ea\u5e26\uff08github\u81ea\u5df1\u7684\uff09\u7684\u955c\u50cf\u4ed3\u5e93 [root@leco ~]# netstat -lnp|grep 5000 tcp6 0 0 :::5000 :::* LISTEN 17540/registry [root@leco ~]# systemctl stop docker-distribution [root@leco ~]# netstat -lnp|grep 500 [root@leco opt]# ls harbor-offline-installer-v1.5.3.tgz myimages.gz [root@leco opt]# tar xf harbor-offline-installer-v1.5.3.tgz -C /usr/local/ [root@leco opt]# cd /usr/local/harbor/ [root@leco harbor]# pwd /usr/local/harbor [root@leco harbor]# ll total 895716 drwxr-xr-x 4 root root 37 Sep 20 17:37 common -rw-r--r-- 1 root root 1185 Sep 12 14:19 docker-compose.clair.yml -rw-r--r-- 1 root root 1725 Sep 12 14:19 docker-compose.notary.yml -rw-r--r-- 1 root root 3596 Sep 12 14:19 docker-compose.yml drwxr-xr-x 3 root root 156 Sep 12 14:19 ha -rw-r--r-- 1 root root 6955 Sep 20 17:32 harbor.cfg -rw-r--r-- 1 root root 6956 Sep 20 17:31 harbor.cfg.ori -rw-r--r-- 1 root root 915878468 Sep 12 14:21 harbor.v1.5.3.tar.gz -rwxr-xr-x 1 root root 5773 Sep 12 14:19 install.sh -rw-r--r-- 1 root root 10764 Sep 12 14:19 LICENSE -rw-r--r-- 1 root root 482 Sep 12 14:19 NOTICE -rw-r--r-- 1 root root 1247461 Sep 12 14:19 open_source_license -rwxr-xr-x 1 root root 27840 Sep 12 14:19 prepare [root@leco harbor]# cp harbor.cfg harbor.cfg.ori 4.2.2 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 \u00b6 [root@leco harbor]# diff harbor.cfg harbor.cfg.ori 7c7 < hostname = 192.168.183.134 --- > hostname = reg.mydomain.com \u4fee\u6539hostname\uff0chostname\u662f\u5bf9\u5916\u8bbf\u95ee\u7684\u7684\u5730\u5740\uff0c\u53ef\u4ee5\u57df\u540d\u53ef\u4ee5ip\u5730\u5740\uff0c\u6211\u4eec\u8fd9\u4f7f\u7528ip\uff08\u4e5f\u5c31\u662fdocker\u7684\u79c1\u6709\u4ed3\u5e93\u5730\u5740\uff09 4.2.3 \u5f00\u59cb\u5b89\u88c5 \u00b6 [root@leco harbor]# sh install.sh [Step 0]: checking installation environment ... Note: docker version: 18.06.1 \u2716 Need to install docker-compose(1.7.1+) by yourself first and run this script again. 4.2.4 \u5b89\u88c5\u7f16\u6392\u5de5\u5177 \u00b6 \u5148\u8981\u5b89\u88c5docker-compose \u56e0\u4e3aharbor\u4f7f\u7528\u901a\u8fc7docker-compose\u7f16\u6392\u5de5\u5177\u53bb\u5b89\u88c5 [root@leco harbor]# yum install -y docker-compose [root@leco harbor]# sh install.sh [Step 0]: checking installation environment ... Note: docker version: 18.06.1 Note: docker-compose version: 1.18.0 [Step 1]: loading Harbor images ... dba693fc2701: Loading layer [==================================================>] 133.4MB/133.4MB 5773887c4c41: Loading layer [==================================================>] 30.09MB/30.09MB 6fc2abbcae42: Loading layer [==================================================>] 15.37MB/15.37MB d85f176a11ec: Loading layer [==================================================>] 15.37MB/15.37MB Loaded image: vmware/harbor-adminserver:v1.5.3 462b14c85230: Loading layer [==================================================>] 410.1MB/410.1MB c2e0c8cb2903: Loading layer [==================================================>] 9.216kB/9.216kB 11bdb24cded2: Loading layer [==================================================>] 9.216kB/9.216kB 5d8f974b49ef: Loading layer [==================================================>] 7.68kB/7.68kB ee04f13f4147: Loading layer [==================================================>] 1.536kB/1.536kB 799db4dfe41a: Loading layer [==================================================>] 11.78kB/11.78kB f7d813585bdd: Loading layer [==================================================>] 2.56kB/2.56kB 6300bbdbd7ab: Loading layer [==================================================>] 3.072kB/3.072kB Loaded image: vmware/harbor-db:v1.5.3 1d7516778a05: Loading layer [==================================================>] 30.09MB/30.09MB f7ec8d1b47d0: Loading layer [==================================================>] 20.91MB/20.91MB 22b0ad749c21: Loading layer [==================================================>] 20.91MB/20.91MB Loaded image: vmware/harbor-jobservice:v1.5.3 2d449d67c05a: Loading layer [==================================================>] 89.58MB/89.58MB 0bfd4e706575: Loading layer [==================================================>] 3.072kB/3.072kB 6100e173c230: Loading layer [==================================================>] 59.9kB/59.9kB 86fe093d1358: Loading layer [==================================================>] 61.95kB/61.95kB Loaded image: vmware/redis-photon:v1.5.3 Loaded image: photon:1.0 3bf3086a6569: Loading layer [==================================================>] 30.09MB/30.09MB 641d0f77d675: Loading layer [==================================================>] 10.95MB/10.95MB 89efbaabea87: Loading layer [==================================================>] 17.3MB/17.3MB 1276e51f4dc2: Loading layer [==================================================>] 15.87kB/15.87kB 49e187d04e78: Loading layer [==================================================>] 3.072kB/3.072kB e62fbfea411d: Loading layer [==================================================>] 28.24MB/28.24MB Loaded image: vmware/notary-signer-photon:v0.5.1-v1.5.3 Loaded image: vmware/mariadb-photon:v1.5.3 201f6ade61d8: Loading layer [==================================================>] 102.5MB/102.5MB 81221fbb5879: Loading layer [==================================================>] 6.656kB/6.656kB 2268e3c9e521: Loading layer [==================================================>] 2.048kB/2.048kB 9fca06f4b193: Loading layer [==================================================>] 7.68kB/7.68kB Loaded image: vmware/postgresql-photon:v1.5.3 11d6e8a232c9: Loading layer [==================================================>] 30.09MB/30.09MB 42650b04d53d: Loading layer [==================================================>] 24.41MB/24.41MB a1cd8af19e29: Loading layer [==================================================>] 7.168kB/7.168kB 4b1cda90ba19: Loading layer [==================================================>] 10.56MB/10.56MB 1351f0f3006a: Loading layer [==================================================>] 24.4MB/24.4MB Loaded image: vmware/harbor-ui:v1.5.3 e335f4c3af7d: Loading layer [==================================================>] 79.93MB/79.93MB 2aea487bc2c4: Loading layer [==================================================>] 3.584kB/3.584kB d2efec3de68b: Loading layer [==================================================>] 3.072kB/3.072kB d0d71a5ce1dd: Loading layer [==================================================>] 4.096kB/4.096kB 19930367abf0: Loading layer [==================================================>] 3.584kB/3.584kB 03e5b7640db5: Loading layer [==================================================>] 9.728kB/9.728kB Loaded image: vmware/harbor-log:v1.5.3 5aebe8cc938c: Loading layer [==================================================>] 11.97MB/11.97MB Loaded image: vmware/nginx-photon:v1.5.3 ede6a57cbd7e: Loading layer [==================================================>] 30.09MB/30.09MB 4d6dd4fc1d87: Loading layer [==================================================>] 2.56kB/2.56kB c86a69f49f60: Loading layer [==================================================>] 2.56kB/2.56kB 0cf6e04c5927: Loading layer [==================================================>] 2.048kB/2.048kB 6fbff4fe9739: Loading layer [==================================================>] 22.8MB/22.8MB 6f527a618092: Loading layer [==================================================>] 22.8MB/22.8MB Loaded image: vmware/registry-photon:v2.6.2-v1.5.3 e29a8834501b: Loading layer [==================================================>] 12.16MB/12.16MB aaf67f1da2c7: Loading layer [==================================================>] 17.3MB/17.3MB 8d5718232133: Loading layer [==================================================>] 15.87kB/15.87kB fc89aca1dd12: Loading layer [==================================================>] 3.072kB/3.072kB 076eb5a76f6d: Loading layer [==================================================>] 29.46MB/29.46MB Loaded image: vmware/notary-server-photon:v0.5.1-v1.5.3 454c81edbd3b: Loading layer [==================================================>] 135.2MB/135.2MB e99db1275091: Loading layer [==================================================>] 395.4MB/395.4MB 051e4ee23882: Loading layer [==================================================>] 9.216kB/9.216kB 6cca4437b6f6: Loading layer [==================================================>] 9.216kB/9.216kB 1d48fc08c8bc: Loading layer [==================================================>] 7.68kB/7.68kB 0419724fd942: Loading layer [==================================================>] 1.536kB/1.536kB 543c0c1ee18d: Loading layer [==================================================>] 655.2MB/655.2MB 4190aa7e89b8: Loading layer [==================================================>] 103.9kB/103.9kB Loaded image: vmware/harbor-migrator:v1.5.0 45878c64fc3c: Loading layer [==================================================>] 165.3MB/165.3MB fc3d407ce98f: Loading layer [==================================================>] 10.93MB/10.93MB d7a0785bb902: Loading layer [==================================================>] 2.048kB/2.048kB a17e0f23bc84: Loading layer [==================================================>] 48.13kB/48.13kB 57c7181f2336: Loading layer [==================================================>] 10.97MB/10.97MB Loaded image: vmware/clair-photon:v2.0.5-v1.5.3 [Step 2]: preparing environment ... Generated and saved secret to file: /data/secretkey Generated configuration file: ./common/config/nginx/nginx.conf Generated configuration file: ./common/config/adminserver/env Generated configuration file: ./common/config/ui/env Generated configuration file: ./common/config/registry/config.yml Generated configuration file: ./common/config/db/env Generated configuration file: ./common/config/jobservice/env Generated configuration file: ./common/config/jobservice/config.yml Generated configuration file: ./common/config/log/logrotate.conf Generated configuration file: ./common/config/jobservice/config.yml Generated configuration file: ./common/config/ui/app.conf Generated certificate, key file: ./common/config/ui/private_key.pem, cert file: ./common/config/registry/root.crt The configuration files are ready, please use docker-compose to start the service. Creating harbor-log ... done [Step 3]: checking existing instance of Harbor ... Creating registry ... done Creating harbor-ui ... done Creating network \"harbor_harbor\" with the default driver Creating nginx ... done Creating harbor-db ... Creating registry ... Creating harbor-adminserver ... Creating redis ... Creating harbor-ui ... Creating harbor-jobservice ... Creating nginx ... \u2714 ----Harbor has been installed and started successfully.---- Now you should be able to visit the admin portal at http://192.168.183.134. For more details, please visit https://github.com/vmware/harbor . \u53ef\u4ee5\u770b\u5230\u4ee5\u4e0a\u5df2\u7ecf\u5b89\u88c5\u5b8c\u4e86\u3002\u6211\u4eec\u901a\u8fc7web\u8bbf\u95eeharbor\uff0c\u53ef\u4ee5\u770b\u5230\u4ee5\u4e0a\u5df2\u7ecf\u5b89\u88c5\u5b8c\u4e86\u3002 \u5b89\u88c5\u5b8c\u6bd5\u540e\u67e5\u770bdocker Harbor\u5176\u5b9e\u4e5f\u662f\u52a0\u8f7ddocker\u955c\u50cf 4.3 Web\u64cd\u4f5c \u00b6 4.3.1 \u7b80\u5355\u4ecb\u7ecd \u00b6 \u9ed8\u8ba4\u8d26\u53f7\u548c\u5bc6\u7801\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c \u8d26\u53f7\u662f: admin \u5bc6\u7801\u662f: Harbor12345 4.3.2 \u65b0\u5efa\u7528\u6237 \u00b6 \u56e0\u4e3aharbor\u662f\u591a\u4eba\u7684\u79c1\u6709\u4ed3\u5e93\uff0c\u6240\u4ee5\u5efa\u7acb\u666e\u901a\u7528\u6237\uff0c\u5bf9\u5e94\u5efa\u7acb\u79c1\u6709\u7684\u4ed3\u5e93\uff0c\u7136\u540edocker\u5ba2\u6237\u7aef\u901a\u8fc7\u4f7f\u7528\u8fd9\u4e2a\u65b0\u5efa\u7684\u8d26\u53f7\u548c\u5bc6\u7801\u767b\u5f55harbor\u7136\u540e\u63a8\u9001\u5230\u81ea\u5df1\u7684\u4ed3\u5e93\u4e2d\u3002 4.3.3 \u65b0\u5efa\u79c1\u6709\u4ed3\u5e93 \u00b6 4.3.4 \u666e\u901a\u7528\u6237\u767b\u5f55 \u00b6 4.3.5 \u666e\u901a\u7528\u6237\u65b0\u5efa\u9879\u76ee \u00b6 4.4 \u5ba2\u6237\u7aef\u64cd\u4f5c\u63a8\u9001 \u00b6 4.4.1 pull\u955c\u50cf \u00b6 [root@localhost img4]# ifconfig ens33 ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500 inet 192.168.183.133 netmask 255.255.255.0 broadcast 192.168.183.255 ether 00:0c:29:9e:1f:67 txqueuelen 1000 (Ethernet) RX packets 66573 bytes 17079495 (16.2 MiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 36722 bytes 16771887 (15.9 MiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 [root@localhost img4]# cat /etc/docker/daemon.json { \"registry-mirrors\": [\"http://3e930982.m.daocloud.io\"], \"insecure-registries\":[\"192.168.183.134\"] } [root@localhost img4]# systemctl restart docker 4.4.2 \u5ba2\u6237\u7aef\u6253tag \u00b6 \u6253tag\u7684\u76ee\u7684\u4e3b\u8981\u662f\u63a8\u9001\u7684\u955c\u50cf\u5230\u79c1\u6709\u4ed3\u5e93\u800c\u4e0d\u662f\u63a8\u9001\u5230dockerhub\u4e0a\uff08\u9ed8\u8ba4\u90fd\u662f\u63a8\u9001\u5230dockerhub\u4e0a\uff09 [root@localhost img4]# docker tag myweb:v0.3-4 192.168.183.134/myweb/myweb:v0.3-4 [root@localhost img4]# docker tag myweb:v0.3-5 192.168.183.134/myweb/myweb:v0.3-5 [root@localhost img4]# docker tag myweb:v0.3-6 192.168.183.134/myweb/myweb:v0.3-6 [root@localhost img4]# docker tag myweb:v0.3-7 192.168.183.134/myweb/myweb:v0.3-7 4.4.3 \u767b\u5f55 \u00b6 [root@localhost img4]# docker login 192.168.183.134 Username: caimengzhi #\u8d26\u53f7\u662fweb\u767b\u5f55\u7684\u8d26\u53f7\u548c\u5bc6\u7801 Password: WARNING! Your password will be stored unencrypted in /root/.docker/config.json. Configure a credential helper to remove this warning. See https://docs.docker.com/engine/reference/commandline/login/#credentials-store Login Succeeded 4.4.4 \u63a8\u9001\u955c\u50cf \u00b6 [root@localhost img4]# docker push 192.168.183.134/myweb/myweb <\u82e5\u662f\u63a8\u9001\u4e0d\u6307\u5b9a\u955c\u50cftag\uff0c\u4f1a\u63a8\u9001\u6240\u6709192.168.183.134/myweb/myweb\u7684\u955c\u50cf> The push refers to repository [192.168.183.134/myweb/myweb] a8dcd6aa3279: Pushed 9a07ffbe3d7d: Pushed 955e7d7f7300: Pushed 95bb4e754f2d: Pushed ebf12965380b: Pushed v0.3-4: digest: sha256:bff4611d26ab5ea7df2a2038f5c806060343e8dcb72f4e7d9c8186f9f29ab1d2 size: 1360 02d539f1584f: Pushed 9a07ffbe3d7d: Layer already exists 955e7d7f7300: Layer already exists 95bb4e754f2d: Layer already exists ebf12965380b: Layer already exists v0.3-5: digest: sha256:d989d072b34649c6c3db1b90cc8e9da01fc0851db7154087f8c20d9276c6b19e size: 1360 cf1c42bcc62e: Pushed 31d53a6ec2f6: Pushed 9a07ffbe3d7d: Layer already exists 955e7d7f7300: Layer already exists 95bb4e754f2d: Layer already exists ebf12965380b: Layer already exists v0.3-6: digest: sha256:f001406ad67619ca5a20595f5392099f4c89aabc03a577a9e2b21951daa6625b size: 1567 cf1c42bcc62e: Layer already exists 31d53a6ec2f6: Layer already exists 9a07ffbe3d7d: Layer already exists 955e7d7f7300: Layer already exists 95bb4e754f2d: Layer already exists ebf12965380b: Layer already exists v0.3-7: digest: sha256:f001406ad67619ca5a20595f5392099f4c89aabc03a577a9e2b21951daa6625b size: 1567 4.4.5 \u67e5\u770b\u63a8\u9001\u60c5\u51b5 \u00b6 \u63a8\u9001\u5b8c\u6bd5\u540e\u5728docker\u79c1\u6709\u4ed3\u5e93\u4e0aweb\u67e5\u770b\u4e4b\u524d\u63a8\u9001\u7684\u60c5\u51b5\u3002 4.5 \u5ba2\u6237\u7aef\u64cd\u4f5c\u62c9 \u00b6 \u65b0\u627e\u4e00\u4e2a\u522b\u7684\u673a\u5668\u53bb\u62c9\u53bb\u64cd\u4f5c 4.5.1 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 \u00b6 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff08http\uff09 [root@leco ~]# cat /etc/docker/daemon.json { \"registry-mirrors\": [\"http://3e930982.m.daocloud.io\"], \"insecure-registries\":[\"192.168.183.134\"] } 4.5.2 \u91cd\u542fdocker \u00b6 [root@leco ~]# systemctl restart docker [root@leco ~]# ifconfig ens33 ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500 inet 192.168.183.135 netmask 255.255.255.0 broadcast 192.168.183.255 ether 00:0c:29:5e:f3:38 txqueuelen 1000 (Ethernet) RX packets 32850 bytes 2734678 (2.6 MiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 3833 bytes 375551 (366.7 KiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 4.5.3 \u767b\u5f55 \u00b6 [root@leco ~]# docker login 192.168.183.134 Username: caimengzhi Password: WARNING! Your password will be stored unencrypted in /root/.docker/config.json. Configure a credential helper to remove this warning. See https://docs.docker.com/engine/reference/commandline/login/#credentials-store Login Succeeded 4.5.4 \u5730\u5740 \u00b6 \u767b\u5f55web\u754c\u9762\u627e\u5230pull\u7684\u5730\u5740 [root@leco ~]# docker pull 192.168.183.134/myweb/myweb:v0.3-7 v0.3-7: Pulling from myweb/myweb c67f3896b22c: Pull complete 428de5b8d58a: Pull complete 7efd417f3e28: Pull complete 61a56b170416: Pull complete e7206a413d4c: Pull complete 54a1363d75f0: Pull complete Digest: sha256:f001406ad67619ca5a20595f5392099f4c89aabc03a577a9e2b21951daa6625b Status: Downloaded newer image for 192.168.183.134/myweb/myweb:v0.3-7 4.5.5 \u67e5\u770b\u672c\u5730\u955c\u50cf \u00b6 [root@leco ~]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE 192.168.183.134/myweb/myweb v0.3-7 5799f549739a 3 hours ago 17.4MB 4.6 Harbor \u670d\u52a1\u64cd\u4f5c \u00b6 4.6.1 \u6682\u505c \u00b6 [root@leco ~]# docker-compose pause 4.6.2 \u505c\u6b62 \u00b6 [root@leco ~]# docker-compose stop 4.6.3 \u542f\u52a8 \u00b6 [root@leco ~]# docker-compose start [root@leco harbor]# pwd /usr/local/harbor [root@leco harbor]# ll total 895716 drwxr-xr-x 4 root root 37 Sep 20 17:37 common -rw-r--r-- 1 root root 1185 Sep 12 14:19 docker-compose.clair.yml -rw-r--r-- 1 root root 1725 Sep 12 14:19 docker-compose.notary.yml -rw-r--r-- 1 root root 3596 Sep 12 14:19 docker-compose.yml drwxr-xr-x 3 root root 156 Sep 12 14:19 ha -rw-r--r-- 1 root root 6955 Sep 20 17:32 harbor.cfg -rw-r--r-- 1 root root 6956 Sep 20 17:31 harbor.cfg.ori -rw-r--r-- 1 root root 915878468 Sep 12 14:21 harbor.v1.5.3.tar.gz -rwxr-xr-x 1 root root 5773 Sep 12 14:19 install.sh -rw-r--r-- 1 root root 10764 Sep 12 14:19 LICENSE -rw-r--r-- 1 root root 482 Sep 12 14:19 NOTICE -rw-r--r-- 1 root root 1247461 Sep 12 14:19 open_source_license -rwxr-xr-x 1 root root 27840 Sep 12 14:19 prepare \u4ee5\u4e0a\u64cd\u4f5c\u90fd\u8981\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e0b\uff0c\u6267\u884c\u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u52a0\u8f7ddocker-compose.yml\u6587\u4ef6 4.7 Harbor \u90ae\u4ef6 \u00b6 4.7.1 \u90ae\u4ef6\u914d\u7f6e \u00b6 \u6211\u4f7f\u7528\u7684163\u7684\u90ae\u7bb1\u8bf7\u6309\u7167\u4e0a\u8ff0\u53c2\u6570\u627e\u5230\u81ea\u5df1\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u5176\u4ed6\u90ae\u7bb1\u8bf7\u767e\u5ea6\u81ea\u884c\u914d\u7f6e\u3002 \u914d\u7f6e\u5b8c\u540e\u3002\u68c0\u9a8c 4.7.2 \u5fd8\u8bb0\u767b\u5f55\u5bc6\u7801 \u00b6 \u7136\u540e\u91cd\u65b0\u767b\u5f55 4.8 QA \u00b6 Q\uff1aMaster-Slave\u7684\u955c\u50cf\u67b6\u6784\u4e2d,\u5982\u679cSlave Registy\u4e2d\u7684\u955c\u50cf\u88ab\u5220\u9664\u4e86\uff0c\u4f1a\u4e0d\u4f1a\u518d\u6b21\u81ea\u52a8\u4eceMaster Reg\u91cc\u9762\u81ea\u52a8\u540c\u6b65\uff1f A\uff1a\u5982\u679c\u505c\u6b62\u540e\u518d\u91cd\u65b0\u542f\u52a8\u590d\u5236\u7b56\u7565\uff0c\u53ef\u4ee5\u540c\u6b65\u88ab\u5220\u9664\u7684\u955c\u50cf\u3002 Q\uff1a\u5bf9\u4e8e\u591a\u4e2a\u6295\u4ea7\u5730\uff0c\u591a\u4e2a\u4ed3\u5e93\uff0c\u54ea\u79cd\u65b9\u5f0f\u7684\u9ad8\u53ef\u7528\u65b9\u6848\u597d\u4e48\uff1f\u7b2c\u4e00\u79cd\uff0c\u5171\u4eab\u5b58\u50a8\u5b58\u50a8\u53ef\u80fd\u4f1a\u51fa\u73b0\u5355\u70b9\u6545\u969c\u4e48\uff1f A\uff1a\u5171\u4eab\u5b58\u50a8\u53ea\u9002\u5408\u540c\u4e00\u6570\u636e\u4e2d\u5fc3\uff0c\u591a\u4e2a\u4ea7\u5730\u5ef6\u65f6\u592a\u5927\uff0c\u4e0d\u9002\u5408\u5171\u4eab\u5b58\u50a8\u3002 Q\uff1aRegistry\u4e4b\u95f4\u540c\u6b65\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff1f A\uff1aRegistry API\u3002 Q\uff1a\u5728\u5b58\u50a8\u8fd9\u5757\u8003\u8651\u8fc7\u63d0\u4f9b\u63d2\u4ef6\u65b9\u5f0f\u53ef\u4ee5\u8c03\u7528\u5916\u90e8\u6a21\u5757\uff0c\u6bd4\u5982\u4ee5\u63d2\u4ef6\u65b9\u5f0f\u652f\u6301s3\u8fd9\u79cd\u5bf9\u8c61\u5b58\u50a8\uff1f A\uff1aHarbor\u652f\u6301\u5176\u4ed6\u5b58\u50a8\u65b9\u5f0f\uff0c\u53c2\u89c1Harbor\u6587\u6863\u3002","title":"1. Harbor"},{"location":"linux/server/harbor/harbor.index/#1-harbor","text":"Harbor\u662f\u4e00\u4e2a\u7528\u4e8e\u5b58\u50a8\u548c\u5206\u53d1Docker\u955c\u50cf\u7684\u4f01\u4e1a\u7ea7Registry\u670d\u52a1\u5668\u3002 \u955c\u50cf\u7684\u5b58\u50a8harbor\u4f7f\u7528\u7684\u662f\u5b98\u65b9\u7684docker registry(v2\u547d\u540d\u662fdistribution)\u670d\u52a1\u53bb\u5b8c\u6210\u3002harbor\u5728docker distribution\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u4e00\u4e9b\u5b89\u5168\u3001\u8bbf\u95ee\u63a7\u5236\u3001\u7ba1\u7406\u7684\u529f\u80fd\u4ee5\u6ee1\u8db3\u4f01\u4e1a\u5bf9\u4e8e\u955c\u50cf\u4ed3\u5e93\u7684\u9700\u6c42\u3002harbor\u4ee5docker-compose\u7684\u89c4\u8303\u5f62\u5f0f\u7ec4\u7ec7\u5404\u4e2a\u7ec4\u4ef6\uff0c\u5e76\u901a\u8fc7docker-compose\u5de5\u5177\u8fdb\u884c\u542f\u505c\u3002 docker\u7684registry\u662f\u7528\u672c\u5730\u5b58\u50a8\u6216\u8005s3\u90fd\u662f\u53ef\u4ee5\u7684\uff0charbor\u7684\u529f\u80fd\u662f\u5728\u6b64\u4e4b\u4e0a\u63d0\u4f9b\u7528\u6237\u6743\u9650\u7ba1\u7406\u3001\u955c\u50cf\u590d\u5236\u7b49\u529f\u80fd\uff0c\u63d0\u9ad8\u4f7f\u7528\u7684registry\u7684\u6548\u7387\u3002Harbor\u7684\u955c\u50cf\u62f7\u8d1d\u529f\u80fd\u662f\u901a\u8fc7docker registry\u7684API\u53bb\u62f7\u8d1d\uff0c\u8fd9\u79cd\u505a\u6cd5\u5c4f\u853d\u4e86\u7e41\u7410\u7684\u5e95\u5c42\u6587\u4ef6\u64cd\u4f5c\u3001\u4e0d\u4ec5\u53ef\u4ee5\u5229\u7528\u73b0\u6709docker registry\u529f\u80fd\u4e0d\u5fc5\u91cd\u590d\u9020\u8f6e\u5b50\uff0c\u800c\u4e14\u53ef\u4ee5\u89e3\u51b3\u51b2\u7a81\u548c\u4e00\u81f4\u6027\u7684\u95ee\u9898\u3002","title":"1. Harbor\u7b80\u4ecb"},{"location":"linux/server/harbor/harbor.index/#11-harbor","text":"\u4e3b\u8981\u7ec4\u4ef6\u5305\u62ec: Proxy\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6nginx\u3002\u5b83\u662f\u4e00\u4e2anginx\u53cd\u5411\u4ee3\u7406\uff0c\u4ee3\u7406Notary client\uff08\u955c\u50cf\u8ba4\u8bc1\uff09\u3001Docker client\uff08\u955c\u50cf\u4e0a\u4f20\u4e0b\u8f7d\u7b49\uff09\u548c\u6d4f\u89c8\u5668\u7684\u8bbf\u95ee\u8bf7\u6c42\uff08Core Service\uff09\u7ed9\u540e\u7aef\u7684\u5404\u670d\u52a1\uff1b UI\uff08Core Service\uff09\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6harbor-ui\u3002\u5e95\u5c42\u6570\u636e\u5b58\u50a8\u4f7f\u7528mysql\u6570\u636e\u5e93\uff0c\u4e3b\u8981\u63d0\u4f9b\u4e86\u56db\u4e2a\u5b50\u529f\u80fd\uff1a UI\uff1a\u4e00\u4e2aweb\u7ba1\u7406\u9875\u9762ui\uff1b API\uff1aHarbor\u66b4\u9732\u7684API\u670d\u52a1\uff1b Auth\uff1a\u7528\u6237\u8ba4\u8bc1\u670d\u52a1\uff0cdecode\u540e\u7684token\u4e2d\u7684\u7528\u6237\u4fe1\u606f\u5728\u8fd9\u91cc\u8fdb\u884c\u8ba4\u8bc1\uff1bauth\u540e\u7aef\u53ef\u4ee5\u63a5db\u3001ldap\u3001uaa\u4e09\u79cd\u8ba4\u8bc1\u5b9e\u73b0\uff1b Token\u670d\u52a1\uff08\u4e0a\u56fe\u4e2d\u672a\u4f53\u73b0\uff09\uff1a\u8d1f\u8d23\u6839\u636e\u7528\u6237\u5728\u6bcf\u4e2aproject\u4e2d\u7684role\u6765\u4e3a\u6bcf\u4e00\u4e2adocker push/pull\u547d\u4ee4issuing\u4e00\u4e2atoken\uff0c\u5982\u679c\u4ecedocker client\u53d1\u9001\u7ed9registry\u7684\u8bf7\u6c42\u6ca1\u6709\u5e26token\uff0cregistry\u4f1a\u91cd\u5b9a\u5411\u8bf7\u6c42\u5230token\u670d\u52a1\u521b\u5efatoken\u3002 Registry\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6registry\u3002\u8d1f\u8d23\u5b58\u50a8\u955c\u50cf\u6587\u4ef6\uff0c\u548c\u5904\u7406\u955c\u50cf\u7684pull/push\u547d\u4ee4\u3002Harbor\u5bf9\u955c\u50cf\u8fdb\u884c\u5f3a\u5236\u7684\u8bbf\u95ee\u63a7\u5236\uff0cRegistry\u4f1a\u5c06\u5ba2\u6237\u7aef\u7684\u6bcf\u4e2apull\u3001push\u8bf7\u6c42\u8f6c\u53d1\u5230token\u670d\u52a1\u6765\u83b7\u53d6\u6709\u6548\u7684token\u3002 Admin Service\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6harbor-adminserver\u3002\u662f\u7cfb\u7edf\u7684\u914d\u7f6e\u7ba1\u7406\u4e2d\u5fc3\u9644\u5e26\u68c0\u67e5\u5b58\u50a8\u7528\u91cf\uff0cui\u548cjobserver\u542f\u52a8\u65f6\u5019\u9700\u8981\u52a0\u8f7dadminserver\u7684\u914d\u7f6e\uff1b Job Sevice\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6harbor-jobservice\u3002\u8d1f\u8d23\u955c\u50cf\u590d\u5236\u5de5\u4f5c\u7684\uff0c\u4ed6\u548cregistry\u901a\u4fe1\uff0c\u4ece\u4e00\u4e2aregistry pull\u955c\u50cf\u7136\u540epush\u5230\u53e6\u4e00\u4e2aregistry\uff0c\u5e76\u8bb0\u5f55job_log\uff1b Log Collector\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6harbor-log\u3002\u65e5\u5fd7\u6c47\u603b\u7ec4\u4ef6\uff0c\u901a\u8fc7docker\u7684log-driver\u628a\u65e5\u5fd7\u6c47\u603b\u5230\u4e00\u8d77\uff1b Volnerability Scanning\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6clair\u3002\u8d1f\u8d23\u955c\u50cf\u626b\u63cf Notary\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6notary\u3002\u8d1f\u8d23\u955c\u50cf\u8ba4\u8bc1 DB\uff1a\u5bf9\u5e94\u542f\u52a8\u7ec4\u4ef6harbor-db\uff0c\u8d1f\u8d23\u5b58\u50a8project\u3001 user\u3001 role\u3001replication\u3001image_scan\u3001access\u7b49\u7684metadata\u6570\u636e\u3002","title":"1.1 Harbor\u67b6\u6784"},{"location":"linux/server/harbor/harbor.index/#12-docker-registery","text":"1.Registry\u7528\u4e8e\u4fdd\u5b58docker\u955c\u50cf\uff0c\u5305\u62ec\u955c\u50cf\u7684\u5c42\u6b21\u7ed3\u6784\u548c\u5143\u6570\u636e 2.\u7528\u6237\u53ef\u81ea\u5efaRegistry\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5b98\u65b9\u7684Docker Hub Docker Registery \u5206\u7c7b 1.Sponsor Registry \u7b2c\u4e09\u65b9Registry\uff0c\u4f9b\u5ba2\u6237\u548cDocker\u793e\u533a\u4f7f\u7528 2.Mirror Registry \u7b2c\u4e09\u65b9Registry\uff0c\u53ea\u8ba9\u5ba2\u6237\u4f7f\u7528 3.Vendor Registry \u7531\u53d1\u5e03Docker\u955c\u50cf\u7684\u4f9b\u5e94\u5546\u63d0\u4f9b\u7684Registry 4.Private Registry \u901a\u8fc7\u8bbe\u6709\u9632\u706b\u5899\u548c\u989d\u5916\u7684\u5b89\u5168\u5c42\u7684\u79c1\u6709\u5b9e\u4f53\u63d0\u4f9b\u7684Registry","title":"1.2 Docker Registery"},{"location":"linux/server/harbor/harbor.index/#2","text":"\u670d\u52a1\u5668\u7684ip\u89c4\u5212 \u673a\u5668 IP \u7cfb\u7edf Docker Registry 192.168.183.134 Centos 7\uff08\u968f\u4fbf\u4f60\u4ec0\u4e48\u7cfb\u7edf\uff09 Docker Client 192.168.183.133 Centos 7\uff08\u968f\u4fbf\u4f60\u4ec0\u4e48\u7cfb\u7edf\uff09\u63a8\u9001\u955c\u50cf Docker Client 192.168.183.135 Centos 7\uff08\u968f\u4fbf\u4f60\u4ec0\u4e48\u7cfb\u7edf\uff09\u62c9\u53d6\u955c\u50cf \u540d\u8bcd\u89e3\u91ca No \u540d\u8bcd \u89e3\u91ca 1 Docker Registry Docker\u79c1\u6709\u4ed3\u5e93\uff08\u672c\u5730\uff09 2 Docker Client \u4e0a\u4f20\u548c\u4e0b\u8f7d\u7684docker\u5ba2\u6237\u7aef","title":"2. \u7cfb\u7edf\u90e8\u7f72\u57fa\u7840"},{"location":"linux/server/harbor/harbor.index/#3-docker","text":"","title":"3. Docker\u81ea\u5e26\u4ed3\u5e93"},{"location":"linux/server/harbor/harbor.index/#31","text":"","title":"3.1 \u5b89\u88c5\u5b98\u65b9\u81ea\u5e26\u4ed3\u5e93"},{"location":"linux/server/harbor/harbor.index/#311","text":"[root@leco ~]# yum install docker-registry [root@leco ~]# yum info docker-registry Loaded plugins: fastestmirror Loading mirror speeds from cached hostfile * base: mirrors.aliyun.com * epel: mirrors.aliyun.com * extras: mirrors.aliyun.com * updates: mirrors.aliyun.com Available Packages Name : docker-registry Arch : x86_64 Version : 0.9.1 Release : 7.el7 Size : 123 k Repo : extras/7/x86_64 Summary : Registry server for Docker URL : https://github.com/docker/docker-registry License : ASL 2.0 Description : Registry server for Docker (hosting/delivering of repositories and images).","title":"3.1.1 \u5b89\u88c5"},{"location":"linux/server/harbor/harbor.index/#312","text":"[root@leco ~]# rpm -ql docker-distribution /etc/docker-distribution/registry/config.yml /usr/bin/registry /usr/lib/systemd/system/docker-distribution.service /usr/share/doc/docker-distribution-2.6.2 /usr/share/doc/docker-distribution-2.6.2/AUTHORS /usr/share/doc/docker-distribution-2.6.2/CONTRIBUTING.md /usr/share/doc/docker-distribution-2.6.2/LICENSE /usr/share/doc/docker-distribution-2.6.2/MAINTAINERS /usr/share/doc/docker-distribution-2.6.2/README.md /var/lib/registry [root@leco registry]# pwd /etc/docker-distribution/registry [root@leco registry]# cat config.yml version: 0.1 log: fields: service: registry storage: cache: layerinfo: inmemory filesystem: rootdirectory: /var/lib/registry # \u4ed3\u5e93\u7684\u5b58\u50a8\u8def\u5f84\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u4fee\u6539\uff08\u627e\u5927\u70b9\u7684\u7a7a\u95f4\u914d\u7f6e\uff09 http: # \u4ed3\u5e93\u534f\u8bae addr: :5000 # \u4ed3\u5e93\u7aef\u53e3","title":"3.1.2 \u67e5\u770b\u5b89\u88c5\u4fe1\u606f"},{"location":"linux/server/harbor/harbor.index/#313","text":"[root@leco registry]# systemctl start docker-distribution.service","title":"3.1.3 \u542f\u52a8\u4ed3\u5e93"},{"location":"linux/server/harbor/harbor.index/#314","text":"[root@leco registry]# systemctl enable docker-distribution.service Created symlink from /etc/systemd/system/multi-user.target.wants/docker-distribution.service to /usr/lib/systemd/system/docker-distribution.service.","title":"3.1.4 \u5f00\u673a\u81ea\u542f\u52a8"},{"location":"linux/server/harbor/harbor.index/#315","text":"[root@leco registry]# ss -tnl State Recv-Q Send-Q Local Address:Port Peer Address:Port LISTEN 0 100 127.0.0.1:25 *:* LISTEN 0 128 *:22 *:* LISTEN 0 100 ::1:25 :::* LISTEN 0 128 :::5000 :::* LISTEN 0 128 :::22 :::*","title":"3.1.5 \u67e5\u770b\u670d\u52a1"},{"location":"linux/server/harbor/harbor.index/#32-docker","text":"\u627e\u4e00\u4e2a\u65b0\u7684docker\u5ba2\u6237\u7aef\u6d4b\u8bd5\u63a8\u62c9","title":"3.2 Docker\u5ba2\u6237\u7aef\u64cd\u4f5c"},{"location":"linux/server/harbor/harbor.index/#321-tag","text":"\u73b0\u5728\u5ba2\u6237\u7aef\u6807\u7b7edocker\u79c1\u6709\u4ed3\u5e93\u5730\u5740\u3002\u4e0d\u6253\u6807\u7b7e\u9ed8\u8ba4\u63a8\u9001\u5230docker github\u4e0a [root@localhost img4]# docker tag myweb:v0.3-11 192.168.183.134:5000/myweb:v0.3-11","title":"3.2.1 \u6253tag"},{"location":"linux/server/harbor/harbor.index/#322-tag","text":"[root@localhost img4]# docker images |grep 5000 192.168.183.134:5000/myweb v0.3-11 44ef73a3a19b 39 minutes ago 18MB [root@localhost img4]# docker push 192.168.183.134:5000/myweb:v0.3-11 The push refers to repository [192.168.183.134:5000/myweb] Get https://192.168.183.134:5000/v2/: http: server gave HTTP response to HTTPS client \u6b64\u65f6\u8981\u5728\u5ba2\u6237\u7aef\u6539\u53d8\u914d\u7f6e\uff0c\u53d8\u6210http\u534f\u8bae\uff08docker \u4ed3\u5e93\u9ed8\u8ba4\u662fhttps\u534f\u8bae\uff0c\u6211\u4eec\u4f7f\u7528http\u534f\u8bae\uff09 [root@localhost img4]# cat !$ cat /etc/docker/daemon.json { \"registry-mirrors\": [\"http://3e930982.m.daocloud.io\"], \"insecure-registries\":[\"192.168.183.134:5000\"] } \u5176\u4e2dinsecure-registries\u540e\u9762\u662fdocker\u4ed3\u5e93\u7684\u5730\u5740\u548c\u7aef\u53e3\u3002 [root@localhost img4]# systemctl restart docker","title":"3.2.2 \u67e5\u770btag\u4fe1\u606f"},{"location":"linux/server/harbor/harbor.index/#323-push","text":"\u4fee\u6539\u534f\u8bae\u540e\u91cd\u542fdocker\u7136\u540e\u5728push\u955c\u50cf\u5230\u79c1\u6709\u4ed3\u5e93\u91cc\u9762 [root@localhost img4]# docker push 192.168.183.134:5000/myweb:v0.3-11 The push refers to repository [192.168.183.134:5000/myweb] 347a19806329: Pushed 20555723c54b: Pushed a79fe6dff072: Pushed 87deea508850: Pushed 90c4db1d5ef5: Pushed cd7100a72410: Pushed v0.3-11: digest: sha256:be593f8f6e45181416242b37183b3c5429745e3623424a1a9b672afab898714e size: 1568","title":"3.2.3 push"},{"location":"linux/server/harbor/harbor.index/#324","text":"docker\u79c1\u6709\u4ed3\u5e93\u7aef\u67e5\u770b [root@leco registry]# ls /var/lib/registry/docker/registry/v2/repositories/myweb/_layers/sha256/ 44ef73a3a19b95ae6f7e0c4bf92f0fcc876dce929340455c591430203b4bc151 4b15fa862ac67691a8bc682937be38197ebebe580f01b1bcc0ee823fc43709aa 5e38f0c1e3e667d4fd01ac85ebcd4337579471d841a925d4be81bde53a482614 7d4e05a01906143afc15671a53151ea9755dac230db376a8b8364b21ca774dbc 8aeac9a3205fce5e21ab65ccce330fe389a9aaf47e4b682970b1772ae25a1d73 b430473be128c1302a75e8381dfbaa45182fec81db4f75b749e4896d7816c2ea ff3a5c916c92643ff77519ffa742d3ec61b7f591b6b7504599d95a4a41134e28 \u53ef\u89c1\u4ecedocker\u5ba2\u6237\u7aefpush\u4e0a\u7684\u955c\u50cf\u5df2\u7ecf\u63a8\u9001\u8fc7\u6765\uff0c\u7ecf\u8fc7hash\u4e86\u3002","title":"3.2.4 \u4ed3\u5e93\u67e5\u770b"},{"location":"linux/server/harbor/harbor.index/#325-pull","text":"\u5728\u5176\u4ed6\u673a\u5668\u4e0a\u6d4b\u8bd5\uff08pull\u955c\u50cf\uff09 [root@leco registry]# cat /etc/docker/daemon.json { \"registry-mirrors\": [\"http://3e930982.m.daocloud.io\"], \"bip\": \"10.0.0.1/16\", \"insecure-registries\":[\"192.168.183.134:5000\"] } [root@leco registry]# systemctl restart docker [root@leco registry]# docker pull 192.168.183.134:5000/myweb:v0.3-11 v0.3-11: Pulling from myweb ff3a5c916c92: Pull complete b430473be128: Pull complete 7d4e05a01906: Pull complete 8aeac9a3205f: Pull complete 5e38f0c1e3e6: Pull complete 4b15fa862ac6: Pull complete Digest: sha256:be593f8f6e45181416242b37183b3c5429745e3623424a1a9b672afab898714e Status: Downloaded newer image for 192.168.183.134:5000/myweb:v0.3-11 [root@leco registry]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE 192.168.183.134:5000/myweb v0.3-11 44ef73a3a19b About an hour ago 18MB","title":"3.2.5 pull"},{"location":"linux/server/harbor/harbor.index/#4-harbor","text":"","title":"4. Harbor"},{"location":"linux/server/harbor/harbor.index/#41","text":"\u5b98\u65b9\u6587\u6863 \u5b89\u88c5\u6b65\u9aa4","title":"4.1 \u53c2\u8003\u6587\u6863"},{"location":"linux/server/harbor/harbor.index/#42","text":"\u4e0b\u8f7d\u5b89\u88c5\u540e\u4e0a\u4f20\u5230\u670d\u52a1\u5668\u4e0a\uff0c\u89e3\u538b\u914d\u7f6e\u5b89\u88c5\u3002","title":"4.2 \u4e0b\u8f7d\u5b89\u88c5"},{"location":"linux/server/harbor/harbor.index/#421","text":"\u5173\u95ed\u4e4b\u524d\u81ea\u5e26\uff08github\u81ea\u5df1\u7684\uff09\u7684\u955c\u50cf\u4ed3\u5e93 [root@leco ~]# netstat -lnp|grep 5000 tcp6 0 0 :::5000 :::* LISTEN 17540/registry [root@leco ~]# systemctl stop docker-distribution [root@leco ~]# netstat -lnp|grep 500 [root@leco opt]# ls harbor-offline-installer-v1.5.3.tgz myimages.gz [root@leco opt]# tar xf harbor-offline-installer-v1.5.3.tgz -C /usr/local/ [root@leco opt]# cd /usr/local/harbor/ [root@leco harbor]# pwd /usr/local/harbor [root@leco harbor]# ll total 895716 drwxr-xr-x 4 root root 37 Sep 20 17:37 common -rw-r--r-- 1 root root 1185 Sep 12 14:19 docker-compose.clair.yml -rw-r--r-- 1 root root 1725 Sep 12 14:19 docker-compose.notary.yml -rw-r--r-- 1 root root 3596 Sep 12 14:19 docker-compose.yml drwxr-xr-x 3 root root 156 Sep 12 14:19 ha -rw-r--r-- 1 root root 6955 Sep 20 17:32 harbor.cfg -rw-r--r-- 1 root root 6956 Sep 20 17:31 harbor.cfg.ori -rw-r--r-- 1 root root 915878468 Sep 12 14:21 harbor.v1.5.3.tar.gz -rwxr-xr-x 1 root root 5773 Sep 12 14:19 install.sh -rw-r--r-- 1 root root 10764 Sep 12 14:19 LICENSE -rw-r--r-- 1 root root 482 Sep 12 14:19 NOTICE -rw-r--r-- 1 root root 1247461 Sep 12 14:19 open_source_license -rwxr-xr-x 1 root root 27840 Sep 12 14:19 prepare [root@leco harbor]# cp harbor.cfg harbor.cfg.ori","title":"4.2.1 \u5173\u95ed\u4ed3\u5e93"},{"location":"linux/server/harbor/harbor.index/#422","text":"[root@leco harbor]# diff harbor.cfg harbor.cfg.ori 7c7 < hostname = 192.168.183.134 --- > hostname = reg.mydomain.com \u4fee\u6539hostname\uff0chostname\u662f\u5bf9\u5916\u8bbf\u95ee\u7684\u7684\u5730\u5740\uff0c\u53ef\u4ee5\u57df\u540d\u53ef\u4ee5ip\u5730\u5740\uff0c\u6211\u4eec\u8fd9\u4f7f\u7528ip\uff08\u4e5f\u5c31\u662fdocker\u7684\u79c1\u6709\u4ed3\u5e93\u5730\u5740\uff09","title":"4.2.2 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},{"location":"linux/server/harbor/harbor.index/#423","text":"[root@leco harbor]# sh install.sh [Step 0]: checking installation environment ... Note: docker version: 18.06.1 \u2716 Need to install docker-compose(1.7.1+) by yourself first and run this script again.","title":"4.2.3 \u5f00\u59cb\u5b89\u88c5"},{"location":"linux/server/harbor/harbor.index/#424","text":"\u5148\u8981\u5b89\u88c5docker-compose \u56e0\u4e3aharbor\u4f7f\u7528\u901a\u8fc7docker-compose\u7f16\u6392\u5de5\u5177\u53bb\u5b89\u88c5 [root@leco harbor]# yum install -y docker-compose [root@leco harbor]# sh install.sh [Step 0]: checking installation environment ... Note: docker version: 18.06.1 Note: docker-compose version: 1.18.0 [Step 1]: loading Harbor images ... dba693fc2701: Loading layer [==================================================>] 133.4MB/133.4MB 5773887c4c41: Loading layer [==================================================>] 30.09MB/30.09MB 6fc2abbcae42: Loading layer [==================================================>] 15.37MB/15.37MB d85f176a11ec: Loading layer [==================================================>] 15.37MB/15.37MB Loaded image: vmware/harbor-adminserver:v1.5.3 462b14c85230: Loading layer [==================================================>] 410.1MB/410.1MB c2e0c8cb2903: Loading layer [==================================================>] 9.216kB/9.216kB 11bdb24cded2: Loading layer [==================================================>] 9.216kB/9.216kB 5d8f974b49ef: Loading layer [==================================================>] 7.68kB/7.68kB ee04f13f4147: Loading layer [==================================================>] 1.536kB/1.536kB 799db4dfe41a: Loading layer [==================================================>] 11.78kB/11.78kB f7d813585bdd: Loading layer [==================================================>] 2.56kB/2.56kB 6300bbdbd7ab: Loading layer [==================================================>] 3.072kB/3.072kB Loaded image: vmware/harbor-db:v1.5.3 1d7516778a05: Loading layer [==================================================>] 30.09MB/30.09MB f7ec8d1b47d0: Loading layer [==================================================>] 20.91MB/20.91MB 22b0ad749c21: Loading layer [==================================================>] 20.91MB/20.91MB Loaded image: vmware/harbor-jobservice:v1.5.3 2d449d67c05a: Loading layer [==================================================>] 89.58MB/89.58MB 0bfd4e706575: Loading layer [==================================================>] 3.072kB/3.072kB 6100e173c230: Loading layer [==================================================>] 59.9kB/59.9kB 86fe093d1358: Loading layer [==================================================>] 61.95kB/61.95kB Loaded image: vmware/redis-photon:v1.5.3 Loaded image: photon:1.0 3bf3086a6569: Loading layer [==================================================>] 30.09MB/30.09MB 641d0f77d675: Loading layer [==================================================>] 10.95MB/10.95MB 89efbaabea87: Loading layer [==================================================>] 17.3MB/17.3MB 1276e51f4dc2: Loading layer [==================================================>] 15.87kB/15.87kB 49e187d04e78: Loading layer [==================================================>] 3.072kB/3.072kB e62fbfea411d: Loading layer [==================================================>] 28.24MB/28.24MB Loaded image: vmware/notary-signer-photon:v0.5.1-v1.5.3 Loaded image: vmware/mariadb-photon:v1.5.3 201f6ade61d8: Loading layer [==================================================>] 102.5MB/102.5MB 81221fbb5879: Loading layer [==================================================>] 6.656kB/6.656kB 2268e3c9e521: Loading layer [==================================================>] 2.048kB/2.048kB 9fca06f4b193: Loading layer [==================================================>] 7.68kB/7.68kB Loaded image: vmware/postgresql-photon:v1.5.3 11d6e8a232c9: Loading layer [==================================================>] 30.09MB/30.09MB 42650b04d53d: Loading layer [==================================================>] 24.41MB/24.41MB a1cd8af19e29: Loading layer [==================================================>] 7.168kB/7.168kB 4b1cda90ba19: Loading layer [==================================================>] 10.56MB/10.56MB 1351f0f3006a: Loading layer [==================================================>] 24.4MB/24.4MB Loaded image: vmware/harbor-ui:v1.5.3 e335f4c3af7d: Loading layer [==================================================>] 79.93MB/79.93MB 2aea487bc2c4: Loading layer [==================================================>] 3.584kB/3.584kB d2efec3de68b: Loading layer [==================================================>] 3.072kB/3.072kB d0d71a5ce1dd: Loading layer [==================================================>] 4.096kB/4.096kB 19930367abf0: Loading layer [==================================================>] 3.584kB/3.584kB 03e5b7640db5: Loading layer [==================================================>] 9.728kB/9.728kB Loaded image: vmware/harbor-log:v1.5.3 5aebe8cc938c: Loading layer [==================================================>] 11.97MB/11.97MB Loaded image: vmware/nginx-photon:v1.5.3 ede6a57cbd7e: Loading layer [==================================================>] 30.09MB/30.09MB 4d6dd4fc1d87: Loading layer [==================================================>] 2.56kB/2.56kB c86a69f49f60: Loading layer [==================================================>] 2.56kB/2.56kB 0cf6e04c5927: Loading layer [==================================================>] 2.048kB/2.048kB 6fbff4fe9739: Loading layer [==================================================>] 22.8MB/22.8MB 6f527a618092: Loading layer [==================================================>] 22.8MB/22.8MB Loaded image: vmware/registry-photon:v2.6.2-v1.5.3 e29a8834501b: Loading layer [==================================================>] 12.16MB/12.16MB aaf67f1da2c7: Loading layer [==================================================>] 17.3MB/17.3MB 8d5718232133: Loading layer [==================================================>] 15.87kB/15.87kB fc89aca1dd12: Loading layer [==================================================>] 3.072kB/3.072kB 076eb5a76f6d: Loading layer [==================================================>] 29.46MB/29.46MB Loaded image: vmware/notary-server-photon:v0.5.1-v1.5.3 454c81edbd3b: Loading layer [==================================================>] 135.2MB/135.2MB e99db1275091: Loading layer [==================================================>] 395.4MB/395.4MB 051e4ee23882: Loading layer [==================================================>] 9.216kB/9.216kB 6cca4437b6f6: Loading layer [==================================================>] 9.216kB/9.216kB 1d48fc08c8bc: Loading layer [==================================================>] 7.68kB/7.68kB 0419724fd942: Loading layer [==================================================>] 1.536kB/1.536kB 543c0c1ee18d: Loading layer [==================================================>] 655.2MB/655.2MB 4190aa7e89b8: Loading layer [==================================================>] 103.9kB/103.9kB Loaded image: vmware/harbor-migrator:v1.5.0 45878c64fc3c: Loading layer [==================================================>] 165.3MB/165.3MB fc3d407ce98f: Loading layer [==================================================>] 10.93MB/10.93MB d7a0785bb902: Loading layer [==================================================>] 2.048kB/2.048kB a17e0f23bc84: Loading layer [==================================================>] 48.13kB/48.13kB 57c7181f2336: Loading layer [==================================================>] 10.97MB/10.97MB Loaded image: vmware/clair-photon:v2.0.5-v1.5.3 [Step 2]: preparing environment ... Generated and saved secret to file: /data/secretkey Generated configuration file: ./common/config/nginx/nginx.conf Generated configuration file: ./common/config/adminserver/env Generated configuration file: ./common/config/ui/env Generated configuration file: ./common/config/registry/config.yml Generated configuration file: ./common/config/db/env Generated configuration file: ./common/config/jobservice/env Generated configuration file: ./common/config/jobservice/config.yml Generated configuration file: ./common/config/log/logrotate.conf Generated configuration file: ./common/config/jobservice/config.yml Generated configuration file: ./common/config/ui/app.conf Generated certificate, key file: ./common/config/ui/private_key.pem, cert file: ./common/config/registry/root.crt The configuration files are ready, please use docker-compose to start the service. Creating harbor-log ... done [Step 3]: checking existing instance of Harbor ... Creating registry ... done Creating harbor-ui ... done Creating network \"harbor_harbor\" with the default driver Creating nginx ... done Creating harbor-db ... Creating registry ... Creating harbor-adminserver ... Creating redis ... Creating harbor-ui ... Creating harbor-jobservice ... Creating nginx ... \u2714 ----Harbor has been installed and started successfully.---- Now you should be able to visit the admin portal at http://192.168.183.134. For more details, please visit https://github.com/vmware/harbor . \u53ef\u4ee5\u770b\u5230\u4ee5\u4e0a\u5df2\u7ecf\u5b89\u88c5\u5b8c\u4e86\u3002\u6211\u4eec\u901a\u8fc7web\u8bbf\u95eeharbor\uff0c\u53ef\u4ee5\u770b\u5230\u4ee5\u4e0a\u5df2\u7ecf\u5b89\u88c5\u5b8c\u4e86\u3002 \u5b89\u88c5\u5b8c\u6bd5\u540e\u67e5\u770bdocker Harbor\u5176\u5b9e\u4e5f\u662f\u52a0\u8f7ddocker\u955c\u50cf","title":"4.2.4 \u5b89\u88c5\u7f16\u6392\u5de5\u5177"},{"location":"linux/server/harbor/harbor.index/#43-web","text":"","title":"4.3 Web\u64cd\u4f5c"},{"location":"linux/server/harbor/harbor.index/#431","text":"\u9ed8\u8ba4\u8d26\u53f7\u548c\u5bc6\u7801\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c \u8d26\u53f7\u662f: admin \u5bc6\u7801\u662f: Harbor12345","title":"4.3.1 \u7b80\u5355\u4ecb\u7ecd"},{"location":"linux/server/harbor/harbor.index/#432","text":"\u56e0\u4e3aharbor\u662f\u591a\u4eba\u7684\u79c1\u6709\u4ed3\u5e93\uff0c\u6240\u4ee5\u5efa\u7acb\u666e\u901a\u7528\u6237\uff0c\u5bf9\u5e94\u5efa\u7acb\u79c1\u6709\u7684\u4ed3\u5e93\uff0c\u7136\u540edocker\u5ba2\u6237\u7aef\u901a\u8fc7\u4f7f\u7528\u8fd9\u4e2a\u65b0\u5efa\u7684\u8d26\u53f7\u548c\u5bc6\u7801\u767b\u5f55harbor\u7136\u540e\u63a8\u9001\u5230\u81ea\u5df1\u7684\u4ed3\u5e93\u4e2d\u3002","title":"4.3.2 \u65b0\u5efa\u7528\u6237"},{"location":"linux/server/harbor/harbor.index/#433","text":"","title":"4.3.3 \u65b0\u5efa\u79c1\u6709\u4ed3\u5e93"},{"location":"linux/server/harbor/harbor.index/#434","text":"","title":"4.3.4 \u666e\u901a\u7528\u6237\u767b\u5f55"},{"location":"linux/server/harbor/harbor.index/#435","text":"","title":"4.3.5 \u666e\u901a\u7528\u6237\u65b0\u5efa\u9879\u76ee"},{"location":"linux/server/harbor/harbor.index/#44","text":"","title":"4.4 \u5ba2\u6237\u7aef\u64cd\u4f5c\u63a8\u9001"},{"location":"linux/server/harbor/harbor.index/#441-pull","text":"[root@localhost img4]# ifconfig ens33 ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500 inet 192.168.183.133 netmask 255.255.255.0 broadcast 192.168.183.255 ether 00:0c:29:9e:1f:67 txqueuelen 1000 (Ethernet) RX packets 66573 bytes 17079495 (16.2 MiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 36722 bytes 16771887 (15.9 MiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 [root@localhost img4]# cat /etc/docker/daemon.json { \"registry-mirrors\": [\"http://3e930982.m.daocloud.io\"], \"insecure-registries\":[\"192.168.183.134\"] } [root@localhost img4]# systemctl restart docker","title":"4.4.1 pull\u955c\u50cf"},{"location":"linux/server/harbor/harbor.index/#442-tag","text":"\u6253tag\u7684\u76ee\u7684\u4e3b\u8981\u662f\u63a8\u9001\u7684\u955c\u50cf\u5230\u79c1\u6709\u4ed3\u5e93\u800c\u4e0d\u662f\u63a8\u9001\u5230dockerhub\u4e0a\uff08\u9ed8\u8ba4\u90fd\u662f\u63a8\u9001\u5230dockerhub\u4e0a\uff09 [root@localhost img4]# docker tag myweb:v0.3-4 192.168.183.134/myweb/myweb:v0.3-4 [root@localhost img4]# docker tag myweb:v0.3-5 192.168.183.134/myweb/myweb:v0.3-5 [root@localhost img4]# docker tag myweb:v0.3-6 192.168.183.134/myweb/myweb:v0.3-6 [root@localhost img4]# docker tag myweb:v0.3-7 192.168.183.134/myweb/myweb:v0.3-7","title":"4.4.2 \u5ba2\u6237\u7aef\u6253tag"},{"location":"linux/server/harbor/harbor.index/#443","text":"[root@localhost img4]# docker login 192.168.183.134 Username: caimengzhi #\u8d26\u53f7\u662fweb\u767b\u5f55\u7684\u8d26\u53f7\u548c\u5bc6\u7801 Password: WARNING! Your password will be stored unencrypted in /root/.docker/config.json. Configure a credential helper to remove this warning. See https://docs.docker.com/engine/reference/commandline/login/#credentials-store Login Succeeded","title":"4.4.3 \u767b\u5f55"},{"location":"linux/server/harbor/harbor.index/#444","text":"[root@localhost img4]# docker push 192.168.183.134/myweb/myweb <\u82e5\u662f\u63a8\u9001\u4e0d\u6307\u5b9a\u955c\u50cftag\uff0c\u4f1a\u63a8\u9001\u6240\u6709192.168.183.134/myweb/myweb\u7684\u955c\u50cf> The push refers to repository [192.168.183.134/myweb/myweb] a8dcd6aa3279: Pushed 9a07ffbe3d7d: Pushed 955e7d7f7300: Pushed 95bb4e754f2d: Pushed ebf12965380b: Pushed v0.3-4: digest: sha256:bff4611d26ab5ea7df2a2038f5c806060343e8dcb72f4e7d9c8186f9f29ab1d2 size: 1360 02d539f1584f: Pushed 9a07ffbe3d7d: Layer already exists 955e7d7f7300: Layer already exists 95bb4e754f2d: Layer already exists ebf12965380b: Layer already exists v0.3-5: digest: sha256:d989d072b34649c6c3db1b90cc8e9da01fc0851db7154087f8c20d9276c6b19e size: 1360 cf1c42bcc62e: Pushed 31d53a6ec2f6: Pushed 9a07ffbe3d7d: Layer already exists 955e7d7f7300: Layer already exists 95bb4e754f2d: Layer already exists ebf12965380b: Layer already exists v0.3-6: digest: sha256:f001406ad67619ca5a20595f5392099f4c89aabc03a577a9e2b21951daa6625b size: 1567 cf1c42bcc62e: Layer already exists 31d53a6ec2f6: Layer already exists 9a07ffbe3d7d: Layer already exists 955e7d7f7300: Layer already exists 95bb4e754f2d: Layer already exists ebf12965380b: Layer already exists v0.3-7: digest: sha256:f001406ad67619ca5a20595f5392099f4c89aabc03a577a9e2b21951daa6625b size: 1567","title":"4.4.4 \u63a8\u9001\u955c\u50cf"},{"location":"linux/server/harbor/harbor.index/#445","text":"\u63a8\u9001\u5b8c\u6bd5\u540e\u5728docker\u79c1\u6709\u4ed3\u5e93\u4e0aweb\u67e5\u770b\u4e4b\u524d\u63a8\u9001\u7684\u60c5\u51b5\u3002","title":"4.4.5  \u67e5\u770b\u63a8\u9001\u60c5\u51b5"},{"location":"linux/server/harbor/harbor.index/#45","text":"\u65b0\u627e\u4e00\u4e2a\u522b\u7684\u673a\u5668\u53bb\u62c9\u53bb\u64cd\u4f5c","title":"4.5 \u5ba2\u6237\u7aef\u64cd\u4f5c\u62c9"},{"location":"linux/server/harbor/harbor.index/#451","text":"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\uff08http\uff09 [root@leco ~]# cat /etc/docker/daemon.json { \"registry-mirrors\": [\"http://3e930982.m.daocloud.io\"], \"insecure-registries\":[\"192.168.183.134\"] }","title":"4.5.1 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},{"location":"linux/server/harbor/harbor.index/#452-docker","text":"[root@leco ~]# systemctl restart docker [root@leco ~]# ifconfig ens33 ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500 inet 192.168.183.135 netmask 255.255.255.0 broadcast 192.168.183.255 ether 00:0c:29:5e:f3:38 txqueuelen 1000 (Ethernet) RX packets 32850 bytes 2734678 (2.6 MiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 3833 bytes 375551 (366.7 KiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0","title":"4.5.2 \u91cd\u542fdocker"},{"location":"linux/server/harbor/harbor.index/#453","text":"[root@leco ~]# docker login 192.168.183.134 Username: caimengzhi Password: WARNING! Your password will be stored unencrypted in /root/.docker/config.json. Configure a credential helper to remove this warning. See https://docs.docker.com/engine/reference/commandline/login/#credentials-store Login Succeeded","title":"4.5.3 \u767b\u5f55"},{"location":"linux/server/harbor/harbor.index/#454","text":"\u767b\u5f55web\u754c\u9762\u627e\u5230pull\u7684\u5730\u5740 [root@leco ~]# docker pull 192.168.183.134/myweb/myweb:v0.3-7 v0.3-7: Pulling from myweb/myweb c67f3896b22c: Pull complete 428de5b8d58a: Pull complete 7efd417f3e28: Pull complete 61a56b170416: Pull complete e7206a413d4c: Pull complete 54a1363d75f0: Pull complete Digest: sha256:f001406ad67619ca5a20595f5392099f4c89aabc03a577a9e2b21951daa6625b Status: Downloaded newer image for 192.168.183.134/myweb/myweb:v0.3-7","title":"4.5.4 \u5730\u5740"},{"location":"linux/server/harbor/harbor.index/#455","text":"[root@leco ~]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE 192.168.183.134/myweb/myweb v0.3-7 5799f549739a 3 hours ago 17.4MB","title":"4.5.5 \u67e5\u770b\u672c\u5730\u955c\u50cf"},{"location":"linux/server/harbor/harbor.index/#46-harbor","text":"","title":"4.6 Harbor \u670d\u52a1\u64cd\u4f5c"},{"location":"linux/server/harbor/harbor.index/#461","text":"[root@leco ~]# docker-compose pause","title":"4.6.1 \u6682\u505c"},{"location":"linux/server/harbor/harbor.index/#462","text":"[root@leco ~]# docker-compose stop","title":"4.6.2 \u505c\u6b62"},{"location":"linux/server/harbor/harbor.index/#463","text":"[root@leco ~]# docker-compose start [root@leco harbor]# pwd /usr/local/harbor [root@leco harbor]# ll total 895716 drwxr-xr-x 4 root root 37 Sep 20 17:37 common -rw-r--r-- 1 root root 1185 Sep 12 14:19 docker-compose.clair.yml -rw-r--r-- 1 root root 1725 Sep 12 14:19 docker-compose.notary.yml -rw-r--r-- 1 root root 3596 Sep 12 14:19 docker-compose.yml drwxr-xr-x 3 root root 156 Sep 12 14:19 ha -rw-r--r-- 1 root root 6955 Sep 20 17:32 harbor.cfg -rw-r--r-- 1 root root 6956 Sep 20 17:31 harbor.cfg.ori -rw-r--r-- 1 root root 915878468 Sep 12 14:21 harbor.v1.5.3.tar.gz -rwxr-xr-x 1 root root 5773 Sep 12 14:19 install.sh -rw-r--r-- 1 root root 10764 Sep 12 14:19 LICENSE -rw-r--r-- 1 root root 482 Sep 12 14:19 NOTICE -rw-r--r-- 1 root root 1247461 Sep 12 14:19 open_source_license -rwxr-xr-x 1 root root 27840 Sep 12 14:19 prepare \u4ee5\u4e0a\u64cd\u4f5c\u90fd\u8981\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e0b\uff0c\u6267\u884c\u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u52a0\u8f7ddocker-compose.yml\u6587\u4ef6","title":"4.6.3 \u542f\u52a8"},{"location":"linux/server/harbor/harbor.index/#47-harbor","text":"","title":"4.7 Harbor \u90ae\u4ef6"},{"location":"linux/server/harbor/harbor.index/#471","text":"\u6211\u4f7f\u7528\u7684163\u7684\u90ae\u7bb1\u8bf7\u6309\u7167\u4e0a\u8ff0\u53c2\u6570\u627e\u5230\u81ea\u5df1\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u5176\u4ed6\u90ae\u7bb1\u8bf7\u767e\u5ea6\u81ea\u884c\u914d\u7f6e\u3002 \u914d\u7f6e\u5b8c\u540e\u3002\u68c0\u9a8c","title":"4.7.1 \u90ae\u4ef6\u914d\u7f6e"},{"location":"linux/server/harbor/harbor.index/#472","text":"\u7136\u540e\u91cd\u65b0\u767b\u5f55","title":"4.7.2 \u5fd8\u8bb0\u767b\u5f55\u5bc6\u7801"},{"location":"linux/server/harbor/harbor.index/#48-qa","text":"Q\uff1aMaster-Slave\u7684\u955c\u50cf\u67b6\u6784\u4e2d,\u5982\u679cSlave Registy\u4e2d\u7684\u955c\u50cf\u88ab\u5220\u9664\u4e86\uff0c\u4f1a\u4e0d\u4f1a\u518d\u6b21\u81ea\u52a8\u4eceMaster Reg\u91cc\u9762\u81ea\u52a8\u540c\u6b65\uff1f A\uff1a\u5982\u679c\u505c\u6b62\u540e\u518d\u91cd\u65b0\u542f\u52a8\u590d\u5236\u7b56\u7565\uff0c\u53ef\u4ee5\u540c\u6b65\u88ab\u5220\u9664\u7684\u955c\u50cf\u3002 Q\uff1a\u5bf9\u4e8e\u591a\u4e2a\u6295\u4ea7\u5730\uff0c\u591a\u4e2a\u4ed3\u5e93\uff0c\u54ea\u79cd\u65b9\u5f0f\u7684\u9ad8\u53ef\u7528\u65b9\u6848\u597d\u4e48\uff1f\u7b2c\u4e00\u79cd\uff0c\u5171\u4eab\u5b58\u50a8\u5b58\u50a8\u53ef\u80fd\u4f1a\u51fa\u73b0\u5355\u70b9\u6545\u969c\u4e48\uff1f A\uff1a\u5171\u4eab\u5b58\u50a8\u53ea\u9002\u5408\u540c\u4e00\u6570\u636e\u4e2d\u5fc3\uff0c\u591a\u4e2a\u4ea7\u5730\u5ef6\u65f6\u592a\u5927\uff0c\u4e0d\u9002\u5408\u5171\u4eab\u5b58\u50a8\u3002 Q\uff1aRegistry\u4e4b\u95f4\u540c\u6b65\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff1f A\uff1aRegistry API\u3002 Q\uff1a\u5728\u5b58\u50a8\u8fd9\u5757\u8003\u8651\u8fc7\u63d0\u4f9b\u63d2\u4ef6\u65b9\u5f0f\u53ef\u4ee5\u8c03\u7528\u5916\u90e8\u6a21\u5757\uff0c\u6bd4\u5982\u4ee5\u63d2\u4ef6\u65b9\u5f0f\u652f\u6301s3\u8fd9\u79cd\u5bf9\u8c61\u5b58\u50a8\uff1f A\uff1aHarbor\u652f\u6301\u5176\u4ed6\u5b58\u50a8\u65b9\u5f0f\uff0c\u53c2\u89c1Harbor\u6587\u6863\u3002","title":"4.8 QA"},{"location":"linux/server/pppoe/pppoe.index/","text":"PPPOE PPPOE\u670d\u52a1\u5668 \u00b6 1. \u7cfb\u7edf\u90e8\u7f72\u57fa\u7840 \u00b6 \u670d\u52a1\u5668\u7684ip\u89c4\u5212 \u89d2\u8272 IP \u7f51\u5173 \u7cfb\u7edf PPPOE server 192.168.10.109 \u5185\u7f51 192.168.5.109 \u5916\u7f51 192.168.5.1 Linux Centos 6.8 x64 PPPOE Client 192.168.10.90 \u5185\u7f51 Xp sp3 x86 PPPOE Client 192.168.10.80 \u5185\u7f51 Centos 68 x64 2. \u670d\u52a1\u7aef\u642d\u5efa \u00b6 2.1 \u5b89\u88c5 \u00b6 \u67e5\u770b\u662f\u5426\u5b89\u88c5\u6240\u9700\u8981\u7684\u5305\u3002 [root@mfsdata02 ppp]# rpm -qa |grep rp-pppoe rp-pppoe-3.10-16.el6.x86_64 \u6ca1\u6709\u8bdd\u5c31\u5b89\u88c5 yum install rp-pppoe 2.2 \u67e5\u770b\u914d\u7f6e\u6587\u4ef6 \u00b6 \u914d\u7f6e\u6587\u4ef6\u76ee\u5f55\u5728/etc/ppp\u4e0b [root@mfsdata02 ~]# cd /etc/ppp/ [root@mfsdata02 ppp]# cp chap-secrets chap-secrets.ori [root@mfsdata02 ppp]# cp pppoe-server-options pppoe-server-options.ori [root@mfsdata02 ppp]# ll total 64 -rw------- 1 root root 189 Jan 16 19:09 chap-secrets -rw------- 1 root root 78 Jan 16 18:33 chap-secrets.ori -rwxr-xr-x. 1 root root 2276 May 11 2016 firewall-masq -rwxr-xr-x. 1 root root 978 May 11 2016 firewall-standalone -rwxr-xr-x. 1 root root 386 Apr 12 2016 ip-down -rwxr-xr-x. 1 root root 3262 Apr 12 2016 ip-down.ipv6to4 -rwxr-xr-x. 1 root root 430 Apr 12 2016 ip-up -rwxr-xr-x. 1 root root 6517 Apr 12 2016 ip-up.ipv6to4 -rwxr-xr-x. 1 root root 1687 Apr 12 2016 ipv6-down -rwxr-xr-x. 1 root root 3196 Apr 12 2016 ipv6-up -rw-r--r--. 1 root root 5 Mar 16 2015 options -rw-------. 1 root root 77 Mar 16 2015 pap-secrets drwxr-xr-x. 2 root root 4096 Jul 13 2016 peers -rw-r--r-- 1 root root 140 Jan 16 18:33 pppoe-server-options -rw-r--r-- 1 root root 104 Jan 16 18:32 pppoe-server-options.ori \u5907\u4efd pppoe-server-options.ori \u662f\u6211\u624b\u52a8\u5907\u4efd\u7684\u6587\u4ef6\uff0c\u4e3b\u8981\u4fee\u6539\u8fd9\u4e24\u4e2a\u914d\u7f6e\u6587\u4ef6 2.3 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 \u00b6 \u914d\u7f6e\u6587\u4ef6pppoe-server-options\u4fee\u6539\u5982\u4e0b # PPP options for the PPPoE server # LIC: GPL #require-pap require-chap #\u9a8c\u8bc1\u65b9\u5f0f,\u5982\u679c\u9009pap\u7684\u8bdd\uff0c\u5c31\u5230pap-secrets\u6587\u4ef6\u4e2d\u589e\u52a0\u7528\u6237 login lcp-echo-interval 10 lcp-echo-failure 2 ms-dns 202.106.0.20 ms-dns 8.8.8.8 2.4 \u6dfb\u52a0\u8d26\u53f7\u4fe1\u606f \u00b6 \u6dfb\u52a0\u7528\u6237\uff0c\u8bbe\u7f6e\u8d26\u6237\u548c\u5bc6\u7801 [root@mfsdata02 ppp]# cat chap-secrets # Secrets for authentication using CHAP # client server secret IP addresses cmz * cmz * cmz2 * cmz2 192.168.10.3 #\u53ef\u4ee5\u6307\u5b9a\u5ba2\u6237\u7aef\u7684\u5730\u5740\u4e5f\u53ef\u4ee5\u4e0d\u6307\u5b9a 2.5 \u5f00\u542f\u5185\u6838ip\u8f6c\u53d1 \u00b6 [root@mfsdata02 ppp]# sed -i \"s#net.ipv4.ip_forward = 0#net.ipv4.ip_forward = 1#g\" /etc/sysctl.conf [root@mfsdata02 ppp]# sysctl -p net.ipv4.ip_forward = 1 2.6 \u9632\u706b\u5899\u914d\u7f6e \u00b6 \u9632\u706b\u5899\u8bbe\u7f6e\uff0c\u8bbe\u7f6e\u5c40\u57df\u7f51\u5185\u673a\u5668\u5171\u4eab\u4e0a\u7f51 [root@mfsdata02 ppp]# iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE [root@mfsdata02 ppp]# iptables -t nat -nL Chain PREROUTING (policy ACCEPT) target prot opt source destination Chain POSTROUTING (policy ACCEPT) target prot opt source destination MASQUERADE all -- 0.0.0.0/0 0.0.0.0/0 Chain OUTPUT (policy ACCEPT) target prot opt source destination eth0\u4e3a\u51fa\u53e3\u7684\u7f51\u5361\uff0c\u5c31\u662f\u53ef\u4ee5\u548c\u5916\u7f51\u8fde\u901a\u7684\u90a3\u5757\u3002\u5230\u73b0\u5728\u8fd9\u4e2apppoe\u670d\u52a1\u5668\u5c31\u53ef\u4ee5\u5de5\u4f5c\u4e86\u3002 2.7 \u542f\u52a8 \u00b6 \u542f\u52a8pppoe\u670d\u52a1 [root@mfsdata02 ppp]# pppoe-server -I eth1 -L 192.168.10.109 -R 192.168.10.2 -N 20 \u53c2\u6570\u89e3\u91ca I\uff1a\u6307\u5b9a\u54cd\u5e94PPPOE\u8bf7\u6c42\u7684\u7aef\u53e3\uff0c\u73b0\u5728\u4f7f\u7528\u7684eth1\uff0c\u4e5f\u5c31\u662f\u5185\u7f51\u7684\u3002 L\uff1aPPPOE\u670d\u52a1\u5668\u7684IP\u5730\u5740\uff0c\u5ba2\u6237\u7aef\u8fde\u63a5\u53ef\u4ee5\u770b\u5230\u7684\u670d\u52a1\u5668\u5730\u5740\uff0c\u53ef\u4ee5\u662f\u4efb\u610f\u4e5f\u5c31\u662fpppoe\u5ba2\u6237\u7aef\u7684\u865a\u62df\u7f51\u5173\u3002 \uff08\u6ce8\u610f\uff1a\u6b64IP\u5730\u5740\u53ef\u4ee5\u4e0d\u662f\u7f51\u5361\u7684IP\u5730\u5740\uff0c\u800c\u662fPPPOE\u670d\u52a1\u5668\u7684\u865a\u62dfIP\uff0c\u6211\u4f7f\u7528\u4e86\u672c\u5730\u7684ip) R\uff1a\u8fd9\u662f\u5206\u914d\u7ed9\u5ba2\u6237\u7aef\u7684\u5730\u5740\u6c60\u8d77\u59cb\u5730\u5740\uff0c\u672c\u4f8b\u4e2d\u4ece192.168.10.2\u5f00\u59cb N\uff1a\u5730\u5740\u6c60\u7684IP\u5730\u5740\u9012\u589e\u51e0\u4e2a\uff0c\u672c\u4f8b\u4e2d\u6dfb\u589e10\uff0c\u4e5f\u5c31\u662f\u4ece192.168.10.2\u5f00\u59cb\u5206\u914d\uff0c\u4e00\u5171\u5206\u914d20\u4e2aIP\u5730\u5740 2.8 \u914d\u7f6e\u81ea\u542f\u52a8 \u00b6 [root@mfsdata02 ppp]# echo \"pppoe-server -I eth1 -L 192.168.10.109 -R 192.168.10.2 -N 20\" >> /etc/rc.d/rc.local \u5ba2\u6237\u7aef\u8fde\u63a5\u4e4b\u540e\u6b64\u65f6\u5728\u670d\u52a1\u7aef\u80fd\u770b\u5230\u4e00\u4e2apppo\u7684\u7f51\u7edc\u4fe1\u606f\u3002\u6ce8\u610f\u4e00\u5b9a\u8981\u662f\u5728\u5ba2\u6237\u7aef\u8fde\u63a5\u4e4b\u540e\u624d\u80fd\u770b\u5230\u8be5\u4fe1\u606f\u3002 [root@mfsdata02 ppp]# ifconfig eth0 Link encap:Ethernet HWaddr 00:0C:29:87:F2:BF inet addr:192.168.5.109 Bcast:192.168.5.255 Mask:255.255.255.0 inet6 addr: fe80::20c:29ff:fe87:f2bf/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:15648 errors:0 dropped:0 overruns:0 frame:0 TX packets:10539 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:16369623 (15.6 MiB) TX bytes:982976 (959.9 KiB) eth1 Link encap:Ethernet HWaddr 00:0C:29:87:F2:C9 inet addr:192.168.10.109 Bcast:192.168.10.255 Mask:255.255.255.0 inet6 addr: fe80::20c:29ff:fe87:f2c9/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:6002 errors:0 dropped:0 overruns:0 frame:0 TX packets:814 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:453691 (443.0 KiB) TX bytes:60473 (59.0 KiB) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:23 errors:0 dropped:0 overruns:0 frame:0 TX packets:23 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:2160 (2.1 KiB) TX bytes:2160 (2.1 KiB) ppp0 Link encap:Point-to-Point Protocol inet addr:192.168.10.109 P-t-P:192.168.1.3 Mask:255.255.255.255 UP POINTOPOINT RUNNING NOARP MULTICAST MTU:1480 Metric:1 RX packets:2184 errors:0 dropped:0 overruns:0 frame:0 TX packets:471 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:3 RX bytes:130073 (127.0 KiB) TX bytes:28127 (27.4 KiB) 3. windows \u5ba2\u6237\u7aef\u6d4b\u8bd5 \u00b6 \u627e\u5176\u4ed6\u673a\u5668\u6d4b\u8bd5 3.1 \u62e8\u53f7\u4e4b\u524d\u68c0\u67e5 \u00b6 \u5ba2\u6237\u7aef\u62e8\u53f7\u6d41\u7a0b 3.2 \u62e8\u53f7 \u00b6 \u9009\u62e9\u5ba2\u6237\u7aef\u62e8\u53f7\u767b\u5f55\u6d4b\u8bd5 3.3 \u62e8\u53f7\u540e\u68c0\u67e5 \u00b6 \u4ee5\u4e0b\u662fdos\u547d\u4ee4\u884c\uff0c\u8be6\u7ec6\u6d4b\u8bd5\u8fc7\u7a0b\uff1a \u6ca1\u6709\u62e8\u53f7\u4e4b\u524d\u64cd\u4f5c Microsoft Windows XP [\u7248\u672c 5.1.2600] (C) \u7248\u6743\u6240\u6709 1985-2001 Microsoft Corp. C:\\Documents and Settings\\Administrator>ipconfig Windows IP Configuration Ethernet adapter \u672c\u5730\u8fde\u63a5: Connection-specific DNS Suffix . : IP Address. . . . . . . . . . . . : 192.168.10.90 #\u672c\u5730\u5c31\u662f\u4e4b\u524d\u5185\u7f51\u7684\u5730\u5740 Subnet Mask . . . . . . . . . . . : 255.255.255.0 Default Gateway . . . . . . . . . : C:\\Documents and Settings\\Administrator>ping 192.168.10.109 #\u53ef\u4ee5ping\u901apppoe\u670d\u52a1\u5668\u7aef\u5185\u7f51\u7684\u5730\u5740 Pinging 192.168.10.109 with 32 bytes of data: Reply from 192.168.10.109: bytes=32 time<1ms TTL=64 Reply from 192.168.10.109: bytes=32 time<1ms TTL=64 Ping statistics for 192.168.10.109: Packets: Sent = 2, Received = 2, Lost = 0 (0% loss), Approximate round trip times in milli-seconds: Minimum = 0ms, Maximum = 0ms, Average = 0ms Control-C ^C C:\\Documents and Settings\\Administrator>ping 192.168.5.1 #\u867d\u7136\u80fdping\u901apppoe\u5185\u7f51\u5730\u5740\u4f46\u662fping\u4e0d\u540cpppoe\u670d\u52a1\u7aef\u5916\u7f51\u5730\u5740\u7f51\u5173\u5730\u5740\uff0c\u6b64\u65f6\u8fd8\u6ca1\u6709\u62e8\u53f7 Pinging 192.168.5.1 with 32 bytes of data: Destination host unreachable. Destination host unreachable. Ping statistics for 192.168.5.1: Packets: Sent = 2, Received = 0, Lost = 2 (100% loss), Control-C ^C \u6ca1\u6709\u62e8\u53f7\u4e4b\u540e\u64cd\u4f5c C:\\Documents and Settings\\Administrator>ping 192.168.5.1 Pinging 192.168.5.1 with 32 bytes of data: Reply from 192.168.5.1: bytes=32 time=8ms TTL=127 Reply from 192.168.5.1: bytes=32 time=15ms TTL=127 Ping statistics for 192.168.5.1: Packets: Sent = 2, Received = 2, Lost = 0 (0% loss), Approximate round trip times in milli-seconds: Minimum = 8ms, Maximum = 15ms, Average = 11ms Control-C ^C C:\\Documents and Settings\\Administrator>ping 192.168.10.109 Pinging 192.168.10.109 with 32 bytes of data: Reply from 192.168.10.109: bytes=32 time=3ms TTL=64 Reply from 192.168.10.109: bytes=32 time=14ms TTL=64 Ping statistics for 192.168.10.109: Packets: Sent = 2, Received = 2, Lost = 0 (0% loss), Approximate round trip times in milli-seconds: Minimum = 3ms, Maximum = 14ms, Average = 8ms Control-C ^C C:\\Documents and Settings\\Administrator>ipconfig Windows IP Configuration Ethernet adapter \u672c\u5730\u8fde\u63a5: Connection-specific DNS Suffix . : IP Address. . . . . . . . . . . . : 192.168.10.90 Subnet Mask . . . . . . . . . . . : 255.255.255.0 Default Gateway . . . . . . . . . : PPP adapter \u5bbd\u5e26\u8fde\u63a5: #\u62e8\u53f7\u6210\u529f\u540e\u5c31\u4f1a\u53d1\u73b0\u6709\u4e2appp\u5ba2\u6237\u7aef\u4ea7\u751f\uff0c\u62e8\u53f7\u4e4b\u524d\u662f\u6ca1\u6709\u7684 Connection-specific DNS Suffix . : IP Address. . . . . . . . . . . . : 10.67.15.18 Subnet Mask . . . . . . . . . . . : 255.255.255.255 Default Gateway . . . . . . . . . : 10.67.15.18 C:\\Documents and Settings\\Administrator>ping baidu.com #\u62e8\u53f7\u6210\u529f\u540e\uff0c\u53ef\u4ee5\u6b63\u5e38\u4e0a\u7f51 Pinging baidu.com [180.149.132.47] with 32 bytes of data: Reply from 180.149.132.47: bytes=32 time=41ms TTL=54 Ping statistics for 180.149.132.47: Packets: Sent = 1, Received = 1, Lost = 0 (0% loss), Approximate round trip times in milli-seconds: Minimum = 41ms, Maximum = 41ms, Average = 41ms Control-C ^C 4. linux \u5ba2\u6237\u7aef\u6d4b\u8bd5 \u00b6 \u5ba2\u6237\u7aef\u9009\u62e9centos\uff0c\u62e8\u53f7\u4e0a\u7f51\uff0c\u64cd\u4f5c\u8fc7\u7a0b\u5982\u4e0b\uff1a 4.1 \u62e8\u53f7\u4e4b\u524d\u64cd\u4f5c\u68c0\u67e5 \u00b6 [root@mfsdata01 ~]# cat /etc/issue CentOS release 6.8 (Final) Kernel \\r on an \\m [root@mfsdata01 ~]# uname -a Linux mfsdata01 2.6.32-642.6.2.el6.x86_64 #1 SMP Wed Oct 26 06:52:09 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux [root@mfsdata01 ~]# ifconfig eth0 Link encap:Ethernet HWaddr 00:0C:29:F1:FB:05 inet addr:192.168.10.80 Bcast:192.168.10.255 Mask:255.255.255.0 inet6 addr: fe80::20c:29ff:fef1:fb05/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:30766 errors:0 dropped:0 overruns:0 frame:0 TX packets:9953 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:18534315 (17.6 MiB) TX bytes:638381 (623.4 KiB) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:8 errors:0 dropped:0 overruns:0 frame:0 TX packets:8 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:480 (480.0 b) TX bytes:480 (480.0 b) \u6b64\u65f6\u53ea\u53ef\u4ee5ping\u901apppoeserver\u5185\u7f51\u7684\u5730\u5740\uff0c\u5982\u4e0b\uff1a [root@mfsdata01 ~]# ping 192.168.10.109 -c 1 PING 192.168.10.109 (192.168.10.109) 56(84) bytes of data. 64 bytes from 192.168.10.109: icmp_seq=1 ttl=64 time=0.300 ms --- 192.168.10.109 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.300/0.300/0.300/0.000 ms [root@mfsdata01 ~]# ping 192.168.5.1 -c 1 connect: Network is unreachable [root@mfsdata01 ~]# ping baidu.com -c 1 ping: unknown host baidu.com 4.2 \u5efa\u7acbPPPoe\u94fe\u63a5 \u00b6 [root@mfsdata01 ~]# adsl-setup # < \u5efa\u7acbADSL\u8fde\u63a5\u6211\u7684\u662f\u7b2c\u4e8c\u6b21\u91cd\u65b0\u914d\u7f6e Welcome to the PPPoE client setup. First, I will run some checks on your system to make sure the PPPoE client is installed properly... The following DSL config was found on your system: Device: Name: ppp0 DSLppp0 Please enter the device if you want to configure the present DSL config (default ppp0) or enter 'n' if you want to create a new one: n LOGIN NAME Enter your Login Name: cmz #\u8f93\u5165ADSL\u8fde\u63a5\u7684\u7528\u6237\u540d INTERFACE Enter the Ethernet interface connected to the PPPoE modem For Solaris, this is likely to be something like /dev/hme0. For Linux, it will be ethX, where 'X' is a number. (default eth0): #\u6307\u5b9a\u7f51\u7edc\u8bbe\u5907 Do you want the link to come up on demand, or stay up continuously? If you want it to come up on demand, enter the idle time in seconds after which the link should be dropped. If you want the link to stay up permanently, enter 'no' (two letters, lower-case.) NOTE: Demand-activated links do not interact well with dynamic IP addresses. You may have some problems with demand-activated links. Enter the demand value (default no): #\u63a5\u53d7\u9ed8\u8ba4\u8bbe\u7f6e DNS Please enter the IP address of your ISP's primary DNS server. If your ISP claims that 'the server will provide dynamic DNS addresses', enter 'server' (all lower-case) here. #\u8f93\u5165DNS\u5730\u5740\uff0c\u4e0d\u8f93\u5165\u4e0d\u80fd\u89e3\u6790 If you just press enter, I will assume you know what you are doing and not modify your DNS setup. Enter the DNS information here: 114.114.114.114 Please enter the IP address of your ISP's secondary DNS server. If you just press enter, I will assume there is only one DNS server. Enter the secondary DNS server address here: 8.8.8.8 PASSWORD Please enter your Password: #\u6b64\u65f6\u8f93\u5165ADSL\u8d26\u53f7cmz\u5bf9\u5e94\u7684\u5bc6\u7801 \u4e5f\u662fcmz Please re-enter your Password: #\u518d\u8f93\u5165\u4e00\u6b21 USERCTRL Please enter 'yes' (three letters, lower-case.) if you want to allow normal user to start or stop DSL connection (default yes): no #\u586b\u5165NO\uff0c\u4e0d\u5141\u8bb8\u4e00\u822c\u7684\u7528\u6237\u8fde\u63a5PPPoE FIREWALLING Please choose the firewall rules to use. Note that these rules are very basic. You are strongly encouraged to use a more sophisticated firewall setup; however, these will provide basic security. If you are running any servers on your machine, you must choose 'NONE' and set up firewalling yourself. Otherwise, the firewall rules will deny access to all standard servers like Web, e-mail, ftp, etc. If you are using SSH, the rules will block outgoing SSH connections which allocate a privileged source port. The firewall choices are: 0 - NONE: This script will not set any firewall rules. You are responsible for ensuring the security of your machine. You are STRONGLY recommended to use some kind of firewall rules. 1 - STANDALONE: Appropriate for a basic stand-alone web-surfing workstation 2 - MASQUERADE: Appropriate for a machine acting as an Internet gateway for a LAN Choose a type of firewall (0-2): 0 #\u8f93\u51650\uff0c\u4e0d\u5728\u8fd9\u91cc\u8bbe\u7f6e\u9632\u706b\u5899 Start this connection at boot time Do you want to start this connection at boot time? Please enter no or yes (default no):yes #\u586byes,\u7cfb\u7edf\u542f\u52a8\u81ea\u52a8\u8fde\u63a5ADSL ** Summary of what you entered ** Ethernet Interface: eth0 User name: cmz Activate-on-demand: No Primary DNS: 114.114.114.114 Secondary DNS: 8.8.8.8 Firewalling: NONE User Control: no Accept these settings and adjust configuration files (y/n)? y Adjusting /etc/sysconfig/network-scripts/ifcfg-ppp1 Adjusting /etc/resolv.conf (But first backing it up to /etc/resolv.conf.bak) Adjusting /etc/ppp/chap-secrets and /etc/ppp/pap-secrets (But first backing it up to /etc/ppp/chap-secrets.bak) (But first backing it up to /etc/ppp/pap-secrets.bak) Congratulations, it should be all set up! Type '/sbin/ifup ppp1' to bring up your xDSL link and '/sbin/ifdown ppp1' to bring it down. Type '/sbin/pppoe-status /etc/sysconfig/network-scripts/ifcfg-ppp1' to see the link status. [root@mfsdata01 ~]# adsl-start #\u542f\u52a8adsl [root@mfsdata01 ~]# #\u2190 \u7a0d\u7b49\u7247\u523b\u540e\u82e5\u542f\u52a8\u6210\u529f\u540e\u51fa\u73b0\u63d0\u793a\u7b26\uff08\u65e0\u4efb\u4f55\u63d0\u793a\u5373\u610f\u5473\u7740\u8fde\u63a5\u6210\u529f\uff09 \u8fd9\u65f6\uff0c\u901a\u8fc7\u201cifconfig\u201d\u547d\u4ee4\u53ef\u4ee5\u770b\u5230\u5404\u7f51\u7edc\u63a5\u53e3\u7684\u4fe1\u606f\uff08IP\u5730\u5740\u7b49\u7b49\uff09\u3002 [root@mfsdata01 ~]# ifconfig eth0 Link encap:Ethernet HWaddr 00:0C:29:F1:FB:05 inet addr:192.168.10.80 Bcast:192.168.10.255 Mask:255.255.255.0 inet6 addr: fe80::20c:29ff:fef1:fb05/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:31553 errors:0 dropped:0 overruns:0 frame:0 TX packets:10328 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:18597215 (17.7 MiB) TX bytes:688437 (672.3 KiB) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:8 errors:0 dropped:0 overruns:0 frame:0 TX packets:8 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:480 (480.0 b) TX bytes:480 (480.0 b) ppp0 Link encap:Point-to-Point Protocol inet addr:10.67.15.20 P-t-P:192.168.10.109 Mask:255.255.255.255 UP POINTOPOINT RUNNING NOARP MULTICAST MTU:1492 Metric:1 RX packets:3 errors:0 dropped:0 overruns:0 frame:0 TX packets:11 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:3 RX bytes:30 (30.0 b) TX bytes:1086 (1.0 KiB) [root@mfsdata01 ~]# ping baidu.com PING baidu.com (180.149.132.47) 56(84) bytes of data. 64 bytes from 180.149.132.47: icmp_seq=1 ttl=54 time=29.6 ms 64 bytes from 180.149.132.47: icmp_seq=2 ttl=54 time=34.8 ms ^C --- baidu.com ping statistics --- 2 packets transmitted, 2 received, 0% packet loss, time 1630ms rtt min/avg/max/mdev = 29.611/32.248/34.885/2.637 ms","title":"2. PPPOE"},{"location":"linux/server/pppoe/pppoe.index/#pppoe","text":"","title":"PPPOE\u670d\u52a1\u5668"},{"location":"linux/server/pppoe/pppoe.index/#1","text":"\u670d\u52a1\u5668\u7684ip\u89c4\u5212 \u89d2\u8272 IP \u7f51\u5173 \u7cfb\u7edf PPPOE server 192.168.10.109 \u5185\u7f51 192.168.5.109 \u5916\u7f51 192.168.5.1 Linux Centos 6.8 x64 PPPOE Client 192.168.10.90 \u5185\u7f51 Xp sp3 x86 PPPOE Client 192.168.10.80 \u5185\u7f51 Centos 68 x64","title":"1. \u7cfb\u7edf\u90e8\u7f72\u57fa\u7840"},{"location":"linux/server/pppoe/pppoe.index/#2","text":"","title":"2. \u670d\u52a1\u7aef\u642d\u5efa"},{"location":"linux/server/pppoe/pppoe.index/#21","text":"\u67e5\u770b\u662f\u5426\u5b89\u88c5\u6240\u9700\u8981\u7684\u5305\u3002 [root@mfsdata02 ppp]# rpm -qa |grep rp-pppoe rp-pppoe-3.10-16.el6.x86_64 \u6ca1\u6709\u8bdd\u5c31\u5b89\u88c5 yum install rp-pppoe","title":"2.1 \u5b89\u88c5"},{"location":"linux/server/pppoe/pppoe.index/#22","text":"\u914d\u7f6e\u6587\u4ef6\u76ee\u5f55\u5728/etc/ppp\u4e0b [root@mfsdata02 ~]# cd /etc/ppp/ [root@mfsdata02 ppp]# cp chap-secrets chap-secrets.ori [root@mfsdata02 ppp]# cp pppoe-server-options pppoe-server-options.ori [root@mfsdata02 ppp]# ll total 64 -rw------- 1 root root 189 Jan 16 19:09 chap-secrets -rw------- 1 root root 78 Jan 16 18:33 chap-secrets.ori -rwxr-xr-x. 1 root root 2276 May 11 2016 firewall-masq -rwxr-xr-x. 1 root root 978 May 11 2016 firewall-standalone -rwxr-xr-x. 1 root root 386 Apr 12 2016 ip-down -rwxr-xr-x. 1 root root 3262 Apr 12 2016 ip-down.ipv6to4 -rwxr-xr-x. 1 root root 430 Apr 12 2016 ip-up -rwxr-xr-x. 1 root root 6517 Apr 12 2016 ip-up.ipv6to4 -rwxr-xr-x. 1 root root 1687 Apr 12 2016 ipv6-down -rwxr-xr-x. 1 root root 3196 Apr 12 2016 ipv6-up -rw-r--r--. 1 root root 5 Mar 16 2015 options -rw-------. 1 root root 77 Mar 16 2015 pap-secrets drwxr-xr-x. 2 root root 4096 Jul 13 2016 peers -rw-r--r-- 1 root root 140 Jan 16 18:33 pppoe-server-options -rw-r--r-- 1 root root 104 Jan 16 18:32 pppoe-server-options.ori \u5907\u4efd pppoe-server-options.ori \u662f\u6211\u624b\u52a8\u5907\u4efd\u7684\u6587\u4ef6\uff0c\u4e3b\u8981\u4fee\u6539\u8fd9\u4e24\u4e2a\u914d\u7f6e\u6587\u4ef6","title":"2.2 \u67e5\u770b\u914d\u7f6e\u6587\u4ef6"},{"location":"linux/server/pppoe/pppoe.index/#23","text":"\u914d\u7f6e\u6587\u4ef6pppoe-server-options\u4fee\u6539\u5982\u4e0b # PPP options for the PPPoE server # LIC: GPL #require-pap require-chap #\u9a8c\u8bc1\u65b9\u5f0f,\u5982\u679c\u9009pap\u7684\u8bdd\uff0c\u5c31\u5230pap-secrets\u6587\u4ef6\u4e2d\u589e\u52a0\u7528\u6237 login lcp-echo-interval 10 lcp-echo-failure 2 ms-dns 202.106.0.20 ms-dns 8.8.8.8","title":"2.3 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},{"location":"linux/server/pppoe/pppoe.index/#24","text":"\u6dfb\u52a0\u7528\u6237\uff0c\u8bbe\u7f6e\u8d26\u6237\u548c\u5bc6\u7801 [root@mfsdata02 ppp]# cat chap-secrets # Secrets for authentication using CHAP # client server secret IP addresses cmz * cmz * cmz2 * cmz2 192.168.10.3 #\u53ef\u4ee5\u6307\u5b9a\u5ba2\u6237\u7aef\u7684\u5730\u5740\u4e5f\u53ef\u4ee5\u4e0d\u6307\u5b9a","title":"2.4 \u6dfb\u52a0\u8d26\u53f7\u4fe1\u606f"},{"location":"linux/server/pppoe/pppoe.index/#25-ip","text":"[root@mfsdata02 ppp]# sed -i \"s#net.ipv4.ip_forward = 0#net.ipv4.ip_forward = 1#g\" /etc/sysctl.conf [root@mfsdata02 ppp]# sysctl -p net.ipv4.ip_forward = 1","title":"2.5 \u5f00\u542f\u5185\u6838ip\u8f6c\u53d1"},{"location":"linux/server/pppoe/pppoe.index/#26","text":"\u9632\u706b\u5899\u8bbe\u7f6e\uff0c\u8bbe\u7f6e\u5c40\u57df\u7f51\u5185\u673a\u5668\u5171\u4eab\u4e0a\u7f51 [root@mfsdata02 ppp]# iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE [root@mfsdata02 ppp]# iptables -t nat -nL Chain PREROUTING (policy ACCEPT) target prot opt source destination Chain POSTROUTING (policy ACCEPT) target prot opt source destination MASQUERADE all -- 0.0.0.0/0 0.0.0.0/0 Chain OUTPUT (policy ACCEPT) target prot opt source destination eth0\u4e3a\u51fa\u53e3\u7684\u7f51\u5361\uff0c\u5c31\u662f\u53ef\u4ee5\u548c\u5916\u7f51\u8fde\u901a\u7684\u90a3\u5757\u3002\u5230\u73b0\u5728\u8fd9\u4e2apppoe\u670d\u52a1\u5668\u5c31\u53ef\u4ee5\u5de5\u4f5c\u4e86\u3002","title":"2.6 \u9632\u706b\u5899\u914d\u7f6e"},{"location":"linux/server/pppoe/pppoe.index/#27","text":"\u542f\u52a8pppoe\u670d\u52a1 [root@mfsdata02 ppp]# pppoe-server -I eth1 -L 192.168.10.109 -R 192.168.10.2 -N 20 \u53c2\u6570\u89e3\u91ca I\uff1a\u6307\u5b9a\u54cd\u5e94PPPOE\u8bf7\u6c42\u7684\u7aef\u53e3\uff0c\u73b0\u5728\u4f7f\u7528\u7684eth1\uff0c\u4e5f\u5c31\u662f\u5185\u7f51\u7684\u3002 L\uff1aPPPOE\u670d\u52a1\u5668\u7684IP\u5730\u5740\uff0c\u5ba2\u6237\u7aef\u8fde\u63a5\u53ef\u4ee5\u770b\u5230\u7684\u670d\u52a1\u5668\u5730\u5740\uff0c\u53ef\u4ee5\u662f\u4efb\u610f\u4e5f\u5c31\u662fpppoe\u5ba2\u6237\u7aef\u7684\u865a\u62df\u7f51\u5173\u3002 \uff08\u6ce8\u610f\uff1a\u6b64IP\u5730\u5740\u53ef\u4ee5\u4e0d\u662f\u7f51\u5361\u7684IP\u5730\u5740\uff0c\u800c\u662fPPPOE\u670d\u52a1\u5668\u7684\u865a\u62dfIP\uff0c\u6211\u4f7f\u7528\u4e86\u672c\u5730\u7684ip) R\uff1a\u8fd9\u662f\u5206\u914d\u7ed9\u5ba2\u6237\u7aef\u7684\u5730\u5740\u6c60\u8d77\u59cb\u5730\u5740\uff0c\u672c\u4f8b\u4e2d\u4ece192.168.10.2\u5f00\u59cb N\uff1a\u5730\u5740\u6c60\u7684IP\u5730\u5740\u9012\u589e\u51e0\u4e2a\uff0c\u672c\u4f8b\u4e2d\u6dfb\u589e10\uff0c\u4e5f\u5c31\u662f\u4ece192.168.10.2\u5f00\u59cb\u5206\u914d\uff0c\u4e00\u5171\u5206\u914d20\u4e2aIP\u5730\u5740","title":"2.7 \u542f\u52a8"},{"location":"linux/server/pppoe/pppoe.index/#28","text":"[root@mfsdata02 ppp]# echo \"pppoe-server -I eth1 -L 192.168.10.109 -R 192.168.10.2 -N 20\" >> /etc/rc.d/rc.local \u5ba2\u6237\u7aef\u8fde\u63a5\u4e4b\u540e\u6b64\u65f6\u5728\u670d\u52a1\u7aef\u80fd\u770b\u5230\u4e00\u4e2apppo\u7684\u7f51\u7edc\u4fe1\u606f\u3002\u6ce8\u610f\u4e00\u5b9a\u8981\u662f\u5728\u5ba2\u6237\u7aef\u8fde\u63a5\u4e4b\u540e\u624d\u80fd\u770b\u5230\u8be5\u4fe1\u606f\u3002 [root@mfsdata02 ppp]# ifconfig eth0 Link encap:Ethernet HWaddr 00:0C:29:87:F2:BF inet addr:192.168.5.109 Bcast:192.168.5.255 Mask:255.255.255.0 inet6 addr: fe80::20c:29ff:fe87:f2bf/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:15648 errors:0 dropped:0 overruns:0 frame:0 TX packets:10539 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:16369623 (15.6 MiB) TX bytes:982976 (959.9 KiB) eth1 Link encap:Ethernet HWaddr 00:0C:29:87:F2:C9 inet addr:192.168.10.109 Bcast:192.168.10.255 Mask:255.255.255.0 inet6 addr: fe80::20c:29ff:fe87:f2c9/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:6002 errors:0 dropped:0 overruns:0 frame:0 TX packets:814 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:453691 (443.0 KiB) TX bytes:60473 (59.0 KiB) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:23 errors:0 dropped:0 overruns:0 frame:0 TX packets:23 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:2160 (2.1 KiB) TX bytes:2160 (2.1 KiB) ppp0 Link encap:Point-to-Point Protocol inet addr:192.168.10.109 P-t-P:192.168.1.3 Mask:255.255.255.255 UP POINTOPOINT RUNNING NOARP MULTICAST MTU:1480 Metric:1 RX packets:2184 errors:0 dropped:0 overruns:0 frame:0 TX packets:471 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:3 RX bytes:130073 (127.0 KiB) TX bytes:28127 (27.4 KiB)","title":"2.8 \u914d\u7f6e\u81ea\u542f\u52a8"},{"location":"linux/server/pppoe/pppoe.index/#3-windows","text":"\u627e\u5176\u4ed6\u673a\u5668\u6d4b\u8bd5","title":"3. windows \u5ba2\u6237\u7aef\u6d4b\u8bd5"},{"location":"linux/server/pppoe/pppoe.index/#31","text":"\u5ba2\u6237\u7aef\u62e8\u53f7\u6d41\u7a0b","title":"3.1 \u62e8\u53f7\u4e4b\u524d\u68c0\u67e5"},{"location":"linux/server/pppoe/pppoe.index/#32","text":"\u9009\u62e9\u5ba2\u6237\u7aef\u62e8\u53f7\u767b\u5f55\u6d4b\u8bd5","title":"3.2 \u62e8\u53f7"},{"location":"linux/server/pppoe/pppoe.index/#33","text":"\u4ee5\u4e0b\u662fdos\u547d\u4ee4\u884c\uff0c\u8be6\u7ec6\u6d4b\u8bd5\u8fc7\u7a0b\uff1a \u6ca1\u6709\u62e8\u53f7\u4e4b\u524d\u64cd\u4f5c Microsoft Windows XP [\u7248\u672c 5.1.2600] (C) \u7248\u6743\u6240\u6709 1985-2001 Microsoft Corp. C:\\Documents and Settings\\Administrator>ipconfig Windows IP Configuration Ethernet adapter \u672c\u5730\u8fde\u63a5: Connection-specific DNS Suffix . : IP Address. . . . . . . . . . . . : 192.168.10.90 #\u672c\u5730\u5c31\u662f\u4e4b\u524d\u5185\u7f51\u7684\u5730\u5740 Subnet Mask . . . . . . . . . . . : 255.255.255.0 Default Gateway . . . . . . . . . : C:\\Documents and Settings\\Administrator>ping 192.168.10.109 #\u53ef\u4ee5ping\u901apppoe\u670d\u52a1\u5668\u7aef\u5185\u7f51\u7684\u5730\u5740 Pinging 192.168.10.109 with 32 bytes of data: Reply from 192.168.10.109: bytes=32 time<1ms TTL=64 Reply from 192.168.10.109: bytes=32 time<1ms TTL=64 Ping statistics for 192.168.10.109: Packets: Sent = 2, Received = 2, Lost = 0 (0% loss), Approximate round trip times in milli-seconds: Minimum = 0ms, Maximum = 0ms, Average = 0ms Control-C ^C C:\\Documents and Settings\\Administrator>ping 192.168.5.1 #\u867d\u7136\u80fdping\u901apppoe\u5185\u7f51\u5730\u5740\u4f46\u662fping\u4e0d\u540cpppoe\u670d\u52a1\u7aef\u5916\u7f51\u5730\u5740\u7f51\u5173\u5730\u5740\uff0c\u6b64\u65f6\u8fd8\u6ca1\u6709\u62e8\u53f7 Pinging 192.168.5.1 with 32 bytes of data: Destination host unreachable. Destination host unreachable. Ping statistics for 192.168.5.1: Packets: Sent = 2, Received = 0, Lost = 2 (100% loss), Control-C ^C \u6ca1\u6709\u62e8\u53f7\u4e4b\u540e\u64cd\u4f5c C:\\Documents and Settings\\Administrator>ping 192.168.5.1 Pinging 192.168.5.1 with 32 bytes of data: Reply from 192.168.5.1: bytes=32 time=8ms TTL=127 Reply from 192.168.5.1: bytes=32 time=15ms TTL=127 Ping statistics for 192.168.5.1: Packets: Sent = 2, Received = 2, Lost = 0 (0% loss), Approximate round trip times in milli-seconds: Minimum = 8ms, Maximum = 15ms, Average = 11ms Control-C ^C C:\\Documents and Settings\\Administrator>ping 192.168.10.109 Pinging 192.168.10.109 with 32 bytes of data: Reply from 192.168.10.109: bytes=32 time=3ms TTL=64 Reply from 192.168.10.109: bytes=32 time=14ms TTL=64 Ping statistics for 192.168.10.109: Packets: Sent = 2, Received = 2, Lost = 0 (0% loss), Approximate round trip times in milli-seconds: Minimum = 3ms, Maximum = 14ms, Average = 8ms Control-C ^C C:\\Documents and Settings\\Administrator>ipconfig Windows IP Configuration Ethernet adapter \u672c\u5730\u8fde\u63a5: Connection-specific DNS Suffix . : IP Address. . . . . . . . . . . . : 192.168.10.90 Subnet Mask . . . . . . . . . . . : 255.255.255.0 Default Gateway . . . . . . . . . : PPP adapter \u5bbd\u5e26\u8fde\u63a5: #\u62e8\u53f7\u6210\u529f\u540e\u5c31\u4f1a\u53d1\u73b0\u6709\u4e2appp\u5ba2\u6237\u7aef\u4ea7\u751f\uff0c\u62e8\u53f7\u4e4b\u524d\u662f\u6ca1\u6709\u7684 Connection-specific DNS Suffix . : IP Address. . . . . . . . . . . . : 10.67.15.18 Subnet Mask . . . . . . . . . . . : 255.255.255.255 Default Gateway . . . . . . . . . : 10.67.15.18 C:\\Documents and Settings\\Administrator>ping baidu.com #\u62e8\u53f7\u6210\u529f\u540e\uff0c\u53ef\u4ee5\u6b63\u5e38\u4e0a\u7f51 Pinging baidu.com [180.149.132.47] with 32 bytes of data: Reply from 180.149.132.47: bytes=32 time=41ms TTL=54 Ping statistics for 180.149.132.47: Packets: Sent = 1, Received = 1, Lost = 0 (0% loss), Approximate round trip times in milli-seconds: Minimum = 41ms, Maximum = 41ms, Average = 41ms Control-C ^C","title":"3.3 \u62e8\u53f7\u540e\u68c0\u67e5"},{"location":"linux/server/pppoe/pppoe.index/#4-linux","text":"\u5ba2\u6237\u7aef\u9009\u62e9centos\uff0c\u62e8\u53f7\u4e0a\u7f51\uff0c\u64cd\u4f5c\u8fc7\u7a0b\u5982\u4e0b\uff1a","title":"4. linux \u5ba2\u6237\u7aef\u6d4b\u8bd5"},{"location":"linux/server/pppoe/pppoe.index/#41","text":"[root@mfsdata01 ~]# cat /etc/issue CentOS release 6.8 (Final) Kernel \\r on an \\m [root@mfsdata01 ~]# uname -a Linux mfsdata01 2.6.32-642.6.2.el6.x86_64 #1 SMP Wed Oct 26 06:52:09 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux [root@mfsdata01 ~]# ifconfig eth0 Link encap:Ethernet HWaddr 00:0C:29:F1:FB:05 inet addr:192.168.10.80 Bcast:192.168.10.255 Mask:255.255.255.0 inet6 addr: fe80::20c:29ff:fef1:fb05/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:30766 errors:0 dropped:0 overruns:0 frame:0 TX packets:9953 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:18534315 (17.6 MiB) TX bytes:638381 (623.4 KiB) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:8 errors:0 dropped:0 overruns:0 frame:0 TX packets:8 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:480 (480.0 b) TX bytes:480 (480.0 b) \u6b64\u65f6\u53ea\u53ef\u4ee5ping\u901apppoeserver\u5185\u7f51\u7684\u5730\u5740\uff0c\u5982\u4e0b\uff1a [root@mfsdata01 ~]# ping 192.168.10.109 -c 1 PING 192.168.10.109 (192.168.10.109) 56(84) bytes of data. 64 bytes from 192.168.10.109: icmp_seq=1 ttl=64 time=0.300 ms --- 192.168.10.109 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.300/0.300/0.300/0.000 ms [root@mfsdata01 ~]# ping 192.168.5.1 -c 1 connect: Network is unreachable [root@mfsdata01 ~]# ping baidu.com -c 1 ping: unknown host baidu.com","title":"4.1 \u62e8\u53f7\u4e4b\u524d\u64cd\u4f5c\u68c0\u67e5"},{"location":"linux/server/pppoe/pppoe.index/#42-pppoe","text":"[root@mfsdata01 ~]# adsl-setup # < \u5efa\u7acbADSL\u8fde\u63a5\u6211\u7684\u662f\u7b2c\u4e8c\u6b21\u91cd\u65b0\u914d\u7f6e Welcome to the PPPoE client setup. First, I will run some checks on your system to make sure the PPPoE client is installed properly... The following DSL config was found on your system: Device: Name: ppp0 DSLppp0 Please enter the device if you want to configure the present DSL config (default ppp0) or enter 'n' if you want to create a new one: n LOGIN NAME Enter your Login Name: cmz #\u8f93\u5165ADSL\u8fde\u63a5\u7684\u7528\u6237\u540d INTERFACE Enter the Ethernet interface connected to the PPPoE modem For Solaris, this is likely to be something like /dev/hme0. For Linux, it will be ethX, where 'X' is a number. (default eth0): #\u6307\u5b9a\u7f51\u7edc\u8bbe\u5907 Do you want the link to come up on demand, or stay up continuously? If you want it to come up on demand, enter the idle time in seconds after which the link should be dropped. If you want the link to stay up permanently, enter 'no' (two letters, lower-case.) NOTE: Demand-activated links do not interact well with dynamic IP addresses. You may have some problems with demand-activated links. Enter the demand value (default no): #\u63a5\u53d7\u9ed8\u8ba4\u8bbe\u7f6e DNS Please enter the IP address of your ISP's primary DNS server. If your ISP claims that 'the server will provide dynamic DNS addresses', enter 'server' (all lower-case) here. #\u8f93\u5165DNS\u5730\u5740\uff0c\u4e0d\u8f93\u5165\u4e0d\u80fd\u89e3\u6790 If you just press enter, I will assume you know what you are doing and not modify your DNS setup. Enter the DNS information here: 114.114.114.114 Please enter the IP address of your ISP's secondary DNS server. If you just press enter, I will assume there is only one DNS server. Enter the secondary DNS server address here: 8.8.8.8 PASSWORD Please enter your Password: #\u6b64\u65f6\u8f93\u5165ADSL\u8d26\u53f7cmz\u5bf9\u5e94\u7684\u5bc6\u7801 \u4e5f\u662fcmz Please re-enter your Password: #\u518d\u8f93\u5165\u4e00\u6b21 USERCTRL Please enter 'yes' (three letters, lower-case.) if you want to allow normal user to start or stop DSL connection (default yes): no #\u586b\u5165NO\uff0c\u4e0d\u5141\u8bb8\u4e00\u822c\u7684\u7528\u6237\u8fde\u63a5PPPoE FIREWALLING Please choose the firewall rules to use. Note that these rules are very basic. You are strongly encouraged to use a more sophisticated firewall setup; however, these will provide basic security. If you are running any servers on your machine, you must choose 'NONE' and set up firewalling yourself. Otherwise, the firewall rules will deny access to all standard servers like Web, e-mail, ftp, etc. If you are using SSH, the rules will block outgoing SSH connections which allocate a privileged source port. The firewall choices are: 0 - NONE: This script will not set any firewall rules. You are responsible for ensuring the security of your machine. You are STRONGLY recommended to use some kind of firewall rules. 1 - STANDALONE: Appropriate for a basic stand-alone web-surfing workstation 2 - MASQUERADE: Appropriate for a machine acting as an Internet gateway for a LAN Choose a type of firewall (0-2): 0 #\u8f93\u51650\uff0c\u4e0d\u5728\u8fd9\u91cc\u8bbe\u7f6e\u9632\u706b\u5899 Start this connection at boot time Do you want to start this connection at boot time? Please enter no or yes (default no):yes #\u586byes,\u7cfb\u7edf\u542f\u52a8\u81ea\u52a8\u8fde\u63a5ADSL ** Summary of what you entered ** Ethernet Interface: eth0 User name: cmz Activate-on-demand: No Primary DNS: 114.114.114.114 Secondary DNS: 8.8.8.8 Firewalling: NONE User Control: no Accept these settings and adjust configuration files (y/n)? y Adjusting /etc/sysconfig/network-scripts/ifcfg-ppp1 Adjusting /etc/resolv.conf (But first backing it up to /etc/resolv.conf.bak) Adjusting /etc/ppp/chap-secrets and /etc/ppp/pap-secrets (But first backing it up to /etc/ppp/chap-secrets.bak) (But first backing it up to /etc/ppp/pap-secrets.bak) Congratulations, it should be all set up! Type '/sbin/ifup ppp1' to bring up your xDSL link and '/sbin/ifdown ppp1' to bring it down. Type '/sbin/pppoe-status /etc/sysconfig/network-scripts/ifcfg-ppp1' to see the link status. [root@mfsdata01 ~]# adsl-start #\u542f\u52a8adsl [root@mfsdata01 ~]# #\u2190 \u7a0d\u7b49\u7247\u523b\u540e\u82e5\u542f\u52a8\u6210\u529f\u540e\u51fa\u73b0\u63d0\u793a\u7b26\uff08\u65e0\u4efb\u4f55\u63d0\u793a\u5373\u610f\u5473\u7740\u8fde\u63a5\u6210\u529f\uff09 \u8fd9\u65f6\uff0c\u901a\u8fc7\u201cifconfig\u201d\u547d\u4ee4\u53ef\u4ee5\u770b\u5230\u5404\u7f51\u7edc\u63a5\u53e3\u7684\u4fe1\u606f\uff08IP\u5730\u5740\u7b49\u7b49\uff09\u3002 [root@mfsdata01 ~]# ifconfig eth0 Link encap:Ethernet HWaddr 00:0C:29:F1:FB:05 inet addr:192.168.10.80 Bcast:192.168.10.255 Mask:255.255.255.0 inet6 addr: fe80::20c:29ff:fef1:fb05/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:31553 errors:0 dropped:0 overruns:0 frame:0 TX packets:10328 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:18597215 (17.7 MiB) TX bytes:688437 (672.3 KiB) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:8 errors:0 dropped:0 overruns:0 frame:0 TX packets:8 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:480 (480.0 b) TX bytes:480 (480.0 b) ppp0 Link encap:Point-to-Point Protocol inet addr:10.67.15.20 P-t-P:192.168.10.109 Mask:255.255.255.255 UP POINTOPOINT RUNNING NOARP MULTICAST MTU:1492 Metric:1 RX packets:3 errors:0 dropped:0 overruns:0 frame:0 TX packets:11 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:3 RX bytes:30 (30.0 b) TX bytes:1086 (1.0 KiB) [root@mfsdata01 ~]# ping baidu.com PING baidu.com (180.149.132.47) 56(84) bytes of data. 64 bytes from 180.149.132.47: icmp_seq=1 ttl=54 time=29.6 ms 64 bytes from 180.149.132.47: icmp_seq=2 ttl=54 time=34.8 ms ^C --- baidu.com ping statistics --- 2 packets transmitted, 2 received, 0% packet loss, time 1630ms rtt min/avg/max/mdev = 29.611/32.248/34.885/2.637 ms","title":"4.2 \u5efa\u7acbPPPoe\u94fe\u63a5"},{"location":"linux/server/sersync/sersync/","text":"Sersync\u6570\u636e\u540c\u6b65 \u4e00.rsync\u4ecb\u7ecd \u00b6 rsync\u662f\u7c7bunix\u7cfb\u7edf\u4e0b\u7684\u6570\u636e\u955c\u50cf\u5907\u4efd\u5de5\u5177\u2014\u2014remote sync\u3002\u4e00\u6b3e\u5feb\u901f\u589e\u91cf\u5907\u4efd\u5de5\u5177 Remote Sync\uff0c\u8fdc\u7a0b\u540c\u6b65\u652f\u6301\u672c\u5730\u590d\u5236\uff0c\u6216\u8005\u4e0e\u5176\u4ed6SSH\u3001rsync\u4e3b\u673a\u540c\u6b65\u3002 \u5b83\u7684\u7279\u6027\u5982\u4e0b\uff1a \u53ef\u4ee5\u955c\u50cf\u4fdd\u5b58\u6574\u4e2a\u76ee\u5f55\u6811\u548c\u6587\u4ef6\u7cfb\u7edf\u3002 \u53ef\u4ee5\u5f88\u5bb9\u6613\u505a\u5230\u4fdd\u6301\u539f\u6765\u6587\u4ef6\u7684\u6743\u9650\u3001\u65f6\u95f4\u3001\u8f6f\u786c\u94fe\u63a5\u7b49\u7b49\u3002 \u65e0\u987b\u7279\u6b8a\u6743\u9650\u5373\u53ef\u5b89\u88c5\u3002 \u5feb\u901f\uff1a\u7b2c\u4e00\u6b21\u540c\u6b65\u65f6 rsync \u4f1a\u590d\u5236\u5168\u90e8\u5185\u5bb9\uff0c\u4f46\u5728\u4e0b\u4e00\u6b21\u53ea\u4f20\u8f93\u4fee\u6539\u8fc7\u7684\u6587\u4ef6\u3002rsync \u5728\u4f20\u8f93\u6570\u636e\u7684\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u5b9e\u884c\u538b\u7f29\u53ca\u89e3\u538b\u7f29\u64cd\u4f5c\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528\u66f4\u5c11\u7684\u5e26\u5bbd\u3002 \u5b89\u5168\uff1a\u53ef\u4ee5\u4f7f\u7528scp\u3001ssh\u7b49\u65b9\u5f0f\u6765\u4f20\u8f93\u6587\u4ef6\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u901a\u8fc7\u76f4\u63a5\u7684socket\u8fde\u63a5\u3002 \u652f\u6301\u533f\u540d\u4f20\u8f93\uff0c\u4ee5\u65b9\u4fbf\u8fdb\u884c\u7f51\u7ad9\u955c\u8c61\u3002 IP \u89d2\u8272 \u5b89\u88c5\u8f6f\u4ef6 \u76ee\u5f55 \u76ee\u7684 192.168.91.166 Rsync \u670d\u52a1\u7aef rsync /data \u5c06192.168.91.156 rsync \u5ba2\u6237\u7aef\u4e0a\u7684/data\u4e0b\u76ee\u5f55\u5b9e\u65f6\u63a8\u9001\u5230192.168.91.166 rsync\u670d\u52a1\u5668\u7aef/data\u4e0b 192.168.91.156 Rsync \u5ba2\u6237\u7aef serync /data \u4e8c.rsync\u7684\u5b89\u88c5 \u00b6 yum install -y rsync \u4e09.rsync\u901a\u8fc7ssh\u8ba4\u8bc1\u4f20\u8f93 \u00b6 3.1\u5c06\u6570\u636e\u53d1\u9001\u5230\u8fdc\u7aef \u00b6 rsync -avz -P \u672c\u5730\u76ee\u5f55 -e 'ssh -p \u7aef\u53e3\u53f7' \u8fdc\u7aef\u7528\u6237\u540d@\u8fdc\u7aefIP:\u8fdc\u7aef\u8def\u5f84 root@template /tmp 16:33:07 # cat rsync.txt \u6211\u662frsync\u6d4b\u8bd5 root@template /tmp 16:34:02 # rsync -avzP /tmp/rsync.txt -e 'ssh -p 22' root@192.168.44.100:/tmp The authenticity of host '192.168.44.100(192.168.44.100)' can't be established. RSA key fingerprint is57:22:33:d6:43:40:31:84:88:19:5d:f5:fc:7d:4e:ce. Are you sure you want to continue connecting(yes/no)? yes Warning: Permanently added '192.168.44.100' (RSA) tothe list of known hosts. reverse mapping checking getaddrinfo for bogon[192.168.44.100] failed - POSSIBLE BREAK-IN ATTEMPT! root@192.168.44.100's password: sending incremental file list rsync.txt 18100% 0.00kB/s 0:00:00 (xfer#1, to-check=0/1) sent 93 bytes received 31 bytes 13.05 bytes/sec total size is 18 speedup is 0.15 \u8be6\u7ec6\u53c2\u6570\uff1a -v, --verbose \u8be6\u7ec6\u6a21\u5f0f\u8f93\u51fa -q, --quiet \u7cbe\u7b80\u8f93\u51fa\u6a21\u5f0f -c, --checksum \u6253\u5f00\u6821\u9a8c\u5f00\u5173\uff0c\u5f3a\u5236\u5bf9\u6587\u4ef6\u4f20\u8f93\u8fdb\u884c\u6821\u9a8c -a, --archive \u5f52\u6863\u6a21\u5f0f\uff0c\u8868\u793a\u4ee5\u9012\u5f52\u65b9\u5f0f\u4f20\u8f93\u6587\u4ef6\uff0c\u5e76\u4fdd\u6301\u6240\u6709\u6587\u4ef6\u5c5e\u6027\uff0c\u7b49\u4e8e-rlptgoD -r, --recursive \u5bf9\u5b50\u76ee\u5f55\u4ee5\u9012\u5f52\u6a21\u5f0f\u5904\u7406 -R, --relative \u4f7f\u7528\u76f8\u5bf9\u8def\u5f84\u4fe1\u606f -b, --backup \u521b\u5efa\u5907\u4efd\uff0c\u4e5f\u5c31\u662f\u5bf9\u4e8e\u76ee\u7684\u5df2\u7ecf\u5b58\u5728\u6709\u540c\u6837\u7684\u6587\u4ef6\u540d\u65f6\uff0c\u5c06\u8001\u7684\u6587\u4ef6\u91cd\u65b0\u547d\u540d\u4e3a~filename\u3002\u53ef\u4ee5\u4f7f\u7528--suffix\u9009\u9879\u6765\u6307\u5b9a\u4e0d\u540c\u7684\u5907\u4efd\u6587\u4ef6\u524d\u7f00\u3002 --backup-dir \u5c06\u5907\u4efd\u6587\u4ef6(\u5982~filename)\u5b58\u653e\u5728\u5728\u76ee\u5f55\u4e0b\u3002 -suffix=SUFFIX \u5b9a\u4e49\u5907\u4efd\u6587\u4ef6\u524d\u7f00 -u, --update \u4ec5\u4ec5\u8fdb\u884c\u66f4\u65b0\uff0c\u4e5f\u5c31\u662f\u8df3\u8fc7\u6240\u6709\u5df2\u7ecf\u5b58\u5728\u4e8eDST\uff0c\u5e76\u4e14\u6587\u4ef6\u65f6\u95f4\u665a\u4e8e\u8981\u5907\u4efd\u7684\u6587\u4ef6\u3002(\u4e0d\u8986\u76d6\u66f4\u65b0\u7684\u6587\u4ef6) -l, --links \u4fdd\u7559\u8f6f\u94fe\u7ed3 -L, --copy-links \u60f3\u5bf9\u5f85\u5e38\u89c4\u6587\u4ef6\u4e00\u6837\u5904\u7406\u8f6f\u94fe\u7ed3 --copy-unsafe-links \u4ec5\u4ec5\u62f7\u8d1d\u6307\u5411SRC\u8def\u5f84\u76ee\u5f55\u6811\u4ee5\u5916\u7684\u94fe\u7ed3 --safe-links \u5ffd\u7565\u6307\u5411SRC\u8def\u5f84\u76ee\u5f55\u6811\u4ee5\u5916\u7684\u94fe\u7ed3 -H, --hard-links \u4fdd\u7559\u786c\u94fe\u7ed3 -p, --perms \u4fdd\u6301\u6587\u4ef6\u6743\u9650 -o, --owner \u4fdd\u6301\u6587\u4ef6\u5c5e\u4e3b\u4fe1\u606f -g, --group \u4fdd\u6301\u6587\u4ef6\u5c5e\u7ec4\u4fe1\u606f -D, --devices \u4fdd\u6301\u8bbe\u5907\u6587\u4ef6\u4fe1\u606f -t, --times \u4fdd\u6301\u6587\u4ef6\u65f6\u95f4\u4fe1\u606f -S, --sparse \u5bf9\u7a00\u758f\u6587\u4ef6\u8fdb\u884c\u7279\u6b8a\u5904\u7406\u4ee5\u8282\u7701DST\u7684\u7a7a\u95f4 -n, --dry-run\u73b0\u5b9e\u54ea\u4e9b\u6587\u4ef6\u5c06\u88ab\u4f20\u8f93 -W, --whole-file \u62f7\u8d1d\u6587\u4ef6\uff0c\u4e0d\u8fdb\u884c\u589e\u91cf\u68c0\u6d4b -x, --one-file-system \u4e0d\u8981\u8de8\u8d8a\u6587\u4ef6\u7cfb\u7edf\u8fb9\u754c -B, --block-size=SIZE \u68c0\u9a8c\u7b97\u6cd5\u4f7f\u7528\u7684\u5757\u5c3a\u5bf8\uff0c\u9ed8\u8ba4\u662f700\u5b57\u8282 -e, --rsh=COMMAND \u6307\u5b9a\u4f7f\u7528rsh\u3001ssh\u65b9\u5f0f\u8fdb\u884c\u6570\u636e\u540c\u6b65 --rsync-path=PATH \u6307\u5b9a\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u7684rsync\u547d\u4ee4\u6240\u5728\u8def\u5f84\u4fe1\u606f -C, --cvs-exclude \u4f7f\u7528\u548cCVS\u4e00\u6837\u7684\u65b9\u6cd5\u81ea\u52a8\u5ffd\u7565\u6587\u4ef6\uff0c\u7528\u6765\u6392\u9664\u90a3\u4e9b\u4e0d\u5e0c\u671b\u4f20\u8f93\u7684\u6587\u4ef6 --existing \u4ec5\u4ec5\u66f4\u65b0\u90a3\u4e9b\u5df2\u7ecf\u5b58\u5728\u4e8eDST\u7684\u6587\u4ef6\uff0c\u800c\u4e0d\u5907\u4efd\u90a3\u4e9b\u65b0\u521b\u5efa\u7684\u6587\u4ef6 --delete \u5220\u9664\u90a3\u4e9bDST\u4e2dSRC\u6ca1\u6709\u7684\u6587\u4ef6 --delete-excluded \u540c\u6837\u5220\u9664\u63a5\u6536\u7aef\u90a3\u4e9b\u88ab\u8be5\u9009\u9879\u6307\u5b9a\u6392\u9664\u7684\u6587\u4ef6 --delete-after \u4f20\u8f93\u7ed3\u675f\u4ee5\u540e\u518d\u5220\u9664 --ignore-errors \u53ca\u65f6\u51fa\u73b0IO\u9519\u8bef\u4e5f\u8fdb\u884c\u5220\u9664 --max-delete=NUM \u6700\u591a\u5220\u9664NUM\u4e2a\u6587\u4ef6 --partial \u4fdd\u7559\u90a3\u4e9b\u56e0\u6545\u6ca1\u6709\u5b8c\u5168\u4f20\u8f93\u7684\u6587\u4ef6\uff0c\u4ee5\u662f\u52a0\u5feb\u968f\u540e\u7684\u518d\u6b21\u4f20\u8f93 --force \u5f3a\u5236\u5220\u9664\u76ee\u5f55\uff0c\u5373\u4f7f\u4e0d\u4e3a\u7a7a --numeric-ids \u4e0d\u5c06\u6570\u5b57\u7684\u7528\u6237\u548c\u7ec4ID\u5339\u914d\u4e3a\u7528\u6237\u540d\u548c\u7ec4\u540d --timeout=TIME IP\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2 -I, --ignore-times \u4e0d\u8df3\u8fc7\u90a3\u4e9b\u6709\u540c\u6837\u7684\u65f6\u95f4\u548c\u957f\u5ea6\u7684\u6587\u4ef6 --size-only \u5f53\u51b3\u5b9a\u662f\u5426\u8981\u5907\u4efd\u6587\u4ef6\u65f6\uff0c\u4ec5\u4ec5\u5bdf\u770b\u6587\u4ef6\u5927\u5c0f\u800c\u4e0d\u8003\u8651\u6587\u4ef6\u65f6\u95f4 --modify-window=NUM \u51b3\u5b9a\u6587\u4ef6\u662f\u5426\u65f6\u95f4\u76f8\u540c\u65f6\u4f7f\u7528\u7684\u65f6\u95f4\u6233\u7a97\u53e3\uff0c\u9ed8\u8ba4\u4e3a0 -T --temp-dir=DIR \u5728DIR\u4e2d\u521b\u5efa\u4e34\u65f6\u6587\u4ef6 --compare-dest=DIR \u540c\u6837\u6bd4\u8f83DIR\u4e2d\u7684\u6587\u4ef6\u6765\u51b3\u5b9a\u662f\u5426\u9700\u8981\u5907\u4efd -P \u7b49\u540c\u4e8e --partial --progress \u663e\u793a\u5907\u4efd\u8fc7\u7a0b -z, --compress \u5bf9\u5907\u4efd\u7684\u6587\u4ef6\u5728\u4f20\u8f93\u65f6\u8fdb\u884c\u538b\u7f29\u5904\u7406 --exclude=PATTERN \u6307\u5b9a\u6392\u9664\u4e0d\u9700\u8981\u4f20\u8f93\u7684\u6587\u4ef6\u6a21\u5f0f --include=PATTERN \u6307\u5b9a\u4e0d\u6392\u9664\u800c\u9700\u8981\u4f20\u8f93\u7684\u6587\u4ef6\u6a21\u5f0f --exclude-from=FILE \u6392\u9664FILE\u4e2d\u6307\u5b9a\u6a21\u5f0f\u7684\u6587\u4ef6 --include-from=FILE \u4e0d\u6392\u9664FILE\u6307\u5b9a\u6a21\u5f0f\u5339\u914d\u7684\u6587\u4ef6 --version \u6253\u5370\u7248\u672c\u4fe1\u606f --address \u7ed1\u5b9a\u5230\u7279\u5b9a\u7684\u5730\u5740 --config=FILE \u6307\u5b9a\u5176\u4ed6\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u4e0d\u4f7f\u7528\u9ed8\u8ba4\u7684rsyncd.conf\u6587\u4ef6 --port=PORT \u6307\u5b9a\u5176\u4ed6\u7684rsync\u670d\u52a1\u7aef\u53e3 --blocking-io \u5bf9\u8fdc\u7a0bshell\u4f7f\u7528\u963b\u585eIO -stats \u7ed9\u51fa\u67d0\u4e9b\u6587\u4ef6\u7684\u4f20\u8f93\u72b6\u6001 --progress \u5728\u4f20\u8f93\u65f6\u73b0\u5b9e\u4f20\u8f93\u8fc7\u7a0b --log-format=formAT \u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\u683c\u5f0f --password-file=FILE \u4eceFILE\u4e2d\u5f97\u5230\u5bc6\u7801 --bwlimit=KBPS \u9650\u5236I/O\u5e26\u5bbd\uff0cKBytes per second -h, --help \u663e\u793a\u5e2e\u52a9\u4fe1\u606f 3.2\u4ece\u8fdc\u7aef\u62c9\u53d6\u6570\u636e \u00b6 rsync -avz -P -e 'ssh -p \u7aef\u53e3\u53f7' \u8fdc\u7aef\u7528\u6237\u540d@\u8fdc\u7aefIP:\u8fdc\u7aef\u8def\u5f84 \u672c\u5730\u76ee\u5f55 root@template /tmp 16:34:19 # rsync -avzP -e 'ssh -p 22'root@192.168.44.100:/tmp/rsync.txt /tmp reverse mapping checking getaddrinfo for bogon[192.168.44.100] failed - POSSIBLE BREAK-IN ATTEMPT! root@192.168.44.100's password: receiving incremental file list rsync.txt 19100% 18.55kB/s 0:00:00 (xfer#1, to-check=0/1) sent 36 bytes received 99 bytes 30.00 bytes/sec total size is 19 speedup is 0.14 root@template /tmp 16:39:26 # cat rsync.txt \u6211\u662frsync\u6d4b\u8bd52 \u56db.\u901a\u8fc7rsync\u8ba4\u8bc1\u4f20\u8f93 \u00b6 4.1\u5907\u4efd\u670d\u52a1\u5668\u914d\u7f6e \u00b6 \u4e5f\u5c31\u662f\u670d\u52a1\u5668\u7aef192.168.91.166 4.1.1\u521b\u5efarsync\u540c\u6b65\u7528\u6237 \u00b6 [root@salt-master data]# useradd -M -s /sbin/nologin rsync 4.1.2\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 \u00b6 \uff08vim /etc/rsyncd.conf\uff09 [root@salt-master data]# cat /etc/rsyncd.conf #config_______________start ##rsyncd.conf start## uid = root #\u6b64\u65f6\u7528\u6237\u53ef\u4ee5\u662f\u522b\u7684\uff0c\u4f46\u662f\u53ea\u8981\u6709\u7ba1\u7406\u670d\u52a1\u7aef\u4e0b/data\u7684\u6743\u9650\u5373\u53ef,\u4e0d\u4e00\u5b9a\u975e\u5f97\u8981\u7528root gid = root use chroot = no #\u5185\u7f51\u8bbe\u7f6e\u4e3ano max connections = 200 #\u6700\u5927\u8fde\u63a5\u6570\u9ed8\u8ba4\u4e3a0\u65e0\u9650\u5927\uff0c\u8d1f\u6570\u4e3a\u5173\u95ed timeout = 300 #\u8d85\u65f6\u9ed8\u8ba4\u4e3a0 notimeout\u65e0\u8d85\u65f6\u65f6\u95f4 \u5efa\u8bae200-600\uff085-10\u5206\u949f\uff09 pid file = /var/run/rsyncd.pid lock file = /var/run/rsync.lock log file = /var/log/rsyncd.log [data] #\u65b0\u5efa\u7684\u6a21\u5757\u540d comment = datafile by caimengzhi at 2016-11-10 #\u6ce8\u91ca\u90e8\u5206 path = /data/ #\u9ed8\u8ba4\u4e0a\u4f20\u548c\u4e0b\u8f7d\u7684\u8def\u5f84 ignore errors #\u5ffd\u7565\u9519\u8bef read only = false #\u7981\u6b62\u53ea\u8bfb\u53ef\u5199 list = false #\u7981\u6b62\u5217\u8868 hosts allow = 192.168.91.0/24 #\u6307\u5b9a\u53ef\u4ee5\u8fde\u63a5\u7684\u5ba2\u6237\u7aefip\u6216\u5730\u5740\u6bb5 hosts deny = 0.0.0.0/32 #\u6307\u5b9a\u4e0d\u53ef\u4ee5\u8fde\u63a5\u7684ip\u6216\u5730\u5740\u6bb5 auth users = rsync_body #\u5ba2\u6237\u7aef\u540c\u6b65\u7684\u865a\u62df\u7528\u6237 secrets file = /etc/rsync.password #\u5ba2\u6237\u7aef\u540c\u6b65\u7684\u865a\u62df\u673a\u7528\u6237\u7684\u5bc6\u7801 \u5feb\u901f cat >>/etc/rsyncd.conf<<EOF #config_______________start ##rsyncd.conf start## uid = root gid = root use chroot = no max connections = 200 timeout = 300 pid file = /var/run/rsyncd.pid lock file = /var/run/rsync.lock log file = /var/log/rsyncd.log [data] comment = datafile by caimengzhi at 2016-11-10 path = /data/ ignore errors read only = false list = false hosts allow = 192.168.91.0/24 hosts deny = 0.0.0.0/32 auth users = rsync_body secrets file = /etc/rsync.password EOF 4.1.3\u6dfb\u52a0\u5bc6\u7801\u6587\u4ef6 \u00b6 [root@salt-master data]# echo 'rsync_body:admin' >> /etc/rsync.password #\u6dfb\u52a0\u8d26\u6237\u548c\u5bc6\u7801\uff0c\u524d\u9762\u662f\u540c\u6b65\u65f6\u5019\u7684\u865a\u62df\u8d26\u53f7\u548c\u5bc6\u7801 [root@salt-master data]# cat /etc/rsync.password rsync_body:admin [root@salt-master data]# chmod 600 /etc/rsync.password 4.1.4\u542f\u52a8\u670d\u52a1 [root@salt-master data]# rsync --daemon #rsync\u670d\u52a1\u7aef\u4ee5\u5b88\u62a4\u8fdb\u7a0b\u65b9\u5f0f\u542f\u52a8\uff0c\u4e14\u7aef\u53e3\u662ftcp\u534f\u8bae\u7684873 [root@salt-master data]# ps -ef | grep rsync |grep -v grep root 7247 1 0 17:21 ? 00:00:00 rsync --daemon [root@salt-master data]# netstat -lnp| grep 873 tcp 0 0 0.0.0.0:873 0.0.0.0:* LISTEN 7247/rsync tcp 0 0 :::873 :::* LISTEN 7247/rsync [root@salt-master data]# lsof -i:873 COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME rsync 7247 root 4u IPv4 67065 0t0 TCP *:rsync (LISTEN) rsync 7247 root 5u IPv6 67066 0t0 TCP *:rsync (LISTEN) 4.2\u6e90\u6570\u636e\u670d\u52a1\u5668\u914d\u7f6e\u4e5f\u5c31\u662f\u5ba2\u6237\u7aef192.168.91.156 \u00b6 4.2.1\u914d\u7f6e\u5bc6\u7801\u6587\u4ef6 \u00b6 [root@salt-client01 sersync]# echo \"admin\">/etc/rsync.password #\u5ba2\u6237\u7aef\u53ea\u9700\u8981\u914d\u7f6e\u5bc6\u7801\u6587\u4ef6\u5373\u53ef\uff0c\u56e0\u4e3a\u5728\u540c\u6b65\u7684\u65f6\u5019\u4f1a\u6307\u5b9a\u865a\u62df\u540c\u6b65\u8d26\u53f7 [root@salt-client01 sersync]# cat /etc/rsync.password admin [root@salt-client01 sersync]# chmod 600 /etc/rsync.password [root@salt-client01 sersync]# ll /etc/rsync.password -rw------- 1 root root 6 Nov 10 17:26 /etc/rsync.password 4.2.2\u5411\u5907\u4efd\u670d\u52a1\u5668\u53d1\u9001\u6570\u636e \u00b6 rsync -avz -P \u672c\u5730\u76ee\u5f55\u6216\u6587\u4ef6 rsync_backup@\u670d\u52a1\u7aef\u5730\u5740::\u6a21\u5757\u540d--password-file=/etc/rsync.pwd [root@salt-client01 sersync]# rsync -avz /data rsync_body@192.168.91.166::data --password-file=/etc/rsync.password sending incremental file list data/ data/3 sent 88 bytes received 31 bytes 238.00 bytes/sec total size is 0 speedup is 0.00 \u8bf4\u660ersync \u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u662fOK\u7684 \u00b6 4.2.3\u4ece\u5907\u4efd\u670d\u52a1\u5668\u62c9\u53d6 \u00b6 rsync -avz -P rsync_backup@\u670d\u52a1\u7aef\u5730\u5740::\u6a21\u5757\u540d \u672c\u5730\u76ee\u5f55\u6216\u6587\u4ef6--password-file=/etc/rsync.pwd \u4e94.sersync\u7684\u7b80\u5355\u539f\u7406 \u00b6 \u91c7\u7528inotify\u6765\u5bf9\u6587\u4ef6\u8fdb\u884c\u76d1\u63a7\uff0c\u5f53\u76d1\u63a7\u5230\u6587\u4ef6\u6709\u6587\u4ef6\u53d1\u751f\u6539\u53d8\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8c03\u7528rsync\u5b9e\u73b0\u89e6\u53d1\u5f0f\u5b9e\u65f6\u540c\u6b65\uff01 5.1\u5b89\u88c5sersync \u00b6 \uff08\u6ce8\u610fsersync\u662f\u5de5\u4f5c\u5728rsync\u7684\u6e90\u670d\u52a1\u5668\u4e0a\uff0c\u4e5f\u5c31\u662f\u5ba2\u6237\u7aef\u4e0a\uff09 [root@salt-client01 ~]# cd /usr/local/src/ [root@salt-client01 src]# tar -zxvf sersync2.5.4_64bit_binary_stable_final.tar.gz -C /usr/local/ GNU-Linux-x86/ GNU-Linux-x86/sersync2 GNU-Linux-x86/confxml.xml [root@salt-client01 src]# cd /usr/local/ [root@salt-client01 local]# mv GNU-Linux-x86 sersync [root@salt-client01 local]# cd sersync/ [root@salt-client01 sersync]# mkdir conf bin log [root@salt-client01sersync]# mv confxml.xml conf [root@salt-client01sersync]# mv sersync2 bin/sersync 5.2\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 \u00b6 ***********************************30\u884c\u5f00\u59cb****************************** <commonParams params=\"-artuz\"/> #-artuz\u4e3arsync\u540c\u6b65\u65f6\u7684\u53c2\u6570 <authstart=\"true\" users=\"rsync\u7684\u865a\u62df\u7528\u6237\u540d(rsync_backup)\" passwordfile=\"rsync\u7684\u5bc6\u7801\u6587\u4ef6\"/> <userDefinedPort start=\"true\"port=\"873\"/><!-- port=874 --> <timeout start=\"false\" time=\"100\"/><!--timeout=100 --> <sshstart=\"false\"/> ************************************\u7b2c36\u884c*********************************** <failLogpath=\"\u81ea\u5df1\u5b9a\u4e49\u7684log\u6587\u4ef6\u5939(/usr/local/sersync/log)rsync_fail_log.sh\" timeToExecute=\"60\"/><!--defaultevery 60mins execute once--> ******************************************************************************* *\u6ce8\uff1a\u82e5\u6709\u591a\u4e2a\u76ee\u5f55\u5907\u4efd\u53ef\u4ee5\u7a7f\u4ef6\u591a\u4e2a\u914d\u7f6e\u6587\u4ef6\u5728\u542f\u52a8\u65f6\u7684-o\u53c2\u6570\u4e2d\u6dfb\u52a0\u5373\u53ef [root@salt-client01 conf]# diff confxml.xml confxml.xml.bak 24,25c24,25 < <localpath watch=\"/data/\"> #data\u5c31\u662f\u672c\u5730\u9700\u8981\u540c\u6b65\u7684\u6587\u4ef6\u5939\u5230\u670d\u52a1\u5668\u7aef\u7684\u76ee\u5f55 < <remote ip=\"192.168.91.166\" name=\"data\"/> #data (server\u7684\u6a21\u5757\u540d)\u662frsync \u670d\u52a1\u7aef\u7684\u6587\u4ef6\u5939\uff0c\u4e5f\u5c31\u662f\u63a8\u9001\u5230\u670d\u52a1\u5668\u7aef\u7684\u76ee\u6807\u6587\u4ef6\u5939\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c --- > <localpath watch=\"/opt/tongbu\"> > <remote ip=\"127.0.0.1\" name=\"tongbu1\"/> 31c31 < <auth start=\"true\" users=\"rsync_body\" passwordfile=\"/etc/rsync.password\"/> #true \u624d\u80fd\u751f\u6548\uff0crsync_body\u540c\u6b65\u65f6\u5019\u865a\u62df\u8d26\u53f7\uff0c\u540e\u9762\u662f\u5bc6\u7801\u6587\u4ef6 --- > <auth start=\"false\" users=\"root\" passwordfile=\"/etc/rsync.pas\"/> 33c33 < <timeout start=\"true\" time=\"100\"/><!-- timeout=100 --> #true \u624d\u80fd\u751f\u6548 --- > <timeout start=\"false\" time=\"100\"/><!-- timeout=100 --> 36c36 < <failLog path=\"/usr/local/sersync/log/rsync_fail_log.sh\" timeToExecute=\"60\"/><!--default every 60mins execute once--> #\u68c0\u6d4brsync\u8fdb\u7a0b\u5224\u65ad\uff0c\u6ca1\u6709\u81ea\u52a8\u542f --- > <failLog path=\"/tmp/rsync_fail_log.sh\" timeToExecute=\"60\"/><!--default every 60mins execute once--> 5.3\u542f\u52a8sersync \u00b6 [root@salt-client01 src]# echo 'export PATH=$PATH:/usr/local/sersync/bin'>>/etc/profile #\u58f0\u660e\u73af\u5883\u53d8\u91cf [root@salt-client01 src]# source /etc/profile [root@salt-client01 src]# sersync2 -r -d -o /usr/local/sersync/conf/confxml.xml #\u542f\u52a8 set the system param execute\uff1aecho 50000000 > /proc/sys/fs/inotify/max_user_watches execute\uff1aecho 327679 > /proc/sys/fs/inotify/max_queued_events parse the command param option: -r rsync all the local files to the remote servers before the sersync work option: -d run as a daemon option: -o config xml name\uff1a /usr/local/sersync/conf/confxml.xml daemon thread num: 10 parse xml config file host ip : localhost host port: 8008 daemon start\uff0csersync run behind the console use rsync password-file : user is rsync_body passwordfile is /etc/rsync.password config xml parse success please set /etc/rsyncd.conf max connections=0 Manually sersync working thread 12 = 1(primary thread) + 1(fail retry thread) + 10(daemon sub threads) Max threads numbers is: 22 = 12(Thread pool nums) + 10(Sub threads) please according your cpu \uff0cuse -n param to adjust the cpu rate ------------------------------------------ rsync the directory recursivly to the remote servers once working please wait... execute command: cd /data && rsync -artuz -R --delete ./ --timeout=100 rsync_body@192.168.91.166::data --password-file=/etc/rsync.password >/dev/null 2>&1 run the sersync: watch path is: /data #\u6b64\u65f6\u53ef\u4ee5\u770b\u51fasersync\u5df2\u7ecf\u542f\u52a8\u6210\u529f\u4e86 \u68c0\u6d4b\u811a\u672c [root@salt-client01 log]# pwd /usr/local/sersync/log [root@salt-client01 log]# vim rsync_fail_log.sh [root@salt-client01 log]# chmod +x rsync_fail_log.sh [root@salt-client01 ~]# cat /usr/local/sersync/log/rsync_fail_log.sh #!/bin/bash #Purpose: Check sersync whether it is alive #Author: cai meng zhi SERSYNC=\"/usr/local/sersync/bin/sersync2\" CONF_FILE=\"/usr/local/sersync/conf/confxml.xml\" STATUS=$(ps aux |grep 'sersync2'|grep -v 'grep'|wc -l) if [ $STATUS -eq 0 ]; then $SERSYNC -d -r -o $CONF_FILE & else exit 0; fi \u811a\u672c\u5199\u597d\u4ee5\u540e\uff0c\u6dfb\u52a0\u5230\u8ba1\u5212\u4efb\u52a1\u4e2d\u53bb */1 * * * * /bin/bash /usr/local/sersync/log/rsync_fail_log.sh > /dev/null 2>&1 \u6d4b\u8bd5\u540c\u6b65\uff1a \u5ba2\u6237\u7aef\u65b0\u589e\u6587\u4ef6 [root@salt-client01 data]# cp /etc/passwd 192.168.91.156.passwd [root@salt-client01 data]# ll total 4 -rw-r--r-- 1 root root 1928 Nov 10 18:15 192.168.91.156.passwd -rw-r--r-- 1 root root 0 Nov 10 17:27 3 \u670d\u52a1\u7aef\u68c0\u6d4b [root@salt-master data]# cd /data/ [root@salt-master data]# ll total 8 -rw-r--r-- 1 root root 1928 Nov 10 18:15 192.168.91.156.passwd #\u8bf4\u660e\u5df2\u7ecf\u540c\u6b65\u8fc7\u6765\u4e86 -rw-r--r-- 1 root root 0 Nov 10 17:27 3 drwxr-xr-x 2 root root 4096 Nov 10 17:27 data \u5ba2\u6237\u7aef\u6d4b\u8bd5\u5220\u9664 [root@salt-client01 data]# rm rf 192.168.91.156.passwd rm: cannot remove `rf': No such file or directory rm: remove regular file `192.168.91.156.passwd'? y [root@salt-client01 data]# ll total 0 -rw-r--r-- 1 root root 0 Nov 10 17:27 3 [root@salt-client01 data]# \u670d\u52a1\u5668\u7aef\uff1a [root@salt-master data]# ll total 4 -rw-r--r-- 1 root root 0 Nov 10 17:27 3 #\u8bf4\u660e\u5df2\u7ecf\u5220\u9664\u6389\u4e86 drwxr-xr-x 2 root root 4096 Nov 10 17:27 data 5.4\u5e38\u89c1\u9519\u8bef\u6c47\u603b \u00b6 \u9519\u8bef\u4e00\uff1a @ERROR: auth failed on module xxxxx rsync: connection unexpectedly closed(90 bytes read so far) rsync error: error in rsync protocoldata stream (code 12) at io.c(150) \u8bf4\u660e\uff1a\u8fd9\u662f\u56e0\u4e3a\u5bc6\u7801\u8bbe\u7f6e\u9519\u4e86\uff0c\u65e0\u6cd5\u767b\u5165\u6210\u529f\uff0c\u68c0\u67e5\u4e00\u4e0brsync.pwd\uff0c\u770b\u5ba2\u670d\u662f\u5426\u5339\u914d\u3002\u8fd8\u6709\u670d\u52a1\u5668\u7aef\u6ca1\u542f\u52a8rsync \u670d\u52a1\u4e5f\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u3002 \u9519\u8bef\u4e8c\uff1a password file must not beother-accessible continuing without password file Password: \u8bf4\u660e\uff1a\u8fd9\u662f\u56e0\u4e3arsyncd.pwdrsyncd.sec\u7684\u6743\u9650\u4e0d\u5bf9\uff0c\u5e94\u8be5\u8bbe\u7f6e\u4e3a600\u3002\u5982\uff1achmod600 rsyncd.pwd \u9519\u8bef\u4e09\uff1a @ERROR: chroot failed rsync: connection unexpectedly closed(75 bytes read so far) rsync error: error in rsync protocoldata stream (code 12) at io.c(150) \u8bf4\u660e\uff1a\u8fd9\u662f\u56e0\u4e3a\u4f60\u5728 rsync.conf\u4e2d\u8bbe\u7f6e\u7684 path \u8def\u5f84\u4e0d\u5b58\u5728\uff0c\u8981\u65b0\u5efa\u76ee\u5f55\u624d\u80fd\u5f00\u542f\u540c\u6b65 \u9519\u8bef\u56db\uff1a rsync: failed to connect to218.107.243.2: No route to host (113) rsync error: error in socket IO (code10) at clientserver.c(104) [receiver=2.6.9] \u8bf4\u660e\uff1a\u9632\u706b\u5899\u95ee\u9898\u5bfc\u81f4\uff0c\u8fd9\u4e2a\u6700\u597d\u5148\u5f7b\u5e95\u5173\u95ed\u9632\u706b\u5899\uff0c\u6392\u9519\u7684\u57fa\u672c\u6cd5\u5c31\u662f\u8fd9\u6837\uff0c\u65e0\u8bba\u662fS\u8fd8\u662fC\uff0c\u8fd8\u6709ignore errors\u9009\u9879\u95ee\u9898\u4e5f\u4f1a\u5bfc\u81f4 \u9519\u8bef\u4e94\uff1a @ERROR: access denied to www fromunknown (192.168.1.123) rsync: connection unexpectedly closed(0 bytes received so far) [receiver] rsync error: error in rsync protocoldata stream (code 12) at io.c(359) \u8bf4\u660e\uff1a\u6b64\u95ee\u9898\u5f88\u660e\u663e\uff0c\u662f\u914d\u7f6e\u9009\u9879hostallow\u7684\u95ee\u9898\uff0c\u521d\u5b66\u8005\u559c\u6b22\u4e00\u4e2a\u5141\u8bb8\u6bb5\u505a\u6210\u4e00\u4e2a\u914d\u7f6e\uff0c\u7136\u540e\u6a21\u5757\u53c8\u662f\u540c\u4e00\u4e2a\uff0c\u81f4\u4f7f\u5bfc\u81f4 \u9519\u8bef\u516d\uff1a rsync error: received SIGINT,SIGTERM, or SIGHUP (code 20) at rsync.c(244) [generator=2.6.9] rsync error: received SIGUSR1 (code19) at main.c(1182) [receiver=2.6.9] \u8bf4\u660e\uff1a\u5bfc\u81f4\u6b64\u95ee\u9898\u591a\u534a\u662f\u670d\u52a1\u7aef\u670d\u52a1\u6ca1\u6709\u88ab\u6b63\u5e38\u542f\u52a8\uff0c\u5230\u670d\u52a1\u5668\u4e0a\u53bb\u67e5\u67e5\u670d\u52a1\u662f\u5426\u6709\u542f\u52a8\uff0c\u7136\u540e\u67e5\u770b\u4e0b /var/run/rsync.pid \u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u6700\u5e72\u8106\u7684\u65b9\u6cd5\u662f\u6740\u6b7b\u5df2\u7ecf\u542f\u52a8\u4e86\u670d\u52a1\uff0c\u7136\u540e\u518d\u6b21\u542f\u52a8\u670d\u52a1\u6216\u8005\u8ba9\u811a\u672c\u52a0\u5165\u7cfb\u7edf\u542f\u52a8\u670d\u52a1\u7ea7\u522b\u7136\u540eshutdown -r now\u670d\u52a1\u5668 \u9519\u8bef\u4e03\uff1a rsync: read error: Connection resetby peer (104) rsync error: error in rsync protocoldata stream (code 12) at io.c(604) [sender=2.6.9] \u8bf4\u660e\uff1a\u539f\u6570\u636e\u76ee\u5f55\u91cc\u6ca1\u6709\u6570\u636e\u5b58\u5728 \u516d.\u8d44\u6599 \u00b6 \u53c2\u8003\u8d44\u6599","title":"4. sersync"},{"location":"linux/server/sersync/sersync/#rsync","text":"rsync\u662f\u7c7bunix\u7cfb\u7edf\u4e0b\u7684\u6570\u636e\u955c\u50cf\u5907\u4efd\u5de5\u5177\u2014\u2014remote sync\u3002\u4e00\u6b3e\u5feb\u901f\u589e\u91cf\u5907\u4efd\u5de5\u5177 Remote Sync\uff0c\u8fdc\u7a0b\u540c\u6b65\u652f\u6301\u672c\u5730\u590d\u5236\uff0c\u6216\u8005\u4e0e\u5176\u4ed6SSH\u3001rsync\u4e3b\u673a\u540c\u6b65\u3002 \u5b83\u7684\u7279\u6027\u5982\u4e0b\uff1a \u53ef\u4ee5\u955c\u50cf\u4fdd\u5b58\u6574\u4e2a\u76ee\u5f55\u6811\u548c\u6587\u4ef6\u7cfb\u7edf\u3002 \u53ef\u4ee5\u5f88\u5bb9\u6613\u505a\u5230\u4fdd\u6301\u539f\u6765\u6587\u4ef6\u7684\u6743\u9650\u3001\u65f6\u95f4\u3001\u8f6f\u786c\u94fe\u63a5\u7b49\u7b49\u3002 \u65e0\u987b\u7279\u6b8a\u6743\u9650\u5373\u53ef\u5b89\u88c5\u3002 \u5feb\u901f\uff1a\u7b2c\u4e00\u6b21\u540c\u6b65\u65f6 rsync \u4f1a\u590d\u5236\u5168\u90e8\u5185\u5bb9\uff0c\u4f46\u5728\u4e0b\u4e00\u6b21\u53ea\u4f20\u8f93\u4fee\u6539\u8fc7\u7684\u6587\u4ef6\u3002rsync \u5728\u4f20\u8f93\u6570\u636e\u7684\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u5b9e\u884c\u538b\u7f29\u53ca\u89e3\u538b\u7f29\u64cd\u4f5c\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528\u66f4\u5c11\u7684\u5e26\u5bbd\u3002 \u5b89\u5168\uff1a\u53ef\u4ee5\u4f7f\u7528scp\u3001ssh\u7b49\u65b9\u5f0f\u6765\u4f20\u8f93\u6587\u4ef6\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u901a\u8fc7\u76f4\u63a5\u7684socket\u8fde\u63a5\u3002 \u652f\u6301\u533f\u540d\u4f20\u8f93\uff0c\u4ee5\u65b9\u4fbf\u8fdb\u884c\u7f51\u7ad9\u955c\u8c61\u3002 IP \u89d2\u8272 \u5b89\u88c5\u8f6f\u4ef6 \u76ee\u5f55 \u76ee\u7684 192.168.91.166 Rsync \u670d\u52a1\u7aef rsync /data \u5c06192.168.91.156 rsync \u5ba2\u6237\u7aef\u4e0a\u7684/data\u4e0b\u76ee\u5f55\u5b9e\u65f6\u63a8\u9001\u5230192.168.91.166 rsync\u670d\u52a1\u5668\u7aef/data\u4e0b 192.168.91.156 Rsync \u5ba2\u6237\u7aef serync /data","title":"\u4e00.rsync\u4ecb\u7ecd"},{"location":"linux/server/sersync/sersync/#rsync_1","text":"yum install -y rsync","title":"\u4e8c.rsync\u7684\u5b89\u88c5"},{"location":"linux/server/sersync/sersync/#rsyncssh","text":"","title":"\u4e09.rsync\u901a\u8fc7ssh\u8ba4\u8bc1\u4f20\u8f93"},{"location":"linux/server/sersync/sersync/#31","text":"rsync -avz -P \u672c\u5730\u76ee\u5f55 -e 'ssh -p \u7aef\u53e3\u53f7' \u8fdc\u7aef\u7528\u6237\u540d@\u8fdc\u7aefIP:\u8fdc\u7aef\u8def\u5f84 root@template /tmp 16:33:07 # cat rsync.txt \u6211\u662frsync\u6d4b\u8bd5 root@template /tmp 16:34:02 # rsync -avzP /tmp/rsync.txt -e 'ssh -p 22' root@192.168.44.100:/tmp The authenticity of host '192.168.44.100(192.168.44.100)' can't be established. RSA key fingerprint is57:22:33:d6:43:40:31:84:88:19:5d:f5:fc:7d:4e:ce. Are you sure you want to continue connecting(yes/no)? yes Warning: Permanently added '192.168.44.100' (RSA) tothe list of known hosts. reverse mapping checking getaddrinfo for bogon[192.168.44.100] failed - POSSIBLE BREAK-IN ATTEMPT! root@192.168.44.100's password: sending incremental file list rsync.txt 18100% 0.00kB/s 0:00:00 (xfer#1, to-check=0/1) sent 93 bytes received 31 bytes 13.05 bytes/sec total size is 18 speedup is 0.15 \u8be6\u7ec6\u53c2\u6570\uff1a -v, --verbose \u8be6\u7ec6\u6a21\u5f0f\u8f93\u51fa -q, --quiet \u7cbe\u7b80\u8f93\u51fa\u6a21\u5f0f -c, --checksum \u6253\u5f00\u6821\u9a8c\u5f00\u5173\uff0c\u5f3a\u5236\u5bf9\u6587\u4ef6\u4f20\u8f93\u8fdb\u884c\u6821\u9a8c -a, --archive \u5f52\u6863\u6a21\u5f0f\uff0c\u8868\u793a\u4ee5\u9012\u5f52\u65b9\u5f0f\u4f20\u8f93\u6587\u4ef6\uff0c\u5e76\u4fdd\u6301\u6240\u6709\u6587\u4ef6\u5c5e\u6027\uff0c\u7b49\u4e8e-rlptgoD -r, --recursive \u5bf9\u5b50\u76ee\u5f55\u4ee5\u9012\u5f52\u6a21\u5f0f\u5904\u7406 -R, --relative \u4f7f\u7528\u76f8\u5bf9\u8def\u5f84\u4fe1\u606f -b, --backup \u521b\u5efa\u5907\u4efd\uff0c\u4e5f\u5c31\u662f\u5bf9\u4e8e\u76ee\u7684\u5df2\u7ecf\u5b58\u5728\u6709\u540c\u6837\u7684\u6587\u4ef6\u540d\u65f6\uff0c\u5c06\u8001\u7684\u6587\u4ef6\u91cd\u65b0\u547d\u540d\u4e3a~filename\u3002\u53ef\u4ee5\u4f7f\u7528--suffix\u9009\u9879\u6765\u6307\u5b9a\u4e0d\u540c\u7684\u5907\u4efd\u6587\u4ef6\u524d\u7f00\u3002 --backup-dir \u5c06\u5907\u4efd\u6587\u4ef6(\u5982~filename)\u5b58\u653e\u5728\u5728\u76ee\u5f55\u4e0b\u3002 -suffix=SUFFIX \u5b9a\u4e49\u5907\u4efd\u6587\u4ef6\u524d\u7f00 -u, --update \u4ec5\u4ec5\u8fdb\u884c\u66f4\u65b0\uff0c\u4e5f\u5c31\u662f\u8df3\u8fc7\u6240\u6709\u5df2\u7ecf\u5b58\u5728\u4e8eDST\uff0c\u5e76\u4e14\u6587\u4ef6\u65f6\u95f4\u665a\u4e8e\u8981\u5907\u4efd\u7684\u6587\u4ef6\u3002(\u4e0d\u8986\u76d6\u66f4\u65b0\u7684\u6587\u4ef6) -l, --links \u4fdd\u7559\u8f6f\u94fe\u7ed3 -L, --copy-links \u60f3\u5bf9\u5f85\u5e38\u89c4\u6587\u4ef6\u4e00\u6837\u5904\u7406\u8f6f\u94fe\u7ed3 --copy-unsafe-links \u4ec5\u4ec5\u62f7\u8d1d\u6307\u5411SRC\u8def\u5f84\u76ee\u5f55\u6811\u4ee5\u5916\u7684\u94fe\u7ed3 --safe-links \u5ffd\u7565\u6307\u5411SRC\u8def\u5f84\u76ee\u5f55\u6811\u4ee5\u5916\u7684\u94fe\u7ed3 -H, --hard-links \u4fdd\u7559\u786c\u94fe\u7ed3 -p, --perms \u4fdd\u6301\u6587\u4ef6\u6743\u9650 -o, --owner \u4fdd\u6301\u6587\u4ef6\u5c5e\u4e3b\u4fe1\u606f -g, --group \u4fdd\u6301\u6587\u4ef6\u5c5e\u7ec4\u4fe1\u606f -D, --devices \u4fdd\u6301\u8bbe\u5907\u6587\u4ef6\u4fe1\u606f -t, --times \u4fdd\u6301\u6587\u4ef6\u65f6\u95f4\u4fe1\u606f -S, --sparse \u5bf9\u7a00\u758f\u6587\u4ef6\u8fdb\u884c\u7279\u6b8a\u5904\u7406\u4ee5\u8282\u7701DST\u7684\u7a7a\u95f4 -n, --dry-run\u73b0\u5b9e\u54ea\u4e9b\u6587\u4ef6\u5c06\u88ab\u4f20\u8f93 -W, --whole-file \u62f7\u8d1d\u6587\u4ef6\uff0c\u4e0d\u8fdb\u884c\u589e\u91cf\u68c0\u6d4b -x, --one-file-system \u4e0d\u8981\u8de8\u8d8a\u6587\u4ef6\u7cfb\u7edf\u8fb9\u754c -B, --block-size=SIZE \u68c0\u9a8c\u7b97\u6cd5\u4f7f\u7528\u7684\u5757\u5c3a\u5bf8\uff0c\u9ed8\u8ba4\u662f700\u5b57\u8282 -e, --rsh=COMMAND \u6307\u5b9a\u4f7f\u7528rsh\u3001ssh\u65b9\u5f0f\u8fdb\u884c\u6570\u636e\u540c\u6b65 --rsync-path=PATH \u6307\u5b9a\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u7684rsync\u547d\u4ee4\u6240\u5728\u8def\u5f84\u4fe1\u606f -C, --cvs-exclude \u4f7f\u7528\u548cCVS\u4e00\u6837\u7684\u65b9\u6cd5\u81ea\u52a8\u5ffd\u7565\u6587\u4ef6\uff0c\u7528\u6765\u6392\u9664\u90a3\u4e9b\u4e0d\u5e0c\u671b\u4f20\u8f93\u7684\u6587\u4ef6 --existing \u4ec5\u4ec5\u66f4\u65b0\u90a3\u4e9b\u5df2\u7ecf\u5b58\u5728\u4e8eDST\u7684\u6587\u4ef6\uff0c\u800c\u4e0d\u5907\u4efd\u90a3\u4e9b\u65b0\u521b\u5efa\u7684\u6587\u4ef6 --delete \u5220\u9664\u90a3\u4e9bDST\u4e2dSRC\u6ca1\u6709\u7684\u6587\u4ef6 --delete-excluded \u540c\u6837\u5220\u9664\u63a5\u6536\u7aef\u90a3\u4e9b\u88ab\u8be5\u9009\u9879\u6307\u5b9a\u6392\u9664\u7684\u6587\u4ef6 --delete-after \u4f20\u8f93\u7ed3\u675f\u4ee5\u540e\u518d\u5220\u9664 --ignore-errors \u53ca\u65f6\u51fa\u73b0IO\u9519\u8bef\u4e5f\u8fdb\u884c\u5220\u9664 --max-delete=NUM \u6700\u591a\u5220\u9664NUM\u4e2a\u6587\u4ef6 --partial \u4fdd\u7559\u90a3\u4e9b\u56e0\u6545\u6ca1\u6709\u5b8c\u5168\u4f20\u8f93\u7684\u6587\u4ef6\uff0c\u4ee5\u662f\u52a0\u5feb\u968f\u540e\u7684\u518d\u6b21\u4f20\u8f93 --force \u5f3a\u5236\u5220\u9664\u76ee\u5f55\uff0c\u5373\u4f7f\u4e0d\u4e3a\u7a7a --numeric-ids \u4e0d\u5c06\u6570\u5b57\u7684\u7528\u6237\u548c\u7ec4ID\u5339\u914d\u4e3a\u7528\u6237\u540d\u548c\u7ec4\u540d --timeout=TIME IP\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2 -I, --ignore-times \u4e0d\u8df3\u8fc7\u90a3\u4e9b\u6709\u540c\u6837\u7684\u65f6\u95f4\u548c\u957f\u5ea6\u7684\u6587\u4ef6 --size-only \u5f53\u51b3\u5b9a\u662f\u5426\u8981\u5907\u4efd\u6587\u4ef6\u65f6\uff0c\u4ec5\u4ec5\u5bdf\u770b\u6587\u4ef6\u5927\u5c0f\u800c\u4e0d\u8003\u8651\u6587\u4ef6\u65f6\u95f4 --modify-window=NUM \u51b3\u5b9a\u6587\u4ef6\u662f\u5426\u65f6\u95f4\u76f8\u540c\u65f6\u4f7f\u7528\u7684\u65f6\u95f4\u6233\u7a97\u53e3\uff0c\u9ed8\u8ba4\u4e3a0 -T --temp-dir=DIR \u5728DIR\u4e2d\u521b\u5efa\u4e34\u65f6\u6587\u4ef6 --compare-dest=DIR \u540c\u6837\u6bd4\u8f83DIR\u4e2d\u7684\u6587\u4ef6\u6765\u51b3\u5b9a\u662f\u5426\u9700\u8981\u5907\u4efd -P \u7b49\u540c\u4e8e --partial --progress \u663e\u793a\u5907\u4efd\u8fc7\u7a0b -z, --compress \u5bf9\u5907\u4efd\u7684\u6587\u4ef6\u5728\u4f20\u8f93\u65f6\u8fdb\u884c\u538b\u7f29\u5904\u7406 --exclude=PATTERN \u6307\u5b9a\u6392\u9664\u4e0d\u9700\u8981\u4f20\u8f93\u7684\u6587\u4ef6\u6a21\u5f0f --include=PATTERN \u6307\u5b9a\u4e0d\u6392\u9664\u800c\u9700\u8981\u4f20\u8f93\u7684\u6587\u4ef6\u6a21\u5f0f --exclude-from=FILE \u6392\u9664FILE\u4e2d\u6307\u5b9a\u6a21\u5f0f\u7684\u6587\u4ef6 --include-from=FILE \u4e0d\u6392\u9664FILE\u6307\u5b9a\u6a21\u5f0f\u5339\u914d\u7684\u6587\u4ef6 --version \u6253\u5370\u7248\u672c\u4fe1\u606f --address \u7ed1\u5b9a\u5230\u7279\u5b9a\u7684\u5730\u5740 --config=FILE \u6307\u5b9a\u5176\u4ed6\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u4e0d\u4f7f\u7528\u9ed8\u8ba4\u7684rsyncd.conf\u6587\u4ef6 --port=PORT \u6307\u5b9a\u5176\u4ed6\u7684rsync\u670d\u52a1\u7aef\u53e3 --blocking-io \u5bf9\u8fdc\u7a0bshell\u4f7f\u7528\u963b\u585eIO -stats \u7ed9\u51fa\u67d0\u4e9b\u6587\u4ef6\u7684\u4f20\u8f93\u72b6\u6001 --progress \u5728\u4f20\u8f93\u65f6\u73b0\u5b9e\u4f20\u8f93\u8fc7\u7a0b --log-format=formAT \u6307\u5b9a\u65e5\u5fd7\u6587\u4ef6\u683c\u5f0f --password-file=FILE \u4eceFILE\u4e2d\u5f97\u5230\u5bc6\u7801 --bwlimit=KBPS \u9650\u5236I/O\u5e26\u5bbd\uff0cKBytes per second -h, --help \u663e\u793a\u5e2e\u52a9\u4fe1\u606f","title":"3.1\u5c06\u6570\u636e\u53d1\u9001\u5230\u8fdc\u7aef"},{"location":"linux/server/sersync/sersync/#32","text":"rsync -avz -P -e 'ssh -p \u7aef\u53e3\u53f7' \u8fdc\u7aef\u7528\u6237\u540d@\u8fdc\u7aefIP:\u8fdc\u7aef\u8def\u5f84 \u672c\u5730\u76ee\u5f55 root@template /tmp 16:34:19 # rsync -avzP -e 'ssh -p 22'root@192.168.44.100:/tmp/rsync.txt /tmp reverse mapping checking getaddrinfo for bogon[192.168.44.100] failed - POSSIBLE BREAK-IN ATTEMPT! root@192.168.44.100's password: receiving incremental file list rsync.txt 19100% 18.55kB/s 0:00:00 (xfer#1, to-check=0/1) sent 36 bytes received 99 bytes 30.00 bytes/sec total size is 19 speedup is 0.14 root@template /tmp 16:39:26 # cat rsync.txt \u6211\u662frsync\u6d4b\u8bd52","title":"3.2\u4ece\u8fdc\u7aef\u62c9\u53d6\u6570\u636e"},{"location":"linux/server/sersync/sersync/#rsync_2","text":"","title":"\u56db.\u901a\u8fc7rsync\u8ba4\u8bc1\u4f20\u8f93"},{"location":"linux/server/sersync/sersync/#41","text":"\u4e5f\u5c31\u662f\u670d\u52a1\u5668\u7aef192.168.91.166","title":"4.1\u5907\u4efd\u670d\u52a1\u5668\u914d\u7f6e"},{"location":"linux/server/sersync/sersync/#411rsync","text":"[root@salt-master data]# useradd -M -s /sbin/nologin rsync","title":"4.1.1\u521b\u5efarsync\u540c\u6b65\u7528\u6237"},{"location":"linux/server/sersync/sersync/#412","text":"\uff08vim /etc/rsyncd.conf\uff09 [root@salt-master data]# cat /etc/rsyncd.conf #config_______________start ##rsyncd.conf start## uid = root #\u6b64\u65f6\u7528\u6237\u53ef\u4ee5\u662f\u522b\u7684\uff0c\u4f46\u662f\u53ea\u8981\u6709\u7ba1\u7406\u670d\u52a1\u7aef\u4e0b/data\u7684\u6743\u9650\u5373\u53ef,\u4e0d\u4e00\u5b9a\u975e\u5f97\u8981\u7528root gid = root use chroot = no #\u5185\u7f51\u8bbe\u7f6e\u4e3ano max connections = 200 #\u6700\u5927\u8fde\u63a5\u6570\u9ed8\u8ba4\u4e3a0\u65e0\u9650\u5927\uff0c\u8d1f\u6570\u4e3a\u5173\u95ed timeout = 300 #\u8d85\u65f6\u9ed8\u8ba4\u4e3a0 notimeout\u65e0\u8d85\u65f6\u65f6\u95f4 \u5efa\u8bae200-600\uff085-10\u5206\u949f\uff09 pid file = /var/run/rsyncd.pid lock file = /var/run/rsync.lock log file = /var/log/rsyncd.log [data] #\u65b0\u5efa\u7684\u6a21\u5757\u540d comment = datafile by caimengzhi at 2016-11-10 #\u6ce8\u91ca\u90e8\u5206 path = /data/ #\u9ed8\u8ba4\u4e0a\u4f20\u548c\u4e0b\u8f7d\u7684\u8def\u5f84 ignore errors #\u5ffd\u7565\u9519\u8bef read only = false #\u7981\u6b62\u53ea\u8bfb\u53ef\u5199 list = false #\u7981\u6b62\u5217\u8868 hosts allow = 192.168.91.0/24 #\u6307\u5b9a\u53ef\u4ee5\u8fde\u63a5\u7684\u5ba2\u6237\u7aefip\u6216\u5730\u5740\u6bb5 hosts deny = 0.0.0.0/32 #\u6307\u5b9a\u4e0d\u53ef\u4ee5\u8fde\u63a5\u7684ip\u6216\u5730\u5740\u6bb5 auth users = rsync_body #\u5ba2\u6237\u7aef\u540c\u6b65\u7684\u865a\u62df\u7528\u6237 secrets file = /etc/rsync.password #\u5ba2\u6237\u7aef\u540c\u6b65\u7684\u865a\u62df\u673a\u7528\u6237\u7684\u5bc6\u7801 \u5feb\u901f cat >>/etc/rsyncd.conf<<EOF #config_______________start ##rsyncd.conf start## uid = root gid = root use chroot = no max connections = 200 timeout = 300 pid file = /var/run/rsyncd.pid lock file = /var/run/rsync.lock log file = /var/log/rsyncd.log [data] comment = datafile by caimengzhi at 2016-11-10 path = /data/ ignore errors read only = false list = false hosts allow = 192.168.91.0/24 hosts deny = 0.0.0.0/32 auth users = rsync_body secrets file = /etc/rsync.password EOF","title":"4.1.2\u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},{"location":"linux/server/sersync/sersync/#413","text":"[root@salt-master data]# echo 'rsync_body:admin' >> /etc/rsync.password #\u6dfb\u52a0\u8d26\u6237\u548c\u5bc6\u7801\uff0c\u524d\u9762\u662f\u540c\u6b65\u65f6\u5019\u7684\u865a\u62df\u8d26\u53f7\u548c\u5bc6\u7801 [root@salt-master data]# cat /etc/rsync.password rsync_body:admin [root@salt-master data]# chmod 600 /etc/rsync.password 4.1.4\u542f\u52a8\u670d\u52a1 [root@salt-master data]# rsync --daemon #rsync\u670d\u52a1\u7aef\u4ee5\u5b88\u62a4\u8fdb\u7a0b\u65b9\u5f0f\u542f\u52a8\uff0c\u4e14\u7aef\u53e3\u662ftcp\u534f\u8bae\u7684873 [root@salt-master data]# ps -ef | grep rsync |grep -v grep root 7247 1 0 17:21 ? 00:00:00 rsync --daemon [root@salt-master data]# netstat -lnp| grep 873 tcp 0 0 0.0.0.0:873 0.0.0.0:* LISTEN 7247/rsync tcp 0 0 :::873 :::* LISTEN 7247/rsync [root@salt-master data]# lsof -i:873 COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME rsync 7247 root 4u IPv4 67065 0t0 TCP *:rsync (LISTEN) rsync 7247 root 5u IPv6 67066 0t0 TCP *:rsync (LISTEN)","title":"4.1.3\u6dfb\u52a0\u5bc6\u7801\u6587\u4ef6"},{"location":"linux/server/sersync/sersync/#4219216891156","text":"","title":"4.2\u6e90\u6570\u636e\u670d\u52a1\u5668\u914d\u7f6e\u4e5f\u5c31\u662f\u5ba2\u6237\u7aef192.168.91.156"},{"location":"linux/server/sersync/sersync/#421","text":"[root@salt-client01 sersync]# echo \"admin\">/etc/rsync.password #\u5ba2\u6237\u7aef\u53ea\u9700\u8981\u914d\u7f6e\u5bc6\u7801\u6587\u4ef6\u5373\u53ef\uff0c\u56e0\u4e3a\u5728\u540c\u6b65\u7684\u65f6\u5019\u4f1a\u6307\u5b9a\u865a\u62df\u540c\u6b65\u8d26\u53f7 [root@salt-client01 sersync]# cat /etc/rsync.password admin [root@salt-client01 sersync]# chmod 600 /etc/rsync.password [root@salt-client01 sersync]# ll /etc/rsync.password -rw------- 1 root root 6 Nov 10 17:26 /etc/rsync.password","title":"4.2.1\u914d\u7f6e\u5bc6\u7801\u6587\u4ef6"},{"location":"linux/server/sersync/sersync/#422","text":"rsync -avz -P \u672c\u5730\u76ee\u5f55\u6216\u6587\u4ef6 rsync_backup@\u670d\u52a1\u7aef\u5730\u5740::\u6a21\u5757\u540d--password-file=/etc/rsync.pwd [root@salt-client01 sersync]# rsync -avz /data rsync_body@192.168.91.166::data --password-file=/etc/rsync.password sending incremental file list data/ data/3 sent 88 bytes received 31 bytes 238.00 bytes/sec total size is 0 speedup is 0.00","title":"4.2.2\u5411\u5907\u4efd\u670d\u52a1\u5668\u53d1\u9001\u6570\u636e"},{"location":"linux/server/sersync/sersync/#rsync-ok","text":"","title":"\u8bf4\u660ersync \u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u662fOK\u7684"},{"location":"linux/server/sersync/sersync/#423","text":"rsync -avz -P rsync_backup@\u670d\u52a1\u7aef\u5730\u5740::\u6a21\u5757\u540d \u672c\u5730\u76ee\u5f55\u6216\u6587\u4ef6--password-file=/etc/rsync.pwd","title":"4.2.3\u4ece\u5907\u4efd\u670d\u52a1\u5668\u62c9\u53d6"},{"location":"linux/server/sersync/sersync/#sersync","text":"\u91c7\u7528inotify\u6765\u5bf9\u6587\u4ef6\u8fdb\u884c\u76d1\u63a7\uff0c\u5f53\u76d1\u63a7\u5230\u6587\u4ef6\u6709\u6587\u4ef6\u53d1\u751f\u6539\u53d8\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8c03\u7528rsync\u5b9e\u73b0\u89e6\u53d1\u5f0f\u5b9e\u65f6\u540c\u6b65\uff01","title":"\u4e94.sersync\u7684\u7b80\u5355\u539f\u7406"},{"location":"linux/server/sersync/sersync/#51sersync","text":"\uff08\u6ce8\u610fsersync\u662f\u5de5\u4f5c\u5728rsync\u7684\u6e90\u670d\u52a1\u5668\u4e0a\uff0c\u4e5f\u5c31\u662f\u5ba2\u6237\u7aef\u4e0a\uff09 [root@salt-client01 ~]# cd /usr/local/src/ [root@salt-client01 src]# tar -zxvf sersync2.5.4_64bit_binary_stable_final.tar.gz -C /usr/local/ GNU-Linux-x86/ GNU-Linux-x86/sersync2 GNU-Linux-x86/confxml.xml [root@salt-client01 src]# cd /usr/local/ [root@salt-client01 local]# mv GNU-Linux-x86 sersync [root@salt-client01 local]# cd sersync/ [root@salt-client01 sersync]# mkdir conf bin log [root@salt-client01sersync]# mv confxml.xml conf [root@salt-client01sersync]# mv sersync2 bin/sersync","title":"5.1\u5b89\u88c5sersync"},{"location":"linux/server/sersync/sersync/#52","text":"***********************************30\u884c\u5f00\u59cb****************************** <commonParams params=\"-artuz\"/> #-artuz\u4e3arsync\u540c\u6b65\u65f6\u7684\u53c2\u6570 <authstart=\"true\" users=\"rsync\u7684\u865a\u62df\u7528\u6237\u540d(rsync_backup)\" passwordfile=\"rsync\u7684\u5bc6\u7801\u6587\u4ef6\"/> <userDefinedPort start=\"true\"port=\"873\"/><!-- port=874 --> <timeout start=\"false\" time=\"100\"/><!--timeout=100 --> <sshstart=\"false\"/> ************************************\u7b2c36\u884c*********************************** <failLogpath=\"\u81ea\u5df1\u5b9a\u4e49\u7684log\u6587\u4ef6\u5939(/usr/local/sersync/log)rsync_fail_log.sh\" timeToExecute=\"60\"/><!--defaultevery 60mins execute once--> ******************************************************************************* *\u6ce8\uff1a\u82e5\u6709\u591a\u4e2a\u76ee\u5f55\u5907\u4efd\u53ef\u4ee5\u7a7f\u4ef6\u591a\u4e2a\u914d\u7f6e\u6587\u4ef6\u5728\u542f\u52a8\u65f6\u7684-o\u53c2\u6570\u4e2d\u6dfb\u52a0\u5373\u53ef [root@salt-client01 conf]# diff confxml.xml confxml.xml.bak 24,25c24,25 < <localpath watch=\"/data/\"> #data\u5c31\u662f\u672c\u5730\u9700\u8981\u540c\u6b65\u7684\u6587\u4ef6\u5939\u5230\u670d\u52a1\u5668\u7aef\u7684\u76ee\u5f55 < <remote ip=\"192.168.91.166\" name=\"data\"/> #data (server\u7684\u6a21\u5757\u540d)\u662frsync \u670d\u52a1\u7aef\u7684\u6587\u4ef6\u5939\uff0c\u4e5f\u5c31\u662f\u63a8\u9001\u5230\u670d\u52a1\u5668\u7aef\u7684\u76ee\u6807\u6587\u4ef6\u5939\uff0c\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a\uff0c --- > <localpath watch=\"/opt/tongbu\"> > <remote ip=\"127.0.0.1\" name=\"tongbu1\"/> 31c31 < <auth start=\"true\" users=\"rsync_body\" passwordfile=\"/etc/rsync.password\"/> #true \u624d\u80fd\u751f\u6548\uff0crsync_body\u540c\u6b65\u65f6\u5019\u865a\u62df\u8d26\u53f7\uff0c\u540e\u9762\u662f\u5bc6\u7801\u6587\u4ef6 --- > <auth start=\"false\" users=\"root\" passwordfile=\"/etc/rsync.pas\"/> 33c33 < <timeout start=\"true\" time=\"100\"/><!-- timeout=100 --> #true \u624d\u80fd\u751f\u6548 --- > <timeout start=\"false\" time=\"100\"/><!-- timeout=100 --> 36c36 < <failLog path=\"/usr/local/sersync/log/rsync_fail_log.sh\" timeToExecute=\"60\"/><!--default every 60mins execute once--> #\u68c0\u6d4brsync\u8fdb\u7a0b\u5224\u65ad\uff0c\u6ca1\u6709\u81ea\u52a8\u542f --- > <failLog path=\"/tmp/rsync_fail_log.sh\" timeToExecute=\"60\"/><!--default every 60mins execute once-->","title":"5.2\u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},{"location":"linux/server/sersync/sersync/#53sersync","text":"[root@salt-client01 src]# echo 'export PATH=$PATH:/usr/local/sersync/bin'>>/etc/profile #\u58f0\u660e\u73af\u5883\u53d8\u91cf [root@salt-client01 src]# source /etc/profile [root@salt-client01 src]# sersync2 -r -d -o /usr/local/sersync/conf/confxml.xml #\u542f\u52a8 set the system param execute\uff1aecho 50000000 > /proc/sys/fs/inotify/max_user_watches execute\uff1aecho 327679 > /proc/sys/fs/inotify/max_queued_events parse the command param option: -r rsync all the local files to the remote servers before the sersync work option: -d run as a daemon option: -o config xml name\uff1a /usr/local/sersync/conf/confxml.xml daemon thread num: 10 parse xml config file host ip : localhost host port: 8008 daemon start\uff0csersync run behind the console use rsync password-file : user is rsync_body passwordfile is /etc/rsync.password config xml parse success please set /etc/rsyncd.conf max connections=0 Manually sersync working thread 12 = 1(primary thread) + 1(fail retry thread) + 10(daemon sub threads) Max threads numbers is: 22 = 12(Thread pool nums) + 10(Sub threads) please according your cpu \uff0cuse -n param to adjust the cpu rate ------------------------------------------ rsync the directory recursivly to the remote servers once working please wait... execute command: cd /data && rsync -artuz -R --delete ./ --timeout=100 rsync_body@192.168.91.166::data --password-file=/etc/rsync.password >/dev/null 2>&1 run the sersync: watch path is: /data #\u6b64\u65f6\u53ef\u4ee5\u770b\u51fasersync\u5df2\u7ecf\u542f\u52a8\u6210\u529f\u4e86 \u68c0\u6d4b\u811a\u672c [root@salt-client01 log]# pwd /usr/local/sersync/log [root@salt-client01 log]# vim rsync_fail_log.sh [root@salt-client01 log]# chmod +x rsync_fail_log.sh [root@salt-client01 ~]# cat /usr/local/sersync/log/rsync_fail_log.sh #!/bin/bash #Purpose: Check sersync whether it is alive #Author: cai meng zhi SERSYNC=\"/usr/local/sersync/bin/sersync2\" CONF_FILE=\"/usr/local/sersync/conf/confxml.xml\" STATUS=$(ps aux |grep 'sersync2'|grep -v 'grep'|wc -l) if [ $STATUS -eq 0 ]; then $SERSYNC -d -r -o $CONF_FILE & else exit 0; fi \u811a\u672c\u5199\u597d\u4ee5\u540e\uff0c\u6dfb\u52a0\u5230\u8ba1\u5212\u4efb\u52a1\u4e2d\u53bb */1 * * * * /bin/bash /usr/local/sersync/log/rsync_fail_log.sh > /dev/null 2>&1 \u6d4b\u8bd5\u540c\u6b65\uff1a \u5ba2\u6237\u7aef\u65b0\u589e\u6587\u4ef6 [root@salt-client01 data]# cp /etc/passwd 192.168.91.156.passwd [root@salt-client01 data]# ll total 4 -rw-r--r-- 1 root root 1928 Nov 10 18:15 192.168.91.156.passwd -rw-r--r-- 1 root root 0 Nov 10 17:27 3 \u670d\u52a1\u7aef\u68c0\u6d4b [root@salt-master data]# cd /data/ [root@salt-master data]# ll total 8 -rw-r--r-- 1 root root 1928 Nov 10 18:15 192.168.91.156.passwd #\u8bf4\u660e\u5df2\u7ecf\u540c\u6b65\u8fc7\u6765\u4e86 -rw-r--r-- 1 root root 0 Nov 10 17:27 3 drwxr-xr-x 2 root root 4096 Nov 10 17:27 data \u5ba2\u6237\u7aef\u6d4b\u8bd5\u5220\u9664 [root@salt-client01 data]# rm rf 192.168.91.156.passwd rm: cannot remove `rf': No such file or directory rm: remove regular file `192.168.91.156.passwd'? y [root@salt-client01 data]# ll total 0 -rw-r--r-- 1 root root 0 Nov 10 17:27 3 [root@salt-client01 data]# \u670d\u52a1\u5668\u7aef\uff1a [root@salt-master data]# ll total 4 -rw-r--r-- 1 root root 0 Nov 10 17:27 3 #\u8bf4\u660e\u5df2\u7ecf\u5220\u9664\u6389\u4e86 drwxr-xr-x 2 root root 4096 Nov 10 17:27 data","title":"5.3\u542f\u52a8sersync"},{"location":"linux/server/sersync/sersync/#54","text":"\u9519\u8bef\u4e00\uff1a @ERROR: auth failed on module xxxxx rsync: connection unexpectedly closed(90 bytes read so far) rsync error: error in rsync protocoldata stream (code 12) at io.c(150) \u8bf4\u660e\uff1a\u8fd9\u662f\u56e0\u4e3a\u5bc6\u7801\u8bbe\u7f6e\u9519\u4e86\uff0c\u65e0\u6cd5\u767b\u5165\u6210\u529f\uff0c\u68c0\u67e5\u4e00\u4e0brsync.pwd\uff0c\u770b\u5ba2\u670d\u662f\u5426\u5339\u914d\u3002\u8fd8\u6709\u670d\u52a1\u5668\u7aef\u6ca1\u542f\u52a8rsync \u670d\u52a1\u4e5f\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u3002 \u9519\u8bef\u4e8c\uff1a password file must not beother-accessible continuing without password file Password: \u8bf4\u660e\uff1a\u8fd9\u662f\u56e0\u4e3arsyncd.pwdrsyncd.sec\u7684\u6743\u9650\u4e0d\u5bf9\uff0c\u5e94\u8be5\u8bbe\u7f6e\u4e3a600\u3002\u5982\uff1achmod600 rsyncd.pwd \u9519\u8bef\u4e09\uff1a @ERROR: chroot failed rsync: connection unexpectedly closed(75 bytes read so far) rsync error: error in rsync protocoldata stream (code 12) at io.c(150) \u8bf4\u660e\uff1a\u8fd9\u662f\u56e0\u4e3a\u4f60\u5728 rsync.conf\u4e2d\u8bbe\u7f6e\u7684 path \u8def\u5f84\u4e0d\u5b58\u5728\uff0c\u8981\u65b0\u5efa\u76ee\u5f55\u624d\u80fd\u5f00\u542f\u540c\u6b65 \u9519\u8bef\u56db\uff1a rsync: failed to connect to218.107.243.2: No route to host (113) rsync error: error in socket IO (code10) at clientserver.c(104) [receiver=2.6.9] \u8bf4\u660e\uff1a\u9632\u706b\u5899\u95ee\u9898\u5bfc\u81f4\uff0c\u8fd9\u4e2a\u6700\u597d\u5148\u5f7b\u5e95\u5173\u95ed\u9632\u706b\u5899\uff0c\u6392\u9519\u7684\u57fa\u672c\u6cd5\u5c31\u662f\u8fd9\u6837\uff0c\u65e0\u8bba\u662fS\u8fd8\u662fC\uff0c\u8fd8\u6709ignore errors\u9009\u9879\u95ee\u9898\u4e5f\u4f1a\u5bfc\u81f4 \u9519\u8bef\u4e94\uff1a @ERROR: access denied to www fromunknown (192.168.1.123) rsync: connection unexpectedly closed(0 bytes received so far) [receiver] rsync error: error in rsync protocoldata stream (code 12) at io.c(359) \u8bf4\u660e\uff1a\u6b64\u95ee\u9898\u5f88\u660e\u663e\uff0c\u662f\u914d\u7f6e\u9009\u9879hostallow\u7684\u95ee\u9898\uff0c\u521d\u5b66\u8005\u559c\u6b22\u4e00\u4e2a\u5141\u8bb8\u6bb5\u505a\u6210\u4e00\u4e2a\u914d\u7f6e\uff0c\u7136\u540e\u6a21\u5757\u53c8\u662f\u540c\u4e00\u4e2a\uff0c\u81f4\u4f7f\u5bfc\u81f4 \u9519\u8bef\u516d\uff1a rsync error: received SIGINT,SIGTERM, or SIGHUP (code 20) at rsync.c(244) [generator=2.6.9] rsync error: received SIGUSR1 (code19) at main.c(1182) [receiver=2.6.9] \u8bf4\u660e\uff1a\u5bfc\u81f4\u6b64\u95ee\u9898\u591a\u534a\u662f\u670d\u52a1\u7aef\u670d\u52a1\u6ca1\u6709\u88ab\u6b63\u5e38\u542f\u52a8\uff0c\u5230\u670d\u52a1\u5668\u4e0a\u53bb\u67e5\u67e5\u670d\u52a1\u662f\u5426\u6709\u542f\u52a8\uff0c\u7136\u540e\u67e5\u770b\u4e0b /var/run/rsync.pid \u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u6700\u5e72\u8106\u7684\u65b9\u6cd5\u662f\u6740\u6b7b\u5df2\u7ecf\u542f\u52a8\u4e86\u670d\u52a1\uff0c\u7136\u540e\u518d\u6b21\u542f\u52a8\u670d\u52a1\u6216\u8005\u8ba9\u811a\u672c\u52a0\u5165\u7cfb\u7edf\u542f\u52a8\u670d\u52a1\u7ea7\u522b\u7136\u540eshutdown -r now\u670d\u52a1\u5668 \u9519\u8bef\u4e03\uff1a rsync: read error: Connection resetby peer (104) rsync error: error in rsync protocoldata stream (code 12) at io.c(604) [sender=2.6.9] \u8bf4\u660e\uff1a\u539f\u6570\u636e\u76ee\u5f55\u91cc\u6ca1\u6709\u6570\u636e\u5b58\u5728","title":"5.4\u5e38\u89c1\u9519\u8bef\u6c47\u603b"},{"location":"linux/server/sersync/sersync/#_1","text":"\u53c2\u8003\u8d44\u6599","title":"\u516d.\u8d44\u6599"},{"location":"linux/server/xtrabackup/xtrabackup.index/","text":"MySQL \u5907\u4efd Xtrabackup 1. Xtrabackup \u00b6 1.1 \u4ecb\u7ecd \u00b6 Xtrabackup\u662f\u4e00\u4e2a\u5bf9InnoDB\u505a\u6570\u636e\u5907\u4efd\u7684\u5de5\u5177\uff0c\u652f\u6301\u5728\u7ebf\u70ed\u5907\u4efd\uff08\u5907\u4efd\u65f6\u5019\u4e0d\u5f71\u54cd\u6570\u636e\u8bfb\u5199\uff09\uff0c\u662f\u5546\u4e1a\u5907\u4efd\u5de5\u4f5cInnoDB hotbackup\u7684\u4e00\u4e2a\u5f88\u597d\u7684\u66ff\u4ee3\u54c1\u3002 1.2 \u7279\u70b9 \u00b6 \u65e0\u9700\u505c\u6b62\u6570\u636e\u5e93\u8fdb\u884cInnoDB\u70ed\u5907 \u589e\u91cf\u5907\u4efdMySQL \u6d41\u538b\u7f29\u5230\u4f20\u8f93\u5230\u5176\u4ed6\u670d\u52a1\u5668 \u80fd\u6bd4\u8f83\u5bb9\u6613\u7684\u521b\u5efa\u4e3b\u4ece\u540c\u6b65 \u5907\u4efdMySQL\u65f6\u4e0d\u4f1a\u589e\u5927\u670d\u52a1\u5668\u8d1f\u8f7d 1.3 \u5907\u4efd\u65b9\u5f0f \u00b6 \u70ed\u5907\u4efd\uff1a\u8bfb\u5199\u4e0d\u53d7\u5f71\u54cd\uff08mysqldump \u2192 innodb\uff09 \u6e29\u5907\u4efd\uff1a\u4ec5\u53ef\u4ee5\u6267\u884c\u8bfb\u64cd\u4f5c\uff08mysqldump \u2192 myisam\uff09 \u51b7\u5907\u4efd\uff1a\u79bb\u7ebf\u5907\u4efd\uff0c\u8bfb\u5199\u90fd\u4e0d\u53ef\u7528 \u903b\u8f91\u5907\u4efd\uff1a\u8bb2\u6570\u636e\u5bfc\u51fa\u6587\u672c\u6587\u4ef6\u4e2d(mysqldump) \u7269\u7406\u5907\u4efd\uff1a\u8bb2\u6570\u636e\u6587\u4ef6\u62f7\u8d1d\uff08xtrabackup\uff0cmysqlhotcopy\uff09 \u5b8c\u6210\u5907\u4efd\uff1a\u5907\u4efd\u6240\u6709\u6570\u636e \u589e\u91cf\u5907\u4efd\uff1a\u4ec5\u5907\u4efd\u4e0a\u6b21\u5b8c\u6574\u5907\u4efd\u6216\u8005\u589e\u91cf\u5907\u4efd\u4ee5\u6765\u53d8\u5316\u7684\u6570\u636e \u5dee\u5f02\u5907\u4efd\uff1a\u4ec5\u5907\u4efd\u4e0a\u6b21\u5b8c\u6574\u5907\u4efd\u4ee5\u6765\u53d8\u5316\u7684\u6570\u636e 2. xtrabackup \u539f\u7406 \u00b6 2.1 xtrabackup \u5907\u4efd\u8fc7\u7a0b \u00b6 innobackupex\u5907\u4efd\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a\u5907\u4efd\u5f00\u59cb\u65f6\u9996\u5148\u4f1a\u5f00\u542f\u4e00\u4e2a\u540e\u53f0\u68c0\u6d4b\u8fdb\u7a0b\uff0c\u5b9e\u65f6\u68c0\u6d4bmysql redo\u7684\u53d8\u5316\uff0c\u4e00\u65e6\u53d1\u73b0redo\u4e2d\u6709\u65b0\u7684\u65e5\u5fd7\u5199\u5165\uff0c\u7acb\u523b\u5c06\u65e5\u5fd7\u8bb0\u5165\u540e\u53f0\u65e5\u5fd7\u6587\u4ef6 xtrabackup_log \u4e2d\u3002\u4e4b\u540e\u590d\u5236innodb\u7684\u6570\u636e\u6587\u4ef6\u548c\u7cfb\u7edf\u8868\u7a7a\u95f4\u6587\u4ef6ibdata1\uff0c\u5f85\u590d\u5236\u7ed3\u675f\u540e\uff0c\u6267\u884cflush tables with read lock\u64cd\u4f5c\uff0c\u590d\u5236.frm\uff0cMYI\uff0cMYD\uff0c\u7b49\u6587\u4ef6\uff08\u6267\u884cflush tableswith read lock\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u9632\u6b62\u6570\u636e\u8868\u53d1\u751fDDL\u64cd\u4f5c\uff0c\u5e76\u4e14\u5728\u8fd9\u4e00\u65f6\u523b\u83b7\u5f97binlog\u7684\u4f4d\u7f6e\uff09\u6700\u540e\u4f1a\u53d1\u51faunlock tables\uff0c\u628a\u8868\u8bbe\u7f6e\u4e3a\u53ef\u8bfb\u53ef\u5199\u72b6\u6001\uff0c\u6700\u7ec8\u505c\u6b62xtrabackup_log\u3002 2.2 Xtrabackup \u5168\u91cf\u5907\u4efd\u6062\u590d \u00b6 \u8fd9\u4e00\u9636\u6bb5\u4f1a\u542f\u52a8xtrabackup\u5185\u5d4c\u7684innodb\u5b9e\u4f8b\uff0c\u56de\u653extrabackup\u65e5\u5fd7xtrabackup_log\uff0c\u5c06\u63d0\u4ea4\u7684\u4e8b\u52a1\u4fe1\u606f\u53d8\u66f4\u5e94\u7528\u5230innodb\u6570\u636e/\u8868\u7a7a\u95f4\uff0c\u540c\u65f6\u56de\u6eda\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1(\u8fd9\u4e00\u8fc7\u7a0b\u7c7b\u4f3cinnodb\u7684\u5b9e\u4f8b\u6062\u590d\uff09\u3002\u6062\u590d\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a 2.3 Xtrabackup \u589e\u91cf\u5907\u4efd\u539f\u7406 \u00b6 innobackupex\u589e\u91cf\u5907\u4efd\u8fc7\u7a0b\u4e2d\u7684\"\u589e\u91cf\"\u5904\u7406\uff0c\u5176\u5b9e\u4e3b\u8981\u662f\u76f8\u5bf9innodb\u800c\u8a00\uff0c\u5bf9myisam\u548c\u5176\u4ed6\u5b58\u50a8\u5f15\u64ce\u800c\u8a00\uff0c\u5b83\u4ecd\u7136\u662f\u5168\u62f7\u8d1d(\u5168\u5907\u4efd)\"\u3002\u589e\u91cf\"\u5907\u4efd\u7684\u8fc7\u7a0b\u4e3b\u8981\u662f\u901a\u8fc7\u62f7\u8d1dinnodb\u4e2d\u6709\u53d8\u66f4\u7684\"\u9875\"\uff08\u8fd9\u4e9b\u53d8\u66f4\u7684\u6570\u636e\u9875\u6307\u7684\u662f\"\u9875\"\u7684LSN\u5927\u4e8extrabackup_checkpoints\u4e2d\u7ed9\u5b9a\u7684LSN\uff09\u3002\u589e\u91cf\u5907\u4efd\u662f\u57fa\u4e8e\u5168\u5907\u7684\uff0c\u7b2c\u4e00\u6b21\u589e\u5907\u7684\u6570\u636e\u5fc5\u987b\u8981\u57fa\u4e8e\u4e0a\u4e00\u6b21\u7684\u5168\u5907\uff0c\u4e4b\u540e\u7684\u6bcf\u6b21\u589e\u5907\u90fd\u662f\u57fa\u4e8e\u4e0a\u4e00\u6b21\u7684\u589e\u5907\uff0c\u6700\u7ec8\u8fbe\u5230\u4e00\u81f4\u6027\u7684\u589e\u5907\u3002\u589e\u91cf\u5907\u4efd\u7684\u8fc7\u7a0b\u5982\u4e0b\uff0c\u548c\u5168\u5907\u7684\u8fc7\u7a0b\u5f88\u7c7b\u4f3c\uff0c\u533a\u522b\u4ec5\u5728\u7b2c2\u6b65\u3002 2.4 Xtrabackup \u589e\u91cf\u5907\u4efd\u6062\u590d \u00b6 \u548c\u5168\u5907\u6062\u590d\u7c7b\u4f3c\uff0c\u4e5f\u9700\u8981\u4e24\u6b65\uff0c\u4e00\u662f\u6570\u636e\u6587\u4ef6\u7684\u6062\u590d\uff0c\u5982\u56fe4\uff0c\u8fd9\u91cc\u7684\u6570\u636e\u6765\u6e90\u75313\u90e8\u5206\u7ec4\u6210\uff1a\u5168\u5907\u4efd\uff0c\u589e\u91cf\u5907\u4efd\u548cxtrabackup log\u3002\u4e8c\u662f\u5bf9\u672a\u63d0\u4ea4\u4e8b\u52a1\u7684\u56de\u6eda\uff0c\u5982\u56fe\u6240\u793a 3. xtrabackup \u90e8\u7f72 \u00b6 3.1 \u79bb\u7ebf\u5b89\u88c5 \u00b6 \u5b89\u88c5Percona XtraBackup Percona yum\u8d44\u6e90\u5e93 yum install -y \\ http://www.percona.com/downloads/percona-release/redhat/0.1-3/percona-release-0.1-3.noarch.rpm yum list|grep percona yum install percona-xtrabackup-22 3.2 \u68c0\u67e5\u5b89\u88c5 \u00b6 [root@localhost ~]# rpm -qa|grep xtrabackup percona-xtrabackup-22-2.2.13-1.el7.x86_64 3.3 \u5e38\u7528\u53c2\u6570 \u00b6 Xtrabackup\u4e2d\u4e3b\u8981\u5305\u542b\u4e24\u4e2a\u5de5\u5177\uff1a xtrabackup\uff1a\u662f\u7528\u4e8e\u70ed\u5907innodb\uff0cxtradb\u8868\u4e2d\u6570\u636e\u7684\u5de5\u5177\uff0c\u4e0d\u80fd\u5907\u4efd\u5176\u4ed6\u7c7b\u578b\u7684\u8868\uff0c\u4e5f\u4e0d\u80fd\u5907\u4efd\u6570\u636e\u8868\u7ed3\u6784\uff1b innobackupex\uff1a\u662f\u5c06xtrabackup\u8fdb\u884c\u5c01\u88c5\u7684perl\u811a\u672c\uff0c\u63d0\u4f9b\u4e86\u5907\u4efdmyisam\u8868\u7684\u80fd\u529b\u3002 \u5e38\u7528\u9009\u9879: -host \u6307\u5b9a\u4e3b\u673a --user \u6307\u5b9a\u7528\u6237\u540d --password \u6307\u5b9a\u5bc6\u7801 --port \u6307\u5b9a\u7aef\u53e3 --databases \u6307\u5b9a\u6570\u636e\u5e93 --incremental \u521b\u5efa\u589e\u91cf\u5907\u4efd --incremental-basedir \u6307\u5b9a\u5305\u542b\u5b8c\u5168\u5907\u4efd\u7684\u76ee\u5f55 --incremental-dir \u6307\u5b9a\u5305\u542b\u589e\u91cf\u5907\u4efd\u7684\u76ee\u5f55 --apply-log \u5bf9\u5907\u4efd\u8fdb\u884c\u9884\u5904\u7406\u64cd\u4f5c \u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5728\u5907\u4efd\u5b8c\u6210\u540e\uff0c\u6570\u636e\u5c1a\u4e14\u4e0d\u80fd\u7528\u4e8e\u6062\u590d\u64cd\u4f5c\uff0c\u56e0\u4e3a\u5907\u4efd\u7684\u6570\u636e\u4e2d\u53ef\u80fd\u4f1a\u5305\u542b\u5c1a\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u6216\u5df2\u7ecf\u63d0\u4ea4\u4f46\u5c1a\u672a\u540c\u6b65\u81f3\u6570\u636e\u6587\u4ef6\u4e2d\u7684\u4e8b\u52a1\u3002\u56e0\u6b64\uff0c\u6b64\u65f6\u6570\u636e\u6587\u4ef6\u4ecd\u5904\u7406\u4e0d\u4e00\u81f4\u72b6\u6001\u3002\u201c\u51c6\u5907\u201d\u7684\u4e3b\u8981\u4f5c\u7528\u6b63\u662f\u901a\u8fc7\u56de\u6eda\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u53ca\u540c\u6b65\u5df2\u7ecf\u63d0\u4ea4\u7684\u4e8b\u52a1\u81f3\u6570\u636e\u6587\u4ef6\u4e5f\u4f7f\u5f97\u6570\u636e\u6587\u4ef6\u5904\u4e8e\u4e00\u81f4\u6027\u72b6\u6001\u3002 --redo-only \u4e0d\u56de\u6eda\u672a\u63d0\u4ea4\u4e8b\u52a1 --copy-back \u6062\u590d\u5907\u4efd\u76ee\u5f55 \u4f7f\u7528innobakupex\u5907\u4efd\u65f6,\u5176\u4f1a\u8c03\u7528xtrabackup\u5907\u4efd\u6240\u6709\u7684InnoDB\u8868,\u590d\u5236\u6240\u6709\u5173\u4e8e\u8868\u7ed3\u6784\u5b9a\u4e49\u7684\u76f8\u5173\u6587\u4ef6(.frm)\u3001\u4ee5\u53caMyISAM\u3001MERGE\u3001CSV\u548cARCHIVE\u8868\u7684\u76f8\u5173\u6587\u4ef6,\u540c\u65f6\u8fd8\u4f1a\u5907\u4efd\u89e6\u53d1\u5668\u548c\u6570\u636e\u5e93\u914d\u7f6e\u4fe1\u606f\u76f8\u5173\u7684\u6587\u4ef6,\u8fd9\u4e9b\u6587\u4ef6\u4f1a\u88ab\u4fdd\u5b58\u81f3\u4e00\u4e2a\u4ee5\u65f6\u95f4\u547d\u4ee4\u7684\u76ee\u5f55\u4e2d\u3002 \u5907\u4efd\u7684\u540c\u65f6\uff0cinnobackupex\u8fd8\u4f1a\u5728\u5907\u4efd\u76ee\u5f55\u4e2d\u521b\u5efa\u5982\u4e0b\u6587\u4ef6\uff1a `. xtrabackup_checkpoints \u5907\u4efd\u7c7b\u578b\uff08\u5982\u5b8c\u5168\u6216\u589e\u91cf\uff09\u3001\u5907\u4efd\u72b6\u6001\uff08\u5982\u662f\u5426\u5df2\u7ecf\u4e3aprepared\u72b6\u6001\uff09\u548cLSN(\u65e5\u5fd7\u5e8f\u5217\u53f7)\u8303\u56f4\u4fe1\u606f;\u6bcf\u4e2aInnoDB\u9875(\u901a\u5e38\u4e3a16k\u5927\u5c0f)\u90fd\u4f1a\u5305\u542b\u4e00\u4e2a\u65e5\u5fd7\u5e8f\u5217\u53f7\uff0c\u5373LSN\u3002 LSN\u662f\u6574\u4e2a\u6570\u636e\u5e93\u7cfb\u7edf\u7684\u7cfb\u7edf\u7248\u672c\u53f7\uff0c\u6bcf\u4e2a\u9875\u9762\u76f8\u5173\u7684LSN\u80fd\u591f\u8868\u660e\u6b64\u9875\u9762\u6700\u8fd1\u662f\u5982\u4f55\u53d1\u751f\u6539\u53d8\u7684\u3002 2. xtrabackup_binlog_info mysql\u670d\u52a1\u5668\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u53ca\u81f3\u5907\u4efd\u8fd9\u4e00\u523b\u4e3a\u6b62\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e8b\u4ef6\u7684\u4f4d\u7f6e\u3002 3. xtrabackup_binlog_pos_innodb \u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u53ca\u7528\u4e8eInnoDB\u6216XtraDB\u8868\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u7684\u5f53\u524dposition\u3002 4. xtrabackup_binary \u5907\u4efd\u4e2d\u7528\u5230\u7684xtrabackup\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff1b 5. backup-my.cnf \u5907\u4efd\u547d\u4ee4\u7528\u5230\u7684\u914d\u7f6e\u9009\u9879\u4fe1\u606f\uff1b \u5728\u4f7f\u7528innobackupex\u8fdb\u884c\u5907\u4efd\u65f6\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528--no-timestamp\u9009\u9879\u6765\u963b\u6b62\u547d\u4ee4\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u4ee5\u65f6\u95f4\u547d\u540d\u7684\u76ee\u5f55\uff1b\u5982\u6b64\u4e00\u6765\uff0cinnobackupex\u547d\u4ee4\u5c06\u4f1a\u521b\u5efa\u4e00\u4e2aBACKUP-DIR\u76ee\u5f55\u6765\u5b58\u50a8\u5907\u4efd\u6570\u636e\u3002 \u5982\u679c\u8981\u4f7f\u7528\u4e00\u4e2a\u6700\u5c0f\u6743\u9650\u7684\u7528\u6237\u8fdb\u884c\u5907\u4efd\uff0c\u5219\u53ef\u57fa\u4e8e\u5982\u4e0b\u547d\u4ee4\u521b\u5efa\u6b64\u7c7b\u7528\u6237\uff1a mysql> CREATE USER 'backuser'@'localhost' IDENTIFIED BY 'backuser'; \u521b\u5efa\u7528\u6237 mysql> REVOKE ALL PRIVILEGES,GRANT OPTION FROM 'backuser'@'localhost'; \u56de\u6536\u6b64\u7528\u6237\u6240\u6709\u6743\u9650 mysql> GRANT RELOAD,LOCK TABLES,REPLICATION CLIENT ON *.* TO 'baskuser'@'localhost'; \u6388\u6743\u5237\u65b0\u3001\u9501\u5b9a\u8868\u3001\u7528\u6237\u67e5\u770b\u670d\u52a1\u5668\u72b6\u6001 mysql> FLUSH PRIVILEGES; \u5237\u65b0\u6388\u6743\u8868 \u6ce8\u610f \u5907\u4efd\u8fc7\u7a0b : \u5907\u4efd\u65f6\u9700\u542f\u52a8 MySQL , \u6062\u590d\u65f6\u9700\u5173\u95ed MySQL , \u6e05\u7a7a mysql\u6570\u636e\u76ee\u5f55\u4e14\u4e0d\u80fd\u91cd\u65b0\u521d\u59cb\u5316 , \u6062\u590d\u6570\u636e\u540e\u5e94\u8be5\u7acb\u5373\u8fdb\u884c\u4e00\u6b21\u5b8c\u5168\u5907\u4efd 4. xtrabackup \u64cd\u4f5c \u00b6 4.1 \u57fa\u4e8e\u5168\u91cf\u7684\u5907\u4efd\u4e0e\u6062\u590d \u00b6 4.1.1 \u5168\u91cf\u5907\u4efd \u00b6 \u5168\u91cf\u5907\u4efd\u4e0e\u6062\u590d \u5907\u4efd innobackupex --user=root --password=root --defaults-file=/etc/my.cnf /opt/ \u6062\u590d innobackupex --apply-log /opt/2017-01-05_11-04-55/ innobackupex --copy-back --defaults-file=/etc/my.cnf /opt/2017-01-05_11-04-55/ \u5b8c\u5168\u5907\u4efd\uff1a [root@localhost backup]# mysqladmin -uroot password root Warning: Using a password on the command line interface can be insecure. [root@localhost opt]# innobackupex --user=root --password=root --defaults-file=/etc/my.cnf /opt/ InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy and Percona LLC and/or its affiliates 2009-2013. All Rights Reserved. This software is published under the GNU GENERAL PUBLIC LICENSE Version 2, June 1991. Get the latest version of Percona XtraBackup, documentation, and help resources: http://www.percona.com/xb/p 170105 11:04:55 innobackupex: Executing a version check against the server... 170105 11:04:55 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 11:04:55 innobackupex: Connected to MySQL server 170105 11:04:55 innobackupex: Done. 170105 11:04:55 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 11:04:55 innobackupex: Connected to MySQL server 170105 11:04:55 innobackupex: Starting the backup operation IMPORTANT: Please check that the backup run completes successfully. At the end of a successful backup run innobackupex prints \"completed OK!\". innobackupex: Using server version 5.6.35-log innobackupex: Created backup directory /opt/2017-01-05_11-04-55 170105 11:04:55 innobackupex: Starting ibbackup with command: xtrabackup --defaults-file=\"/etc/my.cnf\" --defaults-group=\"mysqld\" --backup --suspend-at-end --target-dir=/opt/2017-01-05_11-04-55 --innodb_log_file_size=\"50331648\" --innodb_data_file_path=\"ibdata1:12M:autoextend\" --tmpdir=/tmp --extra-lsndir='/tmp' innobackupex: Waiting for ibbackup (pid=25098) to suspend innobackupex: Suspend file '/opt/2017-01-05_11-04-55/xtrabackup_suspended_2' xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3) xtrabackup: uses posix_fadvise(). xtrabackup: cd to /var/lib/mysql xtrabackup: open files limit requested 0, set to 1024 xtrabackup: using the following InnoDB configuration: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 2 xtrabackup: innodb_log_file_size = 50331648 >> log scanned up to (1666902) xtrabackup: Generating a list of tablespaces [01] Copying ./ibdata1 to /opt/2017-01-05_11-04-55/ibdata1 [01] ...done [01] Copying ./mysql/innodb_table_stats.ibd to /opt/2017-01-05_11-04-55/mysql/innodb_table_stats.ibd [01] ...done [01] Copying ./mysql/innodb_index_stats.ibd to /opt/2017-01-05_11-04-55/mysql/innodb_index_stats.ibd [01] ...done [01] Copying ./mysql/slave_relay_log_info.ibd to /opt/2017-01-05_11-04-55/mysql/slave_relay_log_info.ibd [01] ...done [01] Copying ./mysql/slave_master_info.ibd to /opt/2017-01-05_11-04-55/mysql/slave_master_info.ibd [01] ...done [01] Copying ./mysql/slave_worker_info.ibd to /opt/2017-01-05_11-04-55/mysql/slave_worker_info.ibd [01] ...done [01] Copying ./leco/student.ibd to /opt/2017-01-05_11-04-55/leco/student.ibd [01] ...done >> log scanned up to (1666902) xtrabackup: Creating suspend file '/opt/2017-01-05_11-04-55/xtrabackup_suspended_2' with pid '25098' 170105 11:04:57 innobackupex: Continuing after ibbackup has suspended 170105 11:04:57 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG TABLES... >> log scanned up to (1666902) 170105 11:04:57 innobackupex: Executing FLUSH TABLES WITH READ LOCK... 170105 11:04:57 innobackupex: All tables locked and flushed to disk 170105 11:04:57 innobackupex: Starting to backup non-InnoDB tables and files innobackupex: in subdirectories of '/var/lib/mysql/' innobackupex: Backing up files '/var/lib/mysql//mysql/*.{frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par}' (74 files) innobackupex: Backing up file '/var/lib/mysql//leco/db.opt' innobackupex: Backing up file '/var/lib/mysql//leco/student.frm' innobackupex: Backing up files '/var/lib/mysql//performance_schema/*.{frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par}' (53 files) 170105 11:04:58 innobackupex: Finished backing up non-InnoDB tables and files 170105 11:04:58 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS... 170105 11:04:58 innobackupex: Waiting for log copying to finish xtrabackup: The latest check point (for incremental): '1666902' xtrabackup: Stopping log copying thread. .>> log scanned up to (1666902) xtrabackup: Creating suspend file '/opt/2017-01-05_11-04-55/xtrabackup_log_copied' with pid '25098' xtrabackup: Transaction log of lsn (1666902) to (1666902) was copied. 170105 11:04:59 innobackupex: All tables unlocked innobackupex: Backup created in directory '/opt/2017-01-05_11-04-55' innobackupex: MySQL binlog position: filename 'mysql-bin.000001', position 430 170105 11:04:59 innobackupex: Connection to database server closed 170105 11:04:59 innobackupex: completed OK! \u8bed\u6cd5\u89e3\u91ca innobackupex -- user = root -- password = root -- defaults - file =/ etc / my . cnf / opt / \u8bed\u6cd5\u89e3\u91ca\u8bf4\u660e\uff1a 1. -- user = root \u6307\u5b9a\u5907\u4efd\u7684\u7528\u6237 2. -- password = root\u6307\u5b9a\u5907\u4efd\u7528\u6237\u7684\u5bc6\u7801 3. -- defaults - file =/ etc / my . cnf \u6307\u5b9a\u7684\u5907\u4efd\u6570\u636e\u7684\u914d\u7f6e\u6587\u4ef6 4. / opt / \u6307\u5b9a\u5907\u4efd\u540e\u7684\u6570\u636e\u4fdd\u5b58\u8def\u5f84 \u8bf4\u660e \u5728\u5907\u4efd\u7684\u540c\u65f6\uff0c\u5907\u4efd\u6570\u636e\u4f1a\u5728\u5907\u4efd\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u4ee5\u5f53\u524d\u65f6\u95f4\u4e3a\u540d\u5b57\u7684\u76ee\u5f55\u5b58\u653e\u5907\u4efd\u6587\u4ef6\u3002 \u5404\u6587\u4ef6\u8bf4\u660e\uff1a \uff08 1 \uff09 xtrabackup_checkpoints \u2014 - \u5907\u4efd\u7c7b\u578b\uff08\u5982\u5b8c\u5168\u6216\u589e\u91cf\uff09\u3001\u5907\u4efd\u72b6\u6001\uff08\u5982\u662f\u5426\u5df2\u7ecf\u6ca1 prepare\u72b6\u6001 \uff09\u548c LSN \uff08\u65e5\u5fd7\u5e8f\u5217\u53f7\uff09\u8303\u56f4\u4fe1\u606f \u6bcf\u4e2a InnoDB\u9875 \uff08\u901a\u5e38\u5927\u5c0f\u4e3a 16 K \uff09\u90fd\u4f1a\u5305\u542b\u4e00\u4e2a\u65e5\u5fd7\u5e8f\u5217\u53f7\uff0c\u5373 LSN \uff0c LSN\u662f\u6574\u4e2a\u6570\u636e\u5e93\u7cfb\u7edf\u7684\u7cfb\u7edf\u7248\u672c\u53f7 \uff0c\u6bcf\u4e2a\u9875\u9762\u76f8\u5173\u7684 LSN\u80fd\u591f\u8868\u540d\u6b64\u9875\u9762\u6700\u8fd1\u662f\u5982\u4f55\u53d1\u751f\u6539\u53d8\u7684 \u3002 backup_type = full - backuped from_lsn = 0 to_lsn = 2097320 last_lsn = 2097320 compact = 0 \uff08 2 \uff09 xtrabackup_binlog_info \u2014 - mysql\u670d\u52a1\u5668\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u53ca\u5907\u4efd\u8fd9\u4e00\u523b\u4e3a\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e8b\u4ef6\u7684\u4f4d\u7f6e \uff08 3 \uff09 xtrabackup_pos_innodb \u2014 - \u4e8c\u8fdb\u5236\u65e5\u5fd7\u53ca\u7528\u4e8e InnoDB\u6216XtraDB\u8868\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7684\u5f53\u524dposistion \u3002 \uff08 4 \uff09 xtrabackup_binary \u2014 - \u5907\u4efd\u4e2d\u7528\u5230\u7684 xtrabackup\u7684\u53ef\u6267\u884c\u6587\u4ef6 \uff08 5 \uff09 backup - my . cnf \u2014 - \u5907\u4efd\u547d\u4ee4\u7528\u5230\u7684\u914d\u7f6e\u9009\u9879\u4fe1\u606f\uff1b \u5728\u4f7f\u7528 innobackupex\u547d\u4ee4\u5907\u4efd\u65f6\u5417\u8fd8\u53ef\u4ee5\u4f7f\u7528 \u2013 no - timestamp\u9009\u9879\u6765\u963b\u6b62\u547d\u4ee4\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u4ee5\u65f6\u95f4\u547d\u540d\u7684\u76ee\u5f55 innobackupex\u547d\u4ee4\u5c06\u4f1a\u521b\u5efa\u4e00\u4e2aBACKUP - DIR\u76ee\u5f55\u6765\u5b58\u50a8\u5907\u4efd\u6570\u636e \u8fd8\u9700\u8981\u6ce8\u610f\uff0c\u5907\u4efd\u6570\u636e\u5e93\u7684\u7528\u6237\u9700\u8981\u5177\u6709\u76f8\u5bf9\u5e94\u7684\u6743\u9650\uff0c\u5982\u679c\u8981\u4f7f\u7528\u4e00\u4e2a\u6700\u5c0f\u6743\u9650\u7684\u7528\u6237\u8fdb\u884c\u5907\u4efd\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u53c2\u6570\uff1a mysql > GRANT RELOAD , LOCK TABLES , REPLICATION CLIENT ON *.* TO \u2018 bkpuser \u2019@\u2019 localhost \u2019 ; mysql > FLUSH PRIVILEGES ; \u5728\u4f7f\u7528innobackupex\u8fdb\u884c\u5907\u4efd [root@localhost opt]# ll /opt/ total 4 drwxr-xr-x. 5 root root 4096 Jan 5 11:04 2017-01-05_11-04-55 [root@localhost opt]# systemctl stop mysql [root@localhost opt]# grep datadir /etc/my.cnf datadir=/var/lib/mysql [root@localhost opt]# cd /var/lib/mysql [root@localhost mysql]# rm -rf * 4.1.2 \u5168\u91cf\u5907\u4efd\u6062\u590d \u00b6 \u51c6\u5907\u4e00\u4e2a\u5b8c\u6574\u5907\u4efd\uff08prepare\uff09 \u5728\u4f7f\u7528innobackup\u8fdb\u884c\u5907\u4efd\u65f6\u5019\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528--no-timestamp\u9009\u9879\u6765\u963b\u6b62\u547d\u4ee4\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u65f6\u95f4\u547d\u540d\u7684\u76ee\u5f55\u3002\u5982\u6b64\u4e00\u6765\uff0cinnobackupex\u547d\u4ee4\u5c06\u4f1a\u521b\u5efa\u4e00\u4e2aBACKUP-DIR\u76ee\u5f55\u6765\u50a8\u5b58\u5907\u4efd\u6570\u636e\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5728\u5907\u4efd\u5b8c\u6210\u540e\uff0c\u6570\u636e\u4e14\u5c1a\u4e0d\u80fd\u7528\u4e8e\u6062\u590d\u64cd\u4f5c\uff0c\u56e0\u4e3a\u5907\u4efd\u7684\u6570\u636e\u4e2d\u53ef\u80fd\u5305\u542b\u5c1a\u672a\u63d0\u4ea4\u7684\u4e8b\u7269\u6216\u8005\u5df2\u7ecf\u63d0\u4ea4\u4f46\u5c1a\u672a\u540c\u6b65\u81f3\u6570\u636e\u6587\u4ef6\u4e2d\u7684\u4e8b\u7269\uff0c\u56e0\u6b64\u6b64\u65f6\u6570\u636e\u6587\u4ef6\u4ecd\u7136\u5904\u4e8e\u4e0d\u4e00\u81f4\u72b6\u6001\uff0c\u51c6\u5907\u7684\u4e3b\u8981\u4f5c\u7528\u6b63\u662f\u901a\u8fc7\u56de\u6eda\u672a\u63d0\u4ea4\u7684\u4e8b\u7269\u53ca\u540c\u6b65\u5df2\u7ecf\u63d0\u4ea4\u7684\u4e8b\u7269\u81f3\u6570\u636e\u6587\u4ef6\u4e5f\u4f7f\u5f97\u6570\u636e\u6587\u4ef6\u5904\u4e8e\u4e00\u81f4\u72b6\u6001\u3002 Innobackupex\uff0c\u547d\u4ee4\u7684--apply-log\u9009\u9879\u53ef\u4ee5\u5b9e\u73b0\u4e0a\u8ff0\u529f\u80fd\u3002 [root@localhost mysql]# innobackupex --apply-log /opt/2017-01-05_11-04-55/ InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy and Percona LLC and/or its affiliates 2009-2013. All Rights Reserved. This software is published under the GNU GENERAL PUBLIC LICENSE Version 2, June 1991. Get the latest version of Percona XtraBackup, documentation, and help resources: http://www.percona.com/xb/p 170105 11:19:14 innobackupex: Starting the apply-log operation IMPORTANT: Please check that the apply-log run completes successfully. At the end of a successful apply-log run innobackupex prints \"completed OK!\". 170105 11:19:14 innobackupex: Starting ibbackup with command: xtrabackup --defaults-file=\"/opt/2017-01-05_11-04-55/backup-my.cnf\" --defaults-group=\"mysqld\" --prepare --target-dir=/opt/2017-01-05_11-04-55 xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3) xtrabackup: cd to /opt/2017-01-05_11-04-55 xtrabackup: This target seems to be not prepared yet. xtrabackup: xtrabackup_logfile detected: size=2097152, start_lsn=(1666902) xtrabackup: using the following InnoDB configuration for recovery: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 1 xtrabackup: innodb_log_file_size = 2097152 xtrabackup: using the following InnoDB configuration for recovery: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 1 xtrabackup: innodb_log_file_size = 2097152 xtrabackup: Starting InnoDB instance for recovery. xtrabackup: Using 104857600 bytes for buffer pool (set by --use-memory parameter) InnoDB: Using atomics to ref count buffer pool pages InnoDB: The InnoDB memory heap is disabled InnoDB: Mutexes and rw_locks use GCC atomic builtins InnoDB: Memory barrier is not used InnoDB: Compressed tables use zlib 1.2.7 InnoDB: Using CPU crc32 instructions InnoDB: Initializing buffer pool, size = 100.0M InnoDB: Completed initialization of buffer pool InnoDB: Highest supported file format is Barracuda. InnoDB: The log sequence numbers 1663530 and 1663530 in ibdata files do not match the log sequence number 1666902 in the ib_logfiles! InnoDB: Database was not shutdown normally! InnoDB: Starting crash recovery. InnoDB: Reading tablespace information from the .ibd files... InnoDB: Restoring possible half-written data pages InnoDB: from the doublewrite buffer... InnoDB: Last MySQL binlog file position 0 1451, file name mysql-bin.000001 InnoDB: 128 rollback segment(s) are active. InnoDB: Waiting for purge to start InnoDB: 5.6.24 started; log sequence number 1666902 [notice (again)] If you use binary log and don't use any hack of group commit, the binary log position seems to be: InnoDB: Last MySQL binlog file position 0 1451, file name mysql-bin.000001 xtrabackup: starting shutdown with innodb_fast_shutdown = 1 InnoDB: FTS optimize thread exiting. InnoDB: Starting shutdown... InnoDB: Shutdown completed; log sequence number 1666912 170105 11:19:16 innobackupex: Restarting xtrabackup with command: xtrabackup --defaults-file=\"/opt/2017-01-05_11-04-55/backup-my.cnf\" --defaults-group=\"mysqld\" --prepare --target-dir=/opt/2017-01-05_11-04-55 for creating ib_logfile* xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3) xtrabackup: cd to /opt/2017-01-05_11-04-55 xtrabackup: This target seems to be already prepared. xtrabackup: notice: xtrabackup_logfile was already used to '--prepare'. xtrabackup: using the following InnoDB configuration for recovery: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 2 xtrabackup: innodb_log_file_size = 50331648 xtrabackup: using the following InnoDB configuration for recovery: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 2 xtrabackup: innodb_log_file_size = 50331648 xtrabackup: Starting InnoDB instance for recovery. xtrabackup: Using 104857600 bytes for buffer pool (set by --use-memory parameter) InnoDB: Using atomics to ref count buffer pool pages InnoDB: The InnoDB memory heap is disabled InnoDB: Mutexes and rw_locks use GCC atomic builtins InnoDB: Memory barrier is not used InnoDB: Compressed tables use zlib 1.2.7 InnoDB: Using CPU crc32 instructions InnoDB: Initializing buffer pool, size = 100.0M InnoDB: Completed initialization of buffer pool InnoDB: Setting log file ./ib_logfile101 size to 48 MB InnoDB: Setting log file ./ib_logfile1 size to 48 MB InnoDB: Renaming log file ./ib_logfile101 to ./ib_logfile0 InnoDB: New log files created, LSN=1666912 InnoDB: Highest supported file format is Barracuda. InnoDB: 128 rollback segment(s) are active. InnoDB: Waiting for purge to start InnoDB: 5.6.24 started; log sequence number 1667084 [notice (again)] If you use binary log and don't use any hack of group commit, the binary log position seems to be: InnoDB: Last MySQL binlog file position 0 1451, file name mysql-bin.000001 xtrabackup: starting shutdown with innodb_fast_shutdown = 1 InnoDB: FTS optimize thread exiting. InnoDB: Starting shutdown... InnoDB: Shutdown completed; log sequence number 1667094 170105 11:19:18 innobackupex: completed OK! \u5185\u5b58\u6307\u5b9a \u5728\u5b9e\u73b0\u51c6\u5907\u8fc7\u7a0b\u4e2d\uff0c innobackupex\u901a\u5e38\u8fd8\u53ef\u4ee5\u4f7f\u7528 -- user - memory\u9009\u9879\u6765\u6307\u5b9a\u5176\u53ef\u4ee5\u4f7f\u7528\u7684\u5185\u5b58\u5927\u5c0f \u3002\u9ed8\u8ba4\u901a\u5e38\u662f 100 M \uff0c\u5982\u679c\u6709\u8db3\u591f\u7684\u5185\u5b58\u4f7f\u7528\uff0c\u53ef\u4ee5\u591a\u5212\u5206\u4e00\u4e9b\u7ed9\u5185\u5b58\u51c6\u5907 prepare \uff0c\u4ee5\u63d0\u9ad8\u5176\u5b8c\u6210\u901f\u5ea6\u3002 \u4ece\u4e00\u4e2a\u5b8c\u6574\u5907\u4efd\u4e2d\u6062\u590d\u6570\u636e. Innobackupex\u547d\u4ee4\u7684--copy-back\u9009\u9879\u7528\u4e8e\u6267\u884c\u6062\u590d\u64cd\u4f5c\uff0c\u5176\u901a\u8fc7\u590d\u5236\u6240\u6709\u7684\u6570\u636e\u76f8\u5173\u6587\u4ef6\u5230mysql\u670d\u52a1\u5668\u7684DATADIR\u76ee\u5f55\u6765\u6267\u884c\u6062\u590d\u8fc7\u7a0b\uff0cinnobackupex\u901a\u8fc7backup-my.cnf\u6765\u83b7\u53d6DATADIR\u76ee\u5f55\u76f8\u5173\u4fe1\u606f\u3002 \u5f00\u59cb\u6062\u590d [root@localhost mysql]# innobackupex --copy-back --defaults-file=/etc/my.cnf /opt/2017-01-05_11-04-55/ InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy and Percona LLC and/or its affiliates 2009-2013. All Rights Reserved. This software is published under the GNU GENERAL PUBLIC LICENSE Version 2, June 1991. Get the latest version of Percona XtraBackup, documentation, and help resources: http://www.percona.com/xb/p 170105 11:26:34 innobackupex: Starting the copy-back operation IMPORTANT: Please check that the copy-back run completes successfully. At the end of a successful copy-back run innobackupex prints \"completed OK!\". innobackupex: Starting to copy files in '/opt/2017-01-05_11-04-55' innobackupex: back to original data directory '/var/lib/mysql' innobackupex: Copying '/opt/2017-01-05_11-04-55/xtrabackup_info' to '/var/lib/mysql/xtrabackup_info' innobackupex: Copying '/opt/2017-01-05_11-04-55/xtrabackup_binlog_pos_innodb' to '/var/lib/mysql/xtrabackup_binlog_pos_innodb' innobackupex: Creating directory '/var/lib/mysql/mysql' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/innodb_table_stats.ibd' to '/var/lib/mysql/mysql/innodb_table_stats.ibd' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/innodb_index_stats.ibd' to '/var/lib/mysql/mysql/innodb_index_stats.ibd' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slave_relay_log_info.ibd' to '/var/lib/mysql/mysql/slave_relay_log_info.ibd' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slave_master_info.ibd' to '/var/lib/mysql/mysql/slave_master_info.ibd' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slave_worker_info.ibd' to '/var/lib/mysql/mysql/slave_worker_info.ibd' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/db.frm' to '/var/lib/mysql/mysql/db.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/db.MYI' to '/var/lib/mysql/mysql/db.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/db.MYD' to '/var/lib/mysql/mysql/db.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/user.frm' to '/var/lib/mysql/mysql/user.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/user.MYI' to '/var/lib/mysql/mysql/user.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/user.MYD' to '/var/lib/mysql/mysql/user.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/func.frm' to '/var/lib/mysql/mysql/func.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/func.MYI' to '/var/lib/mysql/mysql/func.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/func.MYD' to '/var/lib/mysql/mysql/func.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/plugin.frm' to '/var/lib/mysql/mysql/plugin.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/plugin.MYI' to '/var/lib/mysql/mysql/plugin.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/plugin.MYD' to '/var/lib/mysql/mysql/plugin.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/servers.frm' to '/var/lib/mysql/mysql/servers.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/servers.MYI' to '/var/lib/mysql/mysql/servers.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/servers.MYD' to '/var/lib/mysql/mysql/servers.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/tables_priv.frm' to '/var/lib/mysql/mysql/tables_priv.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/tables_priv.MYI' to '/var/lib/mysql/mysql/tables_priv.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/tables_priv.MYD' to '/var/lib/mysql/mysql/tables_priv.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/columns_priv.frm' to '/var/lib/mysql/mysql/columns_priv.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/columns_priv.MYI' to '/var/lib/mysql/mysql/columns_priv.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/columns_priv.MYD' to '/var/lib/mysql/mysql/columns_priv.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_topic.frm' to '/var/lib/mysql/mysql/help_topic.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_topic.MYI' to '/var/lib/mysql/mysql/help_topic.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_topic.MYD' to '/var/lib/mysql/mysql/help_topic.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_category.frm' to '/var/lib/mysql/mysql/help_category.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_category.MYI' to '/var/lib/mysql/mysql/help_category.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_category.MYD' to '/var/lib/mysql/mysql/help_category.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_relation.frm' to '/var/lib/mysql/mysql/help_relation.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_relation.MYI' to '/var/lib/mysql/mysql/help_relation.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_relation.MYD' to '/var/lib/mysql/mysql/help_relation.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_keyword.frm' to '/var/lib/mysql/mysql/help_keyword.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_keyword.MYI' to '/var/lib/mysql/mysql/help_keyword.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_keyword.MYD' to '/var/lib/mysql/mysql/help_keyword.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_name.frm' to '/var/lib/mysql/mysql/time_zone_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_name.MYI' to '/var/lib/mysql/mysql/time_zone_name.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_name.MYD' to '/var/lib/mysql/mysql/time_zone_name.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone.frm' to '/var/lib/mysql/mysql/time_zone.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone.MYI' to '/var/lib/mysql/mysql/time_zone.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone.MYD' to '/var/lib/mysql/mysql/time_zone.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_transition.frm' to '/var/lib/mysql/mysql/time_zone_transition.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_transition.MYI' to '/var/lib/mysql/mysql/time_zone_transition.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_transition.MYD' to '/var/lib/mysql/mysql/time_zone_transition.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_transition_type.frm' to '/var/lib/mysql/mysql/time_zone_transition_type.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_transition_type.MYI' to '/var/lib/mysql/mysql/time_zone_transition_type.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_transition_type.MYD' to '/var/lib/mysql/mysql/time_zone_transition_type.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_leap_second.frm' to '/var/lib/mysql/mysql/time_zone_leap_second.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_leap_second.MYI' to '/var/lib/mysql/mysql/time_zone_leap_second.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_leap_second.MYD' to '/var/lib/mysql/mysql/time_zone_leap_second.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/proc.frm' to '/var/lib/mysql/mysql/proc.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/proc.MYI' to '/var/lib/mysql/mysql/proc.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/proc.MYD' to '/var/lib/mysql/mysql/proc.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/procs_priv.frm' to '/var/lib/mysql/mysql/procs_priv.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/procs_priv.MYI' to '/var/lib/mysql/mysql/procs_priv.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/procs_priv.MYD' to '/var/lib/mysql/mysql/procs_priv.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/general_log.frm' to '/var/lib/mysql/mysql/general_log.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/general_log.CSM' to '/var/lib/mysql/mysql/general_log.CSM' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/general_log.CSV' to '/var/lib/mysql/mysql/general_log.CSV' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slow_log.frm' to '/var/lib/mysql/mysql/slow_log.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slow_log.CSM' to '/var/lib/mysql/mysql/slow_log.CSM' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slow_log.CSV' to '/var/lib/mysql/mysql/slow_log.CSV' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/event.frm' to '/var/lib/mysql/mysql/event.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/event.MYI' to '/var/lib/mysql/mysql/event.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/event.MYD' to '/var/lib/mysql/mysql/event.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/ndb_binlog_index.frm' to '/var/lib/mysql/mysql/ndb_binlog_index.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/ndb_binlog_index.MYI' to '/var/lib/mysql/mysql/ndb_binlog_index.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/ndb_binlog_index.MYD' to '/var/lib/mysql/mysql/ndb_binlog_index.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/innodb_table_stats.frm' to '/var/lib/mysql/mysql/innodb_table_stats.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/innodb_index_stats.frm' to '/var/lib/mysql/mysql/innodb_index_stats.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slave_relay_log_info.frm' to '/var/lib/mysql/mysql/slave_relay_log_info.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slave_master_info.frm' to '/var/lib/mysql/mysql/slave_master_info.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slave_worker_info.frm' to '/var/lib/mysql/mysql/slave_worker_info.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/proxies_priv.frm' to '/var/lib/mysql/mysql/proxies_priv.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/proxies_priv.MYI' to '/var/lib/mysql/mysql/proxies_priv.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/proxies_priv.MYD' to '/var/lib/mysql/mysql/proxies_priv.MYD' innobackupex: Creating directory '/var/lib/mysql/leco' innobackupex: Copying '/opt/2017-01-05_11-04-55/leco/student.ibd' to '/var/lib/mysql/leco/student.ibd' innobackupex: Copying '/opt/2017-01-05_11-04-55/leco/db.opt' to '/var/lib/mysql/leco/db.opt' innobackupex: Copying '/opt/2017-01-05_11-04-55/leco/student.frm' to '/var/lib/mysql/leco/student.frm' innobackupex: Creating directory '/var/lib/mysql/performance_schema' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/db.opt' to '/var/lib/mysql/performance_schema/db.opt' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/cond_instances.frm' to '/var/lib/mysql/performance_schema/cond_instances.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_current.frm' to '/var/lib/mysql/performance_schema/events_waits_current.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_history.frm' to '/var/lib/mysql/performance_schema/events_waits_history.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_history_long.frm' to '/var/lib/mysql/performance_schema/events_waits_history_long.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_summary_by_instance.frm' to '/var/lib/mysql/performance_schema/events_waits_summary_by_instance.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_summary_by_host_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_waits_summary_by_host_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_summary_by_user_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_waits_summary_by_user_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_summary_by_account_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_waits_summary_by_account_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_summary_by_thread_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_waits_summary_by_thread_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_summary_global_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_waits_summary_global_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/file_instances.frm' to '/var/lib/mysql/performance_schema/file_instances.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/file_summary_by_event_name.frm' to '/var/lib/mysql/performance_schema/file_summary_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/file_summary_by_instance.frm' to '/var/lib/mysql/performance_schema/file_summary_by_instance.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/socket_instances.frm' to '/var/lib/mysql/performance_schema/socket_instances.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/socket_summary_by_instance.frm' to '/var/lib/mysql/performance_schema/socket_summary_by_instance.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/socket_summary_by_event_name.frm' to '/var/lib/mysql/performance_schema/socket_summary_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/host_cache.frm' to '/var/lib/mysql/performance_schema/host_cache.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/mutex_instances.frm' to '/var/lib/mysql/performance_schema/mutex_instances.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/objects_summary_global_by_type.frm' to '/var/lib/mysql/performance_schema/objects_summary_global_by_type.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/performance_timers.frm' to '/var/lib/mysql/performance_schema/performance_timers.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/rwlock_instances.frm' to '/var/lib/mysql/performance_schema/rwlock_instances.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/setup_actors.frm' to '/var/lib/mysql/performance_schema/setup_actors.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/setup_consumers.frm' to '/var/lib/mysql/performance_schema/setup_consumers.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/setup_instruments.frm' to '/var/lib/mysql/performance_schema/setup_instruments.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/setup_objects.frm' to '/var/lib/mysql/performance_schema/setup_objects.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/setup_timers.frm' to '/var/lib/mysql/performance_schema/setup_timers.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/table_io_waits_summary_by_index_usage.frm' to '/var/lib/mysql/performance_schema/table_io_waits_summary_by_index_usage.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/table_io_waits_summary_by_table.frm' to '/var/lib/mysql/performance_schema/table_io_waits_summary_by_table.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/table_lock_waits_summary_by_table.frm' to '/var/lib/mysql/performance_schema/table_lock_waits_summary_by_table.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/threads.frm' to '/var/lib/mysql/performance_schema/threads.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_current.frm' to '/var/lib/mysql/performance_schema/events_stages_current.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_history.frm' to '/var/lib/mysql/performance_schema/events_stages_history.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_history_long.frm' to '/var/lib/mysql/performance_schema/events_stages_history_long.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_summary_by_thread_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_stages_summary_by_thread_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_summary_by_host_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_stages_summary_by_host_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_summary_by_user_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_stages_summary_by_user_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_summary_by_account_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_stages_summary_by_account_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_summary_global_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_stages_summary_global_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_current.frm' to '/var/lib/mysql/performance_schema/events_statements_current.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_history.frm' to '/var/lib/mysql/performance_schema/events_statements_history.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_history_long.frm' to '/var/lib/mysql/performance_schema/events_statements_history_long.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_summary_by_thread_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_statements_summary_by_thread_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_summary_by_host_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_statements_summary_by_host_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_summary_by_user_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_statements_summary_by_user_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_summary_by_account_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_statements_summary_by_account_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_summary_global_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_statements_summary_global_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/hosts.frm' to '/var/lib/mysql/performance_schema/hosts.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/users.frm' to '/var/lib/mysql/performance_schema/users.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/accounts.frm' to '/var/lib/mysql/performance_schema/accounts.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_summary_by_digest.frm' to '/var/lib/mysql/performance_schema/events_statements_summary_by_digest.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/session_connect_attrs.frm' to '/var/lib/mysql/performance_schema/session_connect_attrs.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/session_account_connect_attrs.frm' to '/var/lib/mysql/performance_schema/session_account_connect_attrs.frm' innobackupex: Starting to copy InnoDB system tablespace innobackupex: in '/opt/2017-01-05_11-04-55' innobackupex: back to original InnoDB data directory '/var/lib/mysql' innobackupex: Copying '/opt/2017-01-05_11-04-55/ibdata1' to '/var/lib/mysql/ibdata1' innobackupex: Starting to copy InnoDB undo tablespaces innobackupex: in '/opt/2017-01-05_11-04-55' innobackupex: back to '/var/lib/mysql' innobackupex: Starting to copy InnoDB log files innobackupex: in '/opt/2017-01-05_11-04-55' innobackupex: back to original InnoDB log directory '/var/lib/mysql' innobackupex: Copying '/opt/2017-01-05_11-04-55/ib_logfile1' to '/var/lib/mysql/ib_logfile1' innobackupex: Copying '/opt/2017-01-05_11-04-55/ib_logfile0' to '/var/lib/mysql/ib_logfile0' innobackupex: Finished copying back files. 170105 11:26:35 innobackupex: completed OK! \u6062\u590d\u6210\u529f\u3002 [root@localhost mysql]# ll total 110608 -rw-r--r--. 1 root root 12582912 Jan 5 11:26 ibdata1 -rw-r--r--. 1 root root 50331648 Jan 5 11:26 ib_logfile0 -rw-r--r--. 1 root root 50331648 Jan 5 11:26 ib_logfile1 drwxr-xr-x. 2 root root 55 Jan 5 11:26 leco drwxr-xr-x. 2 root root 4096 Jan 5 11:26 mysql drwxr-xr-x. 2 root root 4096 Jan 5 11:26 performance_schema -rw-r--r--. 1 root root 22 Jan 5 11:26 xtrabackup_binlog_pos_innodb -rw-r--r--. 1 root root 584 Jan 5 11:26 xtrabackup_info \u6240\u5c5e\u7ec4\u53d8\u66f4 \u6b64\u65f6\u6570\u636e\u6062\u590d\u5230 DATADIR\u76ee\u5f55\u540e \uff0c\u8fd8\u8981\u786e\u4fdd\u6240\u6709\u6570\u636e\u6587\u4ef6\u5c5e\u6027\u4e3a\u6b63\u786e\u7528\u6237\u548c\u7ec4\uff0c\u5982 MySQL \uff0c\u5426\u5219\u542f\u52a8\u4e0d\u4e86\u3002 [root@localhost mysql]# chown -R mysql.mysql . [root@localhost mysql]# ll total 110608 -rw-r--r--. 1 mysql mysql 12582912 Jan 5 11:26 ibdata1 -rw-r--r--. 1 mysql mysql 50331648 Jan 5 11:26 ib_logfile0 -rw-r--r--. 1 mysql mysql 50331648 Jan 5 11:26 ib_logfile1 drwxr-xr-x. 2 mysql mysql 55 Jan 5 11:26 leco drwxr-xr-x. 2 mysql mysql 4096 Jan 5 11:26 mysql drwxr-xr-x. 2 mysql mysql 4096 Jan 5 11:26 performance_schema -rw-r--r--. 1 mysql mysql 22 Jan 5 11:26 xtrabackup_binlog_pos_innodb -rw-r--r--. 1 mysql mysql 584 Jan 5 11:26 xtrabackup_info [root@localhost mysql]# systemctl start mysql [root@localhost mysql]# ll total 110620 -rw-rw----. 1 mysql mysql 56 Jan 5 11:28 auto.cnf -rw-r--r--. 1 mysql mysql 12582912 Jan 5 11:28 ibdata1 -rw-r--r--. 1 mysql mysql 50331648 Jan 5 11:28 ib_logfile0 -rw-r--r--. 1 mysql mysql 50331648 Jan 5 11:26 ib_logfile1 drwxr-xr-x. 2 mysql mysql 55 Jan 5 11:26 leco drwxr-xr-x. 2 mysql mysql 4096 Jan 5 11:26 mysql -rw-rw----. 1 mysql mysql 120 Jan 5 11:28 mysql-bin.000001 -rw-rw----. 1 mysql mysql 19 Jan 5 11:28 mysql-bin.index srwxrwxrwx. 1 mysql mysql 0 Jan 5 11:28 mysql.sock drwxr-xr-x. 2 mysql mysql 4096 Jan 5 11:26 performance_schema -rw-r--r--. 1 mysql mysql 22 Jan 5 11:26 xtrabackup_binlog_pos_innodb -rw-r--r--. 1 mysql mysql 584 Jan 5 11:26 xtrabackup_info \u767b\u9646\u6d4b\u8bd5\u770b\u770b\u6ca1\u6709\u6ca1\u6062\u590d\u8fc7\u6765 [root@localhost mysql]# mysql -uroot -proot Warning: Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 2 Server version: 5.6.35-log MySQL Community Server (GPL) Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | leco | | mysql | | performance_schema | +--------------------+ 4 rows in set (0.02 sec) mysql> use leco; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +----------------+ | Tables_in_leco | +----------------+ | student | +----------------+ 1 row in set (0.02 sec) mysql> desc student; +-------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+-------+ | id | int(4) | NO | | NULL | | | name | char(20) | NO | | NULL | | | age | tinyint(2) | NO | | 0 | | | dept | varchar(16) | YES | | NULL | | +-------+-------------+------+-----+---------+-------+ 4 rows in set (0.01 sec) mysql> select * from student; +----+------+-----+------+ | id | name | age | dept | +----+------+-----+------+ | 1 | good | 15 | NULL | | 2 | hehe | 18 | NULL | | 1 | good | 15 | NULL | | 2 | hehe | 18 | NULL | +----+------+-----+------+ 4 rows in set (0.02 sec) \u5230\u73b0\u5728\u5168\u5907\u5df2\u7ecf\u6d4b\u8bd5OK. \u5148\u63d2\u5165\u51e0\u4e2a\u6570\u636e\uff0c\u4e3a\u589e\u91cf\u5907\u4efd\u505a\u51c6\u5907 mysql> insert into student(id,name,age) values(2,'beijing',100); Query OK, 1 row affected (0.01 sec) mysql> insert into student(id,name,age) values(2,'cmz',30); Query OK, 1 row affected (0.01 sec) mysql> select * from student; +----+---------+-----+------+ | id | name | age | dept | +----+---------+-----+------+ | 1 | good | 15 | NULL | | 2 | hehe | 18 | NULL | | 1 | good | 15 | NULL | | 2 | hehe | 18 | NULL | | 2 | beijing | 100 | NULL | | 2 | cmz | 30 | NULL | +----+---------+-----+------+ 6 rows in set (0.00 sec) 4.2 \u57fa\u4e8e\u5168\u91cf\u5907\u4efd\u589e\u91cf\u5907\u4efd\u4e0e\u6062\u590d \u00b6 4.2.1 \u589e\u91cf\u5907\u4efd \u00b6 \u6bcf\u4e2aInnoDB\u7684\u9875\u9762\u90fd\u4f1a\u5305\u542b\u4e00\u4e2aLSN\u4fe1\u606f\uff0c\u6bcf\u5f53\u76f8\u5173\u6570\u636e\u53d1\u751f\u6539\u53d8\uff0c\u76f8\u5173\u9875\u9762\u7684LSN\u4e5f\u4f1a\u81ea\u52a8\u589e\u957f\uff0c\u8fd9\u6b63\u662fInnoDB\u8868\u5c05\u6709\u8fdb\u884c\u589e\u91cf\u5907\u4efd\u7684\u57fa\u7840\uff0c\u5373innobackupex\u901a\u8fc7\u4e0a\u6b21\u5b8c\u5168\u5907\u4efd\u4e4b\u540e\u53d1\u751f\u6539\u53d8\u7684\u9875\u9762\u6765\u5b9e\u73b0\u3002\u5728\u8fdb\u884c\u589e\u91cf\u5907\u4efd\u65f6\uff0c\u9996\u5148\u8981\u8fdb\u884c\u4e00\u6b21\u5168\u91cf\u5907\u4efd\uff0c\u7b2c\u4e00\u6b21\u589e\u91cf\u5907\u4efd\u662f\u57fa\u4e8e\u5168\u5907\u7684\uff0c\u4e4b\u540e\u7684\u589e\u91cf\u5907\u4efd\u662f\u57fa\u4e8e\u4e0a\u4e00\u6b21\u7684\u589e\u91cf\u5907\u4efd\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002 \u8981\u5148\u5b9e\u73b0\u7b2c\u4e00\u6b21\u589e\u91cf\u5907\u4efd\u3002\u53ef\u4ee5\u5b9e\u73b0\u4e0b\u547d\u4ee4\u8fdb\u884c \u57fa\u4e8e\u5168\u91cf\u5907\u4efd\u7684\u589e\u91cf\u5907\u4efd\u4e0e\u6062\u590d \u505a\u4e00\u6b21\u589e\u91cf\u5907\u4efd\uff08\u57fa\u4e8e\u5f53\u524d\u6700\u65b0\u7684\u5168\u91cf\u5907\u4efd\uff09 innobackupex --user=root --password=root --defaults-file=/etc/my.cnf --incremental /opt/ --incremental-basedir=/opt/2017-01-05_11-04-55/ 1. \u51c6\u5907\u57fa\u4e8e\u5168\u91cf innobackupex --user=root --password=root --defaults-file=/etc/my.cnf --apply-log --redo-only /opt/2017-01-05_11-04-55/ 2. \u51c6\u5907\u57fa\u4e8e\u589e\u91cf innobackupex --user=root --password=root --defaults-file=/etc/my.cnf --apply-log --redo-only /opt/2017-01-05_11-04-55/ --incremental-dir=/opt/2017-01-05_11-44-22/ 3. \u6062\u590d innobackupex --copy-back --defaults-file=/etc/my.cnf /opt/2017-01-05_11-04-55/ \u89e3\u91ca 1.2017 - 01 - 05 _11 - 04 - 55 \u6307\u7684\u662f\u5b8c\u5168\u5907\u4efd\u6240\u5728\u7684\u76ee\u5f55\u3002 2.2017 - 01 - 05 _11 - 44 - 22 \u6307\u5b9a\u662f\u7b2c\u4e00\u6b21\u57fa\u4e8e 2017 - 01 - 05 _11 - 04 - 55 \u589e\u91cf\u5907\u4efd\u7684\u76ee\u5f55\uff0c\u5176\u4ed6\u7c7b\u4f3c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u5373\u5982\u679c\u6709\u591a\u6b21\u589e\u91cf\u5907\u4efd\u3002\u6bcf\u4e00\u6b21\u90fd\u8981\u6267\u884c\u5982\u4e0a\u64cd\u4f5c\u3002 \u5f00\u59cb [root@localhost mysql]# innobackupex --user=root --password=root --defaults-file=/etc/my.cnf --incremental /opt/ --incremental-basedir=/opt/2017-01-05_11-04-55/ InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy and Percona LLC and/or its affiliates 2009-2013. All Rights Reserved. This software is published under the GNU GENERAL PUBLIC LICENSE Version 2, June 1991. Get the latest version of Percona XtraBackup, documentation, and help resources: http://www.percona.com/xb/p 170105 11:44:22 innobackupex: Executing a version check against the server... 170105 11:44:22 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 11:44:22 innobackupex: Connected to MySQL server 170105 11:44:22 innobackupex: Done. 170105 11:44:22 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 11:44:22 innobackupex: Connected to MySQL server 170105 11:44:22 innobackupex: Starting the backup operation IMPORTANT: Please check that the backup run completes successfully. At the end of a successful backup run innobackupex prints \"completed OK!\". innobackupex: Using server version 5.6.35-log innobackupex: Created backup directory /opt/2017-01-05_11-44-22 170105 11:44:22 innobackupex: Starting ibbackup with command: xtrabackup --defaults-file=\"/etc/my.cnf\" --defaults-group=\"mysqld\" --backup --suspend-at-end --target-dir=/opt/2017-01-05_11-44-22 --innodb_log_file_size=\"50331648\" --innodb_data_file_path=\"ibdata1:12M:autoextend\" --tmpdir=/tmp --extra-lsndir='/tmp' --incremental-basedir='/opt/2017-01-05_11-04-55/' innobackupex: Waiting for ibbackup (pid=27861) to suspend innobackupex: Suspend file '/opt/2017-01-05_11-44-22/xtrabackup_suspended_2' xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3) incremental backup from 1666902 is enabled. xtrabackup: uses posix_fadvise(). xtrabackup: cd to /var/lib/mysql xtrabackup: open files limit requested 0, set to 1024 xtrabackup: using the following InnoDB configuration: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 2 xtrabackup: innodb_log_file_size = 50331648 >> log scanned up to (1669207) xtrabackup: Generating a list of tablespaces xtrabackup: using the full scan for incremental backup [01] Copying ./ibdata1 to /opt/2017-01-05_11-44-22/ibdata1.delta [01] ...done [01] Copying ./mysql/innodb_table_stats.ibd to /opt/2017-01-05_11-44-22/mysql/innodb_table_stats.ibd.delta [01] ...done [01] Copying ./mysql/innodb_index_stats.ibd to /opt/2017-01-05_11-44-22/mysql/innodb_index_stats.ibd.delta [01] ...done [01] Copying ./mysql/slave_relay_log_info.ibd to /opt/2017-01-05_11-44-22/mysql/slave_relay_log_info.ibd.delta [01] ...done [01] Copying ./mysql/slave_master_info.ibd to /opt/2017-01-05_11-44-22/mysql/slave_master_info.ibd.delta [01] ...done [01] Copying ./mysql/slave_worker_info.ibd to /opt/2017-01-05_11-44-22/mysql/slave_worker_info.ibd.delta [01] ...done [01] Copying ./leco/student.ibd to /opt/2017-01-05_11-44-22/leco/student.ibd.delta [01] ...done >> log scanned up to (1669207) xtrabackup: Creating suspend file '/opt/2017-01-05_11-44-22/xtrabackup_suspended_2' with pid '27861' 170105 11:44:24 innobackupex: Continuing after ibbackup has suspended 170105 11:44:24 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG TABLES... >> log scanned up to (1669207) 170105 11:44:24 innobackupex: Executing FLUSH TABLES WITH READ LOCK... 170105 11:44:24 innobackupex: All tables locked and flushed to disk 170105 11:44:24 innobackupex: Starting to backup non-InnoDB tables and files innobackupex: in subdirectories of '/var/lib/mysql/' innobackupex: Backing up files '/var/lib/mysql//mysql/*.{frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par}' (74 files) innobackupex: Backing up file '/var/lib/mysql//leco/db.opt' innobackupex: Backing up file '/var/lib/mysql//leco/student.frm' innobackupex: Backing up files '/var/lib/mysql//performance_schema/*.{frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par}' (53 files) 170105 11:44:25 innobackupex: Finished backing up non-InnoDB tables and files 170105 11:44:25 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS... 170105 11:44:25 innobackupex: Waiting for log copying to finish xtrabackup: The latest check point (for incremental): '1669207' xtrabackup: Stopping log copying thread. .>> log scanned up to (1669207) xtrabackup: Creating suspend file '/opt/2017-01-05_11-44-22/xtrabackup_log_copied' with pid '27861' xtrabackup: Transaction log of lsn (1669207) to (1669207) was copied. 170105 11:44:26 innobackupex: All tables unlocked innobackupex: Backup created in directory '/opt/2017-01-05_11-44-22' innobackupex: MySQL binlog position: filename 'mysql-bin.000001', position 595 170105 11:44:26 innobackupex: Connection to database server closed 170105 11:44:26 innobackupex: completed OK! [root@localhost 2017-01-05_11-04-55]# cat xtrabackup_checkpoints #\u5168\u91cf\u5907\u4efd\u70b9 backup_type = full-prepared from_lsn = 0 to_lsn = 1666902 last_lsn = 1666902 compact = 0 [root@localhost 2017-01-05_11-04-55]# cd ../2017-01-05_11-44-22/ [root@localhost 2017-01-05_11-44-22]# ls backup-my.cnf ibdata1.meta mysql xtrabackup_binlog_info xtrabackup_info ibdata1.delta leco performance_schema xtrabackup_checkpoints xtrabackup_logfile [root@localhost 2017-01-05_11-44-22]# cat xtrabackup_checkpoints #\u589e\u91cf\u5907\u4efd\u70b9 backup_type = incremental from_lsn = 1666902 to_lsn = 1669207 last_lsn = 1669207 compact = 0 4.2.2 \u589e\u91cf\u6062\u590d \u00b6 \u51c6\u5907\uff08prepare\uff09\u589e\u91cf\u5907\u4efd\u4e0e\u6574\u4f53\u5b8c\u5168\u5907\u4efd\u6709\u4e00\u4e9b\u4e0d\u540c\uff0c\u5c24\u5176\u8981\u6ce8\u610f\u7684\u662f \u9700\u8981\u5728\u6bcf\u4e2a\u5907\u4efd\uff08\u5305\u62ec\u5b8c\u5168\u548c\u5404\u4e2a\u589e\u91cf\u5907\u4efd\uff09\u4e0a\uff0c\u5c06\u5df2\u7ecf\u63d0\u4ea4\u7684\u4e8b\u7269\u8fdb\u884c\uff0c\u91cd\u653e\u3002\u91cd\u653e\u4e4b\u540e\uff0c\u6240\u6709\u7684\u5907\u4efd\u6570\u636e\u5c06\u5408\u5e76\u5230\u5b8c\u5168\u5907\u4efd\u4e0a\u3002 \u57fa\u4e8e\u6240\u6709\u7684\u5907\u4efd\u5c06\u672a\u63d0\u4ea4\u7684\u4e8b\u7269\u8fdb\u7a0b\u56de\u6eda [root@localhost ~]# systemctl stop mysql [root@localhost ~]# cd /var/lib/mysql/ leco/ mysql/ performance_schema/ [root@localhost ~]# cd /var/lib/mysql/ [root@localhost mysql]# ls auto.cnf ib_logfile0 leco mysql-bin.000001 performance_schema xtrabackup_binlog_pos_innodb ibdata1 ib_logfile1 mysql mysql-bin.index select xtrabackup_info [root@localhost mysql]# rm -rf * \u6307\u5b9a\u5168\u91cf\u5907\u4efd [root@localhost mysql]# innobackupex --user=root --password=root --defaults-file=/etc/my.cnf --apply-log --redo-only /opt/2017-01-05_11-04-55/ \u6307\u5b9a\u589e\u91cf\u5907\u4efd [root@localhost mysql]# innobackupex --user=root --password=root --defaults-file=/etc/my.cnf --apply-log --redo-only /opt/2017-01-05_11-04-55/ --incremental-dir=/opt/2017-01-05_11-44-22/ \u6062\u590d [root@localhost mysql]# innobackupex --copy-back --defaults-file=/etc/my.cnf /opt/2017-01-05_11-04-55/ \u89e3\u91ca 1. 2017 - 01 - 05 _11 - 04 - 55 / \u662f\u4e00\u6b21\u5168\u91cf\u5907\u4efd 2. 2017 - 01 - 05 _11 - 44 - 22 \u662f\u4e00\u6b21\u57fa\u4e8e 2017 - 01 - 05 _11 - 04 - 55 \u7684\u589e\u91cf\u5907\u4efd 3. \u6062\u590d\u7684\u65f6\u5019\u8981\u6307\u5b9a\u90a3\u4e2a\u5168\u91cf\u7684\u76ee\u5f55\u8def\u5f84\u3002 [root@localhost mysql]# ls ibdata1 ib_logfile0 ib_logfile1 leco mysql performance_schema xtrabackup_info [root@localhost mysql]# chown -R mysql.mysql * #\u6b64\u65f6\u4e00\u5b9a\u8981\u5148\u6388\u6743\u5728\u542f\u52a8mysql [root@localhost mysql]# ll total 110604 -rw-r--r--. 1 mysql mysql 12582912 Jan 5 13:24 ibdata1 -rw-r--r--. 1 mysql mysql 50331648 Jan 5 13:24 ib_logfile0 -rw-r--r--. 1 mysql mysql 50331648 Jan 5 13:24 ib_logfile1 drwxr-xr-x. 2 mysql mysql 55 Jan 5 13:24 leco drwxr-xr-x. 2 mysql mysql 4096 Jan 5 13:24 mysql -rw-rw----. 1 mysql mysql 0 Jan 5 13:26 mysql-bin.index drwxr-xr-x. 2 mysql mysql 4096 Jan 5 13:24 performance_schema -rw-r--r--. 1 mysql mysql 652 Jan 5 13:24 xtrabackup_info [root@localhost mysql]# systemctl start mysql [root@localhost mysql]# ps aux|grep mysql mysql 33422 2.0 0.1 113248 1604 ? Ss 13:26 0:00 /bin/sh /usr/bin/mysqld_safe --basedir=/usr root 33423 0.0 0.1 113116 1456 ? Ss 13:26 0:00 /bin/bash /usr/bin/mysql-systemd-start post mysql 33599 21.0 11.1 475116 111352 ? Sl 13:26 0:00 /usr/sbin/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib64/mysql/plugin --log-error=/var/log/mysqld.log --pid-file=/var/run/mysqld/mysqld.pid --socket=/var/lib/mysqlmysql.sock root 33612 0.0 0.0 112648 952 pts/3 S+ 13:26 0:00 grep --color=auto mysql [root@localhost mysql]# mysql -uroot -proot Warning: Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 2 Server version: 5.6.35-log MySQL Community Server (GPL) Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | leco | | mysql | | performance_schema | +--------------------+ 4 rows in set (0.03 sec) mysql> use leco; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +----------------+ | Tables_in_leco | +----------------+ | student | +----------------+ 1 row in set (0.00 sec) mysql> select * from student; +----+---------+-----+------+ | id | name | age | dept | +----+---------+-----+------+ | 1 | good | 15 | NULL | | 2 | hehe | 18 | NULL | | 1 | good | 15 | NULL | | 2 | hehe | 18 | NULL | | 2 | beijing | 100 | NULL | | 2 | cmz | 30 | NULL | +----+---------+-----+------+ 6 rows in set (0.00 sec) \u5230\u589e\u91cf\u5907\u4efd\u5df2\u7ecfOK 4.2.3 \u591a\u6b21\u589e\u91cf\u5907\u4efd \u00b6 4.2.4 \u591a\u6b21\u589e\u91cf\u6062\u590d \u00b6 4.3 \u5355\u5e93\u5907\u4efd\u4e0e\u6062\u590d \u00b6 [root@localhost opt]# innobackupex --user=root -password=root --defaults-file=/etc/my.cnf --database=leco /tmp/ InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy and Percona LLC and/or its affiliates 2009-2013. All Rights Reserved. This software is published under the GNU GENERAL PUBLIC LICENSE Version 2, June 1991. Get the latest version of Percona XtraBackup, documentation, and help resources: http://www.percona.com/xb/p 170105 13:58:45 innobackupex: Executing a version check against the server... 170105 13:58:45 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 13:58:45 innobackupex: Connected to MySQL server 170105 13:58:45 innobackupex: Done. 170105 13:58:45 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 13:58:45 innobackupex: Connected to MySQL server 170105 13:58:45 innobackupex: Starting the backup operation IMPORTANT: Please check that the backup run completes successfully. At the end of a successful backup run innobackupex prints \"completed OK!\". innobackupex: Using server version 5.6.35-log innobackupex: Created backup directory /tmp/2017-01-05_13-58-45 170105 13:58:45 innobackupex: Starting ibbackup with command: xtrabackup --defaults-file=\"/etc/my.cnf\" --defaults-group=\"mysqld\" --backup --suspend-at-end --target-dir=/tmp/2017-01-05_13-58-45 --innodb_log_file_size=\"50331648\" --innodb_data_file_path=\"ibdata1:12M:autoextend\" --tmpdir=/tmp --extra-lsndir='/tmp' --databases='leco' innobackupex: Waiting for ibbackup (pid=35053) to suspend innobackupex: Suspend file '/tmp/2017-01-05_13-58-45/xtrabackup_suspended_2' xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3) xtrabackup: uses posix_fadvise(). xtrabackup: cd to /var/lib/mysql xtrabackup: open files limit requested 0, set to 1024 xtrabackup: using the following InnoDB configuration: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 2 xtrabackup: innodb_log_file_size = 50331648 >> log scanned up to (1667104) xtrabackup: Generating a list of tablespaces [01] Copying ./ibdata1 to /tmp/2017-01-05_13-58-45/ibdata1 [01] ...done [01] Copying ./leco/student.ibd to /tmp/2017-01-05_13-58-45/leco/student.ibd [01] ...done >> log scanned up to (1667104) xtrabackup: Creating suspend file '/tmp/2017-01-05_13-58-45/xtrabackup_suspended_2' with pid '35053' 170105 13:58:47 innobackupex: Continuing after ibbackup has suspended 170105 13:58:47 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG TABLES... 170105 13:58:47 innobackupex: Executing FLUSH TABLES WITH READ LOCK... 170105 13:58:47 innobackupex: All tables locked and flushed to disk 170105 13:58:47 innobackupex: Starting to backup non-InnoDB tables and files innobackupex: in subdirectories of '/var/lib/mysql/' innobackupex: Backing up file '/var/lib/mysql//leco/db.opt' >> log scanned up to (1667104) innobackupex: Backing up file '/var/lib/mysql//leco/student.frm' 170105 13:58:47 innobackupex: Finished backing up non-InnoDB tables and files 170105 13:58:47 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS... 170105 13:58:47 innobackupex: Waiting for log copying to finish xtrabackup: The latest check point (for incremental): '1667104' xtrabackup: Stopping log copying thread. .>> log scanned up to (1667104) xtrabackup: Creating suspend file '/tmp/2017-01-05_13-58-45/xtrabackup_log_copied' with pid '35053' xtrabackup: Transaction log of lsn (1667104) to (1667104) was copied. 170105 13:58:48 innobackupex: All tables unlocked innobackupex: Backup created in directory '/tmp/2017-01-05_13-58-45' innobackupex: MySQL binlog position: filename 'mysql-bin.000001', position 120 170105 13:58:48 innobackupex: Connection to database server closed 170105 13:58:48 innobackupex: completed OK! [root@localhost opt]# ll /tmp/2017-01-05_13-58-45 total 12308 -rw-r--r--. 1 root root 295 Jan 5 13:58 backup-my.cnf -rw-r-----. 1 root root 12582912 Jan 5 13:58 ibdata1 drwx------. 2 root root 55 Jan 5 13:58 leco -rw-r--r--. 1 root root 21 Jan 5 13:58 xtrabackup_binlog_info -rw-r-----. 1 root root 89 Jan 5 13:58 xtrabackup_checkpoints -rw-r--r--. 1 root root 600 Jan 5 13:58 xtrabackup_info -rw-r-----. 1 root root 2560 Jan 5 13:58 xtrabackup_logfile \u89e3\u91ca 1. \u8981\u52a0\u53c2\u6570 -- database 2. \u8981\u6307\u5b9a\u5e93\u540d\u5b57 4.4 \u5907\u4efd\u6587\u4ef6\u5f52\u6863\u538b\u7f29 \u00b6 4.4.1 \u538b\u7f29 \u00b6 [root@localhost opt]# mkdir /tmp/db [root@localhost opt]# innobackupex --user=root -password=root --defaults-file=/etc/my.cnf --stream=tar /tmp/db | gzip >/tmp/db/`date +%F`.tar.gz InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy and Percona LLC and/or its affiliates 2009-2013. All Rights Reserved. This software is published under the GNU GENERAL PUBLIC LICENSE Version 2, June 1991. Get the latest version of Percona XtraBackup, documentation, and help resources: http://www.percona.com/xb/p 170105 14:05:59 innobackupex: Executing a version check against the server... 170105 14:05:59 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 14:05:59 innobackupex: Connected to MySQL server 170105 14:05:59 innobackupex: Done. 170105 14:05:59 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 14:05:59 innobackupex: Connected to MySQL server 170105 14:05:59 innobackupex: Starting the backup operation IMPORTANT: Please check that the backup run completes successfully. At the end of a successful backup run innobackupex prints \"completed OK!\". innobackupex: Using server version 5.6.35-log innobackupex: Created backup directory /tmp/db 170105 14:05:59 innobackupex: Starting ibbackup with command: xtrabackup --defaults-file=\"/etc/my.cnf\" --defaults-group=\"mysqld\" --backup --suspend-at-end --target-dir=/tmp --innodb_log_file_size=\"50331648\" --innodb_data_file_path=\"ibdata1:12M:autoextend\" --tmpdir=/tmp --extra-lsndir='/tmp' --stream=tar innobackupex: Waiting for ibbackup (pid=35685) to suspend innobackupex: Suspend file '/tmp/xtrabackup_suspended_2' xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3) xtrabackup: uses posix_fadvise(). xtrabackup: cd to /var/lib/mysql xtrabackup: open files limit requested 0, set to 1024 xtrabackup: using the following InnoDB configuration: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 2 xtrabackup: innodb_log_file_size = 50331648 >> log scanned up to (1667104) xtrabackup: Generating a list of tablespaces [01] Streaming ./ibdata1 [01] ...done [01] Streaming ./mysql/innodb_table_stats.ibd [01] ...done [01] Streaming ./mysql/innodb_index_stats.ibd [01] ...done [01] Streaming ./mysql/slave_relay_log_info.ibd [01] ...done [01] Streaming ./mysql/slave_master_info.ibd [01] ...done [01] Streaming ./mysql/slave_worker_info.ibd [01] ...done [01] Streaming ./leco/student.ibd [01] ...done >> log scanned up to (1667104) xtrabackup: Creating suspend file '/tmp/xtrabackup_suspended_2' with pid '35685' 170105 14:06:01 innobackupex: Continuing after ibbackup has suspended 170105 14:06:01 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG TABLES... 170105 14:06:01 innobackupex: Executing FLUSH TABLES WITH READ LOCK... 170105 14:06:01 innobackupex: All tables locked and flushed to disk 170105 14:06:01 innobackupex: Starting to backup non-InnoDB tables and files innobackupex: in subdirectories of '/var/lib/mysql/' innobackupex: Backing up files '/var/lib/mysql//mysql/*.{frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par}' (74 files) >> log scanned up to (1667104) innobackupex: Backing up file '/var/lib/mysql//leco/db.opt' innobackupex: Backing up file '/var/lib/mysql//leco/student.frm' innobackupex: Backing up files '/var/lib/mysql//performance_schema/*.{frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par}' (53 files) 170105 14:06:02 innobackupex: Finished backing up non-InnoDB tables and files 170105 14:06:02 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS... 170105 14:06:02 innobackupex: Waiting for log copying to finish xtrabackup: The latest check point (for incremental): '1667104' xtrabackup: Stopping log copying thread. .>> log scanned up to (1667104) xtrabackup: Creating suspend file '/tmp/xtrabackup_log_copied' with pid '35685' xtrabackup: Transaction log of lsn (1667104) to (1667104) was copied. 170105 14:06:03 innobackupex: All tables unlocked innobackupex: Backup created in directory '/tmp/db' innobackupex: MySQL binlog position: filename 'mysql-bin.000001', position 120 170105 14:06:03 innobackupex: Connection to database server closed innobackupex: You must use -i (--ignore-zeros) option for extraction of the tar stream. 170105 14:06:03 innobackupex: completed OK! [root@localhost opt]# ll /tmp/db/2017-01-05.tar.gz -rw-r--r--. 1 root root 285805 Jan 5 14:06 /tmp/db/2017-01-05.tar.gz 4.4.2 \u89e3\u538b \u00b6 [root@localhost db]# tar -izxvf `date +%F`.tar.gz ./backup-my.cnf ibdata1 mysql/innodb_table_stats.ibd mysql/innodb_index_stats.ibd mysql/slave_relay_log_info.ibd mysql/slave_master_info.ibd mysql/slave_worker_info.ibd leco/student.ibd mysql/db.frm mysql/db.MYI mysql/db.MYD mysql/user.frm mysql/user.MYI mysql/user.MYD mysql/func.frm mysql/func.MYI mysql/func.MYD mysql/plugin.frm mysql/plugin.MYI mysql/plugin.MYD mysql/servers.frm mysql/servers.MYI mysql/servers.MYD mysql/tables_priv.frm mysql/tables_priv.MYI mysql/tables_priv.MYD mysql/columns_priv.frm mysql/columns_priv.MYI mysql/columns_priv.MYD mysql/help_topic.frm mysql/help_topic.MYI mysql/help_topic.MYD mysql/help_category.frm mysql/help_category.MYI mysql/help_category.MYD mysql/help_relation.frm mysql/help_relation.MYI mysql/help_relation.MYD mysql/help_keyword.frm mysql/help_keyword.MYI mysql/help_keyword.MYD mysql/time_zone_name.frm mysql/time_zone_name.MYI mysql/time_zone_name.MYD mysql/time_zone.frm mysql/time_zone.MYI mysql/time_zone.MYD mysql/time_zone_transition.frm mysql/time_zone_transition.MYI mysql/time_zone_transition.MYD mysql/time_zone_transition_type.frm mysql/time_zone_transition_type.MYI mysql/time_zone_transition_type.MYD mysql/time_zone_leap_second.frm mysql/time_zone_leap_second.MYI mysql/time_zone_leap_second.MYD mysql/proc.frm mysql/proc.MYI mysql/proc.MYD mysql/procs_priv.frm mysql/procs_priv.MYI mysql/procs_priv.MYD mysql/general_log.frm mysql/general_log.CSM mysql/general_log.CSV mysql/slow_log.frm mysql/slow_log.CSM mysql/slow_log.CSV mysql/event.frm mysql/event.MYI mysql/event.MYD mysql/ndb_binlog_index.frm mysql/ndb_binlog_index.MYI mysql/ndb_binlog_index.MYD mysql/innodb_table_stats.frm mysql/innodb_index_stats.frm mysql/slave_relay_log_info.frm mysql/slave_master_info.frm mysql/slave_worker_info.frm mysql/proxies_priv.frm mysql/proxies_priv.MYI mysql/proxies_priv.MYD leco/db.opt leco/student.frm performance_schema/db.opt performance_schema/cond_instances.frm performance_schema/events_waits_current.frm performance_schema/events_waits_history.frm performance_schema/events_waits_history_long.frm performance_schema/events_waits_summary_by_instance.frm performance_schema/events_waits_summary_by_host_by_event_name.frm performance_schema/events_waits_summary_by_user_by_event_name.frm performance_schema/events_waits_summary_by_account_by_event_name.frm performance_schema/events_waits_summary_by_thread_by_event_name.frm performance_schema/events_waits_summary_global_by_event_name.frm performance_schema/file_instances.frm performance_schema/file_summary_by_event_name.frm performance_schema/file_summary_by_instance.frm performance_schema/socket_instances.frm performance_schema/socket_summary_by_instance.frm performance_schema/socket_summary_by_event_name.frm performance_schema/host_cache.frm performance_schema/mutex_instances.frm performance_schema/objects_summary_global_by_type.frm performance_schema/performance_timers.frm performance_schema/rwlock_instances.frm performance_schema/setup_actors.frm performance_schema/setup_consumers.frm performance_schema/setup_instruments.frm performance_schema/setup_objects.frm performance_schema/setup_timers.frm performance_schema/table_io_waits_summary_by_index_usage.frm performance_schema/table_io_waits_summary_by_table.frm performance_schema/table_lock_waits_summary_by_table.frm performance_schema/threads.frm performance_schema/events_stages_current.frm performance_schema/events_stages_history.frm performance_schema/events_stages_history_long.frm performance_schema/events_stages_summary_by_thread_by_event_name.frm performance_schema/events_stages_summary_by_host_by_event_name.frm performance_schema/events_stages_summary_by_user_by_event_name.frm performance_schema/events_stages_summary_by_account_by_event_name.frm performance_schema/events_stages_summary_global_by_event_name.frm performance_schema/events_statements_current.frm performance_schema/events_statements_history.frm performance_schema/events_statements_history_long.frm performance_schema/events_statements_summary_by_thread_by_event_name.frm performance_schema/events_statements_summary_by_host_by_event_name.frm performance_schema/events_statements_summary_by_user_by_event_name.frm performance_schema/events_statements_summary_by_account_by_event_name.frm performance_schema/events_statements_summary_global_by_event_name.frm performance_schema/hosts.frm performance_schema/users.frm performance_schema/accounts.frm performance_schema/events_statements_summary_by_digest.frm performance_schema/session_connect_attrs.frm performance_schema/session_account_connect_attrs.frm ./xtrabackup_binlog_info xtrabackup_logfile xtrabackup_checkpoints ./xtrabackup_info [root@localhost db]# ls 2017-01-05.tar.gz ibdata1 mysql xtrabackup_binlog_info xtrabackup_info backup-my.cnf leco performance_schema xtrabackup_checkpoints xtrabackup_logfile \u6ce8\u610f \u6ce8\u610f\u89e3\u538b\u7684\u65b9\u5f0f\u4e0d\u540c\uff0c\u4e0d\u80fd\u76f4\u63a5\u50cf\u5e73\u65f6\u89e3\u538b\u6587\u4ef6\u90a3\u6837\u3002","title":"3. xtrabackup"},{"location":"linux/server/xtrabackup/xtrabackup.index/#1-xtrabackup","text":"","title":"1. Xtrabackup"},{"location":"linux/server/xtrabackup/xtrabackup.index/#11","text":"Xtrabackup\u662f\u4e00\u4e2a\u5bf9InnoDB\u505a\u6570\u636e\u5907\u4efd\u7684\u5de5\u5177\uff0c\u652f\u6301\u5728\u7ebf\u70ed\u5907\u4efd\uff08\u5907\u4efd\u65f6\u5019\u4e0d\u5f71\u54cd\u6570\u636e\u8bfb\u5199\uff09\uff0c\u662f\u5546\u4e1a\u5907\u4efd\u5de5\u4f5cInnoDB hotbackup\u7684\u4e00\u4e2a\u5f88\u597d\u7684\u66ff\u4ee3\u54c1\u3002","title":"1.1 \u4ecb\u7ecd"},{"location":"linux/server/xtrabackup/xtrabackup.index/#12","text":"\u65e0\u9700\u505c\u6b62\u6570\u636e\u5e93\u8fdb\u884cInnoDB\u70ed\u5907 \u589e\u91cf\u5907\u4efdMySQL \u6d41\u538b\u7f29\u5230\u4f20\u8f93\u5230\u5176\u4ed6\u670d\u52a1\u5668 \u80fd\u6bd4\u8f83\u5bb9\u6613\u7684\u521b\u5efa\u4e3b\u4ece\u540c\u6b65 \u5907\u4efdMySQL\u65f6\u4e0d\u4f1a\u589e\u5927\u670d\u52a1\u5668\u8d1f\u8f7d","title":"1.2 \u7279\u70b9"},{"location":"linux/server/xtrabackup/xtrabackup.index/#13","text":"\u70ed\u5907\u4efd\uff1a\u8bfb\u5199\u4e0d\u53d7\u5f71\u54cd\uff08mysqldump \u2192 innodb\uff09 \u6e29\u5907\u4efd\uff1a\u4ec5\u53ef\u4ee5\u6267\u884c\u8bfb\u64cd\u4f5c\uff08mysqldump \u2192 myisam\uff09 \u51b7\u5907\u4efd\uff1a\u79bb\u7ebf\u5907\u4efd\uff0c\u8bfb\u5199\u90fd\u4e0d\u53ef\u7528 \u903b\u8f91\u5907\u4efd\uff1a\u8bb2\u6570\u636e\u5bfc\u51fa\u6587\u672c\u6587\u4ef6\u4e2d(mysqldump) \u7269\u7406\u5907\u4efd\uff1a\u8bb2\u6570\u636e\u6587\u4ef6\u62f7\u8d1d\uff08xtrabackup\uff0cmysqlhotcopy\uff09 \u5b8c\u6210\u5907\u4efd\uff1a\u5907\u4efd\u6240\u6709\u6570\u636e \u589e\u91cf\u5907\u4efd\uff1a\u4ec5\u5907\u4efd\u4e0a\u6b21\u5b8c\u6574\u5907\u4efd\u6216\u8005\u589e\u91cf\u5907\u4efd\u4ee5\u6765\u53d8\u5316\u7684\u6570\u636e \u5dee\u5f02\u5907\u4efd\uff1a\u4ec5\u5907\u4efd\u4e0a\u6b21\u5b8c\u6574\u5907\u4efd\u4ee5\u6765\u53d8\u5316\u7684\u6570\u636e","title":"1.3 \u5907\u4efd\u65b9\u5f0f"},{"location":"linux/server/xtrabackup/xtrabackup.index/#2-xtrabackup","text":"","title":"2. xtrabackup \u539f\u7406"},{"location":"linux/server/xtrabackup/xtrabackup.index/#21-xtrabackup","text":"innobackupex\u5907\u4efd\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a\u5907\u4efd\u5f00\u59cb\u65f6\u9996\u5148\u4f1a\u5f00\u542f\u4e00\u4e2a\u540e\u53f0\u68c0\u6d4b\u8fdb\u7a0b\uff0c\u5b9e\u65f6\u68c0\u6d4bmysql redo\u7684\u53d8\u5316\uff0c\u4e00\u65e6\u53d1\u73b0redo\u4e2d\u6709\u65b0\u7684\u65e5\u5fd7\u5199\u5165\uff0c\u7acb\u523b\u5c06\u65e5\u5fd7\u8bb0\u5165\u540e\u53f0\u65e5\u5fd7\u6587\u4ef6 xtrabackup_log \u4e2d\u3002\u4e4b\u540e\u590d\u5236innodb\u7684\u6570\u636e\u6587\u4ef6\u548c\u7cfb\u7edf\u8868\u7a7a\u95f4\u6587\u4ef6ibdata1\uff0c\u5f85\u590d\u5236\u7ed3\u675f\u540e\uff0c\u6267\u884cflush tables with read lock\u64cd\u4f5c\uff0c\u590d\u5236.frm\uff0cMYI\uff0cMYD\uff0c\u7b49\u6587\u4ef6\uff08\u6267\u884cflush tableswith read lock\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u9632\u6b62\u6570\u636e\u8868\u53d1\u751fDDL\u64cd\u4f5c\uff0c\u5e76\u4e14\u5728\u8fd9\u4e00\u65f6\u523b\u83b7\u5f97binlog\u7684\u4f4d\u7f6e\uff09\u6700\u540e\u4f1a\u53d1\u51faunlock tables\uff0c\u628a\u8868\u8bbe\u7f6e\u4e3a\u53ef\u8bfb\u53ef\u5199\u72b6\u6001\uff0c\u6700\u7ec8\u505c\u6b62xtrabackup_log\u3002","title":"2.1 xtrabackup \u5907\u4efd\u8fc7\u7a0b"},{"location":"linux/server/xtrabackup/xtrabackup.index/#22-xtrabackup","text":"\u8fd9\u4e00\u9636\u6bb5\u4f1a\u542f\u52a8xtrabackup\u5185\u5d4c\u7684innodb\u5b9e\u4f8b\uff0c\u56de\u653extrabackup\u65e5\u5fd7xtrabackup_log\uff0c\u5c06\u63d0\u4ea4\u7684\u4e8b\u52a1\u4fe1\u606f\u53d8\u66f4\u5e94\u7528\u5230innodb\u6570\u636e/\u8868\u7a7a\u95f4\uff0c\u540c\u65f6\u56de\u6eda\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1(\u8fd9\u4e00\u8fc7\u7a0b\u7c7b\u4f3cinnodb\u7684\u5b9e\u4f8b\u6062\u590d\uff09\u3002\u6062\u590d\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a","title":"2.2 Xtrabackup \u5168\u91cf\u5907\u4efd\u6062\u590d"},{"location":"linux/server/xtrabackup/xtrabackup.index/#23-xtrabackup","text":"innobackupex\u589e\u91cf\u5907\u4efd\u8fc7\u7a0b\u4e2d\u7684\"\u589e\u91cf\"\u5904\u7406\uff0c\u5176\u5b9e\u4e3b\u8981\u662f\u76f8\u5bf9innodb\u800c\u8a00\uff0c\u5bf9myisam\u548c\u5176\u4ed6\u5b58\u50a8\u5f15\u64ce\u800c\u8a00\uff0c\u5b83\u4ecd\u7136\u662f\u5168\u62f7\u8d1d(\u5168\u5907\u4efd)\"\u3002\u589e\u91cf\"\u5907\u4efd\u7684\u8fc7\u7a0b\u4e3b\u8981\u662f\u901a\u8fc7\u62f7\u8d1dinnodb\u4e2d\u6709\u53d8\u66f4\u7684\"\u9875\"\uff08\u8fd9\u4e9b\u53d8\u66f4\u7684\u6570\u636e\u9875\u6307\u7684\u662f\"\u9875\"\u7684LSN\u5927\u4e8extrabackup_checkpoints\u4e2d\u7ed9\u5b9a\u7684LSN\uff09\u3002\u589e\u91cf\u5907\u4efd\u662f\u57fa\u4e8e\u5168\u5907\u7684\uff0c\u7b2c\u4e00\u6b21\u589e\u5907\u7684\u6570\u636e\u5fc5\u987b\u8981\u57fa\u4e8e\u4e0a\u4e00\u6b21\u7684\u5168\u5907\uff0c\u4e4b\u540e\u7684\u6bcf\u6b21\u589e\u5907\u90fd\u662f\u57fa\u4e8e\u4e0a\u4e00\u6b21\u7684\u589e\u5907\uff0c\u6700\u7ec8\u8fbe\u5230\u4e00\u81f4\u6027\u7684\u589e\u5907\u3002\u589e\u91cf\u5907\u4efd\u7684\u8fc7\u7a0b\u5982\u4e0b\uff0c\u548c\u5168\u5907\u7684\u8fc7\u7a0b\u5f88\u7c7b\u4f3c\uff0c\u533a\u522b\u4ec5\u5728\u7b2c2\u6b65\u3002","title":"2.3 Xtrabackup \u589e\u91cf\u5907\u4efd\u539f\u7406"},{"location":"linux/server/xtrabackup/xtrabackup.index/#24-xtrabackup","text":"\u548c\u5168\u5907\u6062\u590d\u7c7b\u4f3c\uff0c\u4e5f\u9700\u8981\u4e24\u6b65\uff0c\u4e00\u662f\u6570\u636e\u6587\u4ef6\u7684\u6062\u590d\uff0c\u5982\u56fe4\uff0c\u8fd9\u91cc\u7684\u6570\u636e\u6765\u6e90\u75313\u90e8\u5206\u7ec4\u6210\uff1a\u5168\u5907\u4efd\uff0c\u589e\u91cf\u5907\u4efd\u548cxtrabackup log\u3002\u4e8c\u662f\u5bf9\u672a\u63d0\u4ea4\u4e8b\u52a1\u7684\u56de\u6eda\uff0c\u5982\u56fe\u6240\u793a","title":"2.4  Xtrabackup \u589e\u91cf\u5907\u4efd\u6062\u590d"},{"location":"linux/server/xtrabackup/xtrabackup.index/#3-xtrabackup","text":"","title":"3. xtrabackup \u90e8\u7f72"},{"location":"linux/server/xtrabackup/xtrabackup.index/#31","text":"\u5b89\u88c5Percona XtraBackup Percona yum\u8d44\u6e90\u5e93 yum install -y \\ http://www.percona.com/downloads/percona-release/redhat/0.1-3/percona-release-0.1-3.noarch.rpm yum list|grep percona yum install percona-xtrabackup-22","title":"3.1 \u79bb\u7ebf\u5b89\u88c5"},{"location":"linux/server/xtrabackup/xtrabackup.index/#32","text":"[root@localhost ~]# rpm -qa|grep xtrabackup percona-xtrabackup-22-2.2.13-1.el7.x86_64","title":"3.2 \u68c0\u67e5\u5b89\u88c5"},{"location":"linux/server/xtrabackup/xtrabackup.index/#33","text":"Xtrabackup\u4e2d\u4e3b\u8981\u5305\u542b\u4e24\u4e2a\u5de5\u5177\uff1a xtrabackup\uff1a\u662f\u7528\u4e8e\u70ed\u5907innodb\uff0cxtradb\u8868\u4e2d\u6570\u636e\u7684\u5de5\u5177\uff0c\u4e0d\u80fd\u5907\u4efd\u5176\u4ed6\u7c7b\u578b\u7684\u8868\uff0c\u4e5f\u4e0d\u80fd\u5907\u4efd\u6570\u636e\u8868\u7ed3\u6784\uff1b innobackupex\uff1a\u662f\u5c06xtrabackup\u8fdb\u884c\u5c01\u88c5\u7684perl\u811a\u672c\uff0c\u63d0\u4f9b\u4e86\u5907\u4efdmyisam\u8868\u7684\u80fd\u529b\u3002 \u5e38\u7528\u9009\u9879: -host \u6307\u5b9a\u4e3b\u673a --user \u6307\u5b9a\u7528\u6237\u540d --password \u6307\u5b9a\u5bc6\u7801 --port \u6307\u5b9a\u7aef\u53e3 --databases \u6307\u5b9a\u6570\u636e\u5e93 --incremental \u521b\u5efa\u589e\u91cf\u5907\u4efd --incremental-basedir \u6307\u5b9a\u5305\u542b\u5b8c\u5168\u5907\u4efd\u7684\u76ee\u5f55 --incremental-dir \u6307\u5b9a\u5305\u542b\u589e\u91cf\u5907\u4efd\u7684\u76ee\u5f55 --apply-log \u5bf9\u5907\u4efd\u8fdb\u884c\u9884\u5904\u7406\u64cd\u4f5c \u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5728\u5907\u4efd\u5b8c\u6210\u540e\uff0c\u6570\u636e\u5c1a\u4e14\u4e0d\u80fd\u7528\u4e8e\u6062\u590d\u64cd\u4f5c\uff0c\u56e0\u4e3a\u5907\u4efd\u7684\u6570\u636e\u4e2d\u53ef\u80fd\u4f1a\u5305\u542b\u5c1a\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u6216\u5df2\u7ecf\u63d0\u4ea4\u4f46\u5c1a\u672a\u540c\u6b65\u81f3\u6570\u636e\u6587\u4ef6\u4e2d\u7684\u4e8b\u52a1\u3002\u56e0\u6b64\uff0c\u6b64\u65f6\u6570\u636e\u6587\u4ef6\u4ecd\u5904\u7406\u4e0d\u4e00\u81f4\u72b6\u6001\u3002\u201c\u51c6\u5907\u201d\u7684\u4e3b\u8981\u4f5c\u7528\u6b63\u662f\u901a\u8fc7\u56de\u6eda\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u53ca\u540c\u6b65\u5df2\u7ecf\u63d0\u4ea4\u7684\u4e8b\u52a1\u81f3\u6570\u636e\u6587\u4ef6\u4e5f\u4f7f\u5f97\u6570\u636e\u6587\u4ef6\u5904\u4e8e\u4e00\u81f4\u6027\u72b6\u6001\u3002 --redo-only \u4e0d\u56de\u6eda\u672a\u63d0\u4ea4\u4e8b\u52a1 --copy-back \u6062\u590d\u5907\u4efd\u76ee\u5f55 \u4f7f\u7528innobakupex\u5907\u4efd\u65f6,\u5176\u4f1a\u8c03\u7528xtrabackup\u5907\u4efd\u6240\u6709\u7684InnoDB\u8868,\u590d\u5236\u6240\u6709\u5173\u4e8e\u8868\u7ed3\u6784\u5b9a\u4e49\u7684\u76f8\u5173\u6587\u4ef6(.frm)\u3001\u4ee5\u53caMyISAM\u3001MERGE\u3001CSV\u548cARCHIVE\u8868\u7684\u76f8\u5173\u6587\u4ef6,\u540c\u65f6\u8fd8\u4f1a\u5907\u4efd\u89e6\u53d1\u5668\u548c\u6570\u636e\u5e93\u914d\u7f6e\u4fe1\u606f\u76f8\u5173\u7684\u6587\u4ef6,\u8fd9\u4e9b\u6587\u4ef6\u4f1a\u88ab\u4fdd\u5b58\u81f3\u4e00\u4e2a\u4ee5\u65f6\u95f4\u547d\u4ee4\u7684\u76ee\u5f55\u4e2d\u3002 \u5907\u4efd\u7684\u540c\u65f6\uff0cinnobackupex\u8fd8\u4f1a\u5728\u5907\u4efd\u76ee\u5f55\u4e2d\u521b\u5efa\u5982\u4e0b\u6587\u4ef6\uff1a `. xtrabackup_checkpoints \u5907\u4efd\u7c7b\u578b\uff08\u5982\u5b8c\u5168\u6216\u589e\u91cf\uff09\u3001\u5907\u4efd\u72b6\u6001\uff08\u5982\u662f\u5426\u5df2\u7ecf\u4e3aprepared\u72b6\u6001\uff09\u548cLSN(\u65e5\u5fd7\u5e8f\u5217\u53f7)\u8303\u56f4\u4fe1\u606f;\u6bcf\u4e2aInnoDB\u9875(\u901a\u5e38\u4e3a16k\u5927\u5c0f)\u90fd\u4f1a\u5305\u542b\u4e00\u4e2a\u65e5\u5fd7\u5e8f\u5217\u53f7\uff0c\u5373LSN\u3002 LSN\u662f\u6574\u4e2a\u6570\u636e\u5e93\u7cfb\u7edf\u7684\u7cfb\u7edf\u7248\u672c\u53f7\uff0c\u6bcf\u4e2a\u9875\u9762\u76f8\u5173\u7684LSN\u80fd\u591f\u8868\u660e\u6b64\u9875\u9762\u6700\u8fd1\u662f\u5982\u4f55\u53d1\u751f\u6539\u53d8\u7684\u3002 2. xtrabackup_binlog_info mysql\u670d\u52a1\u5668\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u53ca\u81f3\u5907\u4efd\u8fd9\u4e00\u523b\u4e3a\u6b62\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e8b\u4ef6\u7684\u4f4d\u7f6e\u3002 3. xtrabackup_binlog_pos_innodb \u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u53ca\u7528\u4e8eInnoDB\u6216XtraDB\u8868\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u7684\u5f53\u524dposition\u3002 4. xtrabackup_binary \u5907\u4efd\u4e2d\u7528\u5230\u7684xtrabackup\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff1b 5. backup-my.cnf \u5907\u4efd\u547d\u4ee4\u7528\u5230\u7684\u914d\u7f6e\u9009\u9879\u4fe1\u606f\uff1b \u5728\u4f7f\u7528innobackupex\u8fdb\u884c\u5907\u4efd\u65f6\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528--no-timestamp\u9009\u9879\u6765\u963b\u6b62\u547d\u4ee4\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u4ee5\u65f6\u95f4\u547d\u540d\u7684\u76ee\u5f55\uff1b\u5982\u6b64\u4e00\u6765\uff0cinnobackupex\u547d\u4ee4\u5c06\u4f1a\u521b\u5efa\u4e00\u4e2aBACKUP-DIR\u76ee\u5f55\u6765\u5b58\u50a8\u5907\u4efd\u6570\u636e\u3002 \u5982\u679c\u8981\u4f7f\u7528\u4e00\u4e2a\u6700\u5c0f\u6743\u9650\u7684\u7528\u6237\u8fdb\u884c\u5907\u4efd\uff0c\u5219\u53ef\u57fa\u4e8e\u5982\u4e0b\u547d\u4ee4\u521b\u5efa\u6b64\u7c7b\u7528\u6237\uff1a mysql> CREATE USER 'backuser'@'localhost' IDENTIFIED BY 'backuser'; \u521b\u5efa\u7528\u6237 mysql> REVOKE ALL PRIVILEGES,GRANT OPTION FROM 'backuser'@'localhost'; \u56de\u6536\u6b64\u7528\u6237\u6240\u6709\u6743\u9650 mysql> GRANT RELOAD,LOCK TABLES,REPLICATION CLIENT ON *.* TO 'baskuser'@'localhost'; \u6388\u6743\u5237\u65b0\u3001\u9501\u5b9a\u8868\u3001\u7528\u6237\u67e5\u770b\u670d\u52a1\u5668\u72b6\u6001 mysql> FLUSH PRIVILEGES; \u5237\u65b0\u6388\u6743\u8868 \u6ce8\u610f \u5907\u4efd\u8fc7\u7a0b : \u5907\u4efd\u65f6\u9700\u542f\u52a8 MySQL , \u6062\u590d\u65f6\u9700\u5173\u95ed MySQL , \u6e05\u7a7a mysql\u6570\u636e\u76ee\u5f55\u4e14\u4e0d\u80fd\u91cd\u65b0\u521d\u59cb\u5316 , \u6062\u590d\u6570\u636e\u540e\u5e94\u8be5\u7acb\u5373\u8fdb\u884c\u4e00\u6b21\u5b8c\u5168\u5907\u4efd","title":"3.3 \u5e38\u7528\u53c2\u6570"},{"location":"linux/server/xtrabackup/xtrabackup.index/#4-xtrabackup","text":"","title":"4. xtrabackup \u64cd\u4f5c"},{"location":"linux/server/xtrabackup/xtrabackup.index/#41","text":"","title":"4.1 \u57fa\u4e8e\u5168\u91cf\u7684\u5907\u4efd\u4e0e\u6062\u590d"},{"location":"linux/server/xtrabackup/xtrabackup.index/#411","text":"\u5168\u91cf\u5907\u4efd\u4e0e\u6062\u590d \u5907\u4efd innobackupex --user=root --password=root --defaults-file=/etc/my.cnf /opt/ \u6062\u590d innobackupex --apply-log /opt/2017-01-05_11-04-55/ innobackupex --copy-back --defaults-file=/etc/my.cnf /opt/2017-01-05_11-04-55/ \u5b8c\u5168\u5907\u4efd\uff1a [root@localhost backup]# mysqladmin -uroot password root Warning: Using a password on the command line interface can be insecure. [root@localhost opt]# innobackupex --user=root --password=root --defaults-file=/etc/my.cnf /opt/ InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy and Percona LLC and/or its affiliates 2009-2013. All Rights Reserved. This software is published under the GNU GENERAL PUBLIC LICENSE Version 2, June 1991. Get the latest version of Percona XtraBackup, documentation, and help resources: http://www.percona.com/xb/p 170105 11:04:55 innobackupex: Executing a version check against the server... 170105 11:04:55 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 11:04:55 innobackupex: Connected to MySQL server 170105 11:04:55 innobackupex: Done. 170105 11:04:55 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 11:04:55 innobackupex: Connected to MySQL server 170105 11:04:55 innobackupex: Starting the backup operation IMPORTANT: Please check that the backup run completes successfully. At the end of a successful backup run innobackupex prints \"completed OK!\". innobackupex: Using server version 5.6.35-log innobackupex: Created backup directory /opt/2017-01-05_11-04-55 170105 11:04:55 innobackupex: Starting ibbackup with command: xtrabackup --defaults-file=\"/etc/my.cnf\" --defaults-group=\"mysqld\" --backup --suspend-at-end --target-dir=/opt/2017-01-05_11-04-55 --innodb_log_file_size=\"50331648\" --innodb_data_file_path=\"ibdata1:12M:autoextend\" --tmpdir=/tmp --extra-lsndir='/tmp' innobackupex: Waiting for ibbackup (pid=25098) to suspend innobackupex: Suspend file '/opt/2017-01-05_11-04-55/xtrabackup_suspended_2' xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3) xtrabackup: uses posix_fadvise(). xtrabackup: cd to /var/lib/mysql xtrabackup: open files limit requested 0, set to 1024 xtrabackup: using the following InnoDB configuration: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 2 xtrabackup: innodb_log_file_size = 50331648 >> log scanned up to (1666902) xtrabackup: Generating a list of tablespaces [01] Copying ./ibdata1 to /opt/2017-01-05_11-04-55/ibdata1 [01] ...done [01] Copying ./mysql/innodb_table_stats.ibd to /opt/2017-01-05_11-04-55/mysql/innodb_table_stats.ibd [01] ...done [01] Copying ./mysql/innodb_index_stats.ibd to /opt/2017-01-05_11-04-55/mysql/innodb_index_stats.ibd [01] ...done [01] Copying ./mysql/slave_relay_log_info.ibd to /opt/2017-01-05_11-04-55/mysql/slave_relay_log_info.ibd [01] ...done [01] Copying ./mysql/slave_master_info.ibd to /opt/2017-01-05_11-04-55/mysql/slave_master_info.ibd [01] ...done [01] Copying ./mysql/slave_worker_info.ibd to /opt/2017-01-05_11-04-55/mysql/slave_worker_info.ibd [01] ...done [01] Copying ./leco/student.ibd to /opt/2017-01-05_11-04-55/leco/student.ibd [01] ...done >> log scanned up to (1666902) xtrabackup: Creating suspend file '/opt/2017-01-05_11-04-55/xtrabackup_suspended_2' with pid '25098' 170105 11:04:57 innobackupex: Continuing after ibbackup has suspended 170105 11:04:57 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG TABLES... >> log scanned up to (1666902) 170105 11:04:57 innobackupex: Executing FLUSH TABLES WITH READ LOCK... 170105 11:04:57 innobackupex: All tables locked and flushed to disk 170105 11:04:57 innobackupex: Starting to backup non-InnoDB tables and files innobackupex: in subdirectories of '/var/lib/mysql/' innobackupex: Backing up files '/var/lib/mysql//mysql/*.{frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par}' (74 files) innobackupex: Backing up file '/var/lib/mysql//leco/db.opt' innobackupex: Backing up file '/var/lib/mysql//leco/student.frm' innobackupex: Backing up files '/var/lib/mysql//performance_schema/*.{frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par}' (53 files) 170105 11:04:58 innobackupex: Finished backing up non-InnoDB tables and files 170105 11:04:58 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS... 170105 11:04:58 innobackupex: Waiting for log copying to finish xtrabackup: The latest check point (for incremental): '1666902' xtrabackup: Stopping log copying thread. .>> log scanned up to (1666902) xtrabackup: Creating suspend file '/opt/2017-01-05_11-04-55/xtrabackup_log_copied' with pid '25098' xtrabackup: Transaction log of lsn (1666902) to (1666902) was copied. 170105 11:04:59 innobackupex: All tables unlocked innobackupex: Backup created in directory '/opt/2017-01-05_11-04-55' innobackupex: MySQL binlog position: filename 'mysql-bin.000001', position 430 170105 11:04:59 innobackupex: Connection to database server closed 170105 11:04:59 innobackupex: completed OK! \u8bed\u6cd5\u89e3\u91ca innobackupex -- user = root -- password = root -- defaults - file =/ etc / my . cnf / opt / \u8bed\u6cd5\u89e3\u91ca\u8bf4\u660e\uff1a 1. -- user = root \u6307\u5b9a\u5907\u4efd\u7684\u7528\u6237 2. -- password = root\u6307\u5b9a\u5907\u4efd\u7528\u6237\u7684\u5bc6\u7801 3. -- defaults - file =/ etc / my . cnf \u6307\u5b9a\u7684\u5907\u4efd\u6570\u636e\u7684\u914d\u7f6e\u6587\u4ef6 4. / opt / \u6307\u5b9a\u5907\u4efd\u540e\u7684\u6570\u636e\u4fdd\u5b58\u8def\u5f84 \u8bf4\u660e \u5728\u5907\u4efd\u7684\u540c\u65f6\uff0c\u5907\u4efd\u6570\u636e\u4f1a\u5728\u5907\u4efd\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u4ee5\u5f53\u524d\u65f6\u95f4\u4e3a\u540d\u5b57\u7684\u76ee\u5f55\u5b58\u653e\u5907\u4efd\u6587\u4ef6\u3002 \u5404\u6587\u4ef6\u8bf4\u660e\uff1a \uff08 1 \uff09 xtrabackup_checkpoints \u2014 - \u5907\u4efd\u7c7b\u578b\uff08\u5982\u5b8c\u5168\u6216\u589e\u91cf\uff09\u3001\u5907\u4efd\u72b6\u6001\uff08\u5982\u662f\u5426\u5df2\u7ecf\u6ca1 prepare\u72b6\u6001 \uff09\u548c LSN \uff08\u65e5\u5fd7\u5e8f\u5217\u53f7\uff09\u8303\u56f4\u4fe1\u606f \u6bcf\u4e2a InnoDB\u9875 \uff08\u901a\u5e38\u5927\u5c0f\u4e3a 16 K \uff09\u90fd\u4f1a\u5305\u542b\u4e00\u4e2a\u65e5\u5fd7\u5e8f\u5217\u53f7\uff0c\u5373 LSN \uff0c LSN\u662f\u6574\u4e2a\u6570\u636e\u5e93\u7cfb\u7edf\u7684\u7cfb\u7edf\u7248\u672c\u53f7 \uff0c\u6bcf\u4e2a\u9875\u9762\u76f8\u5173\u7684 LSN\u80fd\u591f\u8868\u540d\u6b64\u9875\u9762\u6700\u8fd1\u662f\u5982\u4f55\u53d1\u751f\u6539\u53d8\u7684 \u3002 backup_type = full - backuped from_lsn = 0 to_lsn = 2097320 last_lsn = 2097320 compact = 0 \uff08 2 \uff09 xtrabackup_binlog_info \u2014 - mysql\u670d\u52a1\u5668\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u53ca\u5907\u4efd\u8fd9\u4e00\u523b\u4e3a\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e8b\u4ef6\u7684\u4f4d\u7f6e \uff08 3 \uff09 xtrabackup_pos_innodb \u2014 - \u4e8c\u8fdb\u5236\u65e5\u5fd7\u53ca\u7528\u4e8e InnoDB\u6216XtraDB\u8868\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7684\u5f53\u524dposistion \u3002 \uff08 4 \uff09 xtrabackup_binary \u2014 - \u5907\u4efd\u4e2d\u7528\u5230\u7684 xtrabackup\u7684\u53ef\u6267\u884c\u6587\u4ef6 \uff08 5 \uff09 backup - my . cnf \u2014 - \u5907\u4efd\u547d\u4ee4\u7528\u5230\u7684\u914d\u7f6e\u9009\u9879\u4fe1\u606f\uff1b \u5728\u4f7f\u7528 innobackupex\u547d\u4ee4\u5907\u4efd\u65f6\u5417\u8fd8\u53ef\u4ee5\u4f7f\u7528 \u2013 no - timestamp\u9009\u9879\u6765\u963b\u6b62\u547d\u4ee4\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u4ee5\u65f6\u95f4\u547d\u540d\u7684\u76ee\u5f55 innobackupex\u547d\u4ee4\u5c06\u4f1a\u521b\u5efa\u4e00\u4e2aBACKUP - DIR\u76ee\u5f55\u6765\u5b58\u50a8\u5907\u4efd\u6570\u636e \u8fd8\u9700\u8981\u6ce8\u610f\uff0c\u5907\u4efd\u6570\u636e\u5e93\u7684\u7528\u6237\u9700\u8981\u5177\u6709\u76f8\u5bf9\u5e94\u7684\u6743\u9650\uff0c\u5982\u679c\u8981\u4f7f\u7528\u4e00\u4e2a\u6700\u5c0f\u6743\u9650\u7684\u7528\u6237\u8fdb\u884c\u5907\u4efd\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u53c2\u6570\uff1a mysql > GRANT RELOAD , LOCK TABLES , REPLICATION CLIENT ON *.* TO \u2018 bkpuser \u2019@\u2019 localhost \u2019 ; mysql > FLUSH PRIVILEGES ; \u5728\u4f7f\u7528innobackupex\u8fdb\u884c\u5907\u4efd [root@localhost opt]# ll /opt/ total 4 drwxr-xr-x. 5 root root 4096 Jan 5 11:04 2017-01-05_11-04-55 [root@localhost opt]# systemctl stop mysql [root@localhost opt]# grep datadir /etc/my.cnf datadir=/var/lib/mysql [root@localhost opt]# cd /var/lib/mysql [root@localhost mysql]# rm -rf *","title":"4.1.1 \u5168\u91cf\u5907\u4efd"},{"location":"linux/server/xtrabackup/xtrabackup.index/#412","text":"\u51c6\u5907\u4e00\u4e2a\u5b8c\u6574\u5907\u4efd\uff08prepare\uff09 \u5728\u4f7f\u7528innobackup\u8fdb\u884c\u5907\u4efd\u65f6\u5019\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528--no-timestamp\u9009\u9879\u6765\u963b\u6b62\u547d\u4ee4\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u65f6\u95f4\u547d\u540d\u7684\u76ee\u5f55\u3002\u5982\u6b64\u4e00\u6765\uff0cinnobackupex\u547d\u4ee4\u5c06\u4f1a\u521b\u5efa\u4e00\u4e2aBACKUP-DIR\u76ee\u5f55\u6765\u50a8\u5b58\u5907\u4efd\u6570\u636e\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5728\u5907\u4efd\u5b8c\u6210\u540e\uff0c\u6570\u636e\u4e14\u5c1a\u4e0d\u80fd\u7528\u4e8e\u6062\u590d\u64cd\u4f5c\uff0c\u56e0\u4e3a\u5907\u4efd\u7684\u6570\u636e\u4e2d\u53ef\u80fd\u5305\u542b\u5c1a\u672a\u63d0\u4ea4\u7684\u4e8b\u7269\u6216\u8005\u5df2\u7ecf\u63d0\u4ea4\u4f46\u5c1a\u672a\u540c\u6b65\u81f3\u6570\u636e\u6587\u4ef6\u4e2d\u7684\u4e8b\u7269\uff0c\u56e0\u6b64\u6b64\u65f6\u6570\u636e\u6587\u4ef6\u4ecd\u7136\u5904\u4e8e\u4e0d\u4e00\u81f4\u72b6\u6001\uff0c\u51c6\u5907\u7684\u4e3b\u8981\u4f5c\u7528\u6b63\u662f\u901a\u8fc7\u56de\u6eda\u672a\u63d0\u4ea4\u7684\u4e8b\u7269\u53ca\u540c\u6b65\u5df2\u7ecf\u63d0\u4ea4\u7684\u4e8b\u7269\u81f3\u6570\u636e\u6587\u4ef6\u4e5f\u4f7f\u5f97\u6570\u636e\u6587\u4ef6\u5904\u4e8e\u4e00\u81f4\u72b6\u6001\u3002 Innobackupex\uff0c\u547d\u4ee4\u7684--apply-log\u9009\u9879\u53ef\u4ee5\u5b9e\u73b0\u4e0a\u8ff0\u529f\u80fd\u3002 [root@localhost mysql]# innobackupex --apply-log /opt/2017-01-05_11-04-55/ InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy and Percona LLC and/or its affiliates 2009-2013. All Rights Reserved. This software is published under the GNU GENERAL PUBLIC LICENSE Version 2, June 1991. Get the latest version of Percona XtraBackup, documentation, and help resources: http://www.percona.com/xb/p 170105 11:19:14 innobackupex: Starting the apply-log operation IMPORTANT: Please check that the apply-log run completes successfully. At the end of a successful apply-log run innobackupex prints \"completed OK!\". 170105 11:19:14 innobackupex: Starting ibbackup with command: xtrabackup --defaults-file=\"/opt/2017-01-05_11-04-55/backup-my.cnf\" --defaults-group=\"mysqld\" --prepare --target-dir=/opt/2017-01-05_11-04-55 xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3) xtrabackup: cd to /opt/2017-01-05_11-04-55 xtrabackup: This target seems to be not prepared yet. xtrabackup: xtrabackup_logfile detected: size=2097152, start_lsn=(1666902) xtrabackup: using the following InnoDB configuration for recovery: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 1 xtrabackup: innodb_log_file_size = 2097152 xtrabackup: using the following InnoDB configuration for recovery: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 1 xtrabackup: innodb_log_file_size = 2097152 xtrabackup: Starting InnoDB instance for recovery. xtrabackup: Using 104857600 bytes for buffer pool (set by --use-memory parameter) InnoDB: Using atomics to ref count buffer pool pages InnoDB: The InnoDB memory heap is disabled InnoDB: Mutexes and rw_locks use GCC atomic builtins InnoDB: Memory barrier is not used InnoDB: Compressed tables use zlib 1.2.7 InnoDB: Using CPU crc32 instructions InnoDB: Initializing buffer pool, size = 100.0M InnoDB: Completed initialization of buffer pool InnoDB: Highest supported file format is Barracuda. InnoDB: The log sequence numbers 1663530 and 1663530 in ibdata files do not match the log sequence number 1666902 in the ib_logfiles! InnoDB: Database was not shutdown normally! InnoDB: Starting crash recovery. InnoDB: Reading tablespace information from the .ibd files... InnoDB: Restoring possible half-written data pages InnoDB: from the doublewrite buffer... InnoDB: Last MySQL binlog file position 0 1451, file name mysql-bin.000001 InnoDB: 128 rollback segment(s) are active. InnoDB: Waiting for purge to start InnoDB: 5.6.24 started; log sequence number 1666902 [notice (again)] If you use binary log and don't use any hack of group commit, the binary log position seems to be: InnoDB: Last MySQL binlog file position 0 1451, file name mysql-bin.000001 xtrabackup: starting shutdown with innodb_fast_shutdown = 1 InnoDB: FTS optimize thread exiting. InnoDB: Starting shutdown... InnoDB: Shutdown completed; log sequence number 1666912 170105 11:19:16 innobackupex: Restarting xtrabackup with command: xtrabackup --defaults-file=\"/opt/2017-01-05_11-04-55/backup-my.cnf\" --defaults-group=\"mysqld\" --prepare --target-dir=/opt/2017-01-05_11-04-55 for creating ib_logfile* xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3) xtrabackup: cd to /opt/2017-01-05_11-04-55 xtrabackup: This target seems to be already prepared. xtrabackup: notice: xtrabackup_logfile was already used to '--prepare'. xtrabackup: using the following InnoDB configuration for recovery: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 2 xtrabackup: innodb_log_file_size = 50331648 xtrabackup: using the following InnoDB configuration for recovery: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 2 xtrabackup: innodb_log_file_size = 50331648 xtrabackup: Starting InnoDB instance for recovery. xtrabackup: Using 104857600 bytes for buffer pool (set by --use-memory parameter) InnoDB: Using atomics to ref count buffer pool pages InnoDB: The InnoDB memory heap is disabled InnoDB: Mutexes and rw_locks use GCC atomic builtins InnoDB: Memory barrier is not used InnoDB: Compressed tables use zlib 1.2.7 InnoDB: Using CPU crc32 instructions InnoDB: Initializing buffer pool, size = 100.0M InnoDB: Completed initialization of buffer pool InnoDB: Setting log file ./ib_logfile101 size to 48 MB InnoDB: Setting log file ./ib_logfile1 size to 48 MB InnoDB: Renaming log file ./ib_logfile101 to ./ib_logfile0 InnoDB: New log files created, LSN=1666912 InnoDB: Highest supported file format is Barracuda. InnoDB: 128 rollback segment(s) are active. InnoDB: Waiting for purge to start InnoDB: 5.6.24 started; log sequence number 1667084 [notice (again)] If you use binary log and don't use any hack of group commit, the binary log position seems to be: InnoDB: Last MySQL binlog file position 0 1451, file name mysql-bin.000001 xtrabackup: starting shutdown with innodb_fast_shutdown = 1 InnoDB: FTS optimize thread exiting. InnoDB: Starting shutdown... InnoDB: Shutdown completed; log sequence number 1667094 170105 11:19:18 innobackupex: completed OK! \u5185\u5b58\u6307\u5b9a \u5728\u5b9e\u73b0\u51c6\u5907\u8fc7\u7a0b\u4e2d\uff0c innobackupex\u901a\u5e38\u8fd8\u53ef\u4ee5\u4f7f\u7528 -- user - memory\u9009\u9879\u6765\u6307\u5b9a\u5176\u53ef\u4ee5\u4f7f\u7528\u7684\u5185\u5b58\u5927\u5c0f \u3002\u9ed8\u8ba4\u901a\u5e38\u662f 100 M \uff0c\u5982\u679c\u6709\u8db3\u591f\u7684\u5185\u5b58\u4f7f\u7528\uff0c\u53ef\u4ee5\u591a\u5212\u5206\u4e00\u4e9b\u7ed9\u5185\u5b58\u51c6\u5907 prepare \uff0c\u4ee5\u63d0\u9ad8\u5176\u5b8c\u6210\u901f\u5ea6\u3002 \u4ece\u4e00\u4e2a\u5b8c\u6574\u5907\u4efd\u4e2d\u6062\u590d\u6570\u636e. Innobackupex\u547d\u4ee4\u7684--copy-back\u9009\u9879\u7528\u4e8e\u6267\u884c\u6062\u590d\u64cd\u4f5c\uff0c\u5176\u901a\u8fc7\u590d\u5236\u6240\u6709\u7684\u6570\u636e\u76f8\u5173\u6587\u4ef6\u5230mysql\u670d\u52a1\u5668\u7684DATADIR\u76ee\u5f55\u6765\u6267\u884c\u6062\u590d\u8fc7\u7a0b\uff0cinnobackupex\u901a\u8fc7backup-my.cnf\u6765\u83b7\u53d6DATADIR\u76ee\u5f55\u76f8\u5173\u4fe1\u606f\u3002 \u5f00\u59cb\u6062\u590d [root@localhost mysql]# innobackupex --copy-back --defaults-file=/etc/my.cnf /opt/2017-01-05_11-04-55/ InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy and Percona LLC and/or its affiliates 2009-2013. All Rights Reserved. This software is published under the GNU GENERAL PUBLIC LICENSE Version 2, June 1991. Get the latest version of Percona XtraBackup, documentation, and help resources: http://www.percona.com/xb/p 170105 11:26:34 innobackupex: Starting the copy-back operation IMPORTANT: Please check that the copy-back run completes successfully. At the end of a successful copy-back run innobackupex prints \"completed OK!\". innobackupex: Starting to copy files in '/opt/2017-01-05_11-04-55' innobackupex: back to original data directory '/var/lib/mysql' innobackupex: Copying '/opt/2017-01-05_11-04-55/xtrabackup_info' to '/var/lib/mysql/xtrabackup_info' innobackupex: Copying '/opt/2017-01-05_11-04-55/xtrabackup_binlog_pos_innodb' to '/var/lib/mysql/xtrabackup_binlog_pos_innodb' innobackupex: Creating directory '/var/lib/mysql/mysql' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/innodb_table_stats.ibd' to '/var/lib/mysql/mysql/innodb_table_stats.ibd' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/innodb_index_stats.ibd' to '/var/lib/mysql/mysql/innodb_index_stats.ibd' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slave_relay_log_info.ibd' to '/var/lib/mysql/mysql/slave_relay_log_info.ibd' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slave_master_info.ibd' to '/var/lib/mysql/mysql/slave_master_info.ibd' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slave_worker_info.ibd' to '/var/lib/mysql/mysql/slave_worker_info.ibd' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/db.frm' to '/var/lib/mysql/mysql/db.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/db.MYI' to '/var/lib/mysql/mysql/db.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/db.MYD' to '/var/lib/mysql/mysql/db.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/user.frm' to '/var/lib/mysql/mysql/user.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/user.MYI' to '/var/lib/mysql/mysql/user.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/user.MYD' to '/var/lib/mysql/mysql/user.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/func.frm' to '/var/lib/mysql/mysql/func.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/func.MYI' to '/var/lib/mysql/mysql/func.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/func.MYD' to '/var/lib/mysql/mysql/func.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/plugin.frm' to '/var/lib/mysql/mysql/plugin.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/plugin.MYI' to '/var/lib/mysql/mysql/plugin.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/plugin.MYD' to '/var/lib/mysql/mysql/plugin.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/servers.frm' to '/var/lib/mysql/mysql/servers.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/servers.MYI' to '/var/lib/mysql/mysql/servers.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/servers.MYD' to '/var/lib/mysql/mysql/servers.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/tables_priv.frm' to '/var/lib/mysql/mysql/tables_priv.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/tables_priv.MYI' to '/var/lib/mysql/mysql/tables_priv.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/tables_priv.MYD' to '/var/lib/mysql/mysql/tables_priv.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/columns_priv.frm' to '/var/lib/mysql/mysql/columns_priv.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/columns_priv.MYI' to '/var/lib/mysql/mysql/columns_priv.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/columns_priv.MYD' to '/var/lib/mysql/mysql/columns_priv.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_topic.frm' to '/var/lib/mysql/mysql/help_topic.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_topic.MYI' to '/var/lib/mysql/mysql/help_topic.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_topic.MYD' to '/var/lib/mysql/mysql/help_topic.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_category.frm' to '/var/lib/mysql/mysql/help_category.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_category.MYI' to '/var/lib/mysql/mysql/help_category.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_category.MYD' to '/var/lib/mysql/mysql/help_category.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_relation.frm' to '/var/lib/mysql/mysql/help_relation.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_relation.MYI' to '/var/lib/mysql/mysql/help_relation.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_relation.MYD' to '/var/lib/mysql/mysql/help_relation.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_keyword.frm' to '/var/lib/mysql/mysql/help_keyword.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_keyword.MYI' to '/var/lib/mysql/mysql/help_keyword.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/help_keyword.MYD' to '/var/lib/mysql/mysql/help_keyword.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_name.frm' to '/var/lib/mysql/mysql/time_zone_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_name.MYI' to '/var/lib/mysql/mysql/time_zone_name.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_name.MYD' to '/var/lib/mysql/mysql/time_zone_name.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone.frm' to '/var/lib/mysql/mysql/time_zone.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone.MYI' to '/var/lib/mysql/mysql/time_zone.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone.MYD' to '/var/lib/mysql/mysql/time_zone.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_transition.frm' to '/var/lib/mysql/mysql/time_zone_transition.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_transition.MYI' to '/var/lib/mysql/mysql/time_zone_transition.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_transition.MYD' to '/var/lib/mysql/mysql/time_zone_transition.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_transition_type.frm' to '/var/lib/mysql/mysql/time_zone_transition_type.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_transition_type.MYI' to '/var/lib/mysql/mysql/time_zone_transition_type.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_transition_type.MYD' to '/var/lib/mysql/mysql/time_zone_transition_type.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_leap_second.frm' to '/var/lib/mysql/mysql/time_zone_leap_second.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_leap_second.MYI' to '/var/lib/mysql/mysql/time_zone_leap_second.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/time_zone_leap_second.MYD' to '/var/lib/mysql/mysql/time_zone_leap_second.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/proc.frm' to '/var/lib/mysql/mysql/proc.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/proc.MYI' to '/var/lib/mysql/mysql/proc.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/proc.MYD' to '/var/lib/mysql/mysql/proc.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/procs_priv.frm' to '/var/lib/mysql/mysql/procs_priv.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/procs_priv.MYI' to '/var/lib/mysql/mysql/procs_priv.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/procs_priv.MYD' to '/var/lib/mysql/mysql/procs_priv.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/general_log.frm' to '/var/lib/mysql/mysql/general_log.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/general_log.CSM' to '/var/lib/mysql/mysql/general_log.CSM' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/general_log.CSV' to '/var/lib/mysql/mysql/general_log.CSV' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slow_log.frm' to '/var/lib/mysql/mysql/slow_log.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slow_log.CSM' to '/var/lib/mysql/mysql/slow_log.CSM' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slow_log.CSV' to '/var/lib/mysql/mysql/slow_log.CSV' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/event.frm' to '/var/lib/mysql/mysql/event.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/event.MYI' to '/var/lib/mysql/mysql/event.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/event.MYD' to '/var/lib/mysql/mysql/event.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/ndb_binlog_index.frm' to '/var/lib/mysql/mysql/ndb_binlog_index.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/ndb_binlog_index.MYI' to '/var/lib/mysql/mysql/ndb_binlog_index.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/ndb_binlog_index.MYD' to '/var/lib/mysql/mysql/ndb_binlog_index.MYD' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/innodb_table_stats.frm' to '/var/lib/mysql/mysql/innodb_table_stats.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/innodb_index_stats.frm' to '/var/lib/mysql/mysql/innodb_index_stats.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slave_relay_log_info.frm' to '/var/lib/mysql/mysql/slave_relay_log_info.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slave_master_info.frm' to '/var/lib/mysql/mysql/slave_master_info.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/slave_worker_info.frm' to '/var/lib/mysql/mysql/slave_worker_info.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/proxies_priv.frm' to '/var/lib/mysql/mysql/proxies_priv.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/proxies_priv.MYI' to '/var/lib/mysql/mysql/proxies_priv.MYI' innobackupex: Copying '/opt/2017-01-05_11-04-55/mysql/proxies_priv.MYD' to '/var/lib/mysql/mysql/proxies_priv.MYD' innobackupex: Creating directory '/var/lib/mysql/leco' innobackupex: Copying '/opt/2017-01-05_11-04-55/leco/student.ibd' to '/var/lib/mysql/leco/student.ibd' innobackupex: Copying '/opt/2017-01-05_11-04-55/leco/db.opt' to '/var/lib/mysql/leco/db.opt' innobackupex: Copying '/opt/2017-01-05_11-04-55/leco/student.frm' to '/var/lib/mysql/leco/student.frm' innobackupex: Creating directory '/var/lib/mysql/performance_schema' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/db.opt' to '/var/lib/mysql/performance_schema/db.opt' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/cond_instances.frm' to '/var/lib/mysql/performance_schema/cond_instances.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_current.frm' to '/var/lib/mysql/performance_schema/events_waits_current.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_history.frm' to '/var/lib/mysql/performance_schema/events_waits_history.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_history_long.frm' to '/var/lib/mysql/performance_schema/events_waits_history_long.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_summary_by_instance.frm' to '/var/lib/mysql/performance_schema/events_waits_summary_by_instance.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_summary_by_host_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_waits_summary_by_host_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_summary_by_user_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_waits_summary_by_user_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_summary_by_account_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_waits_summary_by_account_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_summary_by_thread_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_waits_summary_by_thread_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_waits_summary_global_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_waits_summary_global_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/file_instances.frm' to '/var/lib/mysql/performance_schema/file_instances.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/file_summary_by_event_name.frm' to '/var/lib/mysql/performance_schema/file_summary_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/file_summary_by_instance.frm' to '/var/lib/mysql/performance_schema/file_summary_by_instance.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/socket_instances.frm' to '/var/lib/mysql/performance_schema/socket_instances.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/socket_summary_by_instance.frm' to '/var/lib/mysql/performance_schema/socket_summary_by_instance.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/socket_summary_by_event_name.frm' to '/var/lib/mysql/performance_schema/socket_summary_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/host_cache.frm' to '/var/lib/mysql/performance_schema/host_cache.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/mutex_instances.frm' to '/var/lib/mysql/performance_schema/mutex_instances.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/objects_summary_global_by_type.frm' to '/var/lib/mysql/performance_schema/objects_summary_global_by_type.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/performance_timers.frm' to '/var/lib/mysql/performance_schema/performance_timers.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/rwlock_instances.frm' to '/var/lib/mysql/performance_schema/rwlock_instances.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/setup_actors.frm' to '/var/lib/mysql/performance_schema/setup_actors.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/setup_consumers.frm' to '/var/lib/mysql/performance_schema/setup_consumers.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/setup_instruments.frm' to '/var/lib/mysql/performance_schema/setup_instruments.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/setup_objects.frm' to '/var/lib/mysql/performance_schema/setup_objects.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/setup_timers.frm' to '/var/lib/mysql/performance_schema/setup_timers.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/table_io_waits_summary_by_index_usage.frm' to '/var/lib/mysql/performance_schema/table_io_waits_summary_by_index_usage.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/table_io_waits_summary_by_table.frm' to '/var/lib/mysql/performance_schema/table_io_waits_summary_by_table.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/table_lock_waits_summary_by_table.frm' to '/var/lib/mysql/performance_schema/table_lock_waits_summary_by_table.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/threads.frm' to '/var/lib/mysql/performance_schema/threads.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_current.frm' to '/var/lib/mysql/performance_schema/events_stages_current.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_history.frm' to '/var/lib/mysql/performance_schema/events_stages_history.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_history_long.frm' to '/var/lib/mysql/performance_schema/events_stages_history_long.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_summary_by_thread_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_stages_summary_by_thread_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_summary_by_host_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_stages_summary_by_host_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_summary_by_user_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_stages_summary_by_user_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_summary_by_account_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_stages_summary_by_account_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_stages_summary_global_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_stages_summary_global_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_current.frm' to '/var/lib/mysql/performance_schema/events_statements_current.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_history.frm' to '/var/lib/mysql/performance_schema/events_statements_history.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_history_long.frm' to '/var/lib/mysql/performance_schema/events_statements_history_long.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_summary_by_thread_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_statements_summary_by_thread_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_summary_by_host_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_statements_summary_by_host_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_summary_by_user_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_statements_summary_by_user_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_summary_by_account_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_statements_summary_by_account_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_summary_global_by_event_name.frm' to '/var/lib/mysql/performance_schema/events_statements_summary_global_by_event_name.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/hosts.frm' to '/var/lib/mysql/performance_schema/hosts.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/users.frm' to '/var/lib/mysql/performance_schema/users.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/accounts.frm' to '/var/lib/mysql/performance_schema/accounts.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/events_statements_summary_by_digest.frm' to '/var/lib/mysql/performance_schema/events_statements_summary_by_digest.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/session_connect_attrs.frm' to '/var/lib/mysql/performance_schema/session_connect_attrs.frm' innobackupex: Copying '/opt/2017-01-05_11-04-55/performance_schema/session_account_connect_attrs.frm' to '/var/lib/mysql/performance_schema/session_account_connect_attrs.frm' innobackupex: Starting to copy InnoDB system tablespace innobackupex: in '/opt/2017-01-05_11-04-55' innobackupex: back to original InnoDB data directory '/var/lib/mysql' innobackupex: Copying '/opt/2017-01-05_11-04-55/ibdata1' to '/var/lib/mysql/ibdata1' innobackupex: Starting to copy InnoDB undo tablespaces innobackupex: in '/opt/2017-01-05_11-04-55' innobackupex: back to '/var/lib/mysql' innobackupex: Starting to copy InnoDB log files innobackupex: in '/opt/2017-01-05_11-04-55' innobackupex: back to original InnoDB log directory '/var/lib/mysql' innobackupex: Copying '/opt/2017-01-05_11-04-55/ib_logfile1' to '/var/lib/mysql/ib_logfile1' innobackupex: Copying '/opt/2017-01-05_11-04-55/ib_logfile0' to '/var/lib/mysql/ib_logfile0' innobackupex: Finished copying back files. 170105 11:26:35 innobackupex: completed OK! \u6062\u590d\u6210\u529f\u3002 [root@localhost mysql]# ll total 110608 -rw-r--r--. 1 root root 12582912 Jan 5 11:26 ibdata1 -rw-r--r--. 1 root root 50331648 Jan 5 11:26 ib_logfile0 -rw-r--r--. 1 root root 50331648 Jan 5 11:26 ib_logfile1 drwxr-xr-x. 2 root root 55 Jan 5 11:26 leco drwxr-xr-x. 2 root root 4096 Jan 5 11:26 mysql drwxr-xr-x. 2 root root 4096 Jan 5 11:26 performance_schema -rw-r--r--. 1 root root 22 Jan 5 11:26 xtrabackup_binlog_pos_innodb -rw-r--r--. 1 root root 584 Jan 5 11:26 xtrabackup_info \u6240\u5c5e\u7ec4\u53d8\u66f4 \u6b64\u65f6\u6570\u636e\u6062\u590d\u5230 DATADIR\u76ee\u5f55\u540e \uff0c\u8fd8\u8981\u786e\u4fdd\u6240\u6709\u6570\u636e\u6587\u4ef6\u5c5e\u6027\u4e3a\u6b63\u786e\u7528\u6237\u548c\u7ec4\uff0c\u5982 MySQL \uff0c\u5426\u5219\u542f\u52a8\u4e0d\u4e86\u3002 [root@localhost mysql]# chown -R mysql.mysql . [root@localhost mysql]# ll total 110608 -rw-r--r--. 1 mysql mysql 12582912 Jan 5 11:26 ibdata1 -rw-r--r--. 1 mysql mysql 50331648 Jan 5 11:26 ib_logfile0 -rw-r--r--. 1 mysql mysql 50331648 Jan 5 11:26 ib_logfile1 drwxr-xr-x. 2 mysql mysql 55 Jan 5 11:26 leco drwxr-xr-x. 2 mysql mysql 4096 Jan 5 11:26 mysql drwxr-xr-x. 2 mysql mysql 4096 Jan 5 11:26 performance_schema -rw-r--r--. 1 mysql mysql 22 Jan 5 11:26 xtrabackup_binlog_pos_innodb -rw-r--r--. 1 mysql mysql 584 Jan 5 11:26 xtrabackup_info [root@localhost mysql]# systemctl start mysql [root@localhost mysql]# ll total 110620 -rw-rw----. 1 mysql mysql 56 Jan 5 11:28 auto.cnf -rw-r--r--. 1 mysql mysql 12582912 Jan 5 11:28 ibdata1 -rw-r--r--. 1 mysql mysql 50331648 Jan 5 11:28 ib_logfile0 -rw-r--r--. 1 mysql mysql 50331648 Jan 5 11:26 ib_logfile1 drwxr-xr-x. 2 mysql mysql 55 Jan 5 11:26 leco drwxr-xr-x. 2 mysql mysql 4096 Jan 5 11:26 mysql -rw-rw----. 1 mysql mysql 120 Jan 5 11:28 mysql-bin.000001 -rw-rw----. 1 mysql mysql 19 Jan 5 11:28 mysql-bin.index srwxrwxrwx. 1 mysql mysql 0 Jan 5 11:28 mysql.sock drwxr-xr-x. 2 mysql mysql 4096 Jan 5 11:26 performance_schema -rw-r--r--. 1 mysql mysql 22 Jan 5 11:26 xtrabackup_binlog_pos_innodb -rw-r--r--. 1 mysql mysql 584 Jan 5 11:26 xtrabackup_info \u767b\u9646\u6d4b\u8bd5\u770b\u770b\u6ca1\u6709\u6ca1\u6062\u590d\u8fc7\u6765 [root@localhost mysql]# mysql -uroot -proot Warning: Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 2 Server version: 5.6.35-log MySQL Community Server (GPL) Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | leco | | mysql | | performance_schema | +--------------------+ 4 rows in set (0.02 sec) mysql> use leco; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +----------------+ | Tables_in_leco | +----------------+ | student | +----------------+ 1 row in set (0.02 sec) mysql> desc student; +-------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+-------+ | id | int(4) | NO | | NULL | | | name | char(20) | NO | | NULL | | | age | tinyint(2) | NO | | 0 | | | dept | varchar(16) | YES | | NULL | | +-------+-------------+------+-----+---------+-------+ 4 rows in set (0.01 sec) mysql> select * from student; +----+------+-----+------+ | id | name | age | dept | +----+------+-----+------+ | 1 | good | 15 | NULL | | 2 | hehe | 18 | NULL | | 1 | good | 15 | NULL | | 2 | hehe | 18 | NULL | +----+------+-----+------+ 4 rows in set (0.02 sec) \u5230\u73b0\u5728\u5168\u5907\u5df2\u7ecf\u6d4b\u8bd5OK. \u5148\u63d2\u5165\u51e0\u4e2a\u6570\u636e\uff0c\u4e3a\u589e\u91cf\u5907\u4efd\u505a\u51c6\u5907 mysql> insert into student(id,name,age) values(2,'beijing',100); Query OK, 1 row affected (0.01 sec) mysql> insert into student(id,name,age) values(2,'cmz',30); Query OK, 1 row affected (0.01 sec) mysql> select * from student; +----+---------+-----+------+ | id | name | age | dept | +----+---------+-----+------+ | 1 | good | 15 | NULL | | 2 | hehe | 18 | NULL | | 1 | good | 15 | NULL | | 2 | hehe | 18 | NULL | | 2 | beijing | 100 | NULL | | 2 | cmz | 30 | NULL | +----+---------+-----+------+ 6 rows in set (0.00 sec)","title":"4.1.2 \u5168\u91cf\u5907\u4efd\u6062\u590d"},{"location":"linux/server/xtrabackup/xtrabackup.index/#42","text":"","title":"4.2 \u57fa\u4e8e\u5168\u91cf\u5907\u4efd\u589e\u91cf\u5907\u4efd\u4e0e\u6062\u590d"},{"location":"linux/server/xtrabackup/xtrabackup.index/#421","text":"\u6bcf\u4e2aInnoDB\u7684\u9875\u9762\u90fd\u4f1a\u5305\u542b\u4e00\u4e2aLSN\u4fe1\u606f\uff0c\u6bcf\u5f53\u76f8\u5173\u6570\u636e\u53d1\u751f\u6539\u53d8\uff0c\u76f8\u5173\u9875\u9762\u7684LSN\u4e5f\u4f1a\u81ea\u52a8\u589e\u957f\uff0c\u8fd9\u6b63\u662fInnoDB\u8868\u5c05\u6709\u8fdb\u884c\u589e\u91cf\u5907\u4efd\u7684\u57fa\u7840\uff0c\u5373innobackupex\u901a\u8fc7\u4e0a\u6b21\u5b8c\u5168\u5907\u4efd\u4e4b\u540e\u53d1\u751f\u6539\u53d8\u7684\u9875\u9762\u6765\u5b9e\u73b0\u3002\u5728\u8fdb\u884c\u589e\u91cf\u5907\u4efd\u65f6\uff0c\u9996\u5148\u8981\u8fdb\u884c\u4e00\u6b21\u5168\u91cf\u5907\u4efd\uff0c\u7b2c\u4e00\u6b21\u589e\u91cf\u5907\u4efd\u662f\u57fa\u4e8e\u5168\u5907\u7684\uff0c\u4e4b\u540e\u7684\u589e\u91cf\u5907\u4efd\u662f\u57fa\u4e8e\u4e0a\u4e00\u6b21\u7684\u589e\u91cf\u5907\u4efd\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002 \u8981\u5148\u5b9e\u73b0\u7b2c\u4e00\u6b21\u589e\u91cf\u5907\u4efd\u3002\u53ef\u4ee5\u5b9e\u73b0\u4e0b\u547d\u4ee4\u8fdb\u884c \u57fa\u4e8e\u5168\u91cf\u5907\u4efd\u7684\u589e\u91cf\u5907\u4efd\u4e0e\u6062\u590d \u505a\u4e00\u6b21\u589e\u91cf\u5907\u4efd\uff08\u57fa\u4e8e\u5f53\u524d\u6700\u65b0\u7684\u5168\u91cf\u5907\u4efd\uff09 innobackupex --user=root --password=root --defaults-file=/etc/my.cnf --incremental /opt/ --incremental-basedir=/opt/2017-01-05_11-04-55/ 1. \u51c6\u5907\u57fa\u4e8e\u5168\u91cf innobackupex --user=root --password=root --defaults-file=/etc/my.cnf --apply-log --redo-only /opt/2017-01-05_11-04-55/ 2. \u51c6\u5907\u57fa\u4e8e\u589e\u91cf innobackupex --user=root --password=root --defaults-file=/etc/my.cnf --apply-log --redo-only /opt/2017-01-05_11-04-55/ --incremental-dir=/opt/2017-01-05_11-44-22/ 3. \u6062\u590d innobackupex --copy-back --defaults-file=/etc/my.cnf /opt/2017-01-05_11-04-55/ \u89e3\u91ca 1.2017 - 01 - 05 _11 - 04 - 55 \u6307\u7684\u662f\u5b8c\u5168\u5907\u4efd\u6240\u5728\u7684\u76ee\u5f55\u3002 2.2017 - 01 - 05 _11 - 44 - 22 \u6307\u5b9a\u662f\u7b2c\u4e00\u6b21\u57fa\u4e8e 2017 - 01 - 05 _11 - 04 - 55 \u589e\u91cf\u5907\u4efd\u7684\u76ee\u5f55\uff0c\u5176\u4ed6\u7c7b\u4f3c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u5373\u5982\u679c\u6709\u591a\u6b21\u589e\u91cf\u5907\u4efd\u3002\u6bcf\u4e00\u6b21\u90fd\u8981\u6267\u884c\u5982\u4e0a\u64cd\u4f5c\u3002 \u5f00\u59cb [root@localhost mysql]# innobackupex --user=root --password=root --defaults-file=/etc/my.cnf --incremental /opt/ --incremental-basedir=/opt/2017-01-05_11-04-55/ InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy and Percona LLC and/or its affiliates 2009-2013. All Rights Reserved. This software is published under the GNU GENERAL PUBLIC LICENSE Version 2, June 1991. Get the latest version of Percona XtraBackup, documentation, and help resources: http://www.percona.com/xb/p 170105 11:44:22 innobackupex: Executing a version check against the server... 170105 11:44:22 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 11:44:22 innobackupex: Connected to MySQL server 170105 11:44:22 innobackupex: Done. 170105 11:44:22 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 11:44:22 innobackupex: Connected to MySQL server 170105 11:44:22 innobackupex: Starting the backup operation IMPORTANT: Please check that the backup run completes successfully. At the end of a successful backup run innobackupex prints \"completed OK!\". innobackupex: Using server version 5.6.35-log innobackupex: Created backup directory /opt/2017-01-05_11-44-22 170105 11:44:22 innobackupex: Starting ibbackup with command: xtrabackup --defaults-file=\"/etc/my.cnf\" --defaults-group=\"mysqld\" --backup --suspend-at-end --target-dir=/opt/2017-01-05_11-44-22 --innodb_log_file_size=\"50331648\" --innodb_data_file_path=\"ibdata1:12M:autoextend\" --tmpdir=/tmp --extra-lsndir='/tmp' --incremental-basedir='/opt/2017-01-05_11-04-55/' innobackupex: Waiting for ibbackup (pid=27861) to suspend innobackupex: Suspend file '/opt/2017-01-05_11-44-22/xtrabackup_suspended_2' xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3) incremental backup from 1666902 is enabled. xtrabackup: uses posix_fadvise(). xtrabackup: cd to /var/lib/mysql xtrabackup: open files limit requested 0, set to 1024 xtrabackup: using the following InnoDB configuration: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 2 xtrabackup: innodb_log_file_size = 50331648 >> log scanned up to (1669207) xtrabackup: Generating a list of tablespaces xtrabackup: using the full scan for incremental backup [01] Copying ./ibdata1 to /opt/2017-01-05_11-44-22/ibdata1.delta [01] ...done [01] Copying ./mysql/innodb_table_stats.ibd to /opt/2017-01-05_11-44-22/mysql/innodb_table_stats.ibd.delta [01] ...done [01] Copying ./mysql/innodb_index_stats.ibd to /opt/2017-01-05_11-44-22/mysql/innodb_index_stats.ibd.delta [01] ...done [01] Copying ./mysql/slave_relay_log_info.ibd to /opt/2017-01-05_11-44-22/mysql/slave_relay_log_info.ibd.delta [01] ...done [01] Copying ./mysql/slave_master_info.ibd to /opt/2017-01-05_11-44-22/mysql/slave_master_info.ibd.delta [01] ...done [01] Copying ./mysql/slave_worker_info.ibd to /opt/2017-01-05_11-44-22/mysql/slave_worker_info.ibd.delta [01] ...done [01] Copying ./leco/student.ibd to /opt/2017-01-05_11-44-22/leco/student.ibd.delta [01] ...done >> log scanned up to (1669207) xtrabackup: Creating suspend file '/opt/2017-01-05_11-44-22/xtrabackup_suspended_2' with pid '27861' 170105 11:44:24 innobackupex: Continuing after ibbackup has suspended 170105 11:44:24 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG TABLES... >> log scanned up to (1669207) 170105 11:44:24 innobackupex: Executing FLUSH TABLES WITH READ LOCK... 170105 11:44:24 innobackupex: All tables locked and flushed to disk 170105 11:44:24 innobackupex: Starting to backup non-InnoDB tables and files innobackupex: in subdirectories of '/var/lib/mysql/' innobackupex: Backing up files '/var/lib/mysql//mysql/*.{frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par}' (74 files) innobackupex: Backing up file '/var/lib/mysql//leco/db.opt' innobackupex: Backing up file '/var/lib/mysql//leco/student.frm' innobackupex: Backing up files '/var/lib/mysql//performance_schema/*.{frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par}' (53 files) 170105 11:44:25 innobackupex: Finished backing up non-InnoDB tables and files 170105 11:44:25 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS... 170105 11:44:25 innobackupex: Waiting for log copying to finish xtrabackup: The latest check point (for incremental): '1669207' xtrabackup: Stopping log copying thread. .>> log scanned up to (1669207) xtrabackup: Creating suspend file '/opt/2017-01-05_11-44-22/xtrabackup_log_copied' with pid '27861' xtrabackup: Transaction log of lsn (1669207) to (1669207) was copied. 170105 11:44:26 innobackupex: All tables unlocked innobackupex: Backup created in directory '/opt/2017-01-05_11-44-22' innobackupex: MySQL binlog position: filename 'mysql-bin.000001', position 595 170105 11:44:26 innobackupex: Connection to database server closed 170105 11:44:26 innobackupex: completed OK! [root@localhost 2017-01-05_11-04-55]# cat xtrabackup_checkpoints #\u5168\u91cf\u5907\u4efd\u70b9 backup_type = full-prepared from_lsn = 0 to_lsn = 1666902 last_lsn = 1666902 compact = 0 [root@localhost 2017-01-05_11-04-55]# cd ../2017-01-05_11-44-22/ [root@localhost 2017-01-05_11-44-22]# ls backup-my.cnf ibdata1.meta mysql xtrabackup_binlog_info xtrabackup_info ibdata1.delta leco performance_schema xtrabackup_checkpoints xtrabackup_logfile [root@localhost 2017-01-05_11-44-22]# cat xtrabackup_checkpoints #\u589e\u91cf\u5907\u4efd\u70b9 backup_type = incremental from_lsn = 1666902 to_lsn = 1669207 last_lsn = 1669207 compact = 0","title":"4.2.1 \u589e\u91cf\u5907\u4efd"},{"location":"linux/server/xtrabackup/xtrabackup.index/#422","text":"\u51c6\u5907\uff08prepare\uff09\u589e\u91cf\u5907\u4efd\u4e0e\u6574\u4f53\u5b8c\u5168\u5907\u4efd\u6709\u4e00\u4e9b\u4e0d\u540c\uff0c\u5c24\u5176\u8981\u6ce8\u610f\u7684\u662f \u9700\u8981\u5728\u6bcf\u4e2a\u5907\u4efd\uff08\u5305\u62ec\u5b8c\u5168\u548c\u5404\u4e2a\u589e\u91cf\u5907\u4efd\uff09\u4e0a\uff0c\u5c06\u5df2\u7ecf\u63d0\u4ea4\u7684\u4e8b\u7269\u8fdb\u884c\uff0c\u91cd\u653e\u3002\u91cd\u653e\u4e4b\u540e\uff0c\u6240\u6709\u7684\u5907\u4efd\u6570\u636e\u5c06\u5408\u5e76\u5230\u5b8c\u5168\u5907\u4efd\u4e0a\u3002 \u57fa\u4e8e\u6240\u6709\u7684\u5907\u4efd\u5c06\u672a\u63d0\u4ea4\u7684\u4e8b\u7269\u8fdb\u7a0b\u56de\u6eda [root@localhost ~]# systemctl stop mysql [root@localhost ~]# cd /var/lib/mysql/ leco/ mysql/ performance_schema/ [root@localhost ~]# cd /var/lib/mysql/ [root@localhost mysql]# ls auto.cnf ib_logfile0 leco mysql-bin.000001 performance_schema xtrabackup_binlog_pos_innodb ibdata1 ib_logfile1 mysql mysql-bin.index select xtrabackup_info [root@localhost mysql]# rm -rf * \u6307\u5b9a\u5168\u91cf\u5907\u4efd [root@localhost mysql]# innobackupex --user=root --password=root --defaults-file=/etc/my.cnf --apply-log --redo-only /opt/2017-01-05_11-04-55/ \u6307\u5b9a\u589e\u91cf\u5907\u4efd [root@localhost mysql]# innobackupex --user=root --password=root --defaults-file=/etc/my.cnf --apply-log --redo-only /opt/2017-01-05_11-04-55/ --incremental-dir=/opt/2017-01-05_11-44-22/ \u6062\u590d [root@localhost mysql]# innobackupex --copy-back --defaults-file=/etc/my.cnf /opt/2017-01-05_11-04-55/ \u89e3\u91ca 1. 2017 - 01 - 05 _11 - 04 - 55 / \u662f\u4e00\u6b21\u5168\u91cf\u5907\u4efd 2. 2017 - 01 - 05 _11 - 44 - 22 \u662f\u4e00\u6b21\u57fa\u4e8e 2017 - 01 - 05 _11 - 04 - 55 \u7684\u589e\u91cf\u5907\u4efd 3. \u6062\u590d\u7684\u65f6\u5019\u8981\u6307\u5b9a\u90a3\u4e2a\u5168\u91cf\u7684\u76ee\u5f55\u8def\u5f84\u3002 [root@localhost mysql]# ls ibdata1 ib_logfile0 ib_logfile1 leco mysql performance_schema xtrabackup_info [root@localhost mysql]# chown -R mysql.mysql * #\u6b64\u65f6\u4e00\u5b9a\u8981\u5148\u6388\u6743\u5728\u542f\u52a8mysql [root@localhost mysql]# ll total 110604 -rw-r--r--. 1 mysql mysql 12582912 Jan 5 13:24 ibdata1 -rw-r--r--. 1 mysql mysql 50331648 Jan 5 13:24 ib_logfile0 -rw-r--r--. 1 mysql mysql 50331648 Jan 5 13:24 ib_logfile1 drwxr-xr-x. 2 mysql mysql 55 Jan 5 13:24 leco drwxr-xr-x. 2 mysql mysql 4096 Jan 5 13:24 mysql -rw-rw----. 1 mysql mysql 0 Jan 5 13:26 mysql-bin.index drwxr-xr-x. 2 mysql mysql 4096 Jan 5 13:24 performance_schema -rw-r--r--. 1 mysql mysql 652 Jan 5 13:24 xtrabackup_info [root@localhost mysql]# systemctl start mysql [root@localhost mysql]# ps aux|grep mysql mysql 33422 2.0 0.1 113248 1604 ? Ss 13:26 0:00 /bin/sh /usr/bin/mysqld_safe --basedir=/usr root 33423 0.0 0.1 113116 1456 ? Ss 13:26 0:00 /bin/bash /usr/bin/mysql-systemd-start post mysql 33599 21.0 11.1 475116 111352 ? Sl 13:26 0:00 /usr/sbin/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib64/mysql/plugin --log-error=/var/log/mysqld.log --pid-file=/var/run/mysqld/mysqld.pid --socket=/var/lib/mysqlmysql.sock root 33612 0.0 0.0 112648 952 pts/3 S+ 13:26 0:00 grep --color=auto mysql [root@localhost mysql]# mysql -uroot -proot Warning: Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 2 Server version: 5.6.35-log MySQL Community Server (GPL) Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | leco | | mysql | | performance_schema | +--------------------+ 4 rows in set (0.03 sec) mysql> use leco; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +----------------+ | Tables_in_leco | +----------------+ | student | +----------------+ 1 row in set (0.00 sec) mysql> select * from student; +----+---------+-----+------+ | id | name | age | dept | +----+---------+-----+------+ | 1 | good | 15 | NULL | | 2 | hehe | 18 | NULL | | 1 | good | 15 | NULL | | 2 | hehe | 18 | NULL | | 2 | beijing | 100 | NULL | | 2 | cmz | 30 | NULL | +----+---------+-----+------+ 6 rows in set (0.00 sec) \u5230\u589e\u91cf\u5907\u4efd\u5df2\u7ecfOK","title":"4.2.2 \u589e\u91cf\u6062\u590d"},{"location":"linux/server/xtrabackup/xtrabackup.index/#423","text":"","title":"4.2.3 \u591a\u6b21\u589e\u91cf\u5907\u4efd"},{"location":"linux/server/xtrabackup/xtrabackup.index/#424","text":"","title":"4.2.4 \u591a\u6b21\u589e\u91cf\u6062\u590d"},{"location":"linux/server/xtrabackup/xtrabackup.index/#43","text":"[root@localhost opt]# innobackupex --user=root -password=root --defaults-file=/etc/my.cnf --database=leco /tmp/ InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy and Percona LLC and/or its affiliates 2009-2013. All Rights Reserved. This software is published under the GNU GENERAL PUBLIC LICENSE Version 2, June 1991. Get the latest version of Percona XtraBackup, documentation, and help resources: http://www.percona.com/xb/p 170105 13:58:45 innobackupex: Executing a version check against the server... 170105 13:58:45 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 13:58:45 innobackupex: Connected to MySQL server 170105 13:58:45 innobackupex: Done. 170105 13:58:45 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 13:58:45 innobackupex: Connected to MySQL server 170105 13:58:45 innobackupex: Starting the backup operation IMPORTANT: Please check that the backup run completes successfully. At the end of a successful backup run innobackupex prints \"completed OK!\". innobackupex: Using server version 5.6.35-log innobackupex: Created backup directory /tmp/2017-01-05_13-58-45 170105 13:58:45 innobackupex: Starting ibbackup with command: xtrabackup --defaults-file=\"/etc/my.cnf\" --defaults-group=\"mysqld\" --backup --suspend-at-end --target-dir=/tmp/2017-01-05_13-58-45 --innodb_log_file_size=\"50331648\" --innodb_data_file_path=\"ibdata1:12M:autoextend\" --tmpdir=/tmp --extra-lsndir='/tmp' --databases='leco' innobackupex: Waiting for ibbackup (pid=35053) to suspend innobackupex: Suspend file '/tmp/2017-01-05_13-58-45/xtrabackup_suspended_2' xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3) xtrabackup: uses posix_fadvise(). xtrabackup: cd to /var/lib/mysql xtrabackup: open files limit requested 0, set to 1024 xtrabackup: using the following InnoDB configuration: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 2 xtrabackup: innodb_log_file_size = 50331648 >> log scanned up to (1667104) xtrabackup: Generating a list of tablespaces [01] Copying ./ibdata1 to /tmp/2017-01-05_13-58-45/ibdata1 [01] ...done [01] Copying ./leco/student.ibd to /tmp/2017-01-05_13-58-45/leco/student.ibd [01] ...done >> log scanned up to (1667104) xtrabackup: Creating suspend file '/tmp/2017-01-05_13-58-45/xtrabackup_suspended_2' with pid '35053' 170105 13:58:47 innobackupex: Continuing after ibbackup has suspended 170105 13:58:47 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG TABLES... 170105 13:58:47 innobackupex: Executing FLUSH TABLES WITH READ LOCK... 170105 13:58:47 innobackupex: All tables locked and flushed to disk 170105 13:58:47 innobackupex: Starting to backup non-InnoDB tables and files innobackupex: in subdirectories of '/var/lib/mysql/' innobackupex: Backing up file '/var/lib/mysql//leco/db.opt' >> log scanned up to (1667104) innobackupex: Backing up file '/var/lib/mysql//leco/student.frm' 170105 13:58:47 innobackupex: Finished backing up non-InnoDB tables and files 170105 13:58:47 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS... 170105 13:58:47 innobackupex: Waiting for log copying to finish xtrabackup: The latest check point (for incremental): '1667104' xtrabackup: Stopping log copying thread. .>> log scanned up to (1667104) xtrabackup: Creating suspend file '/tmp/2017-01-05_13-58-45/xtrabackup_log_copied' with pid '35053' xtrabackup: Transaction log of lsn (1667104) to (1667104) was copied. 170105 13:58:48 innobackupex: All tables unlocked innobackupex: Backup created in directory '/tmp/2017-01-05_13-58-45' innobackupex: MySQL binlog position: filename 'mysql-bin.000001', position 120 170105 13:58:48 innobackupex: Connection to database server closed 170105 13:58:48 innobackupex: completed OK! [root@localhost opt]# ll /tmp/2017-01-05_13-58-45 total 12308 -rw-r--r--. 1 root root 295 Jan 5 13:58 backup-my.cnf -rw-r-----. 1 root root 12582912 Jan 5 13:58 ibdata1 drwx------. 2 root root 55 Jan 5 13:58 leco -rw-r--r--. 1 root root 21 Jan 5 13:58 xtrabackup_binlog_info -rw-r-----. 1 root root 89 Jan 5 13:58 xtrabackup_checkpoints -rw-r--r--. 1 root root 600 Jan 5 13:58 xtrabackup_info -rw-r-----. 1 root root 2560 Jan 5 13:58 xtrabackup_logfile \u89e3\u91ca 1. \u8981\u52a0\u53c2\u6570 -- database 2. \u8981\u6307\u5b9a\u5e93\u540d\u5b57","title":"4.3 \u5355\u5e93\u5907\u4efd\u4e0e\u6062\u590d"},{"location":"linux/server/xtrabackup/xtrabackup.index/#44","text":"","title":"4.4 \u5907\u4efd\u6587\u4ef6\u5f52\u6863\u538b\u7f29"},{"location":"linux/server/xtrabackup/xtrabackup.index/#441","text":"[root@localhost opt]# mkdir /tmp/db [root@localhost opt]# innobackupex --user=root -password=root --defaults-file=/etc/my.cnf --stream=tar /tmp/db | gzip >/tmp/db/`date +%F`.tar.gz InnoDB Backup Utility v1.5.1-xtrabackup; Copyright 2003, 2009 Innobase Oy and Percona LLC and/or its affiliates 2009-2013. All Rights Reserved. This software is published under the GNU GENERAL PUBLIC LICENSE Version 2, June 1991. Get the latest version of Percona XtraBackup, documentation, and help resources: http://www.percona.com/xb/p 170105 14:05:59 innobackupex: Executing a version check against the server... 170105 14:05:59 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 14:05:59 innobackupex: Connected to MySQL server 170105 14:05:59 innobackupex: Done. 170105 14:05:59 innobackupex: Connecting to MySQL server with DSN 'dbi:mysql:;mysql_read_default_file=/etc/my.cnf;mysql_read_default_group=xtrabackup' as 'root' (using password: YES). 170105 14:05:59 innobackupex: Connected to MySQL server 170105 14:05:59 innobackupex: Starting the backup operation IMPORTANT: Please check that the backup run completes successfully. At the end of a successful backup run innobackupex prints \"completed OK!\". innobackupex: Using server version 5.6.35-log innobackupex: Created backup directory /tmp/db 170105 14:05:59 innobackupex: Starting ibbackup with command: xtrabackup --defaults-file=\"/etc/my.cnf\" --defaults-group=\"mysqld\" --backup --suspend-at-end --target-dir=/tmp --innodb_log_file_size=\"50331648\" --innodb_data_file_path=\"ibdata1:12M:autoextend\" --tmpdir=/tmp --extra-lsndir='/tmp' --stream=tar innobackupex: Waiting for ibbackup (pid=35685) to suspend innobackupex: Suspend file '/tmp/xtrabackup_suspended_2' xtrabackup version 2.2.13 based on MySQL server 5.6.24 Linux (x86_64) (revision id: 70f4be3) xtrabackup: uses posix_fadvise(). xtrabackup: cd to /var/lib/mysql xtrabackup: open files limit requested 0, set to 1024 xtrabackup: using the following InnoDB configuration: xtrabackup: innodb_data_home_dir = ./ xtrabackup: innodb_data_file_path = ibdata1:12M:autoextend xtrabackup: innodb_log_group_home_dir = ./ xtrabackup: innodb_log_files_in_group = 2 xtrabackup: innodb_log_file_size = 50331648 >> log scanned up to (1667104) xtrabackup: Generating a list of tablespaces [01] Streaming ./ibdata1 [01] ...done [01] Streaming ./mysql/innodb_table_stats.ibd [01] ...done [01] Streaming ./mysql/innodb_index_stats.ibd [01] ...done [01] Streaming ./mysql/slave_relay_log_info.ibd [01] ...done [01] Streaming ./mysql/slave_master_info.ibd [01] ...done [01] Streaming ./mysql/slave_worker_info.ibd [01] ...done [01] Streaming ./leco/student.ibd [01] ...done >> log scanned up to (1667104) xtrabackup: Creating suspend file '/tmp/xtrabackup_suspended_2' with pid '35685' 170105 14:06:01 innobackupex: Continuing after ibbackup has suspended 170105 14:06:01 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG TABLES... 170105 14:06:01 innobackupex: Executing FLUSH TABLES WITH READ LOCK... 170105 14:06:01 innobackupex: All tables locked and flushed to disk 170105 14:06:01 innobackupex: Starting to backup non-InnoDB tables and files innobackupex: in subdirectories of '/var/lib/mysql/' innobackupex: Backing up files '/var/lib/mysql//mysql/*.{frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par}' (74 files) >> log scanned up to (1667104) innobackupex: Backing up file '/var/lib/mysql//leco/db.opt' innobackupex: Backing up file '/var/lib/mysql//leco/student.frm' innobackupex: Backing up files '/var/lib/mysql//performance_schema/*.{frm,isl,MYD,MYI,MAD,MAI,MRG,TRG,TRN,ARM,ARZ,CSM,CSV,opt,par}' (53 files) 170105 14:06:02 innobackupex: Finished backing up non-InnoDB tables and files 170105 14:06:02 innobackupex: Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS... 170105 14:06:02 innobackupex: Waiting for log copying to finish xtrabackup: The latest check point (for incremental): '1667104' xtrabackup: Stopping log copying thread. .>> log scanned up to (1667104) xtrabackup: Creating suspend file '/tmp/xtrabackup_log_copied' with pid '35685' xtrabackup: Transaction log of lsn (1667104) to (1667104) was copied. 170105 14:06:03 innobackupex: All tables unlocked innobackupex: Backup created in directory '/tmp/db' innobackupex: MySQL binlog position: filename 'mysql-bin.000001', position 120 170105 14:06:03 innobackupex: Connection to database server closed innobackupex: You must use -i (--ignore-zeros) option for extraction of the tar stream. 170105 14:06:03 innobackupex: completed OK! [root@localhost opt]# ll /tmp/db/2017-01-05.tar.gz -rw-r--r--. 1 root root 285805 Jan 5 14:06 /tmp/db/2017-01-05.tar.gz","title":"4.4.1 \u538b\u7f29"},{"location":"linux/server/xtrabackup/xtrabackup.index/#442","text":"[root@localhost db]# tar -izxvf `date +%F`.tar.gz ./backup-my.cnf ibdata1 mysql/innodb_table_stats.ibd mysql/innodb_index_stats.ibd mysql/slave_relay_log_info.ibd mysql/slave_master_info.ibd mysql/slave_worker_info.ibd leco/student.ibd mysql/db.frm mysql/db.MYI mysql/db.MYD mysql/user.frm mysql/user.MYI mysql/user.MYD mysql/func.frm mysql/func.MYI mysql/func.MYD mysql/plugin.frm mysql/plugin.MYI mysql/plugin.MYD mysql/servers.frm mysql/servers.MYI mysql/servers.MYD mysql/tables_priv.frm mysql/tables_priv.MYI mysql/tables_priv.MYD mysql/columns_priv.frm mysql/columns_priv.MYI mysql/columns_priv.MYD mysql/help_topic.frm mysql/help_topic.MYI mysql/help_topic.MYD mysql/help_category.frm mysql/help_category.MYI mysql/help_category.MYD mysql/help_relation.frm mysql/help_relation.MYI mysql/help_relation.MYD mysql/help_keyword.frm mysql/help_keyword.MYI mysql/help_keyword.MYD mysql/time_zone_name.frm mysql/time_zone_name.MYI mysql/time_zone_name.MYD mysql/time_zone.frm mysql/time_zone.MYI mysql/time_zone.MYD mysql/time_zone_transition.frm mysql/time_zone_transition.MYI mysql/time_zone_transition.MYD mysql/time_zone_transition_type.frm mysql/time_zone_transition_type.MYI mysql/time_zone_transition_type.MYD mysql/time_zone_leap_second.frm mysql/time_zone_leap_second.MYI mysql/time_zone_leap_second.MYD mysql/proc.frm mysql/proc.MYI mysql/proc.MYD mysql/procs_priv.frm mysql/procs_priv.MYI mysql/procs_priv.MYD mysql/general_log.frm mysql/general_log.CSM mysql/general_log.CSV mysql/slow_log.frm mysql/slow_log.CSM mysql/slow_log.CSV mysql/event.frm mysql/event.MYI mysql/event.MYD mysql/ndb_binlog_index.frm mysql/ndb_binlog_index.MYI mysql/ndb_binlog_index.MYD mysql/innodb_table_stats.frm mysql/innodb_index_stats.frm mysql/slave_relay_log_info.frm mysql/slave_master_info.frm mysql/slave_worker_info.frm mysql/proxies_priv.frm mysql/proxies_priv.MYI mysql/proxies_priv.MYD leco/db.opt leco/student.frm performance_schema/db.opt performance_schema/cond_instances.frm performance_schema/events_waits_current.frm performance_schema/events_waits_history.frm performance_schema/events_waits_history_long.frm performance_schema/events_waits_summary_by_instance.frm performance_schema/events_waits_summary_by_host_by_event_name.frm performance_schema/events_waits_summary_by_user_by_event_name.frm performance_schema/events_waits_summary_by_account_by_event_name.frm performance_schema/events_waits_summary_by_thread_by_event_name.frm performance_schema/events_waits_summary_global_by_event_name.frm performance_schema/file_instances.frm performance_schema/file_summary_by_event_name.frm performance_schema/file_summary_by_instance.frm performance_schema/socket_instances.frm performance_schema/socket_summary_by_instance.frm performance_schema/socket_summary_by_event_name.frm performance_schema/host_cache.frm performance_schema/mutex_instances.frm performance_schema/objects_summary_global_by_type.frm performance_schema/performance_timers.frm performance_schema/rwlock_instances.frm performance_schema/setup_actors.frm performance_schema/setup_consumers.frm performance_schema/setup_instruments.frm performance_schema/setup_objects.frm performance_schema/setup_timers.frm performance_schema/table_io_waits_summary_by_index_usage.frm performance_schema/table_io_waits_summary_by_table.frm performance_schema/table_lock_waits_summary_by_table.frm performance_schema/threads.frm performance_schema/events_stages_current.frm performance_schema/events_stages_history.frm performance_schema/events_stages_history_long.frm performance_schema/events_stages_summary_by_thread_by_event_name.frm performance_schema/events_stages_summary_by_host_by_event_name.frm performance_schema/events_stages_summary_by_user_by_event_name.frm performance_schema/events_stages_summary_by_account_by_event_name.frm performance_schema/events_stages_summary_global_by_event_name.frm performance_schema/events_statements_current.frm performance_schema/events_statements_history.frm performance_schema/events_statements_history_long.frm performance_schema/events_statements_summary_by_thread_by_event_name.frm performance_schema/events_statements_summary_by_host_by_event_name.frm performance_schema/events_statements_summary_by_user_by_event_name.frm performance_schema/events_statements_summary_by_account_by_event_name.frm performance_schema/events_statements_summary_global_by_event_name.frm performance_schema/hosts.frm performance_schema/users.frm performance_schema/accounts.frm performance_schema/events_statements_summary_by_digest.frm performance_schema/session_connect_attrs.frm performance_schema/session_account_connect_attrs.frm ./xtrabackup_binlog_info xtrabackup_logfile xtrabackup_checkpoints ./xtrabackup_info [root@localhost db]# ls 2017-01-05.tar.gz ibdata1 mysql xtrabackup_binlog_info xtrabackup_info backup-my.cnf leco performance_schema xtrabackup_checkpoints xtrabackup_logfile \u6ce8\u610f \u6ce8\u610f\u89e3\u538b\u7684\u65b9\u5f0f\u4e0d\u540c\uff0c\u4e0d\u80fd\u76f4\u63a5\u50cf\u5e73\u65f6\u89e3\u538b\u6587\u4ef6\u90a3\u6837\u3002","title":"4.4.2 \u89e3\u538b"},{"location":"linux/shell/mysql/install/mysql.install/","text":"mysql \u5b89\u88c5 1. \u5b89\u88c5\u811a\u672c \u00b6 #!/bin/bash DIR=`pwd` NAME=\"mysql-5.6.42-linux-glibc2.12-x86_64.tar.gz\" FULL_NAME=${DIR}/${NAME} DATA_DIR=\"/data/mysql\" yum install vim gcc gcc-c++ wget autoconf net-tools lrzsz iotop lsof iotop bash-completion -y yum install curl policycoreutils openssh-server openssh-clients postfix -y if [ -f ${FULL_NAME} ];then echo \"\u5b89\u88c5\u6587\u4ef6\u5b58\u5728\" else echo \"\u5b89\u88c5\u6587\u4ef6\u4e0d\u5b58\u5728\" exit 3 fi if [ -h /usr/local/mysql ];then echo \"Mysql \u5df2\u7ecf\u5b89\u88c5\" exit 3 else tar xvf ${FULL_NAME} -C /usr/local/src ln -sv /usr/local/src/mysql-5.6.42-linux-glibc2.12-x86_64 /usr/local/mysql if id mysql;then echo \"mysql \u7528\u6237\u5df2\u7ecf\u5b58\u5728\uff0c\u8df3\u8fc7\u521b\u5efa\u7528\u6237\u8fc7\u7a0b\" else useradd mysql -s /sbin/nologin if id mysql;then chown -R mysql.mysql /usr/local/mysql/* -R if [ ! -d /data/mysql ];then mkdir -pv /data/mysql /var/lib/mysql && chown -R mysql.mysql /data -R /usr/local/mysql/scripts/mysql_install_db --user=mysql --datadir=/data/mysql --basedir=/usr/local/mysql/ cp /usr/local/src/mysql-5.6.42-linux-glibc2.12-x86_64/support-files/mysql.server /etc/init.d/mysqld chmod a+x /etc/init.d/mysqld cp ${DIR}/my.cnf /etc/my.cnf ln -sv /usr/local/mysql/bin/* /usr/bin/ ln -sv /data/mysql/mysql.sock /var/lib/mysql/mysql.sock /etc/init.d/mysqld start else echo \"MySQL\u6570\u636e\u76ee\u5f55\u5df2\u7ecf\u5b58\u5728,\" exit 3 fi fi fi 2. \u914d\u7f6e\u6587\u4ef6 \u00b6 [mysqld] socket=/data/mysql/mysql.sock user=mysql symbolic-links=0 datadir=/data/mysql innodb_file_per_table=1 max_connections=10000 #skip_name_resolve #server_id=2 #log-bin [client] port=3306 socket=/var/lib/mysql/mysql.sock [mysqld_safe] log-error=/var/log/mysqld.log pid-file=/tmp/mysql.pid","title":"1. \u5b89\u88c5"},{"location":"linux/shell/mysql/install/mysql.install/#1","text":"#!/bin/bash DIR=`pwd` NAME=\"mysql-5.6.42-linux-glibc2.12-x86_64.tar.gz\" FULL_NAME=${DIR}/${NAME} DATA_DIR=\"/data/mysql\" yum install vim gcc gcc-c++ wget autoconf net-tools lrzsz iotop lsof iotop bash-completion -y yum install curl policycoreutils openssh-server openssh-clients postfix -y if [ -f ${FULL_NAME} ];then echo \"\u5b89\u88c5\u6587\u4ef6\u5b58\u5728\" else echo \"\u5b89\u88c5\u6587\u4ef6\u4e0d\u5b58\u5728\" exit 3 fi if [ -h /usr/local/mysql ];then echo \"Mysql \u5df2\u7ecf\u5b89\u88c5\" exit 3 else tar xvf ${FULL_NAME} -C /usr/local/src ln -sv /usr/local/src/mysql-5.6.42-linux-glibc2.12-x86_64 /usr/local/mysql if id mysql;then echo \"mysql \u7528\u6237\u5df2\u7ecf\u5b58\u5728\uff0c\u8df3\u8fc7\u521b\u5efa\u7528\u6237\u8fc7\u7a0b\" else useradd mysql -s /sbin/nologin if id mysql;then chown -R mysql.mysql /usr/local/mysql/* -R if [ ! -d /data/mysql ];then mkdir -pv /data/mysql /var/lib/mysql && chown -R mysql.mysql /data -R /usr/local/mysql/scripts/mysql_install_db --user=mysql --datadir=/data/mysql --basedir=/usr/local/mysql/ cp /usr/local/src/mysql-5.6.42-linux-glibc2.12-x86_64/support-files/mysql.server /etc/init.d/mysqld chmod a+x /etc/init.d/mysqld cp ${DIR}/my.cnf /etc/my.cnf ln -sv /usr/local/mysql/bin/* /usr/bin/ ln -sv /data/mysql/mysql.sock /var/lib/mysql/mysql.sock /etc/init.d/mysqld start else echo \"MySQL\u6570\u636e\u76ee\u5f55\u5df2\u7ecf\u5b58\u5728,\" exit 3 fi fi fi","title":"1. \u5b89\u88c5\u811a\u672c"},{"location":"linux/shell/mysql/install/mysql.install/#2","text":"[mysqld] socket=/data/mysql/mysql.sock user=mysql symbolic-links=0 datadir=/data/mysql innodb_file_per_table=1 max_connections=10000 #skip_name_resolve #server_id=2 #log-bin [client] port=3306 socket=/var/lib/mysql/mysql.sock [mysqld_safe] log-error=/var/log/mysqld.log pid-file=/tmp/mysql.pid","title":"2. \u914d\u7f6e\u6587\u4ef6"},{"location":"linux/shell/system/linux.network/","text":"\u7f51\u5361\u4fe1\u606f 1. \u670d\u52a1\u7684\u4fe1\u606f \u00b6 \u91c7\u96c6\u670d\u52a1\u5668\u7684MAC,DNS\u548c\u5916\u7f51IP #/usr/bin/env bash # Name: get_network_info.sh # Author: caimengzhi # This is a script to gather network information of your Linux system. # Test under Ubuntu 10.04 only. #---------------------------- NIC=bridge01 MAC=$(LANG=C ifconfig $NIC | awk '/HWaddr/{ print $5 }') IP=$(LANG=C ifconfig $NIC | awk '/inet addr:/{ print $2 }' | awk -F: '{print $2 }') MASK=$(LANG=C ifconfig $NIC | awk -F: '/Mask/{print $4}') ext_ip=$(curl -s ifconfig.me) if [ -f /etc/resolv.conf ]; then dns=$(/usr/bin/awk '/^nameserver/{print $2}' /etc/resolv.conf) fi #---------------------------- echo \"Your network information is as below:\" echo $MAC echo $IP echo $dns echo $ext_ip","title":"2. \u7f51\u5361\u4fe1\u606f"},{"location":"linux/shell/system/linux.network/#1","text":"\u91c7\u96c6\u670d\u52a1\u5668\u7684MAC,DNS\u548c\u5916\u7f51IP #/usr/bin/env bash # Name: get_network_info.sh # Author: caimengzhi # This is a script to gather network information of your Linux system. # Test under Ubuntu 10.04 only. #---------------------------- NIC=bridge01 MAC=$(LANG=C ifconfig $NIC | awk '/HWaddr/{ print $5 }') IP=$(LANG=C ifconfig $NIC | awk '/inet addr:/{ print $2 }' | awk -F: '{print $2 }') MASK=$(LANG=C ifconfig $NIC | awk -F: '/Mask/{print $4}') ext_ip=$(curl -s ifconfig.me) if [ -f /etc/resolv.conf ]; then dns=$(/usr/bin/awk '/^nameserver/{print $2}' /etc/resolv.conf) fi #---------------------------- echo \"Your network information is as below:\" echo $MAC echo $IP echo $dns echo $ext_ip","title":"1. \u670d\u52a1\u7684\u4fe1\u606f"},{"location":"linux/shell/system/linux.system_check/","text":"\u670d\u52a1\u5668\u5de1\u68c0 \u811a\u672c 1. \u4ecb\u7ecd \u00b6 \u4e3b\u8981\u662f\u8f93\u51fa\u5f53\u524d\u7cfb\u7edf\u7684\u76f8\u5173\u53c2\u6570\u6307\u6807 2. \u4ee3\u7801 \u00b6 #!/bin/bash #\u4e3b\u673a\u4fe1\u606f\u6bcf\u65e5\u5de1\u68c0 #\u4f5c\u8005: \u8521\u731b\u829d #version 2016.08.09 #\u5f53\u524d\u811a\u672c\u9002\u7528\u4e8eUbuntu #\u73af\u5883\u53d8\u91cfPATH\u6ca1\u8bbe\u597d\uff0c\u5728cron\u91cc\u6267\u884c\u65f6\u6709\u5f88\u591a\u547d\u4ee4\u4f1a\u627e\u4e0d\u5230 export PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin source /etc/profile [ $(id -u) -gt 0 ] && echo \"\u8bf7\u7528root\u7528\u6237\u6267\u884c\u6b64\u811a\u672c\uff01\" && exit 1 #uploadHostDailyCheckApi=\"http://10.0.0.1:8080/api/uploadHostDailyCheck\" #uploadHostDailyCheckReportApi=\"http://10.0.0.1:8080/api/uploadHostDailyCheckReport\" ubuntuVersion=$(awk -F'=' '/DISTRIB_RELEASE/{print $(NF)}' /etc/lsb-release) VERSION=\"2018.05.01\" #\u65e5\u5fd7\u76f8\u5173 PROGPATH=`echo $0 | sed -e 's,[\\\\/][^\\\\/][^\\\\/]*$,,'` [ -f $PROGPATH ] && PROGPATH=\".\" LOGPATH=\"$PROGPATH/log\" [ -e $LOGPATH ] || mkdir $LOGPATH RESULTFILE=\"$LOGPATH/HostDailyCheck-`hostname`-`date +%Y%m%d`.txt\" #\u5b9a\u4e49\u62a5\u8868\u7684\u5168\u5c40\u53d8\u91cf report_DateTime=\"\" #\u65e5\u671f ok report_Hostname=\"\" #\u4e3b\u673a\u540d ok report_OSRelease=\"\" #\u53d1\u884c\u7248\u672c ok report_Kernel=\"\" #\u5185\u6838 ok report_Language=\"\" #\u8bed\u8a00/\u7f16\u7801 ok report_LastReboot=\"\" #\u6700\u8fd1\u542f\u52a8\u65f6\u95f4 ok report_Uptime=\"\" #\u8fd0\u884c\u65f6\u95f4\uff08\u5929\uff09 ok report_CPUs=\"\" #CPU\u6570\u91cf ok report_CPUType=\"\" #CPU\u7c7b\u578b ok report_Arch=\"\" #CPU\u67b6\u6784 ok report_MemTotal=\"\" #\u5185\u5b58\u603b\u5bb9\u91cf(MB) ok report_MemFree=\"\" #\u5185\u5b58\u5269\u4f59(MB) ok report_MemUsedPercent=\"\" #\u5185\u5b58\u4f7f\u7528\u7387% ok report_DiskTotal=\"\" #\u786c\u76d8\u603b\u5bb9\u91cf(GB) ok report_DiskFree=\"\" #\u786c\u76d8\u5269\u4f59(GB) ok report_DiskUsedPercent=\"\" #\u786c\u76d8\u4f7f\u7528\u7387% ok report_InodeTotal=\"\" #Inode\u603b\u91cf ok report_InodeFree=\"\" #Inode\u5269\u4f59 ok report_InodeUsedPercent=\"\" #Inode\u4f7f\u7528\u7387 ok report_IP=\"\" #IP\u5730\u5740 ok report_MAC=\"\" #MAC\u5730\u5740 ok report_Gateway=\"\" #\u9ed8\u8ba4\u7f51\u5173 ok report_DNS=\"\" #DNS ok report_Listen=\"\" #\u76d1\u542c ok report_Selinux=\"\" #Selinux ok report_Firewall=\"\" #\u9632\u706b\u5899 ok report_USERs=\"\" #\u7528\u6237 ok report_USEREmptyPassword=\"\" #\u7a7a\u5bc6\u7801\u7528\u6237 ok report_USERTheSameUID=\"\" #\u76f8\u540cID\u7684\u7528\u6237 ok report_PasswordExpiry=\"\" #\u5bc6\u7801\u8fc7\u671f\uff08\u5929\uff09 ok report_RootUser=\"\" #root\u7528\u6237 ok report_Sudoers=\"\" #sudo\u6388\u6743 ok report_SSHAuthorized=\"\" #SSH\u4fe1\u4efb\u4e3b\u673a ok report_SSHDProtocolVersion=\"\" #SSH\u534f\u8bae\u7248\u672c ok report_SSHDPermitRootLogin=\"\" #\u5141\u8bb8root\u8fdc\u7a0b\u767b\u5f55 ok report_DefunctProsess=\"\" #\u50f5\u5c38\u8fdb\u7a0b\u6570\u91cf ok report_SelfInitiatedService=\"\" #\u81ea\u542f\u52a8\u670d\u52a1\u6570\u91cf ok report_SelfInitiatedProgram=\"\" #\u81ea\u542f\u52a8\u7a0b\u5e8f\u6570\u91cf ok report_RuningService=\"\" #\u8fd0\u884c\u4e2d\u670d\u52a1\u6570 ok report_Crontab=\"\" #\u8ba1\u5212\u4efb\u52a1\u6570 ok report_Syslog=\"\" #\u65e5\u5fd7\u670d\u52a1 ok report_SNMP=\"\" #SNMP OK report_NTP=\"\" #NTP ok report_JDK=\"\" #JDK\u7248\u672c ok function version(){ echo \"\" echo \"\" echo \"\u7cfb\u7edf\u5de1\u68c0\u811a\u672c\uff1aVersion $VERSION\" } function getCpuStatus(){ echo \"\" echo \"\" echo \"############################ CPU\u68c0\u67e5 #############################\" Physical_CPUs=$(grep \"physical id\" /proc/cpuinfo| sort | uniq | wc -l) Virt_CPUs=$(grep \"processor\" /proc/cpuinfo | wc -l) CPU_Kernels=$(grep \"cores\" /proc/cpuinfo|uniq| awk -F ': ' '{print $2}') CPU_Type=$(grep \"model name\" /proc/cpuinfo | awk -F ': ' '{print $2}' | sort | uniq) CPU_Arch=$(uname -m) echo \"\u7269\u7406CPU\u4e2a\u6570:$Physical_CPUs\" echo \"\u903b\u8f91CPU\u4e2a\u6570:$Virt_CPUs\" echo \"\u6bcfCPU\u6838\u5fc3\u6570:$CPU_Kernels\" echo \" CPU\u578b\u53f7:$CPU_Type\" echo \" CPU\u67b6\u6784:$CPU_Arch\" #\u62a5\u8868\u4fe1\u606f report_CPUs=$Virt_CPUs #CPU\u6570\u91cf report_CPUType=$CPU_Type #CPU\u7c7b\u578b report_Arch=$CPU_Arch #CPU\u67b6\u6784 } function getMemStatus(){ echo \"\" echo \"\" echo \"############################ \u5185\u5b58\u68c0\u67e5 ############################\" free -h #\u62a5\u8868\u4fe1\u606f MemTotal=$(grep MemTotal /proc/meminfo| awk '{print $2}') #KB MemFree=$(grep MemFree /proc/meminfo| awk '{print $2}') #KB let MemUsed=MemTotal-MemFree MemPercent=$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\") report_MemTotal=\"$((MemTotal/1024))\"\"MB\" #\u5185\u5b58\u603b\u5bb9\u91cf(MB) report_MemFree=\"$((MemFree/1024))\"\"MB\" #\u5185\u5b58\u5269\u4f59(MB) report_MemUsedPercent=\"$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\")\"\"%\" #\u5185\u5b58\u4f7f\u7528\u7387% } function getDiskStatus(){ echo \"\" echo \"\" echo \"############################ \u78c1\u76d8\u68c0\u67e5 ############################\" df -hiP | sed 's/Mounted on/Mounted/'> /tmp/inode df -hTP | sed 's/Mounted on/Mounted/'> /tmp/disk join /tmp/disk /tmp/inode | awk '{print $1,$2,\"|\",$3,$4,$5,$6,\"|\",$8,$9,$10,$11,\"|\",$12}'| column -t #\u62a5\u8868\u4fe1\u606f diskdata=$(df -TP | sed '1d' | awk '$2!=\"tmpfs\"{print}') #KB disktotal=$(echo \"$diskdata\" | awk '{total+=$3}END{print total}') #KB diskused=$(echo \"$diskdata\" | awk '{total+=$4}END{print total}') #KB diskfree=$((disktotal-diskused)) #KB diskusedpercent=$(echo $disktotal $diskused | awk '{if($1==0){printf 100}else{printf \"%.2f\",$2*100/$1}}') inodedata=$(df -iTP | sed '1d' | awk '$2!=\"tmpfs\"{print}') inodetotal=$(echo \"$inodedata\" | awk '{total+=$3}END{print total}') inodeused=$(echo \"$inodedata\" | awk '{total+=$4}END{print total}') inodefree=$((inodetotal-inodeused)) inodeusedpercent=$(echo $inodetotal $inodeused | awk '{if($1==0){printf 100}else{printf \"%.2f\",$2*100/$1}}') report_DiskTotal=$((disktotal/1024/1024))\"GB\" #\u786c\u76d8\u603b\u5bb9\u91cf(GB) report_DiskFree=$((diskfree/1024/1024))\"GB\" #\u786c\u76d8\u5269\u4f59(GB) report_DiskUsedPercent=\"$diskusedpercent\"\"%\" #\u786c\u76d8\u4f7f\u7528\u7387% report_InodeTotal=$((inodetotal/1000))\"K\" #Inode\u603b\u91cf report_InodeFree=$((inodefree/1000))\"K\" #Inode\u5269\u4f59 report_InodeUsedPercent=\"$inodeusedpercent\"\"%\" #Inode\u4f7f\u7528\u7387% } function getSystemStatus(){ echo \"\" echo \"\" echo \"############################ \u7cfb\u7edf\u68c0\u67e5 ############################\" if [ -e /etc/sysconfig/i18n ];then default_LANG=\"$(grep \"LANG=\" /etc/sysconfig/i18n | grep -v \"^#\" | awk -F '\"' '{print $2}')\" else default_LANG=$LANG fi export LANG=\"en_US.UTF-8\" Release=$(cat /etc/redhat-release 2>/dev/null) Kernel=$(uname -r) OS=$(uname -o) Hostname=$(uname -n) #SELinux=$(/usr/sbin/sestatus | grep \"SELinux status: \" | awk '{print $3}') LastReboot=$(who -b | awk '{print $3,$4}') uptime=$(uptime | sed 's/.*up \\([^,]*\\), .*/\\1/') echo \" \u7cfb\u7edf\uff1a$OS\" echo \" \u53d1\u884c\u7248\u672c\uff1a$Release\" echo \" \u5185\u6838\uff1a$Kernel\" echo \" \u4e3b\u673a\u540d\uff1a$Hostname\" #echo \" SELinux\uff1a$SELinux\" echo \"\u8bed\u8a00/\u7f16\u7801\uff1a$default_LANG\" echo \" \u5f53\u524d\u65f6\u95f4\uff1a$(date +'%F %T')\" echo \" \u6700\u540e\u542f\u52a8\uff1a$LastReboot\" echo \" \u8fd0\u884c\u65f6\u95f4\uff1a$uptime\" #\u62a5\u8868\u4fe1\u606f report_DateTime=$(date +\"%F %T\") #\u65e5\u671f report_Hostname=\"$Hostname\" #\u4e3b\u673a\u540d report_OSRelease=\"$Release\" #\u53d1\u884c\u7248\u672c report_Kernel=\"$Kernel\" #\u5185\u6838 report_Language=\"$default_LANG\" #\u8bed\u8a00/\u7f16\u7801 report_LastReboot=\"$LastReboot\" #\u6700\u8fd1\u542f\u52a8\u65f6\u95f4 report_Uptime=\"$uptime\" #\u8fd0\u884c\u65f6\u95f4\uff08\u5929\uff09 report_Selinux=\"$SELinux\" export LANG=\"$default_LANG\" } function getServiceStatus(){ echo \"\" echo \"\" echo \"############################ \u670d\u52a1\u68c0\u67e5 ############################\" echo \"\" if [[ $centosVersion > 7 ]];then conf=$(systemctl list-unit-files --type=service --state=enabled --no-pager | grep \"enabled\") process=$(systemctl list-units --type=service --state=running --no-pager | grep \".service\") #\u62a5\u8868\u4fe1\u606f report_SelfInitiatedService=\"$(echo \"$conf\" | wc -l)\" #\u81ea\u542f\u52a8\u670d\u52a1\u6570\u91cf report_RuningService=\"$(echo \"$process\" | wc -l)\" #\u8fd0\u884c\u4e2d\u670d\u52a1\u6570\u91cf else conf=$(/sbin/chkconfig | grep -E \":on|:\u542f\u7528\") process=$(/sbin/service --status-all 2>/dev/null | grep -E \"is running|\u6b63\u5728\u8fd0\u884c\") #\u62a5\u8868\u4fe1\u606f report_SelfInitiatedService=\"$(echo \"$conf\" | wc -l)\" #\u81ea\u542f\u52a8\u670d\u52a1\u6570\u91cf report_RuningService=\"$(echo \"$process\" | wc -l)\" #\u8fd0\u884c\u4e2d\u670d\u52a1\u6570\u91cf fi echo \"\u670d\u52a1\u914d\u7f6e\" echo \"--------\" echo \"$conf\" | column -t echo \"\" echo \"\u6b63\u5728\u8fd0\u884c\u7684\u670d\u52a1\" echo \"--------------\" echo \"$process\" } function getAutoStartStatus(){ echo \"\" echo \"\" echo \"############################ \u81ea\u542f\u52a8\u68c0\u67e5 ##########################\" conf=$(grep -v \"^#\" /etc/rc.d/rc.local| sed '/^$/d') echo \"$conf\" #\u62a5\u8868\u4fe1\u606f report_SelfInitiatedProgram=\"$(echo $conf | wc -l)\" #\u81ea\u542f\u52a8\u7a0b\u5e8f\u6570\u91cf } function getLoginStatus(){ echo \"\" echo \"\" echo \"############################ \u767b\u5f55\u68c0\u67e5 ############################\" last | head } function getNetworkStatus(){ echo \"\" echo \"\" echo \"############################ \u7f51\u7edc\u68c0\u67e5 ############################\" /sbin/ifconfig -a | grep -v packets | grep -v collisions | grep -v inet6 for i in $(ip link | grep BROADCAST | awk -F: '{print $2}');do ip add show $i | grep -E \"BROADCAST|global\"| awk '{print $2}' | tr '\\n' ' ' ;echo \"\" ;done GATEWAY=$(ip route | grep default | awk '{print $3}') DNS=$(grep nameserver /etc/resolv.conf| grep -v \"#\" | awk '{print $2}' | tr '\\n' ',' | sed 's/,$//') echo \"\" echo \"\u7f51\u5173\uff1a$GATEWAY \" echo \" DNS\uff1a$DNS\" #\u62a5\u8868\u4fe1\u606f IP=$(ip -f inet addr | grep -v 127.0.0.1 | grep inet | awk '{print $NF,$2}' | tr '\\n' ',' | sed 's/,$//') MAC=$(ip link | grep -v \"LOOPBACK\\|loopback\" | awk '{print $2}' | sed 'N;s/\\n//' | tr '\\n' ',' | sed 's/,$//') report_IP=\"$IP\" #IP\u5730\u5740 report_MAC=$MAC #MAC\u5730\u5740 report_Gateway=\"$GATEWAY\" #\u9ed8\u8ba4\u7f51\u5173 report_DNS=\"$DNS\" #DNS } function getListenStatus(){ echo \"\" echo \"\" echo \"############################ \u76d1\u542c\u68c0\u67e5 ############################\" TCPListen=$(ss -ntul | column -t) echo \"$TCPListen\" #\u62a5\u8868\u4fe1\u606f report_Listen=\"$(echo \"$TCPListen\"| sed '1d' | awk '/tcp/ {print $5}' | awk -F: '{print $NF}' | sort | uniq | wc -l)\" } function getCronStatus(){ echo \"\" echo \"\" echo \"############################ \u8ba1\u5212\u4efb\u52a1\u68c0\u67e5 ########################\" Crontab=0 for shell in $(grep -v \"/sbin/nologin\" /etc/shells);do for user in $(grep \"$shell\" /etc/passwd| awk -F: '{print $1}');do crontab -l -u $user >/dev/null 2>&1 status=$? if [ $status -eq 0 ];then echo \"$user\" echo \"--------\" crontab -l -u $user let Crontab=Crontab+$(crontab -l -u $user | wc -l) echo \"\" fi done done #\u8ba1\u5212\u4efb\u52a1 find /etc/cron* -type f | xargs -i ls -l {} | column -t let Crontab=Crontab+$(find /etc/cron* -type f | wc -l) #\u62a5\u8868\u4fe1\u606f report_Crontab=\"$Crontab\" #\u8ba1\u5212\u4efb\u52a1\u6570 } function getHowLongAgo(){ # \u8ba1\u7b97\u4e00\u4e2a\u65f6\u95f4\u6233\u79bb\u73b0\u5728\u6709\u591a\u4e45\u4e86 datetime=\"$*\" [ -z \"$datetime\" ] && echo \"\u9519\u8bef\u7684\u53c2\u6570\uff1agetHowLongAgo() $*\" Timestamp=$(date +%s -d \"$datetime\") #\u8f6c\u5316\u4e3a\u65f6\u95f4\u6233 Now_Timestamp=$(date +%s) Difference_Timestamp=$(($Now_Timestamp-$Timestamp)) days=0;hours=0;minutes=0; sec_in_day=$((60*60*24)); sec_in_hour=$((60*60)); sec_in_minute=60 while (( $(($Difference_Timestamp-$sec_in_day)) > 1 )) do let Difference_Timestamp=Difference_Timestamp-sec_in_day let days++ done while (( $(($Difference_Timestamp-$sec_in_hour)) > 1 )) do let Difference_Timestamp=Difference_Timestamp-sec_in_hour let hours++ done echo \"$days \u5929 $hours \u5c0f\u65f6\u524d\" } function getUserLastLogin(){ # \u83b7\u53d6\u7528\u6237\u6700\u8fd1\u4e00\u6b21\u767b\u5f55\u7684\u65f6\u95f4\uff0c\u542b\u5e74\u4efd # \u5f88\u9057\u61belast\u547d\u4ee4\u4e0d\u652f\u6301\u663e\u793a\u5e74\u4efd\uff0c\u53ea\u6709\"last -t YYYYMMDDHHMMSS\"\u8868\u793a\u67d0\u4e2a\u65f6\u95f4\u4e4b\u95f4\u7684\u767b\u5f55\uff0c\u6211 # \u4eec\u53ea\u80fd\u7528\u6700\u7b28\u7684\u65b9\u6cd5\u4e86\uff0c\u5bf9\u6bd4\u4eca\u5929\u4e4b\u524d\u548c\u4eca\u5e74\u5143\u65e6\u4e4b\u524d\uff08\u6216\u8005\u53bb\u5e74\u4e4b\u524d\u548c\u524d\u5e74\u4e4b\u524d\u2026\u2026\uff09\u67d0\u4e2a\u7528\u6237 # \u767b\u5f55\u6b21\u6570\uff0c\u5982\u679c\u767b\u5f55\u7edf\u8ba1\u6b21\u6570\u6709\u53d8\u5316\uff0c\u5219\u8bf4\u660e\u6700\u8fd1\u4e00\u6b21\u767b\u5f55\u662f\u4eca\u5e74\u3002 username=$1 : ${username:=\"`whoami`\"} thisYear=$(date +%Y) oldesYear=$(last | tail -n1 | awk '{print $NF}') while(( $thisYear >= $oldesYear));do loginBeforeToday=$(last $username | grep $username | wc -l) loginBeforeNewYearsDayOfThisYear=$(last $username -t $thisYear\"0101000000\" | grep $username | wc -l) if [ $loginBeforeToday -eq 0 ];then echo \"\u4ece\u672a\u767b\u5f55\u8fc7\" break elif [ $loginBeforeToday -gt $loginBeforeNewYearsDayOfThisYear ];then lastDateTime=$(last -i $username | head -n1 | awk '{for(i=4;i<(NF-2);i++)printf\"%s \",$i}')\" $thisYear\" #\u683c\u5f0f\u5982: Sat Nov 2 20:33 2015 lastDateTime=$(date \"+%Y-%m-%d %H:%M:%S\" -d \"$lastDateTime\") echo \"$lastDateTime\" break else thisYear=$((thisYear-1)) fi done } function getUserStatus(){ echo \"\" echo \"\" echo \"############################ \u7528\u6237\u68c0\u67e5 ############################\" #/etc/passwd \u6700\u540e\u4fee\u6539\u65f6\u95f4 pwdfile=\"$(cat /etc/passwd)\" Modify=$(stat /etc/passwd | grep Modify | tr '.' ' ' | awk '{print $2,$3}') echo \"/etc/passwd \u6700\u540e\u4fee\u6539\u65f6\u95f4\uff1a$Modify ($(getHowLongAgo $Modify))\" echo \"\" echo \"\u7279\u6743\u7528\u6237\" echo \"--------\" RootUser=\"\" for user in $(echo \"$pwdfile\" | awk -F: '{print $1}');do if [ $(id -u $user) -eq 0 ];then echo \"$user\" RootUser=\"$RootUser,$user\" fi done echo \"\" echo \"\u7528\u6237\u5217\u8868\" echo \"--------\" USERs=0 echo \"$( echo \"\u7528\u6237\u540d UID GID HOME SHELL \u6700\u540e\u4e00\u6b21\u767b\u5f55\" for shell in $(grep -v \"/sbin/nologin\" /etc/shells);do for username in $(grep \"$shell\" /etc/passwd| awk -F: '{print $1}');do userLastLogin=\"$(getUserLastLogin $username)\" echo \"$pwdfile\" | grep -w \"$username\" |grep -w \"$shell\"| awk -F: -v lastlogin=\"$(echo \"$userLastLogin\" | tr ' ' '_')\" '{print $1,$3,$4,$6,$7,lastlogin}' done let USERs=USERs+$(echo \"$pwdfile\" | grep \"$shell\"| wc -l) done )\" | column -t echo \"\" echo \"\u7a7a\u5bc6\u7801\u7528\u6237\" echo \"----------\" USEREmptyPassword=\"\" for shell in $(grep -v \"/sbin/nologin\" /etc/shells);do for user in $(echo \"$pwdfile\" | grep \"$shell\" | cut -d: -f1);do r=$(awk -F: '$2==\"!!\"{print $1}' /etc/shadow | grep -w $user) if [ ! -z $r ];then echo $r USEREmptyPassword=\"$USEREmptyPassword,\"$r fi done done echo \"\" echo \"\u76f8\u540cID\u7684\u7528\u6237\" echo \"------------\" USERTheSameUID=\"\" UIDs=$(cut -d: -f3 /etc/passwd | sort | uniq -c | awk '$1>1{print $2}') for uid in $UIDs;do echo -n \"$uid\"; USERTheSameUID=\"$uid\" r=$(awk -F: 'ORS=\"\";$3=='\"$uid\"'{print \":\",$1}' /etc/passwd) echo \"$r\" echo \"\" USERTheSameUID=\"$USERTheSameUID $r,\" done #\u62a5\u8868\u4fe1\u606f report_USERs=\"$USERs\" #\u7528\u6237 report_USEREmptyPassword=$(echo $USEREmptyPassword | sed 's/^,//') report_USERTheSameUID=$(echo $USERTheSameUID | sed 's/,$//') report_RootUser=$(echo $RootUser | sed 's/^,//') #\u7279\u6743\u7528\u6237 } function getPasswordStatus { echo \"\" echo \"\" echo \"############################ \u5bc6\u7801\u68c0\u67e5 ############################\" pwdfile=\"$(cat /etc/passwd)\" echo \"\" echo \"\u5bc6\u7801\u8fc7\u671f\u68c0\u67e5\" echo \"------------\" result=\"\" for shell in $(grep -v \"/sbin/nologin\" /etc/shells);do for user in $(echo \"$pwdfile\" | grep \"$shell\" | cut -d: -f1);do get_expiry_date=$(/usr/bin/chage -l $user | grep 'Password expires' | cut -d: -f2) if [[ $get_expiry_date = ' never' || $get_expiry_date = 'never' ]];then printf \"%-15s \u6c38\u4e0d\u8fc7\u671f\\n\" $user result=\"$result,$user:never\" else password_expiry_date=$(date -d \"$get_expiry_date\" \"+%s\") current_date=$(date \"+%s\") diff=$(($password_expiry_date-$current_date)) let DAYS=$(($diff/(60*60*24))) printf \"%-15s %s\u5929\u540e\u8fc7\u671f\\n\" $user $DAYS result=\"$result,$user:$DAYS days\" fi done done report_PasswordExpiry=$(echo $result | sed 's/^,//') echo \"\" echo \"\u5bc6\u7801\u7b56\u7565\u68c0\u67e5\" echo \"------------\" grep -v \"#\" /etc/login.defs | grep -E \"PASS_MAX_DAYS|PASS_MIN_DAYS|PASS_MIN_LEN|PASS_WARN_AGE\" } function getSudoersStatus(){ echo \"\" echo \"\" echo \"############################ Sudoers\u68c0\u67e5 #########################\" conf=$(grep -v \"^#\" /etc/sudoers| grep -v \"^Defaults\" | sed '/^$/d') echo \"$conf\" echo \"\" #\u62a5\u8868\u4fe1\u606f report_Sudoers=\"$(echo $conf | wc -l)\" } function getInstalledStatus(){ echo \"\" echo \"\" echo \"############################ \u8f6f\u4ef6\u68c0\u67e5 ############################\" rpm -qa --last | head | column -t } function getProcessStatus(){ echo \"\" echo \"\" echo \"############################ \u8fdb\u7a0b\u68c0\u67e5 ############################\" if [ $(ps -ef | grep defunct | grep -v grep | wc -l) -ge 1 ];then echo \"\" echo \"\u50f5\u5c38\u8fdb\u7a0b\"; echo \"--------\" ps -ef | head -n1 ps -ef | grep defunct | grep -v grep fi echo \"\" echo \"\u5185\u5b58\u5360\u7528TOP10\" echo \"-------------\" echo -e \"PID %MEM RSS COMMAND $(ps aux | awk '{print $2, $4, $6, $11}' | sort -k3rn | head -n 10 )\"| column -t echo \"\" echo \"CPU\u5360\u7528TOP10\" echo \"------------\" top b -n1 | head -17 | tail -11 #\u62a5\u8868\u4fe1\u606f report_DefunctProsess=\"$(ps -ef | grep defunct | grep -v grep|wc -l)\" } function getJDKStatus(){ echo \"\" echo \"\" echo \"############################ JDK\u68c0\u67e5 #############################\" java -version 2>/dev/null if [ $? -eq 0 ];then java -version 2>&1 fi echo \"JAVA_HOME=\\\"$JAVA_HOME\\\"\" #\u62a5\u8868\u4fe1\u606f report_JDK=\"$(java -version 2>&1 | grep version | awk '{print $1,$3}' | tr -d '\"')\" } function getSyslogStatus(){ echo \"\" echo \"\" echo \"############################ syslog\u68c0\u67e5 ##########################\" echo \"\u670d\u52a1\u72b6\u6001\uff1a$(getState rsyslog)\" echo \"\" echo \"/etc/rsyslog.conf\" echo \"-----------------\" cat /etc/rsyslog.conf 2>/dev/null | grep -v \"^#\" | grep -v \"^\\\\$\" | sed '/^$/d' | column -t #\u62a5\u8868\u4fe1\u606f report_Syslog=\"$(getState rsyslog)\" } function getFirewallStatus(){ echo \"\" echo \"\" echo \"############################ \u9632\u706b\u5899\u68c0\u67e5 ##########################\" #\u9632\u706b\u5899\u72b6\u6001\uff0c\u7b56\u7565\u7b49 if [[ $centosVersion < 7 ]];then /etc/init.d/iptables status >/dev/null 2>&1 status=$? if [ $status -eq 0 ];then s=\"active\" elif [ $status -eq 3 ];then s=\"inactive\" elif [ $status -eq 4 ];then s=\"permission denied\" else s=\"unknown\" fi else s=\"$(getState iptables)\" fi echo \"iptables: $s\" echo \"\" echo \"/etc/sysconfig/iptables\" echo \"-----------------------\" cat /etc/sysconfig/iptables 2>/dev/null #\u62a5\u8868\u4fe1\u606f report_Firewall=\"$s\" } function getSNMPStatus(){ #SNMP\u670d\u52a1\u72b6\u6001\uff0c\u914d\u7f6e\u7b49 echo \"\" echo \"\" echo \"############################ SNMP\u68c0\u67e5 ############################\" status=\"$(getState snmpd)\" echo \"\u670d\u52a1\u72b6\u6001\uff1a$status\" echo \"\" if [ -e /etc/snmp/snmpd.conf ];then echo \"/etc/snmp/snmpd.conf\" echo \"--------------------\" cat /etc/snmp/snmpd.conf 2>/dev/null | grep -v \"^#\" | sed '/^$/d' fi #\u62a5\u8868\u4fe1\u606f report_SNMP=\"$(getState snmpd)\" } function getState(){ if [[ $centosVersion < 7 ]];then if [ -e \"/etc/init.d/$1\" ];then if [ `/etc/init.d/$1 status 2>/dev/null | grep -E \"is running|\u6b63\u5728\u8fd0\u884c\" | wc -l` -ge 1 ];then r=\"active\" else r=\"inactive\" fi else r=\"unknown\" fi else #CentOS 7+ r=\"$(systemctl is-active $1 2>&1)\" fi echo \"$r\" } function getSSHStatus(){ #SSHD\u670d\u52a1\u72b6\u6001\uff0c\u914d\u7f6e,\u53d7\u4fe1\u4efb\u4e3b\u673a\u7b49 echo \"\" echo \"\" echo \"############################ SSH\u68c0\u67e5 #############################\" #\u68c0\u67e5\u53d7\u4fe1\u4efb\u4e3b\u673a pwdfile=\"$(cat /etc/passwd)\" echo \"\u670d\u52a1\u72b6\u6001\uff1a$(getState sshd)\" Protocol_Version=$(cat /etc/ssh/sshd_config | grep Protocol | awk '{print $2}') echo \"SSH\u534f\u8bae\u7248\u672c\uff1a$Protocol_Version\" echo \"\" echo \"\u4fe1\u4efb\u4e3b\u673a\" echo \"--------\" authorized=0 for user in $(echo \"$pwdfile\" | grep /bin/bash | awk -F: '{print $1}');do authorize_file=$(echo \"$pwdfile\" | grep -w $user | awk -F: '{printf $6\"/.ssh/authorized_keys\"}') authorized_host=$(cat $authorize_file 2>/dev/null | awk '{print $3}' | tr '\\n' ',' | sed 's/,$//') if [ ! -z $authorized_host ];then echo \"$user \u6388\u6743 \\\"$authorized_host\\\" \u65e0\u5bc6\u7801\u8bbf\u95ee\" fi let authorized=authorized+$(cat $authorize_file 2>/dev/null | awk '{print $3}'|wc -l) done echo \"\" echo \"\u662f\u5426\u5141\u8bb8ROOT\u8fdc\u7a0b\u767b\u5f55\" echo \"--------------------\" config=$(cat /etc/ssh/sshd_config | grep PermitRootLogin) firstChar=${config:0:1} if [ $firstChar == \"#\" ];then PermitRootLogin=\"yes\" #\u9ed8\u8ba4\u662f\u5141\u8bb8ROOT\u8fdc\u7a0b\u767b\u5f55\u7684 else PermitRootLogin=$(echo $config | awk '{print $2}') fi echo \"PermitRootLogin $PermitRootLogin\" echo \"\" echo \"/etc/ssh/sshd_config\" echo \"--------------------\" cat /etc/ssh/sshd_config | grep -v \"^#\" | sed '/^$/d' #\u62a5\u8868\u4fe1\u606f report_SSHAuthorized=\"$authorized\" #SSH\u4fe1\u4efb\u4e3b\u673a report_SSHDProtocolVersion=\"$Protocol_Version\" #SSH\u534f\u8bae\u7248\u672c report_SSHDPermitRootLogin=\"$PermitRootLogin\" #\u5141\u8bb8root\u8fdc\u7a0b\u767b\u5f55 } function getNTPStatus(){ #NTP\u670d\u52a1\u72b6\u6001\uff0c\u5f53\u524d\u65f6\u95f4\uff0c\u914d\u7f6e\u7b49 echo \"\" echo \"\" echo \"############################ NTP\u68c0\u67e5 #############################\" if [ -e /etc/ntp.conf ];then echo \"\u670d\u52a1\u72b6\u6001\uff1a$(getState ntpd)\" echo \"\" echo \"/etc/ntp.conf\" echo \"-------------\" cat /etc/ntp.conf 2>/dev/null | grep -v \"^#\" | sed '/^$/d' fi #\u62a5\u8868\u4fe1\u606f report_NTP=\"$(getState ntpd)\" } function uploadHostDailyCheckReport(){ json=\"{ \\\"DateTime\\\":\\\"$report_DateTime\\\", \\\"Hostname\\\":\\\"$report_Hostname\\\", \\\"OSRelease\\\":\\\"$report_OSRelease\\\", \\\"Kernel\\\":\\\"$report_Kernel\\\", \\\"Language\\\":\\\"$report_Language\\\", \\\"LastReboot\\\":\\\"$report_LastReboot\\\", \\\"Uptime\\\":\\\"$report_Uptime\\\", \\\"CPUs\\\":\\\"$report_CPUs\\\", \\\"CPUType\\\":\\\"$report_CPUType\\\", \\\"Arch\\\":\\\"$report_Arch\\\", \\\"MemTotal\\\":\\\"$report_MemTotal\\\", \\\"MemFree\\\":\\\"$report_MemFree\\\", \\\"MemUsedPercent\\\":\\\"$report_MemUsedPercent\\\", \\\"DiskTotal\\\":\\\"$report_DiskTotal\\\", \\\"DiskFree\\\":\\\"$report_DiskFree\\\", \\\"DiskUsedPercent\\\":\\\"$report_DiskUsedPercent\\\", \\\"InodeTotal\\\":\\\"$report_InodeTotal\\\", \\\"InodeFree\\\":\\\"$report_InodeFree\\\", \\\"InodeUsedPercent\\\":\\\"$report_InodeUsedPercent\\\", \\\"IP\\\":\\\"$report_IP\\\", \\\"MAC\\\":\\\"$report_MAC\\\", \\\"Gateway\\\":\\\"$report_Gateway\\\", \\\"DNS\\\":\\\"$report_DNS\\\", \\\"Listen\\\":\\\"$report_Listen\\\", \\\"Selinux\\\":\\\"$report_Selinux\\\", \\\"Firewall\\\":\\\"$report_Firewall\\\", \\\"USERs\\\":\\\"$report_USERs\\\", \\\"USEREmptyPassword\\\":\\\"$report_USEREmptyPassword\\\", \\\"USERTheSameUID\\\":\\\"$report_USERTheSameUID\\\", \\\"PasswordExpiry\\\":\\\"$report_PasswordExpiry\\\", \\\"RootUser\\\":\\\"$report_RootUser\\\", \\\"Sudoers\\\":\\\"$report_Sudoers\\\", \\\"SSHAuthorized\\\":\\\"$report_SSHAuthorized\\\", \\\"SSHDProtocolVersion\\\":\\\"$report_SSHDProtocolVersion\\\", \\\"SSHDPermitRootLogin\\\":\\\"$report_SSHDPermitRootLogin\\\", \\\"DefunctProsess\\\":\\\"$report_DefunctProsess\\\", \\\"SelfInitiatedService\\\":\\\"$report_SelfInitiatedService\\\", \\\"SelfInitiatedProgram\\\":\\\"$report_SelfInitiatedProgram\\\", \\\"RuningService\\\":\\\"$report_RuningService\\\", \\\"Crontab\\\":\\\"$report_Crontab\\\", \\\"Syslog\\\":\\\"$report_Syslog\\\", \\\"SNMP\\\":\\\"$report_SNMP\\\", \\\"NTP\\\":\\\"$report_NTP\\\", \\\"JDK\\\":\\\"$report_JDK\\\" }\" #echo \"$json\" curl -l -H \"Content-type: application/json\" -X POST -d \"$json\" \"$uploadHostDailyCheckReportApi\" 2>/dev/null } function check(){ version getSystemStatus getCpuStatus getMemStatus getDiskStatus getNetworkStatus getListenStatus getProcessStatus getServiceStatus getAutoStartStatus getLoginStatus getCronStatus getUserStatus getPasswordStatus getSudoersStatus getJDKStatus getFirewallStatus getSSHStatus getSyslogStatus getSNMPStatus getNTPStatus getInstalledStatus } #\u6267\u884c\u68c0\u67e5\u5e76\u4fdd\u5b58\u68c0\u67e5\u7ed3\u679c check > $RESULTFILE echo \"\u68c0\u67e5\u7ed3\u679c\uff1a$RESULTFILE\" #\u4e0a\u4f20\u68c0\u67e5\u7ed3\u679c\u7684\u6587\u4ef6 #curl -F \"filename=@$RESULTFILE\" \"$uploadHostDailyCheckApi\" 2>/dev/null #\u4e0a\u4f20\u68c0\u67e5\u7ed3\u679c\u7684\u62a5\u8868 #uploadHostDailyCheckReport 1>/dev/null","title":"1. \u7cfb\u7edf\u5de1\u68c0"},{"location":"linux/shell/system/linux.system_check/#1","text":"\u4e3b\u8981\u662f\u8f93\u51fa\u5f53\u524d\u7cfb\u7edf\u7684\u76f8\u5173\u53c2\u6570\u6307\u6807","title":"1. \u4ecb\u7ecd"},{"location":"linux/shell/system/linux.system_check/#2","text":"#!/bin/bash #\u4e3b\u673a\u4fe1\u606f\u6bcf\u65e5\u5de1\u68c0 #\u4f5c\u8005: \u8521\u731b\u829d #version 2016.08.09 #\u5f53\u524d\u811a\u672c\u9002\u7528\u4e8eUbuntu #\u73af\u5883\u53d8\u91cfPATH\u6ca1\u8bbe\u597d\uff0c\u5728cron\u91cc\u6267\u884c\u65f6\u6709\u5f88\u591a\u547d\u4ee4\u4f1a\u627e\u4e0d\u5230 export PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin source /etc/profile [ $(id -u) -gt 0 ] && echo \"\u8bf7\u7528root\u7528\u6237\u6267\u884c\u6b64\u811a\u672c\uff01\" && exit 1 #uploadHostDailyCheckApi=\"http://10.0.0.1:8080/api/uploadHostDailyCheck\" #uploadHostDailyCheckReportApi=\"http://10.0.0.1:8080/api/uploadHostDailyCheckReport\" ubuntuVersion=$(awk -F'=' '/DISTRIB_RELEASE/{print $(NF)}' /etc/lsb-release) VERSION=\"2018.05.01\" #\u65e5\u5fd7\u76f8\u5173 PROGPATH=`echo $0 | sed -e 's,[\\\\/][^\\\\/][^\\\\/]*$,,'` [ -f $PROGPATH ] && PROGPATH=\".\" LOGPATH=\"$PROGPATH/log\" [ -e $LOGPATH ] || mkdir $LOGPATH RESULTFILE=\"$LOGPATH/HostDailyCheck-`hostname`-`date +%Y%m%d`.txt\" #\u5b9a\u4e49\u62a5\u8868\u7684\u5168\u5c40\u53d8\u91cf report_DateTime=\"\" #\u65e5\u671f ok report_Hostname=\"\" #\u4e3b\u673a\u540d ok report_OSRelease=\"\" #\u53d1\u884c\u7248\u672c ok report_Kernel=\"\" #\u5185\u6838 ok report_Language=\"\" #\u8bed\u8a00/\u7f16\u7801 ok report_LastReboot=\"\" #\u6700\u8fd1\u542f\u52a8\u65f6\u95f4 ok report_Uptime=\"\" #\u8fd0\u884c\u65f6\u95f4\uff08\u5929\uff09 ok report_CPUs=\"\" #CPU\u6570\u91cf ok report_CPUType=\"\" #CPU\u7c7b\u578b ok report_Arch=\"\" #CPU\u67b6\u6784 ok report_MemTotal=\"\" #\u5185\u5b58\u603b\u5bb9\u91cf(MB) ok report_MemFree=\"\" #\u5185\u5b58\u5269\u4f59(MB) ok report_MemUsedPercent=\"\" #\u5185\u5b58\u4f7f\u7528\u7387% ok report_DiskTotal=\"\" #\u786c\u76d8\u603b\u5bb9\u91cf(GB) ok report_DiskFree=\"\" #\u786c\u76d8\u5269\u4f59(GB) ok report_DiskUsedPercent=\"\" #\u786c\u76d8\u4f7f\u7528\u7387% ok report_InodeTotal=\"\" #Inode\u603b\u91cf ok report_InodeFree=\"\" #Inode\u5269\u4f59 ok report_InodeUsedPercent=\"\" #Inode\u4f7f\u7528\u7387 ok report_IP=\"\" #IP\u5730\u5740 ok report_MAC=\"\" #MAC\u5730\u5740 ok report_Gateway=\"\" #\u9ed8\u8ba4\u7f51\u5173 ok report_DNS=\"\" #DNS ok report_Listen=\"\" #\u76d1\u542c ok report_Selinux=\"\" #Selinux ok report_Firewall=\"\" #\u9632\u706b\u5899 ok report_USERs=\"\" #\u7528\u6237 ok report_USEREmptyPassword=\"\" #\u7a7a\u5bc6\u7801\u7528\u6237 ok report_USERTheSameUID=\"\" #\u76f8\u540cID\u7684\u7528\u6237 ok report_PasswordExpiry=\"\" #\u5bc6\u7801\u8fc7\u671f\uff08\u5929\uff09 ok report_RootUser=\"\" #root\u7528\u6237 ok report_Sudoers=\"\" #sudo\u6388\u6743 ok report_SSHAuthorized=\"\" #SSH\u4fe1\u4efb\u4e3b\u673a ok report_SSHDProtocolVersion=\"\" #SSH\u534f\u8bae\u7248\u672c ok report_SSHDPermitRootLogin=\"\" #\u5141\u8bb8root\u8fdc\u7a0b\u767b\u5f55 ok report_DefunctProsess=\"\" #\u50f5\u5c38\u8fdb\u7a0b\u6570\u91cf ok report_SelfInitiatedService=\"\" #\u81ea\u542f\u52a8\u670d\u52a1\u6570\u91cf ok report_SelfInitiatedProgram=\"\" #\u81ea\u542f\u52a8\u7a0b\u5e8f\u6570\u91cf ok report_RuningService=\"\" #\u8fd0\u884c\u4e2d\u670d\u52a1\u6570 ok report_Crontab=\"\" #\u8ba1\u5212\u4efb\u52a1\u6570 ok report_Syslog=\"\" #\u65e5\u5fd7\u670d\u52a1 ok report_SNMP=\"\" #SNMP OK report_NTP=\"\" #NTP ok report_JDK=\"\" #JDK\u7248\u672c ok function version(){ echo \"\" echo \"\" echo \"\u7cfb\u7edf\u5de1\u68c0\u811a\u672c\uff1aVersion $VERSION\" } function getCpuStatus(){ echo \"\" echo \"\" echo \"############################ CPU\u68c0\u67e5 #############################\" Physical_CPUs=$(grep \"physical id\" /proc/cpuinfo| sort | uniq | wc -l) Virt_CPUs=$(grep \"processor\" /proc/cpuinfo | wc -l) CPU_Kernels=$(grep \"cores\" /proc/cpuinfo|uniq| awk -F ': ' '{print $2}') CPU_Type=$(grep \"model name\" /proc/cpuinfo | awk -F ': ' '{print $2}' | sort | uniq) CPU_Arch=$(uname -m) echo \"\u7269\u7406CPU\u4e2a\u6570:$Physical_CPUs\" echo \"\u903b\u8f91CPU\u4e2a\u6570:$Virt_CPUs\" echo \"\u6bcfCPU\u6838\u5fc3\u6570:$CPU_Kernels\" echo \" CPU\u578b\u53f7:$CPU_Type\" echo \" CPU\u67b6\u6784:$CPU_Arch\" #\u62a5\u8868\u4fe1\u606f report_CPUs=$Virt_CPUs #CPU\u6570\u91cf report_CPUType=$CPU_Type #CPU\u7c7b\u578b report_Arch=$CPU_Arch #CPU\u67b6\u6784 } function getMemStatus(){ echo \"\" echo \"\" echo \"############################ \u5185\u5b58\u68c0\u67e5 ############################\" free -h #\u62a5\u8868\u4fe1\u606f MemTotal=$(grep MemTotal /proc/meminfo| awk '{print $2}') #KB MemFree=$(grep MemFree /proc/meminfo| awk '{print $2}') #KB let MemUsed=MemTotal-MemFree MemPercent=$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\") report_MemTotal=\"$((MemTotal/1024))\"\"MB\" #\u5185\u5b58\u603b\u5bb9\u91cf(MB) report_MemFree=\"$((MemFree/1024))\"\"MB\" #\u5185\u5b58\u5269\u4f59(MB) report_MemUsedPercent=\"$(awk \"BEGIN {if($MemTotal==0){printf 100}else{printf \\\"%.2f\\\",$MemUsed*100/$MemTotal}}\")\"\"%\" #\u5185\u5b58\u4f7f\u7528\u7387% } function getDiskStatus(){ echo \"\" echo \"\" echo \"############################ \u78c1\u76d8\u68c0\u67e5 ############################\" df -hiP | sed 's/Mounted on/Mounted/'> /tmp/inode df -hTP | sed 's/Mounted on/Mounted/'> /tmp/disk join /tmp/disk /tmp/inode | awk '{print $1,$2,\"|\",$3,$4,$5,$6,\"|\",$8,$9,$10,$11,\"|\",$12}'| column -t #\u62a5\u8868\u4fe1\u606f diskdata=$(df -TP | sed '1d' | awk '$2!=\"tmpfs\"{print}') #KB disktotal=$(echo \"$diskdata\" | awk '{total+=$3}END{print total}') #KB diskused=$(echo \"$diskdata\" | awk '{total+=$4}END{print total}') #KB diskfree=$((disktotal-diskused)) #KB diskusedpercent=$(echo $disktotal $diskused | awk '{if($1==0){printf 100}else{printf \"%.2f\",$2*100/$1}}') inodedata=$(df -iTP | sed '1d' | awk '$2!=\"tmpfs\"{print}') inodetotal=$(echo \"$inodedata\" | awk '{total+=$3}END{print total}') inodeused=$(echo \"$inodedata\" | awk '{total+=$4}END{print total}') inodefree=$((inodetotal-inodeused)) inodeusedpercent=$(echo $inodetotal $inodeused | awk '{if($1==0){printf 100}else{printf \"%.2f\",$2*100/$1}}') report_DiskTotal=$((disktotal/1024/1024))\"GB\" #\u786c\u76d8\u603b\u5bb9\u91cf(GB) report_DiskFree=$((diskfree/1024/1024))\"GB\" #\u786c\u76d8\u5269\u4f59(GB) report_DiskUsedPercent=\"$diskusedpercent\"\"%\" #\u786c\u76d8\u4f7f\u7528\u7387% report_InodeTotal=$((inodetotal/1000))\"K\" #Inode\u603b\u91cf report_InodeFree=$((inodefree/1000))\"K\" #Inode\u5269\u4f59 report_InodeUsedPercent=\"$inodeusedpercent\"\"%\" #Inode\u4f7f\u7528\u7387% } function getSystemStatus(){ echo \"\" echo \"\" echo \"############################ \u7cfb\u7edf\u68c0\u67e5 ############################\" if [ -e /etc/sysconfig/i18n ];then default_LANG=\"$(grep \"LANG=\" /etc/sysconfig/i18n | grep -v \"^#\" | awk -F '\"' '{print $2}')\" else default_LANG=$LANG fi export LANG=\"en_US.UTF-8\" Release=$(cat /etc/redhat-release 2>/dev/null) Kernel=$(uname -r) OS=$(uname -o) Hostname=$(uname -n) #SELinux=$(/usr/sbin/sestatus | grep \"SELinux status: \" | awk '{print $3}') LastReboot=$(who -b | awk '{print $3,$4}') uptime=$(uptime | sed 's/.*up \\([^,]*\\), .*/\\1/') echo \" \u7cfb\u7edf\uff1a$OS\" echo \" \u53d1\u884c\u7248\u672c\uff1a$Release\" echo \" \u5185\u6838\uff1a$Kernel\" echo \" \u4e3b\u673a\u540d\uff1a$Hostname\" #echo \" SELinux\uff1a$SELinux\" echo \"\u8bed\u8a00/\u7f16\u7801\uff1a$default_LANG\" echo \" \u5f53\u524d\u65f6\u95f4\uff1a$(date +'%F %T')\" echo \" \u6700\u540e\u542f\u52a8\uff1a$LastReboot\" echo \" \u8fd0\u884c\u65f6\u95f4\uff1a$uptime\" #\u62a5\u8868\u4fe1\u606f report_DateTime=$(date +\"%F %T\") #\u65e5\u671f report_Hostname=\"$Hostname\" #\u4e3b\u673a\u540d report_OSRelease=\"$Release\" #\u53d1\u884c\u7248\u672c report_Kernel=\"$Kernel\" #\u5185\u6838 report_Language=\"$default_LANG\" #\u8bed\u8a00/\u7f16\u7801 report_LastReboot=\"$LastReboot\" #\u6700\u8fd1\u542f\u52a8\u65f6\u95f4 report_Uptime=\"$uptime\" #\u8fd0\u884c\u65f6\u95f4\uff08\u5929\uff09 report_Selinux=\"$SELinux\" export LANG=\"$default_LANG\" } function getServiceStatus(){ echo \"\" echo \"\" echo \"############################ \u670d\u52a1\u68c0\u67e5 ############################\" echo \"\" if [[ $centosVersion > 7 ]];then conf=$(systemctl list-unit-files --type=service --state=enabled --no-pager | grep \"enabled\") process=$(systemctl list-units --type=service --state=running --no-pager | grep \".service\") #\u62a5\u8868\u4fe1\u606f report_SelfInitiatedService=\"$(echo \"$conf\" | wc -l)\" #\u81ea\u542f\u52a8\u670d\u52a1\u6570\u91cf report_RuningService=\"$(echo \"$process\" | wc -l)\" #\u8fd0\u884c\u4e2d\u670d\u52a1\u6570\u91cf else conf=$(/sbin/chkconfig | grep -E \":on|:\u542f\u7528\") process=$(/sbin/service --status-all 2>/dev/null | grep -E \"is running|\u6b63\u5728\u8fd0\u884c\") #\u62a5\u8868\u4fe1\u606f report_SelfInitiatedService=\"$(echo \"$conf\" | wc -l)\" #\u81ea\u542f\u52a8\u670d\u52a1\u6570\u91cf report_RuningService=\"$(echo \"$process\" | wc -l)\" #\u8fd0\u884c\u4e2d\u670d\u52a1\u6570\u91cf fi echo \"\u670d\u52a1\u914d\u7f6e\" echo \"--------\" echo \"$conf\" | column -t echo \"\" echo \"\u6b63\u5728\u8fd0\u884c\u7684\u670d\u52a1\" echo \"--------------\" echo \"$process\" } function getAutoStartStatus(){ echo \"\" echo \"\" echo \"############################ \u81ea\u542f\u52a8\u68c0\u67e5 ##########################\" conf=$(grep -v \"^#\" /etc/rc.d/rc.local| sed '/^$/d') echo \"$conf\" #\u62a5\u8868\u4fe1\u606f report_SelfInitiatedProgram=\"$(echo $conf | wc -l)\" #\u81ea\u542f\u52a8\u7a0b\u5e8f\u6570\u91cf } function getLoginStatus(){ echo \"\" echo \"\" echo \"############################ \u767b\u5f55\u68c0\u67e5 ############################\" last | head } function getNetworkStatus(){ echo \"\" echo \"\" echo \"############################ \u7f51\u7edc\u68c0\u67e5 ############################\" /sbin/ifconfig -a | grep -v packets | grep -v collisions | grep -v inet6 for i in $(ip link | grep BROADCAST | awk -F: '{print $2}');do ip add show $i | grep -E \"BROADCAST|global\"| awk '{print $2}' | tr '\\n' ' ' ;echo \"\" ;done GATEWAY=$(ip route | grep default | awk '{print $3}') DNS=$(grep nameserver /etc/resolv.conf| grep -v \"#\" | awk '{print $2}' | tr '\\n' ',' | sed 's/,$//') echo \"\" echo \"\u7f51\u5173\uff1a$GATEWAY \" echo \" DNS\uff1a$DNS\" #\u62a5\u8868\u4fe1\u606f IP=$(ip -f inet addr | grep -v 127.0.0.1 | grep inet | awk '{print $NF,$2}' | tr '\\n' ',' | sed 's/,$//') MAC=$(ip link | grep -v \"LOOPBACK\\|loopback\" | awk '{print $2}' | sed 'N;s/\\n//' | tr '\\n' ',' | sed 's/,$//') report_IP=\"$IP\" #IP\u5730\u5740 report_MAC=$MAC #MAC\u5730\u5740 report_Gateway=\"$GATEWAY\" #\u9ed8\u8ba4\u7f51\u5173 report_DNS=\"$DNS\" #DNS } function getListenStatus(){ echo \"\" echo \"\" echo \"############################ \u76d1\u542c\u68c0\u67e5 ############################\" TCPListen=$(ss -ntul | column -t) echo \"$TCPListen\" #\u62a5\u8868\u4fe1\u606f report_Listen=\"$(echo \"$TCPListen\"| sed '1d' | awk '/tcp/ {print $5}' | awk -F: '{print $NF}' | sort | uniq | wc -l)\" } function getCronStatus(){ echo \"\" echo \"\" echo \"############################ \u8ba1\u5212\u4efb\u52a1\u68c0\u67e5 ########################\" Crontab=0 for shell in $(grep -v \"/sbin/nologin\" /etc/shells);do for user in $(grep \"$shell\" /etc/passwd| awk -F: '{print $1}');do crontab -l -u $user >/dev/null 2>&1 status=$? if [ $status -eq 0 ];then echo \"$user\" echo \"--------\" crontab -l -u $user let Crontab=Crontab+$(crontab -l -u $user | wc -l) echo \"\" fi done done #\u8ba1\u5212\u4efb\u52a1 find /etc/cron* -type f | xargs -i ls -l {} | column -t let Crontab=Crontab+$(find /etc/cron* -type f | wc -l) #\u62a5\u8868\u4fe1\u606f report_Crontab=\"$Crontab\" #\u8ba1\u5212\u4efb\u52a1\u6570 } function getHowLongAgo(){ # \u8ba1\u7b97\u4e00\u4e2a\u65f6\u95f4\u6233\u79bb\u73b0\u5728\u6709\u591a\u4e45\u4e86 datetime=\"$*\" [ -z \"$datetime\" ] && echo \"\u9519\u8bef\u7684\u53c2\u6570\uff1agetHowLongAgo() $*\" Timestamp=$(date +%s -d \"$datetime\") #\u8f6c\u5316\u4e3a\u65f6\u95f4\u6233 Now_Timestamp=$(date +%s) Difference_Timestamp=$(($Now_Timestamp-$Timestamp)) days=0;hours=0;minutes=0; sec_in_day=$((60*60*24)); sec_in_hour=$((60*60)); sec_in_minute=60 while (( $(($Difference_Timestamp-$sec_in_day)) > 1 )) do let Difference_Timestamp=Difference_Timestamp-sec_in_day let days++ done while (( $(($Difference_Timestamp-$sec_in_hour)) > 1 )) do let Difference_Timestamp=Difference_Timestamp-sec_in_hour let hours++ done echo \"$days \u5929 $hours \u5c0f\u65f6\u524d\" } function getUserLastLogin(){ # \u83b7\u53d6\u7528\u6237\u6700\u8fd1\u4e00\u6b21\u767b\u5f55\u7684\u65f6\u95f4\uff0c\u542b\u5e74\u4efd # \u5f88\u9057\u61belast\u547d\u4ee4\u4e0d\u652f\u6301\u663e\u793a\u5e74\u4efd\uff0c\u53ea\u6709\"last -t YYYYMMDDHHMMSS\"\u8868\u793a\u67d0\u4e2a\u65f6\u95f4\u4e4b\u95f4\u7684\u767b\u5f55\uff0c\u6211 # \u4eec\u53ea\u80fd\u7528\u6700\u7b28\u7684\u65b9\u6cd5\u4e86\uff0c\u5bf9\u6bd4\u4eca\u5929\u4e4b\u524d\u548c\u4eca\u5e74\u5143\u65e6\u4e4b\u524d\uff08\u6216\u8005\u53bb\u5e74\u4e4b\u524d\u548c\u524d\u5e74\u4e4b\u524d\u2026\u2026\uff09\u67d0\u4e2a\u7528\u6237 # \u767b\u5f55\u6b21\u6570\uff0c\u5982\u679c\u767b\u5f55\u7edf\u8ba1\u6b21\u6570\u6709\u53d8\u5316\uff0c\u5219\u8bf4\u660e\u6700\u8fd1\u4e00\u6b21\u767b\u5f55\u662f\u4eca\u5e74\u3002 username=$1 : ${username:=\"`whoami`\"} thisYear=$(date +%Y) oldesYear=$(last | tail -n1 | awk '{print $NF}') while(( $thisYear >= $oldesYear));do loginBeforeToday=$(last $username | grep $username | wc -l) loginBeforeNewYearsDayOfThisYear=$(last $username -t $thisYear\"0101000000\" | grep $username | wc -l) if [ $loginBeforeToday -eq 0 ];then echo \"\u4ece\u672a\u767b\u5f55\u8fc7\" break elif [ $loginBeforeToday -gt $loginBeforeNewYearsDayOfThisYear ];then lastDateTime=$(last -i $username | head -n1 | awk '{for(i=4;i<(NF-2);i++)printf\"%s \",$i}')\" $thisYear\" #\u683c\u5f0f\u5982: Sat Nov 2 20:33 2015 lastDateTime=$(date \"+%Y-%m-%d %H:%M:%S\" -d \"$lastDateTime\") echo \"$lastDateTime\" break else thisYear=$((thisYear-1)) fi done } function getUserStatus(){ echo \"\" echo \"\" echo \"############################ \u7528\u6237\u68c0\u67e5 ############################\" #/etc/passwd \u6700\u540e\u4fee\u6539\u65f6\u95f4 pwdfile=\"$(cat /etc/passwd)\" Modify=$(stat /etc/passwd | grep Modify | tr '.' ' ' | awk '{print $2,$3}') echo \"/etc/passwd \u6700\u540e\u4fee\u6539\u65f6\u95f4\uff1a$Modify ($(getHowLongAgo $Modify))\" echo \"\" echo \"\u7279\u6743\u7528\u6237\" echo \"--------\" RootUser=\"\" for user in $(echo \"$pwdfile\" | awk -F: '{print $1}');do if [ $(id -u $user) -eq 0 ];then echo \"$user\" RootUser=\"$RootUser,$user\" fi done echo \"\" echo \"\u7528\u6237\u5217\u8868\" echo \"--------\" USERs=0 echo \"$( echo \"\u7528\u6237\u540d UID GID HOME SHELL \u6700\u540e\u4e00\u6b21\u767b\u5f55\" for shell in $(grep -v \"/sbin/nologin\" /etc/shells);do for username in $(grep \"$shell\" /etc/passwd| awk -F: '{print $1}');do userLastLogin=\"$(getUserLastLogin $username)\" echo \"$pwdfile\" | grep -w \"$username\" |grep -w \"$shell\"| awk -F: -v lastlogin=\"$(echo \"$userLastLogin\" | tr ' ' '_')\" '{print $1,$3,$4,$6,$7,lastlogin}' done let USERs=USERs+$(echo \"$pwdfile\" | grep \"$shell\"| wc -l) done )\" | column -t echo \"\" echo \"\u7a7a\u5bc6\u7801\u7528\u6237\" echo \"----------\" USEREmptyPassword=\"\" for shell in $(grep -v \"/sbin/nologin\" /etc/shells);do for user in $(echo \"$pwdfile\" | grep \"$shell\" | cut -d: -f1);do r=$(awk -F: '$2==\"!!\"{print $1}' /etc/shadow | grep -w $user) if [ ! -z $r ];then echo $r USEREmptyPassword=\"$USEREmptyPassword,\"$r fi done done echo \"\" echo \"\u76f8\u540cID\u7684\u7528\u6237\" echo \"------------\" USERTheSameUID=\"\" UIDs=$(cut -d: -f3 /etc/passwd | sort | uniq -c | awk '$1>1{print $2}') for uid in $UIDs;do echo -n \"$uid\"; USERTheSameUID=\"$uid\" r=$(awk -F: 'ORS=\"\";$3=='\"$uid\"'{print \":\",$1}' /etc/passwd) echo \"$r\" echo \"\" USERTheSameUID=\"$USERTheSameUID $r,\" done #\u62a5\u8868\u4fe1\u606f report_USERs=\"$USERs\" #\u7528\u6237 report_USEREmptyPassword=$(echo $USEREmptyPassword | sed 's/^,//') report_USERTheSameUID=$(echo $USERTheSameUID | sed 's/,$//') report_RootUser=$(echo $RootUser | sed 's/^,//') #\u7279\u6743\u7528\u6237 } function getPasswordStatus { echo \"\" echo \"\" echo \"############################ \u5bc6\u7801\u68c0\u67e5 ############################\" pwdfile=\"$(cat /etc/passwd)\" echo \"\" echo \"\u5bc6\u7801\u8fc7\u671f\u68c0\u67e5\" echo \"------------\" result=\"\" for shell in $(grep -v \"/sbin/nologin\" /etc/shells);do for user in $(echo \"$pwdfile\" | grep \"$shell\" | cut -d: -f1);do get_expiry_date=$(/usr/bin/chage -l $user | grep 'Password expires' | cut -d: -f2) if [[ $get_expiry_date = ' never' || $get_expiry_date = 'never' ]];then printf \"%-15s \u6c38\u4e0d\u8fc7\u671f\\n\" $user result=\"$result,$user:never\" else password_expiry_date=$(date -d \"$get_expiry_date\" \"+%s\") current_date=$(date \"+%s\") diff=$(($password_expiry_date-$current_date)) let DAYS=$(($diff/(60*60*24))) printf \"%-15s %s\u5929\u540e\u8fc7\u671f\\n\" $user $DAYS result=\"$result,$user:$DAYS days\" fi done done report_PasswordExpiry=$(echo $result | sed 's/^,//') echo \"\" echo \"\u5bc6\u7801\u7b56\u7565\u68c0\u67e5\" echo \"------------\" grep -v \"#\" /etc/login.defs | grep -E \"PASS_MAX_DAYS|PASS_MIN_DAYS|PASS_MIN_LEN|PASS_WARN_AGE\" } function getSudoersStatus(){ echo \"\" echo \"\" echo \"############################ Sudoers\u68c0\u67e5 #########################\" conf=$(grep -v \"^#\" /etc/sudoers| grep -v \"^Defaults\" | sed '/^$/d') echo \"$conf\" echo \"\" #\u62a5\u8868\u4fe1\u606f report_Sudoers=\"$(echo $conf | wc -l)\" } function getInstalledStatus(){ echo \"\" echo \"\" echo \"############################ \u8f6f\u4ef6\u68c0\u67e5 ############################\" rpm -qa --last | head | column -t } function getProcessStatus(){ echo \"\" echo \"\" echo \"############################ \u8fdb\u7a0b\u68c0\u67e5 ############################\" if [ $(ps -ef | grep defunct | grep -v grep | wc -l) -ge 1 ];then echo \"\" echo \"\u50f5\u5c38\u8fdb\u7a0b\"; echo \"--------\" ps -ef | head -n1 ps -ef | grep defunct | grep -v grep fi echo \"\" echo \"\u5185\u5b58\u5360\u7528TOP10\" echo \"-------------\" echo -e \"PID %MEM RSS COMMAND $(ps aux | awk '{print $2, $4, $6, $11}' | sort -k3rn | head -n 10 )\"| column -t echo \"\" echo \"CPU\u5360\u7528TOP10\" echo \"------------\" top b -n1 | head -17 | tail -11 #\u62a5\u8868\u4fe1\u606f report_DefunctProsess=\"$(ps -ef | grep defunct | grep -v grep|wc -l)\" } function getJDKStatus(){ echo \"\" echo \"\" echo \"############################ JDK\u68c0\u67e5 #############################\" java -version 2>/dev/null if [ $? -eq 0 ];then java -version 2>&1 fi echo \"JAVA_HOME=\\\"$JAVA_HOME\\\"\" #\u62a5\u8868\u4fe1\u606f report_JDK=\"$(java -version 2>&1 | grep version | awk '{print $1,$3}' | tr -d '\"')\" } function getSyslogStatus(){ echo \"\" echo \"\" echo \"############################ syslog\u68c0\u67e5 ##########################\" echo \"\u670d\u52a1\u72b6\u6001\uff1a$(getState rsyslog)\" echo \"\" echo \"/etc/rsyslog.conf\" echo \"-----------------\" cat /etc/rsyslog.conf 2>/dev/null | grep -v \"^#\" | grep -v \"^\\\\$\" | sed '/^$/d' | column -t #\u62a5\u8868\u4fe1\u606f report_Syslog=\"$(getState rsyslog)\" } function getFirewallStatus(){ echo \"\" echo \"\" echo \"############################ \u9632\u706b\u5899\u68c0\u67e5 ##########################\" #\u9632\u706b\u5899\u72b6\u6001\uff0c\u7b56\u7565\u7b49 if [[ $centosVersion < 7 ]];then /etc/init.d/iptables status >/dev/null 2>&1 status=$? if [ $status -eq 0 ];then s=\"active\" elif [ $status -eq 3 ];then s=\"inactive\" elif [ $status -eq 4 ];then s=\"permission denied\" else s=\"unknown\" fi else s=\"$(getState iptables)\" fi echo \"iptables: $s\" echo \"\" echo \"/etc/sysconfig/iptables\" echo \"-----------------------\" cat /etc/sysconfig/iptables 2>/dev/null #\u62a5\u8868\u4fe1\u606f report_Firewall=\"$s\" } function getSNMPStatus(){ #SNMP\u670d\u52a1\u72b6\u6001\uff0c\u914d\u7f6e\u7b49 echo \"\" echo \"\" echo \"############################ SNMP\u68c0\u67e5 ############################\" status=\"$(getState snmpd)\" echo \"\u670d\u52a1\u72b6\u6001\uff1a$status\" echo \"\" if [ -e /etc/snmp/snmpd.conf ];then echo \"/etc/snmp/snmpd.conf\" echo \"--------------------\" cat /etc/snmp/snmpd.conf 2>/dev/null | grep -v \"^#\" | sed '/^$/d' fi #\u62a5\u8868\u4fe1\u606f report_SNMP=\"$(getState snmpd)\" } function getState(){ if [[ $centosVersion < 7 ]];then if [ -e \"/etc/init.d/$1\" ];then if [ `/etc/init.d/$1 status 2>/dev/null | grep -E \"is running|\u6b63\u5728\u8fd0\u884c\" | wc -l` -ge 1 ];then r=\"active\" else r=\"inactive\" fi else r=\"unknown\" fi else #CentOS 7+ r=\"$(systemctl is-active $1 2>&1)\" fi echo \"$r\" } function getSSHStatus(){ #SSHD\u670d\u52a1\u72b6\u6001\uff0c\u914d\u7f6e,\u53d7\u4fe1\u4efb\u4e3b\u673a\u7b49 echo \"\" echo \"\" echo \"############################ SSH\u68c0\u67e5 #############################\" #\u68c0\u67e5\u53d7\u4fe1\u4efb\u4e3b\u673a pwdfile=\"$(cat /etc/passwd)\" echo \"\u670d\u52a1\u72b6\u6001\uff1a$(getState sshd)\" Protocol_Version=$(cat /etc/ssh/sshd_config | grep Protocol | awk '{print $2}') echo \"SSH\u534f\u8bae\u7248\u672c\uff1a$Protocol_Version\" echo \"\" echo \"\u4fe1\u4efb\u4e3b\u673a\" echo \"--------\" authorized=0 for user in $(echo \"$pwdfile\" | grep /bin/bash | awk -F: '{print $1}');do authorize_file=$(echo \"$pwdfile\" | grep -w $user | awk -F: '{printf $6\"/.ssh/authorized_keys\"}') authorized_host=$(cat $authorize_file 2>/dev/null | awk '{print $3}' | tr '\\n' ',' | sed 's/,$//') if [ ! -z $authorized_host ];then echo \"$user \u6388\u6743 \\\"$authorized_host\\\" \u65e0\u5bc6\u7801\u8bbf\u95ee\" fi let authorized=authorized+$(cat $authorize_file 2>/dev/null | awk '{print $3}'|wc -l) done echo \"\" echo \"\u662f\u5426\u5141\u8bb8ROOT\u8fdc\u7a0b\u767b\u5f55\" echo \"--------------------\" config=$(cat /etc/ssh/sshd_config | grep PermitRootLogin) firstChar=${config:0:1} if [ $firstChar == \"#\" ];then PermitRootLogin=\"yes\" #\u9ed8\u8ba4\u662f\u5141\u8bb8ROOT\u8fdc\u7a0b\u767b\u5f55\u7684 else PermitRootLogin=$(echo $config | awk '{print $2}') fi echo \"PermitRootLogin $PermitRootLogin\" echo \"\" echo \"/etc/ssh/sshd_config\" echo \"--------------------\" cat /etc/ssh/sshd_config | grep -v \"^#\" | sed '/^$/d' #\u62a5\u8868\u4fe1\u606f report_SSHAuthorized=\"$authorized\" #SSH\u4fe1\u4efb\u4e3b\u673a report_SSHDProtocolVersion=\"$Protocol_Version\" #SSH\u534f\u8bae\u7248\u672c report_SSHDPermitRootLogin=\"$PermitRootLogin\" #\u5141\u8bb8root\u8fdc\u7a0b\u767b\u5f55 } function getNTPStatus(){ #NTP\u670d\u52a1\u72b6\u6001\uff0c\u5f53\u524d\u65f6\u95f4\uff0c\u914d\u7f6e\u7b49 echo \"\" echo \"\" echo \"############################ NTP\u68c0\u67e5 #############################\" if [ -e /etc/ntp.conf ];then echo \"\u670d\u52a1\u72b6\u6001\uff1a$(getState ntpd)\" echo \"\" echo \"/etc/ntp.conf\" echo \"-------------\" cat /etc/ntp.conf 2>/dev/null | grep -v \"^#\" | sed '/^$/d' fi #\u62a5\u8868\u4fe1\u606f report_NTP=\"$(getState ntpd)\" } function uploadHostDailyCheckReport(){ json=\"{ \\\"DateTime\\\":\\\"$report_DateTime\\\", \\\"Hostname\\\":\\\"$report_Hostname\\\", \\\"OSRelease\\\":\\\"$report_OSRelease\\\", \\\"Kernel\\\":\\\"$report_Kernel\\\", \\\"Language\\\":\\\"$report_Language\\\", \\\"LastReboot\\\":\\\"$report_LastReboot\\\", \\\"Uptime\\\":\\\"$report_Uptime\\\", \\\"CPUs\\\":\\\"$report_CPUs\\\", \\\"CPUType\\\":\\\"$report_CPUType\\\", \\\"Arch\\\":\\\"$report_Arch\\\", \\\"MemTotal\\\":\\\"$report_MemTotal\\\", \\\"MemFree\\\":\\\"$report_MemFree\\\", \\\"MemUsedPercent\\\":\\\"$report_MemUsedPercent\\\", \\\"DiskTotal\\\":\\\"$report_DiskTotal\\\", \\\"DiskFree\\\":\\\"$report_DiskFree\\\", \\\"DiskUsedPercent\\\":\\\"$report_DiskUsedPercent\\\", \\\"InodeTotal\\\":\\\"$report_InodeTotal\\\", \\\"InodeFree\\\":\\\"$report_InodeFree\\\", \\\"InodeUsedPercent\\\":\\\"$report_InodeUsedPercent\\\", \\\"IP\\\":\\\"$report_IP\\\", \\\"MAC\\\":\\\"$report_MAC\\\", \\\"Gateway\\\":\\\"$report_Gateway\\\", \\\"DNS\\\":\\\"$report_DNS\\\", \\\"Listen\\\":\\\"$report_Listen\\\", \\\"Selinux\\\":\\\"$report_Selinux\\\", \\\"Firewall\\\":\\\"$report_Firewall\\\", \\\"USERs\\\":\\\"$report_USERs\\\", \\\"USEREmptyPassword\\\":\\\"$report_USEREmptyPassword\\\", \\\"USERTheSameUID\\\":\\\"$report_USERTheSameUID\\\", \\\"PasswordExpiry\\\":\\\"$report_PasswordExpiry\\\", \\\"RootUser\\\":\\\"$report_RootUser\\\", \\\"Sudoers\\\":\\\"$report_Sudoers\\\", \\\"SSHAuthorized\\\":\\\"$report_SSHAuthorized\\\", \\\"SSHDProtocolVersion\\\":\\\"$report_SSHDProtocolVersion\\\", \\\"SSHDPermitRootLogin\\\":\\\"$report_SSHDPermitRootLogin\\\", \\\"DefunctProsess\\\":\\\"$report_DefunctProsess\\\", \\\"SelfInitiatedService\\\":\\\"$report_SelfInitiatedService\\\", \\\"SelfInitiatedProgram\\\":\\\"$report_SelfInitiatedProgram\\\", \\\"RuningService\\\":\\\"$report_RuningService\\\", \\\"Crontab\\\":\\\"$report_Crontab\\\", \\\"Syslog\\\":\\\"$report_Syslog\\\", \\\"SNMP\\\":\\\"$report_SNMP\\\", \\\"NTP\\\":\\\"$report_NTP\\\", \\\"JDK\\\":\\\"$report_JDK\\\" }\" #echo \"$json\" curl -l -H \"Content-type: application/json\" -X POST -d \"$json\" \"$uploadHostDailyCheckReportApi\" 2>/dev/null } function check(){ version getSystemStatus getCpuStatus getMemStatus getDiskStatus getNetworkStatus getListenStatus getProcessStatus getServiceStatus getAutoStartStatus getLoginStatus getCronStatus getUserStatus getPasswordStatus getSudoersStatus getJDKStatus getFirewallStatus getSSHStatus getSyslogStatus getSNMPStatus getNTPStatus getInstalledStatus } #\u6267\u884c\u68c0\u67e5\u5e76\u4fdd\u5b58\u68c0\u67e5\u7ed3\u679c check > $RESULTFILE echo \"\u68c0\u67e5\u7ed3\u679c\uff1a$RESULTFILE\" #\u4e0a\u4f20\u68c0\u67e5\u7ed3\u679c\u7684\u6587\u4ef6 #curl -F \"filename=@$RESULTFILE\" \"$uploadHostDailyCheckApi\" 2>/dev/null #\u4e0a\u4f20\u68c0\u67e5\u7ed3\u679c\u7684\u62a5\u8868 #uploadHostDailyCheckReport 1>/dev/null","title":"2. \u4ee3\u7801"},{"location":"linux/tools/axel.index/","text":"Axel \u5feb\u901f\u4e0b\u8f7d 1. \u4ecb\u7ecd \u00b6 Axel \u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u4e0b\u8f7d\u7a0b\u5e8f\uff0c\u5b83\u548c\u5176\u4ed6\u52a0\u901f\u5668\u4e00\u6837\uff0c\u5bf9\u540c\u4e00\u4e2a\u6587\u4ef6\u5efa\u7acb\u591a\u4e2a\u8fde\u63a5\uff0c\u6bcf\u4e2a\u8fde\u63a5\u4e0b\u8f7d\u5355\u72ec\u7684\u6587\u4ef6\u7247\u6bb5\u4ee5\u66f4\u5feb\u5730\u5b8c\u6210\u4e0b\u8f7d\u3002 Axel \u652f\u6301 HTTP\u3001HTTPS\u3001FTP \u548c FTPS \u534f\u8bae\u3002\u5b83\u4e5f\u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u955c\u50cf\u7ad9\u70b9\u4e0b\u8f7d\u5355\u4e2a\u6587\u4ef6\uff0c\u6240\u4ee5\uff0cAxel \u53ef\u4ee5\u52a0\u901f\u4e0b\u8f7d\u9ad8\u8fbe 40\uff05\uff08\u5927\u7ea6\uff0c\u6211\u4e2a\u4eba\u8ba4\u4e3a\uff09\u3002\u5b83\u975e\u5e38\u8f7b\u91cf\u7ea7\uff0c\u56e0\u4e3a\u5b83\u6ca1\u6709\u4f9d\u8d56\u5e76\u4e14\u4f7f\u7528\u975e\u5e38\u5c11\u7684 CPU \u548c\u5185\u5b58\u3002 Axel \u4e00\u6b65\u5230\u4f4d\u5730\u5c06\u6240\u6709\u6570\u636e\u76f4\u63a5\u4e0b\u8f7d\u5230\u76ee\u6807\u6587\u4ef6\uff08LCTT \u8bd1\u6ce8\uff1a\u800c\u4e0d\u662f\u50cf\u5176\u5b83\u7684\u4e0b\u8f7d\u8f6f\u4ef6\u90a3\u6837\u4e0b\u8f7d\u6210\u591a\u4e2a\u6587\u4ef6\u5757\uff0c\u7136\u540e\u62fc\u63a5\uff09\u3002 \u6ce8\u610f\uff1a\u4e0d\u652f\u6301\u5728\u5355\u6761\u547d\u4ee4\u4e2d\u4e0b\u8f7d\u4e24\u4e2a\u6587\u4ef6\u3002 \u4f60\u8fd8\u53ef\u4ee5\u5c1d\u8bd5\u5176\u4ed6\u547d\u4ee4\u884c\u4e0b\u8f7d\u7ba1\u7406\u5668/\u52a0\u901f\u5668\u3002 aria2 - \u8d85\u5feb\u901f\u4e0b\u8f7d\u7a0b\u5e8f wget - \u6807\u51c6\u547d\u4ee4\u884c\u4e0b\u8f7d\u7a0b\u5e8f curl - \u547d\u4ee4\u884c\u4e0b\u8f7d\u7a0b\u5e8f Linux \u4e0b\u7684\u6700\u597d\u7684 4 \u4e2a\u547d\u4ee4\u884c\u4e0b\u8f7d\u7ba1\u7406\u5668/\u52a0\u901f\u5668 \u200b \u5927\u591a\u6570\u53d1\u884c\u7248\uff08Debian\u3001Ubuntu\u3001Mint\u3001Fedora\u3001suse\u3001openSUSE\u3001Arch Linux\u3001Manjaro\u3001Mageia \u7b49\uff09\u90fd\u6709 axel \u5305\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4ece\u53d1\u884c\u7248\u5b98\u65b9\u4ed3\u5e93\u8f7b\u677e\u5b89\u88c5\u3002\u5bf9\u4e8e CentOS/RHEL\uff0c\u6211\u4eec\u9700\u8981\u542f\u7528 EPEL Repository \u3002 1.1 Debian/Ubuntu/LinuxMint \u4e0a\u5b89\u88c5 Axel \u00b6 sudo apt-get install axel 1.2 RHEL/CentOS \u4e0a\u5b89\u88c5 Axel \u00b6 sudo yum install axel 1.3 Fedora \u4e0a\u5b89\u88c5 Axel \u00b6 dnf install axel 1.4 openSUSE \u4e0a\u5b89\u88c5 Axel \u00b6 sudo zypper install axel 2. \u4e0b\u8f7d\u5355\u4e2a\u6587\u4ef6 \u00b6 \u200b \u4ee5\u4e0b\u547d\u4ee4\u5c06\u4ece\u7ed9\u5b9a\u7684 URL \u4e0b\u8f7d\u6587\u4ef6\u5e76\u5b58\u50a8\u5728\u5f53\u524d\u76ee\u5f55\u4e2d\uff0c\u4e0b\u8f7d\u6587\u4ef6\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6587\u4ef6\u7684\u4fe1\u606f\uff08\u5efa\u7acb\u7684\u8fde\u63a5\u6570\u3001\u4e0b\u8f7d\u901f\u5ea6\u3001\u4e0b\u8f7d\u8fdb\u5ea6\u3001\u5b8c\u6210\u4e0b\u8f7d\u6240\u82b1\u8d39\u7684\u65f6\u95f4\u4ee5\u53ca\u8fde\u63a5\u5b8c\u6210\u7684\u65f6\u95f4\uff09\u3002 root@leco:/tmp/cmz# axel https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u521d\u59cb\u5316\u4e0b\u8f7d: https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u6587\u4ef6\u5927\u5c0f: 22678208 \u5b57\u8282 \u6253\u5f00\u8f93\u51fa\u6587\u4ef6 owncloud-9.0.0.tar.bz2 \u5f00\u59cb\u4e0b\u8f7d [ 0%] .......... .......... .......... .......... .......... [ 8.6KB/s] [ 0%] .......... .......... .......... .......... .......... [ 8.6KB/s] [ 0%] .......... .......... .......... .......... .......... [ 8.1KB/s] [ 0%] .......... .......... .......... .......... .......... [ 8.7KB/s] [ 0%] .......... .......... .......... .......... .......... [ 9.8KB/s] [ 1%] .......... .......... .......... .......... .......... [ 10.5KB/s] [ 1%] .......... .......... .......... .......... .......... [ 11.1KB/s] [ 1%] .......... .......... .......... .......... .......... [ 10.6KB/s] [ 1%] .......... .......... .......... .......... .......... [ 8.4KB/s] [ 2%] .......... ..... \u8fde\u63a5\u8d85\u65f6 0 ,,,,,,,,,, ,,,,,..... .......... .......... .......... [ 8.8KB/s] [ 2%] .......... .......... .......... .......... .......... [ 9.5KB/s] [ 2%] .......... .......... .......... .......... .......... [ 10.3KB/s] [ 2%] .......... .......... .......... .......... .......... [ 11.0KB/s] [ 2%] .......... .......... .......... .......... .......... [ 11.6KB/s] [ 3%] .......... .......... .......... .......... .......... [ 12.2KB/s] [ 3%] .......... .......... .......... .......... .......... [ 12.7KB/s] [ 3%] .......... .......... .......... .......... .......... [ 12.8KB/s] [ 3%] .......... .......... .......... .......... .......... [ 12.6KB/s] [ 4%] .......... .......... .......... .......... .......... [ 12.5KB/s] [ 4%] .......... .......... .......... .......... .......... [ 12.6KB/s] [ 4%] .......... .......... .......... .......... .......... [ 12.7KB/s] 3. \u7528\u4e0d\u540c\u7684\u540d\u79f0\u4fdd\u5b58\u6587\u4ef6 \u00b6 root@leco:/tmp/cmz# axel -o cloud.tar.bz2 https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u521d\u59cb\u5316\u4e0b\u8f7d: https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u6587\u4ef6\u5927\u5c0f: 22678208 \u5b57\u8282 \u6253\u5f00\u8f93\u51fa\u6587\u4ef6 cloud.tar.bz2 \u5f00\u59cb\u4e0b\u8f7d [ 0%] .......... .......... .......... .......... .......... [ 2.9KB/s] [ 0%] .......... .......... .......^C 77.7 \u5343\u5b57\u8282 \u5df2\u4e0b\u8f7d\uff0c\u7528\u65f6 19 \u79d2\u3002\uff083.96 \u5343\u5b57\u8282/\u79d2\uff09 root@leco:/tmp/cmz# ls owncloud-9.0.0.tar.bz2 owncloud-9.0.0.tar.bz2 4. \u9650\u5236\u4e0b\u8f7d\u901f\u5ea6 \u00b6 \u200b \u9ed8\u8ba4\u60c5\u51b5\u4e0b axel \u4ee5\u5b57\u8282/\u79d2\u4e3a\u5355\u4f4d\u8bbe\u7f6e\u4e0b\u8f7d\u6587\u4ef6\u7684\u6700\u5927\u901f\u5ea6\u3002\u5f53\u6211\u4eec\u7684\u7f51\u7edc\u8fde\u63a5\u901f\u5ea6\u8f83\u6162\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u6b64\u9009\u9879\u3002\u53ea\u9700\u6dfb\u52a0 -s \u9009\u9879\uff0c\u540e\u9762\u8ddf\u5b57\u8282\u503c\u3002\u8fd9\u91cc\u6211\u4eec\u8981\u9650\u901f 512 KB/s \u4e0b\u8f7d\u4e00\u4e2a\u6587\u4ef6\u3002 root@leco:/tmp/cmz# axel -s 512000 https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u521d\u59cb\u5316\u4e0b\u8f7d: https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u6587\u4ef6\u5927\u5c0f: 22678208 \u5b57\u8282 \u6253\u5f00\u8f93\u51fa\u6587\u4ef6 owncloud-9.0.0.tar.bz2 \u627e\u5230\u72b6\u6001\u6587\u4ef6\uff1a 2151071 \u5b57\u8282\u5df2\u4e0b\u8f7d\uff0c\u7ee7\u7eed\u4e0b\u8f7d 20527137 \u5b57\u8282\u3002 \u5f00\u59cb\u4e0b\u8f7d ,,,,,,,,,, ,,,,,,,,,, ,,,,,,,,,, ,,,,,,,,,, ,,,,,,,,,, [ 3.3KB/s] [ 9%] .......... .......... ... 5. \u9650\u5236\u8fde\u63a5\u6570 \u00b6 \u200b axel \u9ed8\u8ba4\u5efa\u7acb 4 \u4e2a\u8fde\u63a5\u4ee5\u4ece\u4e0d\u540c\u7684\u955c\u50cf\u83b7\u53d6\u6587\u4ef6\u3002\u6b64\u5916\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 -n \u9009\u9879\u6dfb\u52a0\u66f4\u591a\u7684\u8fde\u63a5\uff0c\u540e\u8ddf\u8fde\u63a5\u6570 10 \u6765\u63d0\u9ad8\u4e0b\u8f7d\u901f\u5ea6\u3002\u4fdd\u9669\u8d77\u89c1\uff0c\u6211\u4eec\u6dfb\u52a0\u4e86\u5341\u4e2a\u8fde\u63a5\uff0c\u4f46\u4e0d\u5e78\u7684\u662f\uff0c\u5b83\u82b1\u4e86\u66f4\u591a\u65f6\u95f4\u6765\u4e0b\u8f7d\u6587\u4ef6\u3002 root@leco:/tmp/cmz# axel -n 10 https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u521d\u59cb\u5316\u4e0b\u8f7d: https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u6587\u4ef6\u5927\u5c0f: 22678208 \u5b57\u8282 \u6253\u5f00\u8f93\u51fa\u6587\u4ef6 owncloud-9.0.0.tar.bz2 \u627e\u5230\u72b6\u6001\u6587\u4ef6\uff1a 2217319 \u5b57\u8282\u5df2\u4e0b\u8f7d\uff0c\u7ee7\u7eed\u4e0b\u8f7d 20460889 \u5b57\u8282\u3002 \u5f00\u59cb\u4e0b\u8f7d ,,,,,,,,,, ,,,,,..... .......... .......... .......... [ 28.7KB/s] [ 9%] .......... .......... .......... .......... .......... [ 40.2KB/s] [ 10%] .......... .......... .......... .......... .......... [ 38.9KB/s] [ 10%] ........ 6. \u6062\u590d\u672a\u5b8c\u6210\u7684\u4e0b\u8f7d \u00b6 \u200b axel \u9ed8\u8ba4\u5177\u6709\u6062\u590d\u672a\u5b8c\u6210\u7684\u4e0b\u8f7d\u7684\u884c\u4e3a\u3002Axel \u5728\u4e0b\u8f7d\u6587\u4ef6\u65f6\u5b9a\u671f\u66f4\u65b0\u72b6\u6001\u6587\u4ef6\uff08\u6269\u5c55\u540d\u4e3a .st \uff09\u3002\u7531\u4e8e\u67d0\u4e9b\u539f\u56e0\uff0c\u4e0b\u8f7d\u4e2d\u9014\u505c\u6b62\u4e86\uff1f\u4e0d\u7528\u62c5\u5fc3\uff0c\u53ea\u8981\u4f7f\u7528\u76f8\u540c\u7684 axel \u547d\u4ee4\uff0c\u5b83\u5c06\u4f1a\u68c0\u67e5 file \u548c file.st \uff0c\u5982\u679c\u627e\u5230\uff0c\u5b83\u4f1a\u4ece\u505c\u6b62\u5904\u6062\u590d\u4e0b\u8f7d\u3002 root@leco:/tmp/cmz# ll \u603b\u7528\u91cf 2496 drwxr-xr-x 2 root root 4096 3\u6708 25 14:36 ./ drwxrwxrwt 31 root root 12288 3\u6708 25 14:41 ../ -rw-r--r-- 1 root root 17028450 3\u6708 25 14:36 cloud.tar.bz2 -rw-r--r-- 1 root root 44 3\u6708 25 14:36 cloud.tar.bz2.st -rw-r--r-- 1 root root 17651050 3\u6708 25 14:41 owncloud-9.0.0.tar.bz2 -rw-r--r-- 1 root root 44 3\u6708 25 14:41 owncloud-9.0.0.tar.bz2.st root@leco:/tmp/cmz# axel -n 10 https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u521d\u59cb\u5316\u4e0b\u8f7d: https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u6587\u4ef6\u5927\u5c0f: 22678208 \u5b57\u8282 \u6253\u5f00\u8f93\u51fa\u6587\u4ef6 owncloud-9.0.0.tar.bz2 \u627e\u5230\u72b6\u6001\u6587\u4ef6\uff1a 2424295 \u5b57\u8282\u5df2\u4e0b\u8f7d\uff0c\u7ee7\u7eed\u4e0b\u8f7d 20253913 \u5b57\u8282\u3002 \u5f00\u59cb\u4e0b\u8f7d ,,,,,,,,,, ,,,,,,,... .......... .......... .......... [ 42.8KB/s] [ 10%] .......... .......... .......... .......... .......... [ 45.9KB/s] [ 11%] .......... .......... .......... .......... .......... [ 64.8KB/s] [ 11%] .......... .......... .......... .......... .......... [ 82.4KB/s] [ 11%] .......... ..^C 195.1 \u5343\u5b57\u8282 \u5df2\u4e0b\u8f7d\uff0c\u7528\u65f6 2 \u79d2\u3002\uff0877.54 \u5343\u5b57\u8282/\u79d2\uff09 \u4e0a\u9762\u7684\u8f93\u51fa\u6e05\u6670\u5730\u663e\u793a\u4e86\u5728\u4e0b\u8f7d\u65ad\u5f00\u65f6\u6709\u4e24\u4e2a\u6587\u4ef6 owncloud-9.0.0.tar.bz2 \u548c owncloud-9.0.0.tar.bz2.st \u3002\u5f53\u91cd\u65b0\u5f00\u59cb\u4e0b\u8f7d\u65f6\uff0c\u5b83\u4f1a\u4ece\u505c\u6b62\u5904\u5f00\u59cb\u4e0b\u8f7d\u3002 7. \u4e0d\u663e\u793a\u6587\u4ef6\u4e0b\u8f7d\u8fdb\u5ea6 \u00b6 \u5982\u679c\u4f60\u4e0d\u60f3\u8981\u770b\u5230\u6587\u4ef6\u7684\u4e0b\u8f7d\u8fdb\u5ea6\uff0c\u53ea\u8981\u5728 axel \u547d\u4ee4\u4e2d\u52a0\u5165 -q \u9009\u9879\u3002 root@leco:/tmp/cmz# axel -q https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 8. \u66ff\u6362\u8fdb\u5ea6\u6761 \u00b6 \u5982\u679c\u4f60\u4e0d\u559c\u6b22\u9ed8\u8ba4\u7684\u8fdb\u5ea6\u6761\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 -a \u9009\u9879\u6765\u66ff\u6362\u8fdb\u5ea6\u6761\u3002 root@leco:/tmp/cmz# axel -q https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 ^Croot@leco:/tmp/cmz# axel -a https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u521d\u59cb\u5316\u4e0b\u8f7d: https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u6587\u4ef6\u5927\u5c0f: 22678208 \u5b57\u8282 \u6253\u5f00\u8f93\u51fa\u6587\u4ef6 owncloud-9.0.0.tar.bz2 \u627e\u5230\u72b6\u6001\u6587\u4ef6\uff1a 3204427 \u5b57\u8282\u5df2\u4e0b\u8f7d\uff0c\u7ee7\u7eed\u4e0b\u8f7d 19473781 \u5b57\u8282\u3002 \u5f00\u59cb\u4e0b\u8f7d [ 14%] [.0 .1 .2 .3 ] [ 16.2KB/s] [19:33]","title":"1. axel"},{"location":"linux/tools/axel.index/#1","text":"Axel \u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u4e0b\u8f7d\u7a0b\u5e8f\uff0c\u5b83\u548c\u5176\u4ed6\u52a0\u901f\u5668\u4e00\u6837\uff0c\u5bf9\u540c\u4e00\u4e2a\u6587\u4ef6\u5efa\u7acb\u591a\u4e2a\u8fde\u63a5\uff0c\u6bcf\u4e2a\u8fde\u63a5\u4e0b\u8f7d\u5355\u72ec\u7684\u6587\u4ef6\u7247\u6bb5\u4ee5\u66f4\u5feb\u5730\u5b8c\u6210\u4e0b\u8f7d\u3002 Axel \u652f\u6301 HTTP\u3001HTTPS\u3001FTP \u548c FTPS \u534f\u8bae\u3002\u5b83\u4e5f\u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u955c\u50cf\u7ad9\u70b9\u4e0b\u8f7d\u5355\u4e2a\u6587\u4ef6\uff0c\u6240\u4ee5\uff0cAxel \u53ef\u4ee5\u52a0\u901f\u4e0b\u8f7d\u9ad8\u8fbe 40\uff05\uff08\u5927\u7ea6\uff0c\u6211\u4e2a\u4eba\u8ba4\u4e3a\uff09\u3002\u5b83\u975e\u5e38\u8f7b\u91cf\u7ea7\uff0c\u56e0\u4e3a\u5b83\u6ca1\u6709\u4f9d\u8d56\u5e76\u4e14\u4f7f\u7528\u975e\u5e38\u5c11\u7684 CPU \u548c\u5185\u5b58\u3002 Axel \u4e00\u6b65\u5230\u4f4d\u5730\u5c06\u6240\u6709\u6570\u636e\u76f4\u63a5\u4e0b\u8f7d\u5230\u76ee\u6807\u6587\u4ef6\uff08LCTT \u8bd1\u6ce8\uff1a\u800c\u4e0d\u662f\u50cf\u5176\u5b83\u7684\u4e0b\u8f7d\u8f6f\u4ef6\u90a3\u6837\u4e0b\u8f7d\u6210\u591a\u4e2a\u6587\u4ef6\u5757\uff0c\u7136\u540e\u62fc\u63a5\uff09\u3002 \u6ce8\u610f\uff1a\u4e0d\u652f\u6301\u5728\u5355\u6761\u547d\u4ee4\u4e2d\u4e0b\u8f7d\u4e24\u4e2a\u6587\u4ef6\u3002 \u4f60\u8fd8\u53ef\u4ee5\u5c1d\u8bd5\u5176\u4ed6\u547d\u4ee4\u884c\u4e0b\u8f7d\u7ba1\u7406\u5668/\u52a0\u901f\u5668\u3002 aria2 - \u8d85\u5feb\u901f\u4e0b\u8f7d\u7a0b\u5e8f wget - \u6807\u51c6\u547d\u4ee4\u884c\u4e0b\u8f7d\u7a0b\u5e8f curl - \u547d\u4ee4\u884c\u4e0b\u8f7d\u7a0b\u5e8f Linux \u4e0b\u7684\u6700\u597d\u7684 4 \u4e2a\u547d\u4ee4\u884c\u4e0b\u8f7d\u7ba1\u7406\u5668/\u52a0\u901f\u5668 \u200b \u5927\u591a\u6570\u53d1\u884c\u7248\uff08Debian\u3001Ubuntu\u3001Mint\u3001Fedora\u3001suse\u3001openSUSE\u3001Arch Linux\u3001Manjaro\u3001Mageia \u7b49\uff09\u90fd\u6709 axel \u5305\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4ece\u53d1\u884c\u7248\u5b98\u65b9\u4ed3\u5e93\u8f7b\u677e\u5b89\u88c5\u3002\u5bf9\u4e8e CentOS/RHEL\uff0c\u6211\u4eec\u9700\u8981\u542f\u7528 EPEL Repository \u3002","title":"1. \u4ecb\u7ecd"},{"location":"linux/tools/axel.index/#11-debianubuntulinuxmint-axel","text":"sudo apt-get install axel","title":"1.1 Debian/Ubuntu/LinuxMint \u4e0a\u5b89\u88c5 Axel"},{"location":"linux/tools/axel.index/#12-rhelcentos-axel","text":"sudo yum install axel","title":"1.2  RHEL/CentOS \u4e0a\u5b89\u88c5 Axel"},{"location":"linux/tools/axel.index/#13-fedora-axel","text":"dnf install axel","title":"1.3 Fedora \u4e0a\u5b89\u88c5 Axel"},{"location":"linux/tools/axel.index/#14-opensuse-axel","text":"sudo zypper install axel","title":"1.4  openSUSE \u4e0a\u5b89\u88c5 Axel"},{"location":"linux/tools/axel.index/#2","text":"\u200b \u4ee5\u4e0b\u547d\u4ee4\u5c06\u4ece\u7ed9\u5b9a\u7684 URL \u4e0b\u8f7d\u6587\u4ef6\u5e76\u5b58\u50a8\u5728\u5f53\u524d\u76ee\u5f55\u4e2d\uff0c\u4e0b\u8f7d\u6587\u4ef6\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6587\u4ef6\u7684\u4fe1\u606f\uff08\u5efa\u7acb\u7684\u8fde\u63a5\u6570\u3001\u4e0b\u8f7d\u901f\u5ea6\u3001\u4e0b\u8f7d\u8fdb\u5ea6\u3001\u5b8c\u6210\u4e0b\u8f7d\u6240\u82b1\u8d39\u7684\u65f6\u95f4\u4ee5\u53ca\u8fde\u63a5\u5b8c\u6210\u7684\u65f6\u95f4\uff09\u3002 root@leco:/tmp/cmz# axel https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u521d\u59cb\u5316\u4e0b\u8f7d: https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u6587\u4ef6\u5927\u5c0f: 22678208 \u5b57\u8282 \u6253\u5f00\u8f93\u51fa\u6587\u4ef6 owncloud-9.0.0.tar.bz2 \u5f00\u59cb\u4e0b\u8f7d [ 0%] .......... .......... .......... .......... .......... [ 8.6KB/s] [ 0%] .......... .......... .......... .......... .......... [ 8.6KB/s] [ 0%] .......... .......... .......... .......... .......... [ 8.1KB/s] [ 0%] .......... .......... .......... .......... .......... [ 8.7KB/s] [ 0%] .......... .......... .......... .......... .......... [ 9.8KB/s] [ 1%] .......... .......... .......... .......... .......... [ 10.5KB/s] [ 1%] .......... .......... .......... .......... .......... [ 11.1KB/s] [ 1%] .......... .......... .......... .......... .......... [ 10.6KB/s] [ 1%] .......... .......... .......... .......... .......... [ 8.4KB/s] [ 2%] .......... ..... \u8fde\u63a5\u8d85\u65f6 0 ,,,,,,,,,, ,,,,,..... .......... .......... .......... [ 8.8KB/s] [ 2%] .......... .......... .......... .......... .......... [ 9.5KB/s] [ 2%] .......... .......... .......... .......... .......... [ 10.3KB/s] [ 2%] .......... .......... .......... .......... .......... [ 11.0KB/s] [ 2%] .......... .......... .......... .......... .......... [ 11.6KB/s] [ 3%] .......... .......... .......... .......... .......... [ 12.2KB/s] [ 3%] .......... .......... .......... .......... .......... [ 12.7KB/s] [ 3%] .......... .......... .......... .......... .......... [ 12.8KB/s] [ 3%] .......... .......... .......... .......... .......... [ 12.6KB/s] [ 4%] .......... .......... .......... .......... .......... [ 12.5KB/s] [ 4%] .......... .......... .......... .......... .......... [ 12.6KB/s] [ 4%] .......... .......... .......... .......... .......... [ 12.7KB/s]","title":"2. \u4e0b\u8f7d\u5355\u4e2a\u6587\u4ef6"},{"location":"linux/tools/axel.index/#3","text":"root@leco:/tmp/cmz# axel -o cloud.tar.bz2 https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u521d\u59cb\u5316\u4e0b\u8f7d: https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u6587\u4ef6\u5927\u5c0f: 22678208 \u5b57\u8282 \u6253\u5f00\u8f93\u51fa\u6587\u4ef6 cloud.tar.bz2 \u5f00\u59cb\u4e0b\u8f7d [ 0%] .......... .......... .......... .......... .......... [ 2.9KB/s] [ 0%] .......... .......... .......^C 77.7 \u5343\u5b57\u8282 \u5df2\u4e0b\u8f7d\uff0c\u7528\u65f6 19 \u79d2\u3002\uff083.96 \u5343\u5b57\u8282/\u79d2\uff09 root@leco:/tmp/cmz# ls owncloud-9.0.0.tar.bz2 owncloud-9.0.0.tar.bz2","title":"3. \u7528\u4e0d\u540c\u7684\u540d\u79f0\u4fdd\u5b58\u6587\u4ef6"},{"location":"linux/tools/axel.index/#4","text":"\u200b \u9ed8\u8ba4\u60c5\u51b5\u4e0b axel \u4ee5\u5b57\u8282/\u79d2\u4e3a\u5355\u4f4d\u8bbe\u7f6e\u4e0b\u8f7d\u6587\u4ef6\u7684\u6700\u5927\u901f\u5ea6\u3002\u5f53\u6211\u4eec\u7684\u7f51\u7edc\u8fde\u63a5\u901f\u5ea6\u8f83\u6162\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u6b64\u9009\u9879\u3002\u53ea\u9700\u6dfb\u52a0 -s \u9009\u9879\uff0c\u540e\u9762\u8ddf\u5b57\u8282\u503c\u3002\u8fd9\u91cc\u6211\u4eec\u8981\u9650\u901f 512 KB/s \u4e0b\u8f7d\u4e00\u4e2a\u6587\u4ef6\u3002 root@leco:/tmp/cmz# axel -s 512000 https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u521d\u59cb\u5316\u4e0b\u8f7d: https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u6587\u4ef6\u5927\u5c0f: 22678208 \u5b57\u8282 \u6253\u5f00\u8f93\u51fa\u6587\u4ef6 owncloud-9.0.0.tar.bz2 \u627e\u5230\u72b6\u6001\u6587\u4ef6\uff1a 2151071 \u5b57\u8282\u5df2\u4e0b\u8f7d\uff0c\u7ee7\u7eed\u4e0b\u8f7d 20527137 \u5b57\u8282\u3002 \u5f00\u59cb\u4e0b\u8f7d ,,,,,,,,,, ,,,,,,,,,, ,,,,,,,,,, ,,,,,,,,,, ,,,,,,,,,, [ 3.3KB/s] [ 9%] .......... .......... ...","title":"4. \u9650\u5236\u4e0b\u8f7d\u901f\u5ea6"},{"location":"linux/tools/axel.index/#5","text":"\u200b axel \u9ed8\u8ba4\u5efa\u7acb 4 \u4e2a\u8fde\u63a5\u4ee5\u4ece\u4e0d\u540c\u7684\u955c\u50cf\u83b7\u53d6\u6587\u4ef6\u3002\u6b64\u5916\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 -n \u9009\u9879\u6dfb\u52a0\u66f4\u591a\u7684\u8fde\u63a5\uff0c\u540e\u8ddf\u8fde\u63a5\u6570 10 \u6765\u63d0\u9ad8\u4e0b\u8f7d\u901f\u5ea6\u3002\u4fdd\u9669\u8d77\u89c1\uff0c\u6211\u4eec\u6dfb\u52a0\u4e86\u5341\u4e2a\u8fde\u63a5\uff0c\u4f46\u4e0d\u5e78\u7684\u662f\uff0c\u5b83\u82b1\u4e86\u66f4\u591a\u65f6\u95f4\u6765\u4e0b\u8f7d\u6587\u4ef6\u3002 root@leco:/tmp/cmz# axel -n 10 https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u521d\u59cb\u5316\u4e0b\u8f7d: https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u6587\u4ef6\u5927\u5c0f: 22678208 \u5b57\u8282 \u6253\u5f00\u8f93\u51fa\u6587\u4ef6 owncloud-9.0.0.tar.bz2 \u627e\u5230\u72b6\u6001\u6587\u4ef6\uff1a 2217319 \u5b57\u8282\u5df2\u4e0b\u8f7d\uff0c\u7ee7\u7eed\u4e0b\u8f7d 20460889 \u5b57\u8282\u3002 \u5f00\u59cb\u4e0b\u8f7d ,,,,,,,,,, ,,,,,..... .......... .......... .......... [ 28.7KB/s] [ 9%] .......... .......... .......... .......... .......... [ 40.2KB/s] [ 10%] .......... .......... .......... .......... .......... [ 38.9KB/s] [ 10%] ........","title":"5. \u9650\u5236\u8fde\u63a5\u6570"},{"location":"linux/tools/axel.index/#6","text":"\u200b axel \u9ed8\u8ba4\u5177\u6709\u6062\u590d\u672a\u5b8c\u6210\u7684\u4e0b\u8f7d\u7684\u884c\u4e3a\u3002Axel \u5728\u4e0b\u8f7d\u6587\u4ef6\u65f6\u5b9a\u671f\u66f4\u65b0\u72b6\u6001\u6587\u4ef6\uff08\u6269\u5c55\u540d\u4e3a .st \uff09\u3002\u7531\u4e8e\u67d0\u4e9b\u539f\u56e0\uff0c\u4e0b\u8f7d\u4e2d\u9014\u505c\u6b62\u4e86\uff1f\u4e0d\u7528\u62c5\u5fc3\uff0c\u53ea\u8981\u4f7f\u7528\u76f8\u540c\u7684 axel \u547d\u4ee4\uff0c\u5b83\u5c06\u4f1a\u68c0\u67e5 file \u548c file.st \uff0c\u5982\u679c\u627e\u5230\uff0c\u5b83\u4f1a\u4ece\u505c\u6b62\u5904\u6062\u590d\u4e0b\u8f7d\u3002 root@leco:/tmp/cmz# ll \u603b\u7528\u91cf 2496 drwxr-xr-x 2 root root 4096 3\u6708 25 14:36 ./ drwxrwxrwt 31 root root 12288 3\u6708 25 14:41 ../ -rw-r--r-- 1 root root 17028450 3\u6708 25 14:36 cloud.tar.bz2 -rw-r--r-- 1 root root 44 3\u6708 25 14:36 cloud.tar.bz2.st -rw-r--r-- 1 root root 17651050 3\u6708 25 14:41 owncloud-9.0.0.tar.bz2 -rw-r--r-- 1 root root 44 3\u6708 25 14:41 owncloud-9.0.0.tar.bz2.st root@leco:/tmp/cmz# axel -n 10 https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u521d\u59cb\u5316\u4e0b\u8f7d: https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u6587\u4ef6\u5927\u5c0f: 22678208 \u5b57\u8282 \u6253\u5f00\u8f93\u51fa\u6587\u4ef6 owncloud-9.0.0.tar.bz2 \u627e\u5230\u72b6\u6001\u6587\u4ef6\uff1a 2424295 \u5b57\u8282\u5df2\u4e0b\u8f7d\uff0c\u7ee7\u7eed\u4e0b\u8f7d 20253913 \u5b57\u8282\u3002 \u5f00\u59cb\u4e0b\u8f7d ,,,,,,,,,, ,,,,,,,... .......... .......... .......... [ 42.8KB/s] [ 10%] .......... .......... .......... .......... .......... [ 45.9KB/s] [ 11%] .......... .......... .......... .......... .......... [ 64.8KB/s] [ 11%] .......... .......... .......... .......... .......... [ 82.4KB/s] [ 11%] .......... ..^C 195.1 \u5343\u5b57\u8282 \u5df2\u4e0b\u8f7d\uff0c\u7528\u65f6 2 \u79d2\u3002\uff0877.54 \u5343\u5b57\u8282/\u79d2\uff09 \u4e0a\u9762\u7684\u8f93\u51fa\u6e05\u6670\u5730\u663e\u793a\u4e86\u5728\u4e0b\u8f7d\u65ad\u5f00\u65f6\u6709\u4e24\u4e2a\u6587\u4ef6 owncloud-9.0.0.tar.bz2 \u548c owncloud-9.0.0.tar.bz2.st \u3002\u5f53\u91cd\u65b0\u5f00\u59cb\u4e0b\u8f7d\u65f6\uff0c\u5b83\u4f1a\u4ece\u505c\u6b62\u5904\u5f00\u59cb\u4e0b\u8f7d\u3002","title":"6.  \u6062\u590d\u672a\u5b8c\u6210\u7684\u4e0b\u8f7d"},{"location":"linux/tools/axel.index/#7","text":"\u5982\u679c\u4f60\u4e0d\u60f3\u8981\u770b\u5230\u6587\u4ef6\u7684\u4e0b\u8f7d\u8fdb\u5ea6\uff0c\u53ea\u8981\u5728 axel \u547d\u4ee4\u4e2d\u52a0\u5165 -q \u9009\u9879\u3002 root@leco:/tmp/cmz# axel -q https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2","title":"7. \u4e0d\u663e\u793a\u6587\u4ef6\u4e0b\u8f7d\u8fdb\u5ea6"},{"location":"linux/tools/axel.index/#8","text":"\u5982\u679c\u4f60\u4e0d\u559c\u6b22\u9ed8\u8ba4\u7684\u8fdb\u5ea6\u6761\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 -a \u9009\u9879\u6765\u66ff\u6362\u8fdb\u5ea6\u6761\u3002 root@leco:/tmp/cmz# axel -q https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 ^Croot@leco:/tmp/cmz# axel -a https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u521d\u59cb\u5316\u4e0b\u8f7d: https://download.owncloud.org/community/owncloud-9.0.0.tar.bz2 \u6587\u4ef6\u5927\u5c0f: 22678208 \u5b57\u8282 \u6253\u5f00\u8f93\u51fa\u6587\u4ef6 owncloud-9.0.0.tar.bz2 \u627e\u5230\u72b6\u6001\u6587\u4ef6\uff1a 3204427 \u5b57\u8282\u5df2\u4e0b\u8f7d\uff0c\u7ee7\u7eed\u4e0b\u8f7d 19473781 \u5b57\u8282\u3002 \u5f00\u59cb\u4e0b\u8f7d [ 14%] [.0 .1 .2 .3 ] [ 16.2KB/s] [19:33]","title":"8.  \u66ff\u6362\u8fdb\u5ea6\u6761"},{"location":"mysql/mysql.affairs/","text":"MySQL \u4e8b\u52a1 1. \u4ecb\u7ecd \u00b6 \u4e8b\u52a1\uff08transaction\uff09\uff1a\u662f\u4e00\u7ec4\u539f\u5b50\u6027\u7684SQL\u67e5\u8be2\uff0c\u6216\u8005\u8bf4\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u5de5\u4f5c\u5355\u5143\u3002\u4e8b\u52a1\u5185\u7684\u8bed\u53e5\uff0c\u8981\u4e48\u5c31\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u5c31\u5168\u90fd\u4e0d\u6267\u884c\u3002 1.2. \u7279\u6027-\u539f\u5b50\u6027\uff08Atomicity\uff09 \u00b6 \u539f\u5b50\u6027\u662f\u6307\u4e8b\u52a1\u5305\u542b\u7684\u6240\u6709\u64cd\u4f5c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u56de\u6eda\uff0c\u56e0\u6b64\u4e8b\u52a1\u7684\u64cd\u4f5c\u5982\u679c\u6210\u529f\u5c31\u5fc5\u987b\u8981\u5b8c\u5168\u5e94\u7528\u5230\u6570\u636e\u5e93\uff0c\u5982\u679c\u64cd\u4f5c\u5931\u8d25\u5219\u4e0d\u80fd\u5bf9\u6570\u636e\u5e93\u6709\u4efb\u4f55\u5f71\u54cd\u3002 1.3. \u7279\u6027-\u4e00\u81f4\u6027\uff08Consistency\uff09 \u00b6 \u4e00\u81f4\u6027\u662f\u6307\u4e8b\u52a1\u5fc5\u987b\u4f7f\u6570\u636e\u5e93\u4ece\u4e00\u4e2a\u4e00\u81f4\u6027\u72b6\u6001\u53d8\u6362\u5230\u53e6\u4e00\u4e2a\u4e00\u81f4\u6027\u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u4e4b\u524d\u548c\u6267\u884c\u4e4b\u540e\u90fd\u5fc5\u987b\u5904\u4e8e\u4e00\u81f4\u6027\u72b6\u6001\u3002 \u62ff\u8f6c\u8d26\u6765\u8bf4\uff0c\u5047\u8bbe\u7528\u6237A\u548c\u7528\u6237B\u4e24\u8005\u7684\u94b1\u52a0\u8d77\u6765\u4e00\u5171\u662f5000\uff0c\u90a3\u4e48\u4e0d\u7ba1A\u548cB\u4e4b\u95f4\u5982\u4f55\u8f6c\u8d26\uff0c\u8f6c\u51e0\u6b21\u8d26\uff0c\u4e8b\u52a1\u7ed3\u675f\u540e\u4e24\u4e2a\u7528\u6237\u7684\u94b1\u76f8\u52a0\u8d77\u6765\u5e94\u8be5\u8fd8\u5f97\u662f5000\uff0c\u8fd9\u5c31\u662f\u4e8b\u52a1\u7684\u4e00\u81f4\u6027\u3002 \uff01 1.4. \u7279\u6027-\u9694\u79bb\u6027\uff08Isolation\uff09 \u00b6 \u9694\u79bb\u6027\u662f\u5f53\u591a\u4e2a\u7528\u6237\u5e76\u53d1\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0c\u6bd4\u5982\u64cd\u4f5c\u540c\u4e00\u5f20\u8868\u65f6\uff0c\u6570\u636e\u5e93\u4e3a\u6bcf\u4e00\u4e2a\u7528\u6237\u5f00\u542f\u7684\u4e8b\u52a1\uff0c\u4e0d\u80fd\u88ab\u5176\u4ed6\u4e8b\u52a1\u7684\u64cd\u4f5c\u6240\u5e72\u6270\uff0c\u591a\u4e2a\u5e76\u53d1\u4e8b\u52a1\u4e4b\u95f4\u8981\u76f8\u4e92\u9694\u79bb\u3002 \u5373\u8981\u8fbe\u5230\u8fd9\u4e48\u4e00\u79cd\u6548\u679c\uff1a\u5bf9\u4e8e\u4efb\u610f\u4e24\u4e2a\u5e76\u53d1\u7684\u4e8b\u52a1T1\u548cT2\uff0c\u5728\u4e8b\u52a1T1\u770b\u6765\uff0cT2\u8981\u4e48\u5728T1\u5f00\u59cb\u4e4b\u524d\u5c31\u5df2\u7ecf\u7ed3\u675f\uff0c\u8981\u4e48\u5728T1\u7ed3\u675f\u4e4b\u540e\u624d\u5f00\u59cb\uff0c\u8fd9\u6837\u6bcf\u4e2a\u4e8b\u52a1\u90fd\u611f\u89c9\u4e0d\u5230\u6709\u5176\u4ed6\u4e8b\u52a1\u5728\u5e76\u53d1\u5730\u6267\u884c\u3002 \u5173\u4e8e\u4e8b\u52a1\u7684\u9694\u79bb\u6027\u6570\u636e\u5e93\u63d0\u4f9b\u4e86\u591a\u79cd\u9694\u79bb\u7ea7\u522b\uff0c\u7a0d\u540e\u4f1a\u4ecb\u7ecd\u5230\uff01 1.5. \u7279\u6027-\u6301\u4e45\u6027\uff08Durability\uff09 \u00b6 \u6301\u4e45\u6027\u662f\u6307\u4e00\u4e2a\u4e8b\u52a1\u4e00\u65e6\u88ab\u63d0\u4ea4\u4e86\uff0c\u90a3\u4e48\u5bf9\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u7684\u6539\u53d8\u5c31\u662f\u6c38\u4e45\u6027\u7684\uff0c\u5373\u4fbf\u662f\u5728\u6570\u636e\u5e93\u7cfb\u7edf\u9047\u5230\u6545\u969c\u7684\u60c5\u51b5\u4e0b\u4e5f\u4e0d\u4f1a\u4e22\u5931\u63d0\u4ea4\u4e8b\u52a1\u7684\u64cd\u4f5c\u3002 \u4f8b\u5982\u6211\u4eec\u5728\u4f7f\u7528JDBC\u64cd\u4f5c\u6570\u636e\u5e93\u65f6\uff0c\u5728\u63d0\u4ea4\u4e8b\u52a1\u65b9\u6cd5\u540e\uff0c\u63d0\u793a\u7528\u6237\u4e8b\u52a1\u64cd\u4f5c\u5b8c\u6210\uff0c\u5f53\u6211\u4eec\u7a0b\u5e8f\u6267\u884c\u5b8c\u6210\u76f4\u5230\u770b\u5230\u63d0\u793a\u540e\uff0c\u5c31\u53ef\u4ee5\u8ba4\u5b9a\u4e8b\u52a1\u4ee5\u53ca\u6b63\u786e\u63d0\u4ea4\uff0c\u5373\u4f7f\u8fd9\u65f6\u5019\u6570\u636e\u5e93\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u4e5f\u5fc5\u987b\u8981\u5c06\u6211\u4eec\u7684\u4e8b\u52a1\u5b8c\u5168\u6267\u884c\u5b8c\u6210\uff0c\u5426\u5219\u5c31\u4f1a\u9020\u6210\u6211\u4eec\u770b\u5230\u63d0\u793a\u4e8b\u52a1\u5904\u7406\u5b8c\u6bd5\uff0c\u4f46\u662f\u6570\u636e\u5e93\u56e0\u4e3a\u6545\u969c\u800c\u6ca1\u6709\u6267\u884c\u4e8b\u52a1\u7684\u91cd\u5927\u9519\u8bef\u3002 \u4ee5\u4e0a\u4ecb\u7ecd\u5b8c\u4e8b\u52a1\u7684\u56db\u5927\u7279\u6027(\u7b80\u79f0ACID)\uff0c\u73b0\u5728\u91cd\u70b9\u6765\u8bf4\u660e\u4e0b\u4e8b\u52a1\u7684\u9694\u79bb\u6027\uff0c\u5f53\u591a\u4e2a\u7ebf\u7a0b\u90fd\u5f00\u542f\u4e8b\u52a1\u64cd\u4f5c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u65f6\uff0c\u6570\u636e\u5e93\u7cfb\u7edf\u8981\u80fd\u8fdb\u884c\u9694\u79bb\u64cd\u4f5c\uff0c\u4ee5\u4fdd\u8bc1\u5404\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u6570\u636e\u7684\u51c6\u786e\u6027\uff0c\u5728\u4ecb\u7ecd\u6570\u636e\u5e93\u63d0\u4f9b\u7684\u5404\u79cd\u9694\u79bb\u7ea7\u522b\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u770b\u770b\u5982\u679c\u4e0d\u8003\u8651\u4e8b\u52a1\u7684\u9694\u79bb\u6027\uff0c\u4f1a\u53d1\u751f\u7684\u51e0\u79cd\u95ee\u9898\uff1a 2. \u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b \u00b6 \u6570\u636e\u5e93\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u67094\u79cd\uff0c\u7531\u4f4e\u5230\u9ad8\u5206\u522b\u4e3aRead uncommitted \u3001Read committed \u3001Repeatable read \u3001Serializable \u3002\u800c\u4e14\uff0c\u5728\u4e8b\u52a1\u7684\u5e76\u53d1\u64cd\u4f5c\u4e2d\u53ef\u80fd\u4f1a\u51fa\u73b0\u810f\u8bfb\uff0c\u4e0d\u53ef\u91cd\u590d\u8bfb\uff0c\u5e7b\u8bfb\u3002\u4e0b\u9762\u901a\u8fc7\u4e8b\u4f8b\u4e00\u4e00\u9610\u8ff0\u5b83\u4eec\u7684\u6982\u5ff5\u4e0e\u8054\u7cfb\u3002 2.1 Read uncommitted(\u672a\u63d0\u4ea4\u8bfb) \u00b6 \u8bfb\u672a\u63d0\u4ea4\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u4e00\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u8bfb\u53d6\u53e6\u4e00\u4e2a\u672a\u63d0\u4ea4\u4e8b\u52a1\u7684\u6570\u636e\u3002 \u4e8b\u4f8b\uff1a\u8001\u677f\u8981\u7ed9\u7a0b\u5e8f\u5458\u53d1\u5de5\u8d44\uff0c\u7a0b\u5e8f\u5458\u7684\u5de5\u8d44\u662f3.6\u4e07/\u6708\u3002\u4f46\u662f\u53d1\u5de5\u8d44\u65f6\u8001\u677f\u4e0d\u5c0f\u5fc3\u6309\u9519\u4e86\u6570\u5b57\uff0c\u6309\u62103.9\u4e07/\u6708\uff0c\u8be5\u94b1\u5df2\u7ecf\u6253\u5230\u7a0b\u5e8f\u5458\u7684\u6237\u53e3\uff0c\u4f46\u662f\u4e8b\u52a1\u8fd8\u6ca1\u6709\u63d0\u4ea4\uff0c\u5c31\u5728\u8fd9\u65f6\uff0c\u7a0b\u5e8f\u5458\u53bb\u67e5\u770b\u81ea\u5df1\u8fd9\u4e2a\u6708\u7684\u5de5\u8d44\uff0c\u53d1\u73b0\u6bd4\u5f80\u5e38\u591a\u4e863\u5343\u5143\uff0c\u4ee5\u4e3a\u6da8\u5de5\u8d44\u4e86\u975e\u5e38\u9ad8\u5174\u3002\u4f46\u662f\u8001\u677f\u53ca\u65f6\u53d1\u73b0\u4e86\u4e0d\u5bf9\uff0c\u9a6c\u4e0a\u56de\u6eda\u5dee\u70b9\u5c31\u63d0\u4ea4\u4e86\u7684\u4e8b\u52a1\uff0c\u5c06\u6570\u5b57\u6539\u62103.6\u4e07\u518d\u63d0\u4ea4\u3002 \u5206\u6790\uff1a\u5b9e\u9645\u7a0b\u5e8f\u5458\u8fd9\u4e2a\u6708\u7684\u5de5\u8d44\u8fd8\u662f3.6\u4e07\uff0c\u4f46\u662f\u7a0b\u5e8f\u5458\u770b\u5230\u7684\u662f3.9\u4e07\u3002\u4ed6\u770b\u5230\u7684\u662f\u8001\u677f\u8fd8\u6ca1\u63d0\u4ea4\u4e8b\u52a1\u65f6\u7684\u6570\u636e\u3002\u8fd9\u5c31\u662f\u810f\u8bfb\u3002 \u810f\u8bfb(Dirty Read)\uff1a\u4e8b\u52a1\u53ef\u4ee5\u8bfb\u53d6\u672a\u63d0\u4ea4\u7684\u6570\u636e \u90a3\u600e\u4e48\u89e3\u51b3\u810f\u8bfb\u5462\uff1fRead committed\uff01\u8bfb\u63d0\u4ea4\uff0c\u80fd\u89e3\u51b3\u810f\u8bfb\u95ee\u9898\u3002 2.2 Read committed(\u63d0\u4ea4\u8bfb) \u00b6 \u8bfb\u63d0\u4ea4\uff0c\u987e\u540d\u601d\u4e49\uff0c\u4e5f\u53ebnonrepeatable read\uff08\u4e0d\u53ef\u91cd\u590d\u8bfb\uff09\u5c31\u662f\u4e00\u4e2a\u4e8b\u52a1\u8981\u7b49\u53e6\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u540e\u624d\u80fd\u8bfb\u53d6\u6570\u636e\u3002\u4e00\u4e2a\u4e8b\u52a1\u4ece\u5f00\u59cb\u5230\u63d0\u4ea4\u4e4b\u524d\uff0c\u6240\u505a\u7684\u4efb\u4f55\u4fee\u6539\u5bf9\u5176\u4ed6\u4e8b\u52a1\u90fd\u662f\u4e0d\u53ef\u89c1\u7684\u3002 \u4e8b\u4f8b\uff1a\u7a0b\u5e8f\u5458\u62ff\u7740\u4fe1\u7528\u5361\u53bb\u4eab\u53d7\u751f\u6d3b\uff08\u5361\u91cc\u5f53\u7136\u662f\u53ea\u67093.6\u4e07\uff09\uff0c\u5f53\u4ed6\u57cb\u5355\u65f6\uff08\u7a0b\u5e8f\u5458\u4e8b\u52a1\u5f00\u542f\uff09\uff0c\u6536\u8d39\u7cfb\u7edf\u4e8b\u5148\u68c0\u6d4b\u5230\u4ed6\u7684\u5361\u91cc\u67093.6\u4e07\uff0c\u5c31\u5728\u8fd9\u4e2a\u65f6\u5019\uff01\uff01\u7a0b\u5e8f\u5458\u7684\u59bb\u5b50\u8981\u628a\u94b1\u5168\u90e8\u8f6c\u51fa\u5145\u5f53\u5bb6\u7528\uff0c\u5e76\u63d0\u4ea4\u3002\u5f53\u6536\u8d39\u7cfb\u7edf\u51c6\u5907\u6263\u6b3e\u65f6\uff0c\u518d\u68c0\u6d4b\u5361\u91cc\u7684\u91d1\u989d\uff0c\u53d1\u73b0\u5df2\u7ecf\u6ca1\u94b1\u4e86\uff08\u7b2c\u4e8c\u6b21\u68c0\u6d4b\u91d1\u989d\u5f53\u7136\u8981\u7b49\u5f85\u59bb\u5b50\u8f6c\u51fa\u91d1\u989d\u4e8b\u52a1\u63d0\u4ea4\u5b8c\uff09\u3002\u7a0b\u5e8f\u5458\u5c31\u4f1a\u5f88\u90c1\u95f7\uff0c\u660e\u660e\u5361\u91cc\u662f\u6709\u94b1\u7684\u2026 \u5206\u6790\uff1a\u8fd9\u5c31\u662f\u8bfb\u63d0\u4ea4\uff0c\u82e5\u6709\u4e8b\u52a1\u5bf9\u6570\u636e\u8fdb\u884c\u66f4\u65b0\uff08UPDATE\uff09\u64cd\u4f5c\u65f6\uff0c\u8bfb\u64cd\u4f5c\u4e8b\u52a1\u8981\u7b49\u5f85\u8fd9\u4e2a\u66f4\u65b0\u64cd\u4f5c\u4e8b\u52a1\u63d0\u4ea4\u540e\u624d\u80fd\u8bfb\u53d6\u6570\u636e\uff0c\u53ef\u4ee5\u89e3\u51b3\u810f\u8bfb\u95ee\u9898\u3002\u4f46\u5728\u8fd9\u4e2a\u4e8b\u4f8b\u4e2d\uff0c\u51fa\u73b0\u4e86\u4e00\u4e2a\u4e8b\u52a1\u8303\u56f4\u5185\u4e24\u4e2a\u76f8\u540c\u7684\u67e5\u8be2\u5374\u8fd4\u56de\u4e86\u4e0d\u540c\u6570\u636e\uff0c\u8fd9\u5c31\u662f\u4e0d\u53ef\u91cd\u590d\u8bfb\uff08\u4e24\u6b21\u6267\u884c\u4e00\u6837\u67e5\u8be2\uff0c\u5f97\u5230\u4e0d\u540c\u7684\u7ed3\u679c\uff09\u3002 \u90a3\u600e\u4e48\u89e3\u51b3\u53ef\u80fd\u7684\u4e0d\u53ef\u91cd\u590d\u8bfb\u95ee\u9898\uff1fRepeatable read \uff01 2.3 Repeatable read(\u91cd\u590d\u8bfb) \u00b6 \u91cd\u590d\u8bfb\uff0c\u5c31\u662f\u5728\u5f00\u59cb\u8bfb\u53d6\u6570\u636e\uff08\u4e8b\u52a1\u5f00\u542f\uff09\u65f6\uff0c\u4e0d\u518d\u5141\u8bb8\u4fee\u6539\u64cd\u4f5c\u3002Mysql\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u662fRepeatable read \u4e8b\u4f8b\uff1a\u7a0b\u5e8f\u5458\u62ff\u7740\u4fe1\u7528\u5361\u53bb\u4eab\u53d7\u751f\u6d3b\uff08\u5361\u91cc\u5f53\u7136\u662f\u53ea\u67093.6\u4e07\uff09\uff0c\u5f53\u4ed6\u57cb\u5355\u65f6\uff08\u4e8b\u52a1\u5f00\u542f\uff0c\u4e0d\u5141\u8bb8\u5176\u4ed6\u4e8b\u52a1\u7684UPDATE\u4fee\u6539\u64cd\u4f5c\uff09\uff0c\u6536\u8d39\u7cfb\u7edf\u4e8b\u5148\u68c0\u6d4b\u5230\u4ed6\u7684\u5361\u91cc\u67093.6\u4e07\u3002\u8fd9\u4e2a\u65f6\u5019\u4ed6\u7684\u59bb\u5b50\u4e0d\u80fd\u8f6c\u51fa\u91d1\u989d\u4e86\u3002\u63a5\u4e0b\u6765\u6536\u8d39\u7cfb\u7edf\u5c31\u53ef\u4ee5\u6263\u6b3e\u4e86\u3002 \u5206\u6790\uff1a\u91cd\u590d\u8bfb\u53ef\u4ee5\u89e3\u51b3\u4e0d\u53ef\u91cd\u590d\u8bfb\u95ee\u9898\u3002\u5199\u5230\u8fd9\u91cc\uff0c\u5e94\u8be5\u660e\u767d\u7684\u4e00\u70b9\u5c31\u662f\uff0c\u4e0d\u53ef\u91cd\u590d\u8bfb\u5bf9\u5e94\u7684\u662f\u4fee\u6539\uff0c\u5373UPDATE\u64cd\u4f5c\u3002\u4f46\u662f\u53ef\u80fd\u8fd8\u4f1a\u6709\u5e7b\u8bfb\u95ee\u9898\u3002\u56e0\u4e3a\u5e7b\u8bfb\u95ee\u9898\u5bf9\u5e94\u7684\u662f\u63d2\u5165INSERT\u64cd\u4f5c\uff0c\u800c\u4e0d\u662fUPDATE\u64cd\u4f5c\u3002 \u4ec0\u4e48\u65f6\u5019\u4f1a\u51fa\u73b0\u5e7b\u8bfb\uff1f \u4e8b\u4f8b\uff1a\u7a0b\u5e8f\u5458\u67d0\u4e00\u5929\u53bb\u6d88\u8d39\uff0c\u82b1\u4e862\u5343\u5143\uff0c\u7136\u540e\u4ed6\u7684\u59bb\u5b50\u53bb\u67e5\u770b\u4ed6\u4eca\u5929\u7684\u6d88\u8d39\u8bb0\u5f55\uff08\u5168\u8868\u626b\u63cfFTS\uff0c\u59bb\u5b50\u4e8b\u52a1\u5f00\u542f\uff09\uff0c\u770b\u5230\u786e\u5b9e\u662f\u82b1\u4e862\u5343\u5143\uff0c\u5c31\u5728\u8fd9\u4e2a\u65f6\u5019\uff0c\u7a0b\u5e8f\u5458\u82b1\u4e861\u4e07\u4e70\u4e86\u4e00\u90e8\u7535\u8111\uff0c\u5373\u65b0\u589eINSERT\u4e86\u4e00\u6761\u6d88\u8d39\u8bb0\u5f55\uff0c\u5e76\u63d0\u4ea4\u3002\u5f53\u59bb\u5b50\u6253\u5370\u7a0b\u5e8f\u5458\u7684\u6d88\u8d39\u8bb0\u5f55\u6e05\u5355\u65f6\uff08\u59bb\u5b50\u4e8b\u52a1\u63d0\u4ea4\uff09\uff0c\u53d1\u73b0\u82b1\u4e861.2\u4e07\u5143\uff0c\u4f3c\u4e4e\u51fa\u73b0\u4e86\u5e7b\u89c9\uff0c\u8fd9\u5c31\u662f\u5e7b\u8bfb\u3002 \u5e7b\u8bfb(phantom Read)\uff1a\u6307\u7684\u662f\u4e00\u4e2a\u4e8b\u52a1\u5728\u8bfb\u53d6\u67d0\u4e2a\u8303\u56f4\u5185\u7684\u8bb0\u5f55\u65f6\uff0c\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u53c8\u5728\u8be5\u8303\u56f4\u5185\u63d2\u5165\u4e86\u65b0\u7684\u8bb0\u5f55\uff0c\u5f53\u4e4b\u524d\u7684\u4e8b\u52a1\u518d\u6b21\u8bfb\u53d6\u8be5\u8303\u56f4\u7684\u8bb0\u5f55\u65f6\uff0c\u4f1a\u4ea7\u751f\u5e7b\u884c(phantom row)\uff0cInnoDB\u5b58\u50a8\u5f15\u64ce\u901a\u8fc7Next-Key Locking\u89e3\u51b3\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898 2.4 Serializable(\u5e8f\u5217\u5316) \u00b6 Serializable \u662f\u6700\u9ad8\u7684\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\uff0c\u5728\u8be5\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u4e32\u884c\u5316\u987a\u5e8f\u6267\u884c\uff0c\u53ef\u4ee5\u907f\u514d\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u4e0e\u5e7b\u8bfb\u3002\u4f46\u662f\u8fd9\u79cd\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u6548\u7387\u4f4e\u4e0b\uff0c\u6bd4\u8f83\u8017\u6570\u636e\u5e93\u6027\u80fd\uff0c\u4e00\u822c\u4e0d\u4f7f\u7528\u3002Serializable \u5728\u8bfb\u53d6\u7684\u6bcf\u4e00\u884c\u6570\u636e\u4e0a\u90fd\u52a0\u9501\uff0c\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff1a\u5927\u591a\u6570\u6570\u636e\u5e93\u9ed8\u8ba4\u7684\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662fRead committed\uff0c\u6bd4\u5982Sql Server , Oracle\u3002Mysql\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u662fRepeatable read","title":"10. \u4e8b\u52a1"},{"location":"mysql/mysql.affairs/#1","text":"\u4e8b\u52a1\uff08transaction\uff09\uff1a\u662f\u4e00\u7ec4\u539f\u5b50\u6027\u7684SQL\u67e5\u8be2\uff0c\u6216\u8005\u8bf4\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u5de5\u4f5c\u5355\u5143\u3002\u4e8b\u52a1\u5185\u7684\u8bed\u53e5\uff0c\u8981\u4e48\u5c31\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u5c31\u5168\u90fd\u4e0d\u6267\u884c\u3002","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.affairs/#12-atomicity","text":"\u539f\u5b50\u6027\u662f\u6307\u4e8b\u52a1\u5305\u542b\u7684\u6240\u6709\u64cd\u4f5c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u56de\u6eda\uff0c\u56e0\u6b64\u4e8b\u52a1\u7684\u64cd\u4f5c\u5982\u679c\u6210\u529f\u5c31\u5fc5\u987b\u8981\u5b8c\u5168\u5e94\u7528\u5230\u6570\u636e\u5e93\uff0c\u5982\u679c\u64cd\u4f5c\u5931\u8d25\u5219\u4e0d\u80fd\u5bf9\u6570\u636e\u5e93\u6709\u4efb\u4f55\u5f71\u54cd\u3002","title":"1.2. \u7279\u6027-\u539f\u5b50\u6027\uff08Atomicity\uff09"},{"location":"mysql/mysql.affairs/#13-consistency","text":"\u4e00\u81f4\u6027\u662f\u6307\u4e8b\u52a1\u5fc5\u987b\u4f7f\u6570\u636e\u5e93\u4ece\u4e00\u4e2a\u4e00\u81f4\u6027\u72b6\u6001\u53d8\u6362\u5230\u53e6\u4e00\u4e2a\u4e00\u81f4\u6027\u72b6\u6001\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u4e4b\u524d\u548c\u6267\u884c\u4e4b\u540e\u90fd\u5fc5\u987b\u5904\u4e8e\u4e00\u81f4\u6027\u72b6\u6001\u3002 \u62ff\u8f6c\u8d26\u6765\u8bf4\uff0c\u5047\u8bbe\u7528\u6237A\u548c\u7528\u6237B\u4e24\u8005\u7684\u94b1\u52a0\u8d77\u6765\u4e00\u5171\u662f5000\uff0c\u90a3\u4e48\u4e0d\u7ba1A\u548cB\u4e4b\u95f4\u5982\u4f55\u8f6c\u8d26\uff0c\u8f6c\u51e0\u6b21\u8d26\uff0c\u4e8b\u52a1\u7ed3\u675f\u540e\u4e24\u4e2a\u7528\u6237\u7684\u94b1\u76f8\u52a0\u8d77\u6765\u5e94\u8be5\u8fd8\u5f97\u662f5000\uff0c\u8fd9\u5c31\u662f\u4e8b\u52a1\u7684\u4e00\u81f4\u6027\u3002 \uff01","title":"1.3. \u7279\u6027-\u4e00\u81f4\u6027\uff08Consistency\uff09"},{"location":"mysql/mysql.affairs/#14-isolation","text":"\u9694\u79bb\u6027\u662f\u5f53\u591a\u4e2a\u7528\u6237\u5e76\u53d1\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0c\u6bd4\u5982\u64cd\u4f5c\u540c\u4e00\u5f20\u8868\u65f6\uff0c\u6570\u636e\u5e93\u4e3a\u6bcf\u4e00\u4e2a\u7528\u6237\u5f00\u542f\u7684\u4e8b\u52a1\uff0c\u4e0d\u80fd\u88ab\u5176\u4ed6\u4e8b\u52a1\u7684\u64cd\u4f5c\u6240\u5e72\u6270\uff0c\u591a\u4e2a\u5e76\u53d1\u4e8b\u52a1\u4e4b\u95f4\u8981\u76f8\u4e92\u9694\u79bb\u3002 \u5373\u8981\u8fbe\u5230\u8fd9\u4e48\u4e00\u79cd\u6548\u679c\uff1a\u5bf9\u4e8e\u4efb\u610f\u4e24\u4e2a\u5e76\u53d1\u7684\u4e8b\u52a1T1\u548cT2\uff0c\u5728\u4e8b\u52a1T1\u770b\u6765\uff0cT2\u8981\u4e48\u5728T1\u5f00\u59cb\u4e4b\u524d\u5c31\u5df2\u7ecf\u7ed3\u675f\uff0c\u8981\u4e48\u5728T1\u7ed3\u675f\u4e4b\u540e\u624d\u5f00\u59cb\uff0c\u8fd9\u6837\u6bcf\u4e2a\u4e8b\u52a1\u90fd\u611f\u89c9\u4e0d\u5230\u6709\u5176\u4ed6\u4e8b\u52a1\u5728\u5e76\u53d1\u5730\u6267\u884c\u3002 \u5173\u4e8e\u4e8b\u52a1\u7684\u9694\u79bb\u6027\u6570\u636e\u5e93\u63d0\u4f9b\u4e86\u591a\u79cd\u9694\u79bb\u7ea7\u522b\uff0c\u7a0d\u540e\u4f1a\u4ecb\u7ecd\u5230\uff01","title":"1.4. \u7279\u6027-\u9694\u79bb\u6027\uff08Isolation\uff09"},{"location":"mysql/mysql.affairs/#15-durability","text":"\u6301\u4e45\u6027\u662f\u6307\u4e00\u4e2a\u4e8b\u52a1\u4e00\u65e6\u88ab\u63d0\u4ea4\u4e86\uff0c\u90a3\u4e48\u5bf9\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u7684\u6539\u53d8\u5c31\u662f\u6c38\u4e45\u6027\u7684\uff0c\u5373\u4fbf\u662f\u5728\u6570\u636e\u5e93\u7cfb\u7edf\u9047\u5230\u6545\u969c\u7684\u60c5\u51b5\u4e0b\u4e5f\u4e0d\u4f1a\u4e22\u5931\u63d0\u4ea4\u4e8b\u52a1\u7684\u64cd\u4f5c\u3002 \u4f8b\u5982\u6211\u4eec\u5728\u4f7f\u7528JDBC\u64cd\u4f5c\u6570\u636e\u5e93\u65f6\uff0c\u5728\u63d0\u4ea4\u4e8b\u52a1\u65b9\u6cd5\u540e\uff0c\u63d0\u793a\u7528\u6237\u4e8b\u52a1\u64cd\u4f5c\u5b8c\u6210\uff0c\u5f53\u6211\u4eec\u7a0b\u5e8f\u6267\u884c\u5b8c\u6210\u76f4\u5230\u770b\u5230\u63d0\u793a\u540e\uff0c\u5c31\u53ef\u4ee5\u8ba4\u5b9a\u4e8b\u52a1\u4ee5\u53ca\u6b63\u786e\u63d0\u4ea4\uff0c\u5373\u4f7f\u8fd9\u65f6\u5019\u6570\u636e\u5e93\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u4e5f\u5fc5\u987b\u8981\u5c06\u6211\u4eec\u7684\u4e8b\u52a1\u5b8c\u5168\u6267\u884c\u5b8c\u6210\uff0c\u5426\u5219\u5c31\u4f1a\u9020\u6210\u6211\u4eec\u770b\u5230\u63d0\u793a\u4e8b\u52a1\u5904\u7406\u5b8c\u6bd5\uff0c\u4f46\u662f\u6570\u636e\u5e93\u56e0\u4e3a\u6545\u969c\u800c\u6ca1\u6709\u6267\u884c\u4e8b\u52a1\u7684\u91cd\u5927\u9519\u8bef\u3002 \u4ee5\u4e0a\u4ecb\u7ecd\u5b8c\u4e8b\u52a1\u7684\u56db\u5927\u7279\u6027(\u7b80\u79f0ACID)\uff0c\u73b0\u5728\u91cd\u70b9\u6765\u8bf4\u660e\u4e0b\u4e8b\u52a1\u7684\u9694\u79bb\u6027\uff0c\u5f53\u591a\u4e2a\u7ebf\u7a0b\u90fd\u5f00\u542f\u4e8b\u52a1\u64cd\u4f5c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u65f6\uff0c\u6570\u636e\u5e93\u7cfb\u7edf\u8981\u80fd\u8fdb\u884c\u9694\u79bb\u64cd\u4f5c\uff0c\u4ee5\u4fdd\u8bc1\u5404\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u6570\u636e\u7684\u51c6\u786e\u6027\uff0c\u5728\u4ecb\u7ecd\u6570\u636e\u5e93\u63d0\u4f9b\u7684\u5404\u79cd\u9694\u79bb\u7ea7\u522b\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u770b\u770b\u5982\u679c\u4e0d\u8003\u8651\u4e8b\u52a1\u7684\u9694\u79bb\u6027\uff0c\u4f1a\u53d1\u751f\u7684\u51e0\u79cd\u95ee\u9898\uff1a","title":"1.5. \u7279\u6027-\u6301\u4e45\u6027\uff08Durability\uff09"},{"location":"mysql/mysql.affairs/#2","text":"\u6570\u636e\u5e93\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u67094\u79cd\uff0c\u7531\u4f4e\u5230\u9ad8\u5206\u522b\u4e3aRead uncommitted \u3001Read committed \u3001Repeatable read \u3001Serializable \u3002\u800c\u4e14\uff0c\u5728\u4e8b\u52a1\u7684\u5e76\u53d1\u64cd\u4f5c\u4e2d\u53ef\u80fd\u4f1a\u51fa\u73b0\u810f\u8bfb\uff0c\u4e0d\u53ef\u91cd\u590d\u8bfb\uff0c\u5e7b\u8bfb\u3002\u4e0b\u9762\u901a\u8fc7\u4e8b\u4f8b\u4e00\u4e00\u9610\u8ff0\u5b83\u4eec\u7684\u6982\u5ff5\u4e0e\u8054\u7cfb\u3002","title":"2. \u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b"},{"location":"mysql/mysql.affairs/#21-read-uncommitted","text":"\u8bfb\u672a\u63d0\u4ea4\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u4e00\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u8bfb\u53d6\u53e6\u4e00\u4e2a\u672a\u63d0\u4ea4\u4e8b\u52a1\u7684\u6570\u636e\u3002 \u4e8b\u4f8b\uff1a\u8001\u677f\u8981\u7ed9\u7a0b\u5e8f\u5458\u53d1\u5de5\u8d44\uff0c\u7a0b\u5e8f\u5458\u7684\u5de5\u8d44\u662f3.6\u4e07/\u6708\u3002\u4f46\u662f\u53d1\u5de5\u8d44\u65f6\u8001\u677f\u4e0d\u5c0f\u5fc3\u6309\u9519\u4e86\u6570\u5b57\uff0c\u6309\u62103.9\u4e07/\u6708\uff0c\u8be5\u94b1\u5df2\u7ecf\u6253\u5230\u7a0b\u5e8f\u5458\u7684\u6237\u53e3\uff0c\u4f46\u662f\u4e8b\u52a1\u8fd8\u6ca1\u6709\u63d0\u4ea4\uff0c\u5c31\u5728\u8fd9\u65f6\uff0c\u7a0b\u5e8f\u5458\u53bb\u67e5\u770b\u81ea\u5df1\u8fd9\u4e2a\u6708\u7684\u5de5\u8d44\uff0c\u53d1\u73b0\u6bd4\u5f80\u5e38\u591a\u4e863\u5343\u5143\uff0c\u4ee5\u4e3a\u6da8\u5de5\u8d44\u4e86\u975e\u5e38\u9ad8\u5174\u3002\u4f46\u662f\u8001\u677f\u53ca\u65f6\u53d1\u73b0\u4e86\u4e0d\u5bf9\uff0c\u9a6c\u4e0a\u56de\u6eda\u5dee\u70b9\u5c31\u63d0\u4ea4\u4e86\u7684\u4e8b\u52a1\uff0c\u5c06\u6570\u5b57\u6539\u62103.6\u4e07\u518d\u63d0\u4ea4\u3002 \u5206\u6790\uff1a\u5b9e\u9645\u7a0b\u5e8f\u5458\u8fd9\u4e2a\u6708\u7684\u5de5\u8d44\u8fd8\u662f3.6\u4e07\uff0c\u4f46\u662f\u7a0b\u5e8f\u5458\u770b\u5230\u7684\u662f3.9\u4e07\u3002\u4ed6\u770b\u5230\u7684\u662f\u8001\u677f\u8fd8\u6ca1\u63d0\u4ea4\u4e8b\u52a1\u65f6\u7684\u6570\u636e\u3002\u8fd9\u5c31\u662f\u810f\u8bfb\u3002 \u810f\u8bfb(Dirty Read)\uff1a\u4e8b\u52a1\u53ef\u4ee5\u8bfb\u53d6\u672a\u63d0\u4ea4\u7684\u6570\u636e \u90a3\u600e\u4e48\u89e3\u51b3\u810f\u8bfb\u5462\uff1fRead committed\uff01\u8bfb\u63d0\u4ea4\uff0c\u80fd\u89e3\u51b3\u810f\u8bfb\u95ee\u9898\u3002","title":"2.1 Read uncommitted(\u672a\u63d0\u4ea4\u8bfb)"},{"location":"mysql/mysql.affairs/#22-read-committed","text":"\u8bfb\u63d0\u4ea4\uff0c\u987e\u540d\u601d\u4e49\uff0c\u4e5f\u53ebnonrepeatable read\uff08\u4e0d\u53ef\u91cd\u590d\u8bfb\uff09\u5c31\u662f\u4e00\u4e2a\u4e8b\u52a1\u8981\u7b49\u53e6\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u540e\u624d\u80fd\u8bfb\u53d6\u6570\u636e\u3002\u4e00\u4e2a\u4e8b\u52a1\u4ece\u5f00\u59cb\u5230\u63d0\u4ea4\u4e4b\u524d\uff0c\u6240\u505a\u7684\u4efb\u4f55\u4fee\u6539\u5bf9\u5176\u4ed6\u4e8b\u52a1\u90fd\u662f\u4e0d\u53ef\u89c1\u7684\u3002 \u4e8b\u4f8b\uff1a\u7a0b\u5e8f\u5458\u62ff\u7740\u4fe1\u7528\u5361\u53bb\u4eab\u53d7\u751f\u6d3b\uff08\u5361\u91cc\u5f53\u7136\u662f\u53ea\u67093.6\u4e07\uff09\uff0c\u5f53\u4ed6\u57cb\u5355\u65f6\uff08\u7a0b\u5e8f\u5458\u4e8b\u52a1\u5f00\u542f\uff09\uff0c\u6536\u8d39\u7cfb\u7edf\u4e8b\u5148\u68c0\u6d4b\u5230\u4ed6\u7684\u5361\u91cc\u67093.6\u4e07\uff0c\u5c31\u5728\u8fd9\u4e2a\u65f6\u5019\uff01\uff01\u7a0b\u5e8f\u5458\u7684\u59bb\u5b50\u8981\u628a\u94b1\u5168\u90e8\u8f6c\u51fa\u5145\u5f53\u5bb6\u7528\uff0c\u5e76\u63d0\u4ea4\u3002\u5f53\u6536\u8d39\u7cfb\u7edf\u51c6\u5907\u6263\u6b3e\u65f6\uff0c\u518d\u68c0\u6d4b\u5361\u91cc\u7684\u91d1\u989d\uff0c\u53d1\u73b0\u5df2\u7ecf\u6ca1\u94b1\u4e86\uff08\u7b2c\u4e8c\u6b21\u68c0\u6d4b\u91d1\u989d\u5f53\u7136\u8981\u7b49\u5f85\u59bb\u5b50\u8f6c\u51fa\u91d1\u989d\u4e8b\u52a1\u63d0\u4ea4\u5b8c\uff09\u3002\u7a0b\u5e8f\u5458\u5c31\u4f1a\u5f88\u90c1\u95f7\uff0c\u660e\u660e\u5361\u91cc\u662f\u6709\u94b1\u7684\u2026 \u5206\u6790\uff1a\u8fd9\u5c31\u662f\u8bfb\u63d0\u4ea4\uff0c\u82e5\u6709\u4e8b\u52a1\u5bf9\u6570\u636e\u8fdb\u884c\u66f4\u65b0\uff08UPDATE\uff09\u64cd\u4f5c\u65f6\uff0c\u8bfb\u64cd\u4f5c\u4e8b\u52a1\u8981\u7b49\u5f85\u8fd9\u4e2a\u66f4\u65b0\u64cd\u4f5c\u4e8b\u52a1\u63d0\u4ea4\u540e\u624d\u80fd\u8bfb\u53d6\u6570\u636e\uff0c\u53ef\u4ee5\u89e3\u51b3\u810f\u8bfb\u95ee\u9898\u3002\u4f46\u5728\u8fd9\u4e2a\u4e8b\u4f8b\u4e2d\uff0c\u51fa\u73b0\u4e86\u4e00\u4e2a\u4e8b\u52a1\u8303\u56f4\u5185\u4e24\u4e2a\u76f8\u540c\u7684\u67e5\u8be2\u5374\u8fd4\u56de\u4e86\u4e0d\u540c\u6570\u636e\uff0c\u8fd9\u5c31\u662f\u4e0d\u53ef\u91cd\u590d\u8bfb\uff08\u4e24\u6b21\u6267\u884c\u4e00\u6837\u67e5\u8be2\uff0c\u5f97\u5230\u4e0d\u540c\u7684\u7ed3\u679c\uff09\u3002 \u90a3\u600e\u4e48\u89e3\u51b3\u53ef\u80fd\u7684\u4e0d\u53ef\u91cd\u590d\u8bfb\u95ee\u9898\uff1fRepeatable read \uff01","title":"2.2 Read committed(\u63d0\u4ea4\u8bfb)"},{"location":"mysql/mysql.affairs/#23-repeatable-read","text":"\u91cd\u590d\u8bfb\uff0c\u5c31\u662f\u5728\u5f00\u59cb\u8bfb\u53d6\u6570\u636e\uff08\u4e8b\u52a1\u5f00\u542f\uff09\u65f6\uff0c\u4e0d\u518d\u5141\u8bb8\u4fee\u6539\u64cd\u4f5c\u3002Mysql\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u662fRepeatable read \u4e8b\u4f8b\uff1a\u7a0b\u5e8f\u5458\u62ff\u7740\u4fe1\u7528\u5361\u53bb\u4eab\u53d7\u751f\u6d3b\uff08\u5361\u91cc\u5f53\u7136\u662f\u53ea\u67093.6\u4e07\uff09\uff0c\u5f53\u4ed6\u57cb\u5355\u65f6\uff08\u4e8b\u52a1\u5f00\u542f\uff0c\u4e0d\u5141\u8bb8\u5176\u4ed6\u4e8b\u52a1\u7684UPDATE\u4fee\u6539\u64cd\u4f5c\uff09\uff0c\u6536\u8d39\u7cfb\u7edf\u4e8b\u5148\u68c0\u6d4b\u5230\u4ed6\u7684\u5361\u91cc\u67093.6\u4e07\u3002\u8fd9\u4e2a\u65f6\u5019\u4ed6\u7684\u59bb\u5b50\u4e0d\u80fd\u8f6c\u51fa\u91d1\u989d\u4e86\u3002\u63a5\u4e0b\u6765\u6536\u8d39\u7cfb\u7edf\u5c31\u53ef\u4ee5\u6263\u6b3e\u4e86\u3002 \u5206\u6790\uff1a\u91cd\u590d\u8bfb\u53ef\u4ee5\u89e3\u51b3\u4e0d\u53ef\u91cd\u590d\u8bfb\u95ee\u9898\u3002\u5199\u5230\u8fd9\u91cc\uff0c\u5e94\u8be5\u660e\u767d\u7684\u4e00\u70b9\u5c31\u662f\uff0c\u4e0d\u53ef\u91cd\u590d\u8bfb\u5bf9\u5e94\u7684\u662f\u4fee\u6539\uff0c\u5373UPDATE\u64cd\u4f5c\u3002\u4f46\u662f\u53ef\u80fd\u8fd8\u4f1a\u6709\u5e7b\u8bfb\u95ee\u9898\u3002\u56e0\u4e3a\u5e7b\u8bfb\u95ee\u9898\u5bf9\u5e94\u7684\u662f\u63d2\u5165INSERT\u64cd\u4f5c\uff0c\u800c\u4e0d\u662fUPDATE\u64cd\u4f5c\u3002 \u4ec0\u4e48\u65f6\u5019\u4f1a\u51fa\u73b0\u5e7b\u8bfb\uff1f \u4e8b\u4f8b\uff1a\u7a0b\u5e8f\u5458\u67d0\u4e00\u5929\u53bb\u6d88\u8d39\uff0c\u82b1\u4e862\u5343\u5143\uff0c\u7136\u540e\u4ed6\u7684\u59bb\u5b50\u53bb\u67e5\u770b\u4ed6\u4eca\u5929\u7684\u6d88\u8d39\u8bb0\u5f55\uff08\u5168\u8868\u626b\u63cfFTS\uff0c\u59bb\u5b50\u4e8b\u52a1\u5f00\u542f\uff09\uff0c\u770b\u5230\u786e\u5b9e\u662f\u82b1\u4e862\u5343\u5143\uff0c\u5c31\u5728\u8fd9\u4e2a\u65f6\u5019\uff0c\u7a0b\u5e8f\u5458\u82b1\u4e861\u4e07\u4e70\u4e86\u4e00\u90e8\u7535\u8111\uff0c\u5373\u65b0\u589eINSERT\u4e86\u4e00\u6761\u6d88\u8d39\u8bb0\u5f55\uff0c\u5e76\u63d0\u4ea4\u3002\u5f53\u59bb\u5b50\u6253\u5370\u7a0b\u5e8f\u5458\u7684\u6d88\u8d39\u8bb0\u5f55\u6e05\u5355\u65f6\uff08\u59bb\u5b50\u4e8b\u52a1\u63d0\u4ea4\uff09\uff0c\u53d1\u73b0\u82b1\u4e861.2\u4e07\u5143\uff0c\u4f3c\u4e4e\u51fa\u73b0\u4e86\u5e7b\u89c9\uff0c\u8fd9\u5c31\u662f\u5e7b\u8bfb\u3002 \u5e7b\u8bfb(phantom Read)\uff1a\u6307\u7684\u662f\u4e00\u4e2a\u4e8b\u52a1\u5728\u8bfb\u53d6\u67d0\u4e2a\u8303\u56f4\u5185\u7684\u8bb0\u5f55\u65f6\uff0c\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u53c8\u5728\u8be5\u8303\u56f4\u5185\u63d2\u5165\u4e86\u65b0\u7684\u8bb0\u5f55\uff0c\u5f53\u4e4b\u524d\u7684\u4e8b\u52a1\u518d\u6b21\u8bfb\u53d6\u8be5\u8303\u56f4\u7684\u8bb0\u5f55\u65f6\uff0c\u4f1a\u4ea7\u751f\u5e7b\u884c(phantom row)\uff0cInnoDB\u5b58\u50a8\u5f15\u64ce\u901a\u8fc7Next-Key Locking\u89e3\u51b3\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898","title":"2.3 Repeatable read(\u91cd\u590d\u8bfb)"},{"location":"mysql/mysql.affairs/#24-serializable","text":"Serializable \u662f\u6700\u9ad8\u7684\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\uff0c\u5728\u8be5\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u4e32\u884c\u5316\u987a\u5e8f\u6267\u884c\uff0c\u53ef\u4ee5\u907f\u514d\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u4e0e\u5e7b\u8bfb\u3002\u4f46\u662f\u8fd9\u79cd\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u6548\u7387\u4f4e\u4e0b\uff0c\u6bd4\u8f83\u8017\u6570\u636e\u5e93\u6027\u80fd\uff0c\u4e00\u822c\u4e0d\u4f7f\u7528\u3002Serializable \u5728\u8bfb\u53d6\u7684\u6bcf\u4e00\u884c\u6570\u636e\u4e0a\u90fd\u52a0\u9501\uff0c\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff1a\u5927\u591a\u6570\u6570\u636e\u5e93\u9ed8\u8ba4\u7684\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662fRead committed\uff0c\u6bd4\u5982Sql Server , Oracle\u3002Mysql\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u662fRepeatable read","title":"2.4 Serializable(\u5e8f\u5217\u5316)"},{"location":"mysql/mysql.alias/","text":"MySQL ALIAS 1. \u4ecb\u7ecd \u00b6 1.1 \u73af\u5883\u51c6\u5907 \u00b6 drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); insert into info(name,age,score) values(\"\u674e\u56db\",20,55); insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.03 sec) mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.05 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) 2. \u5f00\u59cb \u00b6 \u901a\u8fc7\u4f7f\u7528 SQL\uff0c\u53ef\u4ee5\u4e3a\u5217\u540d\u79f0\u548c\u8868\u540d\u79f0\u6307\u5b9a\u522b\u540d\uff08Alias\uff09\u3002 2.1 \u8868alias \u00b6 SELECT column_name(s) FROM table_name AS alias_name \u64cd\u4f5c mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> select name from info as alias_name; +--------+ | name | +--------+ | \u5f20\u4e09 | | \u5f20\u4e09 | | \u674e\u56db | | \u738b\u4e94 | | \u8d75\u516d | +--------+ 5 rows in set (0.00 sec) 2.2 \u5217alias \u00b6 SELECT column_name AS alias_name FROM table_name \u64cd\u4f5c\uff0c\u67e5\u770b\u4ee5\u4e0b\u547d\u4ee4\u7684\u533a\u522b mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> select name from info; +--------+ | name | +--------+ | \u5f20\u4e09 | | \u5f20\u4e09 | | \u674e\u56db | | \u738b\u4e94 | | \u8d75\u516d | +--------+ 5 rows in set (0.00 sec) mysql> select name as \"\u59d3\u540d\" from info; +--------+ | \u59d3\u540d | +--------+ | \u5f20\u4e09 | | \u5f20\u4e09 | | \u674e\u56db | | \u738b\u4e94 | | \u8d75\u516d | +--------+ 5 rows in set (0.00 sec) \u4ee5\u4e0a\u6211\u4eec\u770b\u51fa\uff0cas\u5c31\u662f\u8d77\u522b\u540d\uff0c\u82e5\u662f\u6ca1\u6709as\u5c31\u4f1a\u76f4\u63a5\u663e\u793a\u4e4b\u524d\u7684\u5b57\u6bb5\uff0c\u4f7f\u7528\u4e86as\u4e4b\u540e\uff0c\u5c31\u4f1a\u663e\u793aas\u4e4b\u540e\u8d77\u7684\u522b\u540d\u4e5f\u5c31\u662f\u4e0a\u9762\u7684\u59d3\u540d\u3002","title":"19. SQL ALIAS"},{"location":"mysql/mysql.alias/#1","text":"","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.alias/#11","text":"drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); insert into info(name,age,score) values(\"\u674e\u56db\",20,55); insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.03 sec) mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.05 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec)","title":"1.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.alias/#2","text":"\u901a\u8fc7\u4f7f\u7528 SQL\uff0c\u53ef\u4ee5\u4e3a\u5217\u540d\u79f0\u548c\u8868\u540d\u79f0\u6307\u5b9a\u522b\u540d\uff08Alias\uff09\u3002","title":"2. \u5f00\u59cb"},{"location":"mysql/mysql.alias/#21-alias","text":"SELECT column_name(s) FROM table_name AS alias_name \u64cd\u4f5c mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> select name from info as alias_name; +--------+ | name | +--------+ | \u5f20\u4e09 | | \u5f20\u4e09 | | \u674e\u56db | | \u738b\u4e94 | | \u8d75\u516d | +--------+ 5 rows in set (0.00 sec)","title":"2.1 \u8868alias"},{"location":"mysql/mysql.alias/#22-alias","text":"SELECT column_name AS alias_name FROM table_name \u64cd\u4f5c\uff0c\u67e5\u770b\u4ee5\u4e0b\u547d\u4ee4\u7684\u533a\u522b mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> select name from info; +--------+ | name | +--------+ | \u5f20\u4e09 | | \u5f20\u4e09 | | \u674e\u56db | | \u738b\u4e94 | | \u8d75\u516d | +--------+ 5 rows in set (0.00 sec) mysql> select name as \"\u59d3\u540d\" from info; +--------+ | \u59d3\u540d | +--------+ | \u5f20\u4e09 | | \u5f20\u4e09 | | \u674e\u56db | | \u738b\u4e94 | | \u8d75\u516d | +--------+ 5 rows in set (0.00 sec) \u4ee5\u4e0a\u6211\u4eec\u770b\u51fa\uff0cas\u5c31\u662f\u8d77\u522b\u540d\uff0c\u82e5\u662f\u6ca1\u6709as\u5c31\u4f1a\u76f4\u63a5\u663e\u793a\u4e4b\u524d\u7684\u5b57\u6bb5\uff0c\u4f7f\u7528\u4e86as\u4e4b\u540e\uff0c\u5c31\u4f1a\u663e\u793aas\u4e4b\u540e\u8d77\u7684\u522b\u540d\u4e5f\u5c31\u662f\u4e0a\u9762\u7684\u59d3\u540d\u3002","title":"2.2 \u5217alias"},{"location":"mysql/mysql.alter/","text":"MySQL ALTER 1. \u4ecb\u7ecd \u00b6 \u5f53\u6211\u4eec\u9700\u8981\u4fee\u6539\u6570\u636e\u8868\u540d\u6216\u8005\u4fee\u6539\u6570\u636e\u8868\u5b57\u6bb5\u65f6\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u5230MySQL ALTER\u547d\u4ee4\u3002 1. \u4fee\u6539\u8868\u540d ALTER TABLE \u8868\u540d RENAME \u65b0\u8868\u540d; 2. \u589e\u52a0\u5b57\u6bb5 ALTER TABLE \u8868\u540d ADD \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026], ADD \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026]; ALTER TABLE \u8868\u540d ADD \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026] FIRST; ALTER TABLE \u8868\u540d ADD \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026] AFTER \u5b57\u6bb5\u540d; 3. \u5220\u9664\u5b57\u6bb5 ALTER TABLE \u8868\u540d DROP \u5b57\u6bb5\u540d; 4. \u4fee\u6539\u5b57\u6bb5 ALTER TABLE \u8868\u540d MODIFY \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026]; ALTER TABLE \u8868\u540d CHANGE \u65e7\u5b57\u6bb5\u540d \u65b0\u5b57\u6bb5\u540d \u65e7\u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026]; ALTER TABLE \u8868\u540d CHANGE \u65e7\u5b57\u6bb5\u540d \u65b0\u5b57\u6bb5\u540d \u65b0\u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026]; 2. \u73af\u5883\u51c6\u5907 \u00b6 \u5feb\u901f\u547d\u4ee4 create database db1 charset utf8; use db1; create table t1( id int, name varchar(50), sex enum('male','female'), age int(3)); desc t1; insert into t1 values(1,\"\u5c0f\u660e\",\"male\",18),(2,\"\u5c0f\u7ea2\",'female',20),(3,\"\u5c0f\u5f3a\",\"male\",30),(4,\"\u5f20\u4e09\",\"female\",28); select * from t1; show create table t1\\G; \u6267\u884c\u8fc7\u7a0b root@leco:/home/leco# mysql -uroot -proot mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 67 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> create database db1 charset utf8; ERROR 1007 (HY000): Can't create database 'db1'; database exists mysql> use db1; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> create table t1( id int, name varchar(50), sex enum('male','female'), age int(3)); ERROR 1050 (42S01): Table 't1' already exists mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> insert into t1 values(1,\"\u5c0f\u660e\",\"male\",18),(2,\"\u5c0f\u7ea2\",'female',20),(3,\"\u5c0f\u5f3a\",\"male\",30),(4,\"\u5f20\u4e09\",\"female\",28); Query OK, 4 rows affected (0.01 sec) Records: 4 Duplicates: 0 Warnings: 0 mysql> select * from t1; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5c0f\u660e | male | 18 | | 2 | \u5c0f\u7ea2 | female | 20 | | 3 | \u5c0f\u5f3a | male | 30 | | 4 | \u5f20\u4e09 | female | 28 | +------+--------+--------+------+ 4 rows in set (0.00 sec) mysql> show create table t1\\G; *************************** 1. row *************************** Table: t1 Create Table: CREATE TABLE `t1` ( `id` int(11) DEFAULT NULL, `name` varchar(50) DEFAULT NULL, `sex` enum('male','female') DEFAULT NULL, `age` int(3) DEFAULT NULL ) ENGINE=InnoDB DEFAULT CHARSET=utf8 1 row in set (0.00 sec) ERROR: No query specified 3. \u7528\u6cd5 \u00b6 3.1 \u4fee\u6539\u8868\u540d \u00b6 \u8bed\u6cd5 \u4fee\u6539\u8868\u540d ALTER TABLE \u8868\u540d RENAME \u65b0\u8868\u540d; \u64cd\u4f5c mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | t1 | +---------------+ 1 row in set (0.00 sec) mysql> alter table t1 rename info; Query OK, 0 rows affected (0.04 sec) mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | info | +---------------+ 1 row in set (0.00 sec) 3.2 \u589e\u52a0\u5b57\u6bb5 \u00b6 \u8bed\u6cd5 ALTER TABLE \u8868\u540d ADD \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026], ALTER TABLE \u8868\u540d ADD \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026] FIRST; ALTER TABLE \u8868\u540d ADD \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026] AFTER\u5b57\u6bb5\u540d; \u64cd\u4f5c mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | info | +---------------+ 1 row in set (0.00 sec) mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> alter table info add hobby varchar(50); Query OK, 0 rows affected (0.15 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.00 sec) mysql> alter table info add addr varchar(50) first; Query OK, 0 rows affected (0.15 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | addr | varchar(50) | YES | | NULL | | | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 6 rows in set (0.00 sec) mysql> alter table info add job varchar(50) after age; Query OK, 0 rows affected (0.16 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | addr | varchar(50) | YES | | NULL | | | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 7 rows in set (0.00 sec) \u6ce8\u89e3 1. \u9ed8\u8ba4\u6dfb\u52a0\u7684\u5b57\u6bb5\u90fd\u662f\u63d2\u5165\u5230\u6700\u540e 2. \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 after \uff0c\u6307\u5b9a\u8981\u63d2\u5165\u7684\u5b57\u6bb5\u5728\u4ec0\u4e48\u4f4d\u7f6e 3. frst\u662f\u63d2\u5165\u5230\u7b2c\u4e00\u4e2a\u4f4d\u7f6e 3.3 \u5220\u9664\u5b57\u6bb5 \u00b6 \u8bed\u6cd5 ALTER TABLE \u8868\u540d DROP \u5b57\u6bb5\u540d; \u64cd\u4f5c mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | addr | varchar(50) | YES | | NULL | | | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 7 rows in set (0.00 sec) mysql> alter table info drop addr; Query OK, 0 rows affected (0.16 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 6 rows in set (0.00 sec) \u6ce8\u610f \u8c28\u614e\u5220\u9664\u5b57\u6bb5\uff0c\u56e0\u4e3a\u5220\u9664\u5b57\u6bb5\u540e\u3002\u8868\u4e2d\u5bf9\u5e94\u7684\u6570\u636e\u4e5f\u4f1a\u88ab\u5220\u9664\uff0c\u8bf7\u770b\u4ee5\u4e0b\u64cd\u4f5c\u3002 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 6 rows in set (0.00 sec) mysql> select * from info; +------+--------+--------+------+------+-------+ | id | name | sex | age | job | hobby | +------+--------+--------+------+------+-------+ | 1 | \u5c0f\u660e | male | 18 | NULL | NULL | | 2 | \u5c0f\u7ea2 | female | 20 | NULL | NULL | | 3 | \u5c0f\u5f3a | male | 30 | NULL | NULL | | 4 | \u5f20\u4e09 | female | 28 | NULL | NULL | +------+--------+--------+------+------+-------+ 4 rows in set (0.00 sec) mysql> alter table info drop age; Query OK, 0 rows affected (0.15 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.00 sec) mysql> select * from info; +------+--------+--------+------+-------+ | id | name | sex | job | hobby | +------+--------+--------+------+-------+ | 1 | \u5c0f\u660e | male | NULL | NULL | | 2 | \u5c0f\u7ea2 | female | NULL | NULL | | 3 | \u5c0f\u5f3a | male | NULL | NULL | | 4 | \u5f20\u4e09 | female | NULL | NULL | +------+--------+--------+------+-------+ 4 rows in set (0.00 sec) 3.4 \u4fee\u6539\u5b57\u6bb5 \u00b6 \u8bed\u6cd5 ALTER TABLE \u8868\u540d MODIFY \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026]; ALTER TABLE \u8868\u540d CHANGE \u65e7\u5b57\u6bb5\u540d \u65b0\u5b57\u6bb5\u540d \u65e7\u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026]; ALTER TABLE \u8868\u540d CHANGE \u65e7\u5b57\u6bb5\u540d \u65b0\u5b57\u6bb5\u540d \u65b0\u6570\u636e\u7c7b\u578b[\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026]; \u64cd\u4f5c mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ mysql> alter table info modify id int not null; Query OK, 0 rows affected (0.16 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.00 sec) --------------------------------------------------------------- mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.00 sec) mysql> alter table info change id my_id int not null; Query OK, 0 rows affected (0.03 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | my_id | int(11) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.00 sec) --------------------------------------------------------------- mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | my_id | int(11) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.01 sec) mysql> alter table info change my_id my_id bigint not null; Query OK, 8 rows affected (0.17 sec) Records: 8 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | my_id | bigint(20) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.00 sec) mysql> alter table info change my_id id int not null; Query OK, 8 rows affected (0.17 sec) Records: 8 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.00 sec) 4. \u5176\u4ed6\u7528\u6cd5 \u00b6 4.1 \u589e\u52a0\u4e3b\u952e \u00b6 \u5148\u6062\u590d\u8868\u7ed3\u6784[\u5220\u9664\u91cd\u65b0\u5efa] mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> alter table t1 modify id int(11) not null primary key auto_increment; Query OK, 4 rows affected (0.17 sec) Records: 4 Duplicates: 0 Warnings: 0 mysql> desc info; ERROR 1146 (42S02): Table 'db1.info' doesn't exist mysql> desc t1; +-------+-----------------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+----------------+ 4 rows in set (0.00 sec) \u6216\u8005 mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> alter table t1 add primary key(id); # \u63a8\u8350\u5199\u6cd5 Query OK, 0 rows affected (0.16 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) 4.2 \u5220\u9664\u4e3b\u952e \u00b6 \u5148\u6062\u590d\u8868\u7ed3\u6784[\u5220\u9664\u91cd\u65b0\u5efa] mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> alter table t1 drop primary key; Query OK, 4 rows affected (0.17 sec) Records: 4 Duplicates: 0 Warnings: 0 mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) 4.3 \u589e\u52a0\u590d\u5408\u4e3b\u952e \u00b6 mysql> alter table t1 drop primary key; Query OK, 4 rows affected (0.17 sec) Records: 4 Duplicates: 0 Warnings: 0 mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> alter table t1 add primary key(id,name); Query OK, 0 rows affected (0.15 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | varchar(50) | NO | PRI | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) 4.4 \u5220\u9664\u590d\u5408\u4e3b\u952e \u00b6 \u548c\u5220\u9664\u5355\u4e00\u4e3b\u952e\u4e00\u6837 mysql> alter table t1 drop primary key; Query OK, 4 rows affected (0.17 sec) Records: 4 Duplicates: 0 Warnings: 0 mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | | name | varchar(50) | NO | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec)","title":"21. SQL ALTER"},{"location":"mysql/mysql.alter/#1","text":"\u5f53\u6211\u4eec\u9700\u8981\u4fee\u6539\u6570\u636e\u8868\u540d\u6216\u8005\u4fee\u6539\u6570\u636e\u8868\u5b57\u6bb5\u65f6\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u5230MySQL ALTER\u547d\u4ee4\u3002 1. \u4fee\u6539\u8868\u540d ALTER TABLE \u8868\u540d RENAME \u65b0\u8868\u540d; 2. \u589e\u52a0\u5b57\u6bb5 ALTER TABLE \u8868\u540d ADD \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026], ADD \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026]; ALTER TABLE \u8868\u540d ADD \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026] FIRST; ALTER TABLE \u8868\u540d ADD \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026] AFTER \u5b57\u6bb5\u540d; 3. \u5220\u9664\u5b57\u6bb5 ALTER TABLE \u8868\u540d DROP \u5b57\u6bb5\u540d; 4. \u4fee\u6539\u5b57\u6bb5 ALTER TABLE \u8868\u540d MODIFY \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026]; ALTER TABLE \u8868\u540d CHANGE \u65e7\u5b57\u6bb5\u540d \u65b0\u5b57\u6bb5\u540d \u65e7\u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026]; ALTER TABLE \u8868\u540d CHANGE \u65e7\u5b57\u6bb5\u540d \u65b0\u5b57\u6bb5\u540d \u65b0\u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026];","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.alter/#2","text":"\u5feb\u901f\u547d\u4ee4 create database db1 charset utf8; use db1; create table t1( id int, name varchar(50), sex enum('male','female'), age int(3)); desc t1; insert into t1 values(1,\"\u5c0f\u660e\",\"male\",18),(2,\"\u5c0f\u7ea2\",'female',20),(3,\"\u5c0f\u5f3a\",\"male\",30),(4,\"\u5f20\u4e09\",\"female\",28); select * from t1; show create table t1\\G; \u6267\u884c\u8fc7\u7a0b root@leco:/home/leco# mysql -uroot -proot mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 67 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> create database db1 charset utf8; ERROR 1007 (HY000): Can't create database 'db1'; database exists mysql> use db1; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> create table t1( id int, name varchar(50), sex enum('male','female'), age int(3)); ERROR 1050 (42S01): Table 't1' already exists mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> insert into t1 values(1,\"\u5c0f\u660e\",\"male\",18),(2,\"\u5c0f\u7ea2\",'female',20),(3,\"\u5c0f\u5f3a\",\"male\",30),(4,\"\u5f20\u4e09\",\"female\",28); Query OK, 4 rows affected (0.01 sec) Records: 4 Duplicates: 0 Warnings: 0 mysql> select * from t1; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5c0f\u660e | male | 18 | | 2 | \u5c0f\u7ea2 | female | 20 | | 3 | \u5c0f\u5f3a | male | 30 | | 4 | \u5f20\u4e09 | female | 28 | +------+--------+--------+------+ 4 rows in set (0.00 sec) mysql> show create table t1\\G; *************************** 1. row *************************** Table: t1 Create Table: CREATE TABLE `t1` ( `id` int(11) DEFAULT NULL, `name` varchar(50) DEFAULT NULL, `sex` enum('male','female') DEFAULT NULL, `age` int(3) DEFAULT NULL ) ENGINE=InnoDB DEFAULT CHARSET=utf8 1 row in set (0.00 sec) ERROR: No query specified","title":"2. \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.alter/#3","text":"","title":"3. \u7528\u6cd5"},{"location":"mysql/mysql.alter/#31","text":"\u8bed\u6cd5 \u4fee\u6539\u8868\u540d ALTER TABLE \u8868\u540d RENAME \u65b0\u8868\u540d; \u64cd\u4f5c mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | t1 | +---------------+ 1 row in set (0.00 sec) mysql> alter table t1 rename info; Query OK, 0 rows affected (0.04 sec) mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | info | +---------------+ 1 row in set (0.00 sec)","title":"3.1 \u4fee\u6539\u8868\u540d"},{"location":"mysql/mysql.alter/#32","text":"\u8bed\u6cd5 ALTER TABLE \u8868\u540d ADD \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026], ALTER TABLE \u8868\u540d ADD \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026] FIRST; ALTER TABLE \u8868\u540d ADD \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026] AFTER\u5b57\u6bb5\u540d; \u64cd\u4f5c mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | info | +---------------+ 1 row in set (0.00 sec) mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> alter table info add hobby varchar(50); Query OK, 0 rows affected (0.15 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.00 sec) mysql> alter table info add addr varchar(50) first; Query OK, 0 rows affected (0.15 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | addr | varchar(50) | YES | | NULL | | | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 6 rows in set (0.00 sec) mysql> alter table info add job varchar(50) after age; Query OK, 0 rows affected (0.16 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | addr | varchar(50) | YES | | NULL | | | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 7 rows in set (0.00 sec) \u6ce8\u89e3 1. \u9ed8\u8ba4\u6dfb\u52a0\u7684\u5b57\u6bb5\u90fd\u662f\u63d2\u5165\u5230\u6700\u540e 2. \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 after \uff0c\u6307\u5b9a\u8981\u63d2\u5165\u7684\u5b57\u6bb5\u5728\u4ec0\u4e48\u4f4d\u7f6e 3. frst\u662f\u63d2\u5165\u5230\u7b2c\u4e00\u4e2a\u4f4d\u7f6e","title":"3.2 \u589e\u52a0\u5b57\u6bb5"},{"location":"mysql/mysql.alter/#33","text":"\u8bed\u6cd5 ALTER TABLE \u8868\u540d DROP \u5b57\u6bb5\u540d; \u64cd\u4f5c mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | addr | varchar(50) | YES | | NULL | | | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 7 rows in set (0.00 sec) mysql> alter table info drop addr; Query OK, 0 rows affected (0.16 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 6 rows in set (0.00 sec) \u6ce8\u610f \u8c28\u614e\u5220\u9664\u5b57\u6bb5\uff0c\u56e0\u4e3a\u5220\u9664\u5b57\u6bb5\u540e\u3002\u8868\u4e2d\u5bf9\u5e94\u7684\u6570\u636e\u4e5f\u4f1a\u88ab\u5220\u9664\uff0c\u8bf7\u770b\u4ee5\u4e0b\u64cd\u4f5c\u3002 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 6 rows in set (0.00 sec) mysql> select * from info; +------+--------+--------+------+------+-------+ | id | name | sex | age | job | hobby | +------+--------+--------+------+------+-------+ | 1 | \u5c0f\u660e | male | 18 | NULL | NULL | | 2 | \u5c0f\u7ea2 | female | 20 | NULL | NULL | | 3 | \u5c0f\u5f3a | male | 30 | NULL | NULL | | 4 | \u5f20\u4e09 | female | 28 | NULL | NULL | +------+--------+--------+------+------+-------+ 4 rows in set (0.00 sec) mysql> alter table info drop age; Query OK, 0 rows affected (0.15 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.00 sec) mysql> select * from info; +------+--------+--------+------+-------+ | id | name | sex | job | hobby | +------+--------+--------+------+-------+ | 1 | \u5c0f\u660e | male | NULL | NULL | | 2 | \u5c0f\u7ea2 | female | NULL | NULL | | 3 | \u5c0f\u5f3a | male | NULL | NULL | | 4 | \u5f20\u4e09 | female | NULL | NULL | +------+--------+--------+------+-------+ 4 rows in set (0.00 sec)","title":"3.3 \u5220\u9664\u5b57\u6bb5"},{"location":"mysql/mysql.alter/#34","text":"\u8bed\u6cd5 ALTER TABLE \u8868\u540d MODIFY \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026]; ALTER TABLE \u8868\u540d CHANGE \u65e7\u5b57\u6bb5\u540d \u65b0\u5b57\u6bb5\u540d \u65e7\u6570\u636e\u7c7b\u578b [\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026]; ALTER TABLE \u8868\u540d CHANGE \u65e7\u5b57\u6bb5\u540d \u65b0\u5b57\u6bb5\u540d \u65b0\u6570\u636e\u7c7b\u578b[\u5b8c\u6574\u6027\u7ea6\u675f\u6761\u4ef6\u2026]; \u64cd\u4f5c mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ mysql> alter table info modify id int not null; Query OK, 0 rows affected (0.16 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.00 sec) --------------------------------------------------------------- mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.00 sec) mysql> alter table info change id my_id int not null; Query OK, 0 rows affected (0.03 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | my_id | int(11) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.00 sec) --------------------------------------------------------------- mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | my_id | int(11) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.01 sec) mysql> alter table info change my_id my_id bigint not null; Query OK, 8 rows affected (0.17 sec) Records: 8 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | my_id | bigint(20) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.00 sec) mysql> alter table info change my_id id int not null; Query OK, 8 rows affected (0.17 sec) Records: 8 Duplicates: 0 Warnings: 0 mysql> desc info; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | job | varchar(50) | YES | | NULL | | | hobby | varchar(50) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 5 rows in set (0.00 sec)","title":"3.4 \u4fee\u6539\u5b57\u6bb5"},{"location":"mysql/mysql.alter/#4","text":"","title":"4. \u5176\u4ed6\u7528\u6cd5"},{"location":"mysql/mysql.alter/#41","text":"\u5148\u6062\u590d\u8868\u7ed3\u6784[\u5220\u9664\u91cd\u65b0\u5efa] mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> alter table t1 modify id int(11) not null primary key auto_increment; Query OK, 4 rows affected (0.17 sec) Records: 4 Duplicates: 0 Warnings: 0 mysql> desc info; ERROR 1146 (42S02): Table 'db1.info' doesn't exist mysql> desc t1; +-------+-----------------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+----------------+ 4 rows in set (0.00 sec) \u6216\u8005 mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> alter table t1 add primary key(id); # \u63a8\u8350\u5199\u6cd5 Query OK, 0 rows affected (0.16 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec)","title":"4.1 \u589e\u52a0\u4e3b\u952e"},{"location":"mysql/mysql.alter/#42","text":"\u5148\u6062\u590d\u8868\u7ed3\u6784[\u5220\u9664\u91cd\u65b0\u5efa] mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> alter table t1 drop primary key; Query OK, 4 rows affected (0.17 sec) Records: 4 Duplicates: 0 Warnings: 0 mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec)","title":"4.2 \u5220\u9664\u4e3b\u952e"},{"location":"mysql/mysql.alter/#43","text":"mysql> alter table t1 drop primary key; Query OK, 4 rows affected (0.17 sec) Records: 4 Duplicates: 0 Warnings: 0 mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> alter table t1 add primary key(id,name); Query OK, 0 rows affected (0.15 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | varchar(50) | NO | PRI | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec)","title":"4.3 \u589e\u52a0\u590d\u5408\u4e3b\u952e"},{"location":"mysql/mysql.alter/#44","text":"\u548c\u5220\u9664\u5355\u4e00\u4e3b\u952e\u4e00\u6837 mysql> alter table t1 drop primary key; Query OK, 4 rows affected (0.17 sec) Records: 4 Duplicates: 0 Warnings: 0 mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | | name | varchar(50) | NO | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec)","title":"4.4 \u5220\u9664\u590d\u5408\u4e3b\u952e"},{"location":"mysql/mysql.and_or/","text":"MySQL AND_OR 1. \u4ecb\u7ecd \u00b6 1.1 \u73af\u5883\u51c6\u5907 \u00b6 truncate leco; insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); insert into leco(id,name,sex,age) values(4,\"\u5f20\u4e09\",\"male\",40); insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); \u64cd\u4f5c\u8fc7\u7a0b mysql> truncate leco; Query OK, 0 rows affected (0.04 sec) mysql> insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.00 sec) mysql> insert into leco(id,name,sex,age) values(4,\"\u5f20\u4e09\",\"male\",40); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); Query OK, 1 row affected (0.02 sec) mysql> insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); Query OK, 1 row affected (0.01 sec) mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 5 rows in set (0.00 sec) 1.2 \u5f00\u59cb \u00b6 AND \u548c OR \u8fd0\u7b97\u7b26\u7528\u4e8e\u57fa\u4e8e\u4e00\u4e2a\u4ee5\u4e0a\u7684\u6761\u4ef6\u5bf9\u8bb0\u5f55\u8fdb\u884c\u8fc7\u6ee4\u3002 AND \u548c OR \u8fd0\u7b97\u7b26 AND \u548c OR \u53ef\u5728 WHERE \u5b50\u8bed\u53e5\u4e2d\u628a\u4e24\u4e2a\u6216\u591a\u4e2a\u6761\u4ef6\u7ed3\u5408\u8d77\u6765\u3002 \u5982\u679c\u7b2c\u4e00\u4e2a\u6761\u4ef6\u548c\u7b2c\u4e8c\u4e2a\u6761\u4ef6\u90fd\u6210\u7acb\uff0c\u5219 AND \u8fd0\u7b97\u7b26\u663e\u793a\u4e00\u6761\u8bb0\u5f55\u3002 \u5982\u679c\u7b2c\u4e00\u4e2a\u6761\u4ef6\u548c\u7b2c\u4e8c\u4e2a\u6761\u4ef6\u4e2d\u53ea\u8981\u6709\u4e00\u4e2a\u6210\u7acb\uff0c\u5219 OR \u8fd0\u7b97\u7b26\u663e\u793a\u4e00\u6761\u8bb0\u5f55\u3002 2. \u7528\u6cd5 \u00b6 \u4ee5\u4e0b\u6211\u4eec\u5c06\u5728 SQL AND_OR \u547d\u4ee4\u4e2d\u4f7f\u7528 \u4eceMySQL\u6570\u636e\u8868 leco \u4e2d\u8bfb\u53d6\u6570\u636e\u3002 2.1 AND \u00b6 \u5728leco\u8868\u4e2d\u627e\u51faname\u662f\u5f20\u4e09\u4e14sex\u662fmale\u7684\u4fe1\u606f mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 5 rows in set (0.00 sec) mysql> select * from leco where name = \"\u5f20\u4e09\" and sex = 'male'; +------+--------+------+------+ | id | name | sex | age | +------+--------+------+------+ | 4 | \u5f20\u4e09 | male | 40 | +------+--------+------+------+ 1 row in set (0.00 sec) 2.2 OR \u00b6 \u5728leco\u8868\u4e2d\u627e\u51faname\u662f\u5f20\u4e09\u6216\u8005name\u662f\u674e\u56db\u7684\u4eba\u4fe1\u606f mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 5 rows in set (0.00 sec) mysql> select * from leco where name = \"\u5f20\u4e09\" or name= '\u674e\u56db'; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | +------+--------+--------+------+ 3 rows in set (0.00 sec) 2.3 \u7ed3\u5408 AND \u548c OR \u8fd0\u7b97\u7b26 \u00b6 \u627e\u51fa\u5e74\u9f84\u662f18\u5c81\u6216\u800520\u5c81\uff0c\u4e14sex\u662ffemale\u7684\u4eba\u5458\u4fe1\u606f mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 5 rows in set (0.00 sec) mysql> select * from leco where (age=18 or age=20) and sex='female'; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | +------+--------+--------+------+ 1 row in set (0.01 sec)","title":"13. SQL AND_OR"},{"location":"mysql/mysql.and_or/#1","text":"","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.and_or/#11","text":"truncate leco; insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); insert into leco(id,name,sex,age) values(4,\"\u5f20\u4e09\",\"male\",40); insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); \u64cd\u4f5c\u8fc7\u7a0b mysql> truncate leco; Query OK, 0 rows affected (0.04 sec) mysql> insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.00 sec) mysql> insert into leco(id,name,sex,age) values(4,\"\u5f20\u4e09\",\"male\",40); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); Query OK, 1 row affected (0.02 sec) mysql> insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); Query OK, 1 row affected (0.01 sec) mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 5 rows in set (0.00 sec)","title":"1.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.and_or/#12","text":"AND \u548c OR \u8fd0\u7b97\u7b26\u7528\u4e8e\u57fa\u4e8e\u4e00\u4e2a\u4ee5\u4e0a\u7684\u6761\u4ef6\u5bf9\u8bb0\u5f55\u8fdb\u884c\u8fc7\u6ee4\u3002 AND \u548c OR \u8fd0\u7b97\u7b26 AND \u548c OR \u53ef\u5728 WHERE \u5b50\u8bed\u53e5\u4e2d\u628a\u4e24\u4e2a\u6216\u591a\u4e2a\u6761\u4ef6\u7ed3\u5408\u8d77\u6765\u3002 \u5982\u679c\u7b2c\u4e00\u4e2a\u6761\u4ef6\u548c\u7b2c\u4e8c\u4e2a\u6761\u4ef6\u90fd\u6210\u7acb\uff0c\u5219 AND \u8fd0\u7b97\u7b26\u663e\u793a\u4e00\u6761\u8bb0\u5f55\u3002 \u5982\u679c\u7b2c\u4e00\u4e2a\u6761\u4ef6\u548c\u7b2c\u4e8c\u4e2a\u6761\u4ef6\u4e2d\u53ea\u8981\u6709\u4e00\u4e2a\u6210\u7acb\uff0c\u5219 OR \u8fd0\u7b97\u7b26\u663e\u793a\u4e00\u6761\u8bb0\u5f55\u3002","title":"1.2 \u5f00\u59cb"},{"location":"mysql/mysql.and_or/#2","text":"\u4ee5\u4e0b\u6211\u4eec\u5c06\u5728 SQL AND_OR \u547d\u4ee4\u4e2d\u4f7f\u7528 \u4eceMySQL\u6570\u636e\u8868 leco \u4e2d\u8bfb\u53d6\u6570\u636e\u3002","title":"2. \u7528\u6cd5"},{"location":"mysql/mysql.and_or/#21-and","text":"\u5728leco\u8868\u4e2d\u627e\u51faname\u662f\u5f20\u4e09\u4e14sex\u662fmale\u7684\u4fe1\u606f mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 5 rows in set (0.00 sec) mysql> select * from leco where name = \"\u5f20\u4e09\" and sex = 'male'; +------+--------+------+------+ | id | name | sex | age | +------+--------+------+------+ | 4 | \u5f20\u4e09 | male | 40 | +------+--------+------+------+ 1 row in set (0.00 sec)","title":"2.1 AND"},{"location":"mysql/mysql.and_or/#22-or","text":"\u5728leco\u8868\u4e2d\u627e\u51faname\u662f\u5f20\u4e09\u6216\u8005name\u662f\u674e\u56db\u7684\u4eba\u4fe1\u606f mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 5 rows in set (0.00 sec) mysql> select * from leco where name = \"\u5f20\u4e09\" or name= '\u674e\u56db'; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | +------+--------+--------+------+ 3 rows in set (0.00 sec)","title":"2.2 OR"},{"location":"mysql/mysql.and_or/#23-and-or","text":"\u627e\u51fa\u5e74\u9f84\u662f18\u5c81\u6216\u800520\u5c81\uff0c\u4e14sex\u662ffemale\u7684\u4eba\u5458\u4fe1\u606f mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 5 rows in set (0.00 sec) mysql> select * from leco where (age=18 or age=20) and sex='female'; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | +------+--------+--------+------+ 1 row in set (0.01 sec)","title":"2.3 \u7ed3\u5408 AND \u548c OR \u8fd0\u7b97\u7b26"},{"location":"mysql/mysql.between/","text":"MySQL BETWEEN 1. \u4ecb\u7ecd \u00b6 1.1 \u73af\u5883\u51c6\u5907 \u00b6 drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); insert into info(name,age,score) values(\"\u674e\u56db\",20,55); insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.03 sec) mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.05 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) 2. \u5f00\u59cb \u00b6 2.1 \u8bed\u6cd5 \u00b6 BETWEEN \u64cd\u4f5c\u7b26\u5728 WHERE \u5b50\u53e5\u4e2d\u4f7f\u7528\uff0c\u4f5c\u7528\u662f\u9009\u53d6\u4ecb\u4e8e\u4e24\u4e2a\u503c\u4e4b\u95f4\u7684\u6570\u636e\u8303\u56f4\u3002\u8fd9\u4e9b\u503c\u53ef\u4ee5\u662f\u6570\u503c\u3001\u6587\u672c\u6216\u8005\u65e5\u671f\u3002 SELECT column_name(s) FROM table_name WHERE column_name BETWEEN value1 AND value2 2.2 \u64cd\u4f5c \u00b6 \u67e5\u8be2\u5e74\u9f84\u662f\u572820\u523040\u4e4b\u95f4\uff08\u524d\u540e\u90fd\u5305\uff09\u7684\u4eba\u5458\u4fe1\u606f mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> select * from info where age between 20 and 40; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 4 rows in set (0.00 sec)","title":"18. SQL BETWEEN"},{"location":"mysql/mysql.between/#1","text":"","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.between/#11","text":"drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); insert into info(name,age,score) values(\"\u674e\u56db\",20,55); insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.03 sec) mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.05 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec)","title":"1.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.between/#2","text":"","title":"2. \u5f00\u59cb"},{"location":"mysql/mysql.between/#21","text":"BETWEEN \u64cd\u4f5c\u7b26\u5728 WHERE \u5b50\u53e5\u4e2d\u4f7f\u7528\uff0c\u4f5c\u7528\u662f\u9009\u53d6\u4ecb\u4e8e\u4e24\u4e2a\u503c\u4e4b\u95f4\u7684\u6570\u636e\u8303\u56f4\u3002\u8fd9\u4e9b\u503c\u53ef\u4ee5\u662f\u6570\u503c\u3001\u6587\u672c\u6216\u8005\u65e5\u671f\u3002 SELECT column_name(s) FROM table_name WHERE column_name BETWEEN value1 AND value2","title":"2.1 \u8bed\u6cd5"},{"location":"mysql/mysql.between/#22","text":"\u67e5\u8be2\u5e74\u9f84\u662f\u572820\u523040\u4e4b\u95f4\uff08\u524d\u540e\u90fd\u5305\uff09\u7684\u4eba\u5458\u4fe1\u606f mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> select * from info where age between 20 and 40; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 4 rows in set (0.00 sec)","title":"2.2 \u64cd\u4f5c"},{"location":"mysql/mysql.binlog/","text":"MySQL binlog 1. \u4ecb\u7ecd \u00b6 binlog \u57fa\u672c\u8ba4\u8bc6 MySQL\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u53ef\u4ee5\u8bf4\u662fMySQL\u6700\u91cd\u8981\u7684\u65e5\u5fd7\u4e86\uff0c\u5b83\u8bb0\u5f55\u4e86\u6240\u6709\u7684DDL\u548cDML(\u9664\u4e86\u6570\u636e\u67e5\u8be2\u8bed\u53e5)\u8bed\u53e5\uff0c\u4ee5\u4e8b\u4ef6\u5f62\u5f0f\u8bb0\u5f55\uff0c\u8fd8\u5305\u542b\u8bed\u53e5\u6240\u6267\u884c\u7684\u6d88\u8017\u7684\u65f6\u95f4\uff0cMySQL\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u662f\u4e8b\u52a1\u5b89\u5168\u578b\u7684\u3002 \u4e00\u822c\u6765\u8bf4\u5f00\u542f\u4e8c\u8fdb\u5236\u65e5\u5fd7\u5927\u6982\u4f1a\u67091%\u7684\u6027\u80fd\u635f\u8017(\u53c2\u89c1MySQL\u5b98\u65b9\u4e2d\u6587\u624b\u518c 5.1.24\u7248)\u3002\u4e8c\u8fdb\u5236\u6709\u4e24\u4e2a\u6700\u91cd\u8981\u7684\u4f7f\u7528\u573a\u666f: MySQL Replication\u5728Master\u7aef\u5f00\u542fbinlog\uff0cMster\u628a\u5b83\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4f20\u9012\u7ed9slaves\u6765\u8fbe\u5230master-slave\u6570\u636e\u4e00\u81f4\u7684\u76ee\u7684\u3002 \u81ea\u7136\u5c31\u662f\u6570\u636e\u6062\u590d\u4e86\uff0c\u901a\u8fc7\u4f7f\u7528mysqlbinlog\u5de5\u5177\u6765\u4f7f\u6062\u590d\u6570\u636e\u3002 \u4e8c\u8fdb\u5236\u65e5\u5fd7\u5305\u62ec\u4e24\u7c7b\u6587\u4ef6\uff1a\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7d22\u5f15\u6587\u4ef6\uff08\u6587\u4ef6\u540d\u540e\u7f00\u4e3a.index\uff09\u7528\u4e8e\u8bb0\u5f55\u6240\u6709\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\uff08\u6587\u4ef6\u540d\u540e\u7f00\u4e3a.00000*\uff09\u8bb0\u5f55\u6570\u636e\u5e93\u6240\u6709\u7684DDL\u548cDML(\u9664\u4e86\u6570\u636e\u67e5\u8be2\u8bed\u53e5)\u8bed\u53e5\u4e8b\u4ef6\u3002 2. \u5f00\u542fbinlog \u00b6 \u627e\u5230\u914d\u7f6e\u6587\u4ef6\uff0c\u914d\u7f6e\u597d\u4ee5\u4e0b\uff0c\u7136\u540e\u91cd\u542fmysql\u3002 root@leco:/etc/mysql/mysql.conf.d# grep 'log_bin' mysqld.cnf log_bin = /var/log/mysql/mysql-bin.log \u767b\u5f55\u67e5\u770b mysql> show variables like 'log_bin'; +---------------+-------+ | Variable_name | Value | +---------------+-------+ | log_bin | ON | +---------------+-------+ 1 row in set (0.01 sec) ON\u8868\u793a\u5df2\u7ecf\u5f00\u542fbinlog\u65e5\u5fd7 3. \u5e38\u7528\u64cd\u4f5c \u00b6 3.1 \u65e5\u5fd7\u5217\u8868 \u00b6 \u67e5\u770b\u6240\u6709binlog\u65e5\u5fd7\u5217\u8868 mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 2846 | | mysql-bin.000002 | 1058 | | mysql-bin.000003 | 10287 | +------------------+-----------+ 3 rows in set (0.00 sec) 3.2 \u67e5\u770b\u6700\u65b0 \u00b6 \u67e5\u770bmaster\u72b6\u6001\uff0c\u5373\u6700\u540e(\u6700\u65b0)\u4e00\u4e2abinlog\u65e5\u5fd7\u7684\u7f16\u53f7\u540d\u79f0\uff0c\u53ca\u5176\u6700\u540e\u4e00\u4e2a\u64cd\u4f5c\u4e8b\u4ef6pos\u7ed3\u675f\u70b9(Position)\u503c mysql> show master status; +------------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +------------------+----------+--------------+------------------+-------------------+ | mysql-bin.000003 | 10287 | | | | +------------------+----------+--------------+------------------+-------------------+ 1 row in set (0.00 sec) 3.3 \u5237\u65b0 \u00b6 \u5237\u65b0log\u65e5\u5fd7\uff0c\u81ea\u6b64\u523b\u5f00\u59cb\u4ea7\u751f\u4e00\u4e2a\u65b0\u7f16\u53f7\u7684binlog\u65e5\u5fd7\u6587\u4ef6 mysql> flush logs; Query OK, 0 rows affected (0.06 sec) mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 2846 | | mysql-bin.000002 | 1058 | | mysql-bin.000003 | 10334 | | mysql-bin.000004 | 154 | +------------------+-----------+ 4 rows in set (0.00 sec) \u53ef\u4ee5\u770b\u51fa\u591a\u4e86\u4e00\u4e2amysql-bin.000004 \u6587\u4ef6 \u6ce8\u610f \u6bcf\u5f53 mysqld\u670d\u52a1\u91cd\u542f\u65f6 \uff0c\u4f1a\u81ea\u52a8\u6267\u884c\u6b64\u547d\u4ee4\uff0c\u5237\u65b0 binlog\u65e5\u5fd7 \uff1b\u5728 mysqldump\u5907\u4efd\u6570\u636e\u65f6\u52a0 - F \u9009\u9879\u4e5f\u4f1a\u5237\u65b0 binlog\u65e5\u5fd7 \uff1b 3.4 \u6e05\u9664 \u00b6 \u91cd\u7f6e(\u6e05\u7a7a)\u6240\u6709binlog\u65e5\u5fd7 mysql> reset master; Query OK, 0 rows affected (0.03 sec) mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 154 | +------------------+-----------+ 1 row in set (0.00 sec) \u6ce8\u610f \u5728\u751f\u4ea7\u73af\u5883\u4e0a\uff0c\u4e0d\u8981\u64cd\u4f5c\u3002 4. \u67e5\u770b\u65e5\u5fd7\u5185\u5bb9 \u00b6 4.1 \u65e5\u5fd7\u8def\u5f84 \u00b6 mysql> show variables like 'log_%'; +----------------------------------------+--------------------------------+ | Variable_name | Value | +----------------------------------------+--------------------------------+ | log_bin | ON | | log_bin_basename | /var/log/mysql/mysql-bin | | log_bin_index | /var/log/mysql/mysql-bin.index | | log_bin_trust_function_creators | OFF | | log_bin_use_v1_row_events | OFF | | log_builtin_as_identified_by_password | OFF | | log_error | /var/log/mysql/error.log | | log_error_verbosity | 3 | | log_output | FILE | | log_queries_not_using_indexes | OFF | | log_slave_updates | OFF | | log_slow_admin_statements | OFF | | log_slow_slave_statements | OFF | | log_statements_unsafe_for_binlog | ON | | log_syslog | OFF | | log_syslog_facility | daemon | | log_syslog_include_pid | ON | | log_syslog_tag | | | log_throttle_queries_not_using_indexes | 0 | | log_timestamps | UTC | | log_warnings | 2 | +----------------------------------------+--------------------------------+ 21 rows in set (0.00 sec) \u4e5f\u53ef\u4ee5\u67e5\u770b\u670d\u52a1\u5668\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u67e5\u627e\u3002 root@leco:/etc/mysql/mysql.conf.d# egrep 'log_bin' mysqld.cnf log_bin = /var/log/mysql/mysql-bin.log root@leco:/var/log/mysql# ll \u603b\u7528\u91cf 52 drwxr-x--- 2 mysql adm 4096 3\u6708 1 10:46 ./ drwxrwxr-x 31 root syslog 4096 3\u6708 1 07:35 ../ -rw-r----- 1 mysql adm 0 3\u6708 1 07:35 error.log -rw-r----- 1 mysql adm 6604 3\u6708 1 02:00 error.log.1.gz -rw-r----- 1 mysql adm 2902 2\u6708 27 09:09 error.log.2.gz -rw-r----- 1 mysql adm 4906 2\u6708 26 18:08 error.log.3.gz -rw-r----- 1 mysql adm 1460 2\u6708 25 09:52 error.log.4.gz -rw-r----- 1 mysql adm 324 2\u6708 24 20:01 error.log.5.gz -rw-r----- 1 mysql adm 20 2\u6708 23 07:35 error.log.6.gz -rw-r----- 1 mysql adm 20 2\u6708 22 07:35 error.log.7.gz -rw-r----- 1 mysql mysql 154 3\u6708 1 10:46 mysql-bin.000001 -rw-r----- 1 mysql mysql 32 3\u6708 1 10:46 mysql-bin.index 4.2 binlog\u67e5\u770b \u00b6 4.2.1 \u975eSQL\u65b9\u5f0f\u663e\u793a \u00b6 root@leco:/var/log/mysql# mysqlbinlog -v mysql-bin.000004 /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/; /*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/; DELIMITER /*!*/; # at 4 #190301 11:04:46 server id 1 end_log_pos 123 CRC32 0x14abee01 Start: binlog v 4, server v 5.7.25-0ubuntu0.16.04.2-log created 190301 11:04:46 # Warning: this binlog is either in use or was not closed properly. BINLOG ' TqF4XA8BAAAAdwAAAHsAAAABAAQANS43LjI1LTB1YnVudHUwLjE2LjA0LjItbG9nAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAAXwAEGggAAAAICAgCAAAACgoKKioAEjQA AQHuqxQ= '/*!*/; # at 123 #190301 11:04:46 server id 1 end_log_pos 154 CRC32 0x0bab435e Previous-GTIDs # [empty] # at 154 #190301 11:04:49 server id 1 end_log_pos 219 CRC32 0x6b8e78b8 Anonymous_GTID last_committed=0 sequence_number=1 rbr_only=no SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 219 #190301 11:04:49 server id 1 end_log_pos 317 CRC32 0x82a1e13d Query thread_id=16 exec_time=0 error_code=0 use `summer`/*!*/; SET TIMESTAMP=1551409489/*!*/; SET @@session.pseudo_thread_id=16/*!*/; SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/; SET @@session.sql_mode=1436549152/*!*/; SET @@session.auto_increment_increment=2, @@session.auto_increment_offset=1/*!*/; /*!\\C utf8 *//*!*/; SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/; SET @@session.time_zone='SYSTEM'/*!*/; SET @@session.lc_time_names=0/*!*/; SET @@session.collation_database=DEFAULT/*!*/; flush privileges /*!*/; # at 317 #190301 11:13:38 server id 1 end_log_pos 382 CRC32 0x2b5aab56 Anonymous_GTID last_committed=1 sequence_number=2 rbr_only=no SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 382 #190301 11:13:38 server id 1 end_log_pos 507 CRC32 0xcffec2b7 Query thread_id=16 exec_time=0 error_code=0 SET TIMESTAMP=1551410018/*!*/; DROP TABLE `cmz` /* generated by server */ /*!*/; SET @@SESSION.GTID_NEXT= 'AUTOMATIC' /* added by mysqlbinlog */ /*!*/; DELIMITER ; # End of log file /*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/; /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/; root@leco:/var/log/mysql# mysqlbinlog\u6709\u4e00\u4e2a\u53c2\u6570--verbose(\u6216-v)\uff0c\u5c06\u81ea\u52a8\u751f\u6210\u5e26\u6ce8\u91ca\u7684SQL\u8bed\u53e5\uff08\u5728\u884c\u4e8b\u4ef6\u4e2d\u91cd\u6784\u4f2aSQL\u8bed\u53e5\uff09\uff0c\u5176\u5b9e\u8fd9\u4e2a\u5e76\u975e\u539f\u59cbSQL\u8bed\u53e5\uff0c\u800c\u662f\u4f2aSQL\uff0c\u5982\u679c\u4f7f\u7528\u8fd9\u4e2a\u53c2\u6570\u4e24\u6b21(\u5982-v -v)\uff0c\u5219\u8f93\u51fa\u5217\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u4f1a\u751f\u6210\u5b57\u6bb5\u7684\u7c7b\u578b\u3001\u957f\u5ea6\u3001\u662f\u5426\u4e3anull\u7b49\u5c5e\u6027\u4fe1\u606f\uff1a \u4ee5\u4e0a\u663e\u793a\u4e0d\u662f\u6211\u4eec\u771f\u5b9e\u8f93\u5165\u7684SQL\u8bed\u53e5\u3002\u5176\u5b9e\u8fd9\u91cc\u7684SQL\u8bed\u53e5\u4e0d\u662f\u539f\u59cbSQL\u8bed\u53e5\uff0c\u90a3\u4e48\u80fd\u5426\u770b\u5230\u539f\u59cbSQL\u8bed\u53e5\u5462\uff1f\u7b54\u6848\u662f\u53ef\u4ee5\uff0c\u4f46\u662f\u5fc5\u987b\u8bbe\u7f6e\u7cfb\u7edf\u53d8\u91cfbinlog_rows_query_log_events\u3002 4.2.2 SQL\u65b9\u5f0f\u663e\u793a \u00b6 \u5f00\u542f root@leco:/var/log/mysql# vim /etc/mysql/mysql.conf.d/mysqld.cnf root@leco:/var/log/mysql# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service. mysql> show variables like 'binlog_rows_query_log_events'; +------------------------------+-------+ | Variable_name | Value | +------------------------------+-------+ | binlog_rows_query_log_events | ON | +------------------------------+-------+ 1 row in set (0.00 sec) \u63d2\u5165\u70b9\u6570\u636e mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88); Query OK, 1 row affected (0.01 sec) mysql> insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88); Query OK, 1 row affected (0.01 sec) mysql> insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88); Query OK, 1 row affected (0.01 sec) mysql> insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88); Query OK, 1 row affected (0.01 sec) mysql> flush logs; Query OK, 0 rows affected (0.06 sec) \u6b64\u65f6\u5728\u67e5\u770bbinlog\u65e5\u5fd7 root@leco:/var/log/mysql# mysqlbinlog --base64-output=DECODE-ROWS -vv mysql-bin.000005 /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/; /*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/; DELIMITER /*!*/; # at 4 #190301 14:23:31 server id 1 end_log_pos 123 CRC32 0xc790f07e Start: binlog v 4, server v 5.7.25-0ubuntu0.16.04.2-log created 190301 14:23:31 # at 123 #190301 14:23:31 server id 1 end_log_pos 154 CRC32 0xc5c3c48e Previous-GTIDs # [empty] # at 154 #190301 14:24:16 server id 1 end_log_pos 219 CRC32 0x34abaaba Anonymous_GTID last_committed=0 sequence_number=1 rbr_only=no SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 219 #190301 14:24:16 server id 1 end_log_pos 420 CRC32 0xa5400620 Query thread_id=18 exec_time=0 error_code=0 use `summer`/*!*/; SET TIMESTAMP=1551421456/*!*/; SET @@session.pseudo_thread_id=18/*!*/; SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/; SET @@session.sql_mode=1436549152/*!*/; SET @@session.auto_increment_increment=2, @@session.auto_increment_offset=1/*!*/; /*!\\C utf8 *//*!*/; SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/; SET @@session.lc_time_names=0/*!*/; SET @@session.collation_database=DEFAULT/*!*/; create table cmz( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ) /*!*/; # at 420 #190301 14:24:19 server id 1 end_log_pos 485 CRC32 0x57042dad Anonymous_GTID last_committed=1 sequence_number=2 rbr_only=yes /*!50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED*//*!*/; SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 485 #190301 14:24:19 server id 1 end_log_pos 564 CRC32 0xbd0e31f3 Query thread_id=18 exec_time=0 error_code=0 SET TIMESTAMP=1551421459/*!*/; BEGIN /*!*/; # at 564 #190301 14:24:19 server id 1 end_log_pos 654 CRC32 0xe97dcc67 Rows_query # insert into cmz(name,age,score) values(\"cmz from leco data\",18,88) # at 654 #190301 14:24:19 server id 1 end_log_pos 707 CRC32 0x0e55c20a Table_map: `summer`.`cmz` mapped to number 131 # at 707 #190301 14:24:19 server id 1 end_log_pos 774 CRC32 0x45930630 Write_rows: table id 131 flags: STMT_END_F ### INSERT INTO `summer`.`cmz` ### SET ### @1=1 /* INT meta=0 nullable=0 is_null=0 */ ### @2='cmz from leco data' /* VARSTRING(20) meta=20 nullable=1 is_null=0 */ ### @3=18 /* INT meta=0 nullable=0 is_null=0 */ ### @4=88 /* INT meta=0 nullable=0 is_null=0 */ # at 774 #190301 14:24:19 server id 1 end_log_pos 805 CRC32 0x06220d41 Xid = 257 COMMIT/*!*/; # at 805 #190301 14:24:19 server id 1 end_log_pos 870 CRC32 0xff42bcfd Anonymous_GTID last_committed=2 sequence_number=3 rbr_only=yes /*!50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED*//*!*/; SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 870 #190301 14:24:19 server id 1 end_log_pos 949 CRC32 0xa586b903 Query thread_id=18 exec_time=0 error_code=0 SET TIMESTAMP=1551421459/*!*/; BEGIN /*!*/; # at 949 #190301 14:24:19 server id 1 end_log_pos 1040 CRC32 0x1c25f21f Rows_query # insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88) # at 1040 #190301 14:24:19 server id 1 end_log_pos 1093 CRC32 0x6c8d4461 Table_map: `summer`.`cmz` mapped to number 131 # at 1093 #190301 14:24:19 server id 1 end_log_pos 1161 CRC32 0x32c5030c Write_rows: table id 131 flags: STMT_END_F ### INSERT INTO `summer`.`cmz` ### SET ### @1=3 /* INT meta=0 nullable=0 is_null=0 */ ### @2='cmz1 from leco data' /* VARSTRING(20) meta=20 nullable=1 is_null=0 */ ### @3=40 /* INT meta=0 nullable=0 is_null=0 */ ### @4=88 /* INT meta=0 nullable=0 is_null=0 */ # at 1161 #190301 14:24:19 server id 1 end_log_pos 1192 CRC32 0xc1579343 Xid = 258 COMMIT/*!*/; # at 1192 #190301 14:25:08 server id 1 end_log_pos 1239 CRC32 0x4fde8e8c Rotate to mysql-bin.000006 pos: 4 SET @@SESSION.GTID_NEXT= 'AUTOMATIC' /* added by mysqlbinlog */ /*!*/; DELIMITER ; # End of log file /*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/; /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/; \u53ef\u4ee5\u770b\u5230\u4ee5\u4e0a\u51fa\u73b0\u6211\u4eec\u8f93\u5165\u7684\u771f\u5b9eSQL\u8bed\u53e5\u3002 5. binlog\u76f8\u5173\u53c2\u6570 \u00b6 5.1 binlog\u914d\u7f6e \u00b6 \u5f00\u542fbinlog\u65e5\u5fd7(\u5728[mysqld]\u4e0b\u4fee\u6539\u6216\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e) server-id=1 log-bin=mysql-bin binlog_format=MIXED 5.1 binlog\u6a21\u5f0f \u00b6 Mysql\u590d\u5236\u4e3b\u8981\u6709\u4e09\u79cd\u65b9\u5f0f\uff1a\u57fa\u4e8eSQL\u8bed\u53e5\u7684\u590d\u5236(statement-based replication, SBR)\uff0c\u57fa\u4e8e\u884c\u7684\u590d\u5236(row-based replication, RBR)\uff0c\u6df7\u5408\u6a21\u5f0f\u590d\u5236(mixed-based replication, MBR)\u3002\u5bf9\u5e94\u7684\uff0cbinlog\u7684\u683c\u5f0f\u4e5f\u6709\u4e09\u79cd\uff1aSTATEMENT\uff0cROW\uff0cMIXED\u3002 STATEMENT\u6a21\u5f0f\uff08SBR\uff09 \u6bcf\u4e00\u6761\u4f1a\u4fee\u6539\u6570\u636e\u7684sql\u8bed\u53e5\u4f1a\u8bb0\u5f55\u5230binlog\u4e2d\u3002\u4f18\u70b9\u662f\u5e76\u4e0d\u9700\u8981\u8bb0\u5f55\u6bcf\u4e00\u6761sql\u8bed\u53e5\u548c\u6bcf\u4e00\u884c\u7684\u6570\u636e\u53d8\u5316\uff0c\u51cf\u5c11\u4e86binlog\u65e5\u5fd7\u91cf\uff0c\u8282\u7ea6IO\uff0c\u63d0\u9ad8\u6027\u80fd\u3002\u7f3a\u70b9\u662f\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u4f1a\u5bfc\u81f4master-slave\u4e2d\u7684\u6570\u636e\u4e0d\u4e00\u81f4(\u5982sleep()\u51fd\u6570\uff0c last_insert_id()\uff0c\u4ee5\u53causer-defined functions(udf)\u7b49\u4f1a\u51fa\u73b0\u95ee\u9898) ROW\u6a21\u5f0f\uff08RBR\uff09 \u4e0d\u8bb0\u5f55\u6bcf\u6761sql\u8bed\u53e5\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u4ec5\u9700\u8bb0\u5f55\u54ea\u6761\u6570\u636e\u88ab\u4fee\u6539\u4e86\uff0c\u4fee\u6539\u6210\u4ec0\u4e48\u6837\u4e86\u3002\u800c\u4e14\u4e0d\u4f1a\u51fa\u73b0\u67d0\u4e9b\u7279\u5b9a\u60c5\u51b5\u4e0b\u7684\u5b58\u50a8\u8fc7\u7a0b\u3001\u6216function\u3001\u6216trigger\u7684\u8c03\u7528\u548c\u89e6\u53d1\u65e0\u6cd5\u88ab\u6b63\u786e\u590d\u5236\u7684\u95ee\u9898\u3002\u7f3a\u70b9\u662f\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u65e5\u5fd7\uff0c\u5c24\u5176\u662falter table\u7684\u65f6\u5019\u4f1a\u8ba9\u65e5\u5fd7\u66b4\u6da8\u3002 MIXED\u6a21\u5f0f\uff08MBR\uff09 \u4ee5\u4e0a\u4e24\u79cd\u6a21\u5f0f\u7684\u6df7\u5408\u4f7f\u7528\uff0c\u4e00\u822c\u7684\u590d\u5236\u4f7f\u7528STATEMENT\u6a21\u5f0f\u4fdd\u5b58binlog\uff0c\u5bf9\u4e8eSTATEMENT\u6a21\u5f0f\u65e0\u6cd5\u590d\u5236\u7684\u64cd\u4f5c\u4f7f\u7528ROW\u6a21\u5f0f\u4fdd\u5b58binlog\uff0cMySQL\u4f1a\u6839\u636e\u6267\u884c\u7684SQL\u8bed\u53e5\u9009\u62e9\u65e5\u5fd7\u4fdd\u5b58\u65b9\u5f0f\u3002 5.2 binlog \u4fdd\u5b58\u5929\u6570 \u00b6 mysql> show variables like '%expire_logs_days%'; +------------------+-------+ | Variable_name | Value | +------------------+-------+ | expire_logs_days | 10 | +------------------+-------+ 1 row in set (0.00 sec) 0 \u8868\u793a\u6c38\u4e0d\u8fc7\u671f","title":"05. binlog \u4ecb\u7ecd"},{"location":"mysql/mysql.binlog/#1","text":"binlog \u57fa\u672c\u8ba4\u8bc6 MySQL\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u53ef\u4ee5\u8bf4\u662fMySQL\u6700\u91cd\u8981\u7684\u65e5\u5fd7\u4e86\uff0c\u5b83\u8bb0\u5f55\u4e86\u6240\u6709\u7684DDL\u548cDML(\u9664\u4e86\u6570\u636e\u67e5\u8be2\u8bed\u53e5)\u8bed\u53e5\uff0c\u4ee5\u4e8b\u4ef6\u5f62\u5f0f\u8bb0\u5f55\uff0c\u8fd8\u5305\u542b\u8bed\u53e5\u6240\u6267\u884c\u7684\u6d88\u8017\u7684\u65f6\u95f4\uff0cMySQL\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u662f\u4e8b\u52a1\u5b89\u5168\u578b\u7684\u3002 \u4e00\u822c\u6765\u8bf4\u5f00\u542f\u4e8c\u8fdb\u5236\u65e5\u5fd7\u5927\u6982\u4f1a\u67091%\u7684\u6027\u80fd\u635f\u8017(\u53c2\u89c1MySQL\u5b98\u65b9\u4e2d\u6587\u624b\u518c 5.1.24\u7248)\u3002\u4e8c\u8fdb\u5236\u6709\u4e24\u4e2a\u6700\u91cd\u8981\u7684\u4f7f\u7528\u573a\u666f: MySQL Replication\u5728Master\u7aef\u5f00\u542fbinlog\uff0cMster\u628a\u5b83\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4f20\u9012\u7ed9slaves\u6765\u8fbe\u5230master-slave\u6570\u636e\u4e00\u81f4\u7684\u76ee\u7684\u3002 \u81ea\u7136\u5c31\u662f\u6570\u636e\u6062\u590d\u4e86\uff0c\u901a\u8fc7\u4f7f\u7528mysqlbinlog\u5de5\u5177\u6765\u4f7f\u6062\u590d\u6570\u636e\u3002 \u4e8c\u8fdb\u5236\u65e5\u5fd7\u5305\u62ec\u4e24\u7c7b\u6587\u4ef6\uff1a\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7d22\u5f15\u6587\u4ef6\uff08\u6587\u4ef6\u540d\u540e\u7f00\u4e3a.index\uff09\u7528\u4e8e\u8bb0\u5f55\u6240\u6709\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\uff08\u6587\u4ef6\u540d\u540e\u7f00\u4e3a.00000*\uff09\u8bb0\u5f55\u6570\u636e\u5e93\u6240\u6709\u7684DDL\u548cDML(\u9664\u4e86\u6570\u636e\u67e5\u8be2\u8bed\u53e5)\u8bed\u53e5\u4e8b\u4ef6\u3002","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.binlog/#2-binlog","text":"\u627e\u5230\u914d\u7f6e\u6587\u4ef6\uff0c\u914d\u7f6e\u597d\u4ee5\u4e0b\uff0c\u7136\u540e\u91cd\u542fmysql\u3002 root@leco:/etc/mysql/mysql.conf.d# grep 'log_bin' mysqld.cnf log_bin = /var/log/mysql/mysql-bin.log \u767b\u5f55\u67e5\u770b mysql> show variables like 'log_bin'; +---------------+-------+ | Variable_name | Value | +---------------+-------+ | log_bin | ON | +---------------+-------+ 1 row in set (0.01 sec) ON\u8868\u793a\u5df2\u7ecf\u5f00\u542fbinlog\u65e5\u5fd7","title":"2. \u5f00\u542fbinlog"},{"location":"mysql/mysql.binlog/#3","text":"","title":"3. \u5e38\u7528\u64cd\u4f5c"},{"location":"mysql/mysql.binlog/#31","text":"\u67e5\u770b\u6240\u6709binlog\u65e5\u5fd7\u5217\u8868 mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 2846 | | mysql-bin.000002 | 1058 | | mysql-bin.000003 | 10287 | +------------------+-----------+ 3 rows in set (0.00 sec)","title":"3.1 \u65e5\u5fd7\u5217\u8868"},{"location":"mysql/mysql.binlog/#32","text":"\u67e5\u770bmaster\u72b6\u6001\uff0c\u5373\u6700\u540e(\u6700\u65b0)\u4e00\u4e2abinlog\u65e5\u5fd7\u7684\u7f16\u53f7\u540d\u79f0\uff0c\u53ca\u5176\u6700\u540e\u4e00\u4e2a\u64cd\u4f5c\u4e8b\u4ef6pos\u7ed3\u675f\u70b9(Position)\u503c mysql> show master status; +------------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +------------------+----------+--------------+------------------+-------------------+ | mysql-bin.000003 | 10287 | | | | +------------------+----------+--------------+------------------+-------------------+ 1 row in set (0.00 sec)","title":"3.2 \u67e5\u770b\u6700\u65b0"},{"location":"mysql/mysql.binlog/#33","text":"\u5237\u65b0log\u65e5\u5fd7\uff0c\u81ea\u6b64\u523b\u5f00\u59cb\u4ea7\u751f\u4e00\u4e2a\u65b0\u7f16\u53f7\u7684binlog\u65e5\u5fd7\u6587\u4ef6 mysql> flush logs; Query OK, 0 rows affected (0.06 sec) mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 2846 | | mysql-bin.000002 | 1058 | | mysql-bin.000003 | 10334 | | mysql-bin.000004 | 154 | +------------------+-----------+ 4 rows in set (0.00 sec) \u53ef\u4ee5\u770b\u51fa\u591a\u4e86\u4e00\u4e2amysql-bin.000004 \u6587\u4ef6 \u6ce8\u610f \u6bcf\u5f53 mysqld\u670d\u52a1\u91cd\u542f\u65f6 \uff0c\u4f1a\u81ea\u52a8\u6267\u884c\u6b64\u547d\u4ee4\uff0c\u5237\u65b0 binlog\u65e5\u5fd7 \uff1b\u5728 mysqldump\u5907\u4efd\u6570\u636e\u65f6\u52a0 - F \u9009\u9879\u4e5f\u4f1a\u5237\u65b0 binlog\u65e5\u5fd7 \uff1b","title":"3.3 \u5237\u65b0"},{"location":"mysql/mysql.binlog/#34","text":"\u91cd\u7f6e(\u6e05\u7a7a)\u6240\u6709binlog\u65e5\u5fd7 mysql> reset master; Query OK, 0 rows affected (0.03 sec) mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 154 | +------------------+-----------+ 1 row in set (0.00 sec) \u6ce8\u610f \u5728\u751f\u4ea7\u73af\u5883\u4e0a\uff0c\u4e0d\u8981\u64cd\u4f5c\u3002","title":"3.4 \u6e05\u9664"},{"location":"mysql/mysql.binlog/#4","text":"","title":"4. \u67e5\u770b\u65e5\u5fd7\u5185\u5bb9"},{"location":"mysql/mysql.binlog/#41","text":"mysql> show variables like 'log_%'; +----------------------------------------+--------------------------------+ | Variable_name | Value | +----------------------------------------+--------------------------------+ | log_bin | ON | | log_bin_basename | /var/log/mysql/mysql-bin | | log_bin_index | /var/log/mysql/mysql-bin.index | | log_bin_trust_function_creators | OFF | | log_bin_use_v1_row_events | OFF | | log_builtin_as_identified_by_password | OFF | | log_error | /var/log/mysql/error.log | | log_error_verbosity | 3 | | log_output | FILE | | log_queries_not_using_indexes | OFF | | log_slave_updates | OFF | | log_slow_admin_statements | OFF | | log_slow_slave_statements | OFF | | log_statements_unsafe_for_binlog | ON | | log_syslog | OFF | | log_syslog_facility | daemon | | log_syslog_include_pid | ON | | log_syslog_tag | | | log_throttle_queries_not_using_indexes | 0 | | log_timestamps | UTC | | log_warnings | 2 | +----------------------------------------+--------------------------------+ 21 rows in set (0.00 sec) \u4e5f\u53ef\u4ee5\u67e5\u770b\u670d\u52a1\u5668\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u67e5\u627e\u3002 root@leco:/etc/mysql/mysql.conf.d# egrep 'log_bin' mysqld.cnf log_bin = /var/log/mysql/mysql-bin.log root@leco:/var/log/mysql# ll \u603b\u7528\u91cf 52 drwxr-x--- 2 mysql adm 4096 3\u6708 1 10:46 ./ drwxrwxr-x 31 root syslog 4096 3\u6708 1 07:35 ../ -rw-r----- 1 mysql adm 0 3\u6708 1 07:35 error.log -rw-r----- 1 mysql adm 6604 3\u6708 1 02:00 error.log.1.gz -rw-r----- 1 mysql adm 2902 2\u6708 27 09:09 error.log.2.gz -rw-r----- 1 mysql adm 4906 2\u6708 26 18:08 error.log.3.gz -rw-r----- 1 mysql adm 1460 2\u6708 25 09:52 error.log.4.gz -rw-r----- 1 mysql adm 324 2\u6708 24 20:01 error.log.5.gz -rw-r----- 1 mysql adm 20 2\u6708 23 07:35 error.log.6.gz -rw-r----- 1 mysql adm 20 2\u6708 22 07:35 error.log.7.gz -rw-r----- 1 mysql mysql 154 3\u6708 1 10:46 mysql-bin.000001 -rw-r----- 1 mysql mysql 32 3\u6708 1 10:46 mysql-bin.index","title":"4.1 \u65e5\u5fd7\u8def\u5f84"},{"location":"mysql/mysql.binlog/#42-binlog","text":"","title":"4.2 binlog\u67e5\u770b"},{"location":"mysql/mysql.binlog/#421-sql","text":"root@leco:/var/log/mysql# mysqlbinlog -v mysql-bin.000004 /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/; /*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/; DELIMITER /*!*/; # at 4 #190301 11:04:46 server id 1 end_log_pos 123 CRC32 0x14abee01 Start: binlog v 4, server v 5.7.25-0ubuntu0.16.04.2-log created 190301 11:04:46 # Warning: this binlog is either in use or was not closed properly. BINLOG ' TqF4XA8BAAAAdwAAAHsAAAABAAQANS43LjI1LTB1YnVudHUwLjE2LjA0LjItbG9nAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAAXwAEGggAAAAICAgCAAAACgoKKioAEjQA AQHuqxQ= '/*!*/; # at 123 #190301 11:04:46 server id 1 end_log_pos 154 CRC32 0x0bab435e Previous-GTIDs # [empty] # at 154 #190301 11:04:49 server id 1 end_log_pos 219 CRC32 0x6b8e78b8 Anonymous_GTID last_committed=0 sequence_number=1 rbr_only=no SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 219 #190301 11:04:49 server id 1 end_log_pos 317 CRC32 0x82a1e13d Query thread_id=16 exec_time=0 error_code=0 use `summer`/*!*/; SET TIMESTAMP=1551409489/*!*/; SET @@session.pseudo_thread_id=16/*!*/; SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/; SET @@session.sql_mode=1436549152/*!*/; SET @@session.auto_increment_increment=2, @@session.auto_increment_offset=1/*!*/; /*!\\C utf8 *//*!*/; SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/; SET @@session.time_zone='SYSTEM'/*!*/; SET @@session.lc_time_names=0/*!*/; SET @@session.collation_database=DEFAULT/*!*/; flush privileges /*!*/; # at 317 #190301 11:13:38 server id 1 end_log_pos 382 CRC32 0x2b5aab56 Anonymous_GTID last_committed=1 sequence_number=2 rbr_only=no SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 382 #190301 11:13:38 server id 1 end_log_pos 507 CRC32 0xcffec2b7 Query thread_id=16 exec_time=0 error_code=0 SET TIMESTAMP=1551410018/*!*/; DROP TABLE `cmz` /* generated by server */ /*!*/; SET @@SESSION.GTID_NEXT= 'AUTOMATIC' /* added by mysqlbinlog */ /*!*/; DELIMITER ; # End of log file /*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/; /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/; root@leco:/var/log/mysql# mysqlbinlog\u6709\u4e00\u4e2a\u53c2\u6570--verbose(\u6216-v)\uff0c\u5c06\u81ea\u52a8\u751f\u6210\u5e26\u6ce8\u91ca\u7684SQL\u8bed\u53e5\uff08\u5728\u884c\u4e8b\u4ef6\u4e2d\u91cd\u6784\u4f2aSQL\u8bed\u53e5\uff09\uff0c\u5176\u5b9e\u8fd9\u4e2a\u5e76\u975e\u539f\u59cbSQL\u8bed\u53e5\uff0c\u800c\u662f\u4f2aSQL\uff0c\u5982\u679c\u4f7f\u7528\u8fd9\u4e2a\u53c2\u6570\u4e24\u6b21(\u5982-v -v)\uff0c\u5219\u8f93\u51fa\u5217\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u4f1a\u751f\u6210\u5b57\u6bb5\u7684\u7c7b\u578b\u3001\u957f\u5ea6\u3001\u662f\u5426\u4e3anull\u7b49\u5c5e\u6027\u4fe1\u606f\uff1a \u4ee5\u4e0a\u663e\u793a\u4e0d\u662f\u6211\u4eec\u771f\u5b9e\u8f93\u5165\u7684SQL\u8bed\u53e5\u3002\u5176\u5b9e\u8fd9\u91cc\u7684SQL\u8bed\u53e5\u4e0d\u662f\u539f\u59cbSQL\u8bed\u53e5\uff0c\u90a3\u4e48\u80fd\u5426\u770b\u5230\u539f\u59cbSQL\u8bed\u53e5\u5462\uff1f\u7b54\u6848\u662f\u53ef\u4ee5\uff0c\u4f46\u662f\u5fc5\u987b\u8bbe\u7f6e\u7cfb\u7edf\u53d8\u91cfbinlog_rows_query_log_events\u3002","title":"4.2.1 \u975eSQL\u65b9\u5f0f\u663e\u793a"},{"location":"mysql/mysql.binlog/#422-sql","text":"\u5f00\u542f root@leco:/var/log/mysql# vim /etc/mysql/mysql.conf.d/mysqld.cnf root@leco:/var/log/mysql# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service. mysql> show variables like 'binlog_rows_query_log_events'; +------------------------------+-------+ | Variable_name | Value | +------------------------------+-------+ | binlog_rows_query_log_events | ON | +------------------------------+-------+ 1 row in set (0.00 sec) \u63d2\u5165\u70b9\u6570\u636e mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88); Query OK, 1 row affected (0.01 sec) mysql> insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88); Query OK, 1 row affected (0.01 sec) mysql> insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88); Query OK, 1 row affected (0.01 sec) mysql> insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88); Query OK, 1 row affected (0.01 sec) mysql> flush logs; Query OK, 0 rows affected (0.06 sec) \u6b64\u65f6\u5728\u67e5\u770bbinlog\u65e5\u5fd7 root@leco:/var/log/mysql# mysqlbinlog --base64-output=DECODE-ROWS -vv mysql-bin.000005 /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/; /*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/; DELIMITER /*!*/; # at 4 #190301 14:23:31 server id 1 end_log_pos 123 CRC32 0xc790f07e Start: binlog v 4, server v 5.7.25-0ubuntu0.16.04.2-log created 190301 14:23:31 # at 123 #190301 14:23:31 server id 1 end_log_pos 154 CRC32 0xc5c3c48e Previous-GTIDs # [empty] # at 154 #190301 14:24:16 server id 1 end_log_pos 219 CRC32 0x34abaaba Anonymous_GTID last_committed=0 sequence_number=1 rbr_only=no SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 219 #190301 14:24:16 server id 1 end_log_pos 420 CRC32 0xa5400620 Query thread_id=18 exec_time=0 error_code=0 use `summer`/*!*/; SET TIMESTAMP=1551421456/*!*/; SET @@session.pseudo_thread_id=18/*!*/; SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/; SET @@session.sql_mode=1436549152/*!*/; SET @@session.auto_increment_increment=2, @@session.auto_increment_offset=1/*!*/; /*!\\C utf8 *//*!*/; SET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/; SET @@session.lc_time_names=0/*!*/; SET @@session.collation_database=DEFAULT/*!*/; create table cmz( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ) /*!*/; # at 420 #190301 14:24:19 server id 1 end_log_pos 485 CRC32 0x57042dad Anonymous_GTID last_committed=1 sequence_number=2 rbr_only=yes /*!50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED*//*!*/; SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 485 #190301 14:24:19 server id 1 end_log_pos 564 CRC32 0xbd0e31f3 Query thread_id=18 exec_time=0 error_code=0 SET TIMESTAMP=1551421459/*!*/; BEGIN /*!*/; # at 564 #190301 14:24:19 server id 1 end_log_pos 654 CRC32 0xe97dcc67 Rows_query # insert into cmz(name,age,score) values(\"cmz from leco data\",18,88) # at 654 #190301 14:24:19 server id 1 end_log_pos 707 CRC32 0x0e55c20a Table_map: `summer`.`cmz` mapped to number 131 # at 707 #190301 14:24:19 server id 1 end_log_pos 774 CRC32 0x45930630 Write_rows: table id 131 flags: STMT_END_F ### INSERT INTO `summer`.`cmz` ### SET ### @1=1 /* INT meta=0 nullable=0 is_null=0 */ ### @2='cmz from leco data' /* VARSTRING(20) meta=20 nullable=1 is_null=0 */ ### @3=18 /* INT meta=0 nullable=0 is_null=0 */ ### @4=88 /* INT meta=0 nullable=0 is_null=0 */ # at 774 #190301 14:24:19 server id 1 end_log_pos 805 CRC32 0x06220d41 Xid = 257 COMMIT/*!*/; # at 805 #190301 14:24:19 server id 1 end_log_pos 870 CRC32 0xff42bcfd Anonymous_GTID last_committed=2 sequence_number=3 rbr_only=yes /*!50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED*//*!*/; SET @@SESSION.GTID_NEXT= 'ANONYMOUS'/*!*/; # at 870 #190301 14:24:19 server id 1 end_log_pos 949 CRC32 0xa586b903 Query thread_id=18 exec_time=0 error_code=0 SET TIMESTAMP=1551421459/*!*/; BEGIN /*!*/; # at 949 #190301 14:24:19 server id 1 end_log_pos 1040 CRC32 0x1c25f21f Rows_query # insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88) # at 1040 #190301 14:24:19 server id 1 end_log_pos 1093 CRC32 0x6c8d4461 Table_map: `summer`.`cmz` mapped to number 131 # at 1093 #190301 14:24:19 server id 1 end_log_pos 1161 CRC32 0x32c5030c Write_rows: table id 131 flags: STMT_END_F ### INSERT INTO `summer`.`cmz` ### SET ### @1=3 /* INT meta=0 nullable=0 is_null=0 */ ### @2='cmz1 from leco data' /* VARSTRING(20) meta=20 nullable=1 is_null=0 */ ### @3=40 /* INT meta=0 nullable=0 is_null=0 */ ### @4=88 /* INT meta=0 nullable=0 is_null=0 */ # at 1161 #190301 14:24:19 server id 1 end_log_pos 1192 CRC32 0xc1579343 Xid = 258 COMMIT/*!*/; # at 1192 #190301 14:25:08 server id 1 end_log_pos 1239 CRC32 0x4fde8e8c Rotate to mysql-bin.000006 pos: 4 SET @@SESSION.GTID_NEXT= 'AUTOMATIC' /* added by mysqlbinlog */ /*!*/; DELIMITER ; # End of log file /*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/; /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/; \u53ef\u4ee5\u770b\u5230\u4ee5\u4e0a\u51fa\u73b0\u6211\u4eec\u8f93\u5165\u7684\u771f\u5b9eSQL\u8bed\u53e5\u3002","title":"4.2.2 SQL\u65b9\u5f0f\u663e\u793a"},{"location":"mysql/mysql.binlog/#5-binlog","text":"","title":"5. binlog\u76f8\u5173\u53c2\u6570"},{"location":"mysql/mysql.binlog/#51-binlog","text":"\u5f00\u542fbinlog\u65e5\u5fd7(\u5728[mysqld]\u4e0b\u4fee\u6539\u6216\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e) server-id=1 log-bin=mysql-bin binlog_format=MIXED","title":"5.1 binlog\u914d\u7f6e"},{"location":"mysql/mysql.binlog/#51-binlog_1","text":"Mysql\u590d\u5236\u4e3b\u8981\u6709\u4e09\u79cd\u65b9\u5f0f\uff1a\u57fa\u4e8eSQL\u8bed\u53e5\u7684\u590d\u5236(statement-based replication, SBR)\uff0c\u57fa\u4e8e\u884c\u7684\u590d\u5236(row-based replication, RBR)\uff0c\u6df7\u5408\u6a21\u5f0f\u590d\u5236(mixed-based replication, MBR)\u3002\u5bf9\u5e94\u7684\uff0cbinlog\u7684\u683c\u5f0f\u4e5f\u6709\u4e09\u79cd\uff1aSTATEMENT\uff0cROW\uff0cMIXED\u3002 STATEMENT\u6a21\u5f0f\uff08SBR\uff09 \u6bcf\u4e00\u6761\u4f1a\u4fee\u6539\u6570\u636e\u7684sql\u8bed\u53e5\u4f1a\u8bb0\u5f55\u5230binlog\u4e2d\u3002\u4f18\u70b9\u662f\u5e76\u4e0d\u9700\u8981\u8bb0\u5f55\u6bcf\u4e00\u6761sql\u8bed\u53e5\u548c\u6bcf\u4e00\u884c\u7684\u6570\u636e\u53d8\u5316\uff0c\u51cf\u5c11\u4e86binlog\u65e5\u5fd7\u91cf\uff0c\u8282\u7ea6IO\uff0c\u63d0\u9ad8\u6027\u80fd\u3002\u7f3a\u70b9\u662f\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u4f1a\u5bfc\u81f4master-slave\u4e2d\u7684\u6570\u636e\u4e0d\u4e00\u81f4(\u5982sleep()\u51fd\u6570\uff0c last_insert_id()\uff0c\u4ee5\u53causer-defined functions(udf)\u7b49\u4f1a\u51fa\u73b0\u95ee\u9898) ROW\u6a21\u5f0f\uff08RBR\uff09 \u4e0d\u8bb0\u5f55\u6bcf\u6761sql\u8bed\u53e5\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u4ec5\u9700\u8bb0\u5f55\u54ea\u6761\u6570\u636e\u88ab\u4fee\u6539\u4e86\uff0c\u4fee\u6539\u6210\u4ec0\u4e48\u6837\u4e86\u3002\u800c\u4e14\u4e0d\u4f1a\u51fa\u73b0\u67d0\u4e9b\u7279\u5b9a\u60c5\u51b5\u4e0b\u7684\u5b58\u50a8\u8fc7\u7a0b\u3001\u6216function\u3001\u6216trigger\u7684\u8c03\u7528\u548c\u89e6\u53d1\u65e0\u6cd5\u88ab\u6b63\u786e\u590d\u5236\u7684\u95ee\u9898\u3002\u7f3a\u70b9\u662f\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u65e5\u5fd7\uff0c\u5c24\u5176\u662falter table\u7684\u65f6\u5019\u4f1a\u8ba9\u65e5\u5fd7\u66b4\u6da8\u3002 MIXED\u6a21\u5f0f\uff08MBR\uff09 \u4ee5\u4e0a\u4e24\u79cd\u6a21\u5f0f\u7684\u6df7\u5408\u4f7f\u7528\uff0c\u4e00\u822c\u7684\u590d\u5236\u4f7f\u7528STATEMENT\u6a21\u5f0f\u4fdd\u5b58binlog\uff0c\u5bf9\u4e8eSTATEMENT\u6a21\u5f0f\u65e0\u6cd5\u590d\u5236\u7684\u64cd\u4f5c\u4f7f\u7528ROW\u6a21\u5f0f\u4fdd\u5b58binlog\uff0cMySQL\u4f1a\u6839\u636e\u6267\u884c\u7684SQL\u8bed\u53e5\u9009\u62e9\u65e5\u5fd7\u4fdd\u5b58\u65b9\u5f0f\u3002","title":"5.1 binlog\u6a21\u5f0f"},{"location":"mysql/mysql.binlog/#52-binlog","text":"mysql> show variables like '%expire_logs_days%'; +------------------+-------+ | Variable_name | Value | +------------------+-------+ | expire_logs_days | 10 | +------------------+-------+ 1 row in set (0.00 sec) 0 \u8868\u793a\u6c38\u4e0d\u8fc7\u671f","title":"5.2 binlog \u4fdd\u5b58\u5929\u6570"},{"location":"mysql/mysql.conn/","text":"MySQL conn 1. \u63cf\u8ff0 \u00b6 \u4ee5\u4e0b\u662f\u4ece\u547d\u4ee4\u884c\u4e2d\u8fde\u63a5mysql\u670d\u52a1\u5668\u7684\u7b80\u5355\u5b9e\u4f8b\uff1a 1.1 \u4ea4\u4e92\u5f0f\u767b\u5f55 \u00b6 root@leco:~# mysql -uroot -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 5 Server version: 5.7.25-0ubuntu0.16.04.2 (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u5bc6\u7801\u8f93\u5165 root @leco : ~ # mysql -uroot -p Enter password : # \u8fd9\u4e2a\u5730\u65b9\u8f93\u5165mysql\u7684root\u8d26\u53f7\u5bc6\u7801 1.2 \u975e\u4ea4\u4e92\u5f0f\u767b\u5f55 \u00b6 root@leco:~# mysql -uroot -proot mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 6 Server version: 5.7.25-0ubuntu0.16.04.2 (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u5bc6\u7801\u8f93\u5165 mysql - uroot - proot # -p root\u671f\u4e2droot\u5c31\u662f\u5bc6\u7801 1.3 \u9000\u51famysql \u00b6 mysql> exit Bye 2. python \u94fe\u63a5 \u00b6 root@leco:~/code/pymysql# cat pymysql_demo.py import pymysql #\u5bfc\u5165 pymysql db= pymysql.connect(host=\"localhost\", user=\"root\", password=\"root\", db=\"leco\", port=3306, charset='utf8') # \u4f7f\u7528cursor()\u65b9\u6cd5\u83b7\u53d6\u64cd\u4f5c\u6e38\u6807 cur = db.cursor() # 1.\u67e5\u8be2\u64cd\u4f5c # \u7f16\u5199sql \u67e5\u8be2\u8bed\u53e5 tb_dept \u5bf9\u5e94\u6211\u7684\u8868\u540d sql = \"select * from tb_dept\" try: cur.execute(sql) # \u6267\u884csql\u8bed\u53e5 results = cur.fetchall() # \u83b7\u53d6\u67e5\u8be2\u7684\u6240\u6709\u8bb0\u5f55 print(\"id\",\"name\",\"description\") # \u904d\u5386\u7ed3\u679c for row in results : id = row[0] name = row[1] info = row[2] print(id,name,info) except Exception as e: raise e finally: db.close() #\u5173\u95ed\u8fde\u63a5 \u8fd0\u884c\u7ed3\u679c root@leco:~/code/pymysql# python3 pymysql_demo.py id name description 1 \u5f20\u4e09 IT 2 \u674e\u56db Sale \u53c2\u6570\u89e3\u91ca db = pymysql . connect ( host = \"localhost\" , # mysql server IP user = \"root\" , # \u767b\u5f55MySQL\u8d26\u53f7 password = \"root\" , # \u767b\u5f55MySQL\u7684\u7528\u6237 db = \"leco\" , # MySQL\u7528\u6237\u7684\u5bc6\u7801 port = 3306 , # MySQL\u7684\u7aef\u53e3 charset = 'utf8' ) # \u6307\u5b9a\u5b57\u7b26\u96c6\uff0c\u5426\u5219\u4e2d\u6587\u4f1a\u4e71\u7801","title":"03. MySQL \u94fe\u63a5"},{"location":"mysql/mysql.conn/#1","text":"\u4ee5\u4e0b\u662f\u4ece\u547d\u4ee4\u884c\u4e2d\u8fde\u63a5mysql\u670d\u52a1\u5668\u7684\u7b80\u5355\u5b9e\u4f8b\uff1a","title":"1. \u63cf\u8ff0"},{"location":"mysql/mysql.conn/#11","text":"root@leco:~# mysql -uroot -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 5 Server version: 5.7.25-0ubuntu0.16.04.2 (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u5bc6\u7801\u8f93\u5165 root @leco : ~ # mysql -uroot -p Enter password : # \u8fd9\u4e2a\u5730\u65b9\u8f93\u5165mysql\u7684root\u8d26\u53f7\u5bc6\u7801","title":"1.1 \u4ea4\u4e92\u5f0f\u767b\u5f55"},{"location":"mysql/mysql.conn/#12","text":"root@leco:~# mysql -uroot -proot mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 6 Server version: 5.7.25-0ubuntu0.16.04.2 (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u5bc6\u7801\u8f93\u5165 mysql - uroot - proot # -p root\u671f\u4e2droot\u5c31\u662f\u5bc6\u7801","title":"1.2 \u975e\u4ea4\u4e92\u5f0f\u767b\u5f55"},{"location":"mysql/mysql.conn/#13-mysql","text":"mysql> exit Bye","title":"1.3 \u9000\u51famysql"},{"location":"mysql/mysql.conn/#2-python","text":"root@leco:~/code/pymysql# cat pymysql_demo.py import pymysql #\u5bfc\u5165 pymysql db= pymysql.connect(host=\"localhost\", user=\"root\", password=\"root\", db=\"leco\", port=3306, charset='utf8') # \u4f7f\u7528cursor()\u65b9\u6cd5\u83b7\u53d6\u64cd\u4f5c\u6e38\u6807 cur = db.cursor() # 1.\u67e5\u8be2\u64cd\u4f5c # \u7f16\u5199sql \u67e5\u8be2\u8bed\u53e5 tb_dept \u5bf9\u5e94\u6211\u7684\u8868\u540d sql = \"select * from tb_dept\" try: cur.execute(sql) # \u6267\u884csql\u8bed\u53e5 results = cur.fetchall() # \u83b7\u53d6\u67e5\u8be2\u7684\u6240\u6709\u8bb0\u5f55 print(\"id\",\"name\",\"description\") # \u904d\u5386\u7ed3\u679c for row in results : id = row[0] name = row[1] info = row[2] print(id,name,info) except Exception as e: raise e finally: db.close() #\u5173\u95ed\u8fde\u63a5 \u8fd0\u884c\u7ed3\u679c root@leco:~/code/pymysql# python3 pymysql_demo.py id name description 1 \u5f20\u4e09 IT 2 \u674e\u56db Sale \u53c2\u6570\u89e3\u91ca db = pymysql . connect ( host = \"localhost\" , # mysql server IP user = \"root\" , # \u767b\u5f55MySQL\u8d26\u53f7 password = \"root\" , # \u767b\u5f55MySQL\u7684\u7528\u6237 db = \"leco\" , # MySQL\u7528\u6237\u7684\u5bc6\u7801 port = 3306 , # MySQL\u7684\u7aef\u53e3 charset = 'utf8' ) # \u6307\u5b9a\u5b57\u7b26\u96c6\uff0c\u5426\u5219\u4e2d\u6587\u4f1a\u4e71\u7801","title":"2. python \u94fe\u63a5"},{"location":"mysql/mysql.copy_table/","text":"MySQL \u8868\u590d\u5236 1. \u4ecb\u7ecd \u00b6 1. \u590d\u5236\u8868\u7ed3\u6784 + \u8bb0\u5f55\uff08\u6570\u636e\uff09 2. \u53ea\u590d\u5236\u8868\u7ed3\u6784\uff0c\u4e0d\u590d\u5236\u8bb0\u5f55 1. \u590d\u5236\u90e8\u5206\u8868\u7ed3\u6784 2. \u590d\u5236\u5168\u90e8\u8868\u7ed3\u6784 \u590d\u5236\u8868\u7ed3\u6784\uff0b\u8bb0\u5f55 \uff08key\u4e0d\u4f1a\u590d\u5236: \u4e3b\u952e\u3001\u5916\u952e\u548c\u7d22\u5f15\uff09 # \u590d\u5236\u8868\u7ed3\u6784\u54e6\u548c\u6570\u636e 2. \u6848\u4f8b \u00b6 root@leco:~# mysql -uroot -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 6 Server version: 5.7.21-0ubuntu0.16.04.1 (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | db1 | | db2 | | mysql | | performance_schema | | sys | +--------------------+ 6 rows in set (0.00 sec) mysql> use db2; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +---------------+ | Tables_in_db2 | +---------------+ | t1 | +---------------+ 1 row in set (0.00 sec) mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> select \u00d7 from t1; ERROR 1054 (42S22): Unknown column '\u00d7' in 'field list' mysql> select * from t1; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | cmz | male | 18 | | 2 | leco | female | 10 | | 3 | loocha | male | 8 | +------+--------+--------+------+ 3 rows in set (0.00 sec) mysql> create table new_t1 select * from t1; Query OK, 3 rows affected (0.03 sec) Records: 3 Duplicates: 0 Warnings: 0 mysql> show tables; +---------------+ | Tables_in_db2 | +---------------+ | new_t1 | | t1 | +---------------+ 2 rows in set (0.00 sec) mysql> desc new_t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.01 sec) mysql> select * from new_t1; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | cmz | male | 18 | | 2 | leco | female | 10 | | 3 | loocha | male | 8 | +------+--------+--------+------+ 3 rows in set (0.00 sec) # \u53ea\u590d\u5236\u8868\u7ed3\u6784\uff0c\u4e0d\u590d\u5236\u6570\u636e mysql> create table t2 select * from t1 where 1=2; # \u6761\u4ef6\u4e3a\u5047\uff0c\u67e5\u4e0d\u5230\u4efb\u4f55\u8bb0\u5f55\uff0c\u6b64\u65f6\u5c31\u53ea\u4f1a\u590d\u5236\u8868\u7ed3\u6784\uff0c\u4e0d\u590d\u5236\u8868\u6570\u636e Query OK, 0 rows affected (0.03 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> show tables; +---------------+ | Tables_in_db2 | +---------------+ | new_t1 | | t1 | | t2 | +---------------+ 3 rows in set (0.00 sec) mysql> desc t2; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> select * from t2; Empty set (0.00 sec) mysql> create table t3 like t1; Query OK, 0 rows affected (0.03 sec) mysql> show tables; +---------------+ | Tables_in_db2 | +---------------+ | new_t1 | | t1 | | t2 | | t3 | +---------------+ 4 rows in set (0.00 sec) mysql> desc t3; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> select * from t3; Empty set (0.00 sec) \u6ce8\u610f create table t2 select * from t1 where 1=2; \u548c create table t3 like t1;\u90fd\u662f\u521b\u5efa\u8868\u7ed3\u6784\u6709\u795e\u7801\u533a\u522b\uff1f \u524d\u8005\u53ef\u4ee5\u9009\u62e9\u6027\u7684\u590d\u5236\uff0c\u6bd4\u5982\u53ea\u590d\u5236\u5176\u4e2d\u90e8\u5206\u5b57\u6bb5\u7684\u8868\u7ed3\u6784\uff0c\u800c\u540e\u8005\u662f\u5168\u90e8\u590d\u5236\u8868\u7ed3\u6784\u5b57\u6bb5\u3002","title":"07. \u8868\u590d\u5236"},{"location":"mysql/mysql.copy_table/#1","text":"1. \u590d\u5236\u8868\u7ed3\u6784 + \u8bb0\u5f55\uff08\u6570\u636e\uff09 2. \u53ea\u590d\u5236\u8868\u7ed3\u6784\uff0c\u4e0d\u590d\u5236\u8bb0\u5f55 1. \u590d\u5236\u90e8\u5206\u8868\u7ed3\u6784 2. \u590d\u5236\u5168\u90e8\u8868\u7ed3\u6784 \u590d\u5236\u8868\u7ed3\u6784\uff0b\u8bb0\u5f55 \uff08key\u4e0d\u4f1a\u590d\u5236: \u4e3b\u952e\u3001\u5916\u952e\u548c\u7d22\u5f15\uff09 # \u590d\u5236\u8868\u7ed3\u6784\u54e6\u548c\u6570\u636e","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.copy_table/#2","text":"root@leco:~# mysql -uroot -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 6 Server version: 5.7.21-0ubuntu0.16.04.1 (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | db1 | | db2 | | mysql | | performance_schema | | sys | +--------------------+ 6 rows in set (0.00 sec) mysql> use db2; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +---------------+ | Tables_in_db2 | +---------------+ | t1 | +---------------+ 1 row in set (0.00 sec) mysql> desc t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> select \u00d7 from t1; ERROR 1054 (42S22): Unknown column '\u00d7' in 'field list' mysql> select * from t1; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | cmz | male | 18 | | 2 | leco | female | 10 | | 3 | loocha | male | 8 | +------+--------+--------+------+ 3 rows in set (0.00 sec) mysql> create table new_t1 select * from t1; Query OK, 3 rows affected (0.03 sec) Records: 3 Duplicates: 0 Warnings: 0 mysql> show tables; +---------------+ | Tables_in_db2 | +---------------+ | new_t1 | | t1 | +---------------+ 2 rows in set (0.00 sec) mysql> desc new_t1; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.01 sec) mysql> select * from new_t1; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | cmz | male | 18 | | 2 | leco | female | 10 | | 3 | loocha | male | 8 | +------+--------+--------+------+ 3 rows in set (0.00 sec) # \u53ea\u590d\u5236\u8868\u7ed3\u6784\uff0c\u4e0d\u590d\u5236\u6570\u636e mysql> create table t2 select * from t1 where 1=2; # \u6761\u4ef6\u4e3a\u5047\uff0c\u67e5\u4e0d\u5230\u4efb\u4f55\u8bb0\u5f55\uff0c\u6b64\u65f6\u5c31\u53ea\u4f1a\u590d\u5236\u8868\u7ed3\u6784\uff0c\u4e0d\u590d\u5236\u8868\u6570\u636e Query OK, 0 rows affected (0.03 sec) Records: 0 Duplicates: 0 Warnings: 0 mysql> show tables; +---------------+ | Tables_in_db2 | +---------------+ | new_t1 | | t1 | | t2 | +---------------+ 3 rows in set (0.00 sec) mysql> desc t2; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> select * from t2; Empty set (0.00 sec) mysql> create table t3 like t1; Query OK, 0 rows affected (0.03 sec) mysql> show tables; +---------------+ | Tables_in_db2 | +---------------+ | new_t1 | | t1 | | t2 | | t3 | +---------------+ 4 rows in set (0.00 sec) mysql> desc t3; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> select * from t3; Empty set (0.00 sec) \u6ce8\u610f create table t2 select * from t1 where 1=2; \u548c create table t3 like t1;\u90fd\u662f\u521b\u5efa\u8868\u7ed3\u6784\u6709\u795e\u7801\u533a\u522b\uff1f \u524d\u8005\u53ef\u4ee5\u9009\u62e9\u6027\u7684\u590d\u5236\uff0c\u6bd4\u5982\u53ea\u590d\u5236\u5176\u4e2d\u90e8\u5206\u5b57\u6bb5\u7684\u8868\u7ed3\u6784\uff0c\u800c\u540e\u8005\u662f\u5168\u90e8\u590d\u5236\u8868\u7ed3\u6784\u5b57\u6bb5\u3002","title":"2. \u6848\u4f8b"},{"location":"mysql/mysql.database/","text":"MySQL \u5e93\u64cd\u4f5c 1. \u521b\u5efa\u6570\u636e\u5e93 \u00b6 \u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646 MySQL \u670d\u52a1\u540e\uff0c\u4f7f\u7528 create \u547d\u4ee4\u521b\u5efa\u6570\u636e\u5e93\uff0c\u8bed\u6cd5\u5982\u4e0b: CREATE DATABASE \u6570\u636e\u5e93\u540d; \u64cd\u4f5c\u8fc7\u7a0b mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | db1 | | leco | | mysql | | performance_schema | | prv_app_scbxy | | qiushibaike | | s12day113 | | sys | +--------------------+ 9 rows in set (0.00 sec) mysql> create database cmz; Query OK, 1 row affected (0.00 sec) mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | cmz | | db1 | | leco | | mysql | | performance_schema | | prv_app_scbxy | | qiushibaike | | s12day113 | | sys | +--------------------+ 10 rows in set (0.00 sec) 2. \u67e5\u770b\u6570\u636e\u5e93 \u00b6 \u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646 MySQL \u670d\u52a1\u540e\uff0c\u4f7f\u7528 show \u547d\u4ee4\u67e5\u770b\u6570\u636e\u5e93\uff0c\u8bed\u6cd5\u5982\u4e0b: SHOW DATABASES; \u64cd\u4f5c\u8fc7\u7a0b mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | cmz | | db1 | | leco | | mysql | | performance_schema | | prv_app_scbxy | | qiushibaike | | s12day113 | | sys | +--------------------+ 10 rows in set (0.00 sec) 3. \u9009\u62e9\u6570\u636e\u5e93 \u00b6 \u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646 MySQL \u670d\u52a1\u540e\uff0c\u4f7f\u7528 use \u547d\u4ee4\u9009\u62e9\u6570\u636e\u5e93\uff0c\u8bed\u6cd5\u5982\u4e0b: USE DATABASENAME; \u64cd\u4f5c\u8fc7\u7a0b mysql> use leco; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +----------------+ | Tables_in_leco | +----------------+ | innodb_t1 | | innodb_t2 | | t1 | | t2 | | t3 | | t4 | | tb_dept | +----------------+ 7 rows in set (0.00 sec) mysql> use cmz; Database changed mysql> show tables; Empty set (0.00 sec) 4. \u5220\u9664\u6570\u636e\u5e93 \u00b6 \u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646 MySQL \u670d\u52a1\u540e\uff0c\u4f7f\u7528 drop \u547d\u4ee4\u9009\u62e9\u6570\u636e\u5e93\uff0c\u8bed\u6cd5\u5982\u4e0b: drop database <\u6570\u636e\u5e93\u540d>; \u64cd\u4f5c\u8fc7\u7a0b mysql> show tables; Empty set (0.00 sec) mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | cmz | | db1 | | leco | | mysql | | performance_schema | | prv_app_scbxy | | qiushibaike | | s12day113 | | sys | +--------------------+ 10 rows in set (0.00 sec) mysql> drop database cmz; Query OK, 0 rows affected (0.00 sec) mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | db1 | | leco | | mysql | | performance_schema | | prv_app_scbxy | | qiushibaike | | s12day113 | | sys | +--------------------+ 9 rows in set (0.00 sec)","title":"04. MySQL \u5e93"},{"location":"mysql/mysql.database/#1","text":"\u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646 MySQL \u670d\u52a1\u540e\uff0c\u4f7f\u7528 create \u547d\u4ee4\u521b\u5efa\u6570\u636e\u5e93\uff0c\u8bed\u6cd5\u5982\u4e0b: CREATE DATABASE \u6570\u636e\u5e93\u540d; \u64cd\u4f5c\u8fc7\u7a0b mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | db1 | | leco | | mysql | | performance_schema | | prv_app_scbxy | | qiushibaike | | s12day113 | | sys | +--------------------+ 9 rows in set (0.00 sec) mysql> create database cmz; Query OK, 1 row affected (0.00 sec) mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | cmz | | db1 | | leco | | mysql | | performance_schema | | prv_app_scbxy | | qiushibaike | | s12day113 | | sys | +--------------------+ 10 rows in set (0.00 sec)","title":"1. \u521b\u5efa\u6570\u636e\u5e93"},{"location":"mysql/mysql.database/#2","text":"\u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646 MySQL \u670d\u52a1\u540e\uff0c\u4f7f\u7528 show \u547d\u4ee4\u67e5\u770b\u6570\u636e\u5e93\uff0c\u8bed\u6cd5\u5982\u4e0b: SHOW DATABASES; \u64cd\u4f5c\u8fc7\u7a0b mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | cmz | | db1 | | leco | | mysql | | performance_schema | | prv_app_scbxy | | qiushibaike | | s12day113 | | sys | +--------------------+ 10 rows in set (0.00 sec)","title":"2. \u67e5\u770b\u6570\u636e\u5e93"},{"location":"mysql/mysql.database/#3","text":"\u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646 MySQL \u670d\u52a1\u540e\uff0c\u4f7f\u7528 use \u547d\u4ee4\u9009\u62e9\u6570\u636e\u5e93\uff0c\u8bed\u6cd5\u5982\u4e0b: USE DATABASENAME; \u64cd\u4f5c\u8fc7\u7a0b mysql> use leco; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +----------------+ | Tables_in_leco | +----------------+ | innodb_t1 | | innodb_t2 | | t1 | | t2 | | t3 | | t4 | | tb_dept | +----------------+ 7 rows in set (0.00 sec) mysql> use cmz; Database changed mysql> show tables; Empty set (0.00 sec)","title":"3. \u9009\u62e9\u6570\u636e\u5e93"},{"location":"mysql/mysql.database/#4","text":"\u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646 MySQL \u670d\u52a1\u540e\uff0c\u4f7f\u7528 drop \u547d\u4ee4\u9009\u62e9\u6570\u636e\u5e93\uff0c\u8bed\u6cd5\u5982\u4e0b: drop database <\u6570\u636e\u5e93\u540d>; \u64cd\u4f5c\u8fc7\u7a0b mysql> show tables; Empty set (0.00 sec) mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | cmz | | db1 | | leco | | mysql | | performance_schema | | prv_app_scbxy | | qiushibaike | | s12day113 | | sys | +--------------------+ 10 rows in set (0.00 sec) mysql> drop database cmz; Query OK, 0 rows affected (0.00 sec) mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | db1 | | leco | | mysql | | performance_schema | | prv_app_scbxy | | qiushibaike | | s12day113 | | sys | +--------------------+ 9 rows in set (0.00 sec)","title":"4. \u5220\u9664\u6570\u636e\u5e93"},{"location":"mysql/mysql.delete/","text":"MySQL delete 1. \u4ecb\u7ecd \u00b6 \u4f60\u53ef\u4ee5\u4f7f\u7528 SQL \u7684 DELETE FROM \u547d\u4ee4\u6765==\u5220\u9664 MySQL \u6570\u636e\u8868\u4e2d\u7684\u8bb0\u5f55==\u3002 \u4f60\u53ef\u4ee5\u5728 mysql> \u547d\u4ee4\u63d0\u793a\u7b26\u6267\u884c\u8be5\u547d\u4ee4\u3002\u4ee5\u4e0b\u662f SQL DELETE \u8bed\u53e5\u4ece MySQL \u6570\u636e\u8868\u4e2d\u5220\u9664\u6570\u636e\u7684\u901a\u7528\u8bed\u6cd5\uff1a DELETE FROM table_name [WHERE Clause] \u5982\u679c\u6ca1\u6709\u6307\u5b9a WHERE \u5b50\u53e5\uff0cMySQL \u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u5c06\u88ab\u5220\u9664\u3002 \u4f60\u53ef\u4ee5\u5728 WHERE \u5b50\u53e5\u4e2d\u6307\u5b9a\u4efb\u4f55\u6761\u4ef6 \u60a8\u53ef\u4ee5\u5728\u5355\u4e2a\u8868\u4e2d\u4e00\u6b21\u6027\u5220\u9664\u8bb0\u5f55\u3002 \u5f53\u4f60\u60f3\u5220\u9664\u6570\u636e\u8868\u4e2d\u6307\u5b9a\u7684\u8bb0\u5f55\u65f6 WHERE \u5b50\u53e5\u662f\u975e\u5e38\u6709\u7528\u7684\u3002 \u6ce8\u610f \u5220\u9664\u8868\u683c\u4e2d\u7684\u8bb0\u5f55\u65f6\u8981\u5c0f\u5fc3\uff01 \u6ce8\u610f SQL DELETE \u8bed\u53e5\u4e2d\u7684 WHERE \u5b50\u53e5\uff01 WHERE\u5b50\u53e5\u6307\u5b9a\u9700\u8981\u5220\u9664\u54ea\u4e9b\u8bb0\u5f55 \u3002\u5982\u679c\u7701\u7565\u4e86 WHERE\u5b50\u53e5 \uff0c\u8868\u4e2d\u6240\u6709\u8bb0\u5f55\u90fd\u5c06\u88ab\u5220\u9664\uff01 2. delete \u7528\u6cd5 \u00b6 delete \u8bed\u53e5\u7528\u4e8e\u4ece\u8868\u4e2d\u5220\u9664\u6570\u636e\u3002 2.1 \u5220\u9664\u90e8\u5206 \u00b6 \u5feb\u6377\u547d\u4ee4 select * from leco; delete from leco where id=1; select * from leco; delete from leco where name = \"\u8d75\u516d\"; select * from leco; \u64cd\u4f5c\u8fc7\u7a0b mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 20 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 20 | | 4 | \u8d75\u516d | female | 20 | +------+--------+--------+------+ 4 rows in set (0.00 sec) mysql> delete from leco where id=1; Query OK, 1 row affected (0.01 sec) mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 20 | | 4 | \u8d75\u516d | female | 20 | +------+--------+--------+------+ 3 rows in set (0.00 sec) mysql> delete from leco where name = \"\u8d75\u516d\"; Query OK, 1 row affected (0.00 sec) mysql> select * from leco; +------+--------+------+------+ | id | name | sex | age | +------+--------+------+------+ | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 20 | +------+--------+------+------+ 2 rows in set (0.00 sec) 2.2 \u6e05\u7a7a\u8868 \u00b6 2.2.1 delete \u00b6 \u5feb\u6377\u547d\u4ee4 insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); delete from leco; \u64cd\u4f5c\u8fc7\u7a0b mysql> select * from leco; +------+--------+------+------+ | id | name | sex | age | +------+--------+------+------+ | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 20 | +------+--------+------+------+ 2 rows in set (0.00 sec) mysql> delete from leco; Query OK, 2 rows affected (0.00 sec) mysql> select * from leco; Empty set (0.00 sec) 2.2.2 truncate \u00b6 truncate table_name; \u4f8b\u5b50 mysql> insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.00 sec) mysql> insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); Query OK, 1 row affected (0.03 sec) mysql> insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); Query OK, 1 row affected (0.01 sec) mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec) mysql> truncate leco; Query OK, 0 rows affected (0.04 sec) mysql> select * from leco; Empty set (0.00 sec)","title":"09. SQL DELETE"},{"location":"mysql/mysql.delete/#1","text":"\u4f60\u53ef\u4ee5\u4f7f\u7528 SQL \u7684 DELETE FROM \u547d\u4ee4\u6765==\u5220\u9664 MySQL \u6570\u636e\u8868\u4e2d\u7684\u8bb0\u5f55==\u3002 \u4f60\u53ef\u4ee5\u5728 mysql> \u547d\u4ee4\u63d0\u793a\u7b26\u6267\u884c\u8be5\u547d\u4ee4\u3002\u4ee5\u4e0b\u662f SQL DELETE \u8bed\u53e5\u4ece MySQL \u6570\u636e\u8868\u4e2d\u5220\u9664\u6570\u636e\u7684\u901a\u7528\u8bed\u6cd5\uff1a DELETE FROM table_name [WHERE Clause] \u5982\u679c\u6ca1\u6709\u6307\u5b9a WHERE \u5b50\u53e5\uff0cMySQL \u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u5c06\u88ab\u5220\u9664\u3002 \u4f60\u53ef\u4ee5\u5728 WHERE \u5b50\u53e5\u4e2d\u6307\u5b9a\u4efb\u4f55\u6761\u4ef6 \u60a8\u53ef\u4ee5\u5728\u5355\u4e2a\u8868\u4e2d\u4e00\u6b21\u6027\u5220\u9664\u8bb0\u5f55\u3002 \u5f53\u4f60\u60f3\u5220\u9664\u6570\u636e\u8868\u4e2d\u6307\u5b9a\u7684\u8bb0\u5f55\u65f6 WHERE \u5b50\u53e5\u662f\u975e\u5e38\u6709\u7528\u7684\u3002 \u6ce8\u610f \u5220\u9664\u8868\u683c\u4e2d\u7684\u8bb0\u5f55\u65f6\u8981\u5c0f\u5fc3\uff01 \u6ce8\u610f SQL DELETE \u8bed\u53e5\u4e2d\u7684 WHERE \u5b50\u53e5\uff01 WHERE\u5b50\u53e5\u6307\u5b9a\u9700\u8981\u5220\u9664\u54ea\u4e9b\u8bb0\u5f55 \u3002\u5982\u679c\u7701\u7565\u4e86 WHERE\u5b50\u53e5 \uff0c\u8868\u4e2d\u6240\u6709\u8bb0\u5f55\u90fd\u5c06\u88ab\u5220\u9664\uff01","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.delete/#2-delete","text":"delete \u8bed\u53e5\u7528\u4e8e\u4ece\u8868\u4e2d\u5220\u9664\u6570\u636e\u3002","title":"2. delete \u7528\u6cd5"},{"location":"mysql/mysql.delete/#21","text":"\u5feb\u6377\u547d\u4ee4 select * from leco; delete from leco where id=1; select * from leco; delete from leco where name = \"\u8d75\u516d\"; select * from leco; \u64cd\u4f5c\u8fc7\u7a0b mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 20 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 20 | | 4 | \u8d75\u516d | female | 20 | +------+--------+--------+------+ 4 rows in set (0.00 sec) mysql> delete from leco where id=1; Query OK, 1 row affected (0.01 sec) mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 20 | | 4 | \u8d75\u516d | female | 20 | +------+--------+--------+------+ 3 rows in set (0.00 sec) mysql> delete from leco where name = \"\u8d75\u516d\"; Query OK, 1 row affected (0.00 sec) mysql> select * from leco; +------+--------+------+------+ | id | name | sex | age | +------+--------+------+------+ | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 20 | +------+--------+------+------+ 2 rows in set (0.00 sec)","title":"2.1 \u5220\u9664\u90e8\u5206"},{"location":"mysql/mysql.delete/#22","text":"","title":"2.2 \u6e05\u7a7a\u8868"},{"location":"mysql/mysql.delete/#221-delete","text":"\u5feb\u6377\u547d\u4ee4 insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); delete from leco; \u64cd\u4f5c\u8fc7\u7a0b mysql> select * from leco; +------+--------+------+------+ | id | name | sex | age | +------+--------+------+------+ | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 20 | +------+--------+------+------+ 2 rows in set (0.00 sec) mysql> delete from leco; Query OK, 2 rows affected (0.00 sec) mysql> select * from leco; Empty set (0.00 sec)","title":"2.2.1 delete"},{"location":"mysql/mysql.delete/#222-truncate","text":"truncate table_name; \u4f8b\u5b50 mysql> insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.00 sec) mysql> insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); Query OK, 1 row affected (0.03 sec) mysql> insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); Query OK, 1 row affected (0.01 sec) mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec) mysql> truncate leco; Query OK, 0 rows affected (0.04 sec) mysql> select * from leco; Empty set (0.00 sec)","title":"2.2.2  truncate"},{"location":"mysql/mysql.delete_truncate_drop/","text":"MySQL \u5220\u9664\u8868\u6570\u636e 1. \u4ecb\u7ecd \u00b6 truncate\u548cdelete\u90fd\u53ef\u4ee5\u5220\u9664\u8868\u6570\u636e\uff0c\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f truncate\u662f\u6574\u4f53\u5220\u9664\uff08\u901f\u5ea6\u8f83\u5feb\uff09\uff0c delete\u662f\u9010\u6761\u5220\u9664\uff08\u901f\u5ea6\u8f83\u6162\uff09\u3002 truncate\u4e0d\u5199\u670d\u52a1\u5668log\uff0cdelete\u5199\u670d\u52a1\u5668log\uff0c\u4e5f\u5c31\u662ftruncate\u6548\u7387\u6bd4delete\u9ad8\u7684\u539f\u56e0\u3002 truncate\u4e0d\u6fc0\u6d3btrigger(\u89e6\u53d1\u5668)\uff0c\u4f46\u662f\u4f1a\u91cd\u7f6eIdentity\uff08\u6807\u8bc6\u5217\u3001\u81ea\u589e\u5b57\u6bb5\uff09\uff0c\u76f8\u5f53\u4e8e\u81ea\u589e\u5217\u4f1a\u88ab\u7f6e\u4e3a\u521d\u59cb\u503c\uff0c\u53c8\u91cd\u65b0\u4ece1\u5f00\u59cb\u8bb0\u5f55\uff0c\u800c\u4e0d\u662f\u63a5\u7740\u539f\u6765\u7684ID\u6570\u3002\u800cdelete\u5220\u9664\u4ee5\u540e\uff0cIdentity\u4f9d\u65e7\u662f\u63a5\u7740\u88ab\u5220\u9664\u7684\u6700\u8fd1\u7684\u90a3\u4e00\u6761\u8bb0\u5f55ID\u52a01\u540e\u8fdb\u884c\u8bb0\u5f55\u3002 \u5982\u679c\u53ea\u9700\u5220\u9664\u8868\u4e2d\u7684\u90e8\u5206\u8bb0\u5f55\uff0c\u53ea\u80fd\u4f7f\u7528DELETE\u8bed\u53e5\u914d\u5408where\u6761\u4ef6\u3002 DELETE FROM wp_comments WHERE\u2026\u2026 MySql\u7684Delete\u3001Truncate\u3001Drop\u5206\u6790 truncate \u548c delete \u53ea\u5220\u9664\u6570\u636e\u4e0d\u5220\u9664\u8868\u7684\u7ed3\u6784(\u5b9a\u4e49),drop \u8bed\u53e5\u5c06\u5220\u9664\u8868\u7684\u7ed3\u6784\u88ab\u4f9d\u8d56\u7684\u7ea6\u675f(constrain)\u3001\u89e6\u53d1\u5668(trigger)\u3001\u7d22\u5f15(index);\u4f9d\u8d56\u4e8e\u8be5\u8868\u7684\u5b58\u50a8\u8fc7\u7a0b/\u51fd\u6570\u5c06\u4fdd\u7559,\u4f46\u662f\u53d8\u4e3a invalid \u72b6\u6001\u3002 delete \u8bed\u53e5\u662f\u6570\u636e\u5e93\u64cd\u4f5c\u8bed\u8a00(dml)\uff0c\u8fd9\u64cd\u4f5c\u4f1a\u653e\u5230rollback segement \u4e2d\uff0c\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\u624d\u751f\u6548;\u5982\u679c\u6709\u76f8\u5e94\u7684 trigger\uff0c\u6267\u884c\u7684\u65f6\u5019\u5c06\u88ab\u89e6\u53d1\u3002,truncate\u3001drop \u662f\u6570\u636e\u5e93\u5b9a\u4e49\u8bed\u8a00(ddl)\uff0c\u64cd\u4f5c\u7acb\u5373\u751f\u6548\uff0c\u539f\u6570\u636e\u4e0d\u653e\u5230 rollback segment \u4e2d\uff0c\u4e0d\u80fd\u56de\u6eda\uff0c\u64cd\u4f5c\u4e0d\u89e6\u53d1 trigger\u3002 delete \u8bed\u53e5\u4e0d\u5f71\u54cd\u8868\u6240\u5360\u7528\u7684 extent\uff0c\u9ad8\u6c34\u7ebf(high watermark)\u4fdd\u6301\u539f\u4f4d\u7f6e\u4e0d\u52a8\u663e\u7136 drop \u8bed\u53e5\u5c06\u8868\u6240\u5360\u7528\u7684\u7a7a\u95f4\u5168\u90e8\u91ca\u653e\u3002,truncate \u8bed\u53e5\u7f3a\u7701\u60c5\u51b5\u4e0b\u89c1\u7a7a\u95f4\u91ca\u653e\u5230 minextents\u4e2a extent\uff0c\u9664\u975e\u4f7f\u7528reuse storage;truncate \u4f1a\u5c06\u9ad8\u6c34\u7ebf\u590d\u4f4d(\u56de\u5230\u6700\u5f00\u59cb)\u3002 \u901f\u5ea6\uff0c\u4e00\u822c\u6765\u8bf4: drop> truncate > delete \u5b89\u5168\u6027\uff1a\u5c0f\u5fc3\u4f7f\u7528 drop \u548c truncate\uff0c\u5c24\u5176\u6ca1\u6709\u5907\u4efd\u7684\u65f6\u5019.\u5426\u5219\u54ed\u90fd\u6765\u4e0d\u53ca 2. \u6f14\u793a \u00b6 \u6f14\u793adrop\uff0cdelete\uff0ctruncate 2.1 drop \u5220\u9664 \u00b6 drop\u5220\u9664\u8868\u6570\u636e\u548c\u8868\u7ed3\u6784\uff0c\u8bf4\u767d\u4e86\u5c31\u662f\u76f4\u63a5\u628a\u8868\u76f4\u63a5\u5220\u6389\u4e86\u3002 mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tabales; ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'tabales' at line1 mysql> show tables; +------------------+ | Tables_in_summer | +------------------+ | cmz | | info | +------------------+ 2 rows in set (0.00 sec) mysql> drop table cmz; Query OK, 0 rows affected (0.05 sec) mysql> show tables; +------------------+ | Tables_in_summer | +------------------+ | info | +------------------+ 1 row in set (0.00 sec) \u5220\u9664\u540e\uff0c\u770b\u4e0d\u5230\u8868\u540d\u4e3acmz\u8fd9\u5f20\u8868\u4e86\u3002 2.1 delete \u5220\u9664 \u00b6 \u51c6\u5907\u73af\u5883 drop database leco; create database leco charset utf8; use leco; create table emp( id int not null auto_increment primary key, name varchar(20) ); insert into emp(name) values(\"summer\"); insert into emp(name) values(\"caimengzhi\"); insert into emp(name) values(\"\u6211\u66fe\"); insert into emp(name) values(\"\u4e16\u672c\u5e38\u6001\"); \u64cd\u4f5c\u8fc7\u7a0b mysql> create database leco charset utf8; Query OK, 1 row affected (0.01 sec) mysql> use leco; Database changed mysql> create table emp( -> id int not null auto_increment primary key, -> name varchar(20) -> ); Query OK, 0 rows affected (0.07 sec) mysql> insert into emp(name) values(\"summer\"); Query OK, 1 row affected (0.02 sec) mysql> insert into emp(name) values(\"caimengzhi\"); Query OK, 1 row affected (0.02 sec) mysql> insert into emp(name) values(\"\u6211\u66fe\"); Query OK, 1 row affected (0.02 sec) mysql> insert into emp(name) values(\"\u4e16\u672c\u5e38\u6001\"); Query OK, 1 row affected (0.01 sec) mysql> show tables; +----------------+ | Tables_in_leco | +----------------+ | emp | +----------------+ 1 row in set (0.00 sec) mysql> select * from emp; +----+--------------+ | id | name | +----+--------------+ | 1 | summer | | 3 | caimengzhi | | 5 | \u6211\u66fe | | 7 | \u4e16\u672c\u5e38\u6001 | +----+--------------+ 4 rows in set (0.00 sec) \u5f00\u59cb\u5220\u9664 mysql> delete from emp; Query OK, 4 rows affected (0.01 sec) mysql> select * from emp; Empty set (0.00 sec) \u518d\u7ee7\u7eed\u63d2\u5165\u6570\u636e mysql> insert into emp(name) values(\"cmz\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+------+ | id | name | +----+------+ | 9 | cmz | +----+------+ 1 row in set (0.00 sec) \u6b64\u65f6\u770b\u5230\u6570\u636e\u7684id\u53d8\u62109\u4e86\uff0c\u4e5f\u5c31\u662fid\u5728\u539f\u6765\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\uff0c\u4ec5\u4ec5\u662f\u5220\u9664\u4e86\u6570\u636e\uff0c\u6ca1\u6709\u5220\u9664id\uff0c\u800ctruncate\u5220\u9664\u6570\u636e\u4e5f\u4f1a\u5220\u9664id[\u6062\u590d\u4e3a0]\u3002\u7ee7\u7eed\u5411\u4e0b\u770b\u3002 2.2 truncate \u5220\u9664 \u00b6 \u51c6\u5907\u73af\u5883 drop database leco; create database leco charset utf8; use leco; create table emp( id int not null auto_increment primary key, name varchar(20) ); insert into emp(name) values(\"summer\"); insert into emp(name) values(\"caimengzhi\"); insert into emp(name) values(\"\u6211\u66fe\"); insert into emp(name) values(\"\u4e16\u672c\u5e38\u6001\"); \u64cd\u4f5c\u8fc7\u7a0b mysql> create database leco charset utf8; Query OK, 1 row affected (0.01 sec) mysql> use leco; Database changed mysql> create table emp( -> id int not null auto_increment primary key, -> name varchar(20) -> ); Query OK, 0 rows affected (0.07 sec) mysql> insert into emp(name) values(\"summer\"); Query OK, 1 row affected (0.02 sec) mysql> insert into emp(name) values(\"caimengzhi\"); Query OK, 1 row affected (0.02 sec) mysql> insert into emp(name) values(\"\u6211\u66fe\"); Query OK, 1 row affected (0.02 sec) mysql> insert into emp(name) values(\"\u4e16\u672c\u5e38\u6001\"); Query OK, 1 row affected (0.01 sec) mysql> show tables; +----------------+ | Tables_in_leco | +----------------+ | emp | +----------------+ 1 row in set (0.00 sec) mysql> select * from emp; +----+--------------+ | id | name | +----+--------------+ | 1 | summer | | 3 | caimengzhi | | 5 | \u6211\u66fe | | 7 | \u4e16\u672c\u5e38\u6001 | +----+--------------+ 4 rows in set (0.00 sec) \u5f00\u59cb\u5220\u9664\u6570\u636e mysql> truncate emp; Query OK, 0 rows affected (0.05 sec) mysql> select * from emp; Empty set (0.00 sec) \u7ee7\u7eed\u6dfb\u52a0\u6570\u636e mysql> insert into emp(name) values(\"cmz\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+------+ | id | name | +----+------+ | 1 | cmz | +----+------+ 1 row in set (0.00 sec) \u6211\u4eec\u4ece\u4e0a\u9762\u7ed3\u679c\u6765\u770b\u3002id\u4ece0\u5f00\u59cb\u4e86\u3002","title":"04. \u8868\u5220\u9664"},{"location":"mysql/mysql.delete_truncate_drop/#1","text":"truncate\u548cdelete\u90fd\u53ef\u4ee5\u5220\u9664\u8868\u6570\u636e\uff0c\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f truncate\u662f\u6574\u4f53\u5220\u9664\uff08\u901f\u5ea6\u8f83\u5feb\uff09\uff0c delete\u662f\u9010\u6761\u5220\u9664\uff08\u901f\u5ea6\u8f83\u6162\uff09\u3002 truncate\u4e0d\u5199\u670d\u52a1\u5668log\uff0cdelete\u5199\u670d\u52a1\u5668log\uff0c\u4e5f\u5c31\u662ftruncate\u6548\u7387\u6bd4delete\u9ad8\u7684\u539f\u56e0\u3002 truncate\u4e0d\u6fc0\u6d3btrigger(\u89e6\u53d1\u5668)\uff0c\u4f46\u662f\u4f1a\u91cd\u7f6eIdentity\uff08\u6807\u8bc6\u5217\u3001\u81ea\u589e\u5b57\u6bb5\uff09\uff0c\u76f8\u5f53\u4e8e\u81ea\u589e\u5217\u4f1a\u88ab\u7f6e\u4e3a\u521d\u59cb\u503c\uff0c\u53c8\u91cd\u65b0\u4ece1\u5f00\u59cb\u8bb0\u5f55\uff0c\u800c\u4e0d\u662f\u63a5\u7740\u539f\u6765\u7684ID\u6570\u3002\u800cdelete\u5220\u9664\u4ee5\u540e\uff0cIdentity\u4f9d\u65e7\u662f\u63a5\u7740\u88ab\u5220\u9664\u7684\u6700\u8fd1\u7684\u90a3\u4e00\u6761\u8bb0\u5f55ID\u52a01\u540e\u8fdb\u884c\u8bb0\u5f55\u3002 \u5982\u679c\u53ea\u9700\u5220\u9664\u8868\u4e2d\u7684\u90e8\u5206\u8bb0\u5f55\uff0c\u53ea\u80fd\u4f7f\u7528DELETE\u8bed\u53e5\u914d\u5408where\u6761\u4ef6\u3002 DELETE FROM wp_comments WHERE\u2026\u2026 MySql\u7684Delete\u3001Truncate\u3001Drop\u5206\u6790 truncate \u548c delete \u53ea\u5220\u9664\u6570\u636e\u4e0d\u5220\u9664\u8868\u7684\u7ed3\u6784(\u5b9a\u4e49),drop \u8bed\u53e5\u5c06\u5220\u9664\u8868\u7684\u7ed3\u6784\u88ab\u4f9d\u8d56\u7684\u7ea6\u675f(constrain)\u3001\u89e6\u53d1\u5668(trigger)\u3001\u7d22\u5f15(index);\u4f9d\u8d56\u4e8e\u8be5\u8868\u7684\u5b58\u50a8\u8fc7\u7a0b/\u51fd\u6570\u5c06\u4fdd\u7559,\u4f46\u662f\u53d8\u4e3a invalid \u72b6\u6001\u3002 delete \u8bed\u53e5\u662f\u6570\u636e\u5e93\u64cd\u4f5c\u8bed\u8a00(dml)\uff0c\u8fd9\u64cd\u4f5c\u4f1a\u653e\u5230rollback segement \u4e2d\uff0c\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\u624d\u751f\u6548;\u5982\u679c\u6709\u76f8\u5e94\u7684 trigger\uff0c\u6267\u884c\u7684\u65f6\u5019\u5c06\u88ab\u89e6\u53d1\u3002,truncate\u3001drop \u662f\u6570\u636e\u5e93\u5b9a\u4e49\u8bed\u8a00(ddl)\uff0c\u64cd\u4f5c\u7acb\u5373\u751f\u6548\uff0c\u539f\u6570\u636e\u4e0d\u653e\u5230 rollback segment \u4e2d\uff0c\u4e0d\u80fd\u56de\u6eda\uff0c\u64cd\u4f5c\u4e0d\u89e6\u53d1 trigger\u3002 delete \u8bed\u53e5\u4e0d\u5f71\u54cd\u8868\u6240\u5360\u7528\u7684 extent\uff0c\u9ad8\u6c34\u7ebf(high watermark)\u4fdd\u6301\u539f\u4f4d\u7f6e\u4e0d\u52a8\u663e\u7136 drop \u8bed\u53e5\u5c06\u8868\u6240\u5360\u7528\u7684\u7a7a\u95f4\u5168\u90e8\u91ca\u653e\u3002,truncate \u8bed\u53e5\u7f3a\u7701\u60c5\u51b5\u4e0b\u89c1\u7a7a\u95f4\u91ca\u653e\u5230 minextents\u4e2a extent\uff0c\u9664\u975e\u4f7f\u7528reuse storage;truncate \u4f1a\u5c06\u9ad8\u6c34\u7ebf\u590d\u4f4d(\u56de\u5230\u6700\u5f00\u59cb)\u3002 \u901f\u5ea6\uff0c\u4e00\u822c\u6765\u8bf4: drop> truncate > delete \u5b89\u5168\u6027\uff1a\u5c0f\u5fc3\u4f7f\u7528 drop \u548c truncate\uff0c\u5c24\u5176\u6ca1\u6709\u5907\u4efd\u7684\u65f6\u5019.\u5426\u5219\u54ed\u90fd\u6765\u4e0d\u53ca","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.delete_truncate_drop/#2","text":"\u6f14\u793adrop\uff0cdelete\uff0ctruncate","title":"2. \u6f14\u793a"},{"location":"mysql/mysql.delete_truncate_drop/#21-drop","text":"drop\u5220\u9664\u8868\u6570\u636e\u548c\u8868\u7ed3\u6784\uff0c\u8bf4\u767d\u4e86\u5c31\u662f\u76f4\u63a5\u628a\u8868\u76f4\u63a5\u5220\u6389\u4e86\u3002 mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tabales; ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'tabales' at line1 mysql> show tables; +------------------+ | Tables_in_summer | +------------------+ | cmz | | info | +------------------+ 2 rows in set (0.00 sec) mysql> drop table cmz; Query OK, 0 rows affected (0.05 sec) mysql> show tables; +------------------+ | Tables_in_summer | +------------------+ | info | +------------------+ 1 row in set (0.00 sec) \u5220\u9664\u540e\uff0c\u770b\u4e0d\u5230\u8868\u540d\u4e3acmz\u8fd9\u5f20\u8868\u4e86\u3002","title":"2.1 drop \u5220\u9664"},{"location":"mysql/mysql.delete_truncate_drop/#21-delete","text":"\u51c6\u5907\u73af\u5883 drop database leco; create database leco charset utf8; use leco; create table emp( id int not null auto_increment primary key, name varchar(20) ); insert into emp(name) values(\"summer\"); insert into emp(name) values(\"caimengzhi\"); insert into emp(name) values(\"\u6211\u66fe\"); insert into emp(name) values(\"\u4e16\u672c\u5e38\u6001\"); \u64cd\u4f5c\u8fc7\u7a0b mysql> create database leco charset utf8; Query OK, 1 row affected (0.01 sec) mysql> use leco; Database changed mysql> create table emp( -> id int not null auto_increment primary key, -> name varchar(20) -> ); Query OK, 0 rows affected (0.07 sec) mysql> insert into emp(name) values(\"summer\"); Query OK, 1 row affected (0.02 sec) mysql> insert into emp(name) values(\"caimengzhi\"); Query OK, 1 row affected (0.02 sec) mysql> insert into emp(name) values(\"\u6211\u66fe\"); Query OK, 1 row affected (0.02 sec) mysql> insert into emp(name) values(\"\u4e16\u672c\u5e38\u6001\"); Query OK, 1 row affected (0.01 sec) mysql> show tables; +----------------+ | Tables_in_leco | +----------------+ | emp | +----------------+ 1 row in set (0.00 sec) mysql> select * from emp; +----+--------------+ | id | name | +----+--------------+ | 1 | summer | | 3 | caimengzhi | | 5 | \u6211\u66fe | | 7 | \u4e16\u672c\u5e38\u6001 | +----+--------------+ 4 rows in set (0.00 sec) \u5f00\u59cb\u5220\u9664 mysql> delete from emp; Query OK, 4 rows affected (0.01 sec) mysql> select * from emp; Empty set (0.00 sec) \u518d\u7ee7\u7eed\u63d2\u5165\u6570\u636e mysql> insert into emp(name) values(\"cmz\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+------+ | id | name | +----+------+ | 9 | cmz | +----+------+ 1 row in set (0.00 sec) \u6b64\u65f6\u770b\u5230\u6570\u636e\u7684id\u53d8\u62109\u4e86\uff0c\u4e5f\u5c31\u662fid\u5728\u539f\u6765\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\uff0c\u4ec5\u4ec5\u662f\u5220\u9664\u4e86\u6570\u636e\uff0c\u6ca1\u6709\u5220\u9664id\uff0c\u800ctruncate\u5220\u9664\u6570\u636e\u4e5f\u4f1a\u5220\u9664id[\u6062\u590d\u4e3a0]\u3002\u7ee7\u7eed\u5411\u4e0b\u770b\u3002","title":"2.1 delete \u5220\u9664"},{"location":"mysql/mysql.delete_truncate_drop/#22-truncate","text":"\u51c6\u5907\u73af\u5883 drop database leco; create database leco charset utf8; use leco; create table emp( id int not null auto_increment primary key, name varchar(20) ); insert into emp(name) values(\"summer\"); insert into emp(name) values(\"caimengzhi\"); insert into emp(name) values(\"\u6211\u66fe\"); insert into emp(name) values(\"\u4e16\u672c\u5e38\u6001\"); \u64cd\u4f5c\u8fc7\u7a0b mysql> create database leco charset utf8; Query OK, 1 row affected (0.01 sec) mysql> use leco; Database changed mysql> create table emp( -> id int not null auto_increment primary key, -> name varchar(20) -> ); Query OK, 0 rows affected (0.07 sec) mysql> insert into emp(name) values(\"summer\"); Query OK, 1 row affected (0.02 sec) mysql> insert into emp(name) values(\"caimengzhi\"); Query OK, 1 row affected (0.02 sec) mysql> insert into emp(name) values(\"\u6211\u66fe\"); Query OK, 1 row affected (0.02 sec) mysql> insert into emp(name) values(\"\u4e16\u672c\u5e38\u6001\"); Query OK, 1 row affected (0.01 sec) mysql> show tables; +----------------+ | Tables_in_leco | +----------------+ | emp | +----------------+ 1 row in set (0.00 sec) mysql> select * from emp; +----+--------------+ | id | name | +----+--------------+ | 1 | summer | | 3 | caimengzhi | | 5 | \u6211\u66fe | | 7 | \u4e16\u672c\u5e38\u6001 | +----+--------------+ 4 rows in set (0.00 sec) \u5f00\u59cb\u5220\u9664\u6570\u636e mysql> truncate emp; Query OK, 0 rows affected (0.05 sec) mysql> select * from emp; Empty set (0.00 sec) \u7ee7\u7eed\u6dfb\u52a0\u6570\u636e mysql> insert into emp(name) values(\"cmz\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+------+ | id | name | +----+------+ | 1 | cmz | +----+------+ 1 row in set (0.00 sec) \u6211\u4eec\u4ece\u4e0a\u9762\u7ed3\u679c\u6765\u770b\u3002id\u4ece0\u5f00\u59cb\u4e86\u3002","title":"2.2 truncate \u5220\u9664"},{"location":"mysql/mysql.desc/","text":"MySQL DESC 1. \u4ecb\u7ecd \u00b6 1.1 \u73af\u5883\u51c6\u5907 \u00b6 drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.02 sec) mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.06 sec) 2. \u5f00\u59cb \u00b6 2.1 \u8bed\u6cd5 \u00b6 desc \u67e5\u8be2\u8868\u5b9a\u4e49 desc table_name 2.2 \u64cd\u4f5c \u00b6 mysql> desc info; +-------+-------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | varchar(20) | YES | | NULL | | | age | int(11) | NO | | NULL | | | score | int(11) | NO | | NULL | | +-------+-------------+------+-----+---------+----------------+ 4 rows in set (0.00 sec) Field: \u5b57\u6bb5\u8868\u793a\u7684\u662f\u5217\u540d Type: \u5b57\u6bb5\u8868\u793a\u7684\u662f\u5217\u7684\u6570\u636e\u7c7b\u578b Null: \u5b57\u6bb5\u8868\u793a\u8fd9\u4e2a\u5217\u662f\u5426\u80fd\u53d6\u7a7a\u503c Key: \u5728mysql\u4e2dkey \u548cindex \u662f\u4e00\u6837\u7684\u610f\u601d\uff0c\u8fd9\u4e2aKey\u5217\u53ef\u80fd\u4f1a\u770b\u5230\u6709\u5982\u4e0b\u7684\u503c\uff1aPRI(\u4e3b\u952e)\u3001MUL(\u666e\u901a\u7684b-tree\u7d22\u5f15)\u3001UNI(\u552f\u4e00\u7d22\u5f15) Default: \u5217\u7684\u9ed8\u8ba4\u503c Extra: \u5176\u5b83\u4fe1\u606f\uff0c\u672c\u6587\u662f\u81ea\u52a8\u589e\u957f","title":"16. SQL DESC"},{"location":"mysql/mysql.desc/#1","text":"","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.desc/#11","text":"drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.02 sec) mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.06 sec)","title":"1.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.desc/#2","text":"","title":"2. \u5f00\u59cb"},{"location":"mysql/mysql.desc/#21","text":"desc \u67e5\u8be2\u8868\u5b9a\u4e49 desc table_name","title":"2.1 \u8bed\u6cd5"},{"location":"mysql/mysql.desc/#22","text":"mysql> desc info; +-------+-------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | varchar(20) | YES | | NULL | | | age | int(11) | NO | | NULL | | | score | int(11) | NO | | NULL | | +-------+-------------+------+-----+---------+----------------+ 4 rows in set (0.00 sec) Field: \u5b57\u6bb5\u8868\u793a\u7684\u662f\u5217\u540d Type: \u5b57\u6bb5\u8868\u793a\u7684\u662f\u5217\u7684\u6570\u636e\u7c7b\u578b Null: \u5b57\u6bb5\u8868\u793a\u8fd9\u4e2a\u5217\u662f\u5426\u80fd\u53d6\u7a7a\u503c Key: \u5728mysql\u4e2dkey \u548cindex \u662f\u4e00\u6837\u7684\u610f\u601d\uff0c\u8fd9\u4e2aKey\u5217\u53ef\u80fd\u4f1a\u770b\u5230\u6709\u5982\u4e0b\u7684\u503c\uff1aPRI(\u4e3b\u952e)\u3001MUL(\u666e\u901a\u7684b-tree\u7d22\u5f15)\u3001UNI(\u552f\u4e00\u7d22\u5f15) Default: \u5217\u7684\u9ed8\u8ba4\u503c Extra: \u5176\u5b83\u4fe1\u606f\uff0c\u672c\u6587\u662f\u81ea\u52a8\u589e\u957f","title":"2.2 \u64cd\u4f5c"},{"location":"mysql/mysql.distinct/","text":"MySQL DISTINCT 1. \u4ecb\u7ecd \u00b6 1.1 \u73af\u5883\u51c6\u5907 \u00b6 mysql> truncate leco; values(8,\"\u5f20\u4e094\",\"female\",18);Query OK, 0 rows affected (0.04 sec) mysql> mysql> insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); Query OK, 1 row affected (0.02 sec) mysql> insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(5,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(6,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.00 sec) mysql> insert into leco(id,name,sex,age) values(7,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(8,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.00 sec) mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | | 5 | \u5f20\u4e09 | female | 18 | | 6 | \u5f20\u4e09 | female | 18 | | 7 | \u5f20\u4e09 | female | 18 | | 8 | \u5f20\u4e09 | female | 18 | +------+--------+--------+------+ 8 rows in set (0.00 sec) 1.2 \u5f00\u59cb \u00b6 distinct\u4e00\u822c\u662f\u7528\u6765\u53bb\u9664\u67e5\u8be2\u7ed3\u679c\u4e2d\u7684\u91cd\u590d\u8bb0\u5f55\u7684\uff0c\u800c\u4e14\u8fd9\u4e2a\u8bed\u53e5\u5728select\u3001insert\u3001delete\u548cupdate\u4e2d\u53ea\u53ef\u4ee5\u5728select\u4e2d\u4f7f\u7528\uff0c\u5177\u4f53\u7684\u8bed\u6cd5\u5982\u4e0b\u3002 \u4ee5\u4e0b\u662f SQL SELECT \u8bed\u53e5\u4f7f\u7528 distinct \u5b50\u53e5\u4ece\u6570\u636e\u8868\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\u901a\u7528\u8bed\u6cd5\uff1a select distinct expression[,expression...] from tables [where conditions]; 2. DISTINCT \u7528\u6cd5 \u00b6 \u4ee5\u4e0b\u6211\u4eec\u5c06\u5728 SQL SELECT \u547d\u4ee4\u4e2d\u4f7f\u7528 DISTINCT\u5b50\u53e5\u6765\u4eceMySQL\u6570\u636e\u8868 leco \u4e2d\u8bfb\u53d6\u6570\u636e\u3002 mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | | 5 | \u5f20\u4e09 | female | 18 | | 6 | \u5f20\u4e09 | female | 18 | | 7 | \u5f20\u4e09 | female | 18 | | 8 | \u5f20\u4e09 | female | 18 | +------+--------+--------+------+ 8 rows in set (0.00 sec) mysql> select DISTINCT name from leco; +--------+ | name | +--------+ | \u5f20\u4e09 | | \u674e\u56db | | \u738b\u4e94 | | \u8d75\u516d | +--------+ 4 rows in set (0.00 sec) mysql> select name from leco; +--------+ | name | +--------+ | \u5f20\u4e09 | | \u674e\u56db | | \u738b\u4e94 | | \u8d75\u516d | | \u5f20\u4e09 | | \u5f20\u4e09 | | \u5f20\u4e09 | | \u5f20\u4e09 | +--------+ 8 rows in set (0.00 sec) \u4ece\u4e0a\u4f8b\u4e2d\u53ef\u4ee5\u53d1\u73b0\uff0c\u5f53distinct\u5e94\u7528\u5230\u591a\u4e2a\u5b57\u6bb5\u7684\u65f6\u5019\uff0c\u5176\u5e94\u7528\u7684\u8303\u56f4\u662f\u5176\u540e\u9762\u7684\u6240\u6709\u5b57\u6bb5\uff0c\u800c\u4e0d\u53ea\u662f\u7d27\u6328\u7740\u5b83\u7684\u4e00\u4e2a\u5b57\u6bb5\uff0c\u800c\u4e14distinct\u53ea\u80fd\u653e\u5230\u6240\u6709\u5b57\u6bb5\u7684\u524d\u9762\uff0c\u5982\u4e0b\u8bed\u53e5\u662f\u9519\u8bef\u7684\uff1a mysql> select id,DISTINCT name from leco; ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'DISTINCT name from leco' at line 1 \u800c\u4ee5\u4e0b\u662f\u5bf9\u7684 mysql> select DISTINCT id,name from leco; +------+--------+ | id | name | +------+--------+ | 1 | \u5f20\u4e09 | | 2 | \u674e\u56db | | 3 | \u738b\u4e94 | | 4 | \u8d75\u516d | | 5 | \u5f20\u4e09 | | 6 | \u5f20\u4e09 | | 7 | \u5f20\u4e09 | | 8 | \u5f20\u4e09 | +------+--------+ 8 rows in set (0.00 sec) \u6ce8\u610f \u518d\u6b21\u5f3a\u8c03\uff0c distinct \u662f\u4f5c\u7528\u4e8e\u6574\u6761\u67e5\u8be2\uff0c\u800c\u4e0d\u662f\u4f5c\u7528\u4e8e\u7d27\u8ddf\u5176\u540e\u7684\u5b57\u6bb5\u3002","title":"11. SQL DISTINCT"},{"location":"mysql/mysql.distinct/#1","text":"","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.distinct/#11","text":"mysql> truncate leco; values(8,\"\u5f20\u4e094\",\"female\",18);Query OK, 0 rows affected (0.04 sec) mysql> mysql> insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); Query OK, 1 row affected (0.02 sec) mysql> insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(5,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(6,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.00 sec) mysql> insert into leco(id,name,sex,age) values(7,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(8,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.00 sec) mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | | 5 | \u5f20\u4e09 | female | 18 | | 6 | \u5f20\u4e09 | female | 18 | | 7 | \u5f20\u4e09 | female | 18 | | 8 | \u5f20\u4e09 | female | 18 | +------+--------+--------+------+ 8 rows in set (0.00 sec)","title":"1.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.distinct/#12","text":"distinct\u4e00\u822c\u662f\u7528\u6765\u53bb\u9664\u67e5\u8be2\u7ed3\u679c\u4e2d\u7684\u91cd\u590d\u8bb0\u5f55\u7684\uff0c\u800c\u4e14\u8fd9\u4e2a\u8bed\u53e5\u5728select\u3001insert\u3001delete\u548cupdate\u4e2d\u53ea\u53ef\u4ee5\u5728select\u4e2d\u4f7f\u7528\uff0c\u5177\u4f53\u7684\u8bed\u6cd5\u5982\u4e0b\u3002 \u4ee5\u4e0b\u662f SQL SELECT \u8bed\u53e5\u4f7f\u7528 distinct \u5b50\u53e5\u4ece\u6570\u636e\u8868\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\u901a\u7528\u8bed\u6cd5\uff1a select distinct expression[,expression...] from tables [where conditions];","title":"1.2 \u5f00\u59cb"},{"location":"mysql/mysql.distinct/#2-distinct","text":"\u4ee5\u4e0b\u6211\u4eec\u5c06\u5728 SQL SELECT \u547d\u4ee4\u4e2d\u4f7f\u7528 DISTINCT\u5b50\u53e5\u6765\u4eceMySQL\u6570\u636e\u8868 leco \u4e2d\u8bfb\u53d6\u6570\u636e\u3002 mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | | 5 | \u5f20\u4e09 | female | 18 | | 6 | \u5f20\u4e09 | female | 18 | | 7 | \u5f20\u4e09 | female | 18 | | 8 | \u5f20\u4e09 | female | 18 | +------+--------+--------+------+ 8 rows in set (0.00 sec) mysql> select DISTINCT name from leco; +--------+ | name | +--------+ | \u5f20\u4e09 | | \u674e\u56db | | \u738b\u4e94 | | \u8d75\u516d | +--------+ 4 rows in set (0.00 sec) mysql> select name from leco; +--------+ | name | +--------+ | \u5f20\u4e09 | | \u674e\u56db | | \u738b\u4e94 | | \u8d75\u516d | | \u5f20\u4e09 | | \u5f20\u4e09 | | \u5f20\u4e09 | | \u5f20\u4e09 | +--------+ 8 rows in set (0.00 sec) \u4ece\u4e0a\u4f8b\u4e2d\u53ef\u4ee5\u53d1\u73b0\uff0c\u5f53distinct\u5e94\u7528\u5230\u591a\u4e2a\u5b57\u6bb5\u7684\u65f6\u5019\uff0c\u5176\u5e94\u7528\u7684\u8303\u56f4\u662f\u5176\u540e\u9762\u7684\u6240\u6709\u5b57\u6bb5\uff0c\u800c\u4e0d\u53ea\u662f\u7d27\u6328\u7740\u5b83\u7684\u4e00\u4e2a\u5b57\u6bb5\uff0c\u800c\u4e14distinct\u53ea\u80fd\u653e\u5230\u6240\u6709\u5b57\u6bb5\u7684\u524d\u9762\uff0c\u5982\u4e0b\u8bed\u53e5\u662f\u9519\u8bef\u7684\uff1a mysql> select id,DISTINCT name from leco; ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'DISTINCT name from leco' at line 1 \u800c\u4ee5\u4e0b\u662f\u5bf9\u7684 mysql> select DISTINCT id,name from leco; +------+--------+ | id | name | +------+--------+ | 1 | \u5f20\u4e09 | | 2 | \u674e\u56db | | 3 | \u738b\u4e94 | | 4 | \u8d75\u516d | | 5 | \u5f20\u4e09 | | 6 | \u5f20\u4e09 | | 7 | \u5f20\u4e09 | | 8 | \u5f20\u4e09 | +------+--------+ 8 rows in set (0.00 sec) \u6ce8\u610f \u518d\u6b21\u5f3a\u8c03\uff0c distinct \u662f\u4f5c\u7528\u4e8e\u6574\u6761\u67e5\u8be2\uff0c\u800c\u4e0d\u662f\u4f5c\u7528\u4e8e\u7d27\u8ddf\u5176\u540e\u7684\u5b57\u6bb5\u3002","title":"2. DISTINCT \u7528\u6cd5"},{"location":"mysql/mysql.grant/","text":"MySQL GRANT 1. \u4ecb\u7ecd \u00b6 \u6388\u4e88MySQL\u5e10\u6237\u7684\u6743\u9650\u51b3\u5b9a\u4e86\u5e10\u6237\u53ef\u4ee5\u6267\u884c\u7684\u64cd\u4f5c\u3002MySQL\u6743\u9650\u5728\u5b83\u4eec\u9002\u7528\u7684\u4e0a\u4e0b\u6587\u548c\u4e0d\u540c\u64cd\u4f5c\u7ea7\u522b\u4e0a\u6709\u6240\u4e0d\u540c\uff1a \u7ba1\u7406\u6743\u9650\u4f7f\u7528\u6237\u80fd\u591f\u7ba1\u7406MySQL\u670d\u52a1\u5668\u7684\u64cd\u4f5c\u3002\u8fd9\u4e9b\u6743\u9650\u662f\u5168\u5c40\u7684\uff0c\u56e0\u4e3a\u5b83\u4eec\u4e0d\u662f\u7279\u5b9a\u4e8e\u7279\u5b9a\u6570\u636e\u5e93\u7684\u3002 \u6570\u636e\u5e93\u6743\u9650\u9002\u7528\u4e8e\u6570\u636e\u5e93\u53ca\u5176\u4e2d\u7684\u6240\u6709\u5bf9\u8c61\u3002\u53ef\u4ee5\u4e3a\u7279\u5b9a\u6570\u636e\u5e93\u6216\u5168\u5c40\u6388\u4e88\u8fd9\u4e9b\u6743\u9650\uff0c\u4ee5\u4fbf\u5b83\u4eec\u9002\u7528\u4e8e\u6240\u6709\u6570\u636e\u5e93\u3002 \u53ef\u4ee5\u4e3a\u6570\u636e\u5e93\u4e2d\u7684\u7279\u5b9a\u5bf9\u8c61\uff0c\u6570\u636e\u5e93\u4e2d\u7ed9\u5b9a\u7c7b\u578b\u7684\u6240\u6709\u5bf9\u8c61\uff08\u4f8b\u5982\uff0c\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u8868\uff09\u6216\u5168\u5c40\u7684\u6240\u6709\u5bf9\u8c61\u6388\u4e88\u6570\u636e\u5e93\u5bf9\u8c61\uff08\u5982\u8868\uff0c\u7d22\u5f15\uff0c\u89c6\u56fe\u548c\u5b58\u50a8\u4f8b\u7a0b\uff09\u7684\u6743\u9650\u3002\u6240\u6709\u6570\u636e\u5e93\u4e2d\u7ed9\u5b9a\u7c7b\u578b\u7684\u5bf9\u8c61 \u7528\u6237\u6743\u9650\u7ba1\u7406\u4e3b\u8981\u6709\u4ee5\u4e0b\u4f5c\u7528 \u53ef\u4ee5\u9650\u5236\u7528\u6237\u8bbf\u95ee\u54ea\u4e9b\u5e93\u3001\u54ea\u4e9b\u8868 \u53ef\u4ee5\u9650\u5236\u7528\u6237\u5bf9\u54ea\u4e9b\u8868\u6267\u884cSELECT\u3001CREATE\u3001DELETE\u3001DELETE\u3001ALTER\u7b49\u64cd\u4f5c \u53ef\u4ee5\u9650\u5236\u7528\u6237\u767b\u5f55\u7684IP\u6216\u57df\u540d \u53ef\u4ee5\u9650\u5236\u7528\u6237\u81ea\u5df1\u7684\u6743\u9650\u662f\u5426\u53ef\u4ee5\u6388\u6743\u7ed9\u522b\u7684\u7528\u6237 1.1 \u6388\u6743 \u00b6 MySQL \u8d4b\u4e88\u7528\u6237\u6743\u9650\u547d\u4ee4\u7684\u7b80\u5355\u683c\u5f0f\u53ef\u6982\u62ec\u4e3a\uff1a grant \u6743\u9650 on \u6570\u636e\u5e93\u5bf9\u8c61 to \u7528\u6237 \u5bc6\u7801 \u5176\u4ed6 \u4f8b\u5b50 mysql> grant all privileges on *.* to 'caimengzhi'@'%' identified by 'caimengzhi123456' with grant option; \u53c2\u6570\u89e3\u91ca 1. all privileges \uff1a\u8868\u793a\u5c06\u6240\u6709\u6743\u9650\u6388\u4e88\u7ed9\u7528\u6237\u3002\u4e5f\u53ef\u6307\u5b9a\u5177\u4f53\u7684\u6743\u9650\uff0c\u5982\uff1a SELECT \u3001 CREATE \u3001 DROP\u7b49 \u3002 2. on \uff1a\u8868\u793a\u8fd9\u4e9b\u6743\u9650\u5bf9\u54ea\u4e9b\u6570\u636e\u5e93\u548c\u8868\u751f\u6548\uff0c\u683c\u5f0f\uff1a\u6570\u636e\u5e93\u540d . \u8868\u540d\uff0c\u8fd9\u91cc\u5199\u201c * \u201d\u8868\u793a\u6240\u6709\u6570\u636e\u5e93\uff0c\u6240\u6709\u8868\u3002\u5982\u679c\u6211\u8981\u6307\u5b9a\u5c06\u6743\u9650\u5e94\u7528\u5230 test\u5e93\u7684user\u8868\u4e2d \uff0c\u53ef\u4ee5\u8fd9\u4e48\u5199\uff1a test . user 3. to \uff1a\u5c06\u6743\u9650\u6388\u4e88\u54ea\u4e2a\u7528\u6237\u3002\u683c\u5f0f\uff1a\u201d\u7528\u6237\u540d\u201d@\u201d\u767b\u5f55 IP\u6216\u57df\u540d \u201d\u3002 % \u8868\u793a\u6ca1\u6709\u9650\u5236\uff0c\u5728\u4efb\u4f55\u4e3b\u673a\u90fd\u53ef\u4ee5\u767b\u5f55\u3002\u6bd4\u5982\uff1a 'caimengzhi' @ '192.168.0.%' \uff0c\u8868\u793a caimengzhi\u8fd9\u4e2a\u7528\u6237\u53ea\u80fd\u5728192 . 168.0 \u8be5 IP\u6bb5\u767b\u5f55 4. identified by \uff1a\u6307\u5b9a\u7528\u6237\u7684\u767b\u5f55\u5bc6\u7801 5. with grant option \uff1a\u8868\u793a\u5141\u8bb8\u7528\u6237\u5c06\u81ea\u5df1\u7684\u6743\u9650\u6388\u6743\u7ed9\u5176\u5b83\u7528\u6237\uff0c\u4e00\u822c\u7528\u4e0d\u5230\uff0c\u6700\u597d\u6709 BDA\u7edf\u4e00\u7ba1\u7406 \u3002 6. \u53ef\u4ee5\u4f7f\u7528 GRANT\u7ed9\u7528\u6237\u6dfb\u52a0\u6743\u9650 \uff0c\u6743\u9650\u4f1a\u81ea\u52a8\u53e0\u52a0\uff0c\u4e0d\u4f1a\u8986\u76d6\u4e4b\u524d\u6388\u4e88\u7684\u6743\u9650\uff0c\u6bd4\u5982\u4f60\u5148\u7ed9\u7528\u6237\u6dfb\u52a0\u4e00\u4e2a SELECT\u6743\u9650 \uff0c\u540e\u6765\u53c8\u7ed9\u7528\u6237\u6dfb\u52a0\u4e86\u4e00\u4e2a INSERT\u6743\u9650 \uff0c\u90a3\u4e48\u8be5\u7528\u6237\u5c31\u540c\u65f6\u62e5\u6709\u4e86 SELECT\u548cINSERT\u6743\u9650 \u3002 \u4f20\u9001\u95e8 - \u7528\u6237\u8be6\u60c5\u7684\u6743\u9650\u5217\u8868\u8bf7\u53c2\u8003MySQL\u5b98\u7f51\u8bf4\u660e 2. \u6848\u4f8b \u00b6 2.1 \u6388\u6743select\u6743\u9650 \u00b6 mysql> grant select on db1.* to 'cmz'@'%' identified by 'cmz'; Query OK, 0 rows affected, 1 warning (0.01 sec) 2.2 \u67e5\u770b\u6388\u4e88\u7684\u6743\u9650 \u00b6 mysql> show grants for 'cmz'@'%'; +--------------------------------------+ | Grants for cmz@% | +--------------------------------------+ | GRANT USAGE ON *.* TO 'cmz'@'%' | | GRANT SELECT ON `db1`.* TO 'cmz'@'%' | +--------------------------------------+ 2 rows in set (0.00 sec) 2.3 \u7528\u6237\u767b\u5f55\u9a8c\u8bc1 \u00b6 root@leco:/home/leco# mysql -ucmz -pcmz mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 56 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | db1 | +--------------------+ 2 rows in set (0.00 sec) mysql> use db1; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | t1 | +---------------+ 1 row in set (0.01 sec) mysql> select * from t1; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5c0f\u660e | male | 18 | | 2 | \u5c0f\u7ea2 | female | 20 | | 3 | \u5c0f\u5f3a | male | 30 | | 4 | \u5f20\u4e09 | female | 28 | +------+--------+--------+------+ 4 rows in set (0.00 sec) mysql> drop table t1; ERROR 1142 (42000): DROP command denied to user 'cmz'@'localhost' for table 't1' mysql> truncate t1; ERROR 1142 (42000): DROP command denied to user 'cmz'@'localhost' for table 't1 \u4ece\u4e0a\u9762\u53ea\u80fd\u770b\u5230\uff0c\u9664\u4e86select\u548cshow\u7684\u5176\u4ed6\u57fa\u672c\u6743\u9650\u90fd\u4e48\u6709\u4e86\u3002 \u7ee7\u7eed\u6dfb\u52a0\u6743\u9650 mysql> grant create on db1.* to 'cmz'@'%'; Query OK, 0 rows affected (0.01 sec) mysql> show grants for 'cmz'@'%'; +----------------------------------------------+ | Grants for cmz@% | +----------------------------------------------+ | GRANT USAGE ON *.* TO 'cmz'@'%' | | GRANT SELECT, CREATE ON `db1`.* TO 'cmz'@'%' | +----------------------------------------------+ 2 rows in set (0.00 sec) \u4ece\u4e0a\u9762\u770b\u5230\u6743\u9650\u662f\u7d2f\u52a0\u7684\u3002\u7c7b\u4f3c\u4ee5\u4e0b grant select on db1.* to 'cmz'@'%'; grant insert on db1.* to 'cmz'@'%'; grant update on db1.* to 'cmz'@'%'; grant delete on db1.* to 'cmz'@'%'; \u7b49\u4ef7\u4e8e grant select,insert,update,delete on db1.* to 'cmz'@'%'; 3. \u5176\u4ed6\u6388\u6743 \u00b6 3.1 \u6388\u6743\u6240\u6709\u5e93 \u00b6 grant all privileges on *.* to 'cmz'@'%' identified by 'cmz'; privileges \u53ef\u4ee5\u7701\u7565 cmz\u8d26\u53f7\uff0c\u7ba1\u7406\u6570\u636e\u5e93\u91cc\u9762\u6240\u6709\u5e93\u548c\u8868\u3002 3.2 \u6388\u6743\u6240\u6709\u67d0\u5e93\u6240\u6709\u8868 \u00b6 grant all privileges on db.* to 'cmz'@'%' identified by 'cmz'; cmz\u8d26\u53f7\uff0c\u7ba1\u7406db\u5e93\u4e0b\u9762\u6240\u6709\u8868\u3002 3.3 \u6388\u6743\u6240\u6709\u67d0\u5e93\u67d0\u8868 \u00b6 grant all privileges on db.table1 to 'cmz'@'%' identified by 'cmz'; cmz\u8d26\u53f7\uff0c\u7ba1\u7406db\u5e93\u4e0b\u7684table1\u8868\u3002 3.4 \u4e3b\u4ece\u8d26\u53f7 \u00b6 mysql> grant replication slave on *.* to 'repl'@'%' identified by 'repl';","title":"20. SQL GRANT"},{"location":"mysql/mysql.grant/#1","text":"\u6388\u4e88MySQL\u5e10\u6237\u7684\u6743\u9650\u51b3\u5b9a\u4e86\u5e10\u6237\u53ef\u4ee5\u6267\u884c\u7684\u64cd\u4f5c\u3002MySQL\u6743\u9650\u5728\u5b83\u4eec\u9002\u7528\u7684\u4e0a\u4e0b\u6587\u548c\u4e0d\u540c\u64cd\u4f5c\u7ea7\u522b\u4e0a\u6709\u6240\u4e0d\u540c\uff1a \u7ba1\u7406\u6743\u9650\u4f7f\u7528\u6237\u80fd\u591f\u7ba1\u7406MySQL\u670d\u52a1\u5668\u7684\u64cd\u4f5c\u3002\u8fd9\u4e9b\u6743\u9650\u662f\u5168\u5c40\u7684\uff0c\u56e0\u4e3a\u5b83\u4eec\u4e0d\u662f\u7279\u5b9a\u4e8e\u7279\u5b9a\u6570\u636e\u5e93\u7684\u3002 \u6570\u636e\u5e93\u6743\u9650\u9002\u7528\u4e8e\u6570\u636e\u5e93\u53ca\u5176\u4e2d\u7684\u6240\u6709\u5bf9\u8c61\u3002\u53ef\u4ee5\u4e3a\u7279\u5b9a\u6570\u636e\u5e93\u6216\u5168\u5c40\u6388\u4e88\u8fd9\u4e9b\u6743\u9650\uff0c\u4ee5\u4fbf\u5b83\u4eec\u9002\u7528\u4e8e\u6240\u6709\u6570\u636e\u5e93\u3002 \u53ef\u4ee5\u4e3a\u6570\u636e\u5e93\u4e2d\u7684\u7279\u5b9a\u5bf9\u8c61\uff0c\u6570\u636e\u5e93\u4e2d\u7ed9\u5b9a\u7c7b\u578b\u7684\u6240\u6709\u5bf9\u8c61\uff08\u4f8b\u5982\uff0c\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u8868\uff09\u6216\u5168\u5c40\u7684\u6240\u6709\u5bf9\u8c61\u6388\u4e88\u6570\u636e\u5e93\u5bf9\u8c61\uff08\u5982\u8868\uff0c\u7d22\u5f15\uff0c\u89c6\u56fe\u548c\u5b58\u50a8\u4f8b\u7a0b\uff09\u7684\u6743\u9650\u3002\u6240\u6709\u6570\u636e\u5e93\u4e2d\u7ed9\u5b9a\u7c7b\u578b\u7684\u5bf9\u8c61 \u7528\u6237\u6743\u9650\u7ba1\u7406\u4e3b\u8981\u6709\u4ee5\u4e0b\u4f5c\u7528 \u53ef\u4ee5\u9650\u5236\u7528\u6237\u8bbf\u95ee\u54ea\u4e9b\u5e93\u3001\u54ea\u4e9b\u8868 \u53ef\u4ee5\u9650\u5236\u7528\u6237\u5bf9\u54ea\u4e9b\u8868\u6267\u884cSELECT\u3001CREATE\u3001DELETE\u3001DELETE\u3001ALTER\u7b49\u64cd\u4f5c \u53ef\u4ee5\u9650\u5236\u7528\u6237\u767b\u5f55\u7684IP\u6216\u57df\u540d \u53ef\u4ee5\u9650\u5236\u7528\u6237\u81ea\u5df1\u7684\u6743\u9650\u662f\u5426\u53ef\u4ee5\u6388\u6743\u7ed9\u522b\u7684\u7528\u6237","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.grant/#11","text":"MySQL \u8d4b\u4e88\u7528\u6237\u6743\u9650\u547d\u4ee4\u7684\u7b80\u5355\u683c\u5f0f\u53ef\u6982\u62ec\u4e3a\uff1a grant \u6743\u9650 on \u6570\u636e\u5e93\u5bf9\u8c61 to \u7528\u6237 \u5bc6\u7801 \u5176\u4ed6 \u4f8b\u5b50 mysql> grant all privileges on *.* to 'caimengzhi'@'%' identified by 'caimengzhi123456' with grant option; \u53c2\u6570\u89e3\u91ca 1. all privileges \uff1a\u8868\u793a\u5c06\u6240\u6709\u6743\u9650\u6388\u4e88\u7ed9\u7528\u6237\u3002\u4e5f\u53ef\u6307\u5b9a\u5177\u4f53\u7684\u6743\u9650\uff0c\u5982\uff1a SELECT \u3001 CREATE \u3001 DROP\u7b49 \u3002 2. on \uff1a\u8868\u793a\u8fd9\u4e9b\u6743\u9650\u5bf9\u54ea\u4e9b\u6570\u636e\u5e93\u548c\u8868\u751f\u6548\uff0c\u683c\u5f0f\uff1a\u6570\u636e\u5e93\u540d . \u8868\u540d\uff0c\u8fd9\u91cc\u5199\u201c * \u201d\u8868\u793a\u6240\u6709\u6570\u636e\u5e93\uff0c\u6240\u6709\u8868\u3002\u5982\u679c\u6211\u8981\u6307\u5b9a\u5c06\u6743\u9650\u5e94\u7528\u5230 test\u5e93\u7684user\u8868\u4e2d \uff0c\u53ef\u4ee5\u8fd9\u4e48\u5199\uff1a test . user 3. to \uff1a\u5c06\u6743\u9650\u6388\u4e88\u54ea\u4e2a\u7528\u6237\u3002\u683c\u5f0f\uff1a\u201d\u7528\u6237\u540d\u201d@\u201d\u767b\u5f55 IP\u6216\u57df\u540d \u201d\u3002 % \u8868\u793a\u6ca1\u6709\u9650\u5236\uff0c\u5728\u4efb\u4f55\u4e3b\u673a\u90fd\u53ef\u4ee5\u767b\u5f55\u3002\u6bd4\u5982\uff1a 'caimengzhi' @ '192.168.0.%' \uff0c\u8868\u793a caimengzhi\u8fd9\u4e2a\u7528\u6237\u53ea\u80fd\u5728192 . 168.0 \u8be5 IP\u6bb5\u767b\u5f55 4. identified by \uff1a\u6307\u5b9a\u7528\u6237\u7684\u767b\u5f55\u5bc6\u7801 5. with grant option \uff1a\u8868\u793a\u5141\u8bb8\u7528\u6237\u5c06\u81ea\u5df1\u7684\u6743\u9650\u6388\u6743\u7ed9\u5176\u5b83\u7528\u6237\uff0c\u4e00\u822c\u7528\u4e0d\u5230\uff0c\u6700\u597d\u6709 BDA\u7edf\u4e00\u7ba1\u7406 \u3002 6. \u53ef\u4ee5\u4f7f\u7528 GRANT\u7ed9\u7528\u6237\u6dfb\u52a0\u6743\u9650 \uff0c\u6743\u9650\u4f1a\u81ea\u52a8\u53e0\u52a0\uff0c\u4e0d\u4f1a\u8986\u76d6\u4e4b\u524d\u6388\u4e88\u7684\u6743\u9650\uff0c\u6bd4\u5982\u4f60\u5148\u7ed9\u7528\u6237\u6dfb\u52a0\u4e00\u4e2a SELECT\u6743\u9650 \uff0c\u540e\u6765\u53c8\u7ed9\u7528\u6237\u6dfb\u52a0\u4e86\u4e00\u4e2a INSERT\u6743\u9650 \uff0c\u90a3\u4e48\u8be5\u7528\u6237\u5c31\u540c\u65f6\u62e5\u6709\u4e86 SELECT\u548cINSERT\u6743\u9650 \u3002 \u4f20\u9001\u95e8 - \u7528\u6237\u8be6\u60c5\u7684\u6743\u9650\u5217\u8868\u8bf7\u53c2\u8003MySQL\u5b98\u7f51\u8bf4\u660e","title":"1.1 \u6388\u6743"},{"location":"mysql/mysql.grant/#2","text":"","title":"2. \u6848\u4f8b"},{"location":"mysql/mysql.grant/#21-select","text":"mysql> grant select on db1.* to 'cmz'@'%' identified by 'cmz'; Query OK, 0 rows affected, 1 warning (0.01 sec)","title":"2.1 \u6388\u6743select\u6743\u9650"},{"location":"mysql/mysql.grant/#22","text":"mysql> show grants for 'cmz'@'%'; +--------------------------------------+ | Grants for cmz@% | +--------------------------------------+ | GRANT USAGE ON *.* TO 'cmz'@'%' | | GRANT SELECT ON `db1`.* TO 'cmz'@'%' | +--------------------------------------+ 2 rows in set (0.00 sec)","title":"2.2 \u67e5\u770b\u6388\u4e88\u7684\u6743\u9650"},{"location":"mysql/mysql.grant/#23","text":"root@leco:/home/leco# mysql -ucmz -pcmz mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 56 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | db1 | +--------------------+ 2 rows in set (0.00 sec) mysql> use db1; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | t1 | +---------------+ 1 row in set (0.01 sec) mysql> select * from t1; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5c0f\u660e | male | 18 | | 2 | \u5c0f\u7ea2 | female | 20 | | 3 | \u5c0f\u5f3a | male | 30 | | 4 | \u5f20\u4e09 | female | 28 | +------+--------+--------+------+ 4 rows in set (0.00 sec) mysql> drop table t1; ERROR 1142 (42000): DROP command denied to user 'cmz'@'localhost' for table 't1' mysql> truncate t1; ERROR 1142 (42000): DROP command denied to user 'cmz'@'localhost' for table 't1 \u4ece\u4e0a\u9762\u53ea\u80fd\u770b\u5230\uff0c\u9664\u4e86select\u548cshow\u7684\u5176\u4ed6\u57fa\u672c\u6743\u9650\u90fd\u4e48\u6709\u4e86\u3002 \u7ee7\u7eed\u6dfb\u52a0\u6743\u9650 mysql> grant create on db1.* to 'cmz'@'%'; Query OK, 0 rows affected (0.01 sec) mysql> show grants for 'cmz'@'%'; +----------------------------------------------+ | Grants for cmz@% | +----------------------------------------------+ | GRANT USAGE ON *.* TO 'cmz'@'%' | | GRANT SELECT, CREATE ON `db1`.* TO 'cmz'@'%' | +----------------------------------------------+ 2 rows in set (0.00 sec) \u4ece\u4e0a\u9762\u770b\u5230\u6743\u9650\u662f\u7d2f\u52a0\u7684\u3002\u7c7b\u4f3c\u4ee5\u4e0b grant select on db1.* to 'cmz'@'%'; grant insert on db1.* to 'cmz'@'%'; grant update on db1.* to 'cmz'@'%'; grant delete on db1.* to 'cmz'@'%'; \u7b49\u4ef7\u4e8e grant select,insert,update,delete on db1.* to 'cmz'@'%';","title":"2.3 \u7528\u6237\u767b\u5f55\u9a8c\u8bc1"},{"location":"mysql/mysql.grant/#3","text":"","title":"3. \u5176\u4ed6\u6388\u6743"},{"location":"mysql/mysql.grant/#31","text":"grant all privileges on *.* to 'cmz'@'%' identified by 'cmz'; privileges \u53ef\u4ee5\u7701\u7565 cmz\u8d26\u53f7\uff0c\u7ba1\u7406\u6570\u636e\u5e93\u91cc\u9762\u6240\u6709\u5e93\u548c\u8868\u3002","title":"3.1 \u6388\u6743\u6240\u6709\u5e93"},{"location":"mysql/mysql.grant/#32","text":"grant all privileges on db.* to 'cmz'@'%' identified by 'cmz'; cmz\u8d26\u53f7\uff0c\u7ba1\u7406db\u5e93\u4e0b\u9762\u6240\u6709\u8868\u3002","title":"3.2 \u6388\u6743\u6240\u6709\u67d0\u5e93\u6240\u6709\u8868"},{"location":"mysql/mysql.grant/#33","text":"grant all privileges on db.table1 to 'cmz'@'%' identified by 'cmz'; cmz\u8d26\u53f7\uff0c\u7ba1\u7406db\u5e93\u4e0b\u7684table1\u8868\u3002","title":"3.3 \u6388\u6743\u6240\u6709\u67d0\u5e93\u67d0\u8868"},{"location":"mysql/mysql.grant/#34","text":"mysql> grant replication slave on *.* to 'repl'@'%' identified by 'repl';","title":"3.4 \u4e3b\u4ece\u8d26\u53f7"},{"location":"mysql/mysql.in/","text":"MySQL IN 1. \u4ecb\u7ecd \u00b6 1.1 \u73af\u5883\u51c6\u5907 \u00b6 drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); insert into info(name,age,score) values(\"\u674e\u56db\",20,55); insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.03 sec) mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.05 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) 2. \u5f00\u59cb \u00b6 2.1 \u8bed\u6cd5 \u00b6 IN \u64cd\u4f5c\u7b26\u5141\u8bb8\u6211\u4eec\u5728 WHERE \u5b50\u53e5\u4e2d\u89c4\u5b9a\u591a\u4e2a\u503c\u3002 SELECT column_name(s) FROM table_name WHERE column_name IN (value1,value2,...) 2.2 \u64cd\u4f5c \u00b6 \u67e5\u8be2\u5e74\u9f84\u662f18,29,20,30\u7684\u4eba\u5458\u4fe1\u606f mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> select * from info where age in (18,29,20,30); +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | +----+--------+-----+-------+ 3 rows in set (0.00 sec)","title":"17. SQL IN"},{"location":"mysql/mysql.in/#1","text":"","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.in/#11","text":"drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); insert into info(name,age,score) values(\"\u674e\u56db\",20,55); insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.03 sec) mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.05 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec)","title":"1.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.in/#2","text":"","title":"2. \u5f00\u59cb"},{"location":"mysql/mysql.in/#21","text":"IN \u64cd\u4f5c\u7b26\u5141\u8bb8\u6211\u4eec\u5728 WHERE \u5b50\u53e5\u4e2d\u89c4\u5b9a\u591a\u4e2a\u503c\u3002 SELECT column_name(s) FROM table_name WHERE column_name IN (value1,value2,...)","title":"2.1 \u8bed\u6cd5"},{"location":"mysql/mysql.in/#22","text":"\u67e5\u8be2\u5e74\u9f84\u662f18,29,20,30\u7684\u4eba\u5458\u4fe1\u606f mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> select * from info where age in (18,29,20,30); +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | +----+--------+-----+-------+ 3 rows in set (0.00 sec)","title":"2.2 \u64cd\u4f5c"},{"location":"mysql/mysql.increment/","text":"MySQL AUTO INCREMENT 1. \u4ecb\u7ecd \u00b6 Auto-increment \u4f1a\u5728\u65b0\u8bb0\u5f55\u63d2\u5165\u8868\u4e2d\u65f6\u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684\u6570\u5b57\u3002 \u6211\u4eec\u901a\u5e38\u5e0c\u671b\u5728\u6bcf\u6b21\u63d2\u5165\u65b0\u8bb0\u5f55\u65f6\u81ea\u52a8\u521b\u5efa\u4e3b\u952e\u5b57\u6bb5\u7684\u503c\u3002\u6211\u4eec\u53ef\u4ee5\u5728\u8868\u4e2d\u521b\u5efa\u4e00\u4e2a\u81ea\u52a8\u589e\u91cf\uff08auto-increment\uff09\u5b57\u6bb5\u3002 1. \u64cd\u4f5c \u00b6 1.1 \u4e0d\u8bbe\u7f6e\u5b57\u6bb5id \u00b6 \u4ee5\u4e0bSQL\u8bed\u53e5\u5c06info\u8868\u4e2d\u7684id\u5217\u5b9a\u4e49\u4e3a\u81ea\u52a8\u9012\u589e\uff08auto-increment\uff09\u4e3b\u952e\u5b57\u6bb5\uff1a drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); insert into info(name,age,score) values(\"\u674e\u56db\",20,55); insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.03 sec) mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.05 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> desc info; +-------+-------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | varchar(20) | YES | | NULL | | | age | int(11) | NO | | NULL | | | score | int(11) | NO | | NULL | | +-------+-------------+------+-----+---------+----------------+ 4 rows in set (0.00 sec) \u6211\u4eec\u80fd\u770b\u5230\u7b2c6\u5217\u4e5f\u5c31\u662fExtra\u90a3\u4e00\u5217\uff0c\u53ea\u6709id\u662f\u6709auto_increment\uff0c\u6709\u8fd9\u4e2aauto_increment\u5c31\u662f\u8868\u793a\u8be5\u5b57\u6bb5\u662f\u8868\u5b57\u6bb5\uff0cinsert\u7684\u65f6\u5019\u53ef\u4ee5\u4e0d\u8bbe\u7f6e\u3002\u4e0d\u8bbe\u7f6e\u7684\u8bdd\uff0c\u6bcf\u6b21\u6b65\u957f\u662f\u6839\u636emysql\u7684\u914d\u7f6e\u5b57\u6bb5\u914d\u7f6e\u3002\u9ed8\u8ba4\u662f1. 1.1.1 \u4e34\u65f6\u4fee\u6539\u6b65\u957f \u00b6 mysql> SHOW VARIABLES LIKE 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 1 | # \u67e5\u770b\u6b65\u957f | auto_increment_offset | 1 | +--------------------------+-------+ 2 rows in set (0.01 sec) \u914d\u7f6e\u81ea\u589e\u6b65\u957f\uff0c\u6570\u636e\u8868\u81ea\u589e\u5c06\u4ee510\u4e3a\u95f4\u9694\u81ea\u589e\u3002 mysql> SET @@auto_increment_increment=10; Query OK, 0 rows affected (0.00 sec) mysql> SHOW VARIABLES LIKE 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 10 | # \u6b65\u957f\u88ab\u8bbe\u7f6e\u4e8610\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u63d2\u5165\u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u522b\u524d\u4e00\u4e2aid\u7684\u57fa\u7840\u4e0a\u52a0\u4e0a\u8fd9\u4e2a\u6b65\u957f10 | auto_increment_offset | 1 | +--------------------------+-------+ 2 rows in set (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> insert into info(name,age,score) values(\"\u5218\u4e03\",30,66); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | | 11 | \u5218\u4e03 | 30 | 66 | +----+--------+-----+-------+ 6 rows in set (0.00 sec) \u5982\u679c\u4ee5\u4e0a\u65b9\u6cd5\u8fd8\u4e0d\u751f\u6548\uff0c\u6216\u8005\u91cd\u542fmysql\u540e\uff0c\u53c8\u53d8\u56de\u6765\u4e86\u3002\u90a3\u80af\u5b9a\u662f\u5728my.cnf\u91cc\u9762\u8bbe\u7f6e\u4e86\u5168\u5c40\u53d8\u91cf\u3002\u8fd9\u4e2a\u5fc5\u987b\u5230\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u53bb\u4fee\u6539\u4e86\uff1b\u8fd9\u79cd\u4fee\u6539\u6c38\u4e45\u6709\u6548\u3002\u800c\u4e14\u65e0\u6cd5\u901a\u8fc7\u4e0a\u9762\u7684\u64cd\u4f5c\u518d\u6b21\u88ab\u4fee\u6539\u3002 1.1.2 \u6c38\u4e45\u4fee\u6539\u6b65\u957f \u00b6 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u91cd\u542fmysql root@leco:/etc/mysql/mysql.conf.d# pwd /etc/mysql/mysql.conf.d root@leco:/etc/mysql/mysql.conf.d# egrep -v '#|^$' mysqld.cnf [mysqld_safe] socket = /var/run/mysqld/mysqld.sock nice = 0 [mysqld] user = mysql pid-file = /var/run/mysqld/mysqld.pid socket = /var/run/mysqld/mysqld.sock port = 3306 basedir = /usr datadir = /var/lib/mysql tmpdir = /tmp lc-messages-dir = /usr/share/mysql skip-external-locking auto_increment_increment = 2 key_buffer_size = 16M max_allowed_packet = 16M thread_stack = 192K thread_cache_size = 8 myisam-recover-options = BACKUP query_cache_limit = 1M query_cache_size = 16M log_error = /var/log/mysql/error.log expire_logs_days = 10 max_binlog_size = 100M [mysql] auto-rehash # \u91cd\u542f root@leco:/etc/mysql/mysql.conf.d# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service. \u6ce8\u610f 1. \u4e00\u70b9\u8981\u627e\u5230 mysql\u7684\u914d\u7f6e \uff0c\u4e0d\u540c\u7248\u672c\u7684 mysql \u3002\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\u7a0d\u5fae\u6709\u70b9\u4e0d\u540c 2. \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 mysqld\u4e0b\u914d\u7f6e 3. \u914d\u7f6e\u5b8c\u6bd5\u540e\u91cd\u542f mysql \u6d4b\u8bd5 mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | | 11 | \u5218\u4e03 | 30 | 66 | +----+--------+-----+-------+ 6 rows in set (0.00 sec) mysql> insert into info(name,age,score) values(\"\u845b\u5927\u7237\",30,66); Query OK, 1 row affected (0.01 sec) mysql> select * from info; +----+-----------+-----+-------+ | id | name | age | score | +----+-----------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | | 11 | \u5218\u4e03 | 30 | 66 | | 13 | \u845b\u5927\u7237 | 30 | 66 | +----+-----------+-----+-------+ 7 rows in set (0.00 sec) \u4ece\u7ed3\u679c\u6765\u770b\uff0c\u6211\u65b0\u589e\u7684\u845b\u5927\u7237\u7684id\u662f\u5728\u516d\u4e03\u7684id=11\u7684\u57fa\u7840\u4e0a\u52a0\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u7684\u6b65\u957f2 \u4e5f\u5c31\u662f\u7b49\u4e8e13\uff0c\u5b8c\u7f8e\u3002 1.2 \u8bbe\u7f6e\u81ea\u589eid \u00b6 drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); insert into info(name,age,score) values(\"\u674e\u56db\",20,55); insert into info(id,name,age,score) values(100,\"\u738b\u4e94\",30,89); insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); \u8fd8\u539fmysql\u7684\u6b65\u957f\uff0c\u4e5f\u5c31\u662f\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u53bb\u6389\u90a3\u4e2a\u6b65\u957f\u914d\u7f6e\u3002\u91cd\u542f\u3002 \u64cd\u4f5c\u8fc7\u7a0b root@leco:/etc/mysql/mysql.conf.d# mysql -uroot -proot mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 3 Server version: 5.7.25-0ubuntu0.16.04.2 (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use cmz; # \u9009\u62e9\u5e93 Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> drop table info; # \u5220\u9664\u8868\uff0c\u4f7f\u7528\u65b0\u7684\u8868\u3002 Query OK, 0 rows affected (0.03 sec) mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.05 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); ,age,score) values(\"\u8d75\u516d\",40,77);Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); Query OK, 1 row affected (0.01 sec) mysql> insert into info(name,age,score) values(\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.02 sec) mysql> insert into info(id,name,age,score) values(100,\"\u738b\u4e94\",30,89); Query OK, 1 row affected (0.01 sec) mysql> insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +-----+--------+-----+-------+ | id | name | age | score | +-----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 100 | \u738b\u4e94 | 30 | 89 | | 101 | \u8d75\u516d | 40 | 77 | +-----+--------+-----+-------+ 5 rows in set (0.00 sec) \u4ece\u4e0a\u9762\u7ed3\u679c\u770b\u51fa\uff0c\u6211\u4eec\u5728\u4e0d\u8bbe\u7f6e\u6b65\u957f\u7684\u65f6\u5019\uff0c\u6bcf\u6b21\u63d2\u5165\u6570\u636e\u7684\u65f6\u5019\uff0cid\u90fd\u662f\u9ed8\u8ba4\u81ea\u52a8\u589e\u957f1\uff0c\u800c\u6211\u4eec\u8ba4\u4e3a\u8bbe\u7f6eid\uff08insert into info(id,name,age,score) values(100,\"\u738b\u4e94\",30,89);\uff09\u540e\uff0c\u6bcf\u6b21\u90fd\u4f1a\u57fa\u4e8e\u8bbe\u7f6e\u7684id\u81ea\u589e\u957f\u3002 \u5220\u9664 \u4ee5\u4e0a\u7684\u5220\u9664\uff0c\u4fee\u6539\u7b49\u64cd\u4f5c\uff0c\u5728\u6b63\u5f0f\u73af\u5883\u4e0a\u8bf7\u914c\u60c5\u4f7f\u7528\u3002","title":"2. SQL INCREMENT"},{"location":"mysql/mysql.increment/#1","text":"Auto-increment \u4f1a\u5728\u65b0\u8bb0\u5f55\u63d2\u5165\u8868\u4e2d\u65f6\u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684\u6570\u5b57\u3002 \u6211\u4eec\u901a\u5e38\u5e0c\u671b\u5728\u6bcf\u6b21\u63d2\u5165\u65b0\u8bb0\u5f55\u65f6\u81ea\u52a8\u521b\u5efa\u4e3b\u952e\u5b57\u6bb5\u7684\u503c\u3002\u6211\u4eec\u53ef\u4ee5\u5728\u8868\u4e2d\u521b\u5efa\u4e00\u4e2a\u81ea\u52a8\u589e\u91cf\uff08auto-increment\uff09\u5b57\u6bb5\u3002","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.increment/#1_1","text":"","title":"1. \u64cd\u4f5c"},{"location":"mysql/mysql.increment/#11-id","text":"\u4ee5\u4e0bSQL\u8bed\u53e5\u5c06info\u8868\u4e2d\u7684id\u5217\u5b9a\u4e49\u4e3a\u81ea\u52a8\u9012\u589e\uff08auto-increment\uff09\u4e3b\u952e\u5b57\u6bb5\uff1a drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); insert into info(name,age,score) values(\"\u674e\u56db\",20,55); insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.03 sec) mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.05 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> desc info; +-------+-------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | varchar(20) | YES | | NULL | | | age | int(11) | NO | | NULL | | | score | int(11) | NO | | NULL | | +-------+-------------+------+-----+---------+----------------+ 4 rows in set (0.00 sec) \u6211\u4eec\u80fd\u770b\u5230\u7b2c6\u5217\u4e5f\u5c31\u662fExtra\u90a3\u4e00\u5217\uff0c\u53ea\u6709id\u662f\u6709auto_increment\uff0c\u6709\u8fd9\u4e2aauto_increment\u5c31\u662f\u8868\u793a\u8be5\u5b57\u6bb5\u662f\u8868\u5b57\u6bb5\uff0cinsert\u7684\u65f6\u5019\u53ef\u4ee5\u4e0d\u8bbe\u7f6e\u3002\u4e0d\u8bbe\u7f6e\u7684\u8bdd\uff0c\u6bcf\u6b21\u6b65\u957f\u662f\u6839\u636emysql\u7684\u914d\u7f6e\u5b57\u6bb5\u914d\u7f6e\u3002\u9ed8\u8ba4\u662f1.","title":"1.1 \u4e0d\u8bbe\u7f6e\u5b57\u6bb5id"},{"location":"mysql/mysql.increment/#111","text":"mysql> SHOW VARIABLES LIKE 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 1 | # \u67e5\u770b\u6b65\u957f | auto_increment_offset | 1 | +--------------------------+-------+ 2 rows in set (0.01 sec) \u914d\u7f6e\u81ea\u589e\u6b65\u957f\uff0c\u6570\u636e\u8868\u81ea\u589e\u5c06\u4ee510\u4e3a\u95f4\u9694\u81ea\u589e\u3002 mysql> SET @@auto_increment_increment=10; Query OK, 0 rows affected (0.00 sec) mysql> SHOW VARIABLES LIKE 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 10 | # \u6b65\u957f\u88ab\u8bbe\u7f6e\u4e8610\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u63d2\u5165\u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u522b\u524d\u4e00\u4e2aid\u7684\u57fa\u7840\u4e0a\u52a0\u4e0a\u8fd9\u4e2a\u6b65\u957f10 | auto_increment_offset | 1 | +--------------------------+-------+ 2 rows in set (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> insert into info(name,age,score) values(\"\u5218\u4e03\",30,66); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | | 11 | \u5218\u4e03 | 30 | 66 | +----+--------+-----+-------+ 6 rows in set (0.00 sec) \u5982\u679c\u4ee5\u4e0a\u65b9\u6cd5\u8fd8\u4e0d\u751f\u6548\uff0c\u6216\u8005\u91cd\u542fmysql\u540e\uff0c\u53c8\u53d8\u56de\u6765\u4e86\u3002\u90a3\u80af\u5b9a\u662f\u5728my.cnf\u91cc\u9762\u8bbe\u7f6e\u4e86\u5168\u5c40\u53d8\u91cf\u3002\u8fd9\u4e2a\u5fc5\u987b\u5230\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u53bb\u4fee\u6539\u4e86\uff1b\u8fd9\u79cd\u4fee\u6539\u6c38\u4e45\u6709\u6548\u3002\u800c\u4e14\u65e0\u6cd5\u901a\u8fc7\u4e0a\u9762\u7684\u64cd\u4f5c\u518d\u6b21\u88ab\u4fee\u6539\u3002","title":"1.1.1 \u4e34\u65f6\u4fee\u6539\u6b65\u957f"},{"location":"mysql/mysql.increment/#112","text":"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u91cd\u542fmysql root@leco:/etc/mysql/mysql.conf.d# pwd /etc/mysql/mysql.conf.d root@leco:/etc/mysql/mysql.conf.d# egrep -v '#|^$' mysqld.cnf [mysqld_safe] socket = /var/run/mysqld/mysqld.sock nice = 0 [mysqld] user = mysql pid-file = /var/run/mysqld/mysqld.pid socket = /var/run/mysqld/mysqld.sock port = 3306 basedir = /usr datadir = /var/lib/mysql tmpdir = /tmp lc-messages-dir = /usr/share/mysql skip-external-locking auto_increment_increment = 2 key_buffer_size = 16M max_allowed_packet = 16M thread_stack = 192K thread_cache_size = 8 myisam-recover-options = BACKUP query_cache_limit = 1M query_cache_size = 16M log_error = /var/log/mysql/error.log expire_logs_days = 10 max_binlog_size = 100M [mysql] auto-rehash # \u91cd\u542f root@leco:/etc/mysql/mysql.conf.d# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service. \u6ce8\u610f 1. \u4e00\u70b9\u8981\u627e\u5230 mysql\u7684\u914d\u7f6e \uff0c\u4e0d\u540c\u7248\u672c\u7684 mysql \u3002\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\u7a0d\u5fae\u6709\u70b9\u4e0d\u540c 2. \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 mysqld\u4e0b\u914d\u7f6e 3. \u914d\u7f6e\u5b8c\u6bd5\u540e\u91cd\u542f mysql \u6d4b\u8bd5 mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | | 11 | \u5218\u4e03 | 30 | 66 | +----+--------+-----+-------+ 6 rows in set (0.00 sec) mysql> insert into info(name,age,score) values(\"\u845b\u5927\u7237\",30,66); Query OK, 1 row affected (0.01 sec) mysql> select * from info; +----+-----------+-----+-------+ | id | name | age | score | +----+-----------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | | 11 | \u5218\u4e03 | 30 | 66 | | 13 | \u845b\u5927\u7237 | 30 | 66 | +----+-----------+-----+-------+ 7 rows in set (0.00 sec) \u4ece\u7ed3\u679c\u6765\u770b\uff0c\u6211\u65b0\u589e\u7684\u845b\u5927\u7237\u7684id\u662f\u5728\u516d\u4e03\u7684id=11\u7684\u57fa\u7840\u4e0a\u52a0\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u7684\u6b65\u957f2 \u4e5f\u5c31\u662f\u7b49\u4e8e13\uff0c\u5b8c\u7f8e\u3002","title":"1.1.2 \u6c38\u4e45\u4fee\u6539\u6b65\u957f"},{"location":"mysql/mysql.increment/#12-id","text":"drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); insert into info(name,age,score) values(\"\u674e\u56db\",20,55); insert into info(id,name,age,score) values(100,\"\u738b\u4e94\",30,89); insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); \u8fd8\u539fmysql\u7684\u6b65\u957f\uff0c\u4e5f\u5c31\u662f\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u53bb\u6389\u90a3\u4e2a\u6b65\u957f\u914d\u7f6e\u3002\u91cd\u542f\u3002 \u64cd\u4f5c\u8fc7\u7a0b root@leco:/etc/mysql/mysql.conf.d# mysql -uroot -proot mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 3 Server version: 5.7.25-0ubuntu0.16.04.2 (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use cmz; # \u9009\u62e9\u5e93 Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> drop table info; # \u5220\u9664\u8868\uff0c\u4f7f\u7528\u65b0\u7684\u8868\u3002 Query OK, 0 rows affected (0.03 sec) mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.05 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); ,age,score) values(\"\u8d75\u516d\",40,77);Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); Query OK, 1 row affected (0.01 sec) mysql> insert into info(name,age,score) values(\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.02 sec) mysql> insert into info(id,name,age,score) values(100,\"\u738b\u4e94\",30,89); Query OK, 1 row affected (0.01 sec) mysql> insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +-----+--------+-----+-------+ | id | name | age | score | +-----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 100 | \u738b\u4e94 | 30 | 89 | | 101 | \u8d75\u516d | 40 | 77 | +-----+--------+-----+-------+ 5 rows in set (0.00 sec) \u4ece\u4e0a\u9762\u7ed3\u679c\u770b\u51fa\uff0c\u6211\u4eec\u5728\u4e0d\u8bbe\u7f6e\u6b65\u957f\u7684\u65f6\u5019\uff0c\u6bcf\u6b21\u63d2\u5165\u6570\u636e\u7684\u65f6\u5019\uff0cid\u90fd\u662f\u9ed8\u8ba4\u81ea\u52a8\u589e\u957f1\uff0c\u800c\u6211\u4eec\u8ba4\u4e3a\u8bbe\u7f6eid\uff08insert into info(id,name,age,score) values(100,\"\u738b\u4e94\",30,89);\uff09\u540e\uff0c\u6bcf\u6b21\u90fd\u4f1a\u57fa\u4e8e\u8bbe\u7f6e\u7684id\u81ea\u589e\u957f\u3002 \u5220\u9664 \u4ee5\u4e0a\u7684\u5220\u9664\uff0c\u4fee\u6539\u7b49\u64cd\u4f5c\uff0c\u5728\u6b63\u5f0f\u73af\u5883\u4e0a\u8bf7\u914c\u60c5\u4f7f\u7528\u3002","title":"1.2 \u8bbe\u7f6e\u81ea\u589eid"},{"location":"mysql/mysql.increment_offset/","text":"MySQL \u81ea\u589e\u548c\u504f\u79fb 1. \u4ecb\u7ecd \u00b6 MySQL\u4e2d\u5bf9\u4e8e\u8868\u4e0aID\u81ea\u589e\u5217\u53ef\u4ee5\u5728\u521b\u5efa\u8868\u7684\u65f6\u5019\u6765\u6307\u5b9a\u5217\u4e0a\u7684auto_increment\u5c5e\u6027\uff1b\u7b49\u540c\u4e8eSQL server\u4e2d\u7684identity\u5c5e\u6027\uff1bOracle\u5219\u662f\u901a\u8fc7Sequence\u65b9\u5f0f\u6765\u5b9e\u73b0\u3002\u5728MySQL\u4e2d\uff0c\u7cfb\u7edf\u53d8\u91cfauto_increment_increment\uff0cauto_increment_offset \u5f71\u54cd\u81ea\u589e\u5217\u7684\u503c\u53ca\u5176\u53d8\u5316\u89c4\u5219\u3002\u672c\u6587\u4e3b\u8981\u63cf\u8ff0\u8fd9\u4e24\u4e2a\u7cfb\u7edf\u53d8\u91cf\u7684\u76f8\u5173\u7528\u6cd5\u3002 auto_increment_increment \u63a7\u5236\u5217\u4e2d\u7684\u503c\u7684\u589e\u91cf\u503c\uff0c\u4e5f\u5c31\u662f\u6b65\u957f\u3002 auto_increment_offset \u786e\u5b9aAUTO_INCREMENT\u5217\u503c\u7684\u8d77\u70b9\uff0c\u4e5f\u5c31\u662f\u521d\u59cb\u503c\u3002 \u53d8\u91cf\u8303\u56f4\uff1a\u53ef\u4ee5\u5728\u5168\u5c40\u4ee5\u53casession\u7ea7\u522b\u8bbe\u7f6e\u8fd92\u4e2a\u53d8\u91cf mysql> show variables like 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 2 | | auto_increment_offset | 1 | +--------------------------+-------+ 2 rows in set (0.00 sec) 2. \u6f14\u793a \u00b6 \u6f14\u793aauto_increment_increment\u4e0eauto_increment_offset 2.1 \u73af\u5883\u51c6\u5907 \u00b6 drop database leco; create database leco charset utf8; use leco; create table emp( id int not null auto_increment primary key, name varchar(20) ); insert into emp(name) values(\"summer\"); insert into emp(name) values(\"caimengzhi\"); insert into emp(name) values(\"\u6211\u66fe\"); insert into emp(name) values(\"\u4e16\u672c\u5e38\u6001\"); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop database leco; Query OK, 7 rows affected (0.14 sec) mysql> create database leco charset utf8; Query OK, 1 row affected (0.00 sec) mysql> use leco; Database changed mysql> use leco; Database changed mysql> create table emp( -> id int not null auto_increment primary key, -> name varchar(20) -> ); Query OK, 0 rows affected (0.08 sec) 2.2 \u63d2\u5165\u6570\u636e \u00b6 mysql> insert into emp(name) values(\"\u4e16\u672c\u5e38\u6001\"); Query OK, 1 row affected (0.01 sec) mysql> insert into emp(name) values(\"summer\"); Query OK, 1 row affected (0.01 sec) mysql> insert into emp(name) values(\"caimengzhi\"); Query OK, 1 row affected (0.03 sec) mysql> insert into emp(name) values(\"\u6211\u66fe\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+--------------+ | id | name | +----+--------------+ | 1 | \u4e16\u672c\u5e38\u6001 | | 3 | summer | | 5 | caimengzhi | | 7 | \u6211\u66fe | +----+--------------+ 4 rows in set (0.00 sec) mysql> show variables like 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 2 | | auto_increment_offset | 1 | +--------------------------+-------+ 2 rows in set (0.01 sec) \u6211\u4eec\u4ece\u4e0a\u9762\u7ed3\u679c\u6765\u770b\u3002id\u4ece1\u5f00\u59cb\u6b65\u957f\u4e3a2\u3002 2.3 \u8bbe\u7f6e\u6b65\u957f \u00b6 \u4ee5\u4e0b\u90fd\u662f\u4e34\u65f6\u751f\u6548\uff0c\u91cd\u542fmysql\u540e\u5931\u6548\u3002 mysql> set auto_increment_increment = 10; Query OK, 0 rows affected (0.00 sec) mysql> show variables like 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 10 | | auto_increment_offset | 1 | +--------------------------+-------+ 2 rows in set (0.00 sec) mysql> select * from emp; +----+--------------+ | id | name | +----+--------------+ | 1 | \u4e16\u672c\u5e38\u6001 | | 3 | summer | | 5 | caimengzhi | | 7 | \u6211\u66fe | +----+--------------+ 4 rows in set (0.00 sec) mysql> insert into emp(name) values(\"\u5357\u4eac\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+--------------+ | id | name | +----+--------------+ | 1 | \u4e16\u672c\u5e38\u6001 | | 3 | summer | | 5 | caimengzhi | | 7 | \u6211\u66fe | | 11 | \u5357\u4eac | +----+--------------+ 5 rows in set (0.00 sec) mysql> insert into emp(name) values(\"\u5357\u4eac2\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+--------------+ | id | name | +----+--------------+ | 1 | \u4e16\u672c\u5e38\u6001 | | 3 | summer | | 5 | caimengzhi | | 7 | \u6211\u66fe | | 11 | \u5357\u4eac | | 21 | \u5357\u4eac2 | +----+--------------+ 6 rows in set (0.00 sec) mysql> insert into emp(name) values(\"\u5357\u4eac3\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+--------------+ | id | name | +----+--------------+ | 1 | \u4e16\u672c\u5e38\u6001 | | 3 | summer | | 5 | caimengzhi | | 7 | \u6211\u66fe | | 11 | \u5357\u4eac | | 21 | \u5357\u4eac2 | | 31 | \u5357\u4eac3 | +----+--------------+ 7 rows in set (0.00 sec) \u6e05\u7a7a\u8868\u518d\u6765\u4e00\u6b21 mysql> truncate emp; Query OK, 0 rows affected (0.05 sec) mysql> insert into emp(name) values(\"cmz1\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+------+ | id | name | +----+------+ | 1 | cmz1 | +----+------+ 1 row in set (0.00 sec) mysql> insert into emp(name) values(\"cmz2\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+------+ | id | name | +----+------+ | 1 | cmz1 | | 11 | cmz2 | +----+------+ 2 rows in set (0.00 sec) 2.4 \u8bbe\u7f6e\u504f\u79fb\u91cf \u00b6 mysql> select * from emp; +----+------+ | id | name | +----+------+ | 1 | cmz1 | | 11 | cmz2 | +----+------+ 2 rows in set (0.00 sec) mysql> set auto_increment_offset = 5; Query OK, 0 rows affected (0.00 sec) mysql> show variables like 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 10 | | auto_increment_offset | 5 | +--------------------------+-------+ 2 rows in set (0.00 sec) mysql> insert into emp(name) values(\"cmz3\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+------+ | id | name | +----+------+ | 1 | cmz1 | | 11 | cmz2 | | 25 | cmz3 | +----+------+ 3 rows in set (0.00 sec) \u4e0a\u9762emp\u8868\u6700\u540e\u4e00\u4f4d\u7684id\u662f11\u3002\u672c\u6765\u8981\u662f\u7ee7\u7eed\u63d2\u5165\u6570\u636e\u7684\u8bdd\uff0cid\u5e94\u8be5\u662f11+10=21, \u6b64\u65f6\u53c8\u8bbe\u7f6e\u4e86\u504f\u79fb\u91cf\u3002\u6240\u4ee5\u662f25. \u6e05\u8868\u91cd\u6765\u4e00\u6b21\u3002 mysql> truncate emp; Query OK, 0 rows affected (0.04 sec) mysql> insert into emp(name) values(\"cmz1\"); Query OK, 1 row affected (0.01 sec) mysql> insert into emp(name) values(\"cmz2\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+------+ | id | name | +----+------+ | 5 | cmz1 | | 15 | cmz2 | +----+------+ 2 rows in set (0.00 sec)","title":"03. \u81ea\u589e/\u504f\u79fb\u91cf"},{"location":"mysql/mysql.increment_offset/#1","text":"MySQL\u4e2d\u5bf9\u4e8e\u8868\u4e0aID\u81ea\u589e\u5217\u53ef\u4ee5\u5728\u521b\u5efa\u8868\u7684\u65f6\u5019\u6765\u6307\u5b9a\u5217\u4e0a\u7684auto_increment\u5c5e\u6027\uff1b\u7b49\u540c\u4e8eSQL server\u4e2d\u7684identity\u5c5e\u6027\uff1bOracle\u5219\u662f\u901a\u8fc7Sequence\u65b9\u5f0f\u6765\u5b9e\u73b0\u3002\u5728MySQL\u4e2d\uff0c\u7cfb\u7edf\u53d8\u91cfauto_increment_increment\uff0cauto_increment_offset \u5f71\u54cd\u81ea\u589e\u5217\u7684\u503c\u53ca\u5176\u53d8\u5316\u89c4\u5219\u3002\u672c\u6587\u4e3b\u8981\u63cf\u8ff0\u8fd9\u4e24\u4e2a\u7cfb\u7edf\u53d8\u91cf\u7684\u76f8\u5173\u7528\u6cd5\u3002 auto_increment_increment \u63a7\u5236\u5217\u4e2d\u7684\u503c\u7684\u589e\u91cf\u503c\uff0c\u4e5f\u5c31\u662f\u6b65\u957f\u3002 auto_increment_offset \u786e\u5b9aAUTO_INCREMENT\u5217\u503c\u7684\u8d77\u70b9\uff0c\u4e5f\u5c31\u662f\u521d\u59cb\u503c\u3002 \u53d8\u91cf\u8303\u56f4\uff1a\u53ef\u4ee5\u5728\u5168\u5c40\u4ee5\u53casession\u7ea7\u522b\u8bbe\u7f6e\u8fd92\u4e2a\u53d8\u91cf mysql> show variables like 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 2 | | auto_increment_offset | 1 | +--------------------------+-------+ 2 rows in set (0.00 sec)","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.increment_offset/#2","text":"\u6f14\u793aauto_increment_increment\u4e0eauto_increment_offset","title":"2. \u6f14\u793a"},{"location":"mysql/mysql.increment_offset/#21","text":"drop database leco; create database leco charset utf8; use leco; create table emp( id int not null auto_increment primary key, name varchar(20) ); insert into emp(name) values(\"summer\"); insert into emp(name) values(\"caimengzhi\"); insert into emp(name) values(\"\u6211\u66fe\"); insert into emp(name) values(\"\u4e16\u672c\u5e38\u6001\"); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop database leco; Query OK, 7 rows affected (0.14 sec) mysql> create database leco charset utf8; Query OK, 1 row affected (0.00 sec) mysql> use leco; Database changed mysql> use leco; Database changed mysql> create table emp( -> id int not null auto_increment primary key, -> name varchar(20) -> ); Query OK, 0 rows affected (0.08 sec)","title":"2.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.increment_offset/#22","text":"mysql> insert into emp(name) values(\"\u4e16\u672c\u5e38\u6001\"); Query OK, 1 row affected (0.01 sec) mysql> insert into emp(name) values(\"summer\"); Query OK, 1 row affected (0.01 sec) mysql> insert into emp(name) values(\"caimengzhi\"); Query OK, 1 row affected (0.03 sec) mysql> insert into emp(name) values(\"\u6211\u66fe\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+--------------+ | id | name | +----+--------------+ | 1 | \u4e16\u672c\u5e38\u6001 | | 3 | summer | | 5 | caimengzhi | | 7 | \u6211\u66fe | +----+--------------+ 4 rows in set (0.00 sec) mysql> show variables like 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 2 | | auto_increment_offset | 1 | +--------------------------+-------+ 2 rows in set (0.01 sec) \u6211\u4eec\u4ece\u4e0a\u9762\u7ed3\u679c\u6765\u770b\u3002id\u4ece1\u5f00\u59cb\u6b65\u957f\u4e3a2\u3002","title":"2.2 \u63d2\u5165\u6570\u636e"},{"location":"mysql/mysql.increment_offset/#23","text":"\u4ee5\u4e0b\u90fd\u662f\u4e34\u65f6\u751f\u6548\uff0c\u91cd\u542fmysql\u540e\u5931\u6548\u3002 mysql> set auto_increment_increment = 10; Query OK, 0 rows affected (0.00 sec) mysql> show variables like 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 10 | | auto_increment_offset | 1 | +--------------------------+-------+ 2 rows in set (0.00 sec) mysql> select * from emp; +----+--------------+ | id | name | +----+--------------+ | 1 | \u4e16\u672c\u5e38\u6001 | | 3 | summer | | 5 | caimengzhi | | 7 | \u6211\u66fe | +----+--------------+ 4 rows in set (0.00 sec) mysql> insert into emp(name) values(\"\u5357\u4eac\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+--------------+ | id | name | +----+--------------+ | 1 | \u4e16\u672c\u5e38\u6001 | | 3 | summer | | 5 | caimengzhi | | 7 | \u6211\u66fe | | 11 | \u5357\u4eac | +----+--------------+ 5 rows in set (0.00 sec) mysql> insert into emp(name) values(\"\u5357\u4eac2\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+--------------+ | id | name | +----+--------------+ | 1 | \u4e16\u672c\u5e38\u6001 | | 3 | summer | | 5 | caimengzhi | | 7 | \u6211\u66fe | | 11 | \u5357\u4eac | | 21 | \u5357\u4eac2 | +----+--------------+ 6 rows in set (0.00 sec) mysql> insert into emp(name) values(\"\u5357\u4eac3\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+--------------+ | id | name | +----+--------------+ | 1 | \u4e16\u672c\u5e38\u6001 | | 3 | summer | | 5 | caimengzhi | | 7 | \u6211\u66fe | | 11 | \u5357\u4eac | | 21 | \u5357\u4eac2 | | 31 | \u5357\u4eac3 | +----+--------------+ 7 rows in set (0.00 sec) \u6e05\u7a7a\u8868\u518d\u6765\u4e00\u6b21 mysql> truncate emp; Query OK, 0 rows affected (0.05 sec) mysql> insert into emp(name) values(\"cmz1\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+------+ | id | name | +----+------+ | 1 | cmz1 | +----+------+ 1 row in set (0.00 sec) mysql> insert into emp(name) values(\"cmz2\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+------+ | id | name | +----+------+ | 1 | cmz1 | | 11 | cmz2 | +----+------+ 2 rows in set (0.00 sec)","title":"2.3 \u8bbe\u7f6e\u6b65\u957f"},{"location":"mysql/mysql.increment_offset/#24","text":"mysql> select * from emp; +----+------+ | id | name | +----+------+ | 1 | cmz1 | | 11 | cmz2 | +----+------+ 2 rows in set (0.00 sec) mysql> set auto_increment_offset = 5; Query OK, 0 rows affected (0.00 sec) mysql> show variables like 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 10 | | auto_increment_offset | 5 | +--------------------------+-------+ 2 rows in set (0.00 sec) mysql> insert into emp(name) values(\"cmz3\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+------+ | id | name | +----+------+ | 1 | cmz1 | | 11 | cmz2 | | 25 | cmz3 | +----+------+ 3 rows in set (0.00 sec) \u4e0a\u9762emp\u8868\u6700\u540e\u4e00\u4f4d\u7684id\u662f11\u3002\u672c\u6765\u8981\u662f\u7ee7\u7eed\u63d2\u5165\u6570\u636e\u7684\u8bdd\uff0cid\u5e94\u8be5\u662f11+10=21, \u6b64\u65f6\u53c8\u8bbe\u7f6e\u4e86\u504f\u79fb\u91cf\u3002\u6240\u4ee5\u662f25. \u6e05\u8868\u91cd\u6765\u4e00\u6b21\u3002 mysql> truncate emp; Query OK, 0 rows affected (0.04 sec) mysql> insert into emp(name) values(\"cmz1\"); Query OK, 1 row affected (0.01 sec) mysql> insert into emp(name) values(\"cmz2\"); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+------+ | id | name | +----+------+ | 5 | cmz1 | | 15 | cmz2 | +----+------+ 2 rows in set (0.00 sec)","title":"2.4 \u8bbe\u7f6e\u504f\u79fb\u91cf"},{"location":"mysql/mysql.index/","text":"MySQL \u4ecb\u7ecd 1. MySQL\u4ecb\u7ecd \u00b6 MySQL\u662f\u4e00\u4e2a\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u7531\u745e\u5178MySQL AB \u516c\u53f8\u5f00\u53d1\uff0c\u76ee\u524d\u5c5e\u4e8e Oracle \u65d7\u4e0b\u516c\u53f8\u3002MySQL \u6700\u6d41\u884c\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u5728 WEB \u5e94\u7528\u65b9\u9762MySQL\u662f\u6700\u597d\u7684 RDBMS (Relational Database Management System\uff0c\u5173\u7cfb\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf) \u5e94\u7528\u8f6f\u4ef6\u4e4b\u4e00\u3002 mysql\u662f\u4ec0\u4e48:mysql\u5c31\u662f\u4e00\u4e2a\u57fa\u4e8esocket\u7f16\u5199\u7684C/S\u67b6\u6784\u7684\u8f6f\u4ef6 \u5ba2\u6237\u7aef\u8f6f\u4ef6 mysql\u81ea\u5e26\uff1a\u5982mysql\u547d\u4ee4\uff0cmysqldump\u547d\u4ee4\u7b49 python\u6a21\u5757\uff1a\u5982pymysql 1.1 \u6570\u636e\u5e93\u7ba1\u7406\u8f6f\u4ef6\u5206\u7c7b \u00b6 \u5206\u4e24\u5927\u7c7b\uff1a \u5173\u7cfb\u578b\uff1a\u5982sqllite\uff0cdb2\uff0coracle\uff0caccess\uff0csql server\uff0cMySQL\uff0c\u6ce8\u610f\uff1asql\u8bed\u53e5\u901a\u7528 \u975e\u5173\u7cfb\u578b\uff1amongodb\uff0credis\uff0cmemcache \u53ef\u4ee5\u7b80\u5355\u7684\u7406\u89e3\u4e3a\uff1a \u5173\u7cfb\u578b\u6570\u636e\u5e93\u9700\u8981\u6709\u8868\u7ed3\u6784 \u975e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u662fkey-value\u5b58\u50a8\u7684\uff0c\u6ca1\u6709\u8868\u7ed3\u6784 2. \u4e0b\u8f7d\u5b89\u88c5 \u00b6 2.1 Linux\u7248\u672c \u00b6 #\u4e8c\u8fdb\u5236rpm\u5305\u5b89\u88c5 yum -y install mysql-server mysql # ubuntu apt-get install mysql-server 2.2 Window\u7248\u672c \u00b6 #1\u3001\u4e0b\u8f7d\uff1aMySQL Community Server 5.7.16 http://dev.mysql.com/downloads/mysql/ #2\u3001\u89e3\u538b \u5982\u679c\u60f3\u8981\u8ba9MySQL\u5b89\u88c5\u5728\u6307\u5b9a\u76ee\u5f55\uff0c\u90a3\u4e48\u5c31\u5c06\u89e3\u538b\u540e\u7684\u6587\u4ef6\u5939\u79fb\u52a8\u5230\u6307\u5b9a\u76ee\u5f55\uff0c\u5982\uff1aC:\\mysql-5.7.16-winx64 #3\u3001\u6dfb\u52a0\u73af\u5883\u53d8\u91cf \u3010\u53f3\u952e\u8ba1\u7b97\u673a\u3011--\u300b\u3010\u5c5e\u6027\u3011--\u300b\u3010\u9ad8\u7ea7\u7cfb\u7edf\u8bbe\u7f6e\u3011--\u300b\u3010\u9ad8\u7ea7\u3011--\u300b\u3010\u73af\u5883\u53d8\u91cf\u3011--\u300b\u3010\u5728\u7b2c\u4e8c\u4e2a\u5185\u5bb9\u6846\u4e2d\u627e\u5230 \u53d8\u91cf\u540d\u4e3aPath \u7684\u4e00\u884c\uff0c\u53cc\u51fb\u3011 --> \u3010\u5c06MySQL\u7684bin\u76ee\u5f55\u8def\u5f84\u8ffd\u52a0\u5230\u53d8\u503c\u503c\u4e2d\uff0c\u7528 \uff1b \u5206\u5272\u3011 #4\u3001\u521d\u59cb\u5316 mysqld --initialize-insecure #5\u3001\u542f\u52a8MySQL\u670d\u52a1 mysqld # \u542f\u52a8MySQL\u670d\u52a1 #6\u3001\u542f\u52a8MySQL\u5ba2\u6237\u7aef\u5e76\u8fde\u63a5MySQL\u670d\u52a1 mysql -u root -p # \u8fde\u63a5MySQL\u670d\u52a1\u5668 \u4e0a\u4e00\u6b65\u89e3\u51b3\u4e86\u4e00\u4e9b\u95ee\u9898\uff0c\u4f46\u4e0d\u591f\u5f7b\u5e95\uff0c\u56e0\u4e3a\u5728\u6267\u884c\u3010mysqd\u3011\u542f\u52a8MySQL\u670d\u52a1\u5668\u65f6\uff0c\u5f53\u524d\u7ec8\u7aef\u4f1a\u88abhang\u4f4f\uff0c\u90a3\u4e48\u505a\u4e00\u4e0b\u8bbe\u7f6e\u5373\u53ef\u89e3\u51b3\u6b64\u95ee\u9898,\u5373\u5c06MySQL\u670d\u52a1\u5236\u4f5c\u6210windows\u670d\u52a1 \u6ce8\u610f\uff1a--install\u524d\uff0c\u5fc5\u987b\u7528mysql\u542f\u52a8\u547d\u4ee4\u7684\u7edd\u5bf9\u8def\u5f84 # \u5236\u4f5cMySQL\u7684Windows\u670d\u52a1\uff0c\u5728\u7ec8\u7aef\u6267\u884c\u6b64\u547d\u4ee4\uff1a \"c:\\mysql-5.7.16-winx64\\bin\\mysqld\" --install # \u79fb\u9664MySQL\u7684Windows\u670d\u52a1\uff0c\u5728\u7ec8\u7aef\u6267\u884c\u6b64\u547d\u4ee4\uff1a \"c:\\mysql-5.7.16-winx64\\bin\\mysqld\" --remove \u6ce8\u518c\u6210\u670d\u52a1\u4e4b\u540e\uff0c\u4ee5\u540e\u518d\u542f\u52a8\u548c\u5173\u95edMySQL\u670d\u52a1\u65f6\uff0c\u4ec5\u9700\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a # \u542f\u52a8MySQL\u670d\u52a1 net start mysql # \u5173\u95edMySQL\u670d\u52a1 net stop mysql 3. MySQL\u542f\u52a8\u4e0e\u67e5\u770b \u00b6 3.1 linux\u5e73\u53f0\u4e0b\u67e5\u770b \u00b6 [root@leco ~]# systemctl start mariadb #\u542f\u52a8 [root@leco ~]# systemctl enable mariadb #\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\u52a8 Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb.service to /usr/lib/systemd/system/mariadb.service. [root@leco ~]# ps aux |grep mysqld |grep -v grep #\u67e5\u770b\u8fdb\u7a0b\uff0cmysqld_safe\u4e3a\u542f\u52a8mysql\u7684\u811a\u672c\u6587\u4ef6\uff0c\u5185\u90e8\u8c03\u7528mysqld\u547d\u4ee4 mysql 3329 0.0 0.0 113252 1592 ? Ss 16:19 0:00 /bin/sh /usr/bin/mysqld_safe --basedir=/usr mysql 3488 0.0 2.3 839276 90380 ? Sl 16:19 0:00 /usr/libexec/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib64/mysql/plugin --log-error=/var/log/mariadb/mariadb.log --pid-file=/var/run/mariadb/mariadb.pid --socket=/var/lib/mysql/mysql.sock [root@leco ~]# netstat -an |grep 3306 #\u67e5\u770b\u7aef\u53e3 tcp 0 0 0.0.0.0:3306 0.0.0.0:* LISTEN [root@leco ~]# ll -d /var/lib/mysql #\u6743\u9650\u4e0d\u5bf9\uff0c\u542f\u52a8\u4e0d\u6210\u529f\uff0c\u6ce8\u610fuser\u548cgroup drwxr-xr-x 5 mysql mysql 4096 Jul 20 16:28 /var/lib/mysql You must reset your password using ALTER USER statement before executing this statement. \u88c5\u5b8cmysql \u4e4b\u540e\uff0c\u767b\u9646\u4ee5\u540e\uff0c\u4e0d\u7ba1\u8fd0\u884c\u4efb\u4f55\u547d\u4ee4\uff0c\u603b\u662f\u63d0\u793a\u8fd9\u4e2a mac mysql error You must reset your password using ALTER USER statement before executing this statement. \u89e3\u51b3\u65b9\u6cd5\uff1a step 1: SET PASSWORD = PASSWORD('your new password'); step 2: ALTER USER 'root'@'localhost' PASSWORD EXPIRE NEVER; step 3: flush privileges; windows\u5e73\u53f0\u5230\u670d\u52a1\u4e2d\u67e5\u770b\u5373\u53ef 4. \u767b\u5f55\u8bbe\u7f6e\u5bc6\u7801 \u00b6 linux\u5e73\u53f0\u4e0b\uff0c\u7834\u89e3\u5bc6\u7801\u7684\u4e24\u79cd\u65b9\u5f0f \u65b9\u6cd5\u4e00\uff1a\u5220\u9664\u6388\u6743\u5e93mysql\uff0c\u91cd\u65b0\u521d\u59cb\u5316 [root@leco ~]# rm -rf /var/lib/mysql/mysql #\u6240\u6709\u6388\u6743\u4fe1\u606f\u5168\u90e8\u4e22\u5931\uff01\uff01\uff01 [root@leco ~]# systemctl restart mariadb [root@leco ~]# mysql \u65b9\u6cd5\u4e8c\uff1a\u542f\u52a8\u65f6\uff0c\u8df3\u8fc7\u6388\u6743\u5e93 \u521d\u59cb\u72b6\u6001\u4e0b\uff0c\u7ba1\u7406\u5458root\uff0c\u5bc6\u7801\u4e3a\u7a7a\uff0c\u9ed8\u8ba4\u53ea\u5141\u8bb8\u4ece\u672c\u673a\u767b\u5f55localhost \u8bbe\u7f6e\u5bc6\u7801 [root@leco ~]# mysqladmin -uroot password \"123\" \u8bbe\u7f6e\u521d\u59cb\u5bc6\u7801 \u7531\u4e8e\u539f\u5bc6\u7801\u4e3a\u7a7a\uff0c\u56e0\u6b64-p\u53ef\u4ee5\u4e0d\u7528 [root@leco ~]# mysqladmin -uroot -p\"123\" password \"456\" \u4fee\u6539mysql\u5bc6\u7801,\u56e0\u4e3a\u5df2\u7ecf\u6709\u5bc6\u7801\u4e86\uff0c\u6240\u4ee5\u5fc5\u987b\u8f93\u5165\u539f\u5bc6\u7801\u624d\u80fd\u8bbe\u7f6e\u65b0\u5bc6\u7801 \u547d\u4ee4\u683c\u5f0f: [root@leco ~]# mysql -h172.31.0.2 -uroot -p456 [root@leco ~]# mysql -uroot -p [root@leco ~]# mysql \u4ee5root\u7528\u6237\u767b\u5f55\u672c\u673a\uff0c\u5bc6\u7801\u4e3a\u7a7a windows\u5e73\u53f0\u4e0b\uff0c5.7\u7248\u672cmysql\uff0c\u7834\u89e3\u5bc6\u7801\u7684\u4e24\u79cd\u65b9\u5f0f\uff1a \u65b9\u5f0f\u4e00 #1 \u5173\u95edmysql #2 \u5728cmd\u4e2d\u6267\u884c\uff1amysqld --skip-grant-tables #3 \u5728cmd\u4e2d\u6267\u884c\uff1amysql #4 \u6267\u884c\u5982\u4e0bsql\uff1a update mysql.user set authentication_string=password('') where user = 'root'; flush privileges; #5 taskill mysqld #\u6216taskkill -f /PID 7832 #6 \u91cd\u65b0\u542f\u52a8mysql \u65b9\u5f0f\u4e8c #1. \u5173\u95edmysql\uff0c\u53ef\u4ee5\u7528tskill mysqld\u5c06\u5176\u6740\u6b7b #2. \u5728\u89e3\u538b\u76ee\u5f55\u4e0b\uff0c\u65b0\u5efamysql\u914d\u7f6e\u6587\u4ef6my.ini #3. my.ini\u5185\u5bb9,\u6307\u5b9a [mysqld] skip-grant-tables #4.\u542f\u52a8mysqld #5.\u5728cmd\u91cc\u76f4\u63a5\u8f93\u5165mysql\u767b\u5f55\uff0c\u7136\u540e\u64cd\u4f5c update mysql.user set authentication_string=password('') where user='root and host='localhost'; flush privileges; #6.\u6ce8\u91camy.ini\u4e2d\u7684skip-grant-tables\uff0c\u7136\u540e\u542f\u52a8myqsld\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u4ee5\u65b0\u5bc6\u7801\u767b\u5f55\u4e86 5. \u7edf\u4e00\u5b57\u7b26\u7f16\u7801 \u00b6 \u5f3a\u8c03\uff1a\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u6ce8\u91ca\u53ef\u4ee5\u6709\u4e2d\u6587\uff0c\u4f46\u662f\u914d\u7f6e\u9879\u4e2d\u4e0d\u80fd\u51fa\u73b0\u4e2d\u6587 #\u5728mysql\u7684\u89e3\u538b\u76ee\u5f55\u4e0b\uff0c\u65b0\u5efamy.ini,\u7136\u540e\u914d\u7f6e #1. \u5728\u6267\u884cmysqld\u547d\u4ee4\u65f6\uff0c\u4e0b\u5217\u914d\u7f6e\u4f1a\u751f\u6548\uff0c\u5373mysql\u670d\u52a1\u542f\u52a8\u65f6\u751f\u6548 [mysqld] ;skip-grant-tables port=3306 character_set_server=utf8 default-storage-engine=innodb innodb_file_per_table=1 #\u89e3\u538b\u7684\u76ee\u5f55 basedir=E:\\mysql-5.7.19-winx64 #data\u76ee\u5f55 datadir=E:\\my_data #\u5728mysqld --initialize\u65f6\uff0c\u5c31\u4f1a\u5c06\u521d\u59cb\u6570\u636e\u5b58\u5165\u6b64\u5904\u6307\u5b9a\u7684\u76ee\u5f55\uff0c\u5728\u521d\u59cb\u5316\u4e4b\u540e\uff0c\u542f\u52a8mysql\u65f6\uff0c\u5c31\u4f1a\u53bb\u8fd9\u4e2a\u76ee\u5f55\u91cc\u627e\u6570\u636e #2. \u9488\u5bf9\u5ba2\u6237\u7aef\u547d\u4ee4\u7684\u5168\u5c40\u914d\u7f6e\uff0c\u5f53mysql\u5ba2\u6237\u7aef\u547d\u4ee4\u6267\u884c\u65f6\uff0c\u4e0b\u5217\u914d\u7f6e\u751f\u6548 [client] port=3306 default-character-set=utf8 user=root password=123 #3. \u53ea\u9488\u5bf9mysql\u8fd9\u4e2a\u5ba2\u6237\u7aef\u7684\u914d\u7f6e\uff0c2\u4e2d\u7684\u662f\u5168\u5c40\u914d\u7f6e\uff0c\u800c\u6b64\u5904\u7684\u5219\u662f\u53ea\u9488\u5bf9mysql\u8fd9\u4e2a\u547d\u4ee4\u7684\u5c40\u90e8\u914d\u7f6e [mysql] ;port=3306 ;default-character-set=utf8 user=egon password=4573 #\uff01\uff01\uff01\u5982\u679c\u6ca1\u6709[mysql],\u5219\u7528\u6237\u5728\u6267\u884cmysql\u547d\u4ee4\u65f6\u7684\u914d\u7f6e\u4ee5[client]\u4e3a\u51c6 \u7edf\u4e00\u5b57\u7b26\u7f16\u7801 #1. \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 [mysqld] default-character-set=utf8 [client] default-character-set=utf8 [mysql] default-character-set=utf8 #mysql5.5\u4ee5\u4e0a\uff1a\u4fee\u6539\u65b9\u5f0f\u6709\u6240\u6539\u52a8 [mysqld] character-set-server=utf8 collation-server=utf8_general_ci [client] default-character-set=utf8 [mysql] default-character-set=utf8 #2. \u91cd\u542f\u670d\u52a1 #3. \u67e5\u770b\u4fee\u6539\u7ed3\u679c\uff1a mysql> show variables like '%char%'; +--------------------------+----------------------------+ | Variable_name | Value | +--------------------------+----------------------------+ | character_set_client | utf8 | | character_set_connection | utf8 | | character_set_database | utf8 | | character_set_filesystem | binary | | character_set_results | utf8 | | character_set_server | utf8 | | character_set_system | utf8 | | character_sets_dir | /usr/share/mysql/charsets/ | +--------------------------+----------------------------+ 8 rows in set (0.00 sec)","title":"01. MySQL \u4ecb\u7ecd"},{"location":"mysql/mysql.index/#1-mysql","text":"MySQL\u662f\u4e00\u4e2a\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u7531\u745e\u5178MySQL AB \u516c\u53f8\u5f00\u53d1\uff0c\u76ee\u524d\u5c5e\u4e8e Oracle \u65d7\u4e0b\u516c\u53f8\u3002MySQL \u6700\u6d41\u884c\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u5728 WEB \u5e94\u7528\u65b9\u9762MySQL\u662f\u6700\u597d\u7684 RDBMS (Relational Database Management System\uff0c\u5173\u7cfb\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf) \u5e94\u7528\u8f6f\u4ef6\u4e4b\u4e00\u3002 mysql\u662f\u4ec0\u4e48:mysql\u5c31\u662f\u4e00\u4e2a\u57fa\u4e8esocket\u7f16\u5199\u7684C/S\u67b6\u6784\u7684\u8f6f\u4ef6 \u5ba2\u6237\u7aef\u8f6f\u4ef6 mysql\u81ea\u5e26\uff1a\u5982mysql\u547d\u4ee4\uff0cmysqldump\u547d\u4ee4\u7b49 python\u6a21\u5757\uff1a\u5982pymysql","title":"1. MySQL\u4ecb\u7ecd"},{"location":"mysql/mysql.index/#11","text":"\u5206\u4e24\u5927\u7c7b\uff1a \u5173\u7cfb\u578b\uff1a\u5982sqllite\uff0cdb2\uff0coracle\uff0caccess\uff0csql server\uff0cMySQL\uff0c\u6ce8\u610f\uff1asql\u8bed\u53e5\u901a\u7528 \u975e\u5173\u7cfb\u578b\uff1amongodb\uff0credis\uff0cmemcache \u53ef\u4ee5\u7b80\u5355\u7684\u7406\u89e3\u4e3a\uff1a \u5173\u7cfb\u578b\u6570\u636e\u5e93\u9700\u8981\u6709\u8868\u7ed3\u6784 \u975e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u662fkey-value\u5b58\u50a8\u7684\uff0c\u6ca1\u6709\u8868\u7ed3\u6784","title":"1.1 \u6570\u636e\u5e93\u7ba1\u7406\u8f6f\u4ef6\u5206\u7c7b"},{"location":"mysql/mysql.index/#2","text":"","title":"2. \u4e0b\u8f7d\u5b89\u88c5"},{"location":"mysql/mysql.index/#21-linux","text":"#\u4e8c\u8fdb\u5236rpm\u5305\u5b89\u88c5 yum -y install mysql-server mysql # ubuntu apt-get install mysql-server","title":"2.1 Linux\u7248\u672c"},{"location":"mysql/mysql.index/#22-window","text":"#1\u3001\u4e0b\u8f7d\uff1aMySQL Community Server 5.7.16 http://dev.mysql.com/downloads/mysql/ #2\u3001\u89e3\u538b \u5982\u679c\u60f3\u8981\u8ba9MySQL\u5b89\u88c5\u5728\u6307\u5b9a\u76ee\u5f55\uff0c\u90a3\u4e48\u5c31\u5c06\u89e3\u538b\u540e\u7684\u6587\u4ef6\u5939\u79fb\u52a8\u5230\u6307\u5b9a\u76ee\u5f55\uff0c\u5982\uff1aC:\\mysql-5.7.16-winx64 #3\u3001\u6dfb\u52a0\u73af\u5883\u53d8\u91cf \u3010\u53f3\u952e\u8ba1\u7b97\u673a\u3011--\u300b\u3010\u5c5e\u6027\u3011--\u300b\u3010\u9ad8\u7ea7\u7cfb\u7edf\u8bbe\u7f6e\u3011--\u300b\u3010\u9ad8\u7ea7\u3011--\u300b\u3010\u73af\u5883\u53d8\u91cf\u3011--\u300b\u3010\u5728\u7b2c\u4e8c\u4e2a\u5185\u5bb9\u6846\u4e2d\u627e\u5230 \u53d8\u91cf\u540d\u4e3aPath \u7684\u4e00\u884c\uff0c\u53cc\u51fb\u3011 --> \u3010\u5c06MySQL\u7684bin\u76ee\u5f55\u8def\u5f84\u8ffd\u52a0\u5230\u53d8\u503c\u503c\u4e2d\uff0c\u7528 \uff1b \u5206\u5272\u3011 #4\u3001\u521d\u59cb\u5316 mysqld --initialize-insecure #5\u3001\u542f\u52a8MySQL\u670d\u52a1 mysqld # \u542f\u52a8MySQL\u670d\u52a1 #6\u3001\u542f\u52a8MySQL\u5ba2\u6237\u7aef\u5e76\u8fde\u63a5MySQL\u670d\u52a1 mysql -u root -p # \u8fde\u63a5MySQL\u670d\u52a1\u5668 \u4e0a\u4e00\u6b65\u89e3\u51b3\u4e86\u4e00\u4e9b\u95ee\u9898\uff0c\u4f46\u4e0d\u591f\u5f7b\u5e95\uff0c\u56e0\u4e3a\u5728\u6267\u884c\u3010mysqd\u3011\u542f\u52a8MySQL\u670d\u52a1\u5668\u65f6\uff0c\u5f53\u524d\u7ec8\u7aef\u4f1a\u88abhang\u4f4f\uff0c\u90a3\u4e48\u505a\u4e00\u4e0b\u8bbe\u7f6e\u5373\u53ef\u89e3\u51b3\u6b64\u95ee\u9898,\u5373\u5c06MySQL\u670d\u52a1\u5236\u4f5c\u6210windows\u670d\u52a1 \u6ce8\u610f\uff1a--install\u524d\uff0c\u5fc5\u987b\u7528mysql\u542f\u52a8\u547d\u4ee4\u7684\u7edd\u5bf9\u8def\u5f84 # \u5236\u4f5cMySQL\u7684Windows\u670d\u52a1\uff0c\u5728\u7ec8\u7aef\u6267\u884c\u6b64\u547d\u4ee4\uff1a \"c:\\mysql-5.7.16-winx64\\bin\\mysqld\" --install # \u79fb\u9664MySQL\u7684Windows\u670d\u52a1\uff0c\u5728\u7ec8\u7aef\u6267\u884c\u6b64\u547d\u4ee4\uff1a \"c:\\mysql-5.7.16-winx64\\bin\\mysqld\" --remove \u6ce8\u518c\u6210\u670d\u52a1\u4e4b\u540e\uff0c\u4ee5\u540e\u518d\u542f\u52a8\u548c\u5173\u95edMySQL\u670d\u52a1\u65f6\uff0c\u4ec5\u9700\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a # \u542f\u52a8MySQL\u670d\u52a1 net start mysql # \u5173\u95edMySQL\u670d\u52a1 net stop mysql","title":"2.2 Window\u7248\u672c"},{"location":"mysql/mysql.index/#3-mysql","text":"","title":"3. MySQL\u542f\u52a8\u4e0e\u67e5\u770b"},{"location":"mysql/mysql.index/#31-linux","text":"[root@leco ~]# systemctl start mariadb #\u542f\u52a8 [root@leco ~]# systemctl enable mariadb #\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\u52a8 Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb.service to /usr/lib/systemd/system/mariadb.service. [root@leco ~]# ps aux |grep mysqld |grep -v grep #\u67e5\u770b\u8fdb\u7a0b\uff0cmysqld_safe\u4e3a\u542f\u52a8mysql\u7684\u811a\u672c\u6587\u4ef6\uff0c\u5185\u90e8\u8c03\u7528mysqld\u547d\u4ee4 mysql 3329 0.0 0.0 113252 1592 ? Ss 16:19 0:00 /bin/sh /usr/bin/mysqld_safe --basedir=/usr mysql 3488 0.0 2.3 839276 90380 ? Sl 16:19 0:00 /usr/libexec/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib64/mysql/plugin --log-error=/var/log/mariadb/mariadb.log --pid-file=/var/run/mariadb/mariadb.pid --socket=/var/lib/mysql/mysql.sock [root@leco ~]# netstat -an |grep 3306 #\u67e5\u770b\u7aef\u53e3 tcp 0 0 0.0.0.0:3306 0.0.0.0:* LISTEN [root@leco ~]# ll -d /var/lib/mysql #\u6743\u9650\u4e0d\u5bf9\uff0c\u542f\u52a8\u4e0d\u6210\u529f\uff0c\u6ce8\u610fuser\u548cgroup drwxr-xr-x 5 mysql mysql 4096 Jul 20 16:28 /var/lib/mysql You must reset your password using ALTER USER statement before executing this statement. \u88c5\u5b8cmysql \u4e4b\u540e\uff0c\u767b\u9646\u4ee5\u540e\uff0c\u4e0d\u7ba1\u8fd0\u884c\u4efb\u4f55\u547d\u4ee4\uff0c\u603b\u662f\u63d0\u793a\u8fd9\u4e2a mac mysql error You must reset your password using ALTER USER statement before executing this statement. \u89e3\u51b3\u65b9\u6cd5\uff1a step 1: SET PASSWORD = PASSWORD('your new password'); step 2: ALTER USER 'root'@'localhost' PASSWORD EXPIRE NEVER; step 3: flush privileges; windows\u5e73\u53f0\u5230\u670d\u52a1\u4e2d\u67e5\u770b\u5373\u53ef","title":"3.1 linux\u5e73\u53f0\u4e0b\u67e5\u770b"},{"location":"mysql/mysql.index/#4","text":"linux\u5e73\u53f0\u4e0b\uff0c\u7834\u89e3\u5bc6\u7801\u7684\u4e24\u79cd\u65b9\u5f0f \u65b9\u6cd5\u4e00\uff1a\u5220\u9664\u6388\u6743\u5e93mysql\uff0c\u91cd\u65b0\u521d\u59cb\u5316 [root@leco ~]# rm -rf /var/lib/mysql/mysql #\u6240\u6709\u6388\u6743\u4fe1\u606f\u5168\u90e8\u4e22\u5931\uff01\uff01\uff01 [root@leco ~]# systemctl restart mariadb [root@leco ~]# mysql \u65b9\u6cd5\u4e8c\uff1a\u542f\u52a8\u65f6\uff0c\u8df3\u8fc7\u6388\u6743\u5e93 \u521d\u59cb\u72b6\u6001\u4e0b\uff0c\u7ba1\u7406\u5458root\uff0c\u5bc6\u7801\u4e3a\u7a7a\uff0c\u9ed8\u8ba4\u53ea\u5141\u8bb8\u4ece\u672c\u673a\u767b\u5f55localhost \u8bbe\u7f6e\u5bc6\u7801 [root@leco ~]# mysqladmin -uroot password \"123\" \u8bbe\u7f6e\u521d\u59cb\u5bc6\u7801 \u7531\u4e8e\u539f\u5bc6\u7801\u4e3a\u7a7a\uff0c\u56e0\u6b64-p\u53ef\u4ee5\u4e0d\u7528 [root@leco ~]# mysqladmin -uroot -p\"123\" password \"456\" \u4fee\u6539mysql\u5bc6\u7801,\u56e0\u4e3a\u5df2\u7ecf\u6709\u5bc6\u7801\u4e86\uff0c\u6240\u4ee5\u5fc5\u987b\u8f93\u5165\u539f\u5bc6\u7801\u624d\u80fd\u8bbe\u7f6e\u65b0\u5bc6\u7801 \u547d\u4ee4\u683c\u5f0f: [root@leco ~]# mysql -h172.31.0.2 -uroot -p456 [root@leco ~]# mysql -uroot -p [root@leco ~]# mysql \u4ee5root\u7528\u6237\u767b\u5f55\u672c\u673a\uff0c\u5bc6\u7801\u4e3a\u7a7a windows\u5e73\u53f0\u4e0b\uff0c5.7\u7248\u672cmysql\uff0c\u7834\u89e3\u5bc6\u7801\u7684\u4e24\u79cd\u65b9\u5f0f\uff1a \u65b9\u5f0f\u4e00 #1 \u5173\u95edmysql #2 \u5728cmd\u4e2d\u6267\u884c\uff1amysqld --skip-grant-tables #3 \u5728cmd\u4e2d\u6267\u884c\uff1amysql #4 \u6267\u884c\u5982\u4e0bsql\uff1a update mysql.user set authentication_string=password('') where user = 'root'; flush privileges; #5 taskill mysqld #\u6216taskkill -f /PID 7832 #6 \u91cd\u65b0\u542f\u52a8mysql \u65b9\u5f0f\u4e8c #1. \u5173\u95edmysql\uff0c\u53ef\u4ee5\u7528tskill mysqld\u5c06\u5176\u6740\u6b7b #2. \u5728\u89e3\u538b\u76ee\u5f55\u4e0b\uff0c\u65b0\u5efamysql\u914d\u7f6e\u6587\u4ef6my.ini #3. my.ini\u5185\u5bb9,\u6307\u5b9a [mysqld] skip-grant-tables #4.\u542f\u52a8mysqld #5.\u5728cmd\u91cc\u76f4\u63a5\u8f93\u5165mysql\u767b\u5f55\uff0c\u7136\u540e\u64cd\u4f5c update mysql.user set authentication_string=password('') where user='root and host='localhost'; flush privileges; #6.\u6ce8\u91camy.ini\u4e2d\u7684skip-grant-tables\uff0c\u7136\u540e\u542f\u52a8myqsld\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u4ee5\u65b0\u5bc6\u7801\u767b\u5f55\u4e86","title":"4. \u767b\u5f55\u8bbe\u7f6e\u5bc6\u7801"},{"location":"mysql/mysql.index/#5","text":"\u5f3a\u8c03\uff1a\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u6ce8\u91ca\u53ef\u4ee5\u6709\u4e2d\u6587\uff0c\u4f46\u662f\u914d\u7f6e\u9879\u4e2d\u4e0d\u80fd\u51fa\u73b0\u4e2d\u6587 #\u5728mysql\u7684\u89e3\u538b\u76ee\u5f55\u4e0b\uff0c\u65b0\u5efamy.ini,\u7136\u540e\u914d\u7f6e #1. \u5728\u6267\u884cmysqld\u547d\u4ee4\u65f6\uff0c\u4e0b\u5217\u914d\u7f6e\u4f1a\u751f\u6548\uff0c\u5373mysql\u670d\u52a1\u542f\u52a8\u65f6\u751f\u6548 [mysqld] ;skip-grant-tables port=3306 character_set_server=utf8 default-storage-engine=innodb innodb_file_per_table=1 #\u89e3\u538b\u7684\u76ee\u5f55 basedir=E:\\mysql-5.7.19-winx64 #data\u76ee\u5f55 datadir=E:\\my_data #\u5728mysqld --initialize\u65f6\uff0c\u5c31\u4f1a\u5c06\u521d\u59cb\u6570\u636e\u5b58\u5165\u6b64\u5904\u6307\u5b9a\u7684\u76ee\u5f55\uff0c\u5728\u521d\u59cb\u5316\u4e4b\u540e\uff0c\u542f\u52a8mysql\u65f6\uff0c\u5c31\u4f1a\u53bb\u8fd9\u4e2a\u76ee\u5f55\u91cc\u627e\u6570\u636e #2. \u9488\u5bf9\u5ba2\u6237\u7aef\u547d\u4ee4\u7684\u5168\u5c40\u914d\u7f6e\uff0c\u5f53mysql\u5ba2\u6237\u7aef\u547d\u4ee4\u6267\u884c\u65f6\uff0c\u4e0b\u5217\u914d\u7f6e\u751f\u6548 [client] port=3306 default-character-set=utf8 user=root password=123 #3. \u53ea\u9488\u5bf9mysql\u8fd9\u4e2a\u5ba2\u6237\u7aef\u7684\u914d\u7f6e\uff0c2\u4e2d\u7684\u662f\u5168\u5c40\u914d\u7f6e\uff0c\u800c\u6b64\u5904\u7684\u5219\u662f\u53ea\u9488\u5bf9mysql\u8fd9\u4e2a\u547d\u4ee4\u7684\u5c40\u90e8\u914d\u7f6e [mysql] ;port=3306 ;default-character-set=utf8 user=egon password=4573 #\uff01\uff01\uff01\u5982\u679c\u6ca1\u6709[mysql],\u5219\u7528\u6237\u5728\u6267\u884cmysql\u547d\u4ee4\u65f6\u7684\u914d\u7f6e\u4ee5[client]\u4e3a\u51c6 \u7edf\u4e00\u5b57\u7b26\u7f16\u7801 #1. \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 [mysqld] default-character-set=utf8 [client] default-character-set=utf8 [mysql] default-character-set=utf8 #mysql5.5\u4ee5\u4e0a\uff1a\u4fee\u6539\u65b9\u5f0f\u6709\u6240\u6539\u52a8 [mysqld] character-set-server=utf8 collation-server=utf8_general_ci [client] default-character-set=utf8 [mysql] default-character-set=utf8 #2. \u91cd\u542f\u670d\u52a1 #3. \u67e5\u770b\u4fee\u6539\u7ed3\u679c\uff1a mysql> show variables like '%char%'; +--------------------------+----------------------------+ | Variable_name | Value | +--------------------------+----------------------------+ | character_set_client | utf8 | | character_set_connection | utf8 | | character_set_database | utf8 | | character_set_filesystem | binary | | character_set_results | utf8 | | character_set_server | utf8 | | character_set_system | utf8 | | character_sets_dir | /usr/share/mysql/charsets/ | +--------------------------+----------------------------+ 8 rows in set (0.00 sec)","title":"5. \u7edf\u4e00\u5b57\u7b26\u7f16\u7801"},{"location":"mysql/mysql.info/","text":"INIT MySQL 1. \u63cf\u8ff0 \u00b6 \u6709\u4e86mysql\u8fd9\u4e2a\u6570\u636e\u5e93\u8f6f\u4ef6\uff0c\u5c31\u53ef\u4ee5\u5c06\u7a0b\u5e8f\u5458\u4ece\u5bf9\u6570\u636e\u7684\u7ba1\u7406\u4e2d\u89e3\u8131\u51fa\u6765\uff0c\u4e13\u6ce8\u4e8e\u5bf9\u7a0b\u5e8f\u903b\u8f91\u7684\u7f16\u5199 mysql\u670d\u52a1\u7aef\u8f6f\u4ef6\u5373mysqld\u5e2e\u6211\u4eec\u7ba1\u7406\u597d\u6587\u4ef6\u5939\u4ee5\u53ca\u6587\u4ef6\uff0c\u524d\u63d0\u662f\u4f5c\u4e3a\u4f7f\u7528\u8005\u7684\u6211\u4eec\uff0c\u9700\u8981\u4e0b\u8f7dmysql\u7684\u5ba2\u6237\u7aef\uff0c \u6216\u8005\u5176\u4ed6\u6a21\u5757\u6765\u8fde\u63a5\u5230mysqld\uff0c\u7136\u540e\u4f7f\u7528mysql\u8f6f\u4ef6\u89c4\u5b9a\u7684\u8bed\u6cd5\u683c\u5f0f\u53bb\u63d0\u4ea4\u81ea\u5df1\u547d\u4ee4\uff0c\u5b9e\u73b0\u5bf9\u6587\u4ef6\u5939\u6216\u6587\u4ef6\u7684\u7ba1\u7406\u3002 \u8be5\u8bed\u6cd5\u5373sql\uff08Structured Query Language \u5373\u7ed3\u6784\u5316\u67e5\u8be2\u8bed\u8a00\uff09 2. \u4f5c\u7528 \u00b6 SQL\u8bed\u8a00\u4e3b\u8981\u7528\u4e8e \u5b58\u53d6\u6570\u636e\u3001\u67e5\u8be2\u6570\u636e\u3001\u66f4\u65b0\u6570\u636e\u548c\u7ba1\u7406\u5173\u7cfb\u6570\u636e\u5e93\u7cfb\u7edf, SQL\u8bed\u8a00\u7531IBM\u5f00\u53d1\u3002SQL\u8bed\u8a00\u5206\u4e3a3\u79cd\u7c7b\u578b\uff1a 1\u3001DDL\u8bed\u53e5 \u6570\u636e\u5e93\u5b9a\u4e49\u8bed\u8a00\uff1a \u6570\u636e\u5e93\u3001\u8868\u3001\u89c6\u56fe\u3001\u7d22\u5f15\u3001\u5b58\u50a8\u8fc7\u7a0b\uff0c\u4f8b\u5982CREATE DROP ALTER 2\u3001DML\u8bed\u53e5 \u6570\u636e\u5e93\u64cd\u7eb5\u8bed\u8a00\uff1a \u63d2\u5165\u6570\u636eINSERT\u3001\u5220\u9664\u6570\u636eDELETE\u3001\u66f4\u65b0\u6570\u636eUPDATE\u3001\u67e5\u8be2\u6570\u636eSELECT 3\u3001DCL\u8bed\u53e5 \u6570\u636e\u5e93\u63a7\u5236\u8bed\u8a00\uff1a \u4f8b\u5982\u63a7\u5236\u7528\u6237\u7684\u8bbf\u95ee\u6743\u9650GRANT\u3001REVOKE 3. \u57fa\u672c\u64cd\u4f5c \u00b6 3.1 \u5e93 \u00b6 \u589e\uff1acreate database db1 charset utf8; \u67e5\uff1ashow databases; \u6539\uff1aalter database db1 charset latin1; \u5220\u9664: drop database db1; 3.2 \u8868 \u00b6 \u5148\u5207\u6362\u5230\u6587\u4ef6\u5939\u4e0b\uff1ause db1 \u589e\uff1acreate table t1(id int,name char); \u67e5\uff1ashow tables \u6539\uff1a alter table t1 modify name char(3); alter table t1 change name name1 char(2); \u5220\uff1adrop table t1; 3.2\u5176\u4ed6 \u00b6 \u589e\uff1ainsert into t1 values(1,'leco1'),(2,'leco2'),(3,'leco3'); \u67e5\uff1aselect * from t1; \u6539\uff1aupdate t1 set name='sb' where id=2; \u5220\uff1adelete from t1 where id=1;","title":"02. MySQL \u521d\u8bc6"},{"location":"mysql/mysql.info/#1","text":"\u6709\u4e86mysql\u8fd9\u4e2a\u6570\u636e\u5e93\u8f6f\u4ef6\uff0c\u5c31\u53ef\u4ee5\u5c06\u7a0b\u5e8f\u5458\u4ece\u5bf9\u6570\u636e\u7684\u7ba1\u7406\u4e2d\u89e3\u8131\u51fa\u6765\uff0c\u4e13\u6ce8\u4e8e\u5bf9\u7a0b\u5e8f\u903b\u8f91\u7684\u7f16\u5199 mysql\u670d\u52a1\u7aef\u8f6f\u4ef6\u5373mysqld\u5e2e\u6211\u4eec\u7ba1\u7406\u597d\u6587\u4ef6\u5939\u4ee5\u53ca\u6587\u4ef6\uff0c\u524d\u63d0\u662f\u4f5c\u4e3a\u4f7f\u7528\u8005\u7684\u6211\u4eec\uff0c\u9700\u8981\u4e0b\u8f7dmysql\u7684\u5ba2\u6237\u7aef\uff0c \u6216\u8005\u5176\u4ed6\u6a21\u5757\u6765\u8fde\u63a5\u5230mysqld\uff0c\u7136\u540e\u4f7f\u7528mysql\u8f6f\u4ef6\u89c4\u5b9a\u7684\u8bed\u6cd5\u683c\u5f0f\u53bb\u63d0\u4ea4\u81ea\u5df1\u547d\u4ee4\uff0c\u5b9e\u73b0\u5bf9\u6587\u4ef6\u5939\u6216\u6587\u4ef6\u7684\u7ba1\u7406\u3002 \u8be5\u8bed\u6cd5\u5373sql\uff08Structured Query Language \u5373\u7ed3\u6784\u5316\u67e5\u8be2\u8bed\u8a00\uff09","title":"1. \u63cf\u8ff0"},{"location":"mysql/mysql.info/#2","text":"SQL\u8bed\u8a00\u4e3b\u8981\u7528\u4e8e \u5b58\u53d6\u6570\u636e\u3001\u67e5\u8be2\u6570\u636e\u3001\u66f4\u65b0\u6570\u636e\u548c\u7ba1\u7406\u5173\u7cfb\u6570\u636e\u5e93\u7cfb\u7edf, SQL\u8bed\u8a00\u7531IBM\u5f00\u53d1\u3002SQL\u8bed\u8a00\u5206\u4e3a3\u79cd\u7c7b\u578b\uff1a 1\u3001DDL\u8bed\u53e5 \u6570\u636e\u5e93\u5b9a\u4e49\u8bed\u8a00\uff1a \u6570\u636e\u5e93\u3001\u8868\u3001\u89c6\u56fe\u3001\u7d22\u5f15\u3001\u5b58\u50a8\u8fc7\u7a0b\uff0c\u4f8b\u5982CREATE DROP ALTER 2\u3001DML\u8bed\u53e5 \u6570\u636e\u5e93\u64cd\u7eb5\u8bed\u8a00\uff1a \u63d2\u5165\u6570\u636eINSERT\u3001\u5220\u9664\u6570\u636eDELETE\u3001\u66f4\u65b0\u6570\u636eUPDATE\u3001\u67e5\u8be2\u6570\u636eSELECT 3\u3001DCL\u8bed\u53e5 \u6570\u636e\u5e93\u63a7\u5236\u8bed\u8a00\uff1a \u4f8b\u5982\u63a7\u5236\u7528\u6237\u7684\u8bbf\u95ee\u6743\u9650GRANT\u3001REVOKE","title":"2. \u4f5c\u7528"},{"location":"mysql/mysql.info/#3","text":"","title":"3. \u57fa\u672c\u64cd\u4f5c"},{"location":"mysql/mysql.info/#31","text":"\u589e\uff1acreate database db1 charset utf8; \u67e5\uff1ashow databases; \u6539\uff1aalter database db1 charset latin1; \u5220\u9664: drop database db1;","title":"3.1 \u5e93"},{"location":"mysql/mysql.info/#32","text":"\u5148\u5207\u6362\u5230\u6587\u4ef6\u5939\u4e0b\uff1ause db1 \u589e\uff1acreate table t1(id int,name char); \u67e5\uff1ashow tables \u6539\uff1a alter table t1 modify name char(3); alter table t1 change name name1 char(2); \u5220\uff1adrop table t1;","title":"3.2 \u8868"},{"location":"mysql/mysql.info/#32_1","text":"\u589e\uff1ainsert into t1 values(1,'leco1'),(2,'leco2'),(3,'leco3'); \u67e5\uff1aselect * from t1; \u6539\uff1aupdate t1 set name='sb' where id=2; \u5220\uff1adelete from t1 where id=1;","title":"3.2\u5176\u4ed6"},{"location":"mysql/mysql.insert/","text":"MySQL INSERT 1. \u4ecb\u7ecd \u00b6 1.1 \u73af\u5883\u51c6\u5907 \u00b6 drop table info; create table info( id int not null, name varchar(20), age int not null, score int not null ); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.02 sec) mysql> create table info( -> id int not null, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.05 sec) mysql> desc info; +-------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | | name | varchar(20) | YES | | NULL | | | age | int(11) | NO | | NULL | | | score | int(11) | NO | | NULL | | +-------+-------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> select * from info; Empty set (0.00 sec) 2. \u5f00\u59cb \u00b6 2.1 \u8bed\u6cd5 \u00b6 INSERT INTO \u8bed\u53e5\u7528\u4e8e\u5411\u8868\u683c\u4e2d\u63d2\u5165\u65b0\u7684\u884c INSERT INTO table_name (\u52171, \u52172,...) VALUES (\u503c1, \u503c2,....) \u6216\u8005 INSERT INTO table_name VALUES (\u503c1, \u503c2,....) 2.2 \u64cd\u4f5c \u00b6 mysql> insert into info(id,name,age,score) values(1,\"\u5f20\u4e09\",18,80); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | +----+--------+-----+-------+ 1 row in set (0.00 sec) mysql> insert into info values(2,\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.01 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u674e\u56db | 20 | 55 | +----+--------+-----+-------+ 2 rows in set (0.00 sec)","title":"15. SQL INSERT"},{"location":"mysql/mysql.insert/#1","text":"","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.insert/#11","text":"drop table info; create table info( id int not null, name varchar(20), age int not null, score int not null ); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.02 sec) mysql> create table info( -> id int not null, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.05 sec) mysql> desc info; +-------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | | name | varchar(20) | YES | | NULL | | | age | int(11) | NO | | NULL | | | score | int(11) | NO | | NULL | | +-------+-------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> select * from info; Empty set (0.00 sec)","title":"1.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.insert/#2","text":"","title":"2. \u5f00\u59cb"},{"location":"mysql/mysql.insert/#21","text":"INSERT INTO \u8bed\u53e5\u7528\u4e8e\u5411\u8868\u683c\u4e2d\u63d2\u5165\u65b0\u7684\u884c INSERT INTO table_name (\u52171, \u52172,...) VALUES (\u503c1, \u503c2,....) \u6216\u8005 INSERT INTO table_name VALUES (\u503c1, \u503c2,....)","title":"2.1 \u8bed\u6cd5"},{"location":"mysql/mysql.insert/#22","text":"mysql> insert into info(id,name,age,score) values(1,\"\u5f20\u4e09\",18,80); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | +----+--------+-----+-------+ 1 row in set (0.00 sec) mysql> insert into info values(2,\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.01 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u674e\u56db | 20 | 55 | +----+--------+-----+-------+ 2 rows in set (0.00 sec)","title":"2.2 \u64cd\u4f5c"},{"location":"mysql/mysql.integrity_constraint/","text":"MySQL \u5b8c\u6574\u6027\u7ea6\u675f 1. \u4ecb\u7ecd \u00b6 \u7ea6\u675f\u6761\u4ef6\u4e0e\u6570\u636e\u7c7b\u578b\u7684\u5bbd\u5ea6\u4e00\u6837\uff0c\u90fd\u662f\u53ef\u9009\u53c2\u6570\uff0c\u7528\u4e8e\u4fdd\u8bc1\u6570\u636e\u7684\u5b8c\u6574\u6027\u548c\u4e00\u81f4\u6027\uff0c\u4e3b\u8981\u5206\u4e3a\u4ee5\u4e0b\u51e0\u79cd PRIMARY KEY (PK) \u6807\u8bc6\u8be5\u5b57\u6bb5\u4e3a\u8be5\u8868\u7684\u4e3b\u952e\uff0c\u53ef\u4ee5\u552f\u4e00\u7684\u6807\u8bc6\u8bb0\u5f55 FOREIGN KEY (FK) \u6807\u8bc6\u8be5\u5b57\u6bb5\u4e3a\u8be5\u8868\u7684\u5916\u952e NOT NULL \u6807\u8bc6\u8be5\u5b57\u6bb5\u4e0d\u80fd\u4e3a\u7a7a UNIQUE KEY (UK) \u6807\u8bc6\u8be5\u5b57\u6bb5\u7684\u503c\u662f\u552f\u4e00\u7684 AUTO_INCREMENT \u6807\u8bc6\u8be5\u5b57\u6bb5\u7684\u503c\u81ea\u52a8\u589e\u957f\uff08\u6574\u6570\u7c7b\u578b\uff0c\u800c\u4e14\u4e3a\u4e3b\u952e\uff09 DEFAULT \u4e3a\u8be5\u5b57\u6bb5\u8bbe\u7f6e\u9ed8\u8ba4\u503c UNSIGNED \u65e0\u7b26\u53f7 ZEROFILL \u4f7f\u75280\u586b\u5145 \u6ce8\u610f 1. \u662f\u5426\u5141\u8bb8\u4e3a\u7a7a\uff0c\u9ed8\u8ba4 NULL \uff0c\u53ef\u8bbe\u7f6e NOT NULL \uff0c\u5b57\u6bb5\u4e0d\u5141\u8bb8\u4e3a\u7a7a\uff0c\u5fc5\u987b\u8d4b\u503c 2. \u5b57\u6bb5\u662f\u5426\u6709\u9ed8\u8ba4\u503c\uff0c\u7f3a\u7701\u7684\u9ed8\u8ba4\u503c\u662f NULL \uff0c\u5982\u679c\u63d2\u5165\u8bb0\u5f55\u65f6\u4e0d\u7ed9\u5b57\u6bb5\u8d4b\u503c\uff0c\u6b64\u5b57\u6bb5\u4f7f\u7528\u9ed8\u8ba4\u503c sex enum ( 'male' , 'female' ) not null default 'male' age int unsigned NOT NULL default 20 \u5fc5\u987b\u4e3a\u6b63\u503c\uff08\u65e0\u7b26\u53f7\uff09 \u4e0d\u5141\u8bb8\u4e3a\u7a7a \u9ed8\u8ba4\u662f 20 3. \u662f\u5426\u662f key \u4e3b\u952e primary key \u5916\u952e foreign key \u7d22\u5f15 ( index , unique ... ) 2. not null\u4e0edefault \u00b6 \u662f\u5426\u53ef\u7a7a\uff0cnull\u8868\u793a\u7a7a\uff0c\u975e\u5b57\u7b26\u4e32 not null - \u4e0d\u53ef\u7a7a null - \u53ef\u7a7a \u9ed8\u8ba4\u503c\uff0c\u521b\u5efa\u5217\u65f6\u53ef\u4ee5\u6307\u5b9a\u9ed8\u8ba4\u503c\uff0c\u5f53\u63d2\u5165\u6570\u636e\u65f6\u5982\u679c\u672a\u4e3b\u52a8\u8bbe\u7f6e\uff0c\u5219\u81ea\u52a8\u6dfb\u52a0\u9ed8\u8ba4\u503c create table t15( id int(11) unsigned zerofill ); mysql> create table t15( -> id int(11) unsigned zerofill -> ); Query OK, 0 rows affected (0.38 sec) mysql> desc t15; +-------+---------------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+---------------------------+------+-----+---------+-------+ | id | int(11) unsigned zerofill | YES | | NULL | | +-------+---------------------------+------+-----+---------+-------+ row in set (0.01 sec) int\u7ea6\u675f\u662f\u6574\u5f62\uff0c11\u8868\u793a\u5bbd\u5ea6\uff0cunsigned \u8868\u793a\u65e0\u7b26\u53f7\uff0czerofill\u8868\u793a\u4e0d\u591f\u75280\u586b\u5145\u3002 create table t16( id int(11), name char(6), sex enum('male','female') not null default 'male' ); mysql> create table t16( -> id int(11), -> name char(6), -> sex enum('male','female') not null default 'male' -> ); Query OK, 0 rows affected (0.42 sec) mysql> desc t16; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | char(6) | YES | | NULL | | | sex | enum('male','female') | NO | | male | | +-------+-----------------------+------+-----+---------+-------+ rows in set (0.00 sec) # enum\u8868\u793a\u679a\u4e3e\uff0cnot null \u8868\u793a\u4e0d\u4e3a\u7a7a\uff0cdefault 'male' \u8868\u793asex\u4e0d\u4f20\u5165\u7684\u8bdd\u9ed8\u8ba4\u503c\u662fmale \u4f8b\u5b50 mysql> insert into t16(id,name) values(1,'cmz'); # sex\u6ca1\u6709\u4f20\u5165\uff0c\u9ed8\u8ba4\u4e3amale Query OK, 1 row affected (0.36 sec) mysql> desc t16; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | char(6) | YES | | NULL | | | sex | enum('male','female') | NO | | male | | +-------+-----------------------+------+-----+---------+-------+ rows in set (0.00 sec) mysql> select * from t16; +------+------+------+ | id | name | sex | +------+------+------+ | 1 | cmz | male | +------+------+------+ row in set (0.00 sec) ==================not null==================== mysql> create table t1(id int); #id\u5b57\u6bb5\u9ed8\u8ba4\u53ef\u4ee5\u63d2\u5165\u7a7a mysql> desc t1; +-------+---------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+---------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | +-------+---------+------+-----+---------+-------+ mysql> insert into t1 values(); #\u53ef\u4ee5\u63d2\u5165\u7a7a mysql> create table t2(id int not null); #\u8bbe\u7f6e\u5b57\u6bb5id\u4e0d\u4e3a\u7a7a mysql> desc t2; +-------+---------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+---------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | +-------+---------+------+-----+---------+-------+ mysql> insert into t2 values(); #\u4e0d\u80fd\u63d2\u5165\u7a7a ERROR 1364 (HY000): Field 'id' doesn't have a default value ==================default==================== #\u8bbe\u7f6eid\u5b57\u6bb5\u6709\u9ed8\u8ba4\u503c\u540e\uff0c\u5219\u65e0\u8bbaid\u5b57\u6bb5\u662fnull\u8fd8\u662fnot null\uff0c\u90fd\u53ef\u4ee5\u63d2\u5165\u7a7a\uff0c\u63d2\u5165\u7a7a\u9ed8\u8ba4\u586b\u5165default\u6307\u5b9a\u7684\u9ed8\u8ba4\u503c mysql> create table t3(id int default 1); mysql> alter table t3 modify id int not null default 1; ==================\u7efc\u5408\u7ec3\u4e60==================== mysql> create table student( -> name varchar(20) not null, -> age int(3) unsigned not null default 18, -> sex enum('male','female') default 'male', -> hobby set('play','study','read','music') default 'play,music' -> ); mysql> desc student; +-------+------------------------------------+------+-----+------------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+------------------------------------+------+-----+------------+-------+ | name | varchar(20) | NO | | NULL | | | age | int(3) unsigned | NO | | 18 | | | sex | enum('male','female') | YES | | male | | | hobby | set('play','study','read','music') | YES | | play,music | | +-------+------------------------------------+------+-----+------------+-------+ mysql> insert into student(name) values('cmz'); mysql> select * from student; +------+-----+------+------------+ | name | age | sex | hobby | +------+-----+------+------------+ | cmz | 18 | male | play,music | +------+-----+------+------------+ 3. unique \u00b6 \u521b\u5efa\u552f\u4e00\u7d22\u5f15\u7684\u76ee\u7684\u4e0d\u662f\u4e3a\u4e86\u63d0\u9ad8\u8bbf\u95ee\u901f\u5ea6\uff0c\u800c\u53ea\u662f\u4e3a\u4e86\u907f\u514d\u6570\u636e\u51fa\u73b0\u91cd\u590d\u3002\u552f\u4e00\u7d22\u5f15\u53ef\u4ee5\u6709\u591a\u4e2a\u4f46\u7d22\u5f15\u5217\u7684\u503c\u5fc5\u987b\u552f\u4e00\uff0c\u7d22\u5f15\u5217\u7684\u503c\u5141\u8bb8\u6709\u7a7a\u503c\u3002\u5982\u679c\u80fd\u786e\u5b9a\u67d0\u4e2a\u6570\u636e\u5217\u5c06\u53ea\u5305\u542b\u5f7c\u6b64\u5404\u4e0d\u76f8\u540c\u7684\u503c\uff0c\u5728\u4e3a\u8fd9\u4e2a\u6570\u636e\u5217\u521b\u5efa\u7d22\u5f15\u7684\u65f6\u5019\u5c31\u5e94\u8be5\u4f7f\u7528\u5173\u952e\u5b57UNIQUE\u3002 #-------------------------------------------unique key # \u5355\u5217\u552f\u4e00 # \u65b9\u5f0f1 create table department( id int, name char(10) unique ); # \u65b9\u5f0f2 create table department( id int, name char(10), unique(name) ); insert into department values(1,'IT'),(2,'sales'); insert into department values(3,'IT'); # \u4f1a\u62a5\u9519 mysql> create table department( -> id int, -> name char(10) unique -> ); Query OK, 0 rows affected (0.04 sec) mysql> insert into department values(1,'IT'),(2,'sales'); Query OK, 2 rows affected (0.04 sec) Records: 2 Duplicates: 0 Warnings: 0 mysql> desc department; +-------+----------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+----------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | char(10) | YES | UNI | NULL | | +-------+----------+------+-----+---------+-------+ rows in set (0.00 sec) mysql> select * from department; +------+-------+ | id | name | +------+-------+ | 1 | IT | | 2 | sales | +------+-------+ rows in set (0.00 sec) mysql> insert into department values(3,'IT'); ERROR 1062 (23000): Duplicate entry 'IT' for key 'name' \u5176\u4ed6\u8981\u662f\u786e\u5b9a\u552f\u4e00\u6027\uff0c\u5c31\u6dfb\u52a0unique\u5373\u53ef\u3002 # \u8054\u5408\u552f\u4e00 create table services( id int, ip char(15), port int, unique(id), unique(ip,port) ); insert into services values (1,'192.168.1.100',80), (2,'192.168.1.100',8080), (3,'192.168.1.110',80); insert into services values (1,'192.168.1.100',80); #\u4f1a\u62a5\u9519 mysql> create table services( -> id int, -> ip char(15), -> port int, -> unique(id), -> unique(ip,port) -> ); Query OK, 0 rows affected (0.41 sec) mysql> desc services; +-------+----------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+----------+------+-----+---------+-------+ | id | int(11) | YES | UNI | NULL | | | ip | char(15) | YES | MUL | NULL | | | port | int(11) | YES | | NULL | | +-------+----------+------+-----+---------+-------+ rows in set (0.01 sec) mysql> insert into services values -> (1,'192.168.1.100',80), -> (2,'192.168.1.100',8080), -> (3,'192.168.1.110',80); Query OK, 3 rows affected (0.37 sec) Records: 3 Duplicates: 0 Warnings: 0 mysql> select * from services; +------+---------------+------+ | id | ip | port | +------+---------------+------+ | 1 | 192.168.1.100 | 80 | | 2 | 192.168.1.100 | 8080 | | 3 | 192.168.1.110 | 80 | +------+---------------+------+ rows in set (0.00 sec) mysql> insert into services values (1,'192.168.1.100',80); #\u4f1a\u62a5\u9519 ERROR 1062 (23000): Duplicate entry '1' for key 'id' 4. primary key \u00b6 primary key\u5b57\u6bb5\u7684\u503c\u4e0d\u4e3a\u7a7a\u4e14\u552f\u4e00\uff0c\u4e00\u4e2a\u8868\u4e2d\u53ef\u4ee5\uff1a 1. \u5355\u5217\u505a\u4e3b\u952e 2. \u591a\u5217\u505a\u4e3b\u952e\uff08\u590d\u5408\u4e3b\u952e\uff09 3. \u4e00\u4e2a\u8868\u5185\u53ea\u80fd\u6709\u4e00\u4e2a\u4e3b\u952eprimary key # primary key \u7ea6\u675f not null unique \u5b58\u50a8\u5f15\u64ce(innodb)\uff0c\u5bf9\u4e8einnodb\u5b58\u50a8\u5f15\u64ce\u6765\u8bf4\uff0c\u4e00\u4e2a\u8868\u5185\u5fc5\u987b\u6709\u4e00\u4e2a\u4e3b\u952e\u3002 # \u5355\u5217\u4e3b\u952e create table t17( id int primary key, name char(16) ); insert into t17 values (1,'cmz'), (2,'leco'), (3,'nanjing'); insert into t17 values (1,'nanjing'); # \u91cd\u590d\u4e86 mysql> create table t17( -> id int primary key, -> name char(16) -> ); Query OK, 0 rows affected (0.48 sec) mysql> desc t17; +-------+----------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+----------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | char(16) | YES | | NULL | | +-------+----------+------+-----+---------+-------+ rows in set (0.01 sec) mysql> insert into t17 values (1,'nanjing'); ERROR 1062 (23000): Duplicate entry '1' for key 'PRIMARY' # mysql\u5efa\u8868\u7684\u65f6\u5019\u8981\u662f\u6ca1\u6709\u6307\u5b9a\u4e3b\u952e\uff0cmysql\u4f1a\u641c\u6574\u4e2a\u8868\u627e\u4e00\u4e2a\u4e0d\u4e3a\u7a7a\uff0c\u4e14\u552f\u4e00\u7684\u4f5c\u4e3a\u4e3b\u952e \u8981\u662f\u627e\u4e0d\u5230\uff0c\u5c31\u4f1a\u9ed8\u8ba4\u4f7f\u7528\u9690\u85cf\u4e3b\u952e\u3002 create table t18( id int not null unique, name char(16) ); mysql> create table t18( -> id int not null unique, -> name char(16) -> ); Query OK, 0 rows affected (0.40 sec) mysql> desc t18; +-------+----------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+----------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | # \u53ef\u4ee5\u770b\u51fa\u4f5c\u4e3a\u4e86\u4e3b\u952e | name | char(16) | YES | | NULL | | +-------+----------+------+-----+---------+-------+ rows in set (0.00 sec) \u901a\u5e38\u4e00\u4e2a\u8868\u4e2d\u6709\u4e00\u4e2aid\u5b57\u6bb5\u4f5c\u4e3a\u4e3b\u952e\u3002 # \u7b26\u5408\u4e3b\u952e \u591a\u4e2a\u5b57\u6bb5\u8054\u5408\u5728\u4e00\u8d77\u4f5c\u4e3a\u4e3b\u952e create table t19( ip char(15), port int, primary key(ip,port) ); create table loocha( ip varchar(15), port char(5), service_name varchar(10) not null, primary key(ip,port) ); mysql> create table t19( -> ip char(15), -> port int, -> primary key(ip,port) -> ); Query OK, 0 rows affected (0.39 sec) mysql> desc t19; +-------+----------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+----------+------+-----+---------+-------+ | ip | char(15) | NO | PRI | NULL | | | port | int(11) | NO | PRI | NULL | | +-------+----------+------+-----+---------+-------+ rows in set (0.00 sec) mysql> create table loocha( -> ip varchar(15), -> port char(5), -> service_name varchar(10) not null, -> primary key(ip,port) -> ); Query OK, 0 rows affected (0.03 sec) mysql> desc loocha -> ; +--------------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +--------------+-------------+------+-----+---------+-------+ | ip | varchar(15) | NO | PRI | NULL | | | port | char(5) | NO | PRI | NULL | | | service_name | varchar(10) | NO | | NULL | | +--------------+-------------+------+-----+---------+-------+ rows in set (0.01 sec) insert into t19 values ('192.168.1.110',80); insert into t19 values ('192.168.1.110',80); # \u62a5\u9519 mysql> insert into t19 values ('192.168.1.110',80); Query OK, 1 row affected (0.01 sec) mysql> insert into t19 values ('192.168.1.110',80); ERROR 1062 (23000): Duplicate entry '192.168.1.110-80' for key 'PRIMARY' mysql> select * from t19; +---------------+------+ | ip | port | +---------------+------+ | 192.168.1.110 | 80 | +---------------+------+ row in set (0.00 sec) ============\u5355\u5217\u505a\u4e3b\u952e=============== #\u65b9\u6cd5\u4e00\uff1anot null+unique create table department1( id int not null unique, #\u4e3b\u952e name varchar(20) not null unique, comment varchar(100) ); mysql> desc department1; +---------+--------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +---------+--------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | varchar(20) | NO | UNI | NULL | | | comment | varchar(100) | YES | | NULL | | +---------+--------------+------+-----+---------+-------+ rows in set (0.01 sec) #\u65b9\u6cd5\u4e8c\uff1a\u5728\u67d0\u4e00\u4e2a\u5b57\u6bb5\u540e\u7528primary key create table department2( id int primary key, #\u4e3b\u952e name varchar(20), comment varchar(100) ); mysql> desc department2; +---------+--------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +---------+--------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | varchar(20) | YES | | NULL | | | comment | varchar(100) | YES | | NULL | | +---------+--------------+------+-----+---------+-------+ rows in set (0.00 sec) #\u65b9\u6cd5\u4e09\uff1a\u5728\u6240\u6709\u5b57\u6bb5\u540e\u5355\u72ec\u5b9a\u4e49primary key create table department3( id int, name varchar(20), comment varchar(100), constraint pk_name primary key(id); #\u521b\u5efa\u4e3b\u952e\u5e76\u4e3a\u5176\u547d\u540dpk_name mysql> desc department3; +---------+--------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +---------+--------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | varchar(20) | YES | | NULL | | | comment | varchar(100) | YES | | NULL | | +---------+--------------+------+-----+---------+-------+ rows in set (0.01 sec) \u5355\u5217\u4e3b\u952e ==================\u591a\u5217\u505a\u4e3b\u952e================ create table service( ip varchar(15), port char(5), service_name varchar(10) not null, primary key(ip,port) ); mysql> desc service; +--------------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +--------------+-------------+------+-----+---------+-------+ | ip | varchar(15) | NO | PRI | NULL | | | port | char(5) | NO | PRI | NULL | | | service_name | varchar(10) | NO | | NULL | | +--------------+-------------+------+-----+---------+-------+ rows in set (0.00 sec) mysql> insert into service values -> ('172.16.45.10','3306','mysqld'), -> ('172.16.45.11','3306','mariadb') -> ; Query OK, 2 rows affected (0.00 sec) Records: 2 Duplicates: 0 Warnings: 0 mysql> insert into service values ('172.16.45.10','3306','nginx'); ERROR 1062 (23000): Duplicate entry '172.16.45.10-3306' for key 'PRIMARY' 5. auto_increment \u00b6 \u6570\u636e\u5e93\u5e94\u7528\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u9700\u8981\u7528\u5230\u81ea\u52a8\u9012\u589e\u7684\u552f\u4e00\u7f16\u53f7\u6765\u6807\u8bc6\u8bb0\u5f55\u3002\u5728MySQL\u4e2d\uff0c\u53ef\u901a\u8fc7\u6570\u636e\u5217\u7684auto_increment\u5c5e\u6027\u6765\u81ea\u52a8\u751f\u6210\u3002\u53ef\u5728\u5efa\u8868\u65f6\u53ef\u7528\u201cauto_increment=n\u201d\u9009\u9879\u6765\u6307\u5b9a\u4e00\u4e2a\u81ea\u589e\u7684\u521d\u59cb\u503c\u3002\u53ef\u7528\u201calter table table_name auto_increment=n\u201d\u547d\u4ee4\u6765\u91cd\u8bbe\u81ea\u589e\u7684\u8d77\u59cb\u503c\uff0c\u5f53\u7136\u5728\u8bbe\u7f6e\u7684\u65f6\u5019Mysql\u4f1a\u53d6\u6570\u636e\u8868\u4e2dauto_increment\u5217\u7684\u6700\u5927\u503c + 1\u4e0en\u4e2d\u7684\u8f83\u5927\u8005\u4f5c\u4e3a\u65b0\u7684auto_increment\u503c\u3002 Myql\u7684auto_increment\u5c5e\u6027\u5177\u6709\u4ee5\u4e0b\u7279\u6027\uff1a \u5177\u6709auto_increment\u5c5e\u6027\u7684\u6570\u636e\u5217\u5e94\u8be5\u662f\u4e00\u4e2a\u6b63\u6570\u5e8f\u5217\uff0c\u5982\u679c\u628a\u8be5\u6570\u636e\u5217\u58f0\u660e\u4e3aUNSIGNED\uff0c\u8fd9\u6837\u5e8f\u5217\u7684\u7f16\u53f7\u4e2a\u6570\u53ef\u589e\u52a0\u4e00\u500d\u3002\u6bd4\u5982tinyint\u6570\u636e\u5217\u7684\u6700\u5927\u7f16\u53f7\u662f127\uff0c\u5982\u679c\u52a0\u4e0aUNSIGNED\uff0c\u90a3\u4e48\u6700\u5927\u7f16\u53f7\u53d8\u4e3a255 auto_increment\u6570\u636e\u5217\u5fc5\u987b\u6709\u552f\u4e00\u7d22\u5f15\uff0c\u4ee5\u907f\u514d\u5e8f\u53f7\u91cd\u590d\uff1b\u5fc5\u987b\u5177\u5907NOT NULL\u5c5e\u6027 # auto_increment # \u7ea6\u675f\u5b57\u6bb5\u4e3a\u81ea\u52a8\u589e\u957f\uff0c\u88ab\u7ea6\u675f\u7684\u5b57\u6bb5\u5fc5\u987b\u540c\u65f6\u88abkey\u7ea6\u675f # primary key or unique key #----------------------------------------------------------- # #\u4e0d\u6307\u5b9aid\uff0c\u5219\u81ea\u52a8\u589e\u957f create table t20( id int primary key auto_increment, name char(16) ); mysql> create table t20( -> id int primary key auto_increment, -> name char(16) -> ); Query OK, 0 rows affected (0.02 sec) mysql> desc t20; +-------+----------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +-------+----------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | char(16) | YES | | NULL | | +-------+----------+------+-----+---------+----------------+ rows in set (0.02 sec) insert into t20(name) values('cmz1'),('leco'),('loocha'); mysql> insert into t20(name) values('cmz1'),('leco'),('loocha'); Query OK, 3 rows affected (0.36 sec) Records: 3 Duplicates: 0 Warnings: 0 mysql> select * from t20; +----+--------+ | id | name | +----+--------+ | 1 | cmz1 | | 2 | leco | | 3 | loocha | +----+--------+ rows in set (0.00 sec) insert into t20(id,name) values(7,'keke'); # \u53ef\u4ee5\u624b\u52a8\u63d2\u5165primary key\u53ea\u8981\u4fdd\u8bc1\u4e3b\u952e\u552f\u4e00\u5373\u53ef\uff0c\u4ee5\u540e\u5728\u63d2\u5165\u5c31\u5728\u8be5\u57fa\u7840\u4e0a\u81ea\u589e\u52a0 mysql> insert into t20(id,name) values(7,'cmz1'); Query OK, 1 row affected (0.00 sec) mysql> select * from t20; +----+--------+ | id | name | +----+--------+ | 1 | cmz1 | | 2 | leco | | 3 | loocha | | 7 | cmz1 | +----+--------+ rows in set (0.01 sec) \u81ea\u589e\u957f\u6b65\u957f\u9ed8\u8ba4\u4e3a1 show variables like 'auto_inc%'; mysql> show variables like 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 1 | # \u6b65\u957f \u9ed8\u8ba4\u4e3a1 | auto_increment_offset | 1 | # \u8d77\u59cb\u504f\u79fb\u91cf \u9ed8\u8ba4\u4e3a1 +--------------------------+-------+ rows in set (0.08 sec) # \u8bbe\u7f6e\u6b65\u957f # session \u6709\u6548 set session auto_increment_increment=5; # \u5168\u5c40 set global auto_increment_increment=5; # \u8bbe\u7f6e\u8d77\u59cb\u504f\u79fb\u91cf set global auto_increment_offset=3; \u5f3a\u8c03\u8d77\u59cb\u504f\u79fb\u91cf<=\u6b65\u957f #\u4f8b\u5b50\u8bbe\u7f6e\u4e0d\u6b65\u957f\u548c\u8d77\u59cb\u504f\u79fb\u91cf mysql> set global auto_increment_offset=3; Query OK, 0 rows affected (0.00 sec) mysql> set global auto_increment_increment=5; Query OK, 0 rows affected (0.00 sec) \u91cd\u65b0\u767b\u5f55\u3002 mysql> show variables like 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 5 | | auto_increment_offset | 3 | +--------------------------+-------+ rows in set (0.01 sec) create table t21( id int primary key auto_increment, name char(16) ); mysql> create table t21( -> id int primary key auto_increment, -> name char(16) -> ); Query OK, 0 rows affected (0.40 sec) \u63d2\u5165\u6570\u636e insert into t21(name) values ('cmz'),('leco'),('loocha'); mysql> insert into t21(name) values -> ('cmz'),('leco'),('loocha'); Query OK, 3 rows affected (0.02 sec) Records: 3 Duplicates: 0 Warnings: 0 mysql> select * from t21; +----+--------+ | id | name | +----+--------+ | 3 | cmz | | 8 | leco | | 13 | loocha | +----+--------+ rows in set (0.00 sec) # \u6e05\u7a7a\u8868 delete from t20; mysql> delete from t20; Query OK, 4 rows affected (0.01 sec) mysql> select * from t20; Empty set (0.00 sec) mysql> show create table t20; +-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ | Table | Create Table | +-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ | t20 | CREATE TABLE `t20` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` char(16) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=latin1 | +-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ row in set (0.00 sec) # \u867d\u7136\u6e05\u7a7a\u4e86\u8868\uff0c\u4f46\u662f\u4e3b\u952e\u6ca1\u5220\u9664 mysql> insert into t20(name) values('cccc'); Query OK, 1 row affected (0.01 sec) mysql> select * from t20; +----+------+ | id | name | +----+------+ | 8 | cccc | +----+------+ row in set (0.00 sec) #truncate \u6e05\u7a7a\u8868\uff0c\u4e3b\u952e\u4e5f\u5220\u9664 mysql> truncate t20; Query OK, 0 rows affected (0.03 sec) mysql> show create table t20; +-------+----------------------------------------------------------------------------------------------------------------------------------------------------------+ | Table | Create Table | +-------+----------------------------------------------------------------------------------------------------------------------------------------------------------+ | t20 | CREATE TABLE `t20` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` char(16) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=latin1 | +-------+----------------------------------------------------------------------------------------------------------------------------------------------------------+ row in set (0.00 sec) mysql> insert into t20(name) values('cccc'); Query OK, 1 row affected (0.01 sec) mysql> select * from t20; +----+------+ | id | name | +----+------+ | 1 | cccc | +----+------+ row in set (0.00 sec) 6. \u6848\u4f8b \u00b6 \u5458\u5de5\u4fe1\u606f\u8868\u6709\u4e09\u4e2a\u5b57\u6bb5\uff1a\u5de5\u53f7 \u59d3\u540d \u90e8\u95e8,\u516c\u53f8\u67093\u4e2a\u90e8\u95e8\uff0c\u4f46\u662f\u67091\u4e2a\u4ebf\u7684\u5458\u5de5\uff0c\u90a3\u610f\u5473\u7740\u90e8\u95e8\u8fd9\u4e2a\u5b57\u6bb5\u9700\u8981\u91cd\u590d\u5b58\u50a8\uff0c\u90e8\u95e8\u540d\u5b57\u8d8a\u957f\uff0c\u8d8a\u6d6a\u8d39 \u89e3\u51b3\u65b9\u6cd5\uff1a \u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u90e8\u95e8\u8868 \u7136\u540e\u8ba9\u5458\u5de5\u4fe1\u606f\u8868\u5173\u8054\u8be5\u8868\uff0c\u5982\u4f55\u5173\u8054\uff0c\u5373foreign key \u53d8\u4e3a\u4e24\u4e2a\u8868\uff0cemp\u548cdep\u8868\uff0c\u540c\u65f6\uff45\uff4d\uff50\u7684\u8868\u4e2ddep_id\u3000\u5173\u8054\u5230\uff44\uff45\uff50\u8868\u4e2d\u7684\u7684\uff49\uff44\u5b57\u6bb5\u3002 #1. \u5148\u5efa\u88ab\u5173\u8054\u7684\u8868\uff0c\u4e14\u4fdd\u8bc1\u88ab\u5173\u8054\u7684\u5b57\u6bb5\u552f\u4e00 #2. \u7136\u540e\u5728\u5efa\u7acb\u5173\u8054\u7684\u8868 create table dep( id int primary key, name char(10), comment char(50) ); create table emp( id int primary key, name char(10), sex enum('male','female'), dep_id int, foreign key(dep_id) references dep(id) on delete cascade on update cascade ); \u6ce8\u610f\uff1a \u3000foreign key(dep_id) references dep(id) \u3000on delete cascade \u3000on update cascade \u3000\u662f\u4e00\u53e5\u8bdd\uff0c\u4e5f\u5c31\u662f \u3000foreign key(dep_id) references dep(id)\u3000on delete cascade\u3000on update cascade \u3000\u5176\u4e2ddep\u8868\u64cd\u4f5c\u3002\u4fee\u6539\u6216\u8005\u5220\u9664\uff0c\uff45\uff4d\uff50\u8868\u5c31\u4f1a\u8ddf\u7740\u53d8\u52a8\uff0c\u8be6\u89c1\u4e0b\u9762\u6d4b\u8bd5\u3002 #3. \u63d2\u5165\u6570\u636e # \u5148\u63d2\u5165\u88ab\u5173\u8054\u8868\u7684\u6570\u636e insert into dep values (1,\"IT\",\"\u6280\u672f\u90e8\u95e8\"), (2,\"\u9500\u552e\",\"\u9500\u552e\u90e8\u95e8\"), (3,\"\u8d22\u52a1\",\"\u8d22\u52a1\u90e8\u95e8\"); insert into emp values(1,'cmz','male',1); insert into emp values(2,'keke','male',2); insert into emp values(3,'leco','female',3); # \u64cd\u4f5c\u8fc7\u7a0b mysql> create table dep( -> id int primary key, -> name char(10), -> comment char(50) -> ); Query OK, 0 rows affected (0.02 sec) mysql> create table emp( -> id int primary key, -> name char(10), -> sex enum('male','female'), -> dep_id int, -> foreign key(dep_id) references dep(id) -> on delete cascade -> on update cascade -> ); Query OK, 0 rows affected (0.04 sec) mysql> desc emp; +--------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +--------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | char(10) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | dep_id | int(11) | YES | MUL | NULL | | +--------+-----------------------+------+-----+---------+-------+ rows in set (0.00 sec) mysql> desc dep; +---------+----------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +---------+----------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | char(10) | YES | | NULL | | | comment | char(50) | YES | | NULL | | +---------+----------+------+-----+---------+-------+ rows in set (0.01 sec) \u63d2\u5165\u6570\u636e mysql> insert into dep values -> (1,\"IT\",\"\u6280\u672f\u90e8\u95e8\"), -> (2,\"\u9500\u552e\",\"\u9500\u552e\u90e8\u95e8\"), -> (3,\"\u8d22\u52a1\",\"\u8d22\u52a1\u90e8\u95e8\"); Query OK, 3 rows affected (0.00 sec) Records: 3 Duplicates: 0 Warnings: 0 mysql> select * from dep; +----+--------+--------------+ | id | name | comment | +----+--------+--------------+ | 1 | IT | \u6280\u672f\u90e8\u95e8 | | 2 | \u9500\u552e | \u9500\u552e\u90e8\u95e8 | | 3 | \u8d22\u52a1 | \u8d22\u52a1\u90e8\u95e8 | +----+--------+--------------+ rows in set (0.00 sec) mysql> insert into emp values(1,'cmz','male',1); Query OK, 1 row affected (0.01 sec) mysql> insert into emp values(2,'keke','male',2); Query OK, 1 row affected (0.01 sec) mysql> insert into emp values(3,'leco','female',3); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+------+--------+--------+ | id | name | sex | dep_id | +----+------+--------+--------+ | 1 | cmz | male | 1 | | 2 | keke | male | 2 | | 3 | leco | female | 3 | +----+------+--------+--------+ rows in set (0.00 sec) \u522a\u9664 \u522a\u9664\u4e86\u90e8\u9580\uff0c\u8ddf\u4ed6\u5173\u8054\u7684\u90e8\u95e8\u4eba\u5458\u90fd\u4f1a\u88ab\u5220\u9664\u3002 mysql> delete from dep where id=1; Query OK, 1 row affected (0.01 sec) mysql> select * from dep; +----+--------+--------------+ | id | name | comment | +----+--------+--------------+ | 2 | \u9500\u552e | \u9500\u552e\u90e8\u95e8 | | 3 | \u8d22\u52a1 | \u8d22\u52a1\u90e8\u95e8 | +----+--------+--------------+ rows in set (0.00 sec) mysql> select * from emp; +----+------+--------+--------+ | id | name | sex | dep_id | +----+------+--------+--------+ | 2 | keke | male | 2 | | 3 | leco | female | 3 | +----+------+--------+--------+ rows in set (0.00 sec) #\u66f4\u65b0 #\u66f4\u65b0\u4e86\u90e8\u9580\uff0c\u8ddf\u4ed6\u5173\u8054\u7684\u90e8\u95e8\u4eba\u5458\u90fd\u4f1a\u88ab\u66f4\u65b0\u3002 mysql> update dep set id=10 where id=2; Query OK, 1 row affected (0.01 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> select * from dep; +----+--------+--------------+ | id | name | comment | +----+--------+--------------+ | 3 | \u8d22\u52a1 | \u8d22\u52a1\u90e8\u95e8 | | 10 | \u9500\u552e | \u9500\u552e\u90e8\u95e8 | +----+--------+--------------+ rows in set (0.00 sec) mysql> select * from emp; +----+------+--------+--------+ | id | name | sex | dep_id | +----+------+--------+--------+ | 2 | keke | male | 10 | | 3 | leco | female | 3 | +----+------+--------+--------+ rows in set (0.00 sec)","title":"06. \u5b8c\u6574\u6027\u7ea6\u675f"},{"location":"mysql/mysql.integrity_constraint/#1","text":"\u7ea6\u675f\u6761\u4ef6\u4e0e\u6570\u636e\u7c7b\u578b\u7684\u5bbd\u5ea6\u4e00\u6837\uff0c\u90fd\u662f\u53ef\u9009\u53c2\u6570\uff0c\u7528\u4e8e\u4fdd\u8bc1\u6570\u636e\u7684\u5b8c\u6574\u6027\u548c\u4e00\u81f4\u6027\uff0c\u4e3b\u8981\u5206\u4e3a\u4ee5\u4e0b\u51e0\u79cd PRIMARY KEY (PK) \u6807\u8bc6\u8be5\u5b57\u6bb5\u4e3a\u8be5\u8868\u7684\u4e3b\u952e\uff0c\u53ef\u4ee5\u552f\u4e00\u7684\u6807\u8bc6\u8bb0\u5f55 FOREIGN KEY (FK) \u6807\u8bc6\u8be5\u5b57\u6bb5\u4e3a\u8be5\u8868\u7684\u5916\u952e NOT NULL \u6807\u8bc6\u8be5\u5b57\u6bb5\u4e0d\u80fd\u4e3a\u7a7a UNIQUE KEY (UK) \u6807\u8bc6\u8be5\u5b57\u6bb5\u7684\u503c\u662f\u552f\u4e00\u7684 AUTO_INCREMENT \u6807\u8bc6\u8be5\u5b57\u6bb5\u7684\u503c\u81ea\u52a8\u589e\u957f\uff08\u6574\u6570\u7c7b\u578b\uff0c\u800c\u4e14\u4e3a\u4e3b\u952e\uff09 DEFAULT \u4e3a\u8be5\u5b57\u6bb5\u8bbe\u7f6e\u9ed8\u8ba4\u503c UNSIGNED \u65e0\u7b26\u53f7 ZEROFILL \u4f7f\u75280\u586b\u5145 \u6ce8\u610f 1. \u662f\u5426\u5141\u8bb8\u4e3a\u7a7a\uff0c\u9ed8\u8ba4 NULL \uff0c\u53ef\u8bbe\u7f6e NOT NULL \uff0c\u5b57\u6bb5\u4e0d\u5141\u8bb8\u4e3a\u7a7a\uff0c\u5fc5\u987b\u8d4b\u503c 2. \u5b57\u6bb5\u662f\u5426\u6709\u9ed8\u8ba4\u503c\uff0c\u7f3a\u7701\u7684\u9ed8\u8ba4\u503c\u662f NULL \uff0c\u5982\u679c\u63d2\u5165\u8bb0\u5f55\u65f6\u4e0d\u7ed9\u5b57\u6bb5\u8d4b\u503c\uff0c\u6b64\u5b57\u6bb5\u4f7f\u7528\u9ed8\u8ba4\u503c sex enum ( 'male' , 'female' ) not null default 'male' age int unsigned NOT NULL default 20 \u5fc5\u987b\u4e3a\u6b63\u503c\uff08\u65e0\u7b26\u53f7\uff09 \u4e0d\u5141\u8bb8\u4e3a\u7a7a \u9ed8\u8ba4\u662f 20 3. \u662f\u5426\u662f key \u4e3b\u952e primary key \u5916\u952e foreign key \u7d22\u5f15 ( index , unique ... )","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.integrity_constraint/#2-not-nulldefault","text":"\u662f\u5426\u53ef\u7a7a\uff0cnull\u8868\u793a\u7a7a\uff0c\u975e\u5b57\u7b26\u4e32 not null - \u4e0d\u53ef\u7a7a null - \u53ef\u7a7a \u9ed8\u8ba4\u503c\uff0c\u521b\u5efa\u5217\u65f6\u53ef\u4ee5\u6307\u5b9a\u9ed8\u8ba4\u503c\uff0c\u5f53\u63d2\u5165\u6570\u636e\u65f6\u5982\u679c\u672a\u4e3b\u52a8\u8bbe\u7f6e\uff0c\u5219\u81ea\u52a8\u6dfb\u52a0\u9ed8\u8ba4\u503c create table t15( id int(11) unsigned zerofill ); mysql> create table t15( -> id int(11) unsigned zerofill -> ); Query OK, 0 rows affected (0.38 sec) mysql> desc t15; +-------+---------------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+---------------------------+------+-----+---------+-------+ | id | int(11) unsigned zerofill | YES | | NULL | | +-------+---------------------------+------+-----+---------+-------+ row in set (0.01 sec) int\u7ea6\u675f\u662f\u6574\u5f62\uff0c11\u8868\u793a\u5bbd\u5ea6\uff0cunsigned \u8868\u793a\u65e0\u7b26\u53f7\uff0czerofill\u8868\u793a\u4e0d\u591f\u75280\u586b\u5145\u3002 create table t16( id int(11), name char(6), sex enum('male','female') not null default 'male' ); mysql> create table t16( -> id int(11), -> name char(6), -> sex enum('male','female') not null default 'male' -> ); Query OK, 0 rows affected (0.42 sec) mysql> desc t16; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | char(6) | YES | | NULL | | | sex | enum('male','female') | NO | | male | | +-------+-----------------------+------+-----+---------+-------+ rows in set (0.00 sec) # enum\u8868\u793a\u679a\u4e3e\uff0cnot null \u8868\u793a\u4e0d\u4e3a\u7a7a\uff0cdefault 'male' \u8868\u793asex\u4e0d\u4f20\u5165\u7684\u8bdd\u9ed8\u8ba4\u503c\u662fmale \u4f8b\u5b50 mysql> insert into t16(id,name) values(1,'cmz'); # sex\u6ca1\u6709\u4f20\u5165\uff0c\u9ed8\u8ba4\u4e3amale Query OK, 1 row affected (0.36 sec) mysql> desc t16; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | char(6) | YES | | NULL | | | sex | enum('male','female') | NO | | male | | +-------+-----------------------+------+-----+---------+-------+ rows in set (0.00 sec) mysql> select * from t16; +------+------+------+ | id | name | sex | +------+------+------+ | 1 | cmz | male | +------+------+------+ row in set (0.00 sec) ==================not null==================== mysql> create table t1(id int); #id\u5b57\u6bb5\u9ed8\u8ba4\u53ef\u4ee5\u63d2\u5165\u7a7a mysql> desc t1; +-------+---------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+---------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | +-------+---------+------+-----+---------+-------+ mysql> insert into t1 values(); #\u53ef\u4ee5\u63d2\u5165\u7a7a mysql> create table t2(id int not null); #\u8bbe\u7f6e\u5b57\u6bb5id\u4e0d\u4e3a\u7a7a mysql> desc t2; +-------+---------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+---------+------+-----+---------+-------+ | id | int(11) | NO | | NULL | | +-------+---------+------+-----+---------+-------+ mysql> insert into t2 values(); #\u4e0d\u80fd\u63d2\u5165\u7a7a ERROR 1364 (HY000): Field 'id' doesn't have a default value ==================default==================== #\u8bbe\u7f6eid\u5b57\u6bb5\u6709\u9ed8\u8ba4\u503c\u540e\uff0c\u5219\u65e0\u8bbaid\u5b57\u6bb5\u662fnull\u8fd8\u662fnot null\uff0c\u90fd\u53ef\u4ee5\u63d2\u5165\u7a7a\uff0c\u63d2\u5165\u7a7a\u9ed8\u8ba4\u586b\u5165default\u6307\u5b9a\u7684\u9ed8\u8ba4\u503c mysql> create table t3(id int default 1); mysql> alter table t3 modify id int not null default 1; ==================\u7efc\u5408\u7ec3\u4e60==================== mysql> create table student( -> name varchar(20) not null, -> age int(3) unsigned not null default 18, -> sex enum('male','female') default 'male', -> hobby set('play','study','read','music') default 'play,music' -> ); mysql> desc student; +-------+------------------------------------+------+-----+------------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+------------------------------------+------+-----+------------+-------+ | name | varchar(20) | NO | | NULL | | | age | int(3) unsigned | NO | | 18 | | | sex | enum('male','female') | YES | | male | | | hobby | set('play','study','read','music') | YES | | play,music | | +-------+------------------------------------+------+-----+------------+-------+ mysql> insert into student(name) values('cmz'); mysql> select * from student; +------+-----+------+------------+ | name | age | sex | hobby | +------+-----+------+------------+ | cmz | 18 | male | play,music | +------+-----+------+------------+","title":"2. not null\u4e0edefault"},{"location":"mysql/mysql.integrity_constraint/#3-unique","text":"\u521b\u5efa\u552f\u4e00\u7d22\u5f15\u7684\u76ee\u7684\u4e0d\u662f\u4e3a\u4e86\u63d0\u9ad8\u8bbf\u95ee\u901f\u5ea6\uff0c\u800c\u53ea\u662f\u4e3a\u4e86\u907f\u514d\u6570\u636e\u51fa\u73b0\u91cd\u590d\u3002\u552f\u4e00\u7d22\u5f15\u53ef\u4ee5\u6709\u591a\u4e2a\u4f46\u7d22\u5f15\u5217\u7684\u503c\u5fc5\u987b\u552f\u4e00\uff0c\u7d22\u5f15\u5217\u7684\u503c\u5141\u8bb8\u6709\u7a7a\u503c\u3002\u5982\u679c\u80fd\u786e\u5b9a\u67d0\u4e2a\u6570\u636e\u5217\u5c06\u53ea\u5305\u542b\u5f7c\u6b64\u5404\u4e0d\u76f8\u540c\u7684\u503c\uff0c\u5728\u4e3a\u8fd9\u4e2a\u6570\u636e\u5217\u521b\u5efa\u7d22\u5f15\u7684\u65f6\u5019\u5c31\u5e94\u8be5\u4f7f\u7528\u5173\u952e\u5b57UNIQUE\u3002 #-------------------------------------------unique key # \u5355\u5217\u552f\u4e00 # \u65b9\u5f0f1 create table department( id int, name char(10) unique ); # \u65b9\u5f0f2 create table department( id int, name char(10), unique(name) ); insert into department values(1,'IT'),(2,'sales'); insert into department values(3,'IT'); # \u4f1a\u62a5\u9519 mysql> create table department( -> id int, -> name char(10) unique -> ); Query OK, 0 rows affected (0.04 sec) mysql> insert into department values(1,'IT'),(2,'sales'); Query OK, 2 rows affected (0.04 sec) Records: 2 Duplicates: 0 Warnings: 0 mysql> desc department; +-------+----------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+----------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | char(10) | YES | UNI | NULL | | +-------+----------+------+-----+---------+-------+ rows in set (0.00 sec) mysql> select * from department; +------+-------+ | id | name | +------+-------+ | 1 | IT | | 2 | sales | +------+-------+ rows in set (0.00 sec) mysql> insert into department values(3,'IT'); ERROR 1062 (23000): Duplicate entry 'IT' for key 'name' \u5176\u4ed6\u8981\u662f\u786e\u5b9a\u552f\u4e00\u6027\uff0c\u5c31\u6dfb\u52a0unique\u5373\u53ef\u3002 # \u8054\u5408\u552f\u4e00 create table services( id int, ip char(15), port int, unique(id), unique(ip,port) ); insert into services values (1,'192.168.1.100',80), (2,'192.168.1.100',8080), (3,'192.168.1.110',80); insert into services values (1,'192.168.1.100',80); #\u4f1a\u62a5\u9519 mysql> create table services( -> id int, -> ip char(15), -> port int, -> unique(id), -> unique(ip,port) -> ); Query OK, 0 rows affected (0.41 sec) mysql> desc services; +-------+----------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+----------+------+-----+---------+-------+ | id | int(11) | YES | UNI | NULL | | | ip | char(15) | YES | MUL | NULL | | | port | int(11) | YES | | NULL | | +-------+----------+------+-----+---------+-------+ rows in set (0.01 sec) mysql> insert into services values -> (1,'192.168.1.100',80), -> (2,'192.168.1.100',8080), -> (3,'192.168.1.110',80); Query OK, 3 rows affected (0.37 sec) Records: 3 Duplicates: 0 Warnings: 0 mysql> select * from services; +------+---------------+------+ | id | ip | port | +------+---------------+------+ | 1 | 192.168.1.100 | 80 | | 2 | 192.168.1.100 | 8080 | | 3 | 192.168.1.110 | 80 | +------+---------------+------+ rows in set (0.00 sec) mysql> insert into services values (1,'192.168.1.100',80); #\u4f1a\u62a5\u9519 ERROR 1062 (23000): Duplicate entry '1' for key 'id'","title":"3. unique"},{"location":"mysql/mysql.integrity_constraint/#4-primary-key","text":"primary key\u5b57\u6bb5\u7684\u503c\u4e0d\u4e3a\u7a7a\u4e14\u552f\u4e00\uff0c\u4e00\u4e2a\u8868\u4e2d\u53ef\u4ee5\uff1a 1. \u5355\u5217\u505a\u4e3b\u952e 2. \u591a\u5217\u505a\u4e3b\u952e\uff08\u590d\u5408\u4e3b\u952e\uff09 3. \u4e00\u4e2a\u8868\u5185\u53ea\u80fd\u6709\u4e00\u4e2a\u4e3b\u952eprimary key # primary key \u7ea6\u675f not null unique \u5b58\u50a8\u5f15\u64ce(innodb)\uff0c\u5bf9\u4e8einnodb\u5b58\u50a8\u5f15\u64ce\u6765\u8bf4\uff0c\u4e00\u4e2a\u8868\u5185\u5fc5\u987b\u6709\u4e00\u4e2a\u4e3b\u952e\u3002 # \u5355\u5217\u4e3b\u952e create table t17( id int primary key, name char(16) ); insert into t17 values (1,'cmz'), (2,'leco'), (3,'nanjing'); insert into t17 values (1,'nanjing'); # \u91cd\u590d\u4e86 mysql> create table t17( -> id int primary key, -> name char(16) -> ); Query OK, 0 rows affected (0.48 sec) mysql> desc t17; +-------+----------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+----------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | char(16) | YES | | NULL | | +-------+----------+------+-----+---------+-------+ rows in set (0.01 sec) mysql> insert into t17 values (1,'nanjing'); ERROR 1062 (23000): Duplicate entry '1' for key 'PRIMARY' # mysql\u5efa\u8868\u7684\u65f6\u5019\u8981\u662f\u6ca1\u6709\u6307\u5b9a\u4e3b\u952e\uff0cmysql\u4f1a\u641c\u6574\u4e2a\u8868\u627e\u4e00\u4e2a\u4e0d\u4e3a\u7a7a\uff0c\u4e14\u552f\u4e00\u7684\u4f5c\u4e3a\u4e3b\u952e \u8981\u662f\u627e\u4e0d\u5230\uff0c\u5c31\u4f1a\u9ed8\u8ba4\u4f7f\u7528\u9690\u85cf\u4e3b\u952e\u3002 create table t18( id int not null unique, name char(16) ); mysql> create table t18( -> id int not null unique, -> name char(16) -> ); Query OK, 0 rows affected (0.40 sec) mysql> desc t18; +-------+----------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+----------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | # \u53ef\u4ee5\u770b\u51fa\u4f5c\u4e3a\u4e86\u4e3b\u952e | name | char(16) | YES | | NULL | | +-------+----------+------+-----+---------+-------+ rows in set (0.00 sec) \u901a\u5e38\u4e00\u4e2a\u8868\u4e2d\u6709\u4e00\u4e2aid\u5b57\u6bb5\u4f5c\u4e3a\u4e3b\u952e\u3002 # \u7b26\u5408\u4e3b\u952e \u591a\u4e2a\u5b57\u6bb5\u8054\u5408\u5728\u4e00\u8d77\u4f5c\u4e3a\u4e3b\u952e create table t19( ip char(15), port int, primary key(ip,port) ); create table loocha( ip varchar(15), port char(5), service_name varchar(10) not null, primary key(ip,port) ); mysql> create table t19( -> ip char(15), -> port int, -> primary key(ip,port) -> ); Query OK, 0 rows affected (0.39 sec) mysql> desc t19; +-------+----------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+----------+------+-----+---------+-------+ | ip | char(15) | NO | PRI | NULL | | | port | int(11) | NO | PRI | NULL | | +-------+----------+------+-----+---------+-------+ rows in set (0.00 sec) mysql> create table loocha( -> ip varchar(15), -> port char(5), -> service_name varchar(10) not null, -> primary key(ip,port) -> ); Query OK, 0 rows affected (0.03 sec) mysql> desc loocha -> ; +--------------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +--------------+-------------+------+-----+---------+-------+ | ip | varchar(15) | NO | PRI | NULL | | | port | char(5) | NO | PRI | NULL | | | service_name | varchar(10) | NO | | NULL | | +--------------+-------------+------+-----+---------+-------+ rows in set (0.01 sec) insert into t19 values ('192.168.1.110',80); insert into t19 values ('192.168.1.110',80); # \u62a5\u9519 mysql> insert into t19 values ('192.168.1.110',80); Query OK, 1 row affected (0.01 sec) mysql> insert into t19 values ('192.168.1.110',80); ERROR 1062 (23000): Duplicate entry '192.168.1.110-80' for key 'PRIMARY' mysql> select * from t19; +---------------+------+ | ip | port | +---------------+------+ | 192.168.1.110 | 80 | +---------------+------+ row in set (0.00 sec) ============\u5355\u5217\u505a\u4e3b\u952e=============== #\u65b9\u6cd5\u4e00\uff1anot null+unique create table department1( id int not null unique, #\u4e3b\u952e name varchar(20) not null unique, comment varchar(100) ); mysql> desc department1; +---------+--------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +---------+--------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | varchar(20) | NO | UNI | NULL | | | comment | varchar(100) | YES | | NULL | | +---------+--------------+------+-----+---------+-------+ rows in set (0.01 sec) #\u65b9\u6cd5\u4e8c\uff1a\u5728\u67d0\u4e00\u4e2a\u5b57\u6bb5\u540e\u7528primary key create table department2( id int primary key, #\u4e3b\u952e name varchar(20), comment varchar(100) ); mysql> desc department2; +---------+--------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +---------+--------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | varchar(20) | YES | | NULL | | | comment | varchar(100) | YES | | NULL | | +---------+--------------+------+-----+---------+-------+ rows in set (0.00 sec) #\u65b9\u6cd5\u4e09\uff1a\u5728\u6240\u6709\u5b57\u6bb5\u540e\u5355\u72ec\u5b9a\u4e49primary key create table department3( id int, name varchar(20), comment varchar(100), constraint pk_name primary key(id); #\u521b\u5efa\u4e3b\u952e\u5e76\u4e3a\u5176\u547d\u540dpk_name mysql> desc department3; +---------+--------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +---------+--------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | varchar(20) | YES | | NULL | | | comment | varchar(100) | YES | | NULL | | +---------+--------------+------+-----+---------+-------+ rows in set (0.01 sec) \u5355\u5217\u4e3b\u952e ==================\u591a\u5217\u505a\u4e3b\u952e================ create table service( ip varchar(15), port char(5), service_name varchar(10) not null, primary key(ip,port) ); mysql> desc service; +--------------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +--------------+-------------+------+-----+---------+-------+ | ip | varchar(15) | NO | PRI | NULL | | | port | char(5) | NO | PRI | NULL | | | service_name | varchar(10) | NO | | NULL | | +--------------+-------------+------+-----+---------+-------+ rows in set (0.00 sec) mysql> insert into service values -> ('172.16.45.10','3306','mysqld'), -> ('172.16.45.11','3306','mariadb') -> ; Query OK, 2 rows affected (0.00 sec) Records: 2 Duplicates: 0 Warnings: 0 mysql> insert into service values ('172.16.45.10','3306','nginx'); ERROR 1062 (23000): Duplicate entry '172.16.45.10-3306' for key 'PRIMARY'","title":"4. primary key"},{"location":"mysql/mysql.integrity_constraint/#5-auto_increment","text":"\u6570\u636e\u5e93\u5e94\u7528\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u9700\u8981\u7528\u5230\u81ea\u52a8\u9012\u589e\u7684\u552f\u4e00\u7f16\u53f7\u6765\u6807\u8bc6\u8bb0\u5f55\u3002\u5728MySQL\u4e2d\uff0c\u53ef\u901a\u8fc7\u6570\u636e\u5217\u7684auto_increment\u5c5e\u6027\u6765\u81ea\u52a8\u751f\u6210\u3002\u53ef\u5728\u5efa\u8868\u65f6\u53ef\u7528\u201cauto_increment=n\u201d\u9009\u9879\u6765\u6307\u5b9a\u4e00\u4e2a\u81ea\u589e\u7684\u521d\u59cb\u503c\u3002\u53ef\u7528\u201calter table table_name auto_increment=n\u201d\u547d\u4ee4\u6765\u91cd\u8bbe\u81ea\u589e\u7684\u8d77\u59cb\u503c\uff0c\u5f53\u7136\u5728\u8bbe\u7f6e\u7684\u65f6\u5019Mysql\u4f1a\u53d6\u6570\u636e\u8868\u4e2dauto_increment\u5217\u7684\u6700\u5927\u503c + 1\u4e0en\u4e2d\u7684\u8f83\u5927\u8005\u4f5c\u4e3a\u65b0\u7684auto_increment\u503c\u3002 Myql\u7684auto_increment\u5c5e\u6027\u5177\u6709\u4ee5\u4e0b\u7279\u6027\uff1a \u5177\u6709auto_increment\u5c5e\u6027\u7684\u6570\u636e\u5217\u5e94\u8be5\u662f\u4e00\u4e2a\u6b63\u6570\u5e8f\u5217\uff0c\u5982\u679c\u628a\u8be5\u6570\u636e\u5217\u58f0\u660e\u4e3aUNSIGNED\uff0c\u8fd9\u6837\u5e8f\u5217\u7684\u7f16\u53f7\u4e2a\u6570\u53ef\u589e\u52a0\u4e00\u500d\u3002\u6bd4\u5982tinyint\u6570\u636e\u5217\u7684\u6700\u5927\u7f16\u53f7\u662f127\uff0c\u5982\u679c\u52a0\u4e0aUNSIGNED\uff0c\u90a3\u4e48\u6700\u5927\u7f16\u53f7\u53d8\u4e3a255 auto_increment\u6570\u636e\u5217\u5fc5\u987b\u6709\u552f\u4e00\u7d22\u5f15\uff0c\u4ee5\u907f\u514d\u5e8f\u53f7\u91cd\u590d\uff1b\u5fc5\u987b\u5177\u5907NOT NULL\u5c5e\u6027 # auto_increment # \u7ea6\u675f\u5b57\u6bb5\u4e3a\u81ea\u52a8\u589e\u957f\uff0c\u88ab\u7ea6\u675f\u7684\u5b57\u6bb5\u5fc5\u987b\u540c\u65f6\u88abkey\u7ea6\u675f # primary key or unique key #----------------------------------------------------------- # #\u4e0d\u6307\u5b9aid\uff0c\u5219\u81ea\u52a8\u589e\u957f create table t20( id int primary key auto_increment, name char(16) ); mysql> create table t20( -> id int primary key auto_increment, -> name char(16) -> ); Query OK, 0 rows affected (0.02 sec) mysql> desc t20; +-------+----------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +-------+----------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | char(16) | YES | | NULL | | +-------+----------+------+-----+---------+----------------+ rows in set (0.02 sec) insert into t20(name) values('cmz1'),('leco'),('loocha'); mysql> insert into t20(name) values('cmz1'),('leco'),('loocha'); Query OK, 3 rows affected (0.36 sec) Records: 3 Duplicates: 0 Warnings: 0 mysql> select * from t20; +----+--------+ | id | name | +----+--------+ | 1 | cmz1 | | 2 | leco | | 3 | loocha | +----+--------+ rows in set (0.00 sec) insert into t20(id,name) values(7,'keke'); # \u53ef\u4ee5\u624b\u52a8\u63d2\u5165primary key\u53ea\u8981\u4fdd\u8bc1\u4e3b\u952e\u552f\u4e00\u5373\u53ef\uff0c\u4ee5\u540e\u5728\u63d2\u5165\u5c31\u5728\u8be5\u57fa\u7840\u4e0a\u81ea\u589e\u52a0 mysql> insert into t20(id,name) values(7,'cmz1'); Query OK, 1 row affected (0.00 sec) mysql> select * from t20; +----+--------+ | id | name | +----+--------+ | 1 | cmz1 | | 2 | leco | | 3 | loocha | | 7 | cmz1 | +----+--------+ rows in set (0.01 sec) \u81ea\u589e\u957f\u6b65\u957f\u9ed8\u8ba4\u4e3a1 show variables like 'auto_inc%'; mysql> show variables like 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 1 | # \u6b65\u957f \u9ed8\u8ba4\u4e3a1 | auto_increment_offset | 1 | # \u8d77\u59cb\u504f\u79fb\u91cf \u9ed8\u8ba4\u4e3a1 +--------------------------+-------+ rows in set (0.08 sec) # \u8bbe\u7f6e\u6b65\u957f # session \u6709\u6548 set session auto_increment_increment=5; # \u5168\u5c40 set global auto_increment_increment=5; # \u8bbe\u7f6e\u8d77\u59cb\u504f\u79fb\u91cf set global auto_increment_offset=3; \u5f3a\u8c03\u8d77\u59cb\u504f\u79fb\u91cf<=\u6b65\u957f #\u4f8b\u5b50\u8bbe\u7f6e\u4e0d\u6b65\u957f\u548c\u8d77\u59cb\u504f\u79fb\u91cf mysql> set global auto_increment_offset=3; Query OK, 0 rows affected (0.00 sec) mysql> set global auto_increment_increment=5; Query OK, 0 rows affected (0.00 sec) \u91cd\u65b0\u767b\u5f55\u3002 mysql> show variables like 'auto_inc%'; +--------------------------+-------+ | Variable_name | Value | +--------------------------+-------+ | auto_increment_increment | 5 | | auto_increment_offset | 3 | +--------------------------+-------+ rows in set (0.01 sec) create table t21( id int primary key auto_increment, name char(16) ); mysql> create table t21( -> id int primary key auto_increment, -> name char(16) -> ); Query OK, 0 rows affected (0.40 sec) \u63d2\u5165\u6570\u636e insert into t21(name) values ('cmz'),('leco'),('loocha'); mysql> insert into t21(name) values -> ('cmz'),('leco'),('loocha'); Query OK, 3 rows affected (0.02 sec) Records: 3 Duplicates: 0 Warnings: 0 mysql> select * from t21; +----+--------+ | id | name | +----+--------+ | 3 | cmz | | 8 | leco | | 13 | loocha | +----+--------+ rows in set (0.00 sec) # \u6e05\u7a7a\u8868 delete from t20; mysql> delete from t20; Query OK, 4 rows affected (0.01 sec) mysql> select * from t20; Empty set (0.00 sec) mysql> show create table t20; +-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ | Table | Create Table | +-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ | t20 | CREATE TABLE `t20` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` char(16) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=latin1 | +-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ row in set (0.00 sec) # \u867d\u7136\u6e05\u7a7a\u4e86\u8868\uff0c\u4f46\u662f\u4e3b\u952e\u6ca1\u5220\u9664 mysql> insert into t20(name) values('cccc'); Query OK, 1 row affected (0.01 sec) mysql> select * from t20; +----+------+ | id | name | +----+------+ | 8 | cccc | +----+------+ row in set (0.00 sec) #truncate \u6e05\u7a7a\u8868\uff0c\u4e3b\u952e\u4e5f\u5220\u9664 mysql> truncate t20; Query OK, 0 rows affected (0.03 sec) mysql> show create table t20; +-------+----------------------------------------------------------------------------------------------------------------------------------------------------------+ | Table | Create Table | +-------+----------------------------------------------------------------------------------------------------------------------------------------------------------+ | t20 | CREATE TABLE `t20` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` char(16) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=latin1 | +-------+----------------------------------------------------------------------------------------------------------------------------------------------------------+ row in set (0.00 sec) mysql> insert into t20(name) values('cccc'); Query OK, 1 row affected (0.01 sec) mysql> select * from t20; +----+------+ | id | name | +----+------+ | 1 | cccc | +----+------+ row in set (0.00 sec)","title":"5. auto_increment"},{"location":"mysql/mysql.integrity_constraint/#6","text":"\u5458\u5de5\u4fe1\u606f\u8868\u6709\u4e09\u4e2a\u5b57\u6bb5\uff1a\u5de5\u53f7 \u59d3\u540d \u90e8\u95e8,\u516c\u53f8\u67093\u4e2a\u90e8\u95e8\uff0c\u4f46\u662f\u67091\u4e2a\u4ebf\u7684\u5458\u5de5\uff0c\u90a3\u610f\u5473\u7740\u90e8\u95e8\u8fd9\u4e2a\u5b57\u6bb5\u9700\u8981\u91cd\u590d\u5b58\u50a8\uff0c\u90e8\u95e8\u540d\u5b57\u8d8a\u957f\uff0c\u8d8a\u6d6a\u8d39 \u89e3\u51b3\u65b9\u6cd5\uff1a \u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u90e8\u95e8\u8868 \u7136\u540e\u8ba9\u5458\u5de5\u4fe1\u606f\u8868\u5173\u8054\u8be5\u8868\uff0c\u5982\u4f55\u5173\u8054\uff0c\u5373foreign key \u53d8\u4e3a\u4e24\u4e2a\u8868\uff0cemp\u548cdep\u8868\uff0c\u540c\u65f6\uff45\uff4d\uff50\u7684\u8868\u4e2ddep_id\u3000\u5173\u8054\u5230\uff44\uff45\uff50\u8868\u4e2d\u7684\u7684\uff49\uff44\u5b57\u6bb5\u3002 #1. \u5148\u5efa\u88ab\u5173\u8054\u7684\u8868\uff0c\u4e14\u4fdd\u8bc1\u88ab\u5173\u8054\u7684\u5b57\u6bb5\u552f\u4e00 #2. \u7136\u540e\u5728\u5efa\u7acb\u5173\u8054\u7684\u8868 create table dep( id int primary key, name char(10), comment char(50) ); create table emp( id int primary key, name char(10), sex enum('male','female'), dep_id int, foreign key(dep_id) references dep(id) on delete cascade on update cascade ); \u6ce8\u610f\uff1a \u3000foreign key(dep_id) references dep(id) \u3000on delete cascade \u3000on update cascade \u3000\u662f\u4e00\u53e5\u8bdd\uff0c\u4e5f\u5c31\u662f \u3000foreign key(dep_id) references dep(id)\u3000on delete cascade\u3000on update cascade \u3000\u5176\u4e2ddep\u8868\u64cd\u4f5c\u3002\u4fee\u6539\u6216\u8005\u5220\u9664\uff0c\uff45\uff4d\uff50\u8868\u5c31\u4f1a\u8ddf\u7740\u53d8\u52a8\uff0c\u8be6\u89c1\u4e0b\u9762\u6d4b\u8bd5\u3002 #3. \u63d2\u5165\u6570\u636e # \u5148\u63d2\u5165\u88ab\u5173\u8054\u8868\u7684\u6570\u636e insert into dep values (1,\"IT\",\"\u6280\u672f\u90e8\u95e8\"), (2,\"\u9500\u552e\",\"\u9500\u552e\u90e8\u95e8\"), (3,\"\u8d22\u52a1\",\"\u8d22\u52a1\u90e8\u95e8\"); insert into emp values(1,'cmz','male',1); insert into emp values(2,'keke','male',2); insert into emp values(3,'leco','female',3); # \u64cd\u4f5c\u8fc7\u7a0b mysql> create table dep( -> id int primary key, -> name char(10), -> comment char(50) -> ); Query OK, 0 rows affected (0.02 sec) mysql> create table emp( -> id int primary key, -> name char(10), -> sex enum('male','female'), -> dep_id int, -> foreign key(dep_id) references dep(id) -> on delete cascade -> on update cascade -> ); Query OK, 0 rows affected (0.04 sec) mysql> desc emp; +--------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +--------+-----------------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | char(10) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | dep_id | int(11) | YES | MUL | NULL | | +--------+-----------------------+------+-----+---------+-------+ rows in set (0.00 sec) mysql> desc dep; +---------+----------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +---------+----------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | char(10) | YES | | NULL | | | comment | char(50) | YES | | NULL | | +---------+----------+------+-----+---------+-------+ rows in set (0.01 sec) \u63d2\u5165\u6570\u636e mysql> insert into dep values -> (1,\"IT\",\"\u6280\u672f\u90e8\u95e8\"), -> (2,\"\u9500\u552e\",\"\u9500\u552e\u90e8\u95e8\"), -> (3,\"\u8d22\u52a1\",\"\u8d22\u52a1\u90e8\u95e8\"); Query OK, 3 rows affected (0.00 sec) Records: 3 Duplicates: 0 Warnings: 0 mysql> select * from dep; +----+--------+--------------+ | id | name | comment | +----+--------+--------------+ | 1 | IT | \u6280\u672f\u90e8\u95e8 | | 2 | \u9500\u552e | \u9500\u552e\u90e8\u95e8 | | 3 | \u8d22\u52a1 | \u8d22\u52a1\u90e8\u95e8 | +----+--------+--------------+ rows in set (0.00 sec) mysql> insert into emp values(1,'cmz','male',1); Query OK, 1 row affected (0.01 sec) mysql> insert into emp values(2,'keke','male',2); Query OK, 1 row affected (0.01 sec) mysql> insert into emp values(3,'leco','female',3); Query OK, 1 row affected (0.01 sec) mysql> select * from emp; +----+------+--------+--------+ | id | name | sex | dep_id | +----+------+--------+--------+ | 1 | cmz | male | 1 | | 2 | keke | male | 2 | | 3 | leco | female | 3 | +----+------+--------+--------+ rows in set (0.00 sec) \u522a\u9664 \u522a\u9664\u4e86\u90e8\u9580\uff0c\u8ddf\u4ed6\u5173\u8054\u7684\u90e8\u95e8\u4eba\u5458\u90fd\u4f1a\u88ab\u5220\u9664\u3002 mysql> delete from dep where id=1; Query OK, 1 row affected (0.01 sec) mysql> select * from dep; +----+--------+--------------+ | id | name | comment | +----+--------+--------------+ | 2 | \u9500\u552e | \u9500\u552e\u90e8\u95e8 | | 3 | \u8d22\u52a1 | \u8d22\u52a1\u90e8\u95e8 | +----+--------+--------------+ rows in set (0.00 sec) mysql> select * from emp; +----+------+--------+--------+ | id | name | sex | dep_id | +----+------+--------+--------+ | 2 | keke | male | 2 | | 3 | leco | female | 3 | +----+------+--------+--------+ rows in set (0.00 sec) #\u66f4\u65b0 #\u66f4\u65b0\u4e86\u90e8\u9580\uff0c\u8ddf\u4ed6\u5173\u8054\u7684\u90e8\u95e8\u4eba\u5458\u90fd\u4f1a\u88ab\u66f4\u65b0\u3002 mysql> update dep set id=10 where id=2; Query OK, 1 row affected (0.01 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> select * from dep; +----+--------+--------------+ | id | name | comment | +----+--------+--------------+ | 3 | \u8d22\u52a1 | \u8d22\u52a1\u90e8\u95e8 | | 10 | \u9500\u552e | \u9500\u552e\u90e8\u95e8 | +----+--------+--------------+ rows in set (0.00 sec) mysql> select * from emp; +----+------+--------+--------+ | id | name | sex | dep_id | +----+------+--------+--------+ | 2 | keke | male | 10 | | 3 | leco | female | 3 | +----+------+--------+--------+ rows in set (0.00 sec)","title":"6. \u6848\u4f8b"},{"location":"mysql/mysql.like/","text":"MySQL LIKE 1. \u4ecb\u7ecd \u00b6 1.1 \u73af\u5883\u51c6\u5907 \u00b6 mysql> truncate leco; values(8,\"\u5f20\u4e094\",\"female\",18);Query OK, 0 rows affected (0.04 sec) mysql> mysql> insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); Query OK, 1 row affected (0.02 sec) mysql> insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); Query OK, 1 row affected (0.01 sec) mysql> mysql> insert into leco(id,name,sex,age) values(5,\"\u5f20\u4e091\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(6,\"\u5f20\u4e092\",\"female\",18); Query OK, 1 row affected (0.00 sec) mysql> insert into leco(id,name,sex,age) values(7,\"\u5f20\u4e093\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(8,\"\u5f20\u4e094\",\"female\",18); Query OK, 1 row affected (0.00 sec) mysql> select * from leco; +------+---------+--------+------+ | id | name | sex | age | +------+---------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | | 5 | \u5f20\u4e091 | female | 18 | | 6 | \u5f20\u4e092 | female | 18 | | 7 | \u5f20\u4e093 | female | 18 | | 8 | \u5f20\u4e094 | female | 18 | +------+---------+--------+------+ 8 rows in set (0.00 sec) 1.2 \u5f00\u59cb \u00b6 \u6211\u4eec\u77e5\u9053\u5728 MySQL \u4e2d\u4f7f\u7528 SQL SELECT \u547d\u4ee4\u6765\u8bfb\u53d6\u6570\u636e\uff0c \u540c\u65f6\u6211\u4eec\u53ef\u4ee5\u5728 SELECT \u8bed\u53e5\u4e2d\u4f7f\u7528 WHERE \u5b50\u53e5\u6765\u83b7\u53d6\u6307\u5b9a\u7684\u8bb0\u5f55\u3002WHERE \u5b50\u53e5\u4e2d\u53ef\u4ee5\u4f7f\u7528\u7b49\u53f7 = \u6765\u8bbe\u5b9a\u83b7\u53d6\u6570\u636e\u7684\u6761\u4ef6\uff0c\u5982 \"name = '\u5f20\u4e09'\"\u3002\u4f46\u662f\u6709\u65f6\u5019\u6211\u4eec\u9700\u8981\u83b7\u53d6 leco \u5b57\u6bb5\u542b\u6709 \"\u5f20\u4e09\" \u5b57\u7b26\u7684\u6240\u6709\u8bb0\u5f55\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u9700\u8981\u5728 WHERE \u5b50\u53e5\u4e2d\u4f7f\u7528 SQL LIKE \u5b50\u53e5\u3002SQL LIKE \u5b50\u53e5\u4e2d\u4f7f\u7528\u767e\u5206\u53f7 %\u5b57\u7b26\u6765\u8868\u793a\u4efb\u610f\u5b57\u7b26\uff0c\u7c7b\u4f3c\u4e8eUNIX\u6216\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u7684\u661f\u53f7 *\u3002\u5982\u679c\u6ca1\u6709\u4f7f\u7528\u767e\u5206\u53f7 %, LIKE \u5b50\u53e5\u4e0e\u7b49\u53f7 = \u7684\u6548\u679c\u662f\u4e00\u6837\u7684\u3002 \u4ee5\u4e0b\u662f SQL SELECT \u8bed\u53e5\u4f7f\u7528 LIKE \u5b50\u53e5\u4ece\u6570\u636e\u8868\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\u901a\u7528\u8bed\u6cd5\uff1a SELECT field1, field2,...fieldN FROM table_name WHERE field1 LIKE condition1 [AND [OR]] filed2 = 'somevalue' \u4f60\u53ef\u4ee5\u5728 WHERE \u5b50\u53e5\u4e2d\u6307\u5b9a\u4efb\u4f55\u6761\u4ef6\u3002 \u4f60\u53ef\u4ee5\u5728 WHERE \u5b50\u53e5\u4e2d\u4f7f\u7528LIKE\u5b50\u53e5\u3002 \u4f60\u53ef\u4ee5\u4f7f\u7528LIKE\u5b50\u53e5\u4ee3\u66ff\u7b49\u53f7 =\u3002 LIKE \u901a\u5e38\u4e0e % \u4e00\u540c\u4f7f\u7528\uff0c\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u5143\u5b57\u7b26\u7684\u641c\u7d22\u3002 \u4f60\u53ef\u4ee5\u4f7f\u7528 AND \u6216\u8005 OR \u6307\u5b9a\u4e00\u4e2a\u6216\u591a\u4e2a\u6761\u4ef6\u3002 \u4f60\u53ef\u4ee5\u5728 DELETE \u6216 UPDATE \u547d\u4ee4\u4e2d\u4f7f\u7528 WHERE...LIKE \u5b50\u53e5\u6765\u6307\u5b9a\u6761\u4ef6\u3002 \u5f53\u4f60\u60f3\u5220\u9664\u6570\u636e\u8868\u4e2d\u6307\u5b9a\u7684\u8bb0\u5f55\u65f6 WHERE \u5b50\u53e5\u662f\u975e\u5e38\u6709\u7528\u7684\u3002 2. like \u7528\u6cd5 \u00b6 \u4ee5\u4e0b\u6211\u4eec\u5c06\u5728 SQL SELECT \u547d\u4ee4\u4e2d\u4f7f\u7528 WHERE...LIKE \u5b50\u53e5\u6765\u4eceMySQL\u6570\u636e\u8868 leco \u4e2d\u8bfb\u53d6\u6570\u636e\u3002 mysql> select * from leco; +------+---------+--------+------+ | id | name | sex | age | +------+---------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | | 5 | \u5f20\u4e091 | female | 18 | | 6 | \u5f20\u4e092 | female | 18 | | 7 | \u5f20\u4e093 | female | 18 | | 8 | \u5f20\u4e094 | female | 18 | +------+---------+--------+------+ 8 rows in set (0.00 sec) mysql> select * from leco where name like '%\u5f20\u4e09'; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | +------+--------+--------+------+ 1 row in set (0.00 sec) mysql> select * from leco where name like '\u5f20\u4e09%'; +------+---------+--------+------+ | id | name | sex | age | +------+---------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 5 | \u5f20\u4e091 | female | 18 | | 6 | \u5f20\u4e092 | female | 18 | | 7 | \u5f20\u4e093 | female | 18 | | 8 | \u5f20\u4e094 | female | 18 | +------+---------+--------+------+ 5 rows in set (0.01 sec) 3. \u5339\u914d \u00b6 3.1 \u5339\u914d\u4f4d \u00b6 like \u5339\u914d/\u6a21\u7cca\u5339\u914d\uff0c\u4f1a\u4e0e % \u548c _ \u7ed3\u5408\u4f7f\u7528\u3002 \uff05 - \u767e\u5206\u53f7\u8868\u793a\u96f6\u4e2a\uff0c\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u7b26 _ - \u4e0b\u5212\u7ebf\u8868\u793a\u5355\u4e2a\u5b57\u7b26 \u8fd0\u7b97\u7b26 \u63cf\u8ff0 '%a' \u4ee5a\u7ed3\u5c3e\u7684\u6570\u636e 'a%' \u4ee5a\u5f00\u5934\u7684\u6570\u636e '%a%' \u542b\u6709a\u7684\u6570\u636e ' a ' \u4e09\u4f4d\u4e14\u4e2d\u95f4\u5b57\u6bcd\u662fa\u7684 '_a' \u4e24\u4f4d\u4e14\u7ed3\u5c3e\u5b57\u6bcd\u662fa\u7684 'a_' \u4e24\u4f4d\u4e14\u5f00\u5934\u5b57\u6bcd\u662fa\u7684 3.2 \u4f8b\u5b50 \u00b6 \u67e5\u8be2\u4ee5 \u5f20\u4e09 \u5b57\u6bb5\u5f00\u5934\u7684\u4fe1\u606f\u3002 SELECT * FROM leco WHERE name LIKE '\u5f20\u4e09%'; \u67e5\u8be2\u5305\u542b \u5f20\u4e09 \u5b57\u6bb5\u7684\u4fe1\u606f\u3002 SELECT * FROM leco WHERE name LIKE '%\u5f20\u4e09%'; \u67e5\u8be2\u4ee5 \u5f20\u4e09 \u5b57\u6bb5\u7ed3\u5c3e\u7684\u4fe1\u606f\u3002 SELECT * FROM leco WHERE name LIKE '%\u5f20\u4e09';","title":"10. SQL LIKE"},{"location":"mysql/mysql.like/#1","text":"","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.like/#11","text":"mysql> truncate leco; values(8,\"\u5f20\u4e094\",\"female\",18);Query OK, 0 rows affected (0.04 sec) mysql> mysql> insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); Query OK, 1 row affected (0.02 sec) mysql> insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); Query OK, 1 row affected (0.01 sec) mysql> mysql> insert into leco(id,name,sex,age) values(5,\"\u5f20\u4e091\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(6,\"\u5f20\u4e092\",\"female\",18); Query OK, 1 row affected (0.00 sec) mysql> insert into leco(id,name,sex,age) values(7,\"\u5f20\u4e093\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(8,\"\u5f20\u4e094\",\"female\",18); Query OK, 1 row affected (0.00 sec) mysql> select * from leco; +------+---------+--------+------+ | id | name | sex | age | +------+---------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | | 5 | \u5f20\u4e091 | female | 18 | | 6 | \u5f20\u4e092 | female | 18 | | 7 | \u5f20\u4e093 | female | 18 | | 8 | \u5f20\u4e094 | female | 18 | +------+---------+--------+------+ 8 rows in set (0.00 sec)","title":"1.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.like/#12","text":"\u6211\u4eec\u77e5\u9053\u5728 MySQL \u4e2d\u4f7f\u7528 SQL SELECT \u547d\u4ee4\u6765\u8bfb\u53d6\u6570\u636e\uff0c \u540c\u65f6\u6211\u4eec\u53ef\u4ee5\u5728 SELECT \u8bed\u53e5\u4e2d\u4f7f\u7528 WHERE \u5b50\u53e5\u6765\u83b7\u53d6\u6307\u5b9a\u7684\u8bb0\u5f55\u3002WHERE \u5b50\u53e5\u4e2d\u53ef\u4ee5\u4f7f\u7528\u7b49\u53f7 = \u6765\u8bbe\u5b9a\u83b7\u53d6\u6570\u636e\u7684\u6761\u4ef6\uff0c\u5982 \"name = '\u5f20\u4e09'\"\u3002\u4f46\u662f\u6709\u65f6\u5019\u6211\u4eec\u9700\u8981\u83b7\u53d6 leco \u5b57\u6bb5\u542b\u6709 \"\u5f20\u4e09\" \u5b57\u7b26\u7684\u6240\u6709\u8bb0\u5f55\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u9700\u8981\u5728 WHERE \u5b50\u53e5\u4e2d\u4f7f\u7528 SQL LIKE \u5b50\u53e5\u3002SQL LIKE \u5b50\u53e5\u4e2d\u4f7f\u7528\u767e\u5206\u53f7 %\u5b57\u7b26\u6765\u8868\u793a\u4efb\u610f\u5b57\u7b26\uff0c\u7c7b\u4f3c\u4e8eUNIX\u6216\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u7684\u661f\u53f7 *\u3002\u5982\u679c\u6ca1\u6709\u4f7f\u7528\u767e\u5206\u53f7 %, LIKE \u5b50\u53e5\u4e0e\u7b49\u53f7 = \u7684\u6548\u679c\u662f\u4e00\u6837\u7684\u3002 \u4ee5\u4e0b\u662f SQL SELECT \u8bed\u53e5\u4f7f\u7528 LIKE \u5b50\u53e5\u4ece\u6570\u636e\u8868\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\u901a\u7528\u8bed\u6cd5\uff1a SELECT field1, field2,...fieldN FROM table_name WHERE field1 LIKE condition1 [AND [OR]] filed2 = 'somevalue' \u4f60\u53ef\u4ee5\u5728 WHERE \u5b50\u53e5\u4e2d\u6307\u5b9a\u4efb\u4f55\u6761\u4ef6\u3002 \u4f60\u53ef\u4ee5\u5728 WHERE \u5b50\u53e5\u4e2d\u4f7f\u7528LIKE\u5b50\u53e5\u3002 \u4f60\u53ef\u4ee5\u4f7f\u7528LIKE\u5b50\u53e5\u4ee3\u66ff\u7b49\u53f7 =\u3002 LIKE \u901a\u5e38\u4e0e % \u4e00\u540c\u4f7f\u7528\uff0c\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u5143\u5b57\u7b26\u7684\u641c\u7d22\u3002 \u4f60\u53ef\u4ee5\u4f7f\u7528 AND \u6216\u8005 OR \u6307\u5b9a\u4e00\u4e2a\u6216\u591a\u4e2a\u6761\u4ef6\u3002 \u4f60\u53ef\u4ee5\u5728 DELETE \u6216 UPDATE \u547d\u4ee4\u4e2d\u4f7f\u7528 WHERE...LIKE \u5b50\u53e5\u6765\u6307\u5b9a\u6761\u4ef6\u3002 \u5f53\u4f60\u60f3\u5220\u9664\u6570\u636e\u8868\u4e2d\u6307\u5b9a\u7684\u8bb0\u5f55\u65f6 WHERE \u5b50\u53e5\u662f\u975e\u5e38\u6709\u7528\u7684\u3002","title":"1.2 \u5f00\u59cb"},{"location":"mysql/mysql.like/#2-like","text":"\u4ee5\u4e0b\u6211\u4eec\u5c06\u5728 SQL SELECT \u547d\u4ee4\u4e2d\u4f7f\u7528 WHERE...LIKE \u5b50\u53e5\u6765\u4eceMySQL\u6570\u636e\u8868 leco \u4e2d\u8bfb\u53d6\u6570\u636e\u3002 mysql> select * from leco; +------+---------+--------+------+ | id | name | sex | age | +------+---------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | | 5 | \u5f20\u4e091 | female | 18 | | 6 | \u5f20\u4e092 | female | 18 | | 7 | \u5f20\u4e093 | female | 18 | | 8 | \u5f20\u4e094 | female | 18 | +------+---------+--------+------+ 8 rows in set (0.00 sec) mysql> select * from leco where name like '%\u5f20\u4e09'; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | +------+--------+--------+------+ 1 row in set (0.00 sec) mysql> select * from leco where name like '\u5f20\u4e09%'; +------+---------+--------+------+ | id | name | sex | age | +------+---------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 5 | \u5f20\u4e091 | female | 18 | | 6 | \u5f20\u4e092 | female | 18 | | 7 | \u5f20\u4e093 | female | 18 | | 8 | \u5f20\u4e094 | female | 18 | +------+---------+--------+------+ 5 rows in set (0.01 sec)","title":"2. like \u7528\u6cd5"},{"location":"mysql/mysql.like/#3","text":"","title":"3. \u5339\u914d"},{"location":"mysql/mysql.like/#31","text":"like \u5339\u914d/\u6a21\u7cca\u5339\u914d\uff0c\u4f1a\u4e0e % \u548c _ \u7ed3\u5408\u4f7f\u7528\u3002 \uff05 - \u767e\u5206\u53f7\u8868\u793a\u96f6\u4e2a\uff0c\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u7b26 _ - \u4e0b\u5212\u7ebf\u8868\u793a\u5355\u4e2a\u5b57\u7b26 \u8fd0\u7b97\u7b26 \u63cf\u8ff0 '%a' \u4ee5a\u7ed3\u5c3e\u7684\u6570\u636e 'a%' \u4ee5a\u5f00\u5934\u7684\u6570\u636e '%a%' \u542b\u6709a\u7684\u6570\u636e ' a ' \u4e09\u4f4d\u4e14\u4e2d\u95f4\u5b57\u6bcd\u662fa\u7684 '_a' \u4e24\u4f4d\u4e14\u7ed3\u5c3e\u5b57\u6bcd\u662fa\u7684 'a_' \u4e24\u4f4d\u4e14\u5f00\u5934\u5b57\u6bcd\u662fa\u7684","title":"3.1 \u5339\u914d\u4f4d"},{"location":"mysql/mysql.like/#32","text":"\u67e5\u8be2\u4ee5 \u5f20\u4e09 \u5b57\u6bb5\u5f00\u5934\u7684\u4fe1\u606f\u3002 SELECT * FROM leco WHERE name LIKE '\u5f20\u4e09%'; \u67e5\u8be2\u5305\u542b \u5f20\u4e09 \u5b57\u6bb5\u7684\u4fe1\u606f\u3002 SELECT * FROM leco WHERE name LIKE '%\u5f20\u4e09%'; \u67e5\u8be2\u4ee5 \u5f20\u4e09 \u5b57\u6bb5\u7ed3\u5c3e\u7684\u4fe1\u606f\u3002 SELECT * FROM leco WHERE name LIKE '%\u5f20\u4e09';","title":"3.2 \u4f8b\u5b50"},{"location":"mysql/mysql.limit/","text":"MySQL LIMIT 1. \u4ecb\u7ecd \u00b6 1.1 \u73af\u5883\u51c6\u5907 \u00b6 truncate leco; insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); \u64cd\u4f5c\u8fc7\u7a0b mysql> truncate leco; values(8,\"\u5f20\u4e094\",\"female\",18);Query OK, 0 rows affected (0.04 sec) mysql> mysql> insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); Query OK, 1 row affected (0.02 sec) mysql> insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); Query OK, 1 row affected (0.01 sec) mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec) 1.2 \u5f00\u59cb \u00b6 LIMIT \u5b50\u53e5\u7528\u4e8e\u89c4\u5b9a\u8981\u8fd4\u56de\u7684\u8bb0\u5f55\u7684\u6570\u76ee\u3002 MySQL \u548c Oracle \u4e2d\u7684 SQL SELECT TOP \u662f\u7b49\u4ef7\u7684 SELECT column_name(s) FROM table_name LIMIT number 2. Limit \u7528\u6cd5 \u00b6 \u4ee5\u4e0b\u6211\u4eec\u5c06\u5728 SQL LIMIT \u547d\u4ee4\u4e2d\u4f7f\u7528 \u4eceMySQL\u6570\u636e\u8868 leco \u4e2d\u8bfb\u53d6\u6570\u636e\u3002 mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec) mysql> select * from leco limit 2; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | +------+--------+--------+------+ 2 rows in set (0.00 sec)","title":"12. SQL LIMIT"},{"location":"mysql/mysql.limit/#1","text":"","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.limit/#11","text":"truncate leco; insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); \u64cd\u4f5c\u8fc7\u7a0b mysql> truncate leco; values(8,\"\u5f20\u4e094\",\"female\",18);Query OK, 0 rows affected (0.04 sec) mysql> mysql> insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); Query OK, 1 row affected (0.02 sec) mysql> insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); Query OK, 1 row affected (0.01 sec) mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec)","title":"1.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.limit/#12","text":"LIMIT \u5b50\u53e5\u7528\u4e8e\u89c4\u5b9a\u8981\u8fd4\u56de\u7684\u8bb0\u5f55\u7684\u6570\u76ee\u3002 MySQL \u548c Oracle \u4e2d\u7684 SQL SELECT TOP \u662f\u7b49\u4ef7\u7684 SELECT column_name(s) FROM table_name LIMIT number","title":"1.2 \u5f00\u59cb"},{"location":"mysql/mysql.limit/#2-limit","text":"\u4ee5\u4e0b\u6211\u4eec\u5c06\u5728 SQL LIMIT \u547d\u4ee4\u4e2d\u4f7f\u7528 \u4eceMySQL\u6570\u636e\u8868 leco \u4e2d\u8bfb\u53d6\u6570\u636e\u3002 mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec) mysql> select * from leco limit 2; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | +------+--------+--------+------+ 2 rows in set (0.00 sec)","title":"2. Limit \u7528\u6cd5"},{"location":"mysql/mysql.master-master/","text":"MySQL \u4e3b\u4e3b 1. \u4ecb\u7ecd \u00b6 \u5728\u4f01\u4e1a\u4e2d\uff0c\u6570\u636e\u5e93\u9ad8\u53ef\u7528\u4e00\u76f4\u662f\u4f01\u4e1a\u7684\u91cd\u4e2d\u4e4b\u91cd\uff0c\u4e2d\u5c0f\u4f01\u4e1a\u5f88\u591a\u90fd\u662f\u4f7f\u7528mysql\u4e3b\u4ece\u65b9\u6848\uff0c\u4e00\u4e3b\u591a\u4ece\uff0c\u8bfb\u5199\u5206\u79bb\u7b49\uff0c\u4f46\u662f\u5355\u4e3b\u5b58\u5728\u5355\u70b9\u6545\u969c\uff0c\u4ece\u5e93\u5207\u6362\u6210\u4e3b\u5e93\u9700\u8981\u4f5c\u6539\u52a8\u3002\u56e0\u6b64\uff0c\u5982\u679c\u662f\u53cc\u4e3b\u6216\u8005\u591a\u4e3b\uff0c\u5c31\u4f1a\u589e\u52a0mysql\u5165\u53e3\uff0c\u589e\u52a0\u9ad8\u53ef\u7528\u3002\u4e0d\u8fc7\u591a\u4e3b\u9700\u8981\u8003\u8651\u81ea\u589e\u957fID\u95ee\u9898\uff0c\u8fd9\u4e2a\u9700\u8981\u7279\u522b\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6\uff0c\u6bd4\u5982\u53cc\u4e3b\uff0c\u53ef\u4ee5\u4f7f\u7528\u5947\u5076\uff0c\u603b\u4e4b\uff0c\u4e3b\u4e4b\u95f4\u8bbe\u7f6e\u81ea\u589e\u957fID\u76f8\u4e92\u4e0d\u51b2\u7a81\u5c31\u80fd\u5b8c\u7f8e\u89e3\u51b3\u81ea\u589e\u957fID\u51b2\u7a81\u95ee\u9898\u3002 2. MySQL\u4e3b\u4e3b \u00b6 MySQL\u7684\u4e3b\u4e3b\uff0c\u5176\u5b9e\u8bf4\u767d\u4e86\u5c31\u662f\u76f8\u4e92\u4e3b\u4ece\u3002\u4e0a\u4e00\u8282\u642d\u5efa\u597d\u4e86\u4e3b\u4ece\u3002\u5728\u539f\u6765\u7684\u57fa\u7840\u4e0a\u518d\u53cd\u8fc7\u6765\u642d\u5efa\u4e3b\u4ece\u3002 3. MySQL\u4e3b\u4e3b\u590d\u5236\u7684\u539f\u7406 \u00b6 \u76f8\u4e92\u4e3b\u4ece\u3002 4. \u73af\u5883\u51c6\u5907 \u00b6 4.1 \u73af\u5883 \u00b6 IP\u5730\u5740 \u89d2\u8272 mysql\u7248\u672c\u53f7 \u7cfb\u7edf \u4e3b\u673a\u540d\u5b57 192.168.5.110 mysql slave 5.7 ubuntu16 leco 192.168.2.148 mysql master 5.7 ubuntu16 manage01 \u8fd9\u6837\u5c31\u53cd\u8fc7\u6765\u4e86\uff0c\u7b49\u90e8\u7f72\u597d\u4e86\uff0c\u76f8\u4e92\u4e3b\u4ece\uff0c\u5c31\u662f\u4e3b\u4e3b\u3002 4.2 \u914d\u7f6e\u51c6\u5907 \u00b6 4.2.1 master\u51c6\u5907 \u00b6 \u5f00\u542f\u4e8c\u8fdb\u5236\u65e5\u5fd7 \u914d\u7f6e\u552f\u4e00\u7684server-id \u83b7\u5f97master\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u540d\u53ca\u4f4d\u7f6e \u521b\u5efa\u4e00\u4e2a\u7528\u4e8eslave\u548cmaster\u901a\u4fe1\u7684\u7528\u6237\u8d26\u53f7 4.2.2 slave\u51c6\u5907 \u00b6 \u914d\u7f6e\u552f\u4e00\u7684server-id \u4f7f\u7528master\u5206\u914d\u7684\u7528\u6237\u8d26\u53f7\u8bfb\u53d6master\u4e8c\u8fdb\u5236\u65e5\u5fd7 \u542f\u7528slave\u670d\u52a1 5. master \u64cd\u4f5c \u00b6 5.1 \u4fee\u6539master\u914d\u7f6e\u6587\u4ef6 \u00b6 \u627e\u5230\u4e3b\u6570\u636e\u5e93\u7684\u914d\u7f6e\u6587\u4ef6my.cnf(\u6216\u8005my.ini)\uff0c\u6211\u7684\u5728/etc/mysql/my.cnf,\u5728[mysqld]\u90e8\u5206\u63d2\u5165\u5982\u4e0b\u4e24\u884c\uff1a root@manage01:~# egrep -irn 'log_bin|server-id' /etc/mysql/mysql.conf.d/mysqld.cnf 84:server-id = 2 85:log_bin = /var/log/mysql/mysql-bin.log \u914d\u7f6e\u5b8c\u6bd5\u540e\uff0c\u91cd\u542fmysql root@manage01:~# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service. 5.2 \u6388\u6743\u540c\u6b65\u8d26\u53f7 \u00b6 \u521b\u5efa\u7528\u6237\u5e76\u6388\u6743\uff1a\u7528\u6237\uff1arepl\uff0c\u5bc6\u7801\uff1arepl grant all privileges on *.* to repl@'%' identified by 'repl'; \u64cd\u4f5c\u8fc7\u7a0b mysql> select host,user from mysql.user; +-------------+------------------+ | host | user | +-------------+------------------+ | % | loocha | | 192.168.5.% | loocha | | localhost | airflow | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | | localhost | seafile | +-------------+------------------+ 8 rows in set (0,00 sec) mysql> grant replication slave on *.* to 'repl'@'%' identified by 'repl'; Query OK, 0 rows affected, 1 warning (0.01 sec) mysql> flush privileges; Query OK, 0 rows affected (0.01 sec) mysql> select host,user from mysql.user; +-------------+------------------+ | host | user | +-------------+------------------+ | % | loocha | | % | repl | | 192.168.5.% | loocha | | localhost | airflow | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | | localhost | seafile | +-------------+------------------+ 9 rows in set (0,00 sec) 5.3 \u8bb0\u5f55\u72b6\u6001 \u00b6 # \u67e5\u770bmaster\u72b6\u6001\uff0c\u8bb0\u5f55\u4e8c\u8fdb\u5236\u6587\u4ef6\u540d(mysql-bin.000003)\u548c\u4f4d\u7f6e(73)\uff1a mysql> show master status; +------------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +------------------+----------+--------------+------------------+-------------------+ | mysql-bin.000001 | 434 | | | | +------------------+----------+--------------+------------------+-------------------+ 1 row in set (0,00 sec) \u6ce8\u610f \u6ce8\u610f\u8fd9\u4e2a\u6587\u4ef6 mysql - bin . 000001 \u548c\u70b9 434 6. slave \u64cd\u4f5c \u00b6 6.1 \u4fee\u6539master\u914d\u7f6e\u6587\u4ef6 \u00b6 \u627e\u5230\u4e3b\u6570\u636e\u5e93\u7684\u914d\u7f6e\u6587\u4ef6my.cnf(\u6216\u8005my.ini)\uff0c\u4fee\u6539server-id\u3002 \u4e5f\u5c31\u662f\u4e4b\u524d\u7684\u4e3b\uff0c\u5df2\u7ecf\u914d\u7f6e\u4e3aserver-id=1 6.2 \u94fe\u63a5 \u00b6 6.2.1 \u5feb\u901f\u547d\u4ee4 \u00b6 \u767b\u5f55\u5230\u4ece\u4e0a\u64cd\u4f5c(master mysql\u7684leco\u4e3b\u673a\u4e0a\u64cd\u4f5c) stop slave; grant all privileges on *.* to repl@'%' identified by 'repl'; change master to master_host='192.168.5.110',\\ master_port=3306,\\ master_user='repl',\\ master_password='repl',\\ master_log_file='mysql-bin.000001',\\ master_log_pos=1571; start slave; show slave status\\G; \u64cd\u4f5c\u8fc7\u7a0b mysql> stop slave; Query OK, 0 rows affected, 1 warning (0.00 sec) mysql> change master to master_host='192.168.2.146',\\ -> master_port=3306,\\ -> master_user='repl',\\ -> master_password='repl',\\ -> master_log_file='mysql-bin.000001',\\ -> master_log_pos=434; Query OK, 0 rows affected, 2 warnings (0.04 sec) mysql> start slave; Query OK, 0 rows affected (0.00 sec) 6.2.2 \u67e5\u770b\u72b6\u6001 \u00b6 \u767b\u5f55\u5230\u4ece\u4e0a\u64cd\u4f5c(master mysql\u7684leco\u4e3b\u673a\u4e0a\u64cd\u4f5c)\uff0c\u5728\u4ece\u4e0a\u67e5\u770bmysql\u72b6\u6001 mysql> show slave status\\G; *************************** 1. row *************************** Slave_IO_State: Waiting for master to send event Master_Host: 192.168.2.146 Master_User: repl Master_Port: 3306 Connect_Retry: 60 Master_Log_File: mysql-bin.000001 Read_Master_Log_Pos: 434 Relay_Log_File: leco-relay-bin.000002 Relay_Log_Pos: 320 Relay_Master_Log_File: mysql-bin.000001 Slave_IO_Running: Yes Slave_SQL_Running: Yes Replicate_Do_DB: Replicate_Ignore_DB: Replicate_Do_Table: Replicate_Ignore_Table: Replicate_Wild_Do_Table: Replicate_Wild_Ignore_Table: Last_Errno: 0 Last_Error: Skip_Counter: 0 Exec_Master_Log_Pos: 434 Relay_Log_Space: 526 Until_Condition: None Until_Log_File: Until_Log_Pos: 0 Master_SSL_Allowed: No Master_SSL_CA_File: Master_SSL_CA_Path: Master_SSL_Cert: Master_SSL_Cipher: Master_SSL_Key: Seconds_Behind_Master: 0 Master_SSL_Verify_Server_Cert: No Last_IO_Errno: 0 Last_IO_Error: Last_SQL_Errno: 0 Last_SQL_Error: Replicate_Ignore_Server_Ids: Master_Server_Id: 2 Master_UUID: 28d41b5e-5341-11e8-b65a-f4ec380008c2 Master_Info_File: /var/lib/mysql/master.info SQL_Delay: 0 SQL_Remaining_Delay: NULL Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates Master_Retry_Count: 86400 Master_Bind: Last_IO_Error_Timestamp: Last_SQL_Error_Timestamp: Master_SSL_Crl: Master_SSL_Crlpath: Retrieved_Gtid_Set: Executed_Gtid_Set: Auto_Position: 0 Replicate_Rewrite_DB: Channel_Name: Master_TLS_Version: 1 row in set (0.00 sec) ERROR: No query specified \u4ee5\u4e0a\u770b\u5230\u4e24\u4e2ayes\u4e00\u822c\u90fd\u662f\u4e3b\u4eceOK\u3002 6.2.3 \u8bbe\u7f6e \u00b6 leco\u673a\u5668\u4e0amysql\u914d\u7f6e auto_increment_offset = 1 auto_increment_increment = 2 manage01\u673a\u5668\u4e0amysql\u914d\u7f6e auto_increment_increment = 2 auto_increment_offset = 2 \u4e3a\u4e86\u4fdd\u8bc1id\u4e0d\u51b2\u7a81\uff0c\u6211\u914d\u7f6e\u4ee5\u4e0a\u4e24\u4e2a\u53c2\u6570\uff0c\u6267\u884c\u8fc7\u7a0b\u5982\u4e0b root@leco:/etc/mysql/mysql.conf.d# egrep -v '#|^$' mysqld.cnf [mysqld_safe] socket = /var/run/mysqld/mysqld.sock nice = 0 [mysqld] user = mysql pid-file = /var/run/mysqld/mysqld.pid socket = /var/run/mysqld/mysqld.sock port = 3306 basedir = /usr datadir = /var/lib/mysql tmpdir = /tmp lc-messages-dir = /usr/share/mysql skip-external-locking auto_increment_offset = 1 auto_increment_increment = 2 key_buffer_size = 16M max_allowed_packet = 16M thread_stack = 192K thread_cache_size = 8 myisam-recover-options = BACKUP query_cache_limit = 1M query_cache_size = 16M log_error = /var/log/mysql/error.log server-id = 1 log_bin = /var/log/mysql/mysql-bin.log expire_logs_days = 10 max_binlog_size = 100M [mysql] auto-rehash root@leco:/etc/mysql/mysql.conf.d# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service. root@manage01:/etc/mysql/mysql.conf.d# egrep -v '#|^$' mysqld.cnf [mysqld_safe] socket = /var/run/mysqld/mysqld.sock nice = 0 [mysqld] user = mysql pid-file = /var/run/mysqld/mysqld.pid socket = /var/run/mysqld/mysqld.sock port = 3306 basedir = /usr datadir = /var/lib/mysql tmpdir = /tmp lc-messages-dir = /usr/share/mysql skip-external-locking character-set-server=utf8 auto_increment_offset = 2 auto_increment_increment = 2 bind-address = 0.0.0.0 key_buffer_size = 16M max_allowed_packet = 16M thread_stack = 192K thread_cache_size = 8 myisam-recover-options = BACKUP query_cache_limit = 1M query_cache_size = 16M log_error = /var/log/mysql/error.log server-id = 2 log_bin = /var/log/mysql/mysql-bin.log expire_logs_days = 10 max_binlog_size = 100M root@manage01:/etc/mysql/mysql.conf.d# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service. 7. \u6d4b\u8bd5 \u00b6 7.1 leco\u4e3b\u673a\u6dfb\u52a0\u4e3b\u6570\u636e \u00b6 root@leco:~# mysql -uroot -p Enter password: mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 8 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> drop table cmz; ERROR 1051 (42S02): Unknown table 'summer.cmz' mysql> create table cmz( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.08 sec) mysql> insert into cmz(name,age,score) values(\"cmz from leco data\",18,88); Query OK, 1 row affected (0.01 sec) mysql> insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88); Query OK, 1 row affected (0.01 sec) mysql> select * from cmz; +----+---------------------+-----+-------+ | id | name | age | score | +----+---------------------+-----+-------+ | 1 | cmz from leco data | 18 | 88 | | 3 | cmz1 from leco data | 40 | 88 | +----+---------------------+-----+-------+ 2 rows in set (0.00 sec) 7.2 manage01\u4e3b\u673a\u67e5\u770b\u6570\u636e \u00b6 root@manage01:~# mysql -uroot -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 8 Server version: 5.7.23-0ubuntu0.16.04.1-log (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use summer Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> select * from cmz; +----+---------------------+-----+-------+ | id | name | age | score | +----+---------------------+-----+-------+ | 1 | cmz from leco data | 18 | 88 | | 3 | cmz1 from leco data | 40 | 88 | +----+---------------------+-----+-------+ 2 rows in set (0,00 sec) \u8fd9\u6837\u6765\u770bleco\u4e3b\u673a\u4e0a\u6dfb\u52a0\u7684\u6570\u636e\u540c\u6b65\u5230manage01\u4e3b\u673a\u4e0a\u4e86\u3002 7.3 manage01\u4e3b\u673a\u5929\u6dfb\u52a0\u6570\u636e \u00b6 root@manage01:~# mysql -uroot -p Enter password: ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES) root@manage01:~# mysql -uroot -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 10 Server version: 5.7.23-0ubuntu0.16.04.1-log (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> insert into cmz(name,age,score) values(\"cmz2 from manage01\",18,66); Query OK, 1 row affected (0,13 sec) mysql> insert into cmz(name,age,score) values(\"cmz3 from manage01\",40,66); Query OK, 1 row affected (0,16 sec) mysql> select * from cmz; +----+---------------------+-----+-------+ | id | name | age | score | +----+---------------------+-----+-------+ | 1 | cmz from leco data | 18 | 88 | | 3 | cmz1 from leco data | 40 | 88 | | 4 | cmz2 from manage01 | 18 | 66 | | 6 | cmz3 from manage01 | 40 | 66 | +----+---------------------+-----+-------+ 4 rows in set (0,00 sec) 7.4 leco\u4e3b\u673a\u67e5\u770b\u6570\u636e \u00b6 root@leco:~# mysql -uroot -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 9 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> select * from cmz; +----+---------------------+-----+-------+ | id | name | age | score | +----+---------------------+-----+-------+ | 1 | cmz from leco data | 18 | 88 | | 3 | cmz1 from leco data | 40 | 88 | | 4 | cmz2 from manage01 | 18 | 66 | | 6 | cmz3 from manage01 | 40 | 66 | +----+---------------------+-----+-------+ 4 rows in set (0.00 sec) \u8fd9\u6837\u6765\u770bmanage01\u4e3b\u673a\u4e0a\u6dfb\u52a0\u7684\u6570\u636e\u540c\u6b65\u5230leco\u4e3b\u673a\u4e0a\u4e86\u3002\u5230\u6b64\u4e3a\u6b62\uff0c\u53cc\u4e3b\u5c31\u641e\u597d\u4e86\u3002","title":"2. \u4e3b\u4e3b"},{"location":"mysql/mysql.master-master/#1","text":"\u5728\u4f01\u4e1a\u4e2d\uff0c\u6570\u636e\u5e93\u9ad8\u53ef\u7528\u4e00\u76f4\u662f\u4f01\u4e1a\u7684\u91cd\u4e2d\u4e4b\u91cd\uff0c\u4e2d\u5c0f\u4f01\u4e1a\u5f88\u591a\u90fd\u662f\u4f7f\u7528mysql\u4e3b\u4ece\u65b9\u6848\uff0c\u4e00\u4e3b\u591a\u4ece\uff0c\u8bfb\u5199\u5206\u79bb\u7b49\uff0c\u4f46\u662f\u5355\u4e3b\u5b58\u5728\u5355\u70b9\u6545\u969c\uff0c\u4ece\u5e93\u5207\u6362\u6210\u4e3b\u5e93\u9700\u8981\u4f5c\u6539\u52a8\u3002\u56e0\u6b64\uff0c\u5982\u679c\u662f\u53cc\u4e3b\u6216\u8005\u591a\u4e3b\uff0c\u5c31\u4f1a\u589e\u52a0mysql\u5165\u53e3\uff0c\u589e\u52a0\u9ad8\u53ef\u7528\u3002\u4e0d\u8fc7\u591a\u4e3b\u9700\u8981\u8003\u8651\u81ea\u589e\u957fID\u95ee\u9898\uff0c\u8fd9\u4e2a\u9700\u8981\u7279\u522b\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6\uff0c\u6bd4\u5982\u53cc\u4e3b\uff0c\u53ef\u4ee5\u4f7f\u7528\u5947\u5076\uff0c\u603b\u4e4b\uff0c\u4e3b\u4e4b\u95f4\u8bbe\u7f6e\u81ea\u589e\u957fID\u76f8\u4e92\u4e0d\u51b2\u7a81\u5c31\u80fd\u5b8c\u7f8e\u89e3\u51b3\u81ea\u589e\u957fID\u51b2\u7a81\u95ee\u9898\u3002","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.master-master/#2-mysql","text":"MySQL\u7684\u4e3b\u4e3b\uff0c\u5176\u5b9e\u8bf4\u767d\u4e86\u5c31\u662f\u76f8\u4e92\u4e3b\u4ece\u3002\u4e0a\u4e00\u8282\u642d\u5efa\u597d\u4e86\u4e3b\u4ece\u3002\u5728\u539f\u6765\u7684\u57fa\u7840\u4e0a\u518d\u53cd\u8fc7\u6765\u642d\u5efa\u4e3b\u4ece\u3002","title":"2. MySQL\u4e3b\u4e3b"},{"location":"mysql/mysql.master-master/#3-mysql","text":"\u76f8\u4e92\u4e3b\u4ece\u3002","title":"3. MySQL\u4e3b\u4e3b\u590d\u5236\u7684\u539f\u7406"},{"location":"mysql/mysql.master-master/#4","text":"","title":"4. \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.master-master/#41","text":"IP\u5730\u5740 \u89d2\u8272 mysql\u7248\u672c\u53f7 \u7cfb\u7edf \u4e3b\u673a\u540d\u5b57 192.168.5.110 mysql slave 5.7 ubuntu16 leco 192.168.2.148 mysql master 5.7 ubuntu16 manage01 \u8fd9\u6837\u5c31\u53cd\u8fc7\u6765\u4e86\uff0c\u7b49\u90e8\u7f72\u597d\u4e86\uff0c\u76f8\u4e92\u4e3b\u4ece\uff0c\u5c31\u662f\u4e3b\u4e3b\u3002","title":"4.1 \u73af\u5883"},{"location":"mysql/mysql.master-master/#42","text":"","title":"4.2 \u914d\u7f6e\u51c6\u5907"},{"location":"mysql/mysql.master-master/#421-master","text":"\u5f00\u542f\u4e8c\u8fdb\u5236\u65e5\u5fd7 \u914d\u7f6e\u552f\u4e00\u7684server-id \u83b7\u5f97master\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u540d\u53ca\u4f4d\u7f6e \u521b\u5efa\u4e00\u4e2a\u7528\u4e8eslave\u548cmaster\u901a\u4fe1\u7684\u7528\u6237\u8d26\u53f7","title":"4.2.1 master\u51c6\u5907"},{"location":"mysql/mysql.master-master/#422-slave","text":"\u914d\u7f6e\u552f\u4e00\u7684server-id \u4f7f\u7528master\u5206\u914d\u7684\u7528\u6237\u8d26\u53f7\u8bfb\u53d6master\u4e8c\u8fdb\u5236\u65e5\u5fd7 \u542f\u7528slave\u670d\u52a1","title":"4.2.2 slave\u51c6\u5907"},{"location":"mysql/mysql.master-master/#5-master","text":"","title":"5. master \u64cd\u4f5c"},{"location":"mysql/mysql.master-master/#51-master","text":"\u627e\u5230\u4e3b\u6570\u636e\u5e93\u7684\u914d\u7f6e\u6587\u4ef6my.cnf(\u6216\u8005my.ini)\uff0c\u6211\u7684\u5728/etc/mysql/my.cnf,\u5728[mysqld]\u90e8\u5206\u63d2\u5165\u5982\u4e0b\u4e24\u884c\uff1a root@manage01:~# egrep -irn 'log_bin|server-id' /etc/mysql/mysql.conf.d/mysqld.cnf 84:server-id = 2 85:log_bin = /var/log/mysql/mysql-bin.log \u914d\u7f6e\u5b8c\u6bd5\u540e\uff0c\u91cd\u542fmysql root@manage01:~# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service.","title":"5.1 \u4fee\u6539master\u914d\u7f6e\u6587\u4ef6"},{"location":"mysql/mysql.master-master/#52","text":"\u521b\u5efa\u7528\u6237\u5e76\u6388\u6743\uff1a\u7528\u6237\uff1arepl\uff0c\u5bc6\u7801\uff1arepl grant all privileges on *.* to repl@'%' identified by 'repl'; \u64cd\u4f5c\u8fc7\u7a0b mysql> select host,user from mysql.user; +-------------+------------------+ | host | user | +-------------+------------------+ | % | loocha | | 192.168.5.% | loocha | | localhost | airflow | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | | localhost | seafile | +-------------+------------------+ 8 rows in set (0,00 sec) mysql> grant replication slave on *.* to 'repl'@'%' identified by 'repl'; Query OK, 0 rows affected, 1 warning (0.01 sec) mysql> flush privileges; Query OK, 0 rows affected (0.01 sec) mysql> select host,user from mysql.user; +-------------+------------------+ | host | user | +-------------+------------------+ | % | loocha | | % | repl | | 192.168.5.% | loocha | | localhost | airflow | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | | localhost | seafile | +-------------+------------------+ 9 rows in set (0,00 sec)","title":"5.2 \u6388\u6743\u540c\u6b65\u8d26\u53f7"},{"location":"mysql/mysql.master-master/#53","text":"# \u67e5\u770bmaster\u72b6\u6001\uff0c\u8bb0\u5f55\u4e8c\u8fdb\u5236\u6587\u4ef6\u540d(mysql-bin.000003)\u548c\u4f4d\u7f6e(73)\uff1a mysql> show master status; +------------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +------------------+----------+--------------+------------------+-------------------+ | mysql-bin.000001 | 434 | | | | +------------------+----------+--------------+------------------+-------------------+ 1 row in set (0,00 sec) \u6ce8\u610f \u6ce8\u610f\u8fd9\u4e2a\u6587\u4ef6 mysql - bin . 000001 \u548c\u70b9 434","title":"5.3 \u8bb0\u5f55\u72b6\u6001"},{"location":"mysql/mysql.master-master/#6-slave","text":"","title":"6. slave \u64cd\u4f5c"},{"location":"mysql/mysql.master-master/#61-master","text":"\u627e\u5230\u4e3b\u6570\u636e\u5e93\u7684\u914d\u7f6e\u6587\u4ef6my.cnf(\u6216\u8005my.ini)\uff0c\u4fee\u6539server-id\u3002 \u4e5f\u5c31\u662f\u4e4b\u524d\u7684\u4e3b\uff0c\u5df2\u7ecf\u914d\u7f6e\u4e3aserver-id=1","title":"6.1 \u4fee\u6539master\u914d\u7f6e\u6587\u4ef6"},{"location":"mysql/mysql.master-master/#62","text":"","title":"6.2 \u94fe\u63a5"},{"location":"mysql/mysql.master-master/#621","text":"\u767b\u5f55\u5230\u4ece\u4e0a\u64cd\u4f5c(master mysql\u7684leco\u4e3b\u673a\u4e0a\u64cd\u4f5c) stop slave; grant all privileges on *.* to repl@'%' identified by 'repl'; change master to master_host='192.168.5.110',\\ master_port=3306,\\ master_user='repl',\\ master_password='repl',\\ master_log_file='mysql-bin.000001',\\ master_log_pos=1571; start slave; show slave status\\G; \u64cd\u4f5c\u8fc7\u7a0b mysql> stop slave; Query OK, 0 rows affected, 1 warning (0.00 sec) mysql> change master to master_host='192.168.2.146',\\ -> master_port=3306,\\ -> master_user='repl',\\ -> master_password='repl',\\ -> master_log_file='mysql-bin.000001',\\ -> master_log_pos=434; Query OK, 0 rows affected, 2 warnings (0.04 sec) mysql> start slave; Query OK, 0 rows affected (0.00 sec)","title":"6.2.1 \u5feb\u901f\u547d\u4ee4"},{"location":"mysql/mysql.master-master/#622","text":"\u767b\u5f55\u5230\u4ece\u4e0a\u64cd\u4f5c(master mysql\u7684leco\u4e3b\u673a\u4e0a\u64cd\u4f5c)\uff0c\u5728\u4ece\u4e0a\u67e5\u770bmysql\u72b6\u6001 mysql> show slave status\\G; *************************** 1. row *************************** Slave_IO_State: Waiting for master to send event Master_Host: 192.168.2.146 Master_User: repl Master_Port: 3306 Connect_Retry: 60 Master_Log_File: mysql-bin.000001 Read_Master_Log_Pos: 434 Relay_Log_File: leco-relay-bin.000002 Relay_Log_Pos: 320 Relay_Master_Log_File: mysql-bin.000001 Slave_IO_Running: Yes Slave_SQL_Running: Yes Replicate_Do_DB: Replicate_Ignore_DB: Replicate_Do_Table: Replicate_Ignore_Table: Replicate_Wild_Do_Table: Replicate_Wild_Ignore_Table: Last_Errno: 0 Last_Error: Skip_Counter: 0 Exec_Master_Log_Pos: 434 Relay_Log_Space: 526 Until_Condition: None Until_Log_File: Until_Log_Pos: 0 Master_SSL_Allowed: No Master_SSL_CA_File: Master_SSL_CA_Path: Master_SSL_Cert: Master_SSL_Cipher: Master_SSL_Key: Seconds_Behind_Master: 0 Master_SSL_Verify_Server_Cert: No Last_IO_Errno: 0 Last_IO_Error: Last_SQL_Errno: 0 Last_SQL_Error: Replicate_Ignore_Server_Ids: Master_Server_Id: 2 Master_UUID: 28d41b5e-5341-11e8-b65a-f4ec380008c2 Master_Info_File: /var/lib/mysql/master.info SQL_Delay: 0 SQL_Remaining_Delay: NULL Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates Master_Retry_Count: 86400 Master_Bind: Last_IO_Error_Timestamp: Last_SQL_Error_Timestamp: Master_SSL_Crl: Master_SSL_Crlpath: Retrieved_Gtid_Set: Executed_Gtid_Set: Auto_Position: 0 Replicate_Rewrite_DB: Channel_Name: Master_TLS_Version: 1 row in set (0.00 sec) ERROR: No query specified \u4ee5\u4e0a\u770b\u5230\u4e24\u4e2ayes\u4e00\u822c\u90fd\u662f\u4e3b\u4eceOK\u3002","title":"6.2.2 \u67e5\u770b\u72b6\u6001"},{"location":"mysql/mysql.master-master/#623","text":"leco\u673a\u5668\u4e0amysql\u914d\u7f6e auto_increment_offset = 1 auto_increment_increment = 2 manage01\u673a\u5668\u4e0amysql\u914d\u7f6e auto_increment_increment = 2 auto_increment_offset = 2 \u4e3a\u4e86\u4fdd\u8bc1id\u4e0d\u51b2\u7a81\uff0c\u6211\u914d\u7f6e\u4ee5\u4e0a\u4e24\u4e2a\u53c2\u6570\uff0c\u6267\u884c\u8fc7\u7a0b\u5982\u4e0b root@leco:/etc/mysql/mysql.conf.d# egrep -v '#|^$' mysqld.cnf [mysqld_safe] socket = /var/run/mysqld/mysqld.sock nice = 0 [mysqld] user = mysql pid-file = /var/run/mysqld/mysqld.pid socket = /var/run/mysqld/mysqld.sock port = 3306 basedir = /usr datadir = /var/lib/mysql tmpdir = /tmp lc-messages-dir = /usr/share/mysql skip-external-locking auto_increment_offset = 1 auto_increment_increment = 2 key_buffer_size = 16M max_allowed_packet = 16M thread_stack = 192K thread_cache_size = 8 myisam-recover-options = BACKUP query_cache_limit = 1M query_cache_size = 16M log_error = /var/log/mysql/error.log server-id = 1 log_bin = /var/log/mysql/mysql-bin.log expire_logs_days = 10 max_binlog_size = 100M [mysql] auto-rehash root@leco:/etc/mysql/mysql.conf.d# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service. root@manage01:/etc/mysql/mysql.conf.d# egrep -v '#|^$' mysqld.cnf [mysqld_safe] socket = /var/run/mysqld/mysqld.sock nice = 0 [mysqld] user = mysql pid-file = /var/run/mysqld/mysqld.pid socket = /var/run/mysqld/mysqld.sock port = 3306 basedir = /usr datadir = /var/lib/mysql tmpdir = /tmp lc-messages-dir = /usr/share/mysql skip-external-locking character-set-server=utf8 auto_increment_offset = 2 auto_increment_increment = 2 bind-address = 0.0.0.0 key_buffer_size = 16M max_allowed_packet = 16M thread_stack = 192K thread_cache_size = 8 myisam-recover-options = BACKUP query_cache_limit = 1M query_cache_size = 16M log_error = /var/log/mysql/error.log server-id = 2 log_bin = /var/log/mysql/mysql-bin.log expire_logs_days = 10 max_binlog_size = 100M root@manage01:/etc/mysql/mysql.conf.d# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service.","title":"6.2.3 \u8bbe\u7f6e"},{"location":"mysql/mysql.master-master/#7","text":"","title":"7. \u6d4b\u8bd5"},{"location":"mysql/mysql.master-master/#71-leco","text":"root@leco:~# mysql -uroot -p Enter password: mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 8 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> drop table cmz; ERROR 1051 (42S02): Unknown table 'summer.cmz' mysql> create table cmz( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.08 sec) mysql> insert into cmz(name,age,score) values(\"cmz from leco data\",18,88); Query OK, 1 row affected (0.01 sec) mysql> insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88); Query OK, 1 row affected (0.01 sec) mysql> select * from cmz; +----+---------------------+-----+-------+ | id | name | age | score | +----+---------------------+-----+-------+ | 1 | cmz from leco data | 18 | 88 | | 3 | cmz1 from leco data | 40 | 88 | +----+---------------------+-----+-------+ 2 rows in set (0.00 sec)","title":"7.1 leco\u4e3b\u673a\u6dfb\u52a0\u4e3b\u6570\u636e"},{"location":"mysql/mysql.master-master/#72-manage01","text":"root@manage01:~# mysql -uroot -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 8 Server version: 5.7.23-0ubuntu0.16.04.1-log (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use summer Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> select * from cmz; +----+---------------------+-----+-------+ | id | name | age | score | +----+---------------------+-----+-------+ | 1 | cmz from leco data | 18 | 88 | | 3 | cmz1 from leco data | 40 | 88 | +----+---------------------+-----+-------+ 2 rows in set (0,00 sec) \u8fd9\u6837\u6765\u770bleco\u4e3b\u673a\u4e0a\u6dfb\u52a0\u7684\u6570\u636e\u540c\u6b65\u5230manage01\u4e3b\u673a\u4e0a\u4e86\u3002","title":"7.2 manage01\u4e3b\u673a\u67e5\u770b\u6570\u636e"},{"location":"mysql/mysql.master-master/#73-manage01","text":"root@manage01:~# mysql -uroot -p Enter password: ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES) root@manage01:~# mysql -uroot -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 10 Server version: 5.7.23-0ubuntu0.16.04.1-log (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> insert into cmz(name,age,score) values(\"cmz2 from manage01\",18,66); Query OK, 1 row affected (0,13 sec) mysql> insert into cmz(name,age,score) values(\"cmz3 from manage01\",40,66); Query OK, 1 row affected (0,16 sec) mysql> select * from cmz; +----+---------------------+-----+-------+ | id | name | age | score | +----+---------------------+-----+-------+ | 1 | cmz from leco data | 18 | 88 | | 3 | cmz1 from leco data | 40 | 88 | | 4 | cmz2 from manage01 | 18 | 66 | | 6 | cmz3 from manage01 | 40 | 66 | +----+---------------------+-----+-------+ 4 rows in set (0,00 sec)","title":"7.3 manage01\u4e3b\u673a\u5929\u6dfb\u52a0\u6570\u636e"},{"location":"mysql/mysql.master-master/#74-leco","text":"root@leco:~# mysql -uroot -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 9 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> select * from cmz; +----+---------------------+-----+-------+ | id | name | age | score | +----+---------------------+-----+-------+ | 1 | cmz from leco data | 18 | 88 | | 3 | cmz1 from leco data | 40 | 88 | | 4 | cmz2 from manage01 | 18 | 66 | | 6 | cmz3 from manage01 | 40 | 66 | +----+---------------------+-----+-------+ 4 rows in set (0.00 sec) \u8fd9\u6837\u6765\u770bmanage01\u4e3b\u673a\u4e0a\u6dfb\u52a0\u7684\u6570\u636e\u540c\u6b65\u5230leco\u4e3b\u673a\u4e0a\u4e86\u3002\u5230\u6b64\u4e3a\u6b62\uff0c\u53cc\u4e3b\u5c31\u641e\u597d\u4e86\u3002","title":"7.4 leco\u4e3b\u673a\u67e5\u770b\u6570\u636e"},{"location":"mysql/mysql.master-slave/","text":"MySQL \u4e3b\u4ece 1. \u539f\u7406 \u00b6 MySQL\u7684\u4e3b\u4ece\u590d\u5236\u65b9\u6848\uff0c\u548c\u6587\u4ef6\u7cfb\u7edf\u7ea7\u522b\u540c\u6b65\u662f\u7c7b\u4f3c\u7684\uff0c\u90fd\u662f\u6570\u636e\u7684\u4f20\u8f93\u3002\u53ea\u4e0d\u8fc7MySQL\u65e0\u9700\u501f\u52a9\u7b2c\u4e09\u65b9\u8f6f\u4ef6\u5de5\u5177\uff0c\u800c\u662f\u5176\u81ea\u5e26\u7684\u540c\u6b65\u590d\u5236\u529f\u80fd\u3002\u53e6\u5916MySQL\u7684\u4e3b\u4ece\u590d\u5236\u5e76\u4e0d\u662f\u5728\u78c1\u76d8\u4e0a\u6587\u4ef6\u76f4\u63a5\u540c\u6b65\uff0c\u800c\u662f\u7528\u903b\u8f91\u7684binlog\u65e5\u5fd7\u540c\u6b65\u5230\u672c\u5730\uff0c\u518d\u5e94\u7528\u6267\u884c\u7684\u8fc7\u7a0b\u3002 \u6211\u4eec\u901a\u5e38\u5e0c\u671b\u5728\u6bcf\u6b21\u63d2\u5165\u65b0\u8bb0\u5f55\u65f6\u81ea\u52a8\u521b\u5efa\u4e3b\u952e\u5b57\u6bb5\u7684\u503c\u3002\u6211\u4eec\u53ef\u4ee5\u5728\u8868\u4e2d\u521b\u5efa\u4e00\u4e2a\u81ea\u52a8\u589e\u91cf\uff08auto-increment\uff09\u5b57\u6bb5\u3002 2. MySQL\u4e3b\u4ece\u590d\u5236\u4ecb\u7ecd \u00b6 MySQL\u6570\u636e\u5e93\u652f\u6301\u5355\u5411\u3001\u53cc\u5411\u3001\u94fe\u5f0f\u7ea7\u8054\u7b49\u4e0d\u540c\u573a\u666f\u7684\u590d\u5236\u3002\u5728\u590d\u5236\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u53f0\u670d\u52a1\u5668\u5145\u5f53\u4e3b\u670d\u52a1\u5668(Master)\uff0c\u800c\u4e00\u4e2a\u6216\u591a\u4e2a\u5176\u4ed6\u7684\u670d\u52a1\u5668\u5145\u5f53\u4ece\u670d\u52a1\u5668(Slave)\u3002 \u590d\u5236\u53ef\u4ee5\u662f\u5355\u5411\u7684M\u2192S\uff0c\u4e5f\u53ef\u4ee5\u662fM\u2190\u2192M\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u591aM\u73af\u72b6\u540c\u6b65\u7b49\u3002 \u5982\u679c\u8bbe\u7f6e\u4e86\u94fe\u5f0f\u7ea7\u8054\u590d\u5236\uff0c\u90a3\u4e48\u4ece(Slave)\u670d\u52a1\u5668\u672c\u8eab\u9664\u4e86\u5145\u5f53\u4ece\u670d\u52a1\u5668\u5916\uff0c\u4e5f\u4f1a\u540c\u65f6\u5145\u5f53\u5176\u4e0b\u9762\u4ece\u670d\u52a1\u5668\u7684\u4e3b\u670d\u52a1\u5668\u3002\u94fe\u5f0f\u7ea7\u8054\u590d\u5236\u7c7b\u4f3cA\u2192B\u2192C\u2192D\u7684\u590d\u5236\u5f62\u5f0f\u3002 \u5728\u5f53\u524d\u7684\u751f\u4ea7\u5de5\u4f5c\u4e2d\uff0cMySQL\u4e3b\u4ece\u590d\u5236\u90fd\u662f\u5f02\u6b65\u7684\u590d\u5236\u65b9\u5f0f\uff0c\u5373\u4e0d\u662f\u4e25\u683c\u5b9e\u65f6\u7684\u6570\u636e\u540c\u6b65\u3002 3. MySQL\u4e3b\u4ece\u590d\u5236\u7684\u539f\u7406 \u00b6 MySQL\u7684\u4e3b\u4ece\u590d\u5236\u662f\u4e00\u4e2a\u5f02\u6b65\u7684\u590d\u5236\u8fc7\u7a0b\uff0c\u6570\u636e\u5c06\u4ece\u4e00\u4e2aMySQL\u6570\u636e\u5e93\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u6570\u636e\u5e93\uff0c\u5728\u4e3b\u6570\u636e\u5e93\u4e0e\u4ece\u6570\u636e\u5e93\u4e4b\u95f4\u5b9e\u73b0\u6574\u4e2a\u4e3b\u4ece\u590d\u5236\u7684\u8fc7\u7a0b\u662f\u7531\u4e09\u4e2a\u7ebf\u7a0b\u53c2\u4e0e\u5b8c\u6210\u7684\u3002\u5176\u4e2d\u6709\u4e24\u4e2a\u7ebf\u7a0b(SQL\u7ebf\u7a0b\u3001IO\u7ebf\u7a0b)\u5728\u4ece\u6570\u636e\u5e93\u7aef\uff0c\u53e6\u5916\u4e00\u4e2aIO\u7ebf\u7a0b\u5728\u4e3b\u6570\u636e\u5e93\u7aef\u3002 \u8981\u5b9e\u73b0MySQL\u7684\u4e3b\u4ece\u590d\u5236\uff0c\u9996\u5148\u5fc5\u987b\u6253\u5f00Master\u7aef\u7684binlog\u8bb0\u5f55\u529f\u80fd\uff0c\u5426\u5219\u5c31\u65e0\u6cd5\u5b9e\u73b0\u3002\u56e0\u4e3a\u6574\u4e2a\u590d\u5236\u8fc7\u7a0b\u5b9e\u9645\u4e0a\u5c31\u662fSlave\u4eceMaster\u7aef\u83b7\u53d6binlog\u65e5\u5fd7\uff0c\u7136\u540e\u518d\u5728Slave\u7aef\u4e0a\u4f9d\u76f8\u540c\u987a\u5e8f\u6267\u884c\u83b7\u53d6\u7684binlog\u65e5\u5fd7\u4e2d\u6240\u8bb0\u5f55\u7684\u5404\u79cdSQL\u64cd\u4f5c\u3002\u8be6\u7ec6\u6d41\u7a0b\u8bf7\u53c2\u9605\u5982\u4e0b\u56fe\u7247\u6587\u6863\u3002 4. \u73af\u5883\u51c6\u5907 \u00b6 4.1 \u73af\u5883 \u00b6 IP\u5730\u5740 \u89d2\u8272 mysql\u7248\u672c\u53f7 \u7cfb\u7edf \u4e3b\u673a\u540d 192.168.5.110 mysql master 5.7 ubuntu16 leco 192.168.2.148 mysql slave 5.7 ubuntu16 manage01 4.2 \u914d\u7f6e\u51c6\u5907 \u00b6 4.2.1 master\u51c6\u5907 \u00b6 \u5f00\u542f\u4e8c\u8fdb\u5236\u65e5\u5fd7 \u914d\u7f6e\u552f\u4e00\u7684server-id \u83b7\u5f97master\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u540d\u53ca\u4f4d\u7f6e \u521b\u5efa\u4e00\u4e2a\u7528\u4e8eslave\u548cmaster\u901a\u4fe1\u7684\u7528\u6237\u8d26\u53f7 4.2.2 slave\u51c6\u5907 \u00b6 \u914d\u7f6e\u552f\u4e00\u7684server-id \u4f7f\u7528master\u5206\u914d\u7684\u7528\u6237\u8d26\u53f7\u8bfb\u53d6master\u4e8c\u8fdb\u5236\u65e5\u5fd7 \u542f\u7528slave\u670d\u52a1 5. master \u64cd\u4f5c \u00b6 5.1 \u4fee\u6539master\u914d\u7f6e\u6587\u4ef6 \u00b6 \u627e\u5230\u4e3b\u6570\u636e\u5e93\u7684\u914d\u7f6e\u6587\u4ef6my.cnf(\u6216\u8005my.ini)\uff0c\u6211\u7684\u5728/etc/mysql/my.cnf,\u5728[mysqld]\u90e8\u5206\u63d2\u5165\u5982\u4e0b\u4e24\u884c\uff1a root@leco:/etc/mysql/mysql.conf.d# ls mysqld.cnf mysqld.cnf root@leco:/etc/mysql/mysql.conf.d# egrep -irn 'log_bin|server-id' mysqld.cnf 83:server-id = 1 84:log_bin = /var/log/mysql/mysql-bin.log \u914d\u7f6e\u5b8c\u6bd5\u540e\uff0c\u91cd\u542fmysql root@leco:/etc/mysql/mysql.conf.d# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service. 5.2 \u6388\u6743\u540c\u6b65\u8d26\u53f7 \u00b6 \u521b\u5efa\u7528\u6237\u5e76\u6388\u6743\uff1a\u7528\u6237\uff1arepl\uff0c\u5bc6\u7801\uff1arepl grant all privileges on *.* to repl@'%' identified by 'repl'; \u64cd\u4f5c\u8fc7\u7a0b mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 5 rows in set (0.00 sec) mysql> grant replication slave on *.* to 'repl'@'%' identified by 'repl'; Query OK, 0 rows affected, 1 warning (0.01 sec) mysql> flush privileges; Query OK, 0 rows affected (0.01 sec) mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 6 rows in set (0.00 sec) 5.3 \u8bb0\u5f55\u72b6\u6001 \u00b6 # \u67e5\u770bmaster\u72b6\u6001\uff0c\u8bb0\u5f55\u4e8c\u8fdb\u5236\u6587\u4ef6\u540d(mysql-bin.000003)\u548c\u4f4d\u7f6e(73)\uff1a mysql> show master status; +------------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +------------------+----------+--------------+------------------+-------------------+ | mysql-bin.000001 | 1571 | | | | +------------------+----------+--------------+------------------+-------------------+ 1 row in set (0.00 sec) \u6ce8\u610f \u6ce8\u610f\u8fd9\u4e2a\u6587\u4ef6 mysql - bin . 000001 \u548c\u70b9 1571 6. slave \u64cd\u4f5c \u00b6 6.1 \u4fee\u6539master\u914d\u7f6e\u6587\u4ef6 \u00b6 \u627e\u5230\u4e3b\u6570\u636e\u5e93\u7684\u914d\u7f6e\u6587\u4ef6my.cnf(\u6216\u8005my.ini)\uff0c\u4fee\u6539server-id\u3002 root@manage01:/etc/mysql/mysql.conf.d# grep 'server-id' mysqld.cnf server-id = 2 \u6ce8\u610f 1. \u4e3b\u4ece\u7684 server - id\u4e00\u5b9a\u8981\u4e0d\u4e00\u6837 \uff0c\u4e00\u822c\u914d\u7f6e\u6210 ip\u5730\u5740\u6700\u540e\u4e00\u4f4d \u3002 2. \u672c\u6587\u6211\u4e3a\u4e86\u7701\u4e8b\uff0c\u76f4\u63a5\u4fee\u6539\u4e3a master\u4e3a1 \uff0c slave2 \u3002 \u91cd\u542f\u4ece\u7684mysql\u3002 root@manage01:~# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service. 6.2 \u94fe\u63a5 \u00b6 6.2.1 \u5feb\u901f\u547d\u4ee4 \u00b6 stop slave; grant all privileges on *.* to repl@'%' identified by 'repl'; change master to master_host='192.168.5.110',\\ master_port=3306,\\ master_user='repl',\\ master_password='repl',\\ master_log_file='mysql-bin.000001',\\ master_log_pos=1571; start slave; show slave status\\G; \u64cd\u4f5c\u8fc7\u7a0b mysql> stop slave; Query OK, 0 rows affected, 1 warning (0,00 sec) mysql> change master to master_host='192.168.5.110',\\ -> master_port=3306,\\ -> master_user='repl',\\ -> master_password='repl',\\ -> master_log_file='mysql-bin.000001',\\ -> master_log_pos=1571; Query OK, 0 rows affected, 2 warnings (0.09 sec) mysql> start slave; Query OK, 0 rows affected (0.00 sec) 6.2.2 \u67e5\u770b\u72b6\u6001 \u00b6 \u5728\u4ece\u4e0a\u67e5\u770bmysql\u72b6\u6001 mysql> show slave status\\G; *************************** 1. row *************************** Slave_IO_State: Waiting for master to send event Master_Host: 192.168.5.110 Master_User: repl Master_Port: 3306 Connect_Retry: 60 Master_Log_File: mysql-bin.000001 Read_Master_Log_Pos: 1571 Relay_Log_File: manage01-relay-bin.000002 Relay_Log_Pos: 320 Relay_Master_Log_File: mysql-bin.000001 Slave_IO_Running: Yes Slave_SQL_Running: Yes Replicate_Do_DB: Replicate_Ignore_DB: Replicate_Do_Table: Replicate_Ignore_Table: Replicate_Wild_Do_Table: Replicate_Wild_Ignore_Table: Last_Errno: 0 Last_Error: Skip_Counter: 0 Exec_Master_Log_Pos: 1571 Relay_Log_Space: 530 Until_Condition: None Until_Log_File: Until_Log_Pos: 0 Master_SSL_Allowed: No Master_SSL_CA_File: Master_SSL_CA_Path: Master_SSL_Cert: Master_SSL_Cipher: Master_SSL_Key: Seconds_Behind_Master: 0 Master_SSL_Verify_Server_Cert: No Last_IO_Errno: 0 Last_IO_Error: Last_SQL_Errno: 0 Last_SQL_Error: Replicate_Ignore_Server_Ids: Master_Server_Id: 1 Master_UUID: 806dc48e-07eb-11e9-89c3-7427eab0aa2c Master_Info_File: /var/lib/mysql/master.info SQL_Delay: 0 SQL_Remaining_Delay: NULL Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates Master_Retry_Count: 86400 Master_Bind: Last_IO_Error_Timestamp: Last_SQL_Error_Timestamp: Master_SSL_Crl: Master_SSL_Crlpath: Retrieved_Gtid_Set: Executed_Gtid_Set: Auto_Position: 0 Replicate_Rewrite_DB: Channel_Name: Master_TLS_Version: 1 row in set (0,00 sec) ERROR: No query specified \u4ee5\u4e0a\u770b\u5230\u4e24\u4e2ayes\u4e00\u822c\u90fd\u662f\u4e3b\u4eceOK\u3002 \u5f53Slave_IO_Running\u548cSlave_SQL_Running\u90fd\u4e3aYES\u7684\u65f6\u5019\u5c31\u8868\u793a\u4e3b\u4ece\u540c\u6b65\u8bbe\u7f6e\u6210\u529f\u4e86\u3002\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u8fdb\u884c\u4e00\u4e9b\u9a8c\u8bc1\u4e86\uff0c\u6bd4\u5982\u5728\u4e3bmaster\u6570\u636e\u5e93\u7684test\u6570\u636e\u5e93\u7684\u4e00\u5f20\u8868\u4e2d\u63d2\u5165\u4e00\u6761\u6570\u636e\uff0c\u5728slave\u7684test\u5e93\u7684\u76f8\u540c\u6570\u636e\u8868\u4e2d\u67e5\u770b\u662f\u5426\u6709\u65b0\u589e\u7684\u6570\u636e\u5373\u53ef\u9a8c\u8bc1\u4e3b\u4ece\u590d\u5236\u529f\u80fd\u662f\u5426\u6709\u6548\uff0c\u8fd8\u53ef\u4ee5\u5173\u95edslave\uff08mysql>stop slave;\uff09,\u7136\u540e\u518d\u4fee\u6539master\uff0c\u770bslave\u662f\u5426\u4e5f\u76f8\u5e94\u4fee\u6539\uff08\u505c\u6b62slave\u540e\uff0cmaster\u7684\u4fee\u6539\u4e0d\u4f1a\u540c\u6b65\u5230slave\uff09\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u4e3b\u4ece\u590d\u5236\u529f\u80fd\u7684\u9a8c\u8bc1\u4e86\u3002 \u8fd8\u53ef\u4ee5\u7528\u5230\u7684\u5176\u4ed6\u76f8\u5173\u53c2\u6570\uff1amaster\u5f00\u542f\u4e8c\u8fdb\u5236\u65e5\u5fd7\u540e\u9ed8\u8ba4\u8bb0\u5f55\u6240\u6709\u5e93\u6240\u6709\u8868\u7684\u64cd\u4f5c\uff0c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6765\u6307\u5b9a\u53ea\u8bb0\u5f55\u6307\u5b9a\u7684\u6570\u636e\u5e93\u751a\u81f3\u6307\u5b9a\u7684\u8868\u7684\u64cd\u4f5c\uff0c\u5177\u4f53\u5728mysql\u914d\u7f6e\u6587\u4ef6\u7684[mysqld]\u53ef\u6dfb\u52a0\u4fee\u6539\u5982\u4e0b\u9009\u9879\uff1a # \u4e0d\u540c\u6b65\u54ea\u4e9b\u6570\u636e\u5e93 binlog-ignore-db = mysql binlog-ignore-db = test binlog-ignore-db = information_schema # \u53ea\u540c\u6b65\u54ea\u4e9b\u6570\u636e\u5e93\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u5176\u4ed6\u4e0d\u540c\u6b65 binlog-do-db = game 7. \u6d4b\u8bd5 \u00b6 7.1 \u4e3b\u52a0\u6570\u636e \u00b6 \u5728\u4e3bmysql\u4e0a\u6dfb\u52a0\u4e00\u4e9b\u6570\u636e create database summer; use summer; drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into info(name,age,score) values('aa',30,66); insert into info(name,age,score) values('bb',30,66); insert into info(name,age,score) values('cc',30,66); \u64cd\u4f5c\u8fc7\u7a0b mysql> create database summer; Query OK, 1 row affected (0.01 sec) mysql> use summer; Database changed mysql> drop table info; ERROR 1051 (42S02): Unknown table 'summer.info' mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.07 sec) mysql> insert into info(name,age,score) values('aa',30,66); Query OK, 1 row affected (0.01 sec) mysql> insert into info(name,age,score) values('bb',30,66); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values('cc',30,66); Query OK, 1 row affected (0.01 sec) 7.2 \u4ece\u68c0\u67e5 \u00b6 \u767b\u5f55\u4ece\u67e5\u770b mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +------------------+ | Tables_in_summer | +------------------+ | info | +------------------+ 1 row in set (0,00 sec) mysql> select * from info; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | aa | 30 | 66 | | 2 | bb | 30 | 66 | | 3 | cc | 30 | 66 | +----+------+-----+-------+ 3 rows in set (0,00 sec) \u4ece\u7ed3\u679c\u6765\u770b\uff0c\u4ece\u5df2\u7ecf\u540c\u6b65\u4e86\u4e3b\u7684\u6570\u636e\uff0cdo well done\uff01 8. \u9057\u6f0f \u00b6 \u5728\u505a\u4e3b\u4ece\u540c\u6b65\u7684\u65f6\u5019\uff0c\u6211\u7701\u7565\u4e86\u4e00\u70b9\uff0c\u8981\u5148\u628a\u4e3b\u4e0a\u7684\u6570\u636e\u5e93\u540c\u6b65\u5230\u4ece\u4e0a\u3002","title":"1. \u4e3b\u4ece"},{"location":"mysql/mysql.master-slave/#1","text":"MySQL\u7684\u4e3b\u4ece\u590d\u5236\u65b9\u6848\uff0c\u548c\u6587\u4ef6\u7cfb\u7edf\u7ea7\u522b\u540c\u6b65\u662f\u7c7b\u4f3c\u7684\uff0c\u90fd\u662f\u6570\u636e\u7684\u4f20\u8f93\u3002\u53ea\u4e0d\u8fc7MySQL\u65e0\u9700\u501f\u52a9\u7b2c\u4e09\u65b9\u8f6f\u4ef6\u5de5\u5177\uff0c\u800c\u662f\u5176\u81ea\u5e26\u7684\u540c\u6b65\u590d\u5236\u529f\u80fd\u3002\u53e6\u5916MySQL\u7684\u4e3b\u4ece\u590d\u5236\u5e76\u4e0d\u662f\u5728\u78c1\u76d8\u4e0a\u6587\u4ef6\u76f4\u63a5\u540c\u6b65\uff0c\u800c\u662f\u7528\u903b\u8f91\u7684binlog\u65e5\u5fd7\u540c\u6b65\u5230\u672c\u5730\uff0c\u518d\u5e94\u7528\u6267\u884c\u7684\u8fc7\u7a0b\u3002 \u6211\u4eec\u901a\u5e38\u5e0c\u671b\u5728\u6bcf\u6b21\u63d2\u5165\u65b0\u8bb0\u5f55\u65f6\u81ea\u52a8\u521b\u5efa\u4e3b\u952e\u5b57\u6bb5\u7684\u503c\u3002\u6211\u4eec\u53ef\u4ee5\u5728\u8868\u4e2d\u521b\u5efa\u4e00\u4e2a\u81ea\u52a8\u589e\u91cf\uff08auto-increment\uff09\u5b57\u6bb5\u3002","title":"1. \u539f\u7406"},{"location":"mysql/mysql.master-slave/#2-mysql","text":"MySQL\u6570\u636e\u5e93\u652f\u6301\u5355\u5411\u3001\u53cc\u5411\u3001\u94fe\u5f0f\u7ea7\u8054\u7b49\u4e0d\u540c\u573a\u666f\u7684\u590d\u5236\u3002\u5728\u590d\u5236\u8fc7\u7a0b\u4e2d\uff0c\u4e00\u53f0\u670d\u52a1\u5668\u5145\u5f53\u4e3b\u670d\u52a1\u5668(Master)\uff0c\u800c\u4e00\u4e2a\u6216\u591a\u4e2a\u5176\u4ed6\u7684\u670d\u52a1\u5668\u5145\u5f53\u4ece\u670d\u52a1\u5668(Slave)\u3002 \u590d\u5236\u53ef\u4ee5\u662f\u5355\u5411\u7684M\u2192S\uff0c\u4e5f\u53ef\u4ee5\u662fM\u2190\u2192M\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u591aM\u73af\u72b6\u540c\u6b65\u7b49\u3002 \u5982\u679c\u8bbe\u7f6e\u4e86\u94fe\u5f0f\u7ea7\u8054\u590d\u5236\uff0c\u90a3\u4e48\u4ece(Slave)\u670d\u52a1\u5668\u672c\u8eab\u9664\u4e86\u5145\u5f53\u4ece\u670d\u52a1\u5668\u5916\uff0c\u4e5f\u4f1a\u540c\u65f6\u5145\u5f53\u5176\u4e0b\u9762\u4ece\u670d\u52a1\u5668\u7684\u4e3b\u670d\u52a1\u5668\u3002\u94fe\u5f0f\u7ea7\u8054\u590d\u5236\u7c7b\u4f3cA\u2192B\u2192C\u2192D\u7684\u590d\u5236\u5f62\u5f0f\u3002 \u5728\u5f53\u524d\u7684\u751f\u4ea7\u5de5\u4f5c\u4e2d\uff0cMySQL\u4e3b\u4ece\u590d\u5236\u90fd\u662f\u5f02\u6b65\u7684\u590d\u5236\u65b9\u5f0f\uff0c\u5373\u4e0d\u662f\u4e25\u683c\u5b9e\u65f6\u7684\u6570\u636e\u540c\u6b65\u3002","title":"2. MySQL\u4e3b\u4ece\u590d\u5236\u4ecb\u7ecd"},{"location":"mysql/mysql.master-slave/#3-mysql","text":"MySQL\u7684\u4e3b\u4ece\u590d\u5236\u662f\u4e00\u4e2a\u5f02\u6b65\u7684\u590d\u5236\u8fc7\u7a0b\uff0c\u6570\u636e\u5c06\u4ece\u4e00\u4e2aMySQL\u6570\u636e\u5e93\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u6570\u636e\u5e93\uff0c\u5728\u4e3b\u6570\u636e\u5e93\u4e0e\u4ece\u6570\u636e\u5e93\u4e4b\u95f4\u5b9e\u73b0\u6574\u4e2a\u4e3b\u4ece\u590d\u5236\u7684\u8fc7\u7a0b\u662f\u7531\u4e09\u4e2a\u7ebf\u7a0b\u53c2\u4e0e\u5b8c\u6210\u7684\u3002\u5176\u4e2d\u6709\u4e24\u4e2a\u7ebf\u7a0b(SQL\u7ebf\u7a0b\u3001IO\u7ebf\u7a0b)\u5728\u4ece\u6570\u636e\u5e93\u7aef\uff0c\u53e6\u5916\u4e00\u4e2aIO\u7ebf\u7a0b\u5728\u4e3b\u6570\u636e\u5e93\u7aef\u3002 \u8981\u5b9e\u73b0MySQL\u7684\u4e3b\u4ece\u590d\u5236\uff0c\u9996\u5148\u5fc5\u987b\u6253\u5f00Master\u7aef\u7684binlog\u8bb0\u5f55\u529f\u80fd\uff0c\u5426\u5219\u5c31\u65e0\u6cd5\u5b9e\u73b0\u3002\u56e0\u4e3a\u6574\u4e2a\u590d\u5236\u8fc7\u7a0b\u5b9e\u9645\u4e0a\u5c31\u662fSlave\u4eceMaster\u7aef\u83b7\u53d6binlog\u65e5\u5fd7\uff0c\u7136\u540e\u518d\u5728Slave\u7aef\u4e0a\u4f9d\u76f8\u540c\u987a\u5e8f\u6267\u884c\u83b7\u53d6\u7684binlog\u65e5\u5fd7\u4e2d\u6240\u8bb0\u5f55\u7684\u5404\u79cdSQL\u64cd\u4f5c\u3002\u8be6\u7ec6\u6d41\u7a0b\u8bf7\u53c2\u9605\u5982\u4e0b\u56fe\u7247\u6587\u6863\u3002","title":"3. MySQL\u4e3b\u4ece\u590d\u5236\u7684\u539f\u7406"},{"location":"mysql/mysql.master-slave/#4","text":"","title":"4. \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.master-slave/#41","text":"IP\u5730\u5740 \u89d2\u8272 mysql\u7248\u672c\u53f7 \u7cfb\u7edf \u4e3b\u673a\u540d 192.168.5.110 mysql master 5.7 ubuntu16 leco 192.168.2.148 mysql slave 5.7 ubuntu16 manage01","title":"4.1 \u73af\u5883"},{"location":"mysql/mysql.master-slave/#42","text":"","title":"4.2 \u914d\u7f6e\u51c6\u5907"},{"location":"mysql/mysql.master-slave/#421-master","text":"\u5f00\u542f\u4e8c\u8fdb\u5236\u65e5\u5fd7 \u914d\u7f6e\u552f\u4e00\u7684server-id \u83b7\u5f97master\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u540d\u53ca\u4f4d\u7f6e \u521b\u5efa\u4e00\u4e2a\u7528\u4e8eslave\u548cmaster\u901a\u4fe1\u7684\u7528\u6237\u8d26\u53f7","title":"4.2.1 master\u51c6\u5907"},{"location":"mysql/mysql.master-slave/#422-slave","text":"\u914d\u7f6e\u552f\u4e00\u7684server-id \u4f7f\u7528master\u5206\u914d\u7684\u7528\u6237\u8d26\u53f7\u8bfb\u53d6master\u4e8c\u8fdb\u5236\u65e5\u5fd7 \u542f\u7528slave\u670d\u52a1","title":"4.2.2 slave\u51c6\u5907"},{"location":"mysql/mysql.master-slave/#5-master","text":"","title":"5. master \u64cd\u4f5c"},{"location":"mysql/mysql.master-slave/#51-master","text":"\u627e\u5230\u4e3b\u6570\u636e\u5e93\u7684\u914d\u7f6e\u6587\u4ef6my.cnf(\u6216\u8005my.ini)\uff0c\u6211\u7684\u5728/etc/mysql/my.cnf,\u5728[mysqld]\u90e8\u5206\u63d2\u5165\u5982\u4e0b\u4e24\u884c\uff1a root@leco:/etc/mysql/mysql.conf.d# ls mysqld.cnf mysqld.cnf root@leco:/etc/mysql/mysql.conf.d# egrep -irn 'log_bin|server-id' mysqld.cnf 83:server-id = 1 84:log_bin = /var/log/mysql/mysql-bin.log \u914d\u7f6e\u5b8c\u6bd5\u540e\uff0c\u91cd\u542fmysql root@leco:/etc/mysql/mysql.conf.d# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service.","title":"5.1 \u4fee\u6539master\u914d\u7f6e\u6587\u4ef6"},{"location":"mysql/mysql.master-slave/#52","text":"\u521b\u5efa\u7528\u6237\u5e76\u6388\u6743\uff1a\u7528\u6237\uff1arepl\uff0c\u5bc6\u7801\uff1arepl grant all privileges on *.* to repl@'%' identified by 'repl'; \u64cd\u4f5c\u8fc7\u7a0b mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 5 rows in set (0.00 sec) mysql> grant replication slave on *.* to 'repl'@'%' identified by 'repl'; Query OK, 0 rows affected, 1 warning (0.01 sec) mysql> flush privileges; Query OK, 0 rows affected (0.01 sec) mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 6 rows in set (0.00 sec)","title":"5.2 \u6388\u6743\u540c\u6b65\u8d26\u53f7"},{"location":"mysql/mysql.master-slave/#53","text":"# \u67e5\u770bmaster\u72b6\u6001\uff0c\u8bb0\u5f55\u4e8c\u8fdb\u5236\u6587\u4ef6\u540d(mysql-bin.000003)\u548c\u4f4d\u7f6e(73)\uff1a mysql> show master status; +------------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +------------------+----------+--------------+------------------+-------------------+ | mysql-bin.000001 | 1571 | | | | +------------------+----------+--------------+------------------+-------------------+ 1 row in set (0.00 sec) \u6ce8\u610f \u6ce8\u610f\u8fd9\u4e2a\u6587\u4ef6 mysql - bin . 000001 \u548c\u70b9 1571","title":"5.3 \u8bb0\u5f55\u72b6\u6001"},{"location":"mysql/mysql.master-slave/#6-slave","text":"","title":"6. slave \u64cd\u4f5c"},{"location":"mysql/mysql.master-slave/#61-master","text":"\u627e\u5230\u4e3b\u6570\u636e\u5e93\u7684\u914d\u7f6e\u6587\u4ef6my.cnf(\u6216\u8005my.ini)\uff0c\u4fee\u6539server-id\u3002 root@manage01:/etc/mysql/mysql.conf.d# grep 'server-id' mysqld.cnf server-id = 2 \u6ce8\u610f 1. \u4e3b\u4ece\u7684 server - id\u4e00\u5b9a\u8981\u4e0d\u4e00\u6837 \uff0c\u4e00\u822c\u914d\u7f6e\u6210 ip\u5730\u5740\u6700\u540e\u4e00\u4f4d \u3002 2. \u672c\u6587\u6211\u4e3a\u4e86\u7701\u4e8b\uff0c\u76f4\u63a5\u4fee\u6539\u4e3a master\u4e3a1 \uff0c slave2 \u3002 \u91cd\u542f\u4ece\u7684mysql\u3002 root@manage01:~# /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service.","title":"6.1 \u4fee\u6539master\u914d\u7f6e\u6587\u4ef6"},{"location":"mysql/mysql.master-slave/#62","text":"","title":"6.2 \u94fe\u63a5"},{"location":"mysql/mysql.master-slave/#621","text":"stop slave; grant all privileges on *.* to repl@'%' identified by 'repl'; change master to master_host='192.168.5.110',\\ master_port=3306,\\ master_user='repl',\\ master_password='repl',\\ master_log_file='mysql-bin.000001',\\ master_log_pos=1571; start slave; show slave status\\G; \u64cd\u4f5c\u8fc7\u7a0b mysql> stop slave; Query OK, 0 rows affected, 1 warning (0,00 sec) mysql> change master to master_host='192.168.5.110',\\ -> master_port=3306,\\ -> master_user='repl',\\ -> master_password='repl',\\ -> master_log_file='mysql-bin.000001',\\ -> master_log_pos=1571; Query OK, 0 rows affected, 2 warnings (0.09 sec) mysql> start slave; Query OK, 0 rows affected (0.00 sec)","title":"6.2.1 \u5feb\u901f\u547d\u4ee4"},{"location":"mysql/mysql.master-slave/#622","text":"\u5728\u4ece\u4e0a\u67e5\u770bmysql\u72b6\u6001 mysql> show slave status\\G; *************************** 1. row *************************** Slave_IO_State: Waiting for master to send event Master_Host: 192.168.5.110 Master_User: repl Master_Port: 3306 Connect_Retry: 60 Master_Log_File: mysql-bin.000001 Read_Master_Log_Pos: 1571 Relay_Log_File: manage01-relay-bin.000002 Relay_Log_Pos: 320 Relay_Master_Log_File: mysql-bin.000001 Slave_IO_Running: Yes Slave_SQL_Running: Yes Replicate_Do_DB: Replicate_Ignore_DB: Replicate_Do_Table: Replicate_Ignore_Table: Replicate_Wild_Do_Table: Replicate_Wild_Ignore_Table: Last_Errno: 0 Last_Error: Skip_Counter: 0 Exec_Master_Log_Pos: 1571 Relay_Log_Space: 530 Until_Condition: None Until_Log_File: Until_Log_Pos: 0 Master_SSL_Allowed: No Master_SSL_CA_File: Master_SSL_CA_Path: Master_SSL_Cert: Master_SSL_Cipher: Master_SSL_Key: Seconds_Behind_Master: 0 Master_SSL_Verify_Server_Cert: No Last_IO_Errno: 0 Last_IO_Error: Last_SQL_Errno: 0 Last_SQL_Error: Replicate_Ignore_Server_Ids: Master_Server_Id: 1 Master_UUID: 806dc48e-07eb-11e9-89c3-7427eab0aa2c Master_Info_File: /var/lib/mysql/master.info SQL_Delay: 0 SQL_Remaining_Delay: NULL Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates Master_Retry_Count: 86400 Master_Bind: Last_IO_Error_Timestamp: Last_SQL_Error_Timestamp: Master_SSL_Crl: Master_SSL_Crlpath: Retrieved_Gtid_Set: Executed_Gtid_Set: Auto_Position: 0 Replicate_Rewrite_DB: Channel_Name: Master_TLS_Version: 1 row in set (0,00 sec) ERROR: No query specified \u4ee5\u4e0a\u770b\u5230\u4e24\u4e2ayes\u4e00\u822c\u90fd\u662f\u4e3b\u4eceOK\u3002 \u5f53Slave_IO_Running\u548cSlave_SQL_Running\u90fd\u4e3aYES\u7684\u65f6\u5019\u5c31\u8868\u793a\u4e3b\u4ece\u540c\u6b65\u8bbe\u7f6e\u6210\u529f\u4e86\u3002\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u8fdb\u884c\u4e00\u4e9b\u9a8c\u8bc1\u4e86\uff0c\u6bd4\u5982\u5728\u4e3bmaster\u6570\u636e\u5e93\u7684test\u6570\u636e\u5e93\u7684\u4e00\u5f20\u8868\u4e2d\u63d2\u5165\u4e00\u6761\u6570\u636e\uff0c\u5728slave\u7684test\u5e93\u7684\u76f8\u540c\u6570\u636e\u8868\u4e2d\u67e5\u770b\u662f\u5426\u6709\u65b0\u589e\u7684\u6570\u636e\u5373\u53ef\u9a8c\u8bc1\u4e3b\u4ece\u590d\u5236\u529f\u80fd\u662f\u5426\u6709\u6548\uff0c\u8fd8\u53ef\u4ee5\u5173\u95edslave\uff08mysql>stop slave;\uff09,\u7136\u540e\u518d\u4fee\u6539master\uff0c\u770bslave\u662f\u5426\u4e5f\u76f8\u5e94\u4fee\u6539\uff08\u505c\u6b62slave\u540e\uff0cmaster\u7684\u4fee\u6539\u4e0d\u4f1a\u540c\u6b65\u5230slave\uff09\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u4e3b\u4ece\u590d\u5236\u529f\u80fd\u7684\u9a8c\u8bc1\u4e86\u3002 \u8fd8\u53ef\u4ee5\u7528\u5230\u7684\u5176\u4ed6\u76f8\u5173\u53c2\u6570\uff1amaster\u5f00\u542f\u4e8c\u8fdb\u5236\u65e5\u5fd7\u540e\u9ed8\u8ba4\u8bb0\u5f55\u6240\u6709\u5e93\u6240\u6709\u8868\u7684\u64cd\u4f5c\uff0c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6765\u6307\u5b9a\u53ea\u8bb0\u5f55\u6307\u5b9a\u7684\u6570\u636e\u5e93\u751a\u81f3\u6307\u5b9a\u7684\u8868\u7684\u64cd\u4f5c\uff0c\u5177\u4f53\u5728mysql\u914d\u7f6e\u6587\u4ef6\u7684[mysqld]\u53ef\u6dfb\u52a0\u4fee\u6539\u5982\u4e0b\u9009\u9879\uff1a # \u4e0d\u540c\u6b65\u54ea\u4e9b\u6570\u636e\u5e93 binlog-ignore-db = mysql binlog-ignore-db = test binlog-ignore-db = information_schema # \u53ea\u540c\u6b65\u54ea\u4e9b\u6570\u636e\u5e93\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u5176\u4ed6\u4e0d\u540c\u6b65 binlog-do-db = game","title":"6.2.2 \u67e5\u770b\u72b6\u6001"},{"location":"mysql/mysql.master-slave/#7","text":"","title":"7. \u6d4b\u8bd5"},{"location":"mysql/mysql.master-slave/#71","text":"\u5728\u4e3bmysql\u4e0a\u6dfb\u52a0\u4e00\u4e9b\u6570\u636e create database summer; use summer; drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into info(name,age,score) values('aa',30,66); insert into info(name,age,score) values('bb',30,66); insert into info(name,age,score) values('cc',30,66); \u64cd\u4f5c\u8fc7\u7a0b mysql> create database summer; Query OK, 1 row affected (0.01 sec) mysql> use summer; Database changed mysql> drop table info; ERROR 1051 (42S02): Unknown table 'summer.info' mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.07 sec) mysql> insert into info(name,age,score) values('aa',30,66); Query OK, 1 row affected (0.01 sec) mysql> insert into info(name,age,score) values('bb',30,66); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values('cc',30,66); Query OK, 1 row affected (0.01 sec)","title":"7.1 \u4e3b\u52a0\u6570\u636e"},{"location":"mysql/mysql.master-slave/#72","text":"\u767b\u5f55\u4ece\u67e5\u770b mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +------------------+ | Tables_in_summer | +------------------+ | info | +------------------+ 1 row in set (0,00 sec) mysql> select * from info; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | aa | 30 | 66 | | 2 | bb | 30 | 66 | | 3 | cc | 30 | 66 | +----+------+-----+-------+ 3 rows in set (0,00 sec) \u4ece\u7ed3\u679c\u6765\u770b\uff0c\u4ece\u5df2\u7ecf\u540c\u6b65\u4e86\u4e3b\u7684\u6570\u636e\uff0cdo well done\uff01","title":"7.2 \u4ece\u68c0\u67e5"},{"location":"mysql/mysql.master-slave/#8","text":"\u5728\u505a\u4e3b\u4ece\u540c\u6b65\u7684\u65f6\u5019\uff0c\u6211\u7701\u7565\u4e86\u4e00\u70b9\uff0c\u8981\u5148\u628a\u4e3b\u4e0a\u7684\u6570\u636e\u5e93\u540c\u6b65\u5230\u4ece\u4e0a\u3002","title":"8. \u9057\u6f0f"},{"location":"mysql/mysql.multi_table_query/","text":"MySQL \u5bf9\u8868\u67e5\u8be2 1. \u4ecb\u7ecd \u00b6 MySQL\uff0c\u91cd\u4e2d\u4e4b\u91cd\u6765\u4e86\u3002 \u591a\u8868\u8fde\u63a5\u67e5\u8be2 \u590d\u5408\u6761\u4ef6\u8fde\u63a5\u67e5\u8be2 \u5b50\u67e5\u8be2 select * from employee inner join department on employee.dep_id=department.id; select * from employee left join department on employee.dep_id=department.id; select * from employee right join department on employee.dep_id=department.id; 1.1 \u73af\u5883\u51c6\u5907 \u00b6 use db1; create table department( id int, name varchar(20) ); create table employee( id int primary key auto_increment, name varchar(20), sex enum('male','female') not null default 'male', age int, dep_id int ); insert into department values (200,'\u6280\u672f'), (201,'\u4eba\u529b\u8d44\u6e90'), (202,'\u9500\u552e'), (203,'\u8fd0\u8425'); insert into employee(name,sex,age,dep_id) values ('\u9648\u88d5\u5149','male',18,200), ('\u4e50\u73c8\u5f64','female',48,201), ('\u6731\u6167\u73ca','male',38,201), ('\u79d1\u7433\u00b7\u739b\u4e3d\u8bfa','female',28,202), ('\u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14','male',18,200), ('\u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179','female',18,204); show tables; desc department; desc employee; select * from department; select * from employee; \u6267\u884c\u8fc7\u7a0b leco@leco:~$ mysql -uroot -proot mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 125 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use db1; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | t1 | +---------------+ 1 row in set (0.00 sec) mysql> use db1; Database changed mysql> create table department( -> id int, -> name varchar(20) -> ); artment values (200,'\u6280\u672f'), (201,'\u4eba\u529b\u8d44\u6e90'), (202,'\u9500\u552e'), (203,'\u8fd0\u8425'); insert into employee(name,sex,age,dep_id) values ('\u9648\u88d5\u5149','male',18,200), ('\u4e50\u73c8\u5f64','female',48,201), ('\u6731\u6167\u73ca','male',38,201), ('\u79d1\u7433\u00b7\u739b\u4e3d\u8bfa','female',28,202), ('\u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14','male',18,200), ('\u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179','female',18,204);Query OK, 0 rows affected (0.08 sec) mysql> create table employee( -> id int primary key auto_increment, -> name varchar(20), -> sex enum('male','female') not null default 'male', -> age int, -> dep_id int -> ); Query OK, 0 rows affected (0.07 sec) mysql> insert into department values -> (200,'\u6280\u672f'), -> (201,'\u4eba\u529b\u8d44\u6e90'), -> (202,'\u9500\u552e'), -> (203,'\u8fd0\u8425'); Query OK, 4 rows affected (0.02 sec) Records: 4 Duplicates: 0 Warnings: 0 mysql> mysql> insert into employee(name,sex,age,dep_id) values -> ('\u9648\u88d5\u5149','male',18,200), -> ('\u4e50\u73c8\u5f64','female',48,201), -> ('\u6731\u6167\u73ca','male',38,201), -> ('\u79d1\u7433\u00b7\u739b\u4e3d\u8bfa','female',28,202), -> ('\u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14','male',18,200), -> ('\u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179','female',18,204); Query OK, 6 rows affected (0.01 sec) Records: 6 Duplicates: 0 Warnings: 0 mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | department | | employee | | t1 | +---------------+ 3 rows in set (0.00 sec) mysql> desc department; +-------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(20) | YES | | NULL | | +-------+-------------+------+-----+---------+-------+ 2 rows in set (0.00 sec) mysql> desc employee; +--------+-----------------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +--------+-----------------------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | varchar(20) | YES | | NULL | | | sex | enum('male','female') | NO | | male | | | age | int(11) | YES | | NULL | | | dep_id | int(11) | YES | | NULL | | +--------+-----------------------+------+-----+---------+----------------+ 5 rows in set (0.00 sec) mysql> select * from department; +------+--------------+ | id | name | +------+--------------+ | 200 | \u6280\u672f | | 201 | \u4eba\u529b\u8d44\u6e90 | | 202 | \u9500\u552e | | 203 | \u8fd0\u8425 | +------+--------------+ 4 rows in set (0.00 sec) mysql> select * from employee; +----+-------------------+--------+------+--------+ | id | name | sex | age | dep_id | +----+-------------------+--------+------+--------+ | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | +----+-------------------+--------+------+--------+ 6 rows in set (0.00 sec) 2. \u591a\u8868\u8fde\u63a5\u67e5\u8be2 \u00b6 # \u91cd\u70b9\uff1a\u5916\u94fe\u63a5\u8bed\u6cd5 SELECT \u5b57\u6bb5\u5217\u8868 FROM \u88681 INNER|LEFT|RIGHT JOIN \u88682 ON \u88681.\u5b57\u6bb5 = \u88682.\u5b57\u6bb5; 2.1 \u4ea4\u53c9\u8fde\u63a5 \u00b6 \u4e0d\u9002\u7528\u4efb\u4f55\u5339\u914d\u6761\u4ef6\u3002\u751f\u6210\u7b1b\u5361\u5c14\u79ef mysql> select * from employee,department; +----+-------------------+--------+------+--------+------+--------------+ | id | name | sex | age | dep_id | id | name | +----+-------------------+--------+------+--------+------+--------------+ | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 200 | \u6280\u672f | | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 201 | \u4eba\u529b\u8d44\u6e90 | | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 202 | \u9500\u552e | | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 203 | \u8fd0\u8425 | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 200 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 202 | \u9500\u552e | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 203 | \u8fd0\u8425 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 200 | \u6280\u672f | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 202 | \u9500\u552e | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 203 | \u8fd0\u8425 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 200 | \u6280\u672f | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 201 | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 202 | \u9500\u552e | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 203 | \u8fd0\u8425 | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 200 | \u6280\u672f | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 201 | \u4eba\u529b\u8d44\u6e90 | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 202 | \u9500\u552e | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 203 | \u8fd0\u8425 | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | 200 | \u6280\u672f | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | 201 | \u4eba\u529b\u8d44\u6e90 | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | 202 | \u9500\u552e | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | 203 | \u8fd0\u8425 | +----+-------------------+--------+------+--------+------+--------------+ 24 rows in set (0.00 sec) 2.2 \u5185\u8fde\u63a5 \u00b6 \u53ea\u8fde\u63a5\u5339\u914d\u7684\u884c\u3002 \u627e\u4e24\u5f20\u8868\u5171\u6709\u7684\u90e8\u5206\uff0c\u76f8\u5f53\u4e8e\u5229\u7528\u6761\u4ef6\u4ece\u7b1b\u5361\u5c14\u79ef\u7ed3\u679c\u4e2d\u7b5b\u9009\u51fa\u4e86\u6b63\u786e\u7684\u7ed3\u679c department\u6ca1\u6709204\u8fd9\u4e2a\u90e8\u95e8\uff0c\u56e0\u800cemployee\u8868\u4e2d\u5173\u4e8e204\u8fd9\u6761\u5458\u5de5\u4fe1\u606f\u6ca1\u6709\u5339\u914d\u51fa\u6765 select employee.id,employee.name,employee.age,employee.sex,department.name from employee inner join department on employee.dep_id=department.id; \u6216\u8005 select * from employee inner join department on employee.dep_id=department.id; mysql> select employee.id,employee.name,employee.age,employee.sex,department.name from employee inner join department on employee.dep_id=department.id; +----+-------------------+------+--------+--------------+ | id | name | age | sex | name | +----+-------------------+------+--------+--------------+ | 1 | \u9648\u88d5\u5149 | 18 | male | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | 48 | female | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | 38 | male | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | 28 | female | \u9500\u552e | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | 18 | male | \u6280\u672f | +----+-------------------+------+--------+--------------+ 5 rows in set (0.00 sec) mysql> select * from employee inner join department on employee.dep_id=department.id; +----+-------------------+--------+------+--------+------+--------------+ | id | name | sex | age | dep_id | id | name | +----+-------------------+--------+------+--------+------+--------------+ | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 200 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 202 | \u9500\u552e | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 200 | \u6280\u672f | +----+-------------------+--------+------+--------+------+--------------+ 5 rows in set (0.00 sec) 2.3 \u5de6\u8fde\u63a5 \u00b6 \u4f18\u5148\u663e\u793a\u5de6\u8868\u5168\u90e8\u8bb0\u5f55 \u4ee5\u5de6\u8868\u4e3a\u51c6\uff0c\u5373\u627e\u51fa\u6240\u6709\u5458\u5de5\u4fe1\u606f\uff0c\u5f53\u7136\u5305\u62ec\u6ca1\u6709\u90e8\u95e8\u7684\u5458\u5de5 \u672c\u8d28\u5c31\u662f\uff1a\u5728\u5185\u8fde\u63a5\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u5de6\u8fb9\u6709\u53f3\u8fb9\u6ca1\u6709\u7684\u7ed3\u679c mysql> select employee.id,employee.name,department.name as depart_name from employee left join department on employee.dep_id=department.id; +----+-------------------+--------------+ | id | name | depart_name | +----+-------------------+--------------+ | 1 | \u9648\u88d5\u5149 | \u6280\u672f | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | \u9500\u552e | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | NULL | +----+-------------------+--------------+ 6 rows in set (0.00 sec) 2.4 \u53f3\u8fde\u63a5 \u00b6 \u4f18\u5148\u663e\u793a\u53f3\u8868\u5168\u90e8\u8bb0\u5f55 \u4ee5\u53f3\u8868\u4e3a\u51c6\uff0c\u5373\u627e\u51fa\u6240\u6709\u90e8\u95e8\u4fe1\u606f\uff0c\u5305\u62ec\u6ca1\u6709\u5458\u5de5\u7684\u90e8\u95e8 \u672c\u8d28\u5c31\u662f\uff1a\u5728\u5185\u8fde\u63a5\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u53f3\u8fb9\u6709\u5de6\u8fb9\u6ca1\u6709\u7684\u7ed3\u679c mysql> select employee.id,employee.name,department.name as depart_name from employee right join department onemployee.dep_id=department.id; +------+-------------------+--------------+ | id | name | depart_name | +------+-------------------+--------------+ | 1 | \u9648\u88d5\u5149 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | \u9500\u552e | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | \u6280\u672f | | NULL | NULL | \u8fd0\u8425 | +------+-------------------+--------------+ 6 rows in set (0.00 sec) 2.4 \u5168\u5916\u8fde\u63a5 \u00b6 \u663e\u793a\u5de6\u53f3\u4e24\u4e2a\u8868\u5168\u90e8\u8bb0\u5f55 \u5168\u5916\u8fde\u63a5\uff1a\u5728\u5185\u8fde\u63a5\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u5de6\u8fb9\u6709\u53f3\u8fb9\u6ca1\u6709\u7684\u548c\u53f3\u8fb9\u6709\u5de6\u8fb9\u6ca1\u6709\u7684\u7ed3\u679c \u6ce8\u610f\uff1amysql\u4e0d\u652f\u6301\u5168\u5916\u8fde\u63a5 full JOIN \u5f3a\u8c03\uff1amysql\u53ef\u4ee5\u4f7f\u7528\u6b64\u79cd\u65b9\u5f0f\u95f4\u63a5\u5b9e\u73b0\u5168\u5916\u8fde\u63a5 mysql> select * from employee left join department on employee.dep_id = department.id -> union -> select * from employee right join department on employee.dep_id = department.id -> ; +------+-------------------+--------+------+--------+------+--------------+ | id | name | sex | age | dep_id | id | name | +------+-------------------+--------+------+--------+------+--------------+ | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 200 | \u6280\u672f | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 200 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 202 | \u9500\u552e | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | NULL | NULL | | NULL | NULL | NULL | NULL | NULL | 203 | \u8fd0\u8425 | +------+-------------------+--------+------+--------+------+--------------+ 7 rows in set (0.00 sec) 2.5 \u7b26\u5408\u6761\u4ef6\u8fde\u63a5\u67e5\u8be2 \u00b6 \u4ee5\u5185\u8fde\u63a5\u7684\u65b9\u5f0f\u67e5\u8be2employee\u548cdepartment\u8868\uff0c\u5e76\u4e14employee\u8868\u4e2d\u7684age\u5b57\u6bb5\u503c\u5fc5\u987b\u5927\u4e8e25,\u5373\u627e\u51fa\u5e74\u9f84\u5927\u4e8e25\u5c81\u7684\u5458\u5de5\u4ee5\u53ca\u5458\u5de5\u6240\u5728\u7684\u90e8\u95e8 mysql> select employee.name,department.name from employee inner join department -> on employee.dep_id = department.id -> where age > 25; +-------------------+--------------+ | name | name | +-------------------+--------------+ | \u4e50\u73c8\u5f64 | \u4eba\u529b\u8d44\u6e90 | | \u6731\u6167\u73ca | \u4eba\u529b\u8d44\u6e90 | | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | \u9500\u552e | +-------------------+--------------+ 3 rows in set (0.00 sec) \u4ee5\u5185\u8fde\u63a5\u7684\u65b9\u5f0f\u67e5\u8be2employee\u548cdepartment\u8868\uff0c\u5e76\u4e14\u4ee5age\u5b57\u6bb5\u7684\u5347\u5e8f\u65b9\u5f0f\u663e\u793a mysql> select employee.id,employee.name,employee.age,department.name from employee,department -> where employee.dep_id = department.id -> and age > 25 -> order by age asc; +----+-------------------+------+--------------+ | id | name | age | name | +----+-------------------+------+--------------+ | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | 28 | \u9500\u552e | | 5 | \u6731\u6167\u73ca | 38 | \u4eba\u529b\u8d44\u6e90 | | 3 | \u4e50\u73c8\u5f64 | 48 | \u4eba\u529b\u8d44\u6e90 | +----+-------------------+------+--------------+ 3 rows in set (0.00 sec) 3. \u5b50\u67e5\u8be2 \u00b6 \u5b50\u67e5\u8be2\u662f\u5c06\u4e00\u4e2a\u67e5\u8be2\u8bed\u53e5\u5d4c\u5957\u5728\u53e6\u4e00\u4e2a\u67e5\u8be2\u8bed\u53e5\u4e2d\u3002 \u5185\u5c42\u67e5\u8be2\u8bed\u53e5\u7684\u67e5\u8be2\u7ed3\u679c\uff0c\u53ef\u4ee5\u4e3a\u5916\u5c42\u67e5\u8be2\u8bed\u53e5\u63d0\u4f9b\u67e5\u8be2\u6761\u4ef6\u3002 \u5b50\u67e5\u8be2\u4e2d\u53ef\u4ee5\u5305\u542b\uff1aIN\u3001NOT IN\u3001ANY\u3001ALL\u3001EXISTS \u548c NOT EXISTS\u7b49\u5173\u952e\u5b57 \u8fd8\u53ef\u4ee5\u5305\u542b\u6bd4\u8f83\u8fd0\u7b97\u7b26\uff1a= \u3001 !=\u3001> \u3001<\u7b49 3.1 IN \u00b6 \u5e26IN\u5173\u952e\u5b57\u7684\u5b50\u67e5\u8be2 \u67e5\u8be2\u5e73\u5747\u5e74\u9f84\u572825\u5c81\u4ee5\u4e0a\u7684\u90e8\u95e8\u540d select id,name from department where id in (select dep_id from employee group by dep_id having avg(age) > 25); mysql> select id,name from department -> where id in -> (select dep_id from employee group by dep_id having avg(age) > 25); +------+--------------+ | id | name | +------+--------------+ | 201 | \u4eba\u529b\u8d44\u6e90 | | 202 | \u9500\u552e | +------+--------------+ 2 rows in set (0.00 sec) \u67e5\u770b\u6280\u672f\u90e8\u5458\u5de5\u59d3\u540d select name from employee where dep_id in (select id from department where name='\u6280\u672f'); mysql> select name from employee -> where dep_id in -> (select id from department where name='\u6280\u672f'); +-------------------+ | name | +-------------------+ | \u9648\u88d5\u5149 | | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | +-------------------+ 2 rows in set (0.00 sec) \u67e5\u770b\u4e0d\u8db31\u4eba\u7684\u90e8\u95e8\u540d select name from department where id in (select dep_id from employee group by dep_id having count(id) <=1); mysql> select name from department -> where id in -> (select dep_id from employee group by dep_id having count(id) <=1); +--------+ | name | +--------+ | \u9500\u552e | +--------+ 1 row in set (0.00 sec) 3.2 \u6bd4\u8f83\u8fd0\u7b97\u7b26 \u00b6 \u5e26\u6bd4\u8f83\u8fd0\u7b97\u7b26\u7684\u5b50\u67e5\u8be2\uff0c\u6bd4\u8f83\u8fd0\u7b97\u7b26\uff1a=\u3001!=\u3001>\u3001>=\u3001<\u3001<=\u3001<> \u67e5\u8be2\u5927\u4e8e\u6240\u6709\u4eba\u5e73\u5747\u5e74\u9f84\u7684\u5458\u5de5\u540d\u4e0e\u5e74\u9f84 mysql> select name,age from employee where age > (select avg(age) from employee); +-----------+------+ | name | age | +-----------+------+ | \u4e50\u73c8\u5f64 | 48 | | \u6731\u6167\u73ca | 38 | +-----------+------+ 2 rows in set (0.00 sec) \u67e5\u8be2\u5927\u4e8e\u90e8\u95e8\u5185\u5e73\u5747\u5e74\u9f84\u7684\u5458\u5de5\u540d\u3001\u5e74\u9f84 select t1.name,t1.age from emp t1 inner join (select dep_id,avg(age) avg_age from emp group by dep_id) t2 on t1.dep_id = t2.dep_id where t1.age > t2.avg_age; mysql> select t1.name,t1.age from employee t1 -> inner join -> (select dep_id,avg(age) avg_age from employee group by dep_id) t2 -> on t1.dep_id = t2.dep_id -> where t1.age > t2.avg_age; +-----------+------+ | name | age | +-----------+------+ | \u4e50\u73c8\u5f64 | 48 | +-----------+------+ 1 row in set (0.00 sec) 3.3 EXISTS \u00b6 \u5e26EXISTS\u5173\u952e\u5b57\u7684\u5b50\u67e5\u8be2\uff0cEXISTS\u5173\u5b57\u952e\u5b57\u8868\u793a\u5b58\u5728\u3002\u5728\u4f7f\u7528EXISTS\u5173\u952e\u5b57\u65f6\uff0c\u5185\u5c42\u67e5\u8be2\u8bed\u53e5\u4e0d\u8fd4\u56de\u67e5\u8be2\u7684\u8bb0\u5f55\u3002\u800c\u662f\u8fd4\u56de\u4e00\u4e2a\u771f\u5047\u503c\uff0cTrue\u6216False\u3002\u5f53\u8fd4\u56deTrue\u65f6\uff0c\u5916\u5c42\u67e5\u8be2\u8bed\u53e5\u5c06\u8fdb\u884c\u67e5\u8be2\uff1b\u5f53\u8fd4\u56de\u503c\u4e3aFalse\u65f6\uff0c\u5916\u5c42\u67e5\u8be2\u8bed\u53e5\u4e0d\u8fdb\u884c\u67e5\u8be2\u3002 department\u8868\u4e2d\u5b58\u5728dept_id=203\uff0cTure select * from employee where exists (select id from department where id=200); mysql> select * from employee -> where exists -> (select id from department where id=200); +----+-------------------+--------+------+--------+ | id | name | sex | age | dep_id | +----+-------------------+--------+------+--------+ | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | +----+-------------------+--------+------+--------+ 6 rows in set (0.00 sec) department\u8868\u4e2d\u5b58\u5728dept_id=205\uff0cFalse select * from employee where exists (select id from department where id=204); mysql> select * from employee -> where exists -> (select id from department where id=204); Empty set (0.00 sec) union union all UNION \u8bed\u53e5\uff1a\u7528\u4e8e\u5c06\u4e0d\u540c\u8868\u4e2d\u76f8\u540c\u5217\u4e2d\u67e5\u8be2\u7684\u6570\u636e\u5c55\u793a\u51fa\u6765 \uff08\u4e0d\u5305\u62ec\u91cd\u590d\u6570\u636e\uff09 UNION ALL \u8bed\u53e5\uff1a\u7528\u4e8e\u5c06\u4e0d\u540c\u8868\u4e2d\u76f8\u540c\u5217\u4e2d\u67e5\u8be2\u7684\u6570\u636e\u5c55\u793a\u51fa\u6765 \uff08\u5305\u62ec\u91cd\u590d\u6570\u636e\uff09 mysql> select * from employee left join department on employee.dep_id = department.id -> union -> select * from employee right join department on employee.dep_id = department.id -> ; +------+-------------------+--------+------+--------+------+--------------+ | id | name | sex | age | dep_id | id | name | +------+-------------------+--------+------+--------+------+--------------+ | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 200 | \u6280\u672f | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 200 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 202 | \u9500\u552e | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | NULL | NULL | | NULL | NULL | NULL | NULL | NULL | 203 | \u8fd0\u8425 | +------+-------------------+--------+------+--------+------+--------------+ 7 rows in set (0.00 sec) mysql> select * from employee left join department on employee.dep_id = department.id -> union all -> select * from employee right join department on employee.dep_id = department.id; +------+-------------------+--------+------+--------+------+--------------+ | id | name | sex | age | dep_id | id | name | +------+-------------------+--------+------+--------+------+--------------+ | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 200 | \u6280\u672f | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 200 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 202 | \u9500\u552e | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | NULL | NULL | | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 200 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 202 | \u9500\u552e | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 200 | \u6280\u672f | | NULL | NULL | NULL | NULL | NULL | 203 | \u8fd0\u8425 | +------+-------------------+--------+------+--------+------+--------------+ 12 rows in set (0.00 sec)","title":"6. \u591a\u8868\u67e5\u8be2"},{"location":"mysql/mysql.multi_table_query/#1","text":"MySQL\uff0c\u91cd\u4e2d\u4e4b\u91cd\u6765\u4e86\u3002 \u591a\u8868\u8fde\u63a5\u67e5\u8be2 \u590d\u5408\u6761\u4ef6\u8fde\u63a5\u67e5\u8be2 \u5b50\u67e5\u8be2 select * from employee inner join department on employee.dep_id=department.id; select * from employee left join department on employee.dep_id=department.id; select * from employee right join department on employee.dep_id=department.id;","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.multi_table_query/#11","text":"use db1; create table department( id int, name varchar(20) ); create table employee( id int primary key auto_increment, name varchar(20), sex enum('male','female') not null default 'male', age int, dep_id int ); insert into department values (200,'\u6280\u672f'), (201,'\u4eba\u529b\u8d44\u6e90'), (202,'\u9500\u552e'), (203,'\u8fd0\u8425'); insert into employee(name,sex,age,dep_id) values ('\u9648\u88d5\u5149','male',18,200), ('\u4e50\u73c8\u5f64','female',48,201), ('\u6731\u6167\u73ca','male',38,201), ('\u79d1\u7433\u00b7\u739b\u4e3d\u8bfa','female',28,202), ('\u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14','male',18,200), ('\u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179','female',18,204); show tables; desc department; desc employee; select * from department; select * from employee; \u6267\u884c\u8fc7\u7a0b leco@leco:~$ mysql -uroot -proot mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 125 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use db1; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | t1 | +---------------+ 1 row in set (0.00 sec) mysql> use db1; Database changed mysql> create table department( -> id int, -> name varchar(20) -> ); artment values (200,'\u6280\u672f'), (201,'\u4eba\u529b\u8d44\u6e90'), (202,'\u9500\u552e'), (203,'\u8fd0\u8425'); insert into employee(name,sex,age,dep_id) values ('\u9648\u88d5\u5149','male',18,200), ('\u4e50\u73c8\u5f64','female',48,201), ('\u6731\u6167\u73ca','male',38,201), ('\u79d1\u7433\u00b7\u739b\u4e3d\u8bfa','female',28,202), ('\u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14','male',18,200), ('\u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179','female',18,204);Query OK, 0 rows affected (0.08 sec) mysql> create table employee( -> id int primary key auto_increment, -> name varchar(20), -> sex enum('male','female') not null default 'male', -> age int, -> dep_id int -> ); Query OK, 0 rows affected (0.07 sec) mysql> insert into department values -> (200,'\u6280\u672f'), -> (201,'\u4eba\u529b\u8d44\u6e90'), -> (202,'\u9500\u552e'), -> (203,'\u8fd0\u8425'); Query OK, 4 rows affected (0.02 sec) Records: 4 Duplicates: 0 Warnings: 0 mysql> mysql> insert into employee(name,sex,age,dep_id) values -> ('\u9648\u88d5\u5149','male',18,200), -> ('\u4e50\u73c8\u5f64','female',48,201), -> ('\u6731\u6167\u73ca','male',38,201), -> ('\u79d1\u7433\u00b7\u739b\u4e3d\u8bfa','female',28,202), -> ('\u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14','male',18,200), -> ('\u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179','female',18,204); Query OK, 6 rows affected (0.01 sec) Records: 6 Duplicates: 0 Warnings: 0 mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | department | | employee | | t1 | +---------------+ 3 rows in set (0.00 sec) mysql> desc department; +-------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(20) | YES | | NULL | | +-------+-------------+------+-----+---------+-------+ 2 rows in set (0.00 sec) mysql> desc employee; +--------+-----------------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +--------+-----------------------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | varchar(20) | YES | | NULL | | | sex | enum('male','female') | NO | | male | | | age | int(11) | YES | | NULL | | | dep_id | int(11) | YES | | NULL | | +--------+-----------------------+------+-----+---------+----------------+ 5 rows in set (0.00 sec) mysql> select * from department; +------+--------------+ | id | name | +------+--------------+ | 200 | \u6280\u672f | | 201 | \u4eba\u529b\u8d44\u6e90 | | 202 | \u9500\u552e | | 203 | \u8fd0\u8425 | +------+--------------+ 4 rows in set (0.00 sec) mysql> select * from employee; +----+-------------------+--------+------+--------+ | id | name | sex | age | dep_id | +----+-------------------+--------+------+--------+ | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | +----+-------------------+--------+------+--------+ 6 rows in set (0.00 sec)","title":"1.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.multi_table_query/#2","text":"# \u91cd\u70b9\uff1a\u5916\u94fe\u63a5\u8bed\u6cd5 SELECT \u5b57\u6bb5\u5217\u8868 FROM \u88681 INNER|LEFT|RIGHT JOIN \u88682 ON \u88681.\u5b57\u6bb5 = \u88682.\u5b57\u6bb5;","title":"2. \u591a\u8868\u8fde\u63a5\u67e5\u8be2"},{"location":"mysql/mysql.multi_table_query/#21","text":"\u4e0d\u9002\u7528\u4efb\u4f55\u5339\u914d\u6761\u4ef6\u3002\u751f\u6210\u7b1b\u5361\u5c14\u79ef mysql> select * from employee,department; +----+-------------------+--------+------+--------+------+--------------+ | id | name | sex | age | dep_id | id | name | +----+-------------------+--------+------+--------+------+--------------+ | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 200 | \u6280\u672f | | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 201 | \u4eba\u529b\u8d44\u6e90 | | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 202 | \u9500\u552e | | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 203 | \u8fd0\u8425 | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 200 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 202 | \u9500\u552e | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 203 | \u8fd0\u8425 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 200 | \u6280\u672f | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 202 | \u9500\u552e | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 203 | \u8fd0\u8425 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 200 | \u6280\u672f | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 201 | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 202 | \u9500\u552e | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 203 | \u8fd0\u8425 | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 200 | \u6280\u672f | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 201 | \u4eba\u529b\u8d44\u6e90 | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 202 | \u9500\u552e | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 203 | \u8fd0\u8425 | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | 200 | \u6280\u672f | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | 201 | \u4eba\u529b\u8d44\u6e90 | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | 202 | \u9500\u552e | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | 203 | \u8fd0\u8425 | +----+-------------------+--------+------+--------+------+--------------+ 24 rows in set (0.00 sec)","title":"2.1 \u4ea4\u53c9\u8fde\u63a5"},{"location":"mysql/mysql.multi_table_query/#22","text":"\u53ea\u8fde\u63a5\u5339\u914d\u7684\u884c\u3002 \u627e\u4e24\u5f20\u8868\u5171\u6709\u7684\u90e8\u5206\uff0c\u76f8\u5f53\u4e8e\u5229\u7528\u6761\u4ef6\u4ece\u7b1b\u5361\u5c14\u79ef\u7ed3\u679c\u4e2d\u7b5b\u9009\u51fa\u4e86\u6b63\u786e\u7684\u7ed3\u679c department\u6ca1\u6709204\u8fd9\u4e2a\u90e8\u95e8\uff0c\u56e0\u800cemployee\u8868\u4e2d\u5173\u4e8e204\u8fd9\u6761\u5458\u5de5\u4fe1\u606f\u6ca1\u6709\u5339\u914d\u51fa\u6765 select employee.id,employee.name,employee.age,employee.sex,department.name from employee inner join department on employee.dep_id=department.id; \u6216\u8005 select * from employee inner join department on employee.dep_id=department.id; mysql> select employee.id,employee.name,employee.age,employee.sex,department.name from employee inner join department on employee.dep_id=department.id; +----+-------------------+------+--------+--------------+ | id | name | age | sex | name | +----+-------------------+------+--------+--------------+ | 1 | \u9648\u88d5\u5149 | 18 | male | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | 48 | female | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | 38 | male | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | 28 | female | \u9500\u552e | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | 18 | male | \u6280\u672f | +----+-------------------+------+--------+--------------+ 5 rows in set (0.00 sec) mysql> select * from employee inner join department on employee.dep_id=department.id; +----+-------------------+--------+------+--------+------+--------------+ | id | name | sex | age | dep_id | id | name | +----+-------------------+--------+------+--------+------+--------------+ | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 200 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 202 | \u9500\u552e | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 200 | \u6280\u672f | +----+-------------------+--------+------+--------+------+--------------+ 5 rows in set (0.00 sec)","title":"2.2 \u5185\u8fde\u63a5"},{"location":"mysql/mysql.multi_table_query/#23","text":"\u4f18\u5148\u663e\u793a\u5de6\u8868\u5168\u90e8\u8bb0\u5f55 \u4ee5\u5de6\u8868\u4e3a\u51c6\uff0c\u5373\u627e\u51fa\u6240\u6709\u5458\u5de5\u4fe1\u606f\uff0c\u5f53\u7136\u5305\u62ec\u6ca1\u6709\u90e8\u95e8\u7684\u5458\u5de5 \u672c\u8d28\u5c31\u662f\uff1a\u5728\u5185\u8fde\u63a5\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u5de6\u8fb9\u6709\u53f3\u8fb9\u6ca1\u6709\u7684\u7ed3\u679c mysql> select employee.id,employee.name,department.name as depart_name from employee left join department on employee.dep_id=department.id; +----+-------------------+--------------+ | id | name | depart_name | +----+-------------------+--------------+ | 1 | \u9648\u88d5\u5149 | \u6280\u672f | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | \u9500\u552e | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | NULL | +----+-------------------+--------------+ 6 rows in set (0.00 sec)","title":"2.3 \u5de6\u8fde\u63a5"},{"location":"mysql/mysql.multi_table_query/#24","text":"\u4f18\u5148\u663e\u793a\u53f3\u8868\u5168\u90e8\u8bb0\u5f55 \u4ee5\u53f3\u8868\u4e3a\u51c6\uff0c\u5373\u627e\u51fa\u6240\u6709\u90e8\u95e8\u4fe1\u606f\uff0c\u5305\u62ec\u6ca1\u6709\u5458\u5de5\u7684\u90e8\u95e8 \u672c\u8d28\u5c31\u662f\uff1a\u5728\u5185\u8fde\u63a5\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u53f3\u8fb9\u6709\u5de6\u8fb9\u6ca1\u6709\u7684\u7ed3\u679c mysql> select employee.id,employee.name,department.name as depart_name from employee right join department onemployee.dep_id=department.id; +------+-------------------+--------------+ | id | name | depart_name | +------+-------------------+--------------+ | 1 | \u9648\u88d5\u5149 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | \u9500\u552e | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | \u6280\u672f | | NULL | NULL | \u8fd0\u8425 | +------+-------------------+--------------+ 6 rows in set (0.00 sec)","title":"2.4 \u53f3\u8fde\u63a5"},{"location":"mysql/mysql.multi_table_query/#24_1","text":"\u663e\u793a\u5de6\u53f3\u4e24\u4e2a\u8868\u5168\u90e8\u8bb0\u5f55 \u5168\u5916\u8fde\u63a5\uff1a\u5728\u5185\u8fde\u63a5\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u5de6\u8fb9\u6709\u53f3\u8fb9\u6ca1\u6709\u7684\u548c\u53f3\u8fb9\u6709\u5de6\u8fb9\u6ca1\u6709\u7684\u7ed3\u679c \u6ce8\u610f\uff1amysql\u4e0d\u652f\u6301\u5168\u5916\u8fde\u63a5 full JOIN \u5f3a\u8c03\uff1amysql\u53ef\u4ee5\u4f7f\u7528\u6b64\u79cd\u65b9\u5f0f\u95f4\u63a5\u5b9e\u73b0\u5168\u5916\u8fde\u63a5 mysql> select * from employee left join department on employee.dep_id = department.id -> union -> select * from employee right join department on employee.dep_id = department.id -> ; +------+-------------------+--------+------+--------+------+--------------+ | id | name | sex | age | dep_id | id | name | +------+-------------------+--------+------+--------+------+--------------+ | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 200 | \u6280\u672f | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 200 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 202 | \u9500\u552e | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | NULL | NULL | | NULL | NULL | NULL | NULL | NULL | 203 | \u8fd0\u8425 | +------+-------------------+--------+------+--------+------+--------------+ 7 rows in set (0.00 sec)","title":"2.4 \u5168\u5916\u8fde\u63a5"},{"location":"mysql/mysql.multi_table_query/#25","text":"\u4ee5\u5185\u8fde\u63a5\u7684\u65b9\u5f0f\u67e5\u8be2employee\u548cdepartment\u8868\uff0c\u5e76\u4e14employee\u8868\u4e2d\u7684age\u5b57\u6bb5\u503c\u5fc5\u987b\u5927\u4e8e25,\u5373\u627e\u51fa\u5e74\u9f84\u5927\u4e8e25\u5c81\u7684\u5458\u5de5\u4ee5\u53ca\u5458\u5de5\u6240\u5728\u7684\u90e8\u95e8 mysql> select employee.name,department.name from employee inner join department -> on employee.dep_id = department.id -> where age > 25; +-------------------+--------------+ | name | name | +-------------------+--------------+ | \u4e50\u73c8\u5f64 | \u4eba\u529b\u8d44\u6e90 | | \u6731\u6167\u73ca | \u4eba\u529b\u8d44\u6e90 | | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | \u9500\u552e | +-------------------+--------------+ 3 rows in set (0.00 sec) \u4ee5\u5185\u8fde\u63a5\u7684\u65b9\u5f0f\u67e5\u8be2employee\u548cdepartment\u8868\uff0c\u5e76\u4e14\u4ee5age\u5b57\u6bb5\u7684\u5347\u5e8f\u65b9\u5f0f\u663e\u793a mysql> select employee.id,employee.name,employee.age,department.name from employee,department -> where employee.dep_id = department.id -> and age > 25 -> order by age asc; +----+-------------------+------+--------------+ | id | name | age | name | +----+-------------------+------+--------------+ | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | 28 | \u9500\u552e | | 5 | \u6731\u6167\u73ca | 38 | \u4eba\u529b\u8d44\u6e90 | | 3 | \u4e50\u73c8\u5f64 | 48 | \u4eba\u529b\u8d44\u6e90 | +----+-------------------+------+--------------+ 3 rows in set (0.00 sec)","title":"2.5 \u7b26\u5408\u6761\u4ef6\u8fde\u63a5\u67e5\u8be2"},{"location":"mysql/mysql.multi_table_query/#3","text":"\u5b50\u67e5\u8be2\u662f\u5c06\u4e00\u4e2a\u67e5\u8be2\u8bed\u53e5\u5d4c\u5957\u5728\u53e6\u4e00\u4e2a\u67e5\u8be2\u8bed\u53e5\u4e2d\u3002 \u5185\u5c42\u67e5\u8be2\u8bed\u53e5\u7684\u67e5\u8be2\u7ed3\u679c\uff0c\u53ef\u4ee5\u4e3a\u5916\u5c42\u67e5\u8be2\u8bed\u53e5\u63d0\u4f9b\u67e5\u8be2\u6761\u4ef6\u3002 \u5b50\u67e5\u8be2\u4e2d\u53ef\u4ee5\u5305\u542b\uff1aIN\u3001NOT IN\u3001ANY\u3001ALL\u3001EXISTS \u548c NOT EXISTS\u7b49\u5173\u952e\u5b57 \u8fd8\u53ef\u4ee5\u5305\u542b\u6bd4\u8f83\u8fd0\u7b97\u7b26\uff1a= \u3001 !=\u3001> \u3001<\u7b49","title":"3. \u5b50\u67e5\u8be2"},{"location":"mysql/mysql.multi_table_query/#31-in","text":"\u5e26IN\u5173\u952e\u5b57\u7684\u5b50\u67e5\u8be2 \u67e5\u8be2\u5e73\u5747\u5e74\u9f84\u572825\u5c81\u4ee5\u4e0a\u7684\u90e8\u95e8\u540d select id,name from department where id in (select dep_id from employee group by dep_id having avg(age) > 25); mysql> select id,name from department -> where id in -> (select dep_id from employee group by dep_id having avg(age) > 25); +------+--------------+ | id | name | +------+--------------+ | 201 | \u4eba\u529b\u8d44\u6e90 | | 202 | \u9500\u552e | +------+--------------+ 2 rows in set (0.00 sec) \u67e5\u770b\u6280\u672f\u90e8\u5458\u5de5\u59d3\u540d select name from employee where dep_id in (select id from department where name='\u6280\u672f'); mysql> select name from employee -> where dep_id in -> (select id from department where name='\u6280\u672f'); +-------------------+ | name | +-------------------+ | \u9648\u88d5\u5149 | | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | +-------------------+ 2 rows in set (0.00 sec) \u67e5\u770b\u4e0d\u8db31\u4eba\u7684\u90e8\u95e8\u540d select name from department where id in (select dep_id from employee group by dep_id having count(id) <=1); mysql> select name from department -> where id in -> (select dep_id from employee group by dep_id having count(id) <=1); +--------+ | name | +--------+ | \u9500\u552e | +--------+ 1 row in set (0.00 sec)","title":"3.1 IN"},{"location":"mysql/mysql.multi_table_query/#32","text":"\u5e26\u6bd4\u8f83\u8fd0\u7b97\u7b26\u7684\u5b50\u67e5\u8be2\uff0c\u6bd4\u8f83\u8fd0\u7b97\u7b26\uff1a=\u3001!=\u3001>\u3001>=\u3001<\u3001<=\u3001<> \u67e5\u8be2\u5927\u4e8e\u6240\u6709\u4eba\u5e73\u5747\u5e74\u9f84\u7684\u5458\u5de5\u540d\u4e0e\u5e74\u9f84 mysql> select name,age from employee where age > (select avg(age) from employee); +-----------+------+ | name | age | +-----------+------+ | \u4e50\u73c8\u5f64 | 48 | | \u6731\u6167\u73ca | 38 | +-----------+------+ 2 rows in set (0.00 sec) \u67e5\u8be2\u5927\u4e8e\u90e8\u95e8\u5185\u5e73\u5747\u5e74\u9f84\u7684\u5458\u5de5\u540d\u3001\u5e74\u9f84 select t1.name,t1.age from emp t1 inner join (select dep_id,avg(age) avg_age from emp group by dep_id) t2 on t1.dep_id = t2.dep_id where t1.age > t2.avg_age; mysql> select t1.name,t1.age from employee t1 -> inner join -> (select dep_id,avg(age) avg_age from employee group by dep_id) t2 -> on t1.dep_id = t2.dep_id -> where t1.age > t2.avg_age; +-----------+------+ | name | age | +-----------+------+ | \u4e50\u73c8\u5f64 | 48 | +-----------+------+ 1 row in set (0.00 sec)","title":"3.2 \u6bd4\u8f83\u8fd0\u7b97\u7b26"},{"location":"mysql/mysql.multi_table_query/#33-exists","text":"\u5e26EXISTS\u5173\u952e\u5b57\u7684\u5b50\u67e5\u8be2\uff0cEXISTS\u5173\u5b57\u952e\u5b57\u8868\u793a\u5b58\u5728\u3002\u5728\u4f7f\u7528EXISTS\u5173\u952e\u5b57\u65f6\uff0c\u5185\u5c42\u67e5\u8be2\u8bed\u53e5\u4e0d\u8fd4\u56de\u67e5\u8be2\u7684\u8bb0\u5f55\u3002\u800c\u662f\u8fd4\u56de\u4e00\u4e2a\u771f\u5047\u503c\uff0cTrue\u6216False\u3002\u5f53\u8fd4\u56deTrue\u65f6\uff0c\u5916\u5c42\u67e5\u8be2\u8bed\u53e5\u5c06\u8fdb\u884c\u67e5\u8be2\uff1b\u5f53\u8fd4\u56de\u503c\u4e3aFalse\u65f6\uff0c\u5916\u5c42\u67e5\u8be2\u8bed\u53e5\u4e0d\u8fdb\u884c\u67e5\u8be2\u3002 department\u8868\u4e2d\u5b58\u5728dept_id=203\uff0cTure select * from employee where exists (select id from department where id=200); mysql> select * from employee -> where exists -> (select id from department where id=200); +----+-------------------+--------+------+--------+ | id | name | sex | age | dep_id | +----+-------------------+--------+------+--------+ | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | +----+-------------------+--------+------+--------+ 6 rows in set (0.00 sec) department\u8868\u4e2d\u5b58\u5728dept_id=205\uff0cFalse select * from employee where exists (select id from department where id=204); mysql> select * from employee -> where exists -> (select id from department where id=204); Empty set (0.00 sec) union union all UNION \u8bed\u53e5\uff1a\u7528\u4e8e\u5c06\u4e0d\u540c\u8868\u4e2d\u76f8\u540c\u5217\u4e2d\u67e5\u8be2\u7684\u6570\u636e\u5c55\u793a\u51fa\u6765 \uff08\u4e0d\u5305\u62ec\u91cd\u590d\u6570\u636e\uff09 UNION ALL \u8bed\u53e5\uff1a\u7528\u4e8e\u5c06\u4e0d\u540c\u8868\u4e2d\u76f8\u540c\u5217\u4e2d\u67e5\u8be2\u7684\u6570\u636e\u5c55\u793a\u51fa\u6765 \uff08\u5305\u62ec\u91cd\u590d\u6570\u636e\uff09 mysql> select * from employee left join department on employee.dep_id = department.id -> union -> select * from employee right join department on employee.dep_id = department.id -> ; +------+-------------------+--------+------+--------+------+--------------+ | id | name | sex | age | dep_id | id | name | +------+-------------------+--------+------+--------+------+--------------+ | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 200 | \u6280\u672f | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 200 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 202 | \u9500\u552e | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | NULL | NULL | | NULL | NULL | NULL | NULL | NULL | 203 | \u8fd0\u8425 | +------+-------------------+--------+------+--------+------+--------------+ 7 rows in set (0.00 sec) mysql> select * from employee left join department on employee.dep_id = department.id -> union all -> select * from employee right join department on employee.dep_id = department.id; +------+-------------------+--------+------+--------+------+--------------+ | id | name | sex | age | dep_id | id | name | +------+-------------------+--------+------+--------+------+--------------+ | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 200 | \u6280\u672f | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 200 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 202 | \u9500\u552e | | 11 | \u4e9a\u4f26\u00b7\u8fea\u4e9a\u5179 | female | 18 | 204 | NULL | NULL | | 1 | \u9648\u88d5\u5149 | male | 18 | 200 | 200 | \u6280\u672f | | 3 | \u4e50\u73c8\u5f64 | female | 48 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 5 | \u6731\u6167\u73ca | male | 38 | 201 | 201 | \u4eba\u529b\u8d44\u6e90 | | 7 | \u79d1\u7433\u00b7\u739b\u4e3d\u8bfa | female | 28 | 202 | 202 | \u9500\u552e | | 9 | \u4f0a\u4e07\u00b7\u4f26\u5fb7\u5c14 | male | 18 | 200 | 200 | \u6280\u672f | | NULL | NULL | NULL | NULL | NULL | 203 | \u8fd0\u8425 | +------+-------------------+--------+------+--------+------+--------------+ 12 rows in set (0.00 sec)","title":"3.3 EXISTS"},{"location":"mysql/mysql.mysqlcnf/","text":"MySQL \u914d\u7f6e\u6587\u4ef6 1. \u4ecb\u7ecd \u00b6 \u5bf9\u4e8eMySQL\u7684\u7406\u89e3\uff0c\u6211\u8ba4\u4e3a\u5f88\u591a\u6027\u80fd\u4f18\u5316\u5de5\u4f5c\u3001\u4e3b\u4ece\u4e3b\u4e3b\u590d\u5236\u90fd\u662f\u5728\u8c03\u6574\u53c2\u6570\uff0c\u6765\u9002\u5e94\u4e0d\u540c\u65f6\u671f\u4e0d\u540c\u6570\u91cf\u7ea7\u7684\u6570\u636e\u3002\u6545\uff0c\u7406\u89e3\u900f\u5f7bmy.cnf\u91cc\u7684\u53c2\u6570\u662f\u6c38\u6052\u7684\u8bdd\u9898\uff1b\u53ea\u6709\u7406\u89e3\u900f\u5f7b\u4e86\u53c2\u6570\u8bbe\u7f6e\uff0c\u624d\u80fd\u5728\u67d0\u4e9b\u65b9\u9762\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u8c03\u4f18\u3002 2. \u53c2\u6570\u63cf\u8ff0 \u00b6 [client] \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u5ba2\u6237\u7aef\u8bbe\u7f6e\uff0c\u5373\u5ba2\u6237\u7aef\u9ed8\u8ba4\u7684\u8fde\u63a5\u53c2\u6570 port = 3306\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u9ed8\u8ba4\u8fde\u63a5\u7aef\u53e3 socket = /var/run/mysqld/mysqld.sock # \u7528\u4e8e\u672c\u5730\u8fde\u63a5\u7684socket\u5957\u63a5\u5b57 default-character-set = utf8mb4\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u7f16\u7801 [mysqld] \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u670d\u52a1\u7aef\u57fa\u672c\u8bbe\u7f6e port = 3306 # MySQL\u76d1\u542c\u7aef\u53e3 socket = /var/run/mysqld/mysqld.sock \u3000\u3000 # \u4e3aMySQL\u5ba2\u6237\u7aef\u7a0b\u5e8f\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u672c\u5730\u901a\u8baf\u6307\u5b9a\u4e00\u4e2a\u5957\u63a5\u5b57\u6587\u4ef6 pid-file = /var/run/mysqld/mysqld.pid \u3000\u3000# pid\u6587\u4ef6\u6240\u5728\u76ee\u5f55 basedir = /usr \u3000\u3000\u3000\u3000\u3000 # \u4f7f\u7528\u8be5\u76ee\u5f55\u4f5c\u4e3a\u6839\u76ee\u5f55\uff08\u5b89\u88c5\u76ee\u5f55\uff09 datadir = /var/lib/mysql \u3000\u3000\u3000\u3000\u3000# \u6570\u636e\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55 tmpdir = /tmp \u3000\u3000\u3000\u3000 # MySQL\u5b58\u653e\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55 character_set_server = utf8mb4 \u3000\u3000\u3000\u3000\u3000\u3000 # \u670d\u52a1\u7aef\u9ed8\u8ba4\u7f16\u7801\uff08\u6570\u636e\u5e93\u7ea7\u522b\uff09 collation_server = utf8mb4_bin \u3000\u3000\u3000\u3000\u3000\u3000 # \u670d\u52a1\u7aef\u9ed8\u8ba4\u7684\u6bd4\u5bf9\u89c4\u5219\uff0c\u6392\u5e8f\u89c4\u5219 user = mysql \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # MySQL\u542f\u52a8\u7528\u6237 log_bin_trust_function_creators = 1 \u3000\u3000\u3000\u3000 # This variable applies when binary logging is enabled. It controls whether stored function creators can be trusted not to create stored functions that will cause \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # unsafe events to be written to the binary log. If set to 0 (the default), users are not permitted to create or alter stored functions unless they have the SUPER \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # privilege in addition to the CREATE ROUTINE or ALTER ROUTINE privilege. \u5f00\u542f\u4e86binlog\u540e\uff0c\u5fc5\u987b\u8bbe\u7f6e\u8fd9\u4e2a\u503c\u4e3a1.\u4e3b\u8981\u662f\u8003\u8651binlog\u5b89\u5168 performance_schema = 0 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u6027\u80fd\u4f18\u5316\u7684\u5f15\u64ce\uff0c\u9ed8\u8ba4\u5173\u95ed secure_auth = 1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# secure_auth \u4e3a\u4e86\u9632\u6b62\u4f4e\u7248\u672c\u7684MySQL\u5ba2\u6237\u7aef(<4.1)\u4f7f\u7528\u65e7\u7684\u5bc6\u7801\u8ba4\u8bc1\u65b9\u5f0f\u8bbf\u95ee\u9ad8\u7248\u672c\u7684\u670d\u52a1\u5668\u3002MySQL 5.6.7\u5f00\u59cbsecure_auth \u9ed8\u8ba4\u4e3a\u542f\u7528\u503c1 #ft_min_word_len = 1 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f00\u542f\u5168\u6587\u7d22\u5f15 #myisam_recover \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u81ea\u52a8\u4fee\u590dMySQL\u7684myisam\u8868 explicit_defaults_for_timestamp \u3000\u3000\u3000\u3000\u3000\u3000 # \u660e\u786e\u65f6\u95f4\u6233\u9ed8\u8ba4null\u65b9\u5f0f event_scheduler \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8ba1\u5212\u4efb\u52a1\uff08\u4e8b\u4ef6\u8c03\u5ea6\u5668\uff09 skip-external-locking\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u8df3\u8fc7\u5916\u90e8\u9501\u5b9a;External-locking\u7528\u4e8e\u591a\u8fdb\u7a0b\u6761\u4ef6\u4e0b\u4e3aMyISAM\u6570\u636e\u8868\u8fdb\u884c\u9501\u5b9a skip-name-resolve\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u8df3\u8fc7\u5ba2\u6237\u7aef\u57df\u540d\u89e3\u6790\uff1b\u5f53\u65b0\u7684\u5ba2\u6237\u8fde\u63a5mysqld\u65f6\uff0cmysqld\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\u6765\u5904\u7406\u8bf7\u6c42\u3002\u8be5\u7ebf\u7a0b\u5148\u68c0\u67e5\u662f\u5426\u4e3b\u673a\u540d\u5728\u4e3b\u673a\u540d\u7f13\u5b58\u4e2d\u3002\u5982\u679c\u4e0d\u5728\uff0c\u7ebf\u7a0b\u8bd5\u56fe\u89e3\u6790\u4e3b\u673a\u540d\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4f7f\u7528\u8fd9\u4e00\u9009\u9879\u4ee5\u6d88\u9664MySQL\u8fdb\u884cDNS\u89e3\u6790\u7684\u65f6\u95f4\u3002\u4f46\u9700\u8981\u6ce8\u610f\uff0c\u5982\u679c\u5f00\u542f\u8be5\u9009\u9879\uff0c\u5219\u6240\u6709\u8fdc\u7a0b\u4e3b\u673a\u8fde\u63a5\u6388\u6743\u90fd\u8981\u4f7f\u7528IP\u5730\u5740\u65b9\u5f0f\uff0c\u5426\u5219MySQL\u5c06\u65e0\u6cd5\u6b63\u5e38\u5904\u7406\u8fde\u63a5\u8bf7\u6c42! #bind-address = 127.0.0.1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# MySQL\u7ed1\u5b9aIP, # 1. 127.0.0.1-> \u53ea\u80fd\u672c\u5730\u8fde\u63a5 # 2. 0.0.0.0 \u2014> \u5141\u8bb8\u5176\u4ed6\u673a\u5668\u8fde\u63a5 skip-slave-start\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4e3a\u4e86\u5b89\u5168\u8d77\u89c1\uff0c\u590d\u5236\u73af\u5883\u7684\u6570\u636e\u5e93\u8fd8\u662f\u8bbe\u7f6e--skip-slave-start\u53c2\u6570\uff0c\u9632\u6b62\u590d\u5236\u968f\u7740mysql\u542f\u52a8\u800c\u81ea\u52a8\u542f\u52a8 slave_net_timeout = 30 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # The number of seconds to wait for more data from a master/slave connection before aborting the read. MySQL\u4e3b\u4ece\u590d\u5236\u7684\u65f6\u5019\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f53Master\u548cSlave\u4e4b\u95f4\u7684\u7f51\u7edc\u4e2d\u65ad\uff0c\u4f46\u662fMaster\u548cSlave\u65e0\u6cd5\u5bdf\u89c9\u7684\u60c5\u51b5\u4e0b\uff08\u6bd4\u5982\u9632\u706b\u5899\u6216\u8005\u8def\u7531\u95ee\u9898\uff09\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # Slave\u4f1a\u7b49\u5f85slave_net_timeout\u8bbe\u7f6e\u7684\u79d2\u6570\u540e\uff0c\u624d\u80fd\u8ba4\u4e3a\u7f51\u7edc\u51fa\u73b0\u6545\u969c\uff0c\u7136\u540e\u624d\u4f1a\u91cd\u8fde\u5e76\u4e14\u8ffd\u8d76\u8fd9\u6bb5\u65f6\u95f4\u4e3b\u5e93\u7684\u6570\u636e\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # 1.\u7528\u8fd9\u4e09\u4e2a\u53c2\u6570\u6765\u5224\u65ad\u4e3b\u4ece\u662f\u5426\u5ef6\u8fdf\u662f\u4e0d\u51c6\u786e\u7684Slave_IO_Running,Slave_SQL_Running,Seconds_Behind_Master.\u8fd8\u662f\u7528pt-heartbeat\u5427\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # 2.slave_net_timeout\u4e0d\u8981\u7528\u9ed8\u8ba4\u503c\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u4f60\u80fd\u63a5\u53d7\u7684\u5ef6\u65f6\u65f6\u95f4\u3002 local-infile = 0 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8bbe\u5b9a\u662f\u5426\u652f\u6301\u547d\u4ee4load data local infile\u3002\u5982\u679c\u6307\u5b9alocal\u5173\u952e\u8bcd\uff0c\u5219\u8868\u660e\u652f\u6301\u4ece\u5ba2\u6237\u4e3b\u673a\u8bfb\u6587\u4ef6 back_log = 1024 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u6307\u5b9aMySQL\u53ef\u80fd\u7684\u8fde\u63a5\u6570\u91cf\u3002\u5f53MySQL\u4e3b\u7ebf\u7a0b\u5728\u5f88\u77ed\u7684\u65f6\u95f4\u5185\u5f97\u5230\u975e\u5e38\u591a\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u8be5\u53c2\u6570\u5c31\u8d77\u4f5c\u7528\uff0c\u4e4b\u540e\u4e3b\u7ebf\u7a0b\u82b1\u4e9b\u65f6\u95f4\uff08\u5c3d\u7ba1\u5f88\u77ed\uff09\u68c0\u67e5\u8fde\u63a5\u5e76\u4e14\u542f\u52a8\u4e00\u4e2a\u65b0\u7ebf\u7a0b\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # back_log\u53c2\u6570\u7684\u503c\u6307\u51fa\u5728MySQL\u6682\u65f6\u505c\u6b62\u54cd\u5e94\u65b0\u8bf7\u6c42\u4e4b\u524d\u7684\u77ed\u65f6\u95f4\u5185\u591a\u5c11\u4e2a\u8bf7\u6c42\u53ef\u4ee5\u88ab\u5b58\u5728\u5806\u6808\u4e2d\u3002 #sql_mode = 'PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,NO_KEY_OPTIONS,NO_TABLE_OPTIONS,NO_FIELD_OPTIONS,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' sql_mode = NO_ENGINE_SUBSTITUTION,NO_AUTO_CREATE_USER\u3000\u3000# sql_mode,\u5b9a\u4e49\u4e86mysql\u5e94\u8be5\u652f\u6301\u7684sql\u8bed\u6cd5\uff0c\u6570\u636e\u6821\u9a8c\u7b49! NO_AUTO_CREATE_USER\uff1a\u7981\u6b62GRANT\u521b\u5efa\u5bc6\u7801\u4e3a\u7a7a\u7684\u7528\u6237\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # NO_ENGINE_SUBSTITUTION \u5982\u679c\u9700\u8981\u7684\u5b58\u50a8\u5f15\u64ce\u88ab\u7981\u7528\u6216\u672a\u7f16\u8bd1\uff0c\u53ef\u4ee5\u9632\u6b62\u81ea\u52a8\u66ff\u6362\u5b58\u50a8\u5f15\u64ce key_buffer_size = 32M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000#\u7d22\u5f15\u5757\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u5bf9MyISAM\u8868\u6027\u80fd\u5f71\u54cd\u6700\u5927\u7684\u4e00\u4e2a\u53c2\u6570.\u51b3\u5b9a\u7d22\u5f15\u5904\u7406\u7684\u901f\u5ea6\uff0c\u5c24\u5176\u662f\u7d22\u5f15\u8bfb\u7684\u901f\u5ea6\u3002\u9ed8\u8ba4\u503c\u662f16M\uff0c\u901a\u8fc7\u68c0\u67e5\u72b6\u6001\u503cKey_read_requests \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 #\u548cKey_reads\uff0c\u53ef\u4ee5\u77e5\u9053key_buffer_size\u8bbe\u7f6e\u662f\u5426\u5408\u7406 max_allowed_packet = 512M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u4e00\u4e2a\u67e5\u8be2\u8bed\u53e5\u5305\u7684\u6700\u5927\u5c3a\u5bf8\u3002\u6d88\u606f\u7f13\u51b2\u533a\u88ab\u521d\u59cb\u5316\u4e3anet_buffer_length\u5b57\u8282\uff0c\u4f46\u662f\u53ef\u5728\u9700\u8981\u65f6\u589e\u52a0\u5230max_allowed_packet\u4e2a\u5b57\u8282\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8be5\u503c\u592a\u5c0f\u5219\u4f1a\u5728\u5904\u7406\u5927\u5305\u65f6\u4ea7\u751f\u9519\u8bef\u3002\u5982\u679c\u4f7f\u7528\u5927\u7684BLOB\u5217\uff0c\u5fc5\u987b\u589e\u52a0\u8be5\u503c\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8fd9\u4e2a\u503c\u6765\u9650\u5236server\u63a5\u53d7\u7684\u6570\u636e\u5305\u5927\u5c0f\u3002\u6709\u65f6\u5019\u5927\u7684\u63d2\u5165\u548c\u66f4\u65b0\u4f1a\u53d7max_allowed_packet \u53c2\u6570\u9650\u5236\uff0c\u5bfc\u81f4\u5199\u5165\u6216\u8005\u66f4\u65b0\u5931\u8d25\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 thread_stack = 256K\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u7ebf\u7a0b\u7f13\u5b58\uff1b\u4e3b\u8981\u7528\u6765\u5b58\u653e\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u81ea\u8eab\u7684\u6807\u8bc6\u4fe1\u606f\uff0c\u5982\u7ebf\u7a0bid\uff0c\u7ebf\u7a0b\u8fd0\u884c\u65f6\u57fa\u672c\u4fe1\u606f\u7b49\u7b49\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 thread_stack \u53c2\u6570\u6765\u8bbe\u7f6e\u4e3a\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u6808\u5206\u914d\u591a\u5927\u7684\u5185\u5b58\u3002 sort_buffer_size = 16M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u662fMySQL\u6267\u884c\u6392\u5e8f\u4f7f\u7528\u7684\u7f13\u51b2\u5927\u5c0f\u3002\u5982\u679c\u60f3\u8981\u589e\u52a0ORDER BY\u7684\u901f\u5ea6\uff0c\u9996\u5148\u770b\u662f\u5426\u53ef\u4ee5\u8ba9MySQL\u4f7f\u7528\u7d22\u5f15\u800c\u4e0d\u662f\u989d\u5916\u7684\u6392\u5e8f\u9636\u6bb5\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5982\u679c\u4e0d\u80fd\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u589e\u52a0sort_buffer_size\u53d8\u91cf\u7684\u5927\u5c0f\u3002 read_buffer_size = 16M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u662fMySQL\u8bfb\u5165\u7f13\u51b2\u533a\u5927\u5c0f\u3002\u5bf9\u8868\u8fdb\u884c\u987a\u5e8f\u626b\u63cf\u7684\u8bf7\u6c42\u5c06\u5206\u914d\u4e00\u4e2a\u8bfb\u5165\u7f13\u51b2\u533a\uff0cMySQL\u4f1a\u4e3a\u5b83\u5206\u914d\u4e00\u6bb5\u5185\u5b58\u7f13\u51b2\u533a\u3002read_buffer_size\u53d8\u91cf\u63a7\u5236\u8fd9\u4e00\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5982\u679c\u5bf9\u8868\u7684\u987a\u5e8f\u626b\u63cf\u8bf7\u6c42\u975e\u5e38\u9891\u7e41\uff0c\u5e76\u4e14\u4f60\u8ba4\u4e3a\u9891\u7e41\u626b\u63cf\u8fdb\u884c\u5f97\u592a\u6162\uff0c\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0\u8be5\u53d8\u91cf\u503c\u4ee5\u53ca\u5185\u5b58\u7f13\u51b2\u533a\u5927\u5c0f\u63d0\u9ad8\u5176\u6027\u80fd\u3002 join_buffer_size = 16M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5e94\u7528\u7a0b\u5e8f\u7ecf\u5e38\u4f1a\u51fa\u73b0\u4e00\u4e9b\u4e24\u8868\uff08\u6216\u591a\u8868\uff09Join\u7684\u64cd\u4f5c\u9700\u6c42\uff0cMySQL\u5728\u5b8c\u6210\u67d0\u4e9b Join \u9700\u6c42\u7684\u65f6\u5019\uff08all/index join\uff09\uff0c\u4e3a\u4e86\u51cf\u5c11\u53c2\u4e0eJoin\u7684\u201c\u88ab\u9a71\u52a8\u8868\u201d\u7684 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8bfb\u53d6\u6b21\u6570\u4ee5\u63d0\u9ad8\u6027\u80fd\uff0c\u9700\u8981\u4f7f\u7528\u5230 Join Buffer \u6765\u534f\u52a9\u5b8c\u6210 Join\u64cd\u4f5c\u3002\u5f53 Join Buffer \u592a\u5c0f\uff0cMySQL \u4e0d\u4f1a\u5c06\u8be5 Buffer \u5b58\u5165\u78c1\u76d8\u6587\u4ef6\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u800c\u662f\u5148\u5c06Join Buffer\u4e2d\u7684\u7ed3\u679c\u96c6\u4e0e\u9700\u8981 Join \u7684\u8868\u8fdb\u884c Join \u64cd\u4f5c\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u7136\u540e\u6e05\u7a7a Join Buffer \u4e2d\u7684\u6570\u636e\uff0c\u7ee7\u7eed\u5c06\u5269\u4f59\u7684\u7ed3\u679c\u96c6\u5199\u5165\u6b64 Buffer \u4e2d\uff0c\u5982\u6b64\u5f80\u590d\u3002\u8fd9\u52bf\u5fc5\u4f1a\u9020\u6210\u88ab\u9a71\u52a8\u8868\u9700\u8981\u88ab\u591a\u6b21\u8bfb\u53d6\uff0c\u6210\u500d\u589e\u52a0 IO \u8bbf\u95ee\uff0c\u964d\u4f4e\u6548\u7387\u3002 read_rnd_buffer_size = 32M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u662fMySQL\u7684\u968f\u673a\u8bfb\u7f13\u51b2\u533a\u5927\u5c0f\u3002\u5f53\u6309\u4efb\u610f\u987a\u5e8f\u8bfb\u53d6\u884c\u65f6(\u4f8b\u5982\uff0c\u6309\u7167\u6392\u5e8f\u987a\u5e8f)\uff0c\u5c06\u5206\u914d\u4e00\u4e2a\u968f\u673a\u8bfb\u7f13\u5b58\u533a\u3002\u8fdb\u884c\u6392\u5e8f\u67e5\u8be2\u65f6\uff0cMySQL\u4f1a\u9996\u5148\u626b\u63cf\u4e00\u904d\u8be5\u7f13\u51b2\uff0c\u4ee5\u907f\u514d\u78c1\u76d8\u641c\u7d22\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u63d0\u9ad8\u67e5\u8be2\u901f\u5ea6\uff0c\u5982\u679c\u9700\u8981\u6392\u5e8f\u5927\u91cf\u6570\u636e\uff0c\u53ef\u9002\u5f53\u8c03\u9ad8\u8be5\u503c\u3002\u4f46MySQL\u4f1a\u4e3a\u6bcf\u4e2a\u5ba2\u6237\u8fde\u63a5\u53d1\u653e\u8be5\u7f13\u51b2\u7a7a\u95f4\uff0c\u6240\u4ee5\u5e94\u5c3d\u91cf\u9002\u5f53\u8bbe\u7f6e\u8be5\u503c\uff0c\u4ee5\u907f\u514d\u5185\u5b58\u5f00\u9500\u8fc7\u5927\u3002 net_buffer_length = 16K\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u901a\u4fe1\u7f13\u51b2\u533a\u5728\u67e5\u8be2\u671f\u95f4\u88ab\u91cd\u7f6e\u5230\u8be5\u5927\u5c0f\u3002\u901a\u5e38\u4e0d\u8981\u6539\u53d8\u8be5\u53c2\u6570\u503c\uff0c\u4f46\u662f\u5982\u679c\u5185\u5b58\u4e0d\u8db3\uff0c\u53ef\u4ee5\u5c06\u5b83\u8bbe\u7f6e\u4e3a\u67e5\u8be2\u671f\u671b\u7684\u5927\u5c0f\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 #\uff08\u5373\uff0c\u5ba2\u6237\u53d1\u51fa\u7684SQL\u8bed\u53e5\u671f\u671b\u7684\u957f\u5ea6\u3002\u5982\u679c\u8bed\u53e5\u8d85\u8fc7\u8fd9\u4e2a\u957f\u5ea6\uff0c\u7f13\u51b2\u533a\u81ea\u52a8\u5730\u88ab\u6269\u5927\uff0c\u76f4\u5230max_allowed_packet\u4e2a\u5b57\u8282\u3002\uff09 myisam_sort_buffer_size = 128M\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f53\u5bf9MyISAM\u8868\u6267\u884crepair table\u6216\u521b\u5efa\u7d22\u5f15\u65f6\uff0c\u7528\u4ee5\u7f13\u5b58\u6392\u5e8f\u7d22\u5f15\uff1b\u8bbe\u7f6e\u592a\u5c0f\u65f6\u53ef\u80fd\u4f1a\u9047\u5230\u201d myisam_sort_buffer_size is too small\u201d bulk_insert_buffer_size = 32M\u3000\u3000\u3000\u3000\u3000\u3000 # \u9ed8\u8ba48M\uff0c\u5f53\u5bf9MyISAM\u975e\u7a7a\u8868\u6267\u884cinsert \u2026 select/ insert \u2026 values(\u2026),(\u2026)\u6216\u8005load data infile\u65f6\uff0c\u4f7f\u7528\u6811\u72b6cache\u7f13\u5b58\u6570\u636e\uff0c\u6bcf\u4e2athread\u5206\u914d\u4e00\u4e2a\uff1b \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u6ce8\uff1a\u5f53\u5bf9MyISAM\u8868load \u5927\u6587\u4ef6\u65f6\uff0c\u8c03\u5927bulk_insert_buffer_size/myisam_sort_buffer_size/key_buffer_size\u4f1a\u6781\u5927\u63d0\u5347\u901f\u5ea6 thread_cache_size = 384\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # thread_cahe_size\u7ebf\u7a0b\u6c60\uff0c\u7ebf\u7a0b\u7f13\u5b58\u3002\u7528\u6765\u7f13\u5b58\u7a7a\u95f2\u7684\u7ebf\u7a0b\uff0c\u4ee5\u81f3\u4e8e\u4e0d\u88ab\u9500\u6bc1\uff0c\u5982\u679c\u7ebf\u7a0b\u7f13\u5b58\u5728\u7684\u7a7a\u95f2\u7ebf\u7a0b\uff0c\u9700\u8981\u91cd\u65b0\u5efa\u7acb\u65b0\u8fde\u63a5\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5219\u4f1a\u4f18\u5148\u8c03\u7528\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7f13\u5b58\uff0c\u5f88\u5feb\u5c31\u80fd\u54cd\u5e94\u8fde\u63a5\u8bf7\u6c42\u3002\u6bcf\u5efa\u7acb\u4e00\u4e2a\u8fde\u63a5\uff0c\u90fd\u9700\u8981\u4e00\u4e2a\u7ebf\u7a0b\u4e0e\u4e4b\u5339\u914d\u3002 query_cache_size = 0\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5de5\u4f5c\u539f\u7406\uff1a \u4e00\u4e2aSELECT\u67e5\u8be2\u5728DB\u4e2d\u5de5\u4f5c\u540e\uff0cDB\u4f1a\u628a\u8be5\u8bed\u53e5\u7f13\u5b58\u4e0b\u6765\uff0c\u5f53\u540c\u6837\u7684\u4e00\u4e2aSQL\u518d\u6b21\u6765\u5230DB\u91cc\u8c03\u7528\u65f6\uff0cDB\u5728\u8be5\u8868\u6ca1\u53d1\u751f\u53d8\u5316\u7684\u60c5\u51b5\u4e0b\u628a\u7ed3\u679c\u4ece\u7f13\u5b58\u4e2d\u8fd4\u56de\u7ed9Client\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5728\u6570\u636e\u5e93\u5199\u5165\u91cf\u6216\u662f\u66f4\u65b0\u91cf\u4e5f\u6bd4\u8f83\u5927\u7684\u7cfb\u7edf\uff0c\u8be5\u53c2\u6570\u4e0d\u9002\u5408\u5206\u914d\u8fc7\u5927\u3002\u800c\u4e14\u5728\u9ad8\u5e76\u53d1\uff0c\u5199\u5165\u91cf\u5927\u7684\u7cfb\u7edf\uff0c\u5efa\u7cfb\u628a\u8be5\u529f\u80fd\u7981\u6389\u3002 query_cache_type = 0\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u51b3\u5b9a\u662f\u5426\u7f13\u5b58\u67e5\u8be2\u7ed3\u679c\u3002\u8fd9\u4e2a\u53d8\u91cf\u6709\u4e09\u4e2a\u53d6\u503c\uff1a0,1,2\uff0c\u5206\u522b\u4ee3\u8868\u4e86off\u3001on\u3001demand\u3002\u3000\u3000\u3000\u3000\u3000\u3000\u3000 tmp_table_size = 1024M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5b83\u89c4\u5b9a\u4e86\u5185\u90e8\u5185\u5b58\u4e34\u65f6\u8868\u7684\u6700\u5927\u503c\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u8981\u5206\u914d\u3002\uff08\u5b9e\u9645\u8d77\u9650\u5236\u4f5c\u7528\u7684\u662ftmp_table_size\u548cmax_heap_table_size\u7684\u6700\u5c0f\u503c\u3002\uff09 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5982\u679c\u5185\u5b58\u4e34\u65f6\u8868\u8d85\u51fa\u4e86\u9650\u5236\uff0cMySQL\u5c31\u4f1a\u81ea\u52a8\u5730\u628a\u5b83\u8f6c\u5316\u4e3a\u57fa\u4e8e\u78c1\u76d8\u7684MyISAM\u8868\uff0c\u5b58\u50a8\u5728\u6307\u5b9a\u7684tmpdir\u76ee\u5f55\u4e0b max_heap_table_size = 512M \u3000\u3000\u3000\u3000\u3000\u3000 # \u72ec\u7acb\u7684\u5185\u5b58\u8868\u6240\u5141\u8bb8\u7684\u6700\u5927\u5bb9\u91cf.# \u6b64\u9009\u9879\u4e3a\u4e86\u9632\u6b62\u610f\u5916\u521b\u5efa\u4e00\u4e2a\u8d85\u5927\u7684\u5185\u5b58\u8868\u5bfc\u81f4\u6c38\u5c3d\u6240\u6709\u7684\u5185\u5b58\u8d44\u6e90. open_files_limit = 10240\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # mysql\u6253\u5f00\u6700\u5927\u6587\u4ef6\u6570 max_connections = 2000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # MySQL\u65e0\u8bba\u5982\u4f55\u90fd\u4f1a\u4fdd\u7559\u4e00\u4e2a\u7528\u4e8e\u7ba1\u7406\u5458\uff08SUPER\uff09\u767b\u9646\u7684\u8fde\u63a5\uff0c\u7528\u4e8e\u7ba1\u7406\u5458\u8fde\u63a5\u6570\u636e\u5e93\u8fdb\u884c\u7ef4\u62a4\u64cd\u4f5c\uff0c\u5373\u4f7f\u5f53\u524d\u8fde\u63a5\u6570\u5df2\u7ecf\u8fbe\u5230\u4e86max_connections\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u56e0\u6b64MySQL\u7684\u5b9e\u9645\u6700\u5927\u53ef\u8fde\u63a5\u6570\u4e3amax_connections+1\uff1b \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8fd9\u4e2a\u53c2\u6570\u5b9e\u9645\u8d77\u4f5c\u7528\u7684\u6700\u5927\u503c\uff08\u5b9e\u9645\u6700\u5927\u53ef\u8fde\u63a5\u6570\uff09\u4e3a16384\uff0c\u5373\u8be5\u53c2\u6570\u6700\u5927\u503c\u4e0d\u80fd\u8d85\u8fc716384\uff0c\u5373\u4f7f\u8d85\u8fc7\u4e5f\u4ee516384\u4e3a\u51c6\uff1b \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u589e\u52a0max_connections\u53c2\u6570\u7684\u503c\uff0c\u4e0d\u4f1a\u5360\u7528\u592a\u591a\u7cfb\u7edf\u8d44\u6e90\u3002\u7cfb\u7edf\u8d44\u6e90\uff08CPU\u3001\u5185\u5b58\uff09\u7684\u5360\u7528\u4e3b\u8981\u53d6\u51b3\u4e8e\u67e5\u8be2\u7684\u5bc6\u5ea6\u3001\u6548\u7387\u7b49\uff1b \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8be5\u53c2\u6570\u8bbe\u7f6e\u8fc7\u5c0f\u7684\u6700\u660e\u663e\u7279\u5f81\u662f\u51fa\u73b0\u201dToo many connections\u201d\u9519\u8bef\uff1b max-user-connections = 0\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u7528\u6765\u9650\u5236\u7528\u6237\u8d44\u6e90\u7684\uff0c0\u4e0d\u9650\u5236\uff1b\u5bf9\u6574\u4e2a\u670d\u52a1\u5668\u7684\u7528\u6237\u9650\u5236 max_connect_errors = 100000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# max_connect_errors\u662f\u4e00\u4e2aMySQL\u4e2d\u4e0e\u5b89\u5168\u6709\u5173\u7684\u8ba1\u6570\u5668\u503c\uff0c\u5b83\u8d1f\u8d23\u963b\u6b62\u8fc7\u591a\u5c1d\u8bd5\u5931\u8d25\u7684\u5ba2\u6237\u7aef\u4ee5\u9632\u6b62\u66b4\u529b\u7834\u89e3\u5bc6\u7801\u7684\u60c5\u51b5\u3002max_connect_errors\u7684\u503c\u4e0e\u6027\u80fd\u5e76\u65e0\u592a\u5927\u5173\u7cfb\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f53\u6b64\u503c\u8bbe\u7f6e\u4e3a10\u65f6\uff0c\u610f\u5473\u7740\u5982\u679c\u67d0\u4e00\u5ba2\u6237\u7aef\u5c1d\u8bd5\u8fde\u63a5\u6b64MySQL\u670d\u52a1\u5668\uff0c\u4f46\u662f\u5931\u8d25\uff08\u5982\u5bc6\u7801\u9519\u8bef\u7b49\u7b49\uff0910\u6b21\uff0c\u5219MySQL\u4f1a\u65e0\u6761\u4ef6\u5f3a\u5236\u963b\u6b62\u6b64\u5ba2\u6237\u7aef\u8fde\u63a5\u3002 table_open_cache = 5120\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u8868\u63cf\u8ff0\u7b26\u7f13\u5b58\u5927\u5c0f\uff0c\u53ef\u51cf\u5c11\u6587\u4ef6\u6253\u5f00/\u5173\u95ed\u6b21\u6570\uff1b interactive_timeout = 86400\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# interactive_time -- \u6307\u7684\u662fmysql\u5728\u5173\u95ed\u4e00\u4e2a\u4ea4\u4e92\u7684\u8fde\u63a5\u4e4b\u524d\u6240\u8981\u7b49\u5f85\u7684\u79d2\u6570(\u4ea4\u4e92\u8fde\u63a5\u5982mysql gui tool\u4e2d\u7684\u8fde\u63a5 wait_timeout = 86400\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # wait_timeout -- \u6307\u7684\u662fMySQL\u5728\u5173\u95ed\u4e00\u4e2a\u975e\u4ea4\u4e92\u7684\u8fde\u63a5\u4e4b\u524d\u6240\u8981\u7b49\u5f85\u7684\u79d2\u6570 binlog_cache_size = 16M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u4e8c\u8fdb\u5236\u65e5\u5fd7\u7f13\u51b2\u5927\u5c0f \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u6211\u4eec\u77e5\u9053InnoDB\u5b58\u50a8\u5f15\u64ce\u662f\u652f\u6301\u4e8b\u52a1\u7684\uff0c\u5b9e\u73b0\u4e8b\u52a1\u9700\u8981\u4f9d\u8d56\u4e8e\u65e5\u5fd7\u6280\u672f\uff0c\u4e3a\u4e86\u6027\u80fd\uff0c\u65e5\u5fd7\u7f16\u7801\u91c7\u7528\u4e8c\u8fdb\u5236\u683c\u5f0f\u3002\u90a3\u4e48\uff0c\u6211\u4eec\u5982\u4f55\u8bb0\u65e5\u5fd7\u5462\uff1f\u6709\u65e5\u5fd7\u7684\u65f6\u5019\uff0c\u5c31\u76f4\u63a5\u5199\u78c1\u76d8\uff1f \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u53ef\u662f\u78c1\u76d8\u7684\u6548\u7387\u662f\u5f88\u4f4e\u7684\uff0c\u5982\u679c\u4f60\u7528\u8fc7Nginx\uff0c\uff0c\u4e00\u822cNginx\u8f93\u51faaccess log\u90fd\u662f\u8981\u7f13\u51b2\u8f93\u51fa\u7684\u3002\u56e0\u6b64\uff0c\u8bb0\u5f55\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7684\u65f6\u5019\uff0c\u6211\u4eec\u662f\u5426\u4e5f\u9700\u8981\u8003\u8651Cache\u5462\uff1f \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u7b54\u6848\u662f\u80af\u5b9a\u7684\uff0c\u4f46\u662fCache\u4e0d\u662f\u76f4\u63a5\u6301\u4e45\u5316\uff0c\u4e8e\u662f\u9762\u4e34\u5b89\u5168\u6027\u7684\u95ee\u9898\u2014\u2014\u56e0\u4e3a\u7cfb\u7edf\u5b95\u673a\u65f6\uff0cCache\u4e2d\u53ef\u80fd\u6709\u6b8b\u4f59\u7684\u6570\u636e\u6ca1\u6765\u5f97\u53ca\u5199\u5165\u78c1\u76d8\u3002\u56e0\u6b64\uff0cCache\u8981\u6743\u8861\uff0c\u8981\u6070\u5230\u597d\u5904\uff1a \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u65e2\u51cf\u5c11\u78c1\u76d8I/O\uff0c\u6ee1\u8db3\u6027\u80fd\u8981\u6c42\uff1b\u53c8\u4fdd\u8bc1Cache\u65e0\u6b8b\u7559\uff0c\u53ca\u65f6\u6301\u4e45\u5316\uff0c\u6ee1\u8db3\u5b89\u5168\u8981\u6c42\u3002 slow_query_log = 1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f00\u542f\u6162\u67e5\u8be2 long_query_time = 1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u8d85\u8fc7\u7684\u65f6\u95f4\u4e3a1s\uff1bMySQL\u80fd\u591f\u8bb0\u5f55\u6267\u884c\u65f6\u95f4\u8d85\u8fc7\u53c2\u6570 long_query_time \u8bbe\u7f6e\u503c\u7684SQL\u8bed\u53e5\uff0c\u9ed8\u8ba4\u662f\u4e0d\u8bb0\u5f55\u7684\u3002 log-slow-admin-statements log-queries-not-using-indexes\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u8bb0\u5f55\u7ba1\u7406\u8bed\u53e5\u548c\u6ca1\u6709\u4f7f\u7528index\u7684\u67e5\u8be2\u8bb0\u5f55 # *** Replication related settings *** binlog_format = ROW\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u5728\u590d\u5236\u65b9\u9762\u7684\u6539\u8fdb\u5c31\u662f\u5f15\u8fdb\u4e86\u65b0\u7684\u590d\u5236\u6280\u672f\uff1a\u57fa\u4e8e\u884c\u7684\u590d\u5236\u3002\u7b80\u8a00\u4e4b\uff0c\u8fd9\u79cd\u65b0\u6280\u672f\u5c31\u662f\u5173\u6ce8\u8868\u4e2d\u53d1\u751f\u53d8\u5316\u7684\u8bb0\u5f55\uff0c\u800c\u975e\u4ee5\u524d\u7684\u7167\u6284 binlog \u6a21\u5f0f\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4ece MySQL 5.1.12 \u5f00\u59cb\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u4e09\u79cd\u6a21\u5f0f\u6765\u5b9e\u73b0\uff1a\u57fa\u4e8eSQL\u8bed\u53e5\u7684\u590d\u5236(statement-based replication, SBR)\uff0c\u57fa\u4e8e\u884c\u7684\u590d\u5236(row-based replication, RBR)\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u6df7\u5408\u6a21\u5f0f\u590d\u5236(mixed-based replication, MBR)\u3002\u76f8\u5e94\u5730\uff0cbinlog\u7684\u683c\u5f0f\u4e5f\u6709\u4e09\u79cd\uff1aSTATEMENT\uff0cROW\uff0cMIXED\u3002MBR \u6a21\u5f0f\u4e2d\uff0cSBR \u6a21\u5f0f\u662f\u9ed8\u8ba4\u7684\u3002 #max_binlog_cache_size = 102400\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4e3a\u6bcf\u4e2asession \u6700\u5927\u53ef\u5206\u914d\u7684\u5185\u5b58\uff0c\u5728\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\u7528\u6765\u5b58\u50a8\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7684\u7f13\u5b58\u3002 log-bin = /var/log/mysql/mysql-bin.log \u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f00\u542f\u4e8c\u8fdb\u5236\u65e5\u5fd7\u529f\u80fd\uff0cbinlog\u6570\u636e\u4f4d\u7f6e log-bin-index = /var/log/mysql/mysql-bin.index relay-log = /var/log/mysql/relay/mysql-relay-bin \u3000\u3000\u3000 # relay-log\u65e5\u5fd7\u8bb0\u5f55\u7684\u662f\u4ece\u670d\u52a1\u5668I/O\u7ebf\u7a0b\u5c06\u4e3b\u670d\u52a1\u5668\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u8bfb\u53d6\u8fc7\u6765\u8bb0\u5f55\u5230\u4ece\u670d\u52a1\u5668\u672c\u5730\u6587\u4ef6\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u7136\u540eSQL\u7ebf\u7a0b\u4f1a\u8bfb\u53d6relay-log\u65e5\u5fd7\u7684\u5185\u5bb9\u5e76\u5e94\u7528\u5230\u4ece\u670d\u52a1\u5668 relay-log-index = /var/log/mysql/relay/mysql-relay-bin.index # binlog\u4f20\u5230\u5907\u673a\u88ab\u5199\u9053relaylog\u91cc\uff0c\u5907\u673a\u7684slave sql\u7ebf\u7a0b\u4ecerelaylog\u91cc\u8bfb\u53d6\u7136\u540e\u5e94\u7528\u5230\u672c\u5730\u3002 server_id = 100\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u670d\u52a1\u7aefID\uff0c\u7528\u6765\u9ad8\u53ef\u7528\u65f6\u505a\u533a\u5206 log_slave_updates = 1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # log_slave_updates\u662f\u5c06\u4ece\u670d\u52a1\u5668\u4ece\u4e3b\u670d\u52a1\u5668\u6536\u5230\u7684\u66f4\u65b0\u8bb0\u5165\u5230\u4ece\u670d\u52a1\u5668\u81ea\u5df1\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u4e2d\u3002 expire-logs-days = 15\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4e8c\u8fdb\u5236\u65e5\u5fd7\u81ea\u52a8\u5220\u9664\u7684\u5929\u6570\u3002\u9ed8\u8ba4\u503c\u4e3a0,\u8868\u793a\u201c\u6ca1\u6709\u81ea\u52a8\u5220\u9664\u201d\u3002\u542f\u52a8\u65f6\u548c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u5faa\u73af\u65f6\u53ef\u80fd\u5220\u9664\u3002 max_binlog_size = 512M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5982\u679c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u5199\u5165\u7684\u5185\u5bb9\u8d85\u51fa\u7ed9\u5b9a\u503c\uff0c\u65e5\u5fd7\u5c31\u4f1a\u53d1\u751f\u6eda\u52a8\u3002\u4f60\u4e0d\u80fd\u5c06\u8be5\u53d8\u91cf\u8bbe\u7f6e\u4e3a\u5927\u4e8e1GB\u6216\u5c0f\u4e8e4096\u5b57\u8282\u3002 \u9ed8\u8ba4\u503c\u662f1GB\u3002 replicate-wild-ignore-table = mysql.%\u3000\u3000 # replicate-wild-ignore-table\u53c2\u6570\u80fd\u540c\u6b65\u6240\u6709\u8de8\u6570\u636e\u5e93\u7684\u66f4\u65b0\uff0c\u6bd4\u5982replicate-do-db\u6216\u8005replicate-ignore-db\u4e0d\u4f1a\u540c\u6b65\u7c7b\u4f3c #replicate-wild-do-table = db_name.%\u3000\u3000 # \u8bbe\u5b9a\u9700\u8981\u590d\u5236\u7684Table #slave-skip-errors = 1062,1053,1146\u3000\u3000\u3000\u3000 # \u590d\u5236\u65f6\u8df3\u8fc7\u4e00\u4e9b\u9519\u8bef;\u4e0d\u8981\u80e1\u4e71\u4f7f\u7528\u8fd9\u4e9b\u8df3\u8fc7\u9519\u8bef\u7684\u53c2\u6570\uff0c\u9664\u975e\u4f60\u975e\u5e38\u786e\u5b9a\u4f60\u5728\u505a\u4ec0\u4e48\u3002\u5f53\u4f60\u4f7f\u7528\u8fd9\u4e9b\u53c2\u6570\u65f6\u5019\uff0cMYSQL\u4f1a\u5ffd\u7565\u90a3\u4e9b\u9519\u8bef\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8fd9\u6837\u4f1a\u5bfc\u81f4\u4f60\u7684\u4e3b\u4ece\u670d\u52a1\u5668\u6570\u636e\u4e0d\u4e00\u81f4\u3002 auto_increment_offset = 1 # \u6f02\u79fb\u503c,\u4e5f\u5c31\u662f\u6b65\u957f auto_increment_increment = 2\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u81ea\u589e\u503c,\u8fd9\u4e24\u4e2a\u53c2\u6570\u4e00\u822c\u7528\u5728\u4e3b\u4e3b\u540c\u6b65\u4e2d\uff0c\u7528\u6765\u9519\u5f00\u81ea\u589e\u503c, \u9632\u6b62\u952e\u503c\u51b2\u7a81 relay_log_info_repository = TABLE\u3000\u3000\u3000\u3000\u3000 # \u5c06\u4e2d\u7ee7\u65e5\u5fd7\u7684\u4fe1\u606f\u5199\u5165\u8868:mysql.slave_realy_log_info master_info_repository = TABLE\u3000\u3000\u3000\u3000\u3000\u3000 # \u5c06master\u7684\u8fde\u63a5\u4fe1\u606f\u5199\u5165\u8868\uff1amysql.salve_master_info relay_log_recovery = on\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4e2d\u7ee7\u65e5\u5fd7\u81ea\u6211\u4fee\u590d\uff1b\u5f53slave\u4ece\u5e93\u5b95\u673a\u540e\uff0c\u5047\u5982relay-log\u635f\u574f\u4e86\uff0c\u5bfc\u81f4\u4e00\u90e8\u5206\u4e2d\u7ee7\u65e5\u5fd7\u6ca1\u6709\u5904\u7406\uff0c\u5219\u81ea\u52a8\u653e\u5f03\u6240\u6709\u672a\u6267\u884c\u7684relay-log\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5e76\u4e14\u91cd\u65b0\u4ecemaster\u4e0a\u83b7\u53d6\u65e5\u5fd7\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86relay-log\u7684\u5b8c\u6574\u6027 # *** innodb setting *** innodb_buffer_pool_size = 4G\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# InnoDB \u7528\u6765\u9ad8\u901f\u7f13\u51b2\u6570\u636e\u548c\u7d22\u5f15\u5185\u5b58\u7f13\u51b2\u5927\u5c0f\u3002 \u66f4\u5927\u7684\u8bbe\u7f6e\u53ef\u4ee5\u4f7f\u8bbf\u95ee\u6570\u636e\u65f6\u51cf\u5c11\u78c1\u76d8 I/O\u3002 innodb_data_file_path = ibdata1:1G:autoextend\u3000\u3000# \u5355\u72ec\u6307\u5b9a\u6570\u636e\u6587\u4ef6\u7684\u8def\u5f84\u4e0e\u5927\u5c0f innodb_flush_log_at_trx_commit = 0\u3000\u3000\u3000\u3000 # \u6bcf\u6b21commit \u65e5\u5fd7\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u5237\u5230\u78c1\u76d8\u4e2d\u3002\u901a\u5e38\u8bbe\u7f6e\u4e3a 1\uff0c\u610f\u5473\u7740\u5728\u4e8b\u52a1\u63d0\u4ea4\u524d\u65e5\u5fd7\u5df2\u88ab\u5199\u5165\u78c1\u76d8\uff0c \u4e8b\u52a1\u53ef\u4ee5\u8fd0\u884c\u66f4\u957f\u4ee5\u53ca\u670d\u52a1\u5d29\u6e83\u540e\u7684\u4fee\u590d\u80fd\u529b\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u5982\u679c\u4f60\u613f\u610f\u51cf\u5f31\u8fd9\u4e2a\u5b89\u5168\uff0c\u6216\u4f60\u8fd0\u884c\u7684\u662f\u6bd4\u8f83\u5c0f\u7684\u4e8b\u52a1\u5904\u7406\uff0c\u53ef\u4ee5\u5c06\u5b83\u8bbe\u7f6e\u4e3a 0 \uff0c\u4ee5\u51cf\u5c11\u5199\u65e5\u5fd7\u6587\u4ef6\u7684\u78c1\u76d8 I/O\u3002\u8fd9\u4e2a\u9009\u9879\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a 0\u3002 #sync_binlog = 1000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # sync_binlog=n\uff0c\u5f53\u6bcf\u8fdb\u884cn\u6b21\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\uff0cMySQL\u5c06\u8fdb\u884c\u4e00\u6b21fsync\u4e4b\u7c7b\u7684\u78c1\u76d8\u540c\u6b65\u6307\u4ee4\u6765\u5c06binlog_cache\u4e2d\u7684\u6570\u636e\u5f3a\u5236\u5199\u5165\u78c1\u76d8\u3002 innodb_read_io_threads = 8\u3000\u3000 innodb_write_io_threads = 8\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5bf9\u4e8e\u591a\u6838\u7684CPU\u673a\u5668\uff0c\u53ef\u4ee5\u4fee\u6539innodb_read_io_threads\u548cinnodb_write_io_threads\u6765\u589e\u52a0IO\u7ebf\u7a0b\uff0c\u6765\u5145\u5206\u5229\u7528\u591a\u6838\u7684\u6027\u80fd innodb_file_format = Barracuda\u3000\u3000\u3000\u3000\u3000\u3000 # Innodb Plugin\u5f15\u64ce\u5f00\u59cb\u5f15\u5165\u591a\u79cd\u683c\u5f0f\u7684\u884c\u5b58\u50a8\u673a\u5236\uff0c\u76ee\u524d\u652f\u6301\uff1aAntelope\u3001Barracuda\u4e24\u79cd\u3002\u5176\u4e2dBarracuda\u517c\u5bb9Antelope\u683c\u5f0f\u3002 innodb_open_files = 65536\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u9650\u5236Innodb\u80fd\u6253\u5f00\u7684\u8868\u7684\u6570\u91cf innodb_purge_threads = 1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f00\u59cb\u788e\u7247\u56de\u6536\u7ebf\u7a0b\u3002\u8fd9\u4e2a\u5e94\u8be5\u80fd\u8ba9\u788e\u7247\u56de\u6536\u5f97\u66f4\u53ca\u65f6\u800c\u4e14\u4e0d\u5f71\u54cd\u5176\u4ed6\u7ebf\u7a0b\u7684\u64cd\u4f5c innodb_support_xa = FALSE\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5206\u5e03\u5f0f\u4e8b\u52a1 innodb_log_buffer_size = 256M\u3000\u3000\u3000\u3000\u3000\u3000 # nnoDB \u5c06\u65e5\u5fd7\u5199\u5165\u65e5\u5fd7\u78c1\u76d8\u6587\u4ef6\u524d\u7684\u7f13\u51b2\u5927\u5c0f\u3002\u7406\u60f3\u503c\u4e3a 1M \u81f3 8M\u3002\u5927\u7684\u65e5\u5fd7\u7f13\u51b2\u5141\u8bb8\u4e8b\u52a1\u8fd0\u884c\u65f6\u4e0d\u9700\u8981\u5c06\u65e5\u5fd7\u4fdd\u5b58\u5165\u78c1\u76d8\u800c\u53ea\u5230\u4e8b\u52a1\u88ab\u63d0\u4ea4(commit)\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u56e0\u6b64\uff0c\u5982\u679c\u6709\u5927\u7684\u4e8b\u52a1\u5904\u7406\uff0c\u8bbe\u7f6e\u5927\u7684\u65e5\u5fd7\u7f13\u51b2\u53ef\u4ee5\u51cf\u5c11\u78c1\u76d8I/O\u3002 innodb_log_file_size = 1G\u3000\u3000\u3000\u3000\u3000\u3000 # \u65e5\u5fd7\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7684\u5927\u5c0f(\u5355\u4f4d MB)\u3002\u5982\u679c n \u662f\u65e5\u5fd7\u7ec4\u4e2d\u65e5\u5fd7\u6587\u4ef6\u7684\u6570\u76ee\uff0c\u90a3\u4e48\u7406\u60f3\u7684\u6570\u503c\u4e3a 1M \u81f3\u4e0b\u9762\u8bbe\u7f6e\u7684\u7f13\u51b2\u6c60(buffer pool)\u5927\u5c0f\u7684 1/n\u3002\u8f83\u5927\u7684\u503c\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 \u3000# \u53ef\u4ee5\u51cf\u5c11\u5237\u65b0\u7f13\u51b2\u6c60\u7684\u6b21\u6570\uff0c\u4ece\u800c\u51cf\u5c11\u78c1\u76d8 I/O\u3002\u4f46\u662f\u5927\u7684\u65e5\u5fd7\u6587\u4ef6\u610f\u5473\u7740\u5728\u5d29\u6e83\u65f6\u9700\u8981\u66f4\u957f\u7684\u65f6\u95f4\u6765\u6062\u590d\u6570\u636e\u3002 innodb_log_files_in_group = 3\u3000\u3000\u3000\u3000\u3000\u3000 # \u6307\u5b9a\u6709\u4e09\u4e2a\u65e5\u5fd7\u7ec4 #innodb_lock_wait_timeout = 120\u3000\u3000\u3000\u3000\u3000 # \u5728\u56de\u6eda(rooled back)\u4e4b\u524d\uff0cInnoDB \u4e8b\u52a1\u5c06\u7b49\u5f85\u8d85\u65f6\u7684\u65f6\u95f4(\u5355\u4f4d \u79d2) innodb_max_dirty_pages_pct = 75\u3000\u3000\u3000\u3000\u3000 # innodb_max_dirty_pages_pct\u4f5c\u7528\uff1a\u63a7\u5236Innodb\u7684\u810f\u9875\u5728\u7f13\u51b2\u4e2d\u5728\u90a3\u4e2a\u767e\u5206\u6bd4\u4e4b\u4e0b\uff0c\u503c\u5728\u8303\u56f41-100,\u9ed8\u8ba4\u4e3a90.\u8fd9\u4e2a\u53c2\u6570\u7684\u53e6\u4e00\u4e2a\u7528\u5904\uff1a \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 \u3000# \u5f53Innodb\u7684\u5185\u5b58\u5206\u914d\u8fc7\u5927\uff0c\u81f4\u4f7fswap\u5360\u7528\u4e25\u91cd\u65f6\uff0c\u53ef\u4ee5\u9002\u5f53\u7684\u51cf\u5c0f\u8c03\u6574\u8fd9\u4e2a\u503c\uff0c\u4f7f\u8fbe\u5230swap\u7a7a\u95f4\u91ca\u653e\u51fa\u6765\u3002\u5efa\u4e49\uff1a\u8fd9\u4e2a\u503c\u6700\u5927\u572890%\uff0c\u6700\u5c0f\u572815%\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u592a\u5927\uff0c\u7f13\u5b58\u4e2d\u6bcf\u6b21\u66f4\u65b0\u9700\u8981\u81f4\u6362\u6570\u636e\u9875\u592a\u591a\uff0c\u592a\u5c0f\uff0c\u653e\u7684\u6570\u636e\u9875\u592a\u5c0f\uff0c\u66f4\u65b0\u64cd\u4f5c\u592a\u6162\u3002 innodb_buffer_pool_instances = 4 \u3000\u3000\u3000 # innodb_buffer_pool_size \u4e00\u81f4 \u53ef\u4ee5\u5f00\u542f\u591a\u4e2a\u5185\u5b58\u7f13\u51b2\u6c60\uff0c\u628a\u9700\u8981\u7f13\u51b2\u7684\u6570\u636ehash\u5230\u4e0d\u540c\u7684\u7f13\u51b2\u6c60\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u5e76\u884c\u7684\u5185\u5b58\u8bfb\u5199\u3002 innodb_io_capacity = 500\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8fd9\u4e2a\u53c2\u6570\u636e\u63a7\u5236Innodb checkpoint\u65f6\u7684IO\u80fd\u529b innodb_file_per_table = 1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4f5c\u7528\uff1a\u4f7f\u6bcf\u4e2aInnodb\u7684\u8868\uff0c\u6709\u81ea\u5df2\u72ec\u7acb\u7684\u8868\u7a7a\u95f4\u3002\u5982\u5220\u9664\u6587\u4ef6\u540e\u53ef\u4ee5\u56de\u6536\u90a3\u90e8\u5206\u7a7a\u95f4\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5206\u914d\u539f\u5219\uff1a\u53ea\u6709\u4f7f\u7528\u4e0d\u4f7f\u7528\u3002\u4f46\uff24\uff22\u8fd8\u9700\u8981\u6709\u4e00\u4e2a\u516c\u5171\u7684\u8868\u7a7a\u95f4\u3002 innodb_change_buffering = inserts\u3000\u3000\u3000\u3000 # \u5f53\u66f4\u65b0/\u63d2\u5165\u7684\u975e\u805a\u96c6\u7d22\u5f15\u7684\u6570\u636e\u6240\u5bf9\u5e94\u7684\u9875\u4e0d\u5728\u5185\u5b58\u4e2d\u65f6\uff08\u5bf9\u975e\u805a\u96c6\u7d22\u5f15\u7684\u66f4\u65b0\u64cd\u4f5c\u901a\u5e38\u4f1a\u5e26\u6765\u968f\u673aIO\uff09\uff0c\u4f1a\u5c06\u5176\u653e\u5230\u4e00\u4e2ainsert buffer\u4e2d\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f53\u968f\u540e\u9875\u9762\u88ab\u8bfb\u5230\u5185\u5b58\u4e2d\u65f6\uff0c\u4f1a\u5c06\u8fd9\u4e9b\u53d8\u5316\u7684\u8bb0\u5f55merge\u5230\u9875\u4e2d\u3002\u5f53\u670d\u52a1\u5668\u6bd4\u8f83\u7a7a\u95f2\u65f6\uff0c\u540e\u53f0\u7ebf\u7a0b\u4e5f\u4f1a\u505amerge\u64cd\u4f5c innodb_adaptive_flushing = 1\u3000\u3000\u3000\u3000\u3000\u3000 # \u8be5\u503c\u5f71\u54cd\u6bcf\u79d2\u5237\u65b0\u810f\u9875\u7684\u64cd\u4f5c\uff0c\u5f00\u542f\u6b64\u914d\u7f6e\u540e\uff0c\u5237\u65b0\u810f\u9875\u4f1a\u901a\u8fc7\u5224\u65ad\u4ea7\u751f\u91cd\u505a\u65e5\u5fd7\u7684\u901f\u5ea6\u6765\u5224\u65ad\u6700\u5408\u9002\u7684\u5237\u65b0\u810f\u9875\u7684\u6570\u91cf\uff1b transaction-isolation = READ-COMMITTED\u3000 \u3000# \u6570\u636e\u5e93\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b \uff0c\u8bfb\u53d6\u63d0\u4ea4\u5185\u5bb9 innodb_flush_method = O_DIRECT\u3000\u3000\u3000\u3000\u3000\u3000 # innodb_flush_method\u8fd9\u4e2a\u53c2\u6570\u63a7\u5236\u7740innodb\u6570\u636e\u6587\u4ef6\u53caredo log\u7684\u6253\u5f00\u3001\u5237\u5199\u6a21\u5f0f \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# InnoDB\u4f7f\u7528O_DIRECT\u6a21\u5f0f\u6253\u5f00\u6570\u636e\u6587\u4ef6\uff0c\u7528fsync()\u51fd\u6570\u53bb\u66f4\u65b0\u65e5\u5fd7\u548c\u6570\u636e\u6587\u4ef6\u3002 #innodb_use_sys_malloc = 1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u9ed8\u8ba4\u8bbe\u7f6e\u503c\u4e3a1.\u8bbe\u7f6e\u4e3a0\uff1a\u8868\u793aInnodb\u4f7f\u7528\u81ea\u5e26\u7684\u5185\u5b58\u5206\u914d\u7a0b\u5e8f\uff1b\u8bbe\u7f6e\u4e3a1\uff1a\u8868\u793aInnoDB\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u5206\u914d\u7a0b\u5e8f\u3002 [mysqldump] quick\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5b83\u5f3a\u5236 mysqldump \u4ece\u670d\u52a1\u5668\u67e5\u8be2\u53d6\u5f97\u8bb0\u5f55\u76f4\u63a5\u8f93\u51fa\u800c\u4e0d\u662f\u53d6\u5f97\u6240\u6709\u8bb0\u5f55\u540e\u5c06\u5b83\u4eec\u7f13\u5b58\u5230\u5185\u5b58\u4e2d max_allowed_packet = 512M \u3000\u3000\u3000\u3000 \u3000\u3000# \u9650\u5236server\u63a5\u53d7\u7684\u6570\u636e\u5305\u5927\u5c0f;\u6307\u4ee3mysql\u670d\u52a1\u5668\u7aef\u548c\u5ba2\u6237\u7aef\u5728\u4e00\u6b21\u4f20\u9001\u6570\u636e\u5305\u7684\u8fc7\u7a0b\u5f53\u4e2d\u6570\u636e\u5305\u7684\u5927\u5c0f net_buffer_length = 16384 \u3000\u3000\u3000\u3000 \u3000\u3000# TCP/IP\u548c\u5957\u63a5\u5b57\u901a\u4fe1\u7f13\u51b2\u533a\u5927\u5c0f,\u521b\u5efa\u957f\u5ea6\u8fbenet_buffer_length\u7684\u884c [mysql] auto-rehash\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # auto-rehash\u662f\u81ea\u52a8\u8865\u5168\u7684\u610f\u601d [isamchk] \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # isamchk\u6570\u636e\u68c0\u6d4b\u6062\u590d\u5de5\u5177 key_buffer = 256M sort_buffer_size = 256M read_buffer = 2M write_buffer = 2M [myisamchk]\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4f7f\u7528myisamchk\u5b9e\u7528\u7a0b\u5e8f\u6765\u83b7\u5f97\u6709\u5173\u4f60\u7684\u6570\u636e\u5e93\u684c\u8868\u7684\u4fe1\u606f\u3001\u68c0\u67e5\u548c\u4fee\u590d\u4ed6\u4eec\u6216\u4f18\u5316\u4ed6\u4eec key_buffer = 256M sort_buffer_size = 256M read_buffer = 2M write_buffer = 2M [mysqlhotcopy] interactive-timeout # mysqlhotcopy\u4f7f\u7528lock tables\u3001flush tables\u548ccp\u6216scp\u6765\u5feb\u901f\u5907\u4efd\u6570\u636e\u5e93.\u5b83\u662f\u5907\u4efd\u6570\u636e\u5e93\u6216\u5355\u4e2a\u8868\u6700\u5feb\u7684\u9014\u5f84,\u5b8c\u5168\u5c5e\u4e8e\u7269\u7406\u5907\u4efd,\u4f46\u53ea\u80fd\u7528\u4e8e\u5907\u4efdMyISAM\u5b58\u50a8\u5f15\u64ce\u548c\u8fd0\u884c\u5728\u6570\u636e\u5e93\u76ee\u5f55\u6240\u5728\u7684\u673a\u5668\u4e0a. \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u4e0emysqldump\u5907\u4efd\u4e0d\u540c,mysqldump\u5c5e\u4e8e\u903b\u8f91\u5907\u4efd,\u5907\u4efd\u65f6\u662f\u6267\u884c\u7684sql\u8bed\u53e5.\u4f7f\u7528mysqlhotcopy\u547d\u4ee4\u524d\u9700\u8981\u8981\u5b89\u88c5\u76f8\u5e94\u7684\u8f6f\u4ef6\u4f9d\u8d56\u5305.","title":"02. \u914d\u7f6e\u6587\u4ef6"},{"location":"mysql/mysql.mysqlcnf/#1","text":"\u5bf9\u4e8eMySQL\u7684\u7406\u89e3\uff0c\u6211\u8ba4\u4e3a\u5f88\u591a\u6027\u80fd\u4f18\u5316\u5de5\u4f5c\u3001\u4e3b\u4ece\u4e3b\u4e3b\u590d\u5236\u90fd\u662f\u5728\u8c03\u6574\u53c2\u6570\uff0c\u6765\u9002\u5e94\u4e0d\u540c\u65f6\u671f\u4e0d\u540c\u6570\u91cf\u7ea7\u7684\u6570\u636e\u3002\u6545\uff0c\u7406\u89e3\u900f\u5f7bmy.cnf\u91cc\u7684\u53c2\u6570\u662f\u6c38\u6052\u7684\u8bdd\u9898\uff1b\u53ea\u6709\u7406\u89e3\u900f\u5f7b\u4e86\u53c2\u6570\u8bbe\u7f6e\uff0c\u624d\u80fd\u5728\u67d0\u4e9b\u65b9\u9762\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u8c03\u4f18\u3002","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.mysqlcnf/#2","text":"[client] \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u5ba2\u6237\u7aef\u8bbe\u7f6e\uff0c\u5373\u5ba2\u6237\u7aef\u9ed8\u8ba4\u7684\u8fde\u63a5\u53c2\u6570 port = 3306\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u9ed8\u8ba4\u8fde\u63a5\u7aef\u53e3 socket = /var/run/mysqld/mysqld.sock # \u7528\u4e8e\u672c\u5730\u8fde\u63a5\u7684socket\u5957\u63a5\u5b57 default-character-set = utf8mb4\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u7f16\u7801 [mysqld] \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u670d\u52a1\u7aef\u57fa\u672c\u8bbe\u7f6e port = 3306 # MySQL\u76d1\u542c\u7aef\u53e3 socket = /var/run/mysqld/mysqld.sock \u3000\u3000 # \u4e3aMySQL\u5ba2\u6237\u7aef\u7a0b\u5e8f\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u672c\u5730\u901a\u8baf\u6307\u5b9a\u4e00\u4e2a\u5957\u63a5\u5b57\u6587\u4ef6 pid-file = /var/run/mysqld/mysqld.pid \u3000\u3000# pid\u6587\u4ef6\u6240\u5728\u76ee\u5f55 basedir = /usr \u3000\u3000\u3000\u3000\u3000 # \u4f7f\u7528\u8be5\u76ee\u5f55\u4f5c\u4e3a\u6839\u76ee\u5f55\uff08\u5b89\u88c5\u76ee\u5f55\uff09 datadir = /var/lib/mysql \u3000\u3000\u3000\u3000\u3000# \u6570\u636e\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55 tmpdir = /tmp \u3000\u3000\u3000\u3000 # MySQL\u5b58\u653e\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55 character_set_server = utf8mb4 \u3000\u3000\u3000\u3000\u3000\u3000 # \u670d\u52a1\u7aef\u9ed8\u8ba4\u7f16\u7801\uff08\u6570\u636e\u5e93\u7ea7\u522b\uff09 collation_server = utf8mb4_bin \u3000\u3000\u3000\u3000\u3000\u3000 # \u670d\u52a1\u7aef\u9ed8\u8ba4\u7684\u6bd4\u5bf9\u89c4\u5219\uff0c\u6392\u5e8f\u89c4\u5219 user = mysql \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # MySQL\u542f\u52a8\u7528\u6237 log_bin_trust_function_creators = 1 \u3000\u3000\u3000\u3000 # This variable applies when binary logging is enabled. It controls whether stored function creators can be trusted not to create stored functions that will cause \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # unsafe events to be written to the binary log. If set to 0 (the default), users are not permitted to create or alter stored functions unless they have the SUPER \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # privilege in addition to the CREATE ROUTINE or ALTER ROUTINE privilege. \u5f00\u542f\u4e86binlog\u540e\uff0c\u5fc5\u987b\u8bbe\u7f6e\u8fd9\u4e2a\u503c\u4e3a1.\u4e3b\u8981\u662f\u8003\u8651binlog\u5b89\u5168 performance_schema = 0 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u6027\u80fd\u4f18\u5316\u7684\u5f15\u64ce\uff0c\u9ed8\u8ba4\u5173\u95ed secure_auth = 1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# secure_auth \u4e3a\u4e86\u9632\u6b62\u4f4e\u7248\u672c\u7684MySQL\u5ba2\u6237\u7aef(<4.1)\u4f7f\u7528\u65e7\u7684\u5bc6\u7801\u8ba4\u8bc1\u65b9\u5f0f\u8bbf\u95ee\u9ad8\u7248\u672c\u7684\u670d\u52a1\u5668\u3002MySQL 5.6.7\u5f00\u59cbsecure_auth \u9ed8\u8ba4\u4e3a\u542f\u7528\u503c1 #ft_min_word_len = 1 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f00\u542f\u5168\u6587\u7d22\u5f15 #myisam_recover \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u81ea\u52a8\u4fee\u590dMySQL\u7684myisam\u8868 explicit_defaults_for_timestamp \u3000\u3000\u3000\u3000\u3000\u3000 # \u660e\u786e\u65f6\u95f4\u6233\u9ed8\u8ba4null\u65b9\u5f0f event_scheduler \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8ba1\u5212\u4efb\u52a1\uff08\u4e8b\u4ef6\u8c03\u5ea6\u5668\uff09 skip-external-locking\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u8df3\u8fc7\u5916\u90e8\u9501\u5b9a;External-locking\u7528\u4e8e\u591a\u8fdb\u7a0b\u6761\u4ef6\u4e0b\u4e3aMyISAM\u6570\u636e\u8868\u8fdb\u884c\u9501\u5b9a skip-name-resolve\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u8df3\u8fc7\u5ba2\u6237\u7aef\u57df\u540d\u89e3\u6790\uff1b\u5f53\u65b0\u7684\u5ba2\u6237\u8fde\u63a5mysqld\u65f6\uff0cmysqld\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\u6765\u5904\u7406\u8bf7\u6c42\u3002\u8be5\u7ebf\u7a0b\u5148\u68c0\u67e5\u662f\u5426\u4e3b\u673a\u540d\u5728\u4e3b\u673a\u540d\u7f13\u5b58\u4e2d\u3002\u5982\u679c\u4e0d\u5728\uff0c\u7ebf\u7a0b\u8bd5\u56fe\u89e3\u6790\u4e3b\u673a\u540d\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4f7f\u7528\u8fd9\u4e00\u9009\u9879\u4ee5\u6d88\u9664MySQL\u8fdb\u884cDNS\u89e3\u6790\u7684\u65f6\u95f4\u3002\u4f46\u9700\u8981\u6ce8\u610f\uff0c\u5982\u679c\u5f00\u542f\u8be5\u9009\u9879\uff0c\u5219\u6240\u6709\u8fdc\u7a0b\u4e3b\u673a\u8fde\u63a5\u6388\u6743\u90fd\u8981\u4f7f\u7528IP\u5730\u5740\u65b9\u5f0f\uff0c\u5426\u5219MySQL\u5c06\u65e0\u6cd5\u6b63\u5e38\u5904\u7406\u8fde\u63a5\u8bf7\u6c42! #bind-address = 127.0.0.1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# MySQL\u7ed1\u5b9aIP, # 1. 127.0.0.1-> \u53ea\u80fd\u672c\u5730\u8fde\u63a5 # 2. 0.0.0.0 \u2014> \u5141\u8bb8\u5176\u4ed6\u673a\u5668\u8fde\u63a5 skip-slave-start\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4e3a\u4e86\u5b89\u5168\u8d77\u89c1\uff0c\u590d\u5236\u73af\u5883\u7684\u6570\u636e\u5e93\u8fd8\u662f\u8bbe\u7f6e--skip-slave-start\u53c2\u6570\uff0c\u9632\u6b62\u590d\u5236\u968f\u7740mysql\u542f\u52a8\u800c\u81ea\u52a8\u542f\u52a8 slave_net_timeout = 30 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # The number of seconds to wait for more data from a master/slave connection before aborting the read. MySQL\u4e3b\u4ece\u590d\u5236\u7684\u65f6\u5019\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f53Master\u548cSlave\u4e4b\u95f4\u7684\u7f51\u7edc\u4e2d\u65ad\uff0c\u4f46\u662fMaster\u548cSlave\u65e0\u6cd5\u5bdf\u89c9\u7684\u60c5\u51b5\u4e0b\uff08\u6bd4\u5982\u9632\u706b\u5899\u6216\u8005\u8def\u7531\u95ee\u9898\uff09\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # Slave\u4f1a\u7b49\u5f85slave_net_timeout\u8bbe\u7f6e\u7684\u79d2\u6570\u540e\uff0c\u624d\u80fd\u8ba4\u4e3a\u7f51\u7edc\u51fa\u73b0\u6545\u969c\uff0c\u7136\u540e\u624d\u4f1a\u91cd\u8fde\u5e76\u4e14\u8ffd\u8d76\u8fd9\u6bb5\u65f6\u95f4\u4e3b\u5e93\u7684\u6570\u636e\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # 1.\u7528\u8fd9\u4e09\u4e2a\u53c2\u6570\u6765\u5224\u65ad\u4e3b\u4ece\u662f\u5426\u5ef6\u8fdf\u662f\u4e0d\u51c6\u786e\u7684Slave_IO_Running,Slave_SQL_Running,Seconds_Behind_Master.\u8fd8\u662f\u7528pt-heartbeat\u5427\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # 2.slave_net_timeout\u4e0d\u8981\u7528\u9ed8\u8ba4\u503c\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u4f60\u80fd\u63a5\u53d7\u7684\u5ef6\u65f6\u65f6\u95f4\u3002 local-infile = 0 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8bbe\u5b9a\u662f\u5426\u652f\u6301\u547d\u4ee4load data local infile\u3002\u5982\u679c\u6307\u5b9alocal\u5173\u952e\u8bcd\uff0c\u5219\u8868\u660e\u652f\u6301\u4ece\u5ba2\u6237\u4e3b\u673a\u8bfb\u6587\u4ef6 back_log = 1024 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u6307\u5b9aMySQL\u53ef\u80fd\u7684\u8fde\u63a5\u6570\u91cf\u3002\u5f53MySQL\u4e3b\u7ebf\u7a0b\u5728\u5f88\u77ed\u7684\u65f6\u95f4\u5185\u5f97\u5230\u975e\u5e38\u591a\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u8be5\u53c2\u6570\u5c31\u8d77\u4f5c\u7528\uff0c\u4e4b\u540e\u4e3b\u7ebf\u7a0b\u82b1\u4e9b\u65f6\u95f4\uff08\u5c3d\u7ba1\u5f88\u77ed\uff09\u68c0\u67e5\u8fde\u63a5\u5e76\u4e14\u542f\u52a8\u4e00\u4e2a\u65b0\u7ebf\u7a0b\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # back_log\u53c2\u6570\u7684\u503c\u6307\u51fa\u5728MySQL\u6682\u65f6\u505c\u6b62\u54cd\u5e94\u65b0\u8bf7\u6c42\u4e4b\u524d\u7684\u77ed\u65f6\u95f4\u5185\u591a\u5c11\u4e2a\u8bf7\u6c42\u53ef\u4ee5\u88ab\u5b58\u5728\u5806\u6808\u4e2d\u3002 #sql_mode = 'PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,NO_KEY_OPTIONS,NO_TABLE_OPTIONS,NO_FIELD_OPTIONS,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' sql_mode = NO_ENGINE_SUBSTITUTION,NO_AUTO_CREATE_USER\u3000\u3000# sql_mode,\u5b9a\u4e49\u4e86mysql\u5e94\u8be5\u652f\u6301\u7684sql\u8bed\u6cd5\uff0c\u6570\u636e\u6821\u9a8c\u7b49! NO_AUTO_CREATE_USER\uff1a\u7981\u6b62GRANT\u521b\u5efa\u5bc6\u7801\u4e3a\u7a7a\u7684\u7528\u6237\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # NO_ENGINE_SUBSTITUTION \u5982\u679c\u9700\u8981\u7684\u5b58\u50a8\u5f15\u64ce\u88ab\u7981\u7528\u6216\u672a\u7f16\u8bd1\uff0c\u53ef\u4ee5\u9632\u6b62\u81ea\u52a8\u66ff\u6362\u5b58\u50a8\u5f15\u64ce key_buffer_size = 32M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000#\u7d22\u5f15\u5757\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u5bf9MyISAM\u8868\u6027\u80fd\u5f71\u54cd\u6700\u5927\u7684\u4e00\u4e2a\u53c2\u6570.\u51b3\u5b9a\u7d22\u5f15\u5904\u7406\u7684\u901f\u5ea6\uff0c\u5c24\u5176\u662f\u7d22\u5f15\u8bfb\u7684\u901f\u5ea6\u3002\u9ed8\u8ba4\u503c\u662f16M\uff0c\u901a\u8fc7\u68c0\u67e5\u72b6\u6001\u503cKey_read_requests \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 #\u548cKey_reads\uff0c\u53ef\u4ee5\u77e5\u9053key_buffer_size\u8bbe\u7f6e\u662f\u5426\u5408\u7406 max_allowed_packet = 512M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u4e00\u4e2a\u67e5\u8be2\u8bed\u53e5\u5305\u7684\u6700\u5927\u5c3a\u5bf8\u3002\u6d88\u606f\u7f13\u51b2\u533a\u88ab\u521d\u59cb\u5316\u4e3anet_buffer_length\u5b57\u8282\uff0c\u4f46\u662f\u53ef\u5728\u9700\u8981\u65f6\u589e\u52a0\u5230max_allowed_packet\u4e2a\u5b57\u8282\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8be5\u503c\u592a\u5c0f\u5219\u4f1a\u5728\u5904\u7406\u5927\u5305\u65f6\u4ea7\u751f\u9519\u8bef\u3002\u5982\u679c\u4f7f\u7528\u5927\u7684BLOB\u5217\uff0c\u5fc5\u987b\u589e\u52a0\u8be5\u503c\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8fd9\u4e2a\u503c\u6765\u9650\u5236server\u63a5\u53d7\u7684\u6570\u636e\u5305\u5927\u5c0f\u3002\u6709\u65f6\u5019\u5927\u7684\u63d2\u5165\u548c\u66f4\u65b0\u4f1a\u53d7max_allowed_packet \u53c2\u6570\u9650\u5236\uff0c\u5bfc\u81f4\u5199\u5165\u6216\u8005\u66f4\u65b0\u5931\u8d25\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 thread_stack = 256K\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u7ebf\u7a0b\u7f13\u5b58\uff1b\u4e3b\u8981\u7528\u6765\u5b58\u653e\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u81ea\u8eab\u7684\u6807\u8bc6\u4fe1\u606f\uff0c\u5982\u7ebf\u7a0bid\uff0c\u7ebf\u7a0b\u8fd0\u884c\u65f6\u57fa\u672c\u4fe1\u606f\u7b49\u7b49\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 thread_stack \u53c2\u6570\u6765\u8bbe\u7f6e\u4e3a\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u6808\u5206\u914d\u591a\u5927\u7684\u5185\u5b58\u3002 sort_buffer_size = 16M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u662fMySQL\u6267\u884c\u6392\u5e8f\u4f7f\u7528\u7684\u7f13\u51b2\u5927\u5c0f\u3002\u5982\u679c\u60f3\u8981\u589e\u52a0ORDER BY\u7684\u901f\u5ea6\uff0c\u9996\u5148\u770b\u662f\u5426\u53ef\u4ee5\u8ba9MySQL\u4f7f\u7528\u7d22\u5f15\u800c\u4e0d\u662f\u989d\u5916\u7684\u6392\u5e8f\u9636\u6bb5\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5982\u679c\u4e0d\u80fd\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u589e\u52a0sort_buffer_size\u53d8\u91cf\u7684\u5927\u5c0f\u3002 read_buffer_size = 16M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u662fMySQL\u8bfb\u5165\u7f13\u51b2\u533a\u5927\u5c0f\u3002\u5bf9\u8868\u8fdb\u884c\u987a\u5e8f\u626b\u63cf\u7684\u8bf7\u6c42\u5c06\u5206\u914d\u4e00\u4e2a\u8bfb\u5165\u7f13\u51b2\u533a\uff0cMySQL\u4f1a\u4e3a\u5b83\u5206\u914d\u4e00\u6bb5\u5185\u5b58\u7f13\u51b2\u533a\u3002read_buffer_size\u53d8\u91cf\u63a7\u5236\u8fd9\u4e00\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5982\u679c\u5bf9\u8868\u7684\u987a\u5e8f\u626b\u63cf\u8bf7\u6c42\u975e\u5e38\u9891\u7e41\uff0c\u5e76\u4e14\u4f60\u8ba4\u4e3a\u9891\u7e41\u626b\u63cf\u8fdb\u884c\u5f97\u592a\u6162\uff0c\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0\u8be5\u53d8\u91cf\u503c\u4ee5\u53ca\u5185\u5b58\u7f13\u51b2\u533a\u5927\u5c0f\u63d0\u9ad8\u5176\u6027\u80fd\u3002 join_buffer_size = 16M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5e94\u7528\u7a0b\u5e8f\u7ecf\u5e38\u4f1a\u51fa\u73b0\u4e00\u4e9b\u4e24\u8868\uff08\u6216\u591a\u8868\uff09Join\u7684\u64cd\u4f5c\u9700\u6c42\uff0cMySQL\u5728\u5b8c\u6210\u67d0\u4e9b Join \u9700\u6c42\u7684\u65f6\u5019\uff08all/index join\uff09\uff0c\u4e3a\u4e86\u51cf\u5c11\u53c2\u4e0eJoin\u7684\u201c\u88ab\u9a71\u52a8\u8868\u201d\u7684 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8bfb\u53d6\u6b21\u6570\u4ee5\u63d0\u9ad8\u6027\u80fd\uff0c\u9700\u8981\u4f7f\u7528\u5230 Join Buffer \u6765\u534f\u52a9\u5b8c\u6210 Join\u64cd\u4f5c\u3002\u5f53 Join Buffer \u592a\u5c0f\uff0cMySQL \u4e0d\u4f1a\u5c06\u8be5 Buffer \u5b58\u5165\u78c1\u76d8\u6587\u4ef6\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u800c\u662f\u5148\u5c06Join Buffer\u4e2d\u7684\u7ed3\u679c\u96c6\u4e0e\u9700\u8981 Join \u7684\u8868\u8fdb\u884c Join \u64cd\u4f5c\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u7136\u540e\u6e05\u7a7a Join Buffer \u4e2d\u7684\u6570\u636e\uff0c\u7ee7\u7eed\u5c06\u5269\u4f59\u7684\u7ed3\u679c\u96c6\u5199\u5165\u6b64 Buffer \u4e2d\uff0c\u5982\u6b64\u5f80\u590d\u3002\u8fd9\u52bf\u5fc5\u4f1a\u9020\u6210\u88ab\u9a71\u52a8\u8868\u9700\u8981\u88ab\u591a\u6b21\u8bfb\u53d6\uff0c\u6210\u500d\u589e\u52a0 IO \u8bbf\u95ee\uff0c\u964d\u4f4e\u6548\u7387\u3002 read_rnd_buffer_size = 32M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u662fMySQL\u7684\u968f\u673a\u8bfb\u7f13\u51b2\u533a\u5927\u5c0f\u3002\u5f53\u6309\u4efb\u610f\u987a\u5e8f\u8bfb\u53d6\u884c\u65f6(\u4f8b\u5982\uff0c\u6309\u7167\u6392\u5e8f\u987a\u5e8f)\uff0c\u5c06\u5206\u914d\u4e00\u4e2a\u968f\u673a\u8bfb\u7f13\u5b58\u533a\u3002\u8fdb\u884c\u6392\u5e8f\u67e5\u8be2\u65f6\uff0cMySQL\u4f1a\u9996\u5148\u626b\u63cf\u4e00\u904d\u8be5\u7f13\u51b2\uff0c\u4ee5\u907f\u514d\u78c1\u76d8\u641c\u7d22\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u63d0\u9ad8\u67e5\u8be2\u901f\u5ea6\uff0c\u5982\u679c\u9700\u8981\u6392\u5e8f\u5927\u91cf\u6570\u636e\uff0c\u53ef\u9002\u5f53\u8c03\u9ad8\u8be5\u503c\u3002\u4f46MySQL\u4f1a\u4e3a\u6bcf\u4e2a\u5ba2\u6237\u8fde\u63a5\u53d1\u653e\u8be5\u7f13\u51b2\u7a7a\u95f4\uff0c\u6240\u4ee5\u5e94\u5c3d\u91cf\u9002\u5f53\u8bbe\u7f6e\u8be5\u503c\uff0c\u4ee5\u907f\u514d\u5185\u5b58\u5f00\u9500\u8fc7\u5927\u3002 net_buffer_length = 16K\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u901a\u4fe1\u7f13\u51b2\u533a\u5728\u67e5\u8be2\u671f\u95f4\u88ab\u91cd\u7f6e\u5230\u8be5\u5927\u5c0f\u3002\u901a\u5e38\u4e0d\u8981\u6539\u53d8\u8be5\u53c2\u6570\u503c\uff0c\u4f46\u662f\u5982\u679c\u5185\u5b58\u4e0d\u8db3\uff0c\u53ef\u4ee5\u5c06\u5b83\u8bbe\u7f6e\u4e3a\u67e5\u8be2\u671f\u671b\u7684\u5927\u5c0f\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 #\uff08\u5373\uff0c\u5ba2\u6237\u53d1\u51fa\u7684SQL\u8bed\u53e5\u671f\u671b\u7684\u957f\u5ea6\u3002\u5982\u679c\u8bed\u53e5\u8d85\u8fc7\u8fd9\u4e2a\u957f\u5ea6\uff0c\u7f13\u51b2\u533a\u81ea\u52a8\u5730\u88ab\u6269\u5927\uff0c\u76f4\u5230max_allowed_packet\u4e2a\u5b57\u8282\u3002\uff09 myisam_sort_buffer_size = 128M\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f53\u5bf9MyISAM\u8868\u6267\u884crepair table\u6216\u521b\u5efa\u7d22\u5f15\u65f6\uff0c\u7528\u4ee5\u7f13\u5b58\u6392\u5e8f\u7d22\u5f15\uff1b\u8bbe\u7f6e\u592a\u5c0f\u65f6\u53ef\u80fd\u4f1a\u9047\u5230\u201d myisam_sort_buffer_size is too small\u201d bulk_insert_buffer_size = 32M\u3000\u3000\u3000\u3000\u3000\u3000 # \u9ed8\u8ba48M\uff0c\u5f53\u5bf9MyISAM\u975e\u7a7a\u8868\u6267\u884cinsert \u2026 select/ insert \u2026 values(\u2026),(\u2026)\u6216\u8005load data infile\u65f6\uff0c\u4f7f\u7528\u6811\u72b6cache\u7f13\u5b58\u6570\u636e\uff0c\u6bcf\u4e2athread\u5206\u914d\u4e00\u4e2a\uff1b \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u6ce8\uff1a\u5f53\u5bf9MyISAM\u8868load \u5927\u6587\u4ef6\u65f6\uff0c\u8c03\u5927bulk_insert_buffer_size/myisam_sort_buffer_size/key_buffer_size\u4f1a\u6781\u5927\u63d0\u5347\u901f\u5ea6 thread_cache_size = 384\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # thread_cahe_size\u7ebf\u7a0b\u6c60\uff0c\u7ebf\u7a0b\u7f13\u5b58\u3002\u7528\u6765\u7f13\u5b58\u7a7a\u95f2\u7684\u7ebf\u7a0b\uff0c\u4ee5\u81f3\u4e8e\u4e0d\u88ab\u9500\u6bc1\uff0c\u5982\u679c\u7ebf\u7a0b\u7f13\u5b58\u5728\u7684\u7a7a\u95f2\u7ebf\u7a0b\uff0c\u9700\u8981\u91cd\u65b0\u5efa\u7acb\u65b0\u8fde\u63a5\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5219\u4f1a\u4f18\u5148\u8c03\u7528\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7f13\u5b58\uff0c\u5f88\u5feb\u5c31\u80fd\u54cd\u5e94\u8fde\u63a5\u8bf7\u6c42\u3002\u6bcf\u5efa\u7acb\u4e00\u4e2a\u8fde\u63a5\uff0c\u90fd\u9700\u8981\u4e00\u4e2a\u7ebf\u7a0b\u4e0e\u4e4b\u5339\u914d\u3002 query_cache_size = 0\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5de5\u4f5c\u539f\u7406\uff1a \u4e00\u4e2aSELECT\u67e5\u8be2\u5728DB\u4e2d\u5de5\u4f5c\u540e\uff0cDB\u4f1a\u628a\u8be5\u8bed\u53e5\u7f13\u5b58\u4e0b\u6765\uff0c\u5f53\u540c\u6837\u7684\u4e00\u4e2aSQL\u518d\u6b21\u6765\u5230DB\u91cc\u8c03\u7528\u65f6\uff0cDB\u5728\u8be5\u8868\u6ca1\u53d1\u751f\u53d8\u5316\u7684\u60c5\u51b5\u4e0b\u628a\u7ed3\u679c\u4ece\u7f13\u5b58\u4e2d\u8fd4\u56de\u7ed9Client\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5728\u6570\u636e\u5e93\u5199\u5165\u91cf\u6216\u662f\u66f4\u65b0\u91cf\u4e5f\u6bd4\u8f83\u5927\u7684\u7cfb\u7edf\uff0c\u8be5\u53c2\u6570\u4e0d\u9002\u5408\u5206\u914d\u8fc7\u5927\u3002\u800c\u4e14\u5728\u9ad8\u5e76\u53d1\uff0c\u5199\u5165\u91cf\u5927\u7684\u7cfb\u7edf\uff0c\u5efa\u7cfb\u628a\u8be5\u529f\u80fd\u7981\u6389\u3002 query_cache_type = 0\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u51b3\u5b9a\u662f\u5426\u7f13\u5b58\u67e5\u8be2\u7ed3\u679c\u3002\u8fd9\u4e2a\u53d8\u91cf\u6709\u4e09\u4e2a\u53d6\u503c\uff1a0,1,2\uff0c\u5206\u522b\u4ee3\u8868\u4e86off\u3001on\u3001demand\u3002\u3000\u3000\u3000\u3000\u3000\u3000\u3000 tmp_table_size = 1024M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5b83\u89c4\u5b9a\u4e86\u5185\u90e8\u5185\u5b58\u4e34\u65f6\u8868\u7684\u6700\u5927\u503c\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u8981\u5206\u914d\u3002\uff08\u5b9e\u9645\u8d77\u9650\u5236\u4f5c\u7528\u7684\u662ftmp_table_size\u548cmax_heap_table_size\u7684\u6700\u5c0f\u503c\u3002\uff09 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5982\u679c\u5185\u5b58\u4e34\u65f6\u8868\u8d85\u51fa\u4e86\u9650\u5236\uff0cMySQL\u5c31\u4f1a\u81ea\u52a8\u5730\u628a\u5b83\u8f6c\u5316\u4e3a\u57fa\u4e8e\u78c1\u76d8\u7684MyISAM\u8868\uff0c\u5b58\u50a8\u5728\u6307\u5b9a\u7684tmpdir\u76ee\u5f55\u4e0b max_heap_table_size = 512M \u3000\u3000\u3000\u3000\u3000\u3000 # \u72ec\u7acb\u7684\u5185\u5b58\u8868\u6240\u5141\u8bb8\u7684\u6700\u5927\u5bb9\u91cf.# \u6b64\u9009\u9879\u4e3a\u4e86\u9632\u6b62\u610f\u5916\u521b\u5efa\u4e00\u4e2a\u8d85\u5927\u7684\u5185\u5b58\u8868\u5bfc\u81f4\u6c38\u5c3d\u6240\u6709\u7684\u5185\u5b58\u8d44\u6e90. open_files_limit = 10240\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # mysql\u6253\u5f00\u6700\u5927\u6587\u4ef6\u6570 max_connections = 2000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # MySQL\u65e0\u8bba\u5982\u4f55\u90fd\u4f1a\u4fdd\u7559\u4e00\u4e2a\u7528\u4e8e\u7ba1\u7406\u5458\uff08SUPER\uff09\u767b\u9646\u7684\u8fde\u63a5\uff0c\u7528\u4e8e\u7ba1\u7406\u5458\u8fde\u63a5\u6570\u636e\u5e93\u8fdb\u884c\u7ef4\u62a4\u64cd\u4f5c\uff0c\u5373\u4f7f\u5f53\u524d\u8fde\u63a5\u6570\u5df2\u7ecf\u8fbe\u5230\u4e86max_connections\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u56e0\u6b64MySQL\u7684\u5b9e\u9645\u6700\u5927\u53ef\u8fde\u63a5\u6570\u4e3amax_connections+1\uff1b \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8fd9\u4e2a\u53c2\u6570\u5b9e\u9645\u8d77\u4f5c\u7528\u7684\u6700\u5927\u503c\uff08\u5b9e\u9645\u6700\u5927\u53ef\u8fde\u63a5\u6570\uff09\u4e3a16384\uff0c\u5373\u8be5\u53c2\u6570\u6700\u5927\u503c\u4e0d\u80fd\u8d85\u8fc716384\uff0c\u5373\u4f7f\u8d85\u8fc7\u4e5f\u4ee516384\u4e3a\u51c6\uff1b \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u589e\u52a0max_connections\u53c2\u6570\u7684\u503c\uff0c\u4e0d\u4f1a\u5360\u7528\u592a\u591a\u7cfb\u7edf\u8d44\u6e90\u3002\u7cfb\u7edf\u8d44\u6e90\uff08CPU\u3001\u5185\u5b58\uff09\u7684\u5360\u7528\u4e3b\u8981\u53d6\u51b3\u4e8e\u67e5\u8be2\u7684\u5bc6\u5ea6\u3001\u6548\u7387\u7b49\uff1b \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8be5\u53c2\u6570\u8bbe\u7f6e\u8fc7\u5c0f\u7684\u6700\u660e\u663e\u7279\u5f81\u662f\u51fa\u73b0\u201dToo many connections\u201d\u9519\u8bef\uff1b max-user-connections = 0\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u7528\u6765\u9650\u5236\u7528\u6237\u8d44\u6e90\u7684\uff0c0\u4e0d\u9650\u5236\uff1b\u5bf9\u6574\u4e2a\u670d\u52a1\u5668\u7684\u7528\u6237\u9650\u5236 max_connect_errors = 100000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# max_connect_errors\u662f\u4e00\u4e2aMySQL\u4e2d\u4e0e\u5b89\u5168\u6709\u5173\u7684\u8ba1\u6570\u5668\u503c\uff0c\u5b83\u8d1f\u8d23\u963b\u6b62\u8fc7\u591a\u5c1d\u8bd5\u5931\u8d25\u7684\u5ba2\u6237\u7aef\u4ee5\u9632\u6b62\u66b4\u529b\u7834\u89e3\u5bc6\u7801\u7684\u60c5\u51b5\u3002max_connect_errors\u7684\u503c\u4e0e\u6027\u80fd\u5e76\u65e0\u592a\u5927\u5173\u7cfb\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f53\u6b64\u503c\u8bbe\u7f6e\u4e3a10\u65f6\uff0c\u610f\u5473\u7740\u5982\u679c\u67d0\u4e00\u5ba2\u6237\u7aef\u5c1d\u8bd5\u8fde\u63a5\u6b64MySQL\u670d\u52a1\u5668\uff0c\u4f46\u662f\u5931\u8d25\uff08\u5982\u5bc6\u7801\u9519\u8bef\u7b49\u7b49\uff0910\u6b21\uff0c\u5219MySQL\u4f1a\u65e0\u6761\u4ef6\u5f3a\u5236\u963b\u6b62\u6b64\u5ba2\u6237\u7aef\u8fde\u63a5\u3002 table_open_cache = 5120\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u8868\u63cf\u8ff0\u7b26\u7f13\u5b58\u5927\u5c0f\uff0c\u53ef\u51cf\u5c11\u6587\u4ef6\u6253\u5f00/\u5173\u95ed\u6b21\u6570\uff1b interactive_timeout = 86400\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# interactive_time -- \u6307\u7684\u662fmysql\u5728\u5173\u95ed\u4e00\u4e2a\u4ea4\u4e92\u7684\u8fde\u63a5\u4e4b\u524d\u6240\u8981\u7b49\u5f85\u7684\u79d2\u6570(\u4ea4\u4e92\u8fde\u63a5\u5982mysql gui tool\u4e2d\u7684\u8fde\u63a5 wait_timeout = 86400\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # wait_timeout -- \u6307\u7684\u662fMySQL\u5728\u5173\u95ed\u4e00\u4e2a\u975e\u4ea4\u4e92\u7684\u8fde\u63a5\u4e4b\u524d\u6240\u8981\u7b49\u5f85\u7684\u79d2\u6570 binlog_cache_size = 16M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u4e8c\u8fdb\u5236\u65e5\u5fd7\u7f13\u51b2\u5927\u5c0f \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u6211\u4eec\u77e5\u9053InnoDB\u5b58\u50a8\u5f15\u64ce\u662f\u652f\u6301\u4e8b\u52a1\u7684\uff0c\u5b9e\u73b0\u4e8b\u52a1\u9700\u8981\u4f9d\u8d56\u4e8e\u65e5\u5fd7\u6280\u672f\uff0c\u4e3a\u4e86\u6027\u80fd\uff0c\u65e5\u5fd7\u7f16\u7801\u91c7\u7528\u4e8c\u8fdb\u5236\u683c\u5f0f\u3002\u90a3\u4e48\uff0c\u6211\u4eec\u5982\u4f55\u8bb0\u65e5\u5fd7\u5462\uff1f\u6709\u65e5\u5fd7\u7684\u65f6\u5019\uff0c\u5c31\u76f4\u63a5\u5199\u78c1\u76d8\uff1f \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u53ef\u662f\u78c1\u76d8\u7684\u6548\u7387\u662f\u5f88\u4f4e\u7684\uff0c\u5982\u679c\u4f60\u7528\u8fc7Nginx\uff0c\uff0c\u4e00\u822cNginx\u8f93\u51faaccess log\u90fd\u662f\u8981\u7f13\u51b2\u8f93\u51fa\u7684\u3002\u56e0\u6b64\uff0c\u8bb0\u5f55\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7684\u65f6\u5019\uff0c\u6211\u4eec\u662f\u5426\u4e5f\u9700\u8981\u8003\u8651Cache\u5462\uff1f \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u7b54\u6848\u662f\u80af\u5b9a\u7684\uff0c\u4f46\u662fCache\u4e0d\u662f\u76f4\u63a5\u6301\u4e45\u5316\uff0c\u4e8e\u662f\u9762\u4e34\u5b89\u5168\u6027\u7684\u95ee\u9898\u2014\u2014\u56e0\u4e3a\u7cfb\u7edf\u5b95\u673a\u65f6\uff0cCache\u4e2d\u53ef\u80fd\u6709\u6b8b\u4f59\u7684\u6570\u636e\u6ca1\u6765\u5f97\u53ca\u5199\u5165\u78c1\u76d8\u3002\u56e0\u6b64\uff0cCache\u8981\u6743\u8861\uff0c\u8981\u6070\u5230\u597d\u5904\uff1a \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u65e2\u51cf\u5c11\u78c1\u76d8I/O\uff0c\u6ee1\u8db3\u6027\u80fd\u8981\u6c42\uff1b\u53c8\u4fdd\u8bc1Cache\u65e0\u6b8b\u7559\uff0c\u53ca\u65f6\u6301\u4e45\u5316\uff0c\u6ee1\u8db3\u5b89\u5168\u8981\u6c42\u3002 slow_query_log = 1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f00\u542f\u6162\u67e5\u8be2 long_query_time = 1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u8d85\u8fc7\u7684\u65f6\u95f4\u4e3a1s\uff1bMySQL\u80fd\u591f\u8bb0\u5f55\u6267\u884c\u65f6\u95f4\u8d85\u8fc7\u53c2\u6570 long_query_time \u8bbe\u7f6e\u503c\u7684SQL\u8bed\u53e5\uff0c\u9ed8\u8ba4\u662f\u4e0d\u8bb0\u5f55\u7684\u3002 log-slow-admin-statements log-queries-not-using-indexes\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u8bb0\u5f55\u7ba1\u7406\u8bed\u53e5\u548c\u6ca1\u6709\u4f7f\u7528index\u7684\u67e5\u8be2\u8bb0\u5f55 # *** Replication related settings *** binlog_format = ROW\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u5728\u590d\u5236\u65b9\u9762\u7684\u6539\u8fdb\u5c31\u662f\u5f15\u8fdb\u4e86\u65b0\u7684\u590d\u5236\u6280\u672f\uff1a\u57fa\u4e8e\u884c\u7684\u590d\u5236\u3002\u7b80\u8a00\u4e4b\uff0c\u8fd9\u79cd\u65b0\u6280\u672f\u5c31\u662f\u5173\u6ce8\u8868\u4e2d\u53d1\u751f\u53d8\u5316\u7684\u8bb0\u5f55\uff0c\u800c\u975e\u4ee5\u524d\u7684\u7167\u6284 binlog \u6a21\u5f0f\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4ece MySQL 5.1.12 \u5f00\u59cb\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u4e09\u79cd\u6a21\u5f0f\u6765\u5b9e\u73b0\uff1a\u57fa\u4e8eSQL\u8bed\u53e5\u7684\u590d\u5236(statement-based replication, SBR)\uff0c\u57fa\u4e8e\u884c\u7684\u590d\u5236(row-based replication, RBR)\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u6df7\u5408\u6a21\u5f0f\u590d\u5236(mixed-based replication, MBR)\u3002\u76f8\u5e94\u5730\uff0cbinlog\u7684\u683c\u5f0f\u4e5f\u6709\u4e09\u79cd\uff1aSTATEMENT\uff0cROW\uff0cMIXED\u3002MBR \u6a21\u5f0f\u4e2d\uff0cSBR \u6a21\u5f0f\u662f\u9ed8\u8ba4\u7684\u3002 #max_binlog_cache_size = 102400\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4e3a\u6bcf\u4e2asession \u6700\u5927\u53ef\u5206\u914d\u7684\u5185\u5b58\uff0c\u5728\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\u7528\u6765\u5b58\u50a8\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7684\u7f13\u5b58\u3002 log-bin = /var/log/mysql/mysql-bin.log \u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f00\u542f\u4e8c\u8fdb\u5236\u65e5\u5fd7\u529f\u80fd\uff0cbinlog\u6570\u636e\u4f4d\u7f6e log-bin-index = /var/log/mysql/mysql-bin.index relay-log = /var/log/mysql/relay/mysql-relay-bin \u3000\u3000\u3000 # relay-log\u65e5\u5fd7\u8bb0\u5f55\u7684\u662f\u4ece\u670d\u52a1\u5668I/O\u7ebf\u7a0b\u5c06\u4e3b\u670d\u52a1\u5668\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u8bfb\u53d6\u8fc7\u6765\u8bb0\u5f55\u5230\u4ece\u670d\u52a1\u5668\u672c\u5730\u6587\u4ef6\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u7136\u540eSQL\u7ebf\u7a0b\u4f1a\u8bfb\u53d6relay-log\u65e5\u5fd7\u7684\u5185\u5bb9\u5e76\u5e94\u7528\u5230\u4ece\u670d\u52a1\u5668 relay-log-index = /var/log/mysql/relay/mysql-relay-bin.index # binlog\u4f20\u5230\u5907\u673a\u88ab\u5199\u9053relaylog\u91cc\uff0c\u5907\u673a\u7684slave sql\u7ebf\u7a0b\u4ecerelaylog\u91cc\u8bfb\u53d6\u7136\u540e\u5e94\u7528\u5230\u672c\u5730\u3002 server_id = 100\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u670d\u52a1\u7aefID\uff0c\u7528\u6765\u9ad8\u53ef\u7528\u65f6\u505a\u533a\u5206 log_slave_updates = 1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # log_slave_updates\u662f\u5c06\u4ece\u670d\u52a1\u5668\u4ece\u4e3b\u670d\u52a1\u5668\u6536\u5230\u7684\u66f4\u65b0\u8bb0\u5165\u5230\u4ece\u670d\u52a1\u5668\u81ea\u5df1\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u4e2d\u3002 expire-logs-days = 15\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4e8c\u8fdb\u5236\u65e5\u5fd7\u81ea\u52a8\u5220\u9664\u7684\u5929\u6570\u3002\u9ed8\u8ba4\u503c\u4e3a0,\u8868\u793a\u201c\u6ca1\u6709\u81ea\u52a8\u5220\u9664\u201d\u3002\u542f\u52a8\u65f6\u548c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u5faa\u73af\u65f6\u53ef\u80fd\u5220\u9664\u3002 max_binlog_size = 512M\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5982\u679c\u4e8c\u8fdb\u5236\u65e5\u5fd7\u5199\u5165\u7684\u5185\u5bb9\u8d85\u51fa\u7ed9\u5b9a\u503c\uff0c\u65e5\u5fd7\u5c31\u4f1a\u53d1\u751f\u6eda\u52a8\u3002\u4f60\u4e0d\u80fd\u5c06\u8be5\u53d8\u91cf\u8bbe\u7f6e\u4e3a\u5927\u4e8e1GB\u6216\u5c0f\u4e8e4096\u5b57\u8282\u3002 \u9ed8\u8ba4\u503c\u662f1GB\u3002 replicate-wild-ignore-table = mysql.%\u3000\u3000 # replicate-wild-ignore-table\u53c2\u6570\u80fd\u540c\u6b65\u6240\u6709\u8de8\u6570\u636e\u5e93\u7684\u66f4\u65b0\uff0c\u6bd4\u5982replicate-do-db\u6216\u8005replicate-ignore-db\u4e0d\u4f1a\u540c\u6b65\u7c7b\u4f3c #replicate-wild-do-table = db_name.%\u3000\u3000 # \u8bbe\u5b9a\u9700\u8981\u590d\u5236\u7684Table #slave-skip-errors = 1062,1053,1146\u3000\u3000\u3000\u3000 # \u590d\u5236\u65f6\u8df3\u8fc7\u4e00\u4e9b\u9519\u8bef;\u4e0d\u8981\u80e1\u4e71\u4f7f\u7528\u8fd9\u4e9b\u8df3\u8fc7\u9519\u8bef\u7684\u53c2\u6570\uff0c\u9664\u975e\u4f60\u975e\u5e38\u786e\u5b9a\u4f60\u5728\u505a\u4ec0\u4e48\u3002\u5f53\u4f60\u4f7f\u7528\u8fd9\u4e9b\u53c2\u6570\u65f6\u5019\uff0cMYSQL\u4f1a\u5ffd\u7565\u90a3\u4e9b\u9519\u8bef\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8fd9\u6837\u4f1a\u5bfc\u81f4\u4f60\u7684\u4e3b\u4ece\u670d\u52a1\u5668\u6570\u636e\u4e0d\u4e00\u81f4\u3002 auto_increment_offset = 1 # \u6f02\u79fb\u503c,\u4e5f\u5c31\u662f\u6b65\u957f auto_increment_increment = 2\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u81ea\u589e\u503c,\u8fd9\u4e24\u4e2a\u53c2\u6570\u4e00\u822c\u7528\u5728\u4e3b\u4e3b\u540c\u6b65\u4e2d\uff0c\u7528\u6765\u9519\u5f00\u81ea\u589e\u503c, \u9632\u6b62\u952e\u503c\u51b2\u7a81 relay_log_info_repository = TABLE\u3000\u3000\u3000\u3000\u3000 # \u5c06\u4e2d\u7ee7\u65e5\u5fd7\u7684\u4fe1\u606f\u5199\u5165\u8868:mysql.slave_realy_log_info master_info_repository = TABLE\u3000\u3000\u3000\u3000\u3000\u3000 # \u5c06master\u7684\u8fde\u63a5\u4fe1\u606f\u5199\u5165\u8868\uff1amysql.salve_master_info relay_log_recovery = on\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4e2d\u7ee7\u65e5\u5fd7\u81ea\u6211\u4fee\u590d\uff1b\u5f53slave\u4ece\u5e93\u5b95\u673a\u540e\uff0c\u5047\u5982relay-log\u635f\u574f\u4e86\uff0c\u5bfc\u81f4\u4e00\u90e8\u5206\u4e2d\u7ee7\u65e5\u5fd7\u6ca1\u6709\u5904\u7406\uff0c\u5219\u81ea\u52a8\u653e\u5f03\u6240\u6709\u672a\u6267\u884c\u7684relay-log\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5e76\u4e14\u91cd\u65b0\u4ecemaster\u4e0a\u83b7\u53d6\u65e5\u5fd7\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86relay-log\u7684\u5b8c\u6574\u6027 # *** innodb setting *** innodb_buffer_pool_size = 4G\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# InnoDB \u7528\u6765\u9ad8\u901f\u7f13\u51b2\u6570\u636e\u548c\u7d22\u5f15\u5185\u5b58\u7f13\u51b2\u5927\u5c0f\u3002 \u66f4\u5927\u7684\u8bbe\u7f6e\u53ef\u4ee5\u4f7f\u8bbf\u95ee\u6570\u636e\u65f6\u51cf\u5c11\u78c1\u76d8 I/O\u3002 innodb_data_file_path = ibdata1:1G:autoextend\u3000\u3000# \u5355\u72ec\u6307\u5b9a\u6570\u636e\u6587\u4ef6\u7684\u8def\u5f84\u4e0e\u5927\u5c0f innodb_flush_log_at_trx_commit = 0\u3000\u3000\u3000\u3000 # \u6bcf\u6b21commit \u65e5\u5fd7\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u5237\u5230\u78c1\u76d8\u4e2d\u3002\u901a\u5e38\u8bbe\u7f6e\u4e3a 1\uff0c\u610f\u5473\u7740\u5728\u4e8b\u52a1\u63d0\u4ea4\u524d\u65e5\u5fd7\u5df2\u88ab\u5199\u5165\u78c1\u76d8\uff0c \u4e8b\u52a1\u53ef\u4ee5\u8fd0\u884c\u66f4\u957f\u4ee5\u53ca\u670d\u52a1\u5d29\u6e83\u540e\u7684\u4fee\u590d\u80fd\u529b\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u5982\u679c\u4f60\u613f\u610f\u51cf\u5f31\u8fd9\u4e2a\u5b89\u5168\uff0c\u6216\u4f60\u8fd0\u884c\u7684\u662f\u6bd4\u8f83\u5c0f\u7684\u4e8b\u52a1\u5904\u7406\uff0c\u53ef\u4ee5\u5c06\u5b83\u8bbe\u7f6e\u4e3a 0 \uff0c\u4ee5\u51cf\u5c11\u5199\u65e5\u5fd7\u6587\u4ef6\u7684\u78c1\u76d8 I/O\u3002\u8fd9\u4e2a\u9009\u9879\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a 0\u3002 #sync_binlog = 1000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # sync_binlog=n\uff0c\u5f53\u6bcf\u8fdb\u884cn\u6b21\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\uff0cMySQL\u5c06\u8fdb\u884c\u4e00\u6b21fsync\u4e4b\u7c7b\u7684\u78c1\u76d8\u540c\u6b65\u6307\u4ee4\u6765\u5c06binlog_cache\u4e2d\u7684\u6570\u636e\u5f3a\u5236\u5199\u5165\u78c1\u76d8\u3002 innodb_read_io_threads = 8\u3000\u3000 innodb_write_io_threads = 8\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5bf9\u4e8e\u591a\u6838\u7684CPU\u673a\u5668\uff0c\u53ef\u4ee5\u4fee\u6539innodb_read_io_threads\u548cinnodb_write_io_threads\u6765\u589e\u52a0IO\u7ebf\u7a0b\uff0c\u6765\u5145\u5206\u5229\u7528\u591a\u6838\u7684\u6027\u80fd innodb_file_format = Barracuda\u3000\u3000\u3000\u3000\u3000\u3000 # Innodb Plugin\u5f15\u64ce\u5f00\u59cb\u5f15\u5165\u591a\u79cd\u683c\u5f0f\u7684\u884c\u5b58\u50a8\u673a\u5236\uff0c\u76ee\u524d\u652f\u6301\uff1aAntelope\u3001Barracuda\u4e24\u79cd\u3002\u5176\u4e2dBarracuda\u517c\u5bb9Antelope\u683c\u5f0f\u3002 innodb_open_files = 65536\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u9650\u5236Innodb\u80fd\u6253\u5f00\u7684\u8868\u7684\u6570\u91cf innodb_purge_threads = 1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f00\u59cb\u788e\u7247\u56de\u6536\u7ebf\u7a0b\u3002\u8fd9\u4e2a\u5e94\u8be5\u80fd\u8ba9\u788e\u7247\u56de\u6536\u5f97\u66f4\u53ca\u65f6\u800c\u4e14\u4e0d\u5f71\u54cd\u5176\u4ed6\u7ebf\u7a0b\u7684\u64cd\u4f5c innodb_support_xa = FALSE\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5206\u5e03\u5f0f\u4e8b\u52a1 innodb_log_buffer_size = 256M\u3000\u3000\u3000\u3000\u3000\u3000 # nnoDB \u5c06\u65e5\u5fd7\u5199\u5165\u65e5\u5fd7\u78c1\u76d8\u6587\u4ef6\u524d\u7684\u7f13\u51b2\u5927\u5c0f\u3002\u7406\u60f3\u503c\u4e3a 1M \u81f3 8M\u3002\u5927\u7684\u65e5\u5fd7\u7f13\u51b2\u5141\u8bb8\u4e8b\u52a1\u8fd0\u884c\u65f6\u4e0d\u9700\u8981\u5c06\u65e5\u5fd7\u4fdd\u5b58\u5165\u78c1\u76d8\u800c\u53ea\u5230\u4e8b\u52a1\u88ab\u63d0\u4ea4(commit)\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u56e0\u6b64\uff0c\u5982\u679c\u6709\u5927\u7684\u4e8b\u52a1\u5904\u7406\uff0c\u8bbe\u7f6e\u5927\u7684\u65e5\u5fd7\u7f13\u51b2\u53ef\u4ee5\u51cf\u5c11\u78c1\u76d8I/O\u3002 innodb_log_file_size = 1G\u3000\u3000\u3000\u3000\u3000\u3000 # \u65e5\u5fd7\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7684\u5927\u5c0f(\u5355\u4f4d MB)\u3002\u5982\u679c n \u662f\u65e5\u5fd7\u7ec4\u4e2d\u65e5\u5fd7\u6587\u4ef6\u7684\u6570\u76ee\uff0c\u90a3\u4e48\u7406\u60f3\u7684\u6570\u503c\u4e3a 1M \u81f3\u4e0b\u9762\u8bbe\u7f6e\u7684\u7f13\u51b2\u6c60(buffer pool)\u5927\u5c0f\u7684 1/n\u3002\u8f83\u5927\u7684\u503c\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 \u3000# \u53ef\u4ee5\u51cf\u5c11\u5237\u65b0\u7f13\u51b2\u6c60\u7684\u6b21\u6570\uff0c\u4ece\u800c\u51cf\u5c11\u78c1\u76d8 I/O\u3002\u4f46\u662f\u5927\u7684\u65e5\u5fd7\u6587\u4ef6\u610f\u5473\u7740\u5728\u5d29\u6e83\u65f6\u9700\u8981\u66f4\u957f\u7684\u65f6\u95f4\u6765\u6062\u590d\u6570\u636e\u3002 innodb_log_files_in_group = 3\u3000\u3000\u3000\u3000\u3000\u3000 # \u6307\u5b9a\u6709\u4e09\u4e2a\u65e5\u5fd7\u7ec4 #innodb_lock_wait_timeout = 120\u3000\u3000\u3000\u3000\u3000 # \u5728\u56de\u6eda(rooled back)\u4e4b\u524d\uff0cInnoDB \u4e8b\u52a1\u5c06\u7b49\u5f85\u8d85\u65f6\u7684\u65f6\u95f4(\u5355\u4f4d \u79d2) innodb_max_dirty_pages_pct = 75\u3000\u3000\u3000\u3000\u3000 # innodb_max_dirty_pages_pct\u4f5c\u7528\uff1a\u63a7\u5236Innodb\u7684\u810f\u9875\u5728\u7f13\u51b2\u4e2d\u5728\u90a3\u4e2a\u767e\u5206\u6bd4\u4e4b\u4e0b\uff0c\u503c\u5728\u8303\u56f41-100,\u9ed8\u8ba4\u4e3a90.\u8fd9\u4e2a\u53c2\u6570\u7684\u53e6\u4e00\u4e2a\u7528\u5904\uff1a \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 \u3000# \u5f53Innodb\u7684\u5185\u5b58\u5206\u914d\u8fc7\u5927\uff0c\u81f4\u4f7fswap\u5360\u7528\u4e25\u91cd\u65f6\uff0c\u53ef\u4ee5\u9002\u5f53\u7684\u51cf\u5c0f\u8c03\u6574\u8fd9\u4e2a\u503c\uff0c\u4f7f\u8fbe\u5230swap\u7a7a\u95f4\u91ca\u653e\u51fa\u6765\u3002\u5efa\u4e49\uff1a\u8fd9\u4e2a\u503c\u6700\u5927\u572890%\uff0c\u6700\u5c0f\u572815%\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u592a\u5927\uff0c\u7f13\u5b58\u4e2d\u6bcf\u6b21\u66f4\u65b0\u9700\u8981\u81f4\u6362\u6570\u636e\u9875\u592a\u591a\uff0c\u592a\u5c0f\uff0c\u653e\u7684\u6570\u636e\u9875\u592a\u5c0f\uff0c\u66f4\u65b0\u64cd\u4f5c\u592a\u6162\u3002 innodb_buffer_pool_instances = 4 \u3000\u3000\u3000 # innodb_buffer_pool_size \u4e00\u81f4 \u53ef\u4ee5\u5f00\u542f\u591a\u4e2a\u5185\u5b58\u7f13\u51b2\u6c60\uff0c\u628a\u9700\u8981\u7f13\u51b2\u7684\u6570\u636ehash\u5230\u4e0d\u540c\u7684\u7f13\u51b2\u6c60\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u5e76\u884c\u7684\u5185\u5b58\u8bfb\u5199\u3002 innodb_io_capacity = 500\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u8fd9\u4e2a\u53c2\u6570\u636e\u63a7\u5236Innodb checkpoint\u65f6\u7684IO\u80fd\u529b innodb_file_per_table = 1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4f5c\u7528\uff1a\u4f7f\u6bcf\u4e2aInnodb\u7684\u8868\uff0c\u6709\u81ea\u5df2\u72ec\u7acb\u7684\u8868\u7a7a\u95f4\u3002\u5982\u5220\u9664\u6587\u4ef6\u540e\u53ef\u4ee5\u56de\u6536\u90a3\u90e8\u5206\u7a7a\u95f4\u3002 \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5206\u914d\u539f\u5219\uff1a\u53ea\u6709\u4f7f\u7528\u4e0d\u4f7f\u7528\u3002\u4f46\uff24\uff22\u8fd8\u9700\u8981\u6709\u4e00\u4e2a\u516c\u5171\u7684\u8868\u7a7a\u95f4\u3002 innodb_change_buffering = inserts\u3000\u3000\u3000\u3000 # \u5f53\u66f4\u65b0/\u63d2\u5165\u7684\u975e\u805a\u96c6\u7d22\u5f15\u7684\u6570\u636e\u6240\u5bf9\u5e94\u7684\u9875\u4e0d\u5728\u5185\u5b58\u4e2d\u65f6\uff08\u5bf9\u975e\u805a\u96c6\u7d22\u5f15\u7684\u66f4\u65b0\u64cd\u4f5c\u901a\u5e38\u4f1a\u5e26\u6765\u968f\u673aIO\uff09\uff0c\u4f1a\u5c06\u5176\u653e\u5230\u4e00\u4e2ainsert buffer\u4e2d\uff0c \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5f53\u968f\u540e\u9875\u9762\u88ab\u8bfb\u5230\u5185\u5b58\u4e2d\u65f6\uff0c\u4f1a\u5c06\u8fd9\u4e9b\u53d8\u5316\u7684\u8bb0\u5f55merge\u5230\u9875\u4e2d\u3002\u5f53\u670d\u52a1\u5668\u6bd4\u8f83\u7a7a\u95f2\u65f6\uff0c\u540e\u53f0\u7ebf\u7a0b\u4e5f\u4f1a\u505amerge\u64cd\u4f5c innodb_adaptive_flushing = 1\u3000\u3000\u3000\u3000\u3000\u3000 # \u8be5\u503c\u5f71\u54cd\u6bcf\u79d2\u5237\u65b0\u810f\u9875\u7684\u64cd\u4f5c\uff0c\u5f00\u542f\u6b64\u914d\u7f6e\u540e\uff0c\u5237\u65b0\u810f\u9875\u4f1a\u901a\u8fc7\u5224\u65ad\u4ea7\u751f\u91cd\u505a\u65e5\u5fd7\u7684\u901f\u5ea6\u6765\u5224\u65ad\u6700\u5408\u9002\u7684\u5237\u65b0\u810f\u9875\u7684\u6570\u91cf\uff1b transaction-isolation = READ-COMMITTED\u3000 \u3000# \u6570\u636e\u5e93\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b \uff0c\u8bfb\u53d6\u63d0\u4ea4\u5185\u5bb9 innodb_flush_method = O_DIRECT\u3000\u3000\u3000\u3000\u3000\u3000 # innodb_flush_method\u8fd9\u4e2a\u53c2\u6570\u63a7\u5236\u7740innodb\u6570\u636e\u6587\u4ef6\u53caredo log\u7684\u6253\u5f00\u3001\u5237\u5199\u6a21\u5f0f \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# InnoDB\u4f7f\u7528O_DIRECT\u6a21\u5f0f\u6253\u5f00\u6570\u636e\u6587\u4ef6\uff0c\u7528fsync()\u51fd\u6570\u53bb\u66f4\u65b0\u65e5\u5fd7\u548c\u6570\u636e\u6587\u4ef6\u3002 #innodb_use_sys_malloc = 1\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u9ed8\u8ba4\u8bbe\u7f6e\u503c\u4e3a1.\u8bbe\u7f6e\u4e3a0\uff1a\u8868\u793aInnodb\u4f7f\u7528\u81ea\u5e26\u7684\u5185\u5b58\u5206\u914d\u7a0b\u5e8f\uff1b\u8bbe\u7f6e\u4e3a1\uff1a\u8868\u793aInnoDB\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u5206\u914d\u7a0b\u5e8f\u3002 [mysqldump] quick\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u5b83\u5f3a\u5236 mysqldump \u4ece\u670d\u52a1\u5668\u67e5\u8be2\u53d6\u5f97\u8bb0\u5f55\u76f4\u63a5\u8f93\u51fa\u800c\u4e0d\u662f\u53d6\u5f97\u6240\u6709\u8bb0\u5f55\u540e\u5c06\u5b83\u4eec\u7f13\u5b58\u5230\u5185\u5b58\u4e2d max_allowed_packet = 512M \u3000\u3000\u3000\u3000 \u3000\u3000# \u9650\u5236server\u63a5\u53d7\u7684\u6570\u636e\u5305\u5927\u5c0f;\u6307\u4ee3mysql\u670d\u52a1\u5668\u7aef\u548c\u5ba2\u6237\u7aef\u5728\u4e00\u6b21\u4f20\u9001\u6570\u636e\u5305\u7684\u8fc7\u7a0b\u5f53\u4e2d\u6570\u636e\u5305\u7684\u5927\u5c0f net_buffer_length = 16384 \u3000\u3000\u3000\u3000 \u3000\u3000# TCP/IP\u548c\u5957\u63a5\u5b57\u901a\u4fe1\u7f13\u51b2\u533a\u5927\u5c0f,\u521b\u5efa\u957f\u5ea6\u8fbenet_buffer_length\u7684\u884c [mysql] auto-rehash\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # auto-rehash\u662f\u81ea\u52a8\u8865\u5168\u7684\u610f\u601d [isamchk] \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # isamchk\u6570\u636e\u68c0\u6d4b\u6062\u590d\u5de5\u5177 key_buffer = 256M sort_buffer_size = 256M read_buffer = 2M write_buffer = 2M [myisamchk]\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000 # \u4f7f\u7528myisamchk\u5b9e\u7528\u7a0b\u5e8f\u6765\u83b7\u5f97\u6709\u5173\u4f60\u7684\u6570\u636e\u5e93\u684c\u8868\u7684\u4fe1\u606f\u3001\u68c0\u67e5\u548c\u4fee\u590d\u4ed6\u4eec\u6216\u4f18\u5316\u4ed6\u4eec key_buffer = 256M sort_buffer_size = 256M read_buffer = 2M write_buffer = 2M [mysqlhotcopy] interactive-timeout # mysqlhotcopy\u4f7f\u7528lock tables\u3001flush tables\u548ccp\u6216scp\u6765\u5feb\u901f\u5907\u4efd\u6570\u636e\u5e93.\u5b83\u662f\u5907\u4efd\u6570\u636e\u5e93\u6216\u5355\u4e2a\u8868\u6700\u5feb\u7684\u9014\u5f84,\u5b8c\u5168\u5c5e\u4e8e\u7269\u7406\u5907\u4efd,\u4f46\u53ea\u80fd\u7528\u4e8e\u5907\u4efdMyISAM\u5b58\u50a8\u5f15\u64ce\u548c\u8fd0\u884c\u5728\u6570\u636e\u5e93\u76ee\u5f55\u6240\u5728\u7684\u673a\u5668\u4e0a. \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000# \u4e0emysqldump\u5907\u4efd\u4e0d\u540c,mysqldump\u5c5e\u4e8e\u903b\u8f91\u5907\u4efd,\u5907\u4efd\u65f6\u662f\u6267\u884c\u7684sql\u8bed\u53e5.\u4f7f\u7528mysqlhotcopy\u547d\u4ee4\u524d\u9700\u8981\u8981\u5b89\u88c5\u76f8\u5e94\u7684\u8f6f\u4ef6\u4f9d\u8d56\u5305.","title":"2. \u53c2\u6570\u63cf\u8ff0"},{"location":"mysql/mysql.mysqldump/","text":"MySQL mysqldump 1. \u4ecb\u7ecd \u00b6 mysqldump\u662fmysql\u7528\u4e8e\u8f6c\u5b58\u50a8\u6570\u636e\u5e93\u7684\u5b9e\u7528\u7a0b\u5e8f\u3002\u5b83\u4e3b\u8981\u4ea7\u751f\u4e00\u4e2aSQL\u811a\u672c\uff0c\u5176\u4e2d\u5305\u542b\u4ece\u5934\u91cd\u65b0\u521b\u5efa\u6570\u636e\u5e93\u6240\u5fc5\u9700\u7684\u547d\u4ee4CREATE TABLE INSERT\u7b49\u3002 2. \u53c2\u6570 \u00b6 --all-databases , -A \u5bfc\u51fa\u5168\u90e8\u6570\u636e\u5e93\u3002 mysqldump -uroot -p --all-databases --all-tablespaces , -Y \u5bfc\u51fa\u5168\u90e8\u8868\u7a7a\u95f4\u3002 mysqldump -uroot -p --all-databases --all-tablespaces --no-tablespaces , -y \u4e0d\u5bfc\u51fa\u4efb\u4f55\u8868\u7a7a\u95f4\u4fe1\u606f\u3002 mysqldump -uroot -p --all-databases --no-tablespaces --add-drop-database \u6bcf\u4e2a\u6570\u636e\u5e93\u521b\u5efa\u4e4b\u524d\u6dfb\u52a0drop\u6570\u636e\u5e93\u8bed\u53e5\u3002 mysqldump -uroot -p --all-databases --add-drop-database --add-drop-table \u6bcf\u4e2a\u6570\u636e\u8868\u521b\u5efa\u4e4b\u524d\u6dfb\u52a0drop\u6570\u636e\u8868\u8bed\u53e5\u3002(\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\uff0c\u4f7f\u7528--skip-add-drop-table\u53d6\u6d88\u9009\u9879) mysqldump -uroot -p --all-databases (\u9ed8\u8ba4\u6dfb\u52a0drop\u8bed\u53e5) mysqldump -uroot -p --all-databases \u2013skip-add-drop-table (\u53d6\u6d88drop\u8bed\u53e5) --add-locks \u5728\u6bcf\u4e2a\u8868\u5bfc\u51fa\u4e4b\u524d\u589e\u52a0LOCK TABLES\u5e76\u4e14\u4e4b\u540eUNLOCK TABLE\u3002(\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\uff0c\u4f7f\u7528--skip-add-locks\u53d6\u6d88\u9009\u9879) mysqldump -uroot -p --all-databases (\u9ed8\u8ba4\u6dfb\u52a0LOCK\u8bed\u53e5) mysqldump -uroot -p --all-databases \u2013skip-add-locks (\u53d6\u6d88LOCK\u8bed\u53e5) --allow-keywords \u5141\u8bb8\u521b\u5efa\u662f\u5173\u952e\u8bcd\u7684\u5217\u540d\u5b57\u3002\u8fd9\u7531\u8868\u540d\u524d\u7f00\u4e8e\u6bcf\u4e2a\u5217\u540d\u505a\u5230\u3002 mysqldump -uroot -p --all-databases --allow-keywords --apply-slave-statements \u5728'CHANGE MASTER'\u524d\u6dfb\u52a0'STOP SLAVE'\uff0c\u5e76\u4e14\u5728\u5bfc\u51fa\u7684\u6700\u540e\u6dfb\u52a0'START SLAVE'\u3002 mysqldump -uroot -p --all-databases --apply-slave-statements --character-sets-dir \u5b57\u7b26\u96c6\u6587\u4ef6\u7684\u76ee\u5f55 mysqldump -uroot -p --all-databases --character-sets-dir=/usr/local/mysql/share/mysql/charsets --comments \u9644\u52a0\u6ce8\u91ca\u4fe1\u606f\u3002\u9ed8\u8ba4\u4e3a\u6253\u5f00\uff0c\u53ef\u4ee5\u7528--skip-comments\u53d6\u6d88 mysqldump -uroot -p --all-databases (\u9ed8\u8ba4\u8bb0\u5f55\u6ce8\u91ca) mysqldump -uroot -p --all-databases --skip-comments (\u53d6\u6d88\u6ce8\u91ca) --compatible \u5bfc\u51fa\u7684\u6570\u636e\u5c06\u548c\u5176\u5b83\u6570\u636e\u5e93\u6216\u65e7\u7248\u672c\u7684MySQL \u76f8\u517c\u5bb9\u3002 \u503c\u53ef\u4ee5\u4e3aansi\u3001mysql323\u3001mysql40\u3001postgresql\u3001oracle\u3001mssql\u3001db2\u3001maxdb\u3001no_key_options\u3001no_tables_options\u3001no_field_options\u7b49\uff0c \u8981\u4f7f\u7528\u51e0\u4e2a\u503c\uff0c\u7528\u9017\u53f7\u5c06\u5b83\u4eec\u9694\u5f00\u3002\u5b83\u5e76\u4e0d\u4fdd\u8bc1\u80fd\u5b8c\u5168\u517c\u5bb9\uff0c\u800c\u662f\u5c3d\u91cf\u517c\u5bb9\u3002 mysqldump -uroot -p --all-databases --compatible=ansi --compact \u5bfc\u51fa\u66f4\u5c11\u7684\u8f93\u51fa\u4fe1\u606f(\u7528\u4e8e\u8c03\u8bd5)\u3002\u53bb\u6389\u6ce8\u91ca\u548c\u5934\u5c3e\u7b49\u7ed3\u6784\u3002\u53ef\u4ee5\u4f7f\u7528\u9009\u9879\uff1a--skip-add-drop-table --skip-add-locks --skip-comments --skip-disable-keys mysqldump -uroot -p --all-databases --compact --complete-insert, -c \u4f7f\u7528\u5b8c\u6574\u7684insert\u8bed\u53e5(\u5305\u542b\u5217\u540d\u79f0)\u3002\u8fd9\u4e48\u505a\u80fd\u63d0\u9ad8\u63d2\u5165\u6548\u7387\uff0c\u4f46\u662f\u53ef\u80fd\u4f1a\u53d7\u5230max_allowed_packet\u53c2\u6570\u7684\u5f71\u54cd\u800c\u5bfc\u81f4\u63d2\u5165\u5931\u8d25\u3002 mysqldump -uroot -p --all-databases --complete-insert --compress, -C \u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u542f\u7528\u538b\u7f29\u4f20\u9012\u6240\u6709\u4fe1\u606f mysqldump -uroot -p --all-databases --compress --create-options, -a \u5728CREATE TABLE\u8bed\u53e5\u4e2d\u5305\u62ec\u6240\u6709MySQL\u7279\u6027\u9009\u9879\u3002(\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001) mysqldump -uroot -p --all-databases --databases, -B \u5bfc\u51fa\u51e0\u4e2a\u6570\u636e\u5e93\u3002\u53c2\u6570\u540e\u9762\u6240\u6709\u540d\u5b57\u53c2\u91cf\u90fd\u88ab\u770b\u4f5c\u6570\u636e\u5e93\u540d\u3002 mysqldump -uroot -p --databases test mysql --debug \u8f93\u51fadebug\u4fe1\u606f\uff0c\u7528\u4e8e\u8c03\u8bd5\u3002\u9ed8\u8ba4\u503c\u4e3a\uff1ad:t:o,/tmp/mysqldump.trace mysqldump -uroot -p --all-databases --debug mysqldump -uroot -p --all-databases --debug=\u201d d:t:o,/tmp/debug.trace\u201d --debug-check \u68c0\u67e5\u5185\u5b58\u548c\u6253\u5f00\u6587\u4ef6\u4f7f\u7528\u8bf4\u660e\u5e76\u9000\u51fa\u3002 mysqldump -uroot -p --all-databases --debug-check --debug-info \u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f\u5e76\u9000\u51fa mysqldump -uroot -p --all-databases --debug-info --default-character-set \u8bbe\u7f6e\u9ed8\u8ba4\u5b57\u7b26\u96c6\uff0c\u9ed8\u8ba4\u503c\u4e3autf8 mysqldump -uroot -p --all-databases --default-character-set=latin1 --delayed-insert \u91c7\u7528\u5ef6\u65f6\u63d2\u5165\u65b9\u5f0f\uff08INSERT DELAYED\uff09\u5bfc\u51fa\u6570\u636e mysqldump -uroot -p --all-databases --delayed-insert --delete-master-logs master\u5907\u4efd\u540e\u5220\u9664\u65e5\u5fd7. \u8fd9\u4e2a\u53c2\u6570\u5c06\u81ea\u52a8\u6fc0\u6d3b--master-data\u3002 mysqldump -uroot -p --all-databases --delete-master-logs --disable-keys\u5bf9\u4e8e\u6bcf\u4e2a\u8868\uff0c\u7528/*!40000 ALTER TABLE tbl_name DISABLE KEYS */;\u548c/*!40000 ALTER TABLE tbl_name ENABLE KEYS */;\u8bed\u53e5\u5f15\u7528INSERT\u8bed\u53e5\u3002\u8fd9\u6837\u53ef\u4ee5\u66f4\u5feb\u5730\u5bfc\u5165dump\u51fa\u6765\u7684\u6587\u4ef6\uff0c\u56e0\u4e3a\u5b83\u662f\u5728\u63d2\u5165\u6240\u6709\u884c\u540e\u521b\u5efa\u7d22\u5f15\u7684\u3002\u8be5\u9009\u9879\u53ea\u9002\u5408MyISAM\u8868\uff0c\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\u3002 mysqldump -uroot -p --all-databases --dump-slave \u8be5\u9009\u9879\u5c06\u5bfc\u81f4\u4e3b\u7684binlog\u4f4d\u7f6e\u548c\u6587\u4ef6\u540d\u8ffd\u52a0\u5230\u5bfc\u51fa\u6570\u636e\u7684\u6587\u4ef6\u4e2d\u3002\u8bbe\u7f6e\u4e3a1\u65f6\uff0c\u5c06\u4f1a\u4ee5CHANGE MASTER\u547d\u4ee4\u8f93\u51fa\u5230\u6570\u636e\u6587\u4ef6\uff1b\u8bbe\u7f6e\u4e3a2\u65f6\uff0c\u5728\u547d\u4ee4\u524d\u589e\u52a0\u8bf4\u660e\u4fe1\u606f\u3002\u8be5\u9009\u9879\u5c06\u4f1a\u6253\u5f00--lock-all-tables\uff0c\u9664\u975e--single-transaction\u88ab\u6307\u5b9a\u3002\u8be5\u9009\u9879\u4f1a\u81ea\u52a8\u5173\u95ed--lock-tables\u9009\u9879\u3002\u9ed8\u8ba4\u503c\u4e3a0\u3002 mysqldump -uroot -p --all-databases --dump-slave=1 mysqldump -uroot -p --all-databases --dump-slave=2 --events, -E \u5bfc\u51fa\u4e8b\u4ef6\u3002 mysqldump -uroot -p --all-databases --events --extended-insert, -e \u4f7f\u7528\u5177\u6709\u591a\u4e2aVALUES\u5217\u7684INSERT\u8bed\u6cd5\u3002\u8fd9\u6837\u4f7f\u5bfc\u51fa\u6587\u4ef6\u66f4\u5c0f\uff0c\u5e76\u52a0\u901f\u5bfc\u5165\u65f6\u7684\u901f\u5ea6\u3002\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\uff0c\u4f7f\u7528--skip-extended-insert\u53d6\u6d88\u9009\u9879\u3002 mysqldump -uroot -p --all-databases mysqldump -uroot -p --all-databases--skip-extended-insert (\u53d6\u6d88\u9009\u9879) --fields-terminated-by \u5bfc\u51fa\u6587\u4ef6\u4e2d\u5ffd\u7565\u7ed9\u5b9a\u5b57\u6bb5\u3002\u4e0e--tab\u9009\u9879\u4e00\u8d77\u4f7f\u7528\uff0c\u4e0d\u80fd\u7528\u4e8e--databases\u548c--all-databases\u9009\u9879 mysqldump -uroot -p test test --tab=\u201d/home/mysql\u201d --fields-terminated-by=\u201d#\u201d --fields-enclosed-by \u8f93\u51fa\u6587\u4ef6\u4e2d\u7684\u5404\u4e2a\u5b57\u6bb5\u7528\u7ed9\u5b9a\u5b57\u7b26\u5305\u88f9\u3002\u4e0e--tab\u9009\u9879\u4e00\u8d77\u4f7f\u7528\uff0c\u4e0d\u80fd\u7528\u4e8e--databases\u548c--all-databases\u9009\u9879 mysqldump -uroot -p test test --tab=\u201d/home/mysql\u201d --fields-enclosed-by=\u201d#\u201d --fields-optionally-enclosed-by \u8f93\u51fa\u6587\u4ef6\u4e2d\u7684\u5404\u4e2a\u5b57\u6bb5\u7528\u7ed9\u5b9a\u5b57\u7b26\u9009\u62e9\u6027\u5305\u88f9\u3002\u4e0e--tab\u9009\u9879\u4e00\u8d77\u4f7f\u7528\uff0c\u4e0d\u80fd\u7528\u4e8e--databases\u548c--all-databases\u9009\u9879 mysqldump -uroot -p test test --tab=\u201d/home/mysql\u201d --fields-enclosed-by=\u201d#\u201d --fields-optionally-enclosed-by =\u201d#\u201d --fields-escaped-by \u8f93\u51fa\u6587\u4ef6\u4e2d\u7684\u5404\u4e2a\u5b57\u6bb5\u5ffd\u7565\u7ed9\u5b9a\u5b57\u7b26\u3002\u4e0e--tab\u9009\u9879\u4e00\u8d77\u4f7f\u7528\uff0c\u4e0d\u80fd\u7528\u4e8e--databases\u548c--all-databases\u9009\u9879 mysqldump -uroot -p mysql user --tab=\u201d/home/mysql\u201d --fields-escaped-by=\u201d#\u201d --flush-logs \u5f00\u59cb\u5bfc\u51fa\u4e4b\u524d\u5237\u65b0\u65e5\u5fd7\u3002 \u8bf7\u6ce8\u610f\uff1a\u5047\u5982\u4e00\u6b21\u5bfc\u51fa\u591a\u4e2a\u6570\u636e\u5e93(\u4f7f\u7528\u9009\u9879--databases\u6216\u8005--all-databases)\uff0c\u5c06\u4f1a\u9010\u4e2a\u6570\u636e\u5e93\u5237\u65b0\u65e5\u5fd7\u3002\u9664\u4f7f\u7528--lock-all-tables\u6216\u8005--master-data\u5916\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u65e5\u5fd7\u5c06\u4f1a\u88ab\u5237\u65b0\u4e00\u6b21\uff0c\u76f8\u5e94\u7684\u6240\u4ee5\u8868\u540c\u65f6\u88ab\u9501\u5b9a\u3002\u56e0\u6b64\uff0c\u5982\u679c\u6253\u7b97\u540c\u65f6\u5bfc\u51fa\u548c\u5237\u65b0\u65e5\u5fd7\u5e94\u8be5\u4f7f\u7528--lock-all-tables \u6216\u8005--master-data \u548c--flush-logs\u3002 mysqldump -uroot -p --all-databases --flush-logs --flush-privileges \u5728\u5bfc\u51famysql\u6570\u636e\u5e93\u4e4b\u540e\uff0c\u53d1\u51fa\u4e00\u6761FLUSH PRIVILEGES \u8bed\u53e5\u3002\u4e3a\u4e86\u6b63\u786e\u6062\u590d\uff0c\u8be5\u9009\u9879\u5e94\u8be5\u7528\u4e8e\u5bfc\u51famysql\u6570\u636e\u5e93\u548c\u4f9d\u8d56mysql\u6570\u636e\u5e93\u6570\u636e\u7684\u4efb\u4f55\u65f6\u5019\u3002 mysqldump -uroot -p --all-databases --flush-privileges --force \u5728\u5bfc\u51fa\u8fc7\u7a0b\u4e2d\u5ffd\u7565\u51fa\u73b0\u7684SQL\u9519\u8bef\u3002 mysqldump -uroot -p --all-databases --force --help \u663e\u793a\u5e2e\u52a9\u4fe1\u606f\u5e76\u9000\u51fa\u3002 mysqldump --help --hex-blob \u4f7f\u7528\u5341\u516d\u8fdb\u5236\u683c\u5f0f\u5bfc\u51fa\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u5b57\u6bb5\u3002\u5982\u679c\u6709\u4e8c\u8fdb\u5236\u6570\u636e\u5c31\u5fc5\u987b\u4f7f\u7528\u8be5\u9009\u9879\u3002\u5f71\u54cd\u5230\u7684\u5b57\u6bb5\u7c7b\u578b\u6709BINARY\u3001VARBINARY\u3001BLOB\u3002 mysqldump -uroot -p --all-databases --hex-blob --host, -h \u9700\u8981\u5bfc\u51fa\u7684\u4e3b\u673a\u4fe1\u606f mysqldump -uroot -p --host=localhost --all-databases --ignore-table \u4e0d\u5bfc\u51fa\u6307\u5b9a\u8868\u3002\u6307\u5b9a\u5ffd\u7565\u591a\u4e2a\u8868\u65f6\uff0c\u9700\u8981\u91cd\u590d\u591a\u6b21\uff0c\u6bcf\u6b21\u4e00\u4e2a\u8868\u3002\u6bcf\u4e2a\u8868\u5fc5\u987b\u540c\u65f6\u6307\u5b9a\u6570\u636e\u5e93\u548c\u8868\u540d\u3002\u4f8b\u5982\uff1a--ignore-table=database.table1 --ignore-table=database.table2 \u2026\u2026 mysqldump -uroot -p --host=localhost --all-databases --ignore-table=mysql.user --include-master-host-port \u5728--dump-slave\u4ea7\u751f\u7684'CHANGE MASTER TO..'\u8bed\u53e5\u4e2d\u589e\u52a0'MASTER_HOST=<host>\uff0cMASTER_PORT=<port>' mysqldump -uroot -p --host=localhost --all-databases --include-master-host-port --insert-ignore \u5728\u63d2\u5165\u884c\u65f6\u4f7f\u7528INSERT IGNORE\u8bed\u53e5. mysqldump -uroot -p --host=localhost --all-databases --insert-ignore --lines-terminated-by \u8f93\u51fa\u6587\u4ef6\u7684\u6bcf\u884c\u7528\u7ed9\u5b9a\u5b57\u7b26\u4e32\u5212\u5206\u3002\u4e0e--tab\u9009\u9879\u4e00\u8d77\u4f7f\u7528\uff0c\u4e0d\u80fd\u7528\u4e8e--databases\u548c--all-databases\u9009\u9879\u3002 mysqldump -uroot -p --host=localhost test test --tab=\u201d/tmp/mysql\u201d --lines-terminated-by=\u201d##\u201d --lock-all-tables, -x \u63d0\u4ea4\u8bf7\u6c42\u9501\u5b9a\u6240\u6709\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u8868\uff0c\u4ee5\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\u3002\u8fd9\u662f\u4e00\u4e2a\u5168\u5c40\u8bfb\u9501\uff0c\u5e76\u4e14\u81ea\u52a8\u5173\u95ed--single-transaction \u548c--lock-tables \u9009\u9879\u3002 mysqldump -uroot -p --host=localhost --all-databases --lock-all-tables --lock-tables, -l \u5f00\u59cb\u5bfc\u51fa\u524d\uff0c\u9501\u5b9a\u6240\u6709\u8868\u3002\u7528READ LOCAL\u9501\u5b9a\u8868\u4ee5\u5141\u8bb8MyISAM\u8868\u5e76\u884c\u63d2\u5165\u3002\u5bf9\u4e8e\u652f\u6301\u4e8b\u52a1\u7684\u8868\u4f8b\u5982InnoDB\u548cBDB\uff0c--single-transaction\u662f\u4e00\u4e2a\u66f4\u597d\u7684\u9009\u62e9\uff0c\u56e0\u4e3a\u5b83\u6839\u672c\u4e0d\u9700\u8981\u9501\u5b9a\u8868\u3002 \u8bf7\u6ce8\u610f\u5f53\u5bfc\u51fa\u591a\u4e2a\u6570\u636e\u5e93\u65f6\uff0c--lock-tables\u5206\u522b\u4e3a\u6bcf\u4e2a\u6570\u636e\u5e93\u9501\u5b9a\u8868\u3002\u56e0\u6b64\uff0c\u8be5\u9009\u9879\u4e0d\u80fd\u4fdd\u8bc1\u5bfc\u51fa\u6587\u4ef6\u4e2d\u7684\u8868\u5728\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u903b\u8f91\u4e00\u81f4\u6027\u3002\u4e0d\u540c\u6570\u636e\u5e93\u8868\u7684\u5bfc\u51fa\u72b6\u6001\u53ef\u4ee5\u5b8c\u5168\u4e0d\u540c\u3002 mysqldump -uroot -p --host=localhost --all-databases --lock-tables --log-error \u9644\u52a0\u8b66\u544a\u548c\u9519\u8bef\u4fe1\u606f\u5230\u7ed9\u5b9a\u6587\u4ef6 mysqldump -uroot -p --host=localhost --all-databases --log-error=/tmp/mysqldump_error_log.err --master-data\u8be5\u9009\u9879\u5c06binlog\u7684\u4f4d\u7f6e\u548c\u6587\u4ef6\u540d\u8ffd\u52a0\u5230\u8f93\u51fa\u6587\u4ef6\u4e2d\u3002\u5982\u679c\u4e3a1\uff0c\u5c06\u4f1a\u8f93\u51faCHANGE MASTER \u547d\u4ee4\uff1b\u5982\u679c\u4e3a2\uff0c\u8f93\u51fa\u7684CHANGE MASTER\u547d\u4ee4\u524d\u6dfb\u52a0\u6ce8\u91ca\u4fe1\u606f\u3002\u8be5\u9009\u9879\u5c06\u6253\u5f00--lock-all-tables \u9009\u9879\uff0c\u9664\u975e--single-transaction\u4e5f\u88ab\u6307\u5b9a\uff08\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5168\u5c40\u8bfb\u9501\u5728\u5f00\u59cb\u5bfc\u51fa\u65f6\u83b7\u5f97\u5f88\u77ed\u7684\u65f6\u95f4\uff1b\u5176\u4ed6\u5185\u5bb9\u53c2\u8003\u4e0b\u9762\u7684--single-transaction\u9009\u9879\uff09\u3002\u8be5\u9009\u9879\u81ea\u52a8\u5173\u95ed--lock-tables\u9009\u9879\u3002 mysqldump -uroot -p --host=localhost --all-databases --master-data=1; mysqldump -uroot -p --host=localhost --all-databases --master-data=2; --max_allowed_packet \u670d\u52a1\u5668\u53d1\u9001\u548c\u63a5\u53d7\u7684\u6700\u5927\u5305\u957f\u5ea6\u3002 mysqldump -uroot -p --host=localhost --all-databases --max_allowed_packet=10240 --net_buffer_length TCP/IP\u548csocket\u8fde\u63a5\u7684\u7f13\u5b58\u5927\u5c0f\u3002 mysqldump -uroot -p --host=localhost --all-databases --net_buffer_length=1024 --no-autocommit \u4f7f\u7528autocommit/commit \u8bed\u53e5\u5305\u88f9\u8868\u3002 mysqldump -uroot -p --host=localhost --all-databases --no-autocommit --no-create-db, -n \u53ea\u5bfc\u51fa\u6570\u636e\uff0c\u800c\u4e0d\u6dfb\u52a0CREATE DATABASE \u8bed\u53e5\u3002 mysqldump -uroot -p --host=localhost --all-databases --no-create-db --no-create-info, -t \u53ea\u5bfc\u51fa\u6570\u636e\uff0c\u800c\u4e0d\u6dfb\u52a0CREATE TABLE \u8bed\u53e5\u3002 mysqldump -uroot -p --host=localhost --all-databases --no-create-info --no-data, -d \u4e0d\u5bfc\u51fa\u4efb\u4f55\u6570\u636e\uff0c\u53ea\u5bfc\u51fa\u6570\u636e\u5e93\u8868\u7ed3\u6784\u3002 mysqldump -uroot -p --host=localhost --all-databases --no-data --no-set-names, -N \u7b49\u540c\u4e8e--skip-set-charset mysqldump -uroot -p --host=localhost --all-databases --no-set-names --opt \u7b49\u540c\u4e8e--add-drop-table, --add-locks, --create-options, --quick, --extended-insert, --lock-tables, --set-charset, --disable-keys \u8be5\u9009\u9879\u9ed8\u8ba4\u5f00\u542f, \u53ef\u4ee5\u7528--skip-opt\u7981\u7528. mysqldump -uroot -p --host=localhost --all-databases --opt --order-by-primary \u5982\u679c\u5b58\u5728\u4e3b\u952e\uff0c\u6216\u8005\u7b2c\u4e00\u4e2a\u552f\u4e00\u952e\uff0c\u5bf9\u6bcf\u4e2a\u8868\u7684\u8bb0\u5f55\u8fdb\u884c\u6392\u5e8f\u3002\u5728\u5bfc\u51faMyISAM\u8868\u5230InnoDB\u8868\u65f6\u6709\u6548\uff0c\u4f46\u4f1a\u4f7f\u5f97\u5bfc\u51fa\u5de5\u4f5c\u82b1\u8d39\u5f88\u957f\u65f6\u95f4\u3002 mysqldump -uroot -p --host=localhost --all-databases --order-by-primary --password, -p \u8fde\u63a5\u6570\u636e\u5e93\u5bc6\u7801 --pipe(windows\u7cfb\u7edf\u53ef\u7528) \u4f7f\u7528\u547d\u540d\u7ba1\u9053\u8fde\u63a5mysql mysqldump -uroot -p --host=localhost --all-databases --pipe --port, -P \u8fde\u63a5\u6570\u636e\u5e93\u7aef\u53e3\u53f7 --protocol \u4f7f\u7528\u7684\u8fde\u63a5\u534f\u8bae\uff0c\u5305\u62ec\uff1atcp, socket, pipe, memory. mysqldump -uroot -p --host=localhost --all-databases --protocol=tcp --quick, -q \u4e0d\u7f13\u51b2\u67e5\u8be2\uff0c\u76f4\u63a5\u5bfc\u51fa\u5230\u6807\u51c6\u8f93\u51fa\u3002\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\uff0c\u4f7f\u7528--skip-quick\u53d6\u6d88\u8be5\u9009\u9879\u3002 mysqldump -uroot -p --host=localhost --all-databases mysqldump -uroot -p --host=localhost --all-databases --skip-quick --quote-names,-Q \u4f7f\u7528\uff08`\uff09\u5f15\u8d77\u8868\u548c\u5217\u540d\u3002\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\uff0c\u4f7f\u7528--skip-quote-names\u53d6\u6d88\u8be5\u9009\u9879\u3002 mysqldump -uroot -p --host=localhost --all-databases mysqldump -uroot -p --host=localhost --all-databases --skip-quote-names --replace \u4f7f\u7528REPLACE INTO \u53d6\u4ee3INSERT INTO. mysqldump -uroot -p --host=localhost --all-databases --replace --result-file, -r \u76f4\u63a5\u8f93\u51fa\u5230\u6307\u5b9a\u6587\u4ef6\u4e2d\u3002\u8be5\u9009\u9879\u5e94\u8be5\u7528\u5728\u4f7f\u7528\u56de\u8f66\u6362\u884c\u5bf9\uff08\\\\r\\\\n\uff09\u6362\u884c\u7684\u7cfb\u7edf\u4e0a\uff08\u4f8b\u5982\uff1aDOS\uff0cWindows\uff09\u3002\u8be5\u9009\u9879\u786e\u4fdd\u53ea\u6709\u4e00\u884c\u88ab\u4f7f\u7528\u3002 mysqldump -uroot -p --host=localhost --all-databases --result-file=/tmp/mysqldump_result_file.txt --routines, -R \u5bfc\u51fa\u5b58\u50a8\u8fc7\u7a0b\u4ee5\u53ca\u81ea\u5b9a\u4e49\u51fd\u6570\u3002 mysqldump -uroot -p --host=localhost --all-databases --routines --set-charset \u6dfb\u52a0'SET NAMES default_character_set'\u5230\u8f93\u51fa\u6587\u4ef6\u3002\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\uff0c\u4f7f\u7528--skip-set-charset\u5173\u95ed\u9009\u9879\u3002 mysqldump -uroot -p --host=localhost --all-databases mysqldump -uroot -p --host=localhost --all-databases --skip-set-charset --single-transaction \u8be5\u9009\u9879\u5728\u5bfc\u51fa\u6570\u636e\u4e4b\u524d\u63d0\u4ea4\u4e00\u4e2aBEGIN SQL\u8bed\u53e5\uff0cBEGIN \u4e0d\u4f1a\u963b\u585e\u4efb\u4f55\u5e94\u7528\u7a0b\u5e8f\u4e14\u80fd\u4fdd\u8bc1\u5bfc\u51fa\u65f6\u6570\u636e\u5e93\u7684\u4e00\u81f4\u6027\u72b6\u6001\u3002\u5b83\u53ea\u9002\u7528\u4e8e\u591a\u7248\u672c\u5b58\u50a8\u5f15\u64ce\uff0c\u4ec5InnoDB\u3002\u672c\u9009\u9879\u548c--lock-tables \u9009\u9879\u662f\u4e92\u65a5\u7684\uff0c\u56e0\u4e3aLOCK TABLES \u4f1a\u4f7f\u4efb\u4f55\u6302\u8d77\u7684\u4e8b\u52a1\u9690\u542b\u63d0\u4ea4\u3002\u8981\u60f3\u5bfc\u51fa\u5927\u8868\u7684\u8bdd\uff0c\u5e94\u7ed3\u5408\u4f7f\u7528--quick \u9009\u9879\u3002 mysqldump -uroot -p --host=localhost --all-databases --single-transaction --dump-date \u5c06\u5bfc\u51fa\u65f6\u95f4\u6dfb\u52a0\u5230\u8f93\u51fa\u6587\u4ef6\u4e2d\u3002\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\uff0c\u4f7f\u7528--skip-dump-date\u5173\u95ed\u9009\u9879\u3002 mysqldump -uroot -p --host=localhost --all-databases mysqldump -uroot -p --host=localhost --all-databases --skip-dump-date --skip-opt \u7981\u7528\u2013opt\u9009\u9879. mysqldump -uroot -p --host=localhost --all-databases --skip-opt --socket,-S \u6307\u5b9a\u8fde\u63a5mysql\u7684socket\u6587\u4ef6\u4f4d\u7f6e\uff0c\u9ed8\u8ba4\u8def\u5f84/tmp/mysql.sock mysqldump -uroot -p --host=localhost --all-databases --socket=/tmp/mysqld.sock --tab,-T \u4e3a\u6bcf\u4e2a\u8868\u5728\u7ed9\u5b9a\u8def\u5f84\u521b\u5efatab\u5206\u5272\u7684\u6587\u672c\u6587\u4ef6\u3002\u6ce8\u610f\uff1a\u4ec5\u4ec5\u7528\u4e8emysqldump\u548cmysqld\u670d\u52a1\u5668\u8fd0\u884c\u5728\u76f8\u540c\u673a\u5668\u4e0a\u3002 mysqldump -uroot -p --host=localhost test test --tab=\"/home/mysql\" --tables \u8986\u76d6--databases (-B)\u53c2\u6570\uff0c\u6307\u5b9a\u9700\u8981\u5bfc\u51fa\u7684\u8868\u540d\u3002 mysqldump -uroot -p --host=localhost --databases test --tables test --triggers \u5bfc\u51fa\u89e6\u53d1\u5668\u3002\u8be5\u9009\u9879\u9ed8\u8ba4\u542f\u7528\uff0c\u7528--skip-triggers\u7981\u7528\u5b83\u3002 mysqldump -uroot -p --host=localhost --all-databases --triggers --tz-utc \u5728\u5bfc\u51fa\u9876\u90e8\u8bbe\u7f6e\u65f6\u533aTIME_ZONE='+00:00' \uff0c\u4ee5\u4fdd\u8bc1\u5728\u4e0d\u540c\u65f6\u533a\u5bfc\u51fa\u7684TIMESTAMP \u6570\u636e\u6216\u8005\u6570\u636e\u88ab\u79fb\u52a8\u5176\u4ed6\u65f6\u533a\u65f6\u7684\u6b63\u786e\u6027\u3002 mysqldump -uroot -p --host=localhost --all-databases --tz-utc --user, -u \u6307\u5b9a\u8fde\u63a5\u7684\u7528\u6237\u540d\u3002 --verbose, --v \u8f93\u51fa\u591a\u79cd\u5e73\u53f0\u4fe1\u606f\u3002 --version, -V \u8f93\u51famysqldump\u7248\u672c\u4fe1\u606f\u5e76\u9000\u51fa --where, -w \u53ea\u8f6c\u50a8\u7ed9\u5b9a\u7684WHERE\u6761\u4ef6\u9009\u62e9\u7684\u8bb0\u5f55\u3002\u8bf7\u6ce8\u610f\u5982\u679c\u6761\u4ef6\u5305\u542b\u547d\u4ee4\u89e3\u91ca\u7b26\u4e13\u7528\u7a7a\u683c\u6216\u5b57\u7b26\uff0c\u4e00\u5b9a\u8981\u5c06\u6761\u4ef6\u5f15\u7528\u8d77\u6765\u3002 mysqldump -uroot -p --host=localhost --all-databases --where=\u201d user=\u2019root\u2019\u201d --xml, -X \u5bfc\u51faXML\u683c\u5f0f. mysqldump -uroot -p --host=localhost --all-databases --xml --plugin_dir \u5ba2\u6237\u7aef\u63d2\u4ef6\u7684\u76ee\u5f55\uff0c\u7528\u4e8e\u517c\u5bb9\u4e0d\u540c\u7684\u63d2\u4ef6\u7248\u672c\u3002 mysqldump -uroot -p --host=localhost --all-databases --plugin_dir=\u201d/usr/local/lib/plugin\u201d --default_auth \u5ba2\u6237\u7aef\u63d2\u4ef6\u9ed8\u8ba4\u4f7f\u7528\u6743\u9650\u3002 mysqldump -uroot -p --host=localhost --all-databases --default-auth=\u201d/usr/local/lib/plugin/<PLUGIN>\u201d","title":"1. mysqldump \u53c2\u6570"},{"location":"mysql/mysql.mysqldump/#1","text":"mysqldump\u662fmysql\u7528\u4e8e\u8f6c\u5b58\u50a8\u6570\u636e\u5e93\u7684\u5b9e\u7528\u7a0b\u5e8f\u3002\u5b83\u4e3b\u8981\u4ea7\u751f\u4e00\u4e2aSQL\u811a\u672c\uff0c\u5176\u4e2d\u5305\u542b\u4ece\u5934\u91cd\u65b0\u521b\u5efa\u6570\u636e\u5e93\u6240\u5fc5\u9700\u7684\u547d\u4ee4CREATE TABLE INSERT\u7b49\u3002","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.mysqldump/#2","text":"--all-databases , -A \u5bfc\u51fa\u5168\u90e8\u6570\u636e\u5e93\u3002 mysqldump -uroot -p --all-databases --all-tablespaces , -Y \u5bfc\u51fa\u5168\u90e8\u8868\u7a7a\u95f4\u3002 mysqldump -uroot -p --all-databases --all-tablespaces --no-tablespaces , -y \u4e0d\u5bfc\u51fa\u4efb\u4f55\u8868\u7a7a\u95f4\u4fe1\u606f\u3002 mysqldump -uroot -p --all-databases --no-tablespaces --add-drop-database \u6bcf\u4e2a\u6570\u636e\u5e93\u521b\u5efa\u4e4b\u524d\u6dfb\u52a0drop\u6570\u636e\u5e93\u8bed\u53e5\u3002 mysqldump -uroot -p --all-databases --add-drop-database --add-drop-table \u6bcf\u4e2a\u6570\u636e\u8868\u521b\u5efa\u4e4b\u524d\u6dfb\u52a0drop\u6570\u636e\u8868\u8bed\u53e5\u3002(\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\uff0c\u4f7f\u7528--skip-add-drop-table\u53d6\u6d88\u9009\u9879) mysqldump -uroot -p --all-databases (\u9ed8\u8ba4\u6dfb\u52a0drop\u8bed\u53e5) mysqldump -uroot -p --all-databases \u2013skip-add-drop-table (\u53d6\u6d88drop\u8bed\u53e5) --add-locks \u5728\u6bcf\u4e2a\u8868\u5bfc\u51fa\u4e4b\u524d\u589e\u52a0LOCK TABLES\u5e76\u4e14\u4e4b\u540eUNLOCK TABLE\u3002(\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\uff0c\u4f7f\u7528--skip-add-locks\u53d6\u6d88\u9009\u9879) mysqldump -uroot -p --all-databases (\u9ed8\u8ba4\u6dfb\u52a0LOCK\u8bed\u53e5) mysqldump -uroot -p --all-databases \u2013skip-add-locks (\u53d6\u6d88LOCK\u8bed\u53e5) --allow-keywords \u5141\u8bb8\u521b\u5efa\u662f\u5173\u952e\u8bcd\u7684\u5217\u540d\u5b57\u3002\u8fd9\u7531\u8868\u540d\u524d\u7f00\u4e8e\u6bcf\u4e2a\u5217\u540d\u505a\u5230\u3002 mysqldump -uroot -p --all-databases --allow-keywords --apply-slave-statements \u5728'CHANGE MASTER'\u524d\u6dfb\u52a0'STOP SLAVE'\uff0c\u5e76\u4e14\u5728\u5bfc\u51fa\u7684\u6700\u540e\u6dfb\u52a0'START SLAVE'\u3002 mysqldump -uroot -p --all-databases --apply-slave-statements --character-sets-dir \u5b57\u7b26\u96c6\u6587\u4ef6\u7684\u76ee\u5f55 mysqldump -uroot -p --all-databases --character-sets-dir=/usr/local/mysql/share/mysql/charsets --comments \u9644\u52a0\u6ce8\u91ca\u4fe1\u606f\u3002\u9ed8\u8ba4\u4e3a\u6253\u5f00\uff0c\u53ef\u4ee5\u7528--skip-comments\u53d6\u6d88 mysqldump -uroot -p --all-databases (\u9ed8\u8ba4\u8bb0\u5f55\u6ce8\u91ca) mysqldump -uroot -p --all-databases --skip-comments (\u53d6\u6d88\u6ce8\u91ca) --compatible \u5bfc\u51fa\u7684\u6570\u636e\u5c06\u548c\u5176\u5b83\u6570\u636e\u5e93\u6216\u65e7\u7248\u672c\u7684MySQL \u76f8\u517c\u5bb9\u3002 \u503c\u53ef\u4ee5\u4e3aansi\u3001mysql323\u3001mysql40\u3001postgresql\u3001oracle\u3001mssql\u3001db2\u3001maxdb\u3001no_key_options\u3001no_tables_options\u3001no_field_options\u7b49\uff0c \u8981\u4f7f\u7528\u51e0\u4e2a\u503c\uff0c\u7528\u9017\u53f7\u5c06\u5b83\u4eec\u9694\u5f00\u3002\u5b83\u5e76\u4e0d\u4fdd\u8bc1\u80fd\u5b8c\u5168\u517c\u5bb9\uff0c\u800c\u662f\u5c3d\u91cf\u517c\u5bb9\u3002 mysqldump -uroot -p --all-databases --compatible=ansi --compact \u5bfc\u51fa\u66f4\u5c11\u7684\u8f93\u51fa\u4fe1\u606f(\u7528\u4e8e\u8c03\u8bd5)\u3002\u53bb\u6389\u6ce8\u91ca\u548c\u5934\u5c3e\u7b49\u7ed3\u6784\u3002\u53ef\u4ee5\u4f7f\u7528\u9009\u9879\uff1a--skip-add-drop-table --skip-add-locks --skip-comments --skip-disable-keys mysqldump -uroot -p --all-databases --compact --complete-insert, -c \u4f7f\u7528\u5b8c\u6574\u7684insert\u8bed\u53e5(\u5305\u542b\u5217\u540d\u79f0)\u3002\u8fd9\u4e48\u505a\u80fd\u63d0\u9ad8\u63d2\u5165\u6548\u7387\uff0c\u4f46\u662f\u53ef\u80fd\u4f1a\u53d7\u5230max_allowed_packet\u53c2\u6570\u7684\u5f71\u54cd\u800c\u5bfc\u81f4\u63d2\u5165\u5931\u8d25\u3002 mysqldump -uroot -p --all-databases --complete-insert --compress, -C \u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u542f\u7528\u538b\u7f29\u4f20\u9012\u6240\u6709\u4fe1\u606f mysqldump -uroot -p --all-databases --compress --create-options, -a \u5728CREATE TABLE\u8bed\u53e5\u4e2d\u5305\u62ec\u6240\u6709MySQL\u7279\u6027\u9009\u9879\u3002(\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001) mysqldump -uroot -p --all-databases --databases, -B \u5bfc\u51fa\u51e0\u4e2a\u6570\u636e\u5e93\u3002\u53c2\u6570\u540e\u9762\u6240\u6709\u540d\u5b57\u53c2\u91cf\u90fd\u88ab\u770b\u4f5c\u6570\u636e\u5e93\u540d\u3002 mysqldump -uroot -p --databases test mysql --debug \u8f93\u51fadebug\u4fe1\u606f\uff0c\u7528\u4e8e\u8c03\u8bd5\u3002\u9ed8\u8ba4\u503c\u4e3a\uff1ad:t:o,/tmp/mysqldump.trace mysqldump -uroot -p --all-databases --debug mysqldump -uroot -p --all-databases --debug=\u201d d:t:o,/tmp/debug.trace\u201d --debug-check \u68c0\u67e5\u5185\u5b58\u548c\u6253\u5f00\u6587\u4ef6\u4f7f\u7528\u8bf4\u660e\u5e76\u9000\u51fa\u3002 mysqldump -uroot -p --all-databases --debug-check --debug-info \u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f\u5e76\u9000\u51fa mysqldump -uroot -p --all-databases --debug-info --default-character-set \u8bbe\u7f6e\u9ed8\u8ba4\u5b57\u7b26\u96c6\uff0c\u9ed8\u8ba4\u503c\u4e3autf8 mysqldump -uroot -p --all-databases --default-character-set=latin1 --delayed-insert \u91c7\u7528\u5ef6\u65f6\u63d2\u5165\u65b9\u5f0f\uff08INSERT DELAYED\uff09\u5bfc\u51fa\u6570\u636e mysqldump -uroot -p --all-databases --delayed-insert --delete-master-logs master\u5907\u4efd\u540e\u5220\u9664\u65e5\u5fd7. \u8fd9\u4e2a\u53c2\u6570\u5c06\u81ea\u52a8\u6fc0\u6d3b--master-data\u3002 mysqldump -uroot -p --all-databases --delete-master-logs --disable-keys\u5bf9\u4e8e\u6bcf\u4e2a\u8868\uff0c\u7528/*!40000 ALTER TABLE tbl_name DISABLE KEYS */;\u548c/*!40000 ALTER TABLE tbl_name ENABLE KEYS */;\u8bed\u53e5\u5f15\u7528INSERT\u8bed\u53e5\u3002\u8fd9\u6837\u53ef\u4ee5\u66f4\u5feb\u5730\u5bfc\u5165dump\u51fa\u6765\u7684\u6587\u4ef6\uff0c\u56e0\u4e3a\u5b83\u662f\u5728\u63d2\u5165\u6240\u6709\u884c\u540e\u521b\u5efa\u7d22\u5f15\u7684\u3002\u8be5\u9009\u9879\u53ea\u9002\u5408MyISAM\u8868\uff0c\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\u3002 mysqldump -uroot -p --all-databases --dump-slave \u8be5\u9009\u9879\u5c06\u5bfc\u81f4\u4e3b\u7684binlog\u4f4d\u7f6e\u548c\u6587\u4ef6\u540d\u8ffd\u52a0\u5230\u5bfc\u51fa\u6570\u636e\u7684\u6587\u4ef6\u4e2d\u3002\u8bbe\u7f6e\u4e3a1\u65f6\uff0c\u5c06\u4f1a\u4ee5CHANGE MASTER\u547d\u4ee4\u8f93\u51fa\u5230\u6570\u636e\u6587\u4ef6\uff1b\u8bbe\u7f6e\u4e3a2\u65f6\uff0c\u5728\u547d\u4ee4\u524d\u589e\u52a0\u8bf4\u660e\u4fe1\u606f\u3002\u8be5\u9009\u9879\u5c06\u4f1a\u6253\u5f00--lock-all-tables\uff0c\u9664\u975e--single-transaction\u88ab\u6307\u5b9a\u3002\u8be5\u9009\u9879\u4f1a\u81ea\u52a8\u5173\u95ed--lock-tables\u9009\u9879\u3002\u9ed8\u8ba4\u503c\u4e3a0\u3002 mysqldump -uroot -p --all-databases --dump-slave=1 mysqldump -uroot -p --all-databases --dump-slave=2 --events, -E \u5bfc\u51fa\u4e8b\u4ef6\u3002 mysqldump -uroot -p --all-databases --events --extended-insert, -e \u4f7f\u7528\u5177\u6709\u591a\u4e2aVALUES\u5217\u7684INSERT\u8bed\u6cd5\u3002\u8fd9\u6837\u4f7f\u5bfc\u51fa\u6587\u4ef6\u66f4\u5c0f\uff0c\u5e76\u52a0\u901f\u5bfc\u5165\u65f6\u7684\u901f\u5ea6\u3002\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\uff0c\u4f7f\u7528--skip-extended-insert\u53d6\u6d88\u9009\u9879\u3002 mysqldump -uroot -p --all-databases mysqldump -uroot -p --all-databases--skip-extended-insert (\u53d6\u6d88\u9009\u9879) --fields-terminated-by \u5bfc\u51fa\u6587\u4ef6\u4e2d\u5ffd\u7565\u7ed9\u5b9a\u5b57\u6bb5\u3002\u4e0e--tab\u9009\u9879\u4e00\u8d77\u4f7f\u7528\uff0c\u4e0d\u80fd\u7528\u4e8e--databases\u548c--all-databases\u9009\u9879 mysqldump -uroot -p test test --tab=\u201d/home/mysql\u201d --fields-terminated-by=\u201d#\u201d --fields-enclosed-by \u8f93\u51fa\u6587\u4ef6\u4e2d\u7684\u5404\u4e2a\u5b57\u6bb5\u7528\u7ed9\u5b9a\u5b57\u7b26\u5305\u88f9\u3002\u4e0e--tab\u9009\u9879\u4e00\u8d77\u4f7f\u7528\uff0c\u4e0d\u80fd\u7528\u4e8e--databases\u548c--all-databases\u9009\u9879 mysqldump -uroot -p test test --tab=\u201d/home/mysql\u201d --fields-enclosed-by=\u201d#\u201d --fields-optionally-enclosed-by \u8f93\u51fa\u6587\u4ef6\u4e2d\u7684\u5404\u4e2a\u5b57\u6bb5\u7528\u7ed9\u5b9a\u5b57\u7b26\u9009\u62e9\u6027\u5305\u88f9\u3002\u4e0e--tab\u9009\u9879\u4e00\u8d77\u4f7f\u7528\uff0c\u4e0d\u80fd\u7528\u4e8e--databases\u548c--all-databases\u9009\u9879 mysqldump -uroot -p test test --tab=\u201d/home/mysql\u201d --fields-enclosed-by=\u201d#\u201d --fields-optionally-enclosed-by =\u201d#\u201d --fields-escaped-by \u8f93\u51fa\u6587\u4ef6\u4e2d\u7684\u5404\u4e2a\u5b57\u6bb5\u5ffd\u7565\u7ed9\u5b9a\u5b57\u7b26\u3002\u4e0e--tab\u9009\u9879\u4e00\u8d77\u4f7f\u7528\uff0c\u4e0d\u80fd\u7528\u4e8e--databases\u548c--all-databases\u9009\u9879 mysqldump -uroot -p mysql user --tab=\u201d/home/mysql\u201d --fields-escaped-by=\u201d#\u201d --flush-logs \u5f00\u59cb\u5bfc\u51fa\u4e4b\u524d\u5237\u65b0\u65e5\u5fd7\u3002 \u8bf7\u6ce8\u610f\uff1a\u5047\u5982\u4e00\u6b21\u5bfc\u51fa\u591a\u4e2a\u6570\u636e\u5e93(\u4f7f\u7528\u9009\u9879--databases\u6216\u8005--all-databases)\uff0c\u5c06\u4f1a\u9010\u4e2a\u6570\u636e\u5e93\u5237\u65b0\u65e5\u5fd7\u3002\u9664\u4f7f\u7528--lock-all-tables\u6216\u8005--master-data\u5916\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u65e5\u5fd7\u5c06\u4f1a\u88ab\u5237\u65b0\u4e00\u6b21\uff0c\u76f8\u5e94\u7684\u6240\u4ee5\u8868\u540c\u65f6\u88ab\u9501\u5b9a\u3002\u56e0\u6b64\uff0c\u5982\u679c\u6253\u7b97\u540c\u65f6\u5bfc\u51fa\u548c\u5237\u65b0\u65e5\u5fd7\u5e94\u8be5\u4f7f\u7528--lock-all-tables \u6216\u8005--master-data \u548c--flush-logs\u3002 mysqldump -uroot -p --all-databases --flush-logs --flush-privileges \u5728\u5bfc\u51famysql\u6570\u636e\u5e93\u4e4b\u540e\uff0c\u53d1\u51fa\u4e00\u6761FLUSH PRIVILEGES \u8bed\u53e5\u3002\u4e3a\u4e86\u6b63\u786e\u6062\u590d\uff0c\u8be5\u9009\u9879\u5e94\u8be5\u7528\u4e8e\u5bfc\u51famysql\u6570\u636e\u5e93\u548c\u4f9d\u8d56mysql\u6570\u636e\u5e93\u6570\u636e\u7684\u4efb\u4f55\u65f6\u5019\u3002 mysqldump -uroot -p --all-databases --flush-privileges --force \u5728\u5bfc\u51fa\u8fc7\u7a0b\u4e2d\u5ffd\u7565\u51fa\u73b0\u7684SQL\u9519\u8bef\u3002 mysqldump -uroot -p --all-databases --force --help \u663e\u793a\u5e2e\u52a9\u4fe1\u606f\u5e76\u9000\u51fa\u3002 mysqldump --help --hex-blob \u4f7f\u7528\u5341\u516d\u8fdb\u5236\u683c\u5f0f\u5bfc\u51fa\u4e8c\u8fdb\u5236\u5b57\u7b26\u4e32\u5b57\u6bb5\u3002\u5982\u679c\u6709\u4e8c\u8fdb\u5236\u6570\u636e\u5c31\u5fc5\u987b\u4f7f\u7528\u8be5\u9009\u9879\u3002\u5f71\u54cd\u5230\u7684\u5b57\u6bb5\u7c7b\u578b\u6709BINARY\u3001VARBINARY\u3001BLOB\u3002 mysqldump -uroot -p --all-databases --hex-blob --host, -h \u9700\u8981\u5bfc\u51fa\u7684\u4e3b\u673a\u4fe1\u606f mysqldump -uroot -p --host=localhost --all-databases --ignore-table \u4e0d\u5bfc\u51fa\u6307\u5b9a\u8868\u3002\u6307\u5b9a\u5ffd\u7565\u591a\u4e2a\u8868\u65f6\uff0c\u9700\u8981\u91cd\u590d\u591a\u6b21\uff0c\u6bcf\u6b21\u4e00\u4e2a\u8868\u3002\u6bcf\u4e2a\u8868\u5fc5\u987b\u540c\u65f6\u6307\u5b9a\u6570\u636e\u5e93\u548c\u8868\u540d\u3002\u4f8b\u5982\uff1a--ignore-table=database.table1 --ignore-table=database.table2 \u2026\u2026 mysqldump -uroot -p --host=localhost --all-databases --ignore-table=mysql.user --include-master-host-port \u5728--dump-slave\u4ea7\u751f\u7684'CHANGE MASTER TO..'\u8bed\u53e5\u4e2d\u589e\u52a0'MASTER_HOST=<host>\uff0cMASTER_PORT=<port>' mysqldump -uroot -p --host=localhost --all-databases --include-master-host-port --insert-ignore \u5728\u63d2\u5165\u884c\u65f6\u4f7f\u7528INSERT IGNORE\u8bed\u53e5. mysqldump -uroot -p --host=localhost --all-databases --insert-ignore --lines-terminated-by \u8f93\u51fa\u6587\u4ef6\u7684\u6bcf\u884c\u7528\u7ed9\u5b9a\u5b57\u7b26\u4e32\u5212\u5206\u3002\u4e0e--tab\u9009\u9879\u4e00\u8d77\u4f7f\u7528\uff0c\u4e0d\u80fd\u7528\u4e8e--databases\u548c--all-databases\u9009\u9879\u3002 mysqldump -uroot -p --host=localhost test test --tab=\u201d/tmp/mysql\u201d --lines-terminated-by=\u201d##\u201d --lock-all-tables, -x \u63d0\u4ea4\u8bf7\u6c42\u9501\u5b9a\u6240\u6709\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u8868\uff0c\u4ee5\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\u3002\u8fd9\u662f\u4e00\u4e2a\u5168\u5c40\u8bfb\u9501\uff0c\u5e76\u4e14\u81ea\u52a8\u5173\u95ed--single-transaction \u548c--lock-tables \u9009\u9879\u3002 mysqldump -uroot -p --host=localhost --all-databases --lock-all-tables --lock-tables, -l \u5f00\u59cb\u5bfc\u51fa\u524d\uff0c\u9501\u5b9a\u6240\u6709\u8868\u3002\u7528READ LOCAL\u9501\u5b9a\u8868\u4ee5\u5141\u8bb8MyISAM\u8868\u5e76\u884c\u63d2\u5165\u3002\u5bf9\u4e8e\u652f\u6301\u4e8b\u52a1\u7684\u8868\u4f8b\u5982InnoDB\u548cBDB\uff0c--single-transaction\u662f\u4e00\u4e2a\u66f4\u597d\u7684\u9009\u62e9\uff0c\u56e0\u4e3a\u5b83\u6839\u672c\u4e0d\u9700\u8981\u9501\u5b9a\u8868\u3002 \u8bf7\u6ce8\u610f\u5f53\u5bfc\u51fa\u591a\u4e2a\u6570\u636e\u5e93\u65f6\uff0c--lock-tables\u5206\u522b\u4e3a\u6bcf\u4e2a\u6570\u636e\u5e93\u9501\u5b9a\u8868\u3002\u56e0\u6b64\uff0c\u8be5\u9009\u9879\u4e0d\u80fd\u4fdd\u8bc1\u5bfc\u51fa\u6587\u4ef6\u4e2d\u7684\u8868\u5728\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u903b\u8f91\u4e00\u81f4\u6027\u3002\u4e0d\u540c\u6570\u636e\u5e93\u8868\u7684\u5bfc\u51fa\u72b6\u6001\u53ef\u4ee5\u5b8c\u5168\u4e0d\u540c\u3002 mysqldump -uroot -p --host=localhost --all-databases --lock-tables --log-error \u9644\u52a0\u8b66\u544a\u548c\u9519\u8bef\u4fe1\u606f\u5230\u7ed9\u5b9a\u6587\u4ef6 mysqldump -uroot -p --host=localhost --all-databases --log-error=/tmp/mysqldump_error_log.err --master-data\u8be5\u9009\u9879\u5c06binlog\u7684\u4f4d\u7f6e\u548c\u6587\u4ef6\u540d\u8ffd\u52a0\u5230\u8f93\u51fa\u6587\u4ef6\u4e2d\u3002\u5982\u679c\u4e3a1\uff0c\u5c06\u4f1a\u8f93\u51faCHANGE MASTER \u547d\u4ee4\uff1b\u5982\u679c\u4e3a2\uff0c\u8f93\u51fa\u7684CHANGE MASTER\u547d\u4ee4\u524d\u6dfb\u52a0\u6ce8\u91ca\u4fe1\u606f\u3002\u8be5\u9009\u9879\u5c06\u6253\u5f00--lock-all-tables \u9009\u9879\uff0c\u9664\u975e--single-transaction\u4e5f\u88ab\u6307\u5b9a\uff08\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5168\u5c40\u8bfb\u9501\u5728\u5f00\u59cb\u5bfc\u51fa\u65f6\u83b7\u5f97\u5f88\u77ed\u7684\u65f6\u95f4\uff1b\u5176\u4ed6\u5185\u5bb9\u53c2\u8003\u4e0b\u9762\u7684--single-transaction\u9009\u9879\uff09\u3002\u8be5\u9009\u9879\u81ea\u52a8\u5173\u95ed--lock-tables\u9009\u9879\u3002 mysqldump -uroot -p --host=localhost --all-databases --master-data=1; mysqldump -uroot -p --host=localhost --all-databases --master-data=2; --max_allowed_packet \u670d\u52a1\u5668\u53d1\u9001\u548c\u63a5\u53d7\u7684\u6700\u5927\u5305\u957f\u5ea6\u3002 mysqldump -uroot -p --host=localhost --all-databases --max_allowed_packet=10240 --net_buffer_length TCP/IP\u548csocket\u8fde\u63a5\u7684\u7f13\u5b58\u5927\u5c0f\u3002 mysqldump -uroot -p --host=localhost --all-databases --net_buffer_length=1024 --no-autocommit \u4f7f\u7528autocommit/commit \u8bed\u53e5\u5305\u88f9\u8868\u3002 mysqldump -uroot -p --host=localhost --all-databases --no-autocommit --no-create-db, -n \u53ea\u5bfc\u51fa\u6570\u636e\uff0c\u800c\u4e0d\u6dfb\u52a0CREATE DATABASE \u8bed\u53e5\u3002 mysqldump -uroot -p --host=localhost --all-databases --no-create-db --no-create-info, -t \u53ea\u5bfc\u51fa\u6570\u636e\uff0c\u800c\u4e0d\u6dfb\u52a0CREATE TABLE \u8bed\u53e5\u3002 mysqldump -uroot -p --host=localhost --all-databases --no-create-info --no-data, -d \u4e0d\u5bfc\u51fa\u4efb\u4f55\u6570\u636e\uff0c\u53ea\u5bfc\u51fa\u6570\u636e\u5e93\u8868\u7ed3\u6784\u3002 mysqldump -uroot -p --host=localhost --all-databases --no-data --no-set-names, -N \u7b49\u540c\u4e8e--skip-set-charset mysqldump -uroot -p --host=localhost --all-databases --no-set-names --opt \u7b49\u540c\u4e8e--add-drop-table, --add-locks, --create-options, --quick, --extended-insert, --lock-tables, --set-charset, --disable-keys \u8be5\u9009\u9879\u9ed8\u8ba4\u5f00\u542f, \u53ef\u4ee5\u7528--skip-opt\u7981\u7528. mysqldump -uroot -p --host=localhost --all-databases --opt --order-by-primary \u5982\u679c\u5b58\u5728\u4e3b\u952e\uff0c\u6216\u8005\u7b2c\u4e00\u4e2a\u552f\u4e00\u952e\uff0c\u5bf9\u6bcf\u4e2a\u8868\u7684\u8bb0\u5f55\u8fdb\u884c\u6392\u5e8f\u3002\u5728\u5bfc\u51faMyISAM\u8868\u5230InnoDB\u8868\u65f6\u6709\u6548\uff0c\u4f46\u4f1a\u4f7f\u5f97\u5bfc\u51fa\u5de5\u4f5c\u82b1\u8d39\u5f88\u957f\u65f6\u95f4\u3002 mysqldump -uroot -p --host=localhost --all-databases --order-by-primary --password, -p \u8fde\u63a5\u6570\u636e\u5e93\u5bc6\u7801 --pipe(windows\u7cfb\u7edf\u53ef\u7528) \u4f7f\u7528\u547d\u540d\u7ba1\u9053\u8fde\u63a5mysql mysqldump -uroot -p --host=localhost --all-databases --pipe --port, -P \u8fde\u63a5\u6570\u636e\u5e93\u7aef\u53e3\u53f7 --protocol \u4f7f\u7528\u7684\u8fde\u63a5\u534f\u8bae\uff0c\u5305\u62ec\uff1atcp, socket, pipe, memory. mysqldump -uroot -p --host=localhost --all-databases --protocol=tcp --quick, -q \u4e0d\u7f13\u51b2\u67e5\u8be2\uff0c\u76f4\u63a5\u5bfc\u51fa\u5230\u6807\u51c6\u8f93\u51fa\u3002\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\uff0c\u4f7f\u7528--skip-quick\u53d6\u6d88\u8be5\u9009\u9879\u3002 mysqldump -uroot -p --host=localhost --all-databases mysqldump -uroot -p --host=localhost --all-databases --skip-quick --quote-names,-Q \u4f7f\u7528\uff08`\uff09\u5f15\u8d77\u8868\u548c\u5217\u540d\u3002\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\uff0c\u4f7f\u7528--skip-quote-names\u53d6\u6d88\u8be5\u9009\u9879\u3002 mysqldump -uroot -p --host=localhost --all-databases mysqldump -uroot -p --host=localhost --all-databases --skip-quote-names --replace \u4f7f\u7528REPLACE INTO \u53d6\u4ee3INSERT INTO. mysqldump -uroot -p --host=localhost --all-databases --replace --result-file, -r \u76f4\u63a5\u8f93\u51fa\u5230\u6307\u5b9a\u6587\u4ef6\u4e2d\u3002\u8be5\u9009\u9879\u5e94\u8be5\u7528\u5728\u4f7f\u7528\u56de\u8f66\u6362\u884c\u5bf9\uff08\\\\r\\\\n\uff09\u6362\u884c\u7684\u7cfb\u7edf\u4e0a\uff08\u4f8b\u5982\uff1aDOS\uff0cWindows\uff09\u3002\u8be5\u9009\u9879\u786e\u4fdd\u53ea\u6709\u4e00\u884c\u88ab\u4f7f\u7528\u3002 mysqldump -uroot -p --host=localhost --all-databases --result-file=/tmp/mysqldump_result_file.txt --routines, -R \u5bfc\u51fa\u5b58\u50a8\u8fc7\u7a0b\u4ee5\u53ca\u81ea\u5b9a\u4e49\u51fd\u6570\u3002 mysqldump -uroot -p --host=localhost --all-databases --routines --set-charset \u6dfb\u52a0'SET NAMES default_character_set'\u5230\u8f93\u51fa\u6587\u4ef6\u3002\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\uff0c\u4f7f\u7528--skip-set-charset\u5173\u95ed\u9009\u9879\u3002 mysqldump -uroot -p --host=localhost --all-databases mysqldump -uroot -p --host=localhost --all-databases --skip-set-charset --single-transaction \u8be5\u9009\u9879\u5728\u5bfc\u51fa\u6570\u636e\u4e4b\u524d\u63d0\u4ea4\u4e00\u4e2aBEGIN SQL\u8bed\u53e5\uff0cBEGIN \u4e0d\u4f1a\u963b\u585e\u4efb\u4f55\u5e94\u7528\u7a0b\u5e8f\u4e14\u80fd\u4fdd\u8bc1\u5bfc\u51fa\u65f6\u6570\u636e\u5e93\u7684\u4e00\u81f4\u6027\u72b6\u6001\u3002\u5b83\u53ea\u9002\u7528\u4e8e\u591a\u7248\u672c\u5b58\u50a8\u5f15\u64ce\uff0c\u4ec5InnoDB\u3002\u672c\u9009\u9879\u548c--lock-tables \u9009\u9879\u662f\u4e92\u65a5\u7684\uff0c\u56e0\u4e3aLOCK TABLES \u4f1a\u4f7f\u4efb\u4f55\u6302\u8d77\u7684\u4e8b\u52a1\u9690\u542b\u63d0\u4ea4\u3002\u8981\u60f3\u5bfc\u51fa\u5927\u8868\u7684\u8bdd\uff0c\u5e94\u7ed3\u5408\u4f7f\u7528--quick \u9009\u9879\u3002 mysqldump -uroot -p --host=localhost --all-databases --single-transaction --dump-date \u5c06\u5bfc\u51fa\u65f6\u95f4\u6dfb\u52a0\u5230\u8f93\u51fa\u6587\u4ef6\u4e2d\u3002\u9ed8\u8ba4\u4e3a\u6253\u5f00\u72b6\u6001\uff0c\u4f7f\u7528--skip-dump-date\u5173\u95ed\u9009\u9879\u3002 mysqldump -uroot -p --host=localhost --all-databases mysqldump -uroot -p --host=localhost --all-databases --skip-dump-date --skip-opt \u7981\u7528\u2013opt\u9009\u9879. mysqldump -uroot -p --host=localhost --all-databases --skip-opt --socket,-S \u6307\u5b9a\u8fde\u63a5mysql\u7684socket\u6587\u4ef6\u4f4d\u7f6e\uff0c\u9ed8\u8ba4\u8def\u5f84/tmp/mysql.sock mysqldump -uroot -p --host=localhost --all-databases --socket=/tmp/mysqld.sock --tab,-T \u4e3a\u6bcf\u4e2a\u8868\u5728\u7ed9\u5b9a\u8def\u5f84\u521b\u5efatab\u5206\u5272\u7684\u6587\u672c\u6587\u4ef6\u3002\u6ce8\u610f\uff1a\u4ec5\u4ec5\u7528\u4e8emysqldump\u548cmysqld\u670d\u52a1\u5668\u8fd0\u884c\u5728\u76f8\u540c\u673a\u5668\u4e0a\u3002 mysqldump -uroot -p --host=localhost test test --tab=\"/home/mysql\" --tables \u8986\u76d6--databases (-B)\u53c2\u6570\uff0c\u6307\u5b9a\u9700\u8981\u5bfc\u51fa\u7684\u8868\u540d\u3002 mysqldump -uroot -p --host=localhost --databases test --tables test --triggers \u5bfc\u51fa\u89e6\u53d1\u5668\u3002\u8be5\u9009\u9879\u9ed8\u8ba4\u542f\u7528\uff0c\u7528--skip-triggers\u7981\u7528\u5b83\u3002 mysqldump -uroot -p --host=localhost --all-databases --triggers --tz-utc \u5728\u5bfc\u51fa\u9876\u90e8\u8bbe\u7f6e\u65f6\u533aTIME_ZONE='+00:00' \uff0c\u4ee5\u4fdd\u8bc1\u5728\u4e0d\u540c\u65f6\u533a\u5bfc\u51fa\u7684TIMESTAMP \u6570\u636e\u6216\u8005\u6570\u636e\u88ab\u79fb\u52a8\u5176\u4ed6\u65f6\u533a\u65f6\u7684\u6b63\u786e\u6027\u3002 mysqldump -uroot -p --host=localhost --all-databases --tz-utc --user, -u \u6307\u5b9a\u8fde\u63a5\u7684\u7528\u6237\u540d\u3002 --verbose, --v \u8f93\u51fa\u591a\u79cd\u5e73\u53f0\u4fe1\u606f\u3002 --version, -V \u8f93\u51famysqldump\u7248\u672c\u4fe1\u606f\u5e76\u9000\u51fa --where, -w \u53ea\u8f6c\u50a8\u7ed9\u5b9a\u7684WHERE\u6761\u4ef6\u9009\u62e9\u7684\u8bb0\u5f55\u3002\u8bf7\u6ce8\u610f\u5982\u679c\u6761\u4ef6\u5305\u542b\u547d\u4ee4\u89e3\u91ca\u7b26\u4e13\u7528\u7a7a\u683c\u6216\u5b57\u7b26\uff0c\u4e00\u5b9a\u8981\u5c06\u6761\u4ef6\u5f15\u7528\u8d77\u6765\u3002 mysqldump -uroot -p --host=localhost --all-databases --where=\u201d user=\u2019root\u2019\u201d --xml, -X \u5bfc\u51faXML\u683c\u5f0f. mysqldump -uroot -p --host=localhost --all-databases --xml --plugin_dir \u5ba2\u6237\u7aef\u63d2\u4ef6\u7684\u76ee\u5f55\uff0c\u7528\u4e8e\u517c\u5bb9\u4e0d\u540c\u7684\u63d2\u4ef6\u7248\u672c\u3002 mysqldump -uroot -p --host=localhost --all-databases --plugin_dir=\u201d/usr/local/lib/plugin\u201d --default_auth \u5ba2\u6237\u7aef\u63d2\u4ef6\u9ed8\u8ba4\u4f7f\u7528\u6743\u9650\u3002 mysqldump -uroot -p --host=localhost --all-databases --default-auth=\u201d/usr/local/lib/plugin/<PLUGIN>\u201d","title":"2. \u53c2\u6570"},{"location":"mysql/mysql.mysqldump_case/","text":"MySQLDUMP 1. \u5206\u5e93\u5907\u4efd \u00b6 root@leco:/opt/bin# cat Store_backup.sh #!/bin/sh #author: caimengzhi #date:2017-01-20 MYUSER=root MYPASS=root MYLOGIN=\"mysql -u$MYUSER -p$MYPASS\" MYDUMP=\"mysqldump -u$MYUSER -p$MYPASS\" DATABASE=\"$($MYLOGIN -e \"show databases;\"|egrep -vi \"Data|_schema|mysql\")\" [ ! -f /server/backup/ ] && mkdir -p /server/backup/ for dbname in $DATABASE do MYDIR=/server/backup/$dbname [ ! -d $MYDIR ] && mkdir -p $MYDIR $MYDUMP $dbname|gzip >$MYDIR/${dbname}_$(date +%F).sql.gz done \u6267\u884c\u540e root@leco:/opt/bin# sh Store_backup.sh mysql: [Warning] Using a password on the command line interface can be insecure. mysqldump: [Warning] Using a password on the command line interface can be insecure. mysqldump: [Warning] Using a password on the command line interface can be insecure. mysqldump: [Warning] Using a password on the command line interface can be insecure. mysqldump: [Warning] Using a password on the command line interface can be insecure. mysqldump: [Warning] Using a password on the command line interface can be insecure. mysqldump: [Warning] Using a password on the command line interface can be insecure. mysqldump: [Warning] Using a password on the command line interface can be insecure. root@leco:/opt/bin# ls /server/backup/ cmz db1 leco prv_app_scbxy qiushibaike s12day113 sys \u53ef\u4ee5\u7ed3\u5408crontab\u5b9a\u65f6\u5907\u4efd\u3002 root@leco:/opt/bin# crontab -l | grep Store_backup 0 0 * * * /bin/bash /opt/bin/Store_backup.sh >/dev/null 2>&1 2. \u5206\u8868\u5907\u4efd \u00b6 root@leco:/opt/bin# cat mysql_table.sh #!/bin/sh #author: caimengzhi #date:2017-01-20 USER=root PASSWD=root MYLOGIN=\"mysql -u$USER -p$PASSWD\" MYDUMP=\"mysqldump -u$USER -p$PASSWD\" DATEBASE=\"$($MYLOGIN -e \"show databases;\"|egrep -vi \"Data|_schema|mysql\")\" [ ! -f /server/backup/tables ] && mkdir -p /server/backup for dbname in $DATEBASE do TABLE=\"$($MYLOGIN -e \"use $dbname;show tables;\"|sed '1d')\" for tname in $TABLE do MYDIR=/server/backup/$dbname/${dbname}_$(date +%F) [ ! -d $MYDIR ] && mkdir -p $MYDIR $MYDUMP $dbname $tname |gzip >$MYDIR/${dbname}_${tname}_$(date +%F).sql.gz done done \u6267\u884c\u540e root@leco:/opt/bin# sh mysql_table.sh root@leco:/opt/bin# ls /server/backup/ cmz/ db1/ leco/ prv_app_scbxy/ qiushibaike/ s12day113/ sys/ root@leco:/opt/bin# ls /server/backup/cmz/ cmz_2019-02-28 \u53ef\u4ee5\u7ed3\u5408crontab\u5b9a\u65f6\u5907\u4efd\u3002 root@leco:/opt/bin# crontab -l | grep mysql_table 0 0 * * * /bin/bash /opt/bin/mysql_table.sh >/dev/null 2>&1 3. \u4f18\u7f3a\u70b9 \u00b6 \u6bd4\u8f83 1. \u4f18\u70b9\uff1a \u6062\u590d\u7b80\u5355\uff0c\u53ef\u4ee5\u4f7f\u7528\u7ba1\u9053\u5c06\u4ed6\u4eec\u8f93\u5165\u5230 mysql \u4e0e\u5b58\u50a8\u5f15\u64ce\u65e0\u5173\uff0c\u56e0\u4e3a\u662f\u4ece MySQL\u670d\u52a1\u5668\u4e2d\u63d0\u53d6\u6570\u636e\u800c\u751f\u6210\u7684 \uff0c\u6240\u4ee5\u6d88\u9664\u4e86\u5e95\u5c42\u6570\u636e\u5b58\u50a8\u7684\u4e0d\u540c \u6709\u52a9\u4e8e\u907f\u514d\u6570\u636e\u635f\u574f\u3002\u82e5\u78c1\u76d8\u9a71\u52a8\u5668\u6709\u6545\u969c\u800c\u8981\u590d\u5236\u539f\u59cb\u6587\u4ef6\u65f6\uff0c\u6b64\u65f6\u5c06\u5f97\u5230\u4e00\u4e2a\u635f\u574f\u7684\u5907\u4efd 2. \u7f3a\u70b9\uff1a \u5fc5\u987b\u6709\u6570\u636e\u5e93\u670d\u52a1\u5668\u5b8c\u6210\u903b\u8f91\u5de5\u4f5c\uff0c\u9700\u8981\u66f4\u591a\u5730 cpu\u5468\u671f \u903b\u8f91\u5907\u4efd\u8fd8\u539f\u901f\u5ea6\u6162\uff1a\u9700\u8981 MySQL\u52a0\u8f7d\u548c\u89e3\u91ca\u8bed\u53e5 \u3001\u8f6c\u5316\u5b58\u50a8\u683c\u5f0f\u3001\u91cd\u5efa\u5f15\u64ce","title":"2. mysqldump \u811a\u672c"},{"location":"mysql/mysql.mysqldump_case/#1","text":"root@leco:/opt/bin# cat Store_backup.sh #!/bin/sh #author: caimengzhi #date:2017-01-20 MYUSER=root MYPASS=root MYLOGIN=\"mysql -u$MYUSER -p$MYPASS\" MYDUMP=\"mysqldump -u$MYUSER -p$MYPASS\" DATABASE=\"$($MYLOGIN -e \"show databases;\"|egrep -vi \"Data|_schema|mysql\")\" [ ! -f /server/backup/ ] && mkdir -p /server/backup/ for dbname in $DATABASE do MYDIR=/server/backup/$dbname [ ! -d $MYDIR ] && mkdir -p $MYDIR $MYDUMP $dbname|gzip >$MYDIR/${dbname}_$(date +%F).sql.gz done \u6267\u884c\u540e root@leco:/opt/bin# sh Store_backup.sh mysql: [Warning] Using a password on the command line interface can be insecure. mysqldump: [Warning] Using a password on the command line interface can be insecure. mysqldump: [Warning] Using a password on the command line interface can be insecure. mysqldump: [Warning] Using a password on the command line interface can be insecure. mysqldump: [Warning] Using a password on the command line interface can be insecure. mysqldump: [Warning] Using a password on the command line interface can be insecure. mysqldump: [Warning] Using a password on the command line interface can be insecure. mysqldump: [Warning] Using a password on the command line interface can be insecure. root@leco:/opt/bin# ls /server/backup/ cmz db1 leco prv_app_scbxy qiushibaike s12day113 sys \u53ef\u4ee5\u7ed3\u5408crontab\u5b9a\u65f6\u5907\u4efd\u3002 root@leco:/opt/bin# crontab -l | grep Store_backup 0 0 * * * /bin/bash /opt/bin/Store_backup.sh >/dev/null 2>&1","title":"1. \u5206\u5e93\u5907\u4efd"},{"location":"mysql/mysql.mysqldump_case/#2","text":"root@leco:/opt/bin# cat mysql_table.sh #!/bin/sh #author: caimengzhi #date:2017-01-20 USER=root PASSWD=root MYLOGIN=\"mysql -u$USER -p$PASSWD\" MYDUMP=\"mysqldump -u$USER -p$PASSWD\" DATEBASE=\"$($MYLOGIN -e \"show databases;\"|egrep -vi \"Data|_schema|mysql\")\" [ ! -f /server/backup/tables ] && mkdir -p /server/backup for dbname in $DATEBASE do TABLE=\"$($MYLOGIN -e \"use $dbname;show tables;\"|sed '1d')\" for tname in $TABLE do MYDIR=/server/backup/$dbname/${dbname}_$(date +%F) [ ! -d $MYDIR ] && mkdir -p $MYDIR $MYDUMP $dbname $tname |gzip >$MYDIR/${dbname}_${tname}_$(date +%F).sql.gz done done \u6267\u884c\u540e root@leco:/opt/bin# sh mysql_table.sh root@leco:/opt/bin# ls /server/backup/ cmz/ db1/ leco/ prv_app_scbxy/ qiushibaike/ s12day113/ sys/ root@leco:/opt/bin# ls /server/backup/cmz/ cmz_2019-02-28 \u53ef\u4ee5\u7ed3\u5408crontab\u5b9a\u65f6\u5907\u4efd\u3002 root@leco:/opt/bin# crontab -l | grep mysql_table 0 0 * * * /bin/bash /opt/bin/mysql_table.sh >/dev/null 2>&1","title":"2. \u5206\u8868\u5907\u4efd"},{"location":"mysql/mysql.mysqldump_case/#3","text":"\u6bd4\u8f83 1. \u4f18\u70b9\uff1a \u6062\u590d\u7b80\u5355\uff0c\u53ef\u4ee5\u4f7f\u7528\u7ba1\u9053\u5c06\u4ed6\u4eec\u8f93\u5165\u5230 mysql \u4e0e\u5b58\u50a8\u5f15\u64ce\u65e0\u5173\uff0c\u56e0\u4e3a\u662f\u4ece MySQL\u670d\u52a1\u5668\u4e2d\u63d0\u53d6\u6570\u636e\u800c\u751f\u6210\u7684 \uff0c\u6240\u4ee5\u6d88\u9664\u4e86\u5e95\u5c42\u6570\u636e\u5b58\u50a8\u7684\u4e0d\u540c \u6709\u52a9\u4e8e\u907f\u514d\u6570\u636e\u635f\u574f\u3002\u82e5\u78c1\u76d8\u9a71\u52a8\u5668\u6709\u6545\u969c\u800c\u8981\u590d\u5236\u539f\u59cb\u6587\u4ef6\u65f6\uff0c\u6b64\u65f6\u5c06\u5f97\u5230\u4e00\u4e2a\u635f\u574f\u7684\u5907\u4efd 2. \u7f3a\u70b9\uff1a \u5fc5\u987b\u6709\u6570\u636e\u5e93\u670d\u52a1\u5668\u5b8c\u6210\u903b\u8f91\u5de5\u4f5c\uff0c\u9700\u8981\u66f4\u591a\u5730 cpu\u5468\u671f \u903b\u8f91\u5907\u4efd\u8fd8\u539f\u901f\u5ea6\u6162\uff1a\u9700\u8981 MySQL\u52a0\u8f7d\u548c\u89e3\u91ca\u8bed\u53e5 \u3001\u8f6c\u5316\u5b58\u50a8\u683c\u5f0f\u3001\u91cd\u5efa\u5f15\u64ce","title":"3. \u4f18\u7f3a\u70b9"},{"location":"mysql/mysql.null/","text":"MySQL NULL 1. \u4ecb\u7ecd \u00b6 \u6211\u4eec\u5df2\u7ecf\u77e5\u9053MySQL\u4f7f\u7528SQL SELECT\u547d\u4ee4\u53caWHERE\u5b50\u53e5\u6765\u8bfb\u53d6\u6570\u636e\u8868\u4e2d\u7684\u6570\u636e\uff0c\u4f46\u662f\u5f53\u63d0\u4f9b\u7684\u67e5\u8be2\u6761\u4ef6\u5b57\u6bb5\u4e3aNULL\u65f6\uff0c\u8be5\u547d\u4ee4\u53ef\u80fd\u5c31\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c\u3002 \u4e3a\u4e86\u5904\u7406\u8fd9\u79cd\u60c5\u51b5\u65f6\uff0cMySQL\u63d0\u4f9b\u4e86\u4e09\u5927\u8fd0\u7b97\u7b26\uff1a IS NULL\uff1a\u5f53\u5217\u7684\u503c\u662fNULL\uff0c\u6b64\u8fd0\u7b97\u7b26\u8fd4\u56detrue\u3002 IS NOT NULL\uff1a\u5f53\u5217\u7684\u503c\u4e0d\u4e3aNULL\uff0c\u8fd0\u7b97\u7b26\u8fd4\u56detrue\u3002 <=>\uff1a \u6bd4\u8f83\u64cd\u4f5c\u7b26\uff08\u4e0d\u540c\u4e8e=\u8fd0\u7b97\u7b26\uff09\uff0c\u5f53\u6bd4\u8f83\u7684\u7684\u4e24\u4e2a\u503c\u4e3aNULL\u65f6\u8fd4\u56detrue\u3002 \u6ce8\u610f \u5173\u4e8e NULL\u7684\u6761\u4ef6\u6bd4\u8f83\u8fd0\u7b97\u662f\u6bd4\u8f83\u7279\u6b8a\u7684 \u3002\u4f60\u4e0d\u80fd\u4f7f\u7528 = NULL\u6216 \uff01 = NULL\u5728\u5217\u4e2d\u67e5\u627eNULL\u503c \u3002 \u5728 MySQL\u4e2d \uff0c NULL\u503c\u4e0e\u4efb\u4f55\u5176\u4ed6\u503c\u7684\u6bd4\u8f83 \uff08\u5373\u4f7f\u662f NULL \uff09\u6c38\u8fdc\u8fd4\u56de false \uff0c\u5373 NULL = NULL\u8fd4\u56defalse \u3002 MySQL\u4e2d\u5904\u7406NULL\u4f7f\u7528IS NULL\u548cIS NOT NULL\u8fd0\u7b97\u7b26 \u3002 2. \u4f8b\u5b50 \u00b6 2.1 \u73af\u5883 \u00b6 use leco; drop table info; create table info( name varchar(40) NOT NULL, count int ); insert into info(name,count) values(\"cmz1\",NULL); insert into info(name,count) values(\"cmz2\",NULL); insert into info(name,count) values(\"cmz3\",1); insert into info(name,count) values(\"cmz4\",2); desc info; select * from info; 2.2 \u8fc7\u7a0b \u00b6 leco@leco:~$ mysql -uroot -proot mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 118 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use leco; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> drop table info; ERROR 1051 (42S02): Unknown table 'leco.info' mysql> create table info( -> name varchar(40) NOT NULL, -> count int -> ); Query OK, 0 rows affected (0.07 sec) mysql> insert into info(name,count) values(\"cmz1\",NULL); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"cmz2\",NULL); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"cmz3\",1); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"cmz4\",2); Query OK, 1 row affected (0.02 sec) mysql> desc info; +-------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+-------+ | name | varchar(40) | NO | | NULL | | | count | int(11) | YES | | NULL | | +-------+-------------+------+-----+---------+-------+ 2 rows in set (0.00 sec) mysql> select * from info; +------+-------+ | name | count | +------+-------+ | cmz1 | NULL | | cmz2 | NULL | | cmz3 | 1 | | cmz4 | 2 | +------+-------+ 4 rows in set (0.00 sec) mysql> select * from info where count=NULL; Empty set (0.00 sec) mysql> select * from info where count='NULL'; Empty set, 1 warning (0.00 sec) mysql> select * from info where count is NULL; +------+-------+ | name | count | +------+-------+ | cmz1 | NULL | | cmz2 | NULL | +------+-------+ 2 rows in set (0.00 sec) mysql> select * from info where count is not NULL; +------+-------+ | name | count | +------+-------+ | cmz3 | 1 | | cmz4 | 2 | +------+-------+ 2 rows in set (0.00 sec) mysql> select * from info where count <=> NULL; +------+-------+ | name | count | +------+-------+ | cmz1 | NULL | | cmz2 | NULL | +------+-------+ 2 rows in set (0.00 sec) \u6ce8\u610f 1. \u5b9e\u4f8b\u4e2d\u4f60\u53ef\u4ee5\u770b\u5230 = \u548c\uff01 = \u8fd0\u7b97\u7b26\u662f\u4e0d\u8d77\u4f5c\u7528\u7684 . 2. \u5217\u662f\u5426\u4e3a NULL \uff0c\u5fc5\u987b\u4f7f\u7528 IS NULL\u548cIS NOT NULL","title":"4. NULL"},{"location":"mysql/mysql.null/#1","text":"\u6211\u4eec\u5df2\u7ecf\u77e5\u9053MySQL\u4f7f\u7528SQL SELECT\u547d\u4ee4\u53caWHERE\u5b50\u53e5\u6765\u8bfb\u53d6\u6570\u636e\u8868\u4e2d\u7684\u6570\u636e\uff0c\u4f46\u662f\u5f53\u63d0\u4f9b\u7684\u67e5\u8be2\u6761\u4ef6\u5b57\u6bb5\u4e3aNULL\u65f6\uff0c\u8be5\u547d\u4ee4\u53ef\u80fd\u5c31\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c\u3002 \u4e3a\u4e86\u5904\u7406\u8fd9\u79cd\u60c5\u51b5\u65f6\uff0cMySQL\u63d0\u4f9b\u4e86\u4e09\u5927\u8fd0\u7b97\u7b26\uff1a IS NULL\uff1a\u5f53\u5217\u7684\u503c\u662fNULL\uff0c\u6b64\u8fd0\u7b97\u7b26\u8fd4\u56detrue\u3002 IS NOT NULL\uff1a\u5f53\u5217\u7684\u503c\u4e0d\u4e3aNULL\uff0c\u8fd0\u7b97\u7b26\u8fd4\u56detrue\u3002 <=>\uff1a \u6bd4\u8f83\u64cd\u4f5c\u7b26\uff08\u4e0d\u540c\u4e8e=\u8fd0\u7b97\u7b26\uff09\uff0c\u5f53\u6bd4\u8f83\u7684\u7684\u4e24\u4e2a\u503c\u4e3aNULL\u65f6\u8fd4\u56detrue\u3002 \u6ce8\u610f \u5173\u4e8e NULL\u7684\u6761\u4ef6\u6bd4\u8f83\u8fd0\u7b97\u662f\u6bd4\u8f83\u7279\u6b8a\u7684 \u3002\u4f60\u4e0d\u80fd\u4f7f\u7528 = NULL\u6216 \uff01 = NULL\u5728\u5217\u4e2d\u67e5\u627eNULL\u503c \u3002 \u5728 MySQL\u4e2d \uff0c NULL\u503c\u4e0e\u4efb\u4f55\u5176\u4ed6\u503c\u7684\u6bd4\u8f83 \uff08\u5373\u4f7f\u662f NULL \uff09\u6c38\u8fdc\u8fd4\u56de false \uff0c\u5373 NULL = NULL\u8fd4\u56defalse \u3002 MySQL\u4e2d\u5904\u7406NULL\u4f7f\u7528IS NULL\u548cIS NOT NULL\u8fd0\u7b97\u7b26 \u3002","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.null/#2","text":"","title":"2. \u4f8b\u5b50"},{"location":"mysql/mysql.null/#21","text":"use leco; drop table info; create table info( name varchar(40) NOT NULL, count int ); insert into info(name,count) values(\"cmz1\",NULL); insert into info(name,count) values(\"cmz2\",NULL); insert into info(name,count) values(\"cmz3\",1); insert into info(name,count) values(\"cmz4\",2); desc info; select * from info;","title":"2.1 \u73af\u5883"},{"location":"mysql/mysql.null/#22","text":"leco@leco:~$ mysql -uroot -proot mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 118 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use leco; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> drop table info; ERROR 1051 (42S02): Unknown table 'leco.info' mysql> create table info( -> name varchar(40) NOT NULL, -> count int -> ); Query OK, 0 rows affected (0.07 sec) mysql> insert into info(name,count) values(\"cmz1\",NULL); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"cmz2\",NULL); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"cmz3\",1); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"cmz4\",2); Query OK, 1 row affected (0.02 sec) mysql> desc info; +-------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+-------+ | name | varchar(40) | NO | | NULL | | | count | int(11) | YES | | NULL | | +-------+-------------+------+-----+---------+-------+ 2 rows in set (0.00 sec) mysql> select * from info; +------+-------+ | name | count | +------+-------+ | cmz1 | NULL | | cmz2 | NULL | | cmz3 | 1 | | cmz4 | 2 | +------+-------+ 4 rows in set (0.00 sec) mysql> select * from info where count=NULL; Empty set (0.00 sec) mysql> select * from info where count='NULL'; Empty set, 1 warning (0.00 sec) mysql> select * from info where count is NULL; +------+-------+ | name | count | +------+-------+ | cmz1 | NULL | | cmz2 | NULL | +------+-------+ 2 rows in set (0.00 sec) mysql> select * from info where count is not NULL; +------+-------+ | name | count | +------+-------+ | cmz3 | 1 | | cmz4 | 2 | +------+-------+ 2 rows in set (0.00 sec) mysql> select * from info where count <=> NULL; +------+-------+ | name | count | +------+-------+ | cmz1 | NULL | | cmz2 | NULL | +------+-------+ 2 rows in set (0.00 sec) \u6ce8\u610f 1. \u5b9e\u4f8b\u4e2d\u4f60\u53ef\u4ee5\u770b\u5230 = \u548c\uff01 = \u8fd0\u7b97\u7b26\u662f\u4e0d\u8d77\u4f5c\u7528\u7684 . 2. \u5217\u662f\u5426\u4e3a NULL \uff0c\u5fc5\u987b\u4f7f\u7528 IS NULL\u548cIS NOT NULL","title":"2.2 \u8fc7\u7a0b"},{"location":"mysql/mysql.orderby/","text":"MySQL AND_OR 1. \u4ecb\u7ecd \u00b6 1.1 \u73af\u5883\u51c6\u5907 \u00b6 drop table info; create table info( id int not null, name varchar(20), age int not null, score int not null ); insert into info(id,name,age,score) values(1,\"\u5f20\u4e09\",18,80); insert into info(id,name,age,score) values(4,\"\u5f20\u4e09\",40,66); insert into info(id,name,age,score) values(2,\"\u674e\u56db\",20,55); insert into info(id,name,age,score) values(3,\"\u738b\u4e94\",30,89); insert into info(id,name,age,score) values(4,\"\u8d75\u516d\",40,77); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.03 sec) mysql> create table info( -> id int not null, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.06 sec) mysql> insert into info(id,name,age,score) values(1,\"\u5f20\u4e09\",18,80); Query OK, 1 row affected (0.01 sec) mysql> insert into info(id,name,age,score) values(4,\"\u5f20\u4e09\",40,66); Query OK, 1 row affected (0.00 sec) mysql> insert into info(id,name,age,score) values(2,\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.03 sec) mysql> insert into info(id,name,age,score) values(3,\"\u738b\u4e94\",30,89); Query OK, 1 row affected (0.01 sec) mysql> insert into info(id,name,age,score) values(4,\"\u8d75\u516d\",40,77); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 4 | \u5f20\u4e09 | 40 | 66 | | 2 | \u674e\u56db | 20 | 55 | | 3 | \u738b\u4e94 | 30 | 89 | | 4 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) 1.2 \u5f00\u59cb \u00b6 ORDER BY \u8bed\u53e5\u7528\u4e8e\u5bf9\u7ed3\u679c\u96c6\u8fdb\u884c\u6392\u5e8f\u3002 ORDER BY \u8bed\u53e5\u7528\u4e8e\u6839\u636e\u6307\u5b9a\u7684\u5217\u5bf9\u7ed3\u679c\u96c6\u8fdb\u884c\u6392\u5e8f\u3002 ORDER BY \u8bed\u53e5\u9ed8\u8ba4\u6309\u7167\u5347\u5e8f\u5bf9\u8bb0\u5f55\u8fdb\u884c\u6392\u5e8f\u3002 \u5982\u679c\u60a8\u5e0c\u671b\u6309\u7167\u964d\u5e8f\u5bf9\u8bb0\u5f55\u8fdb\u884c\u6392\u5e8f\uff0c\u53ef\u4ee5\u4f7f\u7528 DESC \u5173\u952e\u5b57\u3002 SELECT column1, column2, ... FROM table_name ORDER BY column1, column2, ... ASC|DESC; 2. \u7528\u6cd5 \u00b6 \u4ee5\u4e0b\u6211\u4eec\u5c06\u5728 SQL AND_OR \u547d\u4ee4\u4e2d\u4f7f\u7528 \u4eceMySQL\u6570\u636e\u8868 leco \u4e2d\u8bfb\u53d6\u6570\u636e\u3002 2.1 \u5347\u5e8f \u00b6 \u5728leco\u8868\u4e2d\u627e\u51fa\u5206\u6570\u5347\u5e8f\u6392\u5217 mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 4 | \u5f20\u4e09 | 40 | 66 | | 2 | \u674e\u56db | 20 | 55 | | 3 | \u738b\u4e94 | 30 | 89 | | 4 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> select * from info order by score; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 2 | \u674e\u56db | 20 | 55 | | 4 | \u5f20\u4e09 | 40 | 66 | | 4 | \u8d75\u516d | 40 | 77 | | 1 | \u5f20\u4e09 | 18 | 80 | | 3 | \u738b\u4e94 | 30 | 89 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) \u6216\u8005 mysql> select * from info order by score asc; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 2 | \u674e\u56db | 20 | 55 | | 4 | \u5f20\u4e09 | 40 | 66 | | 4 | \u8d75\u516d | 40 | 77 | | 1 | \u5f20\u4e09 | 18 | 80 | | 3 | \u738b\u4e94 | 30 | 89 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) 2.1 \u964d\u5e8f \u00b6 \u5728leco\u8868\u4e2d\u627e\u51fa\u5206\u6570\u964d\u5e8f\u6392\u5217 mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 4 | \u5f20\u4e09 | 40 | 66 | | 2 | \u674e\u56db | 20 | 55 | | 3 | \u738b\u4e94 | 30 | 89 | | 4 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> select * from info order by score desc; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 3 | \u738b\u4e94 | 30 | 89 | | 1 | \u5f20\u4e09 | 18 | 80 | | 4 | \u8d75\u516d | 40 | 77 | | 4 | \u5f20\u4e09 | 40 | 66 | | 2 | \u674e\u56db | 20 | 55 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) 2.3 \u591a\u6761\u4ef6\u7ed3\u5408 \u00b6 \u5206\u6570\u5347\u5e8f\u540e\u5e74\u9f84\u964d\u5e8f mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 4 | \u5f20\u4e09 | 40 | 66 | | 2 | \u674e\u56db | 20 | 55 | | 3 | \u738b\u4e94 | 30 | 89 | | 4 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> select * from info order by score; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 2 | \u674e\u56db | 20 | 55 | | 4 | \u5f20\u4e09 | 40 | 66 | | 4 | \u8d75\u516d | 40 | 77 | | 1 | \u5f20\u4e09 | 18 | 80 | | 3 | \u738b\u4e94 | 30 | 89 | +----+--------+-----+-------+ 5 rows in set (0.01 sec) mysql> select * from info order by score, age desc; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 2 | \u674e\u56db | 20 | 55 | | 4 | \u5f20\u4e09 | 40 | 66 | | 4 | \u8d75\u516d | 40 | 77 | | 1 | \u5f20\u4e09 | 18 | 80 | | 3 | \u738b\u4e94 | 30 | 89 | +----+--------+-----+-------+ 5 rows in set (0.00 sec)","title":"14. SQL ORDER"},{"location":"mysql/mysql.orderby/#1","text":"","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.orderby/#11","text":"drop table info; create table info( id int not null, name varchar(20), age int not null, score int not null ); insert into info(id,name,age,score) values(1,\"\u5f20\u4e09\",18,80); insert into info(id,name,age,score) values(4,\"\u5f20\u4e09\",40,66); insert into info(id,name,age,score) values(2,\"\u674e\u56db\",20,55); insert into info(id,name,age,score) values(3,\"\u738b\u4e94\",30,89); insert into info(id,name,age,score) values(4,\"\u8d75\u516d\",40,77); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.03 sec) mysql> create table info( -> id int not null, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.06 sec) mysql> insert into info(id,name,age,score) values(1,\"\u5f20\u4e09\",18,80); Query OK, 1 row affected (0.01 sec) mysql> insert into info(id,name,age,score) values(4,\"\u5f20\u4e09\",40,66); Query OK, 1 row affected (0.00 sec) mysql> insert into info(id,name,age,score) values(2,\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.03 sec) mysql> insert into info(id,name,age,score) values(3,\"\u738b\u4e94\",30,89); Query OK, 1 row affected (0.01 sec) mysql> insert into info(id,name,age,score) values(4,\"\u8d75\u516d\",40,77); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 4 | \u5f20\u4e09 | 40 | 66 | | 2 | \u674e\u56db | 20 | 55 | | 3 | \u738b\u4e94 | 30 | 89 | | 4 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec)","title":"1.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.orderby/#12","text":"ORDER BY \u8bed\u53e5\u7528\u4e8e\u5bf9\u7ed3\u679c\u96c6\u8fdb\u884c\u6392\u5e8f\u3002 ORDER BY \u8bed\u53e5\u7528\u4e8e\u6839\u636e\u6307\u5b9a\u7684\u5217\u5bf9\u7ed3\u679c\u96c6\u8fdb\u884c\u6392\u5e8f\u3002 ORDER BY \u8bed\u53e5\u9ed8\u8ba4\u6309\u7167\u5347\u5e8f\u5bf9\u8bb0\u5f55\u8fdb\u884c\u6392\u5e8f\u3002 \u5982\u679c\u60a8\u5e0c\u671b\u6309\u7167\u964d\u5e8f\u5bf9\u8bb0\u5f55\u8fdb\u884c\u6392\u5e8f\uff0c\u53ef\u4ee5\u4f7f\u7528 DESC \u5173\u952e\u5b57\u3002 SELECT column1, column2, ... FROM table_name ORDER BY column1, column2, ... ASC|DESC;","title":"1.2 \u5f00\u59cb"},{"location":"mysql/mysql.orderby/#2","text":"\u4ee5\u4e0b\u6211\u4eec\u5c06\u5728 SQL AND_OR \u547d\u4ee4\u4e2d\u4f7f\u7528 \u4eceMySQL\u6570\u636e\u8868 leco \u4e2d\u8bfb\u53d6\u6570\u636e\u3002","title":"2. \u7528\u6cd5"},{"location":"mysql/mysql.orderby/#21","text":"\u5728leco\u8868\u4e2d\u627e\u51fa\u5206\u6570\u5347\u5e8f\u6392\u5217 mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 4 | \u5f20\u4e09 | 40 | 66 | | 2 | \u674e\u56db | 20 | 55 | | 3 | \u738b\u4e94 | 30 | 89 | | 4 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> select * from info order by score; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 2 | \u674e\u56db | 20 | 55 | | 4 | \u5f20\u4e09 | 40 | 66 | | 4 | \u8d75\u516d | 40 | 77 | | 1 | \u5f20\u4e09 | 18 | 80 | | 3 | \u738b\u4e94 | 30 | 89 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) \u6216\u8005 mysql> select * from info order by score asc; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 2 | \u674e\u56db | 20 | 55 | | 4 | \u5f20\u4e09 | 40 | 66 | | 4 | \u8d75\u516d | 40 | 77 | | 1 | \u5f20\u4e09 | 18 | 80 | | 3 | \u738b\u4e94 | 30 | 89 | +----+--------+-----+-------+ 5 rows in set (0.00 sec)","title":"2.1 \u5347\u5e8f"},{"location":"mysql/mysql.orderby/#21_1","text":"\u5728leco\u8868\u4e2d\u627e\u51fa\u5206\u6570\u964d\u5e8f\u6392\u5217 mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 4 | \u5f20\u4e09 | 40 | 66 | | 2 | \u674e\u56db | 20 | 55 | | 3 | \u738b\u4e94 | 30 | 89 | | 4 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> select * from info order by score desc; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 3 | \u738b\u4e94 | 30 | 89 | | 1 | \u5f20\u4e09 | 18 | 80 | | 4 | \u8d75\u516d | 40 | 77 | | 4 | \u5f20\u4e09 | 40 | 66 | | 2 | \u674e\u56db | 20 | 55 | +----+--------+-----+-------+ 5 rows in set (0.00 sec)","title":"2.1 \u964d\u5e8f"},{"location":"mysql/mysql.orderby/#23","text":"\u5206\u6570\u5347\u5e8f\u540e\u5e74\u9f84\u964d\u5e8f mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 4 | \u5f20\u4e09 | 40 | 66 | | 2 | \u674e\u56db | 20 | 55 | | 3 | \u738b\u4e94 | 30 | 89 | | 4 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> select * from info order by score; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 2 | \u674e\u56db | 20 | 55 | | 4 | \u5f20\u4e09 | 40 | 66 | | 4 | \u8d75\u516d | 40 | 77 | | 1 | \u5f20\u4e09 | 18 | 80 | | 3 | \u738b\u4e94 | 30 | 89 | +----+--------+-----+-------+ 5 rows in set (0.01 sec) mysql> select * from info order by score, age desc; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 2 | \u674e\u56db | 20 | 55 | | 4 | \u5f20\u4e09 | 40 | 66 | | 4 | \u8d75\u516d | 40 | 77 | | 1 | \u5f20\u4e09 | 18 | 80 | | 3 | \u738b\u4e94 | 30 | 89 | +----+--------+-----+-------+ 5 rows in set (0.00 sec)","title":"2.3 \u591a\u6761\u4ef6\u7ed3\u5408"},{"location":"mysql/mysql.pk/","text":"MySQL PRIMARY KEY 1. \u4ecb\u7ecd \u00b6 PRIMARY KEY \u7ea6\u675f PRIMARY KEY \u7ea6\u675f\u552f\u4e00\u6807\u8bc6\u6570\u636e\u5e93\u8868\u4e2d\u7684\u6bcf\u6761\u8bb0\u5f55\u3002 \u4e3b\u952e\u5fc5\u987b\u5305\u542b\u552f\u4e00\u7684\u503c\u3002 \u4e3b\u952e\u5217\u4e0d\u80fd\u5305\u542b NULL \u503c\u3002 \u6bcf\u4e2a\u8868\u90fd\u5e94\u8be5\u6709\u4e00\u4e2a\u4e3b\u952e\uff0c\u5e76\u4e14\u6bcf\u4e2a\u8868\u53ea\u80fd\u6709\u4e00\u4e2a\u4e3b\u952e\u3002 1. \u64cd\u4f5c \u00b6 1.1 \u5b9e\u4f8b \u00b6 drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); insert into info(name,age,score) values(\"\u674e\u56db\",20,55); insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.03 sec) mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.05 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> desc info; +-------+-------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | varchar(20) | YES | | NULL | | | age | int(11) | NO | | NULL | | | score | int(11) | NO | | NULL | | +-------+-------------+------+-----+---------+----------------+ 4 rows in set (0.00 sec) \u6211\u4eec\u80fd\u770b\u5230\u7b2c\u56db\u5217\u4e5f\u5c31\u662fkey\u90a3\u4e00\u5217\uff0c\u53ea\u6709id\u662f\u6709PRI\uff0c\u6709\u8fd9\u4e2aPRI\u5c31\u662f\u8868\u793a\u8be5\u5b57\u6bb5\u662f\u8868\u7684\u4e3b\u952e\u3002","title":"1. SQL PK"},{"location":"mysql/mysql.pk/#1","text":"PRIMARY KEY \u7ea6\u675f PRIMARY KEY \u7ea6\u675f\u552f\u4e00\u6807\u8bc6\u6570\u636e\u5e93\u8868\u4e2d\u7684\u6bcf\u6761\u8bb0\u5f55\u3002 \u4e3b\u952e\u5fc5\u987b\u5305\u542b\u552f\u4e00\u7684\u503c\u3002 \u4e3b\u952e\u5217\u4e0d\u80fd\u5305\u542b NULL \u503c\u3002 \u6bcf\u4e2a\u8868\u90fd\u5e94\u8be5\u6709\u4e00\u4e2a\u4e3b\u952e\uff0c\u5e76\u4e14\u6bcf\u4e2a\u8868\u53ea\u80fd\u6709\u4e00\u4e2a\u4e3b\u952e\u3002","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.pk/#1_1","text":"","title":"1. \u64cd\u4f5c"},{"location":"mysql/mysql.pk/#11","text":"drop table info; create table info( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); insert into info(name,age,score) values(\"\u674e\u56db\",20,55); insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); \u64cd\u4f5c\u8fc7\u7a0b mysql> drop table info; Query OK, 0 rows affected (0.03 sec) mysql> create table info( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.05 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",18,80); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u5f20\u4e09\",40,66); Query OK, 1 row affected (0.00 sec) mysql> insert into info(name,age,score) values(\"\u674e\u56db\",20,55); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u738b\u4e94\",30,89); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,age,score) values(\"\u8d75\u516d\",40,77); Query OK, 1 row affected (0.00 sec) mysql> select * from info; +----+--------+-----+-------+ | id | name | age | score | +----+--------+-----+-------+ | 1 | \u5f20\u4e09 | 18 | 80 | | 2 | \u5f20\u4e09 | 40 | 66 | | 3 | \u674e\u56db | 20 | 55 | | 4 | \u738b\u4e94 | 30 | 89 | | 5 | \u8d75\u516d | 40 | 77 | +----+--------+-----+-------+ 5 rows in set (0.00 sec) mysql> desc info; +-------+-------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | varchar(20) | YES | | NULL | | | age | int(11) | NO | | NULL | | | score | int(11) | NO | | NULL | | +-------+-------------+------+-----+---------+----------------+ 4 rows in set (0.00 sec) \u6211\u4eec\u80fd\u770b\u5230\u7b2c\u56db\u5217\u4e5f\u5c31\u662fkey\u90a3\u4e00\u5217\uff0c\u53ea\u6709id\u662f\u6709PRI\uff0c\u6709\u8fd9\u4e2aPRI\u5c31\u662f\u8868\u793a\u8be5\u5b57\u6bb5\u662f\u8868\u7684\u4e3b\u952e\u3002","title":"1.1 \u5b9e\u4f8b"},{"location":"mysql/mysql.practice1/","text":"MySQL \u7ec3\u4e60 1. \u73af\u5883\u51c6\u5907 \u00b6 /* Navicat MySQL Data Transfer Source Server : localhost Source Server Version : 50621 Source Host : localhost:3306 Source Database : cmz Target Server Type : MYSQL Target Server Version : 50621 File Encoding : 65001 Date: 2018-03-17 21:20:45 */ SET FOREIGN_KEY_CHECKS=0; -- ---------------------------- -- Table structure for `class` -- ---------------------------- DROP TABLE IF EXISTS `class`; CREATE TABLE `class` ( `cid` int(11) NOT NULL AUTO_INCREMENT, `caption` char(10) NOT NULL, `grade_id` int(11) NOT NULL, PRIMARY KEY (`cid`), KEY `grade_id` (`grade_id`), CONSTRAINT `class_ibfk_1` FOREIGN KEY (`grade_id`) REFERENCES `class_grade` (`gid`) ) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of class -- ---------------------------- INSERT INTO `class` VALUES ('1', '\u4e00\u5e74\u4e00\u73ed', '1'); INSERT INTO `class` VALUES ('2', '\u4e00\u5e74\u4e8c\u73ed', '1'); INSERT INTO `class` VALUES ('3', '\u4e00\u5e74\u4e09\u73ed', '1'); INSERT INTO `class` VALUES ('4', '\u4e00\u5e74\u56db\u73ed', '1'); INSERT INTO `class` VALUES ('5', '\u4e00\u5e74\u4e94\u73ed', '1'); INSERT INTO `class` VALUES ('6', '\u4e8c\u5e74\u4e00\u73ed', '2'); INSERT INTO `class` VALUES ('7', '\u4e8c\u5e74\u4e8c\u73ed', '2'); INSERT INTO `class` VALUES ('8', '\u4e8c\u5e74\u4e09\u73ed', '2'); INSERT INTO `class` VALUES ('9', '\u4e8c\u5e74\u56db\u73ed', '2'); INSERT INTO `class` VALUES ('10', '\u4e09\u5e74\u4e00\u73ed', '3'); INSERT INTO `class` VALUES ('11', '\u4e09\u5e74\u4e8c\u73ed', '3'); -- ---------------------------- -- Table structure for `class_grade` -- ---------------------------- DROP TABLE IF EXISTS `class_grade`; CREATE TABLE `class_grade` ( `gid` int(11) NOT NULL AUTO_INCREMENT, `gname` char(10) NOT NULL, PRIMARY KEY (`gid`) ) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of class_grade -- ---------------------------- INSERT INTO `class_grade` VALUES ('1', '\u4e00\u5e74\u7ea7'); INSERT INTO `class_grade` VALUES ('2', '\u4e8c\u5e74\u7ea7'); INSERT INTO `class_grade` VALUES ('3', '\u4e09\u5e74\u7ea7'); -- ---------------------------- -- Table structure for `course` -- ---------------------------- DROP TABLE IF EXISTS `course`; CREATE TABLE `course` ( `cid` int(11) NOT NULL AUTO_INCREMENT, `cname` char(10) NOT NULL, `teacher_id` int(11) NOT NULL, PRIMARY KEY (`cid`), KEY `teacher_id` (`teacher_id`), CONSTRAINT `course_ibfk_1` FOREIGN KEY (`teacher_id`) REFERENCES `teacher` (`tid`) ) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of course -- ---------------------------- INSERT INTO `course` VALUES ('1', '\u751f\u7269', '1'); INSERT INTO `course` VALUES ('2', '\u4f53\u80b2', '1'); INSERT INTO `course` VALUES ('3', '\u7269\u7406', '2'); INSERT INTO `course` VALUES ('4', '\u6570\u5b66', '1'); INSERT INTO `course` VALUES ('5', '\u7f8e\u672f', '3'); -- ---------------------------- -- Table structure for `score` -- ---------------------------- DROP TABLE IF EXISTS `score`; CREATE TABLE `score` ( `sid` int(11) NOT NULL AUTO_INCREMENT, `student_id` int(11) NOT NULL, `course_id` int(11) NOT NULL, `score` int(10) unsigned NOT NULL, PRIMARY KEY (`sid`), UNIQUE KEY `sid` (`sid`), KEY `student_id` (`student_id`), KEY `course_id` (`course_id`), CONSTRAINT `score_ibfk_1` FOREIGN KEY (`student_id`) REFERENCES `student` (`sid`), CONSTRAINT `score_ibfk_2` FOREIGN KEY (`course_id`) REFERENCES `course` (`cid`) ) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of score -- ---------------------------- INSERT INTO `score` VALUES ('5', '1', '3', '80'); INSERT INTO `score` VALUES ('8', '4', '3', '70'); INSERT INTO `score` VALUES ('9', '5', '3', '50'); -- ---------------------------- -- Table structure for `student` -- ---------------------------- DROP TABLE IF EXISTS `student`; CREATE TABLE `student` ( `sid` int(11) NOT NULL AUTO_INCREMENT, `sname` char(10) NOT NULL, `gender` enum('\u7537','\u5973') DEFAULT NULL, `class_id` int(11) NOT NULL, PRIMARY KEY (`sid`), KEY `class_id` (`class_id`), CONSTRAINT `student_ibfk_1` FOREIGN KEY (`class_id`) REFERENCES `class` (`cid`) ) ENGINE=InnoDB AUTO_INCREMENT=18 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of student -- ---------------------------- INSERT INTO `student` VALUES ('1', '\u4e54\u4e39', '\u5973', '1'); INSERT INTO `student` VALUES ('2', '\u827e\u68ee', '\u5973', '2'); INSERT INTO `student` VALUES ('3', '\u79d1\u6bd4', '\u7537', '3'); INSERT INTO `student` VALUES ('4', '\u9ec4\u5bb6', '\u5973', '1'); INSERT INTO `student` VALUES ('5', '\u80e1\u542f', '\u7537', '1'); INSERT INTO `student` VALUES ('6', '\u5434\u5b87', '\u7537', '2'); INSERT INTO `student` VALUES ('7', '\u5510\u660e', '\u5973', '3'); INSERT INTO `student` VALUES ('8', '\u53f6\u8471', '\u7537', '2'); INSERT INTO `student` VALUES ('9', '\u5f20\u6df3', '\u5973', '2'); INSERT INTO `student` VALUES ('10', '\u6620\u6708', '\u7537', '1'); INSERT INTO `student` VALUES ('11', '\u80e1\u542f', '\u7537', '1'); INSERT INTO `student` VALUES ('12', '\u5929\u5b87', '\u5973', '2'); INSERT INTO `student` VALUES ('13', '\u5b59\u5170', '\u7537', '3'); INSERT INTO `student` VALUES ('14', '\u5f20\u7b11', '\u7537', '3'); INSERT INTO `student` VALUES ('15', '\u5f20\u5170', '\u5973', '1'); INSERT INTO `student` VALUES ('16', '\u5f20\u5170', '\u5973', '2'); INSERT INTO `student` VALUES ('17', '\u5f20\u5170', '\u5973', '3'); -- ---------------------------- -- Table structure for `teacher` -- ---------------------------- DROP TABLE IF EXISTS `teacher`; CREATE TABLE `teacher` ( `tid` int(11) NOT NULL AUTO_INCREMENT, `tname` char(10) NOT NULL, PRIMARY KEY (`tid`) ) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of teacher -- ---------------------------- INSERT INTO `teacher` VALUES ('1', '\u5f20\u4e09'); INSERT INTO `teacher` VALUES ('2', '\u674e\u56db'); INSERT INTO `teacher` VALUES ('3', '\u738b\u4e94'); INSERT INTO `teacher` VALUES ('4', '\u674e\u5764'); -- ---------------------------- -- Table structure for `teacher2cls` -- ---------------------------- DROP TABLE IF EXISTS `teacher2cls`; CREATE TABLE `teacher2cls` ( `tcid` int(11) NOT NULL AUTO_INCREMENT, `tid` int(11) NOT NULL, `cid` int(11) NOT NULL, PRIMARY KEY (`tcid`), UNIQUE KEY `tcid` (`tcid`), KEY `tid` (`tid`), KEY `cid` (`cid`), CONSTRAINT `teacher2cls_ibfk_1` FOREIGN KEY (`tid`) REFERENCES `teacher` (`tid`), CONSTRAINT `teacher2cls_ibfk_2` FOREIGN KEY (`cid`) REFERENCES `course` (`cid`) ) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of teacher2cls -- ---------------------------- INSERT INTO `teacher2cls` VALUES ('1', '1', '1'); INSERT INTO `teacher2cls` VALUES ('2', '1', '2'); INSERT INTO `teacher2cls` VALUES ('3', '2', '1'); INSERT INTO `teacher2cls` VALUES ('4', '3', '2'); -- ---------------------------- -- Procedure structure for `p1` -- ---------------------------- DROP PROCEDURE IF EXISTS `p1`; DELIMITER ;; CREATE DEFINER=`cmz`@`localhost` PROCEDURE `p1`() BEGIN select * from score; END ;; DELIMITER ; -- ---------------------------- -- Procedure structure for `p2` -- ---------------------------- DROP PROCEDURE IF EXISTS `p2`; DELIMITER ;; CREATE DEFINER=`cmz`@`localhost` PROCEDURE `p2`(in n1 int,in n2 int,out res int) BEGIN select * from score where course_id=n1 and score >n2 ; set res = 1; END ;; DELIMITER ; 2. \u7ec3\u4e60 \u00b6 #1.------------------------- create database ------------------------- #1. create database and change this database create database cmz charset utf8; use cmz; #2.------------------------- create table ------------------------- #2. create table #1. teacher table create table teacher( tid int not null primary key auto_increment, tname char(10) not null )charset utf8 engine=innodb; #2. class_grade table create table class_grade( gid int not null primary key auto_increment, gname char(10) not null )charset utf8 engine=innodb; #3. course table create table course( cid int not null primary key auto_increment, cname char(10) not null, teacher_id int not null, foreign key(teacher_id) references teacher(tid) )charset utf8 engine=innodb; #4. class table create table class( cid int not null primary key auto_increment, caption char(10) not null, grade_id int not null, foreign key(grade_id) references class_grade(gid) )charset utf8 engine=innodb; #5. student table create table student( sid int not null primary key auto_increment, sname char(10) not null, gender enum('\u7537','\u5973'), class_id int not null, foreign key(class_id) references class(cid) )charset utf8 engine=innodb; #6. score table create table score( sid int not null unique auto_increment, student_id int not null, course_id int not null, score int unsigned not null, foreign key(student_id) references student(sid), foreign key(course_id) references course(cid), primary key(sid) )charset utf8 engine=innodb; #7. teacher2cls table create table teacher2cls( tcid int not null unique auto_increment, tid int not null, cid int not null, foreign key(tid) references teacher(tid), foreign key(cid) references course(cid), primary key(tcid) )charset utf8 engine=innodb; #3. ------------------------- insert into table ------------------------- # insert every table data #1. teacher table insert into teacher(tname) values (\"\u5f20\u4e09\"), (\"\u674e\u56db\"), (\"\u738b\u4e94\"); #2. class_grade table data insert into class_grade(gname) values (\"\u4e00\u5e74\u7ea7\"), (\"\u4e8c\u5e74\u7ea7\"), (\"\u4e09\u5e74\u7ea7\"); #3. course table data insert into course(cname,teacher_id) values (\"\u751f\u7269\",1), (\"\u4f53\u80b2\",1), (\"\u6570\u5b66\",1), (\"\u7269\u7406\",2); #4. class table data insert into class(caption,grade_id) values (\"\u4e00\u5e74\u4e00\u73ed\",1), (\"\u4e00\u5e74\u4e8c\u73ed\",1), (\"\u4e00\u5e74\u4e09\u73ed\",1), (\"\u4e00\u5e74\u56db\u73ed\",1), (\"\u4e00\u5e74\u4e94\u73ed\",1), (\"\u4e8c\u5e74\u4e00\u73ed\",2), (\"\u4e8c\u5e74\u4e8c\u73ed\",2), (\"\u4e8c\u5e74\u4e09\u73ed\",2), (\"\u4e8c\u5e74\u56db\u73ed\",2), (\"\u4e09\u5e74\u4e00\u73ed\",3), (\"\u4e09\u5e74\u4e8c\u73ed\",3); #5. student table data insert into student(sname,gender,class_id) values (\"\u4e54\u4e39\",\"\u5973\",1), (\"\u827e\u68ee\",\"\u5973\",2), (\"\u79d1\u6bd4\",\"\u7537\",3), (\"\u9ec4\u5bb6\",\"\u5973\",1), (\"\u80e1\u542f\",\"\u7537\",1), (\"\u5434\u5b87\",\"\u7537\",2), (\"\u5510\u660e\",\"\u5973\",3), (\"\u53f6\u8471\",\"\u7537\",2), (\"\u5f20\u6df3\",\"\u5973\",2), (\"\u6620\u6708\",\"\u7537\",1), (\"\u80e1\u542f\",\"\u7537\",1), (\"\u5929\u5b87\",\"\u5973\",2), (\"\u5b59\u5170\",\"\u7537\",3); #6. score table data insert into score(student_id,course_id,score) values (1,1,60), (1,2,59), (2,2,59); #7. teacher2cls table data insert into teacher2cls(tid,cid) values (1,1), (1,2), (2,1), (3,2); # sql for operation mysql #1. \u521b\u5efa\u6d4b\u8bd5\u6570\u636e #2. \u67e5\u8be2\u5b66\u751f\u603b\u4eba\u6570 select COUNT(sid) from student; \u8fd0\u884c\u8fc7\u7a0b mysql> select COUNT(sid) from student; +------------+ | COUNT(sid) | +------------+ | 17 | +------------+ 1 row in set (0.00 sec) #3. \u67e5\u8be2\u201c\u751f\u7269\u201d\u8bfe\u7a0b\u548c\u201c\u7269\u7406\u201d\u8bfe\u7a0b\u90fd\u53ca\u683c\u7684\u5b66\u751fid\u548c\u59d3\u540d select s1.sid,s1.sname from student s1 where s1.sid in ( select distinct(s.student_id) from score s left join course c on c.cid=s.course_id where s.score >= 60 and (c.cname='\u751f\u7269' or c.cname='\u7269\u7406')); \u8fd0\u884c\u8fc7\u7a0b mysql> select s1.sid,s1.sname from student s1 -> where s1.sid in ( -> select distinct(s.student_id) from score s left join course c on c.cid=s.course_id -> where s.score >= 60 and (c.cname='\u751f\u7269' or c.cname='\u7269\u7406')); +-----+-------+ | sid | sname | +-----+-------+ | 1 | \u4e54\u4e39 | | 4 | \u9ec4\u5bb6 | +-----+-------+ 2 rows in set (0.00 sec) #4. \u67e5\u8be2\u6bcf\u4e2a\u5e74\u7ea7\u7684\u73ed\u7ea7\u6570\uff0c\u53d6\u51fa\u73ed\u7ea7\u6570\u6700\u591a\u7684\u524d\u4e09\u4e2a\u5e74\u7ea7 select grade_id from class_grade LEFT JOIN class on class_grade.gid = class.grade_id GROUP BY grade_id ORDER BY count(grade_id) asc LIMIT 3; \u8fd0\u884c\u8fc7\u7a0b mysql> select grade_id from class_grade LEFT JOIN class on class_grade.gid = class.grade_id -> GROUP BY grade_id ORDER BY count(grade_id) asc LIMIT 3; +----------+ | grade_id | +----------+ | 3 | | 2 | | 1 | +----------+ 3 rows in set (0.00 sec) #5. \u67e5\u8be2 \u5e73\u5747\u6210\u7ee9\u6700\u9ad8\u548c\u6700\u4f4e\u7684\u5b66\u751f\u7684id\u548c\u59d3\u540d\u4ee5\u53ca\u5e73\u5747\u6210\u7ee9 SELECT student.sid,student.sname,avg(score) from student RIGHT JOIN score on student.sid = score.student_id GROUP BY score ORDER BY avg(score) desc LIMIT 1; SELECT student.sid,student.sname,avg(score) from student RIGHT JOIN score on student.sid = score.student_id GROUP BY score ORDER BY avg(score) asc LIMIT 1; \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT student.sid,student.sname,avg(score) from student RIGHT JOIN score on student.sid = sc ore.student_id -> GROUP BY score ORDER BY avg(score) desc LIMIT 1; +------+-------+------------+ | sid | sname | avg(score) | +------+-------+------------+ | 1 | \u4e54\u4e39 | 80.0000 | +------+-------+------------+ 1 row in set (0.00 sec) mysql> mysql> SELECT student.sid,student.sname,avg(score) from student RIGHT JOIN score on student.sid = sc ore.student_id -> GROUP BY score ORDER BY avg(score) asc LIMIT 1; +------+-------+------------+ | sid | sname | avg(score) | +------+-------+------------+ | 5 | \u80e1\u542f | 50.0000 | +------+-------+------------+ 1 row in set (0.00 sec) #6. \u67e5\u8be2\u6bcf\u4e2a\u5e74\u7ea7\u7684\u5b66\u751f\u4eba\u6570 select count(*) from class group by grade_id; \u8fd0\u884c\u8fc7\u7a0b mysql> select count(*) from class group by grade_id; +----------+ | count(*) | +----------+ | 5 | | 4 | | 2 | +----------+ 3 rows in set (0.00 sec) #7. \u67e5\u8be2\u6bcf\u4e2a\u5b66\u751f\u7684\u5b66\u53f7\uff0c\u59d3\u540d\uff0c\u9009\u8bfe\u6570\uff0c\u5e73\u5747\u6210\u7ee9 SELECT s.sid,s.sname,count(course_id),avg(score) from student s RIGHT JOIN score sc on s.sid = sc.sid GROUP BY student_id; \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT s.sid,s.sname,count(course_id),avg(score) from student s RIGHT JOIN score sc on s.sid= sc.sid -> GROUP BY student_id; +------+-------+------------------+------------+ | sid | sname | count(course_id) | avg(score) | +------+-------+------------------+------------+ | 5 | \u80e1\u542f | 1 | 80.0000 | | 8 | \u53f6\u8471 | 1 | 70.0000 | | 9 | \u5f20\u6df3 | 1 | 50.0000 | +------+-------+------------------+------------+ 3 rows in set (0.00 sec) #8. \u67e5\u8be2\u5b66\u751f\u7f16\u53f7\u4e3a2\u7684\u5b66\u751f\u7684\u59d3\u540d\uff0c\u8be5\u5b66\u751f\u7684\u6210\u7ee9\u6700\u9ad8\u7684\u8bfe\u7a0b\u540d\uff0c\u6210\u7ee9\u6700\u4f4e\u7684\u8bfe\u7a0b\u540d\u4ee5\u53ca\u5206\u6570 SELECT course.cname,score.score from score LEFT JOIN course on score.course_id = course.cid where score.student_id = 2 ORDER BY score.score desc LIMIT 1; SELECT course.cname,score.score from score LEFT JOIN course on score.course_id = course.cid where score.student_id = 2 ORDER BY score.score asc LIMIT 1; \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT course.cname,score.score from score LEFT JOIN course on score.course_id = course.cid -> where score.student_id = 2 ORDER BY score.score desc LIMIT 1; Empty set (0.00 sec) mysql> SELECT course.cname,score.score from score LEFT JOIN course on score.course_id = course.cid -> where score.student_id = 2 ORDER BY score.score asc LIMIT 1; Empty set (0.00 sec) #9. \u67e5\u8be2\u59d3\u201c\u674e\u201d\u7684\u8001\u5e08\u7684\u4e2a\u6570\u548c\u6240\u5e26\u73ed\u7ea7\u6570 select (select tea.tid from teacher tea where tea.tname like '\u5f20%') as \u59d3\u674e\u7684\u4eba\u6570 , count(tea2.tid) as \u8bfe\u7a0b from teacher2cls tea2 where tea2.tid in (select tea.tid from teacher tea where tea.tname like '\u5f20%' ) group by tea2.tid; \u8fd0\u884c\u8fc7\u7a0b mysql> select (select tea.tid from teacher tea where tea.tname like '\u5f20%') as \u59d3\u674e\u7684\u4eba\u6570 , -> count(tea2.tid) as \u8bfe\u7a0b from teacher2cls tea2 -> where tea2.tid in (select tea.tid from teacher tea where tea.tname like '\u5f20%' ) group by tea2.tid; +------------+------+ | \u59d3\u674e\u7684\u4eba\u6570 | \u8bfe\u7a0b | +------------+------+ | 1 | 2 | +------------+------+ 1 row in set (0.00 sec) #10.\u67e5\u8be2\u73ed\u7ea7\u6570\u5c0f\u4e8e5\u7684\u5e74\u7ea7id\u548c\u5e74\u7ea7\u540d select gid,gname from class_grade where gid in (select grade_id from class GROUP BY grade_id HAVING count(class.grade_id)<5); \u8fd0\u884c\u8fc7\u7a0b mysql> select gid,gname from class_grade -> where gid in -> (select grade_id from class GROUP BY grade_id HAVING count(class.grade_id)<5); +-----+--------+ | gid | gname | +-----+--------+ | 2 | \u4e8c\u5e74\u7ea7 | | 3 | \u4e09\u5e74\u7ea7 | +-----+--------+ 2 rows in set (0.00 sec) #11.\u67e5\u8be2\u73ed\u7ea7\u4fe1\u606f\uff0c\u5305\u62ec\u73ed\u7ea7id,\u73ed\u7ea7\u540d\u79f0\uff0c\u5e74\u7ea7\uff0c\u5e74\u7ea7\u7ea7\u522b\uff0812\u4e3a\u4f4e\u5e74\u7ea7\uff0c34\u4e3a\u4e2d\u5e74\u7ea7\uff0c56\u4e3a\u9ad8\u5e74\u7ea7\uff09 \u793a\u4f8b\u5982\u4e0b\uff1a ----------------------------------------------- | \u73ed\u7ea7id | \u73ed\u7ea7\u540d\u79f0 | \u5e74\u7ea7 | \u5e74\u7ea7\u7ea7\u522b | ----------------------------------------------- | 1 | \u4e00\u5e74\u4e00\u73ed | \u4e00\u5e74\u7ea7 | \u4f4e | ----------------------------------------------- \u5e74\u7ea7\u5224\u65ad\u6ca1\u505a\u3002\u6682\u65f6\u4e0d\u4f1a\u3002 SELECT cid \"\u73ed\u7ea7id\", caption \"\u73ed\u7ea7\u540d\u79f0\", gname \"\u5e74\u7ea7\" FROM class LEFT JOIN class_grade ON class.grade_id = class_grade.gid; \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT -> cid \"\u73ed\u7ea7id\", -> caption \"\u73ed\u7ea7\u540d\u79f0\", -> gname \"\u5e74\u7ea7\" -> FROM -> class -> LEFT JOIN class_grade ON class.grade_id = class_grade.gid; +--------+----------+--------+ | \u73ed\u7ea7id | \u73ed\u7ea7\u540d\u79f0 | \u5e74\u7ea7 | +--------+----------+--------+ | 1 | \u4e00\u5e74\u4e00\u73ed | \u4e00\u5e74\u7ea7 | | 2 | \u4e00\u5e74\u4e8c\u73ed | \u4e00\u5e74\u7ea7 | | 3 | \u4e00\u5e74\u4e09\u73ed | \u4e00\u5e74\u7ea7 | | 4 | \u4e00\u5e74\u56db\u73ed | \u4e00\u5e74\u7ea7 | | 5 | \u4e00\u5e74\u4e94\u73ed | \u4e00\u5e74\u7ea7 | | 6 | \u4e8c\u5e74\u4e00\u73ed | \u4e8c\u5e74\u7ea7 | | 7 | \u4e8c\u5e74\u4e8c\u73ed | \u4e8c\u5e74\u7ea7 | | 8 | \u4e8c\u5e74\u4e09\u73ed | \u4e8c\u5e74\u7ea7 | | 9 | \u4e8c\u5e74\u56db\u73ed | \u4e8c\u5e74\u7ea7 | | 10 | \u4e09\u5e74\u4e00\u73ed | \u4e09\u5e74\u7ea7 | | 11 | \u4e09\u5e74\u4e8c\u73ed | \u4e09\u5e74\u7ea7 | +--------+----------+--------+ 11 rows in set (0.00 sec) #12.\u67e5\u8be2\u5b66\u8fc7\u5f20\u4e09\u8001\u5e081\u95e8\u8bfe\u4ee5\u4e0a\u7684\u540c\u5b66\u7684\u5b66\u53f7\uff0c\u59d3\u540d SELECT sc.student_id, su.sname, COUNT(sc.course_id) AS class_sum FROM score sc LEFT JOIN student su ON sc.student_id = su.sid WHERE sc.course_id IN ( SELECT co.cid AS cid FROM teacher tc LEFT JOIN course co ON tc.tid = co.teacher_id WHERE tc.tname = \"\u5f20\u4e09\" ) GROUP BY sc.student_id HAVING class_sum > 1; \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT -> sc.student_id, -> su.sname, -> COUNT(sc.course_id) AS class_sum -> FROM -> score sc -> LEFT JOIN student su ON sc.student_id = su.sid -> WHERE -> sc.course_id IN ( -> SELECT -> co.cid AS cid -> FROM -> teacher tc -> LEFT JOIN course co ON tc.tid = co.teacher_id -> WHERE -> tc.tname = \"\u5f20\u4e09\" -> ) -> GROUP BY -> sc.student_id -> HAVING -> class_sum > 1; +------------+-------+-----------+ | student_id | sname | class_sum | +------------+-------+-----------+ | 10 | \u6620\u6708 | 2 | +------------+-------+-----------+ 1 row in set (0.00 sec) #13.\u67e5\u8be2\u6559\u6388\u8bfe\u7a0b\u8d85\u8fc72\u95e8\u7684\u8001\u5e08\u7684id\u548c\u59d3\u540d select * from teacher where tid in( select tid from teacher2cls GROUP BY tid HAVING count(cid)>=2); \u8fd0\u884c\u8fc7\u7a0b mysql> select * from teacher where tid in( -> select tid from teacher2cls GROUP BY tid HAVING count(cid)>=2); +-----+-------+ | tid | tname | +-----+-------+ | 1 | \u5f20\u4e09 | +-----+-------+ 1 row in set (0.00 sec) #14.\u67e5\u8be2\u5b66\u8fc7\u7f16\u53f7\u201c1\u201c\u8bfe\u7a0b\u548c\u7f16\u53f7\u201d2\u201c\u8bfe\u7a0b\u7684\u540c\u5b66\u7684\u5b66\u53f7\uff0c\u59d3\u540d SELECT sid, sname FROM student WHERE sid IN ( SELECT a.sid FROM ( SELECT st.*, sr.cname FROM student st LEFT JOIN score sc ON st.sid = sc.student_id LEFT JOIN course sr ON sr.cid = sc.course_id WHERE sr.cid = 1 ) AS a LEFT JOIN ( SELECT st.*, sr.cid FROM student st LEFT JOIN score sc ON st.sid = sc.student_id LEFT JOIN course sr ON sr.cid = sc.course_id WHERE sr.cid = 4 ) AS b ON a.sid = b.sid WHERE b.cid = 4 ); \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT -> sid, -> sname -> FROM -> student -> WHERE -> sid IN ( -> SELECT -> a.sid -> FROM -> ( -> SELECT -> st.*, sr.cname -> FROM -> student st -> LEFT JOIN score sc ON st.sid = sc.student_id -> LEFT JOIN course sr ON sr.cid = sc.course_id -> WHERE -> sr.cid = 1 -> ) AS a -> LEFT JOIN ( -> SELECT -> st.*, sr.cid -> FROM -> student st -> LEFT JOIN score sc ON st.sid = sc.student_id -> LEFT JOIN course sr ON sr.cid = sc.course_id -> WHERE -> sr.cid = 4 -> ) AS b ON a.sid = b.sid -> WHERE -> b.cid = 4 -> ); +-----+-------+ | sid | sname | +-----+-------+ | 10 | \u6620\u6708 | +-----+-------+ 1 row in set (0.01 sec) #15.\u67e5\u8be2\u6ca1\u6709\u5e26\u8fc7\u9ad8\u5e74\u7ea7\u7684\u8001\u5e08\u7684id\u548c\u59d3\u540d #16.\u67e5\u8be2\u5b66\u8fc7\u5f20\u4e09\u8001\u5e08\u6240\u6559\u7684\u6240\u6709\u8bfe\u7684\u540c\u5b66\u5b66\u53f7\uff0c\u59d3\u540d select sid,sname from student where sid in ( select student_id from score where course_id in ( select cid from course LEFT JOIN teacher on course.teacher_id = teacher.tid where teacher.tname = \"\u5f20\u4e09\")); \u8fd0\u884c\u8fc7\u7a0b mysql> select sid,sname from student where sid in ( -> select student_id from score where course_id in ( -> select cid from course LEFT JOIN teacher on course.teacher_id = teacher.tid where -> teacher.tname = \"\u5f20\u4e09\")); Empty set (0.00 sec) #17.\u67e5\u8be2\u5e26\u8fc7\u8d85\u8fc72\u4e2a\u73ed\u7ea7\u7684\u8001\u5e08\u7684id\u548c\u59d3\u540d SELECT DISTINCT tc.tid, tc.tname FROM teacher tc LEFT JOIN course co ON tc.tid = co.teacher_id LEFT JOIN teacher2cls t2c ON t2c.cid = co.cid GROUP BY t2c.cid HAVING COUNT(tc.tid) > 2; \u8fd0\u884c\u8fc7\u7a0bmysql> SELECT DISTINCT -> tc.tid, -> tc.tname -> FROM -> teacher tc -> LEFT JOIN course co ON tc.tid = co.teacher_id -> LEFT JOIN teacher2cls t2c ON t2c.cid = co.cid -> GROUP BY -> t2c.cid -> HAVING -> COUNT(tc.tid) > 2; +-----+-------+ | tid | tname | +-----+-------+ | 1 | \u5f20\u4e09 | +-----+-------+ 1 row in set (0.04 sec) #18.\u67e5\u8be2 \u8bfe\u7a0b\u7f16\u53f7\u201c2\u201d\u7684\u6210\u7ee9\u6bd4\u8bfe\u7a0b\u7f16\u53f7\u201c1\u201c\u8bfe\u7a0b\u4f4e\u7684\u6240\u6709\u540c\u5b66\u7684\u5b66\u53f7\uff0c\u59d3\u540d select sid,sname from student where sid in ( select a.sid from (select * from score s where s.course_id = 1) a, (select * from score s where s.course_id = 2) b where a.student_id = b.student_id and a.score > b.score); \u8fd0\u884c\u8fc7\u7a0b mysql> select sid,sname from student where sid in ( -> select a.sid -> from (select * from score s where s.course_id = 1) a, -> (select * from score s where s.course_id = 2) b -> where a.student_id = b.student_id -> and a.score > b.score); Empty set (0.00 sec) #19.\u67e5\u8be2\u6240\u5e26\u73ed\u7ea7\u6570\u6700\u591a\u7684\u8001\u5e08\u7684id\u548c\u59d3\u540d SELECT tc.tname, tc.tid FROM teacher tc LEFT JOIN teacher2cls t2c ON tc.tid = t2c.tid GROUP BY t2c.tid ORDER BY COUNT(cid) DESC LIMIT 1; \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT -> tc.tname, -> tc.tid -> FROM -> teacher tc -> LEFT JOIN teacher2cls t2c ON tc.tid = t2c.tid -> GROUP BY -> t2c.tid -> ORDER BY -> COUNT(cid) DESC -> LIMIT 1; +-------+-----+ | tname | tid | +-------+-----+ | \u5f20\u4e09 | 1 | +-------+-----+ 1 row in set (0.00 sec) #20.\u67e5\u8be2\u6240\u6709\u8bfe\u7a0b\u6210\u7ee9\u5c0f\u4e8e60\u5206\u7684\u540c\u5b66\u7684\u5b66\u53f7\uff0c\u59d3\u540d select student.sid,student.sname from student LEFT JOIN score on student.sid = score.student_id where score.score<60; \u8fd0\u884c\u8fc7\u7a0b mysql> select student.sid,student.sname from student LEFT JOIN score -> on -> student.sid = score.student_id -> where score.score<60; +-----+-------+ | sid | sname | +-----+-------+ | 5 | \u80e1\u542f | +-----+-------+ 1 row in set (0.00 sec) #21.\u67e5\u8be2\u6ca1\u6709\u5b66\u5168\u6240\u6709\u8bfe\u7a0b\u7684\u540c\u5b66\u7684\u5b66\u53f7\uff0c\u59d3\u540d Select sid,sname From student st where (Select Count(*) From score sc Where st.sid=sc.student_id)< (Select Count(*) From course); \u8fd0\u884c\u8fc7\u7a0b mysql> Select sid,sname From student st -> where (Select Count(*) From score sc Where st.sid=sc.student_id)< -> (Select Count(*) From course); +-----+-------+ | sid | sname | +-----+-------+ | 1 | \u4e54\u4e39 | | 2 | \u827e\u68ee | | 3 | \u79d1\u6bd4 | | 4 | \u9ec4\u5bb6 | | 5 | \u80e1\u542f | | 6 | \u5434\u5b87 | | 7 | \u5510\u660e | | 8 | \u53f6\u8471 | | 9 | \u5f20\u6df3 | | 10 | \u6620\u6708 | | 11 | \u80e1\u542f | | 12 | \u5929\u5b87 | | 13 | \u5b59\u5170 | | 14 | \u5f20\u7b11 | | 15 | \u5f20\u5170 | | 16 | \u5f20\u5170 | | 17 | \u5f20\u5170 | +-----+-------+ 17 rows in set (0.00 sec) #22.\u67e5\u8be2\u81f3\u5c11\u4e00\u95e8\u8bfe\u4e0e\u5b66\u53f7\u4e3a\u201c1\u201c\u7684\u540c\u5b66\u6240\u5b66\u76f8\u540c\u7684\u540c\u5b66\u7684\u5b66\u53f7\u548c\u59d3\u540d Select DistInct st.sid,st.sname From student st Inner Join score sc ON st.sid=sc.student_id Where sc.course_id IN (Select course_id From score Where student_id='1'); \u8fd0\u884c\u8fc7\u7a0b mysql> Select DistInct st.sid,st.sname From student st -> Inner Join score sc ON st.sid=sc.student_id -> Where sc.course_id IN (Select course_id From score Where student_id='1'); +-----+-------+ | sid | sname | +-----+-------+ | 1 | \u4e54\u4e39 | | 4 | \u9ec4\u5bb6 | | 5 | \u80e1\u542f | +-----+-------+ 3 rows in set (0.00 sec) #23.\u67e5\u8be2\u81f3\u5c11\u5b66\u8fc7\u5b66\u53f7\u4e3a\u201c1\u201d\u540c\u5b66\u6240\u9009\u8bfe\u7a0b\u4e2d\u4efb\u610f\u4e00\u95e8\u8bfe\u7684\u5176\u4ed6\u540c\u5b66\u5b66\u53f7\u548c\u59d3\u540d Select DistInct st.sid,st.sname From student st Inner Join score sc ON st.sid=sc.student_id Where st.sid <>1 and sc.course_id IN (Select course_id From score Where student_id='1'); \u8fd0\u884c\u8fc7\u7a0b mysql> Select DistInct st.sid,st.sname From student st -> Inner Join score sc ON st.sid=sc.student_id -> Where st.sid <>1 and -> sc.course_id IN -> (Select course_id From score Where student_id='1'); +-----+-------+ | sid | sname | +-----+-------+ | 4 | \u9ec4\u5bb6 | | 5 | \u80e1\u542f | +-----+-------+ 2 rows in set (0.00 sec) #24.\u67e5\u8be2\u548c\"2\"\u53f7\u540c\u5b66\u5b66\u4e60\u7684\u8bfe\u7a0b\u5b8c\u5168\u76f8\u540c\u7684\u5176\u4ed6\u540c\u5b66\u7684\u5b66\u53f7\u548c\u59d3\u540d #25.\u5220\u9664\u5b66\u4e60\u5f20\u4e09\u8001\u5e08\u8bfe\u7684score\u8868\u8bb0\u5f55 DELETE from score where course_id in (select cid from course LEFT JOIN teacher on course.teacher_id = teacher.tid where teacher.tname = '\u5f20\u4e09'); \u8fd0\u884c\u8fc7\u7a0b mysql> DELETE from score where course_id in -> (select cid from course LEFT JOIN teacher -> on course.teacher_id = teacher.tid -> where teacher.tname = '\u5f20\u4e09'); Query OK, 7 rows affected (0.01 sec) #26.\u5411score\u8868\u4e2d\u63d2\u5165\u4e00\u4e9b\u8bb0\u5f55\uff0c\u8fd9\u4e9b\u8bb0\u5f55\u8981\u6c42\u7b26\u5408\u4ee5\u4e0b\u6761\u4ef6 1. \u6ca1\u6709\u4e0a\u8fc7\u7f16\u53f7\u201c2\u201d\u8bfe\u7a0b\u540c\u5b66\u5b66\u53f7 2. \u63d2\u5165\u201c2\u201d\u53f7\u8bfe\u7a0b\u7684\u5e73\u5747\u6210\u7ee9 #27.\u6309\u5e73\u5747\u6210\u7ee9\u4ece\u4f4e\u5230\u9ad8\u663e\u793a\u6240\u6709\u5b66\u751f\u7684\u201c\u8bed\u6587\u201d\uff0c\u201c\u6570\u5b66\u201d\uff0c\u2018\u82f1\u8bed\u2019\u4e09\u95e8\u7684\u7684\u8bfe\u7a0b\u6210\u7ee9\uff0c\u6309\u7167\u5982\u4e0b\u5f62\u5f0f\u663e\u793a \u5b66\u751fID,\u8bed\u6587,\u6570\u5b66,\u82f1\u8bed,\u6709\u6548\u8bfe\u7a0b\u6570,\u6709\u6548\u5e73\u5747\u5206 select concat(\"\u5b66\u751fID: \",st.sid,\" \", \"\u8bfe\u7a0bID: \",sc.course_id,\" \",\"\u5e73\u5747\u6210\u7ee9: \",avg(sc.score)) from student as st RIGHT JOIN score as sc on st.sid = sc.student_id GROUP BY student_id; \u8fd0\u884c\u8fc7\u7a0b mysql> select concat(\"\u5b66\u751fID: \",st.sid,\" \", \"\u8bfe\u7a0bID: \",sc.course_id,\" \",\"\u5e73\u5747\u6210\u7ee9: \",avg(sc.score )) from student as st RIGHT JOIN score as sc on st.sid = sc.student_id -> GROUP BY student_id; +------------------------------------------------------------------------------------------+ | concat(\"\u5b66\u751fID: \",st.sid,\" \", \"\u8bfe\u7a0bID: \",sc.course_id,\" \",\"\u5e73\u5747\u6210\u7ee9: \",avg(sc.score)) | +------------------------------------------------------------------------------------------+ | \u5b66\u751fID: 1 \u8bfe\u7a0bID: 3 \u5e73\u5747\u6210\u7ee9: 80.0000 | | \u5b66\u751fID: 4 \u8bfe\u7a0bID: 3 \u5e73\u5747\u6210\u7ee9: 70.0000 | | \u5b66\u751fID: 5 \u8bfe\u7a0bID: 3 \u5e73\u5747\u6210\u7ee9: 50.0000 | +------------------------------------------------------------------------------------------+ 3 rows in set (0.00 sec) #28.\u67e5\u8be2\u5404\u79d1\u6210\u7ee9\u6700\u9ad8\u548c\u6700\u4f4e\u7684\u5206\uff0c\u5982\u4e0b\u663e\u793a:\u8bfe\u7a0bID,\u6700\u9ad8\u5206,\u6700\u4f4e\u5206 select CONCAT(\"\u8bfe\u7a0bID\",course_id,\",\",\"\u6700\u9ad8\u5206 \",score,\",\",\"\u6700\u4f4e\u5206\") from score GROUP BY course_id ORDER BY score desc LIMIT 1; \u8fd0\u884c\u8fc7\u7a0b mysql> select CONCAT(\"\u8bfe\u7a0bID\",course_id,\",\",\"\u6700\u9ad8\u5206 \",score,\",\",\"\u6700\u4f4e\u5206\") -> from score GROUP BY course_id -> ORDER BY score desc -> LIMIT 1; +-------------------------------------------------------------+ | CONCAT(\"\u8bfe\u7a0bID\",course_id,\",\",\"\u6700\u9ad8\u5206 \",score,\",\",\"\u6700\u4f4e\u5206\") | +-------------------------------------------------------------+ | \u8bfe\u7a0bID4,\u6700\u9ad8\u5206 100,\u6700\u4f4e\u5206 | +-------------------------------------------------------------+ 1 row in set (0.00 sec) #29.\u6309\u5404\u79d1\u5e73\u5747\u6210\u7ee9\u4ece\u4f4e\u5230\u9ad8\u548c\u53ca\u683c\u7387\u7684\u767e\u5206\u6570\u4ece\u9ad8\u5230\u4f4e\u6392\u5e8f # \u53ca\u683c\u7387-------\u6682\u65f6\u4e0d\u4f1a select * from score GROUP BY course_id ORDER BY avg(score) desc; \u8fd0\u884c\u8fc7\u7a0b mysql> select * from score GROUP BY course_id ORDER BY avg(score) desc; +-----+------------+-----------+-------+ | sid | student_id | course_id | score | +-----+------------+-----------+-------+ | 6 | 1 | 4 | 100 | | 1 | 1 | 1 | 60 | | 2 | 1 | 2 | 59 | | 5 | 1 | 3 | 80 | +-----+------------+-----------+-------+ 4 rows in set (0.00 sec) #30.\u8bfe\u7a0b\u5e73\u5747\u5206\u4ece\u9ad8\u5230\u4f4e\u663e\u793a\uff08\u663e\u793a\u4efb\u8bfe\u8001\u5e08\uff09 select tname,cname,score from teacher RIGHT JOIN ( select cname,score,teacher_id from score LEFT JOIN course on score.course_id = course.cid GROUP BY course_id ORDER BY avg(score) desc ) as tmp on tmp.teacher_id = teacher.tid; \u8fd0\u884c\u8fc7\u7a0b mysql> select tname,cname,score from teacher RIGHT JOIN ( -> select cname,score,teacher_id from score LEFT JOIN course on score.course_id = course.cid -> GROUP BY course_id ORDER BY avg(score) desc ) as tmp on tmp.teacher_id = teacher.tid; +-------+-------+-------+ | tname | cname | score | +-------+-------+-------+ | \u5f20\u4e09 | \u6570\u5b66 | 100 | | \u5f20\u4e09 | \u751f\u7269 | 60 | | \u5f20\u4e09 | \u4f53\u80b2 | 59 | | \u674e\u56db | \u7269\u7406 | 80 | +-------+-------+-------+ 4 rows in set (0.00 sec) #31.\u67e5\u8be2\u5404\u79d1\u6210\u7ee9\u524d\u4e09\u540d\u7684\u8bb0\u5f55\uff08\u4e0d\u8003\u8651\u6210\u7ee9\u5e76\u5217\u60c5\u51b5\uff09 SELECT * from student RIGHT JOIN score on student.sid = score.student_id GROUP BY course_id ORDER BY score desc LIMIT 3; \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT * from student RIGHT JOIN score on student.sid = score.student_id -> GROUP BY course_id ORDER BY score desc LIMIT 3; +------+-------+--------+----------+-----+------------+-----------+-------+ | sid | sname | gender | class_id | sid | student_id | course_id | score | +------+-------+--------+----------+-----+------------+-----------+-------+ | 1 | \u4e54\u4e39 | \u5973 | 1 | 6 | 1 | 4 | 100 | | 1 | \u4e54\u4e39 | \u5973 | 1 | 5 | 1 | 3 | 80 | | 1 | \u4e54\u4e39 | \u5973 | 1 | 1 | 1 | 1 | 60 | +------+-------+--------+----------+-----+------------+-----------+-------+ 3 rows in set (0.00 sec) #32.\u67e5\u8be2\u6bcf\u95e8\u8bfe\u7a0b\u88ab\u9009\u4fee\u7684\u5b66\u751f\u6570 select cname \"\u8bfe\u7a0b\",count(student_id) \"\u9009\u4fee\u5b66\u751f\u603b\u6570\" from score LEFT JOIN course on score.course_id = course.cid GROUP BY course_id; \u8fd0\u884c\u8fc7\u7a0b mysql> select cname \"\u8bfe\u7a0b\",count(student_id) \"\u9009\u4fee\u5b66\u751f\u603b\u6570\" from score LEFT JOIN -> course on score.course_id = course.cid GROUP BY course_id; +------+--------------+ | \u8bfe\u7a0b | \u9009\u4fee\u5b66\u751f\u603b\u6570 | +------+--------------+ | \u751f\u7269 | 3 | | \u4f53\u80b2 | 3 | | \u7269\u7406 | 3 | | \u6570\u5b66 | 1 | +------+--------------+ 4 rows in set (0.00 sec) #33.\u67e5\u8be2\u9009\u4fee\u4e862\u95e8\u4ee5\u4e0a\u7684\u8bfe\u7a0b\u7684\u5168\u90e8\u5b66\u751f\u7684\u5b66\u53f7\u548c\u59d3\u540d select sid,sname from student where sid in ( select sid from score group by course_id HAVING count(course_id) > 2 ); \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT gender \"\u6027\u522b\", count(sid) \"\u603b\u4eba\u6570\" FROM student GROUP BY gender ORDER BY count(sid) DESC; +------+--------+ | \u6027\u522b | \u603b\u4eba\u6570 | +------+--------+ | \u5973 | 9 | | \u7537 | 8 | +------+--------+ 2 rows in set (0.00 sec) #34.\u67e5\u8be2\u7537\u751f\uff0c\u5973\u751f\u7684\u4eba\u6570\uff0c\u6309\u7167\u5012\u5e8f\u6392\u5217 SELECT gender \"\u6027\u522b\", count(sid) \"\u603b\u4eba\u6570\" FROM student GROUP BY gender ORDER BY count(sid) DESC; #35.\u67e5\u8be2\u59d3\u5f20\u7684\u5b66\u751f\u540d\u5355 select * from student where sname regexp \"^\u5f20\"; \u8fd0\u884c\u8fc7\u7a0b mysql> select * from student where sname regexp \"^\u5f20\"; +-----+-------+--------+----------+ | sid | sname | gender | class_id | +-----+-------+--------+----------+ | 9 | \u5f20\u6df3 | \u5973 | 2 | | 14 | \u5f20\u7b11 | \u7537 | 3 | | 15 | \u5f20\u5170 | \u5973 | 1 | | 16 | \u5f20\u5170 | \u5973 | 2 | | 17 | \u5f20\u5170 | \u5973 | 3 | +-----+-------+--------+----------+ 5 rows in set (0.00 sec) #36.\u67e5\u8be2\u540c\u540d\u540c\u59d3\u5b66\u751f\u540d\u5355\uff0c\u5e76\u7edf\u8ba1\u540c\u540d\u4eba\u6570 select sname \"\u59d3\u540d\",count(sid) \"\u603b\u4eba\u6570\" from student group by sname HAVING count(sid)>1 ; \u8fd0\u884c\u8fc7\u7a0b mysql> select sname \"\u59d3\u540d\",count(sid) \"\u603b\u4eba\u6570\" from student group by sname HAVING count(sid)>1 ; +------+--------+ | \u59d3\u540d | \u603b\u4eba\u6570 | +------+--------+ | \u5f20\u5170 | 3 | | \u80e1\u542f | 2 | +------+--------+ 2 rows in set (0.00 sec) #37.\u67e5\u8be2\u6bcf\u95e8\u8bfe\u7a0b\u7684\u5e73\u5747\u6210\u7ee9\uff0c\u7ed3\u679c\u6309\u7167\u5e73\u5747\u6210\u7ee9\u5347\u5e8f\u6392\u5217\uff0c\u5e73\u5747\u6210\u7ee9\u76f8\u540c\uff0c\u6309\u7167\u8bfe\u7a0b\u53f7\u964d\u5e8f\u6392\u5217 select course_id,avg(score) from score GROUP BY course_id ORDER BY score asc; # 1 #38.\u67e5\u8be2\u8bfe\u7a0b\u540d\u79f0\u4e3a\u6570\u5b66\uff0c\u4e14\u5206\u6570\u4f4e\u4e8e60\u5206\u7684\u5b66\u751f\u540d\u548c\u5206\u6570 select sname,score from student INNER JOIN score on score.sid = student.sid where score.score < 60; \u8fd0\u884c\u8fc7\u7a0b mysql> select sname,score from student -> INNER JOIN score -> on -> score.sid = student.sid -> where score.score < 60; +-------+-------+ | sname | score | +-------+-------+ | \u827e\u68ee | 59 | | \u79d1\u6bd4 | 59 | | \u5f20\u6df3 | 50 | +-------+-------+ 3 rows in set (0.00 sec) #39.\u67e5\u8be2\u8bfe\u7a0b\u7f16\u53f7\u4e3a3\u4e14\u8bfe\u7a0b\u6210\u7ee9\u572860\u5206\u4ee5\u4e0a\u7684\u5b66\u53f7\u548c\u59d3\u540d select sid,sname from student where sid in (select student_id from score where score.course_id = 2 and score.score > 60); \u8fd0\u884c\u8fc7\u7a0b mysql> select sid,sname from student where sid in -> (select student_id from score where score.course_id = 2 and score.score > 60); +-----+-------+ | sid | sname | +-----+-------+ | 3 | \u79d1\u6bd4 | | 2 | \u827e\u68ee | +-----+-------+ 2 rows in set (0.00 sec) #40.\u6c42\u9009\u4fee\u4e86\u8bfe\u7a0b\u7684\u5b66\u751f\u4eba\u6570 select count(student_id) from score; \u8fd0\u884c\u8fc7\u7a0b mysql> select count(student_id) from score; +-------------------+ | count(student_id) | +-------------------+ | 10 | +-------------------+ 1 row in set (0.00 sec) #41.\u67e5\u8be2\u9009\u4fee\u738b\u4e94\u8001\u5e08\u6240\u6388\u8bfe\u7a0b\u7684\u5b66\u751f\u4e2d\uff0c\u6210\u7ee9\u6700\u9ad8\u548c\u6700\u4f4e\u7684\u5b66\u751f\u59d3\u540d\u53ca\u6210\u7ee9 select sname,score from score RIGHT JOIN student on score.student_id = student.sid where course_id in ( select cid from course as c LEFT JOIN teacher as t on c.teacher_id = t.tid where t.tname = \"\u674e\u56db\") GROUP BY score desc LIMIT 1; select sname,score from score RIGHT JOIN student on score.student_id = student.sid where course_id in ( select cid from course as c LEFT JOIN teacher as t on c.teacher_id = t.tid where t.tname = \"\u674e\u56db\") GROUP BY score asc LIMIT 1; \u8fd0\u884c\u8fc7\u7a0b mysql> select sname,score from score RIGHT JOIN student on score.student_id = student.sid where cou rse_id in ( -> select cid from course as c LEFT JOIN teacher as t on c.teacher_id = t.tid where t.tname = \"\u674e\u56db\") -> GROUP BY score desc LIMIT 1; +-------+-------+ | sname | score | +-------+-------+ | \u4e54\u4e39 | 80 | +-------+-------+ 1 row in set (0.00 sec) mysql> select sname,score from score RIGHT JOIN student on score.student_id = student.sid where cou rse_id in ( -> select cid from course as c LEFT JOIN teacher as t on c.teacher_id = t.tid where t.tname = \"\u674e\u56db\") -> GROUP BY score asc LIMIT 1; +-------+-------+ | sname | score | +-------+-------+ | \u80e1\u542f | 50 | +-------+-------+ 1 row in set (0.00 sec) #42.\u67e5\u8be2\u5404\u4e2a\u8bfe\u7a0b\u53ca\u76f8\u5bf9\u5e94\u7684\u9009\u4fee\u4eba\u6570 select cname,count(sid) from course LEFT JOIN score on course.cid = score.course_id GROUP BY course_id; \u8fd0\u884c\u8fc7\u7a0b mysql> select cname,count(sid) from course LEFT JOIN score on course.cid = score.course_id -> GROUP BY course_id; +-------+------------+ | cname | count(sid) | +-------+------------+ | \u7f8e\u672f | 0 | | \u751f\u7269 | 3 | | \u4f53\u80b2 | 3 | | \u7269\u7406 | 3 | | \u6570\u5b66 | 1 | +-------+------------+ 5 rows in set (0.00 sec) #43.\u67e5\u8be2\u4e0d\u540c\u8bfe\u7a0b\u4f46\u6210\u7ee9\u76f8\u540c\u7684\u5b66\u751f\u7684\u5b66\u53f7\uff0c\u8bfe\u7a0b\u53f7\uff0c\u5b66\u751f\u6210\u7ee9 select sid,sname from student where sid in ( select a.student_id from score a LEFT join score b on a.course_id <> b.course_id where a.score = b.score ); \u8fd0\u884c\u8fc7\u7a0b mysql> select sid,sname from student where sid in ( -> select a.student_id from score a -> LEFT join score b on a.course_id <> b.course_id -> where a.score = b.score -> ); +-----+-------+ | sid | sname | +-----+-------+ | 2 | \u827e\u68ee | | 1 | \u4e54\u4e39 | | 3 | \u79d1\u6bd4 | +-----+-------+ 3 rows in set (0.00 sec) #44.\u67e5\u8be2\u6bcf\u95e8\u8bfe\u7a0b\u6210\u7ee9\u6700\u597d\u7684\u524d\u4e24\u540d\u5b66id\u548c\u59d3\u540d #45.\u68c0\u7d22\u81f3\u5c11\u9009\u62e9\u4e24\u95e8\u8bfe\u7a0b\u7684\u5b66\u751f\u5b66\u53f7 select sid \"\u5b66\u751f\u5e8f\u53f7\" from score group by course_id having count(*)>=2; \u8fd0\u884c\u8fc7\u7a0b mysql> select sid \"\u5b66\u751f\u5e8f\u53f7\" from score -> group by course_id having count(*)>=2; +----------+ | \u5b66\u751f\u5e8f\u53f7 | +----------+ | 1 | | 2 | | 5 | +----------+ 3 rows in set (0.00 sec) #46.\u67e5\u8be2\u6ca1\u6709\u5b66\u751f\u9009\u4fee\u7684\u8bfe\u7a0b\u7684\u8bfe\u7a0b\u53f7\u548c\u62a5\u540d\u8868 select cid, cname from course Where cid not in (select course_id from score); \u8fd0\u884c\u8fc7\u7a0b mysql> select cid, cname from course -> where -> cid not in (select course_id from score); +-----+-------+ | cid | cname | +-----+-------+ | 5 | \u7f8e\u672f | +-----+-------+ 1 row in set (0.00 sec) #47.\u67e5\u8be2\u6ca1\u5e26\u8fc7\u4efb\u4f55\u73ed\u7ea7\u7684\u8001\u5e08id\u548c\u59d3\u540d select * from teacher where tid not in (select tid from teacher2cls); \u8fd0\u884c\u8fc7\u7a0b mysql> select * from teacher where tid not in -> (select tid from teacher2cls); +-----+-------+ | tid | tname | +-----+-------+ | 4 | \u674e\u5764 | +-----+-------+ 1 row in set (0.00 sec) #48.\u67e5\u8be2\u4e24\u95e8\u4ee5\u4e0a\u7684\u8bfe\u7a0b\u8d85\u8fc780\u5206\u7684\u5b66\u751fid\u548c\u5e73\u5747\u6210\u7ee9 select student_id \"\u5b66\u751fid\",avg(score) \"\u5e73\u5747\u6210\u7ee9\" from score where score>60 group by course_id having count(*)>=2; \u8fd0\u884c\u8fc7\u7a0b mysql> select student_id \"\u5b66\u751fid\",avg(score) \"\u5e73\u5747\u6210\u7ee9\" from score where score>60 -> group by course_id having count(*)>=2; +--------+----------+ | \u5b66\u751fid | \u5e73\u5747\u6210\u7ee9 | +--------+----------+ | 3 | 80.0000 | | 1 | 75.0000 | +--------+----------+ 2 rows in set (0.00 sec) #49.\u68c0\u7d22\u201c3\u201d\u8bfe\u7a0b\u5206\u6570\u5c0f\u4e8e60\u5206\uff0c\u6309\u5206\u6570\u964d\u5e8f\u6392\u5217\u7684\u540c\u5b66\u5b66\u53f7 select sid from student where sid in ( select student_id from score where score<80 and course_id=2 ORDER BY score desc); \u8fd0\u884c\u8fc7\u7a0b mysql> select sid from student where sid in ( -> select student_id from score where score<80 and course_id=2 ORDER BY score desc -> ); +-----+ | sid | +-----+ | 1 | +-----+ 1 row in set (0.00 sec) #50.\u5220\u9664\u7f16\u53f7\u4e3a\u201c2\u201d\u7684\u540c\u5b66\u7684\u201c1\u201d\u8bfe\u7a0b\u7684\u6210\u7ee9 DELETE from score where course_id = 1 and student_id = 2; #51.\u67e5\u8be2\u540c\u65f6\u9009\u4fee\u4e86\u7269\u7406\u8bfe\u7a0b\u548c\u751f\u7269\u8bfe\u7684\u5b66\u7684id\u548c\u59d3\u540d select sid,sname from student where sid in( select a.sid from ( select st.*,sr.cname from student AS st left join score AS sc on st.sid = sc.student_id left join course AS sr on sc.course_id = sr.cid where sr.cname = '\u751f\u7269' ) AS a left join ( select st.sid,sr.cname from student AS st left join score AS sc on st.sid = sc.student_id left join course AS sr on sc.course_id = sr.cid where sr.cname = '\u6570\u5b66' ) AS b on a.sid = b.sid where b.cname = '\u6570\u5b66' ); \u8fd0\u884c\u8fc7\u7a0b mysql> select sid,sname from student where sid in( -> select a.sid from ( -> select st.*,sr.cname from student AS st -> left join score AS sc on st.sid = sc.student_id -> left join course AS sr on sc.course_id = sr.cid -> where sr.cname = '\u751f\u7269' -> ) AS a -> left join ( -> select st.sid,sr.cname from student AS st -> left join score AS sc on st.sid = sc.student_id -> left join course AS sr on sc.course_id = sr.cid -> where sr.cname = '\u6570\u5b66' -> ) AS b on a.sid = b.sid where b.cname = '\u6570\u5b66' -> ); +-----+-------+ | sid | sname | +-----+-------+ | 10 | \u6620\u6708 | +-----+-------+ 1 row in set (0.00 sec)","title":"01. MySQL\u7ec3\u4e60"},{"location":"mysql/mysql.practice1/#1","text":"/* Navicat MySQL Data Transfer Source Server : localhost Source Server Version : 50621 Source Host : localhost:3306 Source Database : cmz Target Server Type : MYSQL Target Server Version : 50621 File Encoding : 65001 Date: 2018-03-17 21:20:45 */ SET FOREIGN_KEY_CHECKS=0; -- ---------------------------- -- Table structure for `class` -- ---------------------------- DROP TABLE IF EXISTS `class`; CREATE TABLE `class` ( `cid` int(11) NOT NULL AUTO_INCREMENT, `caption` char(10) NOT NULL, `grade_id` int(11) NOT NULL, PRIMARY KEY (`cid`), KEY `grade_id` (`grade_id`), CONSTRAINT `class_ibfk_1` FOREIGN KEY (`grade_id`) REFERENCES `class_grade` (`gid`) ) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of class -- ---------------------------- INSERT INTO `class` VALUES ('1', '\u4e00\u5e74\u4e00\u73ed', '1'); INSERT INTO `class` VALUES ('2', '\u4e00\u5e74\u4e8c\u73ed', '1'); INSERT INTO `class` VALUES ('3', '\u4e00\u5e74\u4e09\u73ed', '1'); INSERT INTO `class` VALUES ('4', '\u4e00\u5e74\u56db\u73ed', '1'); INSERT INTO `class` VALUES ('5', '\u4e00\u5e74\u4e94\u73ed', '1'); INSERT INTO `class` VALUES ('6', '\u4e8c\u5e74\u4e00\u73ed', '2'); INSERT INTO `class` VALUES ('7', '\u4e8c\u5e74\u4e8c\u73ed', '2'); INSERT INTO `class` VALUES ('8', '\u4e8c\u5e74\u4e09\u73ed', '2'); INSERT INTO `class` VALUES ('9', '\u4e8c\u5e74\u56db\u73ed', '2'); INSERT INTO `class` VALUES ('10', '\u4e09\u5e74\u4e00\u73ed', '3'); INSERT INTO `class` VALUES ('11', '\u4e09\u5e74\u4e8c\u73ed', '3'); -- ---------------------------- -- Table structure for `class_grade` -- ---------------------------- DROP TABLE IF EXISTS `class_grade`; CREATE TABLE `class_grade` ( `gid` int(11) NOT NULL AUTO_INCREMENT, `gname` char(10) NOT NULL, PRIMARY KEY (`gid`) ) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of class_grade -- ---------------------------- INSERT INTO `class_grade` VALUES ('1', '\u4e00\u5e74\u7ea7'); INSERT INTO `class_grade` VALUES ('2', '\u4e8c\u5e74\u7ea7'); INSERT INTO `class_grade` VALUES ('3', '\u4e09\u5e74\u7ea7'); -- ---------------------------- -- Table structure for `course` -- ---------------------------- DROP TABLE IF EXISTS `course`; CREATE TABLE `course` ( `cid` int(11) NOT NULL AUTO_INCREMENT, `cname` char(10) NOT NULL, `teacher_id` int(11) NOT NULL, PRIMARY KEY (`cid`), KEY `teacher_id` (`teacher_id`), CONSTRAINT `course_ibfk_1` FOREIGN KEY (`teacher_id`) REFERENCES `teacher` (`tid`) ) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of course -- ---------------------------- INSERT INTO `course` VALUES ('1', '\u751f\u7269', '1'); INSERT INTO `course` VALUES ('2', '\u4f53\u80b2', '1'); INSERT INTO `course` VALUES ('3', '\u7269\u7406', '2'); INSERT INTO `course` VALUES ('4', '\u6570\u5b66', '1'); INSERT INTO `course` VALUES ('5', '\u7f8e\u672f', '3'); -- ---------------------------- -- Table structure for `score` -- ---------------------------- DROP TABLE IF EXISTS `score`; CREATE TABLE `score` ( `sid` int(11) NOT NULL AUTO_INCREMENT, `student_id` int(11) NOT NULL, `course_id` int(11) NOT NULL, `score` int(10) unsigned NOT NULL, PRIMARY KEY (`sid`), UNIQUE KEY `sid` (`sid`), KEY `student_id` (`student_id`), KEY `course_id` (`course_id`), CONSTRAINT `score_ibfk_1` FOREIGN KEY (`student_id`) REFERENCES `student` (`sid`), CONSTRAINT `score_ibfk_2` FOREIGN KEY (`course_id`) REFERENCES `course` (`cid`) ) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of score -- ---------------------------- INSERT INTO `score` VALUES ('5', '1', '3', '80'); INSERT INTO `score` VALUES ('8', '4', '3', '70'); INSERT INTO `score` VALUES ('9', '5', '3', '50'); -- ---------------------------- -- Table structure for `student` -- ---------------------------- DROP TABLE IF EXISTS `student`; CREATE TABLE `student` ( `sid` int(11) NOT NULL AUTO_INCREMENT, `sname` char(10) NOT NULL, `gender` enum('\u7537','\u5973') DEFAULT NULL, `class_id` int(11) NOT NULL, PRIMARY KEY (`sid`), KEY `class_id` (`class_id`), CONSTRAINT `student_ibfk_1` FOREIGN KEY (`class_id`) REFERENCES `class` (`cid`) ) ENGINE=InnoDB AUTO_INCREMENT=18 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of student -- ---------------------------- INSERT INTO `student` VALUES ('1', '\u4e54\u4e39', '\u5973', '1'); INSERT INTO `student` VALUES ('2', '\u827e\u68ee', '\u5973', '2'); INSERT INTO `student` VALUES ('3', '\u79d1\u6bd4', '\u7537', '3'); INSERT INTO `student` VALUES ('4', '\u9ec4\u5bb6', '\u5973', '1'); INSERT INTO `student` VALUES ('5', '\u80e1\u542f', '\u7537', '1'); INSERT INTO `student` VALUES ('6', '\u5434\u5b87', '\u7537', '2'); INSERT INTO `student` VALUES ('7', '\u5510\u660e', '\u5973', '3'); INSERT INTO `student` VALUES ('8', '\u53f6\u8471', '\u7537', '2'); INSERT INTO `student` VALUES ('9', '\u5f20\u6df3', '\u5973', '2'); INSERT INTO `student` VALUES ('10', '\u6620\u6708', '\u7537', '1'); INSERT INTO `student` VALUES ('11', '\u80e1\u542f', '\u7537', '1'); INSERT INTO `student` VALUES ('12', '\u5929\u5b87', '\u5973', '2'); INSERT INTO `student` VALUES ('13', '\u5b59\u5170', '\u7537', '3'); INSERT INTO `student` VALUES ('14', '\u5f20\u7b11', '\u7537', '3'); INSERT INTO `student` VALUES ('15', '\u5f20\u5170', '\u5973', '1'); INSERT INTO `student` VALUES ('16', '\u5f20\u5170', '\u5973', '2'); INSERT INTO `student` VALUES ('17', '\u5f20\u5170', '\u5973', '3'); -- ---------------------------- -- Table structure for `teacher` -- ---------------------------- DROP TABLE IF EXISTS `teacher`; CREATE TABLE `teacher` ( `tid` int(11) NOT NULL AUTO_INCREMENT, `tname` char(10) NOT NULL, PRIMARY KEY (`tid`) ) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of teacher -- ---------------------------- INSERT INTO `teacher` VALUES ('1', '\u5f20\u4e09'); INSERT INTO `teacher` VALUES ('2', '\u674e\u56db'); INSERT INTO `teacher` VALUES ('3', '\u738b\u4e94'); INSERT INTO `teacher` VALUES ('4', '\u674e\u5764'); -- ---------------------------- -- Table structure for `teacher2cls` -- ---------------------------- DROP TABLE IF EXISTS `teacher2cls`; CREATE TABLE `teacher2cls` ( `tcid` int(11) NOT NULL AUTO_INCREMENT, `tid` int(11) NOT NULL, `cid` int(11) NOT NULL, PRIMARY KEY (`tcid`), UNIQUE KEY `tcid` (`tcid`), KEY `tid` (`tid`), KEY `cid` (`cid`), CONSTRAINT `teacher2cls_ibfk_1` FOREIGN KEY (`tid`) REFERENCES `teacher` (`tid`), CONSTRAINT `teacher2cls_ibfk_2` FOREIGN KEY (`cid`) REFERENCES `course` (`cid`) ) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8; -- ---------------------------- -- Records of teacher2cls -- ---------------------------- INSERT INTO `teacher2cls` VALUES ('1', '1', '1'); INSERT INTO `teacher2cls` VALUES ('2', '1', '2'); INSERT INTO `teacher2cls` VALUES ('3', '2', '1'); INSERT INTO `teacher2cls` VALUES ('4', '3', '2'); -- ---------------------------- -- Procedure structure for `p1` -- ---------------------------- DROP PROCEDURE IF EXISTS `p1`; DELIMITER ;; CREATE DEFINER=`cmz`@`localhost` PROCEDURE `p1`() BEGIN select * from score; END ;; DELIMITER ; -- ---------------------------- -- Procedure structure for `p2` -- ---------------------------- DROP PROCEDURE IF EXISTS `p2`; DELIMITER ;; CREATE DEFINER=`cmz`@`localhost` PROCEDURE `p2`(in n1 int,in n2 int,out res int) BEGIN select * from score where course_id=n1 and score >n2 ; set res = 1; END ;; DELIMITER ;","title":"1. \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.practice1/#2","text":"#1.------------------------- create database ------------------------- #1. create database and change this database create database cmz charset utf8; use cmz; #2.------------------------- create table ------------------------- #2. create table #1. teacher table create table teacher( tid int not null primary key auto_increment, tname char(10) not null )charset utf8 engine=innodb; #2. class_grade table create table class_grade( gid int not null primary key auto_increment, gname char(10) not null )charset utf8 engine=innodb; #3. course table create table course( cid int not null primary key auto_increment, cname char(10) not null, teacher_id int not null, foreign key(teacher_id) references teacher(tid) )charset utf8 engine=innodb; #4. class table create table class( cid int not null primary key auto_increment, caption char(10) not null, grade_id int not null, foreign key(grade_id) references class_grade(gid) )charset utf8 engine=innodb; #5. student table create table student( sid int not null primary key auto_increment, sname char(10) not null, gender enum('\u7537','\u5973'), class_id int not null, foreign key(class_id) references class(cid) )charset utf8 engine=innodb; #6. score table create table score( sid int not null unique auto_increment, student_id int not null, course_id int not null, score int unsigned not null, foreign key(student_id) references student(sid), foreign key(course_id) references course(cid), primary key(sid) )charset utf8 engine=innodb; #7. teacher2cls table create table teacher2cls( tcid int not null unique auto_increment, tid int not null, cid int not null, foreign key(tid) references teacher(tid), foreign key(cid) references course(cid), primary key(tcid) )charset utf8 engine=innodb; #3. ------------------------- insert into table ------------------------- # insert every table data #1. teacher table insert into teacher(tname) values (\"\u5f20\u4e09\"), (\"\u674e\u56db\"), (\"\u738b\u4e94\"); #2. class_grade table data insert into class_grade(gname) values (\"\u4e00\u5e74\u7ea7\"), (\"\u4e8c\u5e74\u7ea7\"), (\"\u4e09\u5e74\u7ea7\"); #3. course table data insert into course(cname,teacher_id) values (\"\u751f\u7269\",1), (\"\u4f53\u80b2\",1), (\"\u6570\u5b66\",1), (\"\u7269\u7406\",2); #4. class table data insert into class(caption,grade_id) values (\"\u4e00\u5e74\u4e00\u73ed\",1), (\"\u4e00\u5e74\u4e8c\u73ed\",1), (\"\u4e00\u5e74\u4e09\u73ed\",1), (\"\u4e00\u5e74\u56db\u73ed\",1), (\"\u4e00\u5e74\u4e94\u73ed\",1), (\"\u4e8c\u5e74\u4e00\u73ed\",2), (\"\u4e8c\u5e74\u4e8c\u73ed\",2), (\"\u4e8c\u5e74\u4e09\u73ed\",2), (\"\u4e8c\u5e74\u56db\u73ed\",2), (\"\u4e09\u5e74\u4e00\u73ed\",3), (\"\u4e09\u5e74\u4e8c\u73ed\",3); #5. student table data insert into student(sname,gender,class_id) values (\"\u4e54\u4e39\",\"\u5973\",1), (\"\u827e\u68ee\",\"\u5973\",2), (\"\u79d1\u6bd4\",\"\u7537\",3), (\"\u9ec4\u5bb6\",\"\u5973\",1), (\"\u80e1\u542f\",\"\u7537\",1), (\"\u5434\u5b87\",\"\u7537\",2), (\"\u5510\u660e\",\"\u5973\",3), (\"\u53f6\u8471\",\"\u7537\",2), (\"\u5f20\u6df3\",\"\u5973\",2), (\"\u6620\u6708\",\"\u7537\",1), (\"\u80e1\u542f\",\"\u7537\",1), (\"\u5929\u5b87\",\"\u5973\",2), (\"\u5b59\u5170\",\"\u7537\",3); #6. score table data insert into score(student_id,course_id,score) values (1,1,60), (1,2,59), (2,2,59); #7. teacher2cls table data insert into teacher2cls(tid,cid) values (1,1), (1,2), (2,1), (3,2); # sql for operation mysql #1. \u521b\u5efa\u6d4b\u8bd5\u6570\u636e #2. \u67e5\u8be2\u5b66\u751f\u603b\u4eba\u6570 select COUNT(sid) from student; \u8fd0\u884c\u8fc7\u7a0b mysql> select COUNT(sid) from student; +------------+ | COUNT(sid) | +------------+ | 17 | +------------+ 1 row in set (0.00 sec) #3. \u67e5\u8be2\u201c\u751f\u7269\u201d\u8bfe\u7a0b\u548c\u201c\u7269\u7406\u201d\u8bfe\u7a0b\u90fd\u53ca\u683c\u7684\u5b66\u751fid\u548c\u59d3\u540d select s1.sid,s1.sname from student s1 where s1.sid in ( select distinct(s.student_id) from score s left join course c on c.cid=s.course_id where s.score >= 60 and (c.cname='\u751f\u7269' or c.cname='\u7269\u7406')); \u8fd0\u884c\u8fc7\u7a0b mysql> select s1.sid,s1.sname from student s1 -> where s1.sid in ( -> select distinct(s.student_id) from score s left join course c on c.cid=s.course_id -> where s.score >= 60 and (c.cname='\u751f\u7269' or c.cname='\u7269\u7406')); +-----+-------+ | sid | sname | +-----+-------+ | 1 | \u4e54\u4e39 | | 4 | \u9ec4\u5bb6 | +-----+-------+ 2 rows in set (0.00 sec) #4. \u67e5\u8be2\u6bcf\u4e2a\u5e74\u7ea7\u7684\u73ed\u7ea7\u6570\uff0c\u53d6\u51fa\u73ed\u7ea7\u6570\u6700\u591a\u7684\u524d\u4e09\u4e2a\u5e74\u7ea7 select grade_id from class_grade LEFT JOIN class on class_grade.gid = class.grade_id GROUP BY grade_id ORDER BY count(grade_id) asc LIMIT 3; \u8fd0\u884c\u8fc7\u7a0b mysql> select grade_id from class_grade LEFT JOIN class on class_grade.gid = class.grade_id -> GROUP BY grade_id ORDER BY count(grade_id) asc LIMIT 3; +----------+ | grade_id | +----------+ | 3 | | 2 | | 1 | +----------+ 3 rows in set (0.00 sec) #5. \u67e5\u8be2 \u5e73\u5747\u6210\u7ee9\u6700\u9ad8\u548c\u6700\u4f4e\u7684\u5b66\u751f\u7684id\u548c\u59d3\u540d\u4ee5\u53ca\u5e73\u5747\u6210\u7ee9 SELECT student.sid,student.sname,avg(score) from student RIGHT JOIN score on student.sid = score.student_id GROUP BY score ORDER BY avg(score) desc LIMIT 1; SELECT student.sid,student.sname,avg(score) from student RIGHT JOIN score on student.sid = score.student_id GROUP BY score ORDER BY avg(score) asc LIMIT 1; \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT student.sid,student.sname,avg(score) from student RIGHT JOIN score on student.sid = sc ore.student_id -> GROUP BY score ORDER BY avg(score) desc LIMIT 1; +------+-------+------------+ | sid | sname | avg(score) | +------+-------+------------+ | 1 | \u4e54\u4e39 | 80.0000 | +------+-------+------------+ 1 row in set (0.00 sec) mysql> mysql> SELECT student.sid,student.sname,avg(score) from student RIGHT JOIN score on student.sid = sc ore.student_id -> GROUP BY score ORDER BY avg(score) asc LIMIT 1; +------+-------+------------+ | sid | sname | avg(score) | +------+-------+------------+ | 5 | \u80e1\u542f | 50.0000 | +------+-------+------------+ 1 row in set (0.00 sec) #6. \u67e5\u8be2\u6bcf\u4e2a\u5e74\u7ea7\u7684\u5b66\u751f\u4eba\u6570 select count(*) from class group by grade_id; \u8fd0\u884c\u8fc7\u7a0b mysql> select count(*) from class group by grade_id; +----------+ | count(*) | +----------+ | 5 | | 4 | | 2 | +----------+ 3 rows in set (0.00 sec) #7. \u67e5\u8be2\u6bcf\u4e2a\u5b66\u751f\u7684\u5b66\u53f7\uff0c\u59d3\u540d\uff0c\u9009\u8bfe\u6570\uff0c\u5e73\u5747\u6210\u7ee9 SELECT s.sid,s.sname,count(course_id),avg(score) from student s RIGHT JOIN score sc on s.sid = sc.sid GROUP BY student_id; \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT s.sid,s.sname,count(course_id),avg(score) from student s RIGHT JOIN score sc on s.sid= sc.sid -> GROUP BY student_id; +------+-------+------------------+------------+ | sid | sname | count(course_id) | avg(score) | +------+-------+------------------+------------+ | 5 | \u80e1\u542f | 1 | 80.0000 | | 8 | \u53f6\u8471 | 1 | 70.0000 | | 9 | \u5f20\u6df3 | 1 | 50.0000 | +------+-------+------------------+------------+ 3 rows in set (0.00 sec) #8. \u67e5\u8be2\u5b66\u751f\u7f16\u53f7\u4e3a2\u7684\u5b66\u751f\u7684\u59d3\u540d\uff0c\u8be5\u5b66\u751f\u7684\u6210\u7ee9\u6700\u9ad8\u7684\u8bfe\u7a0b\u540d\uff0c\u6210\u7ee9\u6700\u4f4e\u7684\u8bfe\u7a0b\u540d\u4ee5\u53ca\u5206\u6570 SELECT course.cname,score.score from score LEFT JOIN course on score.course_id = course.cid where score.student_id = 2 ORDER BY score.score desc LIMIT 1; SELECT course.cname,score.score from score LEFT JOIN course on score.course_id = course.cid where score.student_id = 2 ORDER BY score.score asc LIMIT 1; \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT course.cname,score.score from score LEFT JOIN course on score.course_id = course.cid -> where score.student_id = 2 ORDER BY score.score desc LIMIT 1; Empty set (0.00 sec) mysql> SELECT course.cname,score.score from score LEFT JOIN course on score.course_id = course.cid -> where score.student_id = 2 ORDER BY score.score asc LIMIT 1; Empty set (0.00 sec) #9. \u67e5\u8be2\u59d3\u201c\u674e\u201d\u7684\u8001\u5e08\u7684\u4e2a\u6570\u548c\u6240\u5e26\u73ed\u7ea7\u6570 select (select tea.tid from teacher tea where tea.tname like '\u5f20%') as \u59d3\u674e\u7684\u4eba\u6570 , count(tea2.tid) as \u8bfe\u7a0b from teacher2cls tea2 where tea2.tid in (select tea.tid from teacher tea where tea.tname like '\u5f20%' ) group by tea2.tid; \u8fd0\u884c\u8fc7\u7a0b mysql> select (select tea.tid from teacher tea where tea.tname like '\u5f20%') as \u59d3\u674e\u7684\u4eba\u6570 , -> count(tea2.tid) as \u8bfe\u7a0b from teacher2cls tea2 -> where tea2.tid in (select tea.tid from teacher tea where tea.tname like '\u5f20%' ) group by tea2.tid; +------------+------+ | \u59d3\u674e\u7684\u4eba\u6570 | \u8bfe\u7a0b | +------------+------+ | 1 | 2 | +------------+------+ 1 row in set (0.00 sec) #10.\u67e5\u8be2\u73ed\u7ea7\u6570\u5c0f\u4e8e5\u7684\u5e74\u7ea7id\u548c\u5e74\u7ea7\u540d select gid,gname from class_grade where gid in (select grade_id from class GROUP BY grade_id HAVING count(class.grade_id)<5); \u8fd0\u884c\u8fc7\u7a0b mysql> select gid,gname from class_grade -> where gid in -> (select grade_id from class GROUP BY grade_id HAVING count(class.grade_id)<5); +-----+--------+ | gid | gname | +-----+--------+ | 2 | \u4e8c\u5e74\u7ea7 | | 3 | \u4e09\u5e74\u7ea7 | +-----+--------+ 2 rows in set (0.00 sec) #11.\u67e5\u8be2\u73ed\u7ea7\u4fe1\u606f\uff0c\u5305\u62ec\u73ed\u7ea7id,\u73ed\u7ea7\u540d\u79f0\uff0c\u5e74\u7ea7\uff0c\u5e74\u7ea7\u7ea7\u522b\uff0812\u4e3a\u4f4e\u5e74\u7ea7\uff0c34\u4e3a\u4e2d\u5e74\u7ea7\uff0c56\u4e3a\u9ad8\u5e74\u7ea7\uff09 \u793a\u4f8b\u5982\u4e0b\uff1a ----------------------------------------------- | \u73ed\u7ea7id | \u73ed\u7ea7\u540d\u79f0 | \u5e74\u7ea7 | \u5e74\u7ea7\u7ea7\u522b | ----------------------------------------------- | 1 | \u4e00\u5e74\u4e00\u73ed | \u4e00\u5e74\u7ea7 | \u4f4e | ----------------------------------------------- \u5e74\u7ea7\u5224\u65ad\u6ca1\u505a\u3002\u6682\u65f6\u4e0d\u4f1a\u3002 SELECT cid \"\u73ed\u7ea7id\", caption \"\u73ed\u7ea7\u540d\u79f0\", gname \"\u5e74\u7ea7\" FROM class LEFT JOIN class_grade ON class.grade_id = class_grade.gid; \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT -> cid \"\u73ed\u7ea7id\", -> caption \"\u73ed\u7ea7\u540d\u79f0\", -> gname \"\u5e74\u7ea7\" -> FROM -> class -> LEFT JOIN class_grade ON class.grade_id = class_grade.gid; +--------+----------+--------+ | \u73ed\u7ea7id | \u73ed\u7ea7\u540d\u79f0 | \u5e74\u7ea7 | +--------+----------+--------+ | 1 | \u4e00\u5e74\u4e00\u73ed | \u4e00\u5e74\u7ea7 | | 2 | \u4e00\u5e74\u4e8c\u73ed | \u4e00\u5e74\u7ea7 | | 3 | \u4e00\u5e74\u4e09\u73ed | \u4e00\u5e74\u7ea7 | | 4 | \u4e00\u5e74\u56db\u73ed | \u4e00\u5e74\u7ea7 | | 5 | \u4e00\u5e74\u4e94\u73ed | \u4e00\u5e74\u7ea7 | | 6 | \u4e8c\u5e74\u4e00\u73ed | \u4e8c\u5e74\u7ea7 | | 7 | \u4e8c\u5e74\u4e8c\u73ed | \u4e8c\u5e74\u7ea7 | | 8 | \u4e8c\u5e74\u4e09\u73ed | \u4e8c\u5e74\u7ea7 | | 9 | \u4e8c\u5e74\u56db\u73ed | \u4e8c\u5e74\u7ea7 | | 10 | \u4e09\u5e74\u4e00\u73ed | \u4e09\u5e74\u7ea7 | | 11 | \u4e09\u5e74\u4e8c\u73ed | \u4e09\u5e74\u7ea7 | +--------+----------+--------+ 11 rows in set (0.00 sec) #12.\u67e5\u8be2\u5b66\u8fc7\u5f20\u4e09\u8001\u5e081\u95e8\u8bfe\u4ee5\u4e0a\u7684\u540c\u5b66\u7684\u5b66\u53f7\uff0c\u59d3\u540d SELECT sc.student_id, su.sname, COUNT(sc.course_id) AS class_sum FROM score sc LEFT JOIN student su ON sc.student_id = su.sid WHERE sc.course_id IN ( SELECT co.cid AS cid FROM teacher tc LEFT JOIN course co ON tc.tid = co.teacher_id WHERE tc.tname = \"\u5f20\u4e09\" ) GROUP BY sc.student_id HAVING class_sum > 1; \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT -> sc.student_id, -> su.sname, -> COUNT(sc.course_id) AS class_sum -> FROM -> score sc -> LEFT JOIN student su ON sc.student_id = su.sid -> WHERE -> sc.course_id IN ( -> SELECT -> co.cid AS cid -> FROM -> teacher tc -> LEFT JOIN course co ON tc.tid = co.teacher_id -> WHERE -> tc.tname = \"\u5f20\u4e09\" -> ) -> GROUP BY -> sc.student_id -> HAVING -> class_sum > 1; +------------+-------+-----------+ | student_id | sname | class_sum | +------------+-------+-----------+ | 10 | \u6620\u6708 | 2 | +------------+-------+-----------+ 1 row in set (0.00 sec) #13.\u67e5\u8be2\u6559\u6388\u8bfe\u7a0b\u8d85\u8fc72\u95e8\u7684\u8001\u5e08\u7684id\u548c\u59d3\u540d select * from teacher where tid in( select tid from teacher2cls GROUP BY tid HAVING count(cid)>=2); \u8fd0\u884c\u8fc7\u7a0b mysql> select * from teacher where tid in( -> select tid from teacher2cls GROUP BY tid HAVING count(cid)>=2); +-----+-------+ | tid | tname | +-----+-------+ | 1 | \u5f20\u4e09 | +-----+-------+ 1 row in set (0.00 sec) #14.\u67e5\u8be2\u5b66\u8fc7\u7f16\u53f7\u201c1\u201c\u8bfe\u7a0b\u548c\u7f16\u53f7\u201d2\u201c\u8bfe\u7a0b\u7684\u540c\u5b66\u7684\u5b66\u53f7\uff0c\u59d3\u540d SELECT sid, sname FROM student WHERE sid IN ( SELECT a.sid FROM ( SELECT st.*, sr.cname FROM student st LEFT JOIN score sc ON st.sid = sc.student_id LEFT JOIN course sr ON sr.cid = sc.course_id WHERE sr.cid = 1 ) AS a LEFT JOIN ( SELECT st.*, sr.cid FROM student st LEFT JOIN score sc ON st.sid = sc.student_id LEFT JOIN course sr ON sr.cid = sc.course_id WHERE sr.cid = 4 ) AS b ON a.sid = b.sid WHERE b.cid = 4 ); \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT -> sid, -> sname -> FROM -> student -> WHERE -> sid IN ( -> SELECT -> a.sid -> FROM -> ( -> SELECT -> st.*, sr.cname -> FROM -> student st -> LEFT JOIN score sc ON st.sid = sc.student_id -> LEFT JOIN course sr ON sr.cid = sc.course_id -> WHERE -> sr.cid = 1 -> ) AS a -> LEFT JOIN ( -> SELECT -> st.*, sr.cid -> FROM -> student st -> LEFT JOIN score sc ON st.sid = sc.student_id -> LEFT JOIN course sr ON sr.cid = sc.course_id -> WHERE -> sr.cid = 4 -> ) AS b ON a.sid = b.sid -> WHERE -> b.cid = 4 -> ); +-----+-------+ | sid | sname | +-----+-------+ | 10 | \u6620\u6708 | +-----+-------+ 1 row in set (0.01 sec) #15.\u67e5\u8be2\u6ca1\u6709\u5e26\u8fc7\u9ad8\u5e74\u7ea7\u7684\u8001\u5e08\u7684id\u548c\u59d3\u540d #16.\u67e5\u8be2\u5b66\u8fc7\u5f20\u4e09\u8001\u5e08\u6240\u6559\u7684\u6240\u6709\u8bfe\u7684\u540c\u5b66\u5b66\u53f7\uff0c\u59d3\u540d select sid,sname from student where sid in ( select student_id from score where course_id in ( select cid from course LEFT JOIN teacher on course.teacher_id = teacher.tid where teacher.tname = \"\u5f20\u4e09\")); \u8fd0\u884c\u8fc7\u7a0b mysql> select sid,sname from student where sid in ( -> select student_id from score where course_id in ( -> select cid from course LEFT JOIN teacher on course.teacher_id = teacher.tid where -> teacher.tname = \"\u5f20\u4e09\")); Empty set (0.00 sec) #17.\u67e5\u8be2\u5e26\u8fc7\u8d85\u8fc72\u4e2a\u73ed\u7ea7\u7684\u8001\u5e08\u7684id\u548c\u59d3\u540d SELECT DISTINCT tc.tid, tc.tname FROM teacher tc LEFT JOIN course co ON tc.tid = co.teacher_id LEFT JOIN teacher2cls t2c ON t2c.cid = co.cid GROUP BY t2c.cid HAVING COUNT(tc.tid) > 2; \u8fd0\u884c\u8fc7\u7a0bmysql> SELECT DISTINCT -> tc.tid, -> tc.tname -> FROM -> teacher tc -> LEFT JOIN course co ON tc.tid = co.teacher_id -> LEFT JOIN teacher2cls t2c ON t2c.cid = co.cid -> GROUP BY -> t2c.cid -> HAVING -> COUNT(tc.tid) > 2; +-----+-------+ | tid | tname | +-----+-------+ | 1 | \u5f20\u4e09 | +-----+-------+ 1 row in set (0.04 sec) #18.\u67e5\u8be2 \u8bfe\u7a0b\u7f16\u53f7\u201c2\u201d\u7684\u6210\u7ee9\u6bd4\u8bfe\u7a0b\u7f16\u53f7\u201c1\u201c\u8bfe\u7a0b\u4f4e\u7684\u6240\u6709\u540c\u5b66\u7684\u5b66\u53f7\uff0c\u59d3\u540d select sid,sname from student where sid in ( select a.sid from (select * from score s where s.course_id = 1) a, (select * from score s where s.course_id = 2) b where a.student_id = b.student_id and a.score > b.score); \u8fd0\u884c\u8fc7\u7a0b mysql> select sid,sname from student where sid in ( -> select a.sid -> from (select * from score s where s.course_id = 1) a, -> (select * from score s where s.course_id = 2) b -> where a.student_id = b.student_id -> and a.score > b.score); Empty set (0.00 sec) #19.\u67e5\u8be2\u6240\u5e26\u73ed\u7ea7\u6570\u6700\u591a\u7684\u8001\u5e08\u7684id\u548c\u59d3\u540d SELECT tc.tname, tc.tid FROM teacher tc LEFT JOIN teacher2cls t2c ON tc.tid = t2c.tid GROUP BY t2c.tid ORDER BY COUNT(cid) DESC LIMIT 1; \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT -> tc.tname, -> tc.tid -> FROM -> teacher tc -> LEFT JOIN teacher2cls t2c ON tc.tid = t2c.tid -> GROUP BY -> t2c.tid -> ORDER BY -> COUNT(cid) DESC -> LIMIT 1; +-------+-----+ | tname | tid | +-------+-----+ | \u5f20\u4e09 | 1 | +-------+-----+ 1 row in set (0.00 sec) #20.\u67e5\u8be2\u6240\u6709\u8bfe\u7a0b\u6210\u7ee9\u5c0f\u4e8e60\u5206\u7684\u540c\u5b66\u7684\u5b66\u53f7\uff0c\u59d3\u540d select student.sid,student.sname from student LEFT JOIN score on student.sid = score.student_id where score.score<60; \u8fd0\u884c\u8fc7\u7a0b mysql> select student.sid,student.sname from student LEFT JOIN score -> on -> student.sid = score.student_id -> where score.score<60; +-----+-------+ | sid | sname | +-----+-------+ | 5 | \u80e1\u542f | +-----+-------+ 1 row in set (0.00 sec) #21.\u67e5\u8be2\u6ca1\u6709\u5b66\u5168\u6240\u6709\u8bfe\u7a0b\u7684\u540c\u5b66\u7684\u5b66\u53f7\uff0c\u59d3\u540d Select sid,sname From student st where (Select Count(*) From score sc Where st.sid=sc.student_id)< (Select Count(*) From course); \u8fd0\u884c\u8fc7\u7a0b mysql> Select sid,sname From student st -> where (Select Count(*) From score sc Where st.sid=sc.student_id)< -> (Select Count(*) From course); +-----+-------+ | sid | sname | +-----+-------+ | 1 | \u4e54\u4e39 | | 2 | \u827e\u68ee | | 3 | \u79d1\u6bd4 | | 4 | \u9ec4\u5bb6 | | 5 | \u80e1\u542f | | 6 | \u5434\u5b87 | | 7 | \u5510\u660e | | 8 | \u53f6\u8471 | | 9 | \u5f20\u6df3 | | 10 | \u6620\u6708 | | 11 | \u80e1\u542f | | 12 | \u5929\u5b87 | | 13 | \u5b59\u5170 | | 14 | \u5f20\u7b11 | | 15 | \u5f20\u5170 | | 16 | \u5f20\u5170 | | 17 | \u5f20\u5170 | +-----+-------+ 17 rows in set (0.00 sec) #22.\u67e5\u8be2\u81f3\u5c11\u4e00\u95e8\u8bfe\u4e0e\u5b66\u53f7\u4e3a\u201c1\u201c\u7684\u540c\u5b66\u6240\u5b66\u76f8\u540c\u7684\u540c\u5b66\u7684\u5b66\u53f7\u548c\u59d3\u540d Select DistInct st.sid,st.sname From student st Inner Join score sc ON st.sid=sc.student_id Where sc.course_id IN (Select course_id From score Where student_id='1'); \u8fd0\u884c\u8fc7\u7a0b mysql> Select DistInct st.sid,st.sname From student st -> Inner Join score sc ON st.sid=sc.student_id -> Where sc.course_id IN (Select course_id From score Where student_id='1'); +-----+-------+ | sid | sname | +-----+-------+ | 1 | \u4e54\u4e39 | | 4 | \u9ec4\u5bb6 | | 5 | \u80e1\u542f | +-----+-------+ 3 rows in set (0.00 sec) #23.\u67e5\u8be2\u81f3\u5c11\u5b66\u8fc7\u5b66\u53f7\u4e3a\u201c1\u201d\u540c\u5b66\u6240\u9009\u8bfe\u7a0b\u4e2d\u4efb\u610f\u4e00\u95e8\u8bfe\u7684\u5176\u4ed6\u540c\u5b66\u5b66\u53f7\u548c\u59d3\u540d Select DistInct st.sid,st.sname From student st Inner Join score sc ON st.sid=sc.student_id Where st.sid <>1 and sc.course_id IN (Select course_id From score Where student_id='1'); \u8fd0\u884c\u8fc7\u7a0b mysql> Select DistInct st.sid,st.sname From student st -> Inner Join score sc ON st.sid=sc.student_id -> Where st.sid <>1 and -> sc.course_id IN -> (Select course_id From score Where student_id='1'); +-----+-------+ | sid | sname | +-----+-------+ | 4 | \u9ec4\u5bb6 | | 5 | \u80e1\u542f | +-----+-------+ 2 rows in set (0.00 sec) #24.\u67e5\u8be2\u548c\"2\"\u53f7\u540c\u5b66\u5b66\u4e60\u7684\u8bfe\u7a0b\u5b8c\u5168\u76f8\u540c\u7684\u5176\u4ed6\u540c\u5b66\u7684\u5b66\u53f7\u548c\u59d3\u540d #25.\u5220\u9664\u5b66\u4e60\u5f20\u4e09\u8001\u5e08\u8bfe\u7684score\u8868\u8bb0\u5f55 DELETE from score where course_id in (select cid from course LEFT JOIN teacher on course.teacher_id = teacher.tid where teacher.tname = '\u5f20\u4e09'); \u8fd0\u884c\u8fc7\u7a0b mysql> DELETE from score where course_id in -> (select cid from course LEFT JOIN teacher -> on course.teacher_id = teacher.tid -> where teacher.tname = '\u5f20\u4e09'); Query OK, 7 rows affected (0.01 sec) #26.\u5411score\u8868\u4e2d\u63d2\u5165\u4e00\u4e9b\u8bb0\u5f55\uff0c\u8fd9\u4e9b\u8bb0\u5f55\u8981\u6c42\u7b26\u5408\u4ee5\u4e0b\u6761\u4ef6 1. \u6ca1\u6709\u4e0a\u8fc7\u7f16\u53f7\u201c2\u201d\u8bfe\u7a0b\u540c\u5b66\u5b66\u53f7 2. \u63d2\u5165\u201c2\u201d\u53f7\u8bfe\u7a0b\u7684\u5e73\u5747\u6210\u7ee9 #27.\u6309\u5e73\u5747\u6210\u7ee9\u4ece\u4f4e\u5230\u9ad8\u663e\u793a\u6240\u6709\u5b66\u751f\u7684\u201c\u8bed\u6587\u201d\uff0c\u201c\u6570\u5b66\u201d\uff0c\u2018\u82f1\u8bed\u2019\u4e09\u95e8\u7684\u7684\u8bfe\u7a0b\u6210\u7ee9\uff0c\u6309\u7167\u5982\u4e0b\u5f62\u5f0f\u663e\u793a \u5b66\u751fID,\u8bed\u6587,\u6570\u5b66,\u82f1\u8bed,\u6709\u6548\u8bfe\u7a0b\u6570,\u6709\u6548\u5e73\u5747\u5206 select concat(\"\u5b66\u751fID: \",st.sid,\" \", \"\u8bfe\u7a0bID: \",sc.course_id,\" \",\"\u5e73\u5747\u6210\u7ee9: \",avg(sc.score)) from student as st RIGHT JOIN score as sc on st.sid = sc.student_id GROUP BY student_id; \u8fd0\u884c\u8fc7\u7a0b mysql> select concat(\"\u5b66\u751fID: \",st.sid,\" \", \"\u8bfe\u7a0bID: \",sc.course_id,\" \",\"\u5e73\u5747\u6210\u7ee9: \",avg(sc.score )) from student as st RIGHT JOIN score as sc on st.sid = sc.student_id -> GROUP BY student_id; +------------------------------------------------------------------------------------------+ | concat(\"\u5b66\u751fID: \",st.sid,\" \", \"\u8bfe\u7a0bID: \",sc.course_id,\" \",\"\u5e73\u5747\u6210\u7ee9: \",avg(sc.score)) | +------------------------------------------------------------------------------------------+ | \u5b66\u751fID: 1 \u8bfe\u7a0bID: 3 \u5e73\u5747\u6210\u7ee9: 80.0000 | | \u5b66\u751fID: 4 \u8bfe\u7a0bID: 3 \u5e73\u5747\u6210\u7ee9: 70.0000 | | \u5b66\u751fID: 5 \u8bfe\u7a0bID: 3 \u5e73\u5747\u6210\u7ee9: 50.0000 | +------------------------------------------------------------------------------------------+ 3 rows in set (0.00 sec) #28.\u67e5\u8be2\u5404\u79d1\u6210\u7ee9\u6700\u9ad8\u548c\u6700\u4f4e\u7684\u5206\uff0c\u5982\u4e0b\u663e\u793a:\u8bfe\u7a0bID,\u6700\u9ad8\u5206,\u6700\u4f4e\u5206 select CONCAT(\"\u8bfe\u7a0bID\",course_id,\",\",\"\u6700\u9ad8\u5206 \",score,\",\",\"\u6700\u4f4e\u5206\") from score GROUP BY course_id ORDER BY score desc LIMIT 1; \u8fd0\u884c\u8fc7\u7a0b mysql> select CONCAT(\"\u8bfe\u7a0bID\",course_id,\",\",\"\u6700\u9ad8\u5206 \",score,\",\",\"\u6700\u4f4e\u5206\") -> from score GROUP BY course_id -> ORDER BY score desc -> LIMIT 1; +-------------------------------------------------------------+ | CONCAT(\"\u8bfe\u7a0bID\",course_id,\",\",\"\u6700\u9ad8\u5206 \",score,\",\",\"\u6700\u4f4e\u5206\") | +-------------------------------------------------------------+ | \u8bfe\u7a0bID4,\u6700\u9ad8\u5206 100,\u6700\u4f4e\u5206 | +-------------------------------------------------------------+ 1 row in set (0.00 sec) #29.\u6309\u5404\u79d1\u5e73\u5747\u6210\u7ee9\u4ece\u4f4e\u5230\u9ad8\u548c\u53ca\u683c\u7387\u7684\u767e\u5206\u6570\u4ece\u9ad8\u5230\u4f4e\u6392\u5e8f # \u53ca\u683c\u7387-------\u6682\u65f6\u4e0d\u4f1a select * from score GROUP BY course_id ORDER BY avg(score) desc; \u8fd0\u884c\u8fc7\u7a0b mysql> select * from score GROUP BY course_id ORDER BY avg(score) desc; +-----+------------+-----------+-------+ | sid | student_id | course_id | score | +-----+------------+-----------+-------+ | 6 | 1 | 4 | 100 | | 1 | 1 | 1 | 60 | | 2 | 1 | 2 | 59 | | 5 | 1 | 3 | 80 | +-----+------------+-----------+-------+ 4 rows in set (0.00 sec) #30.\u8bfe\u7a0b\u5e73\u5747\u5206\u4ece\u9ad8\u5230\u4f4e\u663e\u793a\uff08\u663e\u793a\u4efb\u8bfe\u8001\u5e08\uff09 select tname,cname,score from teacher RIGHT JOIN ( select cname,score,teacher_id from score LEFT JOIN course on score.course_id = course.cid GROUP BY course_id ORDER BY avg(score) desc ) as tmp on tmp.teacher_id = teacher.tid; \u8fd0\u884c\u8fc7\u7a0b mysql> select tname,cname,score from teacher RIGHT JOIN ( -> select cname,score,teacher_id from score LEFT JOIN course on score.course_id = course.cid -> GROUP BY course_id ORDER BY avg(score) desc ) as tmp on tmp.teacher_id = teacher.tid; +-------+-------+-------+ | tname | cname | score | +-------+-------+-------+ | \u5f20\u4e09 | \u6570\u5b66 | 100 | | \u5f20\u4e09 | \u751f\u7269 | 60 | | \u5f20\u4e09 | \u4f53\u80b2 | 59 | | \u674e\u56db | \u7269\u7406 | 80 | +-------+-------+-------+ 4 rows in set (0.00 sec) #31.\u67e5\u8be2\u5404\u79d1\u6210\u7ee9\u524d\u4e09\u540d\u7684\u8bb0\u5f55\uff08\u4e0d\u8003\u8651\u6210\u7ee9\u5e76\u5217\u60c5\u51b5\uff09 SELECT * from student RIGHT JOIN score on student.sid = score.student_id GROUP BY course_id ORDER BY score desc LIMIT 3; \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT * from student RIGHT JOIN score on student.sid = score.student_id -> GROUP BY course_id ORDER BY score desc LIMIT 3; +------+-------+--------+----------+-----+------------+-----------+-------+ | sid | sname | gender | class_id | sid | student_id | course_id | score | +------+-------+--------+----------+-----+------------+-----------+-------+ | 1 | \u4e54\u4e39 | \u5973 | 1 | 6 | 1 | 4 | 100 | | 1 | \u4e54\u4e39 | \u5973 | 1 | 5 | 1 | 3 | 80 | | 1 | \u4e54\u4e39 | \u5973 | 1 | 1 | 1 | 1 | 60 | +------+-------+--------+----------+-----+------------+-----------+-------+ 3 rows in set (0.00 sec) #32.\u67e5\u8be2\u6bcf\u95e8\u8bfe\u7a0b\u88ab\u9009\u4fee\u7684\u5b66\u751f\u6570 select cname \"\u8bfe\u7a0b\",count(student_id) \"\u9009\u4fee\u5b66\u751f\u603b\u6570\" from score LEFT JOIN course on score.course_id = course.cid GROUP BY course_id; \u8fd0\u884c\u8fc7\u7a0b mysql> select cname \"\u8bfe\u7a0b\",count(student_id) \"\u9009\u4fee\u5b66\u751f\u603b\u6570\" from score LEFT JOIN -> course on score.course_id = course.cid GROUP BY course_id; +------+--------------+ | \u8bfe\u7a0b | \u9009\u4fee\u5b66\u751f\u603b\u6570 | +------+--------------+ | \u751f\u7269 | 3 | | \u4f53\u80b2 | 3 | | \u7269\u7406 | 3 | | \u6570\u5b66 | 1 | +------+--------------+ 4 rows in set (0.00 sec) #33.\u67e5\u8be2\u9009\u4fee\u4e862\u95e8\u4ee5\u4e0a\u7684\u8bfe\u7a0b\u7684\u5168\u90e8\u5b66\u751f\u7684\u5b66\u53f7\u548c\u59d3\u540d select sid,sname from student where sid in ( select sid from score group by course_id HAVING count(course_id) > 2 ); \u8fd0\u884c\u8fc7\u7a0b mysql> SELECT gender \"\u6027\u522b\", count(sid) \"\u603b\u4eba\u6570\" FROM student GROUP BY gender ORDER BY count(sid) DESC; +------+--------+ | \u6027\u522b | \u603b\u4eba\u6570 | +------+--------+ | \u5973 | 9 | | \u7537 | 8 | +------+--------+ 2 rows in set (0.00 sec) #34.\u67e5\u8be2\u7537\u751f\uff0c\u5973\u751f\u7684\u4eba\u6570\uff0c\u6309\u7167\u5012\u5e8f\u6392\u5217 SELECT gender \"\u6027\u522b\", count(sid) \"\u603b\u4eba\u6570\" FROM student GROUP BY gender ORDER BY count(sid) DESC; #35.\u67e5\u8be2\u59d3\u5f20\u7684\u5b66\u751f\u540d\u5355 select * from student where sname regexp \"^\u5f20\"; \u8fd0\u884c\u8fc7\u7a0b mysql> select * from student where sname regexp \"^\u5f20\"; +-----+-------+--------+----------+ | sid | sname | gender | class_id | +-----+-------+--------+----------+ | 9 | \u5f20\u6df3 | \u5973 | 2 | | 14 | \u5f20\u7b11 | \u7537 | 3 | | 15 | \u5f20\u5170 | \u5973 | 1 | | 16 | \u5f20\u5170 | \u5973 | 2 | | 17 | \u5f20\u5170 | \u5973 | 3 | +-----+-------+--------+----------+ 5 rows in set (0.00 sec) #36.\u67e5\u8be2\u540c\u540d\u540c\u59d3\u5b66\u751f\u540d\u5355\uff0c\u5e76\u7edf\u8ba1\u540c\u540d\u4eba\u6570 select sname \"\u59d3\u540d\",count(sid) \"\u603b\u4eba\u6570\" from student group by sname HAVING count(sid)>1 ; \u8fd0\u884c\u8fc7\u7a0b mysql> select sname \"\u59d3\u540d\",count(sid) \"\u603b\u4eba\u6570\" from student group by sname HAVING count(sid)>1 ; +------+--------+ | \u59d3\u540d | \u603b\u4eba\u6570 | +------+--------+ | \u5f20\u5170 | 3 | | \u80e1\u542f | 2 | +------+--------+ 2 rows in set (0.00 sec) #37.\u67e5\u8be2\u6bcf\u95e8\u8bfe\u7a0b\u7684\u5e73\u5747\u6210\u7ee9\uff0c\u7ed3\u679c\u6309\u7167\u5e73\u5747\u6210\u7ee9\u5347\u5e8f\u6392\u5217\uff0c\u5e73\u5747\u6210\u7ee9\u76f8\u540c\uff0c\u6309\u7167\u8bfe\u7a0b\u53f7\u964d\u5e8f\u6392\u5217 select course_id,avg(score) from score GROUP BY course_id ORDER BY score asc; # 1 #38.\u67e5\u8be2\u8bfe\u7a0b\u540d\u79f0\u4e3a\u6570\u5b66\uff0c\u4e14\u5206\u6570\u4f4e\u4e8e60\u5206\u7684\u5b66\u751f\u540d\u548c\u5206\u6570 select sname,score from student INNER JOIN score on score.sid = student.sid where score.score < 60; \u8fd0\u884c\u8fc7\u7a0b mysql> select sname,score from student -> INNER JOIN score -> on -> score.sid = student.sid -> where score.score < 60; +-------+-------+ | sname | score | +-------+-------+ | \u827e\u68ee | 59 | | \u79d1\u6bd4 | 59 | | \u5f20\u6df3 | 50 | +-------+-------+ 3 rows in set (0.00 sec) #39.\u67e5\u8be2\u8bfe\u7a0b\u7f16\u53f7\u4e3a3\u4e14\u8bfe\u7a0b\u6210\u7ee9\u572860\u5206\u4ee5\u4e0a\u7684\u5b66\u53f7\u548c\u59d3\u540d select sid,sname from student where sid in (select student_id from score where score.course_id = 2 and score.score > 60); \u8fd0\u884c\u8fc7\u7a0b mysql> select sid,sname from student where sid in -> (select student_id from score where score.course_id = 2 and score.score > 60); +-----+-------+ | sid | sname | +-----+-------+ | 3 | \u79d1\u6bd4 | | 2 | \u827e\u68ee | +-----+-------+ 2 rows in set (0.00 sec) #40.\u6c42\u9009\u4fee\u4e86\u8bfe\u7a0b\u7684\u5b66\u751f\u4eba\u6570 select count(student_id) from score; \u8fd0\u884c\u8fc7\u7a0b mysql> select count(student_id) from score; +-------------------+ | count(student_id) | +-------------------+ | 10 | +-------------------+ 1 row in set (0.00 sec) #41.\u67e5\u8be2\u9009\u4fee\u738b\u4e94\u8001\u5e08\u6240\u6388\u8bfe\u7a0b\u7684\u5b66\u751f\u4e2d\uff0c\u6210\u7ee9\u6700\u9ad8\u548c\u6700\u4f4e\u7684\u5b66\u751f\u59d3\u540d\u53ca\u6210\u7ee9 select sname,score from score RIGHT JOIN student on score.student_id = student.sid where course_id in ( select cid from course as c LEFT JOIN teacher as t on c.teacher_id = t.tid where t.tname = \"\u674e\u56db\") GROUP BY score desc LIMIT 1; select sname,score from score RIGHT JOIN student on score.student_id = student.sid where course_id in ( select cid from course as c LEFT JOIN teacher as t on c.teacher_id = t.tid where t.tname = \"\u674e\u56db\") GROUP BY score asc LIMIT 1; \u8fd0\u884c\u8fc7\u7a0b mysql> select sname,score from score RIGHT JOIN student on score.student_id = student.sid where cou rse_id in ( -> select cid from course as c LEFT JOIN teacher as t on c.teacher_id = t.tid where t.tname = \"\u674e\u56db\") -> GROUP BY score desc LIMIT 1; +-------+-------+ | sname | score | +-------+-------+ | \u4e54\u4e39 | 80 | +-------+-------+ 1 row in set (0.00 sec) mysql> select sname,score from score RIGHT JOIN student on score.student_id = student.sid where cou rse_id in ( -> select cid from course as c LEFT JOIN teacher as t on c.teacher_id = t.tid where t.tname = \"\u674e\u56db\") -> GROUP BY score asc LIMIT 1; +-------+-------+ | sname | score | +-------+-------+ | \u80e1\u542f | 50 | +-------+-------+ 1 row in set (0.00 sec) #42.\u67e5\u8be2\u5404\u4e2a\u8bfe\u7a0b\u53ca\u76f8\u5bf9\u5e94\u7684\u9009\u4fee\u4eba\u6570 select cname,count(sid) from course LEFT JOIN score on course.cid = score.course_id GROUP BY course_id; \u8fd0\u884c\u8fc7\u7a0b mysql> select cname,count(sid) from course LEFT JOIN score on course.cid = score.course_id -> GROUP BY course_id; +-------+------------+ | cname | count(sid) | +-------+------------+ | \u7f8e\u672f | 0 | | \u751f\u7269 | 3 | | \u4f53\u80b2 | 3 | | \u7269\u7406 | 3 | | \u6570\u5b66 | 1 | +-------+------------+ 5 rows in set (0.00 sec) #43.\u67e5\u8be2\u4e0d\u540c\u8bfe\u7a0b\u4f46\u6210\u7ee9\u76f8\u540c\u7684\u5b66\u751f\u7684\u5b66\u53f7\uff0c\u8bfe\u7a0b\u53f7\uff0c\u5b66\u751f\u6210\u7ee9 select sid,sname from student where sid in ( select a.student_id from score a LEFT join score b on a.course_id <> b.course_id where a.score = b.score ); \u8fd0\u884c\u8fc7\u7a0b mysql> select sid,sname from student where sid in ( -> select a.student_id from score a -> LEFT join score b on a.course_id <> b.course_id -> where a.score = b.score -> ); +-----+-------+ | sid | sname | +-----+-------+ | 2 | \u827e\u68ee | | 1 | \u4e54\u4e39 | | 3 | \u79d1\u6bd4 | +-----+-------+ 3 rows in set (0.00 sec) #44.\u67e5\u8be2\u6bcf\u95e8\u8bfe\u7a0b\u6210\u7ee9\u6700\u597d\u7684\u524d\u4e24\u540d\u5b66id\u548c\u59d3\u540d #45.\u68c0\u7d22\u81f3\u5c11\u9009\u62e9\u4e24\u95e8\u8bfe\u7a0b\u7684\u5b66\u751f\u5b66\u53f7 select sid \"\u5b66\u751f\u5e8f\u53f7\" from score group by course_id having count(*)>=2; \u8fd0\u884c\u8fc7\u7a0b mysql> select sid \"\u5b66\u751f\u5e8f\u53f7\" from score -> group by course_id having count(*)>=2; +----------+ | \u5b66\u751f\u5e8f\u53f7 | +----------+ | 1 | | 2 | | 5 | +----------+ 3 rows in set (0.00 sec) #46.\u67e5\u8be2\u6ca1\u6709\u5b66\u751f\u9009\u4fee\u7684\u8bfe\u7a0b\u7684\u8bfe\u7a0b\u53f7\u548c\u62a5\u540d\u8868 select cid, cname from course Where cid not in (select course_id from score); \u8fd0\u884c\u8fc7\u7a0b mysql> select cid, cname from course -> where -> cid not in (select course_id from score); +-----+-------+ | cid | cname | +-----+-------+ | 5 | \u7f8e\u672f | +-----+-------+ 1 row in set (0.00 sec) #47.\u67e5\u8be2\u6ca1\u5e26\u8fc7\u4efb\u4f55\u73ed\u7ea7\u7684\u8001\u5e08id\u548c\u59d3\u540d select * from teacher where tid not in (select tid from teacher2cls); \u8fd0\u884c\u8fc7\u7a0b mysql> select * from teacher where tid not in -> (select tid from teacher2cls); +-----+-------+ | tid | tname | +-----+-------+ | 4 | \u674e\u5764 | +-----+-------+ 1 row in set (0.00 sec) #48.\u67e5\u8be2\u4e24\u95e8\u4ee5\u4e0a\u7684\u8bfe\u7a0b\u8d85\u8fc780\u5206\u7684\u5b66\u751fid\u548c\u5e73\u5747\u6210\u7ee9 select student_id \"\u5b66\u751fid\",avg(score) \"\u5e73\u5747\u6210\u7ee9\" from score where score>60 group by course_id having count(*)>=2; \u8fd0\u884c\u8fc7\u7a0b mysql> select student_id \"\u5b66\u751fid\",avg(score) \"\u5e73\u5747\u6210\u7ee9\" from score where score>60 -> group by course_id having count(*)>=2; +--------+----------+ | \u5b66\u751fid | \u5e73\u5747\u6210\u7ee9 | +--------+----------+ | 3 | 80.0000 | | 1 | 75.0000 | +--------+----------+ 2 rows in set (0.00 sec) #49.\u68c0\u7d22\u201c3\u201d\u8bfe\u7a0b\u5206\u6570\u5c0f\u4e8e60\u5206\uff0c\u6309\u5206\u6570\u964d\u5e8f\u6392\u5217\u7684\u540c\u5b66\u5b66\u53f7 select sid from student where sid in ( select student_id from score where score<80 and course_id=2 ORDER BY score desc); \u8fd0\u884c\u8fc7\u7a0b mysql> select sid from student where sid in ( -> select student_id from score where score<80 and course_id=2 ORDER BY score desc -> ); +-----+ | sid | +-----+ | 1 | +-----+ 1 row in set (0.00 sec) #50.\u5220\u9664\u7f16\u53f7\u4e3a\u201c2\u201d\u7684\u540c\u5b66\u7684\u201c1\u201d\u8bfe\u7a0b\u7684\u6210\u7ee9 DELETE from score where course_id = 1 and student_id = 2; #51.\u67e5\u8be2\u540c\u65f6\u9009\u4fee\u4e86\u7269\u7406\u8bfe\u7a0b\u548c\u751f\u7269\u8bfe\u7684\u5b66\u7684id\u548c\u59d3\u540d select sid,sname from student where sid in( select a.sid from ( select st.*,sr.cname from student AS st left join score AS sc on st.sid = sc.student_id left join course AS sr on sc.course_id = sr.cid where sr.cname = '\u751f\u7269' ) AS a left join ( select st.sid,sr.cname from student AS st left join score AS sc on st.sid = sc.student_id left join course AS sr on sc.course_id = sr.cid where sr.cname = '\u6570\u5b66' ) AS b on a.sid = b.sid where b.cname = '\u6570\u5b66' ); \u8fd0\u884c\u8fc7\u7a0b mysql> select sid,sname from student where sid in( -> select a.sid from ( -> select st.*,sr.cname from student AS st -> left join score AS sc on st.sid = sc.student_id -> left join course AS sr on sc.course_id = sr.cid -> where sr.cname = '\u751f\u7269' -> ) AS a -> left join ( -> select st.sid,sr.cname from student AS st -> left join score AS sc on st.sid = sc.student_id -> left join course AS sr on sc.course_id = sr.cid -> where sr.cname = '\u6570\u5b66' -> ) AS b on a.sid = b.sid where b.cname = '\u6570\u5b66' -> ); +-----+-------+ | sid | sname | +-----+-------+ | 10 | \u6620\u6708 | +-----+-------+ 1 row in set (0.00 sec)","title":"2. \u7ec3\u4e60"},{"location":"mysql/mysql.regexp/","text":"MySQL \u6b63\u5219 1. \u4ecb\u7ecd \u00b6 MySQL\u53ef\u4ee5\u901a\u8fc7 LIKE ...% \u6765\u8fdb\u884c\u6a21\u7cca\u5339\u914d\u3002 MySQL \u540c\u6837\u4e5f\u652f\u6301\u5176\u4ed6\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5339\u914d\uff0c MySQL\u4e2d\u4f7f\u7528 REGEXP \u64cd\u4f5c\u7b26\u6765\u8fdb\u884c\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u3002 \u4e0b\u8868\u4e2d\u7684\u6b63\u5219\u6a21\u5f0f\u53ef\u5e94\u7528\u4e8e REGEXP \u64cd\u4f5c\u7b26\u4e2d\u3002 \u8868\u8fbe\u5f0f \u63cf\u8ff0 ^ \u5339\u914d\u8f93\u5165\u5b57\u7b26\u4e32\u7684\u5f00\u59cb\u4f4d\u7f6e\u3002\u5982\u679c\u8bbe\u7f6e\u4e86 RegExp \u5bf9\u8c61\u7684 Multiline \u5c5e\u6027\uff0c^ \u4e5f\u5339\u914d '\\n' \u6216 '\\r' \u4e4b\u540e\u7684\u4f4d\u7f6e\u3002 $ \u5339\u914d\u8f93\u5165\u5b57\u7b26\u4e32\u7684\u7ed3\u675f\u4f4d\u7f6e\u3002\u5982\u679c\u8bbe\u7f6e\u4e86RegExp \u5bf9\u8c61\u7684 Multiline \u5c5e\u6027\uff0c$ \u4e5f\u5339\u914d '\\n' \u6216 '\\r' \u4e4b\u524d\u7684\u4f4d\u7f6e\u3002 . \u5339\u914d\u9664 \"\\n\" \u4e4b\u5916\u7684\u4efb\u4f55\u5355\u4e2a\u5b57\u7b26\u3002\u8981\u5339\u914d\u5305\u62ec '\\n' \u5728\u5185\u7684\u4efb\u4f55\u5b57\u7b26\uff0c\u8bf7\u4f7f\u7528\u8c61 '[.\\n]' \u7684\u6a21\u5f0f\u3002 [...] \u5b57\u7b26\u96c6\u5408\u3002\u5339\u914d\u6240\u5305\u542b\u7684\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\u3002\u4f8b\u5982\uff0c '[abc]' \u53ef\u4ee5\u5339\u914d \"plain\" \u4e2d\u7684 'a'\u3002 [^...] \u8d1f\u503c\u5b57\u7b26\u96c6\u5408\u3002\u5339\u914d\u672a\u5305\u542b\u7684\u4efb\u610f\u5b57\u7b26\u3002\u4f8b\u5982\uff0c '[^abc]' \u53ef\u4ee5\u5339\u914d \"plain\" \u4e2d\u7684'p'\u3002 p1|p2|p3 \u5339\u914d p1 \u6216 p2 \u6216 p3\u3002\u4f8b\u5982\uff0c'z * \u5339\u914d\u524d\u9762\u7684\u5b50\u8868\u8fbe\u5f0f\u96f6\u6b21\u6216\u591a\u6b21\u3002\u4f8b\u5982\uff0czo* \u80fd\u5339\u914d \"z\" \u4ee5\u53ca \"zoo\"\u3002* \u7b49\u4ef7\u4e8e{0,}\u3002 + \u5339\u914d\u524d\u9762\u7684\u5b50\u8868\u8fbe\u5f0f\u4e00\u6b21\u6216\u591a\u6b21\u3002\u4f8b\u5982\uff0c'zo+' \u80fd\u5339\u914d \"zo\" \u4ee5\u53ca \"zoo\"\uff0c\u4f46\u4e0d\u80fd\u5339\u914d \"z\"\u3002+ \u7b49\u4ef7\u4e8e {1,}\u3002 {n} n \u662f\u4e00\u4e2a\u975e\u8d1f\u6574\u6570\u3002\u5339\u914d\u786e\u5b9a\u7684 n \u6b21\u3002\u4f8b\u5982\uff0c'o{2}' \u4e0d\u80fd\u5339\u914d \"Bob\" \u4e2d\u7684 'o'\uff0c\u4f46\u662f\u80fd\u5339\u914d \"food\" \u4e2d\u7684\u4e24\u4e2a o\u3002 {n,m} m \u548c n \u5747\u4e3a\u975e\u8d1f\u6574\u6570\uff0c\u5176\u4e2dn <= m\u3002\u6700\u5c11\u5339\u914d n \u6b21\u4e14\u6700\u591a\u5339\u914d m \u6b21\u3002 2. \u4f8b\u5b50 \u00b6 2.1 \u73af\u5883\u51c6\u5907 \u00b6 use leco; drop table info; create table info( name varchar(40) NOT NULL, count int ); insert into info(name,count) values(\"\u5317\u4eac\",1); insert into info(name,count) values(\"\u5357\u4eac\",2); insert into info(name,count) values(\"\u4e0a\u6d77\",3); insert into info(name,count) values(\"\u5bbf\u8fc1\",4); insert into info(name,count) values(\"okay\",5); insert into info(name,count) values(\"market\",6); insert into info(name,count) values(\"aecdada\",7); insert into info(name,count) values(\"ccmz\",8); insert into info(name,count) values(\"cccmz\",9); insert into info(name,count) values(\"ccccmz\",10); desc info; select * from info; 2.2 \u6267\u884c\u8fc7\u7a0b \u00b6 mysql> use leco; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> drop table info; Query OK, 0 rows affected (0.05 sec) mysql> create table info( -> name varchar(40) NOT NULL, -> count int -> ); Query OK, 0 rows affected (0.07 sec) mysql> insert into info(name,count) values(\"\u5317\u4eac\",1); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"\u5357\u4eac\",2); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"\u4e0a\u6d77\",3); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"\u5bbf\u8fc1\",4); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"okay\",5); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"market\",6); Query OK, 1 row affected (0.01 sec) mysql> insert into info(name,count) values(\"aecdada\",7); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"ccmz\",8); Query OK, 1 row affected (0.01 sec) mysql> insert into info(name,count) values(\"cccmz\",9); Query OK, 1 row affected (0.01 sec) mysql> insert into info(name,count) values(\"ccccmz\",10); Query OK, 1 row affected (0.02 sec) mysql> desc info; +-------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+-------+ | name | varchar(40) | NO | | NULL | | | count | int(11) | YES | | NULL | | +-------+-------------+------+-----+---------+-------+ 2 rows in set (0.00 sec) mysql> select * from info; +---------+-------+ | name | count | +---------+-------+ | \u5317\u4eac | 1 | | \u5357\u4eac | 2 | | \u4e0a\u6d77 | 3 | | \u5bbf\u8fc1 | 4 | | okay | 5 | | market | 6 | | aecdada | 7 | | ccmz | 8 | | cccmz | 9 | | ccccmz | 10 | +---------+-------+ 10 rows in set (0.00 sec) 2.3 \u4ee5\u5f00\u5934 \u00b6 \u67e5\u627ename\u5b57\u6bb5\u4e2d\u4ee5'\u5bbf'\u4e3a\u5f00\u5934\u7684\u6240\u6709\u6570\u636e mysql> SELECT name FROM info WHERE name REGEXP '^\u5bbf'; +--------+ | name | +--------+ | \u5bbf\u8fc1 | +--------+ 1 row in set (0.00 sec) 2.3 \u4ee5\u7ed3\u5c3e \u00b6 \u67e5\u627ename\u5b57\u6bb5\u4e2d\u4ee5'ay'\u4e3a\u7ed3\u5c3e\u7684\u6240\u6709\u6570\u636e mysql> SELECT name FROM info WHERE name REGEXP 'ay$'; +------+ | name | +------+ | okay | +------+ 1 row in set (0.00 sec) 2.4 \u5305\u542b \u00b6 \u67e5\u627ename\u5b57\u6bb5\u4e2d\u5305\u542b'\u4eac'\u5b57\u7b26\u4e32\u7684\u6240\u6709\u6570\u636e mysql> SELECT name FROM info WHERE name REGEXP '\u4eac'; +--------+ | name | +--------+ | \u5317\u4eac | | \u5357\u4eac | +--------+ 2 rows in set (0.00 sec) 2.5 \u6216\u8005 \u00b6 r\u8868\u793a\u5339\u914d\u5176\u4e2d\u4e4b\u4e00\uff0c\u529f\u80fd\u96f7\u540c\u4e0eselect\u8bed\u53e5\u4e2d\u7684or\u8bed\u53e5\uff0c\u591a\u4e2aor\u6761\u4ef6\u53ef\u5e76\u5165\u5355\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f mysql> SELECT name FROM info WHERE name REGEXP '^[\u4e0a]|da$'; +---------+ | name | +---------+ | \u4e0a\u6d77 | | aecdada | +---------+ 2 rows in set (0.00 sec) 2.6 + \u00b6 mysql> SELECT name FROM info WHERE name REGEXP 'c+'; +---------+ | name | +---------+ | aecdada | | ccmz | | cccmz | | ccccmz | +---------+ 4 rows in set (0.00 sec) 2.7 n \u00b6 mysql> SELECT name FROM info WHERE name REGEXP 'c{2,3}'; +--------+ | name | +--------+ | ccmz | | cccmz | | ccccmz | +--------+ 3 rows in set (0.00 sec) 2.8 n,m \u00b6 mysql> SELECT name FROM info WHERE name REGEXP 'c{3,}'; +--------+ | name | +--------+ | cccmz | | ccccmz | +--------+ 2 rows in set (0.00 sec) 2.9 * \u00b6 mysql> SELECT name FROM info WHERE name REGEXP 'cc*'; +---------+ | name | +---------+ | aecdada | | ccmz | | cccmz | | ccccmz | +---------+ 4 rows in set (0.00 sec) \u5339\u914d\u578b\u53f7\u524d\u9762\u7684c\u7684\u6b21\u6570\u662f0\u6b21\u5230\u591a\u6b21\u3002 2.10 \u8303\u56f4 \u00b6 \u96c6\u5408\u53ef\u4ee5\u7528\u6765\u5b9a\u4e49\u8981\u5339\u914d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u7b26\uff0c\u6bd4\u5982[0123456789]\uff0c\u4e3a\u4e86\u7b80\u5316\u8fd9\u79cd\u7c7b\u578b\u7684\u96c6\u5408\uff0c\u53ef\u4f7f\u7528\uff08-\uff09\u6765\u5b9a\u4e49\u4e00\u4e2a\u8303\u56f4\uff0c\u5373[0-9]\uff1b\uff08\u8303\u56f4\u4e0d\u4ec5\u4ec5\u5c40\u9650\u4e8e\u6570\u503c\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u5b57\u6bcd\u5b57\u7b26\u7b49\uff09 mysql> SELECT * from info; +---------+-------+ | name | count | +---------+-------+ | market | 6 | | aecdada | 7 | | ccmz | 8 | | cccmz | 9 | | ccccmz | 10 | +---------+-------+ 5 rows in set (0.00 sec) mysql> select * from info where count regexp '[0-8]'; +---------+-------+ | name | count | +---------+-------+ | market | 6 | | aecdada | 7 | | ccmz | 8 | | ccccmz | 10 | +---------+-------+ 4 rows in set (0.00 sec)","title":"5. \u6b63\u5219"},{"location":"mysql/mysql.regexp/#1","text":"MySQL\u53ef\u4ee5\u901a\u8fc7 LIKE ...% \u6765\u8fdb\u884c\u6a21\u7cca\u5339\u914d\u3002 MySQL \u540c\u6837\u4e5f\u652f\u6301\u5176\u4ed6\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5339\u914d\uff0c MySQL\u4e2d\u4f7f\u7528 REGEXP \u64cd\u4f5c\u7b26\u6765\u8fdb\u884c\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u3002 \u4e0b\u8868\u4e2d\u7684\u6b63\u5219\u6a21\u5f0f\u53ef\u5e94\u7528\u4e8e REGEXP \u64cd\u4f5c\u7b26\u4e2d\u3002 \u8868\u8fbe\u5f0f \u63cf\u8ff0 ^ \u5339\u914d\u8f93\u5165\u5b57\u7b26\u4e32\u7684\u5f00\u59cb\u4f4d\u7f6e\u3002\u5982\u679c\u8bbe\u7f6e\u4e86 RegExp \u5bf9\u8c61\u7684 Multiline \u5c5e\u6027\uff0c^ \u4e5f\u5339\u914d '\\n' \u6216 '\\r' \u4e4b\u540e\u7684\u4f4d\u7f6e\u3002 $ \u5339\u914d\u8f93\u5165\u5b57\u7b26\u4e32\u7684\u7ed3\u675f\u4f4d\u7f6e\u3002\u5982\u679c\u8bbe\u7f6e\u4e86RegExp \u5bf9\u8c61\u7684 Multiline \u5c5e\u6027\uff0c$ \u4e5f\u5339\u914d '\\n' \u6216 '\\r' \u4e4b\u524d\u7684\u4f4d\u7f6e\u3002 . \u5339\u914d\u9664 \"\\n\" \u4e4b\u5916\u7684\u4efb\u4f55\u5355\u4e2a\u5b57\u7b26\u3002\u8981\u5339\u914d\u5305\u62ec '\\n' \u5728\u5185\u7684\u4efb\u4f55\u5b57\u7b26\uff0c\u8bf7\u4f7f\u7528\u8c61 '[.\\n]' \u7684\u6a21\u5f0f\u3002 [...] \u5b57\u7b26\u96c6\u5408\u3002\u5339\u914d\u6240\u5305\u542b\u7684\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\u3002\u4f8b\u5982\uff0c '[abc]' \u53ef\u4ee5\u5339\u914d \"plain\" \u4e2d\u7684 'a'\u3002 [^...] \u8d1f\u503c\u5b57\u7b26\u96c6\u5408\u3002\u5339\u914d\u672a\u5305\u542b\u7684\u4efb\u610f\u5b57\u7b26\u3002\u4f8b\u5982\uff0c '[^abc]' \u53ef\u4ee5\u5339\u914d \"plain\" \u4e2d\u7684'p'\u3002 p1|p2|p3 \u5339\u914d p1 \u6216 p2 \u6216 p3\u3002\u4f8b\u5982\uff0c'z * \u5339\u914d\u524d\u9762\u7684\u5b50\u8868\u8fbe\u5f0f\u96f6\u6b21\u6216\u591a\u6b21\u3002\u4f8b\u5982\uff0czo* \u80fd\u5339\u914d \"z\" \u4ee5\u53ca \"zoo\"\u3002* \u7b49\u4ef7\u4e8e{0,}\u3002 + \u5339\u914d\u524d\u9762\u7684\u5b50\u8868\u8fbe\u5f0f\u4e00\u6b21\u6216\u591a\u6b21\u3002\u4f8b\u5982\uff0c'zo+' \u80fd\u5339\u914d \"zo\" \u4ee5\u53ca \"zoo\"\uff0c\u4f46\u4e0d\u80fd\u5339\u914d \"z\"\u3002+ \u7b49\u4ef7\u4e8e {1,}\u3002 {n} n \u662f\u4e00\u4e2a\u975e\u8d1f\u6574\u6570\u3002\u5339\u914d\u786e\u5b9a\u7684 n \u6b21\u3002\u4f8b\u5982\uff0c'o{2}' \u4e0d\u80fd\u5339\u914d \"Bob\" \u4e2d\u7684 'o'\uff0c\u4f46\u662f\u80fd\u5339\u914d \"food\" \u4e2d\u7684\u4e24\u4e2a o\u3002 {n,m} m \u548c n \u5747\u4e3a\u975e\u8d1f\u6574\u6570\uff0c\u5176\u4e2dn <= m\u3002\u6700\u5c11\u5339\u914d n \u6b21\u4e14\u6700\u591a\u5339\u914d m \u6b21\u3002","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.regexp/#2","text":"","title":"2. \u4f8b\u5b50"},{"location":"mysql/mysql.regexp/#21","text":"use leco; drop table info; create table info( name varchar(40) NOT NULL, count int ); insert into info(name,count) values(\"\u5317\u4eac\",1); insert into info(name,count) values(\"\u5357\u4eac\",2); insert into info(name,count) values(\"\u4e0a\u6d77\",3); insert into info(name,count) values(\"\u5bbf\u8fc1\",4); insert into info(name,count) values(\"okay\",5); insert into info(name,count) values(\"market\",6); insert into info(name,count) values(\"aecdada\",7); insert into info(name,count) values(\"ccmz\",8); insert into info(name,count) values(\"cccmz\",9); insert into info(name,count) values(\"ccccmz\",10); desc info; select * from info;","title":"2.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.regexp/#22","text":"mysql> use leco; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> drop table info; Query OK, 0 rows affected (0.05 sec) mysql> create table info( -> name varchar(40) NOT NULL, -> count int -> ); Query OK, 0 rows affected (0.07 sec) mysql> insert into info(name,count) values(\"\u5317\u4eac\",1); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"\u5357\u4eac\",2); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"\u4e0a\u6d77\",3); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"\u5bbf\u8fc1\",4); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"okay\",5); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"market\",6); Query OK, 1 row affected (0.01 sec) mysql> insert into info(name,count) values(\"aecdada\",7); Query OK, 1 row affected (0.02 sec) mysql> insert into info(name,count) values(\"ccmz\",8); Query OK, 1 row affected (0.01 sec) mysql> insert into info(name,count) values(\"cccmz\",9); Query OK, 1 row affected (0.01 sec) mysql> insert into info(name,count) values(\"ccccmz\",10); Query OK, 1 row affected (0.02 sec) mysql> desc info; +-------+-------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-------------+------+-----+---------+-------+ | name | varchar(40) | NO | | NULL | | | count | int(11) | YES | | NULL | | +-------+-------------+------+-----+---------+-------+ 2 rows in set (0.00 sec) mysql> select * from info; +---------+-------+ | name | count | +---------+-------+ | \u5317\u4eac | 1 | | \u5357\u4eac | 2 | | \u4e0a\u6d77 | 3 | | \u5bbf\u8fc1 | 4 | | okay | 5 | | market | 6 | | aecdada | 7 | | ccmz | 8 | | cccmz | 9 | | ccccmz | 10 | +---------+-------+ 10 rows in set (0.00 sec)","title":"2.2 \u6267\u884c\u8fc7\u7a0b"},{"location":"mysql/mysql.regexp/#23","text":"\u67e5\u627ename\u5b57\u6bb5\u4e2d\u4ee5'\u5bbf'\u4e3a\u5f00\u5934\u7684\u6240\u6709\u6570\u636e mysql> SELECT name FROM info WHERE name REGEXP '^\u5bbf'; +--------+ | name | +--------+ | \u5bbf\u8fc1 | +--------+ 1 row in set (0.00 sec)","title":"2.3 \u4ee5\u5f00\u5934"},{"location":"mysql/mysql.regexp/#23_1","text":"\u67e5\u627ename\u5b57\u6bb5\u4e2d\u4ee5'ay'\u4e3a\u7ed3\u5c3e\u7684\u6240\u6709\u6570\u636e mysql> SELECT name FROM info WHERE name REGEXP 'ay$'; +------+ | name | +------+ | okay | +------+ 1 row in set (0.00 sec)","title":"2.3 \u4ee5\u7ed3\u5c3e"},{"location":"mysql/mysql.regexp/#24","text":"\u67e5\u627ename\u5b57\u6bb5\u4e2d\u5305\u542b'\u4eac'\u5b57\u7b26\u4e32\u7684\u6240\u6709\u6570\u636e mysql> SELECT name FROM info WHERE name REGEXP '\u4eac'; +--------+ | name | +--------+ | \u5317\u4eac | | \u5357\u4eac | +--------+ 2 rows in set (0.00 sec)","title":"2.4 \u5305\u542b"},{"location":"mysql/mysql.regexp/#25","text":"r\u8868\u793a\u5339\u914d\u5176\u4e2d\u4e4b\u4e00\uff0c\u529f\u80fd\u96f7\u540c\u4e0eselect\u8bed\u53e5\u4e2d\u7684or\u8bed\u53e5\uff0c\u591a\u4e2aor\u6761\u4ef6\u53ef\u5e76\u5165\u5355\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f mysql> SELECT name FROM info WHERE name REGEXP '^[\u4e0a]|da$'; +---------+ | name | +---------+ | \u4e0a\u6d77 | | aecdada | +---------+ 2 rows in set (0.00 sec)","title":"2.5 \u6216\u8005"},{"location":"mysql/mysql.regexp/#26","text":"mysql> SELECT name FROM info WHERE name REGEXP 'c+'; +---------+ | name | +---------+ | aecdada | | ccmz | | cccmz | | ccccmz | +---------+ 4 rows in set (0.00 sec)","title":"2.6 +"},{"location":"mysql/mysql.regexp/#27-n","text":"mysql> SELECT name FROM info WHERE name REGEXP 'c{2,3}'; +--------+ | name | +--------+ | ccmz | | cccmz | | ccccmz | +--------+ 3 rows in set (0.00 sec)","title":"2.7 n"},{"location":"mysql/mysql.regexp/#28-nm","text":"mysql> SELECT name FROM info WHERE name REGEXP 'c{3,}'; +--------+ | name | +--------+ | cccmz | | ccccmz | +--------+ 2 rows in set (0.00 sec)","title":"2.8 n,m"},{"location":"mysql/mysql.regexp/#29","text":"mysql> SELECT name FROM info WHERE name REGEXP 'cc*'; +---------+ | name | +---------+ | aecdada | | ccmz | | cccmz | | ccccmz | +---------+ 4 rows in set (0.00 sec) \u5339\u914d\u578b\u53f7\u524d\u9762\u7684c\u7684\u6b21\u6570\u662f0\u6b21\u5230\u591a\u6b21\u3002","title":"2.9 *"},{"location":"mysql/mysql.regexp/#210","text":"\u96c6\u5408\u53ef\u4ee5\u7528\u6765\u5b9a\u4e49\u8981\u5339\u914d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u7b26\uff0c\u6bd4\u5982[0123456789]\uff0c\u4e3a\u4e86\u7b80\u5316\u8fd9\u79cd\u7c7b\u578b\u7684\u96c6\u5408\uff0c\u53ef\u4f7f\u7528\uff08-\uff09\u6765\u5b9a\u4e49\u4e00\u4e2a\u8303\u56f4\uff0c\u5373[0-9]\uff1b\uff08\u8303\u56f4\u4e0d\u4ec5\u4ec5\u5c40\u9650\u4e8e\u6570\u503c\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u5b57\u6bcd\u5b57\u7b26\u7b49\uff09 mysql> SELECT * from info; +---------+-------+ | name | count | +---------+-------+ | market | 6 | | aecdada | 7 | | ccmz | 8 | | cccmz | 9 | | ccccmz | 10 | +---------+-------+ 5 rows in set (0.00 sec) mysql> select * from info where count regexp '[0-8]'; +---------+-------+ | name | count | +---------+-------+ | market | 6 | | aecdada | 7 | | ccmz | 8 | | ccccmz | 10 | +---------+-------+ 4 rows in set (0.00 sec)","title":"2.10 \u8303\u56f4"},{"location":"mysql/mysql.restore_data/","text":"MySQL binlog \u6062\u590d\u6570\u636e\u5e93 1. binlog\u4ecb\u7ecd \u00b6 \u4f17\u6240\u5468\u77e5\uff0cbinlog\u65e5\u5fd7\u5bf9\u4e8emysql\u6570\u636e\u5e93\u6765\u8bf4\u662f\u5341\u5206\u91cd\u8981\u7684\u3002\u5728\u6570\u636e\u4e22\u5931\u7684\u7d27\u6025\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5f80\u5f80\u4f1a\u60f3\u5230\u7528binlog\u65e5\u5fd7\u529f\u80fd\u8fdb\u884c\u6570\u636e\u6062\u590d\uff08\u5b9a\u65f6\u5168\u5907\u4efd+binlog\u65e5\u5fd7\u6062\u590d\u589e\u91cf\u6570\u636e\u90e8\u5206\uff09\uff0c\u4e3a\u4f60\u4e00\u8def\u4fdd\u9a7e\u62a4\u822a\uff01 1.1 \u4e86\u89e3binlog \u00b6 MySQL\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7binlog\u53ef\u4ee5\u8bf4\u662fMySQL\u6700\u91cd\u8981\u7684\u65e5\u5fd7\uff0c\u5b83\u8bb0\u5f55\u4e86\u6240\u6709\u7684DDL\u548cDML\u8bed\u53e5\uff08\u9664\u4e86\u6570\u636e\u67e5\u8be2\u8bed\u53e5select\uff09\uff0c\u4ee5\u4e8b\u4ef6\u5f62\u5f0f\u8bb0\u5f55\uff0c\u8fd8\u5305\u542b\u8bed\u53e5\u6240\u6267\u884c\u7684\u6d88\u8017\u7684\u65f6\u95f4\uff0cMySQL\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u662f\u4e8b\u52a1\u5b89\u5168\u578b\u7684\u3002 1.1.1 DDL \u00b6 Data Definition Language,\u4e3b\u8981\u7684\u547d\u4ee4\u6709CREATE\u3001ALTER\u3001DROP\u7b49\uff0cDDL\u4e3b\u8981\u662f\u7528\u5728\u5b9a\u4e49\u6216\u6539\u53d8\u8868\uff08TABLE\uff09\u7684\u7ed3\u6784\uff0c\u6570\u636e\u7c7b\u578b\uff0c\u8868\u4e4b\u95f4\u7684\u94fe\u63a5\u548c\u7ea6\u675f\u7b49\u521d\u59cb\u5316\u5de5\u4f5c\u4e0a\uff0c\u4ed6\u4eec\u5927\u591a\u5728\u5efa\u7acb\u8868\u65f6\u4f7f\u7528\u3002 1.1.2 DML \u00b6 Data Manipulation Language \u6570\u636e\u64cd\u7eb5\u8bed\u8a00,\u4e3b\u8981\u7684\u547d\u4ee4\u662fSELECT\u3001UPDATE\u3001INSERT\u3001DELETE\uff0c\u5c31\u8c61\u5b83\u7684\u540d\u5b57\u4e00\u6837\uff0c\u8fd94\u6761\u547d\u4ee4\u662f\u7528\u6765\u5bf9\u6570\u636e\u5e93\u91cc\u7684\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\u7684\u8bed\u8a00 1.3 binlog\u5e38\u7528\u9009\u9879 \u00b6 --start-datetime\uff1a \u4ece\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u8bfb\u53d6\u6307\u5b9a\u7b49\u4e8e\u65f6\u95f4\u6233\u6216\u8005\u665a\u4e8e\u672c\u5730\u670d\u52a1\u5668\u7684\u65f6\u95f4 --stop-datetime\uff1a \u4ece\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u8bfb\u53d6\u6307\u5b9a\u5c0f\u4e8e\u65f6\u95f4\u6233\u6216\u8005\u7b49\u4e8e\u672c\u5730\u670d\u52a1\u5668\u7684\u65f6\u95f4 \u53d6\u503c\u548c\u4e0a\u8ff0\u4e00\u6837 --start-position\uff1a \u4ece\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u8bfb\u53d6\u6307\u5b9aposition \u4e8b\u4ef6\u4f4d\u7f6e\u4f5c\u4e3a\u5f00\u59cb\u3002 --stop-position\uff1a \u4ece\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u8bfb\u53d6\u6307\u5b9aposition \u4e8b\u4ef6\u4f4d\u7f6e\u4f5c\u4e3a\u4e8b\u4ef6\u622a\u81f3 1.4 \u4f7f\u7528\u573a\u666f \u00b6 MySQL\u4e3b\u4ece\u590d\u5236\uff1aMySQL Replication\u5728Master\u7aef\u5f00\u542fbinlog\uff0cMaster\u628a\u5b83\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4f20\u9012\u7ed9slaves\u6765\u8fbe\u5230master-slave\u6570\u636e\u4e00\u81f4\u7684\u76ee\u7684 \u6570\u636e\u6062\u590d\u4e86\uff0c\u901a\u8fc7\u4f7f\u7528mysqlbinlog\u5de5\u5177\u6765\u4f7f\u6062\u590d\u6570\u636e\u3002 1.5 binlog\u5305\u62ec\u6587\u4ef6 \u00b6 \u4e8c\u8fdb\u5236\u65e5\u5fd7\u7d22\u5f15\u6587\u4ef6\uff08\u6587\u4ef6\u540d\u540e\u7f00\u4e3a.index\uff09\u7528\u4e8e\u8bb0\u5f55\u6240\u6709\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6 \u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\uff08\u6587\u4ef6\u540d\u540e\u7f00\u4e3a.00000*\uff09\u8bb0\u5f55\u6570\u636e\u5e93\u6240\u6709\u7684DDL\u548cDML(\u9664\u4e86\u6570\u636e\u67e5\u8be2\u8bed\u53e5select)\u8bed\u53e5\u4e8b\u4ef6 1.6 \u5f00\u59cbbinlog \u00b6 \u6211\u7684\u662fubuntu\u7cfb\u7edf\uff0c\u5176\u4ed6\u7cfb\u7edf\u914d\u7f6e\u6587\u4ef6\u53ef\u80fd\u6709\u6240\u4e0d\u540c root@leco:~# grep -i log_bin /etc/mysql/mysql.conf.d/mysqld.cnf log_bin = /var/log/mysql/mysql-bin.log \u6ce8\u610f 1. mysql - bin \u662f\u65e5\u5fd7\u7684\u57fa\u672c\u540d\u6216\u524d\u7f00\u540d 2. \u6bcf\u6b21\u670d\u52a1\u5668\uff08\u6570\u636e\u5e93\uff09\u91cd\u542f\uff0c\u670d\u52a1\u5668\u4f1a\u8c03\u7528 flush logs ; \uff0c\u65b0\u521b\u5efa\u4e00\u4e2a binlog\u65e5\u5fd7 \uff01 3. \u4fee\u6539 mysql\u914d\u7f6e\u6587\u4ef6\u540e\u4e00\u5b9a\u8981\u91cd\u542f \u3002 1.7 \u67e5\u770b\u5f00\u542f \u00b6 root@leco:~# mysql -uroot -proot -e ' show variables like \"log_bin\";' mysql: [Warning] Using a password on the command line interface can be insecure. +---------------+-------+ | Variable_name | Value | +---------------+-------+ | log_bin | ON | +---------------+-------+ \u662fON\u5c31\u662f\u5f00\u59cb\u4e86bin log\u3002 2. binlog\u5e38\u7528\u547d\u4ee4 \u00b6 2.1 \u67e5\u770bbinlog\u65e5\u5fd7\u5217\u8868 \u00b6 \u67e5\u770b\u6240\u6709binlog\u65e5\u5fd7\u5217\u8868 mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 1648 | | mysql-bin.000002 | 677 | | mysql-bin.000003 | 613 | | mysql-bin.000004 | 554 | | mysql-bin.000005 | 1239 | | mysql-bin.000006 | 177 | | mysql-bin.000007 | 1749 | | mysql-bin.000008 | 154 | +------------------+-----------+ 8 rows in set (0.00 sec) 2.2 \u67e5\u770b\u6700\u65b0\u65e5\u5fd7\u60c5\u51b5 \u00b6 \u67e5\u770bmaster\u72b6\u6001\uff0c\u5373\u6700\u540e(\u6700\u65b0)\u4e00\u4e2abinlog\u65e5\u5fd7\u7684\u7f16\u53f7\u540d\u79f0\uff0c\u53ca\u5176\u6700\u540e\u4e00\u4e2a\u64cd\u4f5c\u4e8b\u4ef6pos\u7ed3\u675f\u70b9(Position)\u503c mysql> show master status; +------------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +------------------+----------+--------------+------------------+-------------------+ | mysql-bin.000008 | 154 | | | | +------------------+----------+--------------+------------------+-------------------+ 1 row in set (0.00 sec) 2.3 \u5237\u65b0\u65e5\u5fd7 \u00b6 flush\u5237\u65b0log\u65e5\u5fd7\uff0c\u81ea\u6b64\u523b\u5f00\u59cb\u4ea7\u751f\u4e00\u4e2a\u65b0\u7f16\u53f7\u7684binlog\u65e5\u5fd7\u6587\u4ef6 mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 1648 | | mysql-bin.000002 | 677 | | mysql-bin.000003 | 613 | | mysql-bin.000004 | 554 | | mysql-bin.000005 | 1239 | | mysql-bin.000006 | 177 | | mysql-bin.000007 | 1749 | | mysql-bin.000008 | 154 | +------------------+-----------+ 8 rows in set (0.00 sec) mysql> flush logs; Query OK, 0 rows affected (0.07 sec) mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 1648 | | mysql-bin.000002 | 677 | | mysql-bin.000003 | 613 | | mysql-bin.000004 | 554 | | mysql-bin.000005 | 1239 | | mysql-bin.000006 | 177 | | mysql-bin.000007 | 1749 | | mysql-bin.000008 | 201 | | mysql-bin.000009 | 154 | +------------------+-----------+ 9 rows in set (0.00 sec) \u6ce8\u610f\uff1a\u6bcf\u5f53mysqld\u670d\u52a1\u91cd\u542f\u65f6\uff0c\u4f1a\u81ea\u52a8\u6267\u884c\u6b64\u547d\u4ee4\uff0c\u5237\u65b0binlog\u65e5\u5fd7\uff1b\u5728mysqldump\u5907\u4efd\u6570\u636e\u65f6\u52a0 -F \u9009\u9879\u4e5f\u4f1a\u5237\u65b0binlog\u65e5\u5fd7\uff1b 2.4 \u6e05\u7a7a\u65e5\u5fd7 \u00b6 mysql> reset master; Query OK, 0 rows affected (0.12 sec) mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 106 | +------------------+-----------+ 1 row in set (0.00 sec) 3. \u67e5\u770bbinlog\u65e5\u5fd7\u5185\u5bb9 \u00b6 3.1 mysqbinlog \u00b6 \u4f7f\u7528mysqlbinlog\u81ea\u5e26\u67e5\u770b\u547d\u4ee4\u6cd5\uff1a \u2192binlog\u662f\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u666e\u901a\u6587\u4ef6\u67e5\u770b\u5668cat\u3001more\u3001vim\u7b49\u90fd\u65e0\u6cd5\u6253\u5f00\uff0c\u5fc5\u987b\u4f7f\u7528\u81ea\u5e26\u7684mysqlbinlog\u547d\u4ee4\u67e5\u770b \u2192binlog\u65e5\u5fd7\u4e0e\u6570\u636e\u5e93\u6587\u4ef6\u5728\u540c\u76ee\u5f55\u4e2d \u2192\u5728MySQL5.5\u4ee5\u4e0b\u7248\u672c\u4f7f\u7528mysqlbinlog\u547d\u4ee4\u65f6\u5982\u679c\u62a5\u9519\uff0c\u5c31\u52a0\u4e0a \"--no-defaults\" \u9009\u9879 root@leco:~# cd /var/log/mysql/ root@leco:/var/log/mysql# ls error.log error.log.2.gz error.log.4.gz error.log.6.gz mysql-bin.000001 mysql-bin.000003 mysql-bin.000005 mysql-bin.000007 mysql-bin.000009 error.log.1.gz error.log.3.gz error.log.5.gz error.log.7.gz mysql-bin.000002 mysql-bin.000004 mysql-bin.000006 mysql-bin.000008 mysql-bin.index root@leco:/var/log/mysql# mysqlbinlog -v mysql-bin.000009 /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/; /*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/; DELIMITER /*!*/; # at 4 #190301 15:50:43 server id 1 end_log_pos 123 CRC32 0x19c50202 Start: binlog v 4, server v 5.7.25-0ubuntu0.16.04.2-log created 190301 15:50:43 # Warning: this binlog is either in use or was not closed properly. BINLOG ' U+R4XA8BAAAAdwAAAHsAAAABAAQANS43LjI1LTB1YnVudHUwLjE2LjA0LjItbG9nAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAAXwAEGggAAAAICAgCAAAACgoKKioAEjQA AQICxRk= '/*!*/; # at 123 #190301 15:50:43 server id 1 end_log_pos 154 CRC32 0x91c319ef Previous-GTIDs # [empty] SET @@SESSION.GTID_NEXT= 'AUTOMATIC' /* added by mysqlbinlog */ /*!*/; DELIMITER ; # End of log file /*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/; /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/; \u89e3\u91ca 1. server id 1 \u662f mysql\u7684id \uff0c\u672c\u673a\u662f 1 \u6240\u6709\u663e\u793a 1 2. 190301 15 : 50 : 43 \u6267\u884c\u65f6\u95f4\u3002 3. end_log_pos 154 sql\u7ed3\u675f\u7684pos\u8282\u70b9 3.2 \u53c2\u6570\u67e5\u8be2 \u00b6 \u4e0a\u9762\u8fd9\u79cd\u529e\u6cd5\u8bfb\u53d6\u51fabinlog\u65e5\u5fd7\u7684\u5168\u6587\u5185\u5bb9\u6bd4\u8f83\u591a\uff0c\u4e0d\u5bb9\u6613\u5206\u8fa8\u67e5\u770b\u5230pos\u70b9\u4fe1\u606f \u4e0b\u9762\u4ecb\u7ecd\u4e00\u79cd\u66f4\u4e3a\u65b9\u4fbf\u7684\u67e5\u8be2\u547d\u4ee4\uff1a show binlog events [IN 'log_name'] [FROM pos] [LIMIT [offset,] row_count]; \u89e3\u91ca 1. IN 'log_name' \uff1a \u6307\u5b9a\u8981\u67e5\u8be2\u7684 binlog\u6587\u4ef6\u540d ( \u4e0d\u6307\u5b9a\u5c31\u662f\u7b2c\u4e00\u4e2a binlog\u6587\u4ef6 ) 2. FROM pos \uff1a \u6307\u5b9a\u4ece\u54ea\u4e2a pos\u8d77\u59cb\u70b9\u5f00\u59cb\u67e5\u8d77 ( \u4e0d\u6307\u5b9a\u5c31\u662f\u4ece\u6574\u4e2a\u6587\u4ef6\u9996\u4e2a pos\u70b9\u5f00\u59cb\u7b97 ) 3. LIMIT [ offset ,] \uff1a\u504f\u79fb\u91cf ( \u4e0d\u6307\u5b9a\u5c31\u662f 0 ) 4. row_count \uff1a \u67e5\u8be2\u603b\u6761\u6570 ( \u4e0d\u6307\u5b9a\u5c31\u662f\u6240\u6709\u884c ) mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 1648 | | mysql-bin.000002 | 677 | | mysql-bin.000003 | 613 | | mysql-bin.000004 | 554 | | mysql-bin.000005 | 1239 | | mysql-bin.000006 | 177 | | mysql-bin.000007 | 1749 | | mysql-bin.000008 | 201 | | mysql-bin.000009 | 154 | +------------------+-----------+ 9 rows in set (0.00 sec) mysql> show binlog events in \"mysql-bin.000009\"; +------------------+-----+----------------+-----------+-------------+--------------------------------------------------------+ | Log_name | Pos | Event_type | Server_id | End_log_pos | Info | +------------------+-----+----------------+-----------+-------------+--------------------------------------------------------+ | mysql-bin.000009 | 4 | Format_desc | 1 | 123 | Server ver: 5.7.25-0ubuntu0.16.04.2-log, Binlog ver: 4 | | mysql-bin.000009 | 123 | Previous_gtids | 1 | 154 | | +------------------+-----+----------------+-----------+-------------+--------------------------------------------------------+ 2 rows in set (0.01 sec) mysql> show binlog events in \"mysql-bin.000009\"\\G; *************************** 1. row *************************** Log_name: mysql-bin.000009 Pos: 4 Event_type: Format_desc Server_id: 1 End_log_pos: 123 Info: Server ver: 5.7.25-0ubuntu0.16.04.2-log, Binlog ver: 4 *************************** 2. row *************************** Log_name: mysql-bin.000009 Pos: 123 Event_type: Previous_gtids Server_id: 1 End_log_pos: 154 Info: 2 rows in set (0.00 sec) ERROR: No query specified mysql> show binlog events in \"mysql-bin.000007\"\\G; *************************** 1. row *************************** Log_name: mysql-bin.000007 Pos: 4 Event_type: Format_desc Server_id: 1 End_log_pos: 123 Info: Server ver: 5.7.25-0ubuntu0.16.04.2-log, Binlog ver: 4 *************************** 2. row *************************** Log_name: mysql-bin.000007 Pos: 123 Event_type: Previous_gtids Server_id: 1 End_log_pos: 154 Info: *************************** 3. row *************************** Log_name: mysql-bin.000007 Pos: 154 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 219 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 4. row *************************** Log_name: mysql-bin.000007 Pos: 219 Event_type: Query Server_id: 1 End_log_pos: 298 Info: BEGIN *************************** 5. row *************************** Log_name: mysql-bin.000007 Pos: 298 Event_type: Rows_query Server_id: 1 End_log_pos: 389 Info: # insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88) *************************** 6. row *************************** Log_name: mysql-bin.000007 Pos: 389 Event_type: Table_map Server_id: 1 End_log_pos: 442 Info: table_id: 109 (summer.cmz) *************************** 7. row *************************** Log_name: mysql-bin.000007 Pos: 442 Event_type: Write_rows Server_id: 1 End_log_pos: 510 Info: table_id: 109 flags: STMT_END_F *************************** 8. row *************************** Log_name: mysql-bin.000007 Pos: 510 Event_type: Xid Server_id: 1 End_log_pos: 541 Info: COMMIT /* xid=15 */ *************************** 9. row *************************** Log_name: mysql-bin.000007 Pos: 541 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 606 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 10. row *************************** Log_name: mysql-bin.000007 Pos: 606 Event_type: Query Server_id: 1 End_log_pos: 685 Info: BEGIN *************************** 11. row *************************** Log_name: mysql-bin.000007 Pos: 685 Event_type: Rows_query Server_id: 1 End_log_pos: 776 Info: # insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88) *************************** 12. row *************************** Log_name: mysql-bin.000007 Pos: 776 Event_type: Table_map Server_id: 1 End_log_pos: 829 Info: table_id: 109 (summer.cmz) *************************** 13. row *************************** Log_name: mysql-bin.000007 Pos: 829 Event_type: Write_rows Server_id: 1 End_log_pos: 897 Info: table_id: 109 flags: STMT_END_F *************************** 14. row *************************** Log_name: mysql-bin.000007 Pos: 897 Event_type: Xid Server_id: 1 End_log_pos: 928 Info: COMMIT /* xid=16 */ *************************** 15. row *************************** Log_name: mysql-bin.000007 Pos: 928 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 993 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 16. row *************************** Log_name: mysql-bin.000007 Pos: 993 Event_type: Query Server_id: 1 End_log_pos: 1072 Info: BEGIN *************************** 17. row *************************** Log_name: mysql-bin.000007 Pos: 1072 Event_type: Rows_query Server_id: 1 End_log_pos: 1163 Info: # insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88) *************************** 18. row *************************** Log_name: mysql-bin.000007 Pos: 1163 Event_type: Table_map Server_id: 1 End_log_pos: 1216 Info: table_id: 109 (summer.cmz) *************************** 19. row *************************** Log_name: mysql-bin.000007 Pos: 1216 Event_type: Write_rows Server_id: 1 End_log_pos: 1284 Info: table_id: 109 flags: STMT_END_F *************************** 20. row *************************** Log_name: mysql-bin.000007 Pos: 1284 Event_type: Xid Server_id: 1 End_log_pos: 1315 Info: COMMIT /* xid=17 */ *************************** 21. row *************************** Log_name: mysql-bin.000007 Pos: 1315 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 1380 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 22. row *************************** Log_name: mysql-bin.000007 Pos: 1380 Event_type: Query Server_id: 1 End_log_pos: 1459 Info: BEGIN *************************** 23. row *************************** Log_name: mysql-bin.000007 Pos: 1459 Event_type: Rows_query Server_id: 1 End_log_pos: 1550 Info: # insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88) *************************** 24. row *************************** Log_name: mysql-bin.000007 Pos: 1550 Event_type: Table_map Server_id: 1 End_log_pos: 1603 Info: table_id: 109 (summer.cmz) *************************** 25. row *************************** Log_name: mysql-bin.000007 Pos: 1603 Event_type: Write_rows Server_id: 1 End_log_pos: 1671 Info: table_id: 109 flags: STMT_END_F *************************** 26. row *************************** Log_name: mysql-bin.000007 Pos: 1671 Event_type: Xid Server_id: 1 End_log_pos: 1702 Info: COMMIT /* xid=18 */ *************************** 27. row *************************** Log_name: mysql-bin.000007 Pos: 1702 Event_type: Rotate Server_id: 1 End_log_pos: 1749 Info: mysql-bin.000008;pos=4 27 rows in set (0.00 sec) ERROR: No query specified \u4e0a\u9762\u8fd9\u6761\u8bed\u53e5\u53ef\u4ee5\u5c06\u6307\u5b9a\u7684binlog\u65e5\u5fd7\u6587\u4ef6\uff0c\u5206\u6210\u6709\u6548\u4e8b\u4ef6\u884c\u7684\u65b9\u5f0f\u8fd4\u56de\uff0c\u5e76\u53ef\u4f7f\u7528limit\u6307\u5b9apos\u70b9\u7684\u8d77\u59cb\u504f\u79fb\uff0c\u67e5\u8be2\u6761\u6570\uff01 \u5176\u4ed6\u67e5\u8be2 a\uff09\u67e5\u8be2\u7b2c\u4e00\u4e2a(\u6700\u65e9)\u7684binlog\u65e5\u5fd7\uff1a mysql> show binlog events\\G; b\uff09\u6307\u5b9a\u67e5\u8be2 mysql-bin.000002\u8fd9\u4e2a\u6587\u4ef6\uff1a mysql> show binlog events in 'mysql-bin.000002'\\G; c\uff09\u6307\u5b9a\u67e5\u8be2 mysql-bin.000002\u8fd9\u4e2a\u6587\u4ef6\uff0c\u4ecepos\u70b9:624\u5f00\u59cb\u67e5\u8d77\uff1a mysql> show binlog events in 'mysql-bin.000002' from 624\\G; d\uff09\u6307\u5b9a\u67e5\u8be2 mysql-bin.000002\u8fd9\u4e2a\u6587\u4ef6\uff0c\u4ecepos\u70b9:624\u5f00\u59cb\u67e5\u8d77\uff0c\u67e5\u8be210\u6761\uff08\u537310\u6761\u8bed\u53e5\uff09 mysql> show binlog events in 'mysql-bin.000002' from 624 limit 10\\G; e\uff09\u6307\u5b9a\u67e5\u8be2 mysql-bin.000002\u8fd9\u4e2a\u6587\u4ef6\uff0c\u4ecepos\u70b9:624\u5f00\u59cb\u67e5\u8d77\uff0c\u504f\u79fb2\u884c\uff08\u5373\u4e2d\u95f4\u8df3\u8fc72\u4e2a\uff09\uff0c\u67e5\u8be210\u6761 mysql> show binlog events in 'mysql-bin.000002' from 624 limit 2,10\\G; 4. binlog\u6062\u590d\u6570\u636e \u00b6 4.1 \u73af\u5883\u51c6\u5907 \u00b6 drop database summer; create database summer charset utf8; use summer; drop table cmz; create table cmz( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into cmz(name,age,score) values(\"cmz1\",18,88); insert into cmz(name,age,score) values(\"cmz2\",28,88); insert into cmz(name,age,score) values(\"cmz3\",38,88); insert into cmz(name,age,score) values(\"cmz4\",48,88); select * from cmz; \u6267\u884c\u8fc7\u7a0b mysql> drop database summer; ERROR 1008 (HY000): Can't drop database 'summer'; database doesn't exist mysql> create database summer charset utf8; Query OK, 1 row affected (0.00 sec) mysql> use summer; Database changed mysql> drop table cmz; ERROR 1051 (42S02): Unknown table 'summer.cmz' mysql> create table cmz( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.08 sec) mysql> mysql> insert into cmz(name,age,score) values(\"cmz1\",18,88); Query OK, 1 row affected (0.01 sec) mysql> insert into cmz(name,age,score) values(\"cmz2\",28,88); Query OK, 1 row affected (0.02 sec) mysql> insert into cmz(name,age,score) values(\"cmz3\",38,88); Query OK, 1 row affected (0.03 sec) mysql> insert into cmz(name,age,score) values(\"cmz4\",48,88); Query OK, 1 row affected (0.01 sec) mysql> mysql> select * from cmz; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | cmz1 | 18 | 88 | | 3 | cmz2 | 28 | 88 | | 5 | cmz3 | 38 | 88 | | 7 | cmz4 | 48 | 88 | +----+------+-----+-------+ 4 rows in set (0.00 sec) 5 \u573a\u666f\u6a21\u62df \u00b6 5.1 \u5168\u91cf\u5907\u4efd \u00b6 \u5047\u8bbe\u6bcf\u5929\u96f6\u70b9\u5168\u91cf\u5907\u4efd\u4e00\u6b21\u3002 \u53c2\u6570\u8bf4\u660e 1. - B \uff1a\u6307\u5b9a\u6570\u636e\u5e93 2. - F \uff1a\u5237\u65b0\u65e5\u5fd7 3. - R \uff1a\u5907\u4efd\u5b58\u50a8\u8fc7\u7a0b\u7b49 4. - x \uff1a\u9501\u8868 5. -- master - data \uff1a\u5728\u5907\u4efd\u8bed\u53e5\u91cc\u6dfb\u52a0 CHANGE MASTER\u8bed\u53e5\u4ee5\u53cabinlog\u6587\u4ef6\u53ca\u4f4d\u7f6e\u70b9\u4fe1\u606f \u5f85\u5230\u6570\u636e\u5e93\u5907\u4efd\u5b8c\u6210\uff0c\u5c31\u4e0d\u7528\u62c5\u5fc3\u6570\u636e\u4e22\u5931\u4e86\uff0c\u56e0\u4e3a\u6709\u5b8c\u5168\u5907\u4efd\u6570\u636e\u5728\uff01\uff01 \u7531\u4e8e\u4e0a\u9762\u5728\u5168\u5907\u4efd\u7684\u65f6\u5019\u4f7f\u7528\u4e86-F\u9009\u9879\uff0c\u90a3\u4e48\u5f53\u6570\u636e\u5907\u4efd\u64cd\u4f5c\u521a\u5f00\u59cb\u7684\u65f6\u5019\u7cfb\u7edf\u5c31\u4f1a\u81ea\u52a8\u5237\u65b0log\uff0c\u8fd9\u6837\u5c31\u4f1a\u81ea\u52a8\u4ea7\u751f \u4e00\u4e2a\u65b0\u7684binlog\u65e5\u5fd7\uff0c\u8fd9\u4e2a\u65b0\u7684binlog\u65e5\u5fd7\u5c31\u4f1a\u7528\u6765\u8bb0\u5f55\u5907\u4efd\u4e4b\u540e\u7684\u6570\u636e\u5e93\u201c\u589e\u5220\u6539\u201d\u64cd\u4f5c \u67e5\u770b\u4e00\u4e0b\uff1a root@leco:~# mysql -uroot -proot -e ' show master status;' mysql: [Warning] Using a password on the command line interface can be insecure. +------------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +------------------+----------+--------------+------------------+-------------------+ | mysql-bin.000013 | 154 | | | | +------------------+----------+--------------+------------------+-------------------+ \u4e5f\u5c31\u662f\u8bf4\uff0c mysql-bin.000013 \u662f\u7528\u6765\u8bb0\u5f550\u70b9\u4e4b\u540e\u5bf9\u6570\u636e\u5e93\u7684\u6240\u6709\u201c\u589e\u5220\u6539\u201d\u64cd\u4f5c\u3002 5.2 \u5f00\u5de5 \u00b6 \u65e9\u4e0a\u5f00\u59cb\uff0c\u7531\u4e8e\u4e1a\u52a1\u7684\u9700\u6c42\u4f1a\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u5404\u79cd\u201c\u589e\u5220\u6539\u201d\u64cd\u4f5c\u3002\u6bd4\u5982\u6211\u4eec\u5728cmz\u8868\u4e2d\u505a\u4e86\u589e\u5220\u6539\u67e5\u64cd\u4f5c\u3002 \u5feb\u901f\u547d\u4ee4 insert into cmz(name,age,score) values(\"cmz5\",58,88); insert into cmz(name,age,score) values(\"cmz6\",68,88); update cmz set age=100 where name='cmz1'; update cmz set age=200 where name='cmz2'; \u64cd\u4f5c\u8fc7\u7a0b mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +------------------+ | Tables_in_summer | +------------------+ | cmz | +------------------+ 1 row in set (0.00 sec) mysql> select * from cmz; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | cmz1 | 18 | 88 | | 3 | cmz2 | 28 | 88 | | 5 | cmz3 | 38 | 88 | | 7 | cmz4 | 48 | 88 | +----+------+-----+-------+ 4 rows in set (0.00 sec) mysql> insert into cmz(name,age,score) values(\"cmz5\",58,88); Query OK, 1 row affected (0.01 sec) mysql> insert into cmz(name,age,score) values(\"cmz6\",68,88); Query OK, 1 row affected (0.01 sec) mysql> select * from cmz; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | cmz1 | 18 | 88 | | 3 | cmz2 | 28 | 88 | | 5 | cmz3 | 38 | 88 | | 7 | cmz4 | 48 | 88 | | 9 | cmz5 | 58 | 88 | | 11 | cmz6 | 68 | 88 | +----+------+-----+-------+ 6 rows in set (0.00 sec) \u63a5\u7740\u6709\u53c8\u64cd\u4f5c\u3002 mysql> select * from cmz; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | cmz1 | 18 | 88 | | 3 | cmz2 | 28 | 88 | | 5 | cmz3 | 38 | 88 | | 7 | cmz4 | 48 | 88 | | 9 | aa | 1 | 1 | | 11 | bb | 1 | 1 | | 13 | cc | 1 | 1 | | 15 | dd | 1 | 1 | +----+------+-----+-------+ 8 rows in set (0.00 sec) mysql> update cmz set age=100 where name='cmz1'; Query OK, 1 row affected (0.01 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> update cmz set age=200 where name='cmz2'; Query OK, 1 row affected (0.01 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> select * from cmz; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | cmz1 | 100 | 88 | | 3 | cmz2 | 200 | 88 | | 5 | cmz3 | 38 | 88 | | 7 | cmz4 | 48 | 88 | | 9 | cmz5 | 58 | 88 | | 11 | cmz6 | 68 | 88 | +----+------+-----+-------+ 6 rows in set (0.00 sec) \u4ee5\u4e0a\u4e5f\u5c31\u662f\u6700\u65b0\u7684\u6570\u636e\uff0c\u8fd9\u4e2a\u65f6\u95f4\u70b9\u3002\u67d0\u4e2a\u4eba\u624b\u8d31\u3002\u5220\u9664\u4e86\u8fd9\u4e2a\u8868\u3002 mysql> show tables; +------------------+ | Tables_in_summer | +------------------+ | cmz | +------------------+ 1 row in set (0.00 sec) mysql> drop table cmz; Query OK, 0 rows affected (0.05 sec) mysql> show tables; Empty set (0.00 sec) \u6b64\u65f6\u6765\u627e\u4f60\u3002\u95ee\u4f60\u600e\u4e48\u529e\uff0c\u6b64\u65f6\u4f60\u4e0d\u8981\u60ca\u614c\u3002\u559d\u676f\u6c34\u538b\u538b\u60ca\u3002\u6211\u8349\uff0c\u6211\u8be5\u4e0a\u573a\u4e86\u3002 \u6b64\u65f6\u4f60\u522b\u624b\u6296\uff0c\u5148\u4ed4\u7ec6\u67e5\u770b\u6700\u540e\u4e00\u4e2abinlog\u65e5\u5fd7\uff0c\u5e76\u8bb0\u5f55\u4e0b\u5173\u952e\u7684pos\u70b9\uff0c\u5230\u5e95\u662f\u54ea\u4e2apos\u70b9\u7684\u64cd\u4f5c\u5bfc\u81f4\u4e86\u6570\u636e\u5e93\u7684\u7834\u574f(\u901a\u5e38\u5728\u6700\u540e\u51e0\u6b65)\uff1b\u5148\u5907\u4efd\u4e00\u4e0b\u6700\u540e\u4e00\u4e2abinlog\u65e5\u5fd7\u6587\u4ef6\uff1a root@leco:~# cd /var/log/mysql/ root@leco:/var/log/mysql# ll \u603b\u7528\u91cf 124 drwxr-x--- 2 mysql adm 4096 3\u6708 1 17:21 ./ drwxrwxr-x 31 root syslog 4096 3\u6708 1 07:35 ../ -rw-r----- 1 mysql adm 9428 3\u6708 1 14:26 error.log -rw-r----- 1 mysql adm 6604 3\u6708 1 02:00 error.log.1.gz -rw-r----- 1 mysql adm 2902 2\u6708 27 09:09 error.log.2.gz -rw-r----- 1 mysql adm 4906 2\u6708 26 18:08 error.log.3.gz -rw-r----- 1 mysql adm 1460 2\u6708 25 09:52 error.log.4.gz -rw-r----- 1 mysql adm 324 2\u6708 24 20:01 error.log.5.gz -rw-r----- 1 mysql adm 20 2\u6708 23 07:35 error.log.6.gz -rw-r----- 1 mysql adm 20 2\u6708 22 07:35 error.log.7.gz -rw-r----- 1 mysql mysql 1648 3\u6708 1 10:55 mysql-bin.000001 -rw-r----- 1 mysql mysql 677 3\u6708 1 10:56 mysql-bin.000002 -rw-r----- 1 mysql mysql 613 3\u6708 1 11:04 mysql-bin.000003 -rw-r----- 1 mysql mysql 554 3\u6708 1 14:23 mysql-bin.000004 -rw-r----- 1 mysql mysql 1239 3\u6708 1 14:25 mysql-bin.000005 -rw-r----- 1 mysql mysql 177 3\u6708 1 14:26 mysql-bin.000006 -rw-r----- 1 mysql mysql 1749 3\u6708 1 14:26 mysql-bin.000007 -rw-r----- 1 mysql mysql 201 3\u6708 1 15:50 mysql-bin.000008 -rw-r----- 1 mysql mysql 2246 3\u6708 1 16:12 mysql-bin.000009 -rw-r----- 1 mysql mysql 10105 3\u6708 1 17:09 mysql-bin.000010 -rw-r----- 1 mysql mysql 1105 3\u6708 1 17:14 mysql-bin.000011 -rw-r----- 1 mysql mysql 7882 3\u6708 1 17:21 mysql-bin.000012 -rw-r----- 1 mysql mysql 1786 3\u6708 1 17:25 mysql-bin.000013 -rw-r----- 1 mysql mysql 416 3\u6708 1 17:21 mysql-bin.index root@leco:/var/log/mysql# \u63a5\u7740\u6267\u884c\u4e00\u6b21\u5237\u65b0\u65e5\u5fd7\u7d22\u5f15\u64cd\u4f5c\uff0c\u91cd\u65b0\u5f00\u59cb\u65b0\u7684binlog\u65e5\u5fd7\u8bb0\u5f55\u6587\u4ef6\u3002\u6309\u7406\u8bf4mysql-bin.0000013\uff0c\u8fd9\u4e2a\u6587\u4ef6\u4e0d\u4f1a\u518d\u6709\u540e\u7eed\u5199\u5165\u4e86\uff0c\u56e0\u4e3a\u4fbf\u4e8e\u6211\u4eec\u5206\u6790\u539f\u56e0\u53ca\u67e5\u627eops\u8282\u70b9\uff0c\u4ee5\u540e\u6240\u6709\u6570\u636e\u5e93\u64cd\u4f5c\u90fd\u4f1a\u5199\u5165\u5230\u4e0b\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\u3002 mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 1648 | | mysql-bin.000002 | 677 | | mysql-bin.000003 | 613 | | mysql-bin.000004 | 554 | | mysql-bin.000005 | 1239 | | mysql-bin.000006 | 177 | | mysql-bin.000007 | 1749 | | mysql-bin.000008 | 201 | | mysql-bin.000009 | 2246 | | mysql-bin.000010 | 10105 | | mysql-bin.000011 | 1105 | | mysql-bin.000012 | 7882 | | mysql-bin.000013 | 1786 | +------------------+-----------+ 13 rows in set (0.00 sec) mysql> flush logs; Query OK, 0 rows affected (0.07 sec) mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 1648 | | mysql-bin.000002 | 677 | | mysql-bin.000003 | 613 | | mysql-bin.000004 | 554 | | mysql-bin.000005 | 1239 | | mysql-bin.000006 | 177 | | mysql-bin.000007 | 1749 | | mysql-bin.000008 | 201 | | mysql-bin.000009 | 2246 | | mysql-bin.000010 | 10105 | | mysql-bin.000011 | 1105 | | mysql-bin.000012 | 7882 | | mysql-bin.000013 | 1833 | | mysql-bin.000014 | 154 | +------------------+-----------+ 14 rows in set (0.00 sec) \u63a5\u4e0b\u6765\uff0c\u8bfb\u53d6binlog\u65e5\u5fd7\uff0c\u5206\u6790\u95ee\u9898\u3002\u767b\u5f55\u670d\u52a1\u5668\uff0c\u5e76\u67e5\u770b(\u63a8\u8350\u6b64\u79cd\u65b9\u6cd5) mysql> show binlog events in 'mysql-bin.000013'\\G; *************************** 1. row *************************** Log_name: mysql-bin.000013 Pos: 4 Event_type: Format_desc Server_id: 1 End_log_pos: 123 Info: Server ver: 5.7.25-0ubuntu0.16.04.2-log, Binlog ver: 4 *************************** 2. row *************************** Log_name: mysql-bin.000013 Pos: 123 Event_type: Previous_gtids Server_id: 1 End_log_pos: 154 Info: *************************** 3. row *************************** Log_name: mysql-bin.000013 Pos: 154 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 219 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 4. row *************************** Log_name: mysql-bin.000013 Pos: 219 Event_type: Query Server_id: 1 End_log_pos: 298 Info: BEGIN *************************** 5. row *************************** Log_name: mysql-bin.000013 Pos: 298 Event_type: Rows_query Server_id: 1 End_log_pos: 374 Info: # insert into cmz(name,age,score) values(\"cmz5\",58,88) *************************** 6. row *************************** Log_name: mysql-bin.000013 Pos: 374 Event_type: Table_map Server_id: 1 End_log_pos: 427 Info: table_id: 133 (summer.cmz) *************************** 7. row *************************** Log_name: mysql-bin.000013 Pos: 427 Event_type: Write_rows Server_id: 1 End_log_pos: 480 Info: table_id: 133 flags: STMT_END_F *************************** 8. row *************************** Log_name: mysql-bin.000013 Pos: 480 Event_type: Xid Server_id: 1 End_log_pos: 511 Info: COMMIT /* xid=516 */ *************************** 9. row *************************** Log_name: mysql-bin.000013 Pos: 511 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 576 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 10. row *************************** Log_name: mysql-bin.000013 Pos: 576 Event_type: Query Server_id: 1 End_log_pos: 655 Info: BEGIN *************************** 11. row *************************** Log_name: mysql-bin.000013 Pos: 655 Event_type: Rows_query Server_id: 1 End_log_pos: 731 Info: # insert into cmz(name,age,score) values(\"cmz6\",68,88) *************************** 12. row *************************** Log_name: mysql-bin.000013 Pos: 731 Event_type: Table_map Server_id: 1 End_log_pos: 784 Info: table_id: 133 (summer.cmz) *************************** 13. row *************************** Log_name: mysql-bin.000013 Pos: 784 Event_type: Write_rows Server_id: 1 End_log_pos: 837 Info: table_id: 133 flags: STMT_END_F *************************** 14. row *************************** Log_name: mysql-bin.000013 Pos: 837 Event_type: Xid Server_id: 1 End_log_pos: 868 Info: COMMIT /* xid=517 */ *************************** 15. row *************************** Log_name: mysql-bin.000013 Pos: 868 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 933 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 16. row *************************** Log_name: mysql-bin.000013 Pos: 933 Event_type: Query Server_id: 1 End_log_pos: 1012 Info: BEGIN *************************** 17. row *************************** Log_name: mysql-bin.000013 Pos: 1012 Event_type: Rows_query Server_id: 1 End_log_pos: 1076 Info: # update cmz set age=100 where name='cmz1' *************************** 18. row *************************** Log_name: mysql-bin.000013 Pos: 1076 Event_type: Table_map Server_id: 1 End_log_pos: 1129 Info: table_id: 133 (summer.cmz) *************************** 19. row *************************** Log_name: mysql-bin.000013 Pos: 1129 Event_type: Update_rows Server_id: 1 End_log_pos: 1201 Info: table_id: 133 flags: STMT_END_F *************************** 20. row *************************** Log_name: mysql-bin.000013 Pos: 1201 Event_type: Xid Server_id: 1 End_log_pos: 1232 Info: COMMIT /* xid=520 */ *************************** 21. row *************************** Log_name: mysql-bin.000013 Pos: 1232 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 1297 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 22. row *************************** Log_name: mysql-bin.000013 Pos: 1297 Event_type: Query Server_id: 1 End_log_pos: 1376 Info: BEGIN *************************** 23. row *************************** Log_name: mysql-bin.000013 Pos: 1376 Event_type: Rows_query Server_id: 1 End_log_pos: 1440 Info: # update cmz set age=200 where name='cmz2' *************************** 24. row *************************** Log_name: mysql-bin.000013 Pos: 1440 Event_type: Table_map Server_id: 1 End_log_pos: 1493 Info: table_id: 133 (summer.cmz) *************************** 25. row *************************** Log_name: mysql-bin.000013 Pos: 1493 Event_type: Update_rows Server_id: 1 End_log_pos: 1565 Info: table_id: 133 flags: STMT_END_F *************************** 26. row *************************** Log_name: mysql-bin.000013 Pos: 1565 Event_type: Xid Server_id: 1 End_log_pos: 1596 Info: COMMIT /* xid=521 */ *************************** 27. row *************************** Log_name: mysql-bin.000013 Pos: 1596 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 1661 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 28. row *************************** Log_name: mysql-bin.000013 Pos: 1661 Event_type: Query Server_id: 1 End_log_pos: 1786 Info: use `summer`; DROP TABLE `cmz` /* generated by server */ *************************** 29. row *************************** Log_name: mysql-bin.000013 Pos: 1786 Event_type: Rotate Server_id: 1 End_log_pos: 1833 Info: mysql-bin.000014;pos=4 29 rows in set (0.00 sec) ERROR: No query specified \u901a\u8fc7\u5206\u6790\uff0c\u9020\u6210\u6570\u636e\u5e93\u7834\u574f\u7684pos\u70b9\u533a\u95f4\u662f\u4ecb\u4e8e 1661--1786 \u4e4b\u95f4\uff08\u8fd9\u662f\u6309\u7167\u65e5\u5fd7\u533a\u95f4\u7684pos\u8282\u70b9\u7b97\u7684\uff09\uff0c\u56e0\u4e3a\u5728\u4e0a\u9762\u7684binlog\u65e5\u5fd7\u770b\u51fa\u572828 row\u770b\u5230\u6267\u884c\u4e86drop\u6307\u4ee4\uff0c\u53ea\u8981\u6062\u590d\u52301661\u4e4b\u524d\u5c31\u53ef\u3002 5.3 \u5f00\u59cb\u6062\u590d \u00b6 5.3.1 \u6062\u590d\u4e4b\u524d0\u70b9\u5907\u4efd \u00b6 \u5feb\u901f\u547d\u4ee4 cd /mysqldataback/ gzip -d summer_2019-03-01.sql.gz mysql -uroot -proot -v < summer_2019-03-01.sql \u64cd\u4f5c\u8fc7\u7a0b root@manage01:/var/log/mysql# cd /mysqldataback/ root@manage01:/mysqldataback# ls mysql-bin.000004 summer_2019-03-01.sql.gz root@manage01:/mysqldataback# gzip -d summer_2019-03-01.sql.gz root@manage01:/mysqldataback# ls mysql-bin.000004 summer_2019-03-01.sql root@manage01:/mysqldataback# mysql -uroot -proot -v < summer_2019-03-01.sql mysql: [Warning] Using a password on the command line interface can be insecure. -------------- /*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */ -------------- -------------- /*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */ -------------- -------------- /*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */ -------------- -------------- /*!40101 SET NAMES utf8 */ -------------- -------------- /*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */ -------------- -------------- /*!40103 SET TIME_ZONE='+00:00' */ -------------- -------------- /*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */ -------------- -------------- /*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */ -------------- -------------- /*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */ -------------- -------------- /*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */ -------------- -------------- CREATE DATABASE /*!32312 IF NOT EXISTS*/ `summer` /*!40100 DEFAULT CHARACTER SET utf8 */ -------------- -------------- DROP TABLE IF EXISTS `cmz` -------------- -------------- /*!40101 SET @saved_cs_client = @@character_set_client */ -------------- -------------- /*!40101 SET character_set_client = utf8 */ -------------- -------------- CREATE TABLE `cmz` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(20) DEFAULT NULL, `age` int(11) NOT NULL, `score` int(11) NOT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8 -------------- -------------- /*!40101 SET character_set_client = @saved_cs_client */ -------------- -------------- LOCK TABLES `cmz` WRITE -------------- -------------- /*!40000 ALTER TABLE `cmz` DISABLE KEYS */ -------------- -------------- INSERT INTO `cmz` VALUES (1,'cmz1',18,88),(3,'cmz2',28,88),(5,'cmz3',38,88),(7,'cmz4',48,88) -------------- -------------- /*!40000 ALTER TABLE `cmz` ENABLE KEYS */ -------------- -------------- UNLOCK TABLES -------------- -------------- /*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */ -------------- -------------- /*!40101 SET SQL_MODE=@OLD_SQL_MODE */ -------------- -------------- /*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */ -------------- -------------- /*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */ -------------- -------------- /*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */ -------------- -------------- /*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */ -------------- -------------- /*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */ -------------- -------------- /*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */ -------------- \u767b\u5f55\u67e5\u770b\uff0c0\u70b9\u65f6\u5019\u5907\u4efd\u7684sql\u662f\u5426\u6062\u590d\u8fc7\u6765\u4e86\u3002 mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +------------------+ | Tables_in_summer | +------------------+ | cmz | +------------------+ 1 row in set (0,00 sec) mysql> select * from cmz; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 2 | cmz1 | 18 | 88 | | 4 | cmz2 | 28 | 88 | | 6 | cmz3 | 38 | 88 | | 8 | cmz4 | 48 | 88 | +----+------+-----+-------+ 4 rows in set (0,00 sec) \u8fd9\u6837\u5c31\u6062\u590d\u4e86\u622a\u81f3\u5f53\u65e5\u51cc\u6668(0:00)\u524d\u7684\u5907\u4efd\u6570\u636e\u90fd\u6062\u590d\u4e86\u3002\u4f46\u662f\u8fd9\u4e2a\u4ec5\u4ec5\u53ea0\u70b9\u5907\u4efd\u7684\u65f6\u5019\uff0c0\u70b9\u4ee5\u540e\u5230drop\u4e4b\u95f4\u7684\u6570\u636e\u600e\u4e48\u6062\u590d\u5462 5.3.2 \u65b9\u6cd51 - \u6062\u590d-\u4fee\u6539\u9519sql \u00b6 \u8bed\u6cd5 mysqlbinlog mysql-bin.0000xx | mysql -u\u7528\u6237\u540d -p\u5bc6\u7801 \u6570\u636e\u5e93\u540d \u53c2\u6570\u89e3\u91ca \u5e38\u7528\u53c2\u6570\u9009\u9879\u89e3\u91ca\uff1a -- start - position = 875 \u8d77\u59cb pos\u70b9 -- stop - position = 954 \u7ed3\u675f pos\u70b9 -- start - datetime = \"2016-9-25 22:01:08\" \u8d77\u59cb\u65f6\u95f4\u70b9 -- stop - datetime = \"2019-9-25 22:09:46\" \u7ed3\u675f\u65f6\u95f4\u70b9 -- database = zyyshop \u6307\u5b9a\u53ea\u6062\u590d zyyshop\u6570\u636e\u5e93 ( \u4e00\u53f0\u4e3b\u673a\u4e0a\u5f80\u5f80\u6709\u591a\u4e2a\u6570\u636e\u5e93\uff0c\u53ea\u9650\u672c\u5730 log\u65e5\u5fd7 ) \u4e0d\u5e38\u7528\u9009\u9879\uff1a - u -- user = name \u8fde\u63a5\u5230\u8fdc\u7a0b\u4e3b\u673a\u7684\u7528\u6237\u540d - p -- password [ = name ] \u8fde\u63a5\u5230\u8fdc\u7a0b\u4e3b\u673a\u7684\u5bc6\u7801 - h -- host = name \u4ece\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u83b7\u53d6 binlog\u65e5\u5fd7 -- read - from - remote - server \u4ece\u67d0\u4e2a MySQL\u670d\u52a1\u5668\u4e0a\u8bfb\u53d6binlog\u65e5\u5fd7 \u5b9e\u9645\u662f\u5c06\u8bfb\u51fa\u7684 binlog\u65e5\u5fd7\u5185\u5bb9 \uff0c\u901a\u8fc7\u7ba1\u9053\u7b26\u4f20\u9012\u7ed9 mysql\u547d\u4ee4 \u3002\u8fd9\u4e9b\u547d\u4ee4\u3001\u6587\u4ef6\u5c3d\u91cf\u5199\u6210\u7edd\u5bf9\u8def\u5f84\uff1b \u77e5\u9053\u4e86\u8fd9\u4e48\u6062\u590d\u7684\u8bdd\uff0c\u5f00\u59cb\u6062\u590d\u5907\u4efd\u4e4b\u540e\u5230drop\u4e4b\u95f4\u7684\u6570\u636e\u3002 \u8981\u7f16\u8f91\u90a3\u4e2amysql-bin.000004 \u6587\u4ef6\u3002\u5c06drop\u90a3\u6761\u547d\u4ee4\u53bb\u6389\u3002 root@leco:/mysqldataback# cp /var/log/mysql/mysql-bin.000013 . root@leco:/mysqldataback# ls mysql-bin.000013 summer_2019-03-01.sql root@leco:/mysqldataback# mysqlbinlog mysql-bin.000013 >mysql-bin.000013.sql root@leco:/mysqldataback# ls mysql-bin.000013 mysql-bin.000013.sql summer_2019-03-01.sql root@leco:/mysqldataback# vim mysql-bin.000013.sql root@leco:/mysqldataback# # DROP TABLE `cmz` /* generated by server */ \u5220\u9664\u8fd9\u4e2a\u8bed\u53e5 root@leco:/mysqldataback# mysql -uroot -proot <mysql-bin.000013.sql mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 1790 (HY000) at line 122: @@SESSION.GTID_NEXT cannot be changed by a client that owns a GTID. The client owns ANONYMOUS. Ownership is released on COMMIT or ROLLBACK. \u767b\u5f55\u6570\u636e\u5e93\u67e5\u770b mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> select * from cmz; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | cmz1 | 100 | 88 | | 3 | cmz2 | 200 | 88 | | 5 | cmz3 | 38 | 88 | | 7 | cmz4 | 48 | 88 | | 9 | cmz5 | 58 | 88 | | 11 | cmz6 | 68 | 88 | +----+------+-----+-------+ 6 rows in set (0.00 sec) \u8fd9\u6837\u6570\u636e\u5c31\u5168\u90e8\u6062\u590d\u51fa\u6765\u4e86\u3002\u6062\u590d\u6570\u636e\u4e00\u5171\u4e24\u4e2a\u70b9 \u5148\u6062\u590d\u6700\u8fd1\u5907\u4efd\u90a3\u4e2a\u70b9\uff0c\u4e5f\u5c31\u662f\u4e0a\u9762\u76840\u70b9\u5907\u4efd\u7684\u6587\u4ef6 \u7136\u540e\u518d\u6062\u590d\u65e0\u64cd\u4f5c\u4e4b\u524d\u7684\u6587\u4ef6\uff0c\u5c31\u53ef\u4ee5\u6062\u590d\u4ee5\u4e0a\u6570\u636e\u3002 5.3.3 \u65b9\u6cd52 - \u6062\u590d- \u70b9 \u00b6 \u5220\u9664\u8868 mysql> show tables; +------------------+ | Tables_in_summer | +------------------+ | cmz | +------------------+ 1 row in set (0.00 sec) mysql> drop table cmz; Query OK, 0 rows affected (0.04 sec) mysql> show tables; Empty set (0.00 sec) \u5f00\u59cb\u6062\u590d\u3002 root@leco:/mysqldataback# ll \u603b\u7528\u91cf 24 drwxr-xr-x 2 root root 4096 3\u6708 1 17:35 ./ drwxr-xr-x 33 root root 4096 3\u6708 1 16:10 ../ -rw-r----- 1 root root 1833 3\u6708 1 17:34 mysql-bin.000013 # \u6700\u521d\u5220\u9664drop table cmz\uff0c\u5c31\u662f\u8bb0\u5f55\u5728\u8fd9\u4e2abinlog\u4e2d\u7684\u3002 -rw-r--r-- 1 root root 5432 3\u6708 1 17:35 mysql-bin.000013.sql -rw-r--r-- 1 root root 2331 3\u6708 1 17:21 summer_2019-03-01.sql root@leco:/mysqldataback# \u6211\u4eec\u67e5\u770bsql\u7684\u6267\u884c\u60c5\u51b5 mysql> show binlog events in 'mysql-bin.000013'\\G; *************************** 1. row *************************** Log_name: mysql-bin.000013 Pos: 4 Event_type: Format_desc Server_id: 1 End_log_pos: 123 Info: Server ver: 5.7.25-0ubuntu0.16.04.2-log, Binlog ver: 4 *************************** 2. row *************************** Log_name: mysql-bin.000013 Pos: 123 Event_type: Previous_gtids Server_id: 1 End_log_pos: 154 Info: *************************** 3. row *************************** Log_name: mysql-bin.000013 Pos: 154 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 219 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 4. row *************************** Log_name: mysql-bin.000013 Pos: 219 Event_type: Query Server_id: 1 End_log_pos: 298 Info: BEGIN *************************** 5. row *************************** Log_name: mysql-bin.000013 Pos: 298 Event_type: Rows_query Server_id: 1 End_log_pos: 374 Info: # insert into cmz(name,age,score) values(\"cmz5\",58,88) *************************** 6. row *************************** Log_name: mysql-bin.000013 Pos: 374 Event_type: Table_map Server_id: 1 End_log_pos: 427 Info: table_id: 133 (summer.cmz) *************************** 7. row *************************** Log_name: mysql-bin.000013 Pos: 427 Event_type: Write_rows Server_id: 1 End_log_pos: 480 Info: table_id: 133 flags: STMT_END_F *************************** 8. row *************************** Log_name: mysql-bin.000013 Pos: 480 Event_type: Xid Server_id: 1 End_log_pos: 511 Info: COMMIT /* xid=516 */ *************************** 9. row *************************** Log_name: mysql-bin.000013 Pos: 511 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 576 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 10. row *************************** Log_name: mysql-bin.000013 Pos: 576 Event_type: Query Server_id: 1 End_log_pos: 655 Info: BEGIN *************************** 11. row *************************** Log_name: mysql-bin.000013 Pos: 655 Event_type: Rows_query Server_id: 1 End_log_pos: 731 Info: # insert into cmz(name,age,score) values(\"cmz6\",68,88) *************************** 12. row *************************** Log_name: mysql-bin.000013 Pos: 731 Event_type: Table_map Server_id: 1 End_log_pos: 784 Info: table_id: 133 (summer.cmz) *************************** 13. row *************************** Log_name: mysql-bin.000013 Pos: 784 Event_type: Write_rows Server_id: 1 End_log_pos: 837 Info: table_id: 133 flags: STMT_END_F *************************** 14. row *************************** Log_name: mysql-bin.000013 Pos: 837 Event_type: Xid Server_id: 1 End_log_pos: 868 Info: COMMIT /* xid=517 */ *************************** 15. row *************************** Log_name: mysql-bin.000013 Pos: 868 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 933 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 16. row *************************** Log_name: mysql-bin.000013 Pos: 933 Event_type: Query Server_id: 1 End_log_pos: 1012 Info: BEGIN *************************** 17. row *************************** Log_name: mysql-bin.000013 Pos: 1012 Event_type: Rows_query Server_id: 1 End_log_pos: 1076 Info: # update cmz set age=100 where name='cmz1' *************************** 18. row *************************** Log_name: mysql-bin.000013 Pos: 1076 Event_type: Table_map Server_id: 1 End_log_pos: 1129 Info: table_id: 133 (summer.cmz) *************************** 19. row *************************** Log_name: mysql-bin.000013 Pos: 1129 Event_type: Update_rows Server_id: 1 End_log_pos: 1201 Info: table_id: 133 flags: STMT_END_F *************************** 20. row *************************** Log_name: mysql-bin.000013 Pos: 1201 Event_type: Xid Server_id: 1 End_log_pos: 1232 Info: COMMIT /* xid=520 */ *************************** 21. row *************************** Log_name: mysql-bin.000013 Pos: 1232 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 1297 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 22. row *************************** Log_name: mysql-bin.000013 Pos: 1297 Event_type: Query Server_id: 1 End_log_pos: 1376 Info: BEGIN *************************** 23. row *************************** Log_name: mysql-bin.000013 Pos: 1376 Event_type: Rows_query Server_id: 1 End_log_pos: 1440 Info: # update cmz set age=200 where name='cmz2' *************************** 24. row *************************** Log_name: mysql-bin.000013 Pos: 1440 Event_type: Table_map Server_id: 1 End_log_pos: 1493 Info: table_id: 133 (summer.cmz) *************************** 25. row *************************** Log_name: mysql-bin.000013 Pos: 1493 Event_type: Update_rows Server_id: 1 End_log_pos: 1565 Info: table_id: 133 flags: STMT_END_F *************************** 26. row *************************** Log_name: mysql-bin.000013 Pos: 1565 Event_type: Xid Server_id: 1 End_log_pos: 1596 Info: COMMIT /* xid=521 */ *************************** 27. row *************************** Log_name: mysql-bin.000013 Pos: 1596 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 1661 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 28. row *************************** Log_name: mysql-bin.000013 Pos: 1661 Event_type: Query Server_id: 1 End_log_pos: 1786 Info: use `summer`; DROP TABLE `cmz` /* generated by server */ *************************** 29. row *************************** Log_name: mysql-bin.000013 Pos: 1786 Event_type: Rotate Server_id: 1 End_log_pos: 1833 Info: mysql-bin.000014;pos=4 29 rows in set (0.00 sec) ERROR: No query specified \u4ece\u4e0a\u9762\u53ef\u4ee5\u770b\u5230\u3002\u5728drop\u7684\u65f6\u5019\u3002mysql\u7684pos\u5f00\u59cb\u81f31661\u7ed3\u675f1786\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u6062\u590d\u52301661\uff0c\u5373\u53ef\u3002 \u5f00\u59cb\u6062\u590d # \u5148\u6062\u590d\u4e4b\u524d\u5168\u5907\u4efd root@leco:/mysqldataback# mysql -uroot -proot <summer_2019-03-01.sql # \u7136\u540e\u6839\u636epos\u4f4d\u7f6e\u6062\u590d root@leco:/mysqldataback# mysqlbinlog --stop-position=1661 mysql-bin.000013| mysql -uroot -proot mysql: [Warning] Using a password on the command line interface can be insecure. root@leco:/mysqldataback# mysql -uroot -proot -e 'use summer;select * from cmz;' mysql: [Warning] Using a password on the command line interface can be insecure. +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | cmz1 | 100 | 88 | | 3 | cmz2 | 200 | 88 | | 5 | cmz3 | 38 | 88 | | 7 | cmz4 | 48 | 88 | | 9 | cmz5 | 58 | 88 | | 11 | cmz6 | 68 | 88 | +----+------+-----+-------+ \u7136\u540e\u770b\u5230\uff0c\u6570\u636e\u90fd\u6062\u590d\u4e86\u3002 \u603b\u7ed3 \u6240\u8c13\u6062\u590d\uff0c\u5c31\u662f\u8ba9 mysql\u5c06\u4fdd\u5b58\u5728binlog\u65e5\u5fd7\u4e2d\u6307\u5b9a\u6bb5\u843d\u533a\u95f4\u7684sql\u8bed\u53e5\u9010\u4e2a\u91cd\u65b0\u6267\u884c\u4e00\u6b21\u800c\u5df2 \u3002","title":"4. binlog \u6062\u590d\u6570\u636e"},{"location":"mysql/mysql.restore_data/#1-binlog","text":"\u4f17\u6240\u5468\u77e5\uff0cbinlog\u65e5\u5fd7\u5bf9\u4e8emysql\u6570\u636e\u5e93\u6765\u8bf4\u662f\u5341\u5206\u91cd\u8981\u7684\u3002\u5728\u6570\u636e\u4e22\u5931\u7684\u7d27\u6025\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5f80\u5f80\u4f1a\u60f3\u5230\u7528binlog\u65e5\u5fd7\u529f\u80fd\u8fdb\u884c\u6570\u636e\u6062\u590d\uff08\u5b9a\u65f6\u5168\u5907\u4efd+binlog\u65e5\u5fd7\u6062\u590d\u589e\u91cf\u6570\u636e\u90e8\u5206\uff09\uff0c\u4e3a\u4f60\u4e00\u8def\u4fdd\u9a7e\u62a4\u822a\uff01","title":"1. binlog\u4ecb\u7ecd"},{"location":"mysql/mysql.restore_data/#11-binlog","text":"MySQL\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7binlog\u53ef\u4ee5\u8bf4\u662fMySQL\u6700\u91cd\u8981\u7684\u65e5\u5fd7\uff0c\u5b83\u8bb0\u5f55\u4e86\u6240\u6709\u7684DDL\u548cDML\u8bed\u53e5\uff08\u9664\u4e86\u6570\u636e\u67e5\u8be2\u8bed\u53e5select\uff09\uff0c\u4ee5\u4e8b\u4ef6\u5f62\u5f0f\u8bb0\u5f55\uff0c\u8fd8\u5305\u542b\u8bed\u53e5\u6240\u6267\u884c\u7684\u6d88\u8017\u7684\u65f6\u95f4\uff0cMySQL\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u662f\u4e8b\u52a1\u5b89\u5168\u578b\u7684\u3002","title":"1.1 \u4e86\u89e3binlog"},{"location":"mysql/mysql.restore_data/#111-ddl","text":"Data Definition Language,\u4e3b\u8981\u7684\u547d\u4ee4\u6709CREATE\u3001ALTER\u3001DROP\u7b49\uff0cDDL\u4e3b\u8981\u662f\u7528\u5728\u5b9a\u4e49\u6216\u6539\u53d8\u8868\uff08TABLE\uff09\u7684\u7ed3\u6784\uff0c\u6570\u636e\u7c7b\u578b\uff0c\u8868\u4e4b\u95f4\u7684\u94fe\u63a5\u548c\u7ea6\u675f\u7b49\u521d\u59cb\u5316\u5de5\u4f5c\u4e0a\uff0c\u4ed6\u4eec\u5927\u591a\u5728\u5efa\u7acb\u8868\u65f6\u4f7f\u7528\u3002","title":"1.1.1 DDL"},{"location":"mysql/mysql.restore_data/#112-dml","text":"Data Manipulation Language \u6570\u636e\u64cd\u7eb5\u8bed\u8a00,\u4e3b\u8981\u7684\u547d\u4ee4\u662fSELECT\u3001UPDATE\u3001INSERT\u3001DELETE\uff0c\u5c31\u8c61\u5b83\u7684\u540d\u5b57\u4e00\u6837\uff0c\u8fd94\u6761\u547d\u4ee4\u662f\u7528\u6765\u5bf9\u6570\u636e\u5e93\u91cc\u7684\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\u7684\u8bed\u8a00","title":"1.1.2 DML"},{"location":"mysql/mysql.restore_data/#13-binlog","text":"--start-datetime\uff1a \u4ece\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u8bfb\u53d6\u6307\u5b9a\u7b49\u4e8e\u65f6\u95f4\u6233\u6216\u8005\u665a\u4e8e\u672c\u5730\u670d\u52a1\u5668\u7684\u65f6\u95f4 --stop-datetime\uff1a \u4ece\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u8bfb\u53d6\u6307\u5b9a\u5c0f\u4e8e\u65f6\u95f4\u6233\u6216\u8005\u7b49\u4e8e\u672c\u5730\u670d\u52a1\u5668\u7684\u65f6\u95f4 \u53d6\u503c\u548c\u4e0a\u8ff0\u4e00\u6837 --start-position\uff1a \u4ece\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u8bfb\u53d6\u6307\u5b9aposition \u4e8b\u4ef6\u4f4d\u7f6e\u4f5c\u4e3a\u5f00\u59cb\u3002 --stop-position\uff1a \u4ece\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4e2d\u8bfb\u53d6\u6307\u5b9aposition \u4e8b\u4ef6\u4f4d\u7f6e\u4f5c\u4e3a\u4e8b\u4ef6\u622a\u81f3","title":"1.3 binlog\u5e38\u7528\u9009\u9879"},{"location":"mysql/mysql.restore_data/#14","text":"MySQL\u4e3b\u4ece\u590d\u5236\uff1aMySQL Replication\u5728Master\u7aef\u5f00\u542fbinlog\uff0cMaster\u628a\u5b83\u7684\u4e8c\u8fdb\u5236\u65e5\u5fd7\u4f20\u9012\u7ed9slaves\u6765\u8fbe\u5230master-slave\u6570\u636e\u4e00\u81f4\u7684\u76ee\u7684 \u6570\u636e\u6062\u590d\u4e86\uff0c\u901a\u8fc7\u4f7f\u7528mysqlbinlog\u5de5\u5177\u6765\u4f7f\u6062\u590d\u6570\u636e\u3002","title":"1.4 \u4f7f\u7528\u573a\u666f"},{"location":"mysql/mysql.restore_data/#15-binlog","text":"\u4e8c\u8fdb\u5236\u65e5\u5fd7\u7d22\u5f15\u6587\u4ef6\uff08\u6587\u4ef6\u540d\u540e\u7f00\u4e3a.index\uff09\u7528\u4e8e\u8bb0\u5f55\u6240\u6709\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6 \u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\uff08\u6587\u4ef6\u540d\u540e\u7f00\u4e3a.00000*\uff09\u8bb0\u5f55\u6570\u636e\u5e93\u6240\u6709\u7684DDL\u548cDML(\u9664\u4e86\u6570\u636e\u67e5\u8be2\u8bed\u53e5select)\u8bed\u53e5\u4e8b\u4ef6","title":"1.5 binlog\u5305\u62ec\u6587\u4ef6"},{"location":"mysql/mysql.restore_data/#16-binlog","text":"\u6211\u7684\u662fubuntu\u7cfb\u7edf\uff0c\u5176\u4ed6\u7cfb\u7edf\u914d\u7f6e\u6587\u4ef6\u53ef\u80fd\u6709\u6240\u4e0d\u540c root@leco:~# grep -i log_bin /etc/mysql/mysql.conf.d/mysqld.cnf log_bin = /var/log/mysql/mysql-bin.log \u6ce8\u610f 1. mysql - bin \u662f\u65e5\u5fd7\u7684\u57fa\u672c\u540d\u6216\u524d\u7f00\u540d 2. \u6bcf\u6b21\u670d\u52a1\u5668\uff08\u6570\u636e\u5e93\uff09\u91cd\u542f\uff0c\u670d\u52a1\u5668\u4f1a\u8c03\u7528 flush logs ; \uff0c\u65b0\u521b\u5efa\u4e00\u4e2a binlog\u65e5\u5fd7 \uff01 3. \u4fee\u6539 mysql\u914d\u7f6e\u6587\u4ef6\u540e\u4e00\u5b9a\u8981\u91cd\u542f \u3002","title":"1.6 \u5f00\u59cbbinlog"},{"location":"mysql/mysql.restore_data/#17","text":"root@leco:~# mysql -uroot -proot -e ' show variables like \"log_bin\";' mysql: [Warning] Using a password on the command line interface can be insecure. +---------------+-------+ | Variable_name | Value | +---------------+-------+ | log_bin | ON | +---------------+-------+ \u662fON\u5c31\u662f\u5f00\u59cb\u4e86bin log\u3002","title":"1.7 \u67e5\u770b\u5f00\u542f"},{"location":"mysql/mysql.restore_data/#2-binlog","text":"","title":"2. binlog\u5e38\u7528\u547d\u4ee4"},{"location":"mysql/mysql.restore_data/#21-binlog","text":"\u67e5\u770b\u6240\u6709binlog\u65e5\u5fd7\u5217\u8868 mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 1648 | | mysql-bin.000002 | 677 | | mysql-bin.000003 | 613 | | mysql-bin.000004 | 554 | | mysql-bin.000005 | 1239 | | mysql-bin.000006 | 177 | | mysql-bin.000007 | 1749 | | mysql-bin.000008 | 154 | +------------------+-----------+ 8 rows in set (0.00 sec)","title":"2.1 \u67e5\u770bbinlog\u65e5\u5fd7\u5217\u8868"},{"location":"mysql/mysql.restore_data/#22","text":"\u67e5\u770bmaster\u72b6\u6001\uff0c\u5373\u6700\u540e(\u6700\u65b0)\u4e00\u4e2abinlog\u65e5\u5fd7\u7684\u7f16\u53f7\u540d\u79f0\uff0c\u53ca\u5176\u6700\u540e\u4e00\u4e2a\u64cd\u4f5c\u4e8b\u4ef6pos\u7ed3\u675f\u70b9(Position)\u503c mysql> show master status; +------------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +------------------+----------+--------------+------------------+-------------------+ | mysql-bin.000008 | 154 | | | | +------------------+----------+--------------+------------------+-------------------+ 1 row in set (0.00 sec)","title":"2.2 \u67e5\u770b\u6700\u65b0\u65e5\u5fd7\u60c5\u51b5"},{"location":"mysql/mysql.restore_data/#23","text":"flush\u5237\u65b0log\u65e5\u5fd7\uff0c\u81ea\u6b64\u523b\u5f00\u59cb\u4ea7\u751f\u4e00\u4e2a\u65b0\u7f16\u53f7\u7684binlog\u65e5\u5fd7\u6587\u4ef6 mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 1648 | | mysql-bin.000002 | 677 | | mysql-bin.000003 | 613 | | mysql-bin.000004 | 554 | | mysql-bin.000005 | 1239 | | mysql-bin.000006 | 177 | | mysql-bin.000007 | 1749 | | mysql-bin.000008 | 154 | +------------------+-----------+ 8 rows in set (0.00 sec) mysql> flush logs; Query OK, 0 rows affected (0.07 sec) mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 1648 | | mysql-bin.000002 | 677 | | mysql-bin.000003 | 613 | | mysql-bin.000004 | 554 | | mysql-bin.000005 | 1239 | | mysql-bin.000006 | 177 | | mysql-bin.000007 | 1749 | | mysql-bin.000008 | 201 | | mysql-bin.000009 | 154 | +------------------+-----------+ 9 rows in set (0.00 sec) \u6ce8\u610f\uff1a\u6bcf\u5f53mysqld\u670d\u52a1\u91cd\u542f\u65f6\uff0c\u4f1a\u81ea\u52a8\u6267\u884c\u6b64\u547d\u4ee4\uff0c\u5237\u65b0binlog\u65e5\u5fd7\uff1b\u5728mysqldump\u5907\u4efd\u6570\u636e\u65f6\u52a0 -F \u9009\u9879\u4e5f\u4f1a\u5237\u65b0binlog\u65e5\u5fd7\uff1b","title":"2.3 \u5237\u65b0\u65e5\u5fd7"},{"location":"mysql/mysql.restore_data/#24","text":"mysql> reset master; Query OK, 0 rows affected (0.12 sec) mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 106 | +------------------+-----------+ 1 row in set (0.00 sec)","title":"2.4 \u6e05\u7a7a\u65e5\u5fd7"},{"location":"mysql/mysql.restore_data/#3-binlog","text":"","title":"3. \u67e5\u770bbinlog\u65e5\u5fd7\u5185\u5bb9"},{"location":"mysql/mysql.restore_data/#31-mysqbinlog","text":"\u4f7f\u7528mysqlbinlog\u81ea\u5e26\u67e5\u770b\u547d\u4ee4\u6cd5\uff1a \u2192binlog\u662f\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u666e\u901a\u6587\u4ef6\u67e5\u770b\u5668cat\u3001more\u3001vim\u7b49\u90fd\u65e0\u6cd5\u6253\u5f00\uff0c\u5fc5\u987b\u4f7f\u7528\u81ea\u5e26\u7684mysqlbinlog\u547d\u4ee4\u67e5\u770b \u2192binlog\u65e5\u5fd7\u4e0e\u6570\u636e\u5e93\u6587\u4ef6\u5728\u540c\u76ee\u5f55\u4e2d \u2192\u5728MySQL5.5\u4ee5\u4e0b\u7248\u672c\u4f7f\u7528mysqlbinlog\u547d\u4ee4\u65f6\u5982\u679c\u62a5\u9519\uff0c\u5c31\u52a0\u4e0a \"--no-defaults\" \u9009\u9879 root@leco:~# cd /var/log/mysql/ root@leco:/var/log/mysql# ls error.log error.log.2.gz error.log.4.gz error.log.6.gz mysql-bin.000001 mysql-bin.000003 mysql-bin.000005 mysql-bin.000007 mysql-bin.000009 error.log.1.gz error.log.3.gz error.log.5.gz error.log.7.gz mysql-bin.000002 mysql-bin.000004 mysql-bin.000006 mysql-bin.000008 mysql-bin.index root@leco:/var/log/mysql# mysqlbinlog -v mysql-bin.000009 /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/; /*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/; DELIMITER /*!*/; # at 4 #190301 15:50:43 server id 1 end_log_pos 123 CRC32 0x19c50202 Start: binlog v 4, server v 5.7.25-0ubuntu0.16.04.2-log created 190301 15:50:43 # Warning: this binlog is either in use or was not closed properly. BINLOG ' U+R4XA8BAAAAdwAAAHsAAAABAAQANS43LjI1LTB1YnVudHUwLjE2LjA0LjItbG9nAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAAXwAEGggAAAAICAgCAAAACgoKKioAEjQA AQICxRk= '/*!*/; # at 123 #190301 15:50:43 server id 1 end_log_pos 154 CRC32 0x91c319ef Previous-GTIDs # [empty] SET @@SESSION.GTID_NEXT= 'AUTOMATIC' /* added by mysqlbinlog */ /*!*/; DELIMITER ; # End of log file /*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/; /*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/; \u89e3\u91ca 1. server id 1 \u662f mysql\u7684id \uff0c\u672c\u673a\u662f 1 \u6240\u6709\u663e\u793a 1 2. 190301 15 : 50 : 43 \u6267\u884c\u65f6\u95f4\u3002 3. end_log_pos 154 sql\u7ed3\u675f\u7684pos\u8282\u70b9","title":"3.1 mysqbinlog"},{"location":"mysql/mysql.restore_data/#32","text":"\u4e0a\u9762\u8fd9\u79cd\u529e\u6cd5\u8bfb\u53d6\u51fabinlog\u65e5\u5fd7\u7684\u5168\u6587\u5185\u5bb9\u6bd4\u8f83\u591a\uff0c\u4e0d\u5bb9\u6613\u5206\u8fa8\u67e5\u770b\u5230pos\u70b9\u4fe1\u606f \u4e0b\u9762\u4ecb\u7ecd\u4e00\u79cd\u66f4\u4e3a\u65b9\u4fbf\u7684\u67e5\u8be2\u547d\u4ee4\uff1a show binlog events [IN 'log_name'] [FROM pos] [LIMIT [offset,] row_count]; \u89e3\u91ca 1. IN 'log_name' \uff1a \u6307\u5b9a\u8981\u67e5\u8be2\u7684 binlog\u6587\u4ef6\u540d ( \u4e0d\u6307\u5b9a\u5c31\u662f\u7b2c\u4e00\u4e2a binlog\u6587\u4ef6 ) 2. FROM pos \uff1a \u6307\u5b9a\u4ece\u54ea\u4e2a pos\u8d77\u59cb\u70b9\u5f00\u59cb\u67e5\u8d77 ( \u4e0d\u6307\u5b9a\u5c31\u662f\u4ece\u6574\u4e2a\u6587\u4ef6\u9996\u4e2a pos\u70b9\u5f00\u59cb\u7b97 ) 3. LIMIT [ offset ,] \uff1a\u504f\u79fb\u91cf ( \u4e0d\u6307\u5b9a\u5c31\u662f 0 ) 4. row_count \uff1a \u67e5\u8be2\u603b\u6761\u6570 ( \u4e0d\u6307\u5b9a\u5c31\u662f\u6240\u6709\u884c ) mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 1648 | | mysql-bin.000002 | 677 | | mysql-bin.000003 | 613 | | mysql-bin.000004 | 554 | | mysql-bin.000005 | 1239 | | mysql-bin.000006 | 177 | | mysql-bin.000007 | 1749 | | mysql-bin.000008 | 201 | | mysql-bin.000009 | 154 | +------------------+-----------+ 9 rows in set (0.00 sec) mysql> show binlog events in \"mysql-bin.000009\"; +------------------+-----+----------------+-----------+-------------+--------------------------------------------------------+ | Log_name | Pos | Event_type | Server_id | End_log_pos | Info | +------------------+-----+----------------+-----------+-------------+--------------------------------------------------------+ | mysql-bin.000009 | 4 | Format_desc | 1 | 123 | Server ver: 5.7.25-0ubuntu0.16.04.2-log, Binlog ver: 4 | | mysql-bin.000009 | 123 | Previous_gtids | 1 | 154 | | +------------------+-----+----------------+-----------+-------------+--------------------------------------------------------+ 2 rows in set (0.01 sec) mysql> show binlog events in \"mysql-bin.000009\"\\G; *************************** 1. row *************************** Log_name: mysql-bin.000009 Pos: 4 Event_type: Format_desc Server_id: 1 End_log_pos: 123 Info: Server ver: 5.7.25-0ubuntu0.16.04.2-log, Binlog ver: 4 *************************** 2. row *************************** Log_name: mysql-bin.000009 Pos: 123 Event_type: Previous_gtids Server_id: 1 End_log_pos: 154 Info: 2 rows in set (0.00 sec) ERROR: No query specified mysql> show binlog events in \"mysql-bin.000007\"\\G; *************************** 1. row *************************** Log_name: mysql-bin.000007 Pos: 4 Event_type: Format_desc Server_id: 1 End_log_pos: 123 Info: Server ver: 5.7.25-0ubuntu0.16.04.2-log, Binlog ver: 4 *************************** 2. row *************************** Log_name: mysql-bin.000007 Pos: 123 Event_type: Previous_gtids Server_id: 1 End_log_pos: 154 Info: *************************** 3. row *************************** Log_name: mysql-bin.000007 Pos: 154 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 219 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 4. row *************************** Log_name: mysql-bin.000007 Pos: 219 Event_type: Query Server_id: 1 End_log_pos: 298 Info: BEGIN *************************** 5. row *************************** Log_name: mysql-bin.000007 Pos: 298 Event_type: Rows_query Server_id: 1 End_log_pos: 389 Info: # insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88) *************************** 6. row *************************** Log_name: mysql-bin.000007 Pos: 389 Event_type: Table_map Server_id: 1 End_log_pos: 442 Info: table_id: 109 (summer.cmz) *************************** 7. row *************************** Log_name: mysql-bin.000007 Pos: 442 Event_type: Write_rows Server_id: 1 End_log_pos: 510 Info: table_id: 109 flags: STMT_END_F *************************** 8. row *************************** Log_name: mysql-bin.000007 Pos: 510 Event_type: Xid Server_id: 1 End_log_pos: 541 Info: COMMIT /* xid=15 */ *************************** 9. row *************************** Log_name: mysql-bin.000007 Pos: 541 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 606 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 10. row *************************** Log_name: mysql-bin.000007 Pos: 606 Event_type: Query Server_id: 1 End_log_pos: 685 Info: BEGIN *************************** 11. row *************************** Log_name: mysql-bin.000007 Pos: 685 Event_type: Rows_query Server_id: 1 End_log_pos: 776 Info: # insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88) *************************** 12. row *************************** Log_name: mysql-bin.000007 Pos: 776 Event_type: Table_map Server_id: 1 End_log_pos: 829 Info: table_id: 109 (summer.cmz) *************************** 13. row *************************** Log_name: mysql-bin.000007 Pos: 829 Event_type: Write_rows Server_id: 1 End_log_pos: 897 Info: table_id: 109 flags: STMT_END_F *************************** 14. row *************************** Log_name: mysql-bin.000007 Pos: 897 Event_type: Xid Server_id: 1 End_log_pos: 928 Info: COMMIT /* xid=16 */ *************************** 15. row *************************** Log_name: mysql-bin.000007 Pos: 928 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 993 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 16. row *************************** Log_name: mysql-bin.000007 Pos: 993 Event_type: Query Server_id: 1 End_log_pos: 1072 Info: BEGIN *************************** 17. row *************************** Log_name: mysql-bin.000007 Pos: 1072 Event_type: Rows_query Server_id: 1 End_log_pos: 1163 Info: # insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88) *************************** 18. row *************************** Log_name: mysql-bin.000007 Pos: 1163 Event_type: Table_map Server_id: 1 End_log_pos: 1216 Info: table_id: 109 (summer.cmz) *************************** 19. row *************************** Log_name: mysql-bin.000007 Pos: 1216 Event_type: Write_rows Server_id: 1 End_log_pos: 1284 Info: table_id: 109 flags: STMT_END_F *************************** 20. row *************************** Log_name: mysql-bin.000007 Pos: 1284 Event_type: Xid Server_id: 1 End_log_pos: 1315 Info: COMMIT /* xid=17 */ *************************** 21. row *************************** Log_name: mysql-bin.000007 Pos: 1315 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 1380 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 22. row *************************** Log_name: mysql-bin.000007 Pos: 1380 Event_type: Query Server_id: 1 End_log_pos: 1459 Info: BEGIN *************************** 23. row *************************** Log_name: mysql-bin.000007 Pos: 1459 Event_type: Rows_query Server_id: 1 End_log_pos: 1550 Info: # insert into cmz(name,age,score) values(\"cmz1 from leco data\",40,88) *************************** 24. row *************************** Log_name: mysql-bin.000007 Pos: 1550 Event_type: Table_map Server_id: 1 End_log_pos: 1603 Info: table_id: 109 (summer.cmz) *************************** 25. row *************************** Log_name: mysql-bin.000007 Pos: 1603 Event_type: Write_rows Server_id: 1 End_log_pos: 1671 Info: table_id: 109 flags: STMT_END_F *************************** 26. row *************************** Log_name: mysql-bin.000007 Pos: 1671 Event_type: Xid Server_id: 1 End_log_pos: 1702 Info: COMMIT /* xid=18 */ *************************** 27. row *************************** Log_name: mysql-bin.000007 Pos: 1702 Event_type: Rotate Server_id: 1 End_log_pos: 1749 Info: mysql-bin.000008;pos=4 27 rows in set (0.00 sec) ERROR: No query specified \u4e0a\u9762\u8fd9\u6761\u8bed\u53e5\u53ef\u4ee5\u5c06\u6307\u5b9a\u7684binlog\u65e5\u5fd7\u6587\u4ef6\uff0c\u5206\u6210\u6709\u6548\u4e8b\u4ef6\u884c\u7684\u65b9\u5f0f\u8fd4\u56de\uff0c\u5e76\u53ef\u4f7f\u7528limit\u6307\u5b9apos\u70b9\u7684\u8d77\u59cb\u504f\u79fb\uff0c\u67e5\u8be2\u6761\u6570\uff01 \u5176\u4ed6\u67e5\u8be2 a\uff09\u67e5\u8be2\u7b2c\u4e00\u4e2a(\u6700\u65e9)\u7684binlog\u65e5\u5fd7\uff1a mysql> show binlog events\\G; b\uff09\u6307\u5b9a\u67e5\u8be2 mysql-bin.000002\u8fd9\u4e2a\u6587\u4ef6\uff1a mysql> show binlog events in 'mysql-bin.000002'\\G; c\uff09\u6307\u5b9a\u67e5\u8be2 mysql-bin.000002\u8fd9\u4e2a\u6587\u4ef6\uff0c\u4ecepos\u70b9:624\u5f00\u59cb\u67e5\u8d77\uff1a mysql> show binlog events in 'mysql-bin.000002' from 624\\G; d\uff09\u6307\u5b9a\u67e5\u8be2 mysql-bin.000002\u8fd9\u4e2a\u6587\u4ef6\uff0c\u4ecepos\u70b9:624\u5f00\u59cb\u67e5\u8d77\uff0c\u67e5\u8be210\u6761\uff08\u537310\u6761\u8bed\u53e5\uff09 mysql> show binlog events in 'mysql-bin.000002' from 624 limit 10\\G; e\uff09\u6307\u5b9a\u67e5\u8be2 mysql-bin.000002\u8fd9\u4e2a\u6587\u4ef6\uff0c\u4ecepos\u70b9:624\u5f00\u59cb\u67e5\u8d77\uff0c\u504f\u79fb2\u884c\uff08\u5373\u4e2d\u95f4\u8df3\u8fc72\u4e2a\uff09\uff0c\u67e5\u8be210\u6761 mysql> show binlog events in 'mysql-bin.000002' from 624 limit 2,10\\G;","title":"3.2 \u53c2\u6570\u67e5\u8be2"},{"location":"mysql/mysql.restore_data/#4-binlog","text":"","title":"4. binlog\u6062\u590d\u6570\u636e"},{"location":"mysql/mysql.restore_data/#41","text":"drop database summer; create database summer charset utf8; use summer; drop table cmz; create table cmz( id int not null primary key auto_increment, name varchar(20), age int not null, score int not null ); insert into cmz(name,age,score) values(\"cmz1\",18,88); insert into cmz(name,age,score) values(\"cmz2\",28,88); insert into cmz(name,age,score) values(\"cmz3\",38,88); insert into cmz(name,age,score) values(\"cmz4\",48,88); select * from cmz; \u6267\u884c\u8fc7\u7a0b mysql> drop database summer; ERROR 1008 (HY000): Can't drop database 'summer'; database doesn't exist mysql> create database summer charset utf8; Query OK, 1 row affected (0.00 sec) mysql> use summer; Database changed mysql> drop table cmz; ERROR 1051 (42S02): Unknown table 'summer.cmz' mysql> create table cmz( -> id int not null primary key auto_increment, -> name varchar(20), -> age int not null, -> score int not null -> ); Query OK, 0 rows affected (0.08 sec) mysql> mysql> insert into cmz(name,age,score) values(\"cmz1\",18,88); Query OK, 1 row affected (0.01 sec) mysql> insert into cmz(name,age,score) values(\"cmz2\",28,88); Query OK, 1 row affected (0.02 sec) mysql> insert into cmz(name,age,score) values(\"cmz3\",38,88); Query OK, 1 row affected (0.03 sec) mysql> insert into cmz(name,age,score) values(\"cmz4\",48,88); Query OK, 1 row affected (0.01 sec) mysql> mysql> select * from cmz; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | cmz1 | 18 | 88 | | 3 | cmz2 | 28 | 88 | | 5 | cmz3 | 38 | 88 | | 7 | cmz4 | 48 | 88 | +----+------+-----+-------+ 4 rows in set (0.00 sec)","title":"4.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.restore_data/#5","text":"","title":"5 \u573a\u666f\u6a21\u62df"},{"location":"mysql/mysql.restore_data/#51","text":"\u5047\u8bbe\u6bcf\u5929\u96f6\u70b9\u5168\u91cf\u5907\u4efd\u4e00\u6b21\u3002 \u53c2\u6570\u8bf4\u660e 1. - B \uff1a\u6307\u5b9a\u6570\u636e\u5e93 2. - F \uff1a\u5237\u65b0\u65e5\u5fd7 3. - R \uff1a\u5907\u4efd\u5b58\u50a8\u8fc7\u7a0b\u7b49 4. - x \uff1a\u9501\u8868 5. -- master - data \uff1a\u5728\u5907\u4efd\u8bed\u53e5\u91cc\u6dfb\u52a0 CHANGE MASTER\u8bed\u53e5\u4ee5\u53cabinlog\u6587\u4ef6\u53ca\u4f4d\u7f6e\u70b9\u4fe1\u606f \u5f85\u5230\u6570\u636e\u5e93\u5907\u4efd\u5b8c\u6210\uff0c\u5c31\u4e0d\u7528\u62c5\u5fc3\u6570\u636e\u4e22\u5931\u4e86\uff0c\u56e0\u4e3a\u6709\u5b8c\u5168\u5907\u4efd\u6570\u636e\u5728\uff01\uff01 \u7531\u4e8e\u4e0a\u9762\u5728\u5168\u5907\u4efd\u7684\u65f6\u5019\u4f7f\u7528\u4e86-F\u9009\u9879\uff0c\u90a3\u4e48\u5f53\u6570\u636e\u5907\u4efd\u64cd\u4f5c\u521a\u5f00\u59cb\u7684\u65f6\u5019\u7cfb\u7edf\u5c31\u4f1a\u81ea\u52a8\u5237\u65b0log\uff0c\u8fd9\u6837\u5c31\u4f1a\u81ea\u52a8\u4ea7\u751f \u4e00\u4e2a\u65b0\u7684binlog\u65e5\u5fd7\uff0c\u8fd9\u4e2a\u65b0\u7684binlog\u65e5\u5fd7\u5c31\u4f1a\u7528\u6765\u8bb0\u5f55\u5907\u4efd\u4e4b\u540e\u7684\u6570\u636e\u5e93\u201c\u589e\u5220\u6539\u201d\u64cd\u4f5c \u67e5\u770b\u4e00\u4e0b\uff1a root@leco:~# mysql -uroot -proot -e ' show master status;' mysql: [Warning] Using a password on the command line interface can be insecure. +------------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +------------------+----------+--------------+------------------+-------------------+ | mysql-bin.000013 | 154 | | | | +------------------+----------+--------------+------------------+-------------------+ \u4e5f\u5c31\u662f\u8bf4\uff0c mysql-bin.000013 \u662f\u7528\u6765\u8bb0\u5f550\u70b9\u4e4b\u540e\u5bf9\u6570\u636e\u5e93\u7684\u6240\u6709\u201c\u589e\u5220\u6539\u201d\u64cd\u4f5c\u3002","title":"5.1 \u5168\u91cf\u5907\u4efd"},{"location":"mysql/mysql.restore_data/#52","text":"\u65e9\u4e0a\u5f00\u59cb\uff0c\u7531\u4e8e\u4e1a\u52a1\u7684\u9700\u6c42\u4f1a\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u5404\u79cd\u201c\u589e\u5220\u6539\u201d\u64cd\u4f5c\u3002\u6bd4\u5982\u6211\u4eec\u5728cmz\u8868\u4e2d\u505a\u4e86\u589e\u5220\u6539\u67e5\u64cd\u4f5c\u3002 \u5feb\u901f\u547d\u4ee4 insert into cmz(name,age,score) values(\"cmz5\",58,88); insert into cmz(name,age,score) values(\"cmz6\",68,88); update cmz set age=100 where name='cmz1'; update cmz set age=200 where name='cmz2'; \u64cd\u4f5c\u8fc7\u7a0b mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +------------------+ | Tables_in_summer | +------------------+ | cmz | +------------------+ 1 row in set (0.00 sec) mysql> select * from cmz; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | cmz1 | 18 | 88 | | 3 | cmz2 | 28 | 88 | | 5 | cmz3 | 38 | 88 | | 7 | cmz4 | 48 | 88 | +----+------+-----+-------+ 4 rows in set (0.00 sec) mysql> insert into cmz(name,age,score) values(\"cmz5\",58,88); Query OK, 1 row affected (0.01 sec) mysql> insert into cmz(name,age,score) values(\"cmz6\",68,88); Query OK, 1 row affected (0.01 sec) mysql> select * from cmz; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | cmz1 | 18 | 88 | | 3 | cmz2 | 28 | 88 | | 5 | cmz3 | 38 | 88 | | 7 | cmz4 | 48 | 88 | | 9 | cmz5 | 58 | 88 | | 11 | cmz6 | 68 | 88 | +----+------+-----+-------+ 6 rows in set (0.00 sec) \u63a5\u7740\u6709\u53c8\u64cd\u4f5c\u3002 mysql> select * from cmz; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | cmz1 | 18 | 88 | | 3 | cmz2 | 28 | 88 | | 5 | cmz3 | 38 | 88 | | 7 | cmz4 | 48 | 88 | | 9 | aa | 1 | 1 | | 11 | bb | 1 | 1 | | 13 | cc | 1 | 1 | | 15 | dd | 1 | 1 | +----+------+-----+-------+ 8 rows in set (0.00 sec) mysql> update cmz set age=100 where name='cmz1'; Query OK, 1 row affected (0.01 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> update cmz set age=200 where name='cmz2'; Query OK, 1 row affected (0.01 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> select * from cmz; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | cmz1 | 100 | 88 | | 3 | cmz2 | 200 | 88 | | 5 | cmz3 | 38 | 88 | | 7 | cmz4 | 48 | 88 | | 9 | cmz5 | 58 | 88 | | 11 | cmz6 | 68 | 88 | +----+------+-----+-------+ 6 rows in set (0.00 sec) \u4ee5\u4e0a\u4e5f\u5c31\u662f\u6700\u65b0\u7684\u6570\u636e\uff0c\u8fd9\u4e2a\u65f6\u95f4\u70b9\u3002\u67d0\u4e2a\u4eba\u624b\u8d31\u3002\u5220\u9664\u4e86\u8fd9\u4e2a\u8868\u3002 mysql> show tables; +------------------+ | Tables_in_summer | +------------------+ | cmz | +------------------+ 1 row in set (0.00 sec) mysql> drop table cmz; Query OK, 0 rows affected (0.05 sec) mysql> show tables; Empty set (0.00 sec) \u6b64\u65f6\u6765\u627e\u4f60\u3002\u95ee\u4f60\u600e\u4e48\u529e\uff0c\u6b64\u65f6\u4f60\u4e0d\u8981\u60ca\u614c\u3002\u559d\u676f\u6c34\u538b\u538b\u60ca\u3002\u6211\u8349\uff0c\u6211\u8be5\u4e0a\u573a\u4e86\u3002 \u6b64\u65f6\u4f60\u522b\u624b\u6296\uff0c\u5148\u4ed4\u7ec6\u67e5\u770b\u6700\u540e\u4e00\u4e2abinlog\u65e5\u5fd7\uff0c\u5e76\u8bb0\u5f55\u4e0b\u5173\u952e\u7684pos\u70b9\uff0c\u5230\u5e95\u662f\u54ea\u4e2apos\u70b9\u7684\u64cd\u4f5c\u5bfc\u81f4\u4e86\u6570\u636e\u5e93\u7684\u7834\u574f(\u901a\u5e38\u5728\u6700\u540e\u51e0\u6b65)\uff1b\u5148\u5907\u4efd\u4e00\u4e0b\u6700\u540e\u4e00\u4e2abinlog\u65e5\u5fd7\u6587\u4ef6\uff1a root@leco:~# cd /var/log/mysql/ root@leco:/var/log/mysql# ll \u603b\u7528\u91cf 124 drwxr-x--- 2 mysql adm 4096 3\u6708 1 17:21 ./ drwxrwxr-x 31 root syslog 4096 3\u6708 1 07:35 ../ -rw-r----- 1 mysql adm 9428 3\u6708 1 14:26 error.log -rw-r----- 1 mysql adm 6604 3\u6708 1 02:00 error.log.1.gz -rw-r----- 1 mysql adm 2902 2\u6708 27 09:09 error.log.2.gz -rw-r----- 1 mysql adm 4906 2\u6708 26 18:08 error.log.3.gz -rw-r----- 1 mysql adm 1460 2\u6708 25 09:52 error.log.4.gz -rw-r----- 1 mysql adm 324 2\u6708 24 20:01 error.log.5.gz -rw-r----- 1 mysql adm 20 2\u6708 23 07:35 error.log.6.gz -rw-r----- 1 mysql adm 20 2\u6708 22 07:35 error.log.7.gz -rw-r----- 1 mysql mysql 1648 3\u6708 1 10:55 mysql-bin.000001 -rw-r----- 1 mysql mysql 677 3\u6708 1 10:56 mysql-bin.000002 -rw-r----- 1 mysql mysql 613 3\u6708 1 11:04 mysql-bin.000003 -rw-r----- 1 mysql mysql 554 3\u6708 1 14:23 mysql-bin.000004 -rw-r----- 1 mysql mysql 1239 3\u6708 1 14:25 mysql-bin.000005 -rw-r----- 1 mysql mysql 177 3\u6708 1 14:26 mysql-bin.000006 -rw-r----- 1 mysql mysql 1749 3\u6708 1 14:26 mysql-bin.000007 -rw-r----- 1 mysql mysql 201 3\u6708 1 15:50 mysql-bin.000008 -rw-r----- 1 mysql mysql 2246 3\u6708 1 16:12 mysql-bin.000009 -rw-r----- 1 mysql mysql 10105 3\u6708 1 17:09 mysql-bin.000010 -rw-r----- 1 mysql mysql 1105 3\u6708 1 17:14 mysql-bin.000011 -rw-r----- 1 mysql mysql 7882 3\u6708 1 17:21 mysql-bin.000012 -rw-r----- 1 mysql mysql 1786 3\u6708 1 17:25 mysql-bin.000013 -rw-r----- 1 mysql mysql 416 3\u6708 1 17:21 mysql-bin.index root@leco:/var/log/mysql# \u63a5\u7740\u6267\u884c\u4e00\u6b21\u5237\u65b0\u65e5\u5fd7\u7d22\u5f15\u64cd\u4f5c\uff0c\u91cd\u65b0\u5f00\u59cb\u65b0\u7684binlog\u65e5\u5fd7\u8bb0\u5f55\u6587\u4ef6\u3002\u6309\u7406\u8bf4mysql-bin.0000013\uff0c\u8fd9\u4e2a\u6587\u4ef6\u4e0d\u4f1a\u518d\u6709\u540e\u7eed\u5199\u5165\u4e86\uff0c\u56e0\u4e3a\u4fbf\u4e8e\u6211\u4eec\u5206\u6790\u539f\u56e0\u53ca\u67e5\u627eops\u8282\u70b9\uff0c\u4ee5\u540e\u6240\u6709\u6570\u636e\u5e93\u64cd\u4f5c\u90fd\u4f1a\u5199\u5165\u5230\u4e0b\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\u3002 mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 1648 | | mysql-bin.000002 | 677 | | mysql-bin.000003 | 613 | | mysql-bin.000004 | 554 | | mysql-bin.000005 | 1239 | | mysql-bin.000006 | 177 | | mysql-bin.000007 | 1749 | | mysql-bin.000008 | 201 | | mysql-bin.000009 | 2246 | | mysql-bin.000010 | 10105 | | mysql-bin.000011 | 1105 | | mysql-bin.000012 | 7882 | | mysql-bin.000013 | 1786 | +------------------+-----------+ 13 rows in set (0.00 sec) mysql> flush logs; Query OK, 0 rows affected (0.07 sec) mysql> show master logs; +------------------+-----------+ | Log_name | File_size | +------------------+-----------+ | mysql-bin.000001 | 1648 | | mysql-bin.000002 | 677 | | mysql-bin.000003 | 613 | | mysql-bin.000004 | 554 | | mysql-bin.000005 | 1239 | | mysql-bin.000006 | 177 | | mysql-bin.000007 | 1749 | | mysql-bin.000008 | 201 | | mysql-bin.000009 | 2246 | | mysql-bin.000010 | 10105 | | mysql-bin.000011 | 1105 | | mysql-bin.000012 | 7882 | | mysql-bin.000013 | 1833 | | mysql-bin.000014 | 154 | +------------------+-----------+ 14 rows in set (0.00 sec) \u63a5\u4e0b\u6765\uff0c\u8bfb\u53d6binlog\u65e5\u5fd7\uff0c\u5206\u6790\u95ee\u9898\u3002\u767b\u5f55\u670d\u52a1\u5668\uff0c\u5e76\u67e5\u770b(\u63a8\u8350\u6b64\u79cd\u65b9\u6cd5) mysql> show binlog events in 'mysql-bin.000013'\\G; *************************** 1. row *************************** Log_name: mysql-bin.000013 Pos: 4 Event_type: Format_desc Server_id: 1 End_log_pos: 123 Info: Server ver: 5.7.25-0ubuntu0.16.04.2-log, Binlog ver: 4 *************************** 2. row *************************** Log_name: mysql-bin.000013 Pos: 123 Event_type: Previous_gtids Server_id: 1 End_log_pos: 154 Info: *************************** 3. row *************************** Log_name: mysql-bin.000013 Pos: 154 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 219 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 4. row *************************** Log_name: mysql-bin.000013 Pos: 219 Event_type: Query Server_id: 1 End_log_pos: 298 Info: BEGIN *************************** 5. row *************************** Log_name: mysql-bin.000013 Pos: 298 Event_type: Rows_query Server_id: 1 End_log_pos: 374 Info: # insert into cmz(name,age,score) values(\"cmz5\",58,88) *************************** 6. row *************************** Log_name: mysql-bin.000013 Pos: 374 Event_type: Table_map Server_id: 1 End_log_pos: 427 Info: table_id: 133 (summer.cmz) *************************** 7. row *************************** Log_name: mysql-bin.000013 Pos: 427 Event_type: Write_rows Server_id: 1 End_log_pos: 480 Info: table_id: 133 flags: STMT_END_F *************************** 8. row *************************** Log_name: mysql-bin.000013 Pos: 480 Event_type: Xid Server_id: 1 End_log_pos: 511 Info: COMMIT /* xid=516 */ *************************** 9. row *************************** Log_name: mysql-bin.000013 Pos: 511 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 576 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 10. row *************************** Log_name: mysql-bin.000013 Pos: 576 Event_type: Query Server_id: 1 End_log_pos: 655 Info: BEGIN *************************** 11. row *************************** Log_name: mysql-bin.000013 Pos: 655 Event_type: Rows_query Server_id: 1 End_log_pos: 731 Info: # insert into cmz(name,age,score) values(\"cmz6\",68,88) *************************** 12. row *************************** Log_name: mysql-bin.000013 Pos: 731 Event_type: Table_map Server_id: 1 End_log_pos: 784 Info: table_id: 133 (summer.cmz) *************************** 13. row *************************** Log_name: mysql-bin.000013 Pos: 784 Event_type: Write_rows Server_id: 1 End_log_pos: 837 Info: table_id: 133 flags: STMT_END_F *************************** 14. row *************************** Log_name: mysql-bin.000013 Pos: 837 Event_type: Xid Server_id: 1 End_log_pos: 868 Info: COMMIT /* xid=517 */ *************************** 15. row *************************** Log_name: mysql-bin.000013 Pos: 868 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 933 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 16. row *************************** Log_name: mysql-bin.000013 Pos: 933 Event_type: Query Server_id: 1 End_log_pos: 1012 Info: BEGIN *************************** 17. row *************************** Log_name: mysql-bin.000013 Pos: 1012 Event_type: Rows_query Server_id: 1 End_log_pos: 1076 Info: # update cmz set age=100 where name='cmz1' *************************** 18. row *************************** Log_name: mysql-bin.000013 Pos: 1076 Event_type: Table_map Server_id: 1 End_log_pos: 1129 Info: table_id: 133 (summer.cmz) *************************** 19. row *************************** Log_name: mysql-bin.000013 Pos: 1129 Event_type: Update_rows Server_id: 1 End_log_pos: 1201 Info: table_id: 133 flags: STMT_END_F *************************** 20. row *************************** Log_name: mysql-bin.000013 Pos: 1201 Event_type: Xid Server_id: 1 End_log_pos: 1232 Info: COMMIT /* xid=520 */ *************************** 21. row *************************** Log_name: mysql-bin.000013 Pos: 1232 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 1297 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 22. row *************************** Log_name: mysql-bin.000013 Pos: 1297 Event_type: Query Server_id: 1 End_log_pos: 1376 Info: BEGIN *************************** 23. row *************************** Log_name: mysql-bin.000013 Pos: 1376 Event_type: Rows_query Server_id: 1 End_log_pos: 1440 Info: # update cmz set age=200 where name='cmz2' *************************** 24. row *************************** Log_name: mysql-bin.000013 Pos: 1440 Event_type: Table_map Server_id: 1 End_log_pos: 1493 Info: table_id: 133 (summer.cmz) *************************** 25. row *************************** Log_name: mysql-bin.000013 Pos: 1493 Event_type: Update_rows Server_id: 1 End_log_pos: 1565 Info: table_id: 133 flags: STMT_END_F *************************** 26. row *************************** Log_name: mysql-bin.000013 Pos: 1565 Event_type: Xid Server_id: 1 End_log_pos: 1596 Info: COMMIT /* xid=521 */ *************************** 27. row *************************** Log_name: mysql-bin.000013 Pos: 1596 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 1661 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 28. row *************************** Log_name: mysql-bin.000013 Pos: 1661 Event_type: Query Server_id: 1 End_log_pos: 1786 Info: use `summer`; DROP TABLE `cmz` /* generated by server */ *************************** 29. row *************************** Log_name: mysql-bin.000013 Pos: 1786 Event_type: Rotate Server_id: 1 End_log_pos: 1833 Info: mysql-bin.000014;pos=4 29 rows in set (0.00 sec) ERROR: No query specified \u901a\u8fc7\u5206\u6790\uff0c\u9020\u6210\u6570\u636e\u5e93\u7834\u574f\u7684pos\u70b9\u533a\u95f4\u662f\u4ecb\u4e8e 1661--1786 \u4e4b\u95f4\uff08\u8fd9\u662f\u6309\u7167\u65e5\u5fd7\u533a\u95f4\u7684pos\u8282\u70b9\u7b97\u7684\uff09\uff0c\u56e0\u4e3a\u5728\u4e0a\u9762\u7684binlog\u65e5\u5fd7\u770b\u51fa\u572828 row\u770b\u5230\u6267\u884c\u4e86drop\u6307\u4ee4\uff0c\u53ea\u8981\u6062\u590d\u52301661\u4e4b\u524d\u5c31\u53ef\u3002","title":"5.2 \u5f00\u5de5"},{"location":"mysql/mysql.restore_data/#53","text":"","title":"5.3 \u5f00\u59cb\u6062\u590d"},{"location":"mysql/mysql.restore_data/#531-0","text":"\u5feb\u901f\u547d\u4ee4 cd /mysqldataback/ gzip -d summer_2019-03-01.sql.gz mysql -uroot -proot -v < summer_2019-03-01.sql \u64cd\u4f5c\u8fc7\u7a0b root@manage01:/var/log/mysql# cd /mysqldataback/ root@manage01:/mysqldataback# ls mysql-bin.000004 summer_2019-03-01.sql.gz root@manage01:/mysqldataback# gzip -d summer_2019-03-01.sql.gz root@manage01:/mysqldataback# ls mysql-bin.000004 summer_2019-03-01.sql root@manage01:/mysqldataback# mysql -uroot -proot -v < summer_2019-03-01.sql mysql: [Warning] Using a password on the command line interface can be insecure. -------------- /*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */ -------------- -------------- /*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */ -------------- -------------- /*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */ -------------- -------------- /*!40101 SET NAMES utf8 */ -------------- -------------- /*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */ -------------- -------------- /*!40103 SET TIME_ZONE='+00:00' */ -------------- -------------- /*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */ -------------- -------------- /*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */ -------------- -------------- /*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */ -------------- -------------- /*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */ -------------- -------------- CREATE DATABASE /*!32312 IF NOT EXISTS*/ `summer` /*!40100 DEFAULT CHARACTER SET utf8 */ -------------- -------------- DROP TABLE IF EXISTS `cmz` -------------- -------------- /*!40101 SET @saved_cs_client = @@character_set_client */ -------------- -------------- /*!40101 SET character_set_client = utf8 */ -------------- -------------- CREATE TABLE `cmz` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(20) DEFAULT NULL, `age` int(11) NOT NULL, `score` int(11) NOT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8 -------------- -------------- /*!40101 SET character_set_client = @saved_cs_client */ -------------- -------------- LOCK TABLES `cmz` WRITE -------------- -------------- /*!40000 ALTER TABLE `cmz` DISABLE KEYS */ -------------- -------------- INSERT INTO `cmz` VALUES (1,'cmz1',18,88),(3,'cmz2',28,88),(5,'cmz3',38,88),(7,'cmz4',48,88) -------------- -------------- /*!40000 ALTER TABLE `cmz` ENABLE KEYS */ -------------- -------------- UNLOCK TABLES -------------- -------------- /*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */ -------------- -------------- /*!40101 SET SQL_MODE=@OLD_SQL_MODE */ -------------- -------------- /*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */ -------------- -------------- /*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */ -------------- -------------- /*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */ -------------- -------------- /*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */ -------------- -------------- /*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */ -------------- -------------- /*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */ -------------- \u767b\u5f55\u67e5\u770b\uff0c0\u70b9\u65f6\u5019\u5907\u4efd\u7684sql\u662f\u5426\u6062\u590d\u8fc7\u6765\u4e86\u3002 mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +------------------+ | Tables_in_summer | +------------------+ | cmz | +------------------+ 1 row in set (0,00 sec) mysql> select * from cmz; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 2 | cmz1 | 18 | 88 | | 4 | cmz2 | 28 | 88 | | 6 | cmz3 | 38 | 88 | | 8 | cmz4 | 48 | 88 | +----+------+-----+-------+ 4 rows in set (0,00 sec) \u8fd9\u6837\u5c31\u6062\u590d\u4e86\u622a\u81f3\u5f53\u65e5\u51cc\u6668(0:00)\u524d\u7684\u5907\u4efd\u6570\u636e\u90fd\u6062\u590d\u4e86\u3002\u4f46\u662f\u8fd9\u4e2a\u4ec5\u4ec5\u53ea0\u70b9\u5907\u4efd\u7684\u65f6\u5019\uff0c0\u70b9\u4ee5\u540e\u5230drop\u4e4b\u95f4\u7684\u6570\u636e\u600e\u4e48\u6062\u590d\u5462","title":"5.3.1 \u6062\u590d\u4e4b\u524d0\u70b9\u5907\u4efd"},{"location":"mysql/mysql.restore_data/#532-1-sql","text":"\u8bed\u6cd5 mysqlbinlog mysql-bin.0000xx | mysql -u\u7528\u6237\u540d -p\u5bc6\u7801 \u6570\u636e\u5e93\u540d \u53c2\u6570\u89e3\u91ca \u5e38\u7528\u53c2\u6570\u9009\u9879\u89e3\u91ca\uff1a -- start - position = 875 \u8d77\u59cb pos\u70b9 -- stop - position = 954 \u7ed3\u675f pos\u70b9 -- start - datetime = \"2016-9-25 22:01:08\" \u8d77\u59cb\u65f6\u95f4\u70b9 -- stop - datetime = \"2019-9-25 22:09:46\" \u7ed3\u675f\u65f6\u95f4\u70b9 -- database = zyyshop \u6307\u5b9a\u53ea\u6062\u590d zyyshop\u6570\u636e\u5e93 ( \u4e00\u53f0\u4e3b\u673a\u4e0a\u5f80\u5f80\u6709\u591a\u4e2a\u6570\u636e\u5e93\uff0c\u53ea\u9650\u672c\u5730 log\u65e5\u5fd7 ) \u4e0d\u5e38\u7528\u9009\u9879\uff1a - u -- user = name \u8fde\u63a5\u5230\u8fdc\u7a0b\u4e3b\u673a\u7684\u7528\u6237\u540d - p -- password [ = name ] \u8fde\u63a5\u5230\u8fdc\u7a0b\u4e3b\u673a\u7684\u5bc6\u7801 - h -- host = name \u4ece\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u83b7\u53d6 binlog\u65e5\u5fd7 -- read - from - remote - server \u4ece\u67d0\u4e2a MySQL\u670d\u52a1\u5668\u4e0a\u8bfb\u53d6binlog\u65e5\u5fd7 \u5b9e\u9645\u662f\u5c06\u8bfb\u51fa\u7684 binlog\u65e5\u5fd7\u5185\u5bb9 \uff0c\u901a\u8fc7\u7ba1\u9053\u7b26\u4f20\u9012\u7ed9 mysql\u547d\u4ee4 \u3002\u8fd9\u4e9b\u547d\u4ee4\u3001\u6587\u4ef6\u5c3d\u91cf\u5199\u6210\u7edd\u5bf9\u8def\u5f84\uff1b \u77e5\u9053\u4e86\u8fd9\u4e48\u6062\u590d\u7684\u8bdd\uff0c\u5f00\u59cb\u6062\u590d\u5907\u4efd\u4e4b\u540e\u5230drop\u4e4b\u95f4\u7684\u6570\u636e\u3002 \u8981\u7f16\u8f91\u90a3\u4e2amysql-bin.000004 \u6587\u4ef6\u3002\u5c06drop\u90a3\u6761\u547d\u4ee4\u53bb\u6389\u3002 root@leco:/mysqldataback# cp /var/log/mysql/mysql-bin.000013 . root@leco:/mysqldataback# ls mysql-bin.000013 summer_2019-03-01.sql root@leco:/mysqldataback# mysqlbinlog mysql-bin.000013 >mysql-bin.000013.sql root@leco:/mysqldataback# ls mysql-bin.000013 mysql-bin.000013.sql summer_2019-03-01.sql root@leco:/mysqldataback# vim mysql-bin.000013.sql root@leco:/mysqldataback# # DROP TABLE `cmz` /* generated by server */ \u5220\u9664\u8fd9\u4e2a\u8bed\u53e5 root@leco:/mysqldataback# mysql -uroot -proot <mysql-bin.000013.sql mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 1790 (HY000) at line 122: @@SESSION.GTID_NEXT cannot be changed by a client that owns a GTID. The client owns ANONYMOUS. Ownership is released on COMMIT or ROLLBACK. \u767b\u5f55\u6570\u636e\u5e93\u67e5\u770b mysql> use summer; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> select * from cmz; +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | cmz1 | 100 | 88 | | 3 | cmz2 | 200 | 88 | | 5 | cmz3 | 38 | 88 | | 7 | cmz4 | 48 | 88 | | 9 | cmz5 | 58 | 88 | | 11 | cmz6 | 68 | 88 | +----+------+-----+-------+ 6 rows in set (0.00 sec) \u8fd9\u6837\u6570\u636e\u5c31\u5168\u90e8\u6062\u590d\u51fa\u6765\u4e86\u3002\u6062\u590d\u6570\u636e\u4e00\u5171\u4e24\u4e2a\u70b9 \u5148\u6062\u590d\u6700\u8fd1\u5907\u4efd\u90a3\u4e2a\u70b9\uff0c\u4e5f\u5c31\u662f\u4e0a\u9762\u76840\u70b9\u5907\u4efd\u7684\u6587\u4ef6 \u7136\u540e\u518d\u6062\u590d\u65e0\u64cd\u4f5c\u4e4b\u524d\u7684\u6587\u4ef6\uff0c\u5c31\u53ef\u4ee5\u6062\u590d\u4ee5\u4e0a\u6570\u636e\u3002","title":"5.3.2 \u65b9\u6cd51 - \u6062\u590d-\u4fee\u6539\u9519sql"},{"location":"mysql/mysql.restore_data/#533-2-","text":"\u5220\u9664\u8868 mysql> show tables; +------------------+ | Tables_in_summer | +------------------+ | cmz | +------------------+ 1 row in set (0.00 sec) mysql> drop table cmz; Query OK, 0 rows affected (0.04 sec) mysql> show tables; Empty set (0.00 sec) \u5f00\u59cb\u6062\u590d\u3002 root@leco:/mysqldataback# ll \u603b\u7528\u91cf 24 drwxr-xr-x 2 root root 4096 3\u6708 1 17:35 ./ drwxr-xr-x 33 root root 4096 3\u6708 1 16:10 ../ -rw-r----- 1 root root 1833 3\u6708 1 17:34 mysql-bin.000013 # \u6700\u521d\u5220\u9664drop table cmz\uff0c\u5c31\u662f\u8bb0\u5f55\u5728\u8fd9\u4e2abinlog\u4e2d\u7684\u3002 -rw-r--r-- 1 root root 5432 3\u6708 1 17:35 mysql-bin.000013.sql -rw-r--r-- 1 root root 2331 3\u6708 1 17:21 summer_2019-03-01.sql root@leco:/mysqldataback# \u6211\u4eec\u67e5\u770bsql\u7684\u6267\u884c\u60c5\u51b5 mysql> show binlog events in 'mysql-bin.000013'\\G; *************************** 1. row *************************** Log_name: mysql-bin.000013 Pos: 4 Event_type: Format_desc Server_id: 1 End_log_pos: 123 Info: Server ver: 5.7.25-0ubuntu0.16.04.2-log, Binlog ver: 4 *************************** 2. row *************************** Log_name: mysql-bin.000013 Pos: 123 Event_type: Previous_gtids Server_id: 1 End_log_pos: 154 Info: *************************** 3. row *************************** Log_name: mysql-bin.000013 Pos: 154 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 219 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 4. row *************************** Log_name: mysql-bin.000013 Pos: 219 Event_type: Query Server_id: 1 End_log_pos: 298 Info: BEGIN *************************** 5. row *************************** Log_name: mysql-bin.000013 Pos: 298 Event_type: Rows_query Server_id: 1 End_log_pos: 374 Info: # insert into cmz(name,age,score) values(\"cmz5\",58,88) *************************** 6. row *************************** Log_name: mysql-bin.000013 Pos: 374 Event_type: Table_map Server_id: 1 End_log_pos: 427 Info: table_id: 133 (summer.cmz) *************************** 7. row *************************** Log_name: mysql-bin.000013 Pos: 427 Event_type: Write_rows Server_id: 1 End_log_pos: 480 Info: table_id: 133 flags: STMT_END_F *************************** 8. row *************************** Log_name: mysql-bin.000013 Pos: 480 Event_type: Xid Server_id: 1 End_log_pos: 511 Info: COMMIT /* xid=516 */ *************************** 9. row *************************** Log_name: mysql-bin.000013 Pos: 511 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 576 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 10. row *************************** Log_name: mysql-bin.000013 Pos: 576 Event_type: Query Server_id: 1 End_log_pos: 655 Info: BEGIN *************************** 11. row *************************** Log_name: mysql-bin.000013 Pos: 655 Event_type: Rows_query Server_id: 1 End_log_pos: 731 Info: # insert into cmz(name,age,score) values(\"cmz6\",68,88) *************************** 12. row *************************** Log_name: mysql-bin.000013 Pos: 731 Event_type: Table_map Server_id: 1 End_log_pos: 784 Info: table_id: 133 (summer.cmz) *************************** 13. row *************************** Log_name: mysql-bin.000013 Pos: 784 Event_type: Write_rows Server_id: 1 End_log_pos: 837 Info: table_id: 133 flags: STMT_END_F *************************** 14. row *************************** Log_name: mysql-bin.000013 Pos: 837 Event_type: Xid Server_id: 1 End_log_pos: 868 Info: COMMIT /* xid=517 */ *************************** 15. row *************************** Log_name: mysql-bin.000013 Pos: 868 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 933 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 16. row *************************** Log_name: mysql-bin.000013 Pos: 933 Event_type: Query Server_id: 1 End_log_pos: 1012 Info: BEGIN *************************** 17. row *************************** Log_name: mysql-bin.000013 Pos: 1012 Event_type: Rows_query Server_id: 1 End_log_pos: 1076 Info: # update cmz set age=100 where name='cmz1' *************************** 18. row *************************** Log_name: mysql-bin.000013 Pos: 1076 Event_type: Table_map Server_id: 1 End_log_pos: 1129 Info: table_id: 133 (summer.cmz) *************************** 19. row *************************** Log_name: mysql-bin.000013 Pos: 1129 Event_type: Update_rows Server_id: 1 End_log_pos: 1201 Info: table_id: 133 flags: STMT_END_F *************************** 20. row *************************** Log_name: mysql-bin.000013 Pos: 1201 Event_type: Xid Server_id: 1 End_log_pos: 1232 Info: COMMIT /* xid=520 */ *************************** 21. row *************************** Log_name: mysql-bin.000013 Pos: 1232 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 1297 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 22. row *************************** Log_name: mysql-bin.000013 Pos: 1297 Event_type: Query Server_id: 1 End_log_pos: 1376 Info: BEGIN *************************** 23. row *************************** Log_name: mysql-bin.000013 Pos: 1376 Event_type: Rows_query Server_id: 1 End_log_pos: 1440 Info: # update cmz set age=200 where name='cmz2' *************************** 24. row *************************** Log_name: mysql-bin.000013 Pos: 1440 Event_type: Table_map Server_id: 1 End_log_pos: 1493 Info: table_id: 133 (summer.cmz) *************************** 25. row *************************** Log_name: mysql-bin.000013 Pos: 1493 Event_type: Update_rows Server_id: 1 End_log_pos: 1565 Info: table_id: 133 flags: STMT_END_F *************************** 26. row *************************** Log_name: mysql-bin.000013 Pos: 1565 Event_type: Xid Server_id: 1 End_log_pos: 1596 Info: COMMIT /* xid=521 */ *************************** 27. row *************************** Log_name: mysql-bin.000013 Pos: 1596 Event_type: Anonymous_Gtid Server_id: 1 End_log_pos: 1661 Info: SET @@SESSION.GTID_NEXT= 'ANONYMOUS' *************************** 28. row *************************** Log_name: mysql-bin.000013 Pos: 1661 Event_type: Query Server_id: 1 End_log_pos: 1786 Info: use `summer`; DROP TABLE `cmz` /* generated by server */ *************************** 29. row *************************** Log_name: mysql-bin.000013 Pos: 1786 Event_type: Rotate Server_id: 1 End_log_pos: 1833 Info: mysql-bin.000014;pos=4 29 rows in set (0.00 sec) ERROR: No query specified \u4ece\u4e0a\u9762\u53ef\u4ee5\u770b\u5230\u3002\u5728drop\u7684\u65f6\u5019\u3002mysql\u7684pos\u5f00\u59cb\u81f31661\u7ed3\u675f1786\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u6062\u590d\u52301661\uff0c\u5373\u53ef\u3002 \u5f00\u59cb\u6062\u590d # \u5148\u6062\u590d\u4e4b\u524d\u5168\u5907\u4efd root@leco:/mysqldataback# mysql -uroot -proot <summer_2019-03-01.sql # \u7136\u540e\u6839\u636epos\u4f4d\u7f6e\u6062\u590d root@leco:/mysqldataback# mysqlbinlog --stop-position=1661 mysql-bin.000013| mysql -uroot -proot mysql: [Warning] Using a password on the command line interface can be insecure. root@leco:/mysqldataback# mysql -uroot -proot -e 'use summer;select * from cmz;' mysql: [Warning] Using a password on the command line interface can be insecure. +----+------+-----+-------+ | id | name | age | score | +----+------+-----+-------+ | 1 | cmz1 | 100 | 88 | | 3 | cmz2 | 200 | 88 | | 5 | cmz3 | 38 | 88 | | 7 | cmz4 | 48 | 88 | | 9 | cmz5 | 58 | 88 | | 11 | cmz6 | 68 | 88 | +----+------+-----+-------+ \u7136\u540e\u770b\u5230\uff0c\u6570\u636e\u90fd\u6062\u590d\u4e86\u3002 \u603b\u7ed3 \u6240\u8c13\u6062\u590d\uff0c\u5c31\u662f\u8ba9 mysql\u5c06\u4fdd\u5b58\u5728binlog\u65e5\u5fd7\u4e2d\u6307\u5b9a\u6bb5\u843d\u533a\u95f4\u7684sql\u8bed\u53e5\u9010\u4e2a\u91cd\u65b0\u6267\u884c\u4e00\u6b21\u800c\u5df2 \u3002","title":"5.3.3 \u65b9\u6cd52 - \u6062\u590d- \u70b9"},{"location":"mysql/mysql.select/","text":"MySQL SELECT 1. \u4ecb\u7ecd \u00b6 \u6211\u4eec\u6267\u884c\u7684SQL\u6267\u884c\u987a\u5e8f (8)SELECT (9)DISTINCT (11)<Top Num> <select list> (1)FROM [left_table] (3)<join_type> JOIN <right_table> (2) ON <join_condition> (4)WHERE <where_condition> (5)GROUP BY <group_by_list> (6)WITH <CUBE | RollUP> (7)HAVING <having_condition> (10)ORDER BY <order_by_list> 2. select \u7528\u6cd5 \u00b6 SELECT \u8bed\u53e5\u7528\u4e8e\u4ece\u8868\u4e2d\u9009\u53d6\u6570\u636e\u3002\u7ed3\u679c\u88ab\u5b58\u50a8\u5728\u4e00\u4e2a\u7ed3\u679c\u8868\u4e2d\uff08\u79f0\u4e3a\u7ed3\u679c\u96c6\uff09\uff0c\u57fa\u672c\u8bed\u6cd5\u5982\u4e0b: 2.1 \u663e\u793a\u5b57\u6bb5 \u00b6 SELECT \u5217\u540d\u79f0 FROM \u8868\u540d\u79f0; \u4f8b\u5b50 mysql> select name from leco; +--------+ | name | +--------+ | \u5f20\u4e09 | | \u674e\u56db | | \u738b\u4e94 | | \u8d75\u516d | +--------+ 4 rows in set (0.00 sec) mysql> mysql> select name,age from leco; +--------+------+ | name | age | +--------+------+ | \u5f20\u4e09 | 18 | | \u674e\u56db | 20 | | \u738b\u4e94 | 30 | | \u8d75\u516d | 40 | +--------+------+ 4 rows in set (0.00 sec) 2.2 \u663e\u793a\u6240\u6709\u5b57\u6bb5 \u00b6 SELECT * FROM \u8868\u540d\u79f0; \u6ce8\u610f 1. \u661f\u53f7\uff0c\u8868\u793a\u6240\u6709\uff0c\u6570\u636e\u6bd4\u8f83\u5927\u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u4e0d\u80fd\u76f4\u63a5\u8fd9\u6837\u4f7f\u7528 \u4f8b\u5b50 mysql> use cmz; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec) \u6ce8\u610f 1. mysql\u7684sql\u8bed\u53e5\u4e0d\u533a\u5206\u5927\u5c0f\u5199 2. \u6240\u6709 select \u7b49\u4e8e SELECT \uff0c\u6211\u4e60\u60ef\u5c0f\u5199 3. \u6ce8\u610f\u70b9 \u00b6 SELECT\u5c31\u662f\u6570\u636e\u5e93\u4e2d\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u80fd\u67e5\u8be2\u4f60\u60f3\u8981\u7684\u6570\u636e\uff0c\u6bd4\u5982\u6240\u6709\u4eba\u5458\u7684\u4fe1\u606f\u5305\u62ecID\uff0c\u59d3\u540d\uff0c\u6027\u522b\uff0c\u5e74\u9f84\uff0c\u7b49\u3002\u4e5f\u53ef\u4ee5\u9009\u62e9\u5176\u4e2d\u4e00\u90e8\u5206\u3002","title":"06. SQL SELECT"},{"location":"mysql/mysql.select/#1","text":"\u6211\u4eec\u6267\u884c\u7684SQL\u6267\u884c\u987a\u5e8f (8)SELECT (9)DISTINCT (11)<Top Num> <select list> (1)FROM [left_table] (3)<join_type> JOIN <right_table> (2) ON <join_condition> (4)WHERE <where_condition> (5)GROUP BY <group_by_list> (6)WITH <CUBE | RollUP> (7)HAVING <having_condition> (10)ORDER BY <order_by_list>","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.select/#2-select","text":"SELECT \u8bed\u53e5\u7528\u4e8e\u4ece\u8868\u4e2d\u9009\u53d6\u6570\u636e\u3002\u7ed3\u679c\u88ab\u5b58\u50a8\u5728\u4e00\u4e2a\u7ed3\u679c\u8868\u4e2d\uff08\u79f0\u4e3a\u7ed3\u679c\u96c6\uff09\uff0c\u57fa\u672c\u8bed\u6cd5\u5982\u4e0b:","title":"2. select \u7528\u6cd5"},{"location":"mysql/mysql.select/#21","text":"SELECT \u5217\u540d\u79f0 FROM \u8868\u540d\u79f0; \u4f8b\u5b50 mysql> select name from leco; +--------+ | name | +--------+ | \u5f20\u4e09 | | \u674e\u56db | | \u738b\u4e94 | | \u8d75\u516d | +--------+ 4 rows in set (0.00 sec) mysql> mysql> select name,age from leco; +--------+------+ | name | age | +--------+------+ | \u5f20\u4e09 | 18 | | \u674e\u56db | 20 | | \u738b\u4e94 | 30 | | \u8d75\u516d | 40 | +--------+------+ 4 rows in set (0.00 sec)","title":"2.1 \u663e\u793a\u5b57\u6bb5"},{"location":"mysql/mysql.select/#22","text":"SELECT * FROM \u8868\u540d\u79f0; \u6ce8\u610f 1. \u661f\u53f7\uff0c\u8868\u793a\u6240\u6709\uff0c\u6570\u636e\u6bd4\u8f83\u5927\u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u4e0d\u80fd\u76f4\u63a5\u8fd9\u6837\u4f7f\u7528 \u4f8b\u5b50 mysql> use cmz; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec) \u6ce8\u610f 1. mysql\u7684sql\u8bed\u53e5\u4e0d\u533a\u5206\u5927\u5c0f\u5199 2. \u6240\u6709 select \u7b49\u4e8e SELECT \uff0c\u6211\u4e60\u60ef\u5c0f\u5199","title":"2.2 \u663e\u793a\u6240\u6709\u5b57\u6bb5"},{"location":"mysql/mysql.select/#3","text":"SELECT\u5c31\u662f\u6570\u636e\u5e93\u4e2d\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u80fd\u67e5\u8be2\u4f60\u60f3\u8981\u7684\u6570\u636e\uff0c\u6bd4\u5982\u6240\u6709\u4eba\u5458\u7684\u4fe1\u606f\u5305\u62ecID\uff0c\u59d3\u540d\uff0c\u6027\u522b\uff0c\u5e74\u9f84\uff0c\u7b49\u3002\u4e5f\u53ef\u4ee5\u9009\u62e9\u5176\u4e2d\u4e00\u90e8\u5206\u3002","title":"3. \u6ce8\u610f\u70b9"},{"location":"mysql/mysql.storage_engine/","text":"MySQL \u5b58\u50a8\u5f15\u64ce 1. \u4ecb\u7ecd \u00b6 \u4ec0\u4e48\u662f\u5b58\u50a8\u5f15\u64ce mysql\u4e2d\u5efa\u7acb\u7684\u5e93===>\u6587\u4ef6\u5939 \u5e93\u4e2d\u5efa\u7acb\u7684\u8868===>\u6587\u4ef6 \u5b58\u50a8\u5f15\u64ce\u5c31\u662f\u8868\u7684\u7c7b\u578b \u73b0\u5b9e\u751f\u6d3b\u4e2d\u6211\u4eec\u7528\u6765\u5b58\u50a8\u6570\u636e\u7684\u6587\u4ef6\u6709\u4e0d\u540c\u7684\u7c7b\u578b\uff0c\u6bcf\u79cd\u6587\u4ef6\u7c7b\u578b\u5bf9\u5e94\u5404\u81ea\u4e0d\u540c\u7684\u5904\u7406\u673a\u5236\uff1a\u6bd4\u5982\u5904\u7406\u6587\u672c\u7528txt\u7c7b\u578b\uff0c\u5904\u7406\u8868\u683c\u7528excel\uff0c\u5904\u7406\u56fe\u7247\u7528png\u7b49 \u6570\u636e\u5e93\u4e2d\u7684\u8868\u4e5f\u5e94\u8be5\u6709\u4e0d\u540c\u7684\u7c7b\u578b\uff0c\u8868\u7684\u7c7b\u578b\u4e0d\u540c\uff0c\u4f1a\u5bf9\u5e94mysql\u4e0d\u540c\u7684\u5b58\u53d6\u673a\u5236\uff0c\u8868\u7c7b\u578b\u53c8\u79f0\u4e3a\u5b58\u50a8\u5f15\u64ce\u3002 \u5b58\u50a8\u5f15\u64ce\u8bf4\u767d\u4e86\u5c31\u662f\u5982\u4f55\u5b58\u50a8\u6570\u636e\u3001\u5982\u4f55\u4e3a\u5b58\u50a8\u7684\u6570\u636e\u5efa\u7acb\u7d22\u5f15\u548c\u5982\u4f55\u66f4\u65b0\u3001\u67e5\u8be2\u6570\u636e\u7b49\u6280\u672f\u7684\u5b9e\u73b0\u65b9 \u6cd5\u3002\u56e0\u4e3a\u5728\u5173\u7cfb\u6570\u636e\u5e93\u4e2d\u6570\u636e\u7684\u5b58\u50a8\u662f\u4ee5\u8868\u7684\u5f62\u5f0f\u5b58\u50a8\u7684\uff0c\u6240\u4ee5\u5b58\u50a8\u5f15\u64ce\u4e5f\u53ef\u4ee5\u79f0\u4e3a\u8868\u7c7b\u578b\uff08\u5373\u5b58\u50a8\u548c \u64cd\u4f5c\u6b64\u8868\u7684\u7c7b\u578b\uff09 \u5728Oracle \u548cSQL Server\u7b49\u6570\u636e\u5e93\u4e2d\u53ea\u6709\u4e00\u79cd\u5b58\u50a8\u5f15\u64ce\uff0c\u6240\u6709\u6570\u636e\u5b58\u50a8\u7ba1\u7406\u673a\u5236\u90fd\u662f\u4e00\u6837\u7684\u3002\u800cMySql \u6570\u636e\u5e93\u63d0\u4f9b\u4e86\u591a\u79cd\u5b58\u50a8\u5f15\u64ce\u3002\u7528\u6237\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u9700\u6c42\u4e3a\u6570\u636e\u8868\u9009\u62e9\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u7528\u6237\u4e5f\u53ef\u4ee5\u6839\u636e \u81ea\u5df1\u7684\u9700\u8981\u7f16\u5199\u81ea\u5df1\u7684\u5b58\u50a8\u5f15\u64ce 2. mysql\u652f\u6301\u7684\u5b58\u50a8\u5f15\u64ce \u00b6 mysql> show engines\\G; *************************** 1. row *************************** Engine: MyISAM Support: YES Comment: MyISAM storage engine Transactions: NO XA: NO Savepoints: NO *************************** 2. row *************************** Engine: MRG_MYISAM Support: YES Comment: Collection of identical MyISAM tables Transactions: NO XA: NO Savepoints: NO *************************** 3. row *************************** Engine: CSV Support: YES Comment: CSV storage engine Transactions: NO XA: NO Savepoints: NO *************************** 4. row *************************** Engine: BLACKHOLE Support: YES Comment: /dev/null storage engine (anything you write to it disappears) Transactions: NO XA: NO Savepoints: NO *************************** 5. row *************************** Engine: PERFORMANCE_SCHEMA Support: YES Comment: Performance Schema Transactions: NO XA: NO Savepoints: NO *************************** 6. row *************************** Engine: InnoDB Support: DEFAULT Comment: Supports transactions, row-level locking, and foreign keys Transactions: YES XA: YES Savepoints: YES *************************** 7. row *************************** Engine: ARCHIVE Support: YES Comment: Archive storage engine Transactions: NO XA: NO Savepoints: NO *************************** 8. row *************************** Engine: MEMORY Support: YES Comment: Hash based, stored in memory, useful for temporary tables Transactions: NO XA: NO Savepoints: NO *************************** 9. row *************************** Engine: FEDERATED Support: NO Comment: Federated MySQL storage engine Transactions: NULL XA: NULL Savepoints: NULL rows in set (0.00 sec) ERROR: No query specified mysql> show engines; +--------------------+---------+----------------------------------------------------------------+--------------+------+------------+ | Engine | Support | Comment | Transactions | XA | Savepoints | +--------------------+---------+----------------------------------------------------------------+--------------+------+------------+ | MyISAM | YES | MyISAM storage engine | NO | NO | NO | | MRG_MYISAM | YES | Collection of identical MyISAM tables | NO | NO | NO | | CSV | YES | CSV storage engine | NO | NO | NO | | BLACKHOLE | YES | /dev/null storage engine (anything you write to it disappears) | NO | NO | NO | | PERFORMANCE_SCHEMA | YES | Performance Schema | NO | NO | NO | | InnoDB | DEFAULT | Supports transactions, row-level locking, and foreign keys | YES | YES | YES | | ARCHIVE | YES | Archive storage engine | NO | NO | NO | | MEMORY | YES | Hash based, stored in memory, useful for temporary tables | NO | NO | NO | | FEDERATED | NO | Federated MySQL storage engine | NULL | NULL | NULL | +--------------------+---------+----------------------------------------------------------------+--------------+------+------------+ rows in set (0.00 sec) mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | t1 | +---------------+ row in set (0.00 sec) # \u521b\u5efa\u6307\u5b9a\u5f15\u64ce\u7684\u8868 mysql> create table t2(id int) engine=innodb; Query OK, 0 rows affected (0.03 sec) # \u67e5\u770b\u521b\u5efa\u7684\u8fc7\u7a0b mysql> show create table t2\\G; *************************** 1. row *************************** Table: t2 Create Table: CREATE TABLE `t2` ( `id` int(11) DEFAULT NULL ) ENGINE=InnoDB DEFAULT CHARSET=utf8 row in set (0.00 sec) ERROR: No query specified # \u5176\u4ed6\u7c7b\u578b\u7684\u5f15\u64ce\u65b9\u5f0f mysql> create table t3(id int) engine=memory; # \u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u53ea\u6709\u8868\u7ed3\u6784\uff0c\u6ca1\u6709\u6570\u636e Query OK, 0 rows affected (0.00 sec) mysql> create table t4(id int) engine=blackhole; # \u5b58\u5165\u7684\u6570\u636e\u5c31\u6ca1\u5566 Query OK, 0 rows affected (0.00 sec) mysql> create table t5(id int) engine=myisam; Query OK, 0 rows affected (0.00 sec) mysql> insert into t3 values(1); Query OK, 1 row affected (0.00 sec) mysql> insert into t4 values(1); Query OK, 1 row affected (0.00 sec) mysql> insert into t5 values(1); Query OK, 1 row affected (0.00 sec) mysql> select * from t3; # \u5b58\u4e8e\u5185\u5b58\uff0c\u91cd\u542fmysql\u5c31\u5566 +------+ | id | +------+ | 1 | +------+ row in set (0.00 sec) mysql> select * from t4; # \u6570\u636e\u6ca1\u6709\u5566\uff0c\u9ed1\u6d1e Empty set (0.00 sec) mysql> select * from t5; +------+ | id | +------+ | 1 | +------+ row in set (0.00 sec) # \u91cd\u542fmysql \u67e5\u770bt3\u7684\u6570\u636e Usage: /etc/init.d/mysql start|stop|restart|reload|force-reload|status leco@leco:/etc/mysql/mysql.conf.d$ /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service. leco@leco:/etc/mysql/mysql.conf.d$ mysql -uroot -pleco mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 3 Server version: 5.7.21-0ubuntu0.16.04.1 (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use db1; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | t1 | | t2 | | t3 | | t4 | | t5 | +---------------+ rows in set (0.00 sec) mysql> desc t3; +-------+---------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+---------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | +-------+---------+------+-----+---------+-------+ row in set (0.00 sec) mysql> select * from t3; # \u53d1\u73b0\u6570\u636e\u4e48\u6709\u5566 Empty set (0.00 sec)","title":"08. \u5b58\u50a8\u5f15\u64ce"},{"location":"mysql/mysql.storage_engine/#1","text":"\u4ec0\u4e48\u662f\u5b58\u50a8\u5f15\u64ce mysql\u4e2d\u5efa\u7acb\u7684\u5e93===>\u6587\u4ef6\u5939 \u5e93\u4e2d\u5efa\u7acb\u7684\u8868===>\u6587\u4ef6 \u5b58\u50a8\u5f15\u64ce\u5c31\u662f\u8868\u7684\u7c7b\u578b \u73b0\u5b9e\u751f\u6d3b\u4e2d\u6211\u4eec\u7528\u6765\u5b58\u50a8\u6570\u636e\u7684\u6587\u4ef6\u6709\u4e0d\u540c\u7684\u7c7b\u578b\uff0c\u6bcf\u79cd\u6587\u4ef6\u7c7b\u578b\u5bf9\u5e94\u5404\u81ea\u4e0d\u540c\u7684\u5904\u7406\u673a\u5236\uff1a\u6bd4\u5982\u5904\u7406\u6587\u672c\u7528txt\u7c7b\u578b\uff0c\u5904\u7406\u8868\u683c\u7528excel\uff0c\u5904\u7406\u56fe\u7247\u7528png\u7b49 \u6570\u636e\u5e93\u4e2d\u7684\u8868\u4e5f\u5e94\u8be5\u6709\u4e0d\u540c\u7684\u7c7b\u578b\uff0c\u8868\u7684\u7c7b\u578b\u4e0d\u540c\uff0c\u4f1a\u5bf9\u5e94mysql\u4e0d\u540c\u7684\u5b58\u53d6\u673a\u5236\uff0c\u8868\u7c7b\u578b\u53c8\u79f0\u4e3a\u5b58\u50a8\u5f15\u64ce\u3002 \u5b58\u50a8\u5f15\u64ce\u8bf4\u767d\u4e86\u5c31\u662f\u5982\u4f55\u5b58\u50a8\u6570\u636e\u3001\u5982\u4f55\u4e3a\u5b58\u50a8\u7684\u6570\u636e\u5efa\u7acb\u7d22\u5f15\u548c\u5982\u4f55\u66f4\u65b0\u3001\u67e5\u8be2\u6570\u636e\u7b49\u6280\u672f\u7684\u5b9e\u73b0\u65b9 \u6cd5\u3002\u56e0\u4e3a\u5728\u5173\u7cfb\u6570\u636e\u5e93\u4e2d\u6570\u636e\u7684\u5b58\u50a8\u662f\u4ee5\u8868\u7684\u5f62\u5f0f\u5b58\u50a8\u7684\uff0c\u6240\u4ee5\u5b58\u50a8\u5f15\u64ce\u4e5f\u53ef\u4ee5\u79f0\u4e3a\u8868\u7c7b\u578b\uff08\u5373\u5b58\u50a8\u548c \u64cd\u4f5c\u6b64\u8868\u7684\u7c7b\u578b\uff09 \u5728Oracle \u548cSQL Server\u7b49\u6570\u636e\u5e93\u4e2d\u53ea\u6709\u4e00\u79cd\u5b58\u50a8\u5f15\u64ce\uff0c\u6240\u6709\u6570\u636e\u5b58\u50a8\u7ba1\u7406\u673a\u5236\u90fd\u662f\u4e00\u6837\u7684\u3002\u800cMySql \u6570\u636e\u5e93\u63d0\u4f9b\u4e86\u591a\u79cd\u5b58\u50a8\u5f15\u64ce\u3002\u7528\u6237\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u9700\u6c42\u4e3a\u6570\u636e\u8868\u9009\u62e9\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u7528\u6237\u4e5f\u53ef\u4ee5\u6839\u636e \u81ea\u5df1\u7684\u9700\u8981\u7f16\u5199\u81ea\u5df1\u7684\u5b58\u50a8\u5f15\u64ce","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.storage_engine/#2-mysql","text":"mysql> show engines\\G; *************************** 1. row *************************** Engine: MyISAM Support: YES Comment: MyISAM storage engine Transactions: NO XA: NO Savepoints: NO *************************** 2. row *************************** Engine: MRG_MYISAM Support: YES Comment: Collection of identical MyISAM tables Transactions: NO XA: NO Savepoints: NO *************************** 3. row *************************** Engine: CSV Support: YES Comment: CSV storage engine Transactions: NO XA: NO Savepoints: NO *************************** 4. row *************************** Engine: BLACKHOLE Support: YES Comment: /dev/null storage engine (anything you write to it disappears) Transactions: NO XA: NO Savepoints: NO *************************** 5. row *************************** Engine: PERFORMANCE_SCHEMA Support: YES Comment: Performance Schema Transactions: NO XA: NO Savepoints: NO *************************** 6. row *************************** Engine: InnoDB Support: DEFAULT Comment: Supports transactions, row-level locking, and foreign keys Transactions: YES XA: YES Savepoints: YES *************************** 7. row *************************** Engine: ARCHIVE Support: YES Comment: Archive storage engine Transactions: NO XA: NO Savepoints: NO *************************** 8. row *************************** Engine: MEMORY Support: YES Comment: Hash based, stored in memory, useful for temporary tables Transactions: NO XA: NO Savepoints: NO *************************** 9. row *************************** Engine: FEDERATED Support: NO Comment: Federated MySQL storage engine Transactions: NULL XA: NULL Savepoints: NULL rows in set (0.00 sec) ERROR: No query specified mysql> show engines; +--------------------+---------+----------------------------------------------------------------+--------------+------+------------+ | Engine | Support | Comment | Transactions | XA | Savepoints | +--------------------+---------+----------------------------------------------------------------+--------------+------+------------+ | MyISAM | YES | MyISAM storage engine | NO | NO | NO | | MRG_MYISAM | YES | Collection of identical MyISAM tables | NO | NO | NO | | CSV | YES | CSV storage engine | NO | NO | NO | | BLACKHOLE | YES | /dev/null storage engine (anything you write to it disappears) | NO | NO | NO | | PERFORMANCE_SCHEMA | YES | Performance Schema | NO | NO | NO | | InnoDB | DEFAULT | Supports transactions, row-level locking, and foreign keys | YES | YES | YES | | ARCHIVE | YES | Archive storage engine | NO | NO | NO | | MEMORY | YES | Hash based, stored in memory, useful for temporary tables | NO | NO | NO | | FEDERATED | NO | Federated MySQL storage engine | NULL | NULL | NULL | +--------------------+---------+----------------------------------------------------------------+--------------+------+------------+ rows in set (0.00 sec) mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | t1 | +---------------+ row in set (0.00 sec) # \u521b\u5efa\u6307\u5b9a\u5f15\u64ce\u7684\u8868 mysql> create table t2(id int) engine=innodb; Query OK, 0 rows affected (0.03 sec) # \u67e5\u770b\u521b\u5efa\u7684\u8fc7\u7a0b mysql> show create table t2\\G; *************************** 1. row *************************** Table: t2 Create Table: CREATE TABLE `t2` ( `id` int(11) DEFAULT NULL ) ENGINE=InnoDB DEFAULT CHARSET=utf8 row in set (0.00 sec) ERROR: No query specified # \u5176\u4ed6\u7c7b\u578b\u7684\u5f15\u64ce\u65b9\u5f0f mysql> create table t3(id int) engine=memory; # \u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u53ea\u6709\u8868\u7ed3\u6784\uff0c\u6ca1\u6709\u6570\u636e Query OK, 0 rows affected (0.00 sec) mysql> create table t4(id int) engine=blackhole; # \u5b58\u5165\u7684\u6570\u636e\u5c31\u6ca1\u5566 Query OK, 0 rows affected (0.00 sec) mysql> create table t5(id int) engine=myisam; Query OK, 0 rows affected (0.00 sec) mysql> insert into t3 values(1); Query OK, 1 row affected (0.00 sec) mysql> insert into t4 values(1); Query OK, 1 row affected (0.00 sec) mysql> insert into t5 values(1); Query OK, 1 row affected (0.00 sec) mysql> select * from t3; # \u5b58\u4e8e\u5185\u5b58\uff0c\u91cd\u542fmysql\u5c31\u5566 +------+ | id | +------+ | 1 | +------+ row in set (0.00 sec) mysql> select * from t4; # \u6570\u636e\u6ca1\u6709\u5566\uff0c\u9ed1\u6d1e Empty set (0.00 sec) mysql> select * from t5; +------+ | id | +------+ | 1 | +------+ row in set (0.00 sec) # \u91cd\u542fmysql \u67e5\u770bt3\u7684\u6570\u636e Usage: /etc/init.d/mysql start|stop|restart|reload|force-reload|status leco@leco:/etc/mysql/mysql.conf.d$ /etc/init.d/mysql restart [ ok ] Restarting mysql (via systemctl): mysql.service. leco@leco:/etc/mysql/mysql.conf.d$ mysql -uroot -pleco mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 3 Server version: 5.7.21-0ubuntu0.16.04.1 (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> use db1; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +---------------+ | Tables_in_db1 | +---------------+ | t1 | | t2 | | t3 | | t4 | | t5 | +---------------+ rows in set (0.00 sec) mysql> desc t3; +-------+---------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+---------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | +-------+---------+------+-----+---------+-------+ row in set (0.00 sec) mysql> select * from t3; # \u53d1\u73b0\u6570\u636e\u4e48\u6709\u5566 Empty set (0.00 sec)","title":"2. mysql\u652f\u6301\u7684\u5b58\u50a8\u5f15\u64ce"},{"location":"mysql/mysql.table/","text":"MySQL \u8868\u64cd\u4f5c 1. \u4ecb\u7ecd \u00b6 \u521b\u5efaMySQL\u6570\u636e\u8868\u9700\u8981\u4ee5\u4e0b\u4fe1\u606f \u8868\u540d \u8868\u5b57\u6bb5\u540d \u5b9a\u4e49\u6bcf\u4e2a\u8868\u5b57\u6bb5 2. \u521b\u5efa\u8868\u8bed\u6cd5 \u00b6 \u4ee5\u4e0b\u4e3a\u521b\u5efaMySQL\u6570\u636e\u8868\u7684SQL\u901a\u7528\u8bed\u6cd5\uff1a create table \u8868\u540d( \u5b57\u6bb5\u540d1 \u7c7b\u578b[(\u5bbd\u5ea6) \u7ea6\u675f\u6761\u4ef6], \u5b57\u6bb5\u540d2 \u7c7b\u578b[(\u5bbd\u5ea6) \u7ea6\u675f\u6761\u4ef6], \u5b57\u6bb5\u540d3 \u7c7b\u578b[(\u5bbd\u5ea6) \u7ea6\u675f\u6761\u4ef6] ); \u6ce8\u610f 1. \u5728\u540c\u4e00\u5f20\u8868\u4e2d\uff0c\u5b57\u6bb5\u540d\u662f\u4e0d\u80fd\u76f8\u540c 2. \u5bbd\u5ea6\u548c\u7ea6\u675f\u6761\u4ef6\u53ef\u9009 3. \u5b57\u6bb5\u540d\u548c\u7c7b\u578b\u662f\u5fc5\u987b\u7684 2.1 \u521b\u5efa\u8868\u7684\u4f8b\u5b50 \u00b6 \u4ee5\u4e0b\u4f8b\u5b50\u4e2d\u6211\u4eec\u5c06\u5728 cmz \u6570\u636e\u5e93\u4e2d\u521b\u5efa\u6570\u636e\u8868leco\uff1a create table leco( id int, name varchar(50), sex enum('male','female'), age int(3) )engine=innodb default charset=utf8; \u64cd\u4f5c\u8fc7\u7a0b mysql> create database cmz charset utf8; Query OK, 1 row affected (0.00 sec) mysql> use cmz Database changed mysql> create table leco( -> id int, -> name varchar(50), -> sex enum('male','female'), -> age int(3) -> )ENGINE=InnoDB DEFAULT CHARSET=utf8;; Query OK, 0 rows affected (0.06 sec) ERROR: No query specified mysql> show tables; +---------------+ | Tables_in_cmz | +---------------+ | leco | +---------------+ 1 row in set (0.00 sec) 2. \u67e5\u770b\u8868 \u00b6 \u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646 MySQL \u670d\u52a1\u540e\uff0c\u4f7f\u7528 show tables \u547d\u4ee4\u67e5\u770b\u8868\uff0c\u8bed\u6cd5\u5982\u4e0b: SHOW TABLES; \u64cd\u4f5c\u8fc7\u7a0b mysql> show tables; ERROR 1046 (3D000): No database selected mysql> use cmz; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +---------------+ | Tables_in_cmz | +---------------+ | leco | +---------------+ 1 row in set (0.00 sec) \u6ce8\u610f 1. \u4e00\u5b9a\u8981\u5148\u9009\u62e9\u6570\u636e\u5e93\uff0c\u7136\u540e\u67e5\u770b\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u8868 2. \u5bbd\u5ea6\u548c\u7ea6\u675f\u6761\u4ef6\u53ef\u9009 3. \u5b57\u6bb5\u540d\u548c\u7c7b\u578b\u662f\u5fc5\u987b\u7684 3. \u67e5\u770b\u6570\u636e\u5e93\u8868\u5b57\u6bb5 \u00b6 \u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646 MySQL \u670d\u52a1\u540e\uff0c\u4f7f\u7528 DESC \u547d\u4ee4\u67e5\u770b\u8868\u4e2d\u5b57\u6bb5\uff0c\u8bed\u6cd5\u5982\u4e0b: DESC TABLE_NAME \u64cd\u4f5c\u8fc7\u7a0b mysql> desc leco; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) 4. \u63d2\u5165\u6570\u636e \u00b6 MySQL \u8868\u4e2d\u4f7f\u7528 INSERT INTO SQL\u8bed\u53e5\u6765\u63d2\u5165\u6570\u636e\uff0c\u8bed\u6cd5\u5982\u4e0b\u3002 INSERT INTO table_name ( field1, field2,...fieldN ) VALUES ( value1, value2,...valueN ); \u5982\u679c\u6570\u636e\u662f\u5b57\u7b26\u578b\uff0c\u5fc5\u987b\u4f7f\u7528\u5355\u5f15\u53f7\u6216\u8005\u53cc\u5f15\u53f7\uff0c\u5982\uff1a\"value\"\u3002 mysql> insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); Query OK, 1 row affected (0.02 sec) mysql> insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); Query OK, 1 row affected (0.00 sec) mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec) 4. \u67e5\u770b\u6570\u636e \u00b6 \u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646 MySQL \u670d\u52a1\u540e\uff0c\u4f7f\u7528 select \u547d\u4ee4\u67e5\u770b\u6570\u636e\uff0c\u8bed\u6cd5\u5982\u4e0b: SELECT column_name,column_name FROM table_name [WHERE Clause] [LIMIT N][ OFFSET M] \u67e5\u8be2\u8bed\u53e5\u4e2d\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u8868\uff0c\u8868\u4e4b\u95f4\u4f7f\u7528\u9017\u53f7(,)\u5206\u5272\uff0c\u5e76\u4f7f\u7528WHERE\u8bed\u53e5\u6765\u8bbe\u5b9a\u67e5\u8be2\u6761\u4ef6\u3002 SELECT \u547d\u4ee4\u53ef\u4ee5\u8bfb\u53d6\u4e00\u6761\u6216\u8005\u591a\u6761\u8bb0\u5f55\u3002 \u53ef\u4ee5\u4f7f\u7528\u661f\u53f7\uff08*\uff09\u6765\u4ee3\u66ff\u5176\u4ed6\u5b57\u6bb5\uff0cSELECT\u8bed\u53e5\u4f1a\u8fd4\u56de\u8868\u7684\u6240\u6709\u5b57\u6bb5\u6570\u636e \u53ef\u4ee5\u4f7f\u7528 WHERE \u8bed\u53e5\u6765\u5305\u542b\u4efb\u4f55\u6761\u4ef6\u3002 \u53ef\u4ee5\u4f7f\u7528 LIMIT \u5c5e\u6027\u6765\u8bbe\u5b9a\u8fd4\u56de\u7684\u8bb0\u5f55\u6570\u3002 \u53ef\u4ee5\u901a\u8fc7OFFSET\u6307\u5b9aSELECT\u8bed\u53e5\u5f00\u59cb\u67e5\u8be2\u7684\u6570\u636e\u504f\u79fb\u91cf\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u504f\u79fb\u91cf\u4e3a0\u3002 \u64cd\u4f5c\u8fc7\u7a0b mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec) mysql> select id,name from leco; +------+--------+ | id | name | +------+--------+ | 1 | \u5f20\u4e09 | | 2 | \u674e\u56db | | 3 | \u738b\u4e94 | | 4 | \u8d75\u516d | +------+--------+ 4 rows in set (0.00 sec)","title":"05. MySQL \u8868"},{"location":"mysql/mysql.table/#1","text":"\u521b\u5efaMySQL\u6570\u636e\u8868\u9700\u8981\u4ee5\u4e0b\u4fe1\u606f \u8868\u540d \u8868\u5b57\u6bb5\u540d \u5b9a\u4e49\u6bcf\u4e2a\u8868\u5b57\u6bb5","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.table/#2","text":"\u4ee5\u4e0b\u4e3a\u521b\u5efaMySQL\u6570\u636e\u8868\u7684SQL\u901a\u7528\u8bed\u6cd5\uff1a create table \u8868\u540d( \u5b57\u6bb5\u540d1 \u7c7b\u578b[(\u5bbd\u5ea6) \u7ea6\u675f\u6761\u4ef6], \u5b57\u6bb5\u540d2 \u7c7b\u578b[(\u5bbd\u5ea6) \u7ea6\u675f\u6761\u4ef6], \u5b57\u6bb5\u540d3 \u7c7b\u578b[(\u5bbd\u5ea6) \u7ea6\u675f\u6761\u4ef6] ); \u6ce8\u610f 1. \u5728\u540c\u4e00\u5f20\u8868\u4e2d\uff0c\u5b57\u6bb5\u540d\u662f\u4e0d\u80fd\u76f8\u540c 2. \u5bbd\u5ea6\u548c\u7ea6\u675f\u6761\u4ef6\u53ef\u9009 3. \u5b57\u6bb5\u540d\u548c\u7c7b\u578b\u662f\u5fc5\u987b\u7684","title":"2. \u521b\u5efa\u8868\u8bed\u6cd5"},{"location":"mysql/mysql.table/#21","text":"\u4ee5\u4e0b\u4f8b\u5b50\u4e2d\u6211\u4eec\u5c06\u5728 cmz \u6570\u636e\u5e93\u4e2d\u521b\u5efa\u6570\u636e\u8868leco\uff1a create table leco( id int, name varchar(50), sex enum('male','female'), age int(3) )engine=innodb default charset=utf8; \u64cd\u4f5c\u8fc7\u7a0b mysql> create database cmz charset utf8; Query OK, 1 row affected (0.00 sec) mysql> use cmz Database changed mysql> create table leco( -> id int, -> name varchar(50), -> sex enum('male','female'), -> age int(3) -> )ENGINE=InnoDB DEFAULT CHARSET=utf8;; Query OK, 0 rows affected (0.06 sec) ERROR: No query specified mysql> show tables; +---------------+ | Tables_in_cmz | +---------------+ | leco | +---------------+ 1 row in set (0.00 sec)","title":"2.1 \u521b\u5efa\u8868\u7684\u4f8b\u5b50"},{"location":"mysql/mysql.table/#2_1","text":"\u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646 MySQL \u670d\u52a1\u540e\uff0c\u4f7f\u7528 show tables \u547d\u4ee4\u67e5\u770b\u8868\uff0c\u8bed\u6cd5\u5982\u4e0b: SHOW TABLES; \u64cd\u4f5c\u8fc7\u7a0b mysql> show tables; ERROR 1046 (3D000): No database selected mysql> use cmz; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +---------------+ | Tables_in_cmz | +---------------+ | leco | +---------------+ 1 row in set (0.00 sec) \u6ce8\u610f 1. \u4e00\u5b9a\u8981\u5148\u9009\u62e9\u6570\u636e\u5e93\uff0c\u7136\u540e\u67e5\u770b\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u8868 2. \u5bbd\u5ea6\u548c\u7ea6\u675f\u6761\u4ef6\u53ef\u9009 3. \u5b57\u6bb5\u540d\u548c\u7c7b\u578b\u662f\u5fc5\u987b\u7684","title":"2. \u67e5\u770b\u8868"},{"location":"mysql/mysql.table/#3","text":"\u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646 MySQL \u670d\u52a1\u540e\uff0c\u4f7f\u7528 DESC \u547d\u4ee4\u67e5\u770b\u8868\u4e2d\u5b57\u6bb5\uff0c\u8bed\u6cd5\u5982\u4e0b: DESC TABLE_NAME \u64cd\u4f5c\u8fc7\u7a0b mysql> desc leco; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec)","title":"3. \u67e5\u770b\u6570\u636e\u5e93\u8868\u5b57\u6bb5"},{"location":"mysql/mysql.table/#4","text":"MySQL \u8868\u4e2d\u4f7f\u7528 INSERT INTO SQL\u8bed\u53e5\u6765\u63d2\u5165\u6570\u636e\uff0c\u8bed\u6cd5\u5982\u4e0b\u3002 INSERT INTO table_name ( field1, field2,...fieldN ) VALUES ( value1, value2,...valueN ); \u5982\u679c\u6570\u636e\u662f\u5b57\u7b26\u578b\uff0c\u5fc5\u987b\u4f7f\u7528\u5355\u5f15\u53f7\u6216\u8005\u53cc\u5f15\u53f7\uff0c\u5982\uff1a\"value\"\u3002 mysql> insert into leco(id,name,sex,age) values(1,\"\u5f20\u4e09\",\"female\",18); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(2,\"\u674e\u56db\",\"male\",20); Query OK, 1 row affected (0.01 sec) mysql> insert into leco(id,name,sex,age) values(3,\"\u738b\u4e94\",\"male\",30); Query OK, 1 row affected (0.02 sec) mysql> insert into leco(id,name,sex,age) values(4,\"\u8d75\u516d\",\"female\",40); Query OK, 1 row affected (0.00 sec) mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec)","title":"4. \u63d2\u5165\u6570\u636e"},{"location":"mysql/mysql.table/#4_1","text":"\u6211\u4eec\u53ef\u4ee5\u5728\u767b\u9646 MySQL \u670d\u52a1\u540e\uff0c\u4f7f\u7528 select \u547d\u4ee4\u67e5\u770b\u6570\u636e\uff0c\u8bed\u6cd5\u5982\u4e0b: SELECT column_name,column_name FROM table_name [WHERE Clause] [LIMIT N][ OFFSET M] \u67e5\u8be2\u8bed\u53e5\u4e2d\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u8868\uff0c\u8868\u4e4b\u95f4\u4f7f\u7528\u9017\u53f7(,)\u5206\u5272\uff0c\u5e76\u4f7f\u7528WHERE\u8bed\u53e5\u6765\u8bbe\u5b9a\u67e5\u8be2\u6761\u4ef6\u3002 SELECT \u547d\u4ee4\u53ef\u4ee5\u8bfb\u53d6\u4e00\u6761\u6216\u8005\u591a\u6761\u8bb0\u5f55\u3002 \u53ef\u4ee5\u4f7f\u7528\u661f\u53f7\uff08*\uff09\u6765\u4ee3\u66ff\u5176\u4ed6\u5b57\u6bb5\uff0cSELECT\u8bed\u53e5\u4f1a\u8fd4\u56de\u8868\u7684\u6240\u6709\u5b57\u6bb5\u6570\u636e \u53ef\u4ee5\u4f7f\u7528 WHERE \u8bed\u53e5\u6765\u5305\u542b\u4efb\u4f55\u6761\u4ef6\u3002 \u53ef\u4ee5\u4f7f\u7528 LIMIT \u5c5e\u6027\u6765\u8bbe\u5b9a\u8fd4\u56de\u7684\u8bb0\u5f55\u6570\u3002 \u53ef\u4ee5\u901a\u8fc7OFFSET\u6307\u5b9aSELECT\u8bed\u53e5\u5f00\u59cb\u67e5\u8be2\u7684\u6570\u636e\u504f\u79fb\u91cf\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u504f\u79fb\u91cf\u4e3a0\u3002 \u64cd\u4f5c\u8fc7\u7a0b mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec) mysql> select id,name from leco; +------+--------+ | id | name | +------+--------+ | 1 | \u5f20\u4e09 | | 2 | \u674e\u56db | | 3 | \u738b\u4e94 | | 4 | \u8d75\u516d | +------+--------+ 4 rows in set (0.00 sec)","title":"4. \u67e5\u770b\u6570\u636e"},{"location":"mysql/mysql.transaction/","text":"MySQL \u4e8b\u52a1 1. \u4ecb\u7ecd \u00b6 MySQL \u4e8b\u52a1\u4e3b\u8981\u7528\u4e8e\u5904\u7406\u64cd\u4f5c\u91cf\u5927\uff0c\u590d\u6742\u5ea6\u9ad8\u7684\u6570\u636e\u3002\u6bd4\u5982\u8bf4\uff0c\u5728\u4eba\u5458\u7ba1\u7406\u7cfb\u7edf\u4e2d\uff0c\u4f60\u5220\u9664\u4e00\u4e2a\u4eba\u5458\uff0c\u4f60\u5373\u9700\u8981\u5220\u9664\u4eba\u5458\u7684\u57fa\u672c\u8d44\u6599\uff0c\u4e5f\u8981\u5220\u9664\u548c\u8be5\u4eba\u5458\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u5982\u4fe1\u7bb1\uff0c\u6587\u7ae0\u7b49\u7b49\uff0c\u8fd9\u6837\uff0c\u8fd9\u4e9b\u6570\u636e\u5e93\u64cd\u4f5c\u8bed\u53e5\u5c31\u6784\u6210\u4e00\u4e2a\u4e8b\u52a1\uff01 \u5728 MySQL \u4e2d\u53ea\u6709\u4f7f\u7528\u4e86 Innodb \u6570\u636e\u5e93\u5f15\u64ce\u7684\u6570\u636e\u5e93\u6216\u8868\u624d\u652f\u6301\u4e8b\u52a1\u3002 \u4e8b\u52a1\u5904\u7406\u53ef\u4ee5\u7528\u6765\u7ef4\u62a4\u6570\u636e\u5e93\u7684\u5b8c\u6574\u6027\uff0c\u4fdd\u8bc1\u6210\u6279\u7684 SQL \u8bed\u53e5\u8981\u4e48\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u6267\u884c\u3002 \u4e8b\u52a1\u7528\u6765\u7ba1\u7406 insert,update,delete \u8bed\u53e5 \u4e00\u822c\u6765\u8bf4\uff0c\u4e8b\u52a1\u662f\u5fc5\u987b\u6ee1\u8db34\u4e2a\u6761\u4ef6\uff08ACID\uff09\uff1a\uff1a\u539f\u5b50\u6027\uff08Atomicity\uff0c\u6216\u79f0\u4e0d\u53ef\u5206\u5272\u6027\uff09\u3001\u4e00\u81f4\u6027\uff08Consistency\uff09\u3001\u9694\u79bb\u6027\uff08Isolation\uff0c\u53c8\u79f0\u72ec\u7acb\u6027\uff09\u3001\u6301\u4e45\u6027\uff08Durability\uff09\u3002 \u539f\u5b50\u6027\uff1a\u4e00\u4e2a\u4e8b\u52a1\uff08transaction\uff09\u4e2d\u7684\u6240\u6709\u64cd\u4f5c\uff0c\u8981\u4e48\u5168\u90e8\u5b8c\u6210\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u5b8c\u6210\uff0c\u4e0d\u4f1a\u7ed3\u675f\u5728\u4e2d\u95f4\u67d0\u4e2a\u73af\u8282\u3002\u4e8b\u52a1\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\uff0c\u4f1a\u88ab\u56de\u6eda\uff08Rollback\uff09\u5230\u4e8b\u52a1\u5f00\u59cb\u524d\u7684\u72b6\u6001\uff0c\u5c31\u50cf\u8fd9\u4e2a\u4e8b\u52a1\u4ece\u6765\u6ca1\u6709\u6267\u884c\u8fc7\u4e00\u6837\u3002 \u4e00\u81f4\u6027\uff1a\u5728\u4e8b\u52a1\u5f00\u59cb\u4e4b\u524d\u548c\u4e8b\u52a1\u7ed3\u675f\u4ee5\u540e\uff0c\u6570\u636e\u5e93\u7684\u5b8c\u6574\u6027\u6ca1\u6709\u88ab\u7834\u574f\u3002\u8fd9\u8868\u793a\u5199\u5165\u7684\u8d44\u6599\u5fc5\u987b\u5b8c\u5168\u7b26\u5408\u6240\u6709\u7684\u9884\u8bbe\u89c4\u5219\uff0c\u8fd9\u5305\u542b\u8d44\u6599\u7684\u7cbe\u786e\u5ea6\u3001\u4e32\u8054\u6027\u4ee5\u53ca\u540e\u7eed\u6570\u636e\u5e93\u53ef\u4ee5\u81ea\u53d1\u6027\u5730\u5b8c\u6210\u9884\u5b9a\u7684\u5de5\u4f5c\u3002 \u9694\u79bb\u6027\uff1a\u6570\u636e\u5e93\u5141\u8bb8\u591a\u4e2a\u5e76\u53d1\u4e8b\u52a1\u540c\u65f6\u5bf9\u5176\u6570\u636e\u8fdb\u884c\u8bfb\u5199\u548c\u4fee\u6539\u7684\u80fd\u529b\uff0c\u9694\u79bb\u6027\u53ef\u4ee5\u9632\u6b62\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u65f6\u7531\u4e8e\u4ea4\u53c9\u6267\u884c\u800c\u5bfc\u81f4\u6570\u636e\u7684\u4e0d\u4e00\u81f4\u3002\u4e8b\u52a1\u9694\u79bb\u5206\u4e3a\u4e0d\u540c\u7ea7\u522b\uff0c\u5305\u62ec\u8bfb\u672a\u63d0\u4ea4\uff08Read uncommitted\uff09\u3001\u8bfb\u63d0\u4ea4\uff08read committed\uff09\u3001\u53ef\u91cd\u590d\u8bfb\uff08repeatable read\uff09\u548c\u4e32\u884c\u5316\uff08Serializable\uff09\u3002 \u6301\u4e45\u6027\uff1a\u4e8b\u52a1\u5904\u7406\u7ed3\u675f\u540e\uff0c\u5bf9\u6570\u636e\u7684\u4fee\u6539\u5c31\u662f\u6c38\u4e45\u7684\uff0c\u5373\u4fbf\u7cfb\u7edf\u6545\u969c\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002 \u63d0\u793a \u5728 MySQL \u547d\u4ee4\u884c\u7684\u9ed8\u8ba4\u8bbe\u7f6e\u4e0b\uff0c\u4e8b\u52a1\u90fd\u662f\u81ea\u52a8\u63d0\u4ea4\u7684\uff0c\u5373\u6267\u884c SQL \u8bed\u53e5\u540e\u5c31\u4f1a\u9a6c\u4e0a\u6267\u884c COMMIT \u64cd\u4f5c\u3002\u56e0\u6b64\u8981\u663e\u5f0f\u5730\u5f00\u542f\u4e00\u4e2a\u4e8b\u52a1\u52a1\u987b\u4f7f\u7528\u547d\u4ee4 BEGIN \u6216 START TRANSACTION \uff0c\u6216\u8005\u6267\u884c\u547d\u4ee4 SET AUTOCOMMIT = 0 \uff0c\u7528\u6765\u7981\u6b62\u4f7f\u7528\u5f53\u524d\u4f1a\u8bdd\u7684\u81ea\u52a8\u63d0\u4ea4\u3002 2. \u4e8b\u52a1\u63a7\u5236\u8bed\u53e5 \u00b6 BEGIN \u6216 START TRANSACTION \u663e\u5f0f\u5730\u5f00\u542f\u4e00\u4e2a\u4e8b\u52a1\uff1b COMMIT \u4e5f\u53ef\u4ee5\u4f7f\u7528 COMMIT WORK\uff0c\u4e0d\u8fc7\u4e8c\u8005\u662f\u7b49\u4ef7\u7684\u3002COMMIT \u4f1a\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5e76\u4f7f\u5df2\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u7684\u6240\u6709\u4fee\u6539\u6210\u4e3a\u6c38\u4e45\u6027\u7684\uff1b ROLLBACK \u4e5f\u53ef\u4ee5\u4f7f\u7528 ROLLBACK WORK\uff0c\u4e0d\u8fc7\u4e8c\u8005\u662f\u7b49\u4ef7\u7684\u3002\u56de\u6eda\u4f1a\u7ed3\u675f\u7528\u6237\u7684\u4e8b\u52a1\uff0c\u5e76\u64a4\u9500\u6b63\u5728\u8fdb\u884c\u7684\u6240\u6709\u672a\u63d0\u4ea4\u7684\u4fee\u6539\uff1b SAVEPOINT identifier\uff0cSAVEPOINT \u5141\u8bb8\u5728\u4e8b\u52a1\u4e2d\u521b\u5efa\u4e00\u4e2a\u4fdd\u5b58\u70b9\uff0c\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2a SAVEPOINT\uff1b RELEASE SAVEPOINT identifier \u5220\u9664\u4e00\u4e2a\u4e8b\u52a1\u7684\u4fdd\u5b58\u70b9\uff0c\u5f53\u6ca1\u6709\u6307\u5b9a\u7684\u4fdd\u5b58\u70b9\u65f6\uff0c\u6267\u884c\u8be5\u8bed\u53e5\u4f1a\u629b\u51fa\u4e00\u4e2a\u5f02\u5e38\uff1b ROLLBACK TO identifier \u628a\u4e8b\u52a1\u56de\u6eda\u5230\u6807\u8bb0\u70b9\uff1b SET TRANSACTION \u7528\u6765\u8bbe\u7f6e\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u3002InnoDB \u5b58\u50a8\u5f15\u64ce\u63d0\u4f9b\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u6709READ U NCOMMITTED\u3001READ COMMITTED\u3001REPEATABLE READ \u548c SERIALIZABLE\u3002 3. \u4e8b\u52a1\u5904\u7406 \u00b6 \u7528 BEGIN, ROLLBACK, COMMIT\u6765\u5b9e\u73b0 BEGIN \u5f00\u59cb\u4e00\u4e2a\u4e8b\u52a1 ROLLBACK \u4e8b\u52a1\u56de\u6eda COMMIT \u4e8b\u52a1\u786e\u8ba4 \u76f4\u63a5\u7528 SET \u6765\u6539\u53d8 MySQL \u7684\u81ea\u52a8\u63d0\u4ea4\u6a21\u5f0f: SET AUTOCOMMIT=0 \u7981\u6b62\u81ea\u52a8\u63d0\u4ea4 SET AUTOCOMMIT=1 \u5f00\u542f\u81ea\u52a8\u63d0\u4ea4 4. \u6d4b\u8bd5 \u00b6 4.1 \u73af\u5883\u51c6\u5907 \u00b6 create database shiwu charset utf8; use shiwu; create table user( id int primary key auto_increment, name char(32), balance int ); insert into user(name,balance) values ('cmz',1000), ('leco',1000), ('loocha',1000); select * from user; #\u539f\u5b50\u64cd\u4f5c start transaction; # \u5f00\u542f\u4e8b\u52a1 update user set balance=900 where name='cmz'; #\u4e70\u652f\u4ed8100\u5143 update user set balance=1010 where name='leco'; #\u4e2d\u4ecb\u62ff\u8d7010\u5143 update user set balance=1090 where name='loocha'; #\u5356\u5bb6\u62ff\u523090\u5143 commit; #\u51fa\u73b0\u5f02\u5e38\uff0c\u56de\u6eda\u5230\u521d\u59cb\u72b6\u6001 start transaction; update user set balance=900 where name='cmz'; #\u4e70\u652f\u4ed8100\u5143 update user set balance=1010 where name='leco'; #\u4e2d\u4ecb\u62ff\u8d7010\u5143 uppdate user set balance=1090 where name='loocha'; #\u5356\u5bb6\u62ff\u523090\u5143,\u51fa\u73b0\u5f02\u5e38\u6ca1\u6709\u62ff\u5230 rollback; commit; \u6267\u884c\u8fc7\u7a0b root@leco:~/book/books/docs/mysql# mysql -uroot -proot mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 70 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> create database shiwu charset utf8; Query OK, 1 row affected (0.00 sec) mysql> use shiwu; Database changed mysql> create table user( -> id int primary key auto_increment, -> name char(32), -> balance int -> ); Query OK, 0 rows affected (0.07 sec) mysql> mysql> insert into user(name,balance) -> values -> ('cmz',1000), -> ('leco',1000), -> ('loocha',1000); Query OK, 3 rows affected (0.02 sec) Records: 3 Duplicates: 0 Warnings: 0 mysql> mysql> select * from user; +----+--------+---------+ | id | name | balance | +----+--------+---------+ | 1 | cmz | 1000 | | 3 | leco | 1000 | | 5 | loocha | 1000 | +----+--------+---------+ 3 rows in set (0.00 sec) 4.2 \u539f\u5b50\u64cd\u4f5c \u00b6 mysql> # \u4ee5\u4e0b\u662f\u539f\u5b50\u64cd\u4f5c mysql> start transaction; # \u5f00\u542f\u4e8b\u52a1 Query OK, 0 rows affected (0.00 sec) mysql> update user set balance=900 where name='cmz'; #\u4e70\u652f\u4ed8100\u5143 Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> update user set balance=1010 where name='leco'; #\u4e2d\u4ecb\u62ff\u8d7010\u5143 Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> update user set balance=1090 where name='loocha'; #\u5356\u5bb6\u62ff\u523090\u5143 Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> commit; Query OK, 0 rows affected (0.01 sec) mysql> select * from user; +----+--------+---------+ | id | name | balance | +----+--------+---------+ | 1 | cmz | 900 | | 3 | leco | 1010 | | 5 | loocha | 1090 | +----+--------+---------+ 3 rows in set (0.00 sec) 4.3 \u4e8b\u52a1\u56de\u6eda \u00b6 mysql> select * from user; +----+--------+---------+ | id | name | balance | +----+--------+---------+ | 1 | cmz | 900 | | 3 | leco | 1010 | | 5 | loocha | 1090 | +----+--------+---------+ 3 rows in set (0.00 sec) mysql> start transaction; Query OK, 0 rows affected (0.00 sec) mysql> update user set balance=900 where name='cmz'; #\u4e70\u652f\u4ed8100\u5143 Query OK, 0 rows affected (0.00 sec) Rows matched: 1 Changed: 0 Warnings: 0 mysql> update user set balance=1010 where name='leco'; #\u4e2d\u4ecb\u62ff\u8d7010\u5143 Query OK, 0 rows affected (0.00 sec) Rows matched: 1 Changed: 0 Warnings: 0 mysql> uppdate user set balance=1090 where name='loocha'; #\u5356\u5bb6\u62ff\u523090\u5143,\u51fa\u73b0\u5f02\u5e38\u6ca1\u6709\u62ff\u5230 ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'uppdate user set balance=1090 where name='loocha'' at line 1 mysql> rollback; Query OK, 0 rows affected (0.00 sec) mysql> commit; Query OK, 0 rows affected (0.00 sec) mysql> select * from user; +----+--------+---------+ | id | name | balance | +----+--------+---------+ | 1 | cmz | 900 | | 3 | leco | 1010 | | 5 | loocha | 1090 | +----+--------+---------+ 3 rows in set (0.00 sec)","title":"3. SQL \u4e8b\u52a1"},{"location":"mysql/mysql.transaction/#1","text":"MySQL \u4e8b\u52a1\u4e3b\u8981\u7528\u4e8e\u5904\u7406\u64cd\u4f5c\u91cf\u5927\uff0c\u590d\u6742\u5ea6\u9ad8\u7684\u6570\u636e\u3002\u6bd4\u5982\u8bf4\uff0c\u5728\u4eba\u5458\u7ba1\u7406\u7cfb\u7edf\u4e2d\uff0c\u4f60\u5220\u9664\u4e00\u4e2a\u4eba\u5458\uff0c\u4f60\u5373\u9700\u8981\u5220\u9664\u4eba\u5458\u7684\u57fa\u672c\u8d44\u6599\uff0c\u4e5f\u8981\u5220\u9664\u548c\u8be5\u4eba\u5458\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u5982\u4fe1\u7bb1\uff0c\u6587\u7ae0\u7b49\u7b49\uff0c\u8fd9\u6837\uff0c\u8fd9\u4e9b\u6570\u636e\u5e93\u64cd\u4f5c\u8bed\u53e5\u5c31\u6784\u6210\u4e00\u4e2a\u4e8b\u52a1\uff01 \u5728 MySQL \u4e2d\u53ea\u6709\u4f7f\u7528\u4e86 Innodb \u6570\u636e\u5e93\u5f15\u64ce\u7684\u6570\u636e\u5e93\u6216\u8868\u624d\u652f\u6301\u4e8b\u52a1\u3002 \u4e8b\u52a1\u5904\u7406\u53ef\u4ee5\u7528\u6765\u7ef4\u62a4\u6570\u636e\u5e93\u7684\u5b8c\u6574\u6027\uff0c\u4fdd\u8bc1\u6210\u6279\u7684 SQL \u8bed\u53e5\u8981\u4e48\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u6267\u884c\u3002 \u4e8b\u52a1\u7528\u6765\u7ba1\u7406 insert,update,delete \u8bed\u53e5 \u4e00\u822c\u6765\u8bf4\uff0c\u4e8b\u52a1\u662f\u5fc5\u987b\u6ee1\u8db34\u4e2a\u6761\u4ef6\uff08ACID\uff09\uff1a\uff1a\u539f\u5b50\u6027\uff08Atomicity\uff0c\u6216\u79f0\u4e0d\u53ef\u5206\u5272\u6027\uff09\u3001\u4e00\u81f4\u6027\uff08Consistency\uff09\u3001\u9694\u79bb\u6027\uff08Isolation\uff0c\u53c8\u79f0\u72ec\u7acb\u6027\uff09\u3001\u6301\u4e45\u6027\uff08Durability\uff09\u3002 \u539f\u5b50\u6027\uff1a\u4e00\u4e2a\u4e8b\u52a1\uff08transaction\uff09\u4e2d\u7684\u6240\u6709\u64cd\u4f5c\uff0c\u8981\u4e48\u5168\u90e8\u5b8c\u6210\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u5b8c\u6210\uff0c\u4e0d\u4f1a\u7ed3\u675f\u5728\u4e2d\u95f4\u67d0\u4e2a\u73af\u8282\u3002\u4e8b\u52a1\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\uff0c\u4f1a\u88ab\u56de\u6eda\uff08Rollback\uff09\u5230\u4e8b\u52a1\u5f00\u59cb\u524d\u7684\u72b6\u6001\uff0c\u5c31\u50cf\u8fd9\u4e2a\u4e8b\u52a1\u4ece\u6765\u6ca1\u6709\u6267\u884c\u8fc7\u4e00\u6837\u3002 \u4e00\u81f4\u6027\uff1a\u5728\u4e8b\u52a1\u5f00\u59cb\u4e4b\u524d\u548c\u4e8b\u52a1\u7ed3\u675f\u4ee5\u540e\uff0c\u6570\u636e\u5e93\u7684\u5b8c\u6574\u6027\u6ca1\u6709\u88ab\u7834\u574f\u3002\u8fd9\u8868\u793a\u5199\u5165\u7684\u8d44\u6599\u5fc5\u987b\u5b8c\u5168\u7b26\u5408\u6240\u6709\u7684\u9884\u8bbe\u89c4\u5219\uff0c\u8fd9\u5305\u542b\u8d44\u6599\u7684\u7cbe\u786e\u5ea6\u3001\u4e32\u8054\u6027\u4ee5\u53ca\u540e\u7eed\u6570\u636e\u5e93\u53ef\u4ee5\u81ea\u53d1\u6027\u5730\u5b8c\u6210\u9884\u5b9a\u7684\u5de5\u4f5c\u3002 \u9694\u79bb\u6027\uff1a\u6570\u636e\u5e93\u5141\u8bb8\u591a\u4e2a\u5e76\u53d1\u4e8b\u52a1\u540c\u65f6\u5bf9\u5176\u6570\u636e\u8fdb\u884c\u8bfb\u5199\u548c\u4fee\u6539\u7684\u80fd\u529b\uff0c\u9694\u79bb\u6027\u53ef\u4ee5\u9632\u6b62\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u65f6\u7531\u4e8e\u4ea4\u53c9\u6267\u884c\u800c\u5bfc\u81f4\u6570\u636e\u7684\u4e0d\u4e00\u81f4\u3002\u4e8b\u52a1\u9694\u79bb\u5206\u4e3a\u4e0d\u540c\u7ea7\u522b\uff0c\u5305\u62ec\u8bfb\u672a\u63d0\u4ea4\uff08Read uncommitted\uff09\u3001\u8bfb\u63d0\u4ea4\uff08read committed\uff09\u3001\u53ef\u91cd\u590d\u8bfb\uff08repeatable read\uff09\u548c\u4e32\u884c\u5316\uff08Serializable\uff09\u3002 \u6301\u4e45\u6027\uff1a\u4e8b\u52a1\u5904\u7406\u7ed3\u675f\u540e\uff0c\u5bf9\u6570\u636e\u7684\u4fee\u6539\u5c31\u662f\u6c38\u4e45\u7684\uff0c\u5373\u4fbf\u7cfb\u7edf\u6545\u969c\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002 \u63d0\u793a \u5728 MySQL \u547d\u4ee4\u884c\u7684\u9ed8\u8ba4\u8bbe\u7f6e\u4e0b\uff0c\u4e8b\u52a1\u90fd\u662f\u81ea\u52a8\u63d0\u4ea4\u7684\uff0c\u5373\u6267\u884c SQL \u8bed\u53e5\u540e\u5c31\u4f1a\u9a6c\u4e0a\u6267\u884c COMMIT \u64cd\u4f5c\u3002\u56e0\u6b64\u8981\u663e\u5f0f\u5730\u5f00\u542f\u4e00\u4e2a\u4e8b\u52a1\u52a1\u987b\u4f7f\u7528\u547d\u4ee4 BEGIN \u6216 START TRANSACTION \uff0c\u6216\u8005\u6267\u884c\u547d\u4ee4 SET AUTOCOMMIT = 0 \uff0c\u7528\u6765\u7981\u6b62\u4f7f\u7528\u5f53\u524d\u4f1a\u8bdd\u7684\u81ea\u52a8\u63d0\u4ea4\u3002","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.transaction/#2","text":"BEGIN \u6216 START TRANSACTION \u663e\u5f0f\u5730\u5f00\u542f\u4e00\u4e2a\u4e8b\u52a1\uff1b COMMIT \u4e5f\u53ef\u4ee5\u4f7f\u7528 COMMIT WORK\uff0c\u4e0d\u8fc7\u4e8c\u8005\u662f\u7b49\u4ef7\u7684\u3002COMMIT \u4f1a\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5e76\u4f7f\u5df2\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u7684\u6240\u6709\u4fee\u6539\u6210\u4e3a\u6c38\u4e45\u6027\u7684\uff1b ROLLBACK \u4e5f\u53ef\u4ee5\u4f7f\u7528 ROLLBACK WORK\uff0c\u4e0d\u8fc7\u4e8c\u8005\u662f\u7b49\u4ef7\u7684\u3002\u56de\u6eda\u4f1a\u7ed3\u675f\u7528\u6237\u7684\u4e8b\u52a1\uff0c\u5e76\u64a4\u9500\u6b63\u5728\u8fdb\u884c\u7684\u6240\u6709\u672a\u63d0\u4ea4\u7684\u4fee\u6539\uff1b SAVEPOINT identifier\uff0cSAVEPOINT \u5141\u8bb8\u5728\u4e8b\u52a1\u4e2d\u521b\u5efa\u4e00\u4e2a\u4fdd\u5b58\u70b9\uff0c\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2a SAVEPOINT\uff1b RELEASE SAVEPOINT identifier \u5220\u9664\u4e00\u4e2a\u4e8b\u52a1\u7684\u4fdd\u5b58\u70b9\uff0c\u5f53\u6ca1\u6709\u6307\u5b9a\u7684\u4fdd\u5b58\u70b9\u65f6\uff0c\u6267\u884c\u8be5\u8bed\u53e5\u4f1a\u629b\u51fa\u4e00\u4e2a\u5f02\u5e38\uff1b ROLLBACK TO identifier \u628a\u4e8b\u52a1\u56de\u6eda\u5230\u6807\u8bb0\u70b9\uff1b SET TRANSACTION \u7528\u6765\u8bbe\u7f6e\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u3002InnoDB \u5b58\u50a8\u5f15\u64ce\u63d0\u4f9b\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u6709READ U NCOMMITTED\u3001READ COMMITTED\u3001REPEATABLE READ \u548c SERIALIZABLE\u3002","title":"2. \u4e8b\u52a1\u63a7\u5236\u8bed\u53e5"},{"location":"mysql/mysql.transaction/#3","text":"\u7528 BEGIN, ROLLBACK, COMMIT\u6765\u5b9e\u73b0 BEGIN \u5f00\u59cb\u4e00\u4e2a\u4e8b\u52a1 ROLLBACK \u4e8b\u52a1\u56de\u6eda COMMIT \u4e8b\u52a1\u786e\u8ba4 \u76f4\u63a5\u7528 SET \u6765\u6539\u53d8 MySQL \u7684\u81ea\u52a8\u63d0\u4ea4\u6a21\u5f0f: SET AUTOCOMMIT=0 \u7981\u6b62\u81ea\u52a8\u63d0\u4ea4 SET AUTOCOMMIT=1 \u5f00\u542f\u81ea\u52a8\u63d0\u4ea4","title":"3. \u4e8b\u52a1\u5904\u7406"},{"location":"mysql/mysql.transaction/#4","text":"","title":"4. \u6d4b\u8bd5"},{"location":"mysql/mysql.transaction/#41","text":"create database shiwu charset utf8; use shiwu; create table user( id int primary key auto_increment, name char(32), balance int ); insert into user(name,balance) values ('cmz',1000), ('leco',1000), ('loocha',1000); select * from user; #\u539f\u5b50\u64cd\u4f5c start transaction; # \u5f00\u542f\u4e8b\u52a1 update user set balance=900 where name='cmz'; #\u4e70\u652f\u4ed8100\u5143 update user set balance=1010 where name='leco'; #\u4e2d\u4ecb\u62ff\u8d7010\u5143 update user set balance=1090 where name='loocha'; #\u5356\u5bb6\u62ff\u523090\u5143 commit; #\u51fa\u73b0\u5f02\u5e38\uff0c\u56de\u6eda\u5230\u521d\u59cb\u72b6\u6001 start transaction; update user set balance=900 where name='cmz'; #\u4e70\u652f\u4ed8100\u5143 update user set balance=1010 where name='leco'; #\u4e2d\u4ecb\u62ff\u8d7010\u5143 uppdate user set balance=1090 where name='loocha'; #\u5356\u5bb6\u62ff\u523090\u5143,\u51fa\u73b0\u5f02\u5e38\u6ca1\u6709\u62ff\u5230 rollback; commit; \u6267\u884c\u8fc7\u7a0b root@leco:~/book/books/docs/mysql# mysql -uroot -proot mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 70 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> create database shiwu charset utf8; Query OK, 1 row affected (0.00 sec) mysql> use shiwu; Database changed mysql> create table user( -> id int primary key auto_increment, -> name char(32), -> balance int -> ); Query OK, 0 rows affected (0.07 sec) mysql> mysql> insert into user(name,balance) -> values -> ('cmz',1000), -> ('leco',1000), -> ('loocha',1000); Query OK, 3 rows affected (0.02 sec) Records: 3 Duplicates: 0 Warnings: 0 mysql> mysql> select * from user; +----+--------+---------+ | id | name | balance | +----+--------+---------+ | 1 | cmz | 1000 | | 3 | leco | 1000 | | 5 | loocha | 1000 | +----+--------+---------+ 3 rows in set (0.00 sec)","title":"4.1 \u73af\u5883\u51c6\u5907"},{"location":"mysql/mysql.transaction/#42","text":"mysql> # \u4ee5\u4e0b\u662f\u539f\u5b50\u64cd\u4f5c mysql> start transaction; # \u5f00\u542f\u4e8b\u52a1 Query OK, 0 rows affected (0.00 sec) mysql> update user set balance=900 where name='cmz'; #\u4e70\u652f\u4ed8100\u5143 Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> update user set balance=1010 where name='leco'; #\u4e2d\u4ecb\u62ff\u8d7010\u5143 Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> update user set balance=1090 where name='loocha'; #\u5356\u5bb6\u62ff\u523090\u5143 Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0 mysql> commit; Query OK, 0 rows affected (0.01 sec) mysql> select * from user; +----+--------+---------+ | id | name | balance | +----+--------+---------+ | 1 | cmz | 900 | | 3 | leco | 1010 | | 5 | loocha | 1090 | +----+--------+---------+ 3 rows in set (0.00 sec)","title":"4.2 \u539f\u5b50\u64cd\u4f5c"},{"location":"mysql/mysql.transaction/#43","text":"mysql> select * from user; +----+--------+---------+ | id | name | balance | +----+--------+---------+ | 1 | cmz | 900 | | 3 | leco | 1010 | | 5 | loocha | 1090 | +----+--------+---------+ 3 rows in set (0.00 sec) mysql> start transaction; Query OK, 0 rows affected (0.00 sec) mysql> update user set balance=900 where name='cmz'; #\u4e70\u652f\u4ed8100\u5143 Query OK, 0 rows affected (0.00 sec) Rows matched: 1 Changed: 0 Warnings: 0 mysql> update user set balance=1010 where name='leco'; #\u4e2d\u4ecb\u62ff\u8d7010\u5143 Query OK, 0 rows affected (0.00 sec) Rows matched: 1 Changed: 0 Warnings: 0 mysql> uppdate user set balance=1090 where name='loocha'; #\u5356\u5bb6\u62ff\u523090\u5143,\u51fa\u73b0\u5f02\u5e38\u6ca1\u6709\u62ff\u5230 ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'uppdate user set balance=1090 where name='loocha'' at line 1 mysql> rollback; Query OK, 0 rows affected (0.00 sec) mysql> commit; Query OK, 0 rows affected (0.00 sec) mysql> select * from user; +----+--------+---------+ | id | name | balance | +----+--------+---------+ | 1 | cmz | 900 | | 3 | leco | 1010 | | 5 | loocha | 1090 | +----+--------+---------+ 3 rows in set (0.00 sec)","title":"4.3 \u4e8b\u52a1\u56de\u6eda"},{"location":"mysql/mysql.update/","text":"SQL UPDATE 1. \u4ecb\u7ecd \u00b6 \u5982\u679c\u6211\u4eec\u9700\u8981\u4fee\u6539\u6216\u66f4\u65b0 MySQL \u4e2d\u7684\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 SQL UPDATE \u547d\u4ee4\u6765\u64cd\u4f5c\u3002 \u4ee5\u4e0b\u662f UPDATE \u547d\u4ee4\u4fee\u6539 MySQL \u6570\u636e\u8868\u6570\u636e\u7684\u901a\u7528 SQL \u8bed\u6cd5\uff1a UPDATE table_name SET field1=new-value1, field2=new-value2 [WHERE Clause] \u4f60\u53ef\u4ee5\u540c\u65f6\u66f4\u65b0\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u6bb5\u3002 \u4f60\u53ef\u4ee5\u5728 WHERE \u5b50\u53e5\u4e2d\u6307\u5b9a\u4efb\u4f55\u6761\u4ef6\u3002 \u4f60\u53ef\u4ee5\u5728\u4e00\u4e2a\u5355\u72ec\u8868\u4e2d\u540c\u65f6\u66f4\u65b0\u6570\u636e\u3002 \u810f\u6570\u636e \u66f4\u65b0\u8868\u4e2d\u7684\u8bb0\u5f55\u65f6\u8981\u5c0f\u5fc3\uff01 \u8981\u6ce8\u610f SQL UPDATE \u8bed\u53e5\u4e2d\u7684 WHERE \u5b50\u53e5\uff01 WHERE\u5b50\u53e5\u6307\u5b9a\u54ea\u4e9b\u8bb0\u5f55\u9700\u8981\u66f4\u65b0 \u3002\u5982\u679c\u7701\u7565 WHERE\u5b50\u53e5 \uff0c\u6240\u6709\u8bb0\u5f55\u90fd\u5c06\u66f4\u65b0\uff01 2. \u6761\u4ef6\u64cd\u4f5c\u7b26 \u00b6 \u4ee5\u4e0b\u6211\u4eec\u5c06\u5728 SQL UPDATE \u547d\u4ee4\u4f7f\u7528 WHERE \u5b50\u53e5\u6765\u66f4\u65b0 leco \u8868\u4e2d\u5f20\u4e09\u7684age\u7684\u6570\u636e\uff1a 2.1 \u4fee\u6539\u4e4b\u524d\u6570\u636e \u00b6 mysql> select * from leco where name=\"\u5f20\u4e09\"; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | +------+--------+--------+------+ 1 row in set (0.00 sec) 2.2 \u4fee\u6539\u6570\u636e \u00b6 mysql> update leco set age=20 where name=\"\u5f20\u4e09\"; Query OK, 1 row affected (0.01 sec) Rows matched: 1 Changed: 1 Warnings: 0 2.3 \u4fee\u6539\u4e4b\u540e\u6570\u636e \u00b6 mysql> select * from leco where name=\"\u5f20\u4e09\"; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 20 | +------+--------+--------+------+ 1 row in set (0.00 sec) 2.4 \u810f\u6570\u636e \u00b6 \u810f\u6570\u636e\uff08Dirty Read\uff09\u662f\u6307\u6e90\u7cfb\u7edf\u4e2d\u7684\u6570\u636e\u4e0d\u5728\u7ed9\u5b9a\u7684\u8303\u56f4\u5185\u6216\u5bf9\u4e8e\u5b9e\u9645\u4e1a\u52a1\u6beb\u65e0\u610f\u4e49\uff0c\u6216\u662f\u6570\u636e\u683c\u5f0f\u975e\u6cd5\uff0c\u4ee5\u53ca\u5728\u6e90\u7cfb\u7edf\u4e2d\u5b58\u5728\u4e0d\u89c4\u8303\u7684\u7f16\u7801\u548c\u542b\u7cca\u7684\u4e1a\u52a1\u903b\u8f91\u3002 2.4.1 \u6982\u5ff5 \u00b6 \u5728\u6570\u636e\u5e93\u6280\u672f\u4e2d,\u810f\u6570\u636e\u5728\u4e34\u65f6\u66f4\u65b0\uff08\u810f\u8bfb\uff09\u4e2d\u4ea7\u751f\u3002\u4e8b\u52a1A\u66f4\u65b0\u4e86\u67d0\u4e2a\u6570\u636e\u9879X\uff0c\u4f46\u662f\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\uff0c\u4e8b\u52a1A\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u4e8e\u662f\u8981\u628aA\u56de\u6eda\u3002\u4f46\u662f\u5728\u56de\u6eda\u4e4b\u524d\uff0c\u53e6\u4e00\u4e2a\u4e8b\u52a1B\u8bfb\u53d6\u4e86\u6570\u636e\u9879X\u7684\u503c(A\u66f4\u65b0\u540e)\uff0cA\u56de\u6eda\u4e86\u4e8b\u52a1\uff0c\u6570\u636e\u9879\u6062\u590d\u4e86\u539f\u503c\u3002\u4e8b\u52a1B\u8bfb\u53d6\u7684\u5c31\u662f\u6570\u636e\u9879X\u7684\u5c31\u662f\u4e00\u4e2a\u201c\u4e34\u65f6\u201d\u7684\u503c\uff0c\u5c31\u662f\u810f\u6570\u636e\u3002 2.4.2 \u4ea7\u751f \u00b6 \u901a\u4fd7\u7684\u8bb2\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u6b63\u5728\u8bbf\u95ee\u6570\u636e\uff0c\u5e76\u4e14\u5bf9\u6570\u636e\u8fdb\u884c\u4e86\u4fee\u6539\uff0c\u800c\u8fd9\u79cd\u4fee\u6539\u8fd8\u6ca1\u6709\u63d0\u4ea4\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u8fd9\u65f6\uff0c\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4e5f\u8bbf\u95ee\u8fd9\u4e2a\u6570\u636e\uff0c\u7136\u540e\u4f7f\u7528\u4e86\u8fd9\u4e2a\u6570\u636e\u3002\u56e0\u4e3a\u8fd9\u4e2a\u6570\u636e\u662f\u8fd8\u6ca1\u6709\u63d0\u4ea4\u7684\u6570\u636e\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u8bfb\u5230\u7684\u8fd9\u4e2a\u6570\u636e\u662f\u810f\u6570\u636e\uff0c\u4f9d\u636e\u810f\u6570\u636e\u6240\u505a\u7684\u64cd\u4f5c\u53ef\u80fd\u662f\u4e0d\u6b63\u786e\u7684\u3002 2.4.3 \u5904\u7406\u65b9\u6cd5 \u00b6 \u627e\u5230\u5408\u9002\u7684\u70b9\u56de\u6eda\u3002 2.4.4 \u64cd\u4f5c \u00b6 # 1. \u4fee\u6539\u4e4b\u524d mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 20 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec) # 2. \u4fee\u6539 mysql> update leco set age=20; Query OK, 2 rows affected (0.01 sec) Rows matched: 4 Changed: 2 Warnings: 0 \u5f71\u54cd\u4e864\u6761\u6570\u636e\uff0c # 3. \u6b64\u65f6\u518d\u67e5\u770b\u6570\u636e\uff0c\u6570\u636e\u5168\u90e8\u88ab\u4fee\u6539\u4e86\uff0c\u53ef\u89c1update\u7684\u65f6\u5019\u8981\u7ed3\u548cwhere\u7b49\u4fee\u6539 mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 20 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 20 | | 4 | \u8d75\u516d | female | 20 | +------+--------+--------+------+ 4 rows in set (0.00 sec)","title":"08. SQL UPDATE"},{"location":"mysql/mysql.update/#1","text":"\u5982\u679c\u6211\u4eec\u9700\u8981\u4fee\u6539\u6216\u66f4\u65b0 MySQL \u4e2d\u7684\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 SQL UPDATE \u547d\u4ee4\u6765\u64cd\u4f5c\u3002 \u4ee5\u4e0b\u662f UPDATE \u547d\u4ee4\u4fee\u6539 MySQL \u6570\u636e\u8868\u6570\u636e\u7684\u901a\u7528 SQL \u8bed\u6cd5\uff1a UPDATE table_name SET field1=new-value1, field2=new-value2 [WHERE Clause] \u4f60\u53ef\u4ee5\u540c\u65f6\u66f4\u65b0\u4e00\u4e2a\u6216\u591a\u4e2a\u5b57\u6bb5\u3002 \u4f60\u53ef\u4ee5\u5728 WHERE \u5b50\u53e5\u4e2d\u6307\u5b9a\u4efb\u4f55\u6761\u4ef6\u3002 \u4f60\u53ef\u4ee5\u5728\u4e00\u4e2a\u5355\u72ec\u8868\u4e2d\u540c\u65f6\u66f4\u65b0\u6570\u636e\u3002 \u810f\u6570\u636e \u66f4\u65b0\u8868\u4e2d\u7684\u8bb0\u5f55\u65f6\u8981\u5c0f\u5fc3\uff01 \u8981\u6ce8\u610f SQL UPDATE \u8bed\u53e5\u4e2d\u7684 WHERE \u5b50\u53e5\uff01 WHERE\u5b50\u53e5\u6307\u5b9a\u54ea\u4e9b\u8bb0\u5f55\u9700\u8981\u66f4\u65b0 \u3002\u5982\u679c\u7701\u7565 WHERE\u5b50\u53e5 \uff0c\u6240\u6709\u8bb0\u5f55\u90fd\u5c06\u66f4\u65b0\uff01","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.update/#2","text":"\u4ee5\u4e0b\u6211\u4eec\u5c06\u5728 SQL UPDATE \u547d\u4ee4\u4f7f\u7528 WHERE \u5b50\u53e5\u6765\u66f4\u65b0 leco \u8868\u4e2d\u5f20\u4e09\u7684age\u7684\u6570\u636e\uff1a","title":"2. \u6761\u4ef6\u64cd\u4f5c\u7b26"},{"location":"mysql/mysql.update/#21","text":"mysql> select * from leco where name=\"\u5f20\u4e09\"; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | +------+--------+--------+------+ 1 row in set (0.00 sec)","title":"2.1 \u4fee\u6539\u4e4b\u524d\u6570\u636e"},{"location":"mysql/mysql.update/#22","text":"mysql> update leco set age=20 where name=\"\u5f20\u4e09\"; Query OK, 1 row affected (0.01 sec) Rows matched: 1 Changed: 1 Warnings: 0","title":"2.2 \u4fee\u6539\u6570\u636e"},{"location":"mysql/mysql.update/#23","text":"mysql> select * from leco where name=\"\u5f20\u4e09\"; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 20 | +------+--------+--------+------+ 1 row in set (0.00 sec)","title":"2.3 \u4fee\u6539\u4e4b\u540e\u6570\u636e"},{"location":"mysql/mysql.update/#24","text":"\u810f\u6570\u636e\uff08Dirty Read\uff09\u662f\u6307\u6e90\u7cfb\u7edf\u4e2d\u7684\u6570\u636e\u4e0d\u5728\u7ed9\u5b9a\u7684\u8303\u56f4\u5185\u6216\u5bf9\u4e8e\u5b9e\u9645\u4e1a\u52a1\u6beb\u65e0\u610f\u4e49\uff0c\u6216\u662f\u6570\u636e\u683c\u5f0f\u975e\u6cd5\uff0c\u4ee5\u53ca\u5728\u6e90\u7cfb\u7edf\u4e2d\u5b58\u5728\u4e0d\u89c4\u8303\u7684\u7f16\u7801\u548c\u542b\u7cca\u7684\u4e1a\u52a1\u903b\u8f91\u3002","title":"2.4 \u810f\u6570\u636e"},{"location":"mysql/mysql.update/#241","text":"\u5728\u6570\u636e\u5e93\u6280\u672f\u4e2d,\u810f\u6570\u636e\u5728\u4e34\u65f6\u66f4\u65b0\uff08\u810f\u8bfb\uff09\u4e2d\u4ea7\u751f\u3002\u4e8b\u52a1A\u66f4\u65b0\u4e86\u67d0\u4e2a\u6570\u636e\u9879X\uff0c\u4f46\u662f\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\uff0c\u4e8b\u52a1A\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u4e8e\u662f\u8981\u628aA\u56de\u6eda\u3002\u4f46\u662f\u5728\u56de\u6eda\u4e4b\u524d\uff0c\u53e6\u4e00\u4e2a\u4e8b\u52a1B\u8bfb\u53d6\u4e86\u6570\u636e\u9879X\u7684\u503c(A\u66f4\u65b0\u540e)\uff0cA\u56de\u6eda\u4e86\u4e8b\u52a1\uff0c\u6570\u636e\u9879\u6062\u590d\u4e86\u539f\u503c\u3002\u4e8b\u52a1B\u8bfb\u53d6\u7684\u5c31\u662f\u6570\u636e\u9879X\u7684\u5c31\u662f\u4e00\u4e2a\u201c\u4e34\u65f6\u201d\u7684\u503c\uff0c\u5c31\u662f\u810f\u6570\u636e\u3002","title":"2.4.1 \u6982\u5ff5"},{"location":"mysql/mysql.update/#242","text":"\u901a\u4fd7\u7684\u8bb2\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u6b63\u5728\u8bbf\u95ee\u6570\u636e\uff0c\u5e76\u4e14\u5bf9\u6570\u636e\u8fdb\u884c\u4e86\u4fee\u6539\uff0c\u800c\u8fd9\u79cd\u4fee\u6539\u8fd8\u6ca1\u6709\u63d0\u4ea4\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u8fd9\u65f6\uff0c\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4e5f\u8bbf\u95ee\u8fd9\u4e2a\u6570\u636e\uff0c\u7136\u540e\u4f7f\u7528\u4e86\u8fd9\u4e2a\u6570\u636e\u3002\u56e0\u4e3a\u8fd9\u4e2a\u6570\u636e\u662f\u8fd8\u6ca1\u6709\u63d0\u4ea4\u7684\u6570\u636e\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u8bfb\u5230\u7684\u8fd9\u4e2a\u6570\u636e\u662f\u810f\u6570\u636e\uff0c\u4f9d\u636e\u810f\u6570\u636e\u6240\u505a\u7684\u64cd\u4f5c\u53ef\u80fd\u662f\u4e0d\u6b63\u786e\u7684\u3002","title":"2.4.2 \u4ea7\u751f"},{"location":"mysql/mysql.update/#243","text":"\u627e\u5230\u5408\u9002\u7684\u70b9\u56de\u6eda\u3002","title":"2.4.3 \u5904\u7406\u65b9\u6cd5"},{"location":"mysql/mysql.update/#244","text":"# 1. \u4fee\u6539\u4e4b\u524d mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 20 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec) # 2. \u4fee\u6539 mysql> update leco set age=20; Query OK, 2 rows affected (0.01 sec) Rows matched: 4 Changed: 2 Warnings: 0 \u5f71\u54cd\u4e864\u6761\u6570\u636e\uff0c # 3. \u6b64\u65f6\u518d\u67e5\u770b\u6570\u636e\uff0c\u6570\u636e\u5168\u90e8\u88ab\u4fee\u6539\u4e86\uff0c\u53ef\u89c1update\u7684\u65f6\u5019\u8981\u7ed3\u548cwhere\u7b49\u4fee\u6539 mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 20 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 20 | | 4 | \u8d75\u516d | female | 20 | +------+--------+--------+------+ 4 rows in set (0.00 sec)","title":"2.4.4 \u64cd\u4f5c"},{"location":"mysql/mysql.user/","text":"MySQL \u7528\u6237 \u5feb\u901f\u547d\u4ee4 CREATE USER 'username'@'host' IDENTIFIED BY 'password'; CREATE USER 'cmz'@'localhost' IDENTIFIED BY '123456'; # \u521b\u5efa\u7528\u6237\uff0c\u53ea\u80fd\u5728mysql\u7684\u670d\u52a1\u5668\u7aef\u83dc\u80fd\u767b\u5f55\uff0c\u5bc6\u7801\u662f123456 CREATE USER 'cmz'@'192.168.5.122' IDENTIFIED BY '123456'; # \u521b\u5efa\u7528\u6237\uff0c\u9650\u5236\u6765\u8bbf\u7684IP\u5730\u5740\u5fc5\u987b\u662f192.168.5.5.5.5.5.122\uff0c\u5bc6\u7801\u662f123456 CREATE USER 'cmz'@'%' IDENTIFIED BY '123456'; # \u521b\u5efa\u7528\u6237\uff0c\u4e0d\u9650\u5236\u6765\u8bbfIP\uff0c\u5bc6\u7801\u662f123456 CREATE USER 'cmz'@'%' IDENTIFIED BY ''; # \u521b\u5efa\u7528\u6237\uff0c\u4e0d\u9650\u5236\u6765\u8bbfIP\uff0c\u4e0d\u65e0\u5bc6\u7801 CREATE USER 'cmz'@'%'; # \u521b\u5efa\u7528\u6237\uff0c\u4e0d\u9650\u5236\u6765\u8bbfIP\uff0c\u4e0d\u65e0\u5bc6\u7801 \u548c\u4e0a\u9762\u76f8\u7b49 GRANT privileges ON databasename.tablename TO 'username'@'host' GRANT SELECT, INSERT ON cmz.leco TO 'cmz'@'%'; # \u6388\u6743cmz \u7528\u6237\uff0c\u62e5\u6709cmz\u5e93\u7684leco\u8868\u6709select\uff0cinsert \u6743\u9650 GRANT ALL ON *.* TO 'cmz'@'%'; # \u6388\u6743cmz \u7528\u6237\uff0c\u62e5\u6709\u6240\u6709\u6743\u9650 GRANT ALL ON cmz.* TO 'cmz'@'%'; # \u6388\u6743cmz \u7528\u6237\uff0c\u62e5\u6709\u6240cmz\u5e93\u7684\u4e0b\u6240\u6709\u8868\u7684\u6240\u6709\u6743\u9650 SET PASSWORD FOR 'username'@'host' = PASSWORD('newpassword'); SET PASSWORD FOR 'cmz'@'%' = PASSWORD('cmz'); SET PASSWORD = PASSWORD(\"newpassword\"); SET PASSWORD = PASSWORD(\"cmz123456\"); REVOKE privilege ON databasename.tablename FROM 'username'@'host'; REVOKE SELECT ON *.* FROM 'cmz'@'%'; DROP USER 'username'@'host'; drop user 'cmz'; 1. \u521b\u5efa\u7528\u6237 \u00b6 1.1 \u8bed\u6cd5 \u00b6 CREATE USER 'username'@'host' IDENTIFIED BY 'password'; \u53c2\u6570\u89e3\u91ca username \uff1a \u4f60\u5c06\u521b\u5efa\u7684\u7528\u6237\u540d host \uff1a \u6307\u5b9a\u8be5\u7528\u6237\u5728\u54ea\u4e2a\u4e3b\u673a\u4e0a\u53ef\u4ee5\u767b\u9646\uff0c\u5982\u679c\u662f\u672c\u5730\u7528\u6237\u53ef\u7528 localhost \uff0c\u5982\u679c\u60f3\u8ba9\u8be5\u7528\u6237\u53ef\u4ee5\u4ece\u4efb\u610f\u8fdc\u7a0b\u4e3b\u673a\u767b\u9646\uff0c\u53ef\u4ee5\u4f7f\u7528\u901a\u914d\u7b26 % password \uff1a \u8be5\u7528\u6237\u7684\u767b\u9646\u5bc6\u7801\uff0c\u5bc6\u7801\u53ef\u4ee5\u4e3a\u7a7a\uff0c\u5982\u679c\u4e3a\u7a7a\u5219\u8be5\u7528\u6237\u53ef\u4ee5\u4e0d\u9700\u8981\u5bc6\u7801\u767b\u9646\u670d\u52a1\u5668 1.2 \u4f8b\u5b50 \u00b6 CREATE USER 'cmz'@'localhost' IDENTIFIED BY '123456'; # \u521b\u5efa\u7528\u6237\uff0c\u53ea\u80fd\u5728mysql\u7684\u670d\u52a1\u5668\u7aef\u83dc\u80fd\u767b\u5f55\uff0c\u5bc6\u7801\u662f123456 CREATE USER 'cmz'@'192.168.5.122' IDENTIFIED BY '123456'; # \u521b\u5efa\u7528\u6237\uff0c\u9650\u5236\u6765\u8bbf\u7684IP\u5730\u5740\u5fc5\u987b\u662f192.168.2.122\uff0c\u5bc6\u7801\u662f123456 CREATE USER 'cmz'@'%' IDENTIFIED BY '123456'; # \u521b\u5efa\u7528\u6237\uff0c\u4e0d\u9650\u5236\u6765\u8bbfIP\uff0c\u5bc6\u7801\u662f123456 CREATE USER 'cmz'@'%' IDENTIFIED BY ''; # \u521b\u5efa\u7528\u6237\uff0c\u4e0d\u9650\u5236\u6765\u8bbfIP\uff0c\u4e0d\u65e0\u5bc6\u7801 CREATE USER 'cmz'@'%'; # \u521b\u5efa\u7528\u6237\uff0c\u4e0d\u9650\u5236\u6765\u8bbfIP\uff0c\u4e0d\u65e0\u5bc6\u7801 \u548c\u4e0a\u9762\u76f8\u7b49 1.3 \u73af\u5883 \u00b6 root@leco:~# mysql -V mysql Ver 14.14 Distrib 5.7.25, for Linux (x86_64) using EditLine wrapper mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 6 rows in set (0.00 sec) 1.3.1 \u4f8b\u5b501 \u00b6 CREATE USER 'cmz'@'localhost' IDENTIFIED BY '123456'; mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 6 rows in set (0.00 sec) mysql> CREATE USER 'cmz'@'localhost' IDENTIFIED BY '123456'; Query OK, 0 rows affected (0.01 sec) mysql> select * from user; ERROR 1046 (3D000): No database selected mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | repl | | % | root | | localhost | cmz | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 7 rows in set (0.00 sec) \u5728\u670d\u52a1\u5668\u7aef\u767b\u5f55 leco@leco:~$ mysql -ucmz -p123456 mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 79 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u8bf4\u660e\u53ef\u767b\u5f55\uff0c\u6362\u5176\u4ed6\u673a\u5668\u767b\u5f55 C:\\Users\\cmz>mysql -h192.168.5.110 -ucmz -pcmz Warning: Using a password on the command line interface can be insecure. ERROR 1045 (28000): Access denied for user 'cmz'@'192.168.5.1' (using password: YES) \u7981\u6b62\u767b\u5f55\u4e86\u3002 1.3.2 \u4f8b\u5b502 \u00b6 CREATE USER 'cmz'@'192.168.5.122' IDENTIFIED BY '123456'; # 1. \u5148\u5220\u9664\u4e0a\u9762cmz\u7528\u6237\u3002 mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | repl | | % | root | | localhost | cmz | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 7 rows in set (0.00 sec) mysql> drop user cmz@'localhost'; Query OK, 0 rows affected (0.01 sec) mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 6 rows in set (0.00 sec) # 2. \u521b\u5efa\u7528\u6237 mysql> CREATE USER 'cmz'@'192.168.2.112' IDENTIFIED BY '123456'; Query OK, 0 rows affected (0.00 sec) mysql> select host,user from mysql.user; +---------------+------------------+ | host | user | +---------------+------------------+ | % | repl | | % | root | | 192.168.2.112 | cmz | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +---------------+------------------+ 7 rows in set (0.00 sec) # 3. mysql\u670d\u52a1\u5668\u672c\u5730\u767b\u5f55 leco@leco:~$ mysql -ucmz -p123456 mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 1045 (28000): Access denied for user 'cmz'@'localhost' (using password: YES) \u88ab\u62d2\u7edd\uff0c\u6b63\u5e38\u3002 # 4. \u4ece192.168.5.122 \u673a\u5668\u767b\u5f55 C:\\Users\\cmz>mysql -h192.168.5.110 -ucmz -p123456 Warning: Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 100 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u6d4b\u8bd5OK 1.3.3 \u4f8b\u5b503 \u00b6 CREATE USER 'cmz'@'%' IDENTIFIED BY '123456'; mysql> CREATE USER 'cmz'@'%' IDENTIFIED BY '123456'; Query OK, 0 rows affected (0.00 sec) mysql> select host,user from mysql.user where user='cmz'; +------+------+ | host | user | +------+------+ | % | cmz | +------+------+ 1 row in set (0.00 sec) # 1. mysql\u670d\u52a1\u5668\u672c\u5730\u767b\u5f55 leco@leco:~$ mysql -ucmz -p123456 mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 85 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u6d4b\u8bd5OK\u3002 # 2. \u5176\u4ed6\u673a\u5668\u767b\u5f55 C:\\Users\\cmz>mysql -h192.168.5.110 -ucmz -p123456 Warning: Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 87 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u6d4b\u8bd5OK 1.3.4 \u4f8b\u5b504 \u00b6 CREATE USER 'cmz'@'%' IDENTIFIED BY ''; mysql> drop user cmz@'192.168.5.122'; Query OK, 0 rows affected (0.00 sec) mysql> CREATE USER 'cmz'@'%' IDENTIFIED BY ''; Query OK, 0 rows affected (0.01 sec) mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | cmz | | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 7 rows in set (0.00 sec) # 1. \u670d\u52a1\u5668\u672c\u5730\u767b\u5f55 leco@leco:~$ mysql -ucmz Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 104 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u6d4b\u8bd5OK # 2. \u5176\u4ed6\u673a\u5668\u767b\u5f55 C:\\Users\\cmz>mysql -h192.168.5.110 -ucmz Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 103 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u6d4b\u8bd5OK 2. \u6388\u6743 \u00b6 2.1 \u8bed\u6cd5 \u00b6 GRANT privileges ON databasename.tablename TO 'username'@'host' \u53c2\u6570\u89e3\u91ca privileges \uff1a \u7528\u6237\u7684\u64cd\u4f5c\u6743\u9650\uff0c\u5982 SELECT \uff0c INSERT \uff0c UPDATE\u7b49 \uff0c\u5982\u679c\u8981\u6388\u4e88\u6240\u7684\u6743\u9650\u5219\u4f7f\u7528 ALL databasename \uff1a\u6570\u636e\u5e93\u540d tablename \uff1a \u8868\u540d\uff0c\u5982\u679c\u8981\u6388\u4e88\u8be5\u7528\u6237\u5bf9\u6240\u6709\u6570\u636e\u5e93\u548c\u8868\u7684\u76f8\u5e94\u64cd\u4f5c\u6743\u9650\u5219\u53ef\u7528 * \u8868\u793a\uff0c\u5982 *.* 2.2 \u4f8b\u5b50 \u00b6 GRANT SELECT, INSERT ON cmz.leco TO 'cmz'@'%'; # \u6388\u6743cmz \u7528\u6237\uff0c\u62e5\u6709cmz\u5e93\u7684leco\u8868\u6709select\uff0cinsert \u6743\u9650 GRANT ALL ON *.* TO 'cmz'@'%'; # \u6388\u6743cmz \u7528\u6237\uff0c\u62e5\u6709\u6240\u6709\u6743\u9650 GRANT ALL ON cmz.* TO 'cmz'@'%'; # \u6388\u6743cmz \u7528\u6237\uff0c\u62e5\u6709\u6240cmz\u5e93\u7684\u4e0b\u6240\u6709\u8868\u7684\u6240\u6709\u6743\u9650 \u6ce8\u610f 1. grant \u53ef\u4ee5\u6388\u6743\u7684\u540c\u65f6\u521b\u5efa\u8be5\u7528\u6237\uff0c 2. \u7528\u4ee5\u4e0a\u547d\u4ee4\u6388\u6743\u7684\u7528\u6237\u4e0d\u80fd\u7ed9\u5176\u5b83\u7528\u6237\u6388\u6743\uff0c\u5982\u679c\u60f3\u8ba9\u8be5\u7528\u6237\u53ef\u4ee5\u6388\u6743\uff0c\u7528\u4ee5\u4e0b\u547d\u4ee4 : GRANT privileges ON databasename . tablename TO 'username' @ 'host' WITH GRANT OPTION ; 2.3 \u73af\u5883 \u00b6 2.3.1 \u4f8b\u5b501 \u00b6 GRANT SELECT, INSERT ON cmz.leco TO 'cmz'@'%'; mysql> GRANT SELECT, INSERT ON cmz.leco TO 'cmz'@'%'; Query OK, 0 rows affected (0.00 sec) mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | cmz | | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 7 rows in set (0.00 sec) # 1. \u6d4b\u8bd5 leco@leco:~$ mysql -ucmz -p123456 mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 1045 (28000): Access denied for user 'cmz'@'localhost' (using password: YES) leco@leco:~$ mysql -ucmz Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 107 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | cmz | +--------------------+ 2 rows in set (0.00 sec) mysql> use cmz; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +---------------+ | Tables_in_cmz | +---------------+ | leco | +---------------+ 1 row in set (0.00 sec) mysql> desc leco; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> drop table leco; ERROR 1142 (42000): DROP command denied to user 'cmz'@'localhost' for table 'leco' mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 5 rows in set (0.00 sec) mysql> insert into leco(id,name,sex,age) values(5,\"caimengzhi\",'male',30); Query OK, 1 row affected (0.01 sec) mysql> select * from leco; +------+------------+--------+------+ | id | name | sex | age | +------+------------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | | 5 | caimengzhi | male | 30 | +------+------------+--------+------+ 5 rows in set (0.00 sec) \u6d4b\u8bd5OK\u3002 \u5176\u4ed6\u4e24\u4e2a\u4f8b\u5b50\u4e0d\u5728\u6d4b\u8bd5\u3002 3. \u4fee\u6539\u7528\u6237\u5bc6\u7801 \u00b6 3.1 \u8bed\u6cd5 \u00b6 SET PASSWORD FOR 'username'@'host' = PASSWORD('newpassword'); \u82e5\u662f\u8bbe\u7f6e\u5f53\u524d\u767b\u5f55\u7528\u6237 SET PASSWORD = PASSWORD(\"newpassword\"); 3.2 \u4fee\u6539\u67d0\u4e2a\u7528\u6237 \u00b6 mysql> SET PASSWORD FOR 'cmz'@'%' = PASSWORD('cmz'); Query OK, 0 rows affected, 1 warning (0.01 sec) mysql> flush privileges; Query OK, 0 rows affected (0.00 sec \u767b\u5f55\u6d4b\u8bd5 leco@leco:~$ mysql -ucmz -p Enter password: ERROR 1045 (28000): Access denied for user 'cmz'@'localhost' (using password: NO) leco@leco:~$ mysql -ucmz -pcmz mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 110 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u6d4b\u8bd5OK 3.3 \u4fee\u6539\u5f53\u524d\u767b\u5f55\u7528\u6237 \u00b6 leco@leco:~$ mysql -ucmz -pcmz mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 110 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> SET PASSWORD = PASSWORD(\"cmz123456\"); Query OK, 0 rows affected, 1 warning (0.01 sec) mysql> flush privileges; ERROR 1227 (42000): Access denied; you need (at least one of) the RELOAD privilege(s) for this operation mysql> ^DBye leco@leco:~$ mysql -ucmz -pcmz mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 1045 (28000): Access denied for user 'cmz'@'localhost' (using password: YES) leco@leco:~$ mysql -ucmz -pcmz123456 mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 112 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u6d4b\u8bd5OK 4. \u64a4\u9500\u6743\u9650 \u00b6 4.1 \u8bed\u6cd5 \u00b6 REVOKE privilege ON databasename.tablename FROM 'username'@'host'; \u6ce8\u610f privilege , databasename , tablename \uff1a\u540c\u6388\u6743\u90e8\u5206 \u4f8b\u5b50 REVOKE SELECT ON *.* FROM 'cmz'@'%'; 4.2 \u64a4\u9500\u4f8b\u5b50 \u00b6 mysql> show grants for cmz@'%'; +---------------------------------------------------+ | Grants for cmz@% | +---------------------------------------------------+ | GRANT USAGE ON *.* TO 'cmz'@'%' | | GRANT SELECT, INSERT ON `cmz`.`leco` TO 'cmz'@'%' | +---------------------------------------------------+ 2 rows in set (0.00 sec) mysql> revoke insert on cmz.leco from cmz@'%'; Query OK, 0 rows affected (0.01 sec) mysql> show grants for cmz@'%'; +-------------------------------------------+ | Grants for cmz@% | +-------------------------------------------+ | GRANT USAGE ON *.* TO 'cmz'@'%' | | GRANT SELECT ON `cmz`.`leco` TO 'cmz'@'%' | +-------------------------------------------+ 2 rows in set (0.00 sec) # \u6d4b\u8bd5insert\u6743\u9650 leco@leco:~$ mysql -ucmz -pcmz123456 mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 113 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | cmz | +--------------------+ 2 rows in set (0.00 sec) mysql> use cmz; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +---------------+ | Tables_in_cmz | +---------------+ | leco | +---------------+ 1 row in set (0.00 sec) mysql> desc leco; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> select * from leco; +------+------------+--------+------+ | id | name | sex | age | +------+------------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | | 5 | caimengzhi | male | 30 | +------+------------+--------+------+ 6 rows in set (0.00 sec) mysql> insert into cmz(id,name,age,score) values(6,\"keke\",'female',3); ERROR 1142 (42000): INSERT command denied to user 'cmz'@'localhost' for table 'cmz' \u53ef\u4ee5\u770b\u5230\u3002\u4e4b\u524dcmz\u7528\u6237\u62e5\u6709cmz\u5e93\u4e2dleco\u8868\u7684select\uff0cinsert\u6743\u9650\u3002\u56de\u6536insert\u540e\uff0c\u53ea\u6709select\u6743\u9650\u4e86\u3002 5. \u5220\u9664\u7528\u6237 \u00b6 5.1 \u8bed\u6cd5 \u00b6 DROP USER 'username'@'host'; \u6ce8\u610f DROP USER 'username' @ 'host' ; \u82e5\u662f\u4e0d\u6307\u5b9a host\u4e5f\u5c31\u662fDROP USER 'username' \uff0c\u5c31\u662f\u5220\u9664 username\u6240\u6709\u7528\u6237 \u3002 5.2 \u4f8b\u5b50 \u00b6 mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | cmz | | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 7 rows in set (0.00 sec) mysql> drop user 'cmz'; Query OK, 0 rows affected (0.00 sec) mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 6 rows in set (0.00 sec)","title":"09. \u7528\u6237"},{"location":"mysql/mysql.user/#1","text":"","title":"1. \u521b\u5efa\u7528\u6237"},{"location":"mysql/mysql.user/#11","text":"CREATE USER 'username'@'host' IDENTIFIED BY 'password'; \u53c2\u6570\u89e3\u91ca username \uff1a \u4f60\u5c06\u521b\u5efa\u7684\u7528\u6237\u540d host \uff1a \u6307\u5b9a\u8be5\u7528\u6237\u5728\u54ea\u4e2a\u4e3b\u673a\u4e0a\u53ef\u4ee5\u767b\u9646\uff0c\u5982\u679c\u662f\u672c\u5730\u7528\u6237\u53ef\u7528 localhost \uff0c\u5982\u679c\u60f3\u8ba9\u8be5\u7528\u6237\u53ef\u4ee5\u4ece\u4efb\u610f\u8fdc\u7a0b\u4e3b\u673a\u767b\u9646\uff0c\u53ef\u4ee5\u4f7f\u7528\u901a\u914d\u7b26 % password \uff1a \u8be5\u7528\u6237\u7684\u767b\u9646\u5bc6\u7801\uff0c\u5bc6\u7801\u53ef\u4ee5\u4e3a\u7a7a\uff0c\u5982\u679c\u4e3a\u7a7a\u5219\u8be5\u7528\u6237\u53ef\u4ee5\u4e0d\u9700\u8981\u5bc6\u7801\u767b\u9646\u670d\u52a1\u5668","title":"1.1 \u8bed\u6cd5"},{"location":"mysql/mysql.user/#12","text":"CREATE USER 'cmz'@'localhost' IDENTIFIED BY '123456'; # \u521b\u5efa\u7528\u6237\uff0c\u53ea\u80fd\u5728mysql\u7684\u670d\u52a1\u5668\u7aef\u83dc\u80fd\u767b\u5f55\uff0c\u5bc6\u7801\u662f123456 CREATE USER 'cmz'@'192.168.5.122' IDENTIFIED BY '123456'; # \u521b\u5efa\u7528\u6237\uff0c\u9650\u5236\u6765\u8bbf\u7684IP\u5730\u5740\u5fc5\u987b\u662f192.168.2.122\uff0c\u5bc6\u7801\u662f123456 CREATE USER 'cmz'@'%' IDENTIFIED BY '123456'; # \u521b\u5efa\u7528\u6237\uff0c\u4e0d\u9650\u5236\u6765\u8bbfIP\uff0c\u5bc6\u7801\u662f123456 CREATE USER 'cmz'@'%' IDENTIFIED BY ''; # \u521b\u5efa\u7528\u6237\uff0c\u4e0d\u9650\u5236\u6765\u8bbfIP\uff0c\u4e0d\u65e0\u5bc6\u7801 CREATE USER 'cmz'@'%'; # \u521b\u5efa\u7528\u6237\uff0c\u4e0d\u9650\u5236\u6765\u8bbfIP\uff0c\u4e0d\u65e0\u5bc6\u7801 \u548c\u4e0a\u9762\u76f8\u7b49","title":"1.2 \u4f8b\u5b50"},{"location":"mysql/mysql.user/#13","text":"root@leco:~# mysql -V mysql Ver 14.14 Distrib 5.7.25, for Linux (x86_64) using EditLine wrapper mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 6 rows in set (0.00 sec)","title":"1.3 \u73af\u5883"},{"location":"mysql/mysql.user/#131-1","text":"CREATE USER 'cmz'@'localhost' IDENTIFIED BY '123456'; mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 6 rows in set (0.00 sec) mysql> CREATE USER 'cmz'@'localhost' IDENTIFIED BY '123456'; Query OK, 0 rows affected (0.01 sec) mysql> select * from user; ERROR 1046 (3D000): No database selected mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | repl | | % | root | | localhost | cmz | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 7 rows in set (0.00 sec) \u5728\u670d\u52a1\u5668\u7aef\u767b\u5f55 leco@leco:~$ mysql -ucmz -p123456 mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 79 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u8bf4\u660e\u53ef\u767b\u5f55\uff0c\u6362\u5176\u4ed6\u673a\u5668\u767b\u5f55 C:\\Users\\cmz>mysql -h192.168.5.110 -ucmz -pcmz Warning: Using a password on the command line interface can be insecure. ERROR 1045 (28000): Access denied for user 'cmz'@'192.168.5.1' (using password: YES) \u7981\u6b62\u767b\u5f55\u4e86\u3002","title":"1.3.1 \u4f8b\u5b501"},{"location":"mysql/mysql.user/#132-2","text":"CREATE USER 'cmz'@'192.168.5.122' IDENTIFIED BY '123456'; # 1. \u5148\u5220\u9664\u4e0a\u9762cmz\u7528\u6237\u3002 mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | repl | | % | root | | localhost | cmz | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 7 rows in set (0.00 sec) mysql> drop user cmz@'localhost'; Query OK, 0 rows affected (0.01 sec) mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 6 rows in set (0.00 sec) # 2. \u521b\u5efa\u7528\u6237 mysql> CREATE USER 'cmz'@'192.168.2.112' IDENTIFIED BY '123456'; Query OK, 0 rows affected (0.00 sec) mysql> select host,user from mysql.user; +---------------+------------------+ | host | user | +---------------+------------------+ | % | repl | | % | root | | 192.168.2.112 | cmz | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +---------------+------------------+ 7 rows in set (0.00 sec) # 3. mysql\u670d\u52a1\u5668\u672c\u5730\u767b\u5f55 leco@leco:~$ mysql -ucmz -p123456 mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 1045 (28000): Access denied for user 'cmz'@'localhost' (using password: YES) \u88ab\u62d2\u7edd\uff0c\u6b63\u5e38\u3002 # 4. \u4ece192.168.5.122 \u673a\u5668\u767b\u5f55 C:\\Users\\cmz>mysql -h192.168.5.110 -ucmz -p123456 Warning: Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 100 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u6d4b\u8bd5OK","title":"1.3.2 \u4f8b\u5b502"},{"location":"mysql/mysql.user/#133-3","text":"CREATE USER 'cmz'@'%' IDENTIFIED BY '123456'; mysql> CREATE USER 'cmz'@'%' IDENTIFIED BY '123456'; Query OK, 0 rows affected (0.00 sec) mysql> select host,user from mysql.user where user='cmz'; +------+------+ | host | user | +------+------+ | % | cmz | +------+------+ 1 row in set (0.00 sec) # 1. mysql\u670d\u52a1\u5668\u672c\u5730\u767b\u5f55 leco@leco:~$ mysql -ucmz -p123456 mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 85 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u6d4b\u8bd5OK\u3002 # 2. \u5176\u4ed6\u673a\u5668\u767b\u5f55 C:\\Users\\cmz>mysql -h192.168.5.110 -ucmz -p123456 Warning: Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 87 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u6d4b\u8bd5OK","title":"1.3.3 \u4f8b\u5b503"},{"location":"mysql/mysql.user/#134-4","text":"CREATE USER 'cmz'@'%' IDENTIFIED BY ''; mysql> drop user cmz@'192.168.5.122'; Query OK, 0 rows affected (0.00 sec) mysql> CREATE USER 'cmz'@'%' IDENTIFIED BY ''; Query OK, 0 rows affected (0.01 sec) mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | cmz | | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 7 rows in set (0.00 sec) # 1. \u670d\u52a1\u5668\u672c\u5730\u767b\u5f55 leco@leco:~$ mysql -ucmz Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 104 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u6d4b\u8bd5OK # 2. \u5176\u4ed6\u673a\u5668\u767b\u5f55 C:\\Users\\cmz>mysql -h192.168.5.110 -ucmz Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 103 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u6d4b\u8bd5OK","title":"1.3.4 \u4f8b\u5b504"},{"location":"mysql/mysql.user/#2","text":"","title":"2. \u6388\u6743"},{"location":"mysql/mysql.user/#21","text":"GRANT privileges ON databasename.tablename TO 'username'@'host' \u53c2\u6570\u89e3\u91ca privileges \uff1a \u7528\u6237\u7684\u64cd\u4f5c\u6743\u9650\uff0c\u5982 SELECT \uff0c INSERT \uff0c UPDATE\u7b49 \uff0c\u5982\u679c\u8981\u6388\u4e88\u6240\u7684\u6743\u9650\u5219\u4f7f\u7528 ALL databasename \uff1a\u6570\u636e\u5e93\u540d tablename \uff1a \u8868\u540d\uff0c\u5982\u679c\u8981\u6388\u4e88\u8be5\u7528\u6237\u5bf9\u6240\u6709\u6570\u636e\u5e93\u548c\u8868\u7684\u76f8\u5e94\u64cd\u4f5c\u6743\u9650\u5219\u53ef\u7528 * \u8868\u793a\uff0c\u5982 *.*","title":"2.1 \u8bed\u6cd5"},{"location":"mysql/mysql.user/#22","text":"GRANT SELECT, INSERT ON cmz.leco TO 'cmz'@'%'; # \u6388\u6743cmz \u7528\u6237\uff0c\u62e5\u6709cmz\u5e93\u7684leco\u8868\u6709select\uff0cinsert \u6743\u9650 GRANT ALL ON *.* TO 'cmz'@'%'; # \u6388\u6743cmz \u7528\u6237\uff0c\u62e5\u6709\u6240\u6709\u6743\u9650 GRANT ALL ON cmz.* TO 'cmz'@'%'; # \u6388\u6743cmz \u7528\u6237\uff0c\u62e5\u6709\u6240cmz\u5e93\u7684\u4e0b\u6240\u6709\u8868\u7684\u6240\u6709\u6743\u9650 \u6ce8\u610f 1. grant \u53ef\u4ee5\u6388\u6743\u7684\u540c\u65f6\u521b\u5efa\u8be5\u7528\u6237\uff0c 2. \u7528\u4ee5\u4e0a\u547d\u4ee4\u6388\u6743\u7684\u7528\u6237\u4e0d\u80fd\u7ed9\u5176\u5b83\u7528\u6237\u6388\u6743\uff0c\u5982\u679c\u60f3\u8ba9\u8be5\u7528\u6237\u53ef\u4ee5\u6388\u6743\uff0c\u7528\u4ee5\u4e0b\u547d\u4ee4 : GRANT privileges ON databasename . tablename TO 'username' @ 'host' WITH GRANT OPTION ;","title":"2.2 \u4f8b\u5b50"},{"location":"mysql/mysql.user/#23","text":"","title":"2.3 \u73af\u5883"},{"location":"mysql/mysql.user/#231-1","text":"GRANT SELECT, INSERT ON cmz.leco TO 'cmz'@'%'; mysql> GRANT SELECT, INSERT ON cmz.leco TO 'cmz'@'%'; Query OK, 0 rows affected (0.00 sec) mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | cmz | | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 7 rows in set (0.00 sec) # 1. \u6d4b\u8bd5 leco@leco:~$ mysql -ucmz -p123456 mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 1045 (28000): Access denied for user 'cmz'@'localhost' (using password: YES) leco@leco:~$ mysql -ucmz Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 107 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | cmz | +--------------------+ 2 rows in set (0.00 sec) mysql> use cmz; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +---------------+ | Tables_in_cmz | +---------------+ | leco | +---------------+ 1 row in set (0.00 sec) mysql> desc leco; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> drop table leco; ERROR 1142 (42000): DROP command denied to user 'cmz'@'localhost' for table 'leco' mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 5 rows in set (0.00 sec) mysql> insert into leco(id,name,sex,age) values(5,\"caimengzhi\",'male',30); Query OK, 1 row affected (0.01 sec) mysql> select * from leco; +------+------------+--------+------+ | id | name | sex | age | +------+------------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | | 5 | caimengzhi | male | 30 | +------+------------+--------+------+ 5 rows in set (0.00 sec) \u6d4b\u8bd5OK\u3002 \u5176\u4ed6\u4e24\u4e2a\u4f8b\u5b50\u4e0d\u5728\u6d4b\u8bd5\u3002","title":"2.3.1 \u4f8b\u5b501"},{"location":"mysql/mysql.user/#3","text":"","title":"3. \u4fee\u6539\u7528\u6237\u5bc6\u7801"},{"location":"mysql/mysql.user/#31","text":"SET PASSWORD FOR 'username'@'host' = PASSWORD('newpassword'); \u82e5\u662f\u8bbe\u7f6e\u5f53\u524d\u767b\u5f55\u7528\u6237 SET PASSWORD = PASSWORD(\"newpassword\");","title":"3.1 \u8bed\u6cd5"},{"location":"mysql/mysql.user/#32","text":"mysql> SET PASSWORD FOR 'cmz'@'%' = PASSWORD('cmz'); Query OK, 0 rows affected, 1 warning (0.01 sec) mysql> flush privileges; Query OK, 0 rows affected (0.00 sec \u767b\u5f55\u6d4b\u8bd5 leco@leco:~$ mysql -ucmz -p Enter password: ERROR 1045 (28000): Access denied for user 'cmz'@'localhost' (using password: NO) leco@leco:~$ mysql -ucmz -pcmz mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 110 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u6d4b\u8bd5OK","title":"3.2 \u4fee\u6539\u67d0\u4e2a\u7528\u6237"},{"location":"mysql/mysql.user/#33","text":"leco@leco:~$ mysql -ucmz -pcmz mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 110 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> SET PASSWORD = PASSWORD(\"cmz123456\"); Query OK, 0 rows affected, 1 warning (0.01 sec) mysql> flush privileges; ERROR 1227 (42000): Access denied; you need (at least one of) the RELOAD privilege(s) for this operation mysql> ^DBye leco@leco:~$ mysql -ucmz -pcmz mysql: [Warning] Using a password on the command line interface can be insecure. ERROR 1045 (28000): Access denied for user 'cmz'@'localhost' (using password: YES) leco@leco:~$ mysql -ucmz -pcmz123456 mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 112 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> \u6d4b\u8bd5OK","title":"3.3 \u4fee\u6539\u5f53\u524d\u767b\u5f55\u7528\u6237"},{"location":"mysql/mysql.user/#4","text":"","title":"4. \u64a4\u9500\u6743\u9650"},{"location":"mysql/mysql.user/#41","text":"REVOKE privilege ON databasename.tablename FROM 'username'@'host'; \u6ce8\u610f privilege , databasename , tablename \uff1a\u540c\u6388\u6743\u90e8\u5206 \u4f8b\u5b50 REVOKE SELECT ON *.* FROM 'cmz'@'%';","title":"4.1 \u8bed\u6cd5"},{"location":"mysql/mysql.user/#42","text":"mysql> show grants for cmz@'%'; +---------------------------------------------------+ | Grants for cmz@% | +---------------------------------------------------+ | GRANT USAGE ON *.* TO 'cmz'@'%' | | GRANT SELECT, INSERT ON `cmz`.`leco` TO 'cmz'@'%' | +---------------------------------------------------+ 2 rows in set (0.00 sec) mysql> revoke insert on cmz.leco from cmz@'%'; Query OK, 0 rows affected (0.01 sec) mysql> show grants for cmz@'%'; +-------------------------------------------+ | Grants for cmz@% | +-------------------------------------------+ | GRANT USAGE ON *.* TO 'cmz'@'%' | | GRANT SELECT ON `cmz`.`leco` TO 'cmz'@'%' | +-------------------------------------------+ 2 rows in set (0.00 sec) # \u6d4b\u8bd5insert\u6743\u9650 leco@leco:~$ mysql -ucmz -pcmz123456 mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 113 Server version: 5.7.25-0ubuntu0.16.04.2-log (Ubuntu) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> show databases; +--------------------+ | Database | +--------------------+ | information_schema | | cmz | +--------------------+ 2 rows in set (0.00 sec) mysql> use cmz; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +---------------+ | Tables_in_cmz | +---------------+ | leco | +---------------+ 1 row in set (0.00 sec) mysql> desc leco; +-------+-----------------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+-----------------------+------+-----+---------+-------+ | id | int(11) | YES | | NULL | | | name | varchar(50) | YES | | NULL | | | sex | enum('male','female') | YES | | NULL | | | age | int(3) | YES | | NULL | | +-------+-----------------------+------+-----+---------+-------+ 4 rows in set (0.00 sec) mysql> select * from leco; +------+------------+--------+------+ | id | name | sex | age | +------+------------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 4 | \u5f20\u4e09 | male | 40 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | | 5 | caimengzhi | male | 30 | +------+------------+--------+------+ 6 rows in set (0.00 sec) mysql> insert into cmz(id,name,age,score) values(6,\"keke\",'female',3); ERROR 1142 (42000): INSERT command denied to user 'cmz'@'localhost' for table 'cmz' \u53ef\u4ee5\u770b\u5230\u3002\u4e4b\u524dcmz\u7528\u6237\u62e5\u6709cmz\u5e93\u4e2dleco\u8868\u7684select\uff0cinsert\u6743\u9650\u3002\u56de\u6536insert\u540e\uff0c\u53ea\u6709select\u6743\u9650\u4e86\u3002","title":"4.2 \u64a4\u9500\u4f8b\u5b50"},{"location":"mysql/mysql.user/#5","text":"","title":"5. \u5220\u9664\u7528\u6237"},{"location":"mysql/mysql.user/#51","text":"DROP USER 'username'@'host'; \u6ce8\u610f DROP USER 'username' @ 'host' ; \u82e5\u662f\u4e0d\u6307\u5b9a host\u4e5f\u5c31\u662fDROP USER 'username' \uff0c\u5c31\u662f\u5220\u9664 username\u6240\u6709\u7528\u6237 \u3002","title":"5.1 \u8bed\u6cd5"},{"location":"mysql/mysql.user/#52","text":"mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | cmz | | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 7 rows in set (0.00 sec) mysql> drop user 'cmz'; Query OK, 0 rows affected (0.00 sec) mysql> select host,user from mysql.user; +-----------+------------------+ | host | user | +-----------+------------------+ | % | repl | | % | root | | localhost | debian-sys-maint | | localhost | mysql.session | | localhost | mysql.sys | | localhost | root | +-----------+------------------+ 6 rows in set (0.00 sec)","title":"5.2 \u4f8b\u5b50"},{"location":"mysql/mysql.where/","text":"SQL WHERE 1. \u4ecb\u7ecd \u00b6 \u6211\u4eec\u77e5\u9053\u4ece MySQL \u8868\u4e2d\u4f7f\u7528 SQL SELECT \u8bed\u53e5\u6765\u8bfb\u53d6\u6570\u636e\u3002\u5982\u9700\u6709\u6761\u4ef6\u5730\u4ece\u8868\u4e2d\u9009\u53d6\u6570\u636e\uff0c\u53ef\u5c06 WHERE \u5b50\u53e5\u6dfb\u52a0\u5230 SELECT \u8bed\u53e5\u4e2d\u3002 \u4ee5\u4e0b\u662f SQL SELECT \u8bed\u53e5\u4f7f\u7528 WHERE \u5b50\u53e5\u4ece\u6570\u636e\u8868\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\u901a\u7528\u8bed\u6cd5\uff1a SELECT field1, field2,...fieldN FROM table_name1, table_name2... [WHERE condition1 [AND [OR]] condition2..... \u67e5\u8be2\u8bed\u53e5\u4e2d\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u8868\uff0c\u8868\u4e4b\u95f4\u4f7f\u7528\u9017\u53f7, \u5206\u5272\uff0c\u5e76\u4f7f\u7528WHERE\u8bed\u53e5\u6765\u8bbe\u5b9a\u67e5\u8be2\u6761\u4ef6\u3002 \u4f60\u53ef\u4ee5\u5728 WHERE \u5b50\u53e5\u4e2d\u6307\u5b9a\u4efb\u4f55\u6761\u4ef6\u3002 \u4f60\u53ef\u4ee5\u4f7f\u7528 AND \u6216\u8005 OR \u6307\u5b9a\u4e00\u4e2a\u6216\u591a\u4e2a\u6761\u4ef6\u3002 WHERE \u5b50\u53e5\u4e5f\u53ef\u4ee5\u8fd0\u7528\u4e8e SQL \u7684 DELETE \u6216\u8005 UPDATE \u547d\u4ee4\u3002 WHERE \u5b50\u53e5\u7c7b\u4f3c\u4e8e\u7a0b\u5e8f\u8bed\u8a00\u4e2d\u7684 if \u6761\u4ef6\uff0c\u6839\u636e MySQL \u8868\u4e2d\u7684\u5b57\u6bb5\u503c\u6765\u8bfb\u53d6\u6307\u5b9a\u7684\u6570\u636e\u3002 2. \u6761\u4ef6\u64cd\u4f5c\u7b26 \u00b6 \u5728\u914d\u5408sql \u7684\u65f6\u5019\uff0c\u4f7f\u7528\u7684\u6761\u4ef6 \u64cd\u4f5c\u7b26 \u63cf\u8ff0 = \u7b49\u53f7\uff0c\u68c0\u6d4b\u4e24\u4e2a\u503c\u662f\u5426\u76f8\u7b49\uff0c\u5982\u679c\u76f8\u7b49\u8fd4\u56detrue <>, != \u4e0d\u7b49\u4e8e\uff0c\u68c0\u6d4b\u4e24\u4e2a\u503c\u662f\u5426\u76f8\u7b49\uff0c\u5982\u679c\u4e0d\u76f8\u7b49\u8fd4\u56detrue > \u5927\u4e8e\u53f7\uff0c\u68c0\u6d4b\u5de6\u8fb9\u7684\u503c\u662f\u5426\u5927\u4e8e\u53f3\u8fb9\u7684\u503c, \u5982\u679c\u5de6\u8fb9\u7684\u503c\u5927\u4e8e\u53f3\u8fb9\u7684\u503c\u8fd4\u56detrue < \u5c0f\u4e8e\u53f7\uff0c\u68c0\u6d4b\u5de6\u8fb9\u7684\u503c\u662f\u5426\u5c0f\u4e8e\u53f3\u8fb9\u7684\u503c, \u5982\u679c\u5de6\u8fb9\u7684\u503c\u5c0f\u4e8e\u53f3\u8fb9\u7684\u503c\u8fd4\u56detrue >= \u5927\u4e8e\u7b49\u4e8e\u53f7\uff0c\u68c0\u6d4b\u5de6\u8fb9\u7684\u503c\u662f\u5426\u5927\u4e8e\u6216\u7b49\u4e8e\u53f3\u8fb9\u7684\u503c, \u5982\u679c\u5de6\u8fb9\u7684\u503c\u5927\u4e8e\u6216\u7b49\u4e8e\u53f3\u8fb9\u7684\u503c\u8fd4\u56detrue <= \u5c0f\u4e8e\u7b49\u4e8e\u53f7\uff0c\u68c0\u6d4b\u5de6\u8fb9\u7684\u503c\u662f\u5426\u5c0f\u4e8e\u4e8e\u6216\u7b49\u4e8e\u53f3\u8fb9\u7684\u503c, \u5982\u679c\u5de6\u8fb9\u7684\u503c\u5c0f\u4e8e\u6216\u7b49\u4e8e\u53f3\u8fb9\u7684\u503c\u8fd4\u56detrue \u5982\u679c\u6211\u4eec\u60f3\u5728 MySQL \u6570\u636e\u8868\u4e2d\u8bfb\u53d6\u6307\u5b9a\u7684\u6570\u636e\uff0cWHERE \u5b50\u53e5\u662f\u975e\u5e38\u6709\u7528\u7684\u3002\u4f7f\u7528\u4e3b\u952e\u6765\u4f5c\u4e3a WHERE \u5b50\u53e5\u7684\u6761\u4ef6\u67e5\u8be2\u662f\u975e\u5e38\u5feb\u901f\u7684\u3002\u5982\u679c\u7ed9\u5b9a\u7684\u6761\u4ef6\u5728\u8868\u4e2d\u6ca1\u6709\u4efb\u4f55\u5339\u914d\u7684\u8bb0\u5f55\uff0c\u90a3\u4e48\u67e5\u8be2\u4e0d\u4f1a\u8fd4\u56de\u4efb\u4f55\u6570\u636e\u3002 2.1 \u5b9e\u4f8b\u64cd\u4f5c \u00b6 mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec) mysql> select * from leco where id>2; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 2 rows in set (0.00 sec) mysql> select * from leco where id<2; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | +------+--------+--------+------+ 1 row in set (0.00 sec) mysql> select * from leco where id<>2; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 3 rows in set (0.00 sec) mysql> select * from leco where id!=2; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 3 rows in set (0.00 sec) mysql> select * from leco where id>=2; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 3 rows in set (0.00 sec) mysql> select * from leco where id<=2; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | +------+--------+--------+------+ 2 rows in set (0.00 sec)","title":"07. SQL WHERE"},{"location":"mysql/mysql.where/#1","text":"\u6211\u4eec\u77e5\u9053\u4ece MySQL \u8868\u4e2d\u4f7f\u7528 SQL SELECT \u8bed\u53e5\u6765\u8bfb\u53d6\u6570\u636e\u3002\u5982\u9700\u6709\u6761\u4ef6\u5730\u4ece\u8868\u4e2d\u9009\u53d6\u6570\u636e\uff0c\u53ef\u5c06 WHERE \u5b50\u53e5\u6dfb\u52a0\u5230 SELECT \u8bed\u53e5\u4e2d\u3002 \u4ee5\u4e0b\u662f SQL SELECT \u8bed\u53e5\u4f7f\u7528 WHERE \u5b50\u53e5\u4ece\u6570\u636e\u8868\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\u901a\u7528\u8bed\u6cd5\uff1a SELECT field1, field2,...fieldN FROM table_name1, table_name2... [WHERE condition1 [AND [OR]] condition2..... \u67e5\u8be2\u8bed\u53e5\u4e2d\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u8868\uff0c\u8868\u4e4b\u95f4\u4f7f\u7528\u9017\u53f7, \u5206\u5272\uff0c\u5e76\u4f7f\u7528WHERE\u8bed\u53e5\u6765\u8bbe\u5b9a\u67e5\u8be2\u6761\u4ef6\u3002 \u4f60\u53ef\u4ee5\u5728 WHERE \u5b50\u53e5\u4e2d\u6307\u5b9a\u4efb\u4f55\u6761\u4ef6\u3002 \u4f60\u53ef\u4ee5\u4f7f\u7528 AND \u6216\u8005 OR \u6307\u5b9a\u4e00\u4e2a\u6216\u591a\u4e2a\u6761\u4ef6\u3002 WHERE \u5b50\u53e5\u4e5f\u53ef\u4ee5\u8fd0\u7528\u4e8e SQL \u7684 DELETE \u6216\u8005 UPDATE \u547d\u4ee4\u3002 WHERE \u5b50\u53e5\u7c7b\u4f3c\u4e8e\u7a0b\u5e8f\u8bed\u8a00\u4e2d\u7684 if \u6761\u4ef6\uff0c\u6839\u636e MySQL \u8868\u4e2d\u7684\u5b57\u6bb5\u503c\u6765\u8bfb\u53d6\u6307\u5b9a\u7684\u6570\u636e\u3002","title":"1. \u4ecb\u7ecd"},{"location":"mysql/mysql.where/#2","text":"\u5728\u914d\u5408sql \u7684\u65f6\u5019\uff0c\u4f7f\u7528\u7684\u6761\u4ef6 \u64cd\u4f5c\u7b26 \u63cf\u8ff0 = \u7b49\u53f7\uff0c\u68c0\u6d4b\u4e24\u4e2a\u503c\u662f\u5426\u76f8\u7b49\uff0c\u5982\u679c\u76f8\u7b49\u8fd4\u56detrue <>, != \u4e0d\u7b49\u4e8e\uff0c\u68c0\u6d4b\u4e24\u4e2a\u503c\u662f\u5426\u76f8\u7b49\uff0c\u5982\u679c\u4e0d\u76f8\u7b49\u8fd4\u56detrue > \u5927\u4e8e\u53f7\uff0c\u68c0\u6d4b\u5de6\u8fb9\u7684\u503c\u662f\u5426\u5927\u4e8e\u53f3\u8fb9\u7684\u503c, \u5982\u679c\u5de6\u8fb9\u7684\u503c\u5927\u4e8e\u53f3\u8fb9\u7684\u503c\u8fd4\u56detrue < \u5c0f\u4e8e\u53f7\uff0c\u68c0\u6d4b\u5de6\u8fb9\u7684\u503c\u662f\u5426\u5c0f\u4e8e\u53f3\u8fb9\u7684\u503c, \u5982\u679c\u5de6\u8fb9\u7684\u503c\u5c0f\u4e8e\u53f3\u8fb9\u7684\u503c\u8fd4\u56detrue >= \u5927\u4e8e\u7b49\u4e8e\u53f7\uff0c\u68c0\u6d4b\u5de6\u8fb9\u7684\u503c\u662f\u5426\u5927\u4e8e\u6216\u7b49\u4e8e\u53f3\u8fb9\u7684\u503c, \u5982\u679c\u5de6\u8fb9\u7684\u503c\u5927\u4e8e\u6216\u7b49\u4e8e\u53f3\u8fb9\u7684\u503c\u8fd4\u56detrue <= \u5c0f\u4e8e\u7b49\u4e8e\u53f7\uff0c\u68c0\u6d4b\u5de6\u8fb9\u7684\u503c\u662f\u5426\u5c0f\u4e8e\u4e8e\u6216\u7b49\u4e8e\u53f3\u8fb9\u7684\u503c, \u5982\u679c\u5de6\u8fb9\u7684\u503c\u5c0f\u4e8e\u6216\u7b49\u4e8e\u53f3\u8fb9\u7684\u503c\u8fd4\u56detrue \u5982\u679c\u6211\u4eec\u60f3\u5728 MySQL \u6570\u636e\u8868\u4e2d\u8bfb\u53d6\u6307\u5b9a\u7684\u6570\u636e\uff0cWHERE \u5b50\u53e5\u662f\u975e\u5e38\u6709\u7528\u7684\u3002\u4f7f\u7528\u4e3b\u952e\u6765\u4f5c\u4e3a WHERE \u5b50\u53e5\u7684\u6761\u4ef6\u67e5\u8be2\u662f\u975e\u5e38\u5feb\u901f\u7684\u3002\u5982\u679c\u7ed9\u5b9a\u7684\u6761\u4ef6\u5728\u8868\u4e2d\u6ca1\u6709\u4efb\u4f55\u5339\u914d\u7684\u8bb0\u5f55\uff0c\u90a3\u4e48\u67e5\u8be2\u4e0d\u4f1a\u8fd4\u56de\u4efb\u4f55\u6570\u636e\u3002","title":"2. \u6761\u4ef6\u64cd\u4f5c\u7b26"},{"location":"mysql/mysql.where/#21","text":"mysql> select * from leco; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 4 rows in set (0.00 sec) mysql> select * from leco where id>2; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 2 rows in set (0.00 sec) mysql> select * from leco where id<2; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | +------+--------+--------+------+ 1 row in set (0.00 sec) mysql> select * from leco where id<>2; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 3 rows in set (0.00 sec) mysql> select * from leco where id!=2; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 3 rows in set (0.00 sec) mysql> select * from leco where id>=2; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 2 | \u674e\u56db | male | 20 | | 3 | \u738b\u4e94 | male | 30 | | 4 | \u8d75\u516d | female | 40 | +------+--------+--------+------+ 3 rows in set (0.00 sec) mysql> select * from leco where id<=2; +------+--------+--------+------+ | id | name | sex | age | +------+--------+--------+------+ | 1 | \u5f20\u4e09 | female | 18 | | 2 | \u674e\u56db | male | 20 | +------+--------+--------+------+ 2 rows in set (0.00 sec)","title":"2.1 \u5b9e\u4f8b\u64cd\u4f5c"},{"location":"python/django/form/django.form/","text":"Django \u8868\u5355 1. \u4ecb\u7ecd \u00b6 forms\u7ec4\u4ef6\u4e3b\u8981\u529f\u80fd\u662f\u68c0\u9a8c\u5b57\u6bb5\u7684\u529f\u80fd\uff0c\u6821\u9a8c\u8868\u5355\u4e2d\u7684\u952e\u503c\u5bf9\u7684\u529f\u80fd 2. \u529f\u80fd \u00b6 2.1 \u5bfc\u5165forms\u7ec4\u4ef6 \u00b6 from django import forms 2.2 \u5efa\u7c7b \u00b6 class UserForm(forms.Form): name = forms.CharField(min_length=4) email=forms.EmailField() \u6ce8\u610f 1. name\u5b57\u6bb5\u6700\u5c0f\u4e0d\u5f97\u5c0f\u4e8e4\u4e2a\u5b57\u8282 \uff0c email\u5b57\u6bb5\u5fc5\u987b\u90ae\u7bb1\u683c\u5f0f 2. \u8be5\u7c7b\u5fc5\u987b\u7ee7\u627f forms . Form 3. \u53ea\u6821\u9a8c UserForm\u4e2d\u7684\u5b57\u6bb5 \uff0c\u4f20\u5165\u7684\u5176\u4ed6\u5b57\u6bb5\u4f1a\u88ab\u5ffd\u89c6\uff0c\u4e0d\u4f1a\u6821\u9a8c\u3002 4. forms\u5b58\u5728\u8be5\u5b57\u6bb5 \uff0c\u6821\u9a8c\u65f6\u8be5\u5b57\u6bb5\u5c31\u4e0d\u80fd\u4e3a\u7a7a \u4e00\u4e9b\u5e38\u7528\u7684\u6821\u9a8c\u51fd\u6570\u53ca\u5176\u53c2\u6570 \u6821\u9a8c\u51fd\u6570 \u89e3\u91ca CharField \u6821\u9a8c\u5b57\u7b26\u4e32\uff0c\u53ef\u4ee5\u8bbe\u7f6emax_length\u6700\u5927\u957f\u5ea6\u6216\u6700\u5c0f\u957f\u5ea6min_length DecimalField \u6821\u9a8c\u9a8c\u8bc1\u6570\u5b57\uff0c\u524d\u540e\u7a7a\u683c\u4f1a\u88ab\u5ffd\u7565\uff0cmax_value\u548cmin_value\u63a7\u5236\u603b\u957f\u5ea6\uff0c\u5e76\u5e94\u4f5c\u4e3adecimal.Decimal\u503c\u7ed9\u51fa\u3002max_digits\u5141\u8bb8\u7684\u5c0f\u6570+\u6574\u6570\u603b\u4f4d\u6570;decimal_places\u5141\u8bb8\u7684\u6700\u5927\u5c0f\u6570\u4f4d\u6570\u3002 EmailField \u662f\u5426\u4e3a\u6709\u6548\u7684\u7535\u5b50\u90ae\u4ef6\u5730\u5740,\u53ef\u9009\u53c2\u6570max_length\u548cmin_length FileField \u975e\u7a7a\u6587\u4ef6\u6570\u636e\u662f\u5426\u5df2\u7ed1\u5b9a\u5230\u8868\u5355,max_length\u6587\u4ef6\u6700\u5927\u5927\u5c0f\u548callow_empty_file\u6587\u4ef6\u662f\u5426\u53ef\u4ee5\u4e3a\u7a7a FloatField \u9a8c\u8bc1\u7ed9\u5b9a\u503c\u662f\u5426\u4e3afloat,\u53ef\u9009max_value\u5e76\u4e14min_value IntegerField \u9a8c\u8bc1\u7ed9\u5b9a\u503c\u662f\u5426\u4e3a\u6574\u6570\u3002\u53ef\u9009max_value\u548cmin_value 2.3 \u5b9e\u4f8b\u5316 \u00b6 \u5c06\u9700\u8981\u9a8c\u8bc1\u7684\u8868\u5355\u503c\u4f20\u5165\uff0c\u68c0\u9a8c\u662f\u5426\u5408\u6cd5 form=UserForm({\"name\":\"caimegzhi\",\"email\":\"610658552@qq.com\"}) \u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f20\u5165POST\u5b57\u5178\uff08\u4f46\u662f\u524d\u6bb5\u952e\u503c\u5fc5\u987b\u4e0eform\u4e00\u4e00\u5bf9\u5e94\uff09 form = UserForm(request.POST) 2.4 \u6821\u9a8c \u00b6 \u76f8\u5173API \u529f\u80fd form.is_valid() \u6821\u9a8c\u5168\u90e8\u901a\u8fc7\u8fd4\u56deTrue,\u5426\u5219\u8fd4\u56deFalse form.cleaned_data \u8fd4\u56de\u5b57\u5178\uff0c\u53ef\u4ee5\u67e5\u770b\u6821\u9a8c\u6210\u529f\u7684\u5b57\u6bb5\uff08\u952e\u503c\u90fd\u653e\u5165\uff09 form.errors \u53ef\u4ee5\u67e5\u770b\u6821\u9a8c\u5931\u8d25\u7684\u5b57\u6bb5\uff08\u952e\u4e3a\u6821\u9a8c\u9519\u8bef\u7684\u952e\uff0c\u503c\u4e3a\u9519\u8bef\u4fe1\u606f\u7684\u5217\u8868\uff09 2.5 \u6e32\u67d3\u6807\u7b7e \u00b6 forms\u7ec4\u4ef6\u8fd8\u53ef\u4ee5\u81ea\u52a8\u4e3a\u6211\u4eec\u5728form\u8868\u5355\u4e2d\u6e32\u67d3\u6821\u9a8c\u5b57\u6bb5\u7684\u8868\u5355\u3002 2.6 \u5b9e\u4f8b\u5316 \u00b6 \u9996\u5148\u5b9e\u4f8b\u5316\u4e00\u4e2aforms\u7c7b form=UserForm() \u4e0d\u7528\u4f20\u503c 2.7 \u8c03\u7528 \u00b6 2.7.1 \u65b9\u5f0f1 \u00b6 \u4f7f\u7528\u6807\u7b7e {{ form.\u5b57\u6bb5 }} \u53ef\u4ee5\u6e32\u67d3\u51fa\u76f8\u5e94\u7684input\u6807\u7b7e,\u5728HTML\u4e2d <form action=\"\" method=\"post\"> {% csrf_token %} <p>\u7528\u6237\u540d\uff1a{{ form.name }}</p> <p>\u5bc6\u7801\uff1a{{ form.pwd }}</p> <p>\u518d\u6b21\u786e\u8ba4\u5bc6\u7801\uff1a{{ form.re_pwd }}</p> <p>\u90ae\u7bb1\uff1a{{ form.email }}</p> <p>\u7535\u8bdd\uff1a{{ form.tel }}</p> <input type=\"submit\" value=\"\u6ce8\u518c\"> </form> \u89c6\u56fe\u51fd\u6570 form=UserForm() forms\u7ec4\u4ef6\u5c06\u81ea\u52a8\u5c06\u751f\u6210\u6807\u7b7ename\u5c5e\u6027\u53d8\u6210\u76f8\u5e94\u7684\u5b57\u6bb5\u540d \u6bd4\u5982\u8bf4<p>\u7528\u6237\u540d\uff1a{{ form.name }}</p> \u7b49\u540c\u4e8e<p>\u7528\u6237\u540d\uff1a<input type=\"text\" name=\"name\"></p> 2.7.2 \u65b9\u5f0f2 \u63a8\u8350 \u00b6 \u4f7f\u7528for\u5faa\u73af\u6807\u7b7e <form action=\"\" method=\"post\"> {% csrf_token %} {% for field in form %} <p> <label>{{ field.label }}</label> {{ field }} <span>{{ field.errors.0 }}</span> </p> {% endfor %} <input type=\"submit\" value=\"\u6ce8\u518c\"> </form> \u4f7f\u7528 {{ form.\u5b57\u6bb5.label }} \u53ef\u4ee5\u6e32\u67d3\u51fa\u76f8\u5e94\u7684label\u6807\u7b7e \u6ce8\u610f\uff1alabel\u6807\u7b7e\u9ed8\u8ba4\u663e\u793a\u7684\u662f\u5b57\u6bb5\u540d\uff0c\u5982\u679c\u60f3\u4fee\u6539label\u6807\u7b7e\u663e\u793a\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u5728\u521b\u5efaforms\u7c7b\u65f6\u6307\u5b9a class UserForm(forms.Form): name = forms.CharField(min_length=4,label=\"\u7528\u6237\u540d\") email=forms.EmailField(label=\"\u90ae\u7bb1\") \u4f7f\u7528label\u53c2\u6570\u8fdb\u884c\u6307\u5b9a\uff0c\u7528\u8fd9\u4e2aUserForm\u6e32\u67d3\u51fa\u7684\u6548\u679c\u76f8\u5f53\u4e8e <p>\u7528\u6237\u540d\uff1a{{ form.name }}</p> <p>\u90ae\u7bb1\uff1a{{ form.email }}</p> 2.7.3 \u65b9\u5f0f3 \u4e0d\u63a8\u8350 \u00b6 <form action=\"\" method=\"post\"> {% csrf_token %} {{ form.as_ul }} <input type=\"submit\" value=\"\u6ce8\u518c\"> </form> \u4f7f\u7528 {{ form.as_ul }} \u53ef\u4ee5\u81ea\u52a8\u6e32\u67d3\u6240\u6709\u5b57\u6bb5\uff0c\u6bcf\u4e2a\u5b57\u6bb5\u4f7f\u7528label\u548cinput\u6e32\u67d3\uff0c\u5e76\u4e14\u7528ul\u5305\u88f9\u8fd8\u53ef\u4ee5\u9009\u62e9\u7528 as_p() , as_table() \u5206\u522b\u662f\u7528 p \uff0c table \u6807\u7b7e\u5305\u88f9 2.8 \u91cd\u7f6e\u9875\u9762 \u00b6 \u5f53\u7528\u6237\u8868\u5355\u8f93\u5165\u9519\u8bef\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u81ea\u5df1\u4f20\u5165\u53c2\u6570\uff0c\u8bbe\u7f6e\u5404\u4e2ainput\u7684value\u503c\uff0c\u6765\u6e32\u67d3\u51fa\u4e00\u4e2a\u91cd\u7f6e\u9875\u9762\uff0c\u4f7f\u7528forms\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u5feb\u901f\u6e32\u67d3\u51fa\u4e00\u4e2a\u91cd\u7f6e\u754c\u9762\uff0c\u53ea\u9700\u7b80\u5355\u8bbe\u7f6e\u51e0\u6b65\u5373\u53ef def register(request): if request.method ==\"POST\": form = UserForm(request.POST) if form.is_valid(): return HttpResponse(\"ok\") else: return render(request,\"register.html\",locals()) else: form = UserForm() return render(request,\"register.html\",locals()) \u7b80\u5355\u8bf4\uff0c\u5982\u679c\u7528\u6237\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee\u9875\u9762\u65f6\uff0c\u53d1\u9001\u7684\u662fget\u8bf7\u6c42\uff0c\u6211\u4eec\u4f7f\u7528form = UserForm()\u4f20\u5165\u4e00\u4e2a\u6ca1\u6709\u53c2\u6570\u7684forms\u5bf9\u8c61\uff0c\u5728\u6d4f\u89c8\u5668\u4e2d\uff0c\u5c06\u81ea\u52a8\u6e32\u67d3\u51fa\u5404\u4e2a\u5b57\u6bb5\u7684\u7a7a\u767d\u6807\u7b7e \u5982\u679c\u7528\u6237\u63d0\u4ea4\u8868\u5355\u65f6\uff0c\u6211\u4eec\u5b9e\u4f8b\u5316\u4e00\u4e2aform = UserForm(request.POST)\u5e26\u6709\u53c2\u6570\u7684forms\u5bf9\u8c61\uff0c\u540c\u6837\u7684\uff0c\u6d4f\u89c8\u5668\u4e2d\u4f1a\u6e32\u67d3\u51fa\u63d0\u4ea4\u8868\u5355\u4f20\u5165\u7684\u53c2\u6570\u5185\u5bb9\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u8f93\u5165\u9519\u8bef\u65f6\uff0c\u8fd4\u56de\u7684\u8868\u5355\u4e2d\u7528\u6237\u8f93\u5165\u7684\u5185\u5bb9\u4e0d\u4f1a\u4e3a\u7a7a\uff0c\u4f1a\u662f\u7528\u6237\u4e0a\u6b21\u8f93\u5165\u9519\u8bef\u7684\u5185\u5bb9 2.9 \u9519\u8bef\u663e\u793a \u00b6 \u5982\u679c\u6211\u4eec\u60f3\u5728\u6821\u9a8c\u6570\u636e\u4e4b\u540e\uff0c\u5c06\u9519\u8bef\u4fe1\u606f\u8f93\u5165\u5230HTML\u9875\u9762\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u505a\u3002 2.9.1 \u5b9e\u4f8b\u5316 \u00b6 \u9996\u5148\u5c06\u5b9e\u4f8b\u5316\u7684forms\u5bf9\u8c61\u4f20\u5165HTML\u3002\u8fd9\u6837\u76f4\u63a5\u5c06\u5c40\u90e8\u53d8\u91cf\u5168\u90e8\u5f53\u6620\u5c04\u5230HTML\u6a21\u677f\u4e2d\uff08\u5305\u62ecform\uff09 form = UserForm() return render(request,\"register.html\",locals()) 2.9.2 \u8c03\u7528 \u00b6 \u5728HTML\u6a21\u677f\u4e2d\u8c03\u7528\u76f8\u5e94\u7684\u5bf9\u8c61\u3002 <form action=\"\" method=\"post\"> {% csrf_token %} <p>\u7528\u6237\u540d\uff1a{{ form.name }}<span>{{ form.name.errors.0 }}</span></p> <p>\u5bc6\u7801\uff1a{{ form.pwd }}<span>{{ form.pwd.errors.0 }}</span></p> <p>\u518d\u6b21\u786e\u8ba4\u5bc6\u7801\uff1a{{ form.re_pwd }}<span>{{ form.re_pwd.errors.0 }}</span></p> <p>\u90ae\u7bb1\uff1a{{ form.email }}<span>{{ form.email.errors.0 }}</span></p> <p>\u7535\u8bdd\uff1a{{ form.tel }}<span>{{ form.tel.errors.0 }}</span></p> <input type=\"submit\" value=\"\u6ce8\u518c\"> </form> \u4f7f\u7528 {{ form.\u5b57\u6bb5.errors.0 }} \u6807\u7b7e \u5982\u679c\u76f8\u5e94\u5b57\u6bb5\u9519\u8bef\uff0c\u53ef\u4ee5\u6e32\u67d3\u51fa\u76f8\u5e94\u7684\u9519\u8bef\u4fe1\u606f {{form.\u5b57\u6bb5.errors}} \u662f\u4e00\u4e2a\u9519\u8bef\u5217\u8868\uff0c\u6211\u4eec\u4f7f\u7528 {{ form.\u5b57\u6bb5.errors.0 }} \u53ea\u53d6\u51fa\u7b2c\u4e00\u4e2a\u9519\u8bef\u4fe1\u606f\uff09 2.10 \u53c2\u6570\u914d\u7f6e \u00b6 \u4f7f\u7528widgets\u6a21\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u7ed9forms\u7c7b\u4e2d\u7684\u5b57\u6bb5\u8bbe\u7f6e\u76f8\u5e94\u7684\u53c2\u6570 2.10.1 \u5bfc\u5165 \u00b6 form django.forms import widgets 2.10.2 \u914d\u7f6e \u00b6 \u8bbe\u7f6eforms\u7ec4\u4ef6\u5728\u6a21\u677f\u4e2d\u751f\u6210\u7684\u5143\u7d20\u7c7b\u578b\uff0c\u5982\u679c\u6211\u4eec\u8bbe\u7f6e\u4e00\u4e2a\u6821\u9a8c\u5b57\u6bb5\u4e3aCharField\u7c7b\u578b\uff0c\u90a3\u4e48\u5728HTML\u6a21\u677f\u4e2d\u751f\u6210\u7684\u6807\u7b7e\u5373\u4e3a \u7c7b\u578b \u5982\u679c\u6211\u4eec\u60f3\u4fee\u6539\u751f\u6210\u7684\u6807\u7b7e\u7c7b\u578b\uff0c\u600e\u4e48\u529e\uff1f pwd =forms.CharField(min_length=4,widget=widgets.PasswordInput()) \u4f7f\u7528widget\u53c2\u6570\u53ef\u4ee5\u8bbe\u7f6e\u6807\u7b7e\u7c7b\u578b\uff0c PasswordInput() \u4ee3\u8868\u5c06\u81ea\u52a8\u751f\u6210```\u7c7b\u578b\u6807\u7b7e 2.10.3 \u5143\u7d20\u751f\u6210 \u00b6 \u8bbe\u7f6eforms\u7ec4\u4ef6\u5728\u6a21\u677f\u4e2d\u751f\u6210\u5143\u7d20\u7684\u5c5e\u6027\uff0c\u5982\u679c\u6211\u4eec\u60f3\u7ed9\u6bcf\u4e00\u4e2a\u751f\u6210\u7684\u5143\u7d20\u4e2d\u9ed8\u8ba4\u6dfb\u52a0\u67d0\u4e9b\u5c5e\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5143\u7d20\u7c7b\u578b\u51fd\u6570\u4e2d\u4f7f\u7528attrs\u53c2\u6570 name = forms.CharField(min_length=4,widget=widgets.TextInput(attrs={\"class\":\"form-control\"})) \u5728\u6bcf\u4e2a\u9ed8\u8ba4\u751f\u6210\u7684\u5143\u7d20\u4e2d\u6dfb\u52a0class\u5c5e\u6027\uff0c\u503c\u4e3aform-control\u901a\u8fc7attrs\u4e2d\u5b58\u653e\u9700\u8981\u8bbe\u7f6e\u952e\u503c\u5bf9\uff0c\u8fd9\u6837bootstrap\u5c31\u4f1a\u5bf9\u5176\u54cd\u5e94\u6e32\u67d3\u3002 3. \u5c40\u90e8\u94a9\u5b50 \u00b6 \u5982\u679c\u4e0a\u8ff0\u5bf9\u5b57\u6bb5\u7684\u6821\u9a8c\u6761\u4ef6\u592a\u5c11\uff0c\u4e0d\u80fd\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u8981\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u6bcf\u4e2a\u5b57\u6bb5\u81ea\u5b9a\u4e49\u6821\u9a8c\u7684\u5185\u5bb9\uff0c\u5c31\u8981\u4f7f\u7528\u5c40\u90e8\u94a9\u5b50 \u4f7f\u7528\u65b9\u6cd5 3.1 \u539f\u7406 \u00b6 \u5f53\u6211\u4eec\u8c03\u7528forms\u5bf9\u8c61\u4e0b\u7684 s_valid() \u51fd\u6570\u65f6\uff0c\u5c06\u4f1a\u8fdb\u884c\u5b57\u6bb5\u6821\u9a8c\uff1b\u6821\u9a8c\u6210\u529f\u653e\u5165 clean_data \u5b57\u5178\u4e2d\uff0c\u6821\u9a8c\u5931\u8d25\u629b\u51fa\u5f02\u5e38\uff0c\u7136\u540e\u5f02\u5e38\u5904\u7406\u51fd\u6570\u5c06\u6821\u9a8c\u5931\u8d25\u7684\u5b57\u6bb5\u548c\u9519\u8bef\u4fe1\u606f\u5b58\u5165errors\u5b57\u5178\u4e2d\u3002\u800c\u5728django\u6821\u9a8c\u6210\u529f\u65f6\uff0c\u7279\u610f\u7559\u4e0b\u4e00\u4e2a\u94a9\u5b50\uff0c\u7528\u6765\u7ed9\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570 if hasattr(self, 'clean_%s' % name): value = getattr(self, 'clean_%s' % name)() self.cleaned_data[name] = value 3.2 \u5bfc\u5165\u9519\u8bef\u7c7b\u578b \u00b6 from django.core.exceptions import ValidationError ValidationError\u662f\u7528\u6765\u629b\u51fa\u5f02\u5e38\u65f6\u7684\u9519\u8bef\u7c7b\u578b 3.3 \u5efa\u51fd\u6570 \u00b6 \u7136\u540e\u5728forms\u7c7b\u4e2d\u521b\u5efa\u4e00\u4e2a clean_\u5b57\u6bb5 \u7684\u51fd\u6570\u3002 def clean_name(self) 3.4 \u53d6\u503c \u00b6 \u4f7f\u7528cleaned_data\u83b7\u53d6\u6821\u9a8c\u6210\u529f\u7684\u503c\u3002 val = self.cleaned_data.get(\"name\") \u4f7f\u7528cleaned_data\u53ef\u4ee5\u83b7\u53d6\u7684\u6821\u9a8c\u6210\u529f\u7684\u5b57\u5178 3.5 \u793a\u4f8b \u00b6 \u9a8c\u8bc1\u624b\u673a\u53f7\u7801\u5b57\u6bb5\u662f\u5426\u662f\u5341\u4e00\u4f4d\u3002 def clean_tel(self): val = self.cleaned_data.get(\"tel\") if len(val)==11: return val else: raise ValidationError(\"\u624b\u673a\u53f7\u4f4d\u6570\u9519\u8bef\") \u53d6\u51fa\u7531forms\u6821\u9a8c\u6210\u529f\u7684\u7535\u8bdd\u53f7\u7801\uff0c\u5bf9\u5176\u8fdb\u884c\u6821\u9a8c\uff0c\u5982\u679c\u6ee1\u8db3\u6761\u4ef6\uff0c\u5c06\u539f\u6765\u53d6\u51fa\u7684\u5b57\u6bb5\u539f\u6837\u8fd4\u56de\uff0c\u5426\u5219\u629b\u51fa\u5f02\u5e38 4. \u5168\u5c40\u94a9\u5b50 \u00b6 \u5982\u679c\u6211\u4eec\u60f3\u5bf9\u591a\u4e2a\u5b57\u6bb5\u4e4b\u95f4\u7684\u5173\u7cfb\u8fdb\u884c\u6821\u9a8c\uff0c\u6bd4\u5982\u8bf4\u786e\u8ba4\u5bc6\u7801\u548c\u5bc6\u7801\u9700\u8981\u76f8\u540c\uff0c\u4f46\u7528\u5c40\u90e8\u94a9\u5b50\u53ea\u80fd\u5bf9\u5355\u4e2a\u5b57\u6bb5\u7684\u503c\u8fdb\u884c\u6821\u9a8c\u3002\u8fd9\u662f\u5019\u6211\u4eec\u9700\u8981\u5168\u5c40\u94a9\u5b50\u3002 \u7b2c\u4e00\u6b65\uff0c\u540c\u6837\u5bfc\u5165ValidationError\u7c7b\u578b\u7684\u9519\u8bef\u3002 from django.core.exceptions import ValidationError 4.1 \u539f\u7406 \u00b6 django\u540c\u65f6\u4e5f\u7559\u4e00\u4e2aclean\u51fd\u6570\uff0c\u5f53\u7528\u6237\u60f3\u8981\u5bf9\u591a\u4e2a\u5b57\u6bb5\u4e4b\u95f4\u7684\u5173\u7cfb\u8fdb\u884c\u6821\u9a8c\u65f6\uff0c\u76f4\u63a5\u8986\u76d6\u6389\u8fd9\u4e2a\u51fd\u6570\uff0c\u5728\u51fd\u6570\u4e2d\u5199\u51fa\u81ea\u5df1\u60f3\u6821\u9a8c\u7684\u5185\u5bb9\u5373\u53ef\u3002 def clean(self): \"\"\" Hook for doing any extra form-wide cleaning after Field.clean() has been called on every field. Any ValidationError raised by this method will not be associated with a particular field; it will have a special-case association with the field named '__all__'. \"\"\" return self.cleaned_data 4.2 \u5efa\u51fd\u6570[\u5bc6\u7801\u6821\u51c6] \u00b6 \u5728forms\u7c7b\u4e2d\u521b\u5efa\u4e00\u4e2aclean\u51fd\u6570 def clean(self): pwd = self.cleaned_data.get(\"pwd\") re_pwd = self.cleaned_data.get(\"re_pwd\") if pwd and re_pwd: if pwd == re_pwd: return self.cleaned_data else: raise ValidationError(\"\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4\") return self.cleaned_data \u5982\u679c\u6821\u9a8c\u6210\u529f\uff0c\u8fd4\u56de\u539f\u6765\u7684clean_data\u5b57\u6bb5\uff0c\u6821\u9a8c\u5931\u8d25\u629b\u51fa\u5f02\u5e38ValidationError \u6ce8\u610f 1. \u5728\u6a21\u677f\u4e2d\uff0c\u5355\u4e2a\u5b57\u6bb5\u6821\u9a8c\u5931\u8d25\u7684\u9519\u8bef\u4fe1\u606f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 {{ form . \u5b57\u6bb5 . errors }} \u800c\u5168\u5c40\u94a9\u5b50\u629b\u51fa\u7684\u5f02\u5e38\u4f1a\u88ab\u5b58\u5165\u5168\u5c40\u9519\u8bef\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u5728 python\u4f7f\u7528clean_errors = form . errors . get ( \"__all__\" ) \u83b7\u53d6\u5168\u5c40\u9519\u8bef\u4fe1\u606f\uff0c\u5728\u6a21\u677f\u4e2d\u4f7f\u7528 {{ clean_errors . 0 }} \u83b7\u53d6\u9519\u8bef\u4fe1\u606f 2. \u6211\u4eec\u5728\u6821\u9a8c\u65f6\uff0c\u8fd8\u8981\u5224\u65ad if pwd and re_pwd :, \u4ee3\u8868\u5982\u679c\u5355\u4e2a\u5b57\u6bb5\u6821\u9a8c\u5931\u8d25\uff0c\u5c31\u4e0d\u6267\u884c\u5168\u5c40\u94a9\u5b50\u3002\u8fd9\u6837\u5982\u679c\u5bc6\u7801\u6216\u8005\u662f\u786e\u8ba4\u5bc6\u7801\u683c\u5f0f\u4e0d\u5bf9\uff0c\u5bc6\u7801\u548c\u786e\u8ba4\u5bc6\u7801\u4e5f\u4e0d\u76f8\u540c\u65f6\uff0c\u53ea\u62a5\u4e00\u4e2a\u5bc6\u7801\u6216\u8005\u662f\u786e\u8ba4\u5bc6\u7801\u683c\u5f0f\u9519\u8bef\u3002","title":"5. \u8868\u5355"},{"location":"python/django/form/django.form/#1","text":"forms\u7ec4\u4ef6\u4e3b\u8981\u529f\u80fd\u662f\u68c0\u9a8c\u5b57\u6bb5\u7684\u529f\u80fd\uff0c\u6821\u9a8c\u8868\u5355\u4e2d\u7684\u952e\u503c\u5bf9\u7684\u529f\u80fd","title":"1. \u4ecb\u7ecd"},{"location":"python/django/form/django.form/#2","text":"","title":"2. \u529f\u80fd"},{"location":"python/django/form/django.form/#21-forms","text":"from django import forms","title":"2.1 \u5bfc\u5165forms\u7ec4\u4ef6"},{"location":"python/django/form/django.form/#22","text":"class UserForm(forms.Form): name = forms.CharField(min_length=4) email=forms.EmailField() \u6ce8\u610f 1. name\u5b57\u6bb5\u6700\u5c0f\u4e0d\u5f97\u5c0f\u4e8e4\u4e2a\u5b57\u8282 \uff0c email\u5b57\u6bb5\u5fc5\u987b\u90ae\u7bb1\u683c\u5f0f 2. \u8be5\u7c7b\u5fc5\u987b\u7ee7\u627f forms . Form 3. \u53ea\u6821\u9a8c UserForm\u4e2d\u7684\u5b57\u6bb5 \uff0c\u4f20\u5165\u7684\u5176\u4ed6\u5b57\u6bb5\u4f1a\u88ab\u5ffd\u89c6\uff0c\u4e0d\u4f1a\u6821\u9a8c\u3002 4. forms\u5b58\u5728\u8be5\u5b57\u6bb5 \uff0c\u6821\u9a8c\u65f6\u8be5\u5b57\u6bb5\u5c31\u4e0d\u80fd\u4e3a\u7a7a \u4e00\u4e9b\u5e38\u7528\u7684\u6821\u9a8c\u51fd\u6570\u53ca\u5176\u53c2\u6570 \u6821\u9a8c\u51fd\u6570 \u89e3\u91ca CharField \u6821\u9a8c\u5b57\u7b26\u4e32\uff0c\u53ef\u4ee5\u8bbe\u7f6emax_length\u6700\u5927\u957f\u5ea6\u6216\u6700\u5c0f\u957f\u5ea6min_length DecimalField \u6821\u9a8c\u9a8c\u8bc1\u6570\u5b57\uff0c\u524d\u540e\u7a7a\u683c\u4f1a\u88ab\u5ffd\u7565\uff0cmax_value\u548cmin_value\u63a7\u5236\u603b\u957f\u5ea6\uff0c\u5e76\u5e94\u4f5c\u4e3adecimal.Decimal\u503c\u7ed9\u51fa\u3002max_digits\u5141\u8bb8\u7684\u5c0f\u6570+\u6574\u6570\u603b\u4f4d\u6570;decimal_places\u5141\u8bb8\u7684\u6700\u5927\u5c0f\u6570\u4f4d\u6570\u3002 EmailField \u662f\u5426\u4e3a\u6709\u6548\u7684\u7535\u5b50\u90ae\u4ef6\u5730\u5740,\u53ef\u9009\u53c2\u6570max_length\u548cmin_length FileField \u975e\u7a7a\u6587\u4ef6\u6570\u636e\u662f\u5426\u5df2\u7ed1\u5b9a\u5230\u8868\u5355,max_length\u6587\u4ef6\u6700\u5927\u5927\u5c0f\u548callow_empty_file\u6587\u4ef6\u662f\u5426\u53ef\u4ee5\u4e3a\u7a7a FloatField \u9a8c\u8bc1\u7ed9\u5b9a\u503c\u662f\u5426\u4e3afloat,\u53ef\u9009max_value\u5e76\u4e14min_value IntegerField \u9a8c\u8bc1\u7ed9\u5b9a\u503c\u662f\u5426\u4e3a\u6574\u6570\u3002\u53ef\u9009max_value\u548cmin_value","title":"2.2 \u5efa\u7c7b"},{"location":"python/django/form/django.form/#23","text":"\u5c06\u9700\u8981\u9a8c\u8bc1\u7684\u8868\u5355\u503c\u4f20\u5165\uff0c\u68c0\u9a8c\u662f\u5426\u5408\u6cd5 form=UserForm({\"name\":\"caimegzhi\",\"email\":\"610658552@qq.com\"}) \u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f20\u5165POST\u5b57\u5178\uff08\u4f46\u662f\u524d\u6bb5\u952e\u503c\u5fc5\u987b\u4e0eform\u4e00\u4e00\u5bf9\u5e94\uff09 form = UserForm(request.POST)","title":"2.3 \u5b9e\u4f8b\u5316"},{"location":"python/django/form/django.form/#24","text":"\u76f8\u5173API \u529f\u80fd form.is_valid() \u6821\u9a8c\u5168\u90e8\u901a\u8fc7\u8fd4\u56deTrue,\u5426\u5219\u8fd4\u56deFalse form.cleaned_data \u8fd4\u56de\u5b57\u5178\uff0c\u53ef\u4ee5\u67e5\u770b\u6821\u9a8c\u6210\u529f\u7684\u5b57\u6bb5\uff08\u952e\u503c\u90fd\u653e\u5165\uff09 form.errors \u53ef\u4ee5\u67e5\u770b\u6821\u9a8c\u5931\u8d25\u7684\u5b57\u6bb5\uff08\u952e\u4e3a\u6821\u9a8c\u9519\u8bef\u7684\u952e\uff0c\u503c\u4e3a\u9519\u8bef\u4fe1\u606f\u7684\u5217\u8868\uff09","title":"2.4 \u6821\u9a8c"},{"location":"python/django/form/django.form/#25","text":"forms\u7ec4\u4ef6\u8fd8\u53ef\u4ee5\u81ea\u52a8\u4e3a\u6211\u4eec\u5728form\u8868\u5355\u4e2d\u6e32\u67d3\u6821\u9a8c\u5b57\u6bb5\u7684\u8868\u5355\u3002","title":"2.5 \u6e32\u67d3\u6807\u7b7e"},{"location":"python/django/form/django.form/#26","text":"\u9996\u5148\u5b9e\u4f8b\u5316\u4e00\u4e2aforms\u7c7b form=UserForm() \u4e0d\u7528\u4f20\u503c","title":"2.6 \u5b9e\u4f8b\u5316"},{"location":"python/django/form/django.form/#27","text":"","title":"2.7 \u8c03\u7528"},{"location":"python/django/form/django.form/#271-1","text":"\u4f7f\u7528\u6807\u7b7e {{ form.\u5b57\u6bb5 }} \u53ef\u4ee5\u6e32\u67d3\u51fa\u76f8\u5e94\u7684input\u6807\u7b7e,\u5728HTML\u4e2d <form action=\"\" method=\"post\"> {% csrf_token %} <p>\u7528\u6237\u540d\uff1a{{ form.name }}</p> <p>\u5bc6\u7801\uff1a{{ form.pwd }}</p> <p>\u518d\u6b21\u786e\u8ba4\u5bc6\u7801\uff1a{{ form.re_pwd }}</p> <p>\u90ae\u7bb1\uff1a{{ form.email }}</p> <p>\u7535\u8bdd\uff1a{{ form.tel }}</p> <input type=\"submit\" value=\"\u6ce8\u518c\"> </form> \u89c6\u56fe\u51fd\u6570 form=UserForm() forms\u7ec4\u4ef6\u5c06\u81ea\u52a8\u5c06\u751f\u6210\u6807\u7b7ename\u5c5e\u6027\u53d8\u6210\u76f8\u5e94\u7684\u5b57\u6bb5\u540d \u6bd4\u5982\u8bf4<p>\u7528\u6237\u540d\uff1a{{ form.name }}</p> \u7b49\u540c\u4e8e<p>\u7528\u6237\u540d\uff1a<input type=\"text\" name=\"name\"></p>","title":"2.7.1 \u65b9\u5f0f1"},{"location":"python/django/form/django.form/#272-2","text":"\u4f7f\u7528for\u5faa\u73af\u6807\u7b7e <form action=\"\" method=\"post\"> {% csrf_token %} {% for field in form %} <p> <label>{{ field.label }}</label> {{ field }} <span>{{ field.errors.0 }}</span> </p> {% endfor %} <input type=\"submit\" value=\"\u6ce8\u518c\"> </form> \u4f7f\u7528 {{ form.\u5b57\u6bb5.label }} \u53ef\u4ee5\u6e32\u67d3\u51fa\u76f8\u5e94\u7684label\u6807\u7b7e \u6ce8\u610f\uff1alabel\u6807\u7b7e\u9ed8\u8ba4\u663e\u793a\u7684\u662f\u5b57\u6bb5\u540d\uff0c\u5982\u679c\u60f3\u4fee\u6539label\u6807\u7b7e\u663e\u793a\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u5728\u521b\u5efaforms\u7c7b\u65f6\u6307\u5b9a class UserForm(forms.Form): name = forms.CharField(min_length=4,label=\"\u7528\u6237\u540d\") email=forms.EmailField(label=\"\u90ae\u7bb1\") \u4f7f\u7528label\u53c2\u6570\u8fdb\u884c\u6307\u5b9a\uff0c\u7528\u8fd9\u4e2aUserForm\u6e32\u67d3\u51fa\u7684\u6548\u679c\u76f8\u5f53\u4e8e <p>\u7528\u6237\u540d\uff1a{{ form.name }}</p> <p>\u90ae\u7bb1\uff1a{{ form.email }}</p>","title":"2.7.2 \u65b9\u5f0f2 \u63a8\u8350"},{"location":"python/django/form/django.form/#273-3","text":"<form action=\"\" method=\"post\"> {% csrf_token %} {{ form.as_ul }} <input type=\"submit\" value=\"\u6ce8\u518c\"> </form> \u4f7f\u7528 {{ form.as_ul }} \u53ef\u4ee5\u81ea\u52a8\u6e32\u67d3\u6240\u6709\u5b57\u6bb5\uff0c\u6bcf\u4e2a\u5b57\u6bb5\u4f7f\u7528label\u548cinput\u6e32\u67d3\uff0c\u5e76\u4e14\u7528ul\u5305\u88f9\u8fd8\u53ef\u4ee5\u9009\u62e9\u7528 as_p() , as_table() \u5206\u522b\u662f\u7528 p \uff0c table \u6807\u7b7e\u5305\u88f9","title":"2.7.3 \u65b9\u5f0f3 \u4e0d\u63a8\u8350"},{"location":"python/django/form/django.form/#28","text":"\u5f53\u7528\u6237\u8868\u5355\u8f93\u5165\u9519\u8bef\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u81ea\u5df1\u4f20\u5165\u53c2\u6570\uff0c\u8bbe\u7f6e\u5404\u4e2ainput\u7684value\u503c\uff0c\u6765\u6e32\u67d3\u51fa\u4e00\u4e2a\u91cd\u7f6e\u9875\u9762\uff0c\u4f7f\u7528forms\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u5feb\u901f\u6e32\u67d3\u51fa\u4e00\u4e2a\u91cd\u7f6e\u754c\u9762\uff0c\u53ea\u9700\u7b80\u5355\u8bbe\u7f6e\u51e0\u6b65\u5373\u53ef def register(request): if request.method ==\"POST\": form = UserForm(request.POST) if form.is_valid(): return HttpResponse(\"ok\") else: return render(request,\"register.html\",locals()) else: form = UserForm() return render(request,\"register.html\",locals()) \u7b80\u5355\u8bf4\uff0c\u5982\u679c\u7528\u6237\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee\u9875\u9762\u65f6\uff0c\u53d1\u9001\u7684\u662fget\u8bf7\u6c42\uff0c\u6211\u4eec\u4f7f\u7528form = UserForm()\u4f20\u5165\u4e00\u4e2a\u6ca1\u6709\u53c2\u6570\u7684forms\u5bf9\u8c61\uff0c\u5728\u6d4f\u89c8\u5668\u4e2d\uff0c\u5c06\u81ea\u52a8\u6e32\u67d3\u51fa\u5404\u4e2a\u5b57\u6bb5\u7684\u7a7a\u767d\u6807\u7b7e \u5982\u679c\u7528\u6237\u63d0\u4ea4\u8868\u5355\u65f6\uff0c\u6211\u4eec\u5b9e\u4f8b\u5316\u4e00\u4e2aform = UserForm(request.POST)\u5e26\u6709\u53c2\u6570\u7684forms\u5bf9\u8c61\uff0c\u540c\u6837\u7684\uff0c\u6d4f\u89c8\u5668\u4e2d\u4f1a\u6e32\u67d3\u51fa\u63d0\u4ea4\u8868\u5355\u4f20\u5165\u7684\u53c2\u6570\u5185\u5bb9\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u8f93\u5165\u9519\u8bef\u65f6\uff0c\u8fd4\u56de\u7684\u8868\u5355\u4e2d\u7528\u6237\u8f93\u5165\u7684\u5185\u5bb9\u4e0d\u4f1a\u4e3a\u7a7a\uff0c\u4f1a\u662f\u7528\u6237\u4e0a\u6b21\u8f93\u5165\u9519\u8bef\u7684\u5185\u5bb9","title":"2.8 \u91cd\u7f6e\u9875\u9762"},{"location":"python/django/form/django.form/#29","text":"\u5982\u679c\u6211\u4eec\u60f3\u5728\u6821\u9a8c\u6570\u636e\u4e4b\u540e\uff0c\u5c06\u9519\u8bef\u4fe1\u606f\u8f93\u5165\u5230HTML\u9875\u9762\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u505a\u3002","title":"2.9 \u9519\u8bef\u663e\u793a"},{"location":"python/django/form/django.form/#291","text":"\u9996\u5148\u5c06\u5b9e\u4f8b\u5316\u7684forms\u5bf9\u8c61\u4f20\u5165HTML\u3002\u8fd9\u6837\u76f4\u63a5\u5c06\u5c40\u90e8\u53d8\u91cf\u5168\u90e8\u5f53\u6620\u5c04\u5230HTML\u6a21\u677f\u4e2d\uff08\u5305\u62ecform\uff09 form = UserForm() return render(request,\"register.html\",locals())","title":"2.9.1 \u5b9e\u4f8b\u5316"},{"location":"python/django/form/django.form/#292","text":"\u5728HTML\u6a21\u677f\u4e2d\u8c03\u7528\u76f8\u5e94\u7684\u5bf9\u8c61\u3002 <form action=\"\" method=\"post\"> {% csrf_token %} <p>\u7528\u6237\u540d\uff1a{{ form.name }}<span>{{ form.name.errors.0 }}</span></p> <p>\u5bc6\u7801\uff1a{{ form.pwd }}<span>{{ form.pwd.errors.0 }}</span></p> <p>\u518d\u6b21\u786e\u8ba4\u5bc6\u7801\uff1a{{ form.re_pwd }}<span>{{ form.re_pwd.errors.0 }}</span></p> <p>\u90ae\u7bb1\uff1a{{ form.email }}<span>{{ form.email.errors.0 }}</span></p> <p>\u7535\u8bdd\uff1a{{ form.tel }}<span>{{ form.tel.errors.0 }}</span></p> <input type=\"submit\" value=\"\u6ce8\u518c\"> </form> \u4f7f\u7528 {{ form.\u5b57\u6bb5.errors.0 }} \u6807\u7b7e \u5982\u679c\u76f8\u5e94\u5b57\u6bb5\u9519\u8bef\uff0c\u53ef\u4ee5\u6e32\u67d3\u51fa\u76f8\u5e94\u7684\u9519\u8bef\u4fe1\u606f {{form.\u5b57\u6bb5.errors}} \u662f\u4e00\u4e2a\u9519\u8bef\u5217\u8868\uff0c\u6211\u4eec\u4f7f\u7528 {{ form.\u5b57\u6bb5.errors.0 }} \u53ea\u53d6\u51fa\u7b2c\u4e00\u4e2a\u9519\u8bef\u4fe1\u606f\uff09","title":"2.9.2 \u8c03\u7528"},{"location":"python/django/form/django.form/#210","text":"\u4f7f\u7528widgets\u6a21\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u7ed9forms\u7c7b\u4e2d\u7684\u5b57\u6bb5\u8bbe\u7f6e\u76f8\u5e94\u7684\u53c2\u6570","title":"2.10 \u53c2\u6570\u914d\u7f6e"},{"location":"python/django/form/django.form/#2101","text":"form django.forms import widgets","title":"2.10.1 \u5bfc\u5165"},{"location":"python/django/form/django.form/#2102","text":"\u8bbe\u7f6eforms\u7ec4\u4ef6\u5728\u6a21\u677f\u4e2d\u751f\u6210\u7684\u5143\u7d20\u7c7b\u578b\uff0c\u5982\u679c\u6211\u4eec\u8bbe\u7f6e\u4e00\u4e2a\u6821\u9a8c\u5b57\u6bb5\u4e3aCharField\u7c7b\u578b\uff0c\u90a3\u4e48\u5728HTML\u6a21\u677f\u4e2d\u751f\u6210\u7684\u6807\u7b7e\u5373\u4e3a \u7c7b\u578b \u5982\u679c\u6211\u4eec\u60f3\u4fee\u6539\u751f\u6210\u7684\u6807\u7b7e\u7c7b\u578b\uff0c\u600e\u4e48\u529e\uff1f pwd =forms.CharField(min_length=4,widget=widgets.PasswordInput()) \u4f7f\u7528widget\u53c2\u6570\u53ef\u4ee5\u8bbe\u7f6e\u6807\u7b7e\u7c7b\u578b\uff0c PasswordInput() \u4ee3\u8868\u5c06\u81ea\u52a8\u751f\u6210```\u7c7b\u578b\u6807\u7b7e","title":"2.10.2 \u914d\u7f6e"},{"location":"python/django/form/django.form/#2103","text":"\u8bbe\u7f6eforms\u7ec4\u4ef6\u5728\u6a21\u677f\u4e2d\u751f\u6210\u5143\u7d20\u7684\u5c5e\u6027\uff0c\u5982\u679c\u6211\u4eec\u60f3\u7ed9\u6bcf\u4e00\u4e2a\u751f\u6210\u7684\u5143\u7d20\u4e2d\u9ed8\u8ba4\u6dfb\u52a0\u67d0\u4e9b\u5c5e\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5143\u7d20\u7c7b\u578b\u51fd\u6570\u4e2d\u4f7f\u7528attrs\u53c2\u6570 name = forms.CharField(min_length=4,widget=widgets.TextInput(attrs={\"class\":\"form-control\"})) \u5728\u6bcf\u4e2a\u9ed8\u8ba4\u751f\u6210\u7684\u5143\u7d20\u4e2d\u6dfb\u52a0class\u5c5e\u6027\uff0c\u503c\u4e3aform-control\u901a\u8fc7attrs\u4e2d\u5b58\u653e\u9700\u8981\u8bbe\u7f6e\u952e\u503c\u5bf9\uff0c\u8fd9\u6837bootstrap\u5c31\u4f1a\u5bf9\u5176\u54cd\u5e94\u6e32\u67d3\u3002","title":"2.10.3 \u5143\u7d20\u751f\u6210"},{"location":"python/django/form/django.form/#3","text":"\u5982\u679c\u4e0a\u8ff0\u5bf9\u5b57\u6bb5\u7684\u6821\u9a8c\u6761\u4ef6\u592a\u5c11\uff0c\u4e0d\u80fd\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u8981\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u6bcf\u4e2a\u5b57\u6bb5\u81ea\u5b9a\u4e49\u6821\u9a8c\u7684\u5185\u5bb9\uff0c\u5c31\u8981\u4f7f\u7528\u5c40\u90e8\u94a9\u5b50 \u4f7f\u7528\u65b9\u6cd5","title":"3. \u5c40\u90e8\u94a9\u5b50"},{"location":"python/django/form/django.form/#31","text":"\u5f53\u6211\u4eec\u8c03\u7528forms\u5bf9\u8c61\u4e0b\u7684 s_valid() \u51fd\u6570\u65f6\uff0c\u5c06\u4f1a\u8fdb\u884c\u5b57\u6bb5\u6821\u9a8c\uff1b\u6821\u9a8c\u6210\u529f\u653e\u5165 clean_data \u5b57\u5178\u4e2d\uff0c\u6821\u9a8c\u5931\u8d25\u629b\u51fa\u5f02\u5e38\uff0c\u7136\u540e\u5f02\u5e38\u5904\u7406\u51fd\u6570\u5c06\u6821\u9a8c\u5931\u8d25\u7684\u5b57\u6bb5\u548c\u9519\u8bef\u4fe1\u606f\u5b58\u5165errors\u5b57\u5178\u4e2d\u3002\u800c\u5728django\u6821\u9a8c\u6210\u529f\u65f6\uff0c\u7279\u610f\u7559\u4e0b\u4e00\u4e2a\u94a9\u5b50\uff0c\u7528\u6765\u7ed9\u7528\u6237\u81ea\u5b9a\u4e49\u51fd\u6570 if hasattr(self, 'clean_%s' % name): value = getattr(self, 'clean_%s' % name)() self.cleaned_data[name] = value","title":"3.1 \u539f\u7406"},{"location":"python/django/form/django.form/#32","text":"from django.core.exceptions import ValidationError ValidationError\u662f\u7528\u6765\u629b\u51fa\u5f02\u5e38\u65f6\u7684\u9519\u8bef\u7c7b\u578b","title":"3.2 \u5bfc\u5165\u9519\u8bef\u7c7b\u578b"},{"location":"python/django/form/django.form/#33","text":"\u7136\u540e\u5728forms\u7c7b\u4e2d\u521b\u5efa\u4e00\u4e2a clean_\u5b57\u6bb5 \u7684\u51fd\u6570\u3002 def clean_name(self)","title":"3.3 \u5efa\u51fd\u6570"},{"location":"python/django/form/django.form/#34","text":"\u4f7f\u7528cleaned_data\u83b7\u53d6\u6821\u9a8c\u6210\u529f\u7684\u503c\u3002 val = self.cleaned_data.get(\"name\") \u4f7f\u7528cleaned_data\u53ef\u4ee5\u83b7\u53d6\u7684\u6821\u9a8c\u6210\u529f\u7684\u5b57\u5178","title":"3.4 \u53d6\u503c"},{"location":"python/django/form/django.form/#35","text":"\u9a8c\u8bc1\u624b\u673a\u53f7\u7801\u5b57\u6bb5\u662f\u5426\u662f\u5341\u4e00\u4f4d\u3002 def clean_tel(self): val = self.cleaned_data.get(\"tel\") if len(val)==11: return val else: raise ValidationError(\"\u624b\u673a\u53f7\u4f4d\u6570\u9519\u8bef\") \u53d6\u51fa\u7531forms\u6821\u9a8c\u6210\u529f\u7684\u7535\u8bdd\u53f7\u7801\uff0c\u5bf9\u5176\u8fdb\u884c\u6821\u9a8c\uff0c\u5982\u679c\u6ee1\u8db3\u6761\u4ef6\uff0c\u5c06\u539f\u6765\u53d6\u51fa\u7684\u5b57\u6bb5\u539f\u6837\u8fd4\u56de\uff0c\u5426\u5219\u629b\u51fa\u5f02\u5e38","title":"3.5 \u793a\u4f8b"},{"location":"python/django/form/django.form/#4","text":"\u5982\u679c\u6211\u4eec\u60f3\u5bf9\u591a\u4e2a\u5b57\u6bb5\u4e4b\u95f4\u7684\u5173\u7cfb\u8fdb\u884c\u6821\u9a8c\uff0c\u6bd4\u5982\u8bf4\u786e\u8ba4\u5bc6\u7801\u548c\u5bc6\u7801\u9700\u8981\u76f8\u540c\uff0c\u4f46\u7528\u5c40\u90e8\u94a9\u5b50\u53ea\u80fd\u5bf9\u5355\u4e2a\u5b57\u6bb5\u7684\u503c\u8fdb\u884c\u6821\u9a8c\u3002\u8fd9\u662f\u5019\u6211\u4eec\u9700\u8981\u5168\u5c40\u94a9\u5b50\u3002 \u7b2c\u4e00\u6b65\uff0c\u540c\u6837\u5bfc\u5165ValidationError\u7c7b\u578b\u7684\u9519\u8bef\u3002 from django.core.exceptions import ValidationError","title":"4. \u5168\u5c40\u94a9\u5b50"},{"location":"python/django/form/django.form/#41","text":"django\u540c\u65f6\u4e5f\u7559\u4e00\u4e2aclean\u51fd\u6570\uff0c\u5f53\u7528\u6237\u60f3\u8981\u5bf9\u591a\u4e2a\u5b57\u6bb5\u4e4b\u95f4\u7684\u5173\u7cfb\u8fdb\u884c\u6821\u9a8c\u65f6\uff0c\u76f4\u63a5\u8986\u76d6\u6389\u8fd9\u4e2a\u51fd\u6570\uff0c\u5728\u51fd\u6570\u4e2d\u5199\u51fa\u81ea\u5df1\u60f3\u6821\u9a8c\u7684\u5185\u5bb9\u5373\u53ef\u3002 def clean(self): \"\"\" Hook for doing any extra form-wide cleaning after Field.clean() has been called on every field. Any ValidationError raised by this method will not be associated with a particular field; it will have a special-case association with the field named '__all__'. \"\"\" return self.cleaned_data","title":"4.1 \u539f\u7406"},{"location":"python/django/form/django.form/#42","text":"\u5728forms\u7c7b\u4e2d\u521b\u5efa\u4e00\u4e2aclean\u51fd\u6570 def clean(self): pwd = self.cleaned_data.get(\"pwd\") re_pwd = self.cleaned_data.get(\"re_pwd\") if pwd and re_pwd: if pwd == re_pwd: return self.cleaned_data else: raise ValidationError(\"\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4\") return self.cleaned_data \u5982\u679c\u6821\u9a8c\u6210\u529f\uff0c\u8fd4\u56de\u539f\u6765\u7684clean_data\u5b57\u6bb5\uff0c\u6821\u9a8c\u5931\u8d25\u629b\u51fa\u5f02\u5e38ValidationError \u6ce8\u610f 1. \u5728\u6a21\u677f\u4e2d\uff0c\u5355\u4e2a\u5b57\u6bb5\u6821\u9a8c\u5931\u8d25\u7684\u9519\u8bef\u4fe1\u606f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 {{ form . \u5b57\u6bb5 . errors }} \u800c\u5168\u5c40\u94a9\u5b50\u629b\u51fa\u7684\u5f02\u5e38\u4f1a\u88ab\u5b58\u5165\u5168\u5c40\u9519\u8bef\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u5728 python\u4f7f\u7528clean_errors = form . errors . get ( \"__all__\" ) \u83b7\u53d6\u5168\u5c40\u9519\u8bef\u4fe1\u606f\uff0c\u5728\u6a21\u677f\u4e2d\u4f7f\u7528 {{ clean_errors . 0 }} \u83b7\u53d6\u9519\u8bef\u4fe1\u606f 2. \u6211\u4eec\u5728\u6821\u9a8c\u65f6\uff0c\u8fd8\u8981\u5224\u65ad if pwd and re_pwd :, \u4ee3\u8868\u5982\u679c\u5355\u4e2a\u5b57\u6bb5\u6821\u9a8c\u5931\u8d25\uff0c\u5c31\u4e0d\u6267\u884c\u5168\u5c40\u94a9\u5b50\u3002\u8fd9\u6837\u5982\u679c\u5bc6\u7801\u6216\u8005\u662f\u786e\u8ba4\u5bc6\u7801\u683c\u5f0f\u4e0d\u5bf9\uff0c\u5bc6\u7801\u548c\u786e\u8ba4\u5bc6\u7801\u4e5f\u4e0d\u76f8\u540c\u65f6\uff0c\u53ea\u62a5\u4e00\u4e2a\u5bc6\u7801\u6216\u8005\u662f\u786e\u8ba4\u5bc6\u7801\u683c\u5f0f\u9519\u8bef\u3002","title":"4.2 \u5efa\u51fd\u6570[\u5bc6\u7801\u6821\u51c6]"},{"location":"python/django/middleware/django.middleware/","text":"Django \u4e2d\u95f4\u4ef6 1. \u4ecb\u7ecd \u00b6 \u4ec0\u4e48\u662f\u4e2d\u95f4\u4ef6\uff1f request\u548crespone\u4e4b\u95f4\u7684\u5904\u7406\u7a0b\u5e8f\uff0csettings.py\u4e2dMIDDLEWARE\u6570\u7ec4\u4e2d\u5b58\u50a8\u7684\u5c31\u662f\u4e2d\u95f4\u4ef6 MIDDLEWARE = [ 'django.middleware.security.SecurityMiddleware', 'django.contrib.sessions.middleware.SessionMiddleware', 'django.middleware.common.CommonMiddleware', 'django.middleware.csrf.CsrfViewMiddleware', 'django.contrib.auth.middleware.AuthenticationMiddleware', 'django.contrib.messages.middleware.MessageMiddleware', 'django.middleware.clickjacking.XFrameOptionsMiddleware', 'app01.my_middlewares.AuthMiddleware', 'app01.my_middlewares.IpLimitMiddleware', ] \u4e2d\u95f4\u4ef6\u6d41\u7a0b \u5ba2\u6237\u7aef-\u300bwsgiref\u6a21\u5757-\u300b\u4e2d\u95f4\u4ef6-\u300burls\u8def\u7531\u63a7\u5236-\u300b\u6570\u636e\u5e93MODEL,HTML\u6a21\u677f 2. \u81ea\u5b9a\u4e49\u4e2d\u95f4\u4ef6 \u00b6 \u521b\u5efa\u4e00\u4e2a\u5b58\u653e\u4e2d\u95f4\u4ef6\u7684\u6587\u4ef6\u5939\uff0c\u5982 my_middlewares.py \u3002 2.1 \u5bfc\u5165\u6a21\u5757 \u00b6 from django.utils.deprecation import MiddlewareMixin 2.2 \u7ee7\u627f \u00b6 \u521b\u5efa\u76f8\u5e94\u7684\u7c7b\uff08\u5fc5\u987b\u7ee7\u627fMiddlewareMixin\uff09 class CustomerMiddleware(MiddlewareMixin) def process_request(self,request): print(\"Customer\") \u5fc5\u987b\u6709request\u53c2\u6570\uff1b\u4e0d\u7528\u8fd4\u56de\u503c\uff0c\u8ba9\u5176\u9ed8\u8ba4\u8fd4\u56denone 2.3 \u6ce8\u518c\u81ea\u5b9a\u4e49\u4e2d\u95f4\u4ef6 \u00b6 settings.py MIDDLEWARE = [ ... ... ... \"app01.my_middlewares.CustomerMiddleware\", 2.4 \u4e2d\u95f4\u4ef6\u4f5c\u7528 \u00b6 \u53ea\u8981\u6d4f\u89c8\u5668\u8bbf\u95ee\u670d\u52a1\u5668\uff0c\u5c31\u4f1a\u8bbf\u95ee\u4e2d\u95f4\u4ef6 \u4f5c\u7528\uff1a\u5927\u90e8\u5206\u89c6\u56fe\u51fd\u6570\u8981\u4f7f\u7528\u7684\u4ee3\u7801\u5c31\u53ef\u4ee5\u653e\u5230\u4e2d\u95f4\u4ef6\u4e2d \u6bd4\u5982\uff0c\u5c06\u767b\u9646\u51fd\u6570\u653e\u5230\u4e2d\u95f4\u4ef6\u4e2d\uff0c\u8bbf\u95ee\u670d\u52a1\u5668\u5c31\u4f1a\u8c03\u7528\u4e2d\u95f4\u4ef6\uff0c\u9a8c\u8bc1\u662f\u5426\u767b\u5f55\uff0c\u4f7f\u7528\u4e2d\u95f4\u4ef6\u9650\u5236\u7528\u6237\u8bbf\u95ee\u7684\u9891\u7387 2.5 \u65b9\u6cd5 \u00b6 \u5728\u8be5\u7c7b\u4e2d\uff0c\u4e3b\u8981\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e0b\u51e0\u4e2a\u65b9\u6cd5 \u65b9\u6cd5 \u5b9a\u4e49 process_request def process_request(self,request): process_response def process_response(self,request,response): process_view process_view(self, request, callback, callback_args, callback_kwargs) process_exception def process_exception(self,request,exception): 2.6 \u6267\u884c\u987a\u5e8f \u00b6 2.6.1 \u6b63\u5e38 \u00b6 process_request-\u300burl\u63a7\u5236\u5668-\u300bprocess_view-\u300b\u89c6\u56fe\u51fd\u6570-\u300bprocess_response 2.6.2 \u5f02\u5e38 \u00b6 \u89c6\u56fe\u51fd\u6570\u51fa\u9519\u65f6\u5019 process_request-\u300burl\u63a7\u5236\u5668-\u300bprocess_view-\u300b\u89c6\u56fe\u51fd\u6570\u51fa\u9519-\u300bprocess_exception-\u300bprocess_response setting.py\u4e2dMIDDLEWARE\u5217\u8868\u6267\u884c\u987a\u5e8f \u5f53\u6709\u591a\u4e2a\u4e2d\u95f4\u4ef6\u65f6\uff0c\u670d\u52a1\u5668\u53d1\u8fc7\u6765\u7684\u6570\u636e\u4f9d\u6b21\u4ece\u4e0a\u5411\u4e0b\u6267\u884c\u51fd\u6570\uff0c\u89c6\u56fe\u51fd\u6570\u8fd4\u56de\u987a\u5e8f\u65f6\uff0c\u4ece\u4e0b\u5411\u4e0a\u6267\u884c \u6bcf\u4e2a process_request \u5c06\u4f20\u8fc7\u6765\u7684\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u4f9d\u6b21\u4f20\u7ed9\u4e0b\u4e00\u4e2aprocess_request \u6bcf\u4e2a process_response \u5c06\u4f20\u8fc7\u6765\u7684\u54cd\u5e94\u4f53\u4f9d\u6b21\u4f20\u7ed9\u4e0a\u4e00\u4e2aprocess_response ex: process_request1-\u300bprocess_request2-\u300burl\u63a7\u5236\u5668-\u300bprocess_view1-\u300b\u300bprocess_view2-\u300b\u89c6\u56fe\u51fd\u6570\u51fa\u9519-\u300bprocess_exception2-\u300bprocess_exception1-\u300bprocess_response2-\u300bprocess_response1 3 \u5b9e\u4f8b \u00b6 3.1 \u7528\u6237\u9a8c\u8bc1 \u00b6 \u5982\u679c\u6211\u4eec\u60f3\u8ba9\u4e00\u4e9b\u9875\u9762\u5728\u7528\u6237\u767b\u5f55\u540e\u624d\u663e\u793a\uff0c\u6211\u4eec\u9664\u4e86\u53ef\u4ee5\u4f7f\u7528\u7528\u6237\u8ba4\u8bc1\u88c5\u9970\u5668\u88c5\u9970\u5668\u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4e2d\u95f4\u4ef6 from django.utils.deprecation import MiddlewareMixin from django.shortcuts import redirect from authDemo import settings class AuthMiddleware(MiddlewareMixin): def process_request(self,request): if request.path in settings.WHITE_LIST: return None # \u7528\u6237\u767b\u5f55\u9a8c\u8bc1 if not request.user.is_authenticated: return redirect(\"/login/\")\uff01 \u6ce8\u610f 1. settings . py\u91cc\u9762\u521b\u5efa\u4e00\u4e2aWHITE_LIST\u5217\u8868 \uff0c\u7528\u6765\u5b58\u653e\u4e0d\u9700\u8981\u52a0\u7528\u6237\u8ba4\u8bc1\u7684 url \uff0c\u6bd4\u5982\u767b\u5f55\uff0c\u6ce8\u518c\uff0c\u6ce8\u9500 url 2. \u5982\u679c\u7528\u6237\u6ca1\u6709\u767b\u5f55\uff0c\u6211\u4eec\u5c06\u5176\u9875\u9762\u91cd\u5b9a\u5411\u5230 / login / 3.2 IP\u8bbf\u95ee\u8bc4\u7387\u9650\u5236 \u00b6 \u5982\u679c\u6211\u4eec\u60f3\u9650\u5236\u5ba2\u6237\u7aefip\u7684\u8bbf\u95ee\u9891\u7387\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e2d\u95f4\u4ef6 from django.utils.deprecation import MiddlewareMixin from django.shortcuts import redirect,HttpResponse from authDemo import settings import datetime class IpLimitMiddleware(MiddlewareMixin): def process_request(self,request): if request.META.get(\"HTTP_X_FORWARDED_FOR\"): ip = request.META[\"HTTP_X_FORWARDED_FOR\"] else: ip = request.META[\"REMOTE_ADDR\"] now_min = datetime.datetime.now().minute if ip in settings.BLACK_LIST: # \u67e5\u8be2ip\u662f\u5426\u5728\u9ed1\u540d\u5355\u5185 return HttpResponse(\"\u4f60\u5df2\u7ecf\u88ab\u52a0\u5165\u9ed1\u540d\u5355\") elif ip in settings.IP_LIST: if settings.IP_LIST[ip][\"min\"] == now_min: settings.IP_LIST[ip][\"times\"] += 1 if settings.IP_LIST[ip][\"times\"] >= settings.LIMIT_VISIT_TIMES: #\u5224\u65ad\u7528\u6237\u8bbf\u95ee\u6b21\u6570\u662f\u5426\u592a\u5feb\uff0c\u8fd4\u56de\u63d0\u9192\u7528\u6237 if settings.IP_LIST[ip][\"times\"] >= settings.MAX_VISIT_TIMES: #\u5982\u679c\u7528\u6237\u8bbf\u95ee\u6b21\u6570\u975e\u5e38\u591a\uff0c\u52a0\u5165\u9ed1\u540d\u5355 settings.BLACK_LIST.append(ip) return HttpResponse(\"\u8bbf\u95ee\u9891\u7387\u8fc7\u5feb\") else: settings.IP_LIST[ip][\"times\"] = 0 settings.IP_LIST[ip][\"min\"] = now_min else: settings.IP_LIST[ip] = {\"times\":1,\"min\":now_min} \u89e3\u91ca 1. settings . py\u91cc\u521b\u5efa\u4e00\u4e2aIP_LIST\u5b57\u5178 \uff0c\u7528\u6765\u5b58\u50a8\u5ba2\u6237\u7aef ip\u548c\u5176\u4ed6\u4fe1\u606f \uff08\u5176\u5b9e\u53ef\u4ee5\u5355\u72ec\u653e\u5165\u6570\u636e\u5e93\u4e00\u4e2a\u8868\u4e2d\uff0c\u4e0d\u8fc7\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6ca1\u6709\u5185\u5b58\u4e2d\u8bfb\u53d6\u5feb\uff0c\u8bbf\u95ee\u901f\u5ea6\u4f1a\u53d7\u5230\u5f71\u54cd\uff09 2. \u5982\u679c\u7528\u6237\u4f7f\u7528\u4ee3\u7406 request . META [ \"REMOTE_ADDR\" ] \u6293\u4e0d\u5230\u771f\u5b9e\u5730\u5740\uff0c\u6240\u4ee5\u6211\u4eec\u9996\u5148\u4f7f\u7528 request . META [ \"HTTP_X_FORWARDED_FOR\" ] \u6765\u83b7\u53d6\u7528\u6237\u771f\u5b9e\u5730\u5740 3. \u6211\u4eec\u5c06\u5176\u7528\u6237 ip\u548c\u8bbf\u95ee\u6b21\u6570\u50a8\u5b58 \uff0c\u5728 settings . py\u4e2d\u8bbe\u7f6e\u4e00\u4e2a\u5e38\u91cfLIMIT_VISIT_TIMES \uff0c\u8d85\u8fc7\u8fd9\u4e2a\u6b21\u6570\u4e0d\u8ba9\u7528\u6237\u8bbf\u95ee\u7f51\u9875 ; MAX_VISIT_TIMES\u8d85\u8fc7\u8fd9\u4e2a\u6b21\u6570 \uff0c\u5c06\u8fd9\u4e2a ip\u52a0\u5165\u9ed1\u540d\u5355","title":"6. \u4e2d\u95f4\u4ef6"},{"location":"python/django/middleware/django.middleware/#1","text":"\u4ec0\u4e48\u662f\u4e2d\u95f4\u4ef6\uff1f request\u548crespone\u4e4b\u95f4\u7684\u5904\u7406\u7a0b\u5e8f\uff0csettings.py\u4e2dMIDDLEWARE\u6570\u7ec4\u4e2d\u5b58\u50a8\u7684\u5c31\u662f\u4e2d\u95f4\u4ef6 MIDDLEWARE = [ 'django.middleware.security.SecurityMiddleware', 'django.contrib.sessions.middleware.SessionMiddleware', 'django.middleware.common.CommonMiddleware', 'django.middleware.csrf.CsrfViewMiddleware', 'django.contrib.auth.middleware.AuthenticationMiddleware', 'django.contrib.messages.middleware.MessageMiddleware', 'django.middleware.clickjacking.XFrameOptionsMiddleware', 'app01.my_middlewares.AuthMiddleware', 'app01.my_middlewares.IpLimitMiddleware', ] \u4e2d\u95f4\u4ef6\u6d41\u7a0b \u5ba2\u6237\u7aef-\u300bwsgiref\u6a21\u5757-\u300b\u4e2d\u95f4\u4ef6-\u300burls\u8def\u7531\u63a7\u5236-\u300b\u6570\u636e\u5e93MODEL,HTML\u6a21\u677f","title":"1. \u4ecb\u7ecd"},{"location":"python/django/middleware/django.middleware/#2","text":"\u521b\u5efa\u4e00\u4e2a\u5b58\u653e\u4e2d\u95f4\u4ef6\u7684\u6587\u4ef6\u5939\uff0c\u5982 my_middlewares.py \u3002","title":"2. \u81ea\u5b9a\u4e49\u4e2d\u95f4\u4ef6"},{"location":"python/django/middleware/django.middleware/#21","text":"from django.utils.deprecation import MiddlewareMixin","title":"2.1 \u5bfc\u5165\u6a21\u5757"},{"location":"python/django/middleware/django.middleware/#22","text":"\u521b\u5efa\u76f8\u5e94\u7684\u7c7b\uff08\u5fc5\u987b\u7ee7\u627fMiddlewareMixin\uff09 class CustomerMiddleware(MiddlewareMixin) def process_request(self,request): print(\"Customer\") \u5fc5\u987b\u6709request\u53c2\u6570\uff1b\u4e0d\u7528\u8fd4\u56de\u503c\uff0c\u8ba9\u5176\u9ed8\u8ba4\u8fd4\u56denone","title":"2.2 \u7ee7\u627f"},{"location":"python/django/middleware/django.middleware/#23","text":"settings.py MIDDLEWARE = [ ... ... ... \"app01.my_middlewares.CustomerMiddleware\",","title":"2.3 \u6ce8\u518c\u81ea\u5b9a\u4e49\u4e2d\u95f4\u4ef6"},{"location":"python/django/middleware/django.middleware/#24","text":"\u53ea\u8981\u6d4f\u89c8\u5668\u8bbf\u95ee\u670d\u52a1\u5668\uff0c\u5c31\u4f1a\u8bbf\u95ee\u4e2d\u95f4\u4ef6 \u4f5c\u7528\uff1a\u5927\u90e8\u5206\u89c6\u56fe\u51fd\u6570\u8981\u4f7f\u7528\u7684\u4ee3\u7801\u5c31\u53ef\u4ee5\u653e\u5230\u4e2d\u95f4\u4ef6\u4e2d \u6bd4\u5982\uff0c\u5c06\u767b\u9646\u51fd\u6570\u653e\u5230\u4e2d\u95f4\u4ef6\u4e2d\uff0c\u8bbf\u95ee\u670d\u52a1\u5668\u5c31\u4f1a\u8c03\u7528\u4e2d\u95f4\u4ef6\uff0c\u9a8c\u8bc1\u662f\u5426\u767b\u5f55\uff0c\u4f7f\u7528\u4e2d\u95f4\u4ef6\u9650\u5236\u7528\u6237\u8bbf\u95ee\u7684\u9891\u7387","title":"2.4 \u4e2d\u95f4\u4ef6\u4f5c\u7528"},{"location":"python/django/middleware/django.middleware/#25","text":"\u5728\u8be5\u7c7b\u4e2d\uff0c\u4e3b\u8981\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e0b\u51e0\u4e2a\u65b9\u6cd5 \u65b9\u6cd5 \u5b9a\u4e49 process_request def process_request(self,request): process_response def process_response(self,request,response): process_view process_view(self, request, callback, callback_args, callback_kwargs) process_exception def process_exception(self,request,exception):","title":"2.5 \u65b9\u6cd5"},{"location":"python/django/middleware/django.middleware/#26","text":"","title":"2.6 \u6267\u884c\u987a\u5e8f"},{"location":"python/django/middleware/django.middleware/#261","text":"process_request-\u300burl\u63a7\u5236\u5668-\u300bprocess_view-\u300b\u89c6\u56fe\u51fd\u6570-\u300bprocess_response","title":"2.6.1 \u6b63\u5e38"},{"location":"python/django/middleware/django.middleware/#262","text":"\u89c6\u56fe\u51fd\u6570\u51fa\u9519\u65f6\u5019 process_request-\u300burl\u63a7\u5236\u5668-\u300bprocess_view-\u300b\u89c6\u56fe\u51fd\u6570\u51fa\u9519-\u300bprocess_exception-\u300bprocess_response setting.py\u4e2dMIDDLEWARE\u5217\u8868\u6267\u884c\u987a\u5e8f \u5f53\u6709\u591a\u4e2a\u4e2d\u95f4\u4ef6\u65f6\uff0c\u670d\u52a1\u5668\u53d1\u8fc7\u6765\u7684\u6570\u636e\u4f9d\u6b21\u4ece\u4e0a\u5411\u4e0b\u6267\u884c\u51fd\u6570\uff0c\u89c6\u56fe\u51fd\u6570\u8fd4\u56de\u987a\u5e8f\u65f6\uff0c\u4ece\u4e0b\u5411\u4e0a\u6267\u884c \u6bcf\u4e2a process_request \u5c06\u4f20\u8fc7\u6765\u7684\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u4f9d\u6b21\u4f20\u7ed9\u4e0b\u4e00\u4e2aprocess_request \u6bcf\u4e2a process_response \u5c06\u4f20\u8fc7\u6765\u7684\u54cd\u5e94\u4f53\u4f9d\u6b21\u4f20\u7ed9\u4e0a\u4e00\u4e2aprocess_response ex: process_request1-\u300bprocess_request2-\u300burl\u63a7\u5236\u5668-\u300bprocess_view1-\u300b\u300bprocess_view2-\u300b\u89c6\u56fe\u51fd\u6570\u51fa\u9519-\u300bprocess_exception2-\u300bprocess_exception1-\u300bprocess_response2-\u300bprocess_response1","title":"2.6.2 \u5f02\u5e38"},{"location":"python/django/middleware/django.middleware/#3","text":"","title":"3 \u5b9e\u4f8b"},{"location":"python/django/middleware/django.middleware/#31","text":"\u5982\u679c\u6211\u4eec\u60f3\u8ba9\u4e00\u4e9b\u9875\u9762\u5728\u7528\u6237\u767b\u5f55\u540e\u624d\u663e\u793a\uff0c\u6211\u4eec\u9664\u4e86\u53ef\u4ee5\u4f7f\u7528\u7528\u6237\u8ba4\u8bc1\u88c5\u9970\u5668\u88c5\u9970\u5668\u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4e2d\u95f4\u4ef6 from django.utils.deprecation import MiddlewareMixin from django.shortcuts import redirect from authDemo import settings class AuthMiddleware(MiddlewareMixin): def process_request(self,request): if request.path in settings.WHITE_LIST: return None # \u7528\u6237\u767b\u5f55\u9a8c\u8bc1 if not request.user.is_authenticated: return redirect(\"/login/\")\uff01 \u6ce8\u610f 1. settings . py\u91cc\u9762\u521b\u5efa\u4e00\u4e2aWHITE_LIST\u5217\u8868 \uff0c\u7528\u6765\u5b58\u653e\u4e0d\u9700\u8981\u52a0\u7528\u6237\u8ba4\u8bc1\u7684 url \uff0c\u6bd4\u5982\u767b\u5f55\uff0c\u6ce8\u518c\uff0c\u6ce8\u9500 url 2. \u5982\u679c\u7528\u6237\u6ca1\u6709\u767b\u5f55\uff0c\u6211\u4eec\u5c06\u5176\u9875\u9762\u91cd\u5b9a\u5411\u5230 / login /","title":"3.1 \u7528\u6237\u9a8c\u8bc1"},{"location":"python/django/middleware/django.middleware/#32-ip","text":"\u5982\u679c\u6211\u4eec\u60f3\u9650\u5236\u5ba2\u6237\u7aefip\u7684\u8bbf\u95ee\u9891\u7387\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e2d\u95f4\u4ef6 from django.utils.deprecation import MiddlewareMixin from django.shortcuts import redirect,HttpResponse from authDemo import settings import datetime class IpLimitMiddleware(MiddlewareMixin): def process_request(self,request): if request.META.get(\"HTTP_X_FORWARDED_FOR\"): ip = request.META[\"HTTP_X_FORWARDED_FOR\"] else: ip = request.META[\"REMOTE_ADDR\"] now_min = datetime.datetime.now().minute if ip in settings.BLACK_LIST: # \u67e5\u8be2ip\u662f\u5426\u5728\u9ed1\u540d\u5355\u5185 return HttpResponse(\"\u4f60\u5df2\u7ecf\u88ab\u52a0\u5165\u9ed1\u540d\u5355\") elif ip in settings.IP_LIST: if settings.IP_LIST[ip][\"min\"] == now_min: settings.IP_LIST[ip][\"times\"] += 1 if settings.IP_LIST[ip][\"times\"] >= settings.LIMIT_VISIT_TIMES: #\u5224\u65ad\u7528\u6237\u8bbf\u95ee\u6b21\u6570\u662f\u5426\u592a\u5feb\uff0c\u8fd4\u56de\u63d0\u9192\u7528\u6237 if settings.IP_LIST[ip][\"times\"] >= settings.MAX_VISIT_TIMES: #\u5982\u679c\u7528\u6237\u8bbf\u95ee\u6b21\u6570\u975e\u5e38\u591a\uff0c\u52a0\u5165\u9ed1\u540d\u5355 settings.BLACK_LIST.append(ip) return HttpResponse(\"\u8bbf\u95ee\u9891\u7387\u8fc7\u5feb\") else: settings.IP_LIST[ip][\"times\"] = 0 settings.IP_LIST[ip][\"min\"] = now_min else: settings.IP_LIST[ip] = {\"times\":1,\"min\":now_min} \u89e3\u91ca 1. settings . py\u91cc\u521b\u5efa\u4e00\u4e2aIP_LIST\u5b57\u5178 \uff0c\u7528\u6765\u5b58\u50a8\u5ba2\u6237\u7aef ip\u548c\u5176\u4ed6\u4fe1\u606f \uff08\u5176\u5b9e\u53ef\u4ee5\u5355\u72ec\u653e\u5165\u6570\u636e\u5e93\u4e00\u4e2a\u8868\u4e2d\uff0c\u4e0d\u8fc7\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6ca1\u6709\u5185\u5b58\u4e2d\u8bfb\u53d6\u5feb\uff0c\u8bbf\u95ee\u901f\u5ea6\u4f1a\u53d7\u5230\u5f71\u54cd\uff09 2. \u5982\u679c\u7528\u6237\u4f7f\u7528\u4ee3\u7406 request . META [ \"REMOTE_ADDR\" ] \u6293\u4e0d\u5230\u771f\u5b9e\u5730\u5740\uff0c\u6240\u4ee5\u6211\u4eec\u9996\u5148\u4f7f\u7528 request . META [ \"HTTP_X_FORWARDED_FOR\" ] \u6765\u83b7\u53d6\u7528\u6237\u771f\u5b9e\u5730\u5740 3. \u6211\u4eec\u5c06\u5176\u7528\u6237 ip\u548c\u8bbf\u95ee\u6b21\u6570\u50a8\u5b58 \uff0c\u5728 settings . py\u4e2d\u8bbe\u7f6e\u4e00\u4e2a\u5e38\u91cfLIMIT_VISIT_TIMES \uff0c\u8d85\u8fc7\u8fd9\u4e2a\u6b21\u6570\u4e0d\u8ba9\u7528\u6237\u8bbf\u95ee\u7f51\u9875 ; MAX_VISIT_TIMES\u8d85\u8fc7\u8fd9\u4e2a\u6b21\u6570 \uff0c\u5c06\u8fd9\u4e2a ip\u52a0\u5165\u9ed1\u540d\u5355","title":"3.2 IP\u8bbf\u95ee\u8bc4\u7387\u9650\u5236"},{"location":"python/django/note/django.blank/","text":"\u8868\u5355\u6709\u5173\u7a7a\u8bbe\u7f6e 1. \u4ecb\u7ecd \u00b6 \u5efa\u7acb\u4e00\u4e2a\u7b80\u6613Model class Person(models.Model): GENDER_CHOICES=( (1,'Male'), (2,'Female'), ) name=models.CharField(max_length=30,unique=True,verbose_name='\u59d3 \u540d') birthday=models.DateField(blank=True,null=True) gender=models.IntegerField(choices=GENDER_CHOICES) account=models.IntegerField(default=0) 2. blank \u00b6 \u8bbe\u7f6e\u4e3aTrue\u65f6\uff0c\u5b57\u6bb5\u53ef\u4ee5\u4e3a\u7a7a\u3002\u8bbe\u7f6e\u4e3aFalse\u65f6\uff0c\u5b57\u6bb5\u662f\u5fc5\u987b\u586b\u5199\u7684\u3002\u5b57\u7b26\u578b\u5b57\u6bb5CharField\u548cTextField\u662f\u7528\u7a7a\u5b57\u7b26\u4e32\u6765\u5b58\u50a8\u7a7a\u503c\u7684\u3002\u5982\u679c\u4e3aTrue\uff0c\u5b57\u6bb5\u5141\u8bb8\u4e3a\u7a7a\uff0c\u9ed8\u8ba4\u4e0d\u5141\u8bb8\u3002 3. null \u00b6 \u8bbe\u7f6e\u4e3aTrue\u65f6\uff0cdjango\u7528Null\u6765\u5b58\u50a8\u7a7a\u503c\u3002\u65e5\u671f\u578b\u3001\u65f6\u95f4\u578b\u548c\u6570\u5b57\u578b\u5b57\u6bb5\u4e0d\u63a5\u53d7\u7a7a\u5b57\u7b26\u4e32\u3002\u6240\u4ee5\u8bbe\u7f6eIntegerField\uff0cDateTimeField\u578b\u5b57\u6bb5\u53ef\u4ee5\u4e3a\u7a7a\u65f6\uff0c\u9700\u8981\u5c06blank\uff0cnull\u5747\u8bbe\u4e3aTrue\u3002 \u5982\u679c\u4e3aTrue\uff0c\u7a7a\u503c\u5c06\u4f1a\u88ab\u5b58\u50a8\u4e3aNULL\uff0c\u9ed8\u8ba4\u4e3aFalse\u3002 \u5982\u679c\u60f3\u8bbe\u7f6eBooleanField\u4e3a\u7a7a\u65f6\u53ef\u4ee5\u9009\u7528NullBooleanField\u578b\u5b57\u6bb5\u3002 4. \u603b\u7ed3 \u00b6 null \u662f\u9488\u5bf9\u6570\u636e\u5e93\u800c\u8a00\uff0c\u5982\u679c null=True, \u8868\u793a\u6570\u636e\u5e93\u7684\u8be5\u5b57\u6bb5\u53ef\u4ee5\u4e3a\u7a7a\u3002 blank \u662f\u9488\u5bf9\u8868\u5355\u7684\uff0c\u5982\u679c blank=True\uff0c\u8868\u793a\u4f60\u7684\u8868\u5355\u586b\u5199\u8be5\u5b57\u6bb5\u7684\u65f6\u5019\u53ef\u4ee5\u4e0d\u586b\uff0c\u6bd4\u5982 admin \u754c\u9762\u4e0b\u589e\u52a0 model \u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019\u3002","title":"1. \u8868\u5355\u7a7a"},{"location":"python/django/note/django.blank/#1","text":"\u5efa\u7acb\u4e00\u4e2a\u7b80\u6613Model class Person(models.Model): GENDER_CHOICES=( (1,'Male'), (2,'Female'), ) name=models.CharField(max_length=30,unique=True,verbose_name='\u59d3 \u540d') birthday=models.DateField(blank=True,null=True) gender=models.IntegerField(choices=GENDER_CHOICES) account=models.IntegerField(default=0)","title":"1. \u4ecb\u7ecd"},{"location":"python/django/note/django.blank/#2-blank","text":"\u8bbe\u7f6e\u4e3aTrue\u65f6\uff0c\u5b57\u6bb5\u53ef\u4ee5\u4e3a\u7a7a\u3002\u8bbe\u7f6e\u4e3aFalse\u65f6\uff0c\u5b57\u6bb5\u662f\u5fc5\u987b\u586b\u5199\u7684\u3002\u5b57\u7b26\u578b\u5b57\u6bb5CharField\u548cTextField\u662f\u7528\u7a7a\u5b57\u7b26\u4e32\u6765\u5b58\u50a8\u7a7a\u503c\u7684\u3002\u5982\u679c\u4e3aTrue\uff0c\u5b57\u6bb5\u5141\u8bb8\u4e3a\u7a7a\uff0c\u9ed8\u8ba4\u4e0d\u5141\u8bb8\u3002","title":"2. blank"},{"location":"python/django/note/django.blank/#3-null","text":"\u8bbe\u7f6e\u4e3aTrue\u65f6\uff0cdjango\u7528Null\u6765\u5b58\u50a8\u7a7a\u503c\u3002\u65e5\u671f\u578b\u3001\u65f6\u95f4\u578b\u548c\u6570\u5b57\u578b\u5b57\u6bb5\u4e0d\u63a5\u53d7\u7a7a\u5b57\u7b26\u4e32\u3002\u6240\u4ee5\u8bbe\u7f6eIntegerField\uff0cDateTimeField\u578b\u5b57\u6bb5\u53ef\u4ee5\u4e3a\u7a7a\u65f6\uff0c\u9700\u8981\u5c06blank\uff0cnull\u5747\u8bbe\u4e3aTrue\u3002 \u5982\u679c\u4e3aTrue\uff0c\u7a7a\u503c\u5c06\u4f1a\u88ab\u5b58\u50a8\u4e3aNULL\uff0c\u9ed8\u8ba4\u4e3aFalse\u3002 \u5982\u679c\u60f3\u8bbe\u7f6eBooleanField\u4e3a\u7a7a\u65f6\u53ef\u4ee5\u9009\u7528NullBooleanField\u578b\u5b57\u6bb5\u3002","title":"3. null"},{"location":"python/django/note/django.blank/#4","text":"null \u662f\u9488\u5bf9\u6570\u636e\u5e93\u800c\u8a00\uff0c\u5982\u679c null=True, \u8868\u793a\u6570\u636e\u5e93\u7684\u8be5\u5b57\u6bb5\u53ef\u4ee5\u4e3a\u7a7a\u3002 blank \u662f\u9488\u5bf9\u8868\u5355\u7684\uff0c\u5982\u679c blank=True\uff0c\u8868\u793a\u4f60\u7684\u8868\u5355\u586b\u5199\u8be5\u5b57\u6bb5\u7684\u65f6\u5019\u53ef\u4ee5\u4e0d\u586b\uff0c\u6bd4\u5982 admin \u754c\u9762\u4e0b\u589e\u52a0 model \u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019\u3002","title":"4. \u603b\u7ed3"},{"location":"python/django/note/django.duplication_url_name/","text":"django \u591aapp \u76f8\u540cURL 1. \u4ecb\u7ecd \u00b6 \u5728Django\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u7ecf\u5e38\u4f1a\u7528\u5230\u8def\u7531\u522b\u540d\uff08\u5373url\u4e2d\u7684name\uff09 urlpatterns = [ url(r'^list/', views.list, name='list'), ] \u4f46\u5728\u4e00\u4e2aDjango\u9879\u76ee\u4e2d\u901a\u5e38\u4f1a\u5b58\u5728\u591a\u4e2aapp\u4e5f\u5c31\u662f\u8bf4\u4f1a\u5b58\u5728\u591a\u4e2aurls.py\u6587\u4ef6\uff0c\u800c\u6bcf\u4e2aurls.py\u6587\u4ef6\u4e2d\u4f1a\u5b58\u5728\u591a\u6761\u8def\u7531\uff0c\u8fd9\u5c31\u96be\u514d\u4f1a\u5b58\u5728\u76f8\u540c\u7684\u522b\u540d\uff0c\u800c\u5728\u8c03\u7528\u522b\u540d\u65f6\uff0c\u5982\u679c\u4e0d\u5bf9sessing.py\u6587\u4ef6\u8fdb\u884c\u8bbe\u7f6e\u7684\u8bdd\uff0c\u5c31\u4f1a\u51fa\u73b0\u627e\u9519\u522b\u540d\u7684\u95ee\u9898\uff0c\u53ef\u80fd\u4f1a\u627e\u5230\u7684\u662f\u522b\u7684app\u4e0b\u7684\u522b\u540d\u3002\u8fd9\u65f6\u9700\u8981\u5bf9\u5bf9sessing.py\u6587\u4ef6\u8fdb\u884c\u8bbe\u7f6e\u3002 1.1 \u8bbe\u7f6esettings.py \u00b6 \u5728sessing.py\u6587\u4ef6\u4e2d\u627e\u5230 TEMPLATES \u505a\u5982\u4e0b\u4fee\u6539\uff1a TEMPLATES = [ { 'BACKEND': 'django.template.backends.django.DjangoTemplates', 'DIRS': [os.path.join(BASE_DIR, 'templates')], 'APP_DIRS': True, 'OPTIONS': { 'context_processors': [ 'django.template.context_processors.debug', 'django.template.context_processors.request', 'django.contrib.auth.context_processors.auth', 'django.contrib.messages.context_processors.messages', ], }, }, ] \u6ce8\u610f 'APP_DIRS' : True , True \uff1a\u8868\u793a\u4f18\u5148\u5728\u5f53\u524d app\u4e0b\u8fdb\u884c\u67e5\u627e\u522b\u540d False : \u8868\u793a\u5728\u5168\u5c40\uff08\u6574\u4e2a\u9879\u76ee\uff09\u8fdb\u884c\u522b\u540d\u67e5\u627e 1.2 \u914d\u7f6e\u548c\u5f15\u7528 \u00b6 \u5728app\u4e0b\u65b0\u5efa\u6587\u4ef6\u5939templates,\u5728templates\u91cc\u9762\u5efa\u7acbapp\u540c\u540d\u6587\u4ef6\u5939,\u518d\u653e\u5165html\u6a21\u7248 \u5f15\u7528\u6a21\u7248\u7684\u65f6\u5019,\u91c7\u7528appname/index.html \u8fd9\u79cd\u65b9\u5f0f\u5373\u53ef 2. \u5b9e\u4f8b \u00b6 2.1 \u4fee\u6539APP_DIRS \u00b6 \u627e\u5230django\u7684\u9879\u76ee\u540d\u79f0\u4e0b\u7684settings.py\u6587\u4ef6\u3002\u4fee\u6539 'APP_DIRS': True, urls.py from django.contrib import admin from django.urls import path from django.conf.urls import include,url urlpatterns = [ path('admin/', admin.site.urls), # url(r'^rbac/', include(('rbac.urls', \"rbac\"), namespace='rbac')), url(r'^app01/', include(('app01.urls', \"app01\"), namespace='app01')), url(r'^app02/', include(('app02.urls', \"app02\"), namespace='app02')), ] \u628a\u4e24app\u7684\u5404\u81ea\u8def\u7531\u90fd\u5206\u914d\u5230\u81ea\u5df1\u7684app\u4e0b\uff0c\u7136\u540e\u5728\u9879\u76ee\u7684urls.py \u6dfb\u52a0 2.2 app01 \u00b6 2.2.1 urls \u00b6 from django.conf.urls import include, url from app01 import views urlpatterns = [ url(r'^list/', views.list, name='list'), ] 2.2.2 views \u00b6 def list(request): return render(request, 'app02/list.html') # return HttpResponse(reverse(\"app01:list\")) 2.2.3 html \u00b6 <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>from app01 list</h1> </body> </html> 2.3 app02 \u00b6 2.3.1 url \u00b6 from django.conf.urls import include, url from app02 import views urlpatterns = [ url(r'^list/', views.list, name='list'), url(r'^app02_list/', views.app02_list, name='app02_list'), ] 2.3.2 views \u00b6 def list(request): return render(request, 'app02/list.html') 2.3.3 html \u00b6 <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>from app02 bak</h1> </body> </html> 2.4 \u6d4b\u8bd5 \u00b6 \u6211\u4eec\u5206\u522b\u8f93\u5165app01/list app02/list \u67e5\u770b\u7ed3\u679c \u603b\u7ed3 \u4e3a\u4e86\u89e3\u51b3\u591a app\u540c\u540durl name\u7684\u65f6\u5019 \uff0c\u6700\u597d\u7684\u529e\u597d\u5c31\u662f\u5728\u5404\u81ea\u7684 app\u7684\u4e0b\u9762\u7684templates\u4e0b\u9762\u518d\u5efa\u7acb\u4e00\u4e2a\u4ee5app\u540d\u5b57\u7684\u6587\u4ef6 \u3002\u7136\u540e\u518d\u5199\u89c6\u56fe\u6a21\u677f\u7684 html\u7f51\u9875","title":"2. \u91cd\u540durl"},{"location":"python/django/note/django.duplication_url_name/#1","text":"\u5728Django\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u7ecf\u5e38\u4f1a\u7528\u5230\u8def\u7531\u522b\u540d\uff08\u5373url\u4e2d\u7684name\uff09 urlpatterns = [ url(r'^list/', views.list, name='list'), ] \u4f46\u5728\u4e00\u4e2aDjango\u9879\u76ee\u4e2d\u901a\u5e38\u4f1a\u5b58\u5728\u591a\u4e2aapp\u4e5f\u5c31\u662f\u8bf4\u4f1a\u5b58\u5728\u591a\u4e2aurls.py\u6587\u4ef6\uff0c\u800c\u6bcf\u4e2aurls.py\u6587\u4ef6\u4e2d\u4f1a\u5b58\u5728\u591a\u6761\u8def\u7531\uff0c\u8fd9\u5c31\u96be\u514d\u4f1a\u5b58\u5728\u76f8\u540c\u7684\u522b\u540d\uff0c\u800c\u5728\u8c03\u7528\u522b\u540d\u65f6\uff0c\u5982\u679c\u4e0d\u5bf9sessing.py\u6587\u4ef6\u8fdb\u884c\u8bbe\u7f6e\u7684\u8bdd\uff0c\u5c31\u4f1a\u51fa\u73b0\u627e\u9519\u522b\u540d\u7684\u95ee\u9898\uff0c\u53ef\u80fd\u4f1a\u627e\u5230\u7684\u662f\u522b\u7684app\u4e0b\u7684\u522b\u540d\u3002\u8fd9\u65f6\u9700\u8981\u5bf9\u5bf9sessing.py\u6587\u4ef6\u8fdb\u884c\u8bbe\u7f6e\u3002","title":"1. \u4ecb\u7ecd"},{"location":"python/django/note/django.duplication_url_name/#11-settingspy","text":"\u5728sessing.py\u6587\u4ef6\u4e2d\u627e\u5230 TEMPLATES \u505a\u5982\u4e0b\u4fee\u6539\uff1a TEMPLATES = [ { 'BACKEND': 'django.template.backends.django.DjangoTemplates', 'DIRS': [os.path.join(BASE_DIR, 'templates')], 'APP_DIRS': True, 'OPTIONS': { 'context_processors': [ 'django.template.context_processors.debug', 'django.template.context_processors.request', 'django.contrib.auth.context_processors.auth', 'django.contrib.messages.context_processors.messages', ], }, }, ] \u6ce8\u610f 'APP_DIRS' : True , True \uff1a\u8868\u793a\u4f18\u5148\u5728\u5f53\u524d app\u4e0b\u8fdb\u884c\u67e5\u627e\u522b\u540d False : \u8868\u793a\u5728\u5168\u5c40\uff08\u6574\u4e2a\u9879\u76ee\uff09\u8fdb\u884c\u522b\u540d\u67e5\u627e","title":"1.1 \u8bbe\u7f6esettings.py"},{"location":"python/django/note/django.duplication_url_name/#12","text":"\u5728app\u4e0b\u65b0\u5efa\u6587\u4ef6\u5939templates,\u5728templates\u91cc\u9762\u5efa\u7acbapp\u540c\u540d\u6587\u4ef6\u5939,\u518d\u653e\u5165html\u6a21\u7248 \u5f15\u7528\u6a21\u7248\u7684\u65f6\u5019,\u91c7\u7528appname/index.html \u8fd9\u79cd\u65b9\u5f0f\u5373\u53ef","title":"1.2 \u914d\u7f6e\u548c\u5f15\u7528"},{"location":"python/django/note/django.duplication_url_name/#2","text":"","title":"2. \u5b9e\u4f8b"},{"location":"python/django/note/django.duplication_url_name/#21-app_dirs","text":"\u627e\u5230django\u7684\u9879\u76ee\u540d\u79f0\u4e0b\u7684settings.py\u6587\u4ef6\u3002\u4fee\u6539 'APP_DIRS': True, urls.py from django.contrib import admin from django.urls import path from django.conf.urls import include,url urlpatterns = [ path('admin/', admin.site.urls), # url(r'^rbac/', include(('rbac.urls', \"rbac\"), namespace='rbac')), url(r'^app01/', include(('app01.urls', \"app01\"), namespace='app01')), url(r'^app02/', include(('app02.urls', \"app02\"), namespace='app02')), ] \u628a\u4e24app\u7684\u5404\u81ea\u8def\u7531\u90fd\u5206\u914d\u5230\u81ea\u5df1\u7684app\u4e0b\uff0c\u7136\u540e\u5728\u9879\u76ee\u7684urls.py \u6dfb\u52a0","title":"2.1 \u4fee\u6539APP_DIRS"},{"location":"python/django/note/django.duplication_url_name/#22-app01","text":"","title":"2.2 app01"},{"location":"python/django/note/django.duplication_url_name/#221-urls","text":"from django.conf.urls import include, url from app01 import views urlpatterns = [ url(r'^list/', views.list, name='list'), ]","title":"2.2.1 urls"},{"location":"python/django/note/django.duplication_url_name/#222-views","text":"def list(request): return render(request, 'app02/list.html') # return HttpResponse(reverse(\"app01:list\"))","title":"2.2.2 views"},{"location":"python/django/note/django.duplication_url_name/#223-html","text":"<!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>from app01 list</h1> </body> </html>","title":"2.2.3 html"},{"location":"python/django/note/django.duplication_url_name/#23-app02","text":"","title":"2.3 app02"},{"location":"python/django/note/django.duplication_url_name/#231-url","text":"from django.conf.urls import include, url from app02 import views urlpatterns = [ url(r'^list/', views.list, name='list'), url(r'^app02_list/', views.app02_list, name='app02_list'), ]","title":"2.3.1 url"},{"location":"python/django/note/django.duplication_url_name/#232-views","text":"def list(request): return render(request, 'app02/list.html')","title":"2.3.2 views"},{"location":"python/django/note/django.duplication_url_name/#233-html","text":"<!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>from app02 bak</h1> </body> </html>","title":"2.3.3 html"},{"location":"python/django/note/django.duplication_url_name/#24","text":"\u6211\u4eec\u5206\u522b\u8f93\u5165app01/list app02/list \u67e5\u770b\u7ed3\u679c \u603b\u7ed3 \u4e3a\u4e86\u89e3\u51b3\u591a app\u540c\u540durl name\u7684\u65f6\u5019 \uff0c\u6700\u597d\u7684\u529e\u597d\u5c31\u662f\u5728\u5404\u81ea\u7684 app\u7684\u4e0b\u9762\u7684templates\u4e0b\u9762\u518d\u5efa\u7acb\u4e00\u4e2a\u4ee5app\u540d\u5b57\u7684\u6587\u4ef6 \u3002\u7136\u540e\u518d\u5199\u89c6\u56fe\u6a21\u677f\u7684 html\u7f51\u9875","title":"2.4 \u6d4b\u8bd5"},{"location":"python/django/note/django.url_name/","text":"URL name 1. \u4ecb\u7ecd \u00b6 django\u91cd\u70b9\u4e4burl\u522b\u540d[\u53c2\u6570\u540d\u5fc5\u987b\u662fname,\u683c\u5f0f\u662fname=\"XXX]\uff0c\u6211\u4eec\u79f0url\u7684\u522b\u540d\u3002 1. \u4e0d\u8bba\u540e\u53f0\u8def\u5f84\u5982\u4f55\u8fdb\u884c\u4fee\u6539\u8def\u5f84\uff0c\u524d\u53f0\u8bbf\u95ee\u7684\u8def\u5f84\u4e0d\u53d8\uff0c\u6c38\u8fdc\u662falias, \u8fd9\u6837\u65b9\u4fbf\u5f00\u53d1 2. \u524d\u53f0\u6839\u636e {{ url \"alias\"}} \u53bbviews.py\u4e2d\u67e5\u770bname=\"alias\"\u7684url 2. \u5b9e\u4f8b \u00b6 2.1 url \u00b6 urlpatterns = [ path('admin/', admin.site.urls), path('hello1/', views.hello1, name='hello1'), path('hello2/', views.hello2, name='hello2'), ] URL\u7b2c\u56db\u4e2a\u53c2\u6570\u522b\u540d\u64cd\u4f5c\uff0cname=\"hello1\",name='hello2',name\u91cc\u9762\u7684\u503c\u4ee3\u8868\u7684\u662f\u6211\u4eec\u7684URL\u8def\u5f84 2.2 views \u00b6 def hello1(request): return render(request,'hello1.html') def hello2(request): return render(request,'hello2.html') 2.3 html \u00b6 hello1.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>hello1</h1> <a href=\"{% url 'hello2' %}\">hello2</a> </body> </html> hello2.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>hello2</h1> <a href=\"{% url 'hello1' %}\">hello1</a> </body> </html> \u6ce8\u610f < a href = \"{ % u rl 'hello2' %}\" > hello2 </ a > \u6b63\u5e38\u6211\u4eec\u82e5\u662f\u4f7f\u7528\u4ee5\u4e0b\u8868\u793a < a href = \"/hello2/\" > hello2 </ a > , \u82e5\u662f\u8def\u7531 url\u4e2d\u53d8\u66f4\u7684\u8bdd \u3002\u90a3\u4e48\u6b64\u65f6 html\u4e2d\u7684\u6807\u7b7e\u4e5f\u7684\u8ddf\u7740\u6539 \u3002\u5f88\u9ebb\u70e6\u3002\u6240\u4ee5\u4f7f\u7528 { % url 'hello2' % } \u3002 3 \u6d4b\u8bd5 \u00b6 3.1 \u6d4b\u8bd5 \u00b6 \u6211\u4eec\u5728\u8303\u56f4127.0.0.1:8000/hello1 hello1\u548c\u4e00\u4e2aa\u6807\u7b7ehello2\uff0c \u5f53\u6211\u4eec\u70b9\u51fbhello2\u7684\u65f6\u5019\u4f1a\u8df3\u8f6c\u5230hello2\u9875\u9762\u4e5f\u5c31\u662fhttp://127.0.0.1:8000/hello2/, \u6ce8\u610f name\u7684\u4f5c\u7528\u5c31\u662furl\u548c\u540e\u9762\u7684\u89c6\u56fe\u51fd\u6570\u7ed1\u5b9a \uff0c\u4e0d\u8bba\u524d\u9762 rul\u540e\u9762\u600e\u4e48\u4fee\u6539 3.2 \u603b\u7ed3 \u00b6 \u5f53\u6211\u4eec\u4fee\u6539 path('hello2/', views.hello2, name='hello2'), \u53d8\u66f4\u4e3a path('test/', views.hello2, name='hello2'), \u90a3\u4e48\u540e\u9762\u7684\u4eec\u7684\u89c6\u56fe\u51fd\u6570\u5728hello2.html\u548chello.html \u4e2d\u7684a\u6807\u7b7e\u5c31\u4e0d\u9700\u8981\u4e86\u4fee\u6539\u4e86\uff0c\u4f1a\u81ea\u52a8\u5173\u8054\u524d\u9762\u4fee\u6539\u540e\u7684url\u5730\u5740\u3002","title":"1. name"},{"location":"python/django/note/django.url_name/#1","text":"django\u91cd\u70b9\u4e4burl\u522b\u540d[\u53c2\u6570\u540d\u5fc5\u987b\u662fname,\u683c\u5f0f\u662fname=\"XXX]\uff0c\u6211\u4eec\u79f0url\u7684\u522b\u540d\u3002 1. \u4e0d\u8bba\u540e\u53f0\u8def\u5f84\u5982\u4f55\u8fdb\u884c\u4fee\u6539\u8def\u5f84\uff0c\u524d\u53f0\u8bbf\u95ee\u7684\u8def\u5f84\u4e0d\u53d8\uff0c\u6c38\u8fdc\u662falias, \u8fd9\u6837\u65b9\u4fbf\u5f00\u53d1 2. \u524d\u53f0\u6839\u636e {{ url \"alias\"}} \u53bbviews.py\u4e2d\u67e5\u770bname=\"alias\"\u7684url","title":"1. \u4ecb\u7ecd"},{"location":"python/django/note/django.url_name/#2","text":"","title":"2. \u5b9e\u4f8b"},{"location":"python/django/note/django.url_name/#21-url","text":"urlpatterns = [ path('admin/', admin.site.urls), path('hello1/', views.hello1, name='hello1'), path('hello2/', views.hello2, name='hello2'), ] URL\u7b2c\u56db\u4e2a\u53c2\u6570\u522b\u540d\u64cd\u4f5c\uff0cname=\"hello1\",name='hello2',name\u91cc\u9762\u7684\u503c\u4ee3\u8868\u7684\u662f\u6211\u4eec\u7684URL\u8def\u5f84","title":"2.1 url"},{"location":"python/django/note/django.url_name/#22-views","text":"def hello1(request): return render(request,'hello1.html') def hello2(request): return render(request,'hello2.html')","title":"2.2 views"},{"location":"python/django/note/django.url_name/#23-html","text":"hello1.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>hello1</h1> <a href=\"{% url 'hello2' %}\">hello2</a> </body> </html> hello2.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>hello2</h1> <a href=\"{% url 'hello1' %}\">hello1</a> </body> </html> \u6ce8\u610f < a href = \"{ % u rl 'hello2' %}\" > hello2 </ a > \u6b63\u5e38\u6211\u4eec\u82e5\u662f\u4f7f\u7528\u4ee5\u4e0b\u8868\u793a < a href = \"/hello2/\" > hello2 </ a > , \u82e5\u662f\u8def\u7531 url\u4e2d\u53d8\u66f4\u7684\u8bdd \u3002\u90a3\u4e48\u6b64\u65f6 html\u4e2d\u7684\u6807\u7b7e\u4e5f\u7684\u8ddf\u7740\u6539 \u3002\u5f88\u9ebb\u70e6\u3002\u6240\u4ee5\u4f7f\u7528 { % url 'hello2' % } \u3002","title":"2.3 html"},{"location":"python/django/note/django.url_name/#3","text":"","title":"3 \u6d4b\u8bd5"},{"location":"python/django/note/django.url_name/#31","text":"\u6211\u4eec\u5728\u8303\u56f4127.0.0.1:8000/hello1 hello1\u548c\u4e00\u4e2aa\u6807\u7b7ehello2\uff0c \u5f53\u6211\u4eec\u70b9\u51fbhello2\u7684\u65f6\u5019\u4f1a\u8df3\u8f6c\u5230hello2\u9875\u9762\u4e5f\u5c31\u662fhttp://127.0.0.1:8000/hello2/, \u6ce8\u610f name\u7684\u4f5c\u7528\u5c31\u662furl\u548c\u540e\u9762\u7684\u89c6\u56fe\u51fd\u6570\u7ed1\u5b9a \uff0c\u4e0d\u8bba\u524d\u9762 rul\u540e\u9762\u600e\u4e48\u4fee\u6539","title":"3.1 \u6d4b\u8bd5"},{"location":"python/django/note/django.url_name/#32","text":"\u5f53\u6211\u4eec\u4fee\u6539 path('hello2/', views.hello2, name='hello2'), \u53d8\u66f4\u4e3a path('test/', views.hello2, name='hello2'), \u90a3\u4e48\u540e\u9762\u7684\u4eec\u7684\u89c6\u56fe\u51fd\u6570\u5728hello2.html\u548chello.html \u4e2d\u7684a\u6807\u7b7e\u5c31\u4e0d\u9700\u8981\u4e86\u4fee\u6539\u4e86\uff0c\u4f1a\u81ea\u52a8\u5173\u8054\u524d\u9762\u4fee\u6539\u540e\u7684url\u5730\u5740\u3002","title":"3.2 \u603b\u7ed3"},{"location":"python/django/url/django.paginator/","text":"Django \u5206\u9875\u5668 1. \u4ecb\u7ecd \u00b6 \u5206\u9875\u5668\u5728\u9875\u9762\u4e2d\u975e\u5e38\u5e38\u89c1\uff0c\u5f53\u6570\u636e\u5e93\u6761\u6570\u6570\u636e\u8fc7\u591a\u65f6\uff0c\u9875\u9762\u4e00\u6b21\u6027\u663e\u793a\u4e0d\u597d\u770b\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5206\u9875\u5668\uff0c\u5c06\u6570\u636e\u5206\u51e0\u6b21\u663e\u793a\u3002 1.2 \u9020\u6570\u636e \u00b6 Booklist=[] for i in range(100): Booklist.append(Book(title=\"book\"+str(i),price=30+i*i)) Book.objects.bulk_create(Booklist) \u4f7f\u7528\u5bf9\u8c61\u4e0b\u9762\u7684bulk_create()\uff0c\u53ef\u4ee5\u5b9e\u73b0\u6279\u91cf\u63d2\u5165 1.3 \u5bfc\u5165\u6a21\u5757 \u00b6 from django.core.paginator import Paginator 1.4 \u5b9e\u4f8b\u5316 \u00b6 paginator = Paginator(book_list,10) \u7b2c\u4e00\u4e2a\u4e3a\u6570\u636e\u5217\u8868\uff0c\u7b2c\u4e8c\u4e2a\u4e3a\u6bcf\u4e00\u9875\u6570\u636e 1.5 \u65b9\u6cd5 \u00b6 \u5206\u9875\u5668\u5bf9\u8c61\u76f8\u5173\u7684\u65b9\u6cd5\u5982\u4e0b\uff1a \u65b9\u6cd5 \u4f5c\u7528 paginator.count() \u6570\u636e\u603b\u6570 paginator.num_pages() \u603b\u9875\u6570 paginator.page_range() \u9875\u7801\u7684\u8fed\u4ee3\u5668 \u83b7\u53d6\u7b2cn\u9875\u6570\u636e current_page = paginator.page(1)\u83b7\u53d6\u7b2c\u4e00\u9875\u7684\u5217\u8868 \u65b9\u6cd5|\u4f5c\u7528 ---|--- current_page.object_list| \u83b7\u53d6\u7b2cn\u9875\u5bf9\u8c61\u5217\u8868 current_page.has_next()| \u662f\u5426\u6709\u4e0b\u4e00\u9875 current_page.next_page_number()| \u4e0b\u4e00\u9875\u7684\u9875\u7801 current_page.has_previous()| \u662f\u5426\u6709\u4e0a\u4e00\u9875 current_page.previous_page_number()|\u4e0a\u4e00\u9875\u7684\u9875\u7801 \u6ce8\u610f\uff1a \u5982\u679c\u5728paginator.page(1)\u8f93\u5165\u7684\u9875\u7801\u6570\u5c0f\u4e8e1\u6216\u8005\u5927\u4e8e\u6700\u5927\u9875\u6570\uff0c\u4f1a\u62a5EmptyPage\u9519\u8bef\u3002 \u6355\u6349EmptyPage\u9519\u8bef\u65b9\u6cd5 2. \u4f8b\u5b50 \u00b6 views.py def books(request): book_list = Book.objects.all() from django.core.paginator import Paginator,EmptyPage paginator = Paginator(book_list,3) num_pages = paginator.num_pages current_page_num = int(request.GET.get(\"page\",1)) if num_pages > 11: if current_page_num < 5: page_range = range(1,11) elif current_page_num+5 > num_pages: page_range = range(num_pages-10,num_pages+1) else: page_range = range(current_page_num-5,current_page_num+5) else: page_range = paginator.page_range try: current_page = paginator.page(current_page_num) except EmptyPage as e: current_page = paginator.page(1) return render(request,\"book.html\",locals()) from django.core.paginator import EmptyPage \u5f15\u5165\u9519\u8bef\uff0c\u4f7f\u7528try\u6355\u6349\u9519\u8bef try: \u5185\u5bb9 except EmptyPage as e: current_page=paginator.page(1) book.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>\u5206\u9875\u7ec3\u4e60</title> <link rel=\"stylesheet\" href=\"https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css\" integrity=\"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u\" crossorigin=\"anonymous\"> <script src=\"https://code.jquery.com/jquery-3.3.1.js\" integrity=\"sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=\" crossorigin=\"anonymous\"></script> </head> <body> <p>OK</p> <table class=\"table table-striped\"> <tbody> {#\u663e\u793a\u5f53\u524d\u9875\u9762#} {% for book in current_page %} <tr> <td>{{ book.nid }}</td> <td>{{ book.title }}</td> <td>{{ book.price}}</td> </tr> {% endfor %} </tbody> </table> {#\u663e\u793a\u9875\u7801#} <ul class=\"pagination\"> {% if current_page.has_previous %} <li> <a href=\"?page={{ current_page.previous_page_number }}\" aria-label=\"Previous\"> <span aria-hidden=\"true\">&laquo;</span> </a> </li> {% else %} <li class=\"disabled\"> <a href=\"\" aria-label=\"Previous\"> <span aria-hidden=\"true\">&laquo;</span> </a> </li> {% endif %} {% for item in page_range %} {% if item == current_page_num %} <li class=\"active\"><a href=\"?page={{ item }}\">{{ item }}</a></li> {% else %} <li><a href=\"?page={{ item }}\">{{ item }}</a></li> {% endif %} {% endfor %} {% if current_page.has_next %} <li> <a href=\"?page={{ current_page.next_page_number }}\" aria-label=\"Next\"> <span aria-hidden=\"true\">&raquo;</span> </a> </li> {% else %} <li class=\"disabled\"> <a href=\"\" aria-label=\"Next\"> <span aria-hidden=\"true\">&raquo;</span> </a> </li> {% endif %} </ul> </body> {#<script>#} {# $(\".pagination li a\").click(function () {#} {# $(this).parent().addClass(\"active\").siblings(\"li\").removeClass(\"active\")#} {# })#} {#</script>#} </html>","title":"4. \u5206\u9875\u5668"},{"location":"python/django/url/django.paginator/#1","text":"\u5206\u9875\u5668\u5728\u9875\u9762\u4e2d\u975e\u5e38\u5e38\u89c1\uff0c\u5f53\u6570\u636e\u5e93\u6761\u6570\u6570\u636e\u8fc7\u591a\u65f6\uff0c\u9875\u9762\u4e00\u6b21\u6027\u663e\u793a\u4e0d\u597d\u770b\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5206\u9875\u5668\uff0c\u5c06\u6570\u636e\u5206\u51e0\u6b21\u663e\u793a\u3002","title":"1. \u4ecb\u7ecd"},{"location":"python/django/url/django.paginator/#12","text":"Booklist=[] for i in range(100): Booklist.append(Book(title=\"book\"+str(i),price=30+i*i)) Book.objects.bulk_create(Booklist) \u4f7f\u7528\u5bf9\u8c61\u4e0b\u9762\u7684bulk_create()\uff0c\u53ef\u4ee5\u5b9e\u73b0\u6279\u91cf\u63d2\u5165","title":"1.2 \u9020\u6570\u636e"},{"location":"python/django/url/django.paginator/#13","text":"from django.core.paginator import Paginator","title":"1.3 \u5bfc\u5165\u6a21\u5757"},{"location":"python/django/url/django.paginator/#14","text":"paginator = Paginator(book_list,10) \u7b2c\u4e00\u4e2a\u4e3a\u6570\u636e\u5217\u8868\uff0c\u7b2c\u4e8c\u4e2a\u4e3a\u6bcf\u4e00\u9875\u6570\u636e","title":"1.4 \u5b9e\u4f8b\u5316"},{"location":"python/django/url/django.paginator/#15","text":"\u5206\u9875\u5668\u5bf9\u8c61\u76f8\u5173\u7684\u65b9\u6cd5\u5982\u4e0b\uff1a \u65b9\u6cd5 \u4f5c\u7528 paginator.count() \u6570\u636e\u603b\u6570 paginator.num_pages() \u603b\u9875\u6570 paginator.page_range() \u9875\u7801\u7684\u8fed\u4ee3\u5668 \u83b7\u53d6\u7b2cn\u9875\u6570\u636e current_page = paginator.page(1)\u83b7\u53d6\u7b2c\u4e00\u9875\u7684\u5217\u8868 \u65b9\u6cd5|\u4f5c\u7528 ---|--- current_page.object_list| \u83b7\u53d6\u7b2cn\u9875\u5bf9\u8c61\u5217\u8868 current_page.has_next()| \u662f\u5426\u6709\u4e0b\u4e00\u9875 current_page.next_page_number()| \u4e0b\u4e00\u9875\u7684\u9875\u7801 current_page.has_previous()| \u662f\u5426\u6709\u4e0a\u4e00\u9875 current_page.previous_page_number()|\u4e0a\u4e00\u9875\u7684\u9875\u7801 \u6ce8\u610f\uff1a \u5982\u679c\u5728paginator.page(1)\u8f93\u5165\u7684\u9875\u7801\u6570\u5c0f\u4e8e1\u6216\u8005\u5927\u4e8e\u6700\u5927\u9875\u6570\uff0c\u4f1a\u62a5EmptyPage\u9519\u8bef\u3002 \u6355\u6349EmptyPage\u9519\u8bef\u65b9\u6cd5","title":"1.5 \u65b9\u6cd5"},{"location":"python/django/url/django.paginator/#2","text":"views.py def books(request): book_list = Book.objects.all() from django.core.paginator import Paginator,EmptyPage paginator = Paginator(book_list,3) num_pages = paginator.num_pages current_page_num = int(request.GET.get(\"page\",1)) if num_pages > 11: if current_page_num < 5: page_range = range(1,11) elif current_page_num+5 > num_pages: page_range = range(num_pages-10,num_pages+1) else: page_range = range(current_page_num-5,current_page_num+5) else: page_range = paginator.page_range try: current_page = paginator.page(current_page_num) except EmptyPage as e: current_page = paginator.page(1) return render(request,\"book.html\",locals()) from django.core.paginator import EmptyPage \u5f15\u5165\u9519\u8bef\uff0c\u4f7f\u7528try\u6355\u6349\u9519\u8bef try: \u5185\u5bb9 except EmptyPage as e: current_page=paginator.page(1) book.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>\u5206\u9875\u7ec3\u4e60</title> <link rel=\"stylesheet\" href=\"https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css\" integrity=\"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u\" crossorigin=\"anonymous\"> <script src=\"https://code.jquery.com/jquery-3.3.1.js\" integrity=\"sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=\" crossorigin=\"anonymous\"></script> </head> <body> <p>OK</p> <table class=\"table table-striped\"> <tbody> {#\u663e\u793a\u5f53\u524d\u9875\u9762#} {% for book in current_page %} <tr> <td>{{ book.nid }}</td> <td>{{ book.title }}</td> <td>{{ book.price}}</td> </tr> {% endfor %} </tbody> </table> {#\u663e\u793a\u9875\u7801#} <ul class=\"pagination\"> {% if current_page.has_previous %} <li> <a href=\"?page={{ current_page.previous_page_number }}\" aria-label=\"Previous\"> <span aria-hidden=\"true\">&laquo;</span> </a> </li> {% else %} <li class=\"disabled\"> <a href=\"\" aria-label=\"Previous\"> <span aria-hidden=\"true\">&laquo;</span> </a> </li> {% endif %} {% for item in page_range %} {% if item == current_page_num %} <li class=\"active\"><a href=\"?page={{ item }}\">{{ item }}</a></li> {% else %} <li><a href=\"?page={{ item }}\">{{ item }}</a></li> {% endif %} {% endfor %} {% if current_page.has_next %} <li> <a href=\"?page={{ current_page.next_page_number }}\" aria-label=\"Next\"> <span aria-hidden=\"true\">&raquo;</span> </a> </li> {% else %} <li class=\"disabled\"> <a href=\"\" aria-label=\"Next\"> <span aria-hidden=\"true\">&raquo;</span> </a> </li> {% endif %} </ul> </body> {#<script>#} {# $(\".pagination li a\").click(function () {#} {# $(this).parent().addClass(\"active\").siblings(\"li\").removeClass(\"active\")#} {# })#} {#</script>#} </html>","title":"2. \u4f8b\u5b50"},{"location":"python/django/url/django.reverse_url/","text":"Django \u53cd\u5411\u89e3\u6790 1. \u4ecb\u7ecd \u00b6 Django\u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5173\u4e8eURL\u7684\u6620\u5c04\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4f60\u53ef\u4ee5\u505a\u4e24\u4e2a\u65b9\u5411\u7684\u4f7f\u7528: 1.\u6709\u5ba2\u6237\u7aef\u7684\u6d4f\u89c8\u5668\u53d1\u8d77\u4e00\u4e2aurl\u8bf7\u6c42\uff0cDjango\u6839\u636eURL\u89e3\u6790\uff0c\u628aurl\u4e2d\u7684\u53c2\u6570\u6355\u83b7\uff0c\u8c03\u7528\u76f8\u5e94\u7684\u8bd5\u56fe\uff0c \u83b7\u53d6\u76f8\u5e94\u7684\u6570\u636e\uff0c\u7136\u540e\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u663e\u793a 2.\u901a\u8fc7\u4e00\u4e2a\u89c6\u56fe\u7684\u540d\u5b57\uff0c\u518d\u52a0\u4e0a\u4e00\u4e9b\u53c2\u6570\u548c\u503c\uff0c\u9006\u5411\u83b7\u53d6\u76f8\u5e94\u7684URL \u7b2c\u4e00\u4e2a\u5c31\u662f\u5e73\u5e38\u7684\u8bf7\u6c42\u6709URLconf\u6765\u89e3\u6790\u7684\u8fc7\u7a0b\uff0c\u7b2c\u4e8c\u4e2a\u53eb\u505a\uff0curl\u7684\u9006\u5411\u89e3\u6790\uff0curl\u9006\u5411\u5339\u914d\uff0curl\u7684\u9006\u5411\u67e5\u9605\u7b49 Django\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u5c42\u7ea7\u7684url\u9006\u5411\u5904\u7406\u5de5\u5177\uff1a 1.\u5728\u6a21\u677ftemplates\u4e2d\uff0c\u4f7f\u7528url\u6807\u8bb0\uff0c\u5982\uff1a{% url %} 2.\u5728Python\u4ee3\u7801\u4e2d\uff0c\u4f7f\u7528django.core.urlresolvers.reverse()\u65b9\u6cd5 2. \u53cd\u5411\u89e3\u6790url \u00b6 2.1 url \u00b6 urlpatterns = [ path('admin/', admin.site.urls), path(\"login\",views.login,name=\"Log\") ] 2.2 views \u00b6 def login(request): if request.method == \"GET\": return render(request,\"login.html\") else: user = request.POST.get('user') pwd = request.POST.get('pwd') if user==\"cmz\" and pwd == 'cmz': return HttpResponse(\"\u767b\u5f55\u6210\u529f\") else: return HttpResponse(\"\u7528\u6237\u540d\u6216\u8005\u5bc6\u7801\u9519\u8bef\") return HttpResponse('OK') 2.3 html \u00b6 <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>login</title> </head> <body> {#<form action=\"http://127.0.0.1:8000/login\" method=\"post\">#} <form action=\"{% url 'Log' %}\" method=\"post\"> {#<form action=\"\" method=\"post\">#} \u7528\u6237\u540d: <input type=\"text\" name=\"user\"> \u5bc6\u7801: <input type=\"password\" name=\"pwd\"> <input type=\"submit\" name=\"\u63d0\u4ea4\"> </form> </body> </html> 2.4 \u6d4b\u8bd5 \u00b6 2.4.1 \u6539\u53d8url \u00b6 \u63a5\u4e0b\u6765\uff0c\u6211\u6539\u53d8\u5c06\u4e4b\u524d\u7684\"login\"\u6539\u4e3a\"login.html\" path(\"login.html\",views.login,name=\"Log\") \u6211\u5728\uff08\u4fdd\u5b58\u540epycharm\u81ea\u52a8\u91cd\u542fdjango\uff09\u91cd\u65b0\u8bbf\u95ee\u3002 \u8fd9\u4e2a\u5730\u65b9\u4f1a\u81ea\u52a8\u5173\u8054\uff08\u7ed1\u5b9a\u4e86\u8fd9\u79cd\u5173\u7cfb\uff09\u5c31\u662f\u901a\u8fc7name=\"Log\"\u6765\u5b9e\u73b0\u3002 path(\"login.html\",views.login,name=\"Log\") \u8fd9\u79cd\u5c31\u662f\u53cd\u5411\u89e3\u6790 3. \u53cd\u5411\u89e3\u6790 python \u00b6 \u53cd\u5411\u89e3\u6790\u9664\u4e86\u5728html\u7684\u6a21\u677f\u4e2d\u4f7f\u7528\uff0c\u8fd8\u53ef\u4ee5\u5728python\u4e2d\u4f7f\u7528 \u6d4b\u8bd5\u8bbf\u95ee \u5e26\u6709\u6b63\u5219\u7684\u5fc5\u987b\u8981\u4f20\u5165\u53c2\u6570 reverse\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662furls.py\u7684url\u4e2d\u7684name\u3002\u6bd4\u5982\u4e0a\u9762\u7684s_c_2003 y_a","title":"3. url \u53cd\u5411\u89e3\u6790"},{"location":"python/django/url/django.reverse_url/#1","text":"Django\u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5173\u4e8eURL\u7684\u6620\u5c04\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4f60\u53ef\u4ee5\u505a\u4e24\u4e2a\u65b9\u5411\u7684\u4f7f\u7528: 1.\u6709\u5ba2\u6237\u7aef\u7684\u6d4f\u89c8\u5668\u53d1\u8d77\u4e00\u4e2aurl\u8bf7\u6c42\uff0cDjango\u6839\u636eURL\u89e3\u6790\uff0c\u628aurl\u4e2d\u7684\u53c2\u6570\u6355\u83b7\uff0c\u8c03\u7528\u76f8\u5e94\u7684\u8bd5\u56fe\uff0c \u83b7\u53d6\u76f8\u5e94\u7684\u6570\u636e\uff0c\u7136\u540e\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u663e\u793a 2.\u901a\u8fc7\u4e00\u4e2a\u89c6\u56fe\u7684\u540d\u5b57\uff0c\u518d\u52a0\u4e0a\u4e00\u4e9b\u53c2\u6570\u548c\u503c\uff0c\u9006\u5411\u83b7\u53d6\u76f8\u5e94\u7684URL \u7b2c\u4e00\u4e2a\u5c31\u662f\u5e73\u5e38\u7684\u8bf7\u6c42\u6709URLconf\u6765\u89e3\u6790\u7684\u8fc7\u7a0b\uff0c\u7b2c\u4e8c\u4e2a\u53eb\u505a\uff0curl\u7684\u9006\u5411\u89e3\u6790\uff0curl\u9006\u5411\u5339\u914d\uff0curl\u7684\u9006\u5411\u67e5\u9605\u7b49 Django\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u5c42\u7ea7\u7684url\u9006\u5411\u5904\u7406\u5de5\u5177\uff1a 1.\u5728\u6a21\u677ftemplates\u4e2d\uff0c\u4f7f\u7528url\u6807\u8bb0\uff0c\u5982\uff1a{% url %} 2.\u5728Python\u4ee3\u7801\u4e2d\uff0c\u4f7f\u7528django.core.urlresolvers.reverse()\u65b9\u6cd5","title":"1. \u4ecb\u7ecd"},{"location":"python/django/url/django.reverse_url/#2-url","text":"","title":"2. \u53cd\u5411\u89e3\u6790url"},{"location":"python/django/url/django.reverse_url/#21-url","text":"urlpatterns = [ path('admin/', admin.site.urls), path(\"login\",views.login,name=\"Log\") ]","title":"2.1 url"},{"location":"python/django/url/django.reverse_url/#22-views","text":"def login(request): if request.method == \"GET\": return render(request,\"login.html\") else: user = request.POST.get('user') pwd = request.POST.get('pwd') if user==\"cmz\" and pwd == 'cmz': return HttpResponse(\"\u767b\u5f55\u6210\u529f\") else: return HttpResponse(\"\u7528\u6237\u540d\u6216\u8005\u5bc6\u7801\u9519\u8bef\") return HttpResponse('OK')","title":"2.2 views"},{"location":"python/django/url/django.reverse_url/#23-html","text":"<!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>login</title> </head> <body> {#<form action=\"http://127.0.0.1:8000/login\" method=\"post\">#} <form action=\"{% url 'Log' %}\" method=\"post\"> {#<form action=\"\" method=\"post\">#} \u7528\u6237\u540d: <input type=\"text\" name=\"user\"> \u5bc6\u7801: <input type=\"password\" name=\"pwd\"> <input type=\"submit\" name=\"\u63d0\u4ea4\"> </form> </body> </html>","title":"2.3 html"},{"location":"python/django/url/django.reverse_url/#24","text":"","title":"2.4 \u6d4b\u8bd5"},{"location":"python/django/url/django.reverse_url/#241-url","text":"\u63a5\u4e0b\u6765\uff0c\u6211\u6539\u53d8\u5c06\u4e4b\u524d\u7684\"login\"\u6539\u4e3a\"login.html\" path(\"login.html\",views.login,name=\"Log\") \u6211\u5728\uff08\u4fdd\u5b58\u540epycharm\u81ea\u52a8\u91cd\u542fdjango\uff09\u91cd\u65b0\u8bbf\u95ee\u3002 \u8fd9\u4e2a\u5730\u65b9\u4f1a\u81ea\u52a8\u5173\u8054\uff08\u7ed1\u5b9a\u4e86\u8fd9\u79cd\u5173\u7cfb\uff09\u5c31\u662f\u901a\u8fc7name=\"Log\"\u6765\u5b9e\u73b0\u3002 path(\"login.html\",views.login,name=\"Log\") \u8fd9\u79cd\u5c31\u662f\u53cd\u5411\u89e3\u6790","title":"2.4.1 \u6539\u53d8url"},{"location":"python/django/url/django.reverse_url/#3-python","text":"\u53cd\u5411\u89e3\u6790\u9664\u4e86\u5728html\u7684\u6a21\u677f\u4e2d\u4f7f\u7528\uff0c\u8fd8\u53ef\u4ee5\u5728python\u4e2d\u4f7f\u7528 \u6d4b\u8bd5\u8bbf\u95ee \u5e26\u6709\u6b63\u5219\u7684\u5fc5\u987b\u8981\u4f20\u5165\u53c2\u6570 reverse\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662furls.py\u7684url\u4e2d\u7684name\u3002\u6bd4\u5982\u4e0a\u9762\u7684s_c_2003 y_a","title":"3. \u53cd\u5411\u89e3\u6790 python"},{"location":"python/flask/flask.config/","text":"xshell \u53bb\u9664\u58f0\u97f3 1. \u914d\u7f6e\u6587\u4ef6 \u00b6 flask\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\u662f\u4e00\u4e2aflask.config.Config\u5bf9\u8c61\uff08\u7ee7\u627f\u5b57\u5178\uff09,\u9ed8\u8ba4\u914d\u7f6e\u4e3a\uff1a \u9ed8\u8ba4\u914d\u7f6e { 'DEBUG' : get_debug_flag ( default = False ), \u662f\u5426\u5f00\u542f Debug\u6a21\u5f0f 'TESTING' : False , \u662f\u5426\u5f00\u542f\u6d4b\u8bd5\u6a21\u5f0f 'PROPAGATE_EXCEPTIONS' : None , 'PRESERVE_CONTEXT_ON_EXCEPTION' : None , 'SECRET_KEY' : None , 'PERMANENT_SESSION_LIFETIME' : timedelta ( days = 31 ), 'USE_X_SENDFILE' : False , 'LOGGER_NAME' : None , 'LOGGER_HANDLER_POLICY' : 'always' , 'SERVER_NAME' : None , 'APPLICATION_ROOT' : None , 'SESSION_COOKIE_NAME' : 'session' , 'SESSION_COOKIE_DOMAIN' : None , 'SESSION_COOKIE_PATH' : None , 'SESSION_COOKIE_HTTPONLY' : True , 'SESSION_COOKIE_SECURE' : False , 'SESSION_REFRESH_EACH_REQUEST' : True , 'MAX_CONTENT_LENGTH' : None , 'SEND_FILE_MAX_AGE_DEFAULT' : timedelta ( hours = 12 ), 'TRAP_BAD_REQUEST_ERRORS' : False , 'TRAP_HTTP_EXCEPTIONS' : False , 'EXPLAIN_TEMPLATE_LOADING' : False , 'PREFERRED_URL_SCHEME' : 'http' , 'JSON_AS_ASCII' : True , 'JSON_SORT_KEYS' : True , 'JSONIFY_PRETTYPRINT_REGULAR' : True , 'JSONIFY_MIMETYPE' : 'application/json' , 'TEMPLATES_AUTO_RELOAD' : None , } 2. \u914d\u7f6e\u5f15\u8fdb\u65b9\u5f0f \u00b6 2.1 \u65b9\u5f0f1 . \u00b6 app.debug = True 2.2 \u65b9\u5f0f2 [] \u00b6 app.config[debug] = True 2.3 \u65b9\u5f0f3 \u6587\u4ef6 \u00b6 root@leco:~/code/flask/code# cat settings.py DEBUG = True app.py app.config.from_pyfile('settings.py', silent=True) 2.4 \u65b9\u5f0f4 OBJECT \u63a8\u8350 \u00b6 settings.py class Config(object): DEBUG = False TESTING = False DATABASE_URI = 'sqlite://:memory:' class ProductionConfig(Config): DATABASE_URI = 'mysql://user@localhost/foo' class DevelopmentConfig(Config): DEBUG = True class TestingConfig(Config): TESTING = True app.py app.config.from_object('settings.DevelopmentConfig') flask\u914d\u7f6e\u6587\u4ef6-\u53c2\u8003","title":"2. \u914d\u7f6e"},{"location":"python/flask/flask.config/#1","text":"flask\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\u662f\u4e00\u4e2aflask.config.Config\u5bf9\u8c61\uff08\u7ee7\u627f\u5b57\u5178\uff09,\u9ed8\u8ba4\u914d\u7f6e\u4e3a\uff1a \u9ed8\u8ba4\u914d\u7f6e { 'DEBUG' : get_debug_flag ( default = False ), \u662f\u5426\u5f00\u542f Debug\u6a21\u5f0f 'TESTING' : False , \u662f\u5426\u5f00\u542f\u6d4b\u8bd5\u6a21\u5f0f 'PROPAGATE_EXCEPTIONS' : None , 'PRESERVE_CONTEXT_ON_EXCEPTION' : None , 'SECRET_KEY' : None , 'PERMANENT_SESSION_LIFETIME' : timedelta ( days = 31 ), 'USE_X_SENDFILE' : False , 'LOGGER_NAME' : None , 'LOGGER_HANDLER_POLICY' : 'always' , 'SERVER_NAME' : None , 'APPLICATION_ROOT' : None , 'SESSION_COOKIE_NAME' : 'session' , 'SESSION_COOKIE_DOMAIN' : None , 'SESSION_COOKIE_PATH' : None , 'SESSION_COOKIE_HTTPONLY' : True , 'SESSION_COOKIE_SECURE' : False , 'SESSION_REFRESH_EACH_REQUEST' : True , 'MAX_CONTENT_LENGTH' : None , 'SEND_FILE_MAX_AGE_DEFAULT' : timedelta ( hours = 12 ), 'TRAP_BAD_REQUEST_ERRORS' : False , 'TRAP_HTTP_EXCEPTIONS' : False , 'EXPLAIN_TEMPLATE_LOADING' : False , 'PREFERRED_URL_SCHEME' : 'http' , 'JSON_AS_ASCII' : True , 'JSON_SORT_KEYS' : True , 'JSONIFY_PRETTYPRINT_REGULAR' : True , 'JSONIFY_MIMETYPE' : 'application/json' , 'TEMPLATES_AUTO_RELOAD' : None , }","title":"1. \u914d\u7f6e\u6587\u4ef6"},{"location":"python/flask/flask.config/#2","text":"","title":"2. \u914d\u7f6e\u5f15\u8fdb\u65b9\u5f0f"},{"location":"python/flask/flask.config/#21-1","text":"app.debug = True","title":"2.1 \u65b9\u5f0f1 ."},{"location":"python/flask/flask.config/#22-2","text":"app.config[debug] = True","title":"2.2 \u65b9\u5f0f2 []"},{"location":"python/flask/flask.config/#23-3","text":"root@leco:~/code/flask/code# cat settings.py DEBUG = True app.py app.config.from_pyfile('settings.py', silent=True)","title":"2.3 \u65b9\u5f0f3 \u6587\u4ef6"},{"location":"python/flask/flask.config/#24-4-object","text":"settings.py class Config(object): DEBUG = False TESTING = False DATABASE_URI = 'sqlite://:memory:' class ProductionConfig(Config): DATABASE_URI = 'mysql://user@localhost/foo' class DevelopmentConfig(Config): DEBUG = True class TestingConfig(Config): TESTING = True app.py app.config.from_object('settings.DevelopmentConfig') flask\u914d\u7f6e\u6587\u4ef6-\u53c2\u8003","title":"2.4 \u65b9\u5f0f4 OBJECT \u63a8\u8350"},{"location":"python/flask/flask.index/","text":"Flask \u7b80\u4ecb 1. \u5199\u5728\u5f00\u59cb \u00b6 \u73b0\u5728\u662f 2019/3/3 0:02 \u5206\u3002 \u5199\u5728\u5f00\u59cb\u3002\u751f\u6d3b\u867d\u7136\u4e00\u5730\u9e21\u6bdb\uff0c\u4f46\u662f\u4f9d\u7136\u8981\u6b22\u6b4c\u9ad8\u8fdb\uff0c\u6210\u957f\u4e4b\u8def\u867d\u7136\u6709\u73ab\u7470\u6709\u8346\u68d8\uff0c\u4f46\u4ec0\u4e48\u90fd\u4e0d\u80fd\u963b\u6321\u575a\u5f3a\u7684\u5fc3\u3002\u4f60\u6240\u6709\u90a3\u4e9b\u4e0d\u4e3a\u4eba\u77e5\u7684\u52aa\u529b\uff0c\u90fd\u88ab\u65c1\u4eba\u79f0\u4e4b\u4e3a\uff1a\u5e78\u8fd0\u3002 1. \u4ecb\u7ecd \u00b6 Flask\u662f\u4e00\u4e2a\u57fa\u4e8ePython\u5b9e\u73b0\u7684web\u5f00\u53d1\u7684'\u5fae'\u6846\u67b6\u3002 \u4e2d\u6587\u7684\u5b98\u7f51\uff1a http://docs.jinkan.org/docs/flask/ Flask\u548cDjango\u4e00\u6837\uff0c\u4e5f\u662f\u4e00\u4e2a\u57fa\u4e8eMVC\u8bbe\u8ba1\u6a21\u5f0f\u7684Web\u6846\u67b6 a\uff09\u6709\u975e\u5e38\u9f50\u5168\u7684\u5b98\u65b9\u6587\u6863\uff0c\u4e0a\u624b\u975e\u5e38\u65b9\u4fbf b) \u6709\u975e\u5e38\u597d\u7684\u62d3\u5c55\u673a\u5236\u548c\u7b2c\u4e09\u65b9\u7684\u62d3\u5c55\u73af\u5883\uff0c\u5de5\u4f5c\u4e2d\u5e38\u89c1\u7684\u8f6f\u4ef6\u90fd\u6709\u5bf9\u5e94\u7684\u62d3\u5c55\uff0c\u81ea\u5df1\u52a8\u624b\u5b9e\u73b0\u62d3\u5c55\u4e5f\u5f88\u5bb9\u6613 c) \u5fae\u578b\u6846\u67b6\u7684\u5f62\u5f0f\u7ed9\u4e86\u5f00\u53d1\u8005\u66f4\u5927\u7684\u9009\u62e9\u7a7a\u95f4 2. \u5b89\u88c5Flask \u00b6 pip install flask 3. \u521b\u5efa\u4e00\u4e2aFlask\u9879\u76ee \u00b6 \u521b\u5efa\u4e00\u4e2aapp.py\u6587\u4ef6(\u6587\u4ef6\u540d\u4f60\u60f3\u8d77\u5565\u5c31\u8d77\u5565) root@leco:~/code/flask# cat demo.py from flask import Flask # \u5bfc\u5165Flask\u5305 app = Flask(__name__) # \u83b7\u53d6Flask\u5bf9\u8c61\uff0c\u4ee5\u5f53\u524d\u6a21\u5757\u540d\u4e3a\u53c2\u6570 # \u8def\u7531\u9ed8\u8ba4\u4e3a\uff08127.0.0.1:5000\uff09 @app.route('/') # \u88c5\u9970\u5668\u5bf9\u8be5\u65b9\u6cd5\u8fdb\u884c\u8def\u7531\u8bbe\u7f6e\uff0c\u8bf7\u6c42\u7684\u5730\u5740 def hello_world(): # \u65b9\u6cd5\u540d\u79f0 return 'Hello World!' # \u8fd4\u56de\u54cd\u5e94\u7684\u5185\u5bb9 if __name__ == '__main__': app.run('0.0.0.0',7000,debug=True) \u6ce8\u610f 1. \u8def\u7531\uff0c\u5c31\u662f\u4f60\u8bbf\u95ee\u7684url\u5730\u5740\uff0c\u90a3\u90e8\u5206\uff0c\u4f60\u8981\u662f\u5b66\u8fc7django\uff0c\u90a3\u4f60\u5c31\u5f88\u597d\u7684\u7406\u89e3\u4e86\u8def\u7531\uff0c\u6211\u7b80\u5355\u7684\u63cf\u8ff0\u4e00\u4e0b\u3002\u6bd4\u5982\u4f60\u8bbf\u95eewww.xxx.com/test\uff0c \u540e\u53f0\u6536\u5230\u4f60\u8fd9\u6837\u7684\u8bf7\u6c42\u540e\uff0c\u8fdb\u5165\u4e86\u5bf9\u4e8e\u7684\u89c6\u56fe\u51fd\u6570\u4e2d\uff0c\u7136\u540e\u5904\u7406\u4f60\u8fd9\u4e2a\u8bf7\u6c42\uff0c\u8fd4\u56de\u6570\u636e\u6216\u8005\u76f4\u63a5\u663e\u793a\u4ec0\u4e48\u3002 2. Flask\u7684\u8def\u7531\u662froute \u88c5\u9970\u5668\u88c5\u9970\u7684 3. app.run\u7684\u53c2\u6570app.run('0.0.0.0',7000,debug=True) \u7b49\u4e8e app.run(host='0.0.0.0',port=7000,debug=True) 1. host \u6307\u5b9a\u8bbf\u95ee\u4e3b\u673a\uff0c\u56db\u4e2a0\u8868\u793a\u4e0d\u9650\u5236\u6765\u8bbf\u7684IP 2. port \u914d\u7f6eflask\u76d1\u542c\u7684\u7aef\u53e3\u662f7000\uff0c\u9ed8\u8ba4\u662f5000 3. debug=True \u8868\u793a\u4fee\u6539\u4ee3\u7801\u7684\u65f6\u5019\u3002\u4f1a\u81ea\u52a8\u52a0\u8f7d\u3002 1. app.debug = True \u7b49\u4ef7\u4e8e app.run(debug=True) 4. \u8fd0\u884c \u00b6 \u901a\u8fc7python \u6267\u884capp.py\u6587\u4ef6 python app.py \u670d\u52a1\u4f1a\u9ed8\u8ba4\u7684\u8d77\u5728127.0.0.1:5000,\u4f46\u662f\u6211\u4eec\u4fee\u6539\u4e86\u542f\u52a8\u53c2\u6570\uff0c\u6240\u4ee5\u4f1a\u542f\u52a8\u5728 http://0.0.0.0:7000/ root@leco:~/code/flask# python demo.py * Running on http://0.0.0.0:7000/ (Press CTRL+C to quit) * Restarting with stat * Debugger is active! * Debugger PIN: 231-067-023 \u73b0\u5728\u8bbf\u95ee http://192.168.5.110:7000/ \uff0c\u4f60\u4f1a\u770b\u89c1 Hello World \u95ee\u5019\u3002\u6d4f\u89c8\u5668\u8bbf\u95ee\u5982\u4e0b\u663e\u793a: \u90a3\u4e48\uff0c\u8fd9\u6bb5\u4ee3\u7801\u505a\u4e86\u4ec0\u4e48\uff1f \u9996\u5148\uff0c\u6211\u4eec\u5bfc\u5165\u4e86 Flask \u7c7b\u3002\u8fd9\u4e2a\u7c7b\u7684\u5b9e\u4f8b\u5c06\u4f1a\u662f\u6211\u4eec\u7684 WSGI \u5e94\u7528\u7a0b\u5e8f\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u8be5\u7c7b\u7684\u5b9e\u4f8b\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u5e94\u7528\u6a21\u5757\u6216\u8005\u5305\u7684\u540d\u79f0\u3002 \u5982\u679c\u4f60\u4f7f\u7528\u5355\u4e00\u7684\u6a21\u5757\uff08\u5982\u672c\u4f8b\uff09\uff0c\u4f60\u5e94\u8be5\u4f7f\u7528 name \uff0c\u56e0\u4e3a\u6a21\u5757\u7684\u540d\u79f0\u5c06\u4f1a\u56e0\u5176\u4f5c\u4e3a\u5355\u72ec\u5e94\u7528\u542f\u52a8\u8fd8\u662f\u4f5c\u4e3a\u6a21\u5757\u5bfc\u5165\u800c\u6709\u4e0d\u540c\uff08 \u4e5f\u5373\u662f ' main ' \u6216\u5b9e\u9645\u7684\u5bfc\u5165\u540d\uff09\u3002\u8fd9\u662f\u5fc5\u987b\u7684\uff0c\u8fd9\u6837 Flask \u624d\u77e5\u9053\u5230\u54ea\u53bb\u627e\u6a21\u677f\u3001\u9759\u6001\u6587\u4ef6\u7b49\u7b49\u3002\u8be6\u60c5\u89c1 Flask \u7684\u6587\u6863\u3002 \u7136\u540e\uff0c\u6211\u4eec\u4f7f\u7528 route() \u88c5\u9970\u5668\u544a\u8bc9 Flask \u4ec0\u4e48\u6837\u7684URL \u80fd\u89e6\u53d1\u6211\u4eec\u7684\u51fd\u6570\u3002 \u8fd9\u4e2a\u51fd\u6570\u7684\u540d\u5b57\u4e5f\u5728\u751f\u6210 URL \u65f6\u88ab\u7279\u5b9a\u7684\u51fd\u6570\u91c7\u7528\uff0c\u8fd9\u4e2a\u51fd\u6570\u8fd4\u56de\u6211\u4eec\u60f3\u8981\u663e\u793a\u5728\u7528\u6237\u6d4f\u89c8\u5668\u4e2d\u7684\u4fe1\u606f\u3002 \u6700\u540e\u6211\u4eec\u7528 run() \u51fd\u6570\u6765\u8ba9\u5e94\u7528\u8fd0\u884c\u5728\u672c\u5730\u670d\u52a1\u5668\u4e0a\u3002 \u5176\u4e2d if name == ' main ': \u786e\u4fdd\u670d\u52a1\u5668\u53ea\u4f1a\u5728\u8be5\u811a\u672c\u88ab Python \u89e3\u91ca\u5668\u76f4\u63a5\u6267\u884c\u7684\u65f6\u5019\u624d\u4f1a\u8fd0\u884c\uff0c\u800c\u4e0d\u662f\u4f5c\u4e3a\u6a21\u5757\u5bfc\u5165\u7684\u65f6\u5019\u3002","title":"1. \u7b80\u4ecb"},{"location":"python/flask/flask.index/#1","text":"\u73b0\u5728\u662f 2019/3/3 0:02 \u5206\u3002 \u5199\u5728\u5f00\u59cb\u3002\u751f\u6d3b\u867d\u7136\u4e00\u5730\u9e21\u6bdb\uff0c\u4f46\u662f\u4f9d\u7136\u8981\u6b22\u6b4c\u9ad8\u8fdb\uff0c\u6210\u957f\u4e4b\u8def\u867d\u7136\u6709\u73ab\u7470\u6709\u8346\u68d8\uff0c\u4f46\u4ec0\u4e48\u90fd\u4e0d\u80fd\u963b\u6321\u575a\u5f3a\u7684\u5fc3\u3002\u4f60\u6240\u6709\u90a3\u4e9b\u4e0d\u4e3a\u4eba\u77e5\u7684\u52aa\u529b\uff0c\u90fd\u88ab\u65c1\u4eba\u79f0\u4e4b\u4e3a\uff1a\u5e78\u8fd0\u3002","title":"1. \u5199\u5728\u5f00\u59cb"},{"location":"python/flask/flask.index/#1_1","text":"Flask\u662f\u4e00\u4e2a\u57fa\u4e8ePython\u5b9e\u73b0\u7684web\u5f00\u53d1\u7684'\u5fae'\u6846\u67b6\u3002 \u4e2d\u6587\u7684\u5b98\u7f51\uff1a http://docs.jinkan.org/docs/flask/ Flask\u548cDjango\u4e00\u6837\uff0c\u4e5f\u662f\u4e00\u4e2a\u57fa\u4e8eMVC\u8bbe\u8ba1\u6a21\u5f0f\u7684Web\u6846\u67b6 a\uff09\u6709\u975e\u5e38\u9f50\u5168\u7684\u5b98\u65b9\u6587\u6863\uff0c\u4e0a\u624b\u975e\u5e38\u65b9\u4fbf b) \u6709\u975e\u5e38\u597d\u7684\u62d3\u5c55\u673a\u5236\u548c\u7b2c\u4e09\u65b9\u7684\u62d3\u5c55\u73af\u5883\uff0c\u5de5\u4f5c\u4e2d\u5e38\u89c1\u7684\u8f6f\u4ef6\u90fd\u6709\u5bf9\u5e94\u7684\u62d3\u5c55\uff0c\u81ea\u5df1\u52a8\u624b\u5b9e\u73b0\u62d3\u5c55\u4e5f\u5f88\u5bb9\u6613 c) \u5fae\u578b\u6846\u67b6\u7684\u5f62\u5f0f\u7ed9\u4e86\u5f00\u53d1\u8005\u66f4\u5927\u7684\u9009\u62e9\u7a7a\u95f4","title":"1. \u4ecb\u7ecd"},{"location":"python/flask/flask.index/#2-flask","text":"pip install flask","title":"2. \u5b89\u88c5Flask"},{"location":"python/flask/flask.index/#3-flask","text":"\u521b\u5efa\u4e00\u4e2aapp.py\u6587\u4ef6(\u6587\u4ef6\u540d\u4f60\u60f3\u8d77\u5565\u5c31\u8d77\u5565) root@leco:~/code/flask# cat demo.py from flask import Flask # \u5bfc\u5165Flask\u5305 app = Flask(__name__) # \u83b7\u53d6Flask\u5bf9\u8c61\uff0c\u4ee5\u5f53\u524d\u6a21\u5757\u540d\u4e3a\u53c2\u6570 # \u8def\u7531\u9ed8\u8ba4\u4e3a\uff08127.0.0.1:5000\uff09 @app.route('/') # \u88c5\u9970\u5668\u5bf9\u8be5\u65b9\u6cd5\u8fdb\u884c\u8def\u7531\u8bbe\u7f6e\uff0c\u8bf7\u6c42\u7684\u5730\u5740 def hello_world(): # \u65b9\u6cd5\u540d\u79f0 return 'Hello World!' # \u8fd4\u56de\u54cd\u5e94\u7684\u5185\u5bb9 if __name__ == '__main__': app.run('0.0.0.0',7000,debug=True) \u6ce8\u610f 1. \u8def\u7531\uff0c\u5c31\u662f\u4f60\u8bbf\u95ee\u7684url\u5730\u5740\uff0c\u90a3\u90e8\u5206\uff0c\u4f60\u8981\u662f\u5b66\u8fc7django\uff0c\u90a3\u4f60\u5c31\u5f88\u597d\u7684\u7406\u89e3\u4e86\u8def\u7531\uff0c\u6211\u7b80\u5355\u7684\u63cf\u8ff0\u4e00\u4e0b\u3002\u6bd4\u5982\u4f60\u8bbf\u95eewww.xxx.com/test\uff0c \u540e\u53f0\u6536\u5230\u4f60\u8fd9\u6837\u7684\u8bf7\u6c42\u540e\uff0c\u8fdb\u5165\u4e86\u5bf9\u4e8e\u7684\u89c6\u56fe\u51fd\u6570\u4e2d\uff0c\u7136\u540e\u5904\u7406\u4f60\u8fd9\u4e2a\u8bf7\u6c42\uff0c\u8fd4\u56de\u6570\u636e\u6216\u8005\u76f4\u63a5\u663e\u793a\u4ec0\u4e48\u3002 2. Flask\u7684\u8def\u7531\u662froute \u88c5\u9970\u5668\u88c5\u9970\u7684 3. app.run\u7684\u53c2\u6570app.run('0.0.0.0',7000,debug=True) \u7b49\u4e8e app.run(host='0.0.0.0',port=7000,debug=True) 1. host \u6307\u5b9a\u8bbf\u95ee\u4e3b\u673a\uff0c\u56db\u4e2a0\u8868\u793a\u4e0d\u9650\u5236\u6765\u8bbf\u7684IP 2. port \u914d\u7f6eflask\u76d1\u542c\u7684\u7aef\u53e3\u662f7000\uff0c\u9ed8\u8ba4\u662f5000 3. debug=True \u8868\u793a\u4fee\u6539\u4ee3\u7801\u7684\u65f6\u5019\u3002\u4f1a\u81ea\u52a8\u52a0\u8f7d\u3002 1. app.debug = True \u7b49\u4ef7\u4e8e app.run(debug=True)","title":"3. \u521b\u5efa\u4e00\u4e2aFlask\u9879\u76ee"},{"location":"python/flask/flask.index/#4","text":"\u901a\u8fc7python \u6267\u884capp.py\u6587\u4ef6 python app.py \u670d\u52a1\u4f1a\u9ed8\u8ba4\u7684\u8d77\u5728127.0.0.1:5000,\u4f46\u662f\u6211\u4eec\u4fee\u6539\u4e86\u542f\u52a8\u53c2\u6570\uff0c\u6240\u4ee5\u4f1a\u542f\u52a8\u5728 http://0.0.0.0:7000/ root@leco:~/code/flask# python demo.py * Running on http://0.0.0.0:7000/ (Press CTRL+C to quit) * Restarting with stat * Debugger is active! * Debugger PIN: 231-067-023 \u73b0\u5728\u8bbf\u95ee http://192.168.5.110:7000/ \uff0c\u4f60\u4f1a\u770b\u89c1 Hello World \u95ee\u5019\u3002\u6d4f\u89c8\u5668\u8bbf\u95ee\u5982\u4e0b\u663e\u793a: \u90a3\u4e48\uff0c\u8fd9\u6bb5\u4ee3\u7801\u505a\u4e86\u4ec0\u4e48\uff1f \u9996\u5148\uff0c\u6211\u4eec\u5bfc\u5165\u4e86 Flask \u7c7b\u3002\u8fd9\u4e2a\u7c7b\u7684\u5b9e\u4f8b\u5c06\u4f1a\u662f\u6211\u4eec\u7684 WSGI \u5e94\u7528\u7a0b\u5e8f\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u8be5\u7c7b\u7684\u5b9e\u4f8b\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u5e94\u7528\u6a21\u5757\u6216\u8005\u5305\u7684\u540d\u79f0\u3002 \u5982\u679c\u4f60\u4f7f\u7528\u5355\u4e00\u7684\u6a21\u5757\uff08\u5982\u672c\u4f8b\uff09\uff0c\u4f60\u5e94\u8be5\u4f7f\u7528 name \uff0c\u56e0\u4e3a\u6a21\u5757\u7684\u540d\u79f0\u5c06\u4f1a\u56e0\u5176\u4f5c\u4e3a\u5355\u72ec\u5e94\u7528\u542f\u52a8\u8fd8\u662f\u4f5c\u4e3a\u6a21\u5757\u5bfc\u5165\u800c\u6709\u4e0d\u540c\uff08 \u4e5f\u5373\u662f ' main ' \u6216\u5b9e\u9645\u7684\u5bfc\u5165\u540d\uff09\u3002\u8fd9\u662f\u5fc5\u987b\u7684\uff0c\u8fd9\u6837 Flask \u624d\u77e5\u9053\u5230\u54ea\u53bb\u627e\u6a21\u677f\u3001\u9759\u6001\u6587\u4ef6\u7b49\u7b49\u3002\u8be6\u60c5\u89c1 Flask \u7684\u6587\u6863\u3002 \u7136\u540e\uff0c\u6211\u4eec\u4f7f\u7528 route() \u88c5\u9970\u5668\u544a\u8bc9 Flask \u4ec0\u4e48\u6837\u7684URL \u80fd\u89e6\u53d1\u6211\u4eec\u7684\u51fd\u6570\u3002 \u8fd9\u4e2a\u51fd\u6570\u7684\u540d\u5b57\u4e5f\u5728\u751f\u6210 URL \u65f6\u88ab\u7279\u5b9a\u7684\u51fd\u6570\u91c7\u7528\uff0c\u8fd9\u4e2a\u51fd\u6570\u8fd4\u56de\u6211\u4eec\u60f3\u8981\u663e\u793a\u5728\u7528\u6237\u6d4f\u89c8\u5668\u4e2d\u7684\u4fe1\u606f\u3002 \u6700\u540e\u6211\u4eec\u7528 run() \u51fd\u6570\u6765\u8ba9\u5e94\u7528\u8fd0\u884c\u5728\u672c\u5730\u670d\u52a1\u5668\u4e0a\u3002 \u5176\u4e2d if name == ' main ': \u786e\u4fdd\u670d\u52a1\u5668\u53ea\u4f1a\u5728\u8be5\u811a\u672c\u88ab Python \u89e3\u91ca\u5668\u76f4\u63a5\u6267\u884c\u7684\u65f6\u5019\u624d\u4f1a\u8fd0\u884c\uff0c\u800c\u4e0d\u662f\u4f5c\u4e3a\u6a21\u5757\u5bfc\u5165\u7684\u65f6\u5019\u3002","title":"4. \u8fd0\u884c"},{"location":"python/flask/flask.jinja2/","text":"Jinja2 \u6a21\u677f 1. \u4ecb\u7ecd \u00b6 Jinja2\u662fPython\u6700\u5e38\u7528\u7684\u6a21\u677f\u5f15\u64ce\u4e4b\u4e00\u3002\u5b83\u7684\u7075\u611f\u6765\u81eaDjango\u7684\u6a21\u677f\u7cfb\u7edf\uff0c\u4f46\u5b83\u7528\u4e00\u79cd\u5bcc\u6709\u8868\u73b0\u529b\u7684\u8bed\u8a00\u6269\u5c55\u5b83\uff0c\u4e3a\u6a21\u677f\u4f5c\u8005\u63d0\u4f9b\u4e86\u4e00\u5957\u66f4\u5f3a\u5927\u7684\u5de5\u5177\u3002\u6700\u91cd\u8981\u7684\u662f\uff0c\u5b83\u4e3a\u5b89\u5168\u6027\u5f88\u91cd\u8981\u7684\u5e94\u7528\u7a0b\u5e8f\u6dfb\u52a0\u4e86\u6c99\u76d2\u6267\u884c\u548c\u53ef\u9009\u7684\u81ea\u52a8\u8f6c\u4e49\u3002\u5148\u6765\u4e00\u4e2a\u6f02\u4eae\u7684\u4f8b\u5b50 {\uff05extends \"layout.html\"\uff05} {\uff05block body\uff05} <UL> {\uff05for user in users\uff05} <li> <a href=\"{{ user.url }}\"> {{user.username}} </a> </ li> {\uff05endfor\uff05} </ UL> {\uff05endblock\uff05} \u89e3\u91ca 1. extends \u662f\u8be5\u9875\u9762\u7ee7\u627f\u4e86 layout . html 2. block body \u662f\u91cd\u5199\u4e86 layout . html\u4e2d\u7684body\u8fd9\u4e2a\u90e8\u5206 3. for user in users \u662f\u540e\u7aef\u7684\u7a7f\u8fc7\u6765\u7684 users\u8fdb\u884c\u904d\u5386 4. {{ user . url }} \u662f\u53d6\u503c 5. \u4e0b\u9762\u4f1a\u4e00\u4e00\u8be6\u89e3 \u53c2\u8003\u94fe\u63a5 \u5728\u524d\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u89c6\u56fe\u51fd\u6570\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u751f\u6210\u8bf7\u6c42\u7684\u54cd\u5e94\uff0c\u4e3b\u8981\u662f\u7b80\u5355\u7684\u8bf7\u6c42\uff0c\u5b9e\u9645\u4e0a\uff0c \u89c6\u56fe\u51fd\u6570\u6709\u4e24\u4e2a\u4f5c\u7528\uff0c\u5904\u7406\u4e1a\u52a1\u903b\u8f91\u548c\u8fd4\u56de\u54cd\u5e94\u5185\u5bb9\uff0c\u5728\u5927\u578b\u5e94\u7528\u4e2d\uff0c\u628a\u4e1a\u52a1\u903b\u8f91\u548c\u8868\u73b0\u5185\u5bb9\u653e\u5728\u4e00\u8d77\uff0c\u4f1a\u589e\u52a0\u4ee3\u7801\u7684\u590d\u6742\u5ea6\u548c\u7ef4\u62a4\u6210\u672c\uff0c\u6a21\u677f\uff0c\u5b83\u7684\u4f5c\u7528\uff0c\u5373\u8fd4\u56de\u54cd\u5e94\u7684\u5185\u5bb9\u3002 \u6a21\u677f\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u5305\u542b\u54cd\u5e94\u6587\u672c\u7684\u6587\u4ef6\uff0c\u671f\u4e2d\u7ad9\u4f4d\u7b26(\u53d8\u91cf)\u8868\u793a\u52a8\u6001\u90e8\u5206\u3002\u544a\u8bc9\u6a21\u677f\u5f15\u64ce\u5176\u5177\u4f53\u7684\u503c\u9700\u8981\u4ece\u4f7f\u7528\u7684\u6570\u636e\u4e2d\u83b7\u53d6\u3002 \u4f7f\u7528\u771f\u5b9e\u503c\u66ff\u6362\u53d8\u91cf\uff0c\u5728\u8fd4\u56de\u6700\u7ec8\u5f97\u5230\u7684\u5b57\u7b26\u4e32\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a\u6e32\u67d3\u3002 Flask\u662f\u4f7f\u7528Jinja2\u8fd9\u4e2a\u6a21\u677f\u5f15\u64ce\u6765\u6e32\u67d3\u6a21\u677f\u3002 \u4f7f\u7528\u6a21\u677f\u7684\u597d\u5904: \u89c6\u56fe\u51fd\u6570\u53ea\u8d1f\u8d23\u4e1a\u52a1\u903b\u8f91\u548c\u6570\u636e\u5904\u7406(\u4e1a\u52a1\u903b\u8f91\u65b9\u9762) \u6a21\u677f\u5219\u53d6\u5230\u89c6\u56fe\u51fd\u6570\u7684\u6570\u636e\u7ed3\u679c\u8fdb\u884c\u5c55\u793a\u3002\u89c6\u56fe\u5c55\u793a\u65b9\u9762 \u4ee3\u7801\u7ed3\u6784\u6e05\u6670\uff0c\u8026\u5408\u5ea6\u4f4e 2. \u8fd4\u56de\u6a21\u677f \u00b6 2.1 render_template \u65e0\u53c2 \u00b6 \u6211\u4eec\u4e4b\u524d\u5199\u7684\u90fd\u662f\u8fd4\u56dehello \u8fd9\u6837\u7b80\u5355\u7684\u5b57\u7b26\u4e32\u4e4b\u7c7b\u7684\u3002\u5982\u4f55\u8fd4\u56de\u4e00\u4e2ahtml\u5462\uff0c\u9996\u5148\u6211\u4eec\u5728templates\u6587\u4ef6\u5939\u5185\u5efa\u7acb\u4e00\u4e2ahtml\u6587\u4ef6\u3002 \u7136\u540ereturn\u7684\u65f6\u5019\u8c03\u7528 render_template('login.html') ,\u8fd9\u6837\u5c31\u53ef\u4ee5\u5427login.html\u5185\u5bb9\u8fd4\u56de, render_template \u51fd\u6570\u4f1a\u81ea\u52a8\u5728templates\u6587\u4ef6\u5939\u4e2d\u627e\u5230\u5bf9\u5e94\u7684h\u3002\u4ee3\u7801\u5982\u4e0b\uff1a root@leco:~/code/flask/code# ls app.py templates root@leco:~/code/flask/code# tree . . \u251c\u2500\u2500 app.py \u2514\u2500\u2500 templates \u2514\u2500\u2500 login.html 1 directory, 2 files root@leco:~/code/flask/code# cat app.py #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/3/5 13:41 @File : app.py @Software: PyCharm \"\"\" from flask import Flask, render_template, redirect,request app = Flask(__name__) @app.route('/') def hello_world(): return 'Hello World!' @app.route('/hello') def hello(): return 'Hello!' @app.route('/login', methods=['GET', 'POST']) def login(): return render_template('login.html') @app.route('/home') def home(): return redirect('/login') if __name__ == '__main__': app.run(host='0.0.0.0', port=9527, debug=True) root@leco:~/code/flask/code# cat templates/login.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>\u767b\u5f55\u9875\u9762</h1> </form> </body> </html> \u8fd0\u884c\u6d4b\u8bd5 root@leco:~/code/flask/code# python app.py * Running on http://0.0.0.0:9527/ (Press CTRL+C to quit) * Restarting with stat * Debugger is active! * Debugger PIN: 231-067-023 \u6b64\u65f6\u6211\u4eec\u8bbf\u95ee root@leco:~/book/books/docs/python/flask# curl 127.0.0.1:9527/login <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>\u767b\u5f55\u9875\u9762</h1> </form> </body> \u6b64\u65f6\u8fd4\u56de\u4e86 login.html \u7684\u9875\u9762\u5185\u5bb9\u3002\u4f46\u662f\u9875\u9762\u662f\u56fa\u5b9a\u5185\u5bb9\uff0c\u600e\u4e48\u505a\u5230\u540e\u7aef\u7684\u5185\u5bb9\u4f20\u9012\u7ed9\u524d\u7aef\u9875\u9762\u5462\u3002\u8bf7\u7ee7\u7eed\u3002 2.2 render_template \u6709\u53c2 \u00b6 \u4e0a\u4e00\u5c0f\u7ae0\u8282\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 render_template \u8fd4\u56dehtml\u5185\u5bb9\uff0c\u4f46\u662f\u6ca1\u4f20\u9012\u53c2\u6570\u7ed9\u524d\u7aef\uff0c\u5176\u5b9e\u6211\u4eec\u5728 render_template \u7684\u65f6\u5019\u662f\u53ef\u4ee5\u4f20\u9012\u53c2\u6570\u7684\uff0c\u4ee3\u7801\u4fee\u6539\u5982\u4e0b\uff1a app.py \u4fee\u6539\u7684\u90e8\u5206 @app.route('/login', methods=['GET', 'POST']) def login(): name = \"cmz\" # age = 10 return render_template('login.html',name=name,age=age) # \u4f20\u9012\u4e24\u4e2a\u53c2\u6570 login.html root@leco:~/code/flask/code# cat templates/login.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>\u767b\u5f55\u9875\u9762</h1> {{ name }} - {{ age }} </form> </body> </html> \u6ce8\u610f 1. {{ name }} - {{ age }} \u63a5\u53d7\u4ece\u7236\u4eb2\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570 2. return render_template ( 'login.html' , name = name , age = age ) name = name ------> \u7b49\u53f7\u524d\u9762\u7684 name\u5c31\u662f\u8981\u5728login . html\u4e0a\u8c03\u7528\u7684 \uff0c\u7b49\u53f7\u540e\u9762\u7684 name\u662f\u670d\u52a1\u5668\u8fd9\u8fb9\u4f20\u5165\u7684\u4e5f\u5c31\u662f 'cmz' age \u548c name\u4e00\u6837 3. \u8981\u662f\u670d\u52a1\u5668\u4f20\u5165\u7684\u53c2\u6570\u6bd4\u8f83\u591a\u7684\u60c5\u51b5\u4e0b\u3002\u6211\u4eec\u76f4\u63a5\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u65b9\u6cd5 : return render_template ( 'login.html' , locals ()) ------> \u5728\u524d\u9762\u7684\u9875\u9762\u8c03\u7528\u7684\u4e5f\u6b63\u662f\u8be5\u89c6\u56fe\u51fd\u6570\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570 , \u5176\u5b9e `locals()` \u5c31\u662f\u628a\u89c6\u56fe\u51fd\u6570\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570\u7ec4\u6210 k - v\u4e00\u6837\u7684\u7684\u5b57\u5178\u4f20\u5230\u524d\u7aef 3. \u5177\u4f53\u7528\u6cd5 \u00b6 3.1 \u73af\u5883\u51c6\u5907 \u00b6 \u548cdjango\u7684jinja\u8bed\u6cd5\u4e00\u81f4 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/2/18 13:03 @File : 1.py.py @Software: PyCharm \"\"\" from flask import Flask, render_template, redirect, request app = Flask(__name__) STUDENT = {'name': '\u5f20\u4e09', 'age': 38, 'gender': '\u4e2d'}, STUDENT_LIST = [ {'name': '\u5f20\u4e09', 'age': 38, 'gender': '\u4e2d'}, {'name': '\u674e\u56db', 'age': 73, 'gender': '\u7537'}, {'name': '\u738b\u4e94', 'age': 84, 'gender': '\u5973'} ] STUDENT_DICT = { 1: {'name': '\u5f20\u4e09', 'age': 38, 'gender': '\u4e2d'}, 2: {'name': '\u674e\u56db', 'age': 73, 'gender': '\u7537'}, 3: {'name': '\u738b\u4e94', 'age': 84, 'gender': '\u5973'}, } @app.route('/') def hello_world(): return 'Hello World!' @app.route('/hello') def hello(): return 'Hello!' @app.route('/login',methods=['GET', 'POST']) def login(): # print('\u4f60\u8bbf\u95ee\u4e86login\u51fd\u6570') # print(request.method) # print(request.path) # print(request.headers) # print(request.host) # print(request.host_url) # print(request.full_path) met = request.method if met == 'GET': return render_template('login.html') if met == 'POST': print(\"request.args = \", request.args) print(\"request.data = \", request.data) print(\"request.form = \", request.form) # print(\"request.values = \", request.values) username = request.form.get(\"username\") pwd = request.form.get('pwd') if username=='cc' and pwd=='cc': return '\u767b\u5f55\u6210\u529f' else: return render_template('login.html', msg='\u4f60\u4e2b\u5199\u9519\u4e86') @app.route('/home') def home(): return redirect('/login') @app.route('/detail') def detail(): return render_template('detail.html', stu=STUDENT) @app.route('/detail_list') def detail_list(): return render_template('detail_list.html', stu_list=STUDENT_LIST) @app.route('/detail_dict') def detail_dict(): return render_template('detail_dict.html', stu_dict=STUDENT_DICT) if __name__ == '__main__': app.run(host='0.0.0.0', port=9527, debug=True) # app.run(host='0.0.0.0', debug=True) # wsgi \u5e94\u7528\u7a0b\u5e8f\u7f51\u5173\u63a5\u53e3\uff0c\u628a\u4f60\u7684\u8bf7\u6c42\u5904\u7406\u540e\u53d1\u9001\u7ed9\u5bf9\u4e8e\u7684app\u4e2d # werkzeug Flask\u4f7f\u7528\u7684 3.2 jina2 - \u53e5\u70b9\u53f7 \u00b6 \u5728\u524d\u7aef\u5c55\u793a\u53d6\u503c\u7684\u65f6\u5019\uff0c\u540e\u7aef\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570\uff0c\u6211\u4eec\u90fd\u53ef\u4ee5\u4f7f\u7528\u53e5\u70b9\u53f7\uff0c\u6765\u53d6\u503c\u3002\u4e0d\u7ba1\u540e\u7aef\u4f20\u9012\u8fc7\u6765\u7684\u662f\u5b57\u5178\uff0c\u5217\u8868\uff0c\u8fd8\u662f\u5bf9\u8c61\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7\u53e5\u70b9\u53f7\u53d6\u503c\uff0c \u8bed\u6cd5 \u5217\u8868.\u6570\u503c \u5b57\u5178.\u6570\u503c \u5bf9\u8c61.\u6570\u503c list1 = [1,2,3] dict1 = {1:2,3:4} detail.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>detail</title> </head> <body> <!--{{ stu }}--> {{ stu[0] }} <table border=\"1px\"> <tr> <td>name</td> <td>age</td> <td>gender</td> </tr> <tr> <td>{{ stu[0].name }}</td> <td>{{ stu[0].age }}</td> <td>{{ stu[0]['gender'] }}</td> </tr> </table> </body> </html> \u6d4b\u8bd5\u7ed3\u679c {'name'\uff1a'\u5f20\u4e09'\uff0c'\u5e74\u9f84'\uff1a38\uff0c'\u6027\u522b'\uff1a'\u4e2d'} \u540d\u79f0 \u5e74\u9f84 \u6027\u522b \u5f20\u4e09 38 \u4e2d 3.3 jina2 - for \u00b6 \u540e\u7aef\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u904d\u5386\u8f93\u51fa\u3002 \u8bed\u6cd5 {% for stu in stu_list %} \u4ee3\u7801\u5757 {% endfor %} detail_list.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>detail</title> </head> <body> {{ stu_list }} <table border=\"1px\"> <tr> <td>name</td> <td>age</td> <td>gender</td> </tr> {% for stu in stu_list %} <tr> <td>{{ stu.name }}</td> <td>{{ stu.age }}</td> <td>{{ stu.gender }}</td> </tr> {% endfor %} </table> <p>\u6d4b\u8bd5if</p> <table border=\"1px\"> {% for stu in stu_list %} {% if stu.name != '\u5f20\u4e09' %} <tr> <td>{{ stu.get(\"name\") }}</td> <td>{{ stu.get(\"age\") }}</td> <td>{{ stu.get(\"gender\") }}</td> </tr> {% endif %} {% endfor %} </table> </body> </html> \u6d4b\u8bd5\u7ed3\u679c [{'name'\uff1a'\u5f20\u4e09'\uff0c'\u5e74\u9f84'\uff1a38\uff0c'\u6027\u522b'\uff1a'\u4e2d'}\uff0c{'\u540d\u79f0'\uff1a'\u674e\u56db'\uff0c'\u5e74\u9f84'\uff1a73\uff0c'\u6027\u522b'\uff1a'\u7537'} \uff0c{'name'\uff1a'\u738b\u4e94'\uff0c'\u5e74\u9f84'\uff1a84\uff0c'\u6027\u522b'\uff1a'\u5973'}] \u540d\u79f0 \u5e74\u9f84 \u6027\u522b \u5f20\u4e09 38 \u4e2d \u674e\u56db 73 \u7537 \u738b\u4e94 84 \u5973 \u6d4b\u8bd5\u5982\u679c \u540d\u79f0 \u5e74\u9f84 \u6027\u522b \u674e\u56db 73 \u7537 \u738b\u4e94 84 \u5973 \u4ee5\u4e0a\u4f7f\u7528\u4e86if\u5224\u65ad\uff0c\u5224\u65ad\u975e\u5f20\u4e09\u5c31\u663e\u793a detail_dict.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>detail</title> </head> <body> {{ stu_dict }} <table border=\"1px\"> <tr> <td>id</td> <td>name</td> <td>age</td> <td>gender</td> </tr> {% for id in stu_dict %} <tr> <td>{{ id }}</td> <td>{{ stu_dict.get(id).get(\"name\") }}</td> <td>{{ stu_dict.get(id).get(\"age\") }}</td> <td>{{ stu_dict.get(id).get(\"gender\") }}</td> </tr> {% endfor %} </table> \u6d4b\u8bd5 dict item <table border=\"1px\"> <tr> <td>id</td> <td>name</td> <td>age</td> <td>gender</td> </tr> {% for id,stu in stu_dict.items() %} <tr> <td>{{ id }}</td> <td>{{ stu.get(\"name\") }}</td> <td>{{ stu.get(\"age\") }}</td> <td>{{ stu.get(\"gender\") }}</td> </tr> {% endfor %} </table> </body> </html> \u6d4b\u8bd5\u7ed3\u679c {1\uff1a{'name'\uff1a'\u5f20\u4e09'\uff0c'\u5e74\u9f84'\uff1a38\uff0c'\u6027\u522b'\uff1a'\u4e2d'}\uff0c2\uff1a{'name'\uff1a'\u674e\u56db'\uff0c'\u5e74\u9f84'\uff1a73\uff0c'\u6027\u522b'\uff1a '\u7537'}\uff0c3\uff1a{'name'\uff1a'\u738b\u4e94'\uff0c'\u5e74\u9f84'\uff1a84\uff0c'\u6027\u522b'\uff1a'\u5973'}} ID \u540d\u79f0 \u5e74\u9f84 \u6027\u522b 1 \u5f20\u4e09 38 \u4e2d 2 \u674e\u56db 73 \u7537 3 \u738b\u4e94 84 \u5973 \u6d4b\u8bd5dict\u9879\u76ee ID \u540d\u79f0 \u5e74\u9f84 \u6027\u522b 1 \u5f20\u4e09 38 \u4e2d 2 \u674e\u56db 73 \u7537 3 \u738b\u4e94 84 \u5973 3.4 jina2 - if \u00b6 <table border=\"1px\"> {% for stu in stu_list %} {% if stu.name != '\u5f20\u4e09' %} <tr> <td>{{ stu.get(\"name\") }}</td> <td>{{ stu.get(\"age\") }}</td> <td>{{ stu.get(\"gender\") }}</td> </tr> {% endif %} {% endfor %} </table> 3.5 jina2 - extends \u00b6 \u8bed\u6cd5 {% extends 'hehe.html' %} \u8be5\u9875\u9762\u7ee7\u627f\u4e8ehehe.html hehe.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <p>\u4f60\u597d 123</p> {% block a123 %} {% endblock %} <p>\u4f60\u597d 456</p> {% block a456 %} {% endblock %} <p>\u4f60\u597d 789</p> {% block a789 %} {% endblock %} </body> </html> \u6d4b\u8bd5\u7ed3\u679c \u4f60\u597d123 \u4e00\u4e8c\u4e09 \u4f60\u597d456 \u56db\u4e94\u516d \u4f60\u597d789 \u4e03\u516b\u4e5d \u6211\u662f\u54c8\u54c8\u6a21\u677f 3.6 jina2 - include \u00b6 \u8bed\u6cd5 {% include 'haha.html' %} \u8be5\u5904\u8c03\u7528\u7684haha.html\u7684\u5185\u5bb9 haha.html <h1>\u6211\u662f\u54c8\u54c8\u6a21\u677f</h1> \u6d4b\u8bd5\u7ed3\u679c \u4f60\u597d123 \u4e00\u4e8c\u4e09 \u4f60\u597d456 \u56db\u4e94\u516d \u4f60\u597d789 \u4e03\u516b\u4e5d \u6211\u662f\u54c8\u54c8\u6a21\u677f <------------------- include \u663e\u793a\u7684\u90e8\u5206 3.7 jina2 - \u51fd\u6570 \u00b6 \u540e\u7aef\u6e32\u67d3\u7684\u51fd\u6570\u4f20\u9012\u7ed9\u524d\u7aef\uff0c\u8fd9\u4e2a\u662f\u5c40\u90e8\u7684\uff0c\u8981\u662f\u5168\u5c40\u7684\u8bdd\uff08\u4e5f\u5c31\u662f\u524d\u7aef\u4ec0\u4e48\u9875\u9762\u90fd\u53ef\u4ee5\u8c03\u7528\uff09\u5c31\u662f\u6709template_global def add_sum(*args): return sum(args) \u524d\u7aef\u4f7f\u7528 <p>{{ sum(1,2,3,4,5)}}</p> \u6d4b\u8bd5\u7ed3\u679c 15 3.8 jina2 - safe \u00b6 @app.route('/login',methods=['GET', 'POST']) def login(): # print('\u4f60\u8bbf\u95ee\u4e86login\u51fd\u6570') # print(request.method) # print(request.path) # print(request.headers) # print(request.host) # print(request.host_url) # print(request.full_path) met = request.method if met == 'GET': text_tag = '<p>\u4f60\u5927\u7237\u7684: <input type=\"password\" name=\"pwd\"></p>' text_tag = Markup(text_tag) return render_template('login.html', msg=text_tag, sum=add_sum) if met == 'POST': print(\"request.args = \", request.args) print(\"request.data = \", request.data) print(\"request.form = \", request.form) # print(\"request.values = \", request.values) username = request.form.get(\"username\") pwd = request.form.get('pwd') if username=='cc' and pwd=='cc': return '\u767b\u5f55\u6210\u529f' else: return render_template('login.html', msg='\u4f60\u4e2b\u5199\u9519\u4e86') \u524d\u7aef\u5c55\u793a\u7684\u65f6\u5019\u8c03\u7528text_tag\uff0c\u6211\u4eec\u5728django\u7684\u65f6\u5019\u662f\u4f7f\u7528safe\u5982\u4e0b {{ text_tag| safe }} \u8fd9\u6837\u5c31\u5728\u524d\u7aef\u7684\u65f6\u5019\u663e\u793ainput\u6807\u7b7e\u4e86\uff0c\u5728flask\u4e2d\u53ef\u4ee5\u540e\u7aef\u505a\u5904\u7406\u4e5f\u5c31\u662f\u6709Markup\u3002 \u524d\u7aef\u76f4\u63a5\u4f7f\u7528\u5373\u53ef\uff0c\u5c31\u76f4\u63a5\u6e32\u67d3\u51fainput\u6807\u7b7e\u4e86 {{ text_tag}} 3.9 jina2 - template_global \u00b6 \u540e\u7aef @app.template_global() def add_add(*args): return sum(args) \u524d\u7aef\u8c03\u7528\uff0c\u968f\u4fbf\u54ea\u4e2a\u9875\u9762\u8c03\u7528\uff0c\u8c03\u7528\u5982\u4e0b <p>{{ add_add(1,2,3,4,5)}} </p> 3.10 jina2 - template_filter \u00b6 \u4fd7\u79f0\u8fc7\u6ee4\u5668 # \u8fc7\u6ee4\u5668 @app.template_filter() def oushu(sum): if not sum %2: return \"\u5076\u6570\" else: return \"\u5947\u6570\" \u524d\u7aef\u8c03\u7528 <p> {{ sum(124,4) | oushu }}</p> \u5c06\u524d\u9762sum(124,4)\u7684\u503c\u4f20\u9012\u7ed9oushu\u8fc7\u6ee4\u5668\uff0c\u7ed3\u679c\u662f \u5076\u6570 3.11 jina2 - macro \u00b6 \u5b8f\uff0c\u4f7f\u7528\u7684\u4e0d\u591a\u3002 \u76f4\u63a5\u5728\u524d\u7aef\u9875\u9762\u4e0a\u4f7f\u7528 {# \u610f\u4e49\u4e0d\u5927\u3002\u5b8f\u6307\u4ee4#} {% macro create_tag(na,ty) %} <input type=\"{{ ty }}\" name=\"{{ na }}\" value=\"{{ na }}\"> {% endmacro %} <h1>\u4f60\u5411\u4e0b\u770b</h1> {{ create_tag(\"\u6309\u94ae\",\"submit\") }} \u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u524d\u7aef\u9875\u9762\u4e0a\u521b\u5efa\u4e86\u4e00\u4e2a\u6309\u94ae\u4e86\u3002","title":"5. \u6a21\u677f"},{"location":"python/flask/flask.jinja2/#1","text":"Jinja2\u662fPython\u6700\u5e38\u7528\u7684\u6a21\u677f\u5f15\u64ce\u4e4b\u4e00\u3002\u5b83\u7684\u7075\u611f\u6765\u81eaDjango\u7684\u6a21\u677f\u7cfb\u7edf\uff0c\u4f46\u5b83\u7528\u4e00\u79cd\u5bcc\u6709\u8868\u73b0\u529b\u7684\u8bed\u8a00\u6269\u5c55\u5b83\uff0c\u4e3a\u6a21\u677f\u4f5c\u8005\u63d0\u4f9b\u4e86\u4e00\u5957\u66f4\u5f3a\u5927\u7684\u5de5\u5177\u3002\u6700\u91cd\u8981\u7684\u662f\uff0c\u5b83\u4e3a\u5b89\u5168\u6027\u5f88\u91cd\u8981\u7684\u5e94\u7528\u7a0b\u5e8f\u6dfb\u52a0\u4e86\u6c99\u76d2\u6267\u884c\u548c\u53ef\u9009\u7684\u81ea\u52a8\u8f6c\u4e49\u3002\u5148\u6765\u4e00\u4e2a\u6f02\u4eae\u7684\u4f8b\u5b50 {\uff05extends \"layout.html\"\uff05} {\uff05block body\uff05} <UL> {\uff05for user in users\uff05} <li> <a href=\"{{ user.url }}\"> {{user.username}} </a> </ li> {\uff05endfor\uff05} </ UL> {\uff05endblock\uff05} \u89e3\u91ca 1. extends \u662f\u8be5\u9875\u9762\u7ee7\u627f\u4e86 layout . html 2. block body \u662f\u91cd\u5199\u4e86 layout . html\u4e2d\u7684body\u8fd9\u4e2a\u90e8\u5206 3. for user in users \u662f\u540e\u7aef\u7684\u7a7f\u8fc7\u6765\u7684 users\u8fdb\u884c\u904d\u5386 4. {{ user . url }} \u662f\u53d6\u503c 5. \u4e0b\u9762\u4f1a\u4e00\u4e00\u8be6\u89e3 \u53c2\u8003\u94fe\u63a5 \u5728\u524d\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u89c6\u56fe\u51fd\u6570\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u751f\u6210\u8bf7\u6c42\u7684\u54cd\u5e94\uff0c\u4e3b\u8981\u662f\u7b80\u5355\u7684\u8bf7\u6c42\uff0c\u5b9e\u9645\u4e0a\uff0c \u89c6\u56fe\u51fd\u6570\u6709\u4e24\u4e2a\u4f5c\u7528\uff0c\u5904\u7406\u4e1a\u52a1\u903b\u8f91\u548c\u8fd4\u56de\u54cd\u5e94\u5185\u5bb9\uff0c\u5728\u5927\u578b\u5e94\u7528\u4e2d\uff0c\u628a\u4e1a\u52a1\u903b\u8f91\u548c\u8868\u73b0\u5185\u5bb9\u653e\u5728\u4e00\u8d77\uff0c\u4f1a\u589e\u52a0\u4ee3\u7801\u7684\u590d\u6742\u5ea6\u548c\u7ef4\u62a4\u6210\u672c\uff0c\u6a21\u677f\uff0c\u5b83\u7684\u4f5c\u7528\uff0c\u5373\u8fd4\u56de\u54cd\u5e94\u7684\u5185\u5bb9\u3002 \u6a21\u677f\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u5305\u542b\u54cd\u5e94\u6587\u672c\u7684\u6587\u4ef6\uff0c\u671f\u4e2d\u7ad9\u4f4d\u7b26(\u53d8\u91cf)\u8868\u793a\u52a8\u6001\u90e8\u5206\u3002\u544a\u8bc9\u6a21\u677f\u5f15\u64ce\u5176\u5177\u4f53\u7684\u503c\u9700\u8981\u4ece\u4f7f\u7528\u7684\u6570\u636e\u4e2d\u83b7\u53d6\u3002 \u4f7f\u7528\u771f\u5b9e\u503c\u66ff\u6362\u53d8\u91cf\uff0c\u5728\u8fd4\u56de\u6700\u7ec8\u5f97\u5230\u7684\u5b57\u7b26\u4e32\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a\u6e32\u67d3\u3002 Flask\u662f\u4f7f\u7528Jinja2\u8fd9\u4e2a\u6a21\u677f\u5f15\u64ce\u6765\u6e32\u67d3\u6a21\u677f\u3002 \u4f7f\u7528\u6a21\u677f\u7684\u597d\u5904: \u89c6\u56fe\u51fd\u6570\u53ea\u8d1f\u8d23\u4e1a\u52a1\u903b\u8f91\u548c\u6570\u636e\u5904\u7406(\u4e1a\u52a1\u903b\u8f91\u65b9\u9762) \u6a21\u677f\u5219\u53d6\u5230\u89c6\u56fe\u51fd\u6570\u7684\u6570\u636e\u7ed3\u679c\u8fdb\u884c\u5c55\u793a\u3002\u89c6\u56fe\u5c55\u793a\u65b9\u9762 \u4ee3\u7801\u7ed3\u6784\u6e05\u6670\uff0c\u8026\u5408\u5ea6\u4f4e","title":"1. \u4ecb\u7ecd"},{"location":"python/flask/flask.jinja2/#2","text":"","title":"2. \u8fd4\u56de\u6a21\u677f"},{"location":"python/flask/flask.jinja2/#21-render_template","text":"\u6211\u4eec\u4e4b\u524d\u5199\u7684\u90fd\u662f\u8fd4\u56dehello \u8fd9\u6837\u7b80\u5355\u7684\u5b57\u7b26\u4e32\u4e4b\u7c7b\u7684\u3002\u5982\u4f55\u8fd4\u56de\u4e00\u4e2ahtml\u5462\uff0c\u9996\u5148\u6211\u4eec\u5728templates\u6587\u4ef6\u5939\u5185\u5efa\u7acb\u4e00\u4e2ahtml\u6587\u4ef6\u3002 \u7136\u540ereturn\u7684\u65f6\u5019\u8c03\u7528 render_template('login.html') ,\u8fd9\u6837\u5c31\u53ef\u4ee5\u5427login.html\u5185\u5bb9\u8fd4\u56de, render_template \u51fd\u6570\u4f1a\u81ea\u52a8\u5728templates\u6587\u4ef6\u5939\u4e2d\u627e\u5230\u5bf9\u5e94\u7684h\u3002\u4ee3\u7801\u5982\u4e0b\uff1a root@leco:~/code/flask/code# ls app.py templates root@leco:~/code/flask/code# tree . . \u251c\u2500\u2500 app.py \u2514\u2500\u2500 templates \u2514\u2500\u2500 login.html 1 directory, 2 files root@leco:~/code/flask/code# cat app.py #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/3/5 13:41 @File : app.py @Software: PyCharm \"\"\" from flask import Flask, render_template, redirect,request app = Flask(__name__) @app.route('/') def hello_world(): return 'Hello World!' @app.route('/hello') def hello(): return 'Hello!' @app.route('/login', methods=['GET', 'POST']) def login(): return render_template('login.html') @app.route('/home') def home(): return redirect('/login') if __name__ == '__main__': app.run(host='0.0.0.0', port=9527, debug=True) root@leco:~/code/flask/code# cat templates/login.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>\u767b\u5f55\u9875\u9762</h1> </form> </body> </html> \u8fd0\u884c\u6d4b\u8bd5 root@leco:~/code/flask/code# python app.py * Running on http://0.0.0.0:9527/ (Press CTRL+C to quit) * Restarting with stat * Debugger is active! * Debugger PIN: 231-067-023 \u6b64\u65f6\u6211\u4eec\u8bbf\u95ee root@leco:~/book/books/docs/python/flask# curl 127.0.0.1:9527/login <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>\u767b\u5f55\u9875\u9762</h1> </form> </body> \u6b64\u65f6\u8fd4\u56de\u4e86 login.html \u7684\u9875\u9762\u5185\u5bb9\u3002\u4f46\u662f\u9875\u9762\u662f\u56fa\u5b9a\u5185\u5bb9\uff0c\u600e\u4e48\u505a\u5230\u540e\u7aef\u7684\u5185\u5bb9\u4f20\u9012\u7ed9\u524d\u7aef\u9875\u9762\u5462\u3002\u8bf7\u7ee7\u7eed\u3002","title":"2.1 render_template \u65e0\u53c2"},{"location":"python/flask/flask.jinja2/#22-render_template","text":"\u4e0a\u4e00\u5c0f\u7ae0\u8282\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 render_template \u8fd4\u56dehtml\u5185\u5bb9\uff0c\u4f46\u662f\u6ca1\u4f20\u9012\u53c2\u6570\u7ed9\u524d\u7aef\uff0c\u5176\u5b9e\u6211\u4eec\u5728 render_template \u7684\u65f6\u5019\u662f\u53ef\u4ee5\u4f20\u9012\u53c2\u6570\u7684\uff0c\u4ee3\u7801\u4fee\u6539\u5982\u4e0b\uff1a app.py \u4fee\u6539\u7684\u90e8\u5206 @app.route('/login', methods=['GET', 'POST']) def login(): name = \"cmz\" # age = 10 return render_template('login.html',name=name,age=age) # \u4f20\u9012\u4e24\u4e2a\u53c2\u6570 login.html root@leco:~/code/flask/code# cat templates/login.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>\u767b\u5f55\u9875\u9762</h1> {{ name }} - {{ age }} </form> </body> </html> \u6ce8\u610f 1. {{ name }} - {{ age }} \u63a5\u53d7\u4ece\u7236\u4eb2\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570 2. return render_template ( 'login.html' , name = name , age = age ) name = name ------> \u7b49\u53f7\u524d\u9762\u7684 name\u5c31\u662f\u8981\u5728login . html\u4e0a\u8c03\u7528\u7684 \uff0c\u7b49\u53f7\u540e\u9762\u7684 name\u662f\u670d\u52a1\u5668\u8fd9\u8fb9\u4f20\u5165\u7684\u4e5f\u5c31\u662f 'cmz' age \u548c name\u4e00\u6837 3. \u8981\u662f\u670d\u52a1\u5668\u4f20\u5165\u7684\u53c2\u6570\u6bd4\u8f83\u591a\u7684\u60c5\u51b5\u4e0b\u3002\u6211\u4eec\u76f4\u63a5\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u65b9\u6cd5 : return render_template ( 'login.html' , locals ()) ------> \u5728\u524d\u9762\u7684\u9875\u9762\u8c03\u7528\u7684\u4e5f\u6b63\u662f\u8be5\u89c6\u56fe\u51fd\u6570\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570 , \u5176\u5b9e `locals()` \u5c31\u662f\u628a\u89c6\u56fe\u51fd\u6570\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570\u7ec4\u6210 k - v\u4e00\u6837\u7684\u7684\u5b57\u5178\u4f20\u5230\u524d\u7aef","title":"2.2 render_template \u6709\u53c2"},{"location":"python/flask/flask.jinja2/#3","text":"","title":"3. \u5177\u4f53\u7528\u6cd5"},{"location":"python/flask/flask.jinja2/#31","text":"\u548cdjango\u7684jinja\u8bed\u6cd5\u4e00\u81f4 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/2/18 13:03 @File : 1.py.py @Software: PyCharm \"\"\" from flask import Flask, render_template, redirect, request app = Flask(__name__) STUDENT = {'name': '\u5f20\u4e09', 'age': 38, 'gender': '\u4e2d'}, STUDENT_LIST = [ {'name': '\u5f20\u4e09', 'age': 38, 'gender': '\u4e2d'}, {'name': '\u674e\u56db', 'age': 73, 'gender': '\u7537'}, {'name': '\u738b\u4e94', 'age': 84, 'gender': '\u5973'} ] STUDENT_DICT = { 1: {'name': '\u5f20\u4e09', 'age': 38, 'gender': '\u4e2d'}, 2: {'name': '\u674e\u56db', 'age': 73, 'gender': '\u7537'}, 3: {'name': '\u738b\u4e94', 'age': 84, 'gender': '\u5973'}, } @app.route('/') def hello_world(): return 'Hello World!' @app.route('/hello') def hello(): return 'Hello!' @app.route('/login',methods=['GET', 'POST']) def login(): # print('\u4f60\u8bbf\u95ee\u4e86login\u51fd\u6570') # print(request.method) # print(request.path) # print(request.headers) # print(request.host) # print(request.host_url) # print(request.full_path) met = request.method if met == 'GET': return render_template('login.html') if met == 'POST': print(\"request.args = \", request.args) print(\"request.data = \", request.data) print(\"request.form = \", request.form) # print(\"request.values = \", request.values) username = request.form.get(\"username\") pwd = request.form.get('pwd') if username=='cc' and pwd=='cc': return '\u767b\u5f55\u6210\u529f' else: return render_template('login.html', msg='\u4f60\u4e2b\u5199\u9519\u4e86') @app.route('/home') def home(): return redirect('/login') @app.route('/detail') def detail(): return render_template('detail.html', stu=STUDENT) @app.route('/detail_list') def detail_list(): return render_template('detail_list.html', stu_list=STUDENT_LIST) @app.route('/detail_dict') def detail_dict(): return render_template('detail_dict.html', stu_dict=STUDENT_DICT) if __name__ == '__main__': app.run(host='0.0.0.0', port=9527, debug=True) # app.run(host='0.0.0.0', debug=True) # wsgi \u5e94\u7528\u7a0b\u5e8f\u7f51\u5173\u63a5\u53e3\uff0c\u628a\u4f60\u7684\u8bf7\u6c42\u5904\u7406\u540e\u53d1\u9001\u7ed9\u5bf9\u4e8e\u7684app\u4e2d # werkzeug Flask\u4f7f\u7528\u7684","title":"3.1 \u73af\u5883\u51c6\u5907"},{"location":"python/flask/flask.jinja2/#32-jina2-","text":"\u5728\u524d\u7aef\u5c55\u793a\u53d6\u503c\u7684\u65f6\u5019\uff0c\u540e\u7aef\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570\uff0c\u6211\u4eec\u90fd\u53ef\u4ee5\u4f7f\u7528\u53e5\u70b9\u53f7\uff0c\u6765\u53d6\u503c\u3002\u4e0d\u7ba1\u540e\u7aef\u4f20\u9012\u8fc7\u6765\u7684\u662f\u5b57\u5178\uff0c\u5217\u8868\uff0c\u8fd8\u662f\u5bf9\u8c61\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7\u53e5\u70b9\u53f7\u53d6\u503c\uff0c \u8bed\u6cd5 \u5217\u8868.\u6570\u503c \u5b57\u5178.\u6570\u503c \u5bf9\u8c61.\u6570\u503c list1 = [1,2,3] dict1 = {1:2,3:4} detail.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>detail</title> </head> <body> <!--{{ stu }}--> {{ stu[0] }} <table border=\"1px\"> <tr> <td>name</td> <td>age</td> <td>gender</td> </tr> <tr> <td>{{ stu[0].name }}</td> <td>{{ stu[0].age }}</td> <td>{{ stu[0]['gender'] }}</td> </tr> </table> </body> </html> \u6d4b\u8bd5\u7ed3\u679c {'name'\uff1a'\u5f20\u4e09'\uff0c'\u5e74\u9f84'\uff1a38\uff0c'\u6027\u522b'\uff1a'\u4e2d'} \u540d\u79f0 \u5e74\u9f84 \u6027\u522b \u5f20\u4e09 38 \u4e2d","title":"3.2 jina2 - \u53e5\u70b9\u53f7"},{"location":"python/flask/flask.jinja2/#33-jina2-for","text":"\u540e\u7aef\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u904d\u5386\u8f93\u51fa\u3002 \u8bed\u6cd5 {% for stu in stu_list %} \u4ee3\u7801\u5757 {% endfor %} detail_list.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>detail</title> </head> <body> {{ stu_list }} <table border=\"1px\"> <tr> <td>name</td> <td>age</td> <td>gender</td> </tr> {% for stu in stu_list %} <tr> <td>{{ stu.name }}</td> <td>{{ stu.age }}</td> <td>{{ stu.gender }}</td> </tr> {% endfor %} </table> <p>\u6d4b\u8bd5if</p> <table border=\"1px\"> {% for stu in stu_list %} {% if stu.name != '\u5f20\u4e09' %} <tr> <td>{{ stu.get(\"name\") }}</td> <td>{{ stu.get(\"age\") }}</td> <td>{{ stu.get(\"gender\") }}</td> </tr> {% endif %} {% endfor %} </table> </body> </html> \u6d4b\u8bd5\u7ed3\u679c [{'name'\uff1a'\u5f20\u4e09'\uff0c'\u5e74\u9f84'\uff1a38\uff0c'\u6027\u522b'\uff1a'\u4e2d'}\uff0c{'\u540d\u79f0'\uff1a'\u674e\u56db'\uff0c'\u5e74\u9f84'\uff1a73\uff0c'\u6027\u522b'\uff1a'\u7537'} \uff0c{'name'\uff1a'\u738b\u4e94'\uff0c'\u5e74\u9f84'\uff1a84\uff0c'\u6027\u522b'\uff1a'\u5973'}] \u540d\u79f0 \u5e74\u9f84 \u6027\u522b \u5f20\u4e09 38 \u4e2d \u674e\u56db 73 \u7537 \u738b\u4e94 84 \u5973 \u6d4b\u8bd5\u5982\u679c \u540d\u79f0 \u5e74\u9f84 \u6027\u522b \u674e\u56db 73 \u7537 \u738b\u4e94 84 \u5973 \u4ee5\u4e0a\u4f7f\u7528\u4e86if\u5224\u65ad\uff0c\u5224\u65ad\u975e\u5f20\u4e09\u5c31\u663e\u793a detail_dict.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>detail</title> </head> <body> {{ stu_dict }} <table border=\"1px\"> <tr> <td>id</td> <td>name</td> <td>age</td> <td>gender</td> </tr> {% for id in stu_dict %} <tr> <td>{{ id }}</td> <td>{{ stu_dict.get(id).get(\"name\") }}</td> <td>{{ stu_dict.get(id).get(\"age\") }}</td> <td>{{ stu_dict.get(id).get(\"gender\") }}</td> </tr> {% endfor %} </table> \u6d4b\u8bd5 dict item <table border=\"1px\"> <tr> <td>id</td> <td>name</td> <td>age</td> <td>gender</td> </tr> {% for id,stu in stu_dict.items() %} <tr> <td>{{ id }}</td> <td>{{ stu.get(\"name\") }}</td> <td>{{ stu.get(\"age\") }}</td> <td>{{ stu.get(\"gender\") }}</td> </tr> {% endfor %} </table> </body> </html> \u6d4b\u8bd5\u7ed3\u679c {1\uff1a{'name'\uff1a'\u5f20\u4e09'\uff0c'\u5e74\u9f84'\uff1a38\uff0c'\u6027\u522b'\uff1a'\u4e2d'}\uff0c2\uff1a{'name'\uff1a'\u674e\u56db'\uff0c'\u5e74\u9f84'\uff1a73\uff0c'\u6027\u522b'\uff1a '\u7537'}\uff0c3\uff1a{'name'\uff1a'\u738b\u4e94'\uff0c'\u5e74\u9f84'\uff1a84\uff0c'\u6027\u522b'\uff1a'\u5973'}} ID \u540d\u79f0 \u5e74\u9f84 \u6027\u522b 1 \u5f20\u4e09 38 \u4e2d 2 \u674e\u56db 73 \u7537 3 \u738b\u4e94 84 \u5973 \u6d4b\u8bd5dict\u9879\u76ee ID \u540d\u79f0 \u5e74\u9f84 \u6027\u522b 1 \u5f20\u4e09 38 \u4e2d 2 \u674e\u56db 73 \u7537 3 \u738b\u4e94 84 \u5973","title":"3.3 jina2 - for"},{"location":"python/flask/flask.jinja2/#34-jina2-if","text":"<table border=\"1px\"> {% for stu in stu_list %} {% if stu.name != '\u5f20\u4e09' %} <tr> <td>{{ stu.get(\"name\") }}</td> <td>{{ stu.get(\"age\") }}</td> <td>{{ stu.get(\"gender\") }}</td> </tr> {% endif %} {% endfor %} </table>","title":"3.4 jina2 - if"},{"location":"python/flask/flask.jinja2/#35-jina2-extends","text":"\u8bed\u6cd5 {% extends 'hehe.html' %} \u8be5\u9875\u9762\u7ee7\u627f\u4e8ehehe.html hehe.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <p>\u4f60\u597d 123</p> {% block a123 %} {% endblock %} <p>\u4f60\u597d 456</p> {% block a456 %} {% endblock %} <p>\u4f60\u597d 789</p> {% block a789 %} {% endblock %} </body> </html> \u6d4b\u8bd5\u7ed3\u679c \u4f60\u597d123 \u4e00\u4e8c\u4e09 \u4f60\u597d456 \u56db\u4e94\u516d \u4f60\u597d789 \u4e03\u516b\u4e5d \u6211\u662f\u54c8\u54c8\u6a21\u677f","title":"3.5 jina2 - extends"},{"location":"python/flask/flask.jinja2/#36-jina2-include","text":"\u8bed\u6cd5 {% include 'haha.html' %} \u8be5\u5904\u8c03\u7528\u7684haha.html\u7684\u5185\u5bb9 haha.html <h1>\u6211\u662f\u54c8\u54c8\u6a21\u677f</h1> \u6d4b\u8bd5\u7ed3\u679c \u4f60\u597d123 \u4e00\u4e8c\u4e09 \u4f60\u597d456 \u56db\u4e94\u516d \u4f60\u597d789 \u4e03\u516b\u4e5d \u6211\u662f\u54c8\u54c8\u6a21\u677f <------------------- include \u663e\u793a\u7684\u90e8\u5206","title":"3.6 jina2 - include"},{"location":"python/flask/flask.jinja2/#37-jina2-","text":"\u540e\u7aef\u6e32\u67d3\u7684\u51fd\u6570\u4f20\u9012\u7ed9\u524d\u7aef\uff0c\u8fd9\u4e2a\u662f\u5c40\u90e8\u7684\uff0c\u8981\u662f\u5168\u5c40\u7684\u8bdd\uff08\u4e5f\u5c31\u662f\u524d\u7aef\u4ec0\u4e48\u9875\u9762\u90fd\u53ef\u4ee5\u8c03\u7528\uff09\u5c31\u662f\u6709template_global def add_sum(*args): return sum(args) \u524d\u7aef\u4f7f\u7528 <p>{{ sum(1,2,3,4,5)}}</p> \u6d4b\u8bd5\u7ed3\u679c 15","title":"3.7 jina2 - \u51fd\u6570"},{"location":"python/flask/flask.jinja2/#38-jina2-safe","text":"@app.route('/login',methods=['GET', 'POST']) def login(): # print('\u4f60\u8bbf\u95ee\u4e86login\u51fd\u6570') # print(request.method) # print(request.path) # print(request.headers) # print(request.host) # print(request.host_url) # print(request.full_path) met = request.method if met == 'GET': text_tag = '<p>\u4f60\u5927\u7237\u7684: <input type=\"password\" name=\"pwd\"></p>' text_tag = Markup(text_tag) return render_template('login.html', msg=text_tag, sum=add_sum) if met == 'POST': print(\"request.args = \", request.args) print(\"request.data = \", request.data) print(\"request.form = \", request.form) # print(\"request.values = \", request.values) username = request.form.get(\"username\") pwd = request.form.get('pwd') if username=='cc' and pwd=='cc': return '\u767b\u5f55\u6210\u529f' else: return render_template('login.html', msg='\u4f60\u4e2b\u5199\u9519\u4e86') \u524d\u7aef\u5c55\u793a\u7684\u65f6\u5019\u8c03\u7528text_tag\uff0c\u6211\u4eec\u5728django\u7684\u65f6\u5019\u662f\u4f7f\u7528safe\u5982\u4e0b {{ text_tag| safe }} \u8fd9\u6837\u5c31\u5728\u524d\u7aef\u7684\u65f6\u5019\u663e\u793ainput\u6807\u7b7e\u4e86\uff0c\u5728flask\u4e2d\u53ef\u4ee5\u540e\u7aef\u505a\u5904\u7406\u4e5f\u5c31\u662f\u6709Markup\u3002 \u524d\u7aef\u76f4\u63a5\u4f7f\u7528\u5373\u53ef\uff0c\u5c31\u76f4\u63a5\u6e32\u67d3\u51fainput\u6807\u7b7e\u4e86 {{ text_tag}}","title":"3.8 jina2 - safe"},{"location":"python/flask/flask.jinja2/#39-jina2-template_global","text":"\u540e\u7aef @app.template_global() def add_add(*args): return sum(args) \u524d\u7aef\u8c03\u7528\uff0c\u968f\u4fbf\u54ea\u4e2a\u9875\u9762\u8c03\u7528\uff0c\u8c03\u7528\u5982\u4e0b <p>{{ add_add(1,2,3,4,5)}} </p>","title":"3.9 jina2 - template_global"},{"location":"python/flask/flask.jinja2/#310-jina2-template_filter","text":"\u4fd7\u79f0\u8fc7\u6ee4\u5668 # \u8fc7\u6ee4\u5668 @app.template_filter() def oushu(sum): if not sum %2: return \"\u5076\u6570\" else: return \"\u5947\u6570\" \u524d\u7aef\u8c03\u7528 <p> {{ sum(124,4) | oushu }}</p> \u5c06\u524d\u9762sum(124,4)\u7684\u503c\u4f20\u9012\u7ed9oushu\u8fc7\u6ee4\u5668\uff0c\u7ed3\u679c\u662f \u5076\u6570","title":"3.10 jina2 - template_filter"},{"location":"python/flask/flask.jinja2/#311-jina2-macro","text":"\u5b8f\uff0c\u4f7f\u7528\u7684\u4e0d\u591a\u3002 \u76f4\u63a5\u5728\u524d\u7aef\u9875\u9762\u4e0a\u4f7f\u7528 {# \u610f\u4e49\u4e0d\u5927\u3002\u5b8f\u6307\u4ee4#} {% macro create_tag(na,ty) %} <input type=\"{{ ty }}\" name=\"{{ na }}\" value=\"{{ na }}\"> {% endmacro %} <h1>\u4f60\u5411\u4e0b\u770b</h1> {{ create_tag(\"\u6309\u94ae\",\"submit\") }} \u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u524d\u7aef\u9875\u9762\u4e0a\u521b\u5efa\u4e86\u4e00\u4e2a\u6309\u94ae\u4e86\u3002","title":"3.11 jina2 - macro"},{"location":"python/flask/flask.methods/","text":"Flask \u8bf7\u6c42\u65b9\u5f0f 1. \u4ecb\u7ecd \u00b6 \u9996\u5148\u8981\u660e\u786e\u4e00\u4ef6\u4e8b\uff0cRequest\u8fd9\u662f\u4e2a\u5bf9\u8c61\uff0c\u4e0d\u7ba1\u4f7f\u7528PHP\u8fd8\u662fpython\u8fd8\u662f\u4ec0\u4e48java\u8bed\u8a00\uff0c\u867d\u7136request\u8fd9\u4e2a\u5bf9\u8c61\u53ef\u80fd\u53eb\u7684\u540d\u5b57\u4e0d\u4e00\u6837\uff0c\uff08\u5728\u5176\u4ed6\u8bed\u8a00\u4e2d\u53ef\u80fd\u53eb\u4ec0\u4e48HttpRequest\uff09\uff0c\u4f46\u662f\u539f\u7406\u90fd\u662f\u5dee\u4e0d\u591a\u3002\u6211\u4eec\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u7ed9\u670d\u52a1\u5668\uff0c\u53d1\u9001\u7684\u5c31\u662f\u8fd9\u4e2aRequest\u5bf9\u8c61\u3002\u6211\u4eec\u4e0d\u80fd\u7b80\u5355\u7684\u4ee5\u4e3a\u6211\u4eec\u5728\u5730\u5740\u680f\u6253\u4e86\u4e00\u884c\uff1a www.xxxx.com \u5c31\u4ee5\u4e3a\u8bf7\u6c42\u5c31\u8fd9\u70b9\u4e1c\u897f\uff0c\u5176\u5b9eRequest\u5bf9\u8c61\u91cc\u9762\u5305\u542b\u4e86\u4f60\u8981\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7684\u5f88\u591a\u4e1c\u897f\u3002\u8fd9\u8282\u5185\u5bb9\u548c\u4e4b\u524d\u7684\u57fa\u7840\u77e5\u8bc6\u4e2d\u7684Http\u76f8\u547c\u5e94\u3002 \u5728Flask\u4e2d\uff0cRequest\u5bf9\u8c61\u5c31\u53eb\u505arequest\uff0c\u53ef\u4ee5\u76f4\u63a5\u5f15\u7528 from flask import request 2. \u4ee3\u7801 \u00b6 2.1 python code \u00b6 app.py #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/2/18 13:03 @Software: PyCharm \"\"\" from flask import Flask, render_template, redirect app = Flask(__name__) @app.route('/') def hello_world(): return 'Hello World!' @app.route('/hello') def hello(): return 'Hello!' @app.route('/login') def login(): return render_template('login.html') @app.route('/home') def home(): return redirect('/login') if __name__ == '__main__': app.run(host='0.0.0.0', port=9527, debug=True) # app.run(host='0.0.0.0', debug=True) # wsgi \u5e94\u7528\u7a0b\u5e8f\u7f51\u5173\u63a5\u53e3\uff0c\u628a\u4f60\u7684\u8bf7\u6c42\u5904\u7406\u540e\u53d1\u9001\u7ed9\u5bf9\u4e8e\u7684app\u4e2d # werkzeug Flask\u4f7f\u7528\u7684 2.2 html code \u00b6 log.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>\u767b\u5f55\u9875\u9762</h1> <form action=\"/login\" method=\"post\"> <p> \u7528\u6237\u540d: <input type=\"text\" name=\"username\"> </p> <p> \u5bc6\u7801: <input type=\"password\" name=\"pwd\"> </p> <p><input type=\"submit\"> \u767b\u5f55</p> </form> </body> </html> 2.3 \u8fd0\u884c\u4ee3\u7801 \u00b6 root@leco:~/code/flask# python app.py * Running on http://0.0.0.0:9527/ (Press CTRL+C to quit) * Restarting with stat * Debugger is active! * Debugger PIN: 231-067-023 192.168.5.110 - - [05/Mar/2019 13:32:03] \"GET / HTTP/1.1\" 200 - 192.168.5.1 - - [05/Mar/2019 13:33:34] \"POST / HTTP/1.1\" 405 - 2.4 \u6d4b\u8bd5 \u00b6 2.4.1 GET \u6d4b\u8bd5 \u00b6 root@leco:~/book/books/docs/mysql# curl 192.168.5.110:9527 Hello World!root@leco:~/book/books/docs/mysql# GET\u8bf7\u6c42\u8fc7\u53bb\u662f\u5141\u8bb8\u7684\u3002 2.4.2 POST \u6d4b\u8bd5 \u00b6 root@leco:~/book/books/docs/mysql# root@leco:~/book/books/docs/mysql# curl 192.168.5.110:9527 -X POST -d 'title=123' <!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\"> <title>405 Method Not Allowed</title> <h1>Method Not Allowed</h1> <p>The method is not allowed for the requested URL.</p> POST \u8bf7\u6c42\u8fc7\u53bb\u662f\u4e0d\u5141\u8bb8\u7684\u3002 \u539f\u56e0 1. flask \u6ca1\u6709 methods\u4fee\u9970\u7684\u65f6\u5019 \u3002\u9ed8\u8ba4\u662f\u53ea\u63a5\u53d7 GET\u8bf7\u6c42 2. \u8981\u662f\u5176\u4ed6\u8bf7\u6c42\u53ef\u884c\uff0c\u9700\u8981\u6dfb\u52a0 methods , \u5982 methods = [ 'GET' , 'POST' ] \u539f\u56e0\u5206\u6790\uff0c\u67e5\u770b\u6e90\u7801,\u9519\u8bef\u5206\u6790 \u70b9\u51fbroute\u67e5\u770b\u91c7\u53c2\u6570 \u6ce8\u610f methods is a list of methods this rule should be limited to ( `` GET `` , `` POST `` etc . ) . 3. \u4ee3\u7801\u4fee\u6539 \u00b6 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/3/5 13:41 @File : app.py @Software: PyCharm \"\"\" from flask import Flask, render_template, redirect,request app = Flask(__name__) @app.route('/') def hello_world(): return 'Hello World!' @app.route('/hello') def hello(): return 'Hello!' @app.route('/login', methods=['GET', 'POST']) def login(): print('\u4f60\u8bbf\u95ee\u4e86login\u51fd\u6570') if request.method == 'GET': return \"GET\" elif request.method == \"POST\": return \"POST\" @app.route('/home') def home(): return redirect('/login') if __name__ == '__main__': app.run(host='0.0.0.0', port=9527, debug=True) # app.run(host='0.0.0.0', debug=True) # wsgi \u5e94\u7528\u7a0b\u5e8f\u7f51\u5173\u63a5\u53e3\uff0c\u628a\u4f60\u7684\u8bf7\u6c42\u5904\u7406\u540e\u53d1\u9001\u7ed9\u5bf9\u4e8e\u7684app\u4e2d # werkzeug Flask\u4f7f\u7528\u7684 \u6d4b\u8bd5 root@leco:~/book/books/docs/mysql# curl 192.168.5.110:9527/login GETroot@leco:~/book/books/docs/mysql# root@leco:~/book/books/docs/mysql# root@leco:~/book/books/docs/mysql# root@leco:~/book/books/docs/mysql# curl 192.168.5.110:9527/login -X POST -d 'title=123' POSTroot@leco:~/book/books/docs/mysql# \u6240\u4ee5\u53ef\u4ee5\u63a5\u53d7GET,POST\u7b49\u5176\u4ed6\u65b9\u6cd5\u4e86\u3002 4. \u603b\u7ed3 \u00b6 \u8981\u60f3\u5ba2\u6237\u7aef\u80fd\u4f7f\u7528\u54ea\u79cd\u65b9\u5f0f\u8bbf\u95ee\u3002\u6211\u4eec\u5c31\u5728methods\u540e\u9762\u7684\u5217\u8868\u4e2d\u6dfb\u52a0\u3002","title":"4. \u8bf7\u6c42\u65b9\u6cd5"},{"location":"python/flask/flask.methods/#1","text":"\u9996\u5148\u8981\u660e\u786e\u4e00\u4ef6\u4e8b\uff0cRequest\u8fd9\u662f\u4e2a\u5bf9\u8c61\uff0c\u4e0d\u7ba1\u4f7f\u7528PHP\u8fd8\u662fpython\u8fd8\u662f\u4ec0\u4e48java\u8bed\u8a00\uff0c\u867d\u7136request\u8fd9\u4e2a\u5bf9\u8c61\u53ef\u80fd\u53eb\u7684\u540d\u5b57\u4e0d\u4e00\u6837\uff0c\uff08\u5728\u5176\u4ed6\u8bed\u8a00\u4e2d\u53ef\u80fd\u53eb\u4ec0\u4e48HttpRequest\uff09\uff0c\u4f46\u662f\u539f\u7406\u90fd\u662f\u5dee\u4e0d\u591a\u3002\u6211\u4eec\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u7ed9\u670d\u52a1\u5668\uff0c\u53d1\u9001\u7684\u5c31\u662f\u8fd9\u4e2aRequest\u5bf9\u8c61\u3002\u6211\u4eec\u4e0d\u80fd\u7b80\u5355\u7684\u4ee5\u4e3a\u6211\u4eec\u5728\u5730\u5740\u680f\u6253\u4e86\u4e00\u884c\uff1a www.xxxx.com \u5c31\u4ee5\u4e3a\u8bf7\u6c42\u5c31\u8fd9\u70b9\u4e1c\u897f\uff0c\u5176\u5b9eRequest\u5bf9\u8c61\u91cc\u9762\u5305\u542b\u4e86\u4f60\u8981\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7684\u5f88\u591a\u4e1c\u897f\u3002\u8fd9\u8282\u5185\u5bb9\u548c\u4e4b\u524d\u7684\u57fa\u7840\u77e5\u8bc6\u4e2d\u7684Http\u76f8\u547c\u5e94\u3002 \u5728Flask\u4e2d\uff0cRequest\u5bf9\u8c61\u5c31\u53eb\u505arequest\uff0c\u53ef\u4ee5\u76f4\u63a5\u5f15\u7528 from flask import request","title":"1. \u4ecb\u7ecd"},{"location":"python/flask/flask.methods/#2","text":"","title":"2. \u4ee3\u7801"},{"location":"python/flask/flask.methods/#21-python-code","text":"app.py #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/2/18 13:03 @Software: PyCharm \"\"\" from flask import Flask, render_template, redirect app = Flask(__name__) @app.route('/') def hello_world(): return 'Hello World!' @app.route('/hello') def hello(): return 'Hello!' @app.route('/login') def login(): return render_template('login.html') @app.route('/home') def home(): return redirect('/login') if __name__ == '__main__': app.run(host='0.0.0.0', port=9527, debug=True) # app.run(host='0.0.0.0', debug=True) # wsgi \u5e94\u7528\u7a0b\u5e8f\u7f51\u5173\u63a5\u53e3\uff0c\u628a\u4f60\u7684\u8bf7\u6c42\u5904\u7406\u540e\u53d1\u9001\u7ed9\u5bf9\u4e8e\u7684app\u4e2d # werkzeug Flask\u4f7f\u7528\u7684","title":"2.1 python code"},{"location":"python/flask/flask.methods/#22-html-code","text":"log.html <!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"UTF-8\"> <title>Title</title> </head> <body> <h1>\u767b\u5f55\u9875\u9762</h1> <form action=\"/login\" method=\"post\"> <p> \u7528\u6237\u540d: <input type=\"text\" name=\"username\"> </p> <p> \u5bc6\u7801: <input type=\"password\" name=\"pwd\"> </p> <p><input type=\"submit\"> \u767b\u5f55</p> </form> </body> </html>","title":"2.2 html code"},{"location":"python/flask/flask.methods/#23","text":"root@leco:~/code/flask# python app.py * Running on http://0.0.0.0:9527/ (Press CTRL+C to quit) * Restarting with stat * Debugger is active! * Debugger PIN: 231-067-023 192.168.5.110 - - [05/Mar/2019 13:32:03] \"GET / HTTP/1.1\" 200 - 192.168.5.1 - - [05/Mar/2019 13:33:34] \"POST / HTTP/1.1\" 405 -","title":"2.3 \u8fd0\u884c\u4ee3\u7801"},{"location":"python/flask/flask.methods/#24","text":"","title":"2.4 \u6d4b\u8bd5"},{"location":"python/flask/flask.methods/#241-get","text":"root@leco:~/book/books/docs/mysql# curl 192.168.5.110:9527 Hello World!root@leco:~/book/books/docs/mysql# GET\u8bf7\u6c42\u8fc7\u53bb\u662f\u5141\u8bb8\u7684\u3002","title":"2.4.1 GET \u6d4b\u8bd5"},{"location":"python/flask/flask.methods/#242-post","text":"root@leco:~/book/books/docs/mysql# root@leco:~/book/books/docs/mysql# curl 192.168.5.110:9527 -X POST -d 'title=123' <!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\"> <title>405 Method Not Allowed</title> <h1>Method Not Allowed</h1> <p>The method is not allowed for the requested URL.</p> POST \u8bf7\u6c42\u8fc7\u53bb\u662f\u4e0d\u5141\u8bb8\u7684\u3002 \u539f\u56e0 1. flask \u6ca1\u6709 methods\u4fee\u9970\u7684\u65f6\u5019 \u3002\u9ed8\u8ba4\u662f\u53ea\u63a5\u53d7 GET\u8bf7\u6c42 2. \u8981\u662f\u5176\u4ed6\u8bf7\u6c42\u53ef\u884c\uff0c\u9700\u8981\u6dfb\u52a0 methods , \u5982 methods = [ 'GET' , 'POST' ] \u539f\u56e0\u5206\u6790\uff0c\u67e5\u770b\u6e90\u7801,\u9519\u8bef\u5206\u6790 \u70b9\u51fbroute\u67e5\u770b\u91c7\u53c2\u6570 \u6ce8\u610f methods is a list of methods this rule should be limited to ( `` GET `` , `` POST `` etc . ) .","title":"2.4.2 POST \u6d4b\u8bd5"},{"location":"python/flask/flask.methods/#3","text":"#!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/3/5 13:41 @File : app.py @Software: PyCharm \"\"\" from flask import Flask, render_template, redirect,request app = Flask(__name__) @app.route('/') def hello_world(): return 'Hello World!' @app.route('/hello') def hello(): return 'Hello!' @app.route('/login', methods=['GET', 'POST']) def login(): print('\u4f60\u8bbf\u95ee\u4e86login\u51fd\u6570') if request.method == 'GET': return \"GET\" elif request.method == \"POST\": return \"POST\" @app.route('/home') def home(): return redirect('/login') if __name__ == '__main__': app.run(host='0.0.0.0', port=9527, debug=True) # app.run(host='0.0.0.0', debug=True) # wsgi \u5e94\u7528\u7a0b\u5e8f\u7f51\u5173\u63a5\u53e3\uff0c\u628a\u4f60\u7684\u8bf7\u6c42\u5904\u7406\u540e\u53d1\u9001\u7ed9\u5bf9\u4e8e\u7684app\u4e2d # werkzeug Flask\u4f7f\u7528\u7684 \u6d4b\u8bd5 root@leco:~/book/books/docs/mysql# curl 192.168.5.110:9527/login GETroot@leco:~/book/books/docs/mysql# root@leco:~/book/books/docs/mysql# root@leco:~/book/books/docs/mysql# root@leco:~/book/books/docs/mysql# curl 192.168.5.110:9527/login -X POST -d 'title=123' POSTroot@leco:~/book/books/docs/mysql# \u6240\u4ee5\u53ef\u4ee5\u63a5\u53d7GET,POST\u7b49\u5176\u4ed6\u65b9\u6cd5\u4e86\u3002","title":"3. \u4ee3\u7801\u4fee\u6539"},{"location":"python/flask/flask.methods/#4","text":"\u8981\u60f3\u5ba2\u6237\u7aef\u80fd\u4f7f\u7528\u54ea\u79cd\u65b9\u5f0f\u8bbf\u95ee\u3002\u6211\u4eec\u5c31\u5728methods\u540e\u9762\u7684\u5217\u8868\u4e2d\u6dfb\u52a0\u3002","title":"4. \u603b\u7ed3"},{"location":"python/flask/flask.view/","text":"flask \u8def\u7531 \u73b0\u4ee3 Web \u5e94\u7528\u7684 URL \u5341\u5206\u4f18\u96c5\uff0c\u6613\u4e8e\u4eba\u4eec\u8fa8\u8bc6\u8bb0\u5fc6\uff0c\u8fd9\u4e00\u70b9\u5bf9\u4e8e\u90a3\u4e9b\u9762\u5411\u4f7f\u7528\u4f4e\u901f\u7f51\u7edc\u8fde\u63a5\u79fb\u52a8\u8bbe\u5907\u8bbf\u95ee\u7684\u5e94\u7528\u7279\u522b\u6709\u7528\u3002\u5982\u679c\u53ef\u4ee5\u4e0d\u8bbf\u95ee\u7d22\u5f15\u9875\uff0c\u800c\u662f\u76f4\u63a5\u8bbf\u95ee\u60f3\u8981\u7684\u90a3\u4e2a\u9875\u9762\uff0c\u4ed6\u4eec\u591a\u534a\u4f1a\u7b11\u9010\u989c\u5f00\u800c\u518d\u5ea6\u5149\u987e\u3002 flask\u7684 route() \u88c5\u9970\u5668\u628a\u4e00\u4e2a\u51fd\u6570\u7ed1\u5b9a\u5230\u5bf9\u5e94\u7684 URL \u4e0a\u3002 1. MTV \u00b6 \u5728\u5f00\u59cbflask\u7684\u8def\u7531\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u8bf4\u4e0b\uff0c\u8457\u540d\u7684MVC\u6a21\u5f0f\uff1a\u6240\u8c13MVC\u5c31\u662f\u628aweb\u5e94\u7528\u5206\u4e3a\u6a21\u578b(M),\u63a7\u5236\u5668(C),\u89c6\u56fe(V)\u4e09\u5c42\uff1b\u4ed6\u4eec\u4e4b\u95f4\u4ee5\u4e00\u79cd\u63d2\u4ef6\u4f3c\u7684\uff0c\u677e\u8026\u5408\u7684\u65b9\u5f0f\u8fde\u63a5\u5728\u4e00\u8d77\u3002 \u6a21\u578b\u8d1f\u8d23\u4e1a\u52a1\u5bf9\u8c61\u4e0e\u6570\u636e\u5e93\u7684\u5bf9\u8c61(ORM),\u89c6\u56fe\u8d1f\u8d23\u4e0e\u7528\u6237\u7684\u4ea4\u4e92(\u9875\u9762)\uff0c\u63a7\u5236\u5668(C)\u63a5\u53d7\u7528\u6237\u7684\u8f93\u5165\u8c03\u7528\u6a21\u578b\u548c\u89c6\u56fe\u5b8c\u6210\u7528\u6237\u7684\u8bf7\u6c42\u3002 \u4e00\u4e2a\u89c6\u56fe\u51fd\u6570\uff08\u7c7b\uff09\uff0c\u7b80\u79f0\u89c6\u56fe\uff0c\u662f\u4e00\u4e2a\u7b80\u5355\u7684Python \u51fd\u6570\uff08\u7c7b\uff09\uff0c\u5b83\u63a5\u53d7Web\u8bf7\u6c42\u5e76\u4e14\u8fd4\u56deWeb\u54cd\u5e94\u3002\u54cd\u5e94\u53ef\u4ee5\u662f\u4e00\u5f20\u7f51\u9875\u7684HTML\u5185\u5bb9\uff0c\u4e00\u4e2a\u91cd\u5b9a\u5411\uff0c\u4e00\u4e2a404\u9519\u8bef\uff0c\u4e00\u4e2aXML\u6587\u6863\uff0c\u6216\u8005\u4e00\u5f20\u56fe\u7247\u3002\u65e0\u8bba\u89c6\u56fe\u672c\u8eab\u5305\u542b\u4ec0\u4e48\u903b\u8f91\uff0c\u90fd\u8981\u8fd4\u56de\u54cd\u5e94\u3002\u4ee3\u7801\u5199\u5728\u54ea\u91cc\u4e5f\u65e0\u6240\u8c13\uff0c\u53ea\u8981\u5b83\u5728\u4f60\u5f53\u524d\u9879\u76ee\u76ee\u5f55\u4e0b\u9762\u3002\u9664\u6b64\u4e4b\u5916\u6ca1\u6709\u66f4\u591a\u7684\u8981\u6c42\u4e86\u2014\u2014\u53ef\u4ee5\u8bf4\u201c\u6ca1\u6709\u4ec0\u4e48\u795e\u5947\u7684\u5730\u65b9\u201d\u3002 1.1 MTV \u00b6 \u4ee5\u4e0b\u662fdjango\u7684\u67b6\u6784\u56fe\u3002 Model(\u6a21\u578b)\uff1a\u8d1f\u8d23\u4e1a\u52a1\u5bf9\u8c61\u4e0e\u6570\u636e\u5e93\u7684\u5bf9\u8c61(ORM) Template(\u6a21\u7248)\uff1a\u8d1f\u8d23\u5982\u4f55\u628a\u9875\u9762\u5c55\u793a\u7ed9\u7528\u6237 View(\u89c6\u56fe)\uff1a\u8d1f\u8d23\u4e1a\u52a1\u903b\u8f91\uff0c\u5e76\u5728\u9002\u5f53\u7684\u65f6\u5019\u8c03\u7528Model\u548cTemplate 2. flask\u52a8\u6001\u8def\u7531 \u00b6 Flask \u7684 URL \u89c4\u5219\u57fa\u4e8e Werkzeug \u7684\u8def\u7531\u6a21\u5757\u3002\u8fd9\u4e2a\u6a21\u5757\u80cc\u540e\u7684\u601d\u60f3\u662f\u57fa\u4e8e Apache \u4ee5\u53ca\u66f4\u65e9\u7684 HTTP \u670d\u52a1\u5668\u4e3b\u5f20\u7684\u5148\u4f8b\uff0c\u4fdd\u8bc1\u4f18\u96c5\u4e14\u552f\u4e00\u7684 URL\u3002 2.1 \u53c2\u6570 \u00b6 \u5927\u81f4\u5206\u4ee5\u4e0b\u51e0\u7c7b # 1. \u63a5\u6536\u5b57\u7b26\u4e32\u7c7b\u578b\u53c2\u6570 @app.route('/user/<name>') # 2. \u63a5\u6536\u6574\u578b\u6570\u5b57\u53c2\u6570 @app.route('/<int:age>') # 3. \u63a5\u6536\u6d6e\u70b9\u578b\u6570\u5b57\u53c2\u6570 @app.route('/<float:salary>') # 4. \u63a5\u6536URL\u94fe\u63a5\u7c7b\u578b\u53c2\u6570 @app.route('/<path:path>') \u89e3\u91ca int \u63a5\u53d7\u6574\u6570 float \u540c int \uff0c\u4f46\u662f\u63a5\u53d7\u6d6e\u70b9\u6570 path \u548c\u9ed8\u8ba4\u7684\u76f8\u4f3c\uff0c\u4f46\u4e5f\u63a5\u53d7\u659c\u7ebf \u8981\u7ed9 URL \u6dfb\u52a0\u53d8\u91cf\u90e8\u5206\uff0c\u4f60\u53ef\u4ee5\u628a\u8fd9\u4e9b\u7279\u6b8a\u7684\u5b57\u6bb5\u6807\u8bb0\u4e3a < variable_name > \uff0c \u8fd9\u4e2a\u90e8\u5206\u5c06\u4f1a\u4f5c\u4e3a\u547d\u540d\u53c2\u6570\u4f20\u9012\u5230\u4f60\u7684\u51fd\u6570\u3002\u89c4\u5219\u53ef\u4ee5\u7528 < converter : variable_name > \u6307\u5b9a\u4e00\u4e2a\u53ef\u9009\u7684\u8f6c\u6362\u5668\u3002 2.2 code \u00b6 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/3/3 22:12 @File : url_demo.py @Software: PyCharm @author : caimengzhi \"\"\" from flask import Flask app = Flask(__name__) @app.route('/<name>') # \u8bbe\u7f6eurl\u4f20\u53c2\u6570 http://127.0.0.1:7000/cmz def first_flask(name): # \u89c6\u56fe\u5fc5\u987b\u6709\u5bf9\u5e94\u63a5\u6536\u53c2\u6570 print(name) return 'Hello {}'.format(name) @app.route('/<int:age>/') # \u8bbe\u7f6eurl\u4f20\u53c2\u6570 http://127.0.0.1:7000/30 def second_flask(age): # \u89c6\u56fe\u5fc5\u987b\u6709\u5bf9\u5e94\u63a5\u6536\u53c2\u6570 print(age) return 'my age is '.format(age) @app.route('/<float:salary>/') # \u8bbe\u7f6eurl\u4f20\u53c2\u6570 http://127.0.0.1:7000/88.88 def three_flask(salary): # \u89c6\u56fe\u5fc5\u987b\u6709\u5bf9\u5e94\u63a5\u6536\u53c2\u6570 print(salary) return 'my salary is {}'.format(salary) @app.route('/<path:url>/') # \u8bbe\u7f6eurl\u4f20\u53c2\u6570 http://127.0.0.1:7000/http://www.jd.com def four_flask(url): # \u89c6\u56fe\u5fc5\u987b\u6709\u5bf9\u5e94\u63a5\u6536\u53c2\u6570 print(url) return 'my url {}'.format(url) if __name__ == '__main__': app.run('0.0.0.0', 7000, debug=True) 2.3 \u6d4b\u8bd5 \u00b6 \u6d4b\u8bd5 name \u5f53\u95ee\u6211\u4eec 127.0.0.1:7000/cmz\uff0cflask\u5339\u914d\u7684\u662f @app.route('/<name>') \uff0c\u6b64\u65f6\u5019\u6d4f\u89c8\u5668\u4f1a\u663e\u793a hello cmz\uff0c\u4e5f\u5c31\u662f\u540e\u9762\u7684\u4f4d\u7f6e\u662fstring\u90fd\u662f\u663e\u793a\u3002 \u6d4b\u8bd5age \u5f53\u95ee\u6211\u4eec 127.0.0.1:7000/30\uff0cflask\u5339\u914d\u7684\u662f @app.route('/<int:age>') \uff0c\u6b64\u65f6\u5019\u6d4f\u89c8\u5668\u4f1a\u663e\u793a my age 30\uff0c\u4e5f\u5c31\u662f\u540e\u9762\u7684\u4f4d\u7f6e\u662f\u6574\u6570\u6570\u5b57\u90fd\u662f\u663e\u793a \u6d4b\u8bd5salary \u5f53\u95ee\u6211\u4eec 127.0.0.1:7000/88.88\uff0cflask\u5339\u914d\u7684\u662f @app.route('/<float:salary>') \uff0c\u6b64\u65f6\u5019\u6d4f\u89c8\u5668\u4f1a\u663e\u793a my salary is 88.88\uff0c\u4e5f\u5c31\u662f\u540e\u9762\u7684\u4f4d\u7f6e\u662f\u6d6e\u70b9\u6570\u5b57\u90fd\u662f\u663e\u793a \u6d4b\u8bd5url \u5f53\u95ee\u6211\u4eec 127.0.0.1:7000/ http://www.jd.com \uff0cflask\u5339\u914d\u7684\u662f @app.route('/<path:url>') \uff0c\u6b64\u65f6\u5019\u6d4f\u89c8\u5668\u4f1a\u663e\u793amy url http://www.jd.com \uff0c\u4e5f\u5c31\u662f\u540e\u9762\u7684\u4f4d\u7f6e\u662furl\u5730\u5740 3. HTTP\u65b9\u6cd5 \u00b6 HTTP \uff08\u4e0e Web \u5e94\u7528\u4f1a\u8bdd\u7684\u534f\u8bae\uff09\u6709\u8bb8\u591a\u4e0d\u540c\u7684\u8bbf\u95ee URL \u65b9\u6cd5\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8def\u7531\u53ea\u56de\u5e94 GET \u8bf7\u6c42\uff0c\u4f46\u662f\u901a\u8fc7 route() \u88c5\u9970\u5668\u4f20\u9012 methods \u53c2\u6570\u53ef\u4ee5\u6539\u53d8\u8fd9\u4e2a\u884c\u4e3a\u3002\u8fd9\u91cc\u6709\u4e00\u4e9b\u4f8b\u5b50: 3.1 \u4ee3\u7801\u6a21\u62df \u00b6 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/3/3 22:12 @File : url_demo.py @Software: PyCharm @author : caimengzhi \"\"\" from flask import Flask, request app = Flask(__name__) @app.route('/login', methods=['GET', 'POST']) def login(): if request.method == 'POST': return \"POST\" elif request.method == \"GET\": return \"GET\" else: return \"NO POST,GET\" if __name__ == '__main__': app.run('0.0.0.0', 7000, debug=True) \u5982\u679c\u5b58\u5728 GET \uff0c\u90a3\u4e48\u4e5f\u4f1a\u66ff\u4f60\u81ea\u52a8\u5730\u6dfb\u52a0 HEAD\uff0c\u65e0\u9700\u5e72\u9884\u3002\u5b83\u4f1a\u786e\u4fdd\u9075\u7167 HTTP RFC \uff08\u63cf\u8ff0 HTTP \u534f\u8bae\u7684\u6587\u6863\uff09\u5904\u7406 HEAD \u8bf7\u6c42\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u5b8c\u5168\u5ffd\u7565\u8fd9\u90e8\u5206\u7684 HTTP \u89c4\u8303\u3002\u540c\u6837\uff0c\u81ea\u4ece Flask 0.6 \u8d77\uff0c \u4e5f\u5b9e\u73b0\u4e86 OPTIONS \u7684\u81ea\u52a8\u5904\u7406\u3002\u4ee5\u4e0b\u662f\u5e38\u89c1\u7684\uff1a \u65b9\u6cd5 \u63cf\u8ff0 GET \u6d4f\u89c8\u5668\u544a\u77e5\u670d\u52a1\u5668\uff1a\u53ea \u83b7\u53d6 \u9875\u9762\u4e0a\u7684\u4fe1\u606f\u5e76\u53d1\u7ed9\u6211\u3002\u8fd9\u662f\u6700\u5e38\u7528\u7684\u65b9\u6cd5\u3002 HEAD \u6d4f\u89c8\u5668\u544a\u8bc9\u670d\u52a1\u5668\uff1a\u6b32\u83b7\u53d6\u4fe1\u606f\uff0c\u4f46\u662f\u53ea\u5173\u5fc3 \u6d88\u606f\u5934 \u3002\u5e94\u7528\u5e94\u50cf\u5904\u7406 GET \u8bf7\u6c42\u4e00\u6837\u6765\u5904\u7406\u5b83\uff0c\u4f46\u662f\u4e0d\u5206\u53d1\u5b9e\u9645\u5185\u5bb9\u3002\u5728 Flask \u4e2d\u4f60\u5b8c\u5168\u65e0\u9700 \u4eba\u5de5 \u5e72\u9884\uff0c\u5e95\u5c42\u7684 Werkzeug \u5e93\u5df2\u7ecf\u66ff\u4f60\u6253\u70b9\u597d\u4e86\u3002 POST \u6d4f\u89c8\u5668\u544a\u8bc9\u670d\u52a1\u5668\uff1a\u60f3\u5728 URL \u4e0a \u53d1\u5e03 \u65b0\u4fe1\u606f\u3002\u5e76\u4e14\uff0c\u670d\u52a1\u5668\u5fc5\u987b\u786e\u4fdd \u6570\u636e\u5df2\u5b58\u50a8\u4e14\u4ec5\u5b58\u50a8\u4e00\u6b21\u3002\u8fd9\u662f HTML \u8868\u5355\u901a\u5e38\u53d1\u9001\u6570\u636e\u5230\u670d\u52a1\u5668\u7684\u65b9\u6cd5\u3002 PUT \u7c7b\u4f3c POST \u4f46\u662f\u670d\u52a1\u5668\u53ef\u80fd\u89e6\u53d1\u4e86\u5b58\u50a8\u8fc7\u7a0b\u591a\u6b21\uff0c\u591a\u6b21\u8986\u76d6\u6389\u65e7\u503c\u3002\u4f60\u53ef \u80fd\u4f1a\u95ee\u8fd9\u6709\u4ec0\u4e48\u7528\uff0c\u5f53\u7136\u8fd9\u662f\u6709\u539f\u56e0\u7684\u3002\u8003\u8651\u5230\u4f20\u8f93\u4e2d\u8fde\u63a5\u53ef\u80fd\u4f1a\u4e22\u5931\uff0c\u5728 \u8fd9\u79cd \u60c5\u51b5\u4e0b\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u7cfb\u7edf\u53ef\u80fd\u5b89\u5168\u5730\u7b2c\u4e8c\u6b21\u63a5\u6536\u8bf7\u6c42\uff0c\u800c \u4e0d\u7834\u574f\u5176\u5b83\u4e1c\u897f\u3002\u56e0\u4e3a POST \u5b83\u53ea\u89e6\u53d1\u4e00\u6b21\uff0c\u6240\u4ee5\u7528 POST \u662f\u4e0d\u53ef\u80fd\u7684\u3002 DELETE \u5220\u9664\u7ed9\u5b9a\u4f4d\u7f6e\u7684\u4fe1\u606f\u3002 3.2 \u6d4b\u8bd5 \u00b6 root@leco:~/code/flask# curl 127.0.0.1:7000/login GET root@leco:~/code/flask# curl 127.0.0.1:7000/login -d 'title=\"cmz\"' POST","title":"3. \u8def\u7531"},{"location":"python/flask/flask.view/#1-mtv","text":"\u5728\u5f00\u59cbflask\u7684\u8def\u7531\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u8bf4\u4e0b\uff0c\u8457\u540d\u7684MVC\u6a21\u5f0f\uff1a\u6240\u8c13MVC\u5c31\u662f\u628aweb\u5e94\u7528\u5206\u4e3a\u6a21\u578b(M),\u63a7\u5236\u5668(C),\u89c6\u56fe(V)\u4e09\u5c42\uff1b\u4ed6\u4eec\u4e4b\u95f4\u4ee5\u4e00\u79cd\u63d2\u4ef6\u4f3c\u7684\uff0c\u677e\u8026\u5408\u7684\u65b9\u5f0f\u8fde\u63a5\u5728\u4e00\u8d77\u3002 \u6a21\u578b\u8d1f\u8d23\u4e1a\u52a1\u5bf9\u8c61\u4e0e\u6570\u636e\u5e93\u7684\u5bf9\u8c61(ORM),\u89c6\u56fe\u8d1f\u8d23\u4e0e\u7528\u6237\u7684\u4ea4\u4e92(\u9875\u9762)\uff0c\u63a7\u5236\u5668(C)\u63a5\u53d7\u7528\u6237\u7684\u8f93\u5165\u8c03\u7528\u6a21\u578b\u548c\u89c6\u56fe\u5b8c\u6210\u7528\u6237\u7684\u8bf7\u6c42\u3002 \u4e00\u4e2a\u89c6\u56fe\u51fd\u6570\uff08\u7c7b\uff09\uff0c\u7b80\u79f0\u89c6\u56fe\uff0c\u662f\u4e00\u4e2a\u7b80\u5355\u7684Python \u51fd\u6570\uff08\u7c7b\uff09\uff0c\u5b83\u63a5\u53d7Web\u8bf7\u6c42\u5e76\u4e14\u8fd4\u56deWeb\u54cd\u5e94\u3002\u54cd\u5e94\u53ef\u4ee5\u662f\u4e00\u5f20\u7f51\u9875\u7684HTML\u5185\u5bb9\uff0c\u4e00\u4e2a\u91cd\u5b9a\u5411\uff0c\u4e00\u4e2a404\u9519\u8bef\uff0c\u4e00\u4e2aXML\u6587\u6863\uff0c\u6216\u8005\u4e00\u5f20\u56fe\u7247\u3002\u65e0\u8bba\u89c6\u56fe\u672c\u8eab\u5305\u542b\u4ec0\u4e48\u903b\u8f91\uff0c\u90fd\u8981\u8fd4\u56de\u54cd\u5e94\u3002\u4ee3\u7801\u5199\u5728\u54ea\u91cc\u4e5f\u65e0\u6240\u8c13\uff0c\u53ea\u8981\u5b83\u5728\u4f60\u5f53\u524d\u9879\u76ee\u76ee\u5f55\u4e0b\u9762\u3002\u9664\u6b64\u4e4b\u5916\u6ca1\u6709\u66f4\u591a\u7684\u8981\u6c42\u4e86\u2014\u2014\u53ef\u4ee5\u8bf4\u201c\u6ca1\u6709\u4ec0\u4e48\u795e\u5947\u7684\u5730\u65b9\u201d\u3002","title":"1. MTV"},{"location":"python/flask/flask.view/#11-mtv","text":"\u4ee5\u4e0b\u662fdjango\u7684\u67b6\u6784\u56fe\u3002 Model(\u6a21\u578b)\uff1a\u8d1f\u8d23\u4e1a\u52a1\u5bf9\u8c61\u4e0e\u6570\u636e\u5e93\u7684\u5bf9\u8c61(ORM) Template(\u6a21\u7248)\uff1a\u8d1f\u8d23\u5982\u4f55\u628a\u9875\u9762\u5c55\u793a\u7ed9\u7528\u6237 View(\u89c6\u56fe)\uff1a\u8d1f\u8d23\u4e1a\u52a1\u903b\u8f91\uff0c\u5e76\u5728\u9002\u5f53\u7684\u65f6\u5019\u8c03\u7528Model\u548cTemplate","title":"1.1 MTV"},{"location":"python/flask/flask.view/#2-flask","text":"Flask \u7684 URL \u89c4\u5219\u57fa\u4e8e Werkzeug \u7684\u8def\u7531\u6a21\u5757\u3002\u8fd9\u4e2a\u6a21\u5757\u80cc\u540e\u7684\u601d\u60f3\u662f\u57fa\u4e8e Apache \u4ee5\u53ca\u66f4\u65e9\u7684 HTTP \u670d\u52a1\u5668\u4e3b\u5f20\u7684\u5148\u4f8b\uff0c\u4fdd\u8bc1\u4f18\u96c5\u4e14\u552f\u4e00\u7684 URL\u3002","title":"2. flask\u52a8\u6001\u8def\u7531"},{"location":"python/flask/flask.view/#21","text":"\u5927\u81f4\u5206\u4ee5\u4e0b\u51e0\u7c7b # 1. \u63a5\u6536\u5b57\u7b26\u4e32\u7c7b\u578b\u53c2\u6570 @app.route('/user/<name>') # 2. \u63a5\u6536\u6574\u578b\u6570\u5b57\u53c2\u6570 @app.route('/<int:age>') # 3. \u63a5\u6536\u6d6e\u70b9\u578b\u6570\u5b57\u53c2\u6570 @app.route('/<float:salary>') # 4. \u63a5\u6536URL\u94fe\u63a5\u7c7b\u578b\u53c2\u6570 @app.route('/<path:path>') \u89e3\u91ca int \u63a5\u53d7\u6574\u6570 float \u540c int \uff0c\u4f46\u662f\u63a5\u53d7\u6d6e\u70b9\u6570 path \u548c\u9ed8\u8ba4\u7684\u76f8\u4f3c\uff0c\u4f46\u4e5f\u63a5\u53d7\u659c\u7ebf \u8981\u7ed9 URL \u6dfb\u52a0\u53d8\u91cf\u90e8\u5206\uff0c\u4f60\u53ef\u4ee5\u628a\u8fd9\u4e9b\u7279\u6b8a\u7684\u5b57\u6bb5\u6807\u8bb0\u4e3a < variable_name > \uff0c \u8fd9\u4e2a\u90e8\u5206\u5c06\u4f1a\u4f5c\u4e3a\u547d\u540d\u53c2\u6570\u4f20\u9012\u5230\u4f60\u7684\u51fd\u6570\u3002\u89c4\u5219\u53ef\u4ee5\u7528 < converter : variable_name > \u6307\u5b9a\u4e00\u4e2a\u53ef\u9009\u7684\u8f6c\u6362\u5668\u3002","title":"2.1 \u53c2\u6570"},{"location":"python/flask/flask.view/#22-code","text":"#!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/3/3 22:12 @File : url_demo.py @Software: PyCharm @author : caimengzhi \"\"\" from flask import Flask app = Flask(__name__) @app.route('/<name>') # \u8bbe\u7f6eurl\u4f20\u53c2\u6570 http://127.0.0.1:7000/cmz def first_flask(name): # \u89c6\u56fe\u5fc5\u987b\u6709\u5bf9\u5e94\u63a5\u6536\u53c2\u6570 print(name) return 'Hello {}'.format(name) @app.route('/<int:age>/') # \u8bbe\u7f6eurl\u4f20\u53c2\u6570 http://127.0.0.1:7000/30 def second_flask(age): # \u89c6\u56fe\u5fc5\u987b\u6709\u5bf9\u5e94\u63a5\u6536\u53c2\u6570 print(age) return 'my age is '.format(age) @app.route('/<float:salary>/') # \u8bbe\u7f6eurl\u4f20\u53c2\u6570 http://127.0.0.1:7000/88.88 def three_flask(salary): # \u89c6\u56fe\u5fc5\u987b\u6709\u5bf9\u5e94\u63a5\u6536\u53c2\u6570 print(salary) return 'my salary is {}'.format(salary) @app.route('/<path:url>/') # \u8bbe\u7f6eurl\u4f20\u53c2\u6570 http://127.0.0.1:7000/http://www.jd.com def four_flask(url): # \u89c6\u56fe\u5fc5\u987b\u6709\u5bf9\u5e94\u63a5\u6536\u53c2\u6570 print(url) return 'my url {}'.format(url) if __name__ == '__main__': app.run('0.0.0.0', 7000, debug=True)","title":"2.2 code"},{"location":"python/flask/flask.view/#23","text":"\u6d4b\u8bd5 name \u5f53\u95ee\u6211\u4eec 127.0.0.1:7000/cmz\uff0cflask\u5339\u914d\u7684\u662f @app.route('/<name>') \uff0c\u6b64\u65f6\u5019\u6d4f\u89c8\u5668\u4f1a\u663e\u793a hello cmz\uff0c\u4e5f\u5c31\u662f\u540e\u9762\u7684\u4f4d\u7f6e\u662fstring\u90fd\u662f\u663e\u793a\u3002 \u6d4b\u8bd5age \u5f53\u95ee\u6211\u4eec 127.0.0.1:7000/30\uff0cflask\u5339\u914d\u7684\u662f @app.route('/<int:age>') \uff0c\u6b64\u65f6\u5019\u6d4f\u89c8\u5668\u4f1a\u663e\u793a my age 30\uff0c\u4e5f\u5c31\u662f\u540e\u9762\u7684\u4f4d\u7f6e\u662f\u6574\u6570\u6570\u5b57\u90fd\u662f\u663e\u793a \u6d4b\u8bd5salary \u5f53\u95ee\u6211\u4eec 127.0.0.1:7000/88.88\uff0cflask\u5339\u914d\u7684\u662f @app.route('/<float:salary>') \uff0c\u6b64\u65f6\u5019\u6d4f\u89c8\u5668\u4f1a\u663e\u793a my salary is 88.88\uff0c\u4e5f\u5c31\u662f\u540e\u9762\u7684\u4f4d\u7f6e\u662f\u6d6e\u70b9\u6570\u5b57\u90fd\u662f\u663e\u793a \u6d4b\u8bd5url \u5f53\u95ee\u6211\u4eec 127.0.0.1:7000/ http://www.jd.com \uff0cflask\u5339\u914d\u7684\u662f @app.route('/<path:url>') \uff0c\u6b64\u65f6\u5019\u6d4f\u89c8\u5668\u4f1a\u663e\u793amy url http://www.jd.com \uff0c\u4e5f\u5c31\u662f\u540e\u9762\u7684\u4f4d\u7f6e\u662furl\u5730\u5740","title":"2.3 \u6d4b\u8bd5"},{"location":"python/flask/flask.view/#3-http","text":"HTTP \uff08\u4e0e Web \u5e94\u7528\u4f1a\u8bdd\u7684\u534f\u8bae\uff09\u6709\u8bb8\u591a\u4e0d\u540c\u7684\u8bbf\u95ee URL \u65b9\u6cd5\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8def\u7531\u53ea\u56de\u5e94 GET \u8bf7\u6c42\uff0c\u4f46\u662f\u901a\u8fc7 route() \u88c5\u9970\u5668\u4f20\u9012 methods \u53c2\u6570\u53ef\u4ee5\u6539\u53d8\u8fd9\u4e2a\u884c\u4e3a\u3002\u8fd9\u91cc\u6709\u4e00\u4e9b\u4f8b\u5b50:","title":"3. HTTP\u65b9\u6cd5"},{"location":"python/flask/flask.view/#31","text":"#!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/3/3 22:12 @File : url_demo.py @Software: PyCharm @author : caimengzhi \"\"\" from flask import Flask, request app = Flask(__name__) @app.route('/login', methods=['GET', 'POST']) def login(): if request.method == 'POST': return \"POST\" elif request.method == \"GET\": return \"GET\" else: return \"NO POST,GET\" if __name__ == '__main__': app.run('0.0.0.0', 7000, debug=True) \u5982\u679c\u5b58\u5728 GET \uff0c\u90a3\u4e48\u4e5f\u4f1a\u66ff\u4f60\u81ea\u52a8\u5730\u6dfb\u52a0 HEAD\uff0c\u65e0\u9700\u5e72\u9884\u3002\u5b83\u4f1a\u786e\u4fdd\u9075\u7167 HTTP RFC \uff08\u63cf\u8ff0 HTTP \u534f\u8bae\u7684\u6587\u6863\uff09\u5904\u7406 HEAD \u8bf7\u6c42\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u5b8c\u5168\u5ffd\u7565\u8fd9\u90e8\u5206\u7684 HTTP \u89c4\u8303\u3002\u540c\u6837\uff0c\u81ea\u4ece Flask 0.6 \u8d77\uff0c \u4e5f\u5b9e\u73b0\u4e86 OPTIONS \u7684\u81ea\u52a8\u5904\u7406\u3002\u4ee5\u4e0b\u662f\u5e38\u89c1\u7684\uff1a \u65b9\u6cd5 \u63cf\u8ff0 GET \u6d4f\u89c8\u5668\u544a\u77e5\u670d\u52a1\u5668\uff1a\u53ea \u83b7\u53d6 \u9875\u9762\u4e0a\u7684\u4fe1\u606f\u5e76\u53d1\u7ed9\u6211\u3002\u8fd9\u662f\u6700\u5e38\u7528\u7684\u65b9\u6cd5\u3002 HEAD \u6d4f\u89c8\u5668\u544a\u8bc9\u670d\u52a1\u5668\uff1a\u6b32\u83b7\u53d6\u4fe1\u606f\uff0c\u4f46\u662f\u53ea\u5173\u5fc3 \u6d88\u606f\u5934 \u3002\u5e94\u7528\u5e94\u50cf\u5904\u7406 GET \u8bf7\u6c42\u4e00\u6837\u6765\u5904\u7406\u5b83\uff0c\u4f46\u662f\u4e0d\u5206\u53d1\u5b9e\u9645\u5185\u5bb9\u3002\u5728 Flask \u4e2d\u4f60\u5b8c\u5168\u65e0\u9700 \u4eba\u5de5 \u5e72\u9884\uff0c\u5e95\u5c42\u7684 Werkzeug \u5e93\u5df2\u7ecf\u66ff\u4f60\u6253\u70b9\u597d\u4e86\u3002 POST \u6d4f\u89c8\u5668\u544a\u8bc9\u670d\u52a1\u5668\uff1a\u60f3\u5728 URL \u4e0a \u53d1\u5e03 \u65b0\u4fe1\u606f\u3002\u5e76\u4e14\uff0c\u670d\u52a1\u5668\u5fc5\u987b\u786e\u4fdd \u6570\u636e\u5df2\u5b58\u50a8\u4e14\u4ec5\u5b58\u50a8\u4e00\u6b21\u3002\u8fd9\u662f HTML \u8868\u5355\u901a\u5e38\u53d1\u9001\u6570\u636e\u5230\u670d\u52a1\u5668\u7684\u65b9\u6cd5\u3002 PUT \u7c7b\u4f3c POST \u4f46\u662f\u670d\u52a1\u5668\u53ef\u80fd\u89e6\u53d1\u4e86\u5b58\u50a8\u8fc7\u7a0b\u591a\u6b21\uff0c\u591a\u6b21\u8986\u76d6\u6389\u65e7\u503c\u3002\u4f60\u53ef \u80fd\u4f1a\u95ee\u8fd9\u6709\u4ec0\u4e48\u7528\uff0c\u5f53\u7136\u8fd9\u662f\u6709\u539f\u56e0\u7684\u3002\u8003\u8651\u5230\u4f20\u8f93\u4e2d\u8fde\u63a5\u53ef\u80fd\u4f1a\u4e22\u5931\uff0c\u5728 \u8fd9\u79cd \u60c5\u51b5\u4e0b\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u7cfb\u7edf\u53ef\u80fd\u5b89\u5168\u5730\u7b2c\u4e8c\u6b21\u63a5\u6536\u8bf7\u6c42\uff0c\u800c \u4e0d\u7834\u574f\u5176\u5b83\u4e1c\u897f\u3002\u56e0\u4e3a POST \u5b83\u53ea\u89e6\u53d1\u4e00\u6b21\uff0c\u6240\u4ee5\u7528 POST \u662f\u4e0d\u53ef\u80fd\u7684\u3002 DELETE \u5220\u9664\u7ed9\u5b9a\u4f4d\u7f6e\u7684\u4fe1\u606f\u3002","title":"3.1 \u4ee3\u7801\u6a21\u62df"},{"location":"python/flask/flask.view/#32","text":"root@leco:~/code/flask# curl 127.0.0.1:7000/login GET root@leco:~/code/flask# curl 127.0.0.1:7000/login -d 'title=\"cmz\"' POST","title":"3.2 \u6d4b\u8bd5"},{"location":"python/lib/LRU/LRU.index/","text":"Python LRU 1. \u4ecb\u7ecd \u00b6 \u5185\u5b58\u7ba1\u7406\u7684\u4e00\u79cd\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\uff0c\u5bf9\u4e8e\u5728\u5185\u5b58\u4e2d\u4f46\u53c8\u4e0d\u7528\u7684\u6570\u636e\u5757\uff08\u5185\u5b58\u5757\uff09\u53eb\u505aLRU\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6839\u636e\u54ea\u4e9b\u6570\u636e\u5c5e\u4e8eLRU\u800c\u5c06\u5176\u79fb\u51fa\u5185\u5b58\u800c\u817e\u51fa\u7a7a\u95f4\u6765\u52a0\u8f7d\u53e6\u5916\u7684\u6570\u636e\u3002 \u4ec0\u4e48\u662fLRU\u7b97\u6cd5\uff1f LRU\u662fLeast Recently Used\u7684\u7f29\u5199\uff0c\u5373\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\uff0c\u5e38\u7528\u4e8e\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\uff0c\u662f\u4e3a\u865a\u62df\u9875\u5f0f\u5b58\u50a8\u7ba1\u7406\u670d\u52a1\u7684\u3002 1.1 \u539f\u7406 \u00b6 \u7b97\u6cd5\u6839\u636e\u6570\u636e\u7684\u5386\u53f2\u8bbf\u95ee\u8bb0\u5f55\u6765\u8fdb\u884c\u6dd8\u6c70\u6570\u636e\uff0c\u5176\u6838\u5fc3\u601d\u60f3\u662f\u201c\u5982\u679c\u6570\u636e\u6700\u8fd1\u88ab\u8bbf\u95ee\u8fc7\uff0c\u90a3\u4e48\u5c06\u6765\u88ab\u8bbf\u95ee\u7684\u51e0\u7387\u4e5f\u66f4\u9ad8\u201d\u3002 1.2 \u5b9e\u73b0 \u00b6 \u6700\u5e38\u89c1\u7684\u5b9e\u73b0\u662f\u4f7f\u7528\u4e00\u4e2a\u94fe\u8868\u4fdd\u5b58\u7f13\u5b58\u6570\u636e\uff0c\u8be6\u7ec6\u7b97\u6cd5\u5b9e\u73b0\u5982\u4e0b\uff1a \u65b0\u6570\u636e\u63d2\u5165\u5230\u94fe\u8868\u5934\u90e8\uff1b \u6bcf\u5f53\u7f13\u5b58\u547d\u4e2d\uff08\u5373\u7f13\u5b58\u6570\u636e\u88ab\u8bbf\u95ee\uff09\uff0c\u5219\u5c06\u6570\u636e\u79fb\u5230\u94fe\u8868\u5934\u90e8\uff1b \u5f53\u94fe\u8868\u6ee1\u7684\u65f6\u5019\uff0c\u5c06\u94fe\u8868\u5c3e\u90e8\u7684\u6570\u636e\u4e22\u5f03\u3002 1.3 \u5206\u6790 \u00b6 1.3.1 \u547d\u4e2d\u7387 \u00b6 \u5f53\u5b58\u5728\u70ed\u70b9\u6570\u636e\u65f6\uff0cLRU\u7684\u6548\u7387\u5f88\u597d\uff0c\u4f46\u5076\u53d1\u6027\u7684\u3001\u5468\u671f\u6027\u7684\u6279\u91cf\u64cd\u4f5c\u4f1a\u5bfc\u81f4LRU\u547d\u4e2d\u7387\u6025\u5267\u4e0b\u964d\uff0c\u7f13\u5b58\u6c61\u67d3\u60c5\u51b5\u6bd4\u8f83\u4e25\u91cd\u3002 1.3.2 \u590d\u6742\u5ea6 \u00b6 \u5b9e\u73b0\u7b80\u5355\u3002 1.3.3 \u5f00\u9500 \u00b6 \u547d\u4e2d\u65f6\u9700\u8981\u904d\u5386\u94fe\u8868\uff0c\u627e\u5230\u547d\u4e2d\u7684\u6570\u636e\u5757\u7d22\u5f15\uff0c\u7136\u540e\u9700\u8981\u5c06\u6570\u636e\u79fb\u5230\u5934\u90e8\u3002 2. \u8be6\u7ec6\u89e3\u91ca\u8fc7\u7a0b \u00b6 2.1 \u54c8\u5e0c\u8868 \u00b6 \u4ec0\u4e48\u662f\u54c8\u5e0c\u94fe\u8868\u5462\uff1f \u6211\u4eec\u90fd\u77e5\u9053\uff0c\u54c8\u5e0c\u8868\u662f\u7531\u82e5\u5e72\u4e2aKey-Value\u6240\u7ec4\u6210\u3002\u5728\u201c\u903b\u8f91\u201d\u4e0a\uff0c\u8fd9\u4e9bKey-Value\u662f\u65e0\u6240\u8c13\u6392\u5217\u987a\u5e8f\u7684\uff0c\u8c01\u5148\u8c01\u540e\u90fd\u4e00\u6837\u3002 \u5728\u54c8\u5e0c\u94fe\u8868\u5f53\u4e2d\uff0c\u8fd9\u4e9bKey-Value\u4e0d\u518d\u662f\u5f7c\u6b64\u65e0\u5173\u7684\u5b58\u5728\uff0c\u800c\u662f\u88ab\u4e00\u4e2a\u94fe\u6761\u4e32\u4e86\u8d77\u6765\u3002\u6bcf\u4e00\u4e2aKey-Value\u90fd\u5177\u6709\u5b83\u7684\u524d\u9a71Key-Value\u3001\u540e\u7ee7Key-Value\uff0c\u5c31\u50cf\u53cc\u5411\u94fe\u8868\u4e2d\u7684\u8282\u70b9\u4e00\u6837\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u539f\u672c\u65e0\u5e8f\u7684\u54c8\u5e0c\u8868\u62e5\u6709\u4e86\u56fa\u5b9a\u7684\u6392\u5217\u987a\u5e8f\u3002 2.2 \u89e3\u91caLRU\u8fc7\u7a0b \u00b6 \u8ba9\u6211\u4eec\u4ee5\u7528\u6237\u4fe1\u606f\u7684\u9700\u6c42\u4e3a\u4f8b\uff0c\u6765\u6f14\u793a\u4e00\u4e0bLRU\u7b97\u6cd5\u7684\u57fa\u672c\u601d\u8def\uff1a 1.\u5047\u8bbe\u6211\u4eec\u4f7f\u7528\u54c8\u5e0c\u94fe\u8868\u6765\u7f13\u5b58\u7528\u6237\u4fe1\u606f\uff0c\u76ee\u524d\u7f13\u5b58\u4e864\u4e2a\u7528\u6237\uff0c\u8fd94\u4e2a\u7528\u6237\u662f\u6309\u7167\u65f6\u95f4\u987a\u5e8f\u4f9d\u6b21\u4ece\u94fe\u8868\u53f3\u7aef\u63d2\u5165\u7684\u3002 2.\u6b64\u65f6\uff0c\u4e1a\u52a1\u65b9\u8bbf\u95ee\u7528\u62375\uff0c\u7531\u4e8e\u54c8\u5e0c\u94fe\u8868\u4e2d\u6ca1\u6709\u7528\u62375\u7684\u6570\u636e\uff0c\u6211\u4eec\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u51fa\u6765\uff0c\u63d2\u5165\u5230\u7f13\u5b58\u5f53\u4e2d\u3002\u8fd9\u65f6\u5019\uff0c\u94fe\u8868\u4e2d\u6700\u53f3\u7aef\u662f\u6700\u65b0\u8bbf\u95ee\u5230\u7684\u7528\u62375\uff0c\u6700\u5de6\u7aef\u662f\u6700\u8fd1\u6700\u5c11\u8bbf\u95ee\u7684\u7528\u62371\u3002 3.\u63a5\u4e0b\u6765\uff0c\u4e1a\u52a1\u65b9\u8bbf\u95ee\u7528\u62372\uff0c\u54c8\u5e0c\u94fe\u8868\u4e2d\u5b58\u5728\u7528\u62372\u7684\u6570\u636e\uff0c\u6211\u4eec\u600e\u4e48\u505a\u5462\uff1f\u6211\u4eec\u628a\u7528\u62372\u4ece\u5b83\u7684\u524d\u9a71\u8282\u70b9\u548c\u540e\u7ee7\u8282\u70b9\u4e4b\u95f4\u79fb\u9664\uff0c\u91cd\u65b0\u63d2\u5165\u5230\u94fe\u8868\u6700\u53f3\u7aef\u3002\u8fd9\u65f6\u5019\uff0c\u94fe\u8868\u4e2d\u6700\u53f3\u7aef\u53d8\u6210\u4e86\u6700\u65b0\u8bbf\u95ee\u5230\u7684\u7528\u62372\uff0c\u6700\u5de6\u7aef\u4ecd\u7136\u662f\u6700\u8fd1\u6700\u5c11\u8bbf\u95ee\u7684\u7528\u62371\u3002 4.\u63a5\u4e0b\u6765\uff0c\u4e1a\u52a1\u65b9\u8bf7\u6c42\u4fee\u6539\u7528\u62374\u7684\u4fe1\u606f\u3002\u540c\u6837\u9053\u7406\uff0c\u6211\u4eec\u628a\u7528\u62374\u4ece\u539f\u6765\u7684\u4f4d\u7f6e\u79fb\u52a8\u5230\u94fe\u8868\u6700\u53f3\u4fa7\uff0c\u5e76\u628a\u7528\u6237\u4fe1\u606f\u7684\u503c\u66f4\u65b0\u3002\u8fd9\u65f6\u5019\uff0c\u94fe\u8868\u4e2d\u6700\u53f3\u7aef\u662f\u6700\u65b0\u8bbf\u95ee\u5230\u7684\u7528\u62374\uff0c\u6700\u5de6\u7aef\u4ecd\u7136\u662f\u6700\u8fd1\u6700\u5c11\u8bbf\u95ee\u7684\u7528\u62371\u3002 5.\u540e\u6765\u4e1a\u52a1\u65b9\u6362\u53e3\u5473\u4e86\uff0c\u8bbf\u95ee\u7528\u62376\uff0c\u7528\u62376\u5728\u7f13\u5b58\u91cc\u6ca1\u6709\uff0c\u9700\u8981\u63d2\u5165\u5230\u54c8\u5e0c\u94fe\u8868\u3002\u5047\u8bbe\u8fd9\u65f6\u5019\u7f13\u5b58\u5bb9\u91cf\u5df2\u7ecf\u8fbe\u5230\u4e0a\u9650\uff0c\u5fc5\u987b\u5148\u5220\u9664\u6700\u8fd1\u6700\u5c11\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u90a3\u4e48\u4f4d\u4e8e\u54c8\u5e0c\u94fe\u8868\u6700\u5de6\u7aef\u7684\u7528\u62371\u5c31\u4f1a\u88ab\u5220\u9664\u6389\uff0c\u7136\u540e\u518d\u628a\u7528\u62376\u63d2\u5165\u5230\u6700\u53f3\u7aef\u3002 \u4ee5\u4e0a\uff0c\u5c31\u662fLRU\u7b97\u6cd5\u7684\u57fa\u672c\u601d\u8def\u3002 3. python code \u00b6 class LRUcache: def __init__(self, size=3): self.cache = {} self.keys = [] self.size = size def get(self, key): if key in self.cache: self.keys.remove(key) self.keys.insert(0, key) return self.cache[key] else: return None def set(self, key, value): if key in self.cache: self.keys.remove(key) self.keys.insert(0, key) self.cache[key] = value elif len(self.keys) == self.size: old = self.keys.pop() self.cache.pop(old) self.keys.insert(0, key) self.cache[key] = value else: self.keys.insert(0, key) self.cache[key] = value if __name__ == '__main__': LRUcache = LRUcache() LRUcache.set('key_name','summer') LRUcache.set('key_age',30) LRUcache.set('key_job','IT') LRUcache.set('key_salary',20000) LRUcache.set('key_hobby','apple') LRUcache.set('key_love','keke') LRUcache.set('key_name','cmz') print(\"key_name = \",LRUcache.get('key_name')) print(\"key_age = \",LRUcache.get('key_age')) print(\"key_job = \",LRUcache.get('key_job')) print(\"key_salary = \",LRUcache.get('key_salary')) print(\"key_hobby = \",LRUcache.get('key_hobby')) print(\"key_love = \",LRUcache.get('key_love')) \u8fd0\u884c\u7ed3\u679c root@leco:~/code/lru# python lru_demo.py key_name = cmz key_age = None key_job = None key_salary = None key_hobby = apple key_love = keke","title":"12. LRU"},{"location":"python/lib/LRU/LRU.index/#1","text":"\u5185\u5b58\u7ba1\u7406\u7684\u4e00\u79cd\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\uff0c\u5bf9\u4e8e\u5728\u5185\u5b58\u4e2d\u4f46\u53c8\u4e0d\u7528\u7684\u6570\u636e\u5757\uff08\u5185\u5b58\u5757\uff09\u53eb\u505aLRU\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6839\u636e\u54ea\u4e9b\u6570\u636e\u5c5e\u4e8eLRU\u800c\u5c06\u5176\u79fb\u51fa\u5185\u5b58\u800c\u817e\u51fa\u7a7a\u95f4\u6765\u52a0\u8f7d\u53e6\u5916\u7684\u6570\u636e\u3002 \u4ec0\u4e48\u662fLRU\u7b97\u6cd5\uff1f LRU\u662fLeast Recently Used\u7684\u7f29\u5199\uff0c\u5373\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\uff0c\u5e38\u7528\u4e8e\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\uff0c\u662f\u4e3a\u865a\u62df\u9875\u5f0f\u5b58\u50a8\u7ba1\u7406\u670d\u52a1\u7684\u3002","title":"1. \u4ecb\u7ecd"},{"location":"python/lib/LRU/LRU.index/#11","text":"\u7b97\u6cd5\u6839\u636e\u6570\u636e\u7684\u5386\u53f2\u8bbf\u95ee\u8bb0\u5f55\u6765\u8fdb\u884c\u6dd8\u6c70\u6570\u636e\uff0c\u5176\u6838\u5fc3\u601d\u60f3\u662f\u201c\u5982\u679c\u6570\u636e\u6700\u8fd1\u88ab\u8bbf\u95ee\u8fc7\uff0c\u90a3\u4e48\u5c06\u6765\u88ab\u8bbf\u95ee\u7684\u51e0\u7387\u4e5f\u66f4\u9ad8\u201d\u3002","title":"1.1 \u539f\u7406"},{"location":"python/lib/LRU/LRU.index/#12","text":"\u6700\u5e38\u89c1\u7684\u5b9e\u73b0\u662f\u4f7f\u7528\u4e00\u4e2a\u94fe\u8868\u4fdd\u5b58\u7f13\u5b58\u6570\u636e\uff0c\u8be6\u7ec6\u7b97\u6cd5\u5b9e\u73b0\u5982\u4e0b\uff1a \u65b0\u6570\u636e\u63d2\u5165\u5230\u94fe\u8868\u5934\u90e8\uff1b \u6bcf\u5f53\u7f13\u5b58\u547d\u4e2d\uff08\u5373\u7f13\u5b58\u6570\u636e\u88ab\u8bbf\u95ee\uff09\uff0c\u5219\u5c06\u6570\u636e\u79fb\u5230\u94fe\u8868\u5934\u90e8\uff1b \u5f53\u94fe\u8868\u6ee1\u7684\u65f6\u5019\uff0c\u5c06\u94fe\u8868\u5c3e\u90e8\u7684\u6570\u636e\u4e22\u5f03\u3002","title":"1.2 \u5b9e\u73b0"},{"location":"python/lib/LRU/LRU.index/#13","text":"","title":"1.3 \u5206\u6790"},{"location":"python/lib/LRU/LRU.index/#131","text":"\u5f53\u5b58\u5728\u70ed\u70b9\u6570\u636e\u65f6\uff0cLRU\u7684\u6548\u7387\u5f88\u597d\uff0c\u4f46\u5076\u53d1\u6027\u7684\u3001\u5468\u671f\u6027\u7684\u6279\u91cf\u64cd\u4f5c\u4f1a\u5bfc\u81f4LRU\u547d\u4e2d\u7387\u6025\u5267\u4e0b\u964d\uff0c\u7f13\u5b58\u6c61\u67d3\u60c5\u51b5\u6bd4\u8f83\u4e25\u91cd\u3002","title":"1.3.1 \u547d\u4e2d\u7387"},{"location":"python/lib/LRU/LRU.index/#132","text":"\u5b9e\u73b0\u7b80\u5355\u3002","title":"1.3.2 \u590d\u6742\u5ea6"},{"location":"python/lib/LRU/LRU.index/#133","text":"\u547d\u4e2d\u65f6\u9700\u8981\u904d\u5386\u94fe\u8868\uff0c\u627e\u5230\u547d\u4e2d\u7684\u6570\u636e\u5757\u7d22\u5f15\uff0c\u7136\u540e\u9700\u8981\u5c06\u6570\u636e\u79fb\u5230\u5934\u90e8\u3002","title":"1.3.3 \u5f00\u9500"},{"location":"python/lib/LRU/LRU.index/#2","text":"","title":"2. \u8be6\u7ec6\u89e3\u91ca\u8fc7\u7a0b"},{"location":"python/lib/LRU/LRU.index/#21","text":"\u4ec0\u4e48\u662f\u54c8\u5e0c\u94fe\u8868\u5462\uff1f \u6211\u4eec\u90fd\u77e5\u9053\uff0c\u54c8\u5e0c\u8868\u662f\u7531\u82e5\u5e72\u4e2aKey-Value\u6240\u7ec4\u6210\u3002\u5728\u201c\u903b\u8f91\u201d\u4e0a\uff0c\u8fd9\u4e9bKey-Value\u662f\u65e0\u6240\u8c13\u6392\u5217\u987a\u5e8f\u7684\uff0c\u8c01\u5148\u8c01\u540e\u90fd\u4e00\u6837\u3002 \u5728\u54c8\u5e0c\u94fe\u8868\u5f53\u4e2d\uff0c\u8fd9\u4e9bKey-Value\u4e0d\u518d\u662f\u5f7c\u6b64\u65e0\u5173\u7684\u5b58\u5728\uff0c\u800c\u662f\u88ab\u4e00\u4e2a\u94fe\u6761\u4e32\u4e86\u8d77\u6765\u3002\u6bcf\u4e00\u4e2aKey-Value\u90fd\u5177\u6709\u5b83\u7684\u524d\u9a71Key-Value\u3001\u540e\u7ee7Key-Value\uff0c\u5c31\u50cf\u53cc\u5411\u94fe\u8868\u4e2d\u7684\u8282\u70b9\u4e00\u6837\u3002 \u8fd9\u6837\u4e00\u6765\uff0c\u539f\u672c\u65e0\u5e8f\u7684\u54c8\u5e0c\u8868\u62e5\u6709\u4e86\u56fa\u5b9a\u7684\u6392\u5217\u987a\u5e8f\u3002","title":"2.1 \u54c8\u5e0c\u8868"},{"location":"python/lib/LRU/LRU.index/#22-lru","text":"\u8ba9\u6211\u4eec\u4ee5\u7528\u6237\u4fe1\u606f\u7684\u9700\u6c42\u4e3a\u4f8b\uff0c\u6765\u6f14\u793a\u4e00\u4e0bLRU\u7b97\u6cd5\u7684\u57fa\u672c\u601d\u8def\uff1a 1.\u5047\u8bbe\u6211\u4eec\u4f7f\u7528\u54c8\u5e0c\u94fe\u8868\u6765\u7f13\u5b58\u7528\u6237\u4fe1\u606f\uff0c\u76ee\u524d\u7f13\u5b58\u4e864\u4e2a\u7528\u6237\uff0c\u8fd94\u4e2a\u7528\u6237\u662f\u6309\u7167\u65f6\u95f4\u987a\u5e8f\u4f9d\u6b21\u4ece\u94fe\u8868\u53f3\u7aef\u63d2\u5165\u7684\u3002 2.\u6b64\u65f6\uff0c\u4e1a\u52a1\u65b9\u8bbf\u95ee\u7528\u62375\uff0c\u7531\u4e8e\u54c8\u5e0c\u94fe\u8868\u4e2d\u6ca1\u6709\u7528\u62375\u7684\u6570\u636e\uff0c\u6211\u4eec\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u51fa\u6765\uff0c\u63d2\u5165\u5230\u7f13\u5b58\u5f53\u4e2d\u3002\u8fd9\u65f6\u5019\uff0c\u94fe\u8868\u4e2d\u6700\u53f3\u7aef\u662f\u6700\u65b0\u8bbf\u95ee\u5230\u7684\u7528\u62375\uff0c\u6700\u5de6\u7aef\u662f\u6700\u8fd1\u6700\u5c11\u8bbf\u95ee\u7684\u7528\u62371\u3002 3.\u63a5\u4e0b\u6765\uff0c\u4e1a\u52a1\u65b9\u8bbf\u95ee\u7528\u62372\uff0c\u54c8\u5e0c\u94fe\u8868\u4e2d\u5b58\u5728\u7528\u62372\u7684\u6570\u636e\uff0c\u6211\u4eec\u600e\u4e48\u505a\u5462\uff1f\u6211\u4eec\u628a\u7528\u62372\u4ece\u5b83\u7684\u524d\u9a71\u8282\u70b9\u548c\u540e\u7ee7\u8282\u70b9\u4e4b\u95f4\u79fb\u9664\uff0c\u91cd\u65b0\u63d2\u5165\u5230\u94fe\u8868\u6700\u53f3\u7aef\u3002\u8fd9\u65f6\u5019\uff0c\u94fe\u8868\u4e2d\u6700\u53f3\u7aef\u53d8\u6210\u4e86\u6700\u65b0\u8bbf\u95ee\u5230\u7684\u7528\u62372\uff0c\u6700\u5de6\u7aef\u4ecd\u7136\u662f\u6700\u8fd1\u6700\u5c11\u8bbf\u95ee\u7684\u7528\u62371\u3002 4.\u63a5\u4e0b\u6765\uff0c\u4e1a\u52a1\u65b9\u8bf7\u6c42\u4fee\u6539\u7528\u62374\u7684\u4fe1\u606f\u3002\u540c\u6837\u9053\u7406\uff0c\u6211\u4eec\u628a\u7528\u62374\u4ece\u539f\u6765\u7684\u4f4d\u7f6e\u79fb\u52a8\u5230\u94fe\u8868\u6700\u53f3\u4fa7\uff0c\u5e76\u628a\u7528\u6237\u4fe1\u606f\u7684\u503c\u66f4\u65b0\u3002\u8fd9\u65f6\u5019\uff0c\u94fe\u8868\u4e2d\u6700\u53f3\u7aef\u662f\u6700\u65b0\u8bbf\u95ee\u5230\u7684\u7528\u62374\uff0c\u6700\u5de6\u7aef\u4ecd\u7136\u662f\u6700\u8fd1\u6700\u5c11\u8bbf\u95ee\u7684\u7528\u62371\u3002 5.\u540e\u6765\u4e1a\u52a1\u65b9\u6362\u53e3\u5473\u4e86\uff0c\u8bbf\u95ee\u7528\u62376\uff0c\u7528\u62376\u5728\u7f13\u5b58\u91cc\u6ca1\u6709\uff0c\u9700\u8981\u63d2\u5165\u5230\u54c8\u5e0c\u94fe\u8868\u3002\u5047\u8bbe\u8fd9\u65f6\u5019\u7f13\u5b58\u5bb9\u91cf\u5df2\u7ecf\u8fbe\u5230\u4e0a\u9650\uff0c\u5fc5\u987b\u5148\u5220\u9664\u6700\u8fd1\u6700\u5c11\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u90a3\u4e48\u4f4d\u4e8e\u54c8\u5e0c\u94fe\u8868\u6700\u5de6\u7aef\u7684\u7528\u62371\u5c31\u4f1a\u88ab\u5220\u9664\u6389\uff0c\u7136\u540e\u518d\u628a\u7528\u62376\u63d2\u5165\u5230\u6700\u53f3\u7aef\u3002 \u4ee5\u4e0a\uff0c\u5c31\u662fLRU\u7b97\u6cd5\u7684\u57fa\u672c\u601d\u8def\u3002","title":"2.2 \u89e3\u91caLRU\u8fc7\u7a0b"},{"location":"python/lib/LRU/LRU.index/#3-python-code","text":"class LRUcache: def __init__(self, size=3): self.cache = {} self.keys = [] self.size = size def get(self, key): if key in self.cache: self.keys.remove(key) self.keys.insert(0, key) return self.cache[key] else: return None def set(self, key, value): if key in self.cache: self.keys.remove(key) self.keys.insert(0, key) self.cache[key] = value elif len(self.keys) == self.size: old = self.keys.pop() self.cache.pop(old) self.keys.insert(0, key) self.cache[key] = value else: self.keys.insert(0, key) self.cache[key] = value if __name__ == '__main__': LRUcache = LRUcache() LRUcache.set('key_name','summer') LRUcache.set('key_age',30) LRUcache.set('key_job','IT') LRUcache.set('key_salary',20000) LRUcache.set('key_hobby','apple') LRUcache.set('key_love','keke') LRUcache.set('key_name','cmz') print(\"key_name = \",LRUcache.get('key_name')) print(\"key_age = \",LRUcache.get('key_age')) print(\"key_job = \",LRUcache.get('key_job')) print(\"key_salary = \",LRUcache.get('key_salary')) print(\"key_hobby = \",LRUcache.get('key_hobby')) print(\"key_love = \",LRUcache.get('key_love')) \u8fd0\u884c\u7ed3\u679c root@leco:~/code/lru# python lru_demo.py key_name = cmz key_age = None key_job = None key_salary = None key_hobby = apple key_love = keke","title":"3. python code"},{"location":"python/lib/SQLAlchemy/1.\u521b\u5efa\u8868/","text":"\u901a\u8fc7sql\u5efa\u8868 from sqlalchemy import create_engine from sqlalchemy.orm import sessionmaker sql = '''create table test1( id int not null primary key, name varchar(50), age int, address varchar(100)); ''' engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8', echo=False) conn = engine.connect() conn.execute(sql) engine.connect() # \u8868\u793a\u83b7\u53d6\u5230\u6570\u636e\u5e93\u8fde\u63a5\u3002\u7c7b\u4f3c\u6211\u4eec\u5728MySQLdb\u4e2d\u6e38\u6807course\u7684\u4f5c\u7528\u3002 \u67e5\u770bMySQL mysql> show tables like 'test1'; +-----------------------+ | Tables_in_cmz (test1) | +-----------------------+ | test1 | +-----------------------+ 1 row in set (0.00 sec) mysql> desc test1; +---------+--------------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +---------+--------------+------+-----+---------+-------+ | id | int(11) | NO | PRI | NULL | | | name | varchar(50) | YES | | NULL | | | age | int(11) | YES | | NULL | | | address | varchar(100) | YES | | NULL | | +---------+--------------+------+-----+---------+-------+ 4 rows in set (0.01 sec) \u901a\u8fc7ORM\u5efa\u8868 from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String from sqlalchemy.orm import sessionmaker engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8', echo=True) # echo=True\uff0c\u5c31\u662f\u628a\u6574\u4e2a\u8fc7\u7a0b\u6253\u5370\u51fa\u6765 Base = declarative_base() # \u751f\u6210ORM\u57fa\u7c7b class Test2(Base): __tablename__ = 'test2' # \u8868\u540d id = Column(Integer, primary_key=True) # \u5b57\u6bb5\uff0c\u6574\u5f62\uff0c\u4e3b\u952e column\u662f\u5bfc\u5165\u7684 name = Column(String(32)) password = Column(String(64)) # \u521b\u5efa\u8868\u7ed3\u6784 Base.metadata.create_all(engine) \u67e5\u770bMySQL mysql> show tables like 'test2'; +-----------------------+ | Tables_in_cmz (test2) | +-----------------------+ | test2 | +-----------------------+ 1 row in set (0.00 sec) mysql> desc test2; +----------+-------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +----------+-------------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | varchar(32) | YES | | NULL | | | password | varchar(64) | YES | | NULL | | +----------+-------------+------+-----+---------+----------------+ 3 rows in set (0.01 sec)","title":"1. \u521b\u5efa\u8868"},{"location":"python/lib/SQLAlchemy/2.\u57fa\u672c\u64cd\u4f5c/","text":"Note \u6ce8\u610f \u4ee5\u4e0b\u4ee3\u7801\u57fa\u4e8ePython3.6 \u4ee5\u524d\u6211\u4eec\u5e38\u7528pymysql\u6765\u64cd\u4f5c\u6570\u636e\u5e93\uff0c\u4e3e\u4e2a\u6817\u5b50 #!/usr/bin/env python # -*- coding:utf-8 -*- # Author: loocha import pymysql #\u521b\u5efa\u8fde\u63a5 conn = pymysql.connect(host='127.0.0.1',port=3306,user='root',passwd='root',db='cmz') #\u521b\u5efa\u6e38\u6807 socket\u4e0a\u5efa\u7acb\u7684\u5b9e\u4f8b cursor=conn.cursor() #\u6267\u884cSQL\uff0c\u5e76\u8fd4\u56de\u884c\u6570,\u7528\u6e38\u6807\u6267\u884c\uff0c effect_row = cursor.execute(\"select * from user\") # print(cursor.fetchone()) # print(cursor.fetchone()) print(cursor.fetchall()) \u8fd0\u884c\u7ed3\u679c ((1, 'loocha', '123'), (2, 'realcloud', '123')) \u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u6570\u636e\u5168\u90e8\u53d6\u51fa\u6765\u3002 \u63d2\u5165\u6570\u636e\u5462\uff1f # !/usr/bin/env python # -*- coding:utf-8 -*- # Author: loocha import pymysql # \u521b\u5efa\u8fde\u63a5 conn = pymysql.connect(host='127.0.0.1', port=3306, user='root', passwd='root', db='cmz') # \u521b\u5efa\u6e38\u6807 socket\u4e0a\u5efa\u7acb\u7684\u5b9e\u4f8b cursor = conn.cursor() # \u6267\u884cSQL\uff0c\u5e76\u8fd4\u56de\u884c\u6570,\u7528\u6e38\u6807\u6267\u884c\uff0c # effect_row = cursor.execute(\"select * from user\") # print(cursor.fetchone()) # print(cursor.fetchone()) # print(cursor.fetchall()) data = [ (\"\u5f20\u4e09\", '123'), (\"\u674e\u56db\", '123'), (\"\u738b\u4e94\", '123'), ] cursor.executemany(\"insert into user (name,password) values(%s,%s)\", data) conn.commit() \u6267\u884c\u7ed3\u679c\u540e mysql> select * from user; +----+-----------+----------+ | id | name | password | +----+-----------+----------+ | 1 | loocha | 123 | | 2 | realcloud | 123 | | 3 | \u5f20\u4e09 | 123 | | 4 | \u674e\u56db | 123 | | 5 | \u738b\u4e94 | 123 | +----+-----------+----------+ 5 rows in set (0.00 sec) \u6709\u4e2a\u95ee\u9898\uff0c\u4e0a\u9762\u9700\u8981\u6211\u5199\u539f\u751f\u7684SQL\u8bed\u53e5\u6765\u4f7f\u7528\u3002\u5982\u679c\u5199\u539f\u751f\uff0c\u81ea\u5df1\u589e\u5220\u6539\uff0c\u5982\u679c\u7b80\u5355\u8fd8\u884c\uff0c\u590d\u6742\u5c31\u5f88\u9ebb\u70e6\u4e86\uff0c\u91cd\u7528\u6027\u4e0d\u5f3a\uff0c\u56e0\u4e3a\u90fd\u662f\u5199\u6b7b\u5728\u91cc\u9762\uff0c\u5982\u679c\u6570\u636e\u5e93\u7ed3\u679c\u53d8\u5316\u5c31\u7684\u6539\uff0c\u5bf9\u6269\u5c55\u4ec0\u4e48\u90fd\u4e0d\u65b9\u4fbf\uff0c\u5305\u62ec SQL\u6c34\u5e73\u4e5f\u5c31\u4e00\u822c\u822c\uff0c\u5f88\u591a\u60c5\u51b5\u5199\u4e0d\u51fa\u9ad8\u6548\u7684SQL\u8bed\u53e5\uff0c\u6d89\u53ca\u5230\u8f6f\u4ef6\u597d\u6162\u597d\u6162\uff0c\u52a0\u673a\u5668\u90fd\u4e0d\u597d\u4f7f\u3002 \u4e3a\u4e86\u907f\u514d\uff0c\u6211\u4eec\u628a\u539f\u751fSQL\u5199\u6b7b\u5230\u6e90\u4ee3\u7801\u91cc\uff0c\u600e\u4e48\u529e\u5462\uff1f\u5c31\u8981\u5f15\u5165\u4e0b\u9762\u7684\u4e1c\u897f\u3002 SQLAlchemy\u662fpython\u7f16\u7a0b\u8bed\u8a00\u4e0b\u7684\u4e00\u6b3eORM\u6846\u67b6\uff0c\u8be5\u6846\u67b6\u5efa\u7acb\u5728\u6570\u636e\u5e93API\u4e4b\u4e0a\uff0c\u4f7f\u7528\u5173\u7cfb\u5bf9\u8c61\u6620\u5c04\u8fdb\u884c\u6570\u636e\u5e93\u64cd\u4f5c\u3002\u7b80\u8a00\u4e4b\u4fbf\u662f\uff1a\u5c06\u5bf9\u8c61\u8f6c\u6362\u6210SQL\uff0c\u7136\u540e\u4f7f\u7528\u6570\u636eAPI\u6267\u884cSQL\u5e76\u83b7\u53d6\u6267\u884c\u7ed3\u679c\u3002 \u8fd9\u6837\uff0c\u5c31\u4e0d\u7528\u5199\u539f\u751f\u7684SQL\u4e86\u3002 \u4ec0\u4e48\u662fORM\uff1f ORM\u5c31\u662f\u5bf9\u8c61\u6620\u5c04\u5173\u7cfb\u7a0b\u5e8f\u3002\u76f8\u5f53\u4e8eORM\u5e2e\u6211\u4eec\u628a\u5bf9\u8c61\u91cc\u7684\u8f6c\u5316\u6210SQL\u7136\u540e\u8ddf\u6570\u636e\u5e93\u4ea4\u4e92 ORM\u7684\u4f18\u70b9\uff1a \u9690\u85cf\u4e86\u6570\u636e\u8bbf\u95ee\u7ec6\u8282\uff0c\u5c01\u95ed\u7684\u901a\u7528\u6570\u636e\u5e93\u4ea4\u4e92\uff0cORM\u7684\u6838\u5fc3\uff0c\u5b83\u4f7f\u5f97\u6211\u4eec\u7684\u901a\u7528\u6570\u636e\u5e93\u4ea4\u4e92\u53d8\u5f97\u7b80\u5355\u6613\u884c\uff0c\u5e76\u4e14\u5b8c\u5168\u4e0d\u7528\u8003\u8651\u8be5\u6b7b\u7684SQL\u8bed\u53e5\u3002\u5feb\u901f\u5f00\u53d1\uff0c\u7531\u6b64\u800c\u6765\u3002 ORM\u4f7f\u6211\u4eec\u6784\u9020\u56fa\u5316\u6570\u636e\u7ed3\u6784\u53d8\u5f97\u7b80\u5355\u6613\u884c\u3002 ORM\u7684\u7f3a\u70b9\uff1a \u65e0\u53ef\u907f\u514d\uff0c\u81ea\u52a8\u5316\u610f\u5473\u7740\u6620\u5c04\u548c\u5173\u8054\u7ba1\u7406\uff0c\u4ee3\u4ef7\u662f\u727a\u7272\u6027\u80fd ORM\u662f\u4e00\u4e2a\u672f\u8bed\uff0c\u4e0d\u662f\u4e00\u4e2a\u8f6f\u4ef6\uff0c\u57fa\u4e8eORM\u7684\u6807\u51c6\u4e0b\uff0c\u6709\u5f88\u591a\u8f6f\u4ef6\uff0c\u6700\u6267\u884c\u7684\u5c31\u662fSQLAlchemy \u5982\u4f55\u4f7f\u7528\uff1f windows/linxu \u4e0b\u5b89\u88c5 pip install sqlalchemy pip install pymysql 1. \u521b\u5efa\u8868 \u00b6 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2018/12/20 10:26 @File : \u521b\u5efa\u8868.py @Software: PyCharm \"\"\" from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String from sqlalchemy.orm import sessionmaker engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8', echo=True) # echo=True\uff0c\u5c31\u662f\u628a\u6574\u4e2a\u8fc7\u7a0b\u6253\u5370\u51fa\u6765 Base = declarative_base() # \u751f\u6210ORM\u57fa\u7c7b class User(Base): __tablename__ = 'user' # \u8868\u540d id = Column(Integer, primary_key=True) # \u5b57\u6bb5\uff0c\u6574\u5f62\uff0c\u4e3b\u952e column\u662f\u5bfc\u5165\u7684 name = Column(String(32)) password = Column(String(64)) # \u521b\u5efa\u8868\u7ed3\u6784 Base.metadata.create_all(engine) \u8fd0\u884c \"C:\\Program Files\\Python37\\python.exe\" D:/code/code-spider/sqlalchemy\u5e93/\u521b\u5efa\u8868.py 2018-12-20 10:27:25,465 INFO sqlalchemy.engine.base.Engine SHOW VARIABLES LIKE 'sql_mode' 2018-12-20 10:27:25,465 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,466 INFO sqlalchemy.engine.base.Engine SELECT DATABASE() 2018-12-20 10:27:25,466 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,467 INFO sqlalchemy.engine.base.Engine show collation where `Charset` = 'utf8mb4' and `Collation` = 'utf8mb4_bin' 2018-12-20 10:27:25,467 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,468 INFO sqlalchemy.engine.base.Engine SELECT CAST('test plain returns' AS CHAR(60)) AS anon_1 2018-12-20 10:27:25,468 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,468 INFO sqlalchemy.engine.base.Engine SELECT CAST('test unicode returns' AS CHAR(60)) AS anon_1 2018-12-20 10:27:25,468 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,469 INFO sqlalchemy.engine.base.Engine SELECT CAST('test collated returns' AS CHAR CHARACTER SET utf8mb4) COLLATE utf8mb4_bin AS anon_1 2018-12-20 10:27:25,469 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,469 INFO sqlalchemy.engine.base.Engine DESCRIBE `user` 2018-12-20 10:27:25,470 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,474 INFO sqlalchemy.engine.base.Engine ROLLBACK 2018-12-20 10:27:25,474 INFO sqlalchemy.engine.base.Engine CREATE TABLE user ( id INTEGER NOT NULL AUTO_INCREMENT, name VARCHAR(32), password VARCHAR(64), PRIMARY KEY (id) ) 2018-12-20 10:27:25,474 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,492 INFO sqlalchemy.engine.base.Engine COMMIT \u68c0\u67e5\u6570\u636e\u5e93 mysql> show tables like 'user'; +----------------------+ | Tables_in_cmz (user) | +----------------------+ | user | +----------------------+ 1 row in set (0.00 sec) mysql> desc user; +----------+-------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +----------+-------------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | varchar(32) | YES | | NULL | | | password | varchar(64) | YES | | NULL | | +----------+-------------+------+-----+---------+----------------+ 3 rows in set (0.01 sec) mysql> show create table user; +-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ | Table | Create Table | +-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ | user | CREATE TABLE `user` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(32) DEFAULT NULL, `password` varchar(64) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 | +-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ 1 row in set (0.00 sec) \u8868\u5df2\u7ecf\u521b\u5efa\uff0c\u6ce8\u610f\u94fe\u63a5\u6570\u636e\u5e93\u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u8981\u5148\u521b\u5efa\u6570\u636e\u5e93\uff0c\u6307\u5b9a\u94fe\u63a5\u6570\u636e\u5e93\u7684\u5e93\u540d \u5b9e\u73b0\u7ed3\u679c\uff0c\u5c31\u662f\u5728\u6570\u636e\u5e93\u521b\u5efa\u4e86\u4e00\u4e2a\u8868\uff0cuser\uff0c\u518d\u6b21\u6267\u884c\uff0c\u5982\u679c\u6570\u636e\u5e93\u6709\uff0c\u5b83\u5c31\u4e0d\u4f1a\u521b\u5efa\u4e86\u3002 dialect+driver://username:password@host:port/database \u89e3\u91ca dialect\uff0c\u662f\u6570\u636e\u5e93\u7c7b\u578b\uff0c\u5927\u6982\u5305\u62ec\uff1asqlite, mysql, postgresql, oracle, or mssql. driver\uff0c\u662f\u4f7f\u7528\u7684\u6570\u636e\u5e93API\uff0c\u9a71\u52a8\uff0c\u8fde\u63a5\u5305\uff0c\u968f\u4fbf\u53eb\u4ec0\u4e48\u5427\u3002 username\uff0c\u7528\u6237\u540d password\uff0c\u5bc6\u7801 host\uff0c\u7f51\u7edc\u5730\u5740\uff0c\u53ef\u4ee5\u7528ip\uff0c\u57df\u540d\uff0c\u8ba1\u7b97\u673a\u540d\uff0c\u5f53\u7136\u662f\u4f60\u80fd\u8bbf\u95ee\u5230\u7684\u3002 port\uff0c\u6570\u636e\u5e93\u7aef\u53e3\u3002 databas\uff0c\u6570\u636e\u5e93\u540d\u3002 \u5176\u5b9e\u8fd9\u4e9b\u4e5f\u5c31dialect\u548cdirver\u9700\u8981\u89e3\u91ca\u3002 ex\uff1a engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8', echo=True) 2. \u6570\u636e\u8868\u63d2\u5165\u6570\u636e \u00b6 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/12/20 10:26 @File : \u521b\u5efa\u8868.py @Software: PyCharm \"\"\" from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String from sqlalchemy.orm import sessionmaker engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8', echo=True) # echo=True\uff0c\u5c31\u662f\u628a\u6574\u4e2a\u8fc7\u7a0b\u6253\u5370\u51fa\u6765 Base = declarative_base() # \u751f\u6210ORM\u57fa\u7c7b class User(Base): __tablename__ = 'user' # \u8868\u540d id = Column(Integer, primary_key=True) # \u5b57\u6bb5\uff0c\u6574\u5f62\uff0c\u4e3b\u952e column\u662f\u5bfc\u5165\u7684 name = Column(String(32)) password = Column(String(64)) # \u521b\u5efa\u8868\u7ed3\u6784 # Base.metadata.create_all(engine) ''' \u521b\u5efa\u6570\u636e\uff0c\u6709\u4e2a\u6e38\u6807\u7684\u4e1c\u897f\u53eb\u505asessionmaker\u9700\u8981\u5355\u72ec\u5bfc\u5165 ''' # \u5b9e\u4f8b\u4e0esocket\u7ed1\u5b9a,\u521b\u5efa\u4e0e\u6570\u636e\u5e93\u7684\u7ed8\u753bsession class\uff0c\u6ce8\u610f\uff0c\u8fd9\u91cc\u8fd4\u56de # \u7ed9session\u7684\u662f\u4e00\u4e2aclass\uff0c\u4e0d\u662f\u5b9e\u4f8b Session_class = sessionmaker(bind=engine) # \u751f\u6210session\u5b9e\u4f8b\uff0ccursor Session = Session_class() # \u751f\u4ea7\u4f60\u8981\u521b\u5efa\u7684\u6570\u636e\u5bf9\u8c61 user_obj1 = User(name=\"loocha\", password=\"123\") user_obj2 = User(name=\"realcloud\", password=\"456\") # \u76ee\u524d\u8fd8\u6ca1\u6709\u521b\u5efa\u5bf9\u8c61\uff0c\u53ef\u4ee5\u6253\u5370\u770b\u770b\uff0c\u4e0a\u9762\u53ea\u662f\u7533\u660e print(user_obj1.name, user_obj2.id) # \u628a\u8981\u521b\u5efa\u7684\u6570\u636e\u5bf9\u8c61\u6dfb\u52a0\u5230\u8fd9\u4e2asession\u91cc\uff0c\u4e00\u4f1a\u540c\u4e00\u521b\u5efa Session.add(user_obj1) Session.add(user_obj2) # \u6216\u8005 # session.add_all([user_obj1, user_obj2]) # \u8fd9\u91cc\u4f9d\u65e7\u6ca1\u6709\u521b\u5efa print(user_obj1.name, user_obj2.id) # \u73b0\u5728\u624d\u7edf\u4e00\u63d0\u4ea4\uff0c\u521b\u5efa\u6570\u636e Session.commit() \u68c0\u67e5MySQL mysql> use cmz; Database changed mysql> select * from user; +----+-----------+----------+ | id | name | password | +----+-----------+----------+ | 1 | loocha | 123 | | 2 | realcloud | 456 | +----+-----------+----------+ 2 rows in set (0.00 sec) 3. \u6570\u636e\u8868\u67e5\u8be2\u6570\u636e \u00b6 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2018/12/20 10:50 @File : \u67e5\u8be2.py @Software: PyCharm \"\"\" ''' \u5229\u7528ORM\u5b9e\u73b0\u4e00\u4e2a\u67e5\u8868\u7684\u529f\u80fd ''' import sqlalchemy from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String from sqlalchemy.orm import * # \u521b\u5efa\u8fde\u63a5 engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8') Base = declarative_base() # \u751f\u6210ORM\u57fa\u7c7b # \u521b\u5efa\u8868\u7ed3\u6784 class User(Base): __tablename__ = 'user' # \u8868\u540d id = Column(Integer, primary_key=True) name = Column(String(32)) password = Column(String(64)) def __repr__(self): return \"<%s name:%s>\" % (self.id, self.name) Session_class = sessionmaker(bind=engine) # \u7ed1\u5b9aengine \uff0c\u4f1a\u8fd4\u56de\u7ed9\u4f60\u4e00\u4e2asession\u7c7b\u3002\u6ce8\u610f\u8fd9\u662f\u4e2a\u7c7b session = Session_class() # \u8fd9\u6837\u90fd\u5f97\u5230\u4e86\u6e38\u6807\u4e86 user_obj = session.query(User).filter_by(name='loocha').first() print(user_obj) print(user_obj.name) print(user_obj.password) \u8fd0\u884c\u7ed3\u679c <1 name:loocha> loocha 123 \u6ce8\u610f\uff1a - \u901a\u8fc7.all()\u65b9\u6cd5\u4f1a\u8fd4\u56de\u6240\u6709User\u8868\u91cc\u9762name= 'loocha'\u7684\u5bf9\u8c61\u7ec4\u6210\u4e00\u4e2a\u5217\u8868\uff0c \u300a\u8fd4\u56de\u5217\u8868\u300b - \u7528.first()\u5c31\u53ea\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\u4e86\uff0c \u300a\u8fd4\u56de\u5bf9\u8c61\u300b - \u8fd8\u6709\u4e00\u4e2afilter\u65b9\u6cd5\uff0c\u4e0d\u592a\u5efa\u8bae\uff0c\u7528\u6cd5\u4e3a\u53c2\u6570\u8981\u53d8\u4e3asession.query(User).filter(User.name = name)\u53d8\u6210User\u4e2d\u7684name\u5bf9\u8c61\uff0c \u4e00\u822cfilter\u7528\u5728\uff1a\u6a21\u7cca\u67e5\u8be2(\u7edf\u8ba1)\u3001\u591a\u6761\u4ef6\u67e5\u8be2\uff1a session.query(User).filter(User.name.like('li%')).count() \u6a21\u7cca\u67e5\u8be2\uff0c\u5e76\u901a\u8fc7.count()\u7edf\u8ba1 4. \u6570\u636e\u8868\u4fee\u6539\u6570\u636e \u00b6 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2018/12/20 10:50 @File : \u67e5\u8be2.py @Software: PyCharm \"\"\" ''' \u5229\u7528ORM\u5b9e\u73b0\u4e00\u4e2a\u521b\u5efa\u8868\u7684\u529f\u80fd ''' import sqlalchemy from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String from sqlalchemy.orm import * # \u521b\u5efa\u8fde\u63a5 engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8') Base = declarative_base() # \u751f\u6210ORM\u57fa\u7c7b # \u521b\u5efa\u8868\u7ed3\u6784 class User(Base): __tablename__ = 'user' # \u8868\u540d id = Column(Integer, primary_key=True) name = Column(String(32)) password = Column(String(64)) def __repr__(self): return \"<%s name:%s>\" % (self.id, self.name) Session_class = sessionmaker(bind=engine) # \u7ed1\u5b9aengine \uff0c\u4f1a\u8fd4\u56de\u7ed9\u4f60\u4e00\u4e2asession\u7c7b\u3002\u6ce8\u610f\u8fd9\u662f\u4e2a\u7c7b session = Session_class() # \u8fd9\u6837\u90fd\u5f97\u5230\u4e86\u6e38\u6807\u4e86 # \u9996\u5148\u8981\u62ff\u5230\u6570\u636e\uff0c\u7136\u540e\u4fee\u6539 user_obj = session.query(User).filter_by(name='loocha').first() user_obj.name = \"david\" session.commit() \u67e5\u770bMySQL\u6570\u636e # \u4fee\u6539\u4e4b\u524d mysql> select * from user; +----+-----------+----------+ | id | name | password | +----+-----------+----------+ | 1 | loocha | 123 | | 2 | realcloud | 456 | +----+-----------+----------+ 2 rows in set (0.00 sec) # \u4fee\u6539\u4e4b\u540e mysql> select * from user; +----+-----------+----------+ | id | name | password | +----+-----------+----------+ | 1 | david | 123 | | 2 | realcloud | 456 | +----+-----------+----------+ 2 rows in set (0.00 sec) 5. \u6570\u636e\u8868\u5220\u9664\u6570\u636e \u00b6 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2018/12/20 10:50 @File : \u5220\u9664.py @Software: PyCharm \"\"\" ''' \u5229\u7528ORM\u5b9e\u73b0\u4e00\u4e2a\u521b\u5efa\u8868\u7684\u529f\u80fd ''' import sqlalchemy from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String from sqlalchemy.orm import sessionmaker from sqlalchemy.orm import * # \u521b\u5efa\u8fde\u63a5 engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8') Base = declarative_base() # \u751f\u6210ORM\u57fa\u7c7b # \u521b\u5efa\u8868\u7ed3\u6784 class User(Base): __tablename__ = 'user' # \u8868\u540d id = Column(Integer, primary_key=True) name = Column(String(32)) password = Column(String(64)) def __repr__(self): return \"<%s name:%s>\" % (self.id, self.name) Session_class = sessionmaker(bind=engine) # \u7ed1\u5b9aengine \uff0c\u4f1a\u8fd4\u56de\u7ed9\u4f60\u4e00\u4e2asession\u7c7b\u3002\u6ce8\u610f\u8fd9\u662f\u4e2a\u7c7b session = Session_class() # \u8fd9\u6837\u90fd\u5f97\u5230\u4e86\u6e38\u6807\u4e86 user_obj = session.query(User).filter_by(name=\"realcloud\").first() session.delete(user_obj) session.commit() \u67e5\u770bMySQL # \u5220\u9664\u4e4b\u524d mysql> select * from user; +----+-----------+----------+ | id | name | password | +----+-----------+----------+ | 1 | david | 123 | | 2 | realcloud | 456 | +----+-----------+----------+ 2 rows in set (0.00 sec) # \u5220\u9664\u4e4b\u540e mysql> select * from user; +----+-------+----------+ | id | name | password | +----+-------+----------+ | 1 | david | 123 | +----+-------+----------+ 1 row in set (0.00 sec) \u5176\u4ed6\u5220\u9664 - \u5220\u9664 sql \u4e2dlike # \u5220\u9664name\u5b57\u6bb5\u4ee5id\u4e3a\u7ed3\u5c3e\u7684\u6570\u636e user_obj = session.query(User).filter(User.name.like('%id')).first() session.delete(user_obj) session.commit()","title":"2. \u57fa\u672c\u64cd\u4f5c"},{"location":"python/lib/SQLAlchemy/2.\u57fa\u672c\u64cd\u4f5c/#1","text":"#!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2018/12/20 10:26 @File : \u521b\u5efa\u8868.py @Software: PyCharm \"\"\" from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String from sqlalchemy.orm import sessionmaker engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8', echo=True) # echo=True\uff0c\u5c31\u662f\u628a\u6574\u4e2a\u8fc7\u7a0b\u6253\u5370\u51fa\u6765 Base = declarative_base() # \u751f\u6210ORM\u57fa\u7c7b class User(Base): __tablename__ = 'user' # \u8868\u540d id = Column(Integer, primary_key=True) # \u5b57\u6bb5\uff0c\u6574\u5f62\uff0c\u4e3b\u952e column\u662f\u5bfc\u5165\u7684 name = Column(String(32)) password = Column(String(64)) # \u521b\u5efa\u8868\u7ed3\u6784 Base.metadata.create_all(engine) \u8fd0\u884c \"C:\\Program Files\\Python37\\python.exe\" D:/code/code-spider/sqlalchemy\u5e93/\u521b\u5efa\u8868.py 2018-12-20 10:27:25,465 INFO sqlalchemy.engine.base.Engine SHOW VARIABLES LIKE 'sql_mode' 2018-12-20 10:27:25,465 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,466 INFO sqlalchemy.engine.base.Engine SELECT DATABASE() 2018-12-20 10:27:25,466 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,467 INFO sqlalchemy.engine.base.Engine show collation where `Charset` = 'utf8mb4' and `Collation` = 'utf8mb4_bin' 2018-12-20 10:27:25,467 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,468 INFO sqlalchemy.engine.base.Engine SELECT CAST('test plain returns' AS CHAR(60)) AS anon_1 2018-12-20 10:27:25,468 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,468 INFO sqlalchemy.engine.base.Engine SELECT CAST('test unicode returns' AS CHAR(60)) AS anon_1 2018-12-20 10:27:25,468 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,469 INFO sqlalchemy.engine.base.Engine SELECT CAST('test collated returns' AS CHAR CHARACTER SET utf8mb4) COLLATE utf8mb4_bin AS anon_1 2018-12-20 10:27:25,469 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,469 INFO sqlalchemy.engine.base.Engine DESCRIBE `user` 2018-12-20 10:27:25,470 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,474 INFO sqlalchemy.engine.base.Engine ROLLBACK 2018-12-20 10:27:25,474 INFO sqlalchemy.engine.base.Engine CREATE TABLE user ( id INTEGER NOT NULL AUTO_INCREMENT, name VARCHAR(32), password VARCHAR(64), PRIMARY KEY (id) ) 2018-12-20 10:27:25,474 INFO sqlalchemy.engine.base.Engine {} 2018-12-20 10:27:25,492 INFO sqlalchemy.engine.base.Engine COMMIT \u68c0\u67e5\u6570\u636e\u5e93 mysql> show tables like 'user'; +----------------------+ | Tables_in_cmz (user) | +----------------------+ | user | +----------------------+ 1 row in set (0.00 sec) mysql> desc user; +----------+-------------+------+-----+---------+----------------+ | Field | Type | Null | Key | Default | Extra | +----------+-------------+------+-----+---------+----------------+ | id | int(11) | NO | PRI | NULL | auto_increment | | name | varchar(32) | YES | | NULL | | | password | varchar(64) | YES | | NULL | | +----------+-------------+------+-----+---------+----------------+ 3 rows in set (0.01 sec) mysql> show create table user; +-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ | Table | Create Table | +-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ | user | CREATE TABLE `user` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(32) DEFAULT NULL, `password` varchar(64) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 | +-------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+ 1 row in set (0.00 sec) \u8868\u5df2\u7ecf\u521b\u5efa\uff0c\u6ce8\u610f\u94fe\u63a5\u6570\u636e\u5e93\u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u8981\u5148\u521b\u5efa\u6570\u636e\u5e93\uff0c\u6307\u5b9a\u94fe\u63a5\u6570\u636e\u5e93\u7684\u5e93\u540d \u5b9e\u73b0\u7ed3\u679c\uff0c\u5c31\u662f\u5728\u6570\u636e\u5e93\u521b\u5efa\u4e86\u4e00\u4e2a\u8868\uff0cuser\uff0c\u518d\u6b21\u6267\u884c\uff0c\u5982\u679c\u6570\u636e\u5e93\u6709\uff0c\u5b83\u5c31\u4e0d\u4f1a\u521b\u5efa\u4e86\u3002 dialect+driver://username:password@host:port/database \u89e3\u91ca dialect\uff0c\u662f\u6570\u636e\u5e93\u7c7b\u578b\uff0c\u5927\u6982\u5305\u62ec\uff1asqlite, mysql, postgresql, oracle, or mssql. driver\uff0c\u662f\u4f7f\u7528\u7684\u6570\u636e\u5e93API\uff0c\u9a71\u52a8\uff0c\u8fde\u63a5\u5305\uff0c\u968f\u4fbf\u53eb\u4ec0\u4e48\u5427\u3002 username\uff0c\u7528\u6237\u540d password\uff0c\u5bc6\u7801 host\uff0c\u7f51\u7edc\u5730\u5740\uff0c\u53ef\u4ee5\u7528ip\uff0c\u57df\u540d\uff0c\u8ba1\u7b97\u673a\u540d\uff0c\u5f53\u7136\u662f\u4f60\u80fd\u8bbf\u95ee\u5230\u7684\u3002 port\uff0c\u6570\u636e\u5e93\u7aef\u53e3\u3002 databas\uff0c\u6570\u636e\u5e93\u540d\u3002 \u5176\u5b9e\u8fd9\u4e9b\u4e5f\u5c31dialect\u548cdirver\u9700\u8981\u89e3\u91ca\u3002 ex\uff1a engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8', echo=True)","title":"1. \u521b\u5efa\u8868"},{"location":"python/lib/SQLAlchemy/2.\u57fa\u672c\u64cd\u4f5c/#2","text":"#!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/12/20 10:26 @File : \u521b\u5efa\u8868.py @Software: PyCharm \"\"\" from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String from sqlalchemy.orm import sessionmaker engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8', echo=True) # echo=True\uff0c\u5c31\u662f\u628a\u6574\u4e2a\u8fc7\u7a0b\u6253\u5370\u51fa\u6765 Base = declarative_base() # \u751f\u6210ORM\u57fa\u7c7b class User(Base): __tablename__ = 'user' # \u8868\u540d id = Column(Integer, primary_key=True) # \u5b57\u6bb5\uff0c\u6574\u5f62\uff0c\u4e3b\u952e column\u662f\u5bfc\u5165\u7684 name = Column(String(32)) password = Column(String(64)) # \u521b\u5efa\u8868\u7ed3\u6784 # Base.metadata.create_all(engine) ''' \u521b\u5efa\u6570\u636e\uff0c\u6709\u4e2a\u6e38\u6807\u7684\u4e1c\u897f\u53eb\u505asessionmaker\u9700\u8981\u5355\u72ec\u5bfc\u5165 ''' # \u5b9e\u4f8b\u4e0esocket\u7ed1\u5b9a,\u521b\u5efa\u4e0e\u6570\u636e\u5e93\u7684\u7ed8\u753bsession class\uff0c\u6ce8\u610f\uff0c\u8fd9\u91cc\u8fd4\u56de # \u7ed9session\u7684\u662f\u4e00\u4e2aclass\uff0c\u4e0d\u662f\u5b9e\u4f8b Session_class = sessionmaker(bind=engine) # \u751f\u6210session\u5b9e\u4f8b\uff0ccursor Session = Session_class() # \u751f\u4ea7\u4f60\u8981\u521b\u5efa\u7684\u6570\u636e\u5bf9\u8c61 user_obj1 = User(name=\"loocha\", password=\"123\") user_obj2 = User(name=\"realcloud\", password=\"456\") # \u76ee\u524d\u8fd8\u6ca1\u6709\u521b\u5efa\u5bf9\u8c61\uff0c\u53ef\u4ee5\u6253\u5370\u770b\u770b\uff0c\u4e0a\u9762\u53ea\u662f\u7533\u660e print(user_obj1.name, user_obj2.id) # \u628a\u8981\u521b\u5efa\u7684\u6570\u636e\u5bf9\u8c61\u6dfb\u52a0\u5230\u8fd9\u4e2asession\u91cc\uff0c\u4e00\u4f1a\u540c\u4e00\u521b\u5efa Session.add(user_obj1) Session.add(user_obj2) # \u6216\u8005 # session.add_all([user_obj1, user_obj2]) # \u8fd9\u91cc\u4f9d\u65e7\u6ca1\u6709\u521b\u5efa print(user_obj1.name, user_obj2.id) # \u73b0\u5728\u624d\u7edf\u4e00\u63d0\u4ea4\uff0c\u521b\u5efa\u6570\u636e Session.commit() \u68c0\u67e5MySQL mysql> use cmz; Database changed mysql> select * from user; +----+-----------+----------+ | id | name | password | +----+-----------+----------+ | 1 | loocha | 123 | | 2 | realcloud | 456 | +----+-----------+----------+ 2 rows in set (0.00 sec)","title":"2. \u6570\u636e\u8868\u63d2\u5165\u6570\u636e"},{"location":"python/lib/SQLAlchemy/2.\u57fa\u672c\u64cd\u4f5c/#3","text":"#!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2018/12/20 10:50 @File : \u67e5\u8be2.py @Software: PyCharm \"\"\" ''' \u5229\u7528ORM\u5b9e\u73b0\u4e00\u4e2a\u67e5\u8868\u7684\u529f\u80fd ''' import sqlalchemy from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String from sqlalchemy.orm import * # \u521b\u5efa\u8fde\u63a5 engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8') Base = declarative_base() # \u751f\u6210ORM\u57fa\u7c7b # \u521b\u5efa\u8868\u7ed3\u6784 class User(Base): __tablename__ = 'user' # \u8868\u540d id = Column(Integer, primary_key=True) name = Column(String(32)) password = Column(String(64)) def __repr__(self): return \"<%s name:%s>\" % (self.id, self.name) Session_class = sessionmaker(bind=engine) # \u7ed1\u5b9aengine \uff0c\u4f1a\u8fd4\u56de\u7ed9\u4f60\u4e00\u4e2asession\u7c7b\u3002\u6ce8\u610f\u8fd9\u662f\u4e2a\u7c7b session = Session_class() # \u8fd9\u6837\u90fd\u5f97\u5230\u4e86\u6e38\u6807\u4e86 user_obj = session.query(User).filter_by(name='loocha').first() print(user_obj) print(user_obj.name) print(user_obj.password) \u8fd0\u884c\u7ed3\u679c <1 name:loocha> loocha 123 \u6ce8\u610f\uff1a - \u901a\u8fc7.all()\u65b9\u6cd5\u4f1a\u8fd4\u56de\u6240\u6709User\u8868\u91cc\u9762name= 'loocha'\u7684\u5bf9\u8c61\u7ec4\u6210\u4e00\u4e2a\u5217\u8868\uff0c \u300a\u8fd4\u56de\u5217\u8868\u300b - \u7528.first()\u5c31\u53ea\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\u4e86\uff0c \u300a\u8fd4\u56de\u5bf9\u8c61\u300b - \u8fd8\u6709\u4e00\u4e2afilter\u65b9\u6cd5\uff0c\u4e0d\u592a\u5efa\u8bae\uff0c\u7528\u6cd5\u4e3a\u53c2\u6570\u8981\u53d8\u4e3asession.query(User).filter(User.name = name)\u53d8\u6210User\u4e2d\u7684name\u5bf9\u8c61\uff0c \u4e00\u822cfilter\u7528\u5728\uff1a\u6a21\u7cca\u67e5\u8be2(\u7edf\u8ba1)\u3001\u591a\u6761\u4ef6\u67e5\u8be2\uff1a session.query(User).filter(User.name.like('li%')).count() \u6a21\u7cca\u67e5\u8be2\uff0c\u5e76\u901a\u8fc7.count()\u7edf\u8ba1","title":"3. \u6570\u636e\u8868\u67e5\u8be2\u6570\u636e"},{"location":"python/lib/SQLAlchemy/2.\u57fa\u672c\u64cd\u4f5c/#4","text":"#!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2018/12/20 10:50 @File : \u67e5\u8be2.py @Software: PyCharm \"\"\" ''' \u5229\u7528ORM\u5b9e\u73b0\u4e00\u4e2a\u521b\u5efa\u8868\u7684\u529f\u80fd ''' import sqlalchemy from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String from sqlalchemy.orm import * # \u521b\u5efa\u8fde\u63a5 engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8') Base = declarative_base() # \u751f\u6210ORM\u57fa\u7c7b # \u521b\u5efa\u8868\u7ed3\u6784 class User(Base): __tablename__ = 'user' # \u8868\u540d id = Column(Integer, primary_key=True) name = Column(String(32)) password = Column(String(64)) def __repr__(self): return \"<%s name:%s>\" % (self.id, self.name) Session_class = sessionmaker(bind=engine) # \u7ed1\u5b9aengine \uff0c\u4f1a\u8fd4\u56de\u7ed9\u4f60\u4e00\u4e2asession\u7c7b\u3002\u6ce8\u610f\u8fd9\u662f\u4e2a\u7c7b session = Session_class() # \u8fd9\u6837\u90fd\u5f97\u5230\u4e86\u6e38\u6807\u4e86 # \u9996\u5148\u8981\u62ff\u5230\u6570\u636e\uff0c\u7136\u540e\u4fee\u6539 user_obj = session.query(User).filter_by(name='loocha').first() user_obj.name = \"david\" session.commit() \u67e5\u770bMySQL\u6570\u636e # \u4fee\u6539\u4e4b\u524d mysql> select * from user; +----+-----------+----------+ | id | name | password | +----+-----------+----------+ | 1 | loocha | 123 | | 2 | realcloud | 456 | +----+-----------+----------+ 2 rows in set (0.00 sec) # \u4fee\u6539\u4e4b\u540e mysql> select * from user; +----+-----------+----------+ | id | name | password | +----+-----------+----------+ | 1 | david | 123 | | 2 | realcloud | 456 | +----+-----------+----------+ 2 rows in set (0.00 sec)","title":"4. \u6570\u636e\u8868\u4fee\u6539\u6570\u636e"},{"location":"python/lib/SQLAlchemy/2.\u57fa\u672c\u64cd\u4f5c/#5","text":"#!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2018/12/20 10:50 @File : \u5220\u9664.py @Software: PyCharm \"\"\" ''' \u5229\u7528ORM\u5b9e\u73b0\u4e00\u4e2a\u521b\u5efa\u8868\u7684\u529f\u80fd ''' import sqlalchemy from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String from sqlalchemy.orm import sessionmaker from sqlalchemy.orm import * # \u521b\u5efa\u8fde\u63a5 engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8') Base = declarative_base() # \u751f\u6210ORM\u57fa\u7c7b # \u521b\u5efa\u8868\u7ed3\u6784 class User(Base): __tablename__ = 'user' # \u8868\u540d id = Column(Integer, primary_key=True) name = Column(String(32)) password = Column(String(64)) def __repr__(self): return \"<%s name:%s>\" % (self.id, self.name) Session_class = sessionmaker(bind=engine) # \u7ed1\u5b9aengine \uff0c\u4f1a\u8fd4\u56de\u7ed9\u4f60\u4e00\u4e2asession\u7c7b\u3002\u6ce8\u610f\u8fd9\u662f\u4e2a\u7c7b session = Session_class() # \u8fd9\u6837\u90fd\u5f97\u5230\u4e86\u6e38\u6807\u4e86 user_obj = session.query(User).filter_by(name=\"realcloud\").first() session.delete(user_obj) session.commit() \u67e5\u770bMySQL # \u5220\u9664\u4e4b\u524d mysql> select * from user; +----+-----------+----------+ | id | name | password | +----+-----------+----------+ | 1 | david | 123 | | 2 | realcloud | 456 | +----+-----------+----------+ 2 rows in set (0.00 sec) # \u5220\u9664\u4e4b\u540e mysql> select * from user; +----+-------+----------+ | id | name | password | +----+-------+----------+ | 1 | david | 123 | +----+-------+----------+ 1 row in set (0.00 sec) \u5176\u4ed6\u5220\u9664 - \u5220\u9664 sql \u4e2dlike # \u5220\u9664name\u5b57\u6bb5\u4ee5id\u4e3a\u7ed3\u5c3e\u7684\u6570\u636e user_obj = session.query(User).filter(User.name.like('%id')).first() session.delete(user_obj) session.commit()","title":"5. \u6570\u636e\u8868\u5220\u9664\u6570\u636e"},{"location":"python/lib/SQLAlchemy/3.\u56de\u6eda/","text":"\u56de\u6eda\u4e4b\u524d mysql> select * from user; +----+------+----------+ | id | name | password | +----+------+----------+ | 1 | rain | 12345 | +----+------+----------+ 1 row in set (0.00 sec) \u6267\u884c\u4ee3\u7801 from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String from sqlalchemy.orm import sessionmaker # \u521b\u5efa\u8fde\u63a5 engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8', echo=False) Base = declarative_base() # \u751f\u6210ORM\u57fa\u7c7b # \u521b\u5efa\u8868\u7ed3\u6784 class User(Base): __tablename__ = 'user' # \u8868\u540d id = Column(Integer, primary_key=True) name = Column(String(32)) password = Column(String(64)) # \u76f4\u63a5\u8c03\u7528\u57fa\u7c7b\u4e0b\u7684\u65b9\u6cd5 Base.metadata.create_all(engine) # \u5b9e\u4f8b\u4e0esocket\u7ed1\u5b9a,\u521b\u5efa\u4e0e\u6570\u636e\u5e93\u7684\u7ed8\u753bsession class\uff0c\u6ce8\u610f\uff0c\u8fd9\u91cc\u8fd4\u56de # \u7ed9session\u7684\u662f\u4e00\u4e2aclass\uff0c\u4e0d\u662f\u5b9e\u4f8b Session_class = sessionmaker(bind=engine) # \u751f\u6210session\u5b9e\u4f8b\uff0ccursor Session = Session_class() # \u521b\u5efa\u7528\u6237 fake_user = User(name='leco', password=\"666666\") Session.add(fake_user) # \u56de\u6eda Session.rollback() Session.commit() \u6267\u884c\u540e\u7ed3\u679c mysql> select * from user; +----+------+----------+ | id | name | password | +----+------+----------+ | 1 | rain | 12345 | +----+------+----------+ 1 row in set (0.00 sec) \u5220\u9664Session.rollback() \u6267\u884c\u540e\u7ed3\u679c mysql> select * from user; +----+------+----------+ | id | name | password | +----+------+----------+ | 1 | rain | 12345 | | 2 | leco | 666666 | +----+------+----------+ 2 rows in set (0.00 sec) \u6ce8\u610f: - \u56de\u6eda\u5c31\u662fmysql\u7684\u4e00\u4e2a\u4e8b\u52a1\u7684\u7279\u6027\uff0c\u8981\u4e48\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u6267\u884c - \u56de\u6eda\u901a\u8fc7\u901a\u8fc7\u6355\u83b7\u5f02\u5e38\u6765\u5b9e\u73b0\u56de\u6eda\u3002","title":"3. \u56de\u6eda"},{"location":"python/lib/SQLAlchemy/4.\u7edf\u8ba1\u5206\u7ec4/","text":"#!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/10/20 11:31 @File : \u7edf\u8ba1.py @Software: PyCharm \"\"\" import sqlalchemy from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String from sqlalchemy.orm import sessionmaker from sqlalchemy import func # \u521b\u5efa\u8fde\u63a5 engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8', echo=False) Base = declarative_base() # \u751f\u6210ORM\u57fa\u7c7b # \u521b\u5efa\u8868\u7ed3\u6784 class User(Base): __tablename__ = 'user' # \u8868\u540d id = Column(Integer, primary_key=True) name = Column(String(32)) password = Column(String(64)) # \u76f4\u63a5\u8c03\u7528\u57fa\u7c7b\u4e0b\u7684\u65b9\u6cd5 Base.metadata.create_all(engine) # \u5b9e\u4f8b\u4e0esocket\u7ed1\u5b9a,\u521b\u5efa\u4e0e\u6570\u636e\u5e93\u7684\u7ed8\u753bsession class\uff0c\u6ce8\u610f\uff0c\u8fd9\u91cc\u8fd4\u56de # \u7ed9session\u7684\u662f\u4e00\u4e2aclass\uff0c\u4e0d\u662f\u5b9e\u4f8b Session_class = sessionmaker(bind=engine) # \u751f\u6210session\u5b9e\u4f8b\uff0ccursor Session = Session_class() # \u521b\u5efa\u7528\u6237 # fake_user = User(name='leco', password=\"666666\") # Session.add(fake_user) # Session.rollback() # Session.commit() # print(Session.query(User).filter(User.name.in_(['xiedi', 'rain', 'jack'])).all()) # Session.rollback() # print(Session.query(User).filter(User.name.in_(['leco', 'rain', 'loocha'])).all()) print(Session.query(User).filter(User.name.in_(['leco', 'rain'])).count()) print(Session.query(User.name, func.count(User.name)).group_by(User.name).all()) \u8fd0\u884c\u7ed3\u679c [<__main__.User object at 0x000001C147CFF5C0>, <__main__.User object at 0x000001C147CFF630>] 2 [('leco', 1), ('rain', 1)]","title":"4. \u7edf\u8ba1\u5206\u7ec4"},{"location":"python/lib/SQLAlchemy/5.\u5916\u952e/","text":"MySQL mysql> select * from student; +----+------+---------------+--------+ | id | name | register_date | gender | +----+------+---------------+--------+ | 1 | s2 | 2015-03-01 | F | +----+------+---------------+--------+ 1 row in set (0.00 sec) mysql> select * from user; +----+------+----------+ | id | name | password | +----+------+----------+ | 1 | rain | 12345 | | 2 | leco | 666666 | +----+------+----------+ 2 rows in set (0.00 sec) code from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String, DATE, Enum from sqlalchemy.orm import sessionmaker from sqlalchemy import func # \u521b\u5efa\u8fde\u63a5 engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/cmz\", encoding='utf-8', echo=False) Base = declarative_base() # \u751f\u6210ORM\u57fa\u7c7b # \u521b\u5efa\u8868\u7ed3\u6784 class User(Base): __tablename__ = 'user' # \u8868\u540d id = Column(Integer, primary_key=True) name = Column(String(32)) password = Column(String(64)) class Student(Base): __tablename__ = 'student' # \u8868\u540d id = Column(Integer, primary_key=True) # \u5b57\u6bb5\uff0c\u6574\u5f62\uff0c\u4e3b\u952e column\u662f\u5bfc\u5165\u7684 name = Column(String(32), nullable=False) register_date = Column(DATE, nullable=False) gender = Column(String(32), nullable=False) def __repr__(self): return \"<%s name:%s>\" % (self.id, self.name) # \u76f4\u63a5\u8c03\u7528\u57fa\u7c7b\u4e0b\u7684\u65b9\u6cd5 Base.metadata.create_all(engine) # \u5b9e\u4f8b\u4e0esocket\u7ed1\u5b9a,\u521b\u5efa\u4e0e\u6570\u636e\u5e93\u7684\u7ed8\u753bsession class\uff0c\u6ce8\u610f\uff0c\u8fd9\u91cc\u8fd4\u56de # \u7ed9session\u7684\u662f\u4e00\u4e2aclass\uff0c\u4e0d\u662f\u5b9e\u4f8b Session_class = sessionmaker(bind=engine) # \u751f\u6210session\u5b9e\u4f8b\uff0ccursor Session = Session_class() # s1 = Student(name=\"s2\", register_date=\"2015-03-01\", gender=\"F\") # Session.add(s1) print(Session.query(User, Student).filter(User.id == Student.id).all()) print(Session.query(User, Student).filter(User.id == Student.id).first()) Session.commit() \u6267\u884c\u7ed3\u679c [(<__main__.User object at 0x000002717E36D8D0>, <1 name:s2>)] (<__main__.User object at 0x000001CF04082320>, s2)","title":"5. \u5916\u952e"},{"location":"python/lib/SQLAlchemy/6.\u5173\u7cfb\u5b9a\u4e49/","text":"1. \u4e00\u5bf9\u591a\u5173\u7cfb \u00b6 \u5bf9\u4e8e\u4e00\u4e2a\u666e\u901a\u7684\u535a\u5ba2\u5e94\u7528\u6765\u8bf4\uff0c\u7528\u6237\u548c\u6587\u7ae0\u663e\u7136\u662f\u4e00\u4e2a\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\uff0c\u4e00\u7bc7\u6587\u7ae0\u5c5e\u4e8e\u4e00\u4e2a\u7528\u6237\uff0c\u4e00\u4e2a\u7528\u6237\u53ef\u4ee5\u5199\u5f88\u591a\u7bc7\u6587\u7ae0\uff0c\u90a3\u4e48\u4ed6\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u53ef\u4ee5\u8fd9\u6837\u5b9a\u4e49\uff1a class User(Base): __tablename__ = 'users' id = Column(Integer, primary_key=True) username = Column(String(64), nullable=False, index=True) password = Column(String(64), nullable=False) email = Column(String(64), nullable=False, index=True) articles = relationship('Article') def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.username) class Article(Base): __tablename__ = 'articles' id = Column(Integer, primary_key=True) title = Column(String(255), nullable=False, index=True) content = Column(Text) user_id = Column(Integer, ForeignKey('users.id')) author = relationship('User') def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.title) \u6bcf\u7bc7\u6587\u7ae0\u6709\u4e00\u4e2a\u5916\u952e\u6307\u5411 users \u8868\u4e2d\u7684\u4e3b\u952e id\uff0c \u800c\u5728 User \u4e2d\u4f7f\u7528 SQLAlchemy \u63d0\u4f9b\u7684 relationship \u63cf\u8ff0 \u5173\u7cfb\u3002\u800c\u7528\u6237\u4e0e\u6587\u7ae0\u7684\u4e4b\u95f4\u7684\u8fd9\u4e2a\u5173\u7cfb\u662f\u53cc\u5411\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u770b\u5230\u4e0a\u9762\u7684\u4e24\u5f20\u8868\u4e2d\u90fd\u5b9a\u4e49\u4e86 relationship\u3002 SQLAlchemy \u63d0\u4f9b\u4e86 backref \u8ba9\u6211\u4eec\u53ef\u4ee5\u53ea\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u5173\u7cfb\uff1a articles = relationship('Article', backref='author') \u6dfb\u52a0\u4e86\u8fd9\u4e2a\u5c31\u53ef\u4ee5\u4e0d\u7528\u518d\u5728 Article \u4e2d\u5b9a\u4e49 relationship \u4e86\uff01 2. \u4e00\u5bf9\u4e00\u5173\u7cfb \u00b6 \u5728 User \u4e2d\u6211\u4eec\u53ea\u5b9a\u4e49\u4e86\u51e0\u4e2a\u5fc5\u987b\u7684\u5b57\u6bb5\uff0c \u4f46\u901a\u5e38\u7528\u6237\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u4fe1\u606f\uff0c\u4f46\u8fd9\u4e9b\u4fe1\u606f\u53ef\u80fd\u4e0d\u662f\u5fc5\u987b\u586b\u5199\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u4eec\u653e\u5230\u53e6\u4e00\u5f20 UserInfo \u8868\u4e2d\uff0c\u8fd9\u6837User \u548c UserInfo \u5c31\u5f62\u6210\u4e86\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb\u3002\u4f60\u53ef\u80fd\u4f1a\u5947\u602a\u4e00\u5bf9\u4e00\u5173\u7cfb\u4e3a\u4ec0\u4e48\u4e0d\u5728\u4e00\u5bf9\u591a\u5173\u7cfb\u524d\u9762\uff1f\u90a3\u662f\u56e0\u4e3a\u4e00\u5bf9\u4e00\u5173\u7cfb\u662f\u57fa\u4e8e\u4e00\u5bf9\u591a\u5b9a\u4e49\u7684\uff1a class User(Base): __tablename__ = 'users' id = Column(Integer, primary_key=True) username = Column(String(64), nullable=False, index=True) password = Column(String(64), nullable=False) email = Column(String(64), nullable=False, index=True) articles = relationship('Article', backref='author') userinfo = relationship('UserInfo', backref='user', uselist=False) def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.username) class UserInfo(Base): __tablename__ = 'userinfos' id = Column(Integer, primary_key=True) name = Column(String(64)) qq = Column(String(11)) phone = Column(String(11)) link = Column(String(64)) user_id = Column(Integer, ForeignKey('users.id')) \u5b9a\u4e49\u65b9\u6cd5\u548c\u4e00\u5bf9\u591a\u76f8\u540c\uff0c\u53ea\u662f\u9700\u8981\u6dfb\u52a0 userlist=False 3. \u591a\u5bf9\u591a\u5173\u7cfb \u00b6 \u4e00\u904d\u535a\u5ba2\u901a\u5e38\u6709\u4e00\u4e2a\u5206\u7c7b\uff0c\u597d\u51e0\u4e2a\u6807\u7b7e\u3002\u6807\u7b7e\u4e0e\u535a\u5ba2\u4e4b\u95f4\u5c31\u662f\u4e00\u4e2a\u591a\u5bf9\u591a\u7684\u5173\u7cfb\u3002\u591a\u5bf9\u591a\u5173\u7cfb\u4e0d\u80fd\u76f4\u63a5\u5b9a\u4e49\uff0c\u9700\u8981\u5206\u89e3\u6210\u4fe9\u4e2a\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\uff0c\u4e3a\u6b64\uff0c\u9700\u8981\u4e00\u5f20\u989d\u5916\u7684\u8868\u6765\u534f\u52a9\u5b8c\u6210\uff1a article_tag = Table( 'article_tag', Base.metadata, Column('article_id', Integer, ForeignKey('articles.id')), Column('tag_id', Integer, ForeignKey('tags.id')) ) class Tag(Base): __tablename__ = 'tags' id = Column(Integer, primary_key=True) name = Column(String(64), nullable=False, index=True) def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.name) 4. \u6620\u5c04\u5230\u6570\u636e \u00b6 \u8868\u5df2\u7ecf\u63cf\u8ff0\u597d\u4e86\uff0c\u5728\u6587\u4ef6\u672b\u5c3e\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5728\u6211\u4eec\u8fde\u63a5\u7684\u6570\u636e\u5e93\u4e2d\u521b\u5efa\u5bf9\u5e94\u7684\u8868\uff1a if __name__ == '__main__': Base.metadata.create_all(engine) \u5b8c\u6574\u4ee3\u7801 # coding: utf-8 import random from faker import Factory from sqlalchemy import create_engine, Table from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import ForeignKey from sqlalchemy import Column, String, Integer, Text from sqlalchemy.orm import sessionmaker, relationship engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/blog\", encoding='utf-8', echo=False) Base = declarative_base() class User(Base): __tablename__ = 'users' id = Column(Integer, primary_key=True) username = Column(String(64), nullable=False, index=True) password = Column(String(64), nullable=False) email = Column(String(64), nullable=False, index=True) articles = relationship('Article', backref='author') userinfo = relationship('UserInfo', backref='user', uselist=False) def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.username) class UserInfo(Base): __tablename__ = 'userinfos' id = Column(Integer, primary_key=True) name = Column(String(64)) qq = Column(String(11)) phone = Column(String(11)) link = Column(String(64)) user_id = Column(Integer, ForeignKey('users.id')) class Article(Base): __tablename__ = 'articles' id = Column(Integer, primary_key=True) title = Column(String(255), nullable=False, index=True) content = Column(Text) user_id = Column(Integer, ForeignKey('users.id')) cate_id = Column(Integer, ForeignKey('categories.id')) tags = relationship('Tag', secondary='article_tag', backref='articles') def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.title) class Category(Base): __tablename__ = 'categories' id = Column(Integer, primary_key=True) name = Column(String(64), nullable=False, index=True) articles = relationship('Article', backref='category') def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.name) article_tag = Table( 'article_tag', Base.metadata, Column('article_id', Integer, ForeignKey('articles.id')), Column('tag_id', Integer, ForeignKey('tags.id')) ) class Tag(Base): __tablename__ = 'tags' id = Column(Integer, primary_key=True) name = Column(String(64), nullable=False, index=True) def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.name) if __name__ == '__main__': Base.metadata.create_all(engine) faker = Factory.create() Session = sessionmaker(bind=engine) session = Session() faker_users = [User( username=faker.name(), password=faker.word(), email=faker.email(), ) for i in range(10)] session.add_all(faker_users) faker_categories = [Category(name=faker.word()) for i in range(5)] session.add_all(faker_categories) faker_tags = [Tag(name=faker.word()) for i in range(20)] session.add_all(faker_tags) for i in range(100): article = Article( title=faker.sentence(), content=' '.join(faker.sentences(nb=random.randint(10, 20))), author=random.choice(faker_users), category=random.choice(faker_categories) ) for tag in random.sample(faker_tags, random.randint(2, 5)): article.tags.append(tag) session.add(article) session.commit() \u68c0\u67e5mysql mysql> show tables; +----------------+ | Tables_in_blog | +----------------+ | article_tag | | articles | | categories | | tags | | userinfos | | users | +----------------+ 6 rows in set (0.00 sec)","title":"6. \u5173\u7cfb\u5b9a\u4e49"},{"location":"python/lib/SQLAlchemy/6.\u5173\u7cfb\u5b9a\u4e49/#1","text":"\u5bf9\u4e8e\u4e00\u4e2a\u666e\u901a\u7684\u535a\u5ba2\u5e94\u7528\u6765\u8bf4\uff0c\u7528\u6237\u548c\u6587\u7ae0\u663e\u7136\u662f\u4e00\u4e2a\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\uff0c\u4e00\u7bc7\u6587\u7ae0\u5c5e\u4e8e\u4e00\u4e2a\u7528\u6237\uff0c\u4e00\u4e2a\u7528\u6237\u53ef\u4ee5\u5199\u5f88\u591a\u7bc7\u6587\u7ae0\uff0c\u90a3\u4e48\u4ed6\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u53ef\u4ee5\u8fd9\u6837\u5b9a\u4e49\uff1a class User(Base): __tablename__ = 'users' id = Column(Integer, primary_key=True) username = Column(String(64), nullable=False, index=True) password = Column(String(64), nullable=False) email = Column(String(64), nullable=False, index=True) articles = relationship('Article') def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.username) class Article(Base): __tablename__ = 'articles' id = Column(Integer, primary_key=True) title = Column(String(255), nullable=False, index=True) content = Column(Text) user_id = Column(Integer, ForeignKey('users.id')) author = relationship('User') def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.title) \u6bcf\u7bc7\u6587\u7ae0\u6709\u4e00\u4e2a\u5916\u952e\u6307\u5411 users \u8868\u4e2d\u7684\u4e3b\u952e id\uff0c \u800c\u5728 User \u4e2d\u4f7f\u7528 SQLAlchemy \u63d0\u4f9b\u7684 relationship \u63cf\u8ff0 \u5173\u7cfb\u3002\u800c\u7528\u6237\u4e0e\u6587\u7ae0\u7684\u4e4b\u95f4\u7684\u8fd9\u4e2a\u5173\u7cfb\u662f\u53cc\u5411\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u770b\u5230\u4e0a\u9762\u7684\u4e24\u5f20\u8868\u4e2d\u90fd\u5b9a\u4e49\u4e86 relationship\u3002 SQLAlchemy \u63d0\u4f9b\u4e86 backref \u8ba9\u6211\u4eec\u53ef\u4ee5\u53ea\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u5173\u7cfb\uff1a articles = relationship('Article', backref='author') \u6dfb\u52a0\u4e86\u8fd9\u4e2a\u5c31\u53ef\u4ee5\u4e0d\u7528\u518d\u5728 Article \u4e2d\u5b9a\u4e49 relationship \u4e86\uff01","title":"1. \u4e00\u5bf9\u591a\u5173\u7cfb"},{"location":"python/lib/SQLAlchemy/6.\u5173\u7cfb\u5b9a\u4e49/#2","text":"\u5728 User \u4e2d\u6211\u4eec\u53ea\u5b9a\u4e49\u4e86\u51e0\u4e2a\u5fc5\u987b\u7684\u5b57\u6bb5\uff0c \u4f46\u901a\u5e38\u7528\u6237\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u4fe1\u606f\uff0c\u4f46\u8fd9\u4e9b\u4fe1\u606f\u53ef\u80fd\u4e0d\u662f\u5fc5\u987b\u586b\u5199\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u4eec\u653e\u5230\u53e6\u4e00\u5f20 UserInfo \u8868\u4e2d\uff0c\u8fd9\u6837User \u548c UserInfo \u5c31\u5f62\u6210\u4e86\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb\u3002\u4f60\u53ef\u80fd\u4f1a\u5947\u602a\u4e00\u5bf9\u4e00\u5173\u7cfb\u4e3a\u4ec0\u4e48\u4e0d\u5728\u4e00\u5bf9\u591a\u5173\u7cfb\u524d\u9762\uff1f\u90a3\u662f\u56e0\u4e3a\u4e00\u5bf9\u4e00\u5173\u7cfb\u662f\u57fa\u4e8e\u4e00\u5bf9\u591a\u5b9a\u4e49\u7684\uff1a class User(Base): __tablename__ = 'users' id = Column(Integer, primary_key=True) username = Column(String(64), nullable=False, index=True) password = Column(String(64), nullable=False) email = Column(String(64), nullable=False, index=True) articles = relationship('Article', backref='author') userinfo = relationship('UserInfo', backref='user', uselist=False) def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.username) class UserInfo(Base): __tablename__ = 'userinfos' id = Column(Integer, primary_key=True) name = Column(String(64)) qq = Column(String(11)) phone = Column(String(11)) link = Column(String(64)) user_id = Column(Integer, ForeignKey('users.id')) \u5b9a\u4e49\u65b9\u6cd5\u548c\u4e00\u5bf9\u591a\u76f8\u540c\uff0c\u53ea\u662f\u9700\u8981\u6dfb\u52a0 userlist=False","title":"2. \u4e00\u5bf9\u4e00\u5173\u7cfb"},{"location":"python/lib/SQLAlchemy/6.\u5173\u7cfb\u5b9a\u4e49/#3","text":"\u4e00\u904d\u535a\u5ba2\u901a\u5e38\u6709\u4e00\u4e2a\u5206\u7c7b\uff0c\u597d\u51e0\u4e2a\u6807\u7b7e\u3002\u6807\u7b7e\u4e0e\u535a\u5ba2\u4e4b\u95f4\u5c31\u662f\u4e00\u4e2a\u591a\u5bf9\u591a\u7684\u5173\u7cfb\u3002\u591a\u5bf9\u591a\u5173\u7cfb\u4e0d\u80fd\u76f4\u63a5\u5b9a\u4e49\uff0c\u9700\u8981\u5206\u89e3\u6210\u4fe9\u4e2a\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\uff0c\u4e3a\u6b64\uff0c\u9700\u8981\u4e00\u5f20\u989d\u5916\u7684\u8868\u6765\u534f\u52a9\u5b8c\u6210\uff1a article_tag = Table( 'article_tag', Base.metadata, Column('article_id', Integer, ForeignKey('articles.id')), Column('tag_id', Integer, ForeignKey('tags.id')) ) class Tag(Base): __tablename__ = 'tags' id = Column(Integer, primary_key=True) name = Column(String(64), nullable=False, index=True) def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.name)","title":"3. \u591a\u5bf9\u591a\u5173\u7cfb"},{"location":"python/lib/SQLAlchemy/6.\u5173\u7cfb\u5b9a\u4e49/#4","text":"\u8868\u5df2\u7ecf\u63cf\u8ff0\u597d\u4e86\uff0c\u5728\u6587\u4ef6\u672b\u5c3e\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5728\u6211\u4eec\u8fde\u63a5\u7684\u6570\u636e\u5e93\u4e2d\u521b\u5efa\u5bf9\u5e94\u7684\u8868\uff1a if __name__ == '__main__': Base.metadata.create_all(engine) \u5b8c\u6574\u4ee3\u7801 # coding: utf-8 import random from faker import Factory from sqlalchemy import create_engine, Table from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import ForeignKey from sqlalchemy import Column, String, Integer, Text from sqlalchemy.orm import sessionmaker, relationship engine = create_engine(\"mysql+pymysql://root:root@127.0.0.1/blog\", encoding='utf-8', echo=False) Base = declarative_base() class User(Base): __tablename__ = 'users' id = Column(Integer, primary_key=True) username = Column(String(64), nullable=False, index=True) password = Column(String(64), nullable=False) email = Column(String(64), nullable=False, index=True) articles = relationship('Article', backref='author') userinfo = relationship('UserInfo', backref='user', uselist=False) def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.username) class UserInfo(Base): __tablename__ = 'userinfos' id = Column(Integer, primary_key=True) name = Column(String(64)) qq = Column(String(11)) phone = Column(String(11)) link = Column(String(64)) user_id = Column(Integer, ForeignKey('users.id')) class Article(Base): __tablename__ = 'articles' id = Column(Integer, primary_key=True) title = Column(String(255), nullable=False, index=True) content = Column(Text) user_id = Column(Integer, ForeignKey('users.id')) cate_id = Column(Integer, ForeignKey('categories.id')) tags = relationship('Tag', secondary='article_tag', backref='articles') def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.title) class Category(Base): __tablename__ = 'categories' id = Column(Integer, primary_key=True) name = Column(String(64), nullable=False, index=True) articles = relationship('Article', backref='category') def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.name) article_tag = Table( 'article_tag', Base.metadata, Column('article_id', Integer, ForeignKey('articles.id')), Column('tag_id', Integer, ForeignKey('tags.id')) ) class Tag(Base): __tablename__ = 'tags' id = Column(Integer, primary_key=True) name = Column(String(64), nullable=False, index=True) def __repr__(self): return '%s(%r)' % (self.__class__.__name__, self.name) if __name__ == '__main__': Base.metadata.create_all(engine) faker = Factory.create() Session = sessionmaker(bind=engine) session = Session() faker_users = [User( username=faker.name(), password=faker.word(), email=faker.email(), ) for i in range(10)] session.add_all(faker_users) faker_categories = [Category(name=faker.word()) for i in range(5)] session.add_all(faker_categories) faker_tags = [Tag(name=faker.word()) for i in range(20)] session.add_all(faker_tags) for i in range(100): article = Article( title=faker.sentence(), content=' '.join(faker.sentences(nb=random.randint(10, 20))), author=random.choice(faker_users), category=random.choice(faker_categories) ) for tag in random.sample(faker_tags, random.randint(2, 5)): article.tags.append(tag) session.add(article) session.commit() \u68c0\u67e5mysql mysql> show tables; +----------------+ | Tables_in_blog | +----------------+ | article_tag | | articles | | categories | | tags | | userinfos | | users | +----------------+ 6 rows in set (0.00 sec)","title":"4. \u6620\u5c04\u5230\u6570\u636e"},{"location":"python/lib/email/smtp/lib_smtp/","text":"python smtp \u4f7f\u7528 1. \u5355\u4eba\u63a5\u53d7\u90ae\u4ef6 \u00b6 \u53c2\u8003\u5730\u5740 SMTP\uff08Simple Mail Transfer Protocol\uff09\u5373\u7b80\u5355\u90ae\u4ef6\u4f20\u8f93\u534f\u8bae,\u5b83\u662f\u4e00\u7ec4\u7528\u4e8e\u7531\u6e90\u5730\u5740\u5230\u76ee\u7684\u5730\u5740\u4f20\u9001\u90ae\u4ef6\u7684\u89c4\u5219\uff0c\u7531\u5b83\u6765\u63a7\u5236\u4fe1\u4ef6\u7684\u4e2d\u8f6c\u65b9\u5f0f\u3002 python\u7684smtplib\u63d0\u4f9b\u4e86\u4e00\u79cd\u5f88\u65b9\u4fbf\u7684\u9014\u5f84\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u3002\u5b83\u5bf9smtp\u534f\u8bae\u8fdb\u884c\u4e86\u7b80\u5355\u7684\u5c01\u88c5\u3002 Python\u521b\u5efa SMTP \u5bf9\u8c61\u8bed\u6cd5\u5982\u4e0b\uff1a import smtplib smtpObj = smtplib.SMTP( [host [, port [, local_hostname]]] ) \u53c2\u6570\u89e3\u91ca 1. host : SMTP \u670d\u52a1\u5668\u4e3b\u673a\u3002 \u4f60\u53ef\u4ee5\u6307\u5b9a\u4e3b\u673a\u7684 ip\u5730\u5740\u6216\u8005\u57df\u540d\u5982 : runoob . com \uff0c\u8fd9\u4e2a\u662f\u53ef\u9009\u53c2\u6570\u3002 2. port : \u5982\u679c\u4f60\u63d0\u4f9b\u4e86 host \u53c2\u6570 , \u4f60\u9700\u8981\u6307\u5b9a SMTP \u670d\u52a1\u4f7f\u7528\u7684\u7aef\u53e3\u53f7\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b SMTP \u7aef\u53e3\u53f7\u4e3a 25 \u3002 3. local_hostname : \u5982\u679c SMTP \u5728\u4f60\u7684\u672c\u673a\u4e0a\uff0c\u4f60\u53ea\u9700\u8981\u6307\u5b9a\u670d\u52a1\u5668\u5730\u5740\u4e3a localhost \u5373\u53ef\u3002 Python SMTP \u5bf9\u8c61\u4f7f\u7528 sendmail \u65b9\u6cd5\u53d1\u9001\u90ae\u4ef6\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a \u53c2\u6570\u89e3\u91ca 1. from_addr : \u90ae\u4ef6\u53d1\u9001\u8005\u5730\u5740\u3002 2. to_addrs : \u5b57\u7b26\u4e32\u5217\u8868\uff0c\u90ae\u4ef6\u53d1\u9001\u5730\u5740\u3002 3. msg : \u53d1\u9001\u6d88\u606f \u8fd9\u91cc\u8981\u6ce8\u610f\u4e00\u4e0b\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c msg \u662f\u5b57\u7b26\u4e32\uff0c\u8868\u793a\u90ae\u4ef6\u3002\u6211\u4eec\u77e5\u9053\u90ae\u4ef6\u4e00\u822c\u7531\u6807\u9898\uff0c\u53d1\u4fe1\u4eba\uff0c\u6536\u4ef6\u4eba\uff0c\u90ae\u4ef6\u5185\u5bb9\uff0c\u9644\u4ef6\u7b49\u6784\u6210\uff0c\u53d1\u9001\u90ae\u4ef6\u7684\u65f6\u5019\uff0c\u8981\u6ce8\u610f msg \u7684\u683c\u5f0f\u3002 \u8fd9\u4e2a\u683c\u5f0f\u5c31\u662f smtp \u534f\u8bae\u4e2d\u5b9a\u4e49\u7684\u683c\u5f0f\u3002 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/1/21 11:11 @File : sendmail.py @Software: PyCharm \"\"\" import smtplib from email.mime.text import MIMEText def send_qqmail(send_user, auth_code, contents, subject, recv_user): \"\"\" :param send_user: \u53d1\u9001\u8005\u90ae\u7bb1\u5730\u5740<\u5168\u90e8\u5305\u62ec\u540e\u7f00>\uff0c\u4e5f\u5c31\u662f\u90ae\u7bb1\u767b\u5f55\u8d26\u53f7 :param auth_code: \u53d1\u9001\u8005\u90ae\u7bb1\u7684\u6388\u6743\u7801\uff0c\u800c\u975e\u767b\u5f55\u5bc6\u7801 :param contents: \u90ae\u7bb1\u5730\u5740\u6b63\u6587 :param subject: \u90ae\u7bb1\u4e3b\u9898 :param recv_user: \u63a5\u53d7\u90ae\u7bb1\u5730\u5740 :return: QQ\u53d1\u9001\u90ae\u4ef6 \"\"\" ret = True try: mail_host = 'smtp.qq.com' msg = MIMEText(contents, 'plain', 'utf-8') # \u6784\u9020\u90ae\u4ef6\u6b63\u6587 msg['From'] = send_user # \u6784\u9020\u90ae\u4ef6\u5934\u90e8 msg['To'] = recv_user # \u63a5\u53d7\u8005 msg['Subject'] = subject # \u90ae\u4ef6\u4e3b\u9898 server = smtplib.SMTP_SSL(mail_host, 465) # qq->465, 163->25 server.login(send_user, auth_code) # \u767b\u5f55 server.sendmail(send_user, recv_user, msg.as_string()) except smtplib.SMTPException: ret = False finally: server.quit() # \u5173\u95ed\u8fde\u63a5 return ret if __name__ == '__main__': # send_qqmail('610658552@qq.com', 'bsswzfgmawesbcjd', '\u65b0\u6d6a\u722c\u866b\u6d4b\u8bd5\u7ed3\u679c', '\u65b0\u6d6a\u722c\u866b\u90ae\u4ef6', '610658552@qq.com') ret = send_qqmail(send_user=\"610658552@qq.com\", auth_code=\"bsswzfgmawesbcjd\", contents='\u90ae\u4ef6\u6b63\u6587: \u65b0\u6d6a\u722c\u866b\u7ed3\u679c\u5982\u4e0b', subject='\u90ae\u4ef6\u4e3b\u9898: \u65b0\u6d6a\u722c\u866b\u90ae\u4ef6', recv_user='610658552@qq.com') if ret: print(\"\u90ae\u4ef6\u53d1\u9001\u6210\u529f\") else: print(\"\u90ae\u4ef6\u53d1\u9001\u5931\u8d25\") \u8fd0\u884c \"C:\\Program Files\\Python37\\python.exe\" D:/code/code-django/sendmail.py \u90ae\u4ef6\u53d1\u9001\u6210\u529f \u67e5\u770b 2. \u591a\u4eba\u63a5\u53d7\u90ae\u4ef6 \u00b6 \u548c\u5355\u4eba\u63a5\u53d7\u90ae\u4ef6\u7684\u4ee3\u7801\u51e0\u4e4e\u4e00\u81f4\uff0c\u5c31\u662f\u5728\u63a5\u53d7\u90a3\u90e8\u5206\u6539\u4e3a\u5217\u8868\u3002 recv_user.split()\uff0c\u8fd9\u6837\u6539\u53d8\u540e\uff0c\u7ed3\u679c\u662f\u5217\u8868\uff0c\u8fd9\u6837\u5c31\u80fd\u591a\u4eba\u63a5\u53d7\u90ae\u4ef6\u4e86\u3002 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/1/21 11:11 @File : sendmail.py @Software: PyCharm \"\"\" import smtplib from email.mime.text import MIMEText def send_qqmail(send_user, auth_code, contents, subject, recv_user): \"\"\" :param send_user: \u53d1\u9001\u8005\u90ae\u7bb1\u5730\u5740<\u5168\u90e8\u5305\u62ec\u540e\u7f00>\uff0c\u4e5f\u5c31\u662f\u90ae\u7bb1\u767b\u5f55\u8d26\u53f7 :param auth_code: \u53d1\u9001\u8005\u90ae\u7bb1\u7684\u6388\u6743\u7801\uff0c\u800c\u975e\u767b\u5f55\u5bc6\u7801 :param contents: \u90ae\u7bb1\u5730\u5740\u6b63\u6587 :param subject: \u90ae\u7bb1\u4e3b\u9898 :param recv_user: \u63a5\u53d7\u90ae\u7bb1\u5730\u5740 :return: QQ\u53d1\u9001\u90ae\u4ef6 \"\"\" ret = True try: mail_host = 'smtp.qq.com' msg = MIMEText(contents, 'plain', 'utf-8') # \u6784\u9020\u90ae\u4ef6\u6b63\u6587 msg['From'] = send_user # \u6784\u9020\u90ae\u4ef6\u5934\u90e8 msg['To'] = recv_user # \u63a5\u53d7\u8005 msg['Subject'] = subject # \u90ae\u4ef6\u4e3b\u9898 server = smtplib.SMTP_SSL(mail_host, 465) # qq->465, 163->25 server.login(send_user, auth_code) # \u767b\u5f55 server.sendmail(send_user, recv_user.split(), msg.as_string()) except smtplib.SMTPException: ret = False finally: server.quit() # \u5173\u95ed\u8fde\u63a5 return ret if __name__ == '__main__': # send_qqmail('610658552@qq.com', 'bsswzfgmawesbcjd', '\u65b0\u6d6a\u722c\u866b\u6d4b\u8bd5\u7ed3\u679c', '\u65b0\u6d6a\u722c\u866b\u90ae\u4ef6', '610658552@qq.com') ret = send_qqmail(send_user=\"610658552@qq.com\", auth_code=\"bsswzfgmawesbcjd\", contents='\u90ae\u4ef6\u6b63\u6587: \u65b0\u6d6a\u722c\u866b\u7ed3\u679c\u5982\u4e0b', subject='\u90ae\u4ef6\u4e3b\u9898: \u65b0\u6d6a\u722c\u866b\u90ae\u4ef6', recv_user=\"610658552@qq.com 123456@qq.com\") if ret: print(\"\u90ae\u4ef6\u53d1\u9001\u6210\u529f\") else: print(\"\u90ae\u4ef6\u53d1\u9001\u5931\u8d25\") \u6ce8\u610f recv_user . split () \u8f6c\u53d8\u6210\u5217\u8868 \u5728\u8c03\u7528\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u591a\u4e2a\u4eba\u7684\u90ae\u7bb1\u5199\u5728\u53cc\u5f15\u53f7\u4e0b\u9762\uff0c\u4e2d\u95f4\u7528\u7a7a\u683c\u9694\u5f00\uff0c\u540e\u9762\u662f\u6839\u636e\u7a7a\u683c\u6765\u5207\u5206\u7684 ex : recv_user = \"xx3@qq.com xxx1@qq.com xxx2@qq.com\" )","title":"1. smtp"},{"location":"python/lib/email/smtp/lib_smtp/#1","text":"\u53c2\u8003\u5730\u5740 SMTP\uff08Simple Mail Transfer Protocol\uff09\u5373\u7b80\u5355\u90ae\u4ef6\u4f20\u8f93\u534f\u8bae,\u5b83\u662f\u4e00\u7ec4\u7528\u4e8e\u7531\u6e90\u5730\u5740\u5230\u76ee\u7684\u5730\u5740\u4f20\u9001\u90ae\u4ef6\u7684\u89c4\u5219\uff0c\u7531\u5b83\u6765\u63a7\u5236\u4fe1\u4ef6\u7684\u4e2d\u8f6c\u65b9\u5f0f\u3002 python\u7684smtplib\u63d0\u4f9b\u4e86\u4e00\u79cd\u5f88\u65b9\u4fbf\u7684\u9014\u5f84\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u3002\u5b83\u5bf9smtp\u534f\u8bae\u8fdb\u884c\u4e86\u7b80\u5355\u7684\u5c01\u88c5\u3002 Python\u521b\u5efa SMTP \u5bf9\u8c61\u8bed\u6cd5\u5982\u4e0b\uff1a import smtplib smtpObj = smtplib.SMTP( [host [, port [, local_hostname]]] ) \u53c2\u6570\u89e3\u91ca 1. host : SMTP \u670d\u52a1\u5668\u4e3b\u673a\u3002 \u4f60\u53ef\u4ee5\u6307\u5b9a\u4e3b\u673a\u7684 ip\u5730\u5740\u6216\u8005\u57df\u540d\u5982 : runoob . com \uff0c\u8fd9\u4e2a\u662f\u53ef\u9009\u53c2\u6570\u3002 2. port : \u5982\u679c\u4f60\u63d0\u4f9b\u4e86 host \u53c2\u6570 , \u4f60\u9700\u8981\u6307\u5b9a SMTP \u670d\u52a1\u4f7f\u7528\u7684\u7aef\u53e3\u53f7\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b SMTP \u7aef\u53e3\u53f7\u4e3a 25 \u3002 3. local_hostname : \u5982\u679c SMTP \u5728\u4f60\u7684\u672c\u673a\u4e0a\uff0c\u4f60\u53ea\u9700\u8981\u6307\u5b9a\u670d\u52a1\u5668\u5730\u5740\u4e3a localhost \u5373\u53ef\u3002 Python SMTP \u5bf9\u8c61\u4f7f\u7528 sendmail \u65b9\u6cd5\u53d1\u9001\u90ae\u4ef6\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a \u53c2\u6570\u89e3\u91ca 1. from_addr : \u90ae\u4ef6\u53d1\u9001\u8005\u5730\u5740\u3002 2. to_addrs : \u5b57\u7b26\u4e32\u5217\u8868\uff0c\u90ae\u4ef6\u53d1\u9001\u5730\u5740\u3002 3. msg : \u53d1\u9001\u6d88\u606f \u8fd9\u91cc\u8981\u6ce8\u610f\u4e00\u4e0b\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c msg \u662f\u5b57\u7b26\u4e32\uff0c\u8868\u793a\u90ae\u4ef6\u3002\u6211\u4eec\u77e5\u9053\u90ae\u4ef6\u4e00\u822c\u7531\u6807\u9898\uff0c\u53d1\u4fe1\u4eba\uff0c\u6536\u4ef6\u4eba\uff0c\u90ae\u4ef6\u5185\u5bb9\uff0c\u9644\u4ef6\u7b49\u6784\u6210\uff0c\u53d1\u9001\u90ae\u4ef6\u7684\u65f6\u5019\uff0c\u8981\u6ce8\u610f msg \u7684\u683c\u5f0f\u3002 \u8fd9\u4e2a\u683c\u5f0f\u5c31\u662f smtp \u534f\u8bae\u4e2d\u5b9a\u4e49\u7684\u683c\u5f0f\u3002 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/1/21 11:11 @File : sendmail.py @Software: PyCharm \"\"\" import smtplib from email.mime.text import MIMEText def send_qqmail(send_user, auth_code, contents, subject, recv_user): \"\"\" :param send_user: \u53d1\u9001\u8005\u90ae\u7bb1\u5730\u5740<\u5168\u90e8\u5305\u62ec\u540e\u7f00>\uff0c\u4e5f\u5c31\u662f\u90ae\u7bb1\u767b\u5f55\u8d26\u53f7 :param auth_code: \u53d1\u9001\u8005\u90ae\u7bb1\u7684\u6388\u6743\u7801\uff0c\u800c\u975e\u767b\u5f55\u5bc6\u7801 :param contents: \u90ae\u7bb1\u5730\u5740\u6b63\u6587 :param subject: \u90ae\u7bb1\u4e3b\u9898 :param recv_user: \u63a5\u53d7\u90ae\u7bb1\u5730\u5740 :return: QQ\u53d1\u9001\u90ae\u4ef6 \"\"\" ret = True try: mail_host = 'smtp.qq.com' msg = MIMEText(contents, 'plain', 'utf-8') # \u6784\u9020\u90ae\u4ef6\u6b63\u6587 msg['From'] = send_user # \u6784\u9020\u90ae\u4ef6\u5934\u90e8 msg['To'] = recv_user # \u63a5\u53d7\u8005 msg['Subject'] = subject # \u90ae\u4ef6\u4e3b\u9898 server = smtplib.SMTP_SSL(mail_host, 465) # qq->465, 163->25 server.login(send_user, auth_code) # \u767b\u5f55 server.sendmail(send_user, recv_user, msg.as_string()) except smtplib.SMTPException: ret = False finally: server.quit() # \u5173\u95ed\u8fde\u63a5 return ret if __name__ == '__main__': # send_qqmail('610658552@qq.com', 'bsswzfgmawesbcjd', '\u65b0\u6d6a\u722c\u866b\u6d4b\u8bd5\u7ed3\u679c', '\u65b0\u6d6a\u722c\u866b\u90ae\u4ef6', '610658552@qq.com') ret = send_qqmail(send_user=\"610658552@qq.com\", auth_code=\"bsswzfgmawesbcjd\", contents='\u90ae\u4ef6\u6b63\u6587: \u65b0\u6d6a\u722c\u866b\u7ed3\u679c\u5982\u4e0b', subject='\u90ae\u4ef6\u4e3b\u9898: \u65b0\u6d6a\u722c\u866b\u90ae\u4ef6', recv_user='610658552@qq.com') if ret: print(\"\u90ae\u4ef6\u53d1\u9001\u6210\u529f\") else: print(\"\u90ae\u4ef6\u53d1\u9001\u5931\u8d25\") \u8fd0\u884c \"C:\\Program Files\\Python37\\python.exe\" D:/code/code-django/sendmail.py \u90ae\u4ef6\u53d1\u9001\u6210\u529f \u67e5\u770b","title":"1. \u5355\u4eba\u63a5\u53d7\u90ae\u4ef6"},{"location":"python/lib/email/smtp/lib_smtp/#2","text":"\u548c\u5355\u4eba\u63a5\u53d7\u90ae\u4ef6\u7684\u4ee3\u7801\u51e0\u4e4e\u4e00\u81f4\uff0c\u5c31\u662f\u5728\u63a5\u53d7\u90a3\u90e8\u5206\u6539\u4e3a\u5217\u8868\u3002 recv_user.split()\uff0c\u8fd9\u6837\u6539\u53d8\u540e\uff0c\u7ed3\u679c\u662f\u5217\u8868\uff0c\u8fd9\u6837\u5c31\u80fd\u591a\u4eba\u63a5\u53d7\u90ae\u4ef6\u4e86\u3002 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/1/21 11:11 @File : sendmail.py @Software: PyCharm \"\"\" import smtplib from email.mime.text import MIMEText def send_qqmail(send_user, auth_code, contents, subject, recv_user): \"\"\" :param send_user: \u53d1\u9001\u8005\u90ae\u7bb1\u5730\u5740<\u5168\u90e8\u5305\u62ec\u540e\u7f00>\uff0c\u4e5f\u5c31\u662f\u90ae\u7bb1\u767b\u5f55\u8d26\u53f7 :param auth_code: \u53d1\u9001\u8005\u90ae\u7bb1\u7684\u6388\u6743\u7801\uff0c\u800c\u975e\u767b\u5f55\u5bc6\u7801 :param contents: \u90ae\u7bb1\u5730\u5740\u6b63\u6587 :param subject: \u90ae\u7bb1\u4e3b\u9898 :param recv_user: \u63a5\u53d7\u90ae\u7bb1\u5730\u5740 :return: QQ\u53d1\u9001\u90ae\u4ef6 \"\"\" ret = True try: mail_host = 'smtp.qq.com' msg = MIMEText(contents, 'plain', 'utf-8') # \u6784\u9020\u90ae\u4ef6\u6b63\u6587 msg['From'] = send_user # \u6784\u9020\u90ae\u4ef6\u5934\u90e8 msg['To'] = recv_user # \u63a5\u53d7\u8005 msg['Subject'] = subject # \u90ae\u4ef6\u4e3b\u9898 server = smtplib.SMTP_SSL(mail_host, 465) # qq->465, 163->25 server.login(send_user, auth_code) # \u767b\u5f55 server.sendmail(send_user, recv_user.split(), msg.as_string()) except smtplib.SMTPException: ret = False finally: server.quit() # \u5173\u95ed\u8fde\u63a5 return ret if __name__ == '__main__': # send_qqmail('610658552@qq.com', 'bsswzfgmawesbcjd', '\u65b0\u6d6a\u722c\u866b\u6d4b\u8bd5\u7ed3\u679c', '\u65b0\u6d6a\u722c\u866b\u90ae\u4ef6', '610658552@qq.com') ret = send_qqmail(send_user=\"610658552@qq.com\", auth_code=\"bsswzfgmawesbcjd\", contents='\u90ae\u4ef6\u6b63\u6587: \u65b0\u6d6a\u722c\u866b\u7ed3\u679c\u5982\u4e0b', subject='\u90ae\u4ef6\u4e3b\u9898: \u65b0\u6d6a\u722c\u866b\u90ae\u4ef6', recv_user=\"610658552@qq.com 123456@qq.com\") if ret: print(\"\u90ae\u4ef6\u53d1\u9001\u6210\u529f\") else: print(\"\u90ae\u4ef6\u53d1\u9001\u5931\u8d25\") \u6ce8\u610f recv_user . split () \u8f6c\u53d8\u6210\u5217\u8868 \u5728\u8c03\u7528\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u591a\u4e2a\u4eba\u7684\u90ae\u7bb1\u5199\u5728\u53cc\u5f15\u53f7\u4e0b\u9762\uff0c\u4e2d\u95f4\u7528\u7a7a\u683c\u9694\u5f00\uff0c\u540e\u9762\u662f\u6839\u636e\u7a7a\u683c\u6765\u5207\u5206\u7684 ex : recv_user = \"xx3@qq.com xxx1@qq.com xxx2@qq.com\" )","title":"2. \u591a\u4eba\u63a5\u53d7\u90ae\u4ef6"},{"location":"python/lib/email/smtp/lib_yagmail/","text":"yagmail \u5b9e\u73b0\u53d1\u90ae\u4ef6 1. \u4ecb\u7ecd \u00b6 yagmail \u53ef\u4ee5\u66f4\u7b80\u5355\u7684\u6765\u5b9e\u73b0\u81ea\u52a8\u53d1\u90ae\u4ef6\u529f\u80fd\u3002 github\u9879\u76ee\u5730\u5740 2. \u5b89\u88c5 \u00b6 pip install yagmail 3. \u53d1\u90ae\u4ef6 \u00b6 3.1 \u4e0d\u5e26\u9644\u4ef6 \u00b6 root@leco:~/code/email# cat demo.py import yagmail #\u94fe\u63a5\u90ae\u7bb1\u670d\u52a1\u5668 yag = yagmail.SMTP(user=\"caimengzhi@163.com\", password=\"caimengzhi\", host='smtp.163.com') # \u90ae\u7bb1\u6b63\u6587 contents = ['\u90ae\u4ef6\u6b63\u6587'] # \u53d1\u9001\u90ae\u4ef6 yag.send('caimengzhi@qq.com', '\u4e3b\u9898: subject', contents) print(\"\u5df2\u53d1\u9001\u90ae\u4ef6\") \u53c2\u6570\u89e3\u91ca 1. user \u767b\u5f55\u90ae\u7bb1\uff0c\u90ae\u7bb1\u8d26\u53f7 2. password 163 / 126 / qq \u7b49\u90ae\u7bb1\u7684\u6388\u6743\u7801 3. host \u90ae\u4ef6\u670d\u52a1\u5668\u4e3b\u673a\u540d - smtp . 126. com - smtp . 163. com - smtp . qq . com 4. contents \u90ae\u4ef6\u6b63\u6587 5. subject \u90ae\u4ef6\u4e3b\u9898 3.2 \u5e26\u9644\u4ef6 \u00b6 3.2.1 \u5355\u4eba\u63a5\u53d7\u90ae\u4ef6 \u00b6 root@leco:~/code/email# cat single.py import yagmail yag = yagmail.SMTP(user='caimengzhi@163.com', password='caimengzhi', host='smtp.163.com', port='465') body = \"\u90ae\u4ef6\u6b63\u6587: \u8fd9\u662f\u6700\u8fd1\u5de5\u4f5c\u7684\u6587\u4ef6\uff0c\u8bf7\u67e5\u6536\u3002\" yag.send(to='caimengzhi@qq.com', subject='\u90ae\u4ef6\u6807\u9898: \u5de5\u4f5c\u6587\u4ef6', contents=[body, './linux.jpg', './lib_yagmail.py']) print(\"\u5df2\u53d1\u9001\u90ae\u4ef6\") 3.2.2 \u591a\u4eba\u63a5\u53d7\u90ae\u4ef6 \u00b6 root@leco:~/code/email# cat many.py import yagmail yag = yagmail.SMTP(user='caimengzhi@163.com', password='caimengzhi', host='smtp.163.com', port='465') body = \"\u90ae\u4ef6\u6b63\u6587: \u8fd9\u662f\u6700\u8fd1\u5de5\u4f5c\u7684\u6587\u4ef6\uff0c\u8bf7\u67e5\u6536\u3002\" yag.send(['caimengzhi@qq.com','caimengzhi@163.com'], subject='\u90ae\u4ef6\u6807\u9898: \u5de5\u4f5c\u6587\u4ef6', contents=[body, './linux.jpg', './lib_yagmail.py']) print(\"\u5df2\u53d1\u9001\u90ae\u4ef6\") \u53c2\u6570\u89e3\u91ca \u5355\u4eba\u548c\u591a\u4eba\u63a5\u53d7\u7684\u533a\u522b\u5c31\u662f - \u5355\u4eba\u63a5\u53d7\u90ae\u4ef6\uff0c\u5c31\u5199\u4e00\u4e2a\u63a5\u53d7\u90ae\u4ef6\u4eba\u90ae\u7bb1 - \u591a\u4eba\u63a5\u53d7\u90ae\u4ef6\uff0c\u5c31\u5199\u4e00\u4e2a\u63a5\u53d7\u90ae\u4ef6\u4eba\u90ae\u7bb1\u5217\u8868\uff0c\u628a\u6240\u6709\u63a5\u53d7\u4eba\u90ae\u7bb1\u5199\u5230\u8fd9\u4e2a\u5217\u8868\u91cc\u9762 ./ linux . jpg ./ lib_yagmail . py \u8981\u53d1\u9001\u7684\u90ae\u4ef6\u9644\u4ef6 \u6ce8\u610f \u4ee5\u4e0a\u6240\u6709 code\u7684\u4e2a\u4eba\u4fe1\u606f \uff0c\u6211\u90fd\u6362\u6210 caimengzhi \uff0c\u6839\u636e\u81ea\u5df1\u7684\u5b9e\u9645\u60c5\u51b5\u586b\u5199","title":"2. yagmail"},{"location":"python/lib/email/smtp/lib_yagmail/#1","text":"yagmail \u53ef\u4ee5\u66f4\u7b80\u5355\u7684\u6765\u5b9e\u73b0\u81ea\u52a8\u53d1\u90ae\u4ef6\u529f\u80fd\u3002 github\u9879\u76ee\u5730\u5740","title":"1. \u4ecb\u7ecd"},{"location":"python/lib/email/smtp/lib_yagmail/#2","text":"pip install yagmail","title":"2. \u5b89\u88c5"},{"location":"python/lib/email/smtp/lib_yagmail/#3","text":"","title":"3. \u53d1\u90ae\u4ef6"},{"location":"python/lib/email/smtp/lib_yagmail/#31","text":"root@leco:~/code/email# cat demo.py import yagmail #\u94fe\u63a5\u90ae\u7bb1\u670d\u52a1\u5668 yag = yagmail.SMTP(user=\"caimengzhi@163.com\", password=\"caimengzhi\", host='smtp.163.com') # \u90ae\u7bb1\u6b63\u6587 contents = ['\u90ae\u4ef6\u6b63\u6587'] # \u53d1\u9001\u90ae\u4ef6 yag.send('caimengzhi@qq.com', '\u4e3b\u9898: subject', contents) print(\"\u5df2\u53d1\u9001\u90ae\u4ef6\") \u53c2\u6570\u89e3\u91ca 1. user \u767b\u5f55\u90ae\u7bb1\uff0c\u90ae\u7bb1\u8d26\u53f7 2. password 163 / 126 / qq \u7b49\u90ae\u7bb1\u7684\u6388\u6743\u7801 3. host \u90ae\u4ef6\u670d\u52a1\u5668\u4e3b\u673a\u540d - smtp . 126. com - smtp . 163. com - smtp . qq . com 4. contents \u90ae\u4ef6\u6b63\u6587 5. subject \u90ae\u4ef6\u4e3b\u9898","title":"3.1 \u4e0d\u5e26\u9644\u4ef6"},{"location":"python/lib/email/smtp/lib_yagmail/#32","text":"","title":"3.2 \u5e26\u9644\u4ef6"},{"location":"python/lib/email/smtp/lib_yagmail/#321","text":"root@leco:~/code/email# cat single.py import yagmail yag = yagmail.SMTP(user='caimengzhi@163.com', password='caimengzhi', host='smtp.163.com', port='465') body = \"\u90ae\u4ef6\u6b63\u6587: \u8fd9\u662f\u6700\u8fd1\u5de5\u4f5c\u7684\u6587\u4ef6\uff0c\u8bf7\u67e5\u6536\u3002\" yag.send(to='caimengzhi@qq.com', subject='\u90ae\u4ef6\u6807\u9898: \u5de5\u4f5c\u6587\u4ef6', contents=[body, './linux.jpg', './lib_yagmail.py']) print(\"\u5df2\u53d1\u9001\u90ae\u4ef6\")","title":"3.2.1 \u5355\u4eba\u63a5\u53d7\u90ae\u4ef6"},{"location":"python/lib/email/smtp/lib_yagmail/#322","text":"root@leco:~/code/email# cat many.py import yagmail yag = yagmail.SMTP(user='caimengzhi@163.com', password='caimengzhi', host='smtp.163.com', port='465') body = \"\u90ae\u4ef6\u6b63\u6587: \u8fd9\u662f\u6700\u8fd1\u5de5\u4f5c\u7684\u6587\u4ef6\uff0c\u8bf7\u67e5\u6536\u3002\" yag.send(['caimengzhi@qq.com','caimengzhi@163.com'], subject='\u90ae\u4ef6\u6807\u9898: \u5de5\u4f5c\u6587\u4ef6', contents=[body, './linux.jpg', './lib_yagmail.py']) print(\"\u5df2\u53d1\u9001\u90ae\u4ef6\") \u53c2\u6570\u89e3\u91ca \u5355\u4eba\u548c\u591a\u4eba\u63a5\u53d7\u7684\u533a\u522b\u5c31\u662f - \u5355\u4eba\u63a5\u53d7\u90ae\u4ef6\uff0c\u5c31\u5199\u4e00\u4e2a\u63a5\u53d7\u90ae\u4ef6\u4eba\u90ae\u7bb1 - \u591a\u4eba\u63a5\u53d7\u90ae\u4ef6\uff0c\u5c31\u5199\u4e00\u4e2a\u63a5\u53d7\u90ae\u4ef6\u4eba\u90ae\u7bb1\u5217\u8868\uff0c\u628a\u6240\u6709\u63a5\u53d7\u4eba\u90ae\u7bb1\u5199\u5230\u8fd9\u4e2a\u5217\u8868\u91cc\u9762 ./ linux . jpg ./ lib_yagmail . py \u8981\u53d1\u9001\u7684\u90ae\u4ef6\u9644\u4ef6 \u6ce8\u610f \u4ee5\u4e0a\u6240\u6709 code\u7684\u4e2a\u4eba\u4fe1\u606f \uff0c\u6211\u90fd\u6362\u6210 caimengzhi \uff0c\u6839\u636e\u81ea\u5df1\u7684\u5b9e\u9645\u60c5\u51b5\u586b\u5199","title":"3.2.2 \u591a\u4eba\u63a5\u53d7\u90ae\u4ef6"},{"location":"python/lib/encryption_decryption/base64/1.base64\u4f7f\u7528/","text":"\u5b98\u7f51\u5730\u5740 1. \u7b80\u4ecb \u00b6 \u3000 \u5728\u4e00\u4e9b\u9879\u76ee\u4e2d\uff0c\u63a5\u53e3\u7684\u62a5\u6587\u662f\u901a\u8fc7base64\u52a0\u5bc6\u4f20\u8f93\u7684\uff0c\u6240\u4ee5\u5728\u8fdb\u884c\u63a5\u53e3\u81ea\u52a8\u5316\u65f6\uff0c\u9700\u8981\u5bf9\u6240\u4f20\u7684\u53c2\u6570\u8fdb\u884cbase64\u7f16\u7801\uff0c\u5bf9\u62ff\u5230\u7684\u54cd\u5e94\u62a5\u6587\u8fdb\u884c\u89e3\u7801\u3002 \u3000 Base64\u7f16\u7801\u662f\u4e00\u79cd\u201c\u9632\u541b\u5b50\u4e0d\u9632\u5c0f\u4eba\u201d\u7684\u7f16\u7801\u65b9\u5f0f\u3002\u5e7f\u6cdb\u5e94\u7528\u4e8eMIME\u534f\u8bae\uff0c\u4f5c\u4e3a\u7535\u5b50\u90ae\u4ef6\u7684\u4f20\u8f93\u7f16\u7801\uff0c\u751f\u6210\u7684\u7f16\u7801\u53ef\u9006\uff0c\u540e\u4e00\u4e24\u4f4d\u53ef\u80fd\u6709\u201c=\u201d\uff0c\u751f\u6210\u7684\u7f16\u7801\u90fd\u662fascii\u5b57\u7b26\u3002 \u4f18\u70b9\uff1a\u901f\u5ea6\u5feb\uff0cascii\u5b57\u7b26\uff0c\u8089\u773c\u4e0d\u53ef\u7406\u89e3 \u7f3a\u70b9\uff1a\u7f16\u7801\u6bd4\u8f83\u957f\uff0c\u975e\u5e38\u5bb9\u6613\u88ab\u7834\u89e3\uff0c\u4ec5\u9002\u7528\u4e8e\u52a0\u5bc6\u975e\u5173\u952e\u4fe1\u606f\u7684\u573a\u5408 2. python2\u4e2d \u00b6 #!/usr/bin/python # _*_ coding: utf-8 _*_ import base64 s = '\u6211\u662f\u5b57\u7b26\u4e32' a = base64.b64encode(s) print a print base64.b64decode(a) \u8fd0\u884c root@root:~$ python2 1.py 5oiR5piv5a2X56ym5Liy \u6211\u662f\u5b57\u7b26\u4e32 3. python3\u4e2d \u00b6 python3\u4e0d\u592a\u4e00\u6837\uff1a\u56e0\u4e3a3.x\u4e2d\u5b57\u7b26\u90fd\u4e3aunicode\u7f16\u7801\uff0c\u800cb64encode\u51fd\u6570\u7684\u53c2\u6570\u4e3abyte\u7c7b\u578b\uff0c\u6240\u4ee5\u5fc5\u987b\u5148\u8f6c\u7801\u3002 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Author : caimengzhi @File : base64\u4f7f\u7528.py @Software: PyCharm \"\"\" import base64 if __name__ == '__main__': s = 'plain text' # base64\u7f16\u7801 t = base64.b64encode(s.encode('UTF-8')) print(\"base64\u7f16\u7801 \",str(t, 'utf-8')) # base64\u89e3\u7801 t = base64.b64decode(t) print(\"base64\u89e3\u7801 \",str(t, 'utf-8')) # base32\u7f16\u7801 t = base64.b32encode(s.encode('UTF-8')) print(\"base32\u7f16\u7801 \",str(t, 'utf-8')) # base32\u89e3\u7801 t = base64.b32decode(t) print(\"base32\u89e3\u7801 \",str(t, 'utf-8')) # base16\u7f16\u7801 t = base64.b16encode(s.encode('UTF-8')) print(\"base16\u7f16\u7801 \",str(t, 'utf-8')) # base16\u89e3\u7801 t = base64.b16decode(t) print(\"base16\u89e3\u7801 \",str(t, 'utf-8')) \u8fd0\u884c\u7ed3\u679c \"C:\\Program Files\\Python37\\python.exe\" D:/code/code-django/\u5e93/\u52a0\u5bc6\u548c\u89e3\u5bc6/base64\u4f7f\u7528.py base64\u7f16\u7801 cGxhaW4gdGV4dA== base64\u89e3\u7801 plain text base32\u7f16\u7801 OBWGC2LOEB2GK6DU base32\u89e3\u7801 plain text base16\u7f16\u7801 706C61696E2074657874 base16\u89e3\u7801 plain text \u6ce8\u610f base64.bxxencode\u63a5\u53d7\u4e00\u4e2a\u5b57\u8282\u6570\u7ec4bytes\u7528\u4e8e\u52a0\u5bc6\uff0c\u8fd4\u56de\u4e00\u4e2abytes\u5b58\u50a8\u52a0\u5bc6\u4e4b\u540e\u7684\u5185\u5bb9\u3002 base64.bxxdecode\u63a5\u53d7\u4e00\u4e2a\u5b58\u653e\u7740\u5bc6\u6587\u7684bytes\uff0c\u8fd4\u56de\u4e00\u4e2abytes\u5b58\u653e\u7740\u89e3\u5bc6\u540e\u7684\u5185\u5bb9\u3002","title":"1. base4"},{"location":"python/lib/encryption_decryption/base64/1.base64\u4f7f\u7528/#1","text":"\u5728\u4e00\u4e9b\u9879\u76ee\u4e2d\uff0c\u63a5\u53e3\u7684\u62a5\u6587\u662f\u901a\u8fc7base64\u52a0\u5bc6\u4f20\u8f93\u7684\uff0c\u6240\u4ee5\u5728\u8fdb\u884c\u63a5\u53e3\u81ea\u52a8\u5316\u65f6\uff0c\u9700\u8981\u5bf9\u6240\u4f20\u7684\u53c2\u6570\u8fdb\u884cbase64\u7f16\u7801\uff0c\u5bf9\u62ff\u5230\u7684\u54cd\u5e94\u62a5\u6587\u8fdb\u884c\u89e3\u7801\u3002 \u3000 Base64\u7f16\u7801\u662f\u4e00\u79cd\u201c\u9632\u541b\u5b50\u4e0d\u9632\u5c0f\u4eba\u201d\u7684\u7f16\u7801\u65b9\u5f0f\u3002\u5e7f\u6cdb\u5e94\u7528\u4e8eMIME\u534f\u8bae\uff0c\u4f5c\u4e3a\u7535\u5b50\u90ae\u4ef6\u7684\u4f20\u8f93\u7f16\u7801\uff0c\u751f\u6210\u7684\u7f16\u7801\u53ef\u9006\uff0c\u540e\u4e00\u4e24\u4f4d\u53ef\u80fd\u6709\u201c=\u201d\uff0c\u751f\u6210\u7684\u7f16\u7801\u90fd\u662fascii\u5b57\u7b26\u3002 \u4f18\u70b9\uff1a\u901f\u5ea6\u5feb\uff0cascii\u5b57\u7b26\uff0c\u8089\u773c\u4e0d\u53ef\u7406\u89e3 \u7f3a\u70b9\uff1a\u7f16\u7801\u6bd4\u8f83\u957f\uff0c\u975e\u5e38\u5bb9\u6613\u88ab\u7834\u89e3\uff0c\u4ec5\u9002\u7528\u4e8e\u52a0\u5bc6\u975e\u5173\u952e\u4fe1\u606f\u7684\u573a\u5408","title":"1. \u7b80\u4ecb"},{"location":"python/lib/encryption_decryption/base64/1.base64\u4f7f\u7528/#2-python2","text":"#!/usr/bin/python # _*_ coding: utf-8 _*_ import base64 s = '\u6211\u662f\u5b57\u7b26\u4e32' a = base64.b64encode(s) print a print base64.b64decode(a) \u8fd0\u884c root@root:~$ python2 1.py 5oiR5piv5a2X56ym5Liy \u6211\u662f\u5b57\u7b26\u4e32","title":"2. python2\u4e2d"},{"location":"python/lib/encryption_decryption/base64/1.base64\u4f7f\u7528/#3-python3","text":"python3\u4e0d\u592a\u4e00\u6837\uff1a\u56e0\u4e3a3.x\u4e2d\u5b57\u7b26\u90fd\u4e3aunicode\u7f16\u7801\uff0c\u800cb64encode\u51fd\u6570\u7684\u53c2\u6570\u4e3abyte\u7c7b\u578b\uff0c\u6240\u4ee5\u5fc5\u987b\u5148\u8f6c\u7801\u3002 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Author : caimengzhi @File : base64\u4f7f\u7528.py @Software: PyCharm \"\"\" import base64 if __name__ == '__main__': s = 'plain text' # base64\u7f16\u7801 t = base64.b64encode(s.encode('UTF-8')) print(\"base64\u7f16\u7801 \",str(t, 'utf-8')) # base64\u89e3\u7801 t = base64.b64decode(t) print(\"base64\u89e3\u7801 \",str(t, 'utf-8')) # base32\u7f16\u7801 t = base64.b32encode(s.encode('UTF-8')) print(\"base32\u7f16\u7801 \",str(t, 'utf-8')) # base32\u89e3\u7801 t = base64.b32decode(t) print(\"base32\u89e3\u7801 \",str(t, 'utf-8')) # base16\u7f16\u7801 t = base64.b16encode(s.encode('UTF-8')) print(\"base16\u7f16\u7801 \",str(t, 'utf-8')) # base16\u89e3\u7801 t = base64.b16decode(t) print(\"base16\u89e3\u7801 \",str(t, 'utf-8')) \u8fd0\u884c\u7ed3\u679c \"C:\\Program Files\\Python37\\python.exe\" D:/code/code-django/\u5e93/\u52a0\u5bc6\u548c\u89e3\u5bc6/base64\u4f7f\u7528.py base64\u7f16\u7801 cGxhaW4gdGV4dA== base64\u89e3\u7801 plain text base32\u7f16\u7801 OBWGC2LOEB2GK6DU base32\u89e3\u7801 plain text base16\u7f16\u7801 706C61696E2074657874 base16\u89e3\u7801 plain text \u6ce8\u610f base64.bxxencode\u63a5\u53d7\u4e00\u4e2a\u5b57\u8282\u6570\u7ec4bytes\u7528\u4e8e\u52a0\u5bc6\uff0c\u8fd4\u56de\u4e00\u4e2abytes\u5b58\u50a8\u52a0\u5bc6\u4e4b\u540e\u7684\u5185\u5bb9\u3002 base64.bxxdecode\u63a5\u53d7\u4e00\u4e2a\u5b58\u653e\u7740\u5bc6\u6587\u7684bytes\uff0c\u8fd4\u56de\u4e00\u4e2abytes\u5b58\u653e\u7740\u89e3\u5bc6\u540e\u7684\u5185\u5bb9\u3002","title":"3. python3\u4e2d"},{"location":"python/lib/encryption_decryption/base64/2.\u6848\u4f8b/","text":"\u8981\u6c42\uff1a \u64cd\u4f5cexcel \u52a0\u89e3\u5bc6excel\u67d0\u884c\u6570\u636e \u52a0\u89e3\u5bc6excel\u67d0\u5217\u6570\u636e #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Author : summer @File : \u52a0\u89e3\u5bc6.py @Software: PyCharm \"\"\" import os import base64 import openpyxl class encryption_decryption(): def __init__(self, filename, sheet_name=\"Sheet1\", row=None, column=None): self.filename = filename self.row = row self.column = column self.sheet_name = sheet_name self.row = row self.wb = None if not self.check_filename(): exit(\"%s \u6587\u4ef6\u4e0d\u5728\" % self.filename) def check_filename(self): flag = False if os.path.exists(self.filename): wb = openpyxl.load_workbook(self.filename) self.wb = wb flag = True return flag # \u52a0\u5bc6\u67d0\u884c\u6570\u636e def encryption_row(self): sheet = self.wb[self.sheet_name] # \u83b7\u53d6\u5230\u54ea\u4e00\u9875 for cell in list(sheet.rows)[self.row]: # \u7b2crow\u884c cell.value = base64.b64encode(str(cell.value).encode('UTF-8')) self.wb.save('\u52a0\u5bc6\u884c.xlsx') # \u89e3\u5bc6\u67d0\u884c\u6570\u636e def decryption_row(self): sheet = self.wb[self.sheet_name] # \u83b7\u53d6\u5230\u54ea\u4e00\u9875 for cell in list(sheet.rows)[self.row]: # \u7b2crow\u884c cell.value = str(base64.b64decode(cell.value), 'utf-8') self.wb.save('\u89e3\u5bc6\u884c.xlsx') # \u52a0\u5bc6\u67d0\u5217\u6570\u636e def encryption_column(self): sheet = self.wb[self.sheet_name] for cell in list(sheet.columns)[self.column]: # \u7b2ccolumn\u5217 cell.value = base64.b64encode(str(cell.value).encode('UTF-8')) self.wb.save('\u52a0\u5bc6\u5217.xlsx') # \u89e3\u5bc6\u67d0\u5217\u6570\u636e def decryption_column(self): sheet = self.wb[self.sheet_name] for cell in list(sheet.columns)[self.column]: # \u7b2ccolumn\u5217 cell.value = str(base64.b64decode(str(cell.value)), 'utf-8') self.wb.save('\u89e3\u5bc6\u5217.xlsx') if __name__ == '__main__': # \u52a0\u5bc6\u67d0\u884c obj = encryption_decryption(r\".\\example.xlsx\", \"Sheet1\", row=2) obj.encryption_row() # \u89e3\u5bc6\u67d0\u884c obj.decryption_row() # \u52a0\u5bc6\u67d0\u5217 obj = encryption_decryption(r\".\\example.xlsx\", column=2) obj.encryption_column() # \u89e3\u5bc6\u67d0\u5217 obj.decryption_column() \u6539\u8fdb\u7248 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/1/23 16:22 @File : \u52a0\u89e3\u5bc6.py @Software: PyCharm \"\"\" import os import base64 import openpyxl class encryption_decryption(): def __init__(self, filename, sheet_name=\"Sheet1\", row=None, column=None): self.filename = filename self.row = row self.column = column self.sheet_name = sheet_name self.row = row self.wb = None if not self.check_filename(): exit(\"%s \u6587\u4ef6\u4e0d\u5728\" % self.filename) def check_filename(self): if os.path.exists(self.filename): self.wb = openpyxl.load_workbook(self.filename) return True return False def base(self, col_row, mode, outfilename): sheet = self.wb[self.sheet_name] # \u83b7\u53d6\u5230\u54ea\u4e00\u9875 if col_row == \"\u884c\": # \u884c for cell in list(sheet.rows)[self.row]: if mode == \"\u52a0\u5bc6\": cell.value = base64.b64encode(str(cell.value).encode('UTF-8')) elif mode == \"\u89e3\u5bc6\": cell.value = str(base64.b64decode(cell.value), 'utf-8') else: exit(\"\u7f16\u7801\u65b9\u5f0f\u4e0d\u5bf9\u3002\u53ea\u80fd\u6709\uff0c\u52a0\u5bc6encrypt\u548c\u89e3\u5bc6decrypt\") elif col_row == \"\u5217\": for cell in list(sheet.columns)[self.column]: # \u7b2ccolumn\u5217 if mode == \"\u52a0\u5bc6\": cell.value = base64.b64encode(str(cell.value).encode('UTF-8')) elif mode == \"\u89e3\u5bc6\": cell.value = str(base64.b64decode(str(cell.value)), 'utf-8') else: exit(\"\u7f16\u7801\u65b9\u5f0f\u4e0d\u5bf9\u3002\u53ea\u80fd\u6709\uff0c\u52a0\u5bc6encrypt\u548c\u89e3\u5bc6decrypt\") else: exit(\"\u884c\u5217\u4e0d\u5bf9\u3002\u53ea\u80fd\u6709\u9009\u62e9\u52a0\u5bc6\u884c\u6216\u8005\u52a0\u5bc6\u5217\") self.wb.save(outfilename) def data(self, col_row, mode, outfilename): self.base(col_row, mode, outfilename) if __name__ == '__main__': # \u52a0\u89e3\u5bc6\u884c obj = encryption_decryption(r\".\\example.xlsx\", \"Sheet1\", row=2) obj.data(\"\u884c\", \"\u52a0\u5bc6\", \"\u52a0\u5bc6\u884c\u6d4b\u8bd5.xlsx\") obj.data(\"\u884c\", \"\u89e3\u5bc6\", \"\u89e3\u5bc6\u884c\u6d4b\u8bd5.xlsx\") # \u52a0\u89e3\u5bc6\u5217 obj = encryption_decryption(r\".\\example.xlsx\", \"Sheet1\", column=2) obj.data(\"\u5217\", \"\u52a0\u5bc6\", \"\u52a0\u5bc6\u5217\u6d4b\u8bd5.xlsx\") obj.data(\"\u5217\", \"\u89e3\u5bc6\", \"\u89e3\u5bc6\u5217\u6d4b\u8bd5.xlsx\")","title":"2. \u52a0\u89e3\u5bc6execl\u8868"},{"location":"python/lib/execel/1.xlrd_xlwt/","text":"\u7b80\u4ecb \u00b6 python\u64cd\u4f5cexcel\u4e3b\u8981\u7528\u5230xlrd\uff0cxlwt\u548cxlutils\u80fd\u5c06xlrd\u8fd9\u4e09\u4e2a\u5e93 - xlrd\u662f\u53ea\u80fd\u8bfbexcel\u7684\u5e93\uff0c - xlwt\u662f\u53ea\u80fd\u65b0\u5efaexcel\u7684\u5e93\u3002 - xlutils\u80fd\u5c06xlrd.Book\u8f6c\u4e3axlwt.Workbook\uff0c\u4ece\u800c\u5f97\u4ee5\u5728\u73b0\u6709xls\u7684\u57fa\u7840\u4e0a\u4fee\u6539\u6570\u636e\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a\u65b0\u7684xls\uff0c\u5b9e\u73b0\u4fee\u6539 pip install xlrd pip install xlwt pip install xlutils 1. xlrd\u5e93\u4f7f\u7528 \u00b6 Book(class) \u7531xlrd.open_work(\"example.xls\")\u8fd4\u56de nsheets: sheets\u6570 sheet_names: sheet\u540d\u79f0\u5217\u8868 sheets: sheet\u5217\u8868 sheet_by_index(sheetx): \u6309\u5e8f\u53f7\u63d0\u53d6sheet sheet_by_name(sheet_name): \u6309\u540d\u79f0\u63d0\u53d6sheet Sheet(class) \u7531Book object\u76f8\u5173\u65b9\u6cd5\u8fd4\u56de name: \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000sheet\u540d nrows: \u884c\u6570 ncols: \u5217\u6570 cell(rowx,colx): \u7b2crows\u884ccolx\u5217\u7684\u5355\u5143\u683c cell_type(rowx,colx): \u6570\u636e\u7c7b\u578b cell_value(rows,colx): \u6570\u503c col(colx): \u7b2ccolx\u5217\u6240\u6709\u5355\u5143\u683c\u7ec4\u6210\u7684\u5217\u8868 col_slice(colx,start_rowx=0,end_rowx=None): \u7b2ccolx\u5217\u6307\u5b9a\u5355\u5143\u683c\u7ec4\u6210\u7684\u5217\u8868 col_types(colx,start_rowx=0,end_rowx=None): \u7b2ccolx\u5217\u6307\u5b9a\u5355\u5143\u683c\u6570\u503c\u7c7b\u578b\u7ec4\u6210\u7684\u5217\u8868 col_values(colx,start_rowx=0,end_rowx=None): \u7b2ccolx\u5217\u6307\u5b9a\u5355\u5143\u683c\u6570\u503c\u7ec4\u6210\u7684\u5217\u8868 row\u540c\u6837\u6709col\u7684\u5404\u9879\u64cd\u4f5c\uff0c\u6b64\u5904\u7565\u53bb Cell(class) \u7531Sheet object(s)\u76f8\u5173\u65b9\u6cd5\u8fd4\u56de ctype: \u4e00\u4e2aint\u578b\u53d8\u91cf\uff0c\u5bf9\u5e94\u4e0d\u540c\u7684\u6570\u503c\u7c7b\u578b value: \u5355\u5143\u683c\u7684\u503c 2. xlwt\u5e93\u4f7f\u7528 \u00b6 Workbook(class) \u7531xlwt.Workbook()\u8fd4\u56de encoding: \u7f16\u7801\u65b9\u6848 add_sheet(sheet_name): \u6dfb\u52a0sheet get_sheet(Sheet_name): \u9009\u62e9sheet save(file_name): \u4fdd\u5b58 Worksheet(class) \u7531Workbook object\u76f8\u5173\u65b9\u6cd5\u8fd4\u56de write(rows,colx,cell_value,style): \u7f16\u8f91\u5355\u5143\u683c row(rowx).write(colx,cell_value,style): \u7f16\u8f91\u884c flush_row_data(): \u51cf\u5c11\u5185\u5b58\u538b\u529b\uff0cflush\u4e4b\u524d\u884c\u4e0d\u53ef\u518d\u4fee\u6539 col(colx),write(rows,cell_value,style): \u7f16\u8f91\u5217 easyxf(function) \u521b\u5efaXFStyle instance\uff0c\u683c\u5f0f\u63a7\u5236 expression syntax: (<element>:(<attribute> <value>,)+;)+ <element> - <attribute> - <value>: \uff08\u52a0\u7c97\u4e3a\u9ed8\u8ba4\u683c\u5f0f\uff0c\u4ee5\u4e0b\u6240\u5217\u5e76\u975e\u5168\u90e8\uff09 font - bold - True or False - colour - {colour} - italic - True or False - name - name of the font, Arial - underline - True or False alignment - direction - general, lr, rl - horizontal - general, left, center, right, filled - vertical - bottom, top, center, justified, distributed - shrink_to_fit - True or False bolders - left - an integer width between 0 and 13 - right - an integer width between 0 and 13 - top - an integer width between 0 and 13 - bottom - an integer width between 0 and 13 - diag - an integer width between 0 and 13 - left_colour - {colour}*, automatic colour - right_colour - {colour}*, automatic colour - ... pattern - back_color - {colour}*, automatic colour - fore_colour - {colour}*, automatic colour - pattern - none, solid, fine_dots, sparse_dots {colous}*: black, (dark_)(light_)blue, gold, (dark_)(light_)green, ivory, lavender, (light_)orange, pink, (dark_)red, rose, violet, white, (dark_)(light_)yellow, ... 3. xlutils\u5e93\u4f7f\u7528 \u00b6 copy: \u5c06xlrd.Book\u8f6c\u4e3axlwt.Workbook styles: \u8bfb\u53d6xlrd.Workbook\u7684\u6bcf\u4e00\u4e2a\u5355\u5143\u683c\u7684style display: \u7b80\u5355\u800c\u5b89\u5168\u5730\u5448\u73b0xlrd\u8bfb\u53d6\u7684\u6570\u636e filter: \u62c6\u5206\u4e0e\u6574\u5408\u591a\u4e2axls\u6587\u4ef6 margins: \u67e5\u770b\u8868\u683c\u7a00\u758f\u7a0b\u5ea6 save: \u5e8f\u5217\u5316xlrd.Book\uff0c\u8f6c\u5b58\u4e3abinary xls\u6216stream tips 1. xlrd.open_workbook(fomatting_info=):\u5f53formatting_info=Ture\uff0c\u8bfb\u53d6workbook\u5e76\u4fdd\u7559\u683c\u5f0f 2. xlrd.open_workbook(on_demand=): \u5f53on_demand=True\uff0c\u53ea\u6709\u88ab\u8981\u6c42\u65f6\u624d\u5c06worksheet\u8f7d\u5165\u5185\u5b58\uff0c\u8bfb\u53d6\u5927\u6587\u4ef6\u65f6\u4f7f\u7528 3. xlwt.Worksheet.flush_row_data(): \u51cf\u5c11\u5185\u5b58\u5360\u7528\uff0c\u88ab\u5237\u65b0\u7684\u884c\u4e0d\u80fd\u518d\u8bbf\u95ee\u6216\u4fee\u6539\uff0c\u5efa\u8bae\u6bcf1000\u884c\u5237\u65b0\u4e00\u6b21\uff08\u82e5\u5217\u5f88\u591a\u5f53\u8c03\u6574\uff09 4. xlwt.Workbook(encoding=): \u9009\u62e9\u521b\u5efa\u7684workbook\u7684\u7f16\u7801 \u6848\u4f8b \u00b6 1.\u5bf9excel\u7684\u5199\u64cd\u4f5c\u5b9e\u4f8b\uff1a \u00b6 \u5c06\u4e00\u4e2a\u5217\u8868\u7684\u6570\u636e\u5199\u5165excel, \u7b2c\u4e00\u884c\u662f\u6807\u9898\uff0c\u4e0b\u9762\u884c\u6570\u5177\u4f53\u7684\u6570\u636e #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/1/23 14:08 @File : 1.py @Software: PyCharm \"\"\" import xlwt # \u53ea\u80fd\u5199\u4e0d\u80fd\u8bfb stus = [['\u59d3\u540d', '\u5e74\u9f84', '\u6027\u522b', '\u5206\u6570', '\u624b\u673a\u53f7\u7801'], ['\u5f20\u4e09', 22, '\u5973', 50, '12776238304'], ['\u674e\u56db', 25, '\u7537', 72.5, '11228374621'], ['\u738b\u4e94', 33, '\u7537', 100, '12372615263'], ['\u8d75\u516d', 42, '\u5973', 66.8, '11129374727'] ] book = xlwt.Workbook() # \u65b0\u5efa\u4e00\u4e2aexcel sheet = book.add_sheet('case1_sheet') # \u6dfb\u52a0\u4e00\u4e2asheet\u9875,\u9875\u540d\u5b57\u662fcase1_sheet row = 0 # \u63a7\u5236\u884c for stu in stus: col = 0 # \u63a7\u5236\u5217 for s in stu: # \u518d\u5faa\u73af\u91cc\u9762list\u7684\u503c\uff0c\u6bcf\u4e00\u5217 sheet.write(row, col, s) col += 1 row += 1 book.save('stu_1.xls') # \u4fdd\u5b58\u5230\u5f53\u524d\u76ee\u5f55\u4e0b \u8fd0\u884c\u7ed3\u679c D:\\code\\code-django\\\u5e93\\excel\u64cd\u4f5c \u7684\u76ee\u5f55 2019/01/23 14:12 <DIR> . 2019/01/23 14:12 <DIR> .. 2019/01/23 14:12 796 1.py 2019/01/23 14:12 5,632 stu_1.xls # \u4ea7\u751f\u8fd9\u4e2a\u6587\u4ef6 2019/01/23 14:08 129 __init__.py 3 \u4e2a\u6587\u4ef6 6,557 \u5b57\u8282 2 \u4e2a\u76ee\u5f55 28,743,331,840 \u53ef\u7528\u5b57\u8282 \u4fdd\u5b58\u7684excel\u8868\u683c stu_1.xls \u59d3\u540d \u5e74\u9f84 \u6027\u522b \u5206\u6570 \u624b\u673a\u53f7\u7801 \u5f20\u4e09 22 \u5973 50 12776238304 \u674e\u56db 25 \u7537 72.5 11228374621 \u738b\u4e94 33 \u7537 100 12372615263 \u8d75\u516d 42 \u5973 66.8 11129374727 2.\u5bf9excel \u7684\u8bfb\u64cd\u4f5c\uff1a \u00b6 import xlrd # \u53ea\u80fd\u8bfb\u4e0d\u80fd\u5199 book = xlrd.open_workbook('stu_1.xls') # \u6253\u5f00\u4e00\u4e2aexcel sheet = book.sheet_by_index(0) # \u6839\u636e\u987a\u5e8f\u83b7\u53d6sheet sheet2 = book.sheet_by_name('case1_sheet') # \u6839\u636esheet\u9875\u540d\u5b57\u83b7\u53d6sheet print(sheet.cell(0, 0).value) # \u6307\u5b9a\u884c\u548c\u5217\u83b7\u53d6\u6570\u636e print(sheet.cell(0, 1).value) print(sheet.cell(0, 2).value) print(sheet.cell(0, 3).value) print(sheet.ncols) # \u83b7\u53d6excel\u91cc\u9762\u6709\u591a\u5c11\u5217 print(sheet.nrows) # \u83b7\u53d6excel\u91cc\u9762\u6709\u591a\u5c11\u884c print(sheet.get_rows()) # for i in sheet.get_rows(): print(i) # \u83b7\u53d6\u6bcf\u4e00\u884c\u7684\u6570\u636e print(sheet.row_values(0)) # \u83b7\u53d6\u7b2c\u4e00\u884c for i in range(sheet.nrows): # 0 1 2 3 4 5 print(sheet.row_values(i)) # \u83b7\u53d6\u7b2c\u51e0\u884c\u7684\u6570\u636e print(sheet.col_values(1)) # \u53d6\u7b2c\u4e00\u5217\u7684\u6570\u636e for i in range(sheet.ncols): print(sheet.col_values(i)) # \u83b7\u53d6\u7b2c\u51e0\u5217\u7684\u6570\u636e \u8fd0\u884c\u7ed3\u679c \"C:\\Program Files\\Python37\\python.exe\" D:/code/code-django/\u5e93/excel\u64cd\u4f5c/read.py \u59d3\u540d \u5e74\u9f84 \u6027\u522b \u5206\u6570 5 5 <generator object Sheet.get_rows.<locals>.<genexpr> at 0x00000231D5D0D4F8> [text:'\u59d3\u540d', text:'\u5e74\u9f84', text:'\u6027\u522b', text:'\u5206\u6570', text:'\u624b\u673a\u53f7\u7801'] [text:'\u5f20\u4e09', number:22.0, text:'\u5973', number:50.0, text:'12776238304'] [text:'\u674e\u56db', number:25.0, text:'\u7537', number:72.5, text:'11228374621'] [text:'\u738b\u4e94', number:33.0, text:'\u7537', number:100.0, text:'12372615263'] [text:'\u8d75\u516d', number:42.0, text:'\u5973', number:66.8, text:'11129374727'] ['\u59d3\u540d', '\u5e74\u9f84', '\u6027\u522b', '\u5206\u6570', '\u624b\u673a\u53f7\u7801'] ['\u59d3\u540d', '\u5e74\u9f84', '\u6027\u522b', '\u5206\u6570', '\u624b\u673a\u53f7\u7801'] ['\u5f20\u4e09', 22.0, '\u5973', 50.0, '12776238304'] ['\u674e\u56db', 25.0, '\u7537', 72.5, '11228374621'] ['\u738b\u4e94', 33.0, '\u7537', 100.0, '12372615263'] ['\u8d75\u516d', 42.0, '\u5973', 66.8, '11129374727'] ['\u5e74\u9f84', 22.0, 25.0, 33.0, 42.0] ['\u59d3\u540d', '\u5f20\u4e09', '\u674e\u56db', '\u738b\u4e94', '\u8d75\u516d'] ['\u5e74\u9f84', 22.0, 25.0, 33.0, 42.0] ['\u6027\u522b', '\u5973', '\u7537', '\u7537', '\u5973'] ['\u5206\u6570', 50.0, 72.5, 100.0, 66.8] ['\u624b\u673a\u53f7\u7801', '12776238304', '11228374621', '12372615263', '11129374727'] 3.\u5bf9excel\u7684\u4fee\u6539\u64cd\u4f5c\uff1a \u00b6 \u5c06excel\u4e2d\u7684\u67d0\u4e2a\u503c\u4fee\u6539\u5e76\u91cd\u65b0\u4fdd\u5b58 from xlutils.copy import copy import xlrd # xlutils:\u4fee\u6539excel book1 = xlrd.open_workbook('stu_1.xls') book2 = copy(book1) # \u62f7\u8d1d\u4e00\u4efd\u539f\u6765\u7684excel # print(dir(book2)) sheet = book2.get_sheet(0) # \u83b7\u53d6\u7b2c\u51e0\u4e2asheet\u9875\uff0cbook2\u73b0\u5728\u7684\u662fxlutils\u91cc\u7684\u65b9\u6cd5\uff0c\u4e0d\u662fxlrd\u7684 sheet.write(1, 3, 100) # \u4fee\u6539\u5206\u6570 sheet.write(1, 0, '\u5f20\u4e09\u4ed6\u59e5\u7237') # \u4fee\u6539\u59d3\u540d book2.save('stu.xls') \u8fd0\u884c\u540e\u7ed3\u679c \u59d3\u540d \u5e74\u9f84 \u6027\u522b \u5206\u6570 \u624b\u673a\u53f7\u7801 \u5f20\u4e09\u5979\u59e5\u7237 22 \u5973 100 12776238304 \u674e\u56db 25 \u7537 72.5 11228374621 \u738b\u4e94 33 \u7537 100 12372615263 \u8d75\u516d 42 \u5973 66.8 11129374727","title":"1. xlrd_xlwt"},{"location":"python/lib/execel/1.xlrd_xlwt/#_1","text":"python\u64cd\u4f5cexcel\u4e3b\u8981\u7528\u5230xlrd\uff0cxlwt\u548cxlutils\u80fd\u5c06xlrd\u8fd9\u4e09\u4e2a\u5e93 - xlrd\u662f\u53ea\u80fd\u8bfbexcel\u7684\u5e93\uff0c - xlwt\u662f\u53ea\u80fd\u65b0\u5efaexcel\u7684\u5e93\u3002 - xlutils\u80fd\u5c06xlrd.Book\u8f6c\u4e3axlwt.Workbook\uff0c\u4ece\u800c\u5f97\u4ee5\u5728\u73b0\u6709xls\u7684\u57fa\u7840\u4e0a\u4fee\u6539\u6570\u636e\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a\u65b0\u7684xls\uff0c\u5b9e\u73b0\u4fee\u6539 pip install xlrd pip install xlwt pip install xlutils","title":"\u7b80\u4ecb"},{"location":"python/lib/execel/1.xlrd_xlwt/#1-xlrd","text":"Book(class) \u7531xlrd.open_work(\"example.xls\")\u8fd4\u56de nsheets: sheets\u6570 sheet_names: sheet\u540d\u79f0\u5217\u8868 sheets: sheet\u5217\u8868 sheet_by_index(sheetx): \u6309\u5e8f\u53f7\u63d0\u53d6sheet sheet_by_name(sheet_name): \u6309\u540d\u79f0\u63d0\u53d6sheet Sheet(class) \u7531Book object\u76f8\u5173\u65b9\u6cd5\u8fd4\u56de name: \u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000sheet\u540d nrows: \u884c\u6570 ncols: \u5217\u6570 cell(rowx,colx): \u7b2crows\u884ccolx\u5217\u7684\u5355\u5143\u683c cell_type(rowx,colx): \u6570\u636e\u7c7b\u578b cell_value(rows,colx): \u6570\u503c col(colx): \u7b2ccolx\u5217\u6240\u6709\u5355\u5143\u683c\u7ec4\u6210\u7684\u5217\u8868 col_slice(colx,start_rowx=0,end_rowx=None): \u7b2ccolx\u5217\u6307\u5b9a\u5355\u5143\u683c\u7ec4\u6210\u7684\u5217\u8868 col_types(colx,start_rowx=0,end_rowx=None): \u7b2ccolx\u5217\u6307\u5b9a\u5355\u5143\u683c\u6570\u503c\u7c7b\u578b\u7ec4\u6210\u7684\u5217\u8868 col_values(colx,start_rowx=0,end_rowx=None): \u7b2ccolx\u5217\u6307\u5b9a\u5355\u5143\u683c\u6570\u503c\u7ec4\u6210\u7684\u5217\u8868 row\u540c\u6837\u6709col\u7684\u5404\u9879\u64cd\u4f5c\uff0c\u6b64\u5904\u7565\u53bb Cell(class) \u7531Sheet object(s)\u76f8\u5173\u65b9\u6cd5\u8fd4\u56de ctype: \u4e00\u4e2aint\u578b\u53d8\u91cf\uff0c\u5bf9\u5e94\u4e0d\u540c\u7684\u6570\u503c\u7c7b\u578b value: \u5355\u5143\u683c\u7684\u503c","title":"1. xlrd\u5e93\u4f7f\u7528"},{"location":"python/lib/execel/1.xlrd_xlwt/#2-xlwt","text":"Workbook(class) \u7531xlwt.Workbook()\u8fd4\u56de encoding: \u7f16\u7801\u65b9\u6848 add_sheet(sheet_name): \u6dfb\u52a0sheet get_sheet(Sheet_name): \u9009\u62e9sheet save(file_name): \u4fdd\u5b58 Worksheet(class) \u7531Workbook object\u76f8\u5173\u65b9\u6cd5\u8fd4\u56de write(rows,colx,cell_value,style): \u7f16\u8f91\u5355\u5143\u683c row(rowx).write(colx,cell_value,style): \u7f16\u8f91\u884c flush_row_data(): \u51cf\u5c11\u5185\u5b58\u538b\u529b\uff0cflush\u4e4b\u524d\u884c\u4e0d\u53ef\u518d\u4fee\u6539 col(colx),write(rows,cell_value,style): \u7f16\u8f91\u5217 easyxf(function) \u521b\u5efaXFStyle instance\uff0c\u683c\u5f0f\u63a7\u5236 expression syntax: (<element>:(<attribute> <value>,)+;)+ <element> - <attribute> - <value>: \uff08\u52a0\u7c97\u4e3a\u9ed8\u8ba4\u683c\u5f0f\uff0c\u4ee5\u4e0b\u6240\u5217\u5e76\u975e\u5168\u90e8\uff09 font - bold - True or False - colour - {colour} - italic - True or False - name - name of the font, Arial - underline - True or False alignment - direction - general, lr, rl - horizontal - general, left, center, right, filled - vertical - bottom, top, center, justified, distributed - shrink_to_fit - True or False bolders - left - an integer width between 0 and 13 - right - an integer width between 0 and 13 - top - an integer width between 0 and 13 - bottom - an integer width between 0 and 13 - diag - an integer width between 0 and 13 - left_colour - {colour}*, automatic colour - right_colour - {colour}*, automatic colour - ... pattern - back_color - {colour}*, automatic colour - fore_colour - {colour}*, automatic colour - pattern - none, solid, fine_dots, sparse_dots {colous}*: black, (dark_)(light_)blue, gold, (dark_)(light_)green, ivory, lavender, (light_)orange, pink, (dark_)red, rose, violet, white, (dark_)(light_)yellow, ...","title":"2. xlwt\u5e93\u4f7f\u7528"},{"location":"python/lib/execel/1.xlrd_xlwt/#3-xlutils","text":"copy: \u5c06xlrd.Book\u8f6c\u4e3axlwt.Workbook styles: \u8bfb\u53d6xlrd.Workbook\u7684\u6bcf\u4e00\u4e2a\u5355\u5143\u683c\u7684style display: \u7b80\u5355\u800c\u5b89\u5168\u5730\u5448\u73b0xlrd\u8bfb\u53d6\u7684\u6570\u636e filter: \u62c6\u5206\u4e0e\u6574\u5408\u591a\u4e2axls\u6587\u4ef6 margins: \u67e5\u770b\u8868\u683c\u7a00\u758f\u7a0b\u5ea6 save: \u5e8f\u5217\u5316xlrd.Book\uff0c\u8f6c\u5b58\u4e3abinary xls\u6216stream tips 1. xlrd.open_workbook(fomatting_info=):\u5f53formatting_info=Ture\uff0c\u8bfb\u53d6workbook\u5e76\u4fdd\u7559\u683c\u5f0f 2. xlrd.open_workbook(on_demand=): \u5f53on_demand=True\uff0c\u53ea\u6709\u88ab\u8981\u6c42\u65f6\u624d\u5c06worksheet\u8f7d\u5165\u5185\u5b58\uff0c\u8bfb\u53d6\u5927\u6587\u4ef6\u65f6\u4f7f\u7528 3. xlwt.Worksheet.flush_row_data(): \u51cf\u5c11\u5185\u5b58\u5360\u7528\uff0c\u88ab\u5237\u65b0\u7684\u884c\u4e0d\u80fd\u518d\u8bbf\u95ee\u6216\u4fee\u6539\uff0c\u5efa\u8bae\u6bcf1000\u884c\u5237\u65b0\u4e00\u6b21\uff08\u82e5\u5217\u5f88\u591a\u5f53\u8c03\u6574\uff09 4. xlwt.Workbook(encoding=): \u9009\u62e9\u521b\u5efa\u7684workbook\u7684\u7f16\u7801","title":"3. xlutils\u5e93\u4f7f\u7528"},{"location":"python/lib/execel/1.xlrd_xlwt/#_2","text":"","title":"\u6848\u4f8b"},{"location":"python/lib/execel/1.xlrd_xlwt/#1excel","text":"\u5c06\u4e00\u4e2a\u5217\u8868\u7684\u6570\u636e\u5199\u5165excel, \u7b2c\u4e00\u884c\u662f\u6807\u9898\uff0c\u4e0b\u9762\u884c\u6570\u5177\u4f53\u7684\u6570\u636e #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/1/23 14:08 @File : 1.py @Software: PyCharm \"\"\" import xlwt # \u53ea\u80fd\u5199\u4e0d\u80fd\u8bfb stus = [['\u59d3\u540d', '\u5e74\u9f84', '\u6027\u522b', '\u5206\u6570', '\u624b\u673a\u53f7\u7801'], ['\u5f20\u4e09', 22, '\u5973', 50, '12776238304'], ['\u674e\u56db', 25, '\u7537', 72.5, '11228374621'], ['\u738b\u4e94', 33, '\u7537', 100, '12372615263'], ['\u8d75\u516d', 42, '\u5973', 66.8, '11129374727'] ] book = xlwt.Workbook() # \u65b0\u5efa\u4e00\u4e2aexcel sheet = book.add_sheet('case1_sheet') # \u6dfb\u52a0\u4e00\u4e2asheet\u9875,\u9875\u540d\u5b57\u662fcase1_sheet row = 0 # \u63a7\u5236\u884c for stu in stus: col = 0 # \u63a7\u5236\u5217 for s in stu: # \u518d\u5faa\u73af\u91cc\u9762list\u7684\u503c\uff0c\u6bcf\u4e00\u5217 sheet.write(row, col, s) col += 1 row += 1 book.save('stu_1.xls') # \u4fdd\u5b58\u5230\u5f53\u524d\u76ee\u5f55\u4e0b \u8fd0\u884c\u7ed3\u679c D:\\code\\code-django\\\u5e93\\excel\u64cd\u4f5c \u7684\u76ee\u5f55 2019/01/23 14:12 <DIR> . 2019/01/23 14:12 <DIR> .. 2019/01/23 14:12 796 1.py 2019/01/23 14:12 5,632 stu_1.xls # \u4ea7\u751f\u8fd9\u4e2a\u6587\u4ef6 2019/01/23 14:08 129 __init__.py 3 \u4e2a\u6587\u4ef6 6,557 \u5b57\u8282 2 \u4e2a\u76ee\u5f55 28,743,331,840 \u53ef\u7528\u5b57\u8282 \u4fdd\u5b58\u7684excel\u8868\u683c stu_1.xls \u59d3\u540d \u5e74\u9f84 \u6027\u522b \u5206\u6570 \u624b\u673a\u53f7\u7801 \u5f20\u4e09 22 \u5973 50 12776238304 \u674e\u56db 25 \u7537 72.5 11228374621 \u738b\u4e94 33 \u7537 100 12372615263 \u8d75\u516d 42 \u5973 66.8 11129374727","title":"1.\u5bf9excel\u7684\u5199\u64cd\u4f5c\u5b9e\u4f8b\uff1a"},{"location":"python/lib/execel/1.xlrd_xlwt/#2excel","text":"import xlrd # \u53ea\u80fd\u8bfb\u4e0d\u80fd\u5199 book = xlrd.open_workbook('stu_1.xls') # \u6253\u5f00\u4e00\u4e2aexcel sheet = book.sheet_by_index(0) # \u6839\u636e\u987a\u5e8f\u83b7\u53d6sheet sheet2 = book.sheet_by_name('case1_sheet') # \u6839\u636esheet\u9875\u540d\u5b57\u83b7\u53d6sheet print(sheet.cell(0, 0).value) # \u6307\u5b9a\u884c\u548c\u5217\u83b7\u53d6\u6570\u636e print(sheet.cell(0, 1).value) print(sheet.cell(0, 2).value) print(sheet.cell(0, 3).value) print(sheet.ncols) # \u83b7\u53d6excel\u91cc\u9762\u6709\u591a\u5c11\u5217 print(sheet.nrows) # \u83b7\u53d6excel\u91cc\u9762\u6709\u591a\u5c11\u884c print(sheet.get_rows()) # for i in sheet.get_rows(): print(i) # \u83b7\u53d6\u6bcf\u4e00\u884c\u7684\u6570\u636e print(sheet.row_values(0)) # \u83b7\u53d6\u7b2c\u4e00\u884c for i in range(sheet.nrows): # 0 1 2 3 4 5 print(sheet.row_values(i)) # \u83b7\u53d6\u7b2c\u51e0\u884c\u7684\u6570\u636e print(sheet.col_values(1)) # \u53d6\u7b2c\u4e00\u5217\u7684\u6570\u636e for i in range(sheet.ncols): print(sheet.col_values(i)) # \u83b7\u53d6\u7b2c\u51e0\u5217\u7684\u6570\u636e \u8fd0\u884c\u7ed3\u679c \"C:\\Program Files\\Python37\\python.exe\" D:/code/code-django/\u5e93/excel\u64cd\u4f5c/read.py \u59d3\u540d \u5e74\u9f84 \u6027\u522b \u5206\u6570 5 5 <generator object Sheet.get_rows.<locals>.<genexpr> at 0x00000231D5D0D4F8> [text:'\u59d3\u540d', text:'\u5e74\u9f84', text:'\u6027\u522b', text:'\u5206\u6570', text:'\u624b\u673a\u53f7\u7801'] [text:'\u5f20\u4e09', number:22.0, text:'\u5973', number:50.0, text:'12776238304'] [text:'\u674e\u56db', number:25.0, text:'\u7537', number:72.5, text:'11228374621'] [text:'\u738b\u4e94', number:33.0, text:'\u7537', number:100.0, text:'12372615263'] [text:'\u8d75\u516d', number:42.0, text:'\u5973', number:66.8, text:'11129374727'] ['\u59d3\u540d', '\u5e74\u9f84', '\u6027\u522b', '\u5206\u6570', '\u624b\u673a\u53f7\u7801'] ['\u59d3\u540d', '\u5e74\u9f84', '\u6027\u522b', '\u5206\u6570', '\u624b\u673a\u53f7\u7801'] ['\u5f20\u4e09', 22.0, '\u5973', 50.0, '12776238304'] ['\u674e\u56db', 25.0, '\u7537', 72.5, '11228374621'] ['\u738b\u4e94', 33.0, '\u7537', 100.0, '12372615263'] ['\u8d75\u516d', 42.0, '\u5973', 66.8, '11129374727'] ['\u5e74\u9f84', 22.0, 25.0, 33.0, 42.0] ['\u59d3\u540d', '\u5f20\u4e09', '\u674e\u56db', '\u738b\u4e94', '\u8d75\u516d'] ['\u5e74\u9f84', 22.0, 25.0, 33.0, 42.0] ['\u6027\u522b', '\u5973', '\u7537', '\u7537', '\u5973'] ['\u5206\u6570', 50.0, 72.5, 100.0, 66.8] ['\u624b\u673a\u53f7\u7801', '12776238304', '11228374621', '12372615263', '11129374727']","title":"2.\u5bf9excel \u7684\u8bfb\u64cd\u4f5c\uff1a"},{"location":"python/lib/execel/1.xlrd_xlwt/#3excel","text":"\u5c06excel\u4e2d\u7684\u67d0\u4e2a\u503c\u4fee\u6539\u5e76\u91cd\u65b0\u4fdd\u5b58 from xlutils.copy import copy import xlrd # xlutils:\u4fee\u6539excel book1 = xlrd.open_workbook('stu_1.xls') book2 = copy(book1) # \u62f7\u8d1d\u4e00\u4efd\u539f\u6765\u7684excel # print(dir(book2)) sheet = book2.get_sheet(0) # \u83b7\u53d6\u7b2c\u51e0\u4e2asheet\u9875\uff0cbook2\u73b0\u5728\u7684\u662fxlutils\u91cc\u7684\u65b9\u6cd5\uff0c\u4e0d\u662fxlrd\u7684 sheet.write(1, 3, 100) # \u4fee\u6539\u5206\u6570 sheet.write(1, 0, '\u5f20\u4e09\u4ed6\u59e5\u7237') # \u4fee\u6539\u59d3\u540d book2.save('stu.xls') \u8fd0\u884c\u540e\u7ed3\u679c \u59d3\u540d \u5e74\u9f84 \u6027\u522b \u5206\u6570 \u624b\u673a\u53f7\u7801 \u5f20\u4e09\u5979\u59e5\u7237 22 \u5973 100 12776238304 \u674e\u56db 25 \u7537 72.5 11228374621 \u738b\u4e94 33 \u7537 100 12372615263 \u8d75\u516d 42 \u5973 66.8 11129374727","title":"3.\u5bf9excel\u7684\u4fee\u6539\u64cd\u4f5c\uff1a"},{"location":"python/lib/execel/2.openpyxl/","text":"openpyxl\u6a21\u5757\u4ecb\u7ecd \u00b6 openpyxl\u6a21\u5757\u662f\u4e00\u4e2a\u8bfb\u5199Excel 2010\u6587\u6863\u7684Python\u5e93\uff0c\u5982\u679c\u8981\u5904\u7406\u66f4\u65e9\u683c\u5f0f\u7684Excel\u6587\u6863\uff0c\u9700\u8981\u7528\u5230\u989d\u5916\u7684\u5e93\uff0c openpyxl\u662f\u4e00\u4e2a\u6bd4\u8f83\u7efc\u5408\u7684\u5de5\u5177\uff0c\u80fd\u591f\u540c\u65f6\u8bfb\u53d6\u548c\u4fee\u6539Excel\u6587\u6863\u3002\u5176\u4ed6\u5f88\u591a\u7684\u4e0eExcel\u76f8\u5173\u7684\u9879\u76ee\u57fa\u672c\u53ea\u652f\u6301\u8bfb\u6216\u8005\u5199Excel\u4e00\u79cd\u529f\u80fd\u3002 Excel\u6570\u636e\u7684\u7c7b\u578b\u53ca\u7ec4\u7ec7\u65b9\u5f0f \u00b6 openpyxl\u4e2d\u5b9a\u4e49\u4e86\u591a\u79cd\u6570\u636e\u683c\u5f0f\uff0c\u6211\u53ea\u6d89\u53ca\u5230\u4e86\u5176\u4e2d\u6700\u91cd\u8981\u7684\u4e09\u79cd\uff1a - NULL\uff1a \u7a7a\u503c\uff0c\u5bf9\u5e94\u4e8epython\u4e2d\u7684None\uff0c\u8868\u793a\u8fd9\u4e2acell\u91cc\u9762\u6ca1\u6709\u6570\u636e\u3002 - numberic\uff1a \u6570\u5b57\u578b\uff0c\u7edf\u4e00\u6309\u7167\u6d6e\u70b9\u6570\u6765\u8fdb\u884c\u5904\u7406\u3002\u5bf9\u5e94\u4e8epython\u4e2d\u7684float\u3002 - string\uff1a \u5b57\u7b26\u4e32\u578b\uff0c\u5bf9\u5e94\u4e8epython\u4e2d\u7684unicode\u3002 \u6bcf\u4e00\u4e2aExcel\u6570\u636e\u6587\u4ef6\u4ece\u4e0a\u81f3\u4e0b\u5206\u4e3a\u4e09\u4e2a\u5c42\u7ea7\u7684\u5bf9\u8c61\uff1a - workbook\uff1a \u6bcf\u4e00\u4e2aExcel\u6587\u4ef6\u5c31\u662f\u4e00\u4e2aworkbook\u3002 - sheet\uff1a \u6bcf\u4e00\u4e2aworkbook\u4e2d\u53ef\u4ee5\u5305\u542b\u591a\u4e2asheet\uff0c\u5177\u4f53\u5c31\u5bf9\u5e94Excel\u4e2d\u6211\u4eec\u5728\u5de6\u4e0b\u811a\u6240\u770b\u5230\u7684\u201csheet1\u201d,\u201csheet2\u201d\u7b49\u3002 - cell\uff1a \u6bcf\u4e00\u4e2asheet\u5c31\u662f\u6211\u4eec\u901a\u5e38\u6240\u770b\u5230\u7684\u4e00\u4e2a\u8868\u683c\uff0c\u53ef\u4ee5\u542b\u6709m\u884c\uff0cn\u5217\uff0c\u6bcf\u4e2a\u786e\u5b9a\u7684\u884c\u53f7\uff0c\u5217\u53f7\u6240\u5bf9\u5e94\u7684\u4e00\u4e2a\u683c\u5b50\u5c31\u662f\u4e00\u4e2acell\u3002 \u5b89\u88c5openpyxl\u6a21\u5757 \u00b6 pip3 install openpyxl openpyxl\u57fa\u672c\u7528\u6cd5 \u00b6 \u60f3\u8981\u64cd\u4f5cExcel\u9996\u5148\u8981\u4e86\u89e3Excel\u57fa\u672c\u6982\u5ff5\uff0cExcel\u4e2d\u5217\u4ee5\u5b57\u5e55\u547d\u540d\uff0c\u884c\u4ee5\u6570\u5b57\u547d\u540d\uff0c\u6bd4\u5982\u5de6\u4e0a\u89d2\u7b2c\u4e00\u4e2a\u5355\u5143\u683c\u7684\u5750\u6807\u4e3aA1\uff0c\u4e0b\u9762\u7684\u4e3aA2\uff0c\u53f3\u8fb9\u7684B1\u3002 openpyxl\u4e2d\u6709\u4e09\u4e2a\u4e0d\u540c\u5c42\u6b21\u7684\u7c7b\uff0cWorkbook\u662f\u5bf9\u5de5\u4f5c\u7c3f\u7684\u62bd\u8c61\uff0cWorksheet\u662f\u5bf9\u8868\u683c\u7684\u62bd\u8c61\uff0c Cell\u662f\u5bf9\u5355\u5143\u683c\u7684\u62bd\u8c61\uff0c\u6bcf\u4e00\u4e2a\u7c7b\u90fd\u5305\u542b\u4e86\u8bb8\u591a\u5c5e\u6027\u548c\u65b9\u6cd5\u3002 \u64cd\u4f5cExcel\u7684\u4e00\u822c\u573a\u666f: \u00b6 \u6253\u5f00\u6216\u8005\u521b\u5efa\u4e00\u4e2aExcel\u9700\u8981\u521b\u5efa\u4e00\u4e2aWorkbook\u5bf9\u8c61 \u83b7\u53d6\u4e00\u4e2a\u8868\u5219\u9700\u8981\u5148\u521b\u5efa\u4e00\u4e2aWorkbook\u5bf9\u8c61\uff0c\u7136\u540e\u4f7f\u7528\u8be5\u5bf9\u8c61\u7684\u65b9\u6cd5\u6765\u5f97\u5230\u4e00\u4e2aWorksheet\u5bf9\u8c61 \u5982\u679c\u8981\u83b7\u53d6\u8868\u4e2d\u7684\u6570\u636e\uff0c\u90a3\u4e48\u5f97\u5230Worksheet\u5bf9\u8c61\u4ee5\u540e\u518d\u4ece\u4e2d\u83b7\u53d6\u4ee3\u8868\u5355\u5143\u683c\u7684Cell\u5bf9\u8c61 Workbook\u5bf9\u8c61\u4e00\u4e2aWorkbook\u5bf9\u8c61\u4ee3\u8868\u4e00\u4e2aExcel\u6587\u6863\uff0c\u56e0\u6b64\u5728\u64cd\u4f5cExcel\u4e4b\u524d\uff0c\u90fd\u5e94\u8be5\u5148\u521b\u5efa\u4e00\u4e2aWorkbook\u5bf9\u8c61\u3002 \u5bf9\u4e8e\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Excel\u6587\u6863\uff0c\u76f4\u63a5\u8fdb\u884cWorkbook\u7c7b\u7684\u8c03\u7528\u5373\u53ef\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684Excel\u6587\u6863\uff0c \u53ef\u4ee5\u4f7f\u7528openpyxl\u6a21\u5757\u7684load_workbook\u51fd\u6570\u8fdb\u884c\u8bfb\u53d6\uff0c\u8be5\u51fd\u6570\u5305\u6db5\u591a\u4e2a\u53c2\u6570\uff0c\u4f46\u53ea\u6709filename\u53c2\u6570\u4e3a\u5fc5\u4f20\u53c2\u6570\u3002filename \u662f\u4e00\u4e2a\u6587\u4ef6\u540d\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u6253\u5f00\u7684\u6587\u4ef6\u5bf9\u8c61\u3002 Workbook\u5bf9\u8c61 \u00b6 \u4e00\u4e2aWorkbook\u5bf9\u8c61\u4ee3\u8868\u4e00\u4e2aExcel\u6587\u6863\uff0c\u56e0\u6b64\u5728\u64cd\u4f5cExcel\u4e4b\u524d\uff0c\u90fd\u5e94\u8be5\u5148\u521b\u5efa\u4e00\u4e2aWorkbook\u5bf9\u8c61\u3002 \u5bf9\u4e8e\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Excel\u6587\u6863\uff0c\u76f4\u63a5\u8fdb\u884cWorkbook\u7c7b\u7684\u8c03\u7528\u5373\u53ef\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684Excel\u6587\u6863\uff0c \u53ef\u4ee5\u4f7f\u7528openpyxl\u6a21\u5757\u7684load_workbook\u51fd\u6570\u8fdb\u884c\u8bfb\u53d6\uff0c\u8be5\u51fd\u6570\u5305\u6db5\u591a\u4e2a\u53c2\u6570\uff0c\u4f46\u53ea\u6709filename\u53c2\u6570\u4e3a\u5fc5\u4f20\u53c2\u6570\u3002 filename \u662f\u4e00\u4e2a\u6587\u4ef6\u540d\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u6253\u5f00\u7684\u6587\u4ef6\u5bf9\u8c61\u3002 PS\uff1aWorkbook\u548cload_workbook\u76f8\u540c\uff0c\u8fd4\u56de\u7684\u90fd\u662f\u4e00\u4e2aWorkbook\u5bf9\u8c61 Workbook\u5bf9\u8c61\u63d0\u4f9b\u4e86\u5f88\u591a\u5c5e\u6027\u548c\u65b9\u6cd5\uff0c\u5176\u4e2d\uff0c\u5927\u90e8\u5206\u65b9\u6cd5\u90fd\u4e0esheet\u6709\u5173\uff0c\u90e8\u5206\u5c5e\u6027\u5982\u4e0b\uff1a active\uff1a \u83b7\u53d6\u5f53\u524d\u6d3b\u8dc3\u7684Worksheet worksheets\uff1a\u4ee5\u5217\u8868\u7684\u5f62\u5f0f\u8fd4\u56de\u6240\u6709\u7684Worksheet(\u8868\u683c) read_only\uff1a \u5224\u65ad\u662f\u5426\u4ee5read_only\u6a21\u5f0f\u6253\u5f00Excel\u6587\u6863 encoding\uff1a \u83b7\u53d6\u6587\u6863\u7684\u5b57\u7b26\u96c6\u7f16\u7801 properties\uff1a\u83b7\u53d6\u6587\u6863\u7684\u5143\u6570\u636e\uff0c\u5982\u6807\u9898\uff0c\u521b\u5efa\u8005\uff0c\u521b\u5efa\u65e5\u671f\u7b49 sheetnames\uff1a\u83b7\u53d6\u5de5\u4f5c\u7c3f\u4e2d\u7684\u8868\uff08\u5217\u8868\uff09 - \u4f8b\u5b50 import openpyxl excel2 = openpyxl.load_workbook(\"example.xlsx\") excel2.active print(\"excel2 = \", excel2) print(\"excel2.read_only = \",excel2.read_only) print(\"excel2.worksheets = \",excel2.worksheets) print(\"excel2.properties = \",excel2.properties) print(\"excel2.encoding = \",excel2.encoding) \u8fd0\u884c\u7ed3\u679c excel2 = <openpyxl.workbook.workbook.Workbook object at 0x000001B072D2D7F0> excel2.read_only = False excel2.worksheets = [<Worksheet \"Sheet1\">, <Worksheet \"Sheet2\">, <Worksheet \"Sheet3\">] excel2.properties = <openpyxl.packaging.core.DocumentProperties object> Parameters: creator='cmz', title=None, description=None, subject=None, identifier=None, language=None, created=datetime.datetime(2019, 1, 23, 7, 26), modified=datetime.datetime(2019, 1, 23, 7, 26, 46), lastModifiedBy='\u7231\u4e00\u76f4\u5728\u7ebf1409537494', category=None, contentStatus=None, version=None, revision=None, keywords=None, lastPrinted=None excel2.encoding = utf-8 Workbook\u63d0\u4f9b\u7684\u65b9\u6cd5\u5982\u4e0b\uff1a get_sheet_names\uff1a\u83b7\u53d6\u6240\u6709\u8868\u683c\u7684\u540d\u79f0(\u65b0\u7248\u5df2\u7ecf\u4e0d\u5efa\u8bae\u4f7f\u7528\uff0c\u901a\u8fc7Workbook\u7684sheetnames\u5c5e\u6027\u5373\u53ef\u83b7\u53d6) get_sheet_by_name\uff1a\u901a\u8fc7\u8868\u683c\u540d\u79f0\u83b7\u53d6Worksheet\u5bf9\u8c61(\u65b0\u7248\u4e5f\u4e0d\u5efa\u8bae\u4f7f\u7528\uff0c\u901a\u8fc7Worksheet[\u2018\u8868\u540d\u2018]\u83b7\u53d6) get_active_sheet\uff1a\u83b7\u53d6\u6d3b\u8dc3\u7684\u8868\u683c(\u65b0\u7248\u5efa\u8bae\u901a\u8fc7active\u5c5e\u6027\u83b7\u53d6) remove_sheet\uff1a\u5220\u9664\u4e00\u4e2a\u8868\u683c create_sheet\uff1a\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684\u8868\u683c copy_worksheet\uff1a\u5728Workbook\u5185\u62f7\u8d1d\u8868\u683c Worksheet\u5bf9\u8c61 \u6709\u4e86Worksheet\u5bf9\u8c61\u4ee5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2aWorksheet\u5bf9\u8c61\u83b7\u53d6\u8868\u683c\u7684\u5c5e\u6027\uff0c\u5f97\u5230\u5355\u5143\u683c\u4e2d\u7684\u6570\u636e\uff0c\u4fee\u6539\u8868\u683c\u4e2d\u7684\u5185\u5bb9\u3002openpyxl\u63d0\u4f9b\u4e86\u975e\u5e38\u7075\u6d3b\u7684\u65b9\u5f0f\u6765\u8bbf\u95ee\u8868\u683c\u4e2d\u7684\u5355\u5143\u683c\u548c\u6570\u636e\uff0c\u5e38\u7528\u7684Worksheet\u5c5e\u6027\u5982\u4e0b\uff1a title \uff1a\u8868\u683c\u7684\u6807\u9898 dimensions \uff1a\u8868\u683c\u7684\u5927\u5c0f\uff0c\u8fd9\u91cc\u7684\u5927\u5c0f\u662f\u6307\u542b\u6709\u6570\u636e\u7684\u8868\u683c\u7684\u5927\u5c0f\uff0c\u5373\uff1a\u5de6\u4e0a\u89d2\u7684\u5750\u6807:\u53f3\u4e0b\u89d2\u7684\u5750\u6807 max_row \uff1a\u8868\u683c\u7684\u6700\u5927\u884c min_row \uff1a\u8868\u683c\u7684\u6700\u5c0f\u884c max_column \uff1a\u8868\u683c\u7684\u6700\u5927\u5217 min_column \uff1a\u8868\u683c\u7684\u6700\u5c0f\u5217 rows \uff1a\u6309\u884c\u83b7\u53d6\u5355\u5143\u683c(Cell\u5bf9\u8c61) - \u751f\u6210\u5668 columns \uff1a\u6309\u5217\u83b7\u53d6\u5355\u5143\u683c(Cell\u5bf9\u8c61) - \u751f\u6210\u5668 freeze_panes \uff1a\u51bb\u7ed3\u7a97\u683c values \uff1a\u6309\u884c\u83b7\u53d6\u8868\u683c\u7684\u5185\u5bb9(\u6570\u636e) - \u751f\u6210\u5668 Cell\u5bf9\u8c61 Cell\u5bf9\u8c61\u6bd4\u8f83\u7b80\u5355\uff0c\u5e38\u7528\u7684\u5c5e\u6027\u5982\u4e0b: row \uff1a\u5355\u5143\u683c\u6240\u5728\u7684\u884c column \uff1a\u5355\u5143\u683c\u5750\u5728\u7684\u5217 value \uff1a\u5355\u5143\u683c\u7684\u503c coordinate\uff1a\u5355\u5143\u683c\u7684\u5750\u6807 print(excel2['Sheet1'].cell(row=1,column=2).row) print(excel2['Sheet1'].cell(row=1,column=2).column) print(excel2['Sheet1'].cell(row=1,column=2).value) print(excel2['Sheet1'].cell(row=1,column=2).coordinate) \u7ed3\u679c 1 B \u5e74\u9f84 B1 1. \u8bfb\u53d6Excel\u6587\u6863 \u00b6 \u901a\u8fc7\u8c03\u7528\u65b9\u6cd5load_workbook(filename)\u8fdb\u884c\u6587\u4ef6\u8bfb\u53d6\uff0c\u8be5\u65b9\u6cd5\u4e2d\u8fd8\u6709\u4e00\u4e2aread_only\u53c2\u6570\u7528\u4e8e\u8bbe\u7f6e\u6587\u4ef6\u6253\u5f00\u65b9\u5f0f\uff0c \u9ed8\u8ba4\u4e3a\u53ef\u8bfb\u53ef\u5199\uff0c\u8be5\u65b9\u6cd5\u6700\u7ec8\u5c06\u8fd4\u56de\u4e00\u4e2aworkbook\u7684\u6570\u636e\u5bf9\u8c61 # \u6587\u4ef6\u5fc5\u987b\u662fxlsx\u683c\u5f0f\uff0c\u5982\u679c\u662f\u5176\u4ed6\u683c\u5f0f\u5728\u6267\u884c\u524d\u53ef\u5229\u7528win32\u8f85\u52a9\u8f6c\u5316 wb = openpyxl.load_workbook('example.xlsx') 1.1 \u83b7\u53d6\u5de5\u4f5c\u8868 \u00b6 \u6bcf\u4e00\u4e2aExcel\u8868\u683c\u4e2d\u90fd\u4f1a\u6709\u5f88\u591a\u5f20sheet\u5de5\u4f5c\u8868\uff0c\u5728\u5bf9\u8868\u683c\u64cd\u4f5c\u524d\u9700\u8981\u5148\u9009\u5b9a\u4e00\u5f20\u5de5\u4f5c\u8868 # \u83b7\u53d6\u6240\u6709\u5de5\u4f5c\u8868\u540d(\u8fd4\u56de\u4e00\u4e2a\u5217\u8868) sheets = wb.get_sheet_names() # \u83b7\u53d6\u67d0\u4e00\u7279\u5b9a\u7684\u5de5\u4f5c\u8868 sheet = wb.get_sheet_by_name('Sheet2') # \u8fc7\u65f6\u5199\u6cd5 sheet = wb['Sheet1'] # \u73b0\u5728\u5199\u6cd5 # \u83b7\u53d6\u5de5\u4f5c\u8868\u7684\u8868\u540d sheet_name = sheet.title # \u4e00\u822c\u6765\u8bf4\uff0c\u8868\u683c\u5927\u591a\u6570\u7528\u5230\u7684\u662f\u6253\u5f00\u65f6\u663e\u793a\u7684\u5de5\u4f5c\u8868\uff0c\u8fd9\u65f6\u53ef\u4ee5\u7528active\u6765\u83b7\u53d6\u5f53\u524d\u5de5\u4f5c\u8868 sheet = wb.active 1.2 \u83b7\u53d6\u5355\u5143\u683c \u00b6 \u5bf9Excel\u8868\u683c\u7684\u64cd\u4f5c\u6700\u7ec8\u90fd\u843d\u4e8e\u5bf9\u5355\u5143\u683c\u7684\u64cd\u4f5c\uff0c\u83b7\u53d6\u5355\u5143\u683c\u6709\u4e24\u79cd\u83b7\u53d6\u65b9\u6cd5\uff1asheet[\u5217\u884c\u540d]\u548csheet.cell(row,column) # \u901a\u8fc7sheet[\u5217\u884c\u540d]\u83b7\u53d6 a = sheet['A2'] # \u901a\u8fc7sheet.cell(row,column)\u83b7\u53d6 b = sheet.cell(1, 2) # \u5373sheet['B1'] # \u83b7\u53d6\u5355\u5143\u683c\u5185\u5bb9 print(a.value) # \u83b7\u53d6\u5355\u5143\u683c\u6240\u5728\u5217\u548c\u884c print('a is '+str((a.column,a.row))) \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0csheet.cell(row,column)\u4e2d\u53c2\u6570\u5206\u522b\u662f\u884c\u548c\u5217\uff0c\u4e14\u5fc5\u987b\u4e3a\u6574\u6570\uff0c\u5982\u679c\u5217\u4e3a\u82f1\u6587\u5b57\u6bcd\uff0c\u53ef\u4ee5\u5229\u7528 openpyxl.utils \u4e2d\u7684 column_index_from_string(char)\u8fdb\u884c\u5b57\u6bcd\u6570\u5b57\u7684\u8f6c\u5316\u3002\u987a\u4fbf\u4e00\u8bf4\uff0c\u540c\u7406\u4e5f\u53ef\u4ee5\u5229\u7528get_column_letter(number)\u8fdb\u884c\u6570\u5b57\u5b57\u6bcd\u95f4\u7684\u8f6c\u5316 from openpyxl.utils import get_column_letter, column_index_from_string # \u5bf9\u5217\u8fdb\u884c\u5b57\u6bcd/\u6570\u5b57\u8f6c\u5316 c_num = column_index_from_string('B') # c_num = 2 c_char = get_column_letter(5) # c_char = 'E\u2018 1.3 \u83b7\u53d6\u884c\u548c\u5217 \u00b6 \u5728\u5904\u7406Excel\u8868\u683c\u6709\u65f6\u53ef\u80fd\u9700\u8981\u5bf9\u8868\u683c\u8fdb\u884c\u904d\u5386\u67e5\u627e\uff0copenpyxl\u4e2d\u4fbf\u63d0\u4f9b\u4e86\u4e00\u4e2a\u884c\u548c\u5217\u7684\u751f\u6210\u5668(sheet.rows\u548csheet.columns),\u8fd9\u4e24\u4e2a\u751f\u6210\u5668\u91cc\u9762\u662f\u6bcf\u4e00\u884c\uff08\u6216\u5217\uff09\u7684\u6570\u636e\uff0c\u6bcf\u4e00\u884c\uff08\u6216\u5217\uff09\u53c8\u7531\u4e00\u4e2atuple\u5305\u88f9\uff0c\u501f\u6b64\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5b8c\u6210\u5bf9\u884c\u548c\u5217\u7684\u904d\u5386 # \u5bf9\u884c\u8fdb\u884c\u904d\u5386,\u8f93\u51faA1,B1,C1 for row in sheet.rows: for cell in row: print(cell.value) # \u5bf9\u5217\u8fdb\u884c\u904d\u5386,\u8f93\u51faA1,A2,A3 for column in sheet.columns: for cell in column: print(cell.value) tip \u5b66\u4e60\u65f6\u8fd8\u53d1\u73b0\u4e5f\u53ef\u4ee5\u901a\u8fc7list(sheet.rows)[index](\u6216list(sheet.columns)[index])\u5bf9\u67d0\u4e00\u884c\u6216\u5217\u8fdb\u884c\u904d\u5386\uff0c\u800c\u5728\u6b64\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u7531\u4e8esheet.rows(\u6216sheet.columns)\u662f\u751f\u6210\u5668\u7c7b\u578b\uff0c\u662f\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528\u7684\uff0c\u9700\u5c06\u5176\u8f6c\u5316\u4e3a\u4e00\u4e2alist\u7c7b\u578b\uff0c\u7136\u540e\u518d\u901a\u8fc7\u7d22\u5f15\u904d\u5386 # \u5bf9\u67d0\u4e00\u7279\u5b9a\u7684\u884c\u8fdb\u884c\u904d\u5386 for cell in list(sheet.rows)[0]: # \u7b2c0\u884c print(cell.value) # \u5bf9\u67d0\u4e00\u7279\u5b9a\u7684\u5217\u8fdb\u884c\u904d\u5386 for cell in list(sheet.columns)[0]: # \u7b2c0\u5217 print(cell.value) \u540c\u65f6\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528sheet[\u884c\u5217\u503c:\u884c\u5217\u503c]\u6765\u5bf9\u7ed9\u5b9a\u5355\u5143\u683c\u8303\u56f4\u8fdb\u884c\u904d\u5386 # \u5bf9\u67d0\u4e00\u5355\u5143\u683c\u8303\u56f4\u8fdb\u884c\u904d\u5386 for spaces in sheet['A1':'B2']: for cell in spaces: print(cell.value) \u53e6\u5916\uff0c\u6709\u65f6\u5019\u6211\u4eec\u8fd8\u53ef\u80fd\u9700\u8981\u786e\u5b9a\u8868\u683c\u7684\u5927\u5c0f\uff0c\u5373\u83b7\u53d6\u8868\u683c\u884c\u548c\u5217\u7684\u6700\u5927\u503c\uff0c\u53ef\u4ee5\u7528max_row\u548cmax_column\u6765\u83b7\u53d6 # \u83b7\u5f97\u6700\u5927\u5217\u548c\u6700\u5927\u884c print(sheet.max_row) print(sheet.max_column) 2. \u6863\u5199\u5165Excel\u6587\u6863 \u00b6 \u5728\u5f00\u5934\u8bfb\u53d6\u65f6\u5df2\u7ecf\u4ecb\u7ecd\uff0c\u9ed8\u8ba4\u7684\u6253\u5f00\u65b9\u5f0f\u4e3a\u53ef\u8bfb\u53ef\u5199\uff0c\u90a3\u4e48\u4f7f\u7528load_workbook(filename)\u8bfb\u53d6Excel\u6587\u6863\u540e\u4e5f\u5c31\u53ef\u4ee5\u76f4\u63a5\u5199\u5165\u4e86\u3002\u53e6\u5916\uff0c\u5982\u679c\u9700\u8981\u65b0\u5efa\u4e00\u4e2aExcel\u6587\u4ef6\uff0c\u53ef\u4ee5\u4f7f\u7528Workbook()\u65b9\u6cd5\uff0c\u540c\u65f6\u5b83\u4f1a\u81ea\u52a8\u63d0\u4f9b\u4e00\u4e2asheet\u5de5\u4f5c\u8868\u3002\u5bf9\u4e8e\u5220\u9664\u4e00\u4e2a\u5de5\u4f5c\u8868\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528workbook\u5bf9\u8c61\u7684remove(sheet)\u65b9\u6cd5\u5220\u9664 # \u65b0\u5efa\u4e00\u4e2aExcel\u6587\u6863 wb = openpyxl.Workbook() # \u5220\u9664\u67d0\u4e2a\u5de5\u4f5c\u8868 wb.remove(sheet) 2.1 \u5199\u5165\u5355\u5143\u683c \u00b6 \u83b7\u53d6\u5de5\u4f5c\u8868\u548c\u4e4b\u524d\u4e00\u6837\uff0c\u5982\u679c\u4f7f\u7528load_workbook(filename)\u8bfb\u53d6\uff0c\u90a3\u4e48\u83b7\u53d6\u5de5\u4f5c\u8868\u540e\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7sheet[\u884c\u5217\u503c]\u5199\u5165\u5355\u5143\u683c\u3002\u5b66\u4e60\u65f6\uff0c\u6709\u8d44\u6599\u4ecb\u7ecd\u8fd8\u53ef\u4ee5\u4f20\u5165Excel\u4e2d\u7684\u516c\u5f0f\u8fdb\u884c\u8d4b\u503c\uff0c\u4e0d\u8fc7\u8981\u6ce8\u610f\uff0c\u5728\u8bfb\u53d6\u6587\u4ef6\u65f6\u9700\u8981\u52a0\u4e0a\u53c2\u6570data_only=True\uff0c\u8fd9\u6837\u624d\u80fd\u8fd4\u56de\u6570\u5b57\uff0c\u5426\u5219\u5c06\u8fd4\u56de\u5b57\u7b26\u4e32\uff0c\u5373\u516c\u5f0f\u672c\u8eab # \u76f4\u63a5\u8d4b\u503c sheet['A1'].value = 2 # \u516c\u5f0f\u8d4b\u503c sheet['A6'].value = '=SUM(A1:A5)' \u53e6\u5916\uff0c\u4e5f\u53ef\u4f7f\u7528sheet.append(parameters)\u4e00\u884c\u6216\u591a\u884c\u5199\u5165 # \u5199\u5165\u4e00\u884c row = [1 ,2, 3, 4, 5] sheet.append(row) # \u5199\u5165\u591a\u884c rows = [ ['ID', 'Name', 'Department'], ['001', 'Lee','CS'], ['002', 'John','MA'], ['003', 'Amy','IS'] ] sheet.append(rows) 2.2 \u64cd\u4f5c\u6587\u4ef6 \u00b6 \u5199\u5b8c\u6587\u4ef6\u540e\uff0c\u4f7f\u7528workbook.save(path+filename)\u8fdb\u884c\u4fdd\u5b58\uff0c\u4e0d\u8fc7\u8981\u6ce8\u610f\u6587\u4ef6\u6269\u5c55\u540d\u4e00\u5b9a\u8981\u662fxlsx\u683c\u5f0f # \u4fdd\u5b58\u6587\u4ef6\u81f3\u5f53\u524d\u76ee\u5f55 wb.save('new_file.xlsx') 3. \u8bbe\u7f6e\u5355\u5143\u683c\u6837\u5f0f \u00b6 \u5355\u5143\u683c\u6837\u5f0f\u4e3b\u8981\u5305\u62ec\u5b57\u4f53\u3001\u8fb9\u6846\u3001\u989c\u8272\u4ee5\u53ca\u5bf9\u9f50\u65b9\u5f0f\u7b49\uff0c\u8fd9\u4e9b\u5747\u4f4d\u4e8eopenpyxl.styles\u5e93\u4e2d # \u5bfc\u5165\u5b57\u4f53\u3001\u8fb9\u6846\u3001\u989c\u8272\u4ee5\u53ca\u5bf9\u9f50\u65b9\u5f0f\u76f8\u5173\u5e93 from openpyxl.styles import Font, Border, Side, PatternFill, colors, Alignment 3.1 \u5b57\u4f53 \u00b6 \u901a\u8fc7sheet\u5355\u5143\u683cfont\u5c5e\u6027\u8bbe\u7f6e\u5b57\u4f53\u98ce\u683c # \u8bbe\u7f6e\u5b57\u4f53\u98ce\u683c\u4e3aTimes New Roman\uff0c\u5927\u5c0f\u4e3a16\uff0c\u7c97\u4f53\u3001\u659c\u4f53\uff0c\u989c\u8272\u84dd\u8272 sheet['A1'].font = Font(name='Times New Roman', size=16, bold=True, italic=True, color=colors.BLUE) 3.2 \u5bf9\u9f50\u65b9\u5f0f \u00b6 \u901a\u8fc7sheet\u5355\u5143\u683calignment\u5c5e\u6027\u8bbe\u7f6e\u6587\u672c\u5bf9\u9f50\u98ce\u683c # \u901a\u8fc7\u53c2\u6570horizontal\u548cvertical\u6765\u8bbe\u7f6e\u6587\u5b57\u5728\u5355\u5143\u683c\u91cc\u7684\u5bf9\u9f50\u65b9\u5f0f\uff0c\u6b64\u5916\u8bbe\u7f6e\u503c\u8fd8\u53ef\u4e3aleft\u548cright sheet['B1'].alignment = Alignment(horizontal='center',vertical='center') 3.3 \u8fb9\u6846 \u00b6 \u901a\u8fc7sheet\u5355\u5143\u683cborder\u5c5e\u6027\u8bbe\u7f6e\u5b57\u4f53\u98ce\u683c # \u9996\u5148\u8bbe\u7f6e\u8fb9\u6846\u56db\u4e2a\u65b9\u5411\u7684\u7ebf\u6761\u79cd\u7c7b left, right, top, bottom = [Side(style='thin', color='000000')] * 4 # \u518d\u5c06\u5404\u65b9\u5411\u7ebf\u6761\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165Border\u65b9\u6cd5 sheet['C1'].border = Border(left=left, right=right, top=top, bottom=bottom) 3.4 \u8bbe\u7f6e\u884c\u9ad8\u548c\u5217\u5bbd \u00b6 \u884c\u548c\u5217\u7684\u957f\u5ea6\u5927\u5c0f\u53ef\u4ee5\u901a\u8fc7row_dimensions[\u5e8f\u53f7].height\u548ccolumn_dimensions[\u6807\u53f7].width\u6765\u8bbe\u7f6e # \u8bbe\u7f6e\u884c\u9ad8 sheet.row_dimensions[1].height = 25 # \u8bbe\u7f6e\u5217\u5bbd sheet.column_dimensions['D'].width = 15.5 3.5 \u5408\u5e76\u548c\u62c6\u5206\u5355\u5143\u683c \u00b6 \u5bf9\u5355\u5143\u683c\u7684\u5408\u5e76\u4e0e\u62c6\u5206\uff0c\u4e3b\u8981\u662f\u901a\u8fc7sheet\u7684merge_cells(args1:args2)\u548cunmerge_cells(args1:args2)\u4e24\u4e2a\u65b9\u6cd5\u6765\u5b9e\u73b0\u7684 # \u5408\u5e76\u5355\u5143\u683c sheet.merge_cells('A1:B2') # \u62c6\u5206\u5355\u5143\u683c sheet.unmerge_cells('A1:B2') \u5f53\u7136\uff0c\u9664\u4e86\u5bf9\u89d2\u77e9\u5f62\u533a\u57df\u5316\u5408\u5e76\uff0c\u4e5f\u53ef\u4ee5\u5bf9\u4e00\u884c\u6216\u4e00\u5217\u8fdb\u884c\u5408\u5e76\uff0c\u53ea\u9700\u76f8\u5e94\u4fee\u6539\u53c2\u6570\u5373\u53ef\u3002\u4e0d\u8fc7\uff0c\u8fd9\u91cc\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5408\u5e76\u540e\u5355\u5143\u683c\u663e\u793a\u7684\u6587\u672c\u5185\u5bb9\u662f\u5408\u5e76\u524d\u6700\u5de6\u4e0a\u89d2\u5355\u5143\u683c\u7684\u5185\u5bb9\uff0c\u800c\u5176\u4ed6\u5355\u5143\u683c\u5185\u5bb9\u5219\u4f1a\u81ea\u52a8\u6e05\u9664\u3002 \u591a\u5173\u4e8eopenpyxl\u7684\u4ecb\u7ecd\uff0c \u53ef\u4ee5\u53c2\u9605readthedocs\u76f8\u5173\u6587\u6863","title":"2. openpyxl"},{"location":"python/lib/execel/2.openpyxl/#openpyxl","text":"openpyxl\u6a21\u5757\u662f\u4e00\u4e2a\u8bfb\u5199Excel 2010\u6587\u6863\u7684Python\u5e93\uff0c\u5982\u679c\u8981\u5904\u7406\u66f4\u65e9\u683c\u5f0f\u7684Excel\u6587\u6863\uff0c\u9700\u8981\u7528\u5230\u989d\u5916\u7684\u5e93\uff0c openpyxl\u662f\u4e00\u4e2a\u6bd4\u8f83\u7efc\u5408\u7684\u5de5\u5177\uff0c\u80fd\u591f\u540c\u65f6\u8bfb\u53d6\u548c\u4fee\u6539Excel\u6587\u6863\u3002\u5176\u4ed6\u5f88\u591a\u7684\u4e0eExcel\u76f8\u5173\u7684\u9879\u76ee\u57fa\u672c\u53ea\u652f\u6301\u8bfb\u6216\u8005\u5199Excel\u4e00\u79cd\u529f\u80fd\u3002","title":"openpyxl\u6a21\u5757\u4ecb\u7ecd"},{"location":"python/lib/execel/2.openpyxl/#excel","text":"openpyxl\u4e2d\u5b9a\u4e49\u4e86\u591a\u79cd\u6570\u636e\u683c\u5f0f\uff0c\u6211\u53ea\u6d89\u53ca\u5230\u4e86\u5176\u4e2d\u6700\u91cd\u8981\u7684\u4e09\u79cd\uff1a - NULL\uff1a \u7a7a\u503c\uff0c\u5bf9\u5e94\u4e8epython\u4e2d\u7684None\uff0c\u8868\u793a\u8fd9\u4e2acell\u91cc\u9762\u6ca1\u6709\u6570\u636e\u3002 - numberic\uff1a \u6570\u5b57\u578b\uff0c\u7edf\u4e00\u6309\u7167\u6d6e\u70b9\u6570\u6765\u8fdb\u884c\u5904\u7406\u3002\u5bf9\u5e94\u4e8epython\u4e2d\u7684float\u3002 - string\uff1a \u5b57\u7b26\u4e32\u578b\uff0c\u5bf9\u5e94\u4e8epython\u4e2d\u7684unicode\u3002 \u6bcf\u4e00\u4e2aExcel\u6570\u636e\u6587\u4ef6\u4ece\u4e0a\u81f3\u4e0b\u5206\u4e3a\u4e09\u4e2a\u5c42\u7ea7\u7684\u5bf9\u8c61\uff1a - workbook\uff1a \u6bcf\u4e00\u4e2aExcel\u6587\u4ef6\u5c31\u662f\u4e00\u4e2aworkbook\u3002 - sheet\uff1a \u6bcf\u4e00\u4e2aworkbook\u4e2d\u53ef\u4ee5\u5305\u542b\u591a\u4e2asheet\uff0c\u5177\u4f53\u5c31\u5bf9\u5e94Excel\u4e2d\u6211\u4eec\u5728\u5de6\u4e0b\u811a\u6240\u770b\u5230\u7684\u201csheet1\u201d,\u201csheet2\u201d\u7b49\u3002 - cell\uff1a \u6bcf\u4e00\u4e2asheet\u5c31\u662f\u6211\u4eec\u901a\u5e38\u6240\u770b\u5230\u7684\u4e00\u4e2a\u8868\u683c\uff0c\u53ef\u4ee5\u542b\u6709m\u884c\uff0cn\u5217\uff0c\u6bcf\u4e2a\u786e\u5b9a\u7684\u884c\u53f7\uff0c\u5217\u53f7\u6240\u5bf9\u5e94\u7684\u4e00\u4e2a\u683c\u5b50\u5c31\u662f\u4e00\u4e2acell\u3002","title":"Excel\u6570\u636e\u7684\u7c7b\u578b\u53ca\u7ec4\u7ec7\u65b9\u5f0f"},{"location":"python/lib/execel/2.openpyxl/#openpyxl_1","text":"pip3 install openpyxl","title":"\u5b89\u88c5openpyxl\u6a21\u5757"},{"location":"python/lib/execel/2.openpyxl/#openpyxl_2","text":"\u60f3\u8981\u64cd\u4f5cExcel\u9996\u5148\u8981\u4e86\u89e3Excel\u57fa\u672c\u6982\u5ff5\uff0cExcel\u4e2d\u5217\u4ee5\u5b57\u5e55\u547d\u540d\uff0c\u884c\u4ee5\u6570\u5b57\u547d\u540d\uff0c\u6bd4\u5982\u5de6\u4e0a\u89d2\u7b2c\u4e00\u4e2a\u5355\u5143\u683c\u7684\u5750\u6807\u4e3aA1\uff0c\u4e0b\u9762\u7684\u4e3aA2\uff0c\u53f3\u8fb9\u7684B1\u3002 openpyxl\u4e2d\u6709\u4e09\u4e2a\u4e0d\u540c\u5c42\u6b21\u7684\u7c7b\uff0cWorkbook\u662f\u5bf9\u5de5\u4f5c\u7c3f\u7684\u62bd\u8c61\uff0cWorksheet\u662f\u5bf9\u8868\u683c\u7684\u62bd\u8c61\uff0c Cell\u662f\u5bf9\u5355\u5143\u683c\u7684\u62bd\u8c61\uff0c\u6bcf\u4e00\u4e2a\u7c7b\u90fd\u5305\u542b\u4e86\u8bb8\u591a\u5c5e\u6027\u548c\u65b9\u6cd5\u3002","title":"openpyxl\u57fa\u672c\u7528\u6cd5"},{"location":"python/lib/execel/2.openpyxl/#excel_1","text":"\u6253\u5f00\u6216\u8005\u521b\u5efa\u4e00\u4e2aExcel\u9700\u8981\u521b\u5efa\u4e00\u4e2aWorkbook\u5bf9\u8c61 \u83b7\u53d6\u4e00\u4e2a\u8868\u5219\u9700\u8981\u5148\u521b\u5efa\u4e00\u4e2aWorkbook\u5bf9\u8c61\uff0c\u7136\u540e\u4f7f\u7528\u8be5\u5bf9\u8c61\u7684\u65b9\u6cd5\u6765\u5f97\u5230\u4e00\u4e2aWorksheet\u5bf9\u8c61 \u5982\u679c\u8981\u83b7\u53d6\u8868\u4e2d\u7684\u6570\u636e\uff0c\u90a3\u4e48\u5f97\u5230Worksheet\u5bf9\u8c61\u4ee5\u540e\u518d\u4ece\u4e2d\u83b7\u53d6\u4ee3\u8868\u5355\u5143\u683c\u7684Cell\u5bf9\u8c61 Workbook\u5bf9\u8c61\u4e00\u4e2aWorkbook\u5bf9\u8c61\u4ee3\u8868\u4e00\u4e2aExcel\u6587\u6863\uff0c\u56e0\u6b64\u5728\u64cd\u4f5cExcel\u4e4b\u524d\uff0c\u90fd\u5e94\u8be5\u5148\u521b\u5efa\u4e00\u4e2aWorkbook\u5bf9\u8c61\u3002 \u5bf9\u4e8e\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Excel\u6587\u6863\uff0c\u76f4\u63a5\u8fdb\u884cWorkbook\u7c7b\u7684\u8c03\u7528\u5373\u53ef\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684Excel\u6587\u6863\uff0c \u53ef\u4ee5\u4f7f\u7528openpyxl\u6a21\u5757\u7684load_workbook\u51fd\u6570\u8fdb\u884c\u8bfb\u53d6\uff0c\u8be5\u51fd\u6570\u5305\u6db5\u591a\u4e2a\u53c2\u6570\uff0c\u4f46\u53ea\u6709filename\u53c2\u6570\u4e3a\u5fc5\u4f20\u53c2\u6570\u3002filename \u662f\u4e00\u4e2a\u6587\u4ef6\u540d\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u6253\u5f00\u7684\u6587\u4ef6\u5bf9\u8c61\u3002","title":"\u64cd\u4f5cExcel\u7684\u4e00\u822c\u573a\u666f:"},{"location":"python/lib/execel/2.openpyxl/#workbook","text":"\u4e00\u4e2aWorkbook\u5bf9\u8c61\u4ee3\u8868\u4e00\u4e2aExcel\u6587\u6863\uff0c\u56e0\u6b64\u5728\u64cd\u4f5cExcel\u4e4b\u524d\uff0c\u90fd\u5e94\u8be5\u5148\u521b\u5efa\u4e00\u4e2aWorkbook\u5bf9\u8c61\u3002 \u5bf9\u4e8e\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Excel\u6587\u6863\uff0c\u76f4\u63a5\u8fdb\u884cWorkbook\u7c7b\u7684\u8c03\u7528\u5373\u53ef\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684Excel\u6587\u6863\uff0c \u53ef\u4ee5\u4f7f\u7528openpyxl\u6a21\u5757\u7684load_workbook\u51fd\u6570\u8fdb\u884c\u8bfb\u53d6\uff0c\u8be5\u51fd\u6570\u5305\u6db5\u591a\u4e2a\u53c2\u6570\uff0c\u4f46\u53ea\u6709filename\u53c2\u6570\u4e3a\u5fc5\u4f20\u53c2\u6570\u3002 filename \u662f\u4e00\u4e2a\u6587\u4ef6\u540d\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u6253\u5f00\u7684\u6587\u4ef6\u5bf9\u8c61\u3002 PS\uff1aWorkbook\u548cload_workbook\u76f8\u540c\uff0c\u8fd4\u56de\u7684\u90fd\u662f\u4e00\u4e2aWorkbook\u5bf9\u8c61 Workbook\u5bf9\u8c61\u63d0\u4f9b\u4e86\u5f88\u591a\u5c5e\u6027\u548c\u65b9\u6cd5\uff0c\u5176\u4e2d\uff0c\u5927\u90e8\u5206\u65b9\u6cd5\u90fd\u4e0esheet\u6709\u5173\uff0c\u90e8\u5206\u5c5e\u6027\u5982\u4e0b\uff1a active\uff1a \u83b7\u53d6\u5f53\u524d\u6d3b\u8dc3\u7684Worksheet worksheets\uff1a\u4ee5\u5217\u8868\u7684\u5f62\u5f0f\u8fd4\u56de\u6240\u6709\u7684Worksheet(\u8868\u683c) read_only\uff1a \u5224\u65ad\u662f\u5426\u4ee5read_only\u6a21\u5f0f\u6253\u5f00Excel\u6587\u6863 encoding\uff1a \u83b7\u53d6\u6587\u6863\u7684\u5b57\u7b26\u96c6\u7f16\u7801 properties\uff1a\u83b7\u53d6\u6587\u6863\u7684\u5143\u6570\u636e\uff0c\u5982\u6807\u9898\uff0c\u521b\u5efa\u8005\uff0c\u521b\u5efa\u65e5\u671f\u7b49 sheetnames\uff1a\u83b7\u53d6\u5de5\u4f5c\u7c3f\u4e2d\u7684\u8868\uff08\u5217\u8868\uff09 - \u4f8b\u5b50 import openpyxl excel2 = openpyxl.load_workbook(\"example.xlsx\") excel2.active print(\"excel2 = \", excel2) print(\"excel2.read_only = \",excel2.read_only) print(\"excel2.worksheets = \",excel2.worksheets) print(\"excel2.properties = \",excel2.properties) print(\"excel2.encoding = \",excel2.encoding) \u8fd0\u884c\u7ed3\u679c excel2 = <openpyxl.workbook.workbook.Workbook object at 0x000001B072D2D7F0> excel2.read_only = False excel2.worksheets = [<Worksheet \"Sheet1\">, <Worksheet \"Sheet2\">, <Worksheet \"Sheet3\">] excel2.properties = <openpyxl.packaging.core.DocumentProperties object> Parameters: creator='cmz', title=None, description=None, subject=None, identifier=None, language=None, created=datetime.datetime(2019, 1, 23, 7, 26), modified=datetime.datetime(2019, 1, 23, 7, 26, 46), lastModifiedBy='\u7231\u4e00\u76f4\u5728\u7ebf1409537494', category=None, contentStatus=None, version=None, revision=None, keywords=None, lastPrinted=None excel2.encoding = utf-8 Workbook\u63d0\u4f9b\u7684\u65b9\u6cd5\u5982\u4e0b\uff1a get_sheet_names\uff1a\u83b7\u53d6\u6240\u6709\u8868\u683c\u7684\u540d\u79f0(\u65b0\u7248\u5df2\u7ecf\u4e0d\u5efa\u8bae\u4f7f\u7528\uff0c\u901a\u8fc7Workbook\u7684sheetnames\u5c5e\u6027\u5373\u53ef\u83b7\u53d6) get_sheet_by_name\uff1a\u901a\u8fc7\u8868\u683c\u540d\u79f0\u83b7\u53d6Worksheet\u5bf9\u8c61(\u65b0\u7248\u4e5f\u4e0d\u5efa\u8bae\u4f7f\u7528\uff0c\u901a\u8fc7Worksheet[\u2018\u8868\u540d\u2018]\u83b7\u53d6) get_active_sheet\uff1a\u83b7\u53d6\u6d3b\u8dc3\u7684\u8868\u683c(\u65b0\u7248\u5efa\u8bae\u901a\u8fc7active\u5c5e\u6027\u83b7\u53d6) remove_sheet\uff1a\u5220\u9664\u4e00\u4e2a\u8868\u683c create_sheet\uff1a\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684\u8868\u683c copy_worksheet\uff1a\u5728Workbook\u5185\u62f7\u8d1d\u8868\u683c Worksheet\u5bf9\u8c61 \u6709\u4e86Worksheet\u5bf9\u8c61\u4ee5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2aWorksheet\u5bf9\u8c61\u83b7\u53d6\u8868\u683c\u7684\u5c5e\u6027\uff0c\u5f97\u5230\u5355\u5143\u683c\u4e2d\u7684\u6570\u636e\uff0c\u4fee\u6539\u8868\u683c\u4e2d\u7684\u5185\u5bb9\u3002openpyxl\u63d0\u4f9b\u4e86\u975e\u5e38\u7075\u6d3b\u7684\u65b9\u5f0f\u6765\u8bbf\u95ee\u8868\u683c\u4e2d\u7684\u5355\u5143\u683c\u548c\u6570\u636e\uff0c\u5e38\u7528\u7684Worksheet\u5c5e\u6027\u5982\u4e0b\uff1a title \uff1a\u8868\u683c\u7684\u6807\u9898 dimensions \uff1a\u8868\u683c\u7684\u5927\u5c0f\uff0c\u8fd9\u91cc\u7684\u5927\u5c0f\u662f\u6307\u542b\u6709\u6570\u636e\u7684\u8868\u683c\u7684\u5927\u5c0f\uff0c\u5373\uff1a\u5de6\u4e0a\u89d2\u7684\u5750\u6807:\u53f3\u4e0b\u89d2\u7684\u5750\u6807 max_row \uff1a\u8868\u683c\u7684\u6700\u5927\u884c min_row \uff1a\u8868\u683c\u7684\u6700\u5c0f\u884c max_column \uff1a\u8868\u683c\u7684\u6700\u5927\u5217 min_column \uff1a\u8868\u683c\u7684\u6700\u5c0f\u5217 rows \uff1a\u6309\u884c\u83b7\u53d6\u5355\u5143\u683c(Cell\u5bf9\u8c61) - \u751f\u6210\u5668 columns \uff1a\u6309\u5217\u83b7\u53d6\u5355\u5143\u683c(Cell\u5bf9\u8c61) - \u751f\u6210\u5668 freeze_panes \uff1a\u51bb\u7ed3\u7a97\u683c values \uff1a\u6309\u884c\u83b7\u53d6\u8868\u683c\u7684\u5185\u5bb9(\u6570\u636e) - \u751f\u6210\u5668 Cell\u5bf9\u8c61 Cell\u5bf9\u8c61\u6bd4\u8f83\u7b80\u5355\uff0c\u5e38\u7528\u7684\u5c5e\u6027\u5982\u4e0b: row \uff1a\u5355\u5143\u683c\u6240\u5728\u7684\u884c column \uff1a\u5355\u5143\u683c\u5750\u5728\u7684\u5217 value \uff1a\u5355\u5143\u683c\u7684\u503c coordinate\uff1a\u5355\u5143\u683c\u7684\u5750\u6807 print(excel2['Sheet1'].cell(row=1,column=2).row) print(excel2['Sheet1'].cell(row=1,column=2).column) print(excel2['Sheet1'].cell(row=1,column=2).value) print(excel2['Sheet1'].cell(row=1,column=2).coordinate) \u7ed3\u679c 1 B \u5e74\u9f84 B1","title":"Workbook\u5bf9\u8c61"},{"location":"python/lib/execel/2.openpyxl/#1-excel","text":"\u901a\u8fc7\u8c03\u7528\u65b9\u6cd5load_workbook(filename)\u8fdb\u884c\u6587\u4ef6\u8bfb\u53d6\uff0c\u8be5\u65b9\u6cd5\u4e2d\u8fd8\u6709\u4e00\u4e2aread_only\u53c2\u6570\u7528\u4e8e\u8bbe\u7f6e\u6587\u4ef6\u6253\u5f00\u65b9\u5f0f\uff0c \u9ed8\u8ba4\u4e3a\u53ef\u8bfb\u53ef\u5199\uff0c\u8be5\u65b9\u6cd5\u6700\u7ec8\u5c06\u8fd4\u56de\u4e00\u4e2aworkbook\u7684\u6570\u636e\u5bf9\u8c61 # \u6587\u4ef6\u5fc5\u987b\u662fxlsx\u683c\u5f0f\uff0c\u5982\u679c\u662f\u5176\u4ed6\u683c\u5f0f\u5728\u6267\u884c\u524d\u53ef\u5229\u7528win32\u8f85\u52a9\u8f6c\u5316 wb = openpyxl.load_workbook('example.xlsx')","title":"1. \u8bfb\u53d6Excel\u6587\u6863"},{"location":"python/lib/execel/2.openpyxl/#11","text":"\u6bcf\u4e00\u4e2aExcel\u8868\u683c\u4e2d\u90fd\u4f1a\u6709\u5f88\u591a\u5f20sheet\u5de5\u4f5c\u8868\uff0c\u5728\u5bf9\u8868\u683c\u64cd\u4f5c\u524d\u9700\u8981\u5148\u9009\u5b9a\u4e00\u5f20\u5de5\u4f5c\u8868 # \u83b7\u53d6\u6240\u6709\u5de5\u4f5c\u8868\u540d(\u8fd4\u56de\u4e00\u4e2a\u5217\u8868) sheets = wb.get_sheet_names() # \u83b7\u53d6\u67d0\u4e00\u7279\u5b9a\u7684\u5de5\u4f5c\u8868 sheet = wb.get_sheet_by_name('Sheet2') # \u8fc7\u65f6\u5199\u6cd5 sheet = wb['Sheet1'] # \u73b0\u5728\u5199\u6cd5 # \u83b7\u53d6\u5de5\u4f5c\u8868\u7684\u8868\u540d sheet_name = sheet.title # \u4e00\u822c\u6765\u8bf4\uff0c\u8868\u683c\u5927\u591a\u6570\u7528\u5230\u7684\u662f\u6253\u5f00\u65f6\u663e\u793a\u7684\u5de5\u4f5c\u8868\uff0c\u8fd9\u65f6\u53ef\u4ee5\u7528active\u6765\u83b7\u53d6\u5f53\u524d\u5de5\u4f5c\u8868 sheet = wb.active","title":"1.1 \u83b7\u53d6\u5de5\u4f5c\u8868"},{"location":"python/lib/execel/2.openpyxl/#12","text":"\u5bf9Excel\u8868\u683c\u7684\u64cd\u4f5c\u6700\u7ec8\u90fd\u843d\u4e8e\u5bf9\u5355\u5143\u683c\u7684\u64cd\u4f5c\uff0c\u83b7\u53d6\u5355\u5143\u683c\u6709\u4e24\u79cd\u83b7\u53d6\u65b9\u6cd5\uff1asheet[\u5217\u884c\u540d]\u548csheet.cell(row,column) # \u901a\u8fc7sheet[\u5217\u884c\u540d]\u83b7\u53d6 a = sheet['A2'] # \u901a\u8fc7sheet.cell(row,column)\u83b7\u53d6 b = sheet.cell(1, 2) # \u5373sheet['B1'] # \u83b7\u53d6\u5355\u5143\u683c\u5185\u5bb9 print(a.value) # \u83b7\u53d6\u5355\u5143\u683c\u6240\u5728\u5217\u548c\u884c print('a is '+str((a.column,a.row))) \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0csheet.cell(row,column)\u4e2d\u53c2\u6570\u5206\u522b\u662f\u884c\u548c\u5217\uff0c\u4e14\u5fc5\u987b\u4e3a\u6574\u6570\uff0c\u5982\u679c\u5217\u4e3a\u82f1\u6587\u5b57\u6bcd\uff0c\u53ef\u4ee5\u5229\u7528 openpyxl.utils \u4e2d\u7684 column_index_from_string(char)\u8fdb\u884c\u5b57\u6bcd\u6570\u5b57\u7684\u8f6c\u5316\u3002\u987a\u4fbf\u4e00\u8bf4\uff0c\u540c\u7406\u4e5f\u53ef\u4ee5\u5229\u7528get_column_letter(number)\u8fdb\u884c\u6570\u5b57\u5b57\u6bcd\u95f4\u7684\u8f6c\u5316 from openpyxl.utils import get_column_letter, column_index_from_string # \u5bf9\u5217\u8fdb\u884c\u5b57\u6bcd/\u6570\u5b57\u8f6c\u5316 c_num = column_index_from_string('B') # c_num = 2 c_char = get_column_letter(5) # c_char = 'E\u2018","title":"1.2 \u83b7\u53d6\u5355\u5143\u683c"},{"location":"python/lib/execel/2.openpyxl/#13","text":"\u5728\u5904\u7406Excel\u8868\u683c\u6709\u65f6\u53ef\u80fd\u9700\u8981\u5bf9\u8868\u683c\u8fdb\u884c\u904d\u5386\u67e5\u627e\uff0copenpyxl\u4e2d\u4fbf\u63d0\u4f9b\u4e86\u4e00\u4e2a\u884c\u548c\u5217\u7684\u751f\u6210\u5668(sheet.rows\u548csheet.columns),\u8fd9\u4e24\u4e2a\u751f\u6210\u5668\u91cc\u9762\u662f\u6bcf\u4e00\u884c\uff08\u6216\u5217\uff09\u7684\u6570\u636e\uff0c\u6bcf\u4e00\u884c\uff08\u6216\u5217\uff09\u53c8\u7531\u4e00\u4e2atuple\u5305\u88f9\uff0c\u501f\u6b64\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5b8c\u6210\u5bf9\u884c\u548c\u5217\u7684\u904d\u5386 # \u5bf9\u884c\u8fdb\u884c\u904d\u5386,\u8f93\u51faA1,B1,C1 for row in sheet.rows: for cell in row: print(cell.value) # \u5bf9\u5217\u8fdb\u884c\u904d\u5386,\u8f93\u51faA1,A2,A3 for column in sheet.columns: for cell in column: print(cell.value) tip \u5b66\u4e60\u65f6\u8fd8\u53d1\u73b0\u4e5f\u53ef\u4ee5\u901a\u8fc7list(sheet.rows)[index](\u6216list(sheet.columns)[index])\u5bf9\u67d0\u4e00\u884c\u6216\u5217\u8fdb\u884c\u904d\u5386\uff0c\u800c\u5728\u6b64\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u7531\u4e8esheet.rows(\u6216sheet.columns)\u662f\u751f\u6210\u5668\u7c7b\u578b\uff0c\u662f\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528\u7684\uff0c\u9700\u5c06\u5176\u8f6c\u5316\u4e3a\u4e00\u4e2alist\u7c7b\u578b\uff0c\u7136\u540e\u518d\u901a\u8fc7\u7d22\u5f15\u904d\u5386 # \u5bf9\u67d0\u4e00\u7279\u5b9a\u7684\u884c\u8fdb\u884c\u904d\u5386 for cell in list(sheet.rows)[0]: # \u7b2c0\u884c print(cell.value) # \u5bf9\u67d0\u4e00\u7279\u5b9a\u7684\u5217\u8fdb\u884c\u904d\u5386 for cell in list(sheet.columns)[0]: # \u7b2c0\u5217 print(cell.value) \u540c\u65f6\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528sheet[\u884c\u5217\u503c:\u884c\u5217\u503c]\u6765\u5bf9\u7ed9\u5b9a\u5355\u5143\u683c\u8303\u56f4\u8fdb\u884c\u904d\u5386 # \u5bf9\u67d0\u4e00\u5355\u5143\u683c\u8303\u56f4\u8fdb\u884c\u904d\u5386 for spaces in sheet['A1':'B2']: for cell in spaces: print(cell.value) \u53e6\u5916\uff0c\u6709\u65f6\u5019\u6211\u4eec\u8fd8\u53ef\u80fd\u9700\u8981\u786e\u5b9a\u8868\u683c\u7684\u5927\u5c0f\uff0c\u5373\u83b7\u53d6\u8868\u683c\u884c\u548c\u5217\u7684\u6700\u5927\u503c\uff0c\u53ef\u4ee5\u7528max_row\u548cmax_column\u6765\u83b7\u53d6 # \u83b7\u5f97\u6700\u5927\u5217\u548c\u6700\u5927\u884c print(sheet.max_row) print(sheet.max_column)","title":"1.3 \u83b7\u53d6\u884c\u548c\u5217"},{"location":"python/lib/execel/2.openpyxl/#2-excel","text":"\u5728\u5f00\u5934\u8bfb\u53d6\u65f6\u5df2\u7ecf\u4ecb\u7ecd\uff0c\u9ed8\u8ba4\u7684\u6253\u5f00\u65b9\u5f0f\u4e3a\u53ef\u8bfb\u53ef\u5199\uff0c\u90a3\u4e48\u4f7f\u7528load_workbook(filename)\u8bfb\u53d6Excel\u6587\u6863\u540e\u4e5f\u5c31\u53ef\u4ee5\u76f4\u63a5\u5199\u5165\u4e86\u3002\u53e6\u5916\uff0c\u5982\u679c\u9700\u8981\u65b0\u5efa\u4e00\u4e2aExcel\u6587\u4ef6\uff0c\u53ef\u4ee5\u4f7f\u7528Workbook()\u65b9\u6cd5\uff0c\u540c\u65f6\u5b83\u4f1a\u81ea\u52a8\u63d0\u4f9b\u4e00\u4e2asheet\u5de5\u4f5c\u8868\u3002\u5bf9\u4e8e\u5220\u9664\u4e00\u4e2a\u5de5\u4f5c\u8868\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528workbook\u5bf9\u8c61\u7684remove(sheet)\u65b9\u6cd5\u5220\u9664 # \u65b0\u5efa\u4e00\u4e2aExcel\u6587\u6863 wb = openpyxl.Workbook() # \u5220\u9664\u67d0\u4e2a\u5de5\u4f5c\u8868 wb.remove(sheet)","title":"2. \u6863\u5199\u5165Excel\u6587\u6863"},{"location":"python/lib/execel/2.openpyxl/#21","text":"\u83b7\u53d6\u5de5\u4f5c\u8868\u548c\u4e4b\u524d\u4e00\u6837\uff0c\u5982\u679c\u4f7f\u7528load_workbook(filename)\u8bfb\u53d6\uff0c\u90a3\u4e48\u83b7\u53d6\u5de5\u4f5c\u8868\u540e\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7sheet[\u884c\u5217\u503c]\u5199\u5165\u5355\u5143\u683c\u3002\u5b66\u4e60\u65f6\uff0c\u6709\u8d44\u6599\u4ecb\u7ecd\u8fd8\u53ef\u4ee5\u4f20\u5165Excel\u4e2d\u7684\u516c\u5f0f\u8fdb\u884c\u8d4b\u503c\uff0c\u4e0d\u8fc7\u8981\u6ce8\u610f\uff0c\u5728\u8bfb\u53d6\u6587\u4ef6\u65f6\u9700\u8981\u52a0\u4e0a\u53c2\u6570data_only=True\uff0c\u8fd9\u6837\u624d\u80fd\u8fd4\u56de\u6570\u5b57\uff0c\u5426\u5219\u5c06\u8fd4\u56de\u5b57\u7b26\u4e32\uff0c\u5373\u516c\u5f0f\u672c\u8eab # \u76f4\u63a5\u8d4b\u503c sheet['A1'].value = 2 # \u516c\u5f0f\u8d4b\u503c sheet['A6'].value = '=SUM(A1:A5)' \u53e6\u5916\uff0c\u4e5f\u53ef\u4f7f\u7528sheet.append(parameters)\u4e00\u884c\u6216\u591a\u884c\u5199\u5165 # \u5199\u5165\u4e00\u884c row = [1 ,2, 3, 4, 5] sheet.append(row) # \u5199\u5165\u591a\u884c rows = [ ['ID', 'Name', 'Department'], ['001', 'Lee','CS'], ['002', 'John','MA'], ['003', 'Amy','IS'] ] sheet.append(rows)","title":"2.1 \u5199\u5165\u5355\u5143\u683c"},{"location":"python/lib/execel/2.openpyxl/#22","text":"\u5199\u5b8c\u6587\u4ef6\u540e\uff0c\u4f7f\u7528workbook.save(path+filename)\u8fdb\u884c\u4fdd\u5b58\uff0c\u4e0d\u8fc7\u8981\u6ce8\u610f\u6587\u4ef6\u6269\u5c55\u540d\u4e00\u5b9a\u8981\u662fxlsx\u683c\u5f0f # \u4fdd\u5b58\u6587\u4ef6\u81f3\u5f53\u524d\u76ee\u5f55 wb.save('new_file.xlsx')","title":"2.2 \u64cd\u4f5c\u6587\u4ef6"},{"location":"python/lib/execel/2.openpyxl/#3","text":"\u5355\u5143\u683c\u6837\u5f0f\u4e3b\u8981\u5305\u62ec\u5b57\u4f53\u3001\u8fb9\u6846\u3001\u989c\u8272\u4ee5\u53ca\u5bf9\u9f50\u65b9\u5f0f\u7b49\uff0c\u8fd9\u4e9b\u5747\u4f4d\u4e8eopenpyxl.styles\u5e93\u4e2d # \u5bfc\u5165\u5b57\u4f53\u3001\u8fb9\u6846\u3001\u989c\u8272\u4ee5\u53ca\u5bf9\u9f50\u65b9\u5f0f\u76f8\u5173\u5e93 from openpyxl.styles import Font, Border, Side, PatternFill, colors, Alignment","title":"3. \u8bbe\u7f6e\u5355\u5143\u683c\u6837\u5f0f"},{"location":"python/lib/execel/2.openpyxl/#31","text":"\u901a\u8fc7sheet\u5355\u5143\u683cfont\u5c5e\u6027\u8bbe\u7f6e\u5b57\u4f53\u98ce\u683c # \u8bbe\u7f6e\u5b57\u4f53\u98ce\u683c\u4e3aTimes New Roman\uff0c\u5927\u5c0f\u4e3a16\uff0c\u7c97\u4f53\u3001\u659c\u4f53\uff0c\u989c\u8272\u84dd\u8272 sheet['A1'].font = Font(name='Times New Roman', size=16, bold=True, italic=True, color=colors.BLUE)","title":"3.1 \u5b57\u4f53"},{"location":"python/lib/execel/2.openpyxl/#32","text":"\u901a\u8fc7sheet\u5355\u5143\u683calignment\u5c5e\u6027\u8bbe\u7f6e\u6587\u672c\u5bf9\u9f50\u98ce\u683c # \u901a\u8fc7\u53c2\u6570horizontal\u548cvertical\u6765\u8bbe\u7f6e\u6587\u5b57\u5728\u5355\u5143\u683c\u91cc\u7684\u5bf9\u9f50\u65b9\u5f0f\uff0c\u6b64\u5916\u8bbe\u7f6e\u503c\u8fd8\u53ef\u4e3aleft\u548cright sheet['B1'].alignment = Alignment(horizontal='center',vertical='center')","title":"3.2 \u5bf9\u9f50\u65b9\u5f0f"},{"location":"python/lib/execel/2.openpyxl/#33","text":"\u901a\u8fc7sheet\u5355\u5143\u683cborder\u5c5e\u6027\u8bbe\u7f6e\u5b57\u4f53\u98ce\u683c # \u9996\u5148\u8bbe\u7f6e\u8fb9\u6846\u56db\u4e2a\u65b9\u5411\u7684\u7ebf\u6761\u79cd\u7c7b left, right, top, bottom = [Side(style='thin', color='000000')] * 4 # \u518d\u5c06\u5404\u65b9\u5411\u7ebf\u6761\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165Border\u65b9\u6cd5 sheet['C1'].border = Border(left=left, right=right, top=top, bottom=bottom)","title":"3.3 \u8fb9\u6846"},{"location":"python/lib/execel/2.openpyxl/#34","text":"\u884c\u548c\u5217\u7684\u957f\u5ea6\u5927\u5c0f\u53ef\u4ee5\u901a\u8fc7row_dimensions[\u5e8f\u53f7].height\u548ccolumn_dimensions[\u6807\u53f7].width\u6765\u8bbe\u7f6e # \u8bbe\u7f6e\u884c\u9ad8 sheet.row_dimensions[1].height = 25 # \u8bbe\u7f6e\u5217\u5bbd sheet.column_dimensions['D'].width = 15.5","title":"3.4 \u8bbe\u7f6e\u884c\u9ad8\u548c\u5217\u5bbd"},{"location":"python/lib/execel/2.openpyxl/#35","text":"\u5bf9\u5355\u5143\u683c\u7684\u5408\u5e76\u4e0e\u62c6\u5206\uff0c\u4e3b\u8981\u662f\u901a\u8fc7sheet\u7684merge_cells(args1:args2)\u548cunmerge_cells(args1:args2)\u4e24\u4e2a\u65b9\u6cd5\u6765\u5b9e\u73b0\u7684 # \u5408\u5e76\u5355\u5143\u683c sheet.merge_cells('A1:B2') # \u62c6\u5206\u5355\u5143\u683c sheet.unmerge_cells('A1:B2') \u5f53\u7136\uff0c\u9664\u4e86\u5bf9\u89d2\u77e9\u5f62\u533a\u57df\u5316\u5408\u5e76\uff0c\u4e5f\u53ef\u4ee5\u5bf9\u4e00\u884c\u6216\u4e00\u5217\u8fdb\u884c\u5408\u5e76\uff0c\u53ea\u9700\u76f8\u5e94\u4fee\u6539\u53c2\u6570\u5373\u53ef\u3002\u4e0d\u8fc7\uff0c\u8fd9\u91cc\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5408\u5e76\u540e\u5355\u5143\u683c\u663e\u793a\u7684\u6587\u672c\u5185\u5bb9\u662f\u5408\u5e76\u524d\u6700\u5de6\u4e0a\u89d2\u5355\u5143\u683c\u7684\u5185\u5bb9\uff0c\u800c\u5176\u4ed6\u5355\u5143\u683c\u5185\u5bb9\u5219\u4f1a\u81ea\u52a8\u6e05\u9664\u3002 \u591a\u5173\u4e8eopenpyxl\u7684\u4ecb\u7ecd\uff0c \u53ef\u4ee5\u53c2\u9605readthedocs\u76f8\u5173\u6587\u6863","title":"3.5 \u5408\u5e76\u548c\u62c6\u5206\u5355\u5143\u683c"},{"location":"python/lib/getpass/getpass.index/","text":"getpass \u6a21\u5757 1. \u4ecb\u7ecd \u00b6 \u6709\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u5546\u57ce\u767b\u5f55\u7684\u65f6\u5019\uff0c\u6211\u5e0c\u671b\u8f93\u5165\u7684\u65f6\u5019\u6211\u7684\u5bc6\u7801\u4e0d\u4e3a\u660e\u6587\uff0c\u5982\u4f55\u5b9e\u73b0\u5462\uff1f \u8fd9\u91cc\u5c31\u9700\u8981\u5229\u7528getpass\u6a21\u5757\u4e2d\u7684getpass\u65b9\u6cd5\u3002 2. code \u00b6 #!/usr/bin/env python # _*_ coding: utf-8 _*_ \"\"\" @author: caimengzhi @license: (C) Copyright 2013-2017. @software: pycharm 2017.02 @file: getpass\u6a21\u5757.py @desc: \u4e8e\u9690\u85cf\u7528\u6237\u8f93\u5165\u7684\u5b57\u7b26\u4e32\uff0c\u5e38\u7528\u6765\u63a5\u6536\u5bc6\u7801 \"\"\" import getpass def checkuser(user,passwd): if user == \"leco\" and passwd == \"leco\": return True else: return False if __name__ == \"__main__\": userr = input(\"Input the user:\") passwdd = getpass.getpass(\"Input the passwd:\") print(\"\u5f53\u524d\u8f93\u5165\u7684\u8d26\u53f7\u4e3a: \",userr) print(\"\u5f53\u524d\u8f93\u5165\u7684\u5bc6\u7801\u4e3a: \",passwdd) if checkuser(userr,passwdd): print(\"\u9a8c\u8bc1\u901a\u8fc7!\") else: print(\"\u9a8c\u8bc1\u4e0d\u901a\u8fc7!\") \u6d4b\u8bd5 root@leco:~/book/books/docs/pictures/lib/email# python3 lib_getpass.py Input the user:leco Input the passwd: # \u6b64\u65f6\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u663e\u793a \u5f53\u524d\u8f93\u5165\u7684\u8d26\u53f7\u4e3a: leco \u5f53\u524d\u8f93\u5165\u7684\u5bc6\u7801\u4e3a: leco \u9a8c\u8bc1\u901a\u8fc7!","title":"13. getpass"},{"location":"python/lib/getpass/getpass.index/#1","text":"\u6709\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u5546\u57ce\u767b\u5f55\u7684\u65f6\u5019\uff0c\u6211\u5e0c\u671b\u8f93\u5165\u7684\u65f6\u5019\u6211\u7684\u5bc6\u7801\u4e0d\u4e3a\u660e\u6587\uff0c\u5982\u4f55\u5b9e\u73b0\u5462\uff1f \u8fd9\u91cc\u5c31\u9700\u8981\u5229\u7528getpass\u6a21\u5757\u4e2d\u7684getpass\u65b9\u6cd5\u3002","title":"1. \u4ecb\u7ecd"},{"location":"python/lib/getpass/getpass.index/#2-code","text":"#!/usr/bin/env python # _*_ coding: utf-8 _*_ \"\"\" @author: caimengzhi @license: (C) Copyright 2013-2017. @software: pycharm 2017.02 @file: getpass\u6a21\u5757.py @desc: \u4e8e\u9690\u85cf\u7528\u6237\u8f93\u5165\u7684\u5b57\u7b26\u4e32\uff0c\u5e38\u7528\u6765\u63a5\u6536\u5bc6\u7801 \"\"\" import getpass def checkuser(user,passwd): if user == \"leco\" and passwd == \"leco\": return True else: return False if __name__ == \"__main__\": userr = input(\"Input the user:\") passwdd = getpass.getpass(\"Input the passwd:\") print(\"\u5f53\u524d\u8f93\u5165\u7684\u8d26\u53f7\u4e3a: \",userr) print(\"\u5f53\u524d\u8f93\u5165\u7684\u5bc6\u7801\u4e3a: \",passwdd) if checkuser(userr,passwdd): print(\"\u9a8c\u8bc1\u901a\u8fc7!\") else: print(\"\u9a8c\u8bc1\u4e0d\u901a\u8fc7!\") \u6d4b\u8bd5 root@leco:~/book/books/docs/pictures/lib/email# python3 lib_getpass.py Input the user:leco Input the passwd: # \u6b64\u65f6\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u663e\u793a \u5f53\u524d\u8f93\u5165\u7684\u8d26\u53f7\u4e3a: leco \u5f53\u524d\u8f93\u5165\u7684\u5bc6\u7801\u4e3a: leco \u9a8c\u8bc1\u901a\u8fc7!","title":"2. code"},{"location":"python/lib/nosql/memcached/memcached.index/","text":"memcached \u6a21\u5757 1. \u4ecb\u7ecd \u00b6 \u8fd9\u4e2a\u6a21\u5757\u662f\u4e00\u4e2aPython\u64cd\u4f5cmemcached\u7684\u4e00\u4e2aAPI\u63a5\u53e3\u3002 Memcached\u5b98\u7f51\uff1a http://memcached.org/ \u6a21\u5757\u5b98\u7f51\uff1a https://pypi.python.org/pypi/python-memcached/ 1.1 \u4ec0\u4e48\u662fMemcached\uff1f \u00b6 \u514d\u8d39\u548c\u5f00\u6e90\uff0c\u9ad8\u6027\u80fd\uff0c\u5206\u5e03\u5f0f\u5185\u5b58\u5bf9\u8c61\u7f13\u5b58\u7cfb\u7edf\uff0c\u672c\u8d28\u4e0a\u662f\u901a\u7528\u7684\uff0c\u4f46\u65e8\u5728\u901a\u8fc7\u51cf\u8f7b\u6570\u636e\u5e93\u8d1f\u8f7d\u6765\u52a0\u901f\u52a8\u6001Web\u5e94\u7528\u7a0b\u5e8f\u3002 Memcached\u662f\u4e00\u4e2a\u5185\u5b58\u4e2d\u7684\u952e\u503c\u5b58\u50a8\uff0c\u7528\u4e8e\u4ece\u6570\u636e\u5e93\u8c03\u7528\uff0cAPI\u8c03\u7528\u6216\u9875\u9762\u5448\u73b0\u7684\u7ed3\u679c\u4e2d\u83b7\u53d6\u4efb\u610f\u6570\u636e\uff08\u5b57\u7b26\u4e32\uff0c\u5bf9\u8c61\uff09\u7684\u5c0f\u5757\u3002 Memcached\u7b80\u5355\u800c\u5f3a\u5927\u3002\u5176\u7b80\u5355\u7684\u8bbe\u8ba1\u4fc3\u8fdb\u4e86\u5feb\u901f\u90e8\u7f72\uff0c\u6613\u4e8e\u5f00\u53d1\uff0c\u5e76\u89e3\u51b3\u4e86\u5927\u578b\u6570\u636e\u7f13\u5b58\u9762\u4e34\u7684\u8bb8\u591a\u95ee\u9898\u3002\u5176API\u9002\u7528\u4e8e\u5927\u591a\u6570\u6d41\u884c\u8bed\u8a00\u3002 \u4ee5\u4e0a\u5185\u5bb9\u6458\u81ea\u5b98\u7f51\u7684\u4ecb\u7ecd\u7684\u7ffb\u8bd1\uff0c\u5177\u4f53\u4fe1\u606f\u8bbf\u95ee\u5b98\u7f51 1.2 \u5b89\u88c5 \u00b6 1.2.1 \u5728\u7ebf\u5b89\u88c5 \u00b6 ubuntu apt-get install memcached centos yum install memcached 1.2.2 \u79bb\u7ebf\u5b89\u88c5 \u00b6 Memcached\u6e90\u7801\u5305\u5b89\u88c5\u7684\u65f6\u5019\u9700\u8981\u4f9d\u8d56\u4e8elibevent \u5b89\u88c5\u4f9d\u8d56\u5e93 # Ubuntu apt-get install libevent-dev # CentOS yum install libevent-devel \u4e0d\u5b89\u88c5\u5e93\u7684\u65f6\u5019\uff0c\u7f16\u8bd1\u65f6\u5019\u62a5\u9519\u5982\u4e0b checking for libevent directory... configure: error: libevent is required. You can get it from http://www.monkey.org/~provos/libevent/ If it's already installed, specify its path using --with-libevent=/dir/ \u7f16\u8bd1\u5b89\u88c5memcached wget https://memcached.org/latest tar -zxf memcached-1.x.x.tar.gz cd memcached-1.x.x ./configure --prefix=/usr/local/memcached make && make test && sudo make install \u5177\u4f53\u53c2\u6570\u89c1./configure --help\u5168\u9009\u9879\uff0cSASL\u652f\u6301\u9700\u8981\u4e00\u4e9b\u53ef\u9009\u9644\u52a0\u5e93\u3002 \u64cd\u4f5c\u8fc7\u7a0b root@leco:/usr/local/src# wget http://www.memcached.org/files/memcached-1.5.12.tar.gz --2019-02-20 09:55:44-- http://www.memcached.org/files/memcached-1.5.12.tar.gz \u6b63\u5728\u89e3\u6790\u4e3b\u673a www.memcached.org (www.memcached.org)... 107.170.231.145 \u6b63\u5728\u8fde\u63a5 www.memcached.org (www.memcached.org)|107.170.231.145|:80... \u5df2\u8fde\u63a5\u3002 \u7701\u7565\u3002\u3002\u3002 root@leco:/usr/local/src# ls memcached-1.5.12.tar.gz memcached-1.5.12.tar.gz root@leco:/usr/local/src# tar xf memcached-1.5.12.tar.gz root@leco:/usr/local/src# cd memcached-1.5.12 root@leco:/usr/local/src/memcached-1.5.12# ./configure --prefix=/usr/local/memcached root@leco:/usr/local/src/memcached-1.5.12# make && sudo make install root@leco:/usr/local/src/memcached-1.5.12# echo $? 0 # \u6dfb\u52a0\u73af\u5883\u53d8\u91cf root@leco:/usr/local/src/memcached-1.5.12# vim /etc/profile root@leco:/usr/local/src/memcached-1.5.12# tail -1 /etc/profile export PATH=$PATH:/usr/local/memcached/bin root@leco:/usr/local/src/memcached-1.5.12# source /etc/profile \u4ee5\u4e0a\u662f\u6e90\u7801\u5305\u5b89\u88c5\uff0c\u53ef\u4ee5\u5b89\u88c5\u6700\u65b0\u7248\u672c\u7684\uff0c\u8981\u662f\u5728\u7ebf\u5b89\u88c5\uff0c\u90fd\u662f\u57fa\u4e8e\u7cfb\u7edf\u6e90\u5b89\u88c5\u7684\u3002\u63a8\u8350\u6e90\u7801\u5b89\u88c5 1.2.3 \u542f\u52a8 \u00b6 root@leco:~# memcached -d -m 10 -u root -l 0.0.0.0 -p 11211 -c 256 -P /tmp/memcached.pid root@leco:~# netstat -lnp|grep 11211 tcp 0 0 0.0.0.0:11211 0.0.0.0:* LISTEN 7862/memcached unix 2 [ ACC ] \u6d41 LISTENING 100911211 11507/unity-files-d @leco-com.canonical.Unity.Scope.files.T5294429510698002 root@leco:~# telnet localhost 11211 Trying 127.0.0.1... Connected to localhost. Escape character is '^]'. \u5982\u679c\u51fa\u73b0\u4ee5\u4e0a\u5185\u5bb9\u5c31\u4ee3\u8868\u542f\u52a8\u6210\u529f\uff01 \u53c2\u6570\u8bf4\u660e \u53c2\u6570 \u63cf\u8ff0 -d \u662f\u542f\u52a8\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b -m \u662f\u5206\u914d\u7ed9Memcache\u4f7f\u7528\u7684\u5185\u5b58\u6570\u91cf\uff0c\u5355\u4f4d\u662fMB -u \u662f\u8fd0\u884cMemcache\u7684\u7528\u6237 -l \u662f\u76d1\u542c\u7684\u670d\u52a1\u5668IP\u5730\u5740 -p \u662f\u8bbe\u7f6eMemcache\u76d1\u542c\u7684\u7aef\u53e3,\u6700\u597d\u662f1024\u4ee5\u4e0a\u7684\u7aef\u53e3 -c \u9009\u9879\u662f\u6700\u5927\u8fd0\u884c\u7684\u5e76\u53d1\u8fde\u63a5\u6570\uff0c\u9ed8\u8ba4\u662f1024\uff0c\u6309\u7167\u4f60\u670d\u52a1\u5668\u7684\u8d1f\u8f7d\u91cf\u6765\u8bbe\u5b9a -P \u662f\u8bbe\u7f6e\u4fdd\u5b58Memcache\u7684pid\u6587\u4ef6 1.2.4 \u8bbe\u7f6e\u5f00\u673a\u542f\u52a8 \u00b6 echo 'memcached -d -m 10 -u root -l 0.0.0.0 -p 11211 -c 256 -P /tmp/memcached.pid' >> /etc/rc.local 1.2.5 \u505c\u6b62 \u00b6 pkill `cat /tmp/memcached.pid` 2. memcached\u5e93 \u00b6 2.1 \u5b89\u88c5 \u00b6 root@leco:/home/leco# pip install python3-memcached Collecting python3-memcached Downloading https://files.pythonhosted.org/packages/14/fa/cd0d93c30722db0cfa777ec9cd0203fa7da2771a5c70c9908f471944b6e2/python3-memcached-1.51.tar.gz Building wheels for collected packages: python3-memcached Running setup.py bdist_wheel for python3-memcached ... done Stored in directory: /root/.cache/pip/wheels/6b/50/29/888c59a274ac0e5d3831987eec3a6f6c4562e021c2fc0311b0 Successfully built python3-memcached Installing collected packages: python3-memcached Successfully installed python3-memcached-1.51 root@leco:~/book# pip -V pip 9.0.1 from /usr/local/lib/python3.6/site-packages (python 3.6) root@leco:~/book# python3.6 Python 3.6.1 (default, Mar 21 2018, 13:46:25) [GCC 5.4.0 20160609] on linux Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> import memcache >>> \u5bfc\u5165\u6ca1\u6709\u62a5\u9519\u5c31\u8868\u793a\u5b89\u88c5\u6210\u529f\u3002 2.2 \u6d4b\u8bd5 \u00b6 root@leco:~/book# ipython Python 3.6.1 (default, Mar 21 2018, 13:46:25) Type 'copyright', 'credits' or 'license' for more information IPython 6.2.1 -- An enhanced Interactive Python. Type '?' for help. # \u5bfc\u5165\u6a21\u5757 In [1]: import memcache # \u94fe\u63a5\uff0cip\uff1aport In [2]: conn = memcache.Client(['127.0.0.1:11211']) # \u8bbe\u7f6e key:value In [3]: conn.set('k1', 'v1') Out[3]: True # \u53d6\u503c In [4]: conn.get('k1') Out[4]: 'v1 2.3 \u5176\u4ed6\u547d\u4ee4\u6d4b\u8bd5 \u00b6 \u7528nc\u547d\u4ee4\u64cd\u4f5cmemcached \u529f\u80fd \u547d\u4ee4 \u5b58\u50a8\u6570\u636e printf \"set key 0 10 6\\r\\nresult\\r\\n\" \u83b7\u53d6\u6570\u636e printf \"get key\\r\\n\" \u5220\u9664\u6570\u636e printf \"delete key\\r\\n\" \u67e5\u770b\u72b6\u6001 printf \"stats\\r\\n\" \u6a21\u62dftop\u547d\u4ee4\u67e5\u770b\u72b6\u6001 watch \"echo stats\" \u6e05\u7a7a\u7f13\u5b58 printf \"flush_all\\r\\n\" 2.3 \u96c6\u7fa4 \u00b6 python-memcached\u6a21\u5757\u539f\u751f\u652f\u6301\u96c6\u7fa4\u64cd\u4f5c\uff0c\u5176\u539f\u7406\u662f\u5728\u5185\u5b58\u4e2d\u7ef4\u62a4\u4e00\u4e2a\u4e3b\u673a\u5217\u8868\uff0c\u4e14\u96c6\u7fa4\u4e2d\u4e3b\u673a\u7684\u6743\u91cd\u503c\u548c\u4e3b\u673a\u5728\u5217\u8868\u4e2d\u91cd\u590d\u51fa\u73b0\u7684\u6b21\u6570\u6210\u6b63\u6bd4\u3002 \u4e3b\u673a \u6743\u91cd 1.1.1.1 1 1.1.1.2 2 1.1.1.3 1 \u90a3\u4e48\u5728\u5185\u5b58\u4e2d\u4e3b\u673a\u5217\u8868\u4e3a\uff1a host_list = [\"1.1.1.1\", \"1.1.1.2\", \"1.1.1.2\", \"1.1.1.3\", ] \u7528\u6237\u5982\u679c\u8981\u5728\u5185\u5b58\u4e2d\u521b\u5efa\u4e00\u4e2a\u952e\u503c\u5bf9\uff08\u5982\uff1ak1 = \"value1\"\uff09\uff0c\u90a3\u4e48\u8981\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\uff1a \u6839\u636e\u7b97\u6cd5\u5c06k1\u8f6c\u6362\u6210\u4e00\u4e2a\u6570\u5b57 \u5c06\u6570\u5b57\u548c\u4e3b\u673a\u5217\u8868\u957f\u5ea6\u6c42\u4f59\u6570\uff0c\u5f97\u5230\u4e00\u4e2a\u503cN\uff080 <= N < \u957f\u5ea6\uff09 \u5728\u4e3b\u673a\u5217\u8868\u4e2d\u6839\u636e\u7b2c\u4e8c\u6b65\u5f97\u5230\u7684\u503c\u4e3a\u7d22\u5f15\u83b7\u53d6\u4e3b\u673a\uff0c\u4f8b\u5982: host_list[N] \u8fde\u63a5\u5c06\u7b2c\u4e09\u6b65\u4e2d\u83b7\u53d6\u7684\u4e3b\u673a\uff0c\u5c06k1 = \"value1\" \u653e\u7f6e\u5728\u8be5\u670d\u52a1\u5668\u7684\u5185\u5b58\u4e2d \u53e6\u5916\u5728\u542f\u52a8\u4e24\u4e2a\u670d\u52a1 memcached -d -m 10 -u root -l 0.0.0.0 -p 11212 -c 256 -P /tmp/memcached2.pid memcached -d -m 10 -u root -l 0.0.0.0 -p 11213 -c 256 -P /tmp/memcached3.pid \u64cd\u4f5c\u8fc7\u7a0b root@leco:~# memcached -d -m 10 -u root -l 0.0.0.0 -p 11212 -c 256 -P /tmp/memcached2.pid root@leco:~# memcached -d -m 10 -u root -l 0.0.0.0 -p 11213 -c 256 -P /tmp/memcached3.pid root@leco:~# netstat -lnp|grep memcached tcp 0 0 0.0.0.0:11211 0.0.0.0:* LISTEN 7862/memcached tcp 0 0 0.0.0.0:11212 0.0.0.0:* LISTEN 11748/memcached tcp 0 0 0.0.0.0:11213 0.0.0.0:* LISTEN 11759/memcached root@leco:~/code/memcached# cat test1.py #!/usr/bin/env python3 #coding:utf8 import memcache mc = memcache.Client([('127.0.0.1:11211', 1), ('127.0.0.1:11212', 2),('127.0.0.1:11213',3)]) mc.set('k1','value1') ret = mc.get('k1') print (ret) \u8fd0\u884c\u7ed3\u679c root@leco:~/code/memcached# python3.6 test1.py value1 2.4 \u5b58\u50a8\u64cd\u4f5c \u00b6 2.4.1 set/set_multi \u00b6 set : \u8bbe\u7f6e\u4e00\u4e2a\u952e\u503c\u5bf9\uff0c\u5982\u679cKey\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\uff0c\u5982\u679ckey\u5b58\u5728\uff0c\u5219\u4fee\u6539\u3002 set_multi : \u8bbe\u7f6e\u591a\u4e2a\u952e\u503c\u5bf9\uff0c\u5982\u679ckey\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\uff0c\u5982\u679ckey\u5b58\u5728\uff0c\u5219\u4fee\u6539\u3002 root@leco:~/code/memcached# cat set.py #!/usr/bin/env python # -*- coding:utf-8 -*- import memcache mc = memcache.Client(['127.0.0.1:11211']) mc.set('name','jack') re = mc.get('name') print('set\u7528\u6cd5',re) #\u8bbe\u7f6e\u4e00\u4e2a\u952e\u503c\u5bf9 dic = {'name':'jack','age':'19','job':'IT'} mc.set_multi(dic) #\u8bbe\u7f6e\u591a\u4e2a\u952e\u503c\u5bf9 #\u6216\u8005mc.set_multi({'name':'jack','age':'19','job':'IT'}) name = mc.get('name') age = mc.get('age') job = mc.get('job') print('set_multi\u7528\u6cd5:',name,age,job) \u8fd0\u884c\u7ed3\u679c root@leco:~/code/memcached# python3 set.py set\u7528\u6cd5 jack set_multi\u7528\u6cd5: jack 19 IT 2.4.2 add \u00b6 \u6dfb\u52a0\u4e00\u6761\u952e\u503c\u5bf9\uff0c\u5982\u679c\u5df2\u7ecf\u5b58\u5728\u7684key\uff0c\u91cd\u590d\u6267\u884cadd\u64cd\u4f5c\u8fd4\u56de\u503c\u4e3aflase\u3002 root@leco:~/code/memcached# cat add.py #!/usr/bin/env python3 #coding:utf8 import memcache mc = memcache.Client([('127.0.0.1:11211', 1)]) ret1 = mc.add('add','v1') ret2 = mc.add('add','v2') ret = mc.get('add') print(ret1) print(ret2) print(ret) \u8fd0\u884c\u7ed3\u679c root@leco:~/code/memcached# python2 add.py True # \u7b2c\u4e00\u6dfb\u52a0add \u8fd9\u4e2a\u952e\u65f6\u5019\uff0c\u4e4b\u524d\u662f\u6ca1\u6709\u7684\uff0c\u6240\u6709\u53ef\u4ee5\u521b\u5efa\u3002 False # \u7b2c\u4e8c\u6b21\u518d\u6b21\u6dfb\u52a0add\u8fd9\u4e2a\u952e\u65f6\u5019\uff0c\u4e4b\u524d\u6709\u4e86add\u8fd9\u4e2a\u952e\uff0c\u6240\u4ee5\u521b\u5efa\u5931\u8d25 v1 2.4.3 replace \u00b6 replace\u4fee\u6539\u67d0\u4e2akey\u7684\u503c\uff0c\u5982\u679ckey\u4e0d\u5b58\u5728\uff0c\u8fd4\u56deFalse root@leco:~/code/memcached# cat replace.py #!/usr/bin/env python # -*- coding:utf-8 -*- import memcache mc = memcache.Client(['127.0.0.1:11211']) mc.set('name','\u5f20\u4e09') re = mc.get('name') print(re) ret_name = mc.replace('name','\u674e\u56db') ret1 = mc.get('name') rereplace = mc.replace('name10','hahaha') ret2 = mc.get('name10') print(\"ret_name = \",ret_name) print(\"ret1 = \",ret1) print(\"rereplace = \",rereplace) print(\"ret2 = \",ret2) root@leco:~/code/memcached# python3 replace.py \u5f20\u4e09 ret_name = True # key\u5b58\u5728\u66ff\u6362\u6210\u529f ret1 = \u674e\u56db # \u4fee\u6539\u540e\u7684\u503c rereplace = False # key\u4e0d\u5b58\u5728\uff0c\u66ff\u6362\u5931\u8d25 ret2 = None # \u4e0d\u5b58\u5728\u7684key\uff0c\u8fd4\u56deFalse 2.4.4 append/prepend \u00b6 append : \u4fee\u6539\u6307\u5b9akey\u7684\u503c\uff0c\u5728\u8be5\u503c\u540e\u9762\u8ffd\u52a0\u5185\u5bb9\u3002 prepend : \u4fee\u6539\u6307\u5b9akey\u7684\u503c\uff0c\u5728\u8be5\u503c\u524d\u9762\u63d2\u5165\u5185\u5bb9\u3002 root@leco:~/code/memcached# cat append.py #!/usr/bin/env python # -*- coding:utf-8 -*- import memcache mc = memcache.Client(['127.0.0.1:11211']) mc.set('num','\u6211\u662f\u4e2d\u95f4\u90e8\u5206') re = mc.get('num') print(re) mc.append('num','\u6211\u662f\u540e\u9762\u90e8\u5206') # \u5728\u6211\u662f\u4e2d\u95f4\u90e8\u5206\u540e\u8ffd\u52a0 re = mc.get('num') print(re) mc.prepend('num','\u6211\u662f\u5f00\u5934\u90e8\u5206') # \u5728\u6211\u662f\u4e2d\u95f4\u90e8\u5206\u524d\u8ffd\u52a0 re = mc.get('num') print(re) \u8fd0\u884c\u7ed3\u679c root@leco:~/code/memcached# python3 append.py \u6211\u662f\u4e2d\u95f4\u90e8\u5206 \u6211\u662f\u4e2d\u95f4\u90e8\u5206\u6211\u662f\u540e\u9762\u90e8\u5206 \u6211\u662f\u5f00\u5934\u90e8\u5206\u6211\u662f\u4e2d\u95f4\u90e8\u5206\u6211\u662f\u540e\u9762\u90e8\u5206 2.4.5 gets/cas \u00b6 \u4f7f\u7528\u7f13\u5b58\u7cfb\u7edf\u5171\u4eab\u6570\u636e\u8d44\u6e90\u5c31\u5fc5\u7136\u7ed5\u4e0d\u5f00\u6570\u636e\u4e89\u593a\u548c\u810f\u6570\u636e\uff08\u6570\u636e\u6df7\u4e71\uff09\u7684\u95ee\u9898\u3002 \u5047\u8bbe\u53bb\u5f80\u5f90\u5dde\u7684\u9ad8\u94c1G88\u5217\u8f66\u5269\u4f59\u7968\u6570\u4fdd\u5b58\u5728memcache\u4e2d\uff0cticket_count = 88 A\u7528\u6237\u5237\u65b0\u9875\u9762\u4ecememecache\u4e2d\u8bfb\u53d6\u5230ticket_count = 88 B\u7528\u6237\u5237\u65b0\u9875\u9762\u4ecememecache\u4e2d\u8bfb\u53d6\u5230ticket_count = 88 A,B\u7528\u6237\u5747\u8d2d\u4e70\u8be5\u8d9f\u5217\u8f66\u7684\u7968\uff0c\u5e76\u4fee\u6539ticket_count\u7684\u503c A\u4fee\u6539\u540e\uff0cticket_count = 87 B\u4fee\u6539\u540e\uff0cticket_count = 87 \u7136\u800c\u6b63\u786e\u6570\u5b57\u5e94\u8be5\u662f86\uff0c\u6570\u636e\u5c31\u6df7\u4e71\u4e86\u3002 \u5982\u679c\u60f3\u8981\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 gets\u3000\u548c\u3000cas root@leco:~/code/memcached# cat gets.py #!/usr/bin/env python # -*- coding:utf-8 -*- import memcache mc = memcache.Client(['127.0.0.1:11211']) mc.set('ticket','88') reget = mc.get('ticket') print('\u5269\u4f59\u7968\u6570',reget) ret = mc.gets('ticket') print(ret) # \u5982\u679c\u6709\u4eba\u5728gets\u4e4b\u540e\u548ccas\u4e4b\u524d\u4fee\u6539\u4e86product_count\uff0c\u90a3\u4e48\uff0c # \u4e0b\u9762\u7684\u8bbe\u7f6e\u5c06\u4f1a\u6267\u884c\u5931\u8d25\uff0c\u5256\u51fa\u5f02\u5e38\uff0c\u4ece\u800c\u907f\u514d\u975e\u6b63\u5e38\u6570\u636e\u7684\u4ea7\u751f recas = mc.cas('ticket','88') print(recas) ret = mc.gets('ticket') print('\u5269\u4f59\u7968\u6570',ret) root@leco:~/code/memcached# python3 gets.py \u5269\u4f59\u7968\u6570 88 88 True \u5269\u4f59\u7968\u6570 88 \u672c\u8d28\u4e0a\u6bcf\u6b21\u6267\u884cgets\u65f6\uff0c\u4f1a\u4ecememcache\u4e2d\u83b7\u53d6\u4e00\u4e2a\u81ea\u589e\u7684\u6570\u5b57\uff0c\u901a\u8fc7cas\u53bb\u4fee\u6539gets\u7684\u503c\u65f6\uff0c\u4f1a\u643a\u5e26\u4e4b\u524d\u83b7\u53d6\u7684\u81ea\u589e\u548cmemcache\u4e2d\u7684\u81ea\u589e\u503c\u8fdb\u884c\u6bd4\u8f83\uff0c\u5982\u679c\u76f8\u7b49\uff0c\u5219\u53ef\u4ee5\u63d0\u4ea4\uff0c\u5982\u679c\u4e0d\u76f8\u7b49\uff0c\u90a3\u4e48\u8868\u793a\u5728gets\u548ccas\u6267\u884c\u4e4b\u95f4\uff0c\u53c8\u6709\u5176\u4ed6\u4eba\u6267\u884c\u4e86gets\uff0c\u5219\u4e0d\u5141\u8bb8\u4fee\u6539\u3002 2.5 \u67e5\u627e\u64cd\u4f5c \u00b6 2.5.1 get,get_multi \u00b6 get : \u83b7\u53d6\u4e00\u4e2a\u952e\u503c\u5bf9\u3002 get_multi : \u83b7\u53d6\u591a\u4e2a\u952e\u503c\u5bf9\u3002 root@leco:~/code/memcached# cat get.py #!/usr/bin/env python3 #coding:utf8 import memcache mc = memcache.Client(['127.0.0.1:11211']) mc.set('name','jack') re = mc.get('name') print('get',re) # \u83b7\u53d6\u4e00\u4e2a\u952e\u503c\u5bf9 dic = {'name':'jack','age':'20','job':'IT'} mc.set_multi(dic) regetmu=mc.get_multi(['name','age','job']) print('get_multi',re) # \u83b7\u53d6\u591a\u4e2a\u952e\u503c\u5bf9\u7684\u503c root@leco:~/code/memcached# python3 get.py get jack get_multi jack \u82e5\u662fget\u7684key\u4e0d\u5b58\u5728\u7684\u8bdd\uff0c\u8fd4\u56de\u4e3a\u7a7a\u3002 2.5.2 delete/delete_multi \u00b6 delete : \u5728Memcached\u4e2d\u5220\u9664\u6307\u5b9a\u7684\u4e00\u4e2a\u952e\u503c\u5bf9\u3002 delete_multi : \u5728Memcached\u4e2d\u5220\u9664\u6307\u5b9a\u591a\u4e2a\u952e\u503c\u5bf9\u3002 root@leco:~/code/memcached# cat del.py #!/usr/bin/env python # -*- coding:utf-8 -*- import memcache mc = memcache.Client(['127.0.0.1:11211']) mc.set('name1','JACK1') mc.set('name2','JACK2') mc.set('name3','JACK3') name1,name2,name3 = mc.get('name1'),mc.get('name2'),mc.get('name3') print('name1 = %s, name2=%s, name3=%s' %(name1,name2,name3)) mc.delete('name1') re = mc.get('name') print('\u5220\u9664',re) #\u5220\u9664\u4e00\u4e2a\u952e\u503c\u5bf9 mc.delete_multi(['name2','name3']) name1,name2,name3 = mc.get('name1'),mc.get('name2'),mc.get('name3') print('name1 = %s, name2=%s, name3=%s' %(name1,name2,name3)) \u8fd0\u884c\u7ed3\u679c root@leco:~/code/memcached# python3 del.py name1 = JACK1, name2=JACK2, name3=JACK3 \u5220\u9664 jack name1 = None, name2=None, name3=None 2.5.4 incre/decr \u00b6 decr : \u81ea\u51cf\uff0c\u5c06Memcached\u4e2d\u7684\u4e00\u4e2a\u503c\u589e\u52a0N\uff08N\u9ed8\u8ba4\u4e3a1\uff09 incr : \u81ea\u589e\uff0c\u5c06Memcached\u4e2d\u7684\u4e00\u4e2a\u503c\u51cf\u5c11N\uff08N\u9ed8\u8ba4\u4e3a1\uff09 root@leco:~/code/memcached# cat decr.py #!/usr/bin/env python # -*- coding:utf-8 -*- import memcache mc = memcache.Client(['127.0.0.1:11211']) mc.set('num',1) ret = mc.get('num') print('\u539f\u59cb\u503c',ret) mc.incr('num',9) ret = mc.get('num') print('\u52a0\u503c\u540e\u7ed3\u679c = ',ret) mc.decr('num',5) ret = mc.get('num') print('\u51cf\u503c\u540e\u7ed3\u679c = ',ret) root@leco:~/code/memcached# python3 decr.py \u539f\u59cb\u503c 1 \u52a0\u503c\u540e\u7ed3\u679c = 10 \u51cf\u503c\u540e\u7ed3\u679c = 5 2.6 \u7edf\u8ba1\u64cd\u4f5c \u00b6 2.6.1 stats \u00b6 Memcached stats\u547d\u4ee4\u7528\u4e8e\u8fd4\u56de\u7edf\u8ba1\u4fe1\u606f\u4f8b\u5982PID\uff08\u8fdb\u7a0b\u53f7\uff09\uff0c\u7248\u672c\u53f7\uff0c\u8fde\u63a5\u6570\u7b49\u3002 root@leco:~/code/memcached# cat stats.py #!/usr/bin/env python # -*- coding:utf-8 -*- import memcache mc = memcache.Client(['127.0.0.1:11211']) ret = mc.get_stats() print(ret) root@leco:~/code/memcached# python3 stats.py [(b'127.0.0.1:11211 (1)', {b'pid': b'7862', b'uptime': b'6680', b'time': b'1550635332', b'version': b'1.5.12', b'libevent': b'2.0.21-stable', b'pointer_size': b'64', b'rusage_user': b'0.537668', b'rusage_system': b'0.414349', b'max_connections': b'256', b'curr_connections': b'2', b'total_connections': b'31', b'rejected_connections': b'0', b'connection_structures': b'4', b'reserved_fds': b'20', b'cmd_get': b'77', b'cmd_set': b'65', b'cmd_flush': b'0', b'cmd_touch': b'0', b'get_hits': b'67', b'get_misses': b'10', b'get_expired': b'0', b'get_flushed': b'0', b'delete_misses': b'4', b'delete_hits': b'6', b'incr_misses': b'0', b'incr_hits': b'2', b'decr_misses': b'0', b'decr_hits': b'1', b'cas_misses': b'0', b'cas_hits': b'0', b'cas_badval': b'0', b'touch_hits': b'0', b'touch_misses': b'0', b'auth_cmds': b'0', b'auth_errors': b'0', b'bytes_read': b'2630', b'bytes_written': b'4681', b'limit_maxbytes': b'10485760', b'accepting_conns': b'1', b'listen_disabled_num': b'0', b'time_in_listen_disabled_us': b'0', b'threads': b'4', b'conn_yields': b'0', b'hash_power_level': b'16', b'hash_bytes': b'524288', b'hash_is_expanding': b'0', b'slab_reassign_rescues': b'0', b'slab_reassign_chunk_rescues': b'0', b'slab_reassign_evictions_nomem': b'0', b'slab_reassign_inline_reclaim': b'0', b'slab_reassign_busy_items': b'0', b'slab_reassign_busy_deletes': b'0', b'slab_reassign_running': b'0', b'slabs_moved': b'0', b'lru_crawler_running': b'0', b'lru_crawler_starts':b'3825', b'lru_maintainer_juggles': b'14452', b'malloc_fails': b'0', b'log_worker_dropped': b'0', b'log_worker_written': b'0', b'log_watcher_skipped': b'0', b'log_watcher_sent': b'0', b'bytes': b'520', b'curr_items': b'8', b'total_items': b'56', b'slab_global_page_pool': b'0', b'expired_unfetched': b'0', b'evicted_unfetched': b'0', b'evicted_active': b'0', b'evictions': b'0', b'reclaimed': b'0', b'crawler_reclaimed': b'0', b'crawler_items_checked': b'41', b'lrutail_reflocked': b'4', b'moves_to_cold': b'24', b'moves_to_warm': b'8', b'moves_within_lru': b'1', b'direct_reclaims': b'0', b'lru_bumps_dropped': b'0'})] 2.6.2 slabs \u00b6 Memcached stats slabs \u547d\u4ee4\u7528\u4e8e\u663e\u793a\u5404\u4e2aslab\u7684\u4fe1\u606f\uff0c\u5305\u62ecchunk\u7684\u5927\u5c0f\u3001\u6570\u76ee\u3001\u4f7f\u7528\u60c5\u51b5\u7b49\u3002","title":"2. memcached"},{"location":"python/lib/nosql/memcached/memcached.index/#1","text":"\u8fd9\u4e2a\u6a21\u5757\u662f\u4e00\u4e2aPython\u64cd\u4f5cmemcached\u7684\u4e00\u4e2aAPI\u63a5\u53e3\u3002 Memcached\u5b98\u7f51\uff1a http://memcached.org/ \u6a21\u5757\u5b98\u7f51\uff1a https://pypi.python.org/pypi/python-memcached/","title":"1. \u4ecb\u7ecd"},{"location":"python/lib/nosql/memcached/memcached.index/#11-memcached","text":"\u514d\u8d39\u548c\u5f00\u6e90\uff0c\u9ad8\u6027\u80fd\uff0c\u5206\u5e03\u5f0f\u5185\u5b58\u5bf9\u8c61\u7f13\u5b58\u7cfb\u7edf\uff0c\u672c\u8d28\u4e0a\u662f\u901a\u7528\u7684\uff0c\u4f46\u65e8\u5728\u901a\u8fc7\u51cf\u8f7b\u6570\u636e\u5e93\u8d1f\u8f7d\u6765\u52a0\u901f\u52a8\u6001Web\u5e94\u7528\u7a0b\u5e8f\u3002 Memcached\u662f\u4e00\u4e2a\u5185\u5b58\u4e2d\u7684\u952e\u503c\u5b58\u50a8\uff0c\u7528\u4e8e\u4ece\u6570\u636e\u5e93\u8c03\u7528\uff0cAPI\u8c03\u7528\u6216\u9875\u9762\u5448\u73b0\u7684\u7ed3\u679c\u4e2d\u83b7\u53d6\u4efb\u610f\u6570\u636e\uff08\u5b57\u7b26\u4e32\uff0c\u5bf9\u8c61\uff09\u7684\u5c0f\u5757\u3002 Memcached\u7b80\u5355\u800c\u5f3a\u5927\u3002\u5176\u7b80\u5355\u7684\u8bbe\u8ba1\u4fc3\u8fdb\u4e86\u5feb\u901f\u90e8\u7f72\uff0c\u6613\u4e8e\u5f00\u53d1\uff0c\u5e76\u89e3\u51b3\u4e86\u5927\u578b\u6570\u636e\u7f13\u5b58\u9762\u4e34\u7684\u8bb8\u591a\u95ee\u9898\u3002\u5176API\u9002\u7528\u4e8e\u5927\u591a\u6570\u6d41\u884c\u8bed\u8a00\u3002 \u4ee5\u4e0a\u5185\u5bb9\u6458\u81ea\u5b98\u7f51\u7684\u4ecb\u7ecd\u7684\u7ffb\u8bd1\uff0c\u5177\u4f53\u4fe1\u606f\u8bbf\u95ee\u5b98\u7f51","title":"1.1 \u4ec0\u4e48\u662fMemcached\uff1f"},{"location":"python/lib/nosql/memcached/memcached.index/#12","text":"","title":"1.2 \u5b89\u88c5"},{"location":"python/lib/nosql/memcached/memcached.index/#121","text":"ubuntu apt-get install memcached centos yum install memcached","title":"1.2.1 \u5728\u7ebf\u5b89\u88c5"},{"location":"python/lib/nosql/memcached/memcached.index/#122","text":"Memcached\u6e90\u7801\u5305\u5b89\u88c5\u7684\u65f6\u5019\u9700\u8981\u4f9d\u8d56\u4e8elibevent \u5b89\u88c5\u4f9d\u8d56\u5e93 # Ubuntu apt-get install libevent-dev # CentOS yum install libevent-devel \u4e0d\u5b89\u88c5\u5e93\u7684\u65f6\u5019\uff0c\u7f16\u8bd1\u65f6\u5019\u62a5\u9519\u5982\u4e0b checking for libevent directory... configure: error: libevent is required. You can get it from http://www.monkey.org/~provos/libevent/ If it's already installed, specify its path using --with-libevent=/dir/ \u7f16\u8bd1\u5b89\u88c5memcached wget https://memcached.org/latest tar -zxf memcached-1.x.x.tar.gz cd memcached-1.x.x ./configure --prefix=/usr/local/memcached make && make test && sudo make install \u5177\u4f53\u53c2\u6570\u89c1./configure --help\u5168\u9009\u9879\uff0cSASL\u652f\u6301\u9700\u8981\u4e00\u4e9b\u53ef\u9009\u9644\u52a0\u5e93\u3002 \u64cd\u4f5c\u8fc7\u7a0b root@leco:/usr/local/src# wget http://www.memcached.org/files/memcached-1.5.12.tar.gz --2019-02-20 09:55:44-- http://www.memcached.org/files/memcached-1.5.12.tar.gz \u6b63\u5728\u89e3\u6790\u4e3b\u673a www.memcached.org (www.memcached.org)... 107.170.231.145 \u6b63\u5728\u8fde\u63a5 www.memcached.org (www.memcached.org)|107.170.231.145|:80... \u5df2\u8fde\u63a5\u3002 \u7701\u7565\u3002\u3002\u3002 root@leco:/usr/local/src# ls memcached-1.5.12.tar.gz memcached-1.5.12.tar.gz root@leco:/usr/local/src# tar xf memcached-1.5.12.tar.gz root@leco:/usr/local/src# cd memcached-1.5.12 root@leco:/usr/local/src/memcached-1.5.12# ./configure --prefix=/usr/local/memcached root@leco:/usr/local/src/memcached-1.5.12# make && sudo make install root@leco:/usr/local/src/memcached-1.5.12# echo $? 0 # \u6dfb\u52a0\u73af\u5883\u53d8\u91cf root@leco:/usr/local/src/memcached-1.5.12# vim /etc/profile root@leco:/usr/local/src/memcached-1.5.12# tail -1 /etc/profile export PATH=$PATH:/usr/local/memcached/bin root@leco:/usr/local/src/memcached-1.5.12# source /etc/profile \u4ee5\u4e0a\u662f\u6e90\u7801\u5305\u5b89\u88c5\uff0c\u53ef\u4ee5\u5b89\u88c5\u6700\u65b0\u7248\u672c\u7684\uff0c\u8981\u662f\u5728\u7ebf\u5b89\u88c5\uff0c\u90fd\u662f\u57fa\u4e8e\u7cfb\u7edf\u6e90\u5b89\u88c5\u7684\u3002\u63a8\u8350\u6e90\u7801\u5b89\u88c5","title":"1.2.2 \u79bb\u7ebf\u5b89\u88c5"},{"location":"python/lib/nosql/memcached/memcached.index/#123","text":"root@leco:~# memcached -d -m 10 -u root -l 0.0.0.0 -p 11211 -c 256 -P /tmp/memcached.pid root@leco:~# netstat -lnp|grep 11211 tcp 0 0 0.0.0.0:11211 0.0.0.0:* LISTEN 7862/memcached unix 2 [ ACC ] \u6d41 LISTENING 100911211 11507/unity-files-d @leco-com.canonical.Unity.Scope.files.T5294429510698002 root@leco:~# telnet localhost 11211 Trying 127.0.0.1... Connected to localhost. Escape character is '^]'. \u5982\u679c\u51fa\u73b0\u4ee5\u4e0a\u5185\u5bb9\u5c31\u4ee3\u8868\u542f\u52a8\u6210\u529f\uff01 \u53c2\u6570\u8bf4\u660e \u53c2\u6570 \u63cf\u8ff0 -d \u662f\u542f\u52a8\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b -m \u662f\u5206\u914d\u7ed9Memcache\u4f7f\u7528\u7684\u5185\u5b58\u6570\u91cf\uff0c\u5355\u4f4d\u662fMB -u \u662f\u8fd0\u884cMemcache\u7684\u7528\u6237 -l \u662f\u76d1\u542c\u7684\u670d\u52a1\u5668IP\u5730\u5740 -p \u662f\u8bbe\u7f6eMemcache\u76d1\u542c\u7684\u7aef\u53e3,\u6700\u597d\u662f1024\u4ee5\u4e0a\u7684\u7aef\u53e3 -c \u9009\u9879\u662f\u6700\u5927\u8fd0\u884c\u7684\u5e76\u53d1\u8fde\u63a5\u6570\uff0c\u9ed8\u8ba4\u662f1024\uff0c\u6309\u7167\u4f60\u670d\u52a1\u5668\u7684\u8d1f\u8f7d\u91cf\u6765\u8bbe\u5b9a -P \u662f\u8bbe\u7f6e\u4fdd\u5b58Memcache\u7684pid\u6587\u4ef6","title":"1.2.3 \u542f\u52a8"},{"location":"python/lib/nosql/memcached/memcached.index/#124","text":"echo 'memcached -d -m 10 -u root -l 0.0.0.0 -p 11211 -c 256 -P /tmp/memcached.pid' >> /etc/rc.local","title":"1.2.4 \u8bbe\u7f6e\u5f00\u673a\u542f\u52a8"},{"location":"python/lib/nosql/memcached/memcached.index/#125","text":"pkill `cat /tmp/memcached.pid`","title":"1.2.5 \u505c\u6b62"},{"location":"python/lib/nosql/memcached/memcached.index/#2-memcached","text":"","title":"2. memcached\u5e93"},{"location":"python/lib/nosql/memcached/memcached.index/#21","text":"root@leco:/home/leco# pip install python3-memcached Collecting python3-memcached Downloading https://files.pythonhosted.org/packages/14/fa/cd0d93c30722db0cfa777ec9cd0203fa7da2771a5c70c9908f471944b6e2/python3-memcached-1.51.tar.gz Building wheels for collected packages: python3-memcached Running setup.py bdist_wheel for python3-memcached ... done Stored in directory: /root/.cache/pip/wheels/6b/50/29/888c59a274ac0e5d3831987eec3a6f6c4562e021c2fc0311b0 Successfully built python3-memcached Installing collected packages: python3-memcached Successfully installed python3-memcached-1.51 root@leco:~/book# pip -V pip 9.0.1 from /usr/local/lib/python3.6/site-packages (python 3.6) root@leco:~/book# python3.6 Python 3.6.1 (default, Mar 21 2018, 13:46:25) [GCC 5.4.0 20160609] on linux Type \"help\", \"copyright\", \"credits\" or \"license\" for more information. >>> import memcache >>> \u5bfc\u5165\u6ca1\u6709\u62a5\u9519\u5c31\u8868\u793a\u5b89\u88c5\u6210\u529f\u3002","title":"2.1 \u5b89\u88c5"},{"location":"python/lib/nosql/memcached/memcached.index/#22","text":"root@leco:~/book# ipython Python 3.6.1 (default, Mar 21 2018, 13:46:25) Type 'copyright', 'credits' or 'license' for more information IPython 6.2.1 -- An enhanced Interactive Python. Type '?' for help. # \u5bfc\u5165\u6a21\u5757 In [1]: import memcache # \u94fe\u63a5\uff0cip\uff1aport In [2]: conn = memcache.Client(['127.0.0.1:11211']) # \u8bbe\u7f6e key:value In [3]: conn.set('k1', 'v1') Out[3]: True # \u53d6\u503c In [4]: conn.get('k1') Out[4]: 'v1","title":"2.2 \u6d4b\u8bd5"},{"location":"python/lib/nosql/memcached/memcached.index/#23","text":"\u7528nc\u547d\u4ee4\u64cd\u4f5cmemcached \u529f\u80fd \u547d\u4ee4 \u5b58\u50a8\u6570\u636e printf \"set key 0 10 6\\r\\nresult\\r\\n\" \u83b7\u53d6\u6570\u636e printf \"get key\\r\\n\" \u5220\u9664\u6570\u636e printf \"delete key\\r\\n\" \u67e5\u770b\u72b6\u6001 printf \"stats\\r\\n\" \u6a21\u62dftop\u547d\u4ee4\u67e5\u770b\u72b6\u6001 watch \"echo stats\" \u6e05\u7a7a\u7f13\u5b58 printf \"flush_all\\r\\n\"","title":"2.3 \u5176\u4ed6\u547d\u4ee4\u6d4b\u8bd5"},{"location":"python/lib/nosql/memcached/memcached.index/#23_1","text":"python-memcached\u6a21\u5757\u539f\u751f\u652f\u6301\u96c6\u7fa4\u64cd\u4f5c\uff0c\u5176\u539f\u7406\u662f\u5728\u5185\u5b58\u4e2d\u7ef4\u62a4\u4e00\u4e2a\u4e3b\u673a\u5217\u8868\uff0c\u4e14\u96c6\u7fa4\u4e2d\u4e3b\u673a\u7684\u6743\u91cd\u503c\u548c\u4e3b\u673a\u5728\u5217\u8868\u4e2d\u91cd\u590d\u51fa\u73b0\u7684\u6b21\u6570\u6210\u6b63\u6bd4\u3002 \u4e3b\u673a \u6743\u91cd 1.1.1.1 1 1.1.1.2 2 1.1.1.3 1 \u90a3\u4e48\u5728\u5185\u5b58\u4e2d\u4e3b\u673a\u5217\u8868\u4e3a\uff1a host_list = [\"1.1.1.1\", \"1.1.1.2\", \"1.1.1.2\", \"1.1.1.3\", ] \u7528\u6237\u5982\u679c\u8981\u5728\u5185\u5b58\u4e2d\u521b\u5efa\u4e00\u4e2a\u952e\u503c\u5bf9\uff08\u5982\uff1ak1 = \"value1\"\uff09\uff0c\u90a3\u4e48\u8981\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\uff1a \u6839\u636e\u7b97\u6cd5\u5c06k1\u8f6c\u6362\u6210\u4e00\u4e2a\u6570\u5b57 \u5c06\u6570\u5b57\u548c\u4e3b\u673a\u5217\u8868\u957f\u5ea6\u6c42\u4f59\u6570\uff0c\u5f97\u5230\u4e00\u4e2a\u503cN\uff080 <= N < \u957f\u5ea6\uff09 \u5728\u4e3b\u673a\u5217\u8868\u4e2d\u6839\u636e\u7b2c\u4e8c\u6b65\u5f97\u5230\u7684\u503c\u4e3a\u7d22\u5f15\u83b7\u53d6\u4e3b\u673a\uff0c\u4f8b\u5982: host_list[N] \u8fde\u63a5\u5c06\u7b2c\u4e09\u6b65\u4e2d\u83b7\u53d6\u7684\u4e3b\u673a\uff0c\u5c06k1 = \"value1\" \u653e\u7f6e\u5728\u8be5\u670d\u52a1\u5668\u7684\u5185\u5b58\u4e2d \u53e6\u5916\u5728\u542f\u52a8\u4e24\u4e2a\u670d\u52a1 memcached -d -m 10 -u root -l 0.0.0.0 -p 11212 -c 256 -P /tmp/memcached2.pid memcached -d -m 10 -u root -l 0.0.0.0 -p 11213 -c 256 -P /tmp/memcached3.pid \u64cd\u4f5c\u8fc7\u7a0b root@leco:~# memcached -d -m 10 -u root -l 0.0.0.0 -p 11212 -c 256 -P /tmp/memcached2.pid root@leco:~# memcached -d -m 10 -u root -l 0.0.0.0 -p 11213 -c 256 -P /tmp/memcached3.pid root@leco:~# netstat -lnp|grep memcached tcp 0 0 0.0.0.0:11211 0.0.0.0:* LISTEN 7862/memcached tcp 0 0 0.0.0.0:11212 0.0.0.0:* LISTEN 11748/memcached tcp 0 0 0.0.0.0:11213 0.0.0.0:* LISTEN 11759/memcached root@leco:~/code/memcached# cat test1.py #!/usr/bin/env python3 #coding:utf8 import memcache mc = memcache.Client([('127.0.0.1:11211', 1), ('127.0.0.1:11212', 2),('127.0.0.1:11213',3)]) mc.set('k1','value1') ret = mc.get('k1') print (ret) \u8fd0\u884c\u7ed3\u679c root@leco:~/code/memcached# python3.6 test1.py value1","title":"2.3 \u96c6\u7fa4"},{"location":"python/lib/nosql/memcached/memcached.index/#24","text":"","title":"2.4 \u5b58\u50a8\u64cd\u4f5c"},{"location":"python/lib/nosql/memcached/memcached.index/#241-setset_multi","text":"set : \u8bbe\u7f6e\u4e00\u4e2a\u952e\u503c\u5bf9\uff0c\u5982\u679cKey\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\uff0c\u5982\u679ckey\u5b58\u5728\uff0c\u5219\u4fee\u6539\u3002 set_multi : \u8bbe\u7f6e\u591a\u4e2a\u952e\u503c\u5bf9\uff0c\u5982\u679ckey\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\uff0c\u5982\u679ckey\u5b58\u5728\uff0c\u5219\u4fee\u6539\u3002 root@leco:~/code/memcached# cat set.py #!/usr/bin/env python # -*- coding:utf-8 -*- import memcache mc = memcache.Client(['127.0.0.1:11211']) mc.set('name','jack') re = mc.get('name') print('set\u7528\u6cd5',re) #\u8bbe\u7f6e\u4e00\u4e2a\u952e\u503c\u5bf9 dic = {'name':'jack','age':'19','job':'IT'} mc.set_multi(dic) #\u8bbe\u7f6e\u591a\u4e2a\u952e\u503c\u5bf9 #\u6216\u8005mc.set_multi({'name':'jack','age':'19','job':'IT'}) name = mc.get('name') age = mc.get('age') job = mc.get('job') print('set_multi\u7528\u6cd5:',name,age,job) \u8fd0\u884c\u7ed3\u679c root@leco:~/code/memcached# python3 set.py set\u7528\u6cd5 jack set_multi\u7528\u6cd5: jack 19 IT","title":"2.4.1 set/set_multi"},{"location":"python/lib/nosql/memcached/memcached.index/#242-add","text":"\u6dfb\u52a0\u4e00\u6761\u952e\u503c\u5bf9\uff0c\u5982\u679c\u5df2\u7ecf\u5b58\u5728\u7684key\uff0c\u91cd\u590d\u6267\u884cadd\u64cd\u4f5c\u8fd4\u56de\u503c\u4e3aflase\u3002 root@leco:~/code/memcached# cat add.py #!/usr/bin/env python3 #coding:utf8 import memcache mc = memcache.Client([('127.0.0.1:11211', 1)]) ret1 = mc.add('add','v1') ret2 = mc.add('add','v2') ret = mc.get('add') print(ret1) print(ret2) print(ret) \u8fd0\u884c\u7ed3\u679c root@leco:~/code/memcached# python2 add.py True # \u7b2c\u4e00\u6dfb\u52a0add \u8fd9\u4e2a\u952e\u65f6\u5019\uff0c\u4e4b\u524d\u662f\u6ca1\u6709\u7684\uff0c\u6240\u6709\u53ef\u4ee5\u521b\u5efa\u3002 False # \u7b2c\u4e8c\u6b21\u518d\u6b21\u6dfb\u52a0add\u8fd9\u4e2a\u952e\u65f6\u5019\uff0c\u4e4b\u524d\u6709\u4e86add\u8fd9\u4e2a\u952e\uff0c\u6240\u4ee5\u521b\u5efa\u5931\u8d25 v1","title":"2.4.2 add"},{"location":"python/lib/nosql/memcached/memcached.index/#243-replace","text":"replace\u4fee\u6539\u67d0\u4e2akey\u7684\u503c\uff0c\u5982\u679ckey\u4e0d\u5b58\u5728\uff0c\u8fd4\u56deFalse root@leco:~/code/memcached# cat replace.py #!/usr/bin/env python # -*- coding:utf-8 -*- import memcache mc = memcache.Client(['127.0.0.1:11211']) mc.set('name','\u5f20\u4e09') re = mc.get('name') print(re) ret_name = mc.replace('name','\u674e\u56db') ret1 = mc.get('name') rereplace = mc.replace('name10','hahaha') ret2 = mc.get('name10') print(\"ret_name = \",ret_name) print(\"ret1 = \",ret1) print(\"rereplace = \",rereplace) print(\"ret2 = \",ret2) root@leco:~/code/memcached# python3 replace.py \u5f20\u4e09 ret_name = True # key\u5b58\u5728\u66ff\u6362\u6210\u529f ret1 = \u674e\u56db # \u4fee\u6539\u540e\u7684\u503c rereplace = False # key\u4e0d\u5b58\u5728\uff0c\u66ff\u6362\u5931\u8d25 ret2 = None # \u4e0d\u5b58\u5728\u7684key\uff0c\u8fd4\u56deFalse","title":"2.4.3 replace"},{"location":"python/lib/nosql/memcached/memcached.index/#244-appendprepend","text":"append : \u4fee\u6539\u6307\u5b9akey\u7684\u503c\uff0c\u5728\u8be5\u503c\u540e\u9762\u8ffd\u52a0\u5185\u5bb9\u3002 prepend : \u4fee\u6539\u6307\u5b9akey\u7684\u503c\uff0c\u5728\u8be5\u503c\u524d\u9762\u63d2\u5165\u5185\u5bb9\u3002 root@leco:~/code/memcached# cat append.py #!/usr/bin/env python # -*- coding:utf-8 -*- import memcache mc = memcache.Client(['127.0.0.1:11211']) mc.set('num','\u6211\u662f\u4e2d\u95f4\u90e8\u5206') re = mc.get('num') print(re) mc.append('num','\u6211\u662f\u540e\u9762\u90e8\u5206') # \u5728\u6211\u662f\u4e2d\u95f4\u90e8\u5206\u540e\u8ffd\u52a0 re = mc.get('num') print(re) mc.prepend('num','\u6211\u662f\u5f00\u5934\u90e8\u5206') # \u5728\u6211\u662f\u4e2d\u95f4\u90e8\u5206\u524d\u8ffd\u52a0 re = mc.get('num') print(re) \u8fd0\u884c\u7ed3\u679c root@leco:~/code/memcached# python3 append.py \u6211\u662f\u4e2d\u95f4\u90e8\u5206 \u6211\u662f\u4e2d\u95f4\u90e8\u5206\u6211\u662f\u540e\u9762\u90e8\u5206 \u6211\u662f\u5f00\u5934\u90e8\u5206\u6211\u662f\u4e2d\u95f4\u90e8\u5206\u6211\u662f\u540e\u9762\u90e8\u5206","title":"2.4.4 append/prepend"},{"location":"python/lib/nosql/memcached/memcached.index/#245-getscas","text":"\u4f7f\u7528\u7f13\u5b58\u7cfb\u7edf\u5171\u4eab\u6570\u636e\u8d44\u6e90\u5c31\u5fc5\u7136\u7ed5\u4e0d\u5f00\u6570\u636e\u4e89\u593a\u548c\u810f\u6570\u636e\uff08\u6570\u636e\u6df7\u4e71\uff09\u7684\u95ee\u9898\u3002 \u5047\u8bbe\u53bb\u5f80\u5f90\u5dde\u7684\u9ad8\u94c1G88\u5217\u8f66\u5269\u4f59\u7968\u6570\u4fdd\u5b58\u5728memcache\u4e2d\uff0cticket_count = 88 A\u7528\u6237\u5237\u65b0\u9875\u9762\u4ecememecache\u4e2d\u8bfb\u53d6\u5230ticket_count = 88 B\u7528\u6237\u5237\u65b0\u9875\u9762\u4ecememecache\u4e2d\u8bfb\u53d6\u5230ticket_count = 88 A,B\u7528\u6237\u5747\u8d2d\u4e70\u8be5\u8d9f\u5217\u8f66\u7684\u7968\uff0c\u5e76\u4fee\u6539ticket_count\u7684\u503c A\u4fee\u6539\u540e\uff0cticket_count = 87 B\u4fee\u6539\u540e\uff0cticket_count = 87 \u7136\u800c\u6b63\u786e\u6570\u5b57\u5e94\u8be5\u662f86\uff0c\u6570\u636e\u5c31\u6df7\u4e71\u4e86\u3002 \u5982\u679c\u60f3\u8981\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u7684\u53d1\u751f\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 gets\u3000\u548c\u3000cas root@leco:~/code/memcached# cat gets.py #!/usr/bin/env python # -*- coding:utf-8 -*- import memcache mc = memcache.Client(['127.0.0.1:11211']) mc.set('ticket','88') reget = mc.get('ticket') print('\u5269\u4f59\u7968\u6570',reget) ret = mc.gets('ticket') print(ret) # \u5982\u679c\u6709\u4eba\u5728gets\u4e4b\u540e\u548ccas\u4e4b\u524d\u4fee\u6539\u4e86product_count\uff0c\u90a3\u4e48\uff0c # \u4e0b\u9762\u7684\u8bbe\u7f6e\u5c06\u4f1a\u6267\u884c\u5931\u8d25\uff0c\u5256\u51fa\u5f02\u5e38\uff0c\u4ece\u800c\u907f\u514d\u975e\u6b63\u5e38\u6570\u636e\u7684\u4ea7\u751f recas = mc.cas('ticket','88') print(recas) ret = mc.gets('ticket') print('\u5269\u4f59\u7968\u6570',ret) root@leco:~/code/memcached# python3 gets.py \u5269\u4f59\u7968\u6570 88 88 True \u5269\u4f59\u7968\u6570 88 \u672c\u8d28\u4e0a\u6bcf\u6b21\u6267\u884cgets\u65f6\uff0c\u4f1a\u4ecememcache\u4e2d\u83b7\u53d6\u4e00\u4e2a\u81ea\u589e\u7684\u6570\u5b57\uff0c\u901a\u8fc7cas\u53bb\u4fee\u6539gets\u7684\u503c\u65f6\uff0c\u4f1a\u643a\u5e26\u4e4b\u524d\u83b7\u53d6\u7684\u81ea\u589e\u548cmemcache\u4e2d\u7684\u81ea\u589e\u503c\u8fdb\u884c\u6bd4\u8f83\uff0c\u5982\u679c\u76f8\u7b49\uff0c\u5219\u53ef\u4ee5\u63d0\u4ea4\uff0c\u5982\u679c\u4e0d\u76f8\u7b49\uff0c\u90a3\u4e48\u8868\u793a\u5728gets\u548ccas\u6267\u884c\u4e4b\u95f4\uff0c\u53c8\u6709\u5176\u4ed6\u4eba\u6267\u884c\u4e86gets\uff0c\u5219\u4e0d\u5141\u8bb8\u4fee\u6539\u3002","title":"2.4.5 gets/cas"},{"location":"python/lib/nosql/memcached/memcached.index/#25","text":"","title":"2.5 \u67e5\u627e\u64cd\u4f5c"},{"location":"python/lib/nosql/memcached/memcached.index/#251-getget_multi","text":"get : \u83b7\u53d6\u4e00\u4e2a\u952e\u503c\u5bf9\u3002 get_multi : \u83b7\u53d6\u591a\u4e2a\u952e\u503c\u5bf9\u3002 root@leco:~/code/memcached# cat get.py #!/usr/bin/env python3 #coding:utf8 import memcache mc = memcache.Client(['127.0.0.1:11211']) mc.set('name','jack') re = mc.get('name') print('get',re) # \u83b7\u53d6\u4e00\u4e2a\u952e\u503c\u5bf9 dic = {'name':'jack','age':'20','job':'IT'} mc.set_multi(dic) regetmu=mc.get_multi(['name','age','job']) print('get_multi',re) # \u83b7\u53d6\u591a\u4e2a\u952e\u503c\u5bf9\u7684\u503c root@leco:~/code/memcached# python3 get.py get jack get_multi jack \u82e5\u662fget\u7684key\u4e0d\u5b58\u5728\u7684\u8bdd\uff0c\u8fd4\u56de\u4e3a\u7a7a\u3002","title":"2.5.1 get,get_multi"},{"location":"python/lib/nosql/memcached/memcached.index/#252-deletedelete_multi","text":"delete : \u5728Memcached\u4e2d\u5220\u9664\u6307\u5b9a\u7684\u4e00\u4e2a\u952e\u503c\u5bf9\u3002 delete_multi : \u5728Memcached\u4e2d\u5220\u9664\u6307\u5b9a\u591a\u4e2a\u952e\u503c\u5bf9\u3002 root@leco:~/code/memcached# cat del.py #!/usr/bin/env python # -*- coding:utf-8 -*- import memcache mc = memcache.Client(['127.0.0.1:11211']) mc.set('name1','JACK1') mc.set('name2','JACK2') mc.set('name3','JACK3') name1,name2,name3 = mc.get('name1'),mc.get('name2'),mc.get('name3') print('name1 = %s, name2=%s, name3=%s' %(name1,name2,name3)) mc.delete('name1') re = mc.get('name') print('\u5220\u9664',re) #\u5220\u9664\u4e00\u4e2a\u952e\u503c\u5bf9 mc.delete_multi(['name2','name3']) name1,name2,name3 = mc.get('name1'),mc.get('name2'),mc.get('name3') print('name1 = %s, name2=%s, name3=%s' %(name1,name2,name3)) \u8fd0\u884c\u7ed3\u679c root@leco:~/code/memcached# python3 del.py name1 = JACK1, name2=JACK2, name3=JACK3 \u5220\u9664 jack name1 = None, name2=None, name3=None","title":"2.5.2 delete/delete_multi"},{"location":"python/lib/nosql/memcached/memcached.index/#254-incredecr","text":"decr : \u81ea\u51cf\uff0c\u5c06Memcached\u4e2d\u7684\u4e00\u4e2a\u503c\u589e\u52a0N\uff08N\u9ed8\u8ba4\u4e3a1\uff09 incr : \u81ea\u589e\uff0c\u5c06Memcached\u4e2d\u7684\u4e00\u4e2a\u503c\u51cf\u5c11N\uff08N\u9ed8\u8ba4\u4e3a1\uff09 root@leco:~/code/memcached# cat decr.py #!/usr/bin/env python # -*- coding:utf-8 -*- import memcache mc = memcache.Client(['127.0.0.1:11211']) mc.set('num',1) ret = mc.get('num') print('\u539f\u59cb\u503c',ret) mc.incr('num',9) ret = mc.get('num') print('\u52a0\u503c\u540e\u7ed3\u679c = ',ret) mc.decr('num',5) ret = mc.get('num') print('\u51cf\u503c\u540e\u7ed3\u679c = ',ret) root@leco:~/code/memcached# python3 decr.py \u539f\u59cb\u503c 1 \u52a0\u503c\u540e\u7ed3\u679c = 10 \u51cf\u503c\u540e\u7ed3\u679c = 5","title":"2.5.4 incre/decr"},{"location":"python/lib/nosql/memcached/memcached.index/#26","text":"","title":"2.6 \u7edf\u8ba1\u64cd\u4f5c"},{"location":"python/lib/nosql/memcached/memcached.index/#261-stats","text":"Memcached stats\u547d\u4ee4\u7528\u4e8e\u8fd4\u56de\u7edf\u8ba1\u4fe1\u606f\u4f8b\u5982PID\uff08\u8fdb\u7a0b\u53f7\uff09\uff0c\u7248\u672c\u53f7\uff0c\u8fde\u63a5\u6570\u7b49\u3002 root@leco:~/code/memcached# cat stats.py #!/usr/bin/env python # -*- coding:utf-8 -*- import memcache mc = memcache.Client(['127.0.0.1:11211']) ret = mc.get_stats() print(ret) root@leco:~/code/memcached# python3 stats.py [(b'127.0.0.1:11211 (1)', {b'pid': b'7862', b'uptime': b'6680', b'time': b'1550635332', b'version': b'1.5.12', b'libevent': b'2.0.21-stable', b'pointer_size': b'64', b'rusage_user': b'0.537668', b'rusage_system': b'0.414349', b'max_connections': b'256', b'curr_connections': b'2', b'total_connections': b'31', b'rejected_connections': b'0', b'connection_structures': b'4', b'reserved_fds': b'20', b'cmd_get': b'77', b'cmd_set': b'65', b'cmd_flush': b'0', b'cmd_touch': b'0', b'get_hits': b'67', b'get_misses': b'10', b'get_expired': b'0', b'get_flushed': b'0', b'delete_misses': b'4', b'delete_hits': b'6', b'incr_misses': b'0', b'incr_hits': b'2', b'decr_misses': b'0', b'decr_hits': b'1', b'cas_misses': b'0', b'cas_hits': b'0', b'cas_badval': b'0', b'touch_hits': b'0', b'touch_misses': b'0', b'auth_cmds': b'0', b'auth_errors': b'0', b'bytes_read': b'2630', b'bytes_written': b'4681', b'limit_maxbytes': b'10485760', b'accepting_conns': b'1', b'listen_disabled_num': b'0', b'time_in_listen_disabled_us': b'0', b'threads': b'4', b'conn_yields': b'0', b'hash_power_level': b'16', b'hash_bytes': b'524288', b'hash_is_expanding': b'0', b'slab_reassign_rescues': b'0', b'slab_reassign_chunk_rescues': b'0', b'slab_reassign_evictions_nomem': b'0', b'slab_reassign_inline_reclaim': b'0', b'slab_reassign_busy_items': b'0', b'slab_reassign_busy_deletes': b'0', b'slab_reassign_running': b'0', b'slabs_moved': b'0', b'lru_crawler_running': b'0', b'lru_crawler_starts':b'3825', b'lru_maintainer_juggles': b'14452', b'malloc_fails': b'0', b'log_worker_dropped': b'0', b'log_worker_written': b'0', b'log_watcher_skipped': b'0', b'log_watcher_sent': b'0', b'bytes': b'520', b'curr_items': b'8', b'total_items': b'56', b'slab_global_page_pool': b'0', b'expired_unfetched': b'0', b'evicted_unfetched': b'0', b'evicted_active': b'0', b'evictions': b'0', b'reclaimed': b'0', b'crawler_reclaimed': b'0', b'crawler_items_checked': b'41', b'lrutail_reflocked': b'4', b'moves_to_cold': b'24', b'moves_to_warm': b'8', b'moves_within_lru': b'1', b'direct_reclaims': b'0', b'lru_bumps_dropped': b'0'})]","title":"2.6.1 stats"},{"location":"python/lib/nosql/memcached/memcached.index/#262-slabs","text":"Memcached stats slabs \u547d\u4ee4\u7528\u4e8e\u663e\u793a\u5404\u4e2aslab\u7684\u4fe1\u606f\uff0c\u5305\u62ecchunk\u7684\u5927\u5c0f\u3001\u6570\u76ee\u3001\u4f7f\u7528\u60c5\u51b5\u7b49\u3002","title":"2.6.2 slabs"},{"location":"python/lib/nosql/mongo/mongo.index/","text":"mongodb \u6a21\u5757 1. \u4ecb\u7ecd \u00b6 MongoDB \u662f\u76ee\u524d\u6700\u6d41\u884c\u7684 NoSQL \u6570\u636e\u5e93\u4e4b\u4e00\uff0c\u4f7f\u7528\u7684\u6570\u636e\u7c7b\u578b BSON\uff08\u7c7b\u4f3c JSON\uff09\u3002 Python \u8981\u8fde\u63a5 MongoDB \u9700\u8981 MongoDB \u9a71\u52a8\uff0c\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 PyMongo \u9a71\u52a8\u6765\u8fde\u63a5\u3002 1.1 \u5b89\u88c5 \u00b6 pip \u662f\u4e00\u4e2a\u901a\u7528\u7684 Python \u5305\u7ba1\u7406\u5de5\u5177\uff0c\u63d0\u4f9b\u4e86\u5bf9 Python \u5305\u7684\u67e5\u627e\u3001\u4e0b\u8f7d\u3001\u5b89\u88c5\u3001\u5378\u8f7d\u7684\u529f\u80fd\u3002 python3 -m pip3 install pymongo \u4e5f\u53ef\u4ee5\u6307\u5b9a\u5b89\u88c5\u7684\u7248\u672c: python3 -m pip3 install pymongo==3.5.1 \u66f4\u65b0 pymongo \u547d\u4ee4\uff1a python3 -m pip3 install --upgrade pymongo \u65e7\u7248\u7684 Python \u53ef\u4ee5\u4f7f\u7528 easy_install \u6765\u5b89\u88c5\uff0ceasy_install \u4e5f\u662f Python \u5305\u7ba1\u7406\u5de5\u5177\u3002 python -m easy_install pymongo \u66f4\u65b0 pymongo \u547d\u4ee4\uff1a python -m easy_install -U pymongo 1.2 \u6d4b\u8bd5pymongo \u00b6 \u63a5\u4e0b\u6765\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6d4b\u8bd5\u6587\u4ef6 test_mongodb.py\uff0c\u4ee3\u7801\u5982\u4e0b root@leco:/home/leco# cat test_mongodb.py #!/usr/bin/python3 import pymongo root@leco:/home/leco# python3 test_mongodb.py root@leco:/home/leco# echo $? 0 \u6267\u884c\u4ee5\u4e0a\u4ee3\u7801\u6587\u4ef6\uff0c\u5982\u679c\u6ca1\u6709\u51fa\u73b0\u9519\u8bef\uff0c\u8868\u793a\u5b89\u88c5\u6210\u529f\u3002 2. \u8be6\u7ec6 \u00b6 2.1 \u8fde\u63a5MongoDB \u00b6 \u8fde\u63a5MongoDB\u6211\u4eec\u9700\u8981\u4f7f\u7528PyMongo\u5e93\u91cc\u9762\u7684MongoClient\uff0c\u4e00\u822c\u6765\u8bf4\u4f20\u5165MongoDB\u7684IP\u53ca\u7aef\u53e3\u5373\u53ef\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u5730\u5740host\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u7aef\u53e3port\uff0c\u7aef\u53e3\u5982\u679c\u4e0d\u4f20\u9ed8\u8ba4\u662f27017\u3002 import pymongo client = pymongo.MongoClient(host='localhost', port=27017) \u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2aMongoDB\u7684\u8fde\u63a5\u5bf9\u8c61\u4e86\u3002 \u53e6\u5916MongoClient\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570host\u8fd8\u53ef\u4ee5\u76f4\u63a5\u4f20MongoDB\u7684\u8fde\u63a5\u5b57\u7b26\u4e32\uff0c\u4ee5mongodb\u5f00\u5934\uff0c\u4f8b\u5982\uff1a client = MongoClient('mongodb://localhost:27017/') \u53ef\u4ee5\u8fbe\u5230\u540c\u6837\u7684\u8fde\u63a5\u6548\u679c\u3002 2.2 \u6307\u5b9a\u6570\u636e\u5e93 \u00b6 MongoDB\u4e2d\u8fd8\u5206\u4e3a\u4e00\u4e2a\u4e2a\u6570\u636e\u5e93\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u7684\u4e00\u6b65\u5c31\u662f\u6307\u5b9a\u8981\u64cd\u4f5c\u54ea\u4e2a\u6570\u636e\u5e93\uff0c\u5728\u8fd9\u91cc\u6211\u4ee5test_mongo_db\u6570\u636e\u5e93\u4e3a\u4f8b\u8fdb\u884c\u8bf4\u660e\uff0c\u6240\u4ee5\u4e0b\u4e00\u6b65\u6211\u4eec\u9700\u8981\u5728\u7a0b\u5e8f\u4e2d\u6307\u5b9a\u8981\u4f7f\u7528\u7684\u6570\u636e\u5e93\u3002\u8c03\u7528client\u7684test_mongo_db\u5c5e\u6027\u5373\u53ef\u8fd4\u56detest_mongo_db\u6570\u636e\u5e93\u3002 db = client.test_mongo_db \u6216\u8005 db = client['test_mongo_db'] 2.3 \u6307\u5b9a\u96c6\u5408 \u00b6 MongoDB\u7684\u6bcf\u4e2a\u6570\u636e\u5e93\u53c8\u5305\u542b\u4e86\u8bb8\u591a\u96c6\u5408Collection\uff0c\u4e5f\u5c31\u7c7b\u4f3c\u4e0e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u7684\u8868\uff0c\u4e0b\u4e00\u6b65\u6211\u4eec\u9700\u8981\u6307\u5b9a\u8981\u64cd\u4f5c\u7684\u96c6\u5408\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u6307\u5b9a\u4e00\u4e2a\u96c6\u5408\u540d\u79f0\u4e3ainformations\uff0cinformations\u96c6\u5408\u3002\u8fd8\u662f\u548c\u6307\u5b9a\u6570\u636e\u5e93\u7c7b\u4f3c\uff0c\u6307\u5b9a\u96c6\u5408\u4e5f\u6709\u4e24\u79cd\u65b9\u5f0f: collection = db.informations \u6216\u8005 collection = db['informations'] 2.4 \u63d2\u5165\u6570\u636e \u00b6 2.4.1 \u5355\u6761\u63d2\u5165 \u00b6 \u63a5\u4e0b\u6765\u6211\u4eec\u4fbf\u53ef\u4ee5\u8fdb\u884c\u6570\u636e\u63d2\u5165\u4e86\uff0c\u5bf9\u4e8einformations\u8fd9\u4e2aCollection\uff0c\u6211\u4eec\u65b0\u5efa\u4e00\u6761\u6570\u636e\uff0c\u4ee5\u5b57\u5178\u7684\u5f62\u5f0f\u8868\u793a\uff1a information = {\"name\": \"\u5f20\u4e09\", \"age\": \"25\"} \u5728\u8fd9\u91cc\u6211\u4eec\u6307\u5b9a\u4e86\u59d3\u540d\u3001\u5e74\u9f84\u7136\u540e\u63a5\u4e0b\u6765\u76f4\u63a5\u8c03\u7528collection\u7684insert()\u65b9\u6cd5\u5373\u53ef\u63d2\u5165\u6570\u636e\u3002 result = collection.insert(information) print(result) \u5728MongoDB\u4e2d\uff0c\u6bcf\u6761\u6570\u636e\u5176\u5b9e\u90fd\u6709\u4e00\u4e2a_id\u5c5e\u6027\u6765\u552f\u4e00\u6807\u8bc6\uff0c\u5982\u679c\u6ca1\u6709\u663e\u5f0f\u6307\u660e_id\uff0cMongoDB\u4f1a\u81ea\u52a8\u4ea7\u751f\u4e00\u4e2aObjectId\u7c7b\u578b\u7684_id\u5c5e\u6027\u3002insert()\u65b9\u6cd5\u4f1a\u5728\u6267\u884c\u540e\u8fd4\u56de\u7684_id\u503c\u3002\u8fd0\u884c\u7ed3\u679c\uff1a 5c6b659b1607c47f8abe6ab7 2.4.2 \u591a\u6761\u63d2\u5165 \u00b6 \u5f53\u7136\u6211\u4eec\u4e5f\u53ef\u4ee5\u540c\u65f6\u63d2\u5165\u591a\u6761\u6570\u636e\uff0c\u53ea\u9700\u8981\u4ee5\u5217\u8868\u5f62\u5f0f\u4f20\u9012\u5373\u53ef\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a information = [{\"name\": \"\u5c0f\u660e\", \"age\": \"25\"}, {\"name\": \"\u5c0f\u5f3a\", \"age\": \"24\"}] information_id = collection.insert(information) print(information_id) \u6216\u8005 xiaoming={\"name\": \"\u5c0f\u660e\", \"age\": \"25\"} xiaoqiang= {\"name\": \"\u5c0f\u5f3a\", \"age\": \"24\"} information_id = collection.insert([xiaoming,xiaoqiang]) print(information_id) \u8fd4\u56de\u7684\u7ed3\u679c\u662f\u5bf9\u5e94\u7684_id\u7684\u96c6\u5408\uff0c\u8fd0\u884c\u7ed3\u679c\uff1a [ObjectId('5c6b65c01607c47f8abe6ab8'), ObjectId('5c6b65c01607c47f8abe6ab9')] 2.4.3 \u65b0\u5355\u6761\u63d2\u5165 \u00b6 \u5b9e\u9645\u4e0a\u5728PyMongo 3.X\u7248\u672c\u4e2d\uff0cinsert()\u65b9\u6cd5\u5b98\u65b9\u5df2\u7ecf\u4e0d\u63a8\u8350\u4f7f\u7528\u4e86\uff0c\u5f53\u7136\u7ee7\u7eed\u4f7f\u7528\u4e5f\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u5b98\u65b9\u63a8\u8350\u4f7f\u7528insert_one()\u548cinsert_many()\u65b9\u6cd5\u5c06\u63d2\u5165\u5355\u6761\u548c\u591a\u6761\u8bb0\u5f55\u5206\u5f00\u3002 lisi = {\"name\": \"\u674e\u56db\", \"age\": \"25\"} result = collection.insert_one(lisi) print(result.inserted_id) \u8fd4\u56de\u7ed3\u679c\u548cinsert()\u65b9\u6cd5\u4e0d\u540c\uff0c\u8fd9\u6b21\u8fd4\u56de\u7684\u662fInsertOneResult\u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u7528\u5176inserted_id\u5c5e\u6027\u83b7\u53d6_id\u3002\u7ed3\u679c\u662f 5c6b65df1607c47f8abe6aba 2.4.4 \u65b0\u591a\u6761\u63d2\u5165 \u00b6 \u5bf9\u4e8einsert_many()\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6570\u636e\u4ee5\u5217\u8868\u5f62\u5f0f\u4f20\u9012\u5373\u53ef\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a wangwu={\"name\": \"\u738b\u4e94\", \"age\": \"25\"} zhaoliu= {\"name\": \"\u8d75\u516d\", \"age\": \"24\"} result = collection.insert_many([wangwu,zhaoliu]) print(result) print(result.inserted_ids) \u7ed3\u679c\u662f: <pymongo.results.InsertManyResult object at 0x7f3cf2dc68c8> [ObjectId('5c6b66081607c47f8abe6abb'), ObjectId('5c6b66081607c47f8abe6abc')] insert_many()\u65b9\u6cd5\u8fd4\u56de\u7684\u7c7b\u578b\u662fInsertManyResult\uff0c\u8c03\u7528inserted_ids\u5c5e\u6027\u53ef\u4ee5\u83b7\u53d6\u63d2\u5165\u6570\u636e\u7684_id\u5217\u8868. 2.5 \u67e5\u8be2\u6570\u636e \u00b6 2.5.1 find_one() \u00b6 \u63d2\u5165\u6570\u636e\u540e\u6211\u4eec\u53ef\u4ee5\u5229\u7528find_one(),find_one()\u67e5\u8be2\u5f97\u5230\u662f\u5355\u4e2a\u7ed3\u679c\u3002 result = collection.find_one({'name': '\u5f20\u4e09'}) print(type(result)) print(result) \u7ed3\u679c\u662f: <class 'dict'> {'_id': ObjectId('5c6b659b1607c47f8abe6ab7'), 'name': '\u5f20\u4e09', 'age': '25'} \u53ef\u4ee5\u53d1\u73b0\u5b83\u591a\u4e86\u4e00\u4e2a_id\u5c5e\u6027\uff0c\u8fd9\u5c31\u662fMongoDB\u5728\u63d2\u5165\u7684\u8fc7\u7a0b\u4e2d\u81ea\u52a8\u6dfb\u52a0\u7684\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u76f4\u63a5\u6839\u636eObjectId\u6765\u67e5\u8be2\uff0c\u8fd9\u91cc\u9700\u8981\u4f7f\u7528bson\u5e93\u91cc\u9762\u7684ObjectId\u3002 In [27]: from bson.objectid import ObjectId In [28]: result = collection.find_one({'_id':ObjectId('5c6b659b1607c47f8abe6ab7')}) In [29]: print(result) {'_id': ObjectId('5c6b659b1607c47f8abe6ab7'), 'name': '\u5f20\u4e09', 'age': '25'} \u5176\u67e5\u8be2\u7ed3\u679c\u4f9d\u7136\u662f\u5b57\u5178\u7c7b\u578b\uff0c\u8fd0\u884c\u7ed3\u679c\uff1a {'_id': ObjectId('5c6b659b1607c47f8abe6ab7'), 'name': '\u5f20\u4e09', 'age': '25'} \u5f53\u7136\u5982\u679c\u67e5\u8be2\u7ed3\u679c\u4e0d\u5b58\u5728\u5219\u4f1a\u8fd4\u56deNone. 2.5.2 find() \u00b6 find()\u5219\u8fd4\u56de\u591a\u4e2a\u7ed3\u679c\u3002\u5bf9\u4e8e\u591a\u6761\u6570\u636e\u7684\u67e5\u8be2\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528find()\u65b9\u6cd5\uff0c\u4f8b\u5982\u5728\u8fd9\u91cc\u67e5\u627e\u5e74\u9f84\u4e3a25\u7684\u6570\u636e\uff0c results = collection.find({'age': '25'}) print(results) for result in results: print(result) \u7ed3\u679c\u662f: {'_id': ObjectId('5c6b659b1607c47f8abe6ab7'), 'name': '\u5f20\u4e09', 'age': '25'} {'_id': ObjectId('5c6b65c01607c47f8abe6ab8'), 'name': '\u5c0f\u660e', 'age': '25'} {'_id': ObjectId('5c6b65df1607c47f8abe6aba'), 'name': '\u674e\u56db', 'age': '25'} {'_id': ObjectId('5c6b66081607c47f8abe6abb'), 'name': '\u738b\u4e94', 'age': '25'} \u8fd4\u56de\u7ed3\u679c\u662fCursor\u7c7b\u578b\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u751f\u6210\u5668\uff0c\u6211\u4eec\u9700\u8981\u904d\u5386\u53d6\u5230\u6240\u6709\u7684\u7ed3\u679c\uff0c\u6bcf\u4e00\u4e2a\u7ed3\u679c\u90fd\u662f\u5b57\u5178\u7c7b\u578b\u3002 \u5982\u679c\u8981\u67e5\u8be2\u5e74\u9f84\u5927\u4e8e20\u7684\u6570\u636e\uff0c\u5219\u5199\u6cd5\u5982\u4e0b\uff1a results = collection.find({'age': {'$gt': '20'}}) \u6d4b\u8bd5 In [38]: results = collection.find({'age': {'$gt': '20'}}) In [39]: for data in results: ...: print(data) ...: {'_id': ObjectId('5c6b659b1607c47f8abe6ab7'), 'name': '\u5f20\u4e09', 'age': '25'} {'_id': ObjectId('5c6b65c01607c47f8abe6ab8'), 'name': '\u5c0f\u660e', 'age': '25'} {'_id': ObjectId('5c6b65c01607c47f8abe6ab9'), 'name': '\u5c0f\u5f3a', 'age': '24'} {'_id': ObjectId('5c6b65df1607c47f8abe6aba'), 'name': '\u674e\u56db', 'age': '25'} {'_id': ObjectId('5c6b66081607c47f8abe6abb'), 'name': '\u738b\u4e94', 'age': '25'} {'_id': ObjectId('5c6b66081607c47f8abe6abc'), 'name': '\u8d75\u516d', 'age': '24'} \u5728\u8fd9\u91cc\u67e5\u8be2\u7684\u6761\u4ef6\u952e\u503c\u5df2\u7ecf\u4e0d\u662f\u5355\u7eaf\u7684\u6570\u5b57\u4e86\uff0c\u800c\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5176\u952e\u540d\u4e3a\u6bd4\u8f83\u7b26\u53f7$gt\uff0c\u610f\u601d\u662f\u5927\u4e8e\uff0c\u952e\u503c\u4e3a20\uff0c\u8fd9\u6837\u4fbf\u53ef\u4ee5\u67e5\u8be2\u51fa\u6240\u6709\u5e74\u9f84\u5927\u4e8e20\u7684\u6570\u636e\u3002 2.5.3 \u6bd4\u8f83\u7b26\u53f7 \u00b6 \u5728\u8fd9\u91cc\u5c06\u6bd4\u8f83\u7b26\u53f7\u5f52\u7eb3\u5982\u4e0b\u8868\uff1a \u7b26\u53f7 \u542b\u4e49 \u4f8b\u5b50 $lt \u5c0f\u4e8e {'age': {'$lt': 20}} $gt \u5927\u4e8e {'age': {'$gt': 20}} $lte \u5c0f\u4e8e\u7b49\u4e8e {'age': {'$lte': 20}} $gte \u5927\u4e8e\u7b49\u4e8e {'age': {'$gte': 20}} $ne \u4e0d\u7b49\u4e8e {'age': {'$ne': 20}} $in \u5728\u8303\u56f4\u5185 {'age': {'$in': [20, 23]}} $nin \u4e0d\u5728\u8303\u56f4\u5185 {'age': {'$nin': [20, 23]}} \u53e6\u5916\u8fd8\u53ef\u4ee5\u8fdb\u884c\u6b63\u5219\u5339\u914d\u67e5\u8be2\uff0c\u4f8b\u5982\u67e5\u8be2\u540d\u5b57\u4ee5M\u5f00\u5934\u7684\u5b66\u751f\u6570\u636e\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a results = collection.find({'name': {'$regex': '^M.*'}}) \u5728\u8fd9\u91cc\u4f7f\u7528\u4e86$regex\u6765\u6307\u5b9a\u6b63\u5219\u5339\u914d\uff0c^M.*\u4ee3\u8868\u4ee5M\u5f00\u5934\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u67e5\u8be2\u6240\u6709\u7b26\u5408\u8be5\u6b63\u5219\u7684\u7ed3\u679c\u3002 2.5.4 \u529f\u80fd\u7b26\u53f7 \u00b6 \u5728\u8fd9\u91cc\u5c06\u4e00\u4e9b\u529f\u80fd\u7b26\u53f7\u518d\u5f52\u7c7b\u5982\u4e0b\uff1a \u7b26\u53f7 \u542b\u4e49 \u4f8b\u5b50 \u4f8b\u5b50\u542b\u4e49 $regex \u5339\u914d\u6b63\u5219 {'name': {'$regex': '^M.*'}} name\u4ee5M\u5f00\u5934 $exists \u5c5e\u6027\u662f\u5426\u5b58\u5728 {'name': {'$exists': True}} name\u5c5e\u6027\u5b58\u5728 $type \u7c7b\u578b\u5224\u65ad {'age': {'$type': 'int'}} age\u7684\u7c7b\u578b\u4e3aint $mod \u6570\u5b57\u6a21\u64cd\u4f5c {'age': {'$mod': [5, 0]}} \u5e74\u9f84\u6a215\u4f590 $text \u6587\u672c\u67e5\u8be2 {' text': {' text': {' search': 'Mike'}} text\u7c7b\u578b\u7684\u5c5e\u6027\u4e2d\u5305\u542bMike\u5b57\u7b26\u4e32 $where \u9ad8\u7ea7\u6761\u4ef6\u67e5\u8be2 {'$where': 'obj.fans_count == obj.follows_count'} \u81ea\u8eab\u7c89\u4e1d\u6570\u7b49\u4e8e\u5173\u6ce8\u6570 \u8fd9\u4e9b\u64cd\u4f5c\u7684\u66f4\u8be6\u7ec6\u7528\u6cd5\u5728\u53ef\u4ee5\u5728MongoDB\u5b98\u65b9\u6587\u6863\u627e\u5230\uff1a https://docs.mongodb.com/manual/reference/operator/query/ 2.5 \u8ba1\u6570 \u00b6 \u8981\u7edf\u8ba1\u67e5\u8be2\u7ed3\u679c\u6709\u591a\u5c11\u6761\u6570\u636e\uff0c\u53ef\u4ee5\u8c03\u7528count()\u65b9\u6cd5\uff0c\u5982\u7edf\u8ba1\u6240\u6709\u6570\u636e\u6761\u6570\uff1a In [40]: count = collection.find().count() In [41]: print(count) 6 \u6216\u8005\u7edf\u8ba1\u7b26\u5408\u67d0\u4e2a\u6761\u4ef6\u7684\u6570\u636e\uff1a In [43]: count = collection.find({'age': '25'}).count() In [44]: print(count) 4 2.6 \u6392\u5e8f \u00b6 \u53ef\u4ee5\u8c03\u7528sort\u65b9\u6cd5\uff0c\u4f20\u5165\u6392\u5e8f\u7684\u5b57\u6bb5\u53ca\u5347\u964d\u5e8f\u6807\u5fd7\u5373\u53ef\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a In [45]: results = collection.find().sort('name', pymongo.ASCENDING) In [46]: print([result['name'] for result in results]) ['\u5c0f\u5f3a', '\u5c0f\u660e', '\u5f20\u4e09', '\u674e\u56db', '\u738b\u4e94', '\u8d75\u516d'] 2.7 \u504f\u79fb \u00b6 \u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u6211\u4eec\u53ef\u80fd\u60f3\u53ea\u53d6\u67d0\u51e0\u4e2a\u5143\u7d20\uff0c\u5728\u8fd9\u91cc\u53ef\u4ee5\u5229\u7528skip()\u65b9\u6cd5\u504f\u79fb\u51e0\u4e2a\u4f4d\u7f6e\uff0c\u6bd4\u5982\u504f\u79fb2\uff0c\u5c31\u5ffd\u7565\u524d2\u4e2a\u5143\u7d20\uff0c\u5f97\u5230\u7b2c\u4e09\u4e2a\u53ca\u4ee5\u540e\u7684\u5143\u7d20\u3002 In [47]: results = collection.find().sort('name', pymongo.ASCENDING).skip(2) In [48]: print([result['name'] for result in results]) ['\u5f20\u4e09', '\u674e\u56db', '\u738b\u4e94', '\u8d75\u516d'] 2.8 limit \u00b6 \u53ef\u4ee5\u7528limit()\u65b9\u6cd5\u6307\u5b9a\u8981\u53d6\u7684\u7ed3\u679c\u4e2a\u6570\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a In [49]: results = collection.find().sort('name', pymongo.ASCENDING).skip(2).limit(2) In [50]: print([result['name'] for result in results]) ['\u5f20\u4e09', '\u674e\u56db'] \u5982\u679c\u4e0d\u52a0limit()\u539f\u672c\u4f1a\u8fd4\u56de\u4e09\u4e2a\u7ed3\u679c\uff0c\u52a0\u4e86\u9650\u5236\u4e4b\u540e\uff0c\u4f1a\u622a\u53d62\u4e2a\u7ed3\u679c\u8fd4\u56de\u3002 \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u5728\u6570\u636e\u5e93\u6570\u91cf\u975e\u5e38\u5e9e\u5927\u7684\u65f6\u5019\uff0c\u5982\u5343\u4e07\u3001\u4ebf\u7ea7\u522b\uff0c\u6700\u597d\u4e0d\u8981\u4f7f\u7528\u5927\u7684\u504f\u79fb\u91cf\u6765\u67e5\u8be2\u6570\u636e\uff0c\u5f88\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\u3002\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3cfind({'_id': {'$gt': ObjectId('593278c815c2602678bb2b8d')}}) \u8fd9\u6837\u7684\u65b9\u6cd5\u6765\u67e5\u8be2\uff0c\u8bb0\u5f55\u597d\u4e0a\u6b21\u67e5\u8be2\u7684_id\u3002 2.9 \u66f4\u65b0 \u00b6 2.9.1 update \u00b6 \u5bf9\u4e8e\u6570\u636e\u66f4\u65b0\u53ef\u4ee5\u4f7f\u7528update()\u65b9\u6cd5\uff0c\u6307\u5b9a\u66f4\u65b0\u7684\u6761\u4ef6\u548c\u66f4\u65b0\u540e\u7684\u6570\u636e\u5373\u53ef\uff0c\u4f8b\u5982\uff1a \u6ca1\u4fee\u6539\u4e4b\u524d > db.informations.find() { \"_id\" : ObjectId(\"5c6b659b1607c47f8abe6ab7\"), \"name\" : \"\u5f20\u4e09\", \"age\" : \"25\" } { \"_id\" : ObjectId(\"5c6b65c01607c47f8abe6ab8\"), \"name\" : \"\u5c0f\u660e\", \"age\" : \"25\" } { \"_id\" : ObjectId(\"5c6b65c01607c47f8abe6ab9\"), \"name\" : \"\u5c0f\u5f3a\", \"age\" : \"24\" } { \"_id\" : ObjectId(\"5c6b65df1607c47f8abe6aba\"), \"name\" : \"\u674e\u56db\", \"age\" : \"25\" } { \"_id\" : ObjectId(\"5c6b66081607c47f8abe6abb\"), \"name\" : \"\u738b\u4e94\", \"age\" : \"25\" } { \"_id\" : ObjectId(\"5c6b66081607c47f8abe6abc\"), \"name\" : \"\u8d75\u516d\", \"age\" : \"24\" } In [51]: condition = {'name': '\u5f20\u4e09'} In [52]: user = collection.find_one(condition) In [53]: user['age']=20 In [54]: result = collection.update(condition, user) /usr/local/bin/ipython:1: DeprecationWarning: update is deprecated. Use replace_one, update_one or update_many instead. #!/usr/local/bin/python3.6 In [55]: print(result) {'ok': 1, 'nModified': 1, 'n': 1, 'updatedExisting': True} \u4fee\u6539\u4e4b\u540e > db.informations.find() { \"_id\" : ObjectId(\"5c6b659b1607c47f8abe6ab7\"), \"name\" : \"\u5f20\u4e09\", \"age\" : 20 } { \"_id\" : ObjectId(\"5c6b65c01607c47f8abe6ab8\"), \"name\" : \"\u5c0f\u660e\", \"age\" : \"25\" } { \"_id\" : ObjectId(\"5c6b65c01607c47f8abe6ab9\"), \"name\" : \"\u5c0f\u5f3a\", \"age\" : \"24\" } { \"_id\" : ObjectId(\"5c6b65df1607c47f8abe6aba\"), \"name\" : \"\u674e\u56db\", \"age\" : \"25\" } { \"_id\" : ObjectId(\"5c6b66081607c47f8abe6abb\"), \"name\" : \"\u738b\u4e94\", \"age\" : \"25\" } { \"_id\" : ObjectId(\"5c6b66081607c47f8abe6abc\"), \"name\" : \"\u8d75\u516d\", \"age\" : \"24\" } \u8fd4\u56de\u7ed3\u679c\u662f\u5b57\u5178\u5f62\u5f0f\uff0cok\u5373\u4ee3\u8868\u6267\u884c\u6210\u529f\uff0cnModified\u4ee3\u8868\u5f71\u54cd\u7684\u6570\u636e\u6761\u6570\u3002 \u53e6\u5916update()\u65b9\u6cd5\u5176\u5b9e\u4e5f\u662f\u5b98\u65b9\u4e0d\u63a8\u8350\u4f7f\u7528\u7684\u65b9\u6cd5\uff0c\u5728\u8fd9\u91cc\u4e5f\u5206\u4e86update_one()\u65b9\u6cd5\u548cupdate_many()\u65b9\u6cd5\uff0c\u7528\u6cd5\u66f4\u52a0\u4e25\u683c\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u9700\u8981\u4f7f\u7528$\u7c7b\u578b\u64cd\u4f5c\u7b26\u4f5c\u4e3a\u5b57\u5178\u7684\u952e\u540d\uff0c\u6211\u4eec\u7528\u793a\u4f8b\u611f\u53d7\u4e00\u4e0b\u3002 2.9.2 update_one \u00b6 condition = {'name': '\u674e\u56db'} user = collection.find_one(condition) user['age'] = 26 result = collection.update_one(condition, {'$set': user}) print(result) print(result.matched_count, result.modified_count) \u5728\u8fd9\u91cc\u8c03\u7528\u4e86update_one\u65b9\u6cd5\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e0d\u80fd\u518d\u76f4\u63a5\u4f20\u5165\u4fee\u6539\u540e\u7684\u5b57\u5178\uff0c\u800c\u662f\u9700\u8981\u4f7f\u7528{'$set': user}\u8fd9\u6837\u7684\u5f62\u5f0f\uff0c\u5176\u8fd4\u56de\u7ed3\u679c\u662fUpdateResult\u7c7b\u578b\uff0c\u7136\u540e\u8c03\u7528matched_count\u548cmodified_count\u5c5e\u6027\u5206\u522b\u53ef\u4ee5\u83b7\u5f97\u5339\u914d\u7684\u6570\u636e\u6761\u6570\u548c\u5f71\u54cd\u7684\u6570\u636e\u6761\u6570\u3002 \u518d\u770b\u4e00\u4e2a\u4f8b\u5b50 condition = {'age': {'$gt': 20}} result = collection.update_one(condition, {'$inc': {'age': 1}}) print(result) print(result.matched_count, result.modified_count) \u5728\u8fd9\u91cc\u6211\u4eec\u6307\u5b9a\u67e5\u8be2\u6761\u4ef6\u4e3a\u5e74\u9f84\u5927\u4e8e20\uff0c\u7136\u540e\u66f4\u65b0\u6761\u4ef6\u4e3a{'$inc': {'age': 1}} \uff0c\u4e5f\u5c31\u662f\u5e74\u9f84\u52a01\uff0c\u6267\u884c\u4e4b\u540e\u4f1a\u8bb2\u7b2c\u4e00\u6761\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\u5e74\u9f84\u52a01\u3002 2.9.3 update_many \u00b6 \u5982\u679c\u8c03\u7528update_many()\u65b9\u6cd5\uff0c\u5219\u4f1a\u5c06\u6240\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\u90fd\u66f4\u65b0\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a condition = {'age': {'$gt': 20}} result = collection.update_many(condition, {'$inc': {'age': 1}}) print(result) print(result.matched_count, result.modified_count) 2.10 \u5220\u9664 \u00b6 2.10.1 remove \u00b6 \u5220\u9664\u64cd\u4f5c\u6bd4\u8f83\u7b80\u5355\uff0c\u76f4\u63a5\u8c03\u7528remove()\u65b9\u6cd5\u6307\u5b9a\u5220\u9664\u7684\u6761\u4ef6\u5373\u53ef\uff0c\u7b26\u5408\u6761\u4ef6\u7684\u6240\u6709\u6570\u636e\u5747\u4f1a\u88ab\u5220\u9664\uff0c\u793a\u4f8b\u5982\u4e0b result = collection.remove({'name': '\u738b\u4e94'}) print(result) \u8fd0\u884c n [66]: result = collection.remove({'name': '\u738b\u4e94'}) /usr/local/bin/ipython:1: DeprecationWarning: remove is deprecated. Use delete_one or delete_many instead. #!/usr/local/bin/python3.6 In [67]: print(result) {'ok': 1, 'n': 1} \u53e6\u5916\u4f9d\u7136\u5b58\u5728\u4e24\u4e2a\u65b0\u7684\u63a8\u8350\u65b9\u6cd5\uff0cdelete_one()\u548cdelete_many()\u65b9\u6cd5. 2.10.2 delete_one \u00b6 result = collection.delete_one({'name': '\u8d75\u516d'}) print(result) print(result.deleted_count) \u8fc7\u7a0b In [68]: result = collection.delete_one({'name': '\u8d75\u516d'}) In [69]: print(result) <pymongo.results.DeleteResult object at 0x7f3d00039188> In [70]: print(result.deleted_count) 1 2.10.3 delete_many \u00b6 result = collection.delete_many({'age': {'$lt': 10}}) print(result.deleted_count) delete_one()\u5373\u5220\u9664\u7b2c\u4e00\u6761\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\uff0cdelete_many()\u5373\u5220\u9664\u6240\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\uff0c\u8fd4\u56de\u7ed3\u679c\u662fDeleteResult\u7c7b\u578b\uff0c\u53ef\u4ee5\u8c03\u7528deleted_count\u5c5e\u6027\u83b7\u53d6\u5220\u9664\u7684\u6570\u636e\u6761\u6570\u3002 2.10.4 \u66f4\u591a \u00b6 \u53e6\u5916PyMongo\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7ec4\u5408\u65b9\u6cd5\uff0c\u5982find_one_and_delete() \u3001find_one_and_replace() \u3001find_one_and_update() \uff0c\u5c31\u662f\u67e5\u627e\u540e\u5220\u9664\u3001\u66ff\u6362\u3001\u66f4\u65b0\u64cd\u4f5c\uff0c\u7528\u6cd5\u4e0e\u4e0a\u8ff0\u65b9\u6cd5\u57fa\u672c\u4e00\u81f4\u3002 \u53e6\u5916\u8fd8\u53ef\u4ee5\u5bf9\u7d22\u5f15\u8fdb\u884c\u64cd\u4f5c\uff0c\u5982create_index() \u3001create_indexes() \u3001drop_index()\u7b49\u3002 \u8be6\u7ec6\u7528\u6cd5\u53ef\u4ee5\u53c2\u89c1\u5b98\u65b9\u6587\u6863\uff1a http://api.mongodb.com/python/current/api/pymongo/collection.html \u53e6\u5916\u8fd8\u6709\u5bf9\u6570\u636e\u5e93\u3001\u96c6\u5408\u672c\u8eab\u4ee5\u53ca\u5176\u4ed6\u7684\u4e00\u4e9b\u64cd\u4f5c\uff0c\u5728\u8fd9\u4e0d\u518d\u4e00\u4e00\u8bb2\u89e3\uff0c\u53ef\u4ee5\u53c2\u89c1\u5b98\u65b9\u6587\u6863\uff1a http://api.mongodb.com/python/current/api/pymongo/ 2.11 code \u00b6 #!/usr/bin/env python # -*- coding: utf-8 -*- import pymongo import datetime def get_db(): # \u5efa\u7acb\u8fde\u63a5 client = pymongo.MongoClient(host=\"127.0.0.1\", port=27017) # host \u6307\u5b9a\u8981\u94fe\u63a5\u7684mongo server\u7684\u4e3b\u673a\u3002port\u662f\u7aef\u53e3 db = client['test_mongo_db'] #\u6216\u8005 db = client.test_mongo_db return db def get_collection(db): # \u9009\u62e9\u96c6\u5408(mongo\u4e2dcollection\u548cdatabase\u90fd\u662f\u5ef6\u65f6\u521b\u5efa\u7684) coll = db['informations'] print (db.collection_names()) return coll def insert_one_doc(db): # \u63d2\u5165\u4e00\u4e2adocument coll = db['informations'] information = {\"name\": \"summer\", \"age\": \"25\"} information_id = coll.insert(information) print(information_id) def insert_multi_docs(db): # \u6279\u91cf\u63d2\u5165documents,\u63d2\u5165\u4e00\u4e2a\u6570\u7ec4 coll = db['informations'] information = [{\"name\": \"\u5c0f\u660e\", \"age\": \"25\"}, {\"name\": \"\u5c0f\u5f3a\", \"age\": \"24\"}] information_id = coll.insert(information) print(information_id) def get_one_doc(db): # \u6709\u5c31\u8fd4\u56de\u4e00\u4e2a\uff0c\u6ca1\u6709\u5c31\u8fd4\u56deNone coll = db['informations'] print(coll.find_one()) # \u8fd4\u56de\u7b2c\u4e00\u6761\u8bb0\u5f55 print(coll.find_one({\"name\": \"summer\"})) print(coll.find_one({\"name\": \"none\"})) def get_one_by_id(db): # \u901a\u8fc7objectid\u6765\u67e5\u627e\u4e00\u4e2adoc coll = db['informations'] obj = coll.find_one() obj_id = obj[\"_id\"] print(\"_id \u4e3aObjectId\u7c7b\u578b\uff0cobj_id:\" + str(obj_id)) print(coll.find_one({\"_id\": obj_id})) # \u9700\u8981\u6ce8\u610f\u8fd9\u91cc\u7684obj_id\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4e0d\u662f\u4e00\u4e2astr\uff0c\u4f7f\u7528str\u7c7b\u578b\u4f5c\u4e3a_id\u7684\u503c\u65e0\u6cd5\u627e\u5230\u8bb0\u5f55 print(\"_id \u4e3astr\u7c7b\u578b \") print(coll.find_one({\"_id\": str(obj_id)})) # \u53ef\u4ee5\u901a\u8fc7ObjectId\u65b9\u6cd5\u628astr\u8f6c\u6210ObjectId\u7c7b\u578b from bson.objectid import ObjectId print (\"_id \u8f6c\u6362\u6210ObjectId\u7c7b\u578b\") print (coll.find_one({\"_id\": ObjectId(str(obj_id))})) def get_many_docs(db): # mongo\u4e2d\u63d0\u4f9b\u4e86\u8fc7\u6ee4\u67e5\u627e\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u901a\u8fc7\u5404\u79cd\u6761\u4ef6\u7b5b\u9009\u6765\u83b7\u53d6\u6570\u636e\u96c6\uff0c\u8fd8\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u8ba1\u6570\uff0c\u6392\u5e8f\u7b49\u5904\u7406 coll = db['informations'] # ASCENDING = 1 \u5347\u5e8f;DESCENDING = -1\u964d\u5e8f;default is ASCENDING for item in coll.find().sort(\"age\", pymongo.DESCENDING): print(item) count = coll.count() print (\"\u96c6\u5408\u4e2d\u6240\u6709\u6570\u636e %s\u4e2a\" % int(count)) # \u6761\u4ef6\u67e5\u8be2 count = coll.find({\"name\":\"summer\"}).count() print (\"summer: %s\"%count) def clear_all_datas(db): # \u6e05\u7a7a\u4e00\u4e2a\u96c6\u5408\u4e2d\u7684\u6240\u6709\u6570\u636e db[\"informations\"].remove() if __name__ == '__main__': db = get_db() my_collection = get_collection(db) post = {\"author\": \"Mike\", \"text\": \"My first blog post!\", \"tags\": [\"mongodb\", \"python\", \"pymongo\"], \"date\": datetime.datetime.utcnow()} # \u63d2\u5165\u8bb0\u5f55 my_collection.insert(post) insert_one_doc(db) # \u6761\u4ef6\u67e5\u8be2 print (my_collection.find_one({\"x\": \"10\"})) # \u67e5\u8be2\u8868\u4e2d\u6240\u6709\u7684\u6570\u636e for data in my_collection.find(): print(data) print (my_collection.count()) my_collection.update({\"author\": \"Mike\"}, {\"author\": \"summer\", \"text\": \"My first blog post!\", \"tags\": [\"mongodb\", \"python\", \"pymongo\"], \"date\": datetime.datetime.utcnow()}) for data in my_collection.find(): print (data) get_one_doc(db) get_one_by_id(db) get_many_docs(db) # clear_all_datas(db)","title":"1. mongo"},{"location":"python/lib/nosql/mongo/mongo.index/#1","text":"MongoDB \u662f\u76ee\u524d\u6700\u6d41\u884c\u7684 NoSQL \u6570\u636e\u5e93\u4e4b\u4e00\uff0c\u4f7f\u7528\u7684\u6570\u636e\u7c7b\u578b BSON\uff08\u7c7b\u4f3c JSON\uff09\u3002 Python \u8981\u8fde\u63a5 MongoDB \u9700\u8981 MongoDB \u9a71\u52a8\uff0c\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 PyMongo \u9a71\u52a8\u6765\u8fde\u63a5\u3002","title":"1. \u4ecb\u7ecd"},{"location":"python/lib/nosql/mongo/mongo.index/#11","text":"pip \u662f\u4e00\u4e2a\u901a\u7528\u7684 Python \u5305\u7ba1\u7406\u5de5\u5177\uff0c\u63d0\u4f9b\u4e86\u5bf9 Python \u5305\u7684\u67e5\u627e\u3001\u4e0b\u8f7d\u3001\u5b89\u88c5\u3001\u5378\u8f7d\u7684\u529f\u80fd\u3002 python3 -m pip3 install pymongo \u4e5f\u53ef\u4ee5\u6307\u5b9a\u5b89\u88c5\u7684\u7248\u672c: python3 -m pip3 install pymongo==3.5.1 \u66f4\u65b0 pymongo \u547d\u4ee4\uff1a python3 -m pip3 install --upgrade pymongo \u65e7\u7248\u7684 Python \u53ef\u4ee5\u4f7f\u7528 easy_install \u6765\u5b89\u88c5\uff0ceasy_install \u4e5f\u662f Python \u5305\u7ba1\u7406\u5de5\u5177\u3002 python -m easy_install pymongo \u66f4\u65b0 pymongo \u547d\u4ee4\uff1a python -m easy_install -U pymongo","title":"1.1 \u5b89\u88c5"},{"location":"python/lib/nosql/mongo/mongo.index/#12-pymongo","text":"\u63a5\u4e0b\u6765\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6d4b\u8bd5\u6587\u4ef6 test_mongodb.py\uff0c\u4ee3\u7801\u5982\u4e0b root@leco:/home/leco# cat test_mongodb.py #!/usr/bin/python3 import pymongo root@leco:/home/leco# python3 test_mongodb.py root@leco:/home/leco# echo $? 0 \u6267\u884c\u4ee5\u4e0a\u4ee3\u7801\u6587\u4ef6\uff0c\u5982\u679c\u6ca1\u6709\u51fa\u73b0\u9519\u8bef\uff0c\u8868\u793a\u5b89\u88c5\u6210\u529f\u3002","title":"1.2 \u6d4b\u8bd5pymongo"},{"location":"python/lib/nosql/mongo/mongo.index/#2","text":"","title":"2. \u8be6\u7ec6"},{"location":"python/lib/nosql/mongo/mongo.index/#21-mongodb","text":"\u8fde\u63a5MongoDB\u6211\u4eec\u9700\u8981\u4f7f\u7528PyMongo\u5e93\u91cc\u9762\u7684MongoClient\uff0c\u4e00\u822c\u6765\u8bf4\u4f20\u5165MongoDB\u7684IP\u53ca\u7aef\u53e3\u5373\u53ef\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u5730\u5740host\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u7aef\u53e3port\uff0c\u7aef\u53e3\u5982\u679c\u4e0d\u4f20\u9ed8\u8ba4\u662f27017\u3002 import pymongo client = pymongo.MongoClient(host='localhost', port=27017) \u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2aMongoDB\u7684\u8fde\u63a5\u5bf9\u8c61\u4e86\u3002 \u53e6\u5916MongoClient\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570host\u8fd8\u53ef\u4ee5\u76f4\u63a5\u4f20MongoDB\u7684\u8fde\u63a5\u5b57\u7b26\u4e32\uff0c\u4ee5mongodb\u5f00\u5934\uff0c\u4f8b\u5982\uff1a client = MongoClient('mongodb://localhost:27017/') \u53ef\u4ee5\u8fbe\u5230\u540c\u6837\u7684\u8fde\u63a5\u6548\u679c\u3002","title":"2.1 \u8fde\u63a5MongoDB"},{"location":"python/lib/nosql/mongo/mongo.index/#22","text":"MongoDB\u4e2d\u8fd8\u5206\u4e3a\u4e00\u4e2a\u4e2a\u6570\u636e\u5e93\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u7684\u4e00\u6b65\u5c31\u662f\u6307\u5b9a\u8981\u64cd\u4f5c\u54ea\u4e2a\u6570\u636e\u5e93\uff0c\u5728\u8fd9\u91cc\u6211\u4ee5test_mongo_db\u6570\u636e\u5e93\u4e3a\u4f8b\u8fdb\u884c\u8bf4\u660e\uff0c\u6240\u4ee5\u4e0b\u4e00\u6b65\u6211\u4eec\u9700\u8981\u5728\u7a0b\u5e8f\u4e2d\u6307\u5b9a\u8981\u4f7f\u7528\u7684\u6570\u636e\u5e93\u3002\u8c03\u7528client\u7684test_mongo_db\u5c5e\u6027\u5373\u53ef\u8fd4\u56detest_mongo_db\u6570\u636e\u5e93\u3002 db = client.test_mongo_db \u6216\u8005 db = client['test_mongo_db']","title":"2.2 \u6307\u5b9a\u6570\u636e\u5e93"},{"location":"python/lib/nosql/mongo/mongo.index/#23","text":"MongoDB\u7684\u6bcf\u4e2a\u6570\u636e\u5e93\u53c8\u5305\u542b\u4e86\u8bb8\u591a\u96c6\u5408Collection\uff0c\u4e5f\u5c31\u7c7b\u4f3c\u4e0e\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u7684\u8868\uff0c\u4e0b\u4e00\u6b65\u6211\u4eec\u9700\u8981\u6307\u5b9a\u8981\u64cd\u4f5c\u7684\u96c6\u5408\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u6307\u5b9a\u4e00\u4e2a\u96c6\u5408\u540d\u79f0\u4e3ainformations\uff0cinformations\u96c6\u5408\u3002\u8fd8\u662f\u548c\u6307\u5b9a\u6570\u636e\u5e93\u7c7b\u4f3c\uff0c\u6307\u5b9a\u96c6\u5408\u4e5f\u6709\u4e24\u79cd\u65b9\u5f0f: collection = db.informations \u6216\u8005 collection = db['informations']","title":"2.3 \u6307\u5b9a\u96c6\u5408"},{"location":"python/lib/nosql/mongo/mongo.index/#24","text":"","title":"2.4 \u63d2\u5165\u6570\u636e"},{"location":"python/lib/nosql/mongo/mongo.index/#241","text":"\u63a5\u4e0b\u6765\u6211\u4eec\u4fbf\u53ef\u4ee5\u8fdb\u884c\u6570\u636e\u63d2\u5165\u4e86\uff0c\u5bf9\u4e8einformations\u8fd9\u4e2aCollection\uff0c\u6211\u4eec\u65b0\u5efa\u4e00\u6761\u6570\u636e\uff0c\u4ee5\u5b57\u5178\u7684\u5f62\u5f0f\u8868\u793a\uff1a information = {\"name\": \"\u5f20\u4e09\", \"age\": \"25\"} \u5728\u8fd9\u91cc\u6211\u4eec\u6307\u5b9a\u4e86\u59d3\u540d\u3001\u5e74\u9f84\u7136\u540e\u63a5\u4e0b\u6765\u76f4\u63a5\u8c03\u7528collection\u7684insert()\u65b9\u6cd5\u5373\u53ef\u63d2\u5165\u6570\u636e\u3002 result = collection.insert(information) print(result) \u5728MongoDB\u4e2d\uff0c\u6bcf\u6761\u6570\u636e\u5176\u5b9e\u90fd\u6709\u4e00\u4e2a_id\u5c5e\u6027\u6765\u552f\u4e00\u6807\u8bc6\uff0c\u5982\u679c\u6ca1\u6709\u663e\u5f0f\u6307\u660e_id\uff0cMongoDB\u4f1a\u81ea\u52a8\u4ea7\u751f\u4e00\u4e2aObjectId\u7c7b\u578b\u7684_id\u5c5e\u6027\u3002insert()\u65b9\u6cd5\u4f1a\u5728\u6267\u884c\u540e\u8fd4\u56de\u7684_id\u503c\u3002\u8fd0\u884c\u7ed3\u679c\uff1a 5c6b659b1607c47f8abe6ab7","title":"2.4.1 \u5355\u6761\u63d2\u5165"},{"location":"python/lib/nosql/mongo/mongo.index/#242","text":"\u5f53\u7136\u6211\u4eec\u4e5f\u53ef\u4ee5\u540c\u65f6\u63d2\u5165\u591a\u6761\u6570\u636e\uff0c\u53ea\u9700\u8981\u4ee5\u5217\u8868\u5f62\u5f0f\u4f20\u9012\u5373\u53ef\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a information = [{\"name\": \"\u5c0f\u660e\", \"age\": \"25\"}, {\"name\": \"\u5c0f\u5f3a\", \"age\": \"24\"}] information_id = collection.insert(information) print(information_id) \u6216\u8005 xiaoming={\"name\": \"\u5c0f\u660e\", \"age\": \"25\"} xiaoqiang= {\"name\": \"\u5c0f\u5f3a\", \"age\": \"24\"} information_id = collection.insert([xiaoming,xiaoqiang]) print(information_id) \u8fd4\u56de\u7684\u7ed3\u679c\u662f\u5bf9\u5e94\u7684_id\u7684\u96c6\u5408\uff0c\u8fd0\u884c\u7ed3\u679c\uff1a [ObjectId('5c6b65c01607c47f8abe6ab8'), ObjectId('5c6b65c01607c47f8abe6ab9')]","title":"2.4.2 \u591a\u6761\u63d2\u5165"},{"location":"python/lib/nosql/mongo/mongo.index/#243","text":"\u5b9e\u9645\u4e0a\u5728PyMongo 3.X\u7248\u672c\u4e2d\uff0cinsert()\u65b9\u6cd5\u5b98\u65b9\u5df2\u7ecf\u4e0d\u63a8\u8350\u4f7f\u7528\u4e86\uff0c\u5f53\u7136\u7ee7\u7eed\u4f7f\u7528\u4e5f\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u5b98\u65b9\u63a8\u8350\u4f7f\u7528insert_one()\u548cinsert_many()\u65b9\u6cd5\u5c06\u63d2\u5165\u5355\u6761\u548c\u591a\u6761\u8bb0\u5f55\u5206\u5f00\u3002 lisi = {\"name\": \"\u674e\u56db\", \"age\": \"25\"} result = collection.insert_one(lisi) print(result.inserted_id) \u8fd4\u56de\u7ed3\u679c\u548cinsert()\u65b9\u6cd5\u4e0d\u540c\uff0c\u8fd9\u6b21\u8fd4\u56de\u7684\u662fInsertOneResult\u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u7528\u5176inserted_id\u5c5e\u6027\u83b7\u53d6_id\u3002\u7ed3\u679c\u662f 5c6b65df1607c47f8abe6aba","title":"2.4.3 \u65b0\u5355\u6761\u63d2\u5165"},{"location":"python/lib/nosql/mongo/mongo.index/#244","text":"\u5bf9\u4e8einsert_many()\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6570\u636e\u4ee5\u5217\u8868\u5f62\u5f0f\u4f20\u9012\u5373\u53ef\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a wangwu={\"name\": \"\u738b\u4e94\", \"age\": \"25\"} zhaoliu= {\"name\": \"\u8d75\u516d\", \"age\": \"24\"} result = collection.insert_many([wangwu,zhaoliu]) print(result) print(result.inserted_ids) \u7ed3\u679c\u662f: <pymongo.results.InsertManyResult object at 0x7f3cf2dc68c8> [ObjectId('5c6b66081607c47f8abe6abb'), ObjectId('5c6b66081607c47f8abe6abc')] insert_many()\u65b9\u6cd5\u8fd4\u56de\u7684\u7c7b\u578b\u662fInsertManyResult\uff0c\u8c03\u7528inserted_ids\u5c5e\u6027\u53ef\u4ee5\u83b7\u53d6\u63d2\u5165\u6570\u636e\u7684_id\u5217\u8868.","title":"2.4.4 \u65b0\u591a\u6761\u63d2\u5165"},{"location":"python/lib/nosql/mongo/mongo.index/#25","text":"","title":"2.5 \u67e5\u8be2\u6570\u636e"},{"location":"python/lib/nosql/mongo/mongo.index/#251-find_one","text":"\u63d2\u5165\u6570\u636e\u540e\u6211\u4eec\u53ef\u4ee5\u5229\u7528find_one(),find_one()\u67e5\u8be2\u5f97\u5230\u662f\u5355\u4e2a\u7ed3\u679c\u3002 result = collection.find_one({'name': '\u5f20\u4e09'}) print(type(result)) print(result) \u7ed3\u679c\u662f: <class 'dict'> {'_id': ObjectId('5c6b659b1607c47f8abe6ab7'), 'name': '\u5f20\u4e09', 'age': '25'} \u53ef\u4ee5\u53d1\u73b0\u5b83\u591a\u4e86\u4e00\u4e2a_id\u5c5e\u6027\uff0c\u8fd9\u5c31\u662fMongoDB\u5728\u63d2\u5165\u7684\u8fc7\u7a0b\u4e2d\u81ea\u52a8\u6dfb\u52a0\u7684\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u76f4\u63a5\u6839\u636eObjectId\u6765\u67e5\u8be2\uff0c\u8fd9\u91cc\u9700\u8981\u4f7f\u7528bson\u5e93\u91cc\u9762\u7684ObjectId\u3002 In [27]: from bson.objectid import ObjectId In [28]: result = collection.find_one({'_id':ObjectId('5c6b659b1607c47f8abe6ab7')}) In [29]: print(result) {'_id': ObjectId('5c6b659b1607c47f8abe6ab7'), 'name': '\u5f20\u4e09', 'age': '25'} \u5176\u67e5\u8be2\u7ed3\u679c\u4f9d\u7136\u662f\u5b57\u5178\u7c7b\u578b\uff0c\u8fd0\u884c\u7ed3\u679c\uff1a {'_id': ObjectId('5c6b659b1607c47f8abe6ab7'), 'name': '\u5f20\u4e09', 'age': '25'} \u5f53\u7136\u5982\u679c\u67e5\u8be2\u7ed3\u679c\u4e0d\u5b58\u5728\u5219\u4f1a\u8fd4\u56deNone.","title":"2.5.1 find_one()"},{"location":"python/lib/nosql/mongo/mongo.index/#252-find","text":"find()\u5219\u8fd4\u56de\u591a\u4e2a\u7ed3\u679c\u3002\u5bf9\u4e8e\u591a\u6761\u6570\u636e\u7684\u67e5\u8be2\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528find()\u65b9\u6cd5\uff0c\u4f8b\u5982\u5728\u8fd9\u91cc\u67e5\u627e\u5e74\u9f84\u4e3a25\u7684\u6570\u636e\uff0c results = collection.find({'age': '25'}) print(results) for result in results: print(result) \u7ed3\u679c\u662f: {'_id': ObjectId('5c6b659b1607c47f8abe6ab7'), 'name': '\u5f20\u4e09', 'age': '25'} {'_id': ObjectId('5c6b65c01607c47f8abe6ab8'), 'name': '\u5c0f\u660e', 'age': '25'} {'_id': ObjectId('5c6b65df1607c47f8abe6aba'), 'name': '\u674e\u56db', 'age': '25'} {'_id': ObjectId('5c6b66081607c47f8abe6abb'), 'name': '\u738b\u4e94', 'age': '25'} \u8fd4\u56de\u7ed3\u679c\u662fCursor\u7c7b\u578b\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u751f\u6210\u5668\uff0c\u6211\u4eec\u9700\u8981\u904d\u5386\u53d6\u5230\u6240\u6709\u7684\u7ed3\u679c\uff0c\u6bcf\u4e00\u4e2a\u7ed3\u679c\u90fd\u662f\u5b57\u5178\u7c7b\u578b\u3002 \u5982\u679c\u8981\u67e5\u8be2\u5e74\u9f84\u5927\u4e8e20\u7684\u6570\u636e\uff0c\u5219\u5199\u6cd5\u5982\u4e0b\uff1a results = collection.find({'age': {'$gt': '20'}}) \u6d4b\u8bd5 In [38]: results = collection.find({'age': {'$gt': '20'}}) In [39]: for data in results: ...: print(data) ...: {'_id': ObjectId('5c6b659b1607c47f8abe6ab7'), 'name': '\u5f20\u4e09', 'age': '25'} {'_id': ObjectId('5c6b65c01607c47f8abe6ab8'), 'name': '\u5c0f\u660e', 'age': '25'} {'_id': ObjectId('5c6b65c01607c47f8abe6ab9'), 'name': '\u5c0f\u5f3a', 'age': '24'} {'_id': ObjectId('5c6b65df1607c47f8abe6aba'), 'name': '\u674e\u56db', 'age': '25'} {'_id': ObjectId('5c6b66081607c47f8abe6abb'), 'name': '\u738b\u4e94', 'age': '25'} {'_id': ObjectId('5c6b66081607c47f8abe6abc'), 'name': '\u8d75\u516d', 'age': '24'} \u5728\u8fd9\u91cc\u67e5\u8be2\u7684\u6761\u4ef6\u952e\u503c\u5df2\u7ecf\u4e0d\u662f\u5355\u7eaf\u7684\u6570\u5b57\u4e86\uff0c\u800c\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5176\u952e\u540d\u4e3a\u6bd4\u8f83\u7b26\u53f7$gt\uff0c\u610f\u601d\u662f\u5927\u4e8e\uff0c\u952e\u503c\u4e3a20\uff0c\u8fd9\u6837\u4fbf\u53ef\u4ee5\u67e5\u8be2\u51fa\u6240\u6709\u5e74\u9f84\u5927\u4e8e20\u7684\u6570\u636e\u3002","title":"2.5.2 find()"},{"location":"python/lib/nosql/mongo/mongo.index/#253","text":"\u5728\u8fd9\u91cc\u5c06\u6bd4\u8f83\u7b26\u53f7\u5f52\u7eb3\u5982\u4e0b\u8868\uff1a \u7b26\u53f7 \u542b\u4e49 \u4f8b\u5b50 $lt \u5c0f\u4e8e {'age': {'$lt': 20}} $gt \u5927\u4e8e {'age': {'$gt': 20}} $lte \u5c0f\u4e8e\u7b49\u4e8e {'age': {'$lte': 20}} $gte \u5927\u4e8e\u7b49\u4e8e {'age': {'$gte': 20}} $ne \u4e0d\u7b49\u4e8e {'age': {'$ne': 20}} $in \u5728\u8303\u56f4\u5185 {'age': {'$in': [20, 23]}} $nin \u4e0d\u5728\u8303\u56f4\u5185 {'age': {'$nin': [20, 23]}} \u53e6\u5916\u8fd8\u53ef\u4ee5\u8fdb\u884c\u6b63\u5219\u5339\u914d\u67e5\u8be2\uff0c\u4f8b\u5982\u67e5\u8be2\u540d\u5b57\u4ee5M\u5f00\u5934\u7684\u5b66\u751f\u6570\u636e\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a results = collection.find({'name': {'$regex': '^M.*'}}) \u5728\u8fd9\u91cc\u4f7f\u7528\u4e86$regex\u6765\u6307\u5b9a\u6b63\u5219\u5339\u914d\uff0c^M.*\u4ee3\u8868\u4ee5M\u5f00\u5934\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u67e5\u8be2\u6240\u6709\u7b26\u5408\u8be5\u6b63\u5219\u7684\u7ed3\u679c\u3002","title":"2.5.3 \u6bd4\u8f83\u7b26\u53f7"},{"location":"python/lib/nosql/mongo/mongo.index/#254","text":"\u5728\u8fd9\u91cc\u5c06\u4e00\u4e9b\u529f\u80fd\u7b26\u53f7\u518d\u5f52\u7c7b\u5982\u4e0b\uff1a \u7b26\u53f7 \u542b\u4e49 \u4f8b\u5b50 \u4f8b\u5b50\u542b\u4e49 $regex \u5339\u914d\u6b63\u5219 {'name': {'$regex': '^M.*'}} name\u4ee5M\u5f00\u5934 $exists \u5c5e\u6027\u662f\u5426\u5b58\u5728 {'name': {'$exists': True}} name\u5c5e\u6027\u5b58\u5728 $type \u7c7b\u578b\u5224\u65ad {'age': {'$type': 'int'}} age\u7684\u7c7b\u578b\u4e3aint $mod \u6570\u5b57\u6a21\u64cd\u4f5c {'age': {'$mod': [5, 0]}} \u5e74\u9f84\u6a215\u4f590 $text \u6587\u672c\u67e5\u8be2 {' text': {' text': {' search': 'Mike'}} text\u7c7b\u578b\u7684\u5c5e\u6027\u4e2d\u5305\u542bMike\u5b57\u7b26\u4e32 $where \u9ad8\u7ea7\u6761\u4ef6\u67e5\u8be2 {'$where': 'obj.fans_count == obj.follows_count'} \u81ea\u8eab\u7c89\u4e1d\u6570\u7b49\u4e8e\u5173\u6ce8\u6570 \u8fd9\u4e9b\u64cd\u4f5c\u7684\u66f4\u8be6\u7ec6\u7528\u6cd5\u5728\u53ef\u4ee5\u5728MongoDB\u5b98\u65b9\u6587\u6863\u627e\u5230\uff1a https://docs.mongodb.com/manual/reference/operator/query/","title":"2.5.4 \u529f\u80fd\u7b26\u53f7"},{"location":"python/lib/nosql/mongo/mongo.index/#25_1","text":"\u8981\u7edf\u8ba1\u67e5\u8be2\u7ed3\u679c\u6709\u591a\u5c11\u6761\u6570\u636e\uff0c\u53ef\u4ee5\u8c03\u7528count()\u65b9\u6cd5\uff0c\u5982\u7edf\u8ba1\u6240\u6709\u6570\u636e\u6761\u6570\uff1a In [40]: count = collection.find().count() In [41]: print(count) 6 \u6216\u8005\u7edf\u8ba1\u7b26\u5408\u67d0\u4e2a\u6761\u4ef6\u7684\u6570\u636e\uff1a In [43]: count = collection.find({'age': '25'}).count() In [44]: print(count) 4","title":"2.5 \u8ba1\u6570"},{"location":"python/lib/nosql/mongo/mongo.index/#26","text":"\u53ef\u4ee5\u8c03\u7528sort\u65b9\u6cd5\uff0c\u4f20\u5165\u6392\u5e8f\u7684\u5b57\u6bb5\u53ca\u5347\u964d\u5e8f\u6807\u5fd7\u5373\u53ef\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a In [45]: results = collection.find().sort('name', pymongo.ASCENDING) In [46]: print([result['name'] for result in results]) ['\u5c0f\u5f3a', '\u5c0f\u660e', '\u5f20\u4e09', '\u674e\u56db', '\u738b\u4e94', '\u8d75\u516d']","title":"2.6 \u6392\u5e8f"},{"location":"python/lib/nosql/mongo/mongo.index/#27","text":"\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u6211\u4eec\u53ef\u80fd\u60f3\u53ea\u53d6\u67d0\u51e0\u4e2a\u5143\u7d20\uff0c\u5728\u8fd9\u91cc\u53ef\u4ee5\u5229\u7528skip()\u65b9\u6cd5\u504f\u79fb\u51e0\u4e2a\u4f4d\u7f6e\uff0c\u6bd4\u5982\u504f\u79fb2\uff0c\u5c31\u5ffd\u7565\u524d2\u4e2a\u5143\u7d20\uff0c\u5f97\u5230\u7b2c\u4e09\u4e2a\u53ca\u4ee5\u540e\u7684\u5143\u7d20\u3002 In [47]: results = collection.find().sort('name', pymongo.ASCENDING).skip(2) In [48]: print([result['name'] for result in results]) ['\u5f20\u4e09', '\u674e\u56db', '\u738b\u4e94', '\u8d75\u516d']","title":"2.7 \u504f\u79fb"},{"location":"python/lib/nosql/mongo/mongo.index/#28-limit","text":"\u53ef\u4ee5\u7528limit()\u65b9\u6cd5\u6307\u5b9a\u8981\u53d6\u7684\u7ed3\u679c\u4e2a\u6570\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a In [49]: results = collection.find().sort('name', pymongo.ASCENDING).skip(2).limit(2) In [50]: print([result['name'] for result in results]) ['\u5f20\u4e09', '\u674e\u56db'] \u5982\u679c\u4e0d\u52a0limit()\u539f\u672c\u4f1a\u8fd4\u56de\u4e09\u4e2a\u7ed3\u679c\uff0c\u52a0\u4e86\u9650\u5236\u4e4b\u540e\uff0c\u4f1a\u622a\u53d62\u4e2a\u7ed3\u679c\u8fd4\u56de\u3002 \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u5728\u6570\u636e\u5e93\u6570\u91cf\u975e\u5e38\u5e9e\u5927\u7684\u65f6\u5019\uff0c\u5982\u5343\u4e07\u3001\u4ebf\u7ea7\u522b\uff0c\u6700\u597d\u4e0d\u8981\u4f7f\u7528\u5927\u7684\u504f\u79fb\u91cf\u6765\u67e5\u8be2\u6570\u636e\uff0c\u5f88\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\u3002\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3cfind({'_id': {'$gt': ObjectId('593278c815c2602678bb2b8d')}}) \u8fd9\u6837\u7684\u65b9\u6cd5\u6765\u67e5\u8be2\uff0c\u8bb0\u5f55\u597d\u4e0a\u6b21\u67e5\u8be2\u7684_id\u3002","title":"2.8 limit"},{"location":"python/lib/nosql/mongo/mongo.index/#29","text":"","title":"2.9 \u66f4\u65b0"},{"location":"python/lib/nosql/mongo/mongo.index/#291-update","text":"\u5bf9\u4e8e\u6570\u636e\u66f4\u65b0\u53ef\u4ee5\u4f7f\u7528update()\u65b9\u6cd5\uff0c\u6307\u5b9a\u66f4\u65b0\u7684\u6761\u4ef6\u548c\u66f4\u65b0\u540e\u7684\u6570\u636e\u5373\u53ef\uff0c\u4f8b\u5982\uff1a \u6ca1\u4fee\u6539\u4e4b\u524d > db.informations.find() { \"_id\" : ObjectId(\"5c6b659b1607c47f8abe6ab7\"), \"name\" : \"\u5f20\u4e09\", \"age\" : \"25\" } { \"_id\" : ObjectId(\"5c6b65c01607c47f8abe6ab8\"), \"name\" : \"\u5c0f\u660e\", \"age\" : \"25\" } { \"_id\" : ObjectId(\"5c6b65c01607c47f8abe6ab9\"), \"name\" : \"\u5c0f\u5f3a\", \"age\" : \"24\" } { \"_id\" : ObjectId(\"5c6b65df1607c47f8abe6aba\"), \"name\" : \"\u674e\u56db\", \"age\" : \"25\" } { \"_id\" : ObjectId(\"5c6b66081607c47f8abe6abb\"), \"name\" : \"\u738b\u4e94\", \"age\" : \"25\" } { \"_id\" : ObjectId(\"5c6b66081607c47f8abe6abc\"), \"name\" : \"\u8d75\u516d\", \"age\" : \"24\" } In [51]: condition = {'name': '\u5f20\u4e09'} In [52]: user = collection.find_one(condition) In [53]: user['age']=20 In [54]: result = collection.update(condition, user) /usr/local/bin/ipython:1: DeprecationWarning: update is deprecated. Use replace_one, update_one or update_many instead. #!/usr/local/bin/python3.6 In [55]: print(result) {'ok': 1, 'nModified': 1, 'n': 1, 'updatedExisting': True} \u4fee\u6539\u4e4b\u540e > db.informations.find() { \"_id\" : ObjectId(\"5c6b659b1607c47f8abe6ab7\"), \"name\" : \"\u5f20\u4e09\", \"age\" : 20 } { \"_id\" : ObjectId(\"5c6b65c01607c47f8abe6ab8\"), \"name\" : \"\u5c0f\u660e\", \"age\" : \"25\" } { \"_id\" : ObjectId(\"5c6b65c01607c47f8abe6ab9\"), \"name\" : \"\u5c0f\u5f3a\", \"age\" : \"24\" } { \"_id\" : ObjectId(\"5c6b65df1607c47f8abe6aba\"), \"name\" : \"\u674e\u56db\", \"age\" : \"25\" } { \"_id\" : ObjectId(\"5c6b66081607c47f8abe6abb\"), \"name\" : \"\u738b\u4e94\", \"age\" : \"25\" } { \"_id\" : ObjectId(\"5c6b66081607c47f8abe6abc\"), \"name\" : \"\u8d75\u516d\", \"age\" : \"24\" } \u8fd4\u56de\u7ed3\u679c\u662f\u5b57\u5178\u5f62\u5f0f\uff0cok\u5373\u4ee3\u8868\u6267\u884c\u6210\u529f\uff0cnModified\u4ee3\u8868\u5f71\u54cd\u7684\u6570\u636e\u6761\u6570\u3002 \u53e6\u5916update()\u65b9\u6cd5\u5176\u5b9e\u4e5f\u662f\u5b98\u65b9\u4e0d\u63a8\u8350\u4f7f\u7528\u7684\u65b9\u6cd5\uff0c\u5728\u8fd9\u91cc\u4e5f\u5206\u4e86update_one()\u65b9\u6cd5\u548cupdate_many()\u65b9\u6cd5\uff0c\u7528\u6cd5\u66f4\u52a0\u4e25\u683c\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u9700\u8981\u4f7f\u7528$\u7c7b\u578b\u64cd\u4f5c\u7b26\u4f5c\u4e3a\u5b57\u5178\u7684\u952e\u540d\uff0c\u6211\u4eec\u7528\u793a\u4f8b\u611f\u53d7\u4e00\u4e0b\u3002","title":"2.9.1 update"},{"location":"python/lib/nosql/mongo/mongo.index/#292-update_one","text":"condition = {'name': '\u674e\u56db'} user = collection.find_one(condition) user['age'] = 26 result = collection.update_one(condition, {'$set': user}) print(result) print(result.matched_count, result.modified_count) \u5728\u8fd9\u91cc\u8c03\u7528\u4e86update_one\u65b9\u6cd5\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e0d\u80fd\u518d\u76f4\u63a5\u4f20\u5165\u4fee\u6539\u540e\u7684\u5b57\u5178\uff0c\u800c\u662f\u9700\u8981\u4f7f\u7528{'$set': user}\u8fd9\u6837\u7684\u5f62\u5f0f\uff0c\u5176\u8fd4\u56de\u7ed3\u679c\u662fUpdateResult\u7c7b\u578b\uff0c\u7136\u540e\u8c03\u7528matched_count\u548cmodified_count\u5c5e\u6027\u5206\u522b\u53ef\u4ee5\u83b7\u5f97\u5339\u914d\u7684\u6570\u636e\u6761\u6570\u548c\u5f71\u54cd\u7684\u6570\u636e\u6761\u6570\u3002 \u518d\u770b\u4e00\u4e2a\u4f8b\u5b50 condition = {'age': {'$gt': 20}} result = collection.update_one(condition, {'$inc': {'age': 1}}) print(result) print(result.matched_count, result.modified_count) \u5728\u8fd9\u91cc\u6211\u4eec\u6307\u5b9a\u67e5\u8be2\u6761\u4ef6\u4e3a\u5e74\u9f84\u5927\u4e8e20\uff0c\u7136\u540e\u66f4\u65b0\u6761\u4ef6\u4e3a{'$inc': {'age': 1}} \uff0c\u4e5f\u5c31\u662f\u5e74\u9f84\u52a01\uff0c\u6267\u884c\u4e4b\u540e\u4f1a\u8bb2\u7b2c\u4e00\u6761\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\u5e74\u9f84\u52a01\u3002","title":"2.9.2 update_one"},{"location":"python/lib/nosql/mongo/mongo.index/#293-update_many","text":"\u5982\u679c\u8c03\u7528update_many()\u65b9\u6cd5\uff0c\u5219\u4f1a\u5c06\u6240\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\u90fd\u66f4\u65b0\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a condition = {'age': {'$gt': 20}} result = collection.update_many(condition, {'$inc': {'age': 1}}) print(result) print(result.matched_count, result.modified_count)","title":"2.9.3 update_many"},{"location":"python/lib/nosql/mongo/mongo.index/#210","text":"","title":"2.10 \u5220\u9664"},{"location":"python/lib/nosql/mongo/mongo.index/#2101-remove","text":"\u5220\u9664\u64cd\u4f5c\u6bd4\u8f83\u7b80\u5355\uff0c\u76f4\u63a5\u8c03\u7528remove()\u65b9\u6cd5\u6307\u5b9a\u5220\u9664\u7684\u6761\u4ef6\u5373\u53ef\uff0c\u7b26\u5408\u6761\u4ef6\u7684\u6240\u6709\u6570\u636e\u5747\u4f1a\u88ab\u5220\u9664\uff0c\u793a\u4f8b\u5982\u4e0b result = collection.remove({'name': '\u738b\u4e94'}) print(result) \u8fd0\u884c n [66]: result = collection.remove({'name': '\u738b\u4e94'}) /usr/local/bin/ipython:1: DeprecationWarning: remove is deprecated. Use delete_one or delete_many instead. #!/usr/local/bin/python3.6 In [67]: print(result) {'ok': 1, 'n': 1} \u53e6\u5916\u4f9d\u7136\u5b58\u5728\u4e24\u4e2a\u65b0\u7684\u63a8\u8350\u65b9\u6cd5\uff0cdelete_one()\u548cdelete_many()\u65b9\u6cd5.","title":"2.10.1 remove"},{"location":"python/lib/nosql/mongo/mongo.index/#2102-delete_one","text":"result = collection.delete_one({'name': '\u8d75\u516d'}) print(result) print(result.deleted_count) \u8fc7\u7a0b In [68]: result = collection.delete_one({'name': '\u8d75\u516d'}) In [69]: print(result) <pymongo.results.DeleteResult object at 0x7f3d00039188> In [70]: print(result.deleted_count) 1","title":"2.10.2 delete_one"},{"location":"python/lib/nosql/mongo/mongo.index/#2103-delete_many","text":"result = collection.delete_many({'age': {'$lt': 10}}) print(result.deleted_count) delete_one()\u5373\u5220\u9664\u7b2c\u4e00\u6761\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\uff0cdelete_many()\u5373\u5220\u9664\u6240\u6709\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\uff0c\u8fd4\u56de\u7ed3\u679c\u662fDeleteResult\u7c7b\u578b\uff0c\u53ef\u4ee5\u8c03\u7528deleted_count\u5c5e\u6027\u83b7\u53d6\u5220\u9664\u7684\u6570\u636e\u6761\u6570\u3002","title":"2.10.3 delete_many"},{"location":"python/lib/nosql/mongo/mongo.index/#2104","text":"\u53e6\u5916PyMongo\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7ec4\u5408\u65b9\u6cd5\uff0c\u5982find_one_and_delete() \u3001find_one_and_replace() \u3001find_one_and_update() \uff0c\u5c31\u662f\u67e5\u627e\u540e\u5220\u9664\u3001\u66ff\u6362\u3001\u66f4\u65b0\u64cd\u4f5c\uff0c\u7528\u6cd5\u4e0e\u4e0a\u8ff0\u65b9\u6cd5\u57fa\u672c\u4e00\u81f4\u3002 \u53e6\u5916\u8fd8\u53ef\u4ee5\u5bf9\u7d22\u5f15\u8fdb\u884c\u64cd\u4f5c\uff0c\u5982create_index() \u3001create_indexes() \u3001drop_index()\u7b49\u3002 \u8be6\u7ec6\u7528\u6cd5\u53ef\u4ee5\u53c2\u89c1\u5b98\u65b9\u6587\u6863\uff1a http://api.mongodb.com/python/current/api/pymongo/collection.html \u53e6\u5916\u8fd8\u6709\u5bf9\u6570\u636e\u5e93\u3001\u96c6\u5408\u672c\u8eab\u4ee5\u53ca\u5176\u4ed6\u7684\u4e00\u4e9b\u64cd\u4f5c\uff0c\u5728\u8fd9\u4e0d\u518d\u4e00\u4e00\u8bb2\u89e3\uff0c\u53ef\u4ee5\u53c2\u89c1\u5b98\u65b9\u6587\u6863\uff1a http://api.mongodb.com/python/current/api/pymongo/","title":"2.10.4 \u66f4\u591a"},{"location":"python/lib/nosql/mongo/mongo.index/#211-code","text":"#!/usr/bin/env python # -*- coding: utf-8 -*- import pymongo import datetime def get_db(): # \u5efa\u7acb\u8fde\u63a5 client = pymongo.MongoClient(host=\"127.0.0.1\", port=27017) # host \u6307\u5b9a\u8981\u94fe\u63a5\u7684mongo server\u7684\u4e3b\u673a\u3002port\u662f\u7aef\u53e3 db = client['test_mongo_db'] #\u6216\u8005 db = client.test_mongo_db return db def get_collection(db): # \u9009\u62e9\u96c6\u5408(mongo\u4e2dcollection\u548cdatabase\u90fd\u662f\u5ef6\u65f6\u521b\u5efa\u7684) coll = db['informations'] print (db.collection_names()) return coll def insert_one_doc(db): # \u63d2\u5165\u4e00\u4e2adocument coll = db['informations'] information = {\"name\": \"summer\", \"age\": \"25\"} information_id = coll.insert(information) print(information_id) def insert_multi_docs(db): # \u6279\u91cf\u63d2\u5165documents,\u63d2\u5165\u4e00\u4e2a\u6570\u7ec4 coll = db['informations'] information = [{\"name\": \"\u5c0f\u660e\", \"age\": \"25\"}, {\"name\": \"\u5c0f\u5f3a\", \"age\": \"24\"}] information_id = coll.insert(information) print(information_id) def get_one_doc(db): # \u6709\u5c31\u8fd4\u56de\u4e00\u4e2a\uff0c\u6ca1\u6709\u5c31\u8fd4\u56deNone coll = db['informations'] print(coll.find_one()) # \u8fd4\u56de\u7b2c\u4e00\u6761\u8bb0\u5f55 print(coll.find_one({\"name\": \"summer\"})) print(coll.find_one({\"name\": \"none\"})) def get_one_by_id(db): # \u901a\u8fc7objectid\u6765\u67e5\u627e\u4e00\u4e2adoc coll = db['informations'] obj = coll.find_one() obj_id = obj[\"_id\"] print(\"_id \u4e3aObjectId\u7c7b\u578b\uff0cobj_id:\" + str(obj_id)) print(coll.find_one({\"_id\": obj_id})) # \u9700\u8981\u6ce8\u610f\u8fd9\u91cc\u7684obj_id\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4e0d\u662f\u4e00\u4e2astr\uff0c\u4f7f\u7528str\u7c7b\u578b\u4f5c\u4e3a_id\u7684\u503c\u65e0\u6cd5\u627e\u5230\u8bb0\u5f55 print(\"_id \u4e3astr\u7c7b\u578b \") print(coll.find_one({\"_id\": str(obj_id)})) # \u53ef\u4ee5\u901a\u8fc7ObjectId\u65b9\u6cd5\u628astr\u8f6c\u6210ObjectId\u7c7b\u578b from bson.objectid import ObjectId print (\"_id \u8f6c\u6362\u6210ObjectId\u7c7b\u578b\") print (coll.find_one({\"_id\": ObjectId(str(obj_id))})) def get_many_docs(db): # mongo\u4e2d\u63d0\u4f9b\u4e86\u8fc7\u6ee4\u67e5\u627e\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u901a\u8fc7\u5404\u79cd\u6761\u4ef6\u7b5b\u9009\u6765\u83b7\u53d6\u6570\u636e\u96c6\uff0c\u8fd8\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u8ba1\u6570\uff0c\u6392\u5e8f\u7b49\u5904\u7406 coll = db['informations'] # ASCENDING = 1 \u5347\u5e8f;DESCENDING = -1\u964d\u5e8f;default is ASCENDING for item in coll.find().sort(\"age\", pymongo.DESCENDING): print(item) count = coll.count() print (\"\u96c6\u5408\u4e2d\u6240\u6709\u6570\u636e %s\u4e2a\" % int(count)) # \u6761\u4ef6\u67e5\u8be2 count = coll.find({\"name\":\"summer\"}).count() print (\"summer: %s\"%count) def clear_all_datas(db): # \u6e05\u7a7a\u4e00\u4e2a\u96c6\u5408\u4e2d\u7684\u6240\u6709\u6570\u636e db[\"informations\"].remove() if __name__ == '__main__': db = get_db() my_collection = get_collection(db) post = {\"author\": \"Mike\", \"text\": \"My first blog post!\", \"tags\": [\"mongodb\", \"python\", \"pymongo\"], \"date\": datetime.datetime.utcnow()} # \u63d2\u5165\u8bb0\u5f55 my_collection.insert(post) insert_one_doc(db) # \u6761\u4ef6\u67e5\u8be2 print (my_collection.find_one({\"x\": \"10\"})) # \u67e5\u8be2\u8868\u4e2d\u6240\u6709\u7684\u6570\u636e for data in my_collection.find(): print(data) print (my_collection.count()) my_collection.update({\"author\": \"Mike\"}, {\"author\": \"summer\", \"text\": \"My first blog post!\", \"tags\": [\"mongodb\", \"python\", \"pymongo\"], \"date\": datetime.datetime.utcnow()}) for data in my_collection.find(): print (data) get_one_doc(db) get_one_by_id(db) get_many_docs(db) # clear_all_datas(db)","title":"2.11 code"},{"location":"python/lib/nosql/redis/redis.index/","text":"redis \u6a21\u5757 1. \u4ecb\u7ecd \u00b6 Redis\u662f\u4e00\u4e2a\u57fa\u4e8e\u5185\u5b58\u7684\u9ad8\u6548\u7684\u952e\u503c\u578b\u975e\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u5b58\u53d6\u6548\u7387\u6781\u9ad8\uff0c\u800c\u4e14\u652f\u6301\u591a\u79cd\u5b58\u50a8\u6570\u636e\u7ed3\u6784\uff0c\u4f7f\u7528\u4e5f\u975e\u5e38\u7b80\u5355\u3002\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u5c31\u6765\u4ecb\u7ecd\u4e00\u4e0bPython\u7684Redis\u64cd\u4f5c\uff0c\u4e3b\u8981\u4ecb\u7ecdRedisPy\u8fd9\u4e2a\u5e93\u7684\u7528\u6cd5\u3002 1.1 \u51c6\u5907\u5de5\u4f5c \u00b6 \u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u8bf7\u786e\u4fdd\u5df2\u7ecf\u5b89\u88c5\u597d\u4e86Redis\u53caRedisPy\u5e93\u3002\u5982\u679c\u8981\u505a\u6570\u636e\u5bfc\u5165/\u5bfc\u51fa\u64cd\u4f5c\u7684\u8bdd\uff0c\u8fd8\u9700\u8981\u5b89\u88c5RedisDump\u3002 1.2 Redis StrictRedis \u00b6 RedisPy\u5e93\u63d0\u4f9b\u4e24\u4e2a\u7c7bRedis\u548cStrictRedis\u6765\u5b9e\u73b0Redis\u7684\u547d\u4ee4\u64cd\u4f5c\u3002 StrictRedis\u5b9e\u73b0\u4e86\u7edd\u5927\u90e8\u5206\u5b98\u65b9\u7684\u547d\u4ee4\uff0c\u53c2\u6570\u4e5f\u4e00\u4e00\u5bf9\u5e94\uff0c\u6bd4\u5982set()\u65b9\u6cd5\u5c31\u5bf9\u5e94Redis\u547d\u4ee4\u7684set\u65b9\u6cd5\u3002\u800cRedis\u662fStrictRedis\u7684\u5b50\u7c7b\uff0c\u5b83\u7684\u4e3b\u8981\u529f\u80fd\u662f\u7528\u4e8e\u5411\u540e\u517c\u5bb9\u65e7\u7248\u672c\u5e93\u91cc\u7684\u51e0\u4e2a\u65b9\u6cd5\u3002\u4e3a\u4e86\u505a\u517c\u5bb9\uff0c\u5b83\u5c06\u65b9\u6cd5\u505a\u4e86\u6539\u5199\uff0c\u6bd4\u5982lrem()\u65b9\u6cd5\u5c31\u5c06value\u548cnum\u53c2\u6570\u7684\u4f4d\u7f6e\u4e92\u6362\uff0c\u8fd9\u548cRedis\u547d\u4ee4\u884c\u7684\u547d\u4ee4\u53c2\u6570\u4e0d\u4e00\u81f4\u3002\u5b98\u65b9\u63a8\u8350\u4f7f\u7528StrictRedis 1.3 \u5b89\u88c5 \u00b6 Redis \u548c python\u64cd\u4f5c\u6a21\u5757 \u5b89\u88c5 \u53ca \u542f\u52a8 - ubuntu\u7cfb\u7edf apt-get install redis-server pip3 install Redis /etc/init.d/redis-server restart centos\u7cfb\u7edf yum install redis-server pip3 install Redis /etc/init.d/redis-server restart \u67e5\u770b\u7248\u672c\uff1a redis-cli info # redis\u8be6\u7ec6\u4fe1\u606f redis-cli --version | redis-cli -v redis-server --version | redis-server -v - \u7b80\u5355\u4f7f\u7528\uff1a 127.0.0.1:6379> set name 'keke' # \u8bbe\u7f6e \u952e\u4e3aname \u5bf9\u5e94\u7684\u503c\u4e3akeke OK 127.0.0.1:6379> set age '3' OK 127.0.0.1:6379> keys * # \u67e5\u770b\u6240\u6709\u7684\u952e 1) \"age\" 2) \"name\" 127.0.0.1:6379> get name # \u67e5\u770b\u952e\u4e3aname\u5bf9\u5e94\u7684\u503c \"keke\" 127.0.0.1:6379> get age \"3\" 127.0.0.1:6379> set sex female ex 2 # \u8bbe\u7f6e\u503c\uff0c\u53ea\u5b58\u6d3b2\u79d2 OK 127.0.0.1:6379> keys * 1) \"age\" 2) \"name\" 127.0.0.1:6379> set sex female ex 10 OK 127.0.0.1:6379> keys * 1) \"age\" 2) \"sex\" 3) \"name\" 127.0.0.1:6379> get sex \"female\" 127.0.0.1:6379> keys * 1) \"age\" 2) \"name\" 127.0.0.1:6379> flushdb # \u6e05\u7a7a\u5f53\u524ddb\u4e0b\u7684\u6240\u6709\u952e\u503c\uff0c\u8c28\u614e\u64cd\u4f5c OK 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> 127.0.0.1:6379> flushall # \u6e05\u7a7a\u6240\u6709db\u4e0b\u7684\u952e\u503c OK 2. \u57fa\u672c\u547d\u4ee4 \u00b6 2.1 redis key\u547d\u4ee4 \u00b6 Redis keys \u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 DEL key \u8be5\u547d\u4ee4\u7528\u4e8e\u5728 key \u5b58\u5728\u65f6\u5220\u9664 key\u3002 DUMP key \u5e8f\u5217\u5316\u7ed9\u5b9a key \uff0c\u5e76\u8fd4\u56de\u88ab\u5e8f\u5217\u5316\u7684\u503c\u3002 EXISTS key \u68c0\u67e5\u7ed9\u5b9a key \u662f\u5426\u5b58\u5728\u3002 EXPIRE key seconds \u4e3a\u7ed9\u5b9a key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u79d2\u8ba1\u3002 EXPIREAT key timestamp EXPIREAT \u7684\u4f5c\u7528\u548c EXPIRE \u7c7b\u4f3c\uff0c\u90fd\u7528\u4e8e\u4e3a key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u4e0d\u540c\u5728\u4e8e EXPIREAT \u547d\u4ee4\u63a5\u53d7\u7684\u65f6\u95f4\u53c2\u6570\u662f UNIX \u65f6\u95f4\u6233(unix timestamp)\u3002 PEXPIRE key milliseconds \u8bbe\u7f6e key \u7684\u8fc7\u671f\u65f6\u95f4\u4ee5\u6beb\u79d2\u8ba1\u3002 PEXPIREAT key milliseconds-timestamp \u8bbe\u7f6e key \u8fc7\u671f\u65f6\u95f4\u7684\u65f6\u95f4\u6233(unix timestamp) \u4ee5\u6beb\u79d2\u8ba1 KEYS pattern \u67e5\u627e\u6240\u6709\u7b26\u5408\u7ed9\u5b9a\u6a21\u5f0f( pattern)\u7684 key \u3002 MOVE key db \u5c06\u5f53\u524d\u6570\u636e\u5e93\u7684 key \u79fb\u52a8\u5230\u7ed9\u5b9a\u7684\u6570\u636e\u5e93 db \u5f53\u4e2d\u3002 PERSIST key \u79fb\u9664 key \u7684\u8fc7\u671f\u65f6\u95f4\uff0ckey \u5c06\u6301\u4e45\u4fdd\u6301\u3002 PTTL key \u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u8fd4\u56de key \u7684\u5269\u4f59\u7684\u8fc7\u671f\u65f6\u95f4\u3002 TTL key \u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0c\u8fd4\u56de\u7ed9\u5b9a key \u7684\u5269\u4f59\u751f\u5b58\u65f6\u95f4(TTL, time to live)\u3002 RANDOMKEY \u4ece\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u968f\u673a\u8fd4\u56de\u4e00\u4e2a key \u3002 RENAME key newkey \u4fee\u6539 key \u7684\u540d\u79f0 RENAMENX key newkey \u4ec5\u5f53 newkey \u4e0d\u5b58\u5728\u65f6\uff0c\u5c06 key \u6539\u540d\u4e3a newkey \u3002 TYPE key \u8fd4\u56de key \u6240\u50a8\u5b58\u7684\u503c\u7684\u7c7b\u578b\u3002 2.2 redis \u5b57\u7b26\u4e32\u547d\u4ee4 \u00b6 Redis \u5b57\u7b26\u4e32\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 SET key value \u8bbe\u7f6e\u6307\u5b9a key \u7684\u503c GET key \u83b7\u53d6\u6307\u5b9a key \u7684\u503c\u3002 GETRANGE key start end \u8fd4\u56de key \u4e2d\u5b57\u7b26\u4e32\u503c\u7684\u5b50\u5b57\u7b26 GETSET key value \u5c06\u7ed9\u5b9a key \u7684\u503c\u8bbe\u4e3a value \uff0c\u5e76\u8fd4\u56de key \u7684\u65e7\u503c(old value)\u3002 GETBIT key offset \u5bf9 key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\uff0c\u83b7\u53d6\u6307\u5b9a\u504f\u79fb\u91cf\u4e0a\u7684\u4f4d(bit)\u3002 MGET key1 [key2..] \u83b7\u53d6\u6240\u6709(\u4e00\u4e2a\u6216\u591a\u4e2a)\u7ed9\u5b9a key \u7684\u503c\u3002 SETBIT key offset value \u5bf9 key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\uff0c\u8bbe\u7f6e\u6216\u6e05\u9664\u6307\u5b9a\u504f\u79fb\u91cf\u4e0a\u7684\u4f4d(bit)\u3002 SETEX key seconds value \u5c06\u503c value \u5173\u8054\u5230 key \uff0c\u5e76\u5c06 key \u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u4e3a seconds (\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002 SETNX key value \u53ea\u6709\u5728 key \u4e0d\u5b58\u5728\u65f6\u8bbe\u7f6e key \u7684\u503c\u3002 SETRANGE key offset value \u7528 value \u53c2\u6570\u8986\u5199\u7ed9\u5b9a key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\uff0c\u4ece\u504f\u79fb\u91cf offset \u5f00\u59cb\u3002 STRLEN key \u8fd4\u56de key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\u7684\u957f\u5ea6\u3002 MSET key value [key value ...] \u540c\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u6216\u591a\u4e2a key-value \u5bf9\u3002 MSETNX key value [key value ...] \u540c\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u6216\u591a\u4e2a key-value \u5bf9\uff0c\u5f53\u4e14\u4ec5\u5f53\u6240\u6709\u7ed9\u5b9a key \u90fd\u4e0d\u5b58\u5728\u3002 PSETEX key milliseconds value \u8fd9\u4e2a\u547d\u4ee4\u548c SETEX \u547d\u4ee4\u76f8\u4f3c\uff0c\u4f46\u5b83\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u8bbe\u7f6e key \u7684\u751f\u5b58\u65f6\u95f4\uff0c\u800c\u4e0d\u662f\u50cf SETEX \u547d\u4ee4\u90a3\u6837\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002 INCR key \u5c06 key \u4e2d\u50a8\u5b58\u7684\u6570\u5b57\u503c\u589e\u4e00\u3002 INCRBY key increment \u5c06 key \u6240\u50a8\u5b58\u7684\u503c\u52a0\u4e0a\u7ed9\u5b9a\u7684\u589e\u91cf\u503c\uff08increment\uff09 \u3002 INCRBYFLOAT key increment \u5c06 key \u6240\u50a8\u5b58\u7684\u503c\u52a0\u4e0a\u7ed9\u5b9a\u7684\u6d6e\u70b9\u589e\u91cf\u503c\uff08increment\uff09 \u3002 DECR key \u5c06 key \u4e2d\u50a8\u5b58\u7684\u6570\u5b57\u503c\u51cf\u4e00\u3002 DECRBY key decrement key \u6240\u50a8\u5b58\u7684\u503c\u51cf\u53bb\u7ed9\u5b9a\u7684\u51cf\u91cf\u503c\uff08decrement\uff09 \u3002 APPEND key value \u5982\u679c key \u5df2\u7ecf\u5b58\u5728\u5e76\u4e14\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c APPEND \u547d\u4ee4\u5c06\u6307\u5b9a\u7684 value \u8ffd\u52a0\u5230\u8be5 key \u539f\u6765\u503c\uff08value\uff09\u7684\u672b\u5c3e\u3002 2.3 redis hash\u4e32\u547d\u4ee4 \u00b6 Redis hash \u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 HDEL key field1 [field2] \u5220\u9664\u4e00\u4e2a\u6216\u591a\u4e2a\u54c8\u5e0c\u8868\u5b57\u6bb5 HEXISTS key field \u67e5\u770b\u54c8\u5e0c\u8868 key \u4e2d\uff0c\u6307\u5b9a\u7684\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u3002 HGET key field \u83b7\u53d6\u5b58\u50a8\u5728\u54c8\u5e0c\u8868\u4e2d\u6307\u5b9a\u5b57\u6bb5\u7684\u503c\u3002 HGETALL key \u83b7\u53d6\u5728\u54c8\u5e0c\u8868\u4e2d\u6307\u5b9a key \u7684\u6240\u6709\u5b57\u6bb5\u548c\u503c HINCRBY key field increment \u4e3a\u54c8\u5e0c\u8868 key \u4e2d\u7684\u6307\u5b9a\u5b57\u6bb5\u7684\u6574\u6570\u503c\u52a0\u4e0a\u589e\u91cf increment \u3002 HINCRBYFLOAT key field increment \u4e3a\u54c8\u5e0c\u8868 key \u4e2d\u7684\u6307\u5b9a\u5b57\u6bb5\u7684\u6d6e\u70b9\u6570\u503c\u52a0\u4e0a\u589e\u91cf increment \u3002 HKEYS key \u83b7\u53d6\u6240\u6709\u54c8\u5e0c\u8868\u4e2d\u7684\u5b57\u6bb5 HLEN key \u83b7\u53d6\u54c8\u5e0c\u8868\u4e2d\u5b57\u6bb5\u7684\u6570\u91cf HMGET key field1 [field2] \u83b7\u53d6\u6240\u6709\u7ed9\u5b9a\u5b57\u6bb5\u7684\u503c HMSET key field1 value1 [field2 value2 ] \u540c\u65f6\u5c06\u591a\u4e2a field-value (\u57df-\u503c)\u5bf9\u8bbe\u7f6e\u5230\u54c8\u5e0c\u8868 key \u4e2d\u3002 HSET key field value \u5c06\u54c8\u5e0c\u8868 key \u4e2d\u7684\u5b57\u6bb5 field \u7684\u503c\u8bbe\u4e3a value \u3002 HSETNX key field value \u53ea\u6709\u5728\u5b57\u6bb5 field \u4e0d\u5b58\u5728\u65f6\uff0c\u8bbe\u7f6e\u54c8\u5e0c\u8868\u5b57\u6bb5\u7684\u503c\u3002 HVALS key \u83b7\u53d6\u54c8\u5e0c\u8868\u4e2d\u6240\u6709\u503c HSCAN key cursor [MATCH pattern] [COUNT count] \u8fed\u4ee3\u54c8\u5e0c\u8868\u4e2d\u7684\u952e\u503c\u5bf9\u3002 2.4 redis \u5217\u8868\u547d\u4ee4 \u00b6 Redis \u5217\u8868\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 BLPOP key1 [key2 ] timeout \u79fb\u51fa\u5e76\u83b7\u53d6\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c \u5982\u679c\u5217\u8868\u6ca1\u6709\u5143\u7d20\u4f1a\u963b\u585e\u5217\u8868\u76f4\u5230\u7b49\u5f85\u8d85\u65f6\u6216\u53d1\u73b0\u53ef\u5f39\u51fa\u5143\u7d20\u4e3a\u6b62\u3002 BRPOP key1 [key2 ] timeout \u79fb\u51fa\u5e76\u83b7\u53d6\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c \u5982\u679c\u5217\u8868\u6ca1\u6709\u5143\u7d20\u4f1a\u963b\u585e\u5217\u8868\u76f4\u5230\u7b49\u5f85\u8d85\u65f6\u6216\u53d1\u73b0\u53ef\u5f39\u51fa\u5143\u7d20\u4e3a\u6b62\u3002 BRPOPLPUSH source destination timeout \u4ece\u5217\u8868\u4e2d\u5f39\u51fa\u4e00\u4e2a\u503c\uff0c\u5c06\u5f39\u51fa\u7684\u5143\u7d20\u63d2\u5165\u5230\u53e6\u5916\u4e00\u4e2a\u5217\u8868\u4e2d\u5e76\u8fd4\u56de\u5b83\uff1b \u5982\u679c\u5217\u8868\u6ca1\u6709\u5143\u7d20\u4f1a\u963b\u585e\u5217\u8868\u76f4\u5230\u7b49\u5f85\u8d85\u65f6\u6216\u53d1\u73b0\u53ef\u5f39\u51fa\u5143\u7d20\u4e3a\u6b62\u3002 LINDEX key index \u901a\u8fc7\u7d22\u5f15\u83b7\u53d6\u5217\u8868\u4e2d\u7684\u5143\u7d20 LINSERT key BEFORE AFTER pivot value LLEN key \u83b7\u53d6\u5217\u8868\u957f\u5ea6 LPOP key \u79fb\u51fa\u5e76\u83b7\u53d6\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20 LPUSH key value1 [value2] \u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u503c\u63d2\u5165\u5230\u5217\u8868\u5934\u90e8 LPUSHX key value \u5c06\u4e00\u4e2a\u503c\u63d2\u5165\u5230\u5df2\u5b58\u5728\u7684\u5217\u8868\u5934\u90e8 LRANGE key start stop \u83b7\u53d6\u5217\u8868\u6307\u5b9a\u8303\u56f4\u5185\u7684\u5143\u7d20 LREM key count value \u79fb\u9664\u5217\u8868\u5143\u7d20 LSET key index value \u901a\u8fc7\u7d22\u5f15\u8bbe\u7f6e\u5217\u8868\u5143\u7d20\u7684\u503c LTRIM key start stop \u5bf9\u4e00\u4e2a\u5217\u8868\u8fdb\u884c\u4fee\u526a(trim)\uff0c\u5c31\u662f\u8bf4\uff0c\u8ba9\u5217\u8868\u53ea\u4fdd\u7559\u6307\u5b9a\u533a\u95f4\u5185\u7684\u5143\u7d20\uff0c\u4e0d\u5728\u6307\u5b9a\u533a\u95f4\u4e4b\u5185\u7684\u5143\u7d20\u90fd\u5c06\u88ab\u5220\u9664\u3002 RPOP key \u79fb\u9664\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u8fd4\u56de\u503c\u4e3a\u79fb\u9664\u7684\u5143\u7d20\u3002 RPOPLPUSH source destination \u79fb\u9664\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u5e76\u5c06\u8be5\u5143\u7d20\u6dfb\u52a0\u5230\u53e6\u4e00\u4e2a\u5217\u8868\u5e76\u8fd4\u56de RPUSH key value1 [value2] \u5728\u5217\u8868\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u503c RPUSHX key value \u4e3a\u5df2\u5b58\u5728\u7684\u5217\u8868\u6dfb\u52a0\u503c 2.5 redis \u5217\u8868\u96c6\u5408\u547d\u4ee4 \u00b6 Redis \u96c6\u5408\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 SADD key member1 [member2] \u5411\u96c6\u5408\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458 SCARD key \u83b7\u53d6\u96c6\u5408\u7684\u6210\u5458\u6570 SDIFF key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u5dee\u96c6 SDIFFSTORE destination key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u5dee\u96c6\u5e76\u5b58\u50a8\u5728 destination \u4e2d SINTER key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u4ea4\u96c6 SINTERSTORE destination key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u4ea4\u96c6\u5e76\u5b58\u50a8\u5728 destination \u4e2d SISMEMBER key member \u5224\u65ad member \u5143\u7d20\u662f\u5426\u662f\u96c6\u5408 key \u7684\u6210\u5458 SMEMBERS key \u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u6240\u6709\u6210\u5458 SMOVE source destination member \u5c06 member \u5143\u7d20\u4ece source \u96c6\u5408\u79fb\u52a8\u5230 destination \u96c6\u5408 SPOP key \u79fb\u9664\u5e76\u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u968f\u673a\u5143\u7d20 SRANDMEMBER key [count] \u8fd4\u56de\u96c6\u5408\u4e2d\u4e00\u4e2a\u6216\u591a\u4e2a\u968f\u673a\u6570 SREM key member1 [member2] \u79fb\u9664\u96c6\u5408\u4e2d\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458 SUNION key1 [key2] \u8fd4\u56de\u6240\u6709\u7ed9\u5b9a\u96c6\u5408\u7684\u5e76\u96c6 SUNIONSTORE destination key1 [key2] \u6240\u6709\u7ed9\u5b9a\u96c6\u5408\u7684\u5e76\u96c6\u5b58\u50a8\u5728 destination \u96c6\u5408\u4e2d SSCAN key cursor [MATCH pattern] [COUNT count] \u8fed\u4ee3\u96c6\u5408\u4e2d\u7684\u5143\u7d20 2.6 redis \u5217\u6709\u5e8f\u96c6\u5408\u547d\u4ee4 \u00b6 Redis \u6709\u5e8f\u96c6\u5408\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 ZADD key score1 member1 [score2 member2] \u5411\u6709\u5e8f\u96c6\u5408\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458\uff0c\u6216\u8005\u66f4\u65b0\u5df2\u5b58\u5728\u6210\u5458\u7684\u5206\u6570 ZCARD key \u83b7\u53d6\u6709\u5e8f\u96c6\u5408\u7684\u6210\u5458\u6570 ZCOUNT key min max \u8ba1\u7b97\u5728\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u533a\u95f4\u5206\u6570\u7684\u6210\u5458\u6570 ZINCRBY key increment member \u6709\u5e8f\u96c6\u5408\u4e2d\u5bf9\u6307\u5b9a\u6210\u5458\u7684\u5206\u6570\u52a0\u4e0a\u589e\u91cf increment ZINTERSTORE destination numkeys key [key ...] \u8ba1\u7b97\u7ed9\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6709\u5e8f\u96c6\u7684\u4ea4\u96c6\u5e76\u5c06\u7ed3\u679c\u96c6\u5b58\u50a8\u5728\u65b0\u7684\u6709\u5e8f\u96c6\u5408 key \u4e2d ZLEXCOUNT key min max \u5728\u6709\u5e8f\u96c6\u5408\u4e2d\u8ba1\u7b97\u6307\u5b9a\u5b57\u5178\u533a\u95f4\u5185\u6210\u5458\u6570\u91cf ZRANGE key start stop [WITHSCORES] \u901a\u8fc7\u7d22\u5f15\u533a\u95f4\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u6210\u6307\u5b9a\u533a\u95f4\u5185\u7684\u6210\u5458 ZRANGEBYLEX key min max [LIMIT offset count] \u901a\u8fc7\u5b57\u5178\u533a\u95f4\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u7684\u6210\u5458 ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT] \u901a\u8fc7\u5206\u6570\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u6307\u5b9a\u533a\u95f4\u5185\u7684\u6210\u5458 ZRANK key member \u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u6210\u5458\u7684\u7d22\u5f15 ZREM key member [member ...] \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458 ZREMRANGEBYLEX key min max \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7ed9\u5b9a\u7684\u5b57\u5178\u533a\u95f4\u7684\u6240\u6709\u6210\u5458 ZREMRANGEBYRANK key start stop \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7ed9\u5b9a\u7684\u6392\u540d\u533a\u95f4\u7684\u6240\u6709\u6210\u5458 ZREMRANGEBYSCORE key min max \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7ed9\u5b9a\u7684\u5206\u6570\u533a\u95f4\u7684\u6240\u6709\u6210\u5458 ZREVRANGE key start stop [WITHSCORES] \u8fd4\u56de\u6709\u5e8f\u96c6\u4e2d\u6307\u5b9a\u533a\u95f4\u5185\u7684\u6210\u5458\uff0c\u901a\u8fc7\u7d22\u5f15\uff0c\u5206\u6570\u4ece\u9ad8\u5230\u5e95 ZREVRANGEBYSCORE key max min [WITHSCORES] \u8fd4\u56de\u6709\u5e8f\u96c6\u4e2d\u6307\u5b9a\u5206\u6570\u533a\u95f4\u5185\u7684\u6210\u5458\uff0c\u5206\u6570\u4ece\u9ad8\u5230\u4f4e\u6392\u5e8f ZREVRANK key member \u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u6210\u5458\u7684\u6392\u540d\uff0c\u6709\u5e8f\u96c6\u6210\u5458\u6309\u5206\u6570\u503c\u9012\u51cf(\u4ece\u5927\u5230\u5c0f)\u6392\u5e8f ZSCORE key member \u8fd4\u56de\u6709\u5e8f\u96c6\u4e2d\uff0c\u6210\u5458\u7684\u5206\u6570\u503c ZUNIONSTORE destination numkeys key [key ...] \u8ba1\u7b97\u7ed9\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6709\u5e8f\u96c6\u7684\u5e76\u96c6\uff0c\u5e76\u5b58\u50a8\u5728\u65b0\u7684 key \u4e2d ZSCAN key cursor [MATCH pattern] [COUNT count] \u8fed\u4ee3\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u5143\u7d20\uff08\u5305\u62ec\u5143\u7d20\u6210\u5458\u548c\u5143\u7d20\u5206\u503c\uff09 2.7 redis HyperLogLog\u547d\u4ee4 \u00b6 Redis HyperLogLog \u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 PFADD key element [element ...] \u6dfb\u52a0\u6307\u5b9a\u5143\u7d20\u5230 HyperLogLog \u4e2d\u3002 PFCOUNT key [key ...] \u8fd4\u56de\u7ed9\u5b9a HyperLogLog \u7684\u57fa\u6570\u4f30\u7b97\u503c\u3002 PFMERGE destkey sourcekey [sourcekey ...] \u5c06\u591a\u4e2a HyperLogLog \u5408\u5e76\u4e3a\u4e00\u4e2a HyperLogLog 2.8 redis \u53d1\u5e03\u8ba2\u9605\u547d\u4ee4 \u00b6 Redis \u53d1\u5e03\u8ba2\u9605\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 PSUBSCRIBE pattern [pattern ...] \u8ba2\u9605\u4e00\u4e2a\u6216\u591a\u4e2a\u7b26\u5408\u7ed9\u5b9a\u6a21\u5f0f\u7684\u9891\u9053\u3002 PUBSUB subcommand [argument [argument ...]] \u67e5\u770b\u8ba2\u9605\u4e0e\u53d1\u5e03\u7cfb\u7edf\u72b6\u6001\u3002 PUBLISH channel message \u5c06\u4fe1\u606f\u53d1\u9001\u5230\u6307\u5b9a\u7684\u9891\u9053\u3002 PUNSUBSCRIBE [pattern [pattern ...]] \u9000\u8ba2\u6240\u6709\u7ed9\u5b9a\u6a21\u5f0f\u7684\u9891\u9053\u3002 SUBSCRIBE channel [channel ...] \u8ba2\u9605\u7ed9\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u9891\u9053\u7684\u4fe1\u606f\u3002 UNSUBSCRIBE [channel [channel ...]] \u6307\u9000\u8ba2\u7ed9\u5b9a\u7684\u9891\u9053\u3002 2.9 redis \u4e8b\u52a1\u547d\u4ee4 \u00b6 Redis \u4e8b\u52a1\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 DISCARD \u53d6\u6d88\u4e8b\u52a1\uff0c\u653e\u5f03\u6267\u884c\u4e8b\u52a1\u5757\u5185\u7684\u6240\u6709\u547d\u4ee4\u3002 EXEC \u6267\u884c\u6240\u6709\u4e8b\u52a1\u5757\u5185\u7684\u547d\u4ee4\u3002 MULTI \u6807\u8bb0\u4e00\u4e2a\u4e8b\u52a1\u5757\u7684\u5f00\u59cb\u3002 UNWATCH \u53d6\u6d88 WATCH \u547d\u4ee4\u5bf9\u6240\u6709 key \u7684\u76d1\u89c6\u3002 WATCH key [key ...] \u76d1\u89c6\u4e00\u4e2a(\u6216\u591a\u4e2a) key \uff0c\u5982\u679c\u5728\u4e8b\u52a1\u6267\u884c\u4e4b\u524d\u8fd9\u4e2a(\u6216\u8fd9\u4e9b) key \u88ab\u5176\u4ed6\u547d\u4ee4\u6240\u6539\u52a8\uff0c\u90a3\u4e48\u4e8b\u52a1\u5c06\u88ab\u6253\u65ad 2.10 redis \u811a\u672c\u547d\u4ee4 \u00b6 Redis \u811a\u672c\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 EVAL script numkeys key [key ...] arg [arg ...] \u6267\u884c Lua \u811a\u672c\u3002 EVALSHA sha1 numkeys key [key ...] arg [arg ...] \u6267\u884c Lua \u811a\u672c\u3002 SCRIPT EXISTS script [script ...] \u67e5\u770b\u6307\u5b9a\u7684\u811a\u672c\u662f\u5426\u5df2\u7ecf\u88ab\u4fdd\u5b58\u5728\u7f13\u5b58\u5f53\u4e2d\u3002 SCRIPT FLUSH \u4ece\u811a\u672c\u7f13\u5b58\u4e2d\u79fb\u9664\u6240\u6709\u811a\u672c\u3002 SCRIPT KILL \u6740\u6b7b\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684 Lua \u811a\u672c\u3002 SCRIPT LOAD script \u5c06\u811a\u672c script \u6dfb\u52a0\u5230\u811a\u672c\u7f13\u5b58\u4e2d\uff0c\u4f46\u5e76\u4e0d\u7acb\u5373\u6267\u884c\u8fd9\u4e2a\u811a\u672c\u3002 2.11 redis \u94fe\u63a5\u547d\u4ee4 \u00b6 Redis \u8fde\u63a5\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 AUTH password \u9a8c\u8bc1\u5bc6\u7801\u662f\u5426\u6b63\u786e ECHO message \u6253\u5370\u5b57\u7b26\u4e32 PING \u67e5\u770b\u670d\u52a1\u662f\u5426\u8fd0\u884c QUIT \u5173\u95ed\u5f53\u524d\u8fde\u63a5 SELECT index \u5207\u6362\u5230\u6307\u5b9a\u7684\u6570\u636e\u5e93 2.12 redis \u670d\u52a1\u5668\u547d\u4ee4 \u00b6 Redis \u670d\u52a1\u5668\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 BGREWRITEAOF \u5f02\u6b65\u6267\u884c\u4e00\u4e2a AOF\uff08AppendOnly File\uff09 \u6587\u4ef6\u91cd\u5199\u64cd\u4f5c BGSAVE \u5728\u540e\u53f0\u5f02\u6b65\u4fdd\u5b58\u5f53\u524d\u6570\u636e\u5e93\u7684\u6570\u636e\u5230\u78c1\u76d8 CLIENT KILL [ip:port] [ID client-id] \u5173\u95ed\u5ba2\u6237\u7aef\u8fde\u63a5 CLIENT LIST \u83b7\u53d6\u8fde\u63a5\u5230\u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u5217\u8868 CLIENT GETNAME \u83b7\u53d6\u8fde\u63a5\u7684\u540d\u79f0 CLIENT PAUSE timeout \u5728\u6307\u5b9a\u65f6\u95f4\u5185\u7ec8\u6b62\u8fd0\u884c\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u547d\u4ee4 CLIENT SETNAME connection-name \u8bbe\u7f6e\u5f53\u524d\u8fde\u63a5\u7684\u540d\u79f0 CLUSTER SLOTS \u83b7\u53d6\u96c6\u7fa4\u8282\u70b9\u7684\u6620\u5c04\u6570\u7ec4 COMMAND \u83b7\u53d6 Redis \u547d\u4ee4\u8be6\u60c5\u6570\u7ec4 COMMAND COUNT \u83b7\u53d6 Redis \u547d\u4ee4\u603b\u6570 COMMAND GETKEYS \u83b7\u53d6\u7ed9\u5b9a\u547d\u4ee4\u7684\u6240\u6709\u952e TIME \u8fd4\u56de\u5f53\u524d\u670d\u52a1\u5668\u65f6\u95f4 COMMAND INFO command-name [command-name ...] \u83b7\u53d6\u6307\u5b9a Redis \u547d\u4ee4\u63cf\u8ff0\u7684\u6570\u7ec4 CONFIG GET parameter \u83b7\u53d6\u6307\u5b9a\u914d\u7f6e\u53c2\u6570\u7684\u503c CONFIG REWRITE \u5bf9\u542f\u52a8 Redis \u670d\u52a1\u5668\u65f6\u6240\u6307\u5b9a\u7684 redis.conf \u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u6539\u5199 CONFIG SET parameter value \u4fee\u6539 redis \u914d\u7f6e\u53c2\u6570\uff0c\u65e0\u9700\u91cd\u542f CONFIG RESETSTAT \u91cd\u7f6e INFO \u547d\u4ee4\u4e2d\u7684\u67d0\u4e9b\u7edf\u8ba1\u6570\u636e DBSIZE \u8fd4\u56de\u5f53\u524d\u6570\u636e\u5e93\u7684 key \u7684\u6570\u91cf DEBUG OBJECT key \u83b7\u53d6 key \u7684\u8c03\u8bd5\u4fe1\u606f DEBUG SEGFAULT \u8ba9 Redis \u670d\u52a1\u5d29\u6e83 FLUSHALL \u5220\u9664\u6240\u6709\u6570\u636e\u5e93\u7684\u6240\u6709key FLUSHDB \u5220\u9664\u5f53\u524d\u6570\u636e\u5e93\u7684\u6240\u6709key INFO [section] \u83b7\u53d6 Redis \u670d\u52a1\u5668\u7684\u5404\u79cd\u4fe1\u606f\u548c\u7edf\u8ba1\u6570\u503c LASTSAVE \u8fd4\u56de\u6700\u8fd1\u4e00\u6b21 Redis \u6210\u529f\u5c06\u6570\u636e\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\u65f6\u95f4\uff0c\u4ee5 UNIX \u65f6\u95f4\u6233\u683c\u5f0f\u8868\u793a MONITOR \u5b9e\u65f6\u6253\u5370\u51fa Redis \u670d\u52a1\u5668\u63a5\u6536\u5230\u7684\u547d\u4ee4\uff0c\u8c03\u8bd5\u7528 ROLE \u8fd4\u56de\u4e3b\u4ece\u5b9e\u4f8b\u6240\u5c5e\u7684\u89d2\u8272 SAVE \u540c\u6b65\u4fdd\u5b58\u6570\u636e\u5230\u786c\u76d8 SHUTDOWN [NOSAVE] [SAVE] \u5f02\u6b65\u4fdd\u5b58\u6570\u636e\u5230\u786c\u76d8\uff0c\u5e76\u5173\u95ed\u670d\u52a1\u5668 SLAVEOF host port \u5c06\u5f53\u524d\u670d\u52a1\u5668\u8f6c\u53d8\u4e3a\u6307\u5b9a\u670d\u52a1\u5668\u7684\u4ece\u5c5e\u670d\u52a1\u5668(slave server) SLOWLOG subcommand [argument] \u7ba1\u7406 redis \u7684\u6162\u65e5\u5fd7 SYNC \u7528\u4e8e\u590d\u5236\u529f\u80fd(replication)\u7684\u5185\u90e8\u547d\u4ee4 3. \u8be6\u7ec6 \u00b6 3.1 \u5b89\u88c5redis\u5e93 \u00b6 pip install redis 3.2 Python\u64cd\u4f5cRedis \u00b6 \u8fde\u63a5 redis-py\u63d0\u4f9b\u4e24\u4e2a\u7c7bRedis\u548cStrictRedis\u7528\u4e8e\u5b9e\u73b0Redis\u7684\u547d\u4ee4\uff0cStrictRedis\u7528\u4e8e\u5b9e\u73b0\u5927\u90e8\u5206\u5b98\u65b9\u7684\u547d\u4ee4\uff0c\u5e76\u4f7f\u7528\u5b98\u65b9\u7684\u8bed\u6cd5\u548c\u547d\u4ee4\uff0cRedis\u662fStrictRedis\u7684\u5b50\u7c7b\uff0c\u7528\u4e8e\u5411\u540e\u517c\u5bb9\u65e7\u7248\u672c\u7684redis-py\u3002 import redis r = redis.Redis(host='127.0.0.1', port=6379) r.set('name', 'Jack') print (r.get('name')) - \u8fde\u63a5\u6c60 redis-py\u4f7f\u7528connection pool\u6765\u7ba1\u7406\u5bf9\u4e00\u4e2aredis server\u7684\u6240\u6709\u8fde\u63a5\uff0c\u907f\u514d\u6bcf\u6b21\u5efa\u7acb\u3001\u91ca\u653e\u8fde\u63a5\u7684\u5f00\u9500\u3002\u9ed8\u8ba4\uff0c\u6bcf\u4e2aRedis\u5b9e\u4f8b\u90fd\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u81ea\u5df1\u7684\u8fde\u63a5\u6c60\u3002\u53ef\u4ee5\u76f4\u63a5\u5efa\u7acb\u4e00\u4e2a\u8fde\u63a5\u6c60\uff0c\u7136\u540e\u4f5c\u4e3a\u53c2\u6570Redis\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9e\u73b0\u591a\u4e2aRedis\u5b9e\u4f8b\u5171\u4eab\u4e00\u4e2a\u8fde\u63a5\u6c60\u3002 import redis pool = redis.ConnectionPool(host='127.0.0.1', port=6379) r = redis.Redis(connection_pool=pool) r.set('name', 'Jack') print r.get('name') 3.2 string \u00b6 3.2.1 set \u00b6 set setnx setnx(name, value) setex setex(name, value, time) psetex psetex(name, time_ms, value) set(name, value, ex=None, px=None, nx=False, xx=False) help set \u5728Redis\u4e2d\u8bbe\u7f6e\u503c\uff0c\u9ed8\u8ba4\uff0c\u4e0d\u5b58\u5728\u5219\u521b\u5efa\uff0c\u5b58\u5728\u5219\u4fee\u6539 \u53c2\u6570\uff1a - ex\uff0c\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09 - px\uff0c\u8fc7\u671f\u65f6\u95f4\uff08\u6beb\u79d2\uff09 - nx\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3aTrue\uff0c\u5219\u53ea\u6709name\u4e0d\u5b58\u5728\u65f6\uff0c\u5f53\u524dset\u64cd\u4f5c\u624d\u6267\u884c - xx\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3aTrue\uff0c\u5219\u53ea\u6709name\u5b58\u5728\u65f6\uff0c\u5f53\u524dset\u64cd\u4f5c\u624d\u6267\u884c setex(name, value, time) #\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09 psetex(name, time_ms, value) #\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff08\u8c6a\u79d2\uff09 \u64cd\u4f5c\u8fc7\u7a0b In [5]: r.set('k1','v1') Out[5]: True In [6]: r.get('key1') In [7]: r.get('k1') Out[7]: b'v1' 3.2.3 mset \u00b6 mset(*args, **kwargs) #\u6279\u91cf\u8bbe\u7f6e\u503c r.mset(name1='zhangsan', name2='lisi') #\u6216 r.mget({\"name1\":'zhangsan', \"name2\":'lisi'}) \u64cd\u4f5c\u8fc7\u7a0b In [14]: r.mset(name1='zhangsan', name2='lisi') Out[14]: True In [15]: r.mget({\"name1\":'zhangsan', \"name2\":'lisi'}) Out[15]: [b'zhangsan', b'lisi'] 3.2.4 mget \u00b6 mget(keys, *args) #\u6279\u91cf\u83b7\u53d6 print(r.mget(\"name1\",\"name2\")) #\u6216 li=[\"name1\",\"name2\"] print(r.mget(li)) \u64cd\u4f5c\u8fc7\u7a0b In [16]: r.mget(\"name1\",\"name2\") Out[16]: [b'zhangsan', b'lisi'] In [17]: name=[\"name1\",\"name2\"] In [18]: r.mget(name) Out[18]: [b'zhangsan', b'lisi'] 3.2.5 getset \u00b6 getset(name, value) #\u8bbe\u7f6e\u65b0\u503c\uff0c\u6253\u5370\u539f\u503c print(r.getset(\"name1\",\"wangwu\")) #\u8f93\u51fa:zhangsan print(r.get(\"name1\")) #\u8f93\u51fa:wangwu \u64cd\u4f5c\u8fc7\u7a0b In [26]: r.get(\"name1\") Out[26]: b'zhangsan' In [27]: r.getset(\"name1\",\"wangwu\") Out[27]: b'zhangsan' In [28]: r.get(\"name1\") Out[28]: b'wangwu' 3.2.6 getrange \u00b6 getrange(key, start, end) #\u6839\u636e\u5b57\u8282\u83b7\u53d6\u5b50\u5e8f\u5217 r.set(\"name\",\"zhangsan\") print(r.getrange(\"name\",0,4))#\u8f93\u51fa:zhang \u64cd\u4f5c\u8fc7\u7a0b In [29]: r.set(\"name\",\"zhangsan\") Out[29]: True In [30]: r.getrange('name',0,4) Out[30]: b'zhang' 3.2.7 setrange \u00b6 setrange(name, offset, value) #\u4fee\u6539\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u4ece\u6307\u5b9a\u5b57\u7b26\u4e32\u7d22\u5f15\u5f00\u59cb\u5411\u540e\u66ff\u6362\uff0c\u5982\u679c\u65b0\u503c\u592a\u957f\u65f6\uff0c\u5219\u5411\u540e\u6dfb\u52a0 r.set(\"name\",\"zhangsan\") r.setrange(\"name\",1,\"ww\") print(r.get(\"name\")) #\u8f93\u51fa:zwwngsan r.set(\"name\",\"zhangsan\") r.setrange(\"name\",6,\"wwww\") print(r.get(\"name\")) #\u8f93\u51fa:zwwwwsan r.set(\"name\",\"zhangsan\") r.setrange(\"name\",6,\"wwwwwwwwwww\") print(r.get(\"name\")) #\u8f93\u51fa:zwwwwwwwwwww \u64cd\u4f5c\u8fc7\u7a0b In [31]: r.set(\"name\",\"zhangsan\") Out[31]: True In [32]: r.setrange(\"name\",1,\"ww\") Out[32]: 8 In [33]: r.get(\"name\") Out[33]: b'zwwngsan' In [34]: r.set(\"name\",\"zhangsan\") Out[34]: True In [35]: r.setrange(\"name\",1,\"wwww\") Out[35]: 8 In [36]: r.get(\"name\") Out[36]: b'zwwwwsan' In [37]: r.set(\"name\",\"zhangsan\") Out[37]: True In [38]: r.setrange(\"name\",1,\"wwwwwwwwwww\") Out[38]: 12 In [39]: r.get(\"name\") Out[39]: b'zwwwwwwwwwww' 3.2.8 setbit \u00b6 setbit(name, offset, value) #\u5bf9\u4e8c\u8fdb\u5236\u8868\u793a\u4f4d\u8fdb\u884c\u64cd\u4f5c ''' name:redis\u7684name offset\uff0c\u4f4d\u7684\u7d22\u5f15\uff08\u5c06\u503c\u5bf9\u5e94\u7684ASCII\u7801\u53d8\u6362\u6210\u4e8c\u8fdb\u5236\u540e\u518d\u8fdb\u884c\u7d22\u5f15\uff09 value\uff0c\u503c\u53ea\u80fd\u662f 1 \u6216 0 ''' str=\"345\" r.set(\"name\",str) for i in str: print(i,ord(i),bin(ord(i)))#\u8f93\u51fa \u503c\u3001ASCII\u7801\u4e2d\u5bf9\u5e94\u7684\u503c\u3001\u5bf9\u5e94\u503c\u8f6c\u6362\u7684\u4e8c\u8fdb\u5236 ''' \u8f93\u51fa: 51 0b110011 52 0b110100 53 0b110101''' r.setbit(\"name\",6,0)#\u628a\u7b2c7\u4f4d\u6539\u4e3a0\uff0c\u4e5f\u5c31\u662f3\u5bf9\u5e94\u7684\u53d8\u6210\u4e860b110001 print(r.get(\"name\"))#\u8f93\u51fa\uff1a145 \u64cd\u4f5c\u8fc7\u7a0b In [45]: str=\"345\" In [46]: r.set(\"name\",str) Out[46]: True In [47]: r.setbit(\"name\",6,0) Out[47]: 1 In [48]: r.get(\"name\") Out[48]: b'145' 3.2.9 getbit \u00b6 getbit(name, offset) #\u83b7\u53d6name\u5bf9\u5e94\u503c\u7684\u4e8c\u8fdb\u5236\u4e2d\u67d0\u4f4d\u7684\u503c(0\u62161) r.set(\"name\",\"3\") # \u5bf9\u5e94\u7684\u4e8c\u8fdb\u52360b110011 print(r.getbit(\"name\",5)) #\u8f93\u51fa:0 print(r.getbit(\"name\",6)) #\u8f93\u51fa:1 \u64cd\u4f5c\u8fc7\u7a0b In [49]: r.set(\"name\",\"3\") Out[49]: True In [50]: r.get('name') Out[50]: b'3' In [51]: r.getbit(\"name\",5) Out[51]: 0 In [52]: r.getbit(\"name\",6) Out[52]: 1 3.2.10 bitcount \u00b6 bitcount(key, start=None, end=None) #\u83b7\u53d6\u5bf9\u5e94\u4e8c\u8fdb\u5236\u4e2d1\u7684\u4e2a\u6570 r.set(\"name\",\"345\")#0b110011 0b110100 0b110101 print(r.bitcount(\"name\",start=0,end=1)) #\u8f93\u51fa:7 ''' key:Redis\u7684name start:\u5b57\u8282\u8d77\u59cb\u4f4d\u7f6e end:\u5b57\u8282\u7ed3\u675f\u4f4d\u7f6e''' \u64cd\u4f5c\u8fc7\u7a0b In [56]: r.set(\"name\",\"345\") Out[56]: True In [57]: ...: r.bitcount(\"name\",start=0,end=1) Out[57]: 7 3.2.11 strlen \u00b6 strlen(name) #\u8fd4\u56dename\u5bf9\u5e94\u503c\u7684\u5b57\u8282\u957f\u5ea6\uff08\u4e00\u4e2a\u6c49\u5b573\u4e2a\u5b57\u8282\uff09 r.set(\"name\",\"zhangsan\") print(r.strlen(\"name\")) #\u8f93\u51fa:8 \u64cd\u4f5c\u8fc7\u7a0b In [58]: r.set(\"name\",\"zhangsan\") Out[58]: True In [59]: r.strlen(\"name\") Out[59]: 8 In [60]: r.set(\"name\",\"\u5f20\u4e09\") Out[60]: True In [61]: r.strlen(\"name\") Out[61]: 6 3.2.12 incr \u00b6 incr(self, name, amount=1) #\u81ea\u589emount\u5bf9\u5e94\u7684\u503c\uff0c\u5f53mount\u4e0d\u5b58\u5728\u65f6\uff0c\u5219\u521b\u5efamount\uff1damount\uff0c\u5426\u5219\uff0c\u5219\u81ea\u589e,amount\u4e3a\u81ea\u589e\u6570(\u6574\u6570) print(r.incr(\"mount\",amount=2))#\u8f93\u51fa:2 print(r.incr(\"mount\"))#\u8f93\u51fa:3 print(r.incr(\"mount\",amount=3))#\u8f93\u51fa:6 print(r.incr(\"mount\",amount=6))#\u8f93\u51fa:12 print(r.get(\"mount\")) #\u8f93\u51fa:12 \u64cd\u4f5c\u8fc7\u7a0b In [66]: r.incr(\"num\",amount=2) Out[66]: 2 in [67]: r.incr(\"num\",amount=10) Out[67]: 12 In [68]: r.incr(\"num\") Out[68]: 13 In [69]: r.get('num') Out[69]: b'13' In [70]: r.incr(\"num\",amount=20) Out[70]: 33 In [71]: r.incr(\"num\",amount=30) Out[71]: 63 In [72]: r.get('num') Out[72]: b'63' 3.2.13 incrbyfloat \u00b6 incrbyfloat(self, name, amount=1.0) \u7c7b\u4f3c incr() \u81ea\u589e,amount\u4e3a\u81ea\u589e\u6570(\u6d6e\u70b9\u6570) 3.2.14 decr \u00b6 decr(self, name, amount=1) \u81ea\u51cfname\u5bf9\u5e94\u7684\u503c,\u5f53name\u4e0d\u5b58\u5728\u65f6,\u5219\u521b\u5efaname\uff1damount\uff0c\u5426\u5219\uff0c\u5219\u81ea\u51cf\uff0camount\u4e3a\u81ea\u589e\u6570(\u6574\u6570) 3.2.15 append \u00b6 append(name, value) #\u5728name\u5bf9\u5e94\u7684\u503c\u540e\u9762\u8ffd\u52a0\u5185\u5bb9 r.set(\"name\",\"zhangsan\") print(r.get(\"name\")) #\u8f93\u51fa:'zhangsan r.append(\"name\",\"lisi\") print(r.get(\"name\")) #\u8f93\u51fa:zhangsanlisi \u64cd\u4f5c\u8fc7\u7a0b In [73]: r.set(\"name\",\"zhangsan\") Out[73]: True In [74]: r.get('name') Out[74]: b'zhangsan' In [75]: r.append('name','lisi') Out[75]: 12 In [76]: r.get('name') Out[76]: b'zhangsanlisi' 3.3 Hash \u00b6 redis\u4e2d\u7684Hash \u5728\u5185\u5b58\u4e2d\u7c7b\u4f3c\u4e8e\u4e00\u4e2aname\u5bf9\u5e94\u4e00\u4e2adic\u6765\u5b58\u50a8 3.3.1 hset \u00b6 hset(name, key, value) name\u5bf9\u5e94\u7684hash\u4e2d\u8bbe\u7f6e\u4e00\u4e2a\u952e\u503c\u5bf9\uff08\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\uff0c\u5426\u5219\uff0c\u4fee\u6539\uff09 r.hset(\"hash_name\",\"key1\",\"values1\") \u64cd\u4f5c\u8fc7\u7a0b In [12]: r.hset('hash_name','key1','values1') Out[12]: 1 127.0.0.1:6379> TYPE hash_name hash 127.0.0.1:6379> HGETALL hash_name 1) \"key1\" 2) \"values1\" 127.0.0.1:6379> HGET hash_name key1 \"values1\" 3.3.2 hget \u00b6 hget(name,key) \u53d6\u5355\u4e2akey\u503c r.hset(\"hash_name\",\"key1\",\"values1\") #\u5728hash_name\u5bf9\u5e94\u7684hash\u4e2d\u6839\u636ekey\u83b7\u53d6value print(r.hget(\"hash_name\",\"key1\"))#\u8f93\u51fa:aa \u64cd\u4f5c\u8fc7\u7a0b In [13]: r.hset(\"hash_name\",\"key1\",\"values1\") Out[13]: 0 In [14]: r.hget(\"hash_name\",\"key1\") Out[14]: b'values1' 3.3.3 hgetall \u00b6 hgetall(name) \u83b7\u53d6name\u5bf9\u5e94hash\u7684\u6240\u6709\u952e\u503c In [22]: r.hset(\"hash_name\",\"key1\",\"values1\") Out[22]: 1 In [23]: r.hset(\"hash_name\",\"key2\",\"values2\") Out[23]: 1 In [24]: r.hset(\"hash_name\",\"key3\",\"values3\") Out[24]: 1 In [25]: r.hget('hash_name','key1') Out[25]: b'values1' In [26]: r.hget('hash_name','key') In [27]: r.hget('hash_name','key2') Out[27]: b'values2' In [28]: r.hget('hash_name','key3') Out[28]: b'values3' In [29]: r.hgetall('hash_name') Out[29]: {b'key1': b'values1', b'key2': b'values2', b'key3': b'values3'} 3.3.4 hmset \u00b6 hmset(name, mapping) \u5728name\u5bf9\u5e94\u7684hash\u4e2d\u6279\u91cf\u8bbe\u7f6e\u952e\u503c\u5bf9,mapping:\u5b57\u5178 In [33]: dic={\"name\":\"summer\",\"job\":\"IT\"} In [34]: r.hmset('dic_name',dic) Out[34]: True 127.0.0.1:6379> HGETALL dic_name 1) \"name\" 2) \"summer\" 3) \"job\" 4) \"IT\" 3.3.5 hmget/hmgetall \u00b6 hmget(name, keys, *args) \u5728name\u5bf9\u5e94\u7684hash\u4e2d\u83b7\u53d6\u591a\u4e2akey\u7684\u503c In [36]: r.hmget('dic_name','name') Out[36]: [b'summer'] In [37]: r.hmget('dic_name','job') Out[37]: [b'IT'] 3.3.6 hlen/hkeys/hvals \u00b6 hlen(name)\u3001hkeys(name)\u3001hvals(name) dic={\"name\":\"summer\",\"job\":\"IT\",'age':30} r.hmset(\"dic_name\",dic) #hlen(name) \u83b7\u53d6hash\u4e2d\u952e\u503c\u5bf9\u7684\u4e2a\u6570 print(r.hlen(\"dic_name\")) #hkeys(name) \u83b7\u53d6hash\u4e2d\u6240\u6709\u7684key\u7684\u503c print(r.hkeys(\"dic_name\")) #hvals(name) \u83b7\u53d6hash\u4e2d\u6240\u6709\u7684value\u7684\u503c print(r.hvals(\"dic_name\")) \u64cd\u4f5c\u8fc7\u7a0b In [40]: dic={\"name\":\"summer\",\"job\":\"IT\",'age':30} In [41]: r.hmset('dic_name',dic) Out[41]: True In [42]: r.hlen('dic_name') Out[42]: 3 In [43]: r.hkeys('dic_name') Out[43]: [b'name', b'job', b'age'] In [44]: r.hvals('dic_name') Out[44]: [b'summer', b'IT', b'30'] 3.3.7 hexists \u00b6 hexists(name, key) \u68c0\u67e5name\u5bf9\u5e94\u7684hash\u662f\u5426\u5b58\u5728\u5f53\u524d\u4f20\u5165\u7684key In [45]: r.hexists(\"dic_name\",\"a1\") Out[45]: False In [46]: r.hexists(\"dic_name\",\"name\") Out[46]: True 3.3.8 hdel \u00b6 hdel(name,*keys) \u5220\u9664\u6307\u5b9aname\u5bf9\u5e94\u7684key\u6240\u5728\u7684\u952e\u503c\u5bf9 In [46]: r.hexists(\"dic_name\",\"name\") Out[46]: True In [47]: r.hkeys('dic_name') Out[47]: [b'name', b'job', b'age'] In [48]: r.hvals('dic_name') Out[48]: [b'summer', b'IT', b'30'] In [49]: r.hdel('dic_name','job') Out[49]: 1 In [50]: r.hkeys('dic_name') Out[50]: [b'name', b'age'] 127.0.0.1:6379> HGETALL dic_name 1) \"name\" 2) \"summer\" 3) \"age\" 4) \"30\" 3.3.9 hincrby \u00b6 hincrby(name, key, amount=1) \u81ea\u589ehash\u4e2dkey\u5bf9\u5e94\u7684\u503c\uff0c\u4e0d\u5b58\u5728\u5219\u521b\u5efakey=amount(amount\u4e3a\u6574\u6570) In [52]: r.hincrby(\"num\",\"data\",amount=2) Out[52]: 2 127.0.0.1:6379> keys * 1) \"num\" 2) \"hash_name\" 3) \"dic_name\" 127.0.0.1:6379> type num hash 127.0.0.1:6379> HGETALL num 1) \"data\" 2) \"2\" 3.3.10 hincrbyfloat \u00b6 hincrbyfloat(name, key, amount=1.0) \u81ea\u589ehash\u4e2dkey\u5bf9\u5e94\u7684\u503c\uff0c\u4e0d\u5b58\u5728\u5219\u521b\u5efakey=amount(amount\u4e3a\u6d6e\u70b9\u6570) In [54]: r.hincrby(\"floatnum\",\"float1\",amount=2) Out[54]: 2 127.0.0.1:6379> keys * 1) \"floatnum\" 2) \"num\" 3) \"hash_name\" 4) \"dic_name\" 127.0.0.1:6379> type floatnum hash 127.0.0.1:6379> HGETALL floatnum 1) \"float1\" 2) \"2\" 127.0.0.1:6379> HGET floatnum float1 \"2\" 3.3.11 hscan \u00b6 hscan(name, cursor=0, match=None, count=None) 3.3.12 hscan_iter \u00b6 hscan_iter(name, match=None, count=None) 3.4 List \u00b6 redis\u4e2d\u7684List\u5728\u5728\u5185\u5b58\u4e2d\u6309\u7167\u4e00\u4e2aname\u5bf9\u5e94\u4e00\u4e2aList\u6765\u5b58\u50a8 3.4.1 lpush \u00b6 lpush(name,values) \u5728name\u5bf9\u5e94\u7684list\u4e2d\u6dfb\u52a0\u5143\u7d20\uff0c\u6bcf\u4e2a\u65b0\u7684\u5143\u7d20\u90fd\u6dfb\u52a0\u5230\u5217\u8868\u7684\u6700\u5de6\u8fb9 # \u5728name\u5bf9\u5e94\u7684list\u4e2d\u6dfb\u52a0\u5143\u7d20\uff0c\u6bcf\u4e2a\u65b0\u7684\u5143\u7d20\u90fd\u6dfb\u52a0\u5230\u5217\u8868\u7684\u6700\u5de6\u8fb9 r.lpush('list',5) r.lpush('list',2,3,4) # \u4fdd\u5b58\u5728\u5217\u8868\u4e2d\u7684\u987a\u5e8f\u4e3a5\uff0c4\uff0c3\uff0c2 \u64cd\u4f5c\u8fc7\u7a0b In [58]: r.lpush('list',2) Out[58]: 1 In [59]: r.lpush('list',3,4,5) Out[59]: 4 127.0.0.1:6379> LRANGE list 0 6 1) \"5\" 2) \"4\" 3) \"3\" 4) \"2\" 3.4.2 rpush \u00b6 rpush(name,values) \u540clpush\uff0c\u4f46\u6bcf\u4e2a\u65b0\u7684\u5143\u7d20\u90fd\u6dfb\u52a0\u5230\u5217\u8868\u7684\u6700\u53f3\u8fb9 In [61]: r.rpush('rlist',2) Out[61]: 1 In [62]: r.rpush('rlist',3,4,5) Out[62]: 4 127.0.0.1:6379> keys * 1) \"rlist\" 2) \"list\" 127.0.0.1:6379> LRANGE rlist 0 6 1) \"2\" 2) \"3\" 3) \"4\" 4) \"5\" 3.4.3 lpushx \u00b6 lpushx(name,value) \u5728name\u5bf9\u5e94\u7684list\u4e2d\u6dfb\u52a0\u5143\u7d20\uff0c\u53ea\u6709name\u5df2\u7ecf\u5b58\u5728\u65f6\uff0c\u503c\u6dfb\u52a0\u5230\u5217\u8868\u7684\u6700\u5de6\u8fb9 3.4.4 rpushx \u00b6 rpushx(name,value) \u5728name\u5bf9\u5e94\u7684list\u4e2d\u6dfb\u52a0\u5143\u7d20\uff0c\u53ea\u6709name\u5df2\u7ecf\u5b58\u5728\u65f6\uff0c\u503c\u6dfb\u52a0\u5230\u5217\u8868\u7684\u6700\u53f3\u8fb9 3.4.5 llen \u00b6 llen(name) name\u5bf9\u5e94\u7684list\u5143\u7d20\u7684\u4e2a\u6570 In [63]: r.llen('rlist') Out[63]: 4 3.4.6 linsert \u00b6 linsert(name, where, refvalue, value)) # \u5728name\u5bf9\u5e94\u7684\u5217\u8868\u7684\u67d0\u4e00\u4e2a\u503c\u524d\u6216\u540e\u63d2\u5165\u4e00\u4e2a\u65b0\u503c r.linsert(\"rlist\",\"BEFORE\",\"2\",\"before\")#\u5728\u5217\u8868\u5185\u627e\u5230\u7b2c\u4e00\u4e2a\u5143\u7d202\uff0c\u5728\u5b83\u524d\u9762\u63d2\u5165SS '''\u53c2\u6570\uff1a name: redis\u7684name where: BEFORE\uff08\u524d\uff09\u6216AFTER\uff08\u540e\uff09 refvalue: \u5217\u8868\u5185\u7684\u503c value: \u8981\u63d2\u5165\u7684\u6570\u636e''' \u64cd\u4f5c \u63d2\u5165\u4e4b\u524d 127.0.0.1:6379> LRANGE rlist 0 6 1) \"2\" 2) \"3\" 3) \"4\" 4) \"5\" In [64]: r.linsert(\"rlist\",\"BEFORE\",\"2\",\"before\") Out[64]: 5 \u63d2\u5165\u4e4b\u540e 127.0.0.1:6379> LRANGE rlist 0 6 1) \"before\" 2) \"2\" 3) \"3\" 4) \"4\" 5) \"5\" 3.4.7 lset \u00b6 r.lset(name, index, value) #\u5bf9list\u4e2d\u7684\u67d0\u4e00\u4e2a\u7d22\u5f15\u4f4d\u7f6e\u91cd\u65b0\u8d4b\u503c r.lset(\"rlist\",0,\"bbb\") \u64cd\u4f5c\u8fc7\u7a0b \u4fee\u6539\u4e4b\u524d 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"before\" 2) \"2\" 3) \"3\" 4) \"4_before\" 5) \"4\" 6) \"4_after\" 7) \"4_before\" 8) \"5\" # \u4fee\u6539\u7b2c0\u4f4d\u662f0 In [68]: r.lset('rlist',0,0) Out[68]: True \u4fee\u6539\u4e4b\u540e 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"0\" 2) \"2\" 3) \"3\" 4) \"4_before\" 5) \"4\" 6) \"4_after\" 7) \"4_before\" 8) \"5\" 3.4.8 lrem \u00b6 r.lrem(name, value, num) \u5220\u9664name\u5bf9\u5e94\u7684list\u4e2d\u7684\u6307\u5b9a\u503c r.lrem(\"rlist\",\"data\",num=0) ''' \u53c2\u6570\uff1a name: redis\u7684name value: \u8981\u5220\u9664\u7684\u503c num: num=0 \u5220\u9664\u5217\u8868\u4e2d\u6240\u6709\u7684\u6307\u5b9a\u503c\uff1b num=2 \u4ece\u524d\u5230\u540e\uff0c\u5220\u96642\u4e2a\uff1b num=-2 \u4ece\u540e\u5411\u524d\uff0c\u5220\u96642\u4e2a \u64cd\u4f5c\u8fc7\u7a0b \u5220\u9664\u4e4b\u524d 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"0\" 2) \"2\" 3) \"3\" 4) \"4_before\" 5) \"4\" 6) \"4_after\" 7) \"4_before\" 8) \"5\" In [69]: r.lrem('rlist','4_before',3) Out[69]: 2 \u5220\u9664\u4e4b\u540e 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"0\" 2) \"2\" 3) \"3\" 4) \"4\" 5) \"4_after\" 6) \"5\" 3.4.9 lpop \u00b6 lpop(name) \u79fb\u9664\u5217\u8868\u7684\u5de6\u4fa7\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u8fd4\u56de\u503c\u5219\u662f\u7b2c\u4e00\u4e2a\u5143\u7d20 \u64cd\u4f5c\u8fc7\u7a0b 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"0\" 2) \"2\" 3) \"3\" 4) \"4\" 5) \"4_after\" 6) \"5\" In [70]: r.lpop(\"rlist\") Out[70]: b'0' 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"2\" 2) \"3\" 3) \"4\" 4) \"4_after\" 5) \"5\" 3.4.10 lindex \u00b6 lindex(name, index) \u6839\u636e\u7d22\u5f15\u83b7\u53d6\u5217\u8868\u5185\u5143\u7d20 \u64cd\u4f5c\u8fc7\u7a0b 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"2\" 2) \"3\" 3) \"4\" 4) \"4_after\" 5) \"5\" In [72]: r.lindex('rlist','2') Out[72]: b'4' In [73]: r.lindex('rlist','3') Out[73]: b'4_after 3.4.11 lrange \u00b6 lrange(name, start, end) \u5206\u7247\u83b7\u53d6\u5143\u7d20 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"2\" 2) \"3\" 3) \"4\" 4) \"4_after\" 5) \"5\" In [74]: r.lrange('rlist',0,3) Out[74]: [b'2', b'3', b'4', b'4_after'] In [75]: r.lrange('rlist',0,-1) Out[75]: [b'2', b'3', b'4', b'4_after', b'5'] 3.4.12 ltrim \u00b6 ltrim(name, start, end) \u79fb\u9664\u5217\u8868\u5185\u6ca1\u6709\u5728\u8be5\u7d22\u5f15\u4e4b\u5185\u7684\u503c 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"2\" 2) \"3\" 3) \"4\" 4) \"4_after\" 5) \"5\" In [76]: r.ltrim('rlist',0,2) # \u4fdd\u7559\u7d22\u5f15 0 \u52302\u7684\u503c\uff0c\u5176\u4ed6\u90fd\u5220\u9664 Out[76]: True 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"2\" 2) \"3\" 3) \"4\" 3.4.13 rpoplpush \u00b6 rpoplpush(src, dst) \u4ece\u4e00\u4e2a\u5217\u8868\u53d6\u51fa\u6700\u53f3\u8fb9\u7684\u5143\u7d20\uff0c\u540c\u65f6\u5c06\u5176\u6dfb\u52a0\u81f3\u53e6\u4e00\u4e2a\u5217\u8868\u7684\u6700\u5de6\u8fb9 - src \u8981\u53d6\u6570\u636e\u7684\u5217\u8868 - dst \u8981\u6dfb\u52a0\u6570\u636e\u7684\u5217\u8868 3.4.14 brpoplpush \u00b6 brpoplpush(src, dst, timeout=0) \u540crpoplpush\uff0c\u591a\u4e86\u4e2atimeout, timeout\uff1a\u53d6\u6570\u636e\u7684\u5217\u8868\u6ca1\u5143\u7d20\u540e\u7684\u963b\u585e\u65f6\u95f4\uff0c0\u4e3a\u4e00\u76f4\u963b\u585e 3.4.15 blpop \u00b6 blpop(keys, timeout) \u5c06\u591a\u4e2a\u5217\u8868\u6392\u5217,\u6309\u7167\u4ece\u5de6\u5230\u53f3\u53bb\u79fb\u9664\u5404\u4e2a\u5217\u8868\u5185\u7684\u5143\u7d20 r.lpush(\"rlist1\",3,4,5) r.lpush(\"rlist2\",3,4,5) while True: print(r.blpop([\"rlist1\",\"rlist2\"],timeout=0)) print(r.lrange(\"rlist1\",0,-1),r.lrange(\"rlist2\",0,-1)) '''keys: redis\u7684name\u7684\u96c6\u5408 timeout: \u8d85\u65f6\u65f6\u95f4\uff0c\u83b7\u53d6\u5b8c\u6240\u6709\u5217\u8868\u7684\u5143\u7d20\u4e4b\u540e\uff0c\u963b\u585e\u7b49\u5f85\u5217\u8868\u5185\u6709\u6570\u636e\u7684\u65f6\u95f4\uff08\u79d2\uff09, 0 \u8868\u793a\u6c38\u8fdc\u963b\u585e''' \u64cd\u4f5c\u8fc7\u7a0b In [86]: r.lpush(\"rlist2\",3,4,5) Out[86]: 3 In [87]: r.lpush(\"rlist1\",3,4,5) Out[87]: 3 127.0.0.1:6379> LRANGE rlist1 0 -1 1) \"5\" 2) \"4\" 3) \"3\" 127.0.0.1:6379> LRANGE rlist2 0 -1 1) \"5\" 2) \"4\" 3) \"3\" In [90]: r.blpop([\"rlist1\",\"rlist2\"],timeout=0) Out[90]: (b'rlist1', b'5') 127.0.0.1:6379> LRANGE rlist1 0 -1 1) \"4\" 2) \"3\" 127.0.0.1:6379> LRANGE rlist2 0 -1 1) \"5\" 2) \"4\" 3) \"3\" 3.4.16 brpop \u00b6 r.brpop(keys, timeout) \u540cblpop\uff0c\u5c06\u591a\u4e2a\u5217\u8868\u6392\u5217,\u6309\u7167\u4ece\u53f3\u50cf\u5de6\u53bb\u79fb\u9664\u5404\u4e2a\u5217\u8868\u5185\u7684\u5143\u7d20 \u64cd\u4f5c\u8fc7\u7a0b 127.0.0.1:6379> flushall OK In [5]: r.lpush(\"list1\",1,2,3,4,5) Out[5]: 5 In [6]: r.lpush(\"list2\",1,2,3,4,5) Out[6]: 5 127.0.0.1:6379> LRANGE list1 0 -1 1) \"5\" 2) \"4\" 3) \"3\" 4) \"2\" 5) \"1\" 127.0.0.1:6379> LRANGE list2 0 -1 1) \"5\" 2) \"4\" 3) \"3\" 4) \"2\" 5) \"1\" In [7]: r.blpop([\"list1\",\"list2\"],timeout=0) Out[7]: (b'list1', b'5') 127.0.0.1:6379> LRANGE list1 0 -1 1) \"4\" 2) \"3\" 3) \"2\" 4) \"1\" 127.0.0.1:6379> LRANGE list2 0 -1 1) \"5\" 2) \"4\" 3) \"3\" 4) \"2\" 5) \"1\" 3.4 Set \u00b6 Set\u96c6\u5408\u5c31\u662f\u4e0d\u5141\u8bb8\u91cd\u590d\u7684\u5217\u8868 3.4.1 sadd \u00b6 sadd(name,values) \u7ed9name\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d\u6dfb\u52a0\u5143\u7d20 In [8]: r.sadd('set1','aa') Out[8]: 1 In [9]: r.sadd('set1','aa','bb') Out[9]: 1 127.0.0.1:6379> keys * 1) \"set1\" 2) \"list2\" 3) \"list1\" 4) \"list\" 127.0.0.1:6379> type set1 set 127.0.0.1:6379> SMEMBERS set1 1) \"bb\" 2) \"aa\" 3.4.2 smembers \u00b6 smembers(name) \u83b7\u53d6name\u5bf9\u5e94\u7684\u96c6\u5408\u7684\u6240\u6709\u6210\u5458 In [10]: r.smembers('set1') Out[10]: {b'aa', b'bb'} 3.4.3 scard \u00b6 scard(name) \u83b7\u53d6name\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e2a\u6570 In [11]: r.scard('set1') Out[11]: 2 3.4.4 sdiff \u00b6 sdiff(keys, *args) \u5728\u7b2c\u4e00\u4e2aset1\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d\u4e14\u4e0d\u5728\u5176\u4ed6name\u5bf9\u5e94\u7684\u96c6\u5408\u7684\u5143\u7d20\u96c6\u5408 In [13]: r.sadd(\"set1\",\"aa\",\"bb\") Out[13]: 0 In [14]: r.sadd(\"set2\",\"bb\",\"cc\") Out[14]: 2 In [15]: r.sadd(\"set3\",\"bb\",\"cc\",\"dd\") Out[15]: 3 In [16]: r.sdiff(\"set1\",\"set2\",\"set3\") Out[16]: {b'aa'} 3.4.5 sdiffstore \u00b6 sdiffstore(dest, keys, *args) \u76f8\u5f53\u4e8e\u628asdiff\u83b7\u53d6\u7684\u503c\u52a0\u5165\u5230dest\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d In [17]: r.sdiffstore('set_dest',\"set1\",\"set2\",\"set3\") Out[17]: 1 In [18]: r.smembers('set_dest') Out[18]: {b'aa'} 3.4.6 sinter \u00b6 sinter(keys, *args) \u83b7\u53d6\u591a\u4e2aname\u5bf9\u5e94\u96c6\u5408\u7684\u5e76\u96c6 In [19]: r.sinter('set1','set2','set3') Out[19]: {b'bb'} 3.4.7 sinterstore \u00b6 \u83b7\u53d6\u591a\u4e2a\u5bf9\u5e94\u96c6\u5408\u7684\u5e76\u96c6\uff0c\u518d\u8bb2\u5176\u52a0\u5165\u5230dest\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d In [20]: r.sinterstore('sinterstore','set1','set2','set3') Out[20]: 1 In [21]: r.smembers('sinterstore') Out[21]: {b'bb'} 3.4.8 sismember \u00b6 sismember(name, value) \u68c0\u67e5value\u662f\u5426\u662fname\u5bf9\u5e94\u7684\u96c6\u5408\u5185\u7684\u5143\u7d20 In [22]: r.sismember('set1','abc') Out[22]: False In [23]: r.sismember('set1','aa') Out[23]: True In [24]: r.smembers('set1') Out[24]: {b'aa', b'bb'} 3.4.9 smove \u00b6 smove(src, dst, value) \u628asrc \u96c6\u5408\u4e2d\u7684value\u503c\u79fb\u52a8\u5230dst\u96c6\u5408\u4e2d In [25]: r.smembers('set1') Out[25]: {b'aa', b'bb'} In [26]: r.smembers('set2') Out[26]: {b'bb', b'cc'} In [27]: r.smove('set1','set2','aa') Out[27]: True In [28]: r.smembers('set2') Out[28]: {b'aa', b'bb', b'cc'} In [29]: r.smembers('set1') Out[29]: {b'bb'} 3.4.10 spop \u00b6 spop(name) \u4ece\u96c6\u5408\u7684\u5de6\u4fa7\u79fb\u9664\u4e00\u4e2a\u5143\u7d20\uff0c\u5e76\u5c06\u5176\u8fd4\u56de In [36]: r.smembers('set2') Out[36]: {b'aa', b'bb', b'cc'} In [37]: r.spop('set2') Out[37]: b'aa' In [38]: r.smembers('set2') Out[38]: {b'bb', b'cc'} 3.4.11 srandmember \u00b6 srandmember(name, numbers) \u4ecename\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d\u968f\u673a\u83b7\u53d6numbers\u4e2a\u5143\u7d20 In [40]: r.sadd(\"set_random\",1,2,3,4,5,6) Out[40]: 6 In [41]: r.smembers('set_random') Out[41]: {b'1', b'2', b'3', b'4', b'5', b'6'} In [42]: r.srandmember('set_random',2) Out[42]: [b'1', b'2'] In [43]: r.srandmember('set_random',2) Out[43]: [b'5', b'2'] 3.4.12 srem \u00b6 srem(name, values) \u5220\u9664name\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d\u7684\u67d0\u4e9b\u503c In [45]: r.smembers('set') Out[45]: {b'1', b'2', b'3', b'4', b'5', b'6'} In [46]: r.srem('set','3') Out[46]: 1 In [47]: r.smembers('set') Out[47]: {b'1', b'2', b'4', b'5', b'6'} 3.4.14 sunion \u00b6 sunion(keys, *args) \u83b7\u53d6\u591a\u4e2aname\u5bf9\u5e94\u7684\u96c6\u5408\u7684\u5e76\u96c6 In [54]: r.sadd(\"set1\",1,2,3,4,5,6) Out[54]: 0 In [55]: r.sadd(\"set2\",4,5,6,7,8.9) Out[55]: 0 In [56]: r.sunion('set1','set2') Out[56]: {b'1', b'2', b'3', b'4', b'5', b'6', b'7', b'8.9', b'bb', b'cc'} 3.4.14 sunionstore \u00b6 sunionstore(dest,keys, *args) \u83b7\u53d6\u591a\u4e2aname\u5bf9\u5e94\u7684\u96c6\u5408\u7684\u5e76\u96c6\uff0c\u5e76\u5c06\u7ed3\u679c\u4fdd\u5b58\u5230dest\u96c6\u5408\u4e2d\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d In [57]: r.sunionstore('union_set','set1','set2') Out[57]: 10 In [58]: r.smembers('union_set') Out[58]: {b'1', b'2', b'3', b'4', b'5', b'6', b'7', b'8.9', b'bb', b'cc'} 3.5 \u6709\u5e8f\u96c6\u5408 \u00b6 \u5728\u96c6\u5408\u7684\u57fa\u7840\u4e0a\uff0c\u4e3a\u6bcf\u5143\u7d20\u6392\u5e8f\uff0c\u5143\u7d20\u7684\u6392\u5e8f\u9700\u8981\u6839\u636e\u53e6\u5916\u4e00\u4e2a\u503c\u6765\u8fdb\u884c\u6bd4\u8f83\uff0c\u6240\u4ee5\uff0c\u5bf9\u4e8e\u6709\u5e8f\u96c6\u5408\uff0c\u6bcf\u4e00\u4e2a\u5143\u7d20\u6709\u4e24\u4e2a\u503c\uff0c\u5373\uff1a\u503c\u548c\u5206\u6570\uff0c\u5206\u6570\u4e13\u95e8\u7528\u6765\u505a\u6392\u5e8f\u3002 3.5.1 zadd \u00b6 zadd(name, *args, **kwargs) \u5728name\u5bf9\u5e94\u7684\u6709\u5e8f\u96c6\u5408\u4e2d\u6dfb\u52a0\u5143\u7d20 In [59]: r.zadd(\"zset1\", \"a1\", 2, \"a2\", 3,\"a4\",5) Out[59]: 3 In [63]: r.zadd(\"zset2\",a=10,b=20) Out[63]: 2 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a1\" 2) \"2\" 3) \"a2\" 4) \"3\" 5) \"a4\" 6) \"5\" 127.0.0.1:6379> ZRANGE zset2 0 -1 WITHSCORES 1) \"a\" 2) \"10\" 3) \"b\" 4) \"20\" 3.5.2 zcard \u00b6 zcard(name) \u83b7\u53d6\u6709\u5e8f\u96c6\u5408\u5185\u5143\u7d20\u7684\u6570\u91cf In [64]: r.zcard('zset1') Out[64]: 3 In [65]: r.zcard('zset2') Out[65]: 2 3.5.3 zcount \u00b6 zcount(name, min, max) \u83b7\u53d6\u6709\u5e8f\u96c6\u5408\u4e2d\u5206\u6570\u5728[min,max]\u4e4b\u95f4\u7684\u4e2a\u6570 In [66]: r.zcount(\"zset1\",1,5) Out[66]: 3 3.5.4 zincrby \u00b6 zincrby(name, value, amount) \u81ea\u589e\u6709\u5e8f\u96c6\u5408\u5185value\u5bf9\u5e94\u7684\u5206\u6570 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a1\" 2) \"2\" 3) \"a2\" 4) \"3\" 5) \"a4\" 6) \"5\" In [68]: r.zincrby(\"zset1\",\"a1\",amount=2) Out[68]: 4.0 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a2\" 2) \"3\" 3) \"a1\" 4) \"4\" 5) \"a4\" 6) \"5\" \u672c\u6765a1=2 \u7136\u540e\u52a02\u540e\u53d8\u62104\u4e5f\u5c31\u662f a1=4,\u6240\u4ee5\u5411\u540e\u6392\u5217 3.5.5 zrange \u00b6 zrange( name, start, end, desc=False, withscores=False, score_cast_func=float) \u6309\u7167\u7d22\u5f15\u8303\u56f4\u83b7\u53d6name\u5bf9\u5e94\u7684\u6709\u5e8f\u96c6\u5408\u7684\u5143\u7d20 aa=r.zrange(\"zset_name\",0,1,desc=False,withscores=True,score_cast_func=int) print(aa) \u53c2\u6570\uff1a name redis\u7684name start \u6709\u5e8f\u96c6\u5408\u7d22\u5f15\u8d77\u59cb\u4f4d\u7f6e end \u6709\u5e8f\u96c6\u5408\u7d22\u5f15\u7ed3\u675f\u4f4d\u7f6e desc \u6392\u5e8f\u89c4\u5219\uff0c\u9ed8\u8ba4\u6309\u7167\u5206\u6570\u4ece\u5c0f\u5230\u5927\u6392\u5e8f withscores \u662f\u5426\u83b7\u53d6\u5143\u7d20\u7684\u5206\u6570\uff0c\u9ed8\u8ba4\u53ea\u83b7\u53d6\u5143\u7d20\u7684\u503c score_cast_func \u5bf9\u5206\u6570\u8fdb\u884c\u6570\u636e\u8f6c\u6362\u7684\u51fd\u6570 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a2\" 2) \"3\" 3) \"a1\" 4) \"4\" 5) \"a4\" 6) \"5\" In [69]: r.zrange('zset1',0,1) Out[69]: [b'a2', b'a1'] In [70]: r.zrange('zset1',0,-1) Out[70]: [b'a2', b'a1', b'a4'] 3.5.6 zrevrange \u00b6 zrevrange(name, start, end, withscores=False, score_cast_func=float) \u540czrange\uff0c\u96c6\u5408\u662f\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\u7684 In [71]: r.zrevrange('zset1',0,-1) Out[71]: [b'a4', b'a1', b'a2'] 3.5.7 zrank/zrevrank \u00b6 zrank(name, value)\u3001zrevrank(name, value) \u83b7\u53d6value\u503c\u5728name\u5bf9\u5e94\u7684\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u6392\u884c\u4f4d\u7f6e\uff08\u4ece0\u5f00\u59cb\uff09 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a2\" 2) \"3\" 3) \"a1\" 4) \"4\" 5) \"a4\" 6) \"5\" In [72]: r.zrank('zset1','a1') Out[72]: 1 In [73]: r.zrank('zset1','a2') Out[73]: 0 In [74]: r.zrevrank('zset1','a1') Out[74]: 1 3.5.8 zscore \u00b6 zscore(name, value) \u83b7\u53d6name\u5bf9\u5e94\u6709\u5e8f\u96c6\u5408\u4e2d value \u5bf9\u5e94\u7684\u5206\u6570 In [75]: r.zscore('zset1','a2') Out[75]: 3.0 3.5.9 zrem \u00b6 zrem(name, values) \u5220\u9664name\u5bf9\u5e94\u7684\u6709\u5e8f\u96c6\u5408\u4e2d\u503c\u662fvalues\u7684\u6210\u5458 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a2\" 2) \"3\" 3) \"a1\" 4) \"4\" 5) \"a4\" 6) \"5\" In [76]: r.zrem('zset1','a1','a2') Out[76]: 2 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a4\" 2) \"5\" 3.5.10 zremrangebyrank \u00b6 zremrangebyrank(name, min, max) \u6839\u636e\u6392\u884c\u8303\u56f4\u5220\u9664 127.0.0.1:6379> flushall OK In [78]: r.zadd('zset1',a1=10,a2=20,a3=30,a4=40,a5=50) Out[78]: 5 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a1\" 2) \"10\" 3) \"a2\" 4) \"20\" 5) \"a3\" 6) \"30\" 7) \"a4\" 8) \"40\" 9) \"a5\" 10) \"50\" In [80]: r.zremrangebyrank('zet1', 1, 20) Out[80]: 0 In [81]: r.zremrangebyrank('zset1', 1, 20) Out[81]: 4 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a1\" 2) \"10\" 3.5.11 zremrangebyscore \u00b6 zremrangebyscore(name, min, max) \u6839\u636e\u5206\u6570\u8303\u56f4\u5220\u9664 127.0.0.1:6379> flushall OK In [82]: r.zadd('zset1',a1=10,a2=20,a3=30,a4=40,a5=50) Out[82]: 5 127.0.0.1:6379> keys * 1) \"zset1\" 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a1\" 2) \"10\" 3) \"a2\" 4) \"20\" 5) \"a3\" 6) \"30\" 7) \"a4\" 8) \"40\" 9) \"a5\" 10) \"50\" In [83]: r.zremrangebyscore('zset1',1,30) Out[83]: 3 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a4\" 2) \"40\" 3) \"a5\" 4) \"50\" \u5206\u6570\u4ece 1 \u5230 30(include 30) \u7684\u90fd\u88ab\u5220\u9664\u4e86 3.5.12 zinterstore \u00b6 zinterstore(dest, keys, aggregate=None) In [84]: r.zadd(\"zset_name\", \"a1\", 6, \"a2\", 2,\"a3\",5) Out[84]: 3 In [85]: r.zadd('zset_name1', a1=7,b1=10, b2=5) Out[85]: 3 127.0.0.1:6379> ZRANGE zset_name 0 -1 WITHSCORES 1) \"a2\" 2) \"2\" 3) \"a3\" 4) \"5\" 5) \"a1\" 6) \"6\" 127.0.0.1:6379> ZRANGE zset_name1 0 -1 WITHSCORES 1) \"b2\" 2) \"5\" 3) \"a1\" 4) \"7\" 5) \"b1\" 6) \"10\" # \u83b7\u53d6\u4e24\u4e2a\u6709\u5e8f\u96c6\u5408\u7684\u4ea4\u96c6\u5e76\u653e\u5165dest\u96c6\u5408\uff0c\u5982\u679c\u9047\u5230\u76f8\u540c\u503c\u4e0d\u540c\u5206\u6570\uff0c\u5219\u6309\u7167aggregate\u8fdb\u884c\u64cd\u4f5c # aggregate\u7684\u503c\u4e3a: SUM MIN MAX In [86]: r.zinterstore(\"zset_name2\",(\"zset_name1\",\"zset_name\"),aggregate=\"MAX\") Out[86]: 1 127.0.0.1:6379> keys * 1) \"zset_name\" 2) \"zset_name2\" 3) \"zset_name1\" 4) \"zset1\" 127.0.0.1:6379> ZRANGE zset_name2 0 -1 WITHSCORES 1) \"a1\" 2) \"7\" 3.5.14 zunionstore \u00b6 zunionstore(dest, keys, aggregate=None) \u83b7\u53d6\u4e24\u4e2a\u6709\u5e8f\u96c6\u5408\u7684\u5e76\u96c6\u5e76\u653e\u5165dest\u96c6\u5408\uff0c\u5176\u4ed6\u540czinterstore\uff0c In [89]: r.zadd(\"zset_union_name1\", \"a1\", 6, \"a2\", 2,\"a3\",5) Out[89]: 3 In [90]: r.zadd('zset_union_name2', a1=7,b1=10, b2=5) Out[90]: 3 In [91]: r.zunionstore(\"zset_union_name\",(\"zset_union_name1\",\"zset_union_name2\"),aggregate=\"MAX\") Out[91]: 5 In [92]: print(r.zscan(\"zset_union_name\")) (0, [(b'a2', 2.0), (b'a3', 5.0), (b'b2', 5.0), (b'a1', 7.0), (b'b1', 10.0)]) 3.6 \u5176\u4ed6\u64cd\u4f5c \u00b6 3.6.1 delete \u00b6 delete(*names) #\u6839\u636ename\u5220\u9664redis\u4e2d\u7684\u4efb\u610f\u6570\u636e\u7c7b\u578b In [80]: r.exists('name') Out[80]: True In [81]: r.delete('name') Out[81]: 1 In [82]: r.exists('name') Out[82]: False In [83]: r.get('name') 3.6.2 exists \u00b6 exists(name) #\u68c0\u6d4bredis\u7684name\u662f\u5426\u5b58\u5728 In [79]: r.get('name') Out[79]: b'zhangsanlisi' In [80]: r.exists('name') Out[80]: True 3.6.3 keys \u00b6 keys(pattern='*') #\u6839\u636e* \uff1f\u7b49\u901a\u914d\u7b26\u5339\u914d\u83b7\u53d6redis\u7684name In [88]: r.keys(pattern='*') Out[88]: [b'num', b'k1', b'k2', b'mount', b'k3'] 3.6.4 expire \u00b6 expire(name ,time) # \u4e3a\u67d0\u4e2aname\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4 In [92]: r.get('k1') Out[92]: b'v1' In [93]: r.expire('k1',2) # \u914d\u7f6e\u8fc7\u671f\u65f6\u95f4\u4e3a2\u79d2 Out[93]: True In [94]: r.get('k1') 3.6.5 rename \u00b6 rename(src, dst) # \u91cd\u547d\u540d In [97]: r.rename('k2','k22') Out[97]: True In [98]: r.get('k2') In [99]: r.get('k22') Out[99]: b'v2' 3.6.6 move \u00b6 move(name, db)) # \u5c06redis\u7684\u67d0\u4e2a\u503c\u79fb\u52a8\u5230\u6307\u5b9a\u7684db\u4e0b In [105]: r.move('k3',2) Out[105]: True 127.0.0.1:6379> keys * 1) \"num\" 2) \"k22\" 3) \"mount\" 127.0.0.1:6379[3]> select 2 OK 127.0.0.1:6379[2]> keys * 1) \"k3\" 127.0.0.1:6379[2]> 3.6.7 randomkey \u00b6 randomkey() #\u968f\u673a\u83b7\u53d6\u4e00\u4e2aredis\u7684name\uff08\u4e0d\u5220\u9664\uff09 In [100]: r.randomkey() Out[100]: b'mount' In [101]: r.randomkey() Out[101]: b'k3' 3.6.8 type \u00b6 type(name) # \u83b7\u53d6name\u5bf9\u5e94\u503c\u7684\u7c7b\u578b In [102]: r.type('k3') Out[102]: b'string' 3.6.9 dbsize \u00b6 \u6570\u636e\u5e93\u4e2d\u591a\u5c11\u4e2a\u6761\u6570 In [96]: r.dbsize() Out[96]: 1 3.6.10 flushdb/flushall \u00b6 flushdb \u6e05\u7a7a\u6570\u636e\u5e93 flushall \u5220\u9664\u6240\u6709\u73b0\u6709\u7684\u6570\u636e\u5e93 In [97]: r.flushdb() Out[97]: True In [99]: r.flushall() Out[99]: True redis\u64cd\u4f5c 127.0.0.1:6379> SELECT 1 OK 127.0.0.1:6379[1]> set k1 1 OK 127.0.0.1:6379[1]> select 2 OK 127.0.0.1:6379[2]> set k2 2 OK 127.0.0.1:6379[2]> keys * 1) \"k2\" 127.0.0.1:6379[2]> FLUSHDB OK 127.0.0.1:6379[2]> keys * (empty list or set) 127.0.0.1:6379[2]> select 1 OK 127.0.0.1:6379[1]> keys * 1) \"k1\" 127.0.0.1:6379[1]> 127.0.0.1:6379[1]> 127.0.0.1:6379[1]> select 2 OK 127.0.0.1:6379[2]> set k2 2 OK 127.0.0.1:6379[2]> FLUSHALL OK 127.0.0.1:6379[2]> keys * (empty list or set) 127.0.0.1:6379[2]> select 1 OK 127.0.0.1:6379[1]> keys * (empty list or set) 3.6.11 save \u00b6 \u5f3a\u884c\u628a\u6570\u636e\u5e93\u4fdd\u5b58\u5230\u786c\u76d8\u3002\u4fdd\u5b58\u65f6\u963b\u585e In [98]: r.save() Out[98]: True","title":"1. redis"},{"location":"python/lib/nosql/redis/redis.index/#1","text":"Redis\u662f\u4e00\u4e2a\u57fa\u4e8e\u5185\u5b58\u7684\u9ad8\u6548\u7684\u952e\u503c\u578b\u975e\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u5b58\u53d6\u6548\u7387\u6781\u9ad8\uff0c\u800c\u4e14\u652f\u6301\u591a\u79cd\u5b58\u50a8\u6570\u636e\u7ed3\u6784\uff0c\u4f7f\u7528\u4e5f\u975e\u5e38\u7b80\u5355\u3002\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u5c31\u6765\u4ecb\u7ecd\u4e00\u4e0bPython\u7684Redis\u64cd\u4f5c\uff0c\u4e3b\u8981\u4ecb\u7ecdRedisPy\u8fd9\u4e2a\u5e93\u7684\u7528\u6cd5\u3002","title":"1. \u4ecb\u7ecd"},{"location":"python/lib/nosql/redis/redis.index/#11","text":"\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u8bf7\u786e\u4fdd\u5df2\u7ecf\u5b89\u88c5\u597d\u4e86Redis\u53caRedisPy\u5e93\u3002\u5982\u679c\u8981\u505a\u6570\u636e\u5bfc\u5165/\u5bfc\u51fa\u64cd\u4f5c\u7684\u8bdd\uff0c\u8fd8\u9700\u8981\u5b89\u88c5RedisDump\u3002","title":"1.1 \u51c6\u5907\u5de5\u4f5c"},{"location":"python/lib/nosql/redis/redis.index/#12-redis-strictredis","text":"RedisPy\u5e93\u63d0\u4f9b\u4e24\u4e2a\u7c7bRedis\u548cStrictRedis\u6765\u5b9e\u73b0Redis\u7684\u547d\u4ee4\u64cd\u4f5c\u3002 StrictRedis\u5b9e\u73b0\u4e86\u7edd\u5927\u90e8\u5206\u5b98\u65b9\u7684\u547d\u4ee4\uff0c\u53c2\u6570\u4e5f\u4e00\u4e00\u5bf9\u5e94\uff0c\u6bd4\u5982set()\u65b9\u6cd5\u5c31\u5bf9\u5e94Redis\u547d\u4ee4\u7684set\u65b9\u6cd5\u3002\u800cRedis\u662fStrictRedis\u7684\u5b50\u7c7b\uff0c\u5b83\u7684\u4e3b\u8981\u529f\u80fd\u662f\u7528\u4e8e\u5411\u540e\u517c\u5bb9\u65e7\u7248\u672c\u5e93\u91cc\u7684\u51e0\u4e2a\u65b9\u6cd5\u3002\u4e3a\u4e86\u505a\u517c\u5bb9\uff0c\u5b83\u5c06\u65b9\u6cd5\u505a\u4e86\u6539\u5199\uff0c\u6bd4\u5982lrem()\u65b9\u6cd5\u5c31\u5c06value\u548cnum\u53c2\u6570\u7684\u4f4d\u7f6e\u4e92\u6362\uff0c\u8fd9\u548cRedis\u547d\u4ee4\u884c\u7684\u547d\u4ee4\u53c2\u6570\u4e0d\u4e00\u81f4\u3002\u5b98\u65b9\u63a8\u8350\u4f7f\u7528StrictRedis","title":"1.2 Redis StrictRedis"},{"location":"python/lib/nosql/redis/redis.index/#13","text":"Redis \u548c python\u64cd\u4f5c\u6a21\u5757 \u5b89\u88c5 \u53ca \u542f\u52a8 - ubuntu\u7cfb\u7edf apt-get install redis-server pip3 install Redis /etc/init.d/redis-server restart centos\u7cfb\u7edf yum install redis-server pip3 install Redis /etc/init.d/redis-server restart \u67e5\u770b\u7248\u672c\uff1a redis-cli info # redis\u8be6\u7ec6\u4fe1\u606f redis-cli --version | redis-cli -v redis-server --version | redis-server -v - \u7b80\u5355\u4f7f\u7528\uff1a 127.0.0.1:6379> set name 'keke' # \u8bbe\u7f6e \u952e\u4e3aname \u5bf9\u5e94\u7684\u503c\u4e3akeke OK 127.0.0.1:6379> set age '3' OK 127.0.0.1:6379> keys * # \u67e5\u770b\u6240\u6709\u7684\u952e 1) \"age\" 2) \"name\" 127.0.0.1:6379> get name # \u67e5\u770b\u952e\u4e3aname\u5bf9\u5e94\u7684\u503c \"keke\" 127.0.0.1:6379> get age \"3\" 127.0.0.1:6379> set sex female ex 2 # \u8bbe\u7f6e\u503c\uff0c\u53ea\u5b58\u6d3b2\u79d2 OK 127.0.0.1:6379> keys * 1) \"age\" 2) \"name\" 127.0.0.1:6379> set sex female ex 10 OK 127.0.0.1:6379> keys * 1) \"age\" 2) \"sex\" 3) \"name\" 127.0.0.1:6379> get sex \"female\" 127.0.0.1:6379> keys * 1) \"age\" 2) \"name\" 127.0.0.1:6379> flushdb # \u6e05\u7a7a\u5f53\u524ddb\u4e0b\u7684\u6240\u6709\u952e\u503c\uff0c\u8c28\u614e\u64cd\u4f5c OK 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> 127.0.0.1:6379> flushall # \u6e05\u7a7a\u6240\u6709db\u4e0b\u7684\u952e\u503c OK","title":"1.3 \u5b89\u88c5"},{"location":"python/lib/nosql/redis/redis.index/#2","text":"","title":"2. \u57fa\u672c\u547d\u4ee4"},{"location":"python/lib/nosql/redis/redis.index/#21-redis-key","text":"Redis keys \u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 DEL key \u8be5\u547d\u4ee4\u7528\u4e8e\u5728 key \u5b58\u5728\u65f6\u5220\u9664 key\u3002 DUMP key \u5e8f\u5217\u5316\u7ed9\u5b9a key \uff0c\u5e76\u8fd4\u56de\u88ab\u5e8f\u5217\u5316\u7684\u503c\u3002 EXISTS key \u68c0\u67e5\u7ed9\u5b9a key \u662f\u5426\u5b58\u5728\u3002 EXPIRE key seconds \u4e3a\u7ed9\u5b9a key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u79d2\u8ba1\u3002 EXPIREAT key timestamp EXPIREAT \u7684\u4f5c\u7528\u548c EXPIRE \u7c7b\u4f3c\uff0c\u90fd\u7528\u4e8e\u4e3a key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u3002 \u4e0d\u540c\u5728\u4e8e EXPIREAT \u547d\u4ee4\u63a5\u53d7\u7684\u65f6\u95f4\u53c2\u6570\u662f UNIX \u65f6\u95f4\u6233(unix timestamp)\u3002 PEXPIRE key milliseconds \u8bbe\u7f6e key \u7684\u8fc7\u671f\u65f6\u95f4\u4ee5\u6beb\u79d2\u8ba1\u3002 PEXPIREAT key milliseconds-timestamp \u8bbe\u7f6e key \u8fc7\u671f\u65f6\u95f4\u7684\u65f6\u95f4\u6233(unix timestamp) \u4ee5\u6beb\u79d2\u8ba1 KEYS pattern \u67e5\u627e\u6240\u6709\u7b26\u5408\u7ed9\u5b9a\u6a21\u5f0f( pattern)\u7684 key \u3002 MOVE key db \u5c06\u5f53\u524d\u6570\u636e\u5e93\u7684 key \u79fb\u52a8\u5230\u7ed9\u5b9a\u7684\u6570\u636e\u5e93 db \u5f53\u4e2d\u3002 PERSIST key \u79fb\u9664 key \u7684\u8fc7\u671f\u65f6\u95f4\uff0ckey \u5c06\u6301\u4e45\u4fdd\u6301\u3002 PTTL key \u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u8fd4\u56de key \u7684\u5269\u4f59\u7684\u8fc7\u671f\u65f6\u95f4\u3002 TTL key \u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0c\u8fd4\u56de\u7ed9\u5b9a key \u7684\u5269\u4f59\u751f\u5b58\u65f6\u95f4(TTL, time to live)\u3002 RANDOMKEY \u4ece\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u968f\u673a\u8fd4\u56de\u4e00\u4e2a key \u3002 RENAME key newkey \u4fee\u6539 key \u7684\u540d\u79f0 RENAMENX key newkey \u4ec5\u5f53 newkey \u4e0d\u5b58\u5728\u65f6\uff0c\u5c06 key \u6539\u540d\u4e3a newkey \u3002 TYPE key \u8fd4\u56de key \u6240\u50a8\u5b58\u7684\u503c\u7684\u7c7b\u578b\u3002","title":"2.1 redis key\u547d\u4ee4"},{"location":"python/lib/nosql/redis/redis.index/#22-redis","text":"Redis \u5b57\u7b26\u4e32\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 SET key value \u8bbe\u7f6e\u6307\u5b9a key \u7684\u503c GET key \u83b7\u53d6\u6307\u5b9a key \u7684\u503c\u3002 GETRANGE key start end \u8fd4\u56de key \u4e2d\u5b57\u7b26\u4e32\u503c\u7684\u5b50\u5b57\u7b26 GETSET key value \u5c06\u7ed9\u5b9a key \u7684\u503c\u8bbe\u4e3a value \uff0c\u5e76\u8fd4\u56de key \u7684\u65e7\u503c(old value)\u3002 GETBIT key offset \u5bf9 key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\uff0c\u83b7\u53d6\u6307\u5b9a\u504f\u79fb\u91cf\u4e0a\u7684\u4f4d(bit)\u3002 MGET key1 [key2..] \u83b7\u53d6\u6240\u6709(\u4e00\u4e2a\u6216\u591a\u4e2a)\u7ed9\u5b9a key \u7684\u503c\u3002 SETBIT key offset value \u5bf9 key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\uff0c\u8bbe\u7f6e\u6216\u6e05\u9664\u6307\u5b9a\u504f\u79fb\u91cf\u4e0a\u7684\u4f4d(bit)\u3002 SETEX key seconds value \u5c06\u503c value \u5173\u8054\u5230 key \uff0c\u5e76\u5c06 key \u7684\u8fc7\u671f\u65f6\u95f4\u8bbe\u4e3a seconds (\u4ee5\u79d2\u4e3a\u5355\u4f4d)\u3002 SETNX key value \u53ea\u6709\u5728 key \u4e0d\u5b58\u5728\u65f6\u8bbe\u7f6e key \u7684\u503c\u3002 SETRANGE key offset value \u7528 value \u53c2\u6570\u8986\u5199\u7ed9\u5b9a key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\uff0c\u4ece\u504f\u79fb\u91cf offset \u5f00\u59cb\u3002 STRLEN key \u8fd4\u56de key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\u7684\u957f\u5ea6\u3002 MSET key value [key value ...] \u540c\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u6216\u591a\u4e2a key-value \u5bf9\u3002 MSETNX key value [key value ...] \u540c\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u6216\u591a\u4e2a key-value \u5bf9\uff0c\u5f53\u4e14\u4ec5\u5f53\u6240\u6709\u7ed9\u5b9a key \u90fd\u4e0d\u5b58\u5728\u3002 PSETEX key milliseconds value \u8fd9\u4e2a\u547d\u4ee4\u548c SETEX \u547d\u4ee4\u76f8\u4f3c\uff0c\u4f46\u5b83\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u8bbe\u7f6e key \u7684\u751f\u5b58\u65f6\u95f4\uff0c\u800c\u4e0d\u662f\u50cf SETEX \u547d\u4ee4\u90a3\u6837\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002 INCR key \u5c06 key \u4e2d\u50a8\u5b58\u7684\u6570\u5b57\u503c\u589e\u4e00\u3002 INCRBY key increment \u5c06 key \u6240\u50a8\u5b58\u7684\u503c\u52a0\u4e0a\u7ed9\u5b9a\u7684\u589e\u91cf\u503c\uff08increment\uff09 \u3002 INCRBYFLOAT key increment \u5c06 key \u6240\u50a8\u5b58\u7684\u503c\u52a0\u4e0a\u7ed9\u5b9a\u7684\u6d6e\u70b9\u589e\u91cf\u503c\uff08increment\uff09 \u3002 DECR key \u5c06 key \u4e2d\u50a8\u5b58\u7684\u6570\u5b57\u503c\u51cf\u4e00\u3002 DECRBY key decrement key \u6240\u50a8\u5b58\u7684\u503c\u51cf\u53bb\u7ed9\u5b9a\u7684\u51cf\u91cf\u503c\uff08decrement\uff09 \u3002 APPEND key value \u5982\u679c key \u5df2\u7ecf\u5b58\u5728\u5e76\u4e14\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c APPEND \u547d\u4ee4\u5c06\u6307\u5b9a\u7684 value \u8ffd\u52a0\u5230\u8be5 key \u539f\u6765\u503c\uff08value\uff09\u7684\u672b\u5c3e\u3002","title":"2.2 redis \u5b57\u7b26\u4e32\u547d\u4ee4"},{"location":"python/lib/nosql/redis/redis.index/#23-redis-hash","text":"Redis hash \u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 HDEL key field1 [field2] \u5220\u9664\u4e00\u4e2a\u6216\u591a\u4e2a\u54c8\u5e0c\u8868\u5b57\u6bb5 HEXISTS key field \u67e5\u770b\u54c8\u5e0c\u8868 key \u4e2d\uff0c\u6307\u5b9a\u7684\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u3002 HGET key field \u83b7\u53d6\u5b58\u50a8\u5728\u54c8\u5e0c\u8868\u4e2d\u6307\u5b9a\u5b57\u6bb5\u7684\u503c\u3002 HGETALL key \u83b7\u53d6\u5728\u54c8\u5e0c\u8868\u4e2d\u6307\u5b9a key \u7684\u6240\u6709\u5b57\u6bb5\u548c\u503c HINCRBY key field increment \u4e3a\u54c8\u5e0c\u8868 key \u4e2d\u7684\u6307\u5b9a\u5b57\u6bb5\u7684\u6574\u6570\u503c\u52a0\u4e0a\u589e\u91cf increment \u3002 HINCRBYFLOAT key field increment \u4e3a\u54c8\u5e0c\u8868 key \u4e2d\u7684\u6307\u5b9a\u5b57\u6bb5\u7684\u6d6e\u70b9\u6570\u503c\u52a0\u4e0a\u589e\u91cf increment \u3002 HKEYS key \u83b7\u53d6\u6240\u6709\u54c8\u5e0c\u8868\u4e2d\u7684\u5b57\u6bb5 HLEN key \u83b7\u53d6\u54c8\u5e0c\u8868\u4e2d\u5b57\u6bb5\u7684\u6570\u91cf HMGET key field1 [field2] \u83b7\u53d6\u6240\u6709\u7ed9\u5b9a\u5b57\u6bb5\u7684\u503c HMSET key field1 value1 [field2 value2 ] \u540c\u65f6\u5c06\u591a\u4e2a field-value (\u57df-\u503c)\u5bf9\u8bbe\u7f6e\u5230\u54c8\u5e0c\u8868 key \u4e2d\u3002 HSET key field value \u5c06\u54c8\u5e0c\u8868 key \u4e2d\u7684\u5b57\u6bb5 field \u7684\u503c\u8bbe\u4e3a value \u3002 HSETNX key field value \u53ea\u6709\u5728\u5b57\u6bb5 field \u4e0d\u5b58\u5728\u65f6\uff0c\u8bbe\u7f6e\u54c8\u5e0c\u8868\u5b57\u6bb5\u7684\u503c\u3002 HVALS key \u83b7\u53d6\u54c8\u5e0c\u8868\u4e2d\u6240\u6709\u503c HSCAN key cursor [MATCH pattern] [COUNT count] \u8fed\u4ee3\u54c8\u5e0c\u8868\u4e2d\u7684\u952e\u503c\u5bf9\u3002","title":"2.3 redis hash\u4e32\u547d\u4ee4"},{"location":"python/lib/nosql/redis/redis.index/#24-redis","text":"Redis \u5217\u8868\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 BLPOP key1 [key2 ] timeout \u79fb\u51fa\u5e76\u83b7\u53d6\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c \u5982\u679c\u5217\u8868\u6ca1\u6709\u5143\u7d20\u4f1a\u963b\u585e\u5217\u8868\u76f4\u5230\u7b49\u5f85\u8d85\u65f6\u6216\u53d1\u73b0\u53ef\u5f39\u51fa\u5143\u7d20\u4e3a\u6b62\u3002 BRPOP key1 [key2 ] timeout \u79fb\u51fa\u5e76\u83b7\u53d6\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c \u5982\u679c\u5217\u8868\u6ca1\u6709\u5143\u7d20\u4f1a\u963b\u585e\u5217\u8868\u76f4\u5230\u7b49\u5f85\u8d85\u65f6\u6216\u53d1\u73b0\u53ef\u5f39\u51fa\u5143\u7d20\u4e3a\u6b62\u3002 BRPOPLPUSH source destination timeout \u4ece\u5217\u8868\u4e2d\u5f39\u51fa\u4e00\u4e2a\u503c\uff0c\u5c06\u5f39\u51fa\u7684\u5143\u7d20\u63d2\u5165\u5230\u53e6\u5916\u4e00\u4e2a\u5217\u8868\u4e2d\u5e76\u8fd4\u56de\u5b83\uff1b \u5982\u679c\u5217\u8868\u6ca1\u6709\u5143\u7d20\u4f1a\u963b\u585e\u5217\u8868\u76f4\u5230\u7b49\u5f85\u8d85\u65f6\u6216\u53d1\u73b0\u53ef\u5f39\u51fa\u5143\u7d20\u4e3a\u6b62\u3002 LINDEX key index \u901a\u8fc7\u7d22\u5f15\u83b7\u53d6\u5217\u8868\u4e2d\u7684\u5143\u7d20 LINSERT key BEFORE AFTER pivot value LLEN key \u83b7\u53d6\u5217\u8868\u957f\u5ea6 LPOP key \u79fb\u51fa\u5e76\u83b7\u53d6\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20 LPUSH key value1 [value2] \u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u503c\u63d2\u5165\u5230\u5217\u8868\u5934\u90e8 LPUSHX key value \u5c06\u4e00\u4e2a\u503c\u63d2\u5165\u5230\u5df2\u5b58\u5728\u7684\u5217\u8868\u5934\u90e8 LRANGE key start stop \u83b7\u53d6\u5217\u8868\u6307\u5b9a\u8303\u56f4\u5185\u7684\u5143\u7d20 LREM key count value \u79fb\u9664\u5217\u8868\u5143\u7d20 LSET key index value \u901a\u8fc7\u7d22\u5f15\u8bbe\u7f6e\u5217\u8868\u5143\u7d20\u7684\u503c LTRIM key start stop \u5bf9\u4e00\u4e2a\u5217\u8868\u8fdb\u884c\u4fee\u526a(trim)\uff0c\u5c31\u662f\u8bf4\uff0c\u8ba9\u5217\u8868\u53ea\u4fdd\u7559\u6307\u5b9a\u533a\u95f4\u5185\u7684\u5143\u7d20\uff0c\u4e0d\u5728\u6307\u5b9a\u533a\u95f4\u4e4b\u5185\u7684\u5143\u7d20\u90fd\u5c06\u88ab\u5220\u9664\u3002 RPOP key \u79fb\u9664\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u8fd4\u56de\u503c\u4e3a\u79fb\u9664\u7684\u5143\u7d20\u3002 RPOPLPUSH source destination \u79fb\u9664\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u5e76\u5c06\u8be5\u5143\u7d20\u6dfb\u52a0\u5230\u53e6\u4e00\u4e2a\u5217\u8868\u5e76\u8fd4\u56de RPUSH key value1 [value2] \u5728\u5217\u8868\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u503c RPUSHX key value \u4e3a\u5df2\u5b58\u5728\u7684\u5217\u8868\u6dfb\u52a0\u503c","title":"2.4 redis \u5217\u8868\u547d\u4ee4"},{"location":"python/lib/nosql/redis/redis.index/#25-redis","text":"Redis \u96c6\u5408\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 SADD key member1 [member2] \u5411\u96c6\u5408\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458 SCARD key \u83b7\u53d6\u96c6\u5408\u7684\u6210\u5458\u6570 SDIFF key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u5dee\u96c6 SDIFFSTORE destination key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u5dee\u96c6\u5e76\u5b58\u50a8\u5728 destination \u4e2d SINTER key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u4ea4\u96c6 SINTERSTORE destination key1 [key2] \u8fd4\u56de\u7ed9\u5b9a\u6240\u6709\u96c6\u5408\u7684\u4ea4\u96c6\u5e76\u5b58\u50a8\u5728 destination \u4e2d SISMEMBER key member \u5224\u65ad member \u5143\u7d20\u662f\u5426\u662f\u96c6\u5408 key \u7684\u6210\u5458 SMEMBERS key \u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u6240\u6709\u6210\u5458 SMOVE source destination member \u5c06 member \u5143\u7d20\u4ece source \u96c6\u5408\u79fb\u52a8\u5230 destination \u96c6\u5408 SPOP key \u79fb\u9664\u5e76\u8fd4\u56de\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u968f\u673a\u5143\u7d20 SRANDMEMBER key [count] \u8fd4\u56de\u96c6\u5408\u4e2d\u4e00\u4e2a\u6216\u591a\u4e2a\u968f\u673a\u6570 SREM key member1 [member2] \u79fb\u9664\u96c6\u5408\u4e2d\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458 SUNION key1 [key2] \u8fd4\u56de\u6240\u6709\u7ed9\u5b9a\u96c6\u5408\u7684\u5e76\u96c6 SUNIONSTORE destination key1 [key2] \u6240\u6709\u7ed9\u5b9a\u96c6\u5408\u7684\u5e76\u96c6\u5b58\u50a8\u5728 destination \u96c6\u5408\u4e2d SSCAN key cursor [MATCH pattern] [COUNT count] \u8fed\u4ee3\u96c6\u5408\u4e2d\u7684\u5143\u7d20","title":"2.5 redis \u5217\u8868\u96c6\u5408\u547d\u4ee4"},{"location":"python/lib/nosql/redis/redis.index/#26-redis","text":"Redis \u6709\u5e8f\u96c6\u5408\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 ZADD key score1 member1 [score2 member2] \u5411\u6709\u5e8f\u96c6\u5408\u6dfb\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458\uff0c\u6216\u8005\u66f4\u65b0\u5df2\u5b58\u5728\u6210\u5458\u7684\u5206\u6570 ZCARD key \u83b7\u53d6\u6709\u5e8f\u96c6\u5408\u7684\u6210\u5458\u6570 ZCOUNT key min max \u8ba1\u7b97\u5728\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u533a\u95f4\u5206\u6570\u7684\u6210\u5458\u6570 ZINCRBY key increment member \u6709\u5e8f\u96c6\u5408\u4e2d\u5bf9\u6307\u5b9a\u6210\u5458\u7684\u5206\u6570\u52a0\u4e0a\u589e\u91cf increment ZINTERSTORE destination numkeys key [key ...] \u8ba1\u7b97\u7ed9\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6709\u5e8f\u96c6\u7684\u4ea4\u96c6\u5e76\u5c06\u7ed3\u679c\u96c6\u5b58\u50a8\u5728\u65b0\u7684\u6709\u5e8f\u96c6\u5408 key \u4e2d ZLEXCOUNT key min max \u5728\u6709\u5e8f\u96c6\u5408\u4e2d\u8ba1\u7b97\u6307\u5b9a\u5b57\u5178\u533a\u95f4\u5185\u6210\u5458\u6570\u91cf ZRANGE key start stop [WITHSCORES] \u901a\u8fc7\u7d22\u5f15\u533a\u95f4\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u6210\u6307\u5b9a\u533a\u95f4\u5185\u7684\u6210\u5458 ZRANGEBYLEX key min max [LIMIT offset count] \u901a\u8fc7\u5b57\u5178\u533a\u95f4\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u7684\u6210\u5458 ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT] \u901a\u8fc7\u5206\u6570\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u6307\u5b9a\u533a\u95f4\u5185\u7684\u6210\u5458 ZRANK key member \u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u6210\u5458\u7684\u7d22\u5f15 ZREM key member [member ...] \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6210\u5458 ZREMRANGEBYLEX key min max \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7ed9\u5b9a\u7684\u5b57\u5178\u533a\u95f4\u7684\u6240\u6709\u6210\u5458 ZREMRANGEBYRANK key start stop \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7ed9\u5b9a\u7684\u6392\u540d\u533a\u95f4\u7684\u6240\u6709\u6210\u5458 ZREMRANGEBYSCORE key min max \u79fb\u9664\u6709\u5e8f\u96c6\u5408\u4e2d\u7ed9\u5b9a\u7684\u5206\u6570\u533a\u95f4\u7684\u6240\u6709\u6210\u5458 ZREVRANGE key start stop [WITHSCORES] \u8fd4\u56de\u6709\u5e8f\u96c6\u4e2d\u6307\u5b9a\u533a\u95f4\u5185\u7684\u6210\u5458\uff0c\u901a\u8fc7\u7d22\u5f15\uff0c\u5206\u6570\u4ece\u9ad8\u5230\u5e95 ZREVRANGEBYSCORE key max min [WITHSCORES] \u8fd4\u56de\u6709\u5e8f\u96c6\u4e2d\u6307\u5b9a\u5206\u6570\u533a\u95f4\u5185\u7684\u6210\u5458\uff0c\u5206\u6570\u4ece\u9ad8\u5230\u4f4e\u6392\u5e8f ZREVRANK key member \u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u6210\u5458\u7684\u6392\u540d\uff0c\u6709\u5e8f\u96c6\u6210\u5458\u6309\u5206\u6570\u503c\u9012\u51cf(\u4ece\u5927\u5230\u5c0f)\u6392\u5e8f ZSCORE key member \u8fd4\u56de\u6709\u5e8f\u96c6\u4e2d\uff0c\u6210\u5458\u7684\u5206\u6570\u503c ZUNIONSTORE destination numkeys key [key ...] \u8ba1\u7b97\u7ed9\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6709\u5e8f\u96c6\u7684\u5e76\u96c6\uff0c\u5e76\u5b58\u50a8\u5728\u65b0\u7684 key \u4e2d ZSCAN key cursor [MATCH pattern] [COUNT count] \u8fed\u4ee3\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u5143\u7d20\uff08\u5305\u62ec\u5143\u7d20\u6210\u5458\u548c\u5143\u7d20\u5206\u503c\uff09","title":"2.6 redis \u5217\u6709\u5e8f\u96c6\u5408\u547d\u4ee4"},{"location":"python/lib/nosql/redis/redis.index/#27-redis-hyperloglog","text":"Redis HyperLogLog \u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 PFADD key element [element ...] \u6dfb\u52a0\u6307\u5b9a\u5143\u7d20\u5230 HyperLogLog \u4e2d\u3002 PFCOUNT key [key ...] \u8fd4\u56de\u7ed9\u5b9a HyperLogLog \u7684\u57fa\u6570\u4f30\u7b97\u503c\u3002 PFMERGE destkey sourcekey [sourcekey ...] \u5c06\u591a\u4e2a HyperLogLog \u5408\u5e76\u4e3a\u4e00\u4e2a HyperLogLog","title":"2.7 redis HyperLogLog\u547d\u4ee4"},{"location":"python/lib/nosql/redis/redis.index/#28-redis","text":"Redis \u53d1\u5e03\u8ba2\u9605\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 PSUBSCRIBE pattern [pattern ...] \u8ba2\u9605\u4e00\u4e2a\u6216\u591a\u4e2a\u7b26\u5408\u7ed9\u5b9a\u6a21\u5f0f\u7684\u9891\u9053\u3002 PUBSUB subcommand [argument [argument ...]] \u67e5\u770b\u8ba2\u9605\u4e0e\u53d1\u5e03\u7cfb\u7edf\u72b6\u6001\u3002 PUBLISH channel message \u5c06\u4fe1\u606f\u53d1\u9001\u5230\u6307\u5b9a\u7684\u9891\u9053\u3002 PUNSUBSCRIBE [pattern [pattern ...]] \u9000\u8ba2\u6240\u6709\u7ed9\u5b9a\u6a21\u5f0f\u7684\u9891\u9053\u3002 SUBSCRIBE channel [channel ...] \u8ba2\u9605\u7ed9\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u9891\u9053\u7684\u4fe1\u606f\u3002 UNSUBSCRIBE [channel [channel ...]] \u6307\u9000\u8ba2\u7ed9\u5b9a\u7684\u9891\u9053\u3002","title":"2.8 redis \u53d1\u5e03\u8ba2\u9605\u547d\u4ee4"},{"location":"python/lib/nosql/redis/redis.index/#29-redis","text":"Redis \u4e8b\u52a1\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 DISCARD \u53d6\u6d88\u4e8b\u52a1\uff0c\u653e\u5f03\u6267\u884c\u4e8b\u52a1\u5757\u5185\u7684\u6240\u6709\u547d\u4ee4\u3002 EXEC \u6267\u884c\u6240\u6709\u4e8b\u52a1\u5757\u5185\u7684\u547d\u4ee4\u3002 MULTI \u6807\u8bb0\u4e00\u4e2a\u4e8b\u52a1\u5757\u7684\u5f00\u59cb\u3002 UNWATCH \u53d6\u6d88 WATCH \u547d\u4ee4\u5bf9\u6240\u6709 key \u7684\u76d1\u89c6\u3002 WATCH key [key ...] \u76d1\u89c6\u4e00\u4e2a(\u6216\u591a\u4e2a) key \uff0c\u5982\u679c\u5728\u4e8b\u52a1\u6267\u884c\u4e4b\u524d\u8fd9\u4e2a(\u6216\u8fd9\u4e9b) key \u88ab\u5176\u4ed6\u547d\u4ee4\u6240\u6539\u52a8\uff0c\u90a3\u4e48\u4e8b\u52a1\u5c06\u88ab\u6253\u65ad","title":"2.9 redis \u4e8b\u52a1\u547d\u4ee4"},{"location":"python/lib/nosql/redis/redis.index/#210-redis","text":"Redis \u811a\u672c\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 EVAL script numkeys key [key ...] arg [arg ...] \u6267\u884c Lua \u811a\u672c\u3002 EVALSHA sha1 numkeys key [key ...] arg [arg ...] \u6267\u884c Lua \u811a\u672c\u3002 SCRIPT EXISTS script [script ...] \u67e5\u770b\u6307\u5b9a\u7684\u811a\u672c\u662f\u5426\u5df2\u7ecf\u88ab\u4fdd\u5b58\u5728\u7f13\u5b58\u5f53\u4e2d\u3002 SCRIPT FLUSH \u4ece\u811a\u672c\u7f13\u5b58\u4e2d\u79fb\u9664\u6240\u6709\u811a\u672c\u3002 SCRIPT KILL \u6740\u6b7b\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684 Lua \u811a\u672c\u3002 SCRIPT LOAD script \u5c06\u811a\u672c script \u6dfb\u52a0\u5230\u811a\u672c\u7f13\u5b58\u4e2d\uff0c\u4f46\u5e76\u4e0d\u7acb\u5373\u6267\u884c\u8fd9\u4e2a\u811a\u672c\u3002","title":"2.10 redis \u811a\u672c\u547d\u4ee4"},{"location":"python/lib/nosql/redis/redis.index/#211-redis","text":"Redis \u8fde\u63a5\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 AUTH password \u9a8c\u8bc1\u5bc6\u7801\u662f\u5426\u6b63\u786e ECHO message \u6253\u5370\u5b57\u7b26\u4e32 PING \u67e5\u770b\u670d\u52a1\u662f\u5426\u8fd0\u884c QUIT \u5173\u95ed\u5f53\u524d\u8fde\u63a5 SELECT index \u5207\u6362\u5230\u6307\u5b9a\u7684\u6570\u636e\u5e93","title":"2.11 redis \u94fe\u63a5\u547d\u4ee4"},{"location":"python/lib/nosql/redis/redis.index/#212-redis","text":"Redis \u670d\u52a1\u5668\u547d\u4ee4 \u547d\u4ee4\u53ca\u63cf\u8ff0 BGREWRITEAOF \u5f02\u6b65\u6267\u884c\u4e00\u4e2a AOF\uff08AppendOnly File\uff09 \u6587\u4ef6\u91cd\u5199\u64cd\u4f5c BGSAVE \u5728\u540e\u53f0\u5f02\u6b65\u4fdd\u5b58\u5f53\u524d\u6570\u636e\u5e93\u7684\u6570\u636e\u5230\u78c1\u76d8 CLIENT KILL [ip:port] [ID client-id] \u5173\u95ed\u5ba2\u6237\u7aef\u8fde\u63a5 CLIENT LIST \u83b7\u53d6\u8fde\u63a5\u5230\u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u5217\u8868 CLIENT GETNAME \u83b7\u53d6\u8fde\u63a5\u7684\u540d\u79f0 CLIENT PAUSE timeout \u5728\u6307\u5b9a\u65f6\u95f4\u5185\u7ec8\u6b62\u8fd0\u884c\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u547d\u4ee4 CLIENT SETNAME connection-name \u8bbe\u7f6e\u5f53\u524d\u8fde\u63a5\u7684\u540d\u79f0 CLUSTER SLOTS \u83b7\u53d6\u96c6\u7fa4\u8282\u70b9\u7684\u6620\u5c04\u6570\u7ec4 COMMAND \u83b7\u53d6 Redis \u547d\u4ee4\u8be6\u60c5\u6570\u7ec4 COMMAND COUNT \u83b7\u53d6 Redis \u547d\u4ee4\u603b\u6570 COMMAND GETKEYS \u83b7\u53d6\u7ed9\u5b9a\u547d\u4ee4\u7684\u6240\u6709\u952e TIME \u8fd4\u56de\u5f53\u524d\u670d\u52a1\u5668\u65f6\u95f4 COMMAND INFO command-name [command-name ...] \u83b7\u53d6\u6307\u5b9a Redis \u547d\u4ee4\u63cf\u8ff0\u7684\u6570\u7ec4 CONFIG GET parameter \u83b7\u53d6\u6307\u5b9a\u914d\u7f6e\u53c2\u6570\u7684\u503c CONFIG REWRITE \u5bf9\u542f\u52a8 Redis \u670d\u52a1\u5668\u65f6\u6240\u6307\u5b9a\u7684 redis.conf \u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u6539\u5199 CONFIG SET parameter value \u4fee\u6539 redis \u914d\u7f6e\u53c2\u6570\uff0c\u65e0\u9700\u91cd\u542f CONFIG RESETSTAT \u91cd\u7f6e INFO \u547d\u4ee4\u4e2d\u7684\u67d0\u4e9b\u7edf\u8ba1\u6570\u636e DBSIZE \u8fd4\u56de\u5f53\u524d\u6570\u636e\u5e93\u7684 key \u7684\u6570\u91cf DEBUG OBJECT key \u83b7\u53d6 key \u7684\u8c03\u8bd5\u4fe1\u606f DEBUG SEGFAULT \u8ba9 Redis \u670d\u52a1\u5d29\u6e83 FLUSHALL \u5220\u9664\u6240\u6709\u6570\u636e\u5e93\u7684\u6240\u6709key FLUSHDB \u5220\u9664\u5f53\u524d\u6570\u636e\u5e93\u7684\u6240\u6709key INFO [section] \u83b7\u53d6 Redis \u670d\u52a1\u5668\u7684\u5404\u79cd\u4fe1\u606f\u548c\u7edf\u8ba1\u6570\u503c LASTSAVE \u8fd4\u56de\u6700\u8fd1\u4e00\u6b21 Redis \u6210\u529f\u5c06\u6570\u636e\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\u65f6\u95f4\uff0c\u4ee5 UNIX \u65f6\u95f4\u6233\u683c\u5f0f\u8868\u793a MONITOR \u5b9e\u65f6\u6253\u5370\u51fa Redis \u670d\u52a1\u5668\u63a5\u6536\u5230\u7684\u547d\u4ee4\uff0c\u8c03\u8bd5\u7528 ROLE \u8fd4\u56de\u4e3b\u4ece\u5b9e\u4f8b\u6240\u5c5e\u7684\u89d2\u8272 SAVE \u540c\u6b65\u4fdd\u5b58\u6570\u636e\u5230\u786c\u76d8 SHUTDOWN [NOSAVE] [SAVE] \u5f02\u6b65\u4fdd\u5b58\u6570\u636e\u5230\u786c\u76d8\uff0c\u5e76\u5173\u95ed\u670d\u52a1\u5668 SLAVEOF host port \u5c06\u5f53\u524d\u670d\u52a1\u5668\u8f6c\u53d8\u4e3a\u6307\u5b9a\u670d\u52a1\u5668\u7684\u4ece\u5c5e\u670d\u52a1\u5668(slave server) SLOWLOG subcommand [argument] \u7ba1\u7406 redis \u7684\u6162\u65e5\u5fd7 SYNC \u7528\u4e8e\u590d\u5236\u529f\u80fd(replication)\u7684\u5185\u90e8\u547d\u4ee4","title":"2.12 redis \u670d\u52a1\u5668\u547d\u4ee4"},{"location":"python/lib/nosql/redis/redis.index/#3","text":"","title":"3. \u8be6\u7ec6"},{"location":"python/lib/nosql/redis/redis.index/#31-redis","text":"pip install redis","title":"3.1 \u5b89\u88c5redis\u5e93"},{"location":"python/lib/nosql/redis/redis.index/#32-pythonredis","text":"\u8fde\u63a5 redis-py\u63d0\u4f9b\u4e24\u4e2a\u7c7bRedis\u548cStrictRedis\u7528\u4e8e\u5b9e\u73b0Redis\u7684\u547d\u4ee4\uff0cStrictRedis\u7528\u4e8e\u5b9e\u73b0\u5927\u90e8\u5206\u5b98\u65b9\u7684\u547d\u4ee4\uff0c\u5e76\u4f7f\u7528\u5b98\u65b9\u7684\u8bed\u6cd5\u548c\u547d\u4ee4\uff0cRedis\u662fStrictRedis\u7684\u5b50\u7c7b\uff0c\u7528\u4e8e\u5411\u540e\u517c\u5bb9\u65e7\u7248\u672c\u7684redis-py\u3002 import redis r = redis.Redis(host='127.0.0.1', port=6379) r.set('name', 'Jack') print (r.get('name')) - \u8fde\u63a5\u6c60 redis-py\u4f7f\u7528connection pool\u6765\u7ba1\u7406\u5bf9\u4e00\u4e2aredis server\u7684\u6240\u6709\u8fde\u63a5\uff0c\u907f\u514d\u6bcf\u6b21\u5efa\u7acb\u3001\u91ca\u653e\u8fde\u63a5\u7684\u5f00\u9500\u3002\u9ed8\u8ba4\uff0c\u6bcf\u4e2aRedis\u5b9e\u4f8b\u90fd\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u81ea\u5df1\u7684\u8fde\u63a5\u6c60\u3002\u53ef\u4ee5\u76f4\u63a5\u5efa\u7acb\u4e00\u4e2a\u8fde\u63a5\u6c60\uff0c\u7136\u540e\u4f5c\u4e3a\u53c2\u6570Redis\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9e\u73b0\u591a\u4e2aRedis\u5b9e\u4f8b\u5171\u4eab\u4e00\u4e2a\u8fde\u63a5\u6c60\u3002 import redis pool = redis.ConnectionPool(host='127.0.0.1', port=6379) r = redis.Redis(connection_pool=pool) r.set('name', 'Jack') print r.get('name')","title":"3.2 Python\u64cd\u4f5cRedis"},{"location":"python/lib/nosql/redis/redis.index/#32-string","text":"","title":"3.2 string"},{"location":"python/lib/nosql/redis/redis.index/#321-set","text":"set setnx setnx(name, value) setex setex(name, value, time) psetex psetex(name, time_ms, value) set(name, value, ex=None, px=None, nx=False, xx=False) help set \u5728Redis\u4e2d\u8bbe\u7f6e\u503c\uff0c\u9ed8\u8ba4\uff0c\u4e0d\u5b58\u5728\u5219\u521b\u5efa\uff0c\u5b58\u5728\u5219\u4fee\u6539 \u53c2\u6570\uff1a - ex\uff0c\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09 - px\uff0c\u8fc7\u671f\u65f6\u95f4\uff08\u6beb\u79d2\uff09 - nx\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3aTrue\uff0c\u5219\u53ea\u6709name\u4e0d\u5b58\u5728\u65f6\uff0c\u5f53\u524dset\u64cd\u4f5c\u624d\u6267\u884c - xx\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3aTrue\uff0c\u5219\u53ea\u6709name\u5b58\u5728\u65f6\uff0c\u5f53\u524dset\u64cd\u4f5c\u624d\u6267\u884c setex(name, value, time) #\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09 psetex(name, time_ms, value) #\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff08\u8c6a\u79d2\uff09 \u64cd\u4f5c\u8fc7\u7a0b In [5]: r.set('k1','v1') Out[5]: True In [6]: r.get('key1') In [7]: r.get('k1') Out[7]: b'v1'","title":"3.2.1 set"},{"location":"python/lib/nosql/redis/redis.index/#323-mset","text":"mset(*args, **kwargs) #\u6279\u91cf\u8bbe\u7f6e\u503c r.mset(name1='zhangsan', name2='lisi') #\u6216 r.mget({\"name1\":'zhangsan', \"name2\":'lisi'}) \u64cd\u4f5c\u8fc7\u7a0b In [14]: r.mset(name1='zhangsan', name2='lisi') Out[14]: True In [15]: r.mget({\"name1\":'zhangsan', \"name2\":'lisi'}) Out[15]: [b'zhangsan', b'lisi']","title":"3.2.3 mset"},{"location":"python/lib/nosql/redis/redis.index/#324-mget","text":"mget(keys, *args) #\u6279\u91cf\u83b7\u53d6 print(r.mget(\"name1\",\"name2\")) #\u6216 li=[\"name1\",\"name2\"] print(r.mget(li)) \u64cd\u4f5c\u8fc7\u7a0b In [16]: r.mget(\"name1\",\"name2\") Out[16]: [b'zhangsan', b'lisi'] In [17]: name=[\"name1\",\"name2\"] In [18]: r.mget(name) Out[18]: [b'zhangsan', b'lisi']","title":"3.2.4 mget"},{"location":"python/lib/nosql/redis/redis.index/#325-getset","text":"getset(name, value) #\u8bbe\u7f6e\u65b0\u503c\uff0c\u6253\u5370\u539f\u503c print(r.getset(\"name1\",\"wangwu\")) #\u8f93\u51fa:zhangsan print(r.get(\"name1\")) #\u8f93\u51fa:wangwu \u64cd\u4f5c\u8fc7\u7a0b In [26]: r.get(\"name1\") Out[26]: b'zhangsan' In [27]: r.getset(\"name1\",\"wangwu\") Out[27]: b'zhangsan' In [28]: r.get(\"name1\") Out[28]: b'wangwu'","title":"3.2.5 getset"},{"location":"python/lib/nosql/redis/redis.index/#326-getrange","text":"getrange(key, start, end) #\u6839\u636e\u5b57\u8282\u83b7\u53d6\u5b50\u5e8f\u5217 r.set(\"name\",\"zhangsan\") print(r.getrange(\"name\",0,4))#\u8f93\u51fa:zhang \u64cd\u4f5c\u8fc7\u7a0b In [29]: r.set(\"name\",\"zhangsan\") Out[29]: True In [30]: r.getrange('name',0,4) Out[30]: b'zhang'","title":"3.2.6 getrange"},{"location":"python/lib/nosql/redis/redis.index/#327-setrange","text":"setrange(name, offset, value) #\u4fee\u6539\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u4ece\u6307\u5b9a\u5b57\u7b26\u4e32\u7d22\u5f15\u5f00\u59cb\u5411\u540e\u66ff\u6362\uff0c\u5982\u679c\u65b0\u503c\u592a\u957f\u65f6\uff0c\u5219\u5411\u540e\u6dfb\u52a0 r.set(\"name\",\"zhangsan\") r.setrange(\"name\",1,\"ww\") print(r.get(\"name\")) #\u8f93\u51fa:zwwngsan r.set(\"name\",\"zhangsan\") r.setrange(\"name\",6,\"wwww\") print(r.get(\"name\")) #\u8f93\u51fa:zwwwwsan r.set(\"name\",\"zhangsan\") r.setrange(\"name\",6,\"wwwwwwwwwww\") print(r.get(\"name\")) #\u8f93\u51fa:zwwwwwwwwwww \u64cd\u4f5c\u8fc7\u7a0b In [31]: r.set(\"name\",\"zhangsan\") Out[31]: True In [32]: r.setrange(\"name\",1,\"ww\") Out[32]: 8 In [33]: r.get(\"name\") Out[33]: b'zwwngsan' In [34]: r.set(\"name\",\"zhangsan\") Out[34]: True In [35]: r.setrange(\"name\",1,\"wwww\") Out[35]: 8 In [36]: r.get(\"name\") Out[36]: b'zwwwwsan' In [37]: r.set(\"name\",\"zhangsan\") Out[37]: True In [38]: r.setrange(\"name\",1,\"wwwwwwwwwww\") Out[38]: 12 In [39]: r.get(\"name\") Out[39]: b'zwwwwwwwwwww'","title":"3.2.7 setrange"},{"location":"python/lib/nosql/redis/redis.index/#328-setbit","text":"setbit(name, offset, value) #\u5bf9\u4e8c\u8fdb\u5236\u8868\u793a\u4f4d\u8fdb\u884c\u64cd\u4f5c ''' name:redis\u7684name offset\uff0c\u4f4d\u7684\u7d22\u5f15\uff08\u5c06\u503c\u5bf9\u5e94\u7684ASCII\u7801\u53d8\u6362\u6210\u4e8c\u8fdb\u5236\u540e\u518d\u8fdb\u884c\u7d22\u5f15\uff09 value\uff0c\u503c\u53ea\u80fd\u662f 1 \u6216 0 ''' str=\"345\" r.set(\"name\",str) for i in str: print(i,ord(i),bin(ord(i)))#\u8f93\u51fa \u503c\u3001ASCII\u7801\u4e2d\u5bf9\u5e94\u7684\u503c\u3001\u5bf9\u5e94\u503c\u8f6c\u6362\u7684\u4e8c\u8fdb\u5236 ''' \u8f93\u51fa: 51 0b110011 52 0b110100 53 0b110101''' r.setbit(\"name\",6,0)#\u628a\u7b2c7\u4f4d\u6539\u4e3a0\uff0c\u4e5f\u5c31\u662f3\u5bf9\u5e94\u7684\u53d8\u6210\u4e860b110001 print(r.get(\"name\"))#\u8f93\u51fa\uff1a145 \u64cd\u4f5c\u8fc7\u7a0b In [45]: str=\"345\" In [46]: r.set(\"name\",str) Out[46]: True In [47]: r.setbit(\"name\",6,0) Out[47]: 1 In [48]: r.get(\"name\") Out[48]: b'145'","title":"3.2.8 setbit"},{"location":"python/lib/nosql/redis/redis.index/#329-getbit","text":"getbit(name, offset) #\u83b7\u53d6name\u5bf9\u5e94\u503c\u7684\u4e8c\u8fdb\u5236\u4e2d\u67d0\u4f4d\u7684\u503c(0\u62161) r.set(\"name\",\"3\") # \u5bf9\u5e94\u7684\u4e8c\u8fdb\u52360b110011 print(r.getbit(\"name\",5)) #\u8f93\u51fa:0 print(r.getbit(\"name\",6)) #\u8f93\u51fa:1 \u64cd\u4f5c\u8fc7\u7a0b In [49]: r.set(\"name\",\"3\") Out[49]: True In [50]: r.get('name') Out[50]: b'3' In [51]: r.getbit(\"name\",5) Out[51]: 0 In [52]: r.getbit(\"name\",6) Out[52]: 1","title":"3.2.9 getbit"},{"location":"python/lib/nosql/redis/redis.index/#3210-bitcount","text":"bitcount(key, start=None, end=None) #\u83b7\u53d6\u5bf9\u5e94\u4e8c\u8fdb\u5236\u4e2d1\u7684\u4e2a\u6570 r.set(\"name\",\"345\")#0b110011 0b110100 0b110101 print(r.bitcount(\"name\",start=0,end=1)) #\u8f93\u51fa:7 ''' key:Redis\u7684name start:\u5b57\u8282\u8d77\u59cb\u4f4d\u7f6e end:\u5b57\u8282\u7ed3\u675f\u4f4d\u7f6e''' \u64cd\u4f5c\u8fc7\u7a0b In [56]: r.set(\"name\",\"345\") Out[56]: True In [57]: ...: r.bitcount(\"name\",start=0,end=1) Out[57]: 7","title":"3.2.10 bitcount"},{"location":"python/lib/nosql/redis/redis.index/#3211-strlen","text":"strlen(name) #\u8fd4\u56dename\u5bf9\u5e94\u503c\u7684\u5b57\u8282\u957f\u5ea6\uff08\u4e00\u4e2a\u6c49\u5b573\u4e2a\u5b57\u8282\uff09 r.set(\"name\",\"zhangsan\") print(r.strlen(\"name\")) #\u8f93\u51fa:8 \u64cd\u4f5c\u8fc7\u7a0b In [58]: r.set(\"name\",\"zhangsan\") Out[58]: True In [59]: r.strlen(\"name\") Out[59]: 8 In [60]: r.set(\"name\",\"\u5f20\u4e09\") Out[60]: True In [61]: r.strlen(\"name\") Out[61]: 6","title":"3.2.11 strlen"},{"location":"python/lib/nosql/redis/redis.index/#3212-incr","text":"incr(self, name, amount=1) #\u81ea\u589emount\u5bf9\u5e94\u7684\u503c\uff0c\u5f53mount\u4e0d\u5b58\u5728\u65f6\uff0c\u5219\u521b\u5efamount\uff1damount\uff0c\u5426\u5219\uff0c\u5219\u81ea\u589e,amount\u4e3a\u81ea\u589e\u6570(\u6574\u6570) print(r.incr(\"mount\",amount=2))#\u8f93\u51fa:2 print(r.incr(\"mount\"))#\u8f93\u51fa:3 print(r.incr(\"mount\",amount=3))#\u8f93\u51fa:6 print(r.incr(\"mount\",amount=6))#\u8f93\u51fa:12 print(r.get(\"mount\")) #\u8f93\u51fa:12 \u64cd\u4f5c\u8fc7\u7a0b In [66]: r.incr(\"num\",amount=2) Out[66]: 2 in [67]: r.incr(\"num\",amount=10) Out[67]: 12 In [68]: r.incr(\"num\") Out[68]: 13 In [69]: r.get('num') Out[69]: b'13' In [70]: r.incr(\"num\",amount=20) Out[70]: 33 In [71]: r.incr(\"num\",amount=30) Out[71]: 63 In [72]: r.get('num') Out[72]: b'63'","title":"3.2.12 incr"},{"location":"python/lib/nosql/redis/redis.index/#3213-incrbyfloat","text":"incrbyfloat(self, name, amount=1.0) \u7c7b\u4f3c incr() \u81ea\u589e,amount\u4e3a\u81ea\u589e\u6570(\u6d6e\u70b9\u6570)","title":"3.2.13 incrbyfloat"},{"location":"python/lib/nosql/redis/redis.index/#3214-decr","text":"decr(self, name, amount=1) \u81ea\u51cfname\u5bf9\u5e94\u7684\u503c,\u5f53name\u4e0d\u5b58\u5728\u65f6,\u5219\u521b\u5efaname\uff1damount\uff0c\u5426\u5219\uff0c\u5219\u81ea\u51cf\uff0camount\u4e3a\u81ea\u589e\u6570(\u6574\u6570)","title":"3.2.14 decr"},{"location":"python/lib/nosql/redis/redis.index/#3215-append","text":"append(name, value) #\u5728name\u5bf9\u5e94\u7684\u503c\u540e\u9762\u8ffd\u52a0\u5185\u5bb9 r.set(\"name\",\"zhangsan\") print(r.get(\"name\")) #\u8f93\u51fa:'zhangsan r.append(\"name\",\"lisi\") print(r.get(\"name\")) #\u8f93\u51fa:zhangsanlisi \u64cd\u4f5c\u8fc7\u7a0b In [73]: r.set(\"name\",\"zhangsan\") Out[73]: True In [74]: r.get('name') Out[74]: b'zhangsan' In [75]: r.append('name','lisi') Out[75]: 12 In [76]: r.get('name') Out[76]: b'zhangsanlisi'","title":"3.2.15 append"},{"location":"python/lib/nosql/redis/redis.index/#33-hash","text":"redis\u4e2d\u7684Hash \u5728\u5185\u5b58\u4e2d\u7c7b\u4f3c\u4e8e\u4e00\u4e2aname\u5bf9\u5e94\u4e00\u4e2adic\u6765\u5b58\u50a8","title":"3.3 Hash"},{"location":"python/lib/nosql/redis/redis.index/#331-hset","text":"hset(name, key, value) name\u5bf9\u5e94\u7684hash\u4e2d\u8bbe\u7f6e\u4e00\u4e2a\u952e\u503c\u5bf9\uff08\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\uff0c\u5426\u5219\uff0c\u4fee\u6539\uff09 r.hset(\"hash_name\",\"key1\",\"values1\") \u64cd\u4f5c\u8fc7\u7a0b In [12]: r.hset('hash_name','key1','values1') Out[12]: 1 127.0.0.1:6379> TYPE hash_name hash 127.0.0.1:6379> HGETALL hash_name 1) \"key1\" 2) \"values1\" 127.0.0.1:6379> HGET hash_name key1 \"values1\"","title":"3.3.1 hset"},{"location":"python/lib/nosql/redis/redis.index/#332-hget","text":"hget(name,key) \u53d6\u5355\u4e2akey\u503c r.hset(\"hash_name\",\"key1\",\"values1\") #\u5728hash_name\u5bf9\u5e94\u7684hash\u4e2d\u6839\u636ekey\u83b7\u53d6value print(r.hget(\"hash_name\",\"key1\"))#\u8f93\u51fa:aa \u64cd\u4f5c\u8fc7\u7a0b In [13]: r.hset(\"hash_name\",\"key1\",\"values1\") Out[13]: 0 In [14]: r.hget(\"hash_name\",\"key1\") Out[14]: b'values1'","title":"3.3.2 hget"},{"location":"python/lib/nosql/redis/redis.index/#333-hgetall","text":"hgetall(name) \u83b7\u53d6name\u5bf9\u5e94hash\u7684\u6240\u6709\u952e\u503c In [22]: r.hset(\"hash_name\",\"key1\",\"values1\") Out[22]: 1 In [23]: r.hset(\"hash_name\",\"key2\",\"values2\") Out[23]: 1 In [24]: r.hset(\"hash_name\",\"key3\",\"values3\") Out[24]: 1 In [25]: r.hget('hash_name','key1') Out[25]: b'values1' In [26]: r.hget('hash_name','key') In [27]: r.hget('hash_name','key2') Out[27]: b'values2' In [28]: r.hget('hash_name','key3') Out[28]: b'values3' In [29]: r.hgetall('hash_name') Out[29]: {b'key1': b'values1', b'key2': b'values2', b'key3': b'values3'}","title":"3.3.3 hgetall"},{"location":"python/lib/nosql/redis/redis.index/#334-hmset","text":"hmset(name, mapping) \u5728name\u5bf9\u5e94\u7684hash\u4e2d\u6279\u91cf\u8bbe\u7f6e\u952e\u503c\u5bf9,mapping:\u5b57\u5178 In [33]: dic={\"name\":\"summer\",\"job\":\"IT\"} In [34]: r.hmset('dic_name',dic) Out[34]: True 127.0.0.1:6379> HGETALL dic_name 1) \"name\" 2) \"summer\" 3) \"job\" 4) \"IT\"","title":"3.3.4 hmset"},{"location":"python/lib/nosql/redis/redis.index/#335-hmgethmgetall","text":"hmget(name, keys, *args) \u5728name\u5bf9\u5e94\u7684hash\u4e2d\u83b7\u53d6\u591a\u4e2akey\u7684\u503c In [36]: r.hmget('dic_name','name') Out[36]: [b'summer'] In [37]: r.hmget('dic_name','job') Out[37]: [b'IT']","title":"3.3.5 hmget/hmgetall"},{"location":"python/lib/nosql/redis/redis.index/#336-hlenhkeyshvals","text":"hlen(name)\u3001hkeys(name)\u3001hvals(name) dic={\"name\":\"summer\",\"job\":\"IT\",'age':30} r.hmset(\"dic_name\",dic) #hlen(name) \u83b7\u53d6hash\u4e2d\u952e\u503c\u5bf9\u7684\u4e2a\u6570 print(r.hlen(\"dic_name\")) #hkeys(name) \u83b7\u53d6hash\u4e2d\u6240\u6709\u7684key\u7684\u503c print(r.hkeys(\"dic_name\")) #hvals(name) \u83b7\u53d6hash\u4e2d\u6240\u6709\u7684value\u7684\u503c print(r.hvals(\"dic_name\")) \u64cd\u4f5c\u8fc7\u7a0b In [40]: dic={\"name\":\"summer\",\"job\":\"IT\",'age':30} In [41]: r.hmset('dic_name',dic) Out[41]: True In [42]: r.hlen('dic_name') Out[42]: 3 In [43]: r.hkeys('dic_name') Out[43]: [b'name', b'job', b'age'] In [44]: r.hvals('dic_name') Out[44]: [b'summer', b'IT', b'30']","title":"3.3.6 hlen/hkeys/hvals"},{"location":"python/lib/nosql/redis/redis.index/#337-hexists","text":"hexists(name, key) \u68c0\u67e5name\u5bf9\u5e94\u7684hash\u662f\u5426\u5b58\u5728\u5f53\u524d\u4f20\u5165\u7684key In [45]: r.hexists(\"dic_name\",\"a1\") Out[45]: False In [46]: r.hexists(\"dic_name\",\"name\") Out[46]: True","title":"3.3.7 hexists"},{"location":"python/lib/nosql/redis/redis.index/#338-hdel","text":"hdel(name,*keys) \u5220\u9664\u6307\u5b9aname\u5bf9\u5e94\u7684key\u6240\u5728\u7684\u952e\u503c\u5bf9 In [46]: r.hexists(\"dic_name\",\"name\") Out[46]: True In [47]: r.hkeys('dic_name') Out[47]: [b'name', b'job', b'age'] In [48]: r.hvals('dic_name') Out[48]: [b'summer', b'IT', b'30'] In [49]: r.hdel('dic_name','job') Out[49]: 1 In [50]: r.hkeys('dic_name') Out[50]: [b'name', b'age'] 127.0.0.1:6379> HGETALL dic_name 1) \"name\" 2) \"summer\" 3) \"age\" 4) \"30\"","title":"3.3.8 hdel"},{"location":"python/lib/nosql/redis/redis.index/#339-hincrby","text":"hincrby(name, key, amount=1) \u81ea\u589ehash\u4e2dkey\u5bf9\u5e94\u7684\u503c\uff0c\u4e0d\u5b58\u5728\u5219\u521b\u5efakey=amount(amount\u4e3a\u6574\u6570) In [52]: r.hincrby(\"num\",\"data\",amount=2) Out[52]: 2 127.0.0.1:6379> keys * 1) \"num\" 2) \"hash_name\" 3) \"dic_name\" 127.0.0.1:6379> type num hash 127.0.0.1:6379> HGETALL num 1) \"data\" 2) \"2\"","title":"3.3.9 hincrby"},{"location":"python/lib/nosql/redis/redis.index/#3310-hincrbyfloat","text":"hincrbyfloat(name, key, amount=1.0) \u81ea\u589ehash\u4e2dkey\u5bf9\u5e94\u7684\u503c\uff0c\u4e0d\u5b58\u5728\u5219\u521b\u5efakey=amount(amount\u4e3a\u6d6e\u70b9\u6570) In [54]: r.hincrby(\"floatnum\",\"float1\",amount=2) Out[54]: 2 127.0.0.1:6379> keys * 1) \"floatnum\" 2) \"num\" 3) \"hash_name\" 4) \"dic_name\" 127.0.0.1:6379> type floatnum hash 127.0.0.1:6379> HGETALL floatnum 1) \"float1\" 2) \"2\" 127.0.0.1:6379> HGET floatnum float1 \"2\"","title":"3.3.10 hincrbyfloat"},{"location":"python/lib/nosql/redis/redis.index/#3311-hscan","text":"hscan(name, cursor=0, match=None, count=None)","title":"3.3.11 hscan"},{"location":"python/lib/nosql/redis/redis.index/#3312-hscan_iter","text":"hscan_iter(name, match=None, count=None)","title":"3.3.12 hscan_iter"},{"location":"python/lib/nosql/redis/redis.index/#34-list","text":"redis\u4e2d\u7684List\u5728\u5728\u5185\u5b58\u4e2d\u6309\u7167\u4e00\u4e2aname\u5bf9\u5e94\u4e00\u4e2aList\u6765\u5b58\u50a8","title":"3.4 List"},{"location":"python/lib/nosql/redis/redis.index/#341-lpush","text":"lpush(name,values) \u5728name\u5bf9\u5e94\u7684list\u4e2d\u6dfb\u52a0\u5143\u7d20\uff0c\u6bcf\u4e2a\u65b0\u7684\u5143\u7d20\u90fd\u6dfb\u52a0\u5230\u5217\u8868\u7684\u6700\u5de6\u8fb9 # \u5728name\u5bf9\u5e94\u7684list\u4e2d\u6dfb\u52a0\u5143\u7d20\uff0c\u6bcf\u4e2a\u65b0\u7684\u5143\u7d20\u90fd\u6dfb\u52a0\u5230\u5217\u8868\u7684\u6700\u5de6\u8fb9 r.lpush('list',5) r.lpush('list',2,3,4) # \u4fdd\u5b58\u5728\u5217\u8868\u4e2d\u7684\u987a\u5e8f\u4e3a5\uff0c4\uff0c3\uff0c2 \u64cd\u4f5c\u8fc7\u7a0b In [58]: r.lpush('list',2) Out[58]: 1 In [59]: r.lpush('list',3,4,5) Out[59]: 4 127.0.0.1:6379> LRANGE list 0 6 1) \"5\" 2) \"4\" 3) \"3\" 4) \"2\"","title":"3.4.1 lpush"},{"location":"python/lib/nosql/redis/redis.index/#342-rpush","text":"rpush(name,values) \u540clpush\uff0c\u4f46\u6bcf\u4e2a\u65b0\u7684\u5143\u7d20\u90fd\u6dfb\u52a0\u5230\u5217\u8868\u7684\u6700\u53f3\u8fb9 In [61]: r.rpush('rlist',2) Out[61]: 1 In [62]: r.rpush('rlist',3,4,5) Out[62]: 4 127.0.0.1:6379> keys * 1) \"rlist\" 2) \"list\" 127.0.0.1:6379> LRANGE rlist 0 6 1) \"2\" 2) \"3\" 3) \"4\" 4) \"5\"","title":"3.4.2 rpush"},{"location":"python/lib/nosql/redis/redis.index/#343-lpushx","text":"lpushx(name,value) \u5728name\u5bf9\u5e94\u7684list\u4e2d\u6dfb\u52a0\u5143\u7d20\uff0c\u53ea\u6709name\u5df2\u7ecf\u5b58\u5728\u65f6\uff0c\u503c\u6dfb\u52a0\u5230\u5217\u8868\u7684\u6700\u5de6\u8fb9","title":"3.4.3 lpushx"},{"location":"python/lib/nosql/redis/redis.index/#344-rpushx","text":"rpushx(name,value) \u5728name\u5bf9\u5e94\u7684list\u4e2d\u6dfb\u52a0\u5143\u7d20\uff0c\u53ea\u6709name\u5df2\u7ecf\u5b58\u5728\u65f6\uff0c\u503c\u6dfb\u52a0\u5230\u5217\u8868\u7684\u6700\u53f3\u8fb9","title":"3.4.4 rpushx"},{"location":"python/lib/nosql/redis/redis.index/#345-llen","text":"llen(name) name\u5bf9\u5e94\u7684list\u5143\u7d20\u7684\u4e2a\u6570 In [63]: r.llen('rlist') Out[63]: 4","title":"3.4.5 llen"},{"location":"python/lib/nosql/redis/redis.index/#346-linsert","text":"linsert(name, where, refvalue, value)) # \u5728name\u5bf9\u5e94\u7684\u5217\u8868\u7684\u67d0\u4e00\u4e2a\u503c\u524d\u6216\u540e\u63d2\u5165\u4e00\u4e2a\u65b0\u503c r.linsert(\"rlist\",\"BEFORE\",\"2\",\"before\")#\u5728\u5217\u8868\u5185\u627e\u5230\u7b2c\u4e00\u4e2a\u5143\u7d202\uff0c\u5728\u5b83\u524d\u9762\u63d2\u5165SS '''\u53c2\u6570\uff1a name: redis\u7684name where: BEFORE\uff08\u524d\uff09\u6216AFTER\uff08\u540e\uff09 refvalue: \u5217\u8868\u5185\u7684\u503c value: \u8981\u63d2\u5165\u7684\u6570\u636e''' \u64cd\u4f5c \u63d2\u5165\u4e4b\u524d 127.0.0.1:6379> LRANGE rlist 0 6 1) \"2\" 2) \"3\" 3) \"4\" 4) \"5\" In [64]: r.linsert(\"rlist\",\"BEFORE\",\"2\",\"before\") Out[64]: 5 \u63d2\u5165\u4e4b\u540e 127.0.0.1:6379> LRANGE rlist 0 6 1) \"before\" 2) \"2\" 3) \"3\" 4) \"4\" 5) \"5\"","title":"3.4.6 linsert"},{"location":"python/lib/nosql/redis/redis.index/#347-lset","text":"r.lset(name, index, value) #\u5bf9list\u4e2d\u7684\u67d0\u4e00\u4e2a\u7d22\u5f15\u4f4d\u7f6e\u91cd\u65b0\u8d4b\u503c r.lset(\"rlist\",0,\"bbb\") \u64cd\u4f5c\u8fc7\u7a0b \u4fee\u6539\u4e4b\u524d 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"before\" 2) \"2\" 3) \"3\" 4) \"4_before\" 5) \"4\" 6) \"4_after\" 7) \"4_before\" 8) \"5\" # \u4fee\u6539\u7b2c0\u4f4d\u662f0 In [68]: r.lset('rlist',0,0) Out[68]: True \u4fee\u6539\u4e4b\u540e 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"0\" 2) \"2\" 3) \"3\" 4) \"4_before\" 5) \"4\" 6) \"4_after\" 7) \"4_before\" 8) \"5\"","title":"3.4.7 lset"},{"location":"python/lib/nosql/redis/redis.index/#348-lrem","text":"r.lrem(name, value, num) \u5220\u9664name\u5bf9\u5e94\u7684list\u4e2d\u7684\u6307\u5b9a\u503c r.lrem(\"rlist\",\"data\",num=0) ''' \u53c2\u6570\uff1a name: redis\u7684name value: \u8981\u5220\u9664\u7684\u503c num: num=0 \u5220\u9664\u5217\u8868\u4e2d\u6240\u6709\u7684\u6307\u5b9a\u503c\uff1b num=2 \u4ece\u524d\u5230\u540e\uff0c\u5220\u96642\u4e2a\uff1b num=-2 \u4ece\u540e\u5411\u524d\uff0c\u5220\u96642\u4e2a \u64cd\u4f5c\u8fc7\u7a0b \u5220\u9664\u4e4b\u524d 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"0\" 2) \"2\" 3) \"3\" 4) \"4_before\" 5) \"4\" 6) \"4_after\" 7) \"4_before\" 8) \"5\" In [69]: r.lrem('rlist','4_before',3) Out[69]: 2 \u5220\u9664\u4e4b\u540e 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"0\" 2) \"2\" 3) \"3\" 4) \"4\" 5) \"4_after\" 6) \"5\"","title":"3.4.8 lrem"},{"location":"python/lib/nosql/redis/redis.index/#349-lpop","text":"lpop(name) \u79fb\u9664\u5217\u8868\u7684\u5de6\u4fa7\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u8fd4\u56de\u503c\u5219\u662f\u7b2c\u4e00\u4e2a\u5143\u7d20 \u64cd\u4f5c\u8fc7\u7a0b 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"0\" 2) \"2\" 3) \"3\" 4) \"4\" 5) \"4_after\" 6) \"5\" In [70]: r.lpop(\"rlist\") Out[70]: b'0' 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"2\" 2) \"3\" 3) \"4\" 4) \"4_after\" 5) \"5\"","title":"3.4.9 lpop"},{"location":"python/lib/nosql/redis/redis.index/#3410-lindex","text":"lindex(name, index) \u6839\u636e\u7d22\u5f15\u83b7\u53d6\u5217\u8868\u5185\u5143\u7d20 \u64cd\u4f5c\u8fc7\u7a0b 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"2\" 2) \"3\" 3) \"4\" 4) \"4_after\" 5) \"5\" In [72]: r.lindex('rlist','2') Out[72]: b'4' In [73]: r.lindex('rlist','3') Out[73]: b'4_after","title":"3.4.10 lindex"},{"location":"python/lib/nosql/redis/redis.index/#3411-lrange","text":"lrange(name, start, end) \u5206\u7247\u83b7\u53d6\u5143\u7d20 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"2\" 2) \"3\" 3) \"4\" 4) \"4_after\" 5) \"5\" In [74]: r.lrange('rlist',0,3) Out[74]: [b'2', b'3', b'4', b'4_after'] In [75]: r.lrange('rlist',0,-1) Out[75]: [b'2', b'3', b'4', b'4_after', b'5']","title":"3.4.11 lrange"},{"location":"python/lib/nosql/redis/redis.index/#3412-ltrim","text":"ltrim(name, start, end) \u79fb\u9664\u5217\u8868\u5185\u6ca1\u6709\u5728\u8be5\u7d22\u5f15\u4e4b\u5185\u7684\u503c 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"2\" 2) \"3\" 3) \"4\" 4) \"4_after\" 5) \"5\" In [76]: r.ltrim('rlist',0,2) # \u4fdd\u7559\u7d22\u5f15 0 \u52302\u7684\u503c\uff0c\u5176\u4ed6\u90fd\u5220\u9664 Out[76]: True 127.0.0.1:6379> LRANGE rlist 0 -1 1) \"2\" 2) \"3\" 3) \"4\"","title":"3.4.12 ltrim"},{"location":"python/lib/nosql/redis/redis.index/#3413-rpoplpush","text":"rpoplpush(src, dst) \u4ece\u4e00\u4e2a\u5217\u8868\u53d6\u51fa\u6700\u53f3\u8fb9\u7684\u5143\u7d20\uff0c\u540c\u65f6\u5c06\u5176\u6dfb\u52a0\u81f3\u53e6\u4e00\u4e2a\u5217\u8868\u7684\u6700\u5de6\u8fb9 - src \u8981\u53d6\u6570\u636e\u7684\u5217\u8868 - dst \u8981\u6dfb\u52a0\u6570\u636e\u7684\u5217\u8868","title":"3.4.13 rpoplpush"},{"location":"python/lib/nosql/redis/redis.index/#3414-brpoplpush","text":"brpoplpush(src, dst, timeout=0) \u540crpoplpush\uff0c\u591a\u4e86\u4e2atimeout, timeout\uff1a\u53d6\u6570\u636e\u7684\u5217\u8868\u6ca1\u5143\u7d20\u540e\u7684\u963b\u585e\u65f6\u95f4\uff0c0\u4e3a\u4e00\u76f4\u963b\u585e","title":"3.4.14 brpoplpush"},{"location":"python/lib/nosql/redis/redis.index/#3415-blpop","text":"blpop(keys, timeout) \u5c06\u591a\u4e2a\u5217\u8868\u6392\u5217,\u6309\u7167\u4ece\u5de6\u5230\u53f3\u53bb\u79fb\u9664\u5404\u4e2a\u5217\u8868\u5185\u7684\u5143\u7d20 r.lpush(\"rlist1\",3,4,5) r.lpush(\"rlist2\",3,4,5) while True: print(r.blpop([\"rlist1\",\"rlist2\"],timeout=0)) print(r.lrange(\"rlist1\",0,-1),r.lrange(\"rlist2\",0,-1)) '''keys: redis\u7684name\u7684\u96c6\u5408 timeout: \u8d85\u65f6\u65f6\u95f4\uff0c\u83b7\u53d6\u5b8c\u6240\u6709\u5217\u8868\u7684\u5143\u7d20\u4e4b\u540e\uff0c\u963b\u585e\u7b49\u5f85\u5217\u8868\u5185\u6709\u6570\u636e\u7684\u65f6\u95f4\uff08\u79d2\uff09, 0 \u8868\u793a\u6c38\u8fdc\u963b\u585e''' \u64cd\u4f5c\u8fc7\u7a0b In [86]: r.lpush(\"rlist2\",3,4,5) Out[86]: 3 In [87]: r.lpush(\"rlist1\",3,4,5) Out[87]: 3 127.0.0.1:6379> LRANGE rlist1 0 -1 1) \"5\" 2) \"4\" 3) \"3\" 127.0.0.1:6379> LRANGE rlist2 0 -1 1) \"5\" 2) \"4\" 3) \"3\" In [90]: r.blpop([\"rlist1\",\"rlist2\"],timeout=0) Out[90]: (b'rlist1', b'5') 127.0.0.1:6379> LRANGE rlist1 0 -1 1) \"4\" 2) \"3\" 127.0.0.1:6379> LRANGE rlist2 0 -1 1) \"5\" 2) \"4\" 3) \"3\"","title":"3.4.15 blpop"},{"location":"python/lib/nosql/redis/redis.index/#3416-brpop","text":"r.brpop(keys, timeout) \u540cblpop\uff0c\u5c06\u591a\u4e2a\u5217\u8868\u6392\u5217,\u6309\u7167\u4ece\u53f3\u50cf\u5de6\u53bb\u79fb\u9664\u5404\u4e2a\u5217\u8868\u5185\u7684\u5143\u7d20 \u64cd\u4f5c\u8fc7\u7a0b 127.0.0.1:6379> flushall OK In [5]: r.lpush(\"list1\",1,2,3,4,5) Out[5]: 5 In [6]: r.lpush(\"list2\",1,2,3,4,5) Out[6]: 5 127.0.0.1:6379> LRANGE list1 0 -1 1) \"5\" 2) \"4\" 3) \"3\" 4) \"2\" 5) \"1\" 127.0.0.1:6379> LRANGE list2 0 -1 1) \"5\" 2) \"4\" 3) \"3\" 4) \"2\" 5) \"1\" In [7]: r.blpop([\"list1\",\"list2\"],timeout=0) Out[7]: (b'list1', b'5') 127.0.0.1:6379> LRANGE list1 0 -1 1) \"4\" 2) \"3\" 3) \"2\" 4) \"1\" 127.0.0.1:6379> LRANGE list2 0 -1 1) \"5\" 2) \"4\" 3) \"3\" 4) \"2\" 5) \"1\"","title":"3.4.16 brpop"},{"location":"python/lib/nosql/redis/redis.index/#34-set","text":"Set\u96c6\u5408\u5c31\u662f\u4e0d\u5141\u8bb8\u91cd\u590d\u7684\u5217\u8868","title":"3.4 Set"},{"location":"python/lib/nosql/redis/redis.index/#341-sadd","text":"sadd(name,values) \u7ed9name\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d\u6dfb\u52a0\u5143\u7d20 In [8]: r.sadd('set1','aa') Out[8]: 1 In [9]: r.sadd('set1','aa','bb') Out[9]: 1 127.0.0.1:6379> keys * 1) \"set1\" 2) \"list2\" 3) \"list1\" 4) \"list\" 127.0.0.1:6379> type set1 set 127.0.0.1:6379> SMEMBERS set1 1) \"bb\" 2) \"aa\"","title":"3.4.1 sadd"},{"location":"python/lib/nosql/redis/redis.index/#342-smembers","text":"smembers(name) \u83b7\u53d6name\u5bf9\u5e94\u7684\u96c6\u5408\u7684\u6240\u6709\u6210\u5458 In [10]: r.smembers('set1') Out[10]: {b'aa', b'bb'}","title":"3.4.2 smembers"},{"location":"python/lib/nosql/redis/redis.index/#343-scard","text":"scard(name) \u83b7\u53d6name\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e2a\u6570 In [11]: r.scard('set1') Out[11]: 2","title":"3.4.3 scard"},{"location":"python/lib/nosql/redis/redis.index/#344-sdiff","text":"sdiff(keys, *args) \u5728\u7b2c\u4e00\u4e2aset1\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d\u4e14\u4e0d\u5728\u5176\u4ed6name\u5bf9\u5e94\u7684\u96c6\u5408\u7684\u5143\u7d20\u96c6\u5408 In [13]: r.sadd(\"set1\",\"aa\",\"bb\") Out[13]: 0 In [14]: r.sadd(\"set2\",\"bb\",\"cc\") Out[14]: 2 In [15]: r.sadd(\"set3\",\"bb\",\"cc\",\"dd\") Out[15]: 3 In [16]: r.sdiff(\"set1\",\"set2\",\"set3\") Out[16]: {b'aa'}","title":"3.4.4 sdiff"},{"location":"python/lib/nosql/redis/redis.index/#345-sdiffstore","text":"sdiffstore(dest, keys, *args) \u76f8\u5f53\u4e8e\u628asdiff\u83b7\u53d6\u7684\u503c\u52a0\u5165\u5230dest\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d In [17]: r.sdiffstore('set_dest',\"set1\",\"set2\",\"set3\") Out[17]: 1 In [18]: r.smembers('set_dest') Out[18]: {b'aa'}","title":"3.4.5 sdiffstore"},{"location":"python/lib/nosql/redis/redis.index/#346-sinter","text":"sinter(keys, *args) \u83b7\u53d6\u591a\u4e2aname\u5bf9\u5e94\u96c6\u5408\u7684\u5e76\u96c6 In [19]: r.sinter('set1','set2','set3') Out[19]: {b'bb'}","title":"3.4.6 sinter"},{"location":"python/lib/nosql/redis/redis.index/#347-sinterstore","text":"\u83b7\u53d6\u591a\u4e2a\u5bf9\u5e94\u96c6\u5408\u7684\u5e76\u96c6\uff0c\u518d\u8bb2\u5176\u52a0\u5165\u5230dest\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d In [20]: r.sinterstore('sinterstore','set1','set2','set3') Out[20]: 1 In [21]: r.smembers('sinterstore') Out[21]: {b'bb'}","title":"3.4.7 sinterstore"},{"location":"python/lib/nosql/redis/redis.index/#348-sismember","text":"sismember(name, value) \u68c0\u67e5value\u662f\u5426\u662fname\u5bf9\u5e94\u7684\u96c6\u5408\u5185\u7684\u5143\u7d20 In [22]: r.sismember('set1','abc') Out[22]: False In [23]: r.sismember('set1','aa') Out[23]: True In [24]: r.smembers('set1') Out[24]: {b'aa', b'bb'}","title":"3.4.8 sismember"},{"location":"python/lib/nosql/redis/redis.index/#349-smove","text":"smove(src, dst, value) \u628asrc \u96c6\u5408\u4e2d\u7684value\u503c\u79fb\u52a8\u5230dst\u96c6\u5408\u4e2d In [25]: r.smembers('set1') Out[25]: {b'aa', b'bb'} In [26]: r.smembers('set2') Out[26]: {b'bb', b'cc'} In [27]: r.smove('set1','set2','aa') Out[27]: True In [28]: r.smembers('set2') Out[28]: {b'aa', b'bb', b'cc'} In [29]: r.smembers('set1') Out[29]: {b'bb'}","title":"3.4.9 smove"},{"location":"python/lib/nosql/redis/redis.index/#3410-spop","text":"spop(name) \u4ece\u96c6\u5408\u7684\u5de6\u4fa7\u79fb\u9664\u4e00\u4e2a\u5143\u7d20\uff0c\u5e76\u5c06\u5176\u8fd4\u56de In [36]: r.smembers('set2') Out[36]: {b'aa', b'bb', b'cc'} In [37]: r.spop('set2') Out[37]: b'aa' In [38]: r.smembers('set2') Out[38]: {b'bb', b'cc'}","title":"3.4.10 spop"},{"location":"python/lib/nosql/redis/redis.index/#3411-srandmember","text":"srandmember(name, numbers) \u4ecename\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d\u968f\u673a\u83b7\u53d6numbers\u4e2a\u5143\u7d20 In [40]: r.sadd(\"set_random\",1,2,3,4,5,6) Out[40]: 6 In [41]: r.smembers('set_random') Out[41]: {b'1', b'2', b'3', b'4', b'5', b'6'} In [42]: r.srandmember('set_random',2) Out[42]: [b'1', b'2'] In [43]: r.srandmember('set_random',2) Out[43]: [b'5', b'2']","title":"3.4.11 srandmember"},{"location":"python/lib/nosql/redis/redis.index/#3412-srem","text":"srem(name, values) \u5220\u9664name\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d\u7684\u67d0\u4e9b\u503c In [45]: r.smembers('set') Out[45]: {b'1', b'2', b'3', b'4', b'5', b'6'} In [46]: r.srem('set','3') Out[46]: 1 In [47]: r.smembers('set') Out[47]: {b'1', b'2', b'4', b'5', b'6'}","title":"3.4.12 srem"},{"location":"python/lib/nosql/redis/redis.index/#3414-sunion","text":"sunion(keys, *args) \u83b7\u53d6\u591a\u4e2aname\u5bf9\u5e94\u7684\u96c6\u5408\u7684\u5e76\u96c6 In [54]: r.sadd(\"set1\",1,2,3,4,5,6) Out[54]: 0 In [55]: r.sadd(\"set2\",4,5,6,7,8.9) Out[55]: 0 In [56]: r.sunion('set1','set2') Out[56]: {b'1', b'2', b'3', b'4', b'5', b'6', b'7', b'8.9', b'bb', b'cc'}","title":"3.4.14 sunion"},{"location":"python/lib/nosql/redis/redis.index/#3414-sunionstore","text":"sunionstore(dest,keys, *args) \u83b7\u53d6\u591a\u4e2aname\u5bf9\u5e94\u7684\u96c6\u5408\u7684\u5e76\u96c6\uff0c\u5e76\u5c06\u7ed3\u679c\u4fdd\u5b58\u5230dest\u96c6\u5408\u4e2d\u5bf9\u5e94\u7684\u96c6\u5408\u4e2d In [57]: r.sunionstore('union_set','set1','set2') Out[57]: 10 In [58]: r.smembers('union_set') Out[58]: {b'1', b'2', b'3', b'4', b'5', b'6', b'7', b'8.9', b'bb', b'cc'}","title":"3.4.14 sunionstore"},{"location":"python/lib/nosql/redis/redis.index/#35","text":"\u5728\u96c6\u5408\u7684\u57fa\u7840\u4e0a\uff0c\u4e3a\u6bcf\u5143\u7d20\u6392\u5e8f\uff0c\u5143\u7d20\u7684\u6392\u5e8f\u9700\u8981\u6839\u636e\u53e6\u5916\u4e00\u4e2a\u503c\u6765\u8fdb\u884c\u6bd4\u8f83\uff0c\u6240\u4ee5\uff0c\u5bf9\u4e8e\u6709\u5e8f\u96c6\u5408\uff0c\u6bcf\u4e00\u4e2a\u5143\u7d20\u6709\u4e24\u4e2a\u503c\uff0c\u5373\uff1a\u503c\u548c\u5206\u6570\uff0c\u5206\u6570\u4e13\u95e8\u7528\u6765\u505a\u6392\u5e8f\u3002","title":"3.5 \u6709\u5e8f\u96c6\u5408"},{"location":"python/lib/nosql/redis/redis.index/#351-zadd","text":"zadd(name, *args, **kwargs) \u5728name\u5bf9\u5e94\u7684\u6709\u5e8f\u96c6\u5408\u4e2d\u6dfb\u52a0\u5143\u7d20 In [59]: r.zadd(\"zset1\", \"a1\", 2, \"a2\", 3,\"a4\",5) Out[59]: 3 In [63]: r.zadd(\"zset2\",a=10,b=20) Out[63]: 2 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a1\" 2) \"2\" 3) \"a2\" 4) \"3\" 5) \"a4\" 6) \"5\" 127.0.0.1:6379> ZRANGE zset2 0 -1 WITHSCORES 1) \"a\" 2) \"10\" 3) \"b\" 4) \"20\"","title":"3.5.1 zadd"},{"location":"python/lib/nosql/redis/redis.index/#352-zcard","text":"zcard(name) \u83b7\u53d6\u6709\u5e8f\u96c6\u5408\u5185\u5143\u7d20\u7684\u6570\u91cf In [64]: r.zcard('zset1') Out[64]: 3 In [65]: r.zcard('zset2') Out[65]: 2","title":"3.5.2 zcard"},{"location":"python/lib/nosql/redis/redis.index/#353-zcount","text":"zcount(name, min, max) \u83b7\u53d6\u6709\u5e8f\u96c6\u5408\u4e2d\u5206\u6570\u5728[min,max]\u4e4b\u95f4\u7684\u4e2a\u6570 In [66]: r.zcount(\"zset1\",1,5) Out[66]: 3","title":"3.5.3 zcount"},{"location":"python/lib/nosql/redis/redis.index/#354-zincrby","text":"zincrby(name, value, amount) \u81ea\u589e\u6709\u5e8f\u96c6\u5408\u5185value\u5bf9\u5e94\u7684\u5206\u6570 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a1\" 2) \"2\" 3) \"a2\" 4) \"3\" 5) \"a4\" 6) \"5\" In [68]: r.zincrby(\"zset1\",\"a1\",amount=2) Out[68]: 4.0 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a2\" 2) \"3\" 3) \"a1\" 4) \"4\" 5) \"a4\" 6) \"5\" \u672c\u6765a1=2 \u7136\u540e\u52a02\u540e\u53d8\u62104\u4e5f\u5c31\u662f a1=4,\u6240\u4ee5\u5411\u540e\u6392\u5217","title":"3.5.4 zincrby"},{"location":"python/lib/nosql/redis/redis.index/#355-zrange","text":"zrange( name, start, end, desc=False, withscores=False, score_cast_func=float) \u6309\u7167\u7d22\u5f15\u8303\u56f4\u83b7\u53d6name\u5bf9\u5e94\u7684\u6709\u5e8f\u96c6\u5408\u7684\u5143\u7d20 aa=r.zrange(\"zset_name\",0,1,desc=False,withscores=True,score_cast_func=int) print(aa) \u53c2\u6570\uff1a name redis\u7684name start \u6709\u5e8f\u96c6\u5408\u7d22\u5f15\u8d77\u59cb\u4f4d\u7f6e end \u6709\u5e8f\u96c6\u5408\u7d22\u5f15\u7ed3\u675f\u4f4d\u7f6e desc \u6392\u5e8f\u89c4\u5219\uff0c\u9ed8\u8ba4\u6309\u7167\u5206\u6570\u4ece\u5c0f\u5230\u5927\u6392\u5e8f withscores \u662f\u5426\u83b7\u53d6\u5143\u7d20\u7684\u5206\u6570\uff0c\u9ed8\u8ba4\u53ea\u83b7\u53d6\u5143\u7d20\u7684\u503c score_cast_func \u5bf9\u5206\u6570\u8fdb\u884c\u6570\u636e\u8f6c\u6362\u7684\u51fd\u6570 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a2\" 2) \"3\" 3) \"a1\" 4) \"4\" 5) \"a4\" 6) \"5\" In [69]: r.zrange('zset1',0,1) Out[69]: [b'a2', b'a1'] In [70]: r.zrange('zset1',0,-1) Out[70]: [b'a2', b'a1', b'a4']","title":"3.5.5 zrange"},{"location":"python/lib/nosql/redis/redis.index/#356-zrevrange","text":"zrevrange(name, start, end, withscores=False, score_cast_func=float) \u540czrange\uff0c\u96c6\u5408\u662f\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\u7684 In [71]: r.zrevrange('zset1',0,-1) Out[71]: [b'a4', b'a1', b'a2']","title":"3.5.6 zrevrange"},{"location":"python/lib/nosql/redis/redis.index/#357-zrankzrevrank","text":"zrank(name, value)\u3001zrevrank(name, value) \u83b7\u53d6value\u503c\u5728name\u5bf9\u5e94\u7684\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u6392\u884c\u4f4d\u7f6e\uff08\u4ece0\u5f00\u59cb\uff09 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a2\" 2) \"3\" 3) \"a1\" 4) \"4\" 5) \"a4\" 6) \"5\" In [72]: r.zrank('zset1','a1') Out[72]: 1 In [73]: r.zrank('zset1','a2') Out[73]: 0 In [74]: r.zrevrank('zset1','a1') Out[74]: 1","title":"3.5.7 zrank/zrevrank"},{"location":"python/lib/nosql/redis/redis.index/#358-zscore","text":"zscore(name, value) \u83b7\u53d6name\u5bf9\u5e94\u6709\u5e8f\u96c6\u5408\u4e2d value \u5bf9\u5e94\u7684\u5206\u6570 In [75]: r.zscore('zset1','a2') Out[75]: 3.0","title":"3.5.8 zscore"},{"location":"python/lib/nosql/redis/redis.index/#359-zrem","text":"zrem(name, values) \u5220\u9664name\u5bf9\u5e94\u7684\u6709\u5e8f\u96c6\u5408\u4e2d\u503c\u662fvalues\u7684\u6210\u5458 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a2\" 2) \"3\" 3) \"a1\" 4) \"4\" 5) \"a4\" 6) \"5\" In [76]: r.zrem('zset1','a1','a2') Out[76]: 2 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a4\" 2) \"5\"","title":"3.5.9 zrem"},{"location":"python/lib/nosql/redis/redis.index/#3510-zremrangebyrank","text":"zremrangebyrank(name, min, max) \u6839\u636e\u6392\u884c\u8303\u56f4\u5220\u9664 127.0.0.1:6379> flushall OK In [78]: r.zadd('zset1',a1=10,a2=20,a3=30,a4=40,a5=50) Out[78]: 5 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a1\" 2) \"10\" 3) \"a2\" 4) \"20\" 5) \"a3\" 6) \"30\" 7) \"a4\" 8) \"40\" 9) \"a5\" 10) \"50\" In [80]: r.zremrangebyrank('zet1', 1, 20) Out[80]: 0 In [81]: r.zremrangebyrank('zset1', 1, 20) Out[81]: 4 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a1\" 2) \"10\"","title":"3.5.10 zremrangebyrank"},{"location":"python/lib/nosql/redis/redis.index/#3511-zremrangebyscore","text":"zremrangebyscore(name, min, max) \u6839\u636e\u5206\u6570\u8303\u56f4\u5220\u9664 127.0.0.1:6379> flushall OK In [82]: r.zadd('zset1',a1=10,a2=20,a3=30,a4=40,a5=50) Out[82]: 5 127.0.0.1:6379> keys * 1) \"zset1\" 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a1\" 2) \"10\" 3) \"a2\" 4) \"20\" 5) \"a3\" 6) \"30\" 7) \"a4\" 8) \"40\" 9) \"a5\" 10) \"50\" In [83]: r.zremrangebyscore('zset1',1,30) Out[83]: 3 127.0.0.1:6379> ZRANGE zset1 0 -1 WITHSCORES 1) \"a4\" 2) \"40\" 3) \"a5\" 4) \"50\" \u5206\u6570\u4ece 1 \u5230 30(include 30) \u7684\u90fd\u88ab\u5220\u9664\u4e86","title":"3.5.11 zremrangebyscore"},{"location":"python/lib/nosql/redis/redis.index/#3512-zinterstore","text":"zinterstore(dest, keys, aggregate=None) In [84]: r.zadd(\"zset_name\", \"a1\", 6, \"a2\", 2,\"a3\",5) Out[84]: 3 In [85]: r.zadd('zset_name1', a1=7,b1=10, b2=5) Out[85]: 3 127.0.0.1:6379> ZRANGE zset_name 0 -1 WITHSCORES 1) \"a2\" 2) \"2\" 3) \"a3\" 4) \"5\" 5) \"a1\" 6) \"6\" 127.0.0.1:6379> ZRANGE zset_name1 0 -1 WITHSCORES 1) \"b2\" 2) \"5\" 3) \"a1\" 4) \"7\" 5) \"b1\" 6) \"10\" # \u83b7\u53d6\u4e24\u4e2a\u6709\u5e8f\u96c6\u5408\u7684\u4ea4\u96c6\u5e76\u653e\u5165dest\u96c6\u5408\uff0c\u5982\u679c\u9047\u5230\u76f8\u540c\u503c\u4e0d\u540c\u5206\u6570\uff0c\u5219\u6309\u7167aggregate\u8fdb\u884c\u64cd\u4f5c # aggregate\u7684\u503c\u4e3a: SUM MIN MAX In [86]: r.zinterstore(\"zset_name2\",(\"zset_name1\",\"zset_name\"),aggregate=\"MAX\") Out[86]: 1 127.0.0.1:6379> keys * 1) \"zset_name\" 2) \"zset_name2\" 3) \"zset_name1\" 4) \"zset1\" 127.0.0.1:6379> ZRANGE zset_name2 0 -1 WITHSCORES 1) \"a1\" 2) \"7\"","title":"3.5.12 zinterstore"},{"location":"python/lib/nosql/redis/redis.index/#3514-zunionstore","text":"zunionstore(dest, keys, aggregate=None) \u83b7\u53d6\u4e24\u4e2a\u6709\u5e8f\u96c6\u5408\u7684\u5e76\u96c6\u5e76\u653e\u5165dest\u96c6\u5408\uff0c\u5176\u4ed6\u540czinterstore\uff0c In [89]: r.zadd(\"zset_union_name1\", \"a1\", 6, \"a2\", 2,\"a3\",5) Out[89]: 3 In [90]: r.zadd('zset_union_name2', a1=7,b1=10, b2=5) Out[90]: 3 In [91]: r.zunionstore(\"zset_union_name\",(\"zset_union_name1\",\"zset_union_name2\"),aggregate=\"MAX\") Out[91]: 5 In [92]: print(r.zscan(\"zset_union_name\")) (0, [(b'a2', 2.0), (b'a3', 5.0), (b'b2', 5.0), (b'a1', 7.0), (b'b1', 10.0)])","title":"3.5.14 zunionstore"},{"location":"python/lib/nosql/redis/redis.index/#36","text":"","title":"3.6 \u5176\u4ed6\u64cd\u4f5c"},{"location":"python/lib/nosql/redis/redis.index/#361-delete","text":"delete(*names) #\u6839\u636ename\u5220\u9664redis\u4e2d\u7684\u4efb\u610f\u6570\u636e\u7c7b\u578b In [80]: r.exists('name') Out[80]: True In [81]: r.delete('name') Out[81]: 1 In [82]: r.exists('name') Out[82]: False In [83]: r.get('name')","title":"3.6.1 delete"},{"location":"python/lib/nosql/redis/redis.index/#362-exists","text":"exists(name) #\u68c0\u6d4bredis\u7684name\u662f\u5426\u5b58\u5728 In [79]: r.get('name') Out[79]: b'zhangsanlisi' In [80]: r.exists('name') Out[80]: True","title":"3.6.2 exists"},{"location":"python/lib/nosql/redis/redis.index/#363-keys","text":"keys(pattern='*') #\u6839\u636e* \uff1f\u7b49\u901a\u914d\u7b26\u5339\u914d\u83b7\u53d6redis\u7684name In [88]: r.keys(pattern='*') Out[88]: [b'num', b'k1', b'k2', b'mount', b'k3']","title":"3.6.3 keys"},{"location":"python/lib/nosql/redis/redis.index/#364-expire","text":"expire(name ,time) # \u4e3a\u67d0\u4e2aname\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4 In [92]: r.get('k1') Out[92]: b'v1' In [93]: r.expire('k1',2) # \u914d\u7f6e\u8fc7\u671f\u65f6\u95f4\u4e3a2\u79d2 Out[93]: True In [94]: r.get('k1')","title":"3.6.4 expire"},{"location":"python/lib/nosql/redis/redis.index/#365-rename","text":"rename(src, dst) # \u91cd\u547d\u540d In [97]: r.rename('k2','k22') Out[97]: True In [98]: r.get('k2') In [99]: r.get('k22') Out[99]: b'v2'","title":"3.6.5 rename"},{"location":"python/lib/nosql/redis/redis.index/#366-move","text":"move(name, db)) # \u5c06redis\u7684\u67d0\u4e2a\u503c\u79fb\u52a8\u5230\u6307\u5b9a\u7684db\u4e0b In [105]: r.move('k3',2) Out[105]: True 127.0.0.1:6379> keys * 1) \"num\" 2) \"k22\" 3) \"mount\" 127.0.0.1:6379[3]> select 2 OK 127.0.0.1:6379[2]> keys * 1) \"k3\" 127.0.0.1:6379[2]>","title":"3.6.6 move"},{"location":"python/lib/nosql/redis/redis.index/#367-randomkey","text":"randomkey() #\u968f\u673a\u83b7\u53d6\u4e00\u4e2aredis\u7684name\uff08\u4e0d\u5220\u9664\uff09 In [100]: r.randomkey() Out[100]: b'mount' In [101]: r.randomkey() Out[101]: b'k3'","title":"3.6.7 randomkey"},{"location":"python/lib/nosql/redis/redis.index/#368-type","text":"type(name) # \u83b7\u53d6name\u5bf9\u5e94\u503c\u7684\u7c7b\u578b In [102]: r.type('k3') Out[102]: b'string'","title":"3.6.8 type"},{"location":"python/lib/nosql/redis/redis.index/#369-dbsize","text":"\u6570\u636e\u5e93\u4e2d\u591a\u5c11\u4e2a\u6761\u6570 In [96]: r.dbsize() Out[96]: 1","title":"3.6.9 dbsize"},{"location":"python/lib/nosql/redis/redis.index/#3610-flushdbflushall","text":"flushdb \u6e05\u7a7a\u6570\u636e\u5e93 flushall \u5220\u9664\u6240\u6709\u73b0\u6709\u7684\u6570\u636e\u5e93 In [97]: r.flushdb() Out[97]: True In [99]: r.flushall() Out[99]: True redis\u64cd\u4f5c 127.0.0.1:6379> SELECT 1 OK 127.0.0.1:6379[1]> set k1 1 OK 127.0.0.1:6379[1]> select 2 OK 127.0.0.1:6379[2]> set k2 2 OK 127.0.0.1:6379[2]> keys * 1) \"k2\" 127.0.0.1:6379[2]> FLUSHDB OK 127.0.0.1:6379[2]> keys * (empty list or set) 127.0.0.1:6379[2]> select 1 OK 127.0.0.1:6379[1]> keys * 1) \"k1\" 127.0.0.1:6379[1]> 127.0.0.1:6379[1]> 127.0.0.1:6379[1]> select 2 OK 127.0.0.1:6379[2]> set k2 2 OK 127.0.0.1:6379[2]> FLUSHALL OK 127.0.0.1:6379[2]> keys * (empty list or set) 127.0.0.1:6379[2]> select 1 OK 127.0.0.1:6379[1]> keys * (empty list or set)","title":"3.6.10 flushdb/flushall"},{"location":"python/lib/nosql/redis/redis.index/#3611-save","text":"\u5f3a\u884c\u628a\u6570\u636e\u5e93\u4fdd\u5b58\u5230\u786c\u76d8\u3002\u4fdd\u5b58\u65f6\u963b\u585e In [98]: r.save() Out[98]: True","title":"3.6.11 save"},{"location":"python/lib/nosql/redis/redis.pipeline/","text":"redis pipeline 1. Python Redis pipeline\u4ecb\u7ecd \u00b6 Redis\u662f\u5efa\u7acb\u5728TCP\u534f\u8bae\u57fa\u7840\u4e0a\u7684CS\u67b6\u6784\uff0c\u5ba2\u6237\u7aefclient\u5bf9redis server\u91c7\u53d6\u8bf7\u6c42\u54cd\u5e94\u7684\u65b9\u5f0f\u4ea4\u4e92\u3002 \u4e00\u822c\u6765\u8bf4\u5ba2\u6237\u7aef\u4ece\u63d0\u4ea4\u8bf7\u6c42\u5230\u5f97\u5230\u670d\u52a1\u5668\u76f8\u5e94\uff0c\u9700\u8981\u4f20\u9001\u4e24\u4e2atcp\u62a5\u6587\u3002 Redis\u7684pipeline(\u7ba1\u9053)\u529f\u80fd\u5728\u547d\u4ee4\u884c\u4e2d\u6ca1\u6709\uff0c\u4f46redis\u662f\u652f\u6301pipeline\u7684\uff0c\u800c\u4e14\u5728\u5404\u4e2a\u8bed\u8a00\u7248\u7684client\u4e2d\u90fd\u6709\u76f8\u5e94\u7684\u5b9e\u73b0\u3002 \u7531\u4e8e\u7f51\u7edc\u5f00\u9500\u5ef6\u8fdf\uff0c\u5c31\u7b97redis server\u7aef\u6709\u5f88\u5f3a\u7684\u5904\u7406\u80fd\u529b\uff0c\u4e5f\u4f1a\u7531\u4e8e\u6536\u5230\u7684client\u6d88\u606f\u5c11\uff0c\u800c\u9020\u6210\u541e\u5410\u91cf\u5c0f\u3002\u5f53client \u4f7f\u7528pipelining \u53d1\u9001\u547d\u4ee4\u65f6\uff0credis server\u5fc5\u987b\u5c06\u90e8\u5206\u8bf7\u6c42\u653e\u5230\u961f\u5217\u4e2d\uff08\u4f7f\u7528\u5185\u5b58\uff09\uff0c\u6267\u884c\u5b8c\u6bd5\u540e\u4e00\u6b21\u6027\u53d1\u9001\u7ed3\u679c\uff1b\u5982\u679c\u53d1\u9001\u7684\u547d\u4ee4\u5f88\u591a\u7684\u8bdd\uff0c\u5efa\u8bae\u5bf9\u8fd4\u56de\u7684\u7ed3\u679c\u52a0\u6807\u7b7e\uff0c\u5f53\u7136\u8fd9\u4e5f\u4f1a\u589e\u52a0\u4f7f\u7528\u7684\u5185\u5b58\uff1b Pipeline\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u975e\u5e38\u6709\u7528\uff0c\u6bd4\u5982\u6709\u591a\u4e2acommand\u9700\u8981\u88ab\u201c\u53ca\u65f6\u7684\u201d\u63d0\u4ea4\uff0c\u800c\u4e14\u4ed6\u4eec\u5bf9\u76f8\u5e94\u7ed3\u679c\u6ca1\u6709\u4e92\u76f8\u4f9d\u8d56\uff0c\u5bf9\u7ed3\u679c\u54cd\u5e94\u4e5f\u65e0\u9700\u7acb\u5373\u83b7\u5f97\uff0c\u90a3\u4e48pipeline\u5c31\u53ef\u4ee5\u5145\u5f53\u8fd9\u79cd\u201c\u6279\u5904\u7406\u201d\u7684\u5de5\u5177\uff1b\u800c\u4e14\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\uff0c\u53ef\u4ee5\u8f83\u5927\u7684\u63d0\u5347\u6027\u80fd\uff0c\u6027\u80fd\u63d0\u5347\u7684\u539f\u56e0\u4e3b\u8981\u662fTCP\u8fde\u63a5\u4e2d\u51cf\u5c11\u4e86\u201c\u4ea4\u4e92\u5f80\u8fd4\u201d\u7684\u65f6\u95f4\u3002 \u4e0d\u8fc7\u5728\u7f16\u7801\u65f6\u8bf7\u6ce8\u610f\uff0cpipeline\u671f\u95f4\u5c06\u201c\u72ec\u5360\u201d\u94fe\u63a5\uff0c\u6b64\u671f\u95f4\u5c06\u4e0d\u80fd\u8fdb\u884c\u975e\u201c\u7ba1\u9053\u201d\u7c7b\u578b\u7684\u5176\u4ed6\u64cd\u4f5c\uff0c\u76f4\u5230pipeline\u5173\u95ed\uff1b\u5982\u679c\u4f60\u7684pipeline\u7684\u6307\u4ee4\u96c6\u5f88\u5e9e\u5927\uff0c\u4e3a\u4e86\u4e0d\u5e72\u6270\u94fe\u63a5\u4e2d\u7684\u5176\u4ed6\u64cd\u4f5c\uff0c\u4f60\u53ef\u4ee5\u4e3apipeline\u64cd\u4f5c\u65b0\u5efaClient\u94fe\u63a5\uff0c\u8ba9pipeline\u548c\u5176\u4ed6\u6b63\u5e38\u64cd\u4f5c\u5206\u79bb\u57282\u4e2aclient\u4e2d\u3002\u4e0d\u8fc7pipeline\u4e8b\u5b9e\u4e0a\u6240\u80fd\u5bb9\u5fcd\u7684\u64cd\u4f5c\u4e2a\u6570\uff0c\u548csocket-output\u7f13\u51b2\u533a\u5927\u5c0f/\u8fd4\u56de\u7ed3\u679c\u7684\u6570\u636e\u5c3a\u5bf8\u90fd\u6709\u5f88\u5927\u7684\u5173\u7cfb\uff1b\u540c\u65f6\u4e5f\u610f\u5473\u7740\u6bcf\u4e2aredis-server\u540c\u65f6\u6240\u80fd\u652f\u6491\u7684pipeline\u94fe\u63a5\u7684\u4e2a\u6570\uff0c\u4e5f\u662f\u6709\u9650\u7684\uff0c\u8fd9\u5c06\u53d7\u9650\u4e8eserver\u7684\u7269\u7406\u5185\u5b58\u6216\u7f51\u7edc\u63a5\u53e3\u7684\u7f13\u51b2\u80fd\u529b\u3002 Redis\u4f7f\u7528\u7684\u662f\u5ba2\u6237\u7aef-\u670d\u52a1\u5668\uff08CS\uff09\u6a21\u578b\u548c\u8bf7\u6c42/\u54cd\u5e94\u534f\u8bae\u7684TCP\u670d\u52a1\u5668\u3002\u8fd9\u610f\u5473\u7740\u901a\u5e38\u60c5\u51b5\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u4f1a\u9075\u5faa\u4ee5\u4e0b\u6b65\u9aa4\uff1a \u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u9001\u4e00\u4e2a\u67e5\u8be2\u8bf7\u6c42\uff0c\u5e76\u76d1\u542cSocket\u8fd4\u56de\uff0c\u901a\u5e38\u662f\u4ee5\u963b\u585e\u6a21\u5f0f\uff0c\u7b49\u5f85\u670d\u52a1\u7aef\u54cd\u5e94\u3002 \u670d\u52a1\u7aef\u5904\u7406\u547d\u4ee4\uff0c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002 Redis\u5ba2\u6237\u7aef\u4e0eRedis\u670d\u52a1\u5668\u4e4b\u95f4\u4f7f\u7528TCP\u534f\u8bae\u8fdb\u884c\u8fde\u63a5\uff0c\u4e00\u4e2a\u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2asocket\u8fde\u63a5\u53d1\u8d77\u591a\u4e2a\u8bf7\u6c42\u547d\u4ee4\u3002\u6bcf\u4e2a\u8bf7\u6c42\u547d\u4ee4\u53d1\u51fa\u540eclient\u901a\u5e38\u4f1a\u963b\u585e\u5e76\u7b49\u5f85redis\u670d\u52a1\u5668\u5904\u7406\uff0credis\u5904\u7406\u5b8c\u8bf7\u6c42\u547d\u4ee4\u540e\u4f1a\u5c06\u7ed3\u679c\u901a\u8fc7\u54cd\u5e94\u62a5\u6587\u8fd4\u56de\u7ed9client\uff0c\u56e0\u6b64\u5f53\u6267\u884c\u591a\u6761\u547d\u4ee4\u7684\u65f6\u5019\u90fd\u9700\u8981\u7b49\u5f85\u4e0a\u4e00\u6761\u547d\u4ee4\u6267\u884c\u5b8c\u6bd5\u624d\u80fd\u6267\u884c\u3002\u6bd4\u5982\uff1a 127.0.0.1:6379> get k1 \"v1\" 127.0.0.1:6379> get k2 \"v2\" 127.0.0.1:6379> get k3 \"v3\" \u7531\u4e8e\u901a\u4fe1\u4f1a\u6709\u7f51\u7edc\u5ef6\u8fdf\uff0c\u5047\u5982client\u548cserver\u4e4b\u95f4\u7684\u5305\u4f20\u8f93\u65f6\u95f4\u9700\u89810.125\u79d2\u3002\u90a3\u4e48\u4e0a\u9762\u7684\u4e09\u4e2a\u547d\u4ee46\u4e2a\u62a5\u6587\u81f3\u5c11\u9700\u89810.75\u79d2\u624d\u80fd\u5b8c\u6210\u3002\u8fd9\u6837\u5373\u4f7fredis\u6bcf\u79d2\u80fd\u5904\u7406100\u4e2a\u547d\u4ee4\uff0c\u800c\u6211\u4eec\u7684client\u4e5f\u53ea\u80fd\u4e00\u79d2\u949f\u53d1\u51fa\u56db\u4e2a\u547d\u4ee4\u3002\u8fd9\u663e\u7136\u6ca1\u6709\u5145\u5206\u5229\u7528 redis\u7684\u5904\u7406\u80fd\u529b\u3002 \u800c\u7ba1\u9053\uff08pipeline\uff09\u53ef\u4ee5\u4e00\u6b21\u6027\u53d1\u9001\u591a\u6761\u547d\u4ee4\u5e76\u5728\u6267\u884c\u5b8c\u540e\u4e00\u6b21\u6027\u5c06\u7ed3\u679c\u8fd4\u56de\uff0cpipeline\u901a\u8fc7\u51cf\u5c11\u5ba2\u6237\u7aef\u4e0eredis\u7684\u901a\u4fe1\u6b21\u6570\u6765\u5b9e\u73b0\u964d\u4f4e\u5f80\u8fd4\u5ef6\u65f6\u65f6\u95f4\uff0c\u800c\u4e14Pipeline \u5b9e\u73b0\u7684\u539f\u7406\u662f\u961f\u5217\uff0c\u800c\u961f\u5217\u7684\u539f\u7406\u662f\u65f6\u5148\u8fdb\u5148\u51fa\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u6570\u636e\u7684\u987a\u5e8f\u6027\u3002 Pipeline \u7684\u9ed8\u8ba4\u7684\u540c\u6b65\u7684\u4e2a\u6570\u4e3a53\u4e2a\uff0c\u4e5f\u5c31\u662f\u8bf4arges\u4e2d\u7d2f\u52a0\u523053\u6761\u6570\u636e\u65f6\u4f1a\u628a\u6570\u636e\u63d0\u4ea4\u3002\u5176\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1aclient\u53ef\u4ee5\u5c06\u4e09\u4e2a\u547d\u4ee4\u653e\u5230\u4e00\u4e2atcp\u62a5\u6587\u4e00\u8d77\u53d1\u9001\uff0cserver\u5219\u53ef\u4ee5\u5c06\u4e09\u6761\u547d\u4ee4\u7684\u5904\u7406\u7ed3\u679c\u653e\u5230\u4e00\u4e2atcp\u62a5\u6587\u8fd4\u56de\u3002 \u6ce8\u610f \u7528 pipeline\u65b9\u5f0f\u6253\u5305\u547d\u4ee4\u53d1\u9001\uff0credis\u5fc5\u987b\u5728\u5904\u7406\u5b8c\u6240\u6709\u547d\u4ee4\u524d\u5148\u7f13\u5b58\u8d77\u6240\u6709\u547d\u4ee4\u7684\u5904\u7406\u7ed3\u679c\u3002\u6253\u5305\u7684\u547d\u4ee4\u8d8a\u591a\uff0c\u7f13\u5b58\u6d88\u8017\u5185\u5b58\u4e5f\u8d8a\u591a\u3002\u6240\u4ee5\u5e76\u4e0d\u662f\u6253\u5305\u7684\u547d\u4ee4\u8d8a\u591a\u8d8a\u597d\u3002\u5177\u4f53\u591a\u5c11\u5408\u9002\u9700\u8981\u6839\u636e\u5177\u4f53\u60c5\u51b5\u6d4b\u8bd5\u3002 2. Python Redis pipeline\u64cd\u4f5c \u00b6 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/2/21 13:25 @File : pipeline_demo.py @Author : summer @Software: PyCharm \"\"\" import redis import time r = redis.Redis(host='127.0.0.1', port=6379, password='') def try_pipeline(): start = time.time() with r.pipeline(transaction=False) as p: p.sadd('set1', 1).sadd('set2', 2).srem('set2', 2).lpush('list1', 1).lrange('list2', 0, -1) p.execute() print(time.time() - start) def without_pipeline(): start = time.time() r.sadd('seta', 1) r.sadd('seta', 2) r.srem('seta', 2) r.lpush('lista', 1 r.lrange('lista', 0, -1) print(time.time() - start) if __name__ == '__main__': try_pipeline() without_pipeline() \u8fd0\u884c\u7ed3\u679c D:\\code\\code-flask\\code-flask\\venv\\Scripts\\python.exe D:/code/code-flask/code-flask/2019-02-20/1.py 0.004987478256225586 0.03494906425476074 try_pipeline\u5e73\u5747\u5904\u7406\u65f6\u95f4\uff1a0.004987478256225586 without_pipeline\u5e73\u5747\u5904\u7406\u65f6\u95f4\uff1a0.03494906425476074 \u6211\u4eec\u7684\u6279\u91cf\u91cc\u67095\u4e2a\u64cd\u4f5c\uff0c\u5728\u5904\u7406\u65f6\u95f4\u7ef4\u5ea6\u4e0a\u6027\u80fd\u63d0\u5347\u4e867\u500d\uff01 pipeline\u6279\u91cf\u64cd\u4f5c\u53ea\u8fdb\u884c\u4e00\u6b21\u7f51\u7edc\u5f80\u8fd4\uff0c\u53ef\u4ee5\u770b\u5230\u8282\u7701\u7684\u65f6\u95f4\u57fa\u672c\u90fd\u662f\u7f51\u8def\u5ef6\u8fdf\u3002 2\u3001pipeline\u4e0etransation pipeline\u4e0d\u4ec5\u4ec5\u7528\u6765\u6279\u91cf\u7684\u63d0\u4ea4\u547d\u4ee4\uff0c\u8fd8\u7528\u6765\u5b9e\u73b0\u4e8b\u52a1transation\u3002 \u4f7f\u7528transaction\u4e0e\u5426\u4e0d\u540c\u4e4b\u5904\u5728\u4e0e\u521b\u5efapipeline\u5b9e\u4f8b\u7684\u65f6\u5019\uff0ctransaction\u662f\u5426\u6253\u5f00\uff0c\u9ed8\u8ba4\u662f\u6253\u5f00\u7684\u3002 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/2/21 13:25 @File : pipeline_demo.py @Author : summer @Software: PyCharm \"\"\" # -*- coding:utf-8 -*- import redis from redis import WatchError from concurrent.futures import ProcessPoolExecutor r = redis.Redis(host='127.0.0.1', port=6379) # \u51cf\u5e93\u5b58\u51fd\u6570, \u5faa\u73af\u76f4\u5230\u51cf\u5e93\u5b58\u5b8c\u6210 # \u5e93\u5b58\u5145\u8db3, \u51cf\u5e93\u5b58\u6210\u529f, \u8fd4\u56deTrue # \u5e93\u5b58\u4e0d\u8db3, \u51cf\u5e93\u5b58\u5931\u8d25, \u8fd4\u56deFalse def decr_stock(): # python\u4e2dredis\u4e8b\u52a1\u662f\u901a\u8fc7pipeline\u7684\u5c01\u88c5\u5b9e\u73b0\u7684 with r.pipeline() as pipe: while True: try: # watch\u5e93\u5b58\u952e, multi\u540e\u5982\u679c\u8be5key\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u6539\u53d8, \u4e8b\u52a1\u64cd\u4f5c\u4f1a\u629b\u51faWatchError\u5f02\u5e38 pipe.watch('stock:count') count = int(pipe.get('stock:count')) if count > 0: # \u6709\u5e93\u5b58 # \u4e8b\u52a1\u5f00\u59cb pipe.multi() pipe.decr('stock:count') # \u628a\u547d\u4ee4\u63a8\u9001\u8fc7\u53bb # execute\u8fd4\u56de\u547d\u4ee4\u6267\u884c\u7ed3\u679c\u5217\u8868, \u8fd9\u91cc\u53ea\u6709\u4e00\u4e2adecr\u8fd4\u56de\u5f53\u524d\u503c print(pipe.execute()[0]) return True else: return False except WatchError as ex: # \u6253\u5370WatchError\u5f02\u5e38, \u89c2\u5bdf\u88abwatch\u9501\u4f4f\u7684\u60c5\u51b5 print(ex, '\u9501\u4f4f\u4e86') pipe.unwatch() def worker(): while True: # \u6ca1\u6709\u5e93\u5b58\u5c31\u9000\u51fa if not decr_stock(): break # \u5b9e\u9a8c\u5f00\u59cb \u8bbe\u7f6e\u5e93\u5b58\u4e3a20 r.set(\"stock:count\", 20) # \u591a\u8fdb\u7a0b\u6a21\u62df\u591a\u4e2a\u5ba2\u6237\u7aef\u63d0\u4ea4 if __name__ == '__main__': with ProcessPoolExecutor(max_workers=2) as pool: for _ in range(10): pool.submit(worker) \u8fd0\u884c\u7ed3\u679c D:\\code\\code-flask\\code-flask\\venv\\Scripts\\python.exe D:/code/code-flask/code-flask/2019-02-20/1.py 19 18 17 16 19 18 Watched variable changed. \u9501\u4f4f\u4e86 17 Watched variable changed. \u9501\u4f4f\u4e86 16 Watched variable changed. \u9501\u4f4f\u4e86 15 Watched variable changed. \u9501\u4f4f\u4e86 Watched variable changed. \u9501\u4f4f\u4e86 14 13 Watched variable changed. \u9501\u4f4f\u4e86 12 Watched variable changed. \u9501\u4f4f\u4e86 11 Watched variable changed. \u9501\u4f4f\u4e86 10 9 Watched variable changed. \u9501\u4f4f\u4e86 8 7 6 5 Watched variable changed. \u9501\u4f4f\u4e86 4 3 2 1 Watched variable changed. \u9501\u4f4f\u4e86 0 Process finished with exit code 0","title":"2. redis pipeline"},{"location":"python/lib/nosql/redis/redis.pipeline/#1-python-redis-pipeline","text":"Redis\u662f\u5efa\u7acb\u5728TCP\u534f\u8bae\u57fa\u7840\u4e0a\u7684CS\u67b6\u6784\uff0c\u5ba2\u6237\u7aefclient\u5bf9redis server\u91c7\u53d6\u8bf7\u6c42\u54cd\u5e94\u7684\u65b9\u5f0f\u4ea4\u4e92\u3002 \u4e00\u822c\u6765\u8bf4\u5ba2\u6237\u7aef\u4ece\u63d0\u4ea4\u8bf7\u6c42\u5230\u5f97\u5230\u670d\u52a1\u5668\u76f8\u5e94\uff0c\u9700\u8981\u4f20\u9001\u4e24\u4e2atcp\u62a5\u6587\u3002 Redis\u7684pipeline(\u7ba1\u9053)\u529f\u80fd\u5728\u547d\u4ee4\u884c\u4e2d\u6ca1\u6709\uff0c\u4f46redis\u662f\u652f\u6301pipeline\u7684\uff0c\u800c\u4e14\u5728\u5404\u4e2a\u8bed\u8a00\u7248\u7684client\u4e2d\u90fd\u6709\u76f8\u5e94\u7684\u5b9e\u73b0\u3002 \u7531\u4e8e\u7f51\u7edc\u5f00\u9500\u5ef6\u8fdf\uff0c\u5c31\u7b97redis server\u7aef\u6709\u5f88\u5f3a\u7684\u5904\u7406\u80fd\u529b\uff0c\u4e5f\u4f1a\u7531\u4e8e\u6536\u5230\u7684client\u6d88\u606f\u5c11\uff0c\u800c\u9020\u6210\u541e\u5410\u91cf\u5c0f\u3002\u5f53client \u4f7f\u7528pipelining \u53d1\u9001\u547d\u4ee4\u65f6\uff0credis server\u5fc5\u987b\u5c06\u90e8\u5206\u8bf7\u6c42\u653e\u5230\u961f\u5217\u4e2d\uff08\u4f7f\u7528\u5185\u5b58\uff09\uff0c\u6267\u884c\u5b8c\u6bd5\u540e\u4e00\u6b21\u6027\u53d1\u9001\u7ed3\u679c\uff1b\u5982\u679c\u53d1\u9001\u7684\u547d\u4ee4\u5f88\u591a\u7684\u8bdd\uff0c\u5efa\u8bae\u5bf9\u8fd4\u56de\u7684\u7ed3\u679c\u52a0\u6807\u7b7e\uff0c\u5f53\u7136\u8fd9\u4e5f\u4f1a\u589e\u52a0\u4f7f\u7528\u7684\u5185\u5b58\uff1b Pipeline\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u975e\u5e38\u6709\u7528\uff0c\u6bd4\u5982\u6709\u591a\u4e2acommand\u9700\u8981\u88ab\u201c\u53ca\u65f6\u7684\u201d\u63d0\u4ea4\uff0c\u800c\u4e14\u4ed6\u4eec\u5bf9\u76f8\u5e94\u7ed3\u679c\u6ca1\u6709\u4e92\u76f8\u4f9d\u8d56\uff0c\u5bf9\u7ed3\u679c\u54cd\u5e94\u4e5f\u65e0\u9700\u7acb\u5373\u83b7\u5f97\uff0c\u90a3\u4e48pipeline\u5c31\u53ef\u4ee5\u5145\u5f53\u8fd9\u79cd\u201c\u6279\u5904\u7406\u201d\u7684\u5de5\u5177\uff1b\u800c\u4e14\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\uff0c\u53ef\u4ee5\u8f83\u5927\u7684\u63d0\u5347\u6027\u80fd\uff0c\u6027\u80fd\u63d0\u5347\u7684\u539f\u56e0\u4e3b\u8981\u662fTCP\u8fde\u63a5\u4e2d\u51cf\u5c11\u4e86\u201c\u4ea4\u4e92\u5f80\u8fd4\u201d\u7684\u65f6\u95f4\u3002 \u4e0d\u8fc7\u5728\u7f16\u7801\u65f6\u8bf7\u6ce8\u610f\uff0cpipeline\u671f\u95f4\u5c06\u201c\u72ec\u5360\u201d\u94fe\u63a5\uff0c\u6b64\u671f\u95f4\u5c06\u4e0d\u80fd\u8fdb\u884c\u975e\u201c\u7ba1\u9053\u201d\u7c7b\u578b\u7684\u5176\u4ed6\u64cd\u4f5c\uff0c\u76f4\u5230pipeline\u5173\u95ed\uff1b\u5982\u679c\u4f60\u7684pipeline\u7684\u6307\u4ee4\u96c6\u5f88\u5e9e\u5927\uff0c\u4e3a\u4e86\u4e0d\u5e72\u6270\u94fe\u63a5\u4e2d\u7684\u5176\u4ed6\u64cd\u4f5c\uff0c\u4f60\u53ef\u4ee5\u4e3apipeline\u64cd\u4f5c\u65b0\u5efaClient\u94fe\u63a5\uff0c\u8ba9pipeline\u548c\u5176\u4ed6\u6b63\u5e38\u64cd\u4f5c\u5206\u79bb\u57282\u4e2aclient\u4e2d\u3002\u4e0d\u8fc7pipeline\u4e8b\u5b9e\u4e0a\u6240\u80fd\u5bb9\u5fcd\u7684\u64cd\u4f5c\u4e2a\u6570\uff0c\u548csocket-output\u7f13\u51b2\u533a\u5927\u5c0f/\u8fd4\u56de\u7ed3\u679c\u7684\u6570\u636e\u5c3a\u5bf8\u90fd\u6709\u5f88\u5927\u7684\u5173\u7cfb\uff1b\u540c\u65f6\u4e5f\u610f\u5473\u7740\u6bcf\u4e2aredis-server\u540c\u65f6\u6240\u80fd\u652f\u6491\u7684pipeline\u94fe\u63a5\u7684\u4e2a\u6570\uff0c\u4e5f\u662f\u6709\u9650\u7684\uff0c\u8fd9\u5c06\u53d7\u9650\u4e8eserver\u7684\u7269\u7406\u5185\u5b58\u6216\u7f51\u7edc\u63a5\u53e3\u7684\u7f13\u51b2\u80fd\u529b\u3002 Redis\u4f7f\u7528\u7684\u662f\u5ba2\u6237\u7aef-\u670d\u52a1\u5668\uff08CS\uff09\u6a21\u578b\u548c\u8bf7\u6c42/\u54cd\u5e94\u534f\u8bae\u7684TCP\u670d\u52a1\u5668\u3002\u8fd9\u610f\u5473\u7740\u901a\u5e38\u60c5\u51b5\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u4f1a\u9075\u5faa\u4ee5\u4e0b\u6b65\u9aa4\uff1a \u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u9001\u4e00\u4e2a\u67e5\u8be2\u8bf7\u6c42\uff0c\u5e76\u76d1\u542cSocket\u8fd4\u56de\uff0c\u901a\u5e38\u662f\u4ee5\u963b\u585e\u6a21\u5f0f\uff0c\u7b49\u5f85\u670d\u52a1\u7aef\u54cd\u5e94\u3002 \u670d\u52a1\u7aef\u5904\u7406\u547d\u4ee4\uff0c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002 Redis\u5ba2\u6237\u7aef\u4e0eRedis\u670d\u52a1\u5668\u4e4b\u95f4\u4f7f\u7528TCP\u534f\u8bae\u8fdb\u884c\u8fde\u63a5\uff0c\u4e00\u4e2a\u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2asocket\u8fde\u63a5\u53d1\u8d77\u591a\u4e2a\u8bf7\u6c42\u547d\u4ee4\u3002\u6bcf\u4e2a\u8bf7\u6c42\u547d\u4ee4\u53d1\u51fa\u540eclient\u901a\u5e38\u4f1a\u963b\u585e\u5e76\u7b49\u5f85redis\u670d\u52a1\u5668\u5904\u7406\uff0credis\u5904\u7406\u5b8c\u8bf7\u6c42\u547d\u4ee4\u540e\u4f1a\u5c06\u7ed3\u679c\u901a\u8fc7\u54cd\u5e94\u62a5\u6587\u8fd4\u56de\u7ed9client\uff0c\u56e0\u6b64\u5f53\u6267\u884c\u591a\u6761\u547d\u4ee4\u7684\u65f6\u5019\u90fd\u9700\u8981\u7b49\u5f85\u4e0a\u4e00\u6761\u547d\u4ee4\u6267\u884c\u5b8c\u6bd5\u624d\u80fd\u6267\u884c\u3002\u6bd4\u5982\uff1a 127.0.0.1:6379> get k1 \"v1\" 127.0.0.1:6379> get k2 \"v2\" 127.0.0.1:6379> get k3 \"v3\" \u7531\u4e8e\u901a\u4fe1\u4f1a\u6709\u7f51\u7edc\u5ef6\u8fdf\uff0c\u5047\u5982client\u548cserver\u4e4b\u95f4\u7684\u5305\u4f20\u8f93\u65f6\u95f4\u9700\u89810.125\u79d2\u3002\u90a3\u4e48\u4e0a\u9762\u7684\u4e09\u4e2a\u547d\u4ee46\u4e2a\u62a5\u6587\u81f3\u5c11\u9700\u89810.75\u79d2\u624d\u80fd\u5b8c\u6210\u3002\u8fd9\u6837\u5373\u4f7fredis\u6bcf\u79d2\u80fd\u5904\u7406100\u4e2a\u547d\u4ee4\uff0c\u800c\u6211\u4eec\u7684client\u4e5f\u53ea\u80fd\u4e00\u79d2\u949f\u53d1\u51fa\u56db\u4e2a\u547d\u4ee4\u3002\u8fd9\u663e\u7136\u6ca1\u6709\u5145\u5206\u5229\u7528 redis\u7684\u5904\u7406\u80fd\u529b\u3002 \u800c\u7ba1\u9053\uff08pipeline\uff09\u53ef\u4ee5\u4e00\u6b21\u6027\u53d1\u9001\u591a\u6761\u547d\u4ee4\u5e76\u5728\u6267\u884c\u5b8c\u540e\u4e00\u6b21\u6027\u5c06\u7ed3\u679c\u8fd4\u56de\uff0cpipeline\u901a\u8fc7\u51cf\u5c11\u5ba2\u6237\u7aef\u4e0eredis\u7684\u901a\u4fe1\u6b21\u6570\u6765\u5b9e\u73b0\u964d\u4f4e\u5f80\u8fd4\u5ef6\u65f6\u65f6\u95f4\uff0c\u800c\u4e14Pipeline \u5b9e\u73b0\u7684\u539f\u7406\u662f\u961f\u5217\uff0c\u800c\u961f\u5217\u7684\u539f\u7406\u662f\u65f6\u5148\u8fdb\u5148\u51fa\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u6570\u636e\u7684\u987a\u5e8f\u6027\u3002 Pipeline \u7684\u9ed8\u8ba4\u7684\u540c\u6b65\u7684\u4e2a\u6570\u4e3a53\u4e2a\uff0c\u4e5f\u5c31\u662f\u8bf4arges\u4e2d\u7d2f\u52a0\u523053\u6761\u6570\u636e\u65f6\u4f1a\u628a\u6570\u636e\u63d0\u4ea4\u3002\u5176\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1aclient\u53ef\u4ee5\u5c06\u4e09\u4e2a\u547d\u4ee4\u653e\u5230\u4e00\u4e2atcp\u62a5\u6587\u4e00\u8d77\u53d1\u9001\uff0cserver\u5219\u53ef\u4ee5\u5c06\u4e09\u6761\u547d\u4ee4\u7684\u5904\u7406\u7ed3\u679c\u653e\u5230\u4e00\u4e2atcp\u62a5\u6587\u8fd4\u56de\u3002 \u6ce8\u610f \u7528 pipeline\u65b9\u5f0f\u6253\u5305\u547d\u4ee4\u53d1\u9001\uff0credis\u5fc5\u987b\u5728\u5904\u7406\u5b8c\u6240\u6709\u547d\u4ee4\u524d\u5148\u7f13\u5b58\u8d77\u6240\u6709\u547d\u4ee4\u7684\u5904\u7406\u7ed3\u679c\u3002\u6253\u5305\u7684\u547d\u4ee4\u8d8a\u591a\uff0c\u7f13\u5b58\u6d88\u8017\u5185\u5b58\u4e5f\u8d8a\u591a\u3002\u6240\u4ee5\u5e76\u4e0d\u662f\u6253\u5305\u7684\u547d\u4ee4\u8d8a\u591a\u8d8a\u597d\u3002\u5177\u4f53\u591a\u5c11\u5408\u9002\u9700\u8981\u6839\u636e\u5177\u4f53\u60c5\u51b5\u6d4b\u8bd5\u3002","title":"1. Python Redis pipeline\u4ecb\u7ecd"},{"location":"python/lib/nosql/redis/redis.pipeline/#2-python-redis-pipeline","text":"#!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/2/21 13:25 @File : pipeline_demo.py @Author : summer @Software: PyCharm \"\"\" import redis import time r = redis.Redis(host='127.0.0.1', port=6379, password='') def try_pipeline(): start = time.time() with r.pipeline(transaction=False) as p: p.sadd('set1', 1).sadd('set2', 2).srem('set2', 2).lpush('list1', 1).lrange('list2', 0, -1) p.execute() print(time.time() - start) def without_pipeline(): start = time.time() r.sadd('seta', 1) r.sadd('seta', 2) r.srem('seta', 2) r.lpush('lista', 1 r.lrange('lista', 0, -1) print(time.time() - start) if __name__ == '__main__': try_pipeline() without_pipeline() \u8fd0\u884c\u7ed3\u679c D:\\code\\code-flask\\code-flask\\venv\\Scripts\\python.exe D:/code/code-flask/code-flask/2019-02-20/1.py 0.004987478256225586 0.03494906425476074 try_pipeline\u5e73\u5747\u5904\u7406\u65f6\u95f4\uff1a0.004987478256225586 without_pipeline\u5e73\u5747\u5904\u7406\u65f6\u95f4\uff1a0.03494906425476074 \u6211\u4eec\u7684\u6279\u91cf\u91cc\u67095\u4e2a\u64cd\u4f5c\uff0c\u5728\u5904\u7406\u65f6\u95f4\u7ef4\u5ea6\u4e0a\u6027\u80fd\u63d0\u5347\u4e867\u500d\uff01 pipeline\u6279\u91cf\u64cd\u4f5c\u53ea\u8fdb\u884c\u4e00\u6b21\u7f51\u7edc\u5f80\u8fd4\uff0c\u53ef\u4ee5\u770b\u5230\u8282\u7701\u7684\u65f6\u95f4\u57fa\u672c\u90fd\u662f\u7f51\u8def\u5ef6\u8fdf\u3002 2\u3001pipeline\u4e0etransation pipeline\u4e0d\u4ec5\u4ec5\u7528\u6765\u6279\u91cf\u7684\u63d0\u4ea4\u547d\u4ee4\uff0c\u8fd8\u7528\u6765\u5b9e\u73b0\u4e8b\u52a1transation\u3002 \u4f7f\u7528transaction\u4e0e\u5426\u4e0d\u540c\u4e4b\u5904\u5728\u4e0e\u521b\u5efapipeline\u5b9e\u4f8b\u7684\u65f6\u5019\uff0ctransaction\u662f\u5426\u6253\u5f00\uff0c\u9ed8\u8ba4\u662f\u6253\u5f00\u7684\u3002 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/2/21 13:25 @File : pipeline_demo.py @Author : summer @Software: PyCharm \"\"\" # -*- coding:utf-8 -*- import redis from redis import WatchError from concurrent.futures import ProcessPoolExecutor r = redis.Redis(host='127.0.0.1', port=6379) # \u51cf\u5e93\u5b58\u51fd\u6570, \u5faa\u73af\u76f4\u5230\u51cf\u5e93\u5b58\u5b8c\u6210 # \u5e93\u5b58\u5145\u8db3, \u51cf\u5e93\u5b58\u6210\u529f, \u8fd4\u56deTrue # \u5e93\u5b58\u4e0d\u8db3, \u51cf\u5e93\u5b58\u5931\u8d25, \u8fd4\u56deFalse def decr_stock(): # python\u4e2dredis\u4e8b\u52a1\u662f\u901a\u8fc7pipeline\u7684\u5c01\u88c5\u5b9e\u73b0\u7684 with r.pipeline() as pipe: while True: try: # watch\u5e93\u5b58\u952e, multi\u540e\u5982\u679c\u8be5key\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u6539\u53d8, \u4e8b\u52a1\u64cd\u4f5c\u4f1a\u629b\u51faWatchError\u5f02\u5e38 pipe.watch('stock:count') count = int(pipe.get('stock:count')) if count > 0: # \u6709\u5e93\u5b58 # \u4e8b\u52a1\u5f00\u59cb pipe.multi() pipe.decr('stock:count') # \u628a\u547d\u4ee4\u63a8\u9001\u8fc7\u53bb # execute\u8fd4\u56de\u547d\u4ee4\u6267\u884c\u7ed3\u679c\u5217\u8868, \u8fd9\u91cc\u53ea\u6709\u4e00\u4e2adecr\u8fd4\u56de\u5f53\u524d\u503c print(pipe.execute()[0]) return True else: return False except WatchError as ex: # \u6253\u5370WatchError\u5f02\u5e38, \u89c2\u5bdf\u88abwatch\u9501\u4f4f\u7684\u60c5\u51b5 print(ex, '\u9501\u4f4f\u4e86') pipe.unwatch() def worker(): while True: # \u6ca1\u6709\u5e93\u5b58\u5c31\u9000\u51fa if not decr_stock(): break # \u5b9e\u9a8c\u5f00\u59cb \u8bbe\u7f6e\u5e93\u5b58\u4e3a20 r.set(\"stock:count\", 20) # \u591a\u8fdb\u7a0b\u6a21\u62df\u591a\u4e2a\u5ba2\u6237\u7aef\u63d0\u4ea4 if __name__ == '__main__': with ProcessPoolExecutor(max_workers=2) as pool: for _ in range(10): pool.submit(worker) \u8fd0\u884c\u7ed3\u679c D:\\code\\code-flask\\code-flask\\venv\\Scripts\\python.exe D:/code/code-flask/code-flask/2019-02-20/1.py 19 18 17 16 19 18 Watched variable changed. \u9501\u4f4f\u4e86 17 Watched variable changed. \u9501\u4f4f\u4e86 16 Watched variable changed. \u9501\u4f4f\u4e86 15 Watched variable changed. \u9501\u4f4f\u4e86 Watched variable changed. \u9501\u4f4f\u4e86 14 13 Watched variable changed. \u9501\u4f4f\u4e86 12 Watched variable changed. \u9501\u4f4f\u4e86 11 Watched variable changed. \u9501\u4f4f\u4e86 10 9 Watched variable changed. \u9501\u4f4f\u4e86 8 7 6 5 Watched variable changed. \u9501\u4f4f\u4e86 4 3 2 1 Watched variable changed. \u9501\u4f4f\u4e86 0 Process finished with exit code 0","title":"2. Python Redis pipeline\u64cd\u4f5c"},{"location":"python/lib/nosql/redis/redis.pub_sub/","text":"redis \u53d1\u5e03\u8ba2\u9605 1. \u4ecb\u7ecd \u00b6 Redis \u53d1\u5e03\u8ba2\u9605(pub/sub)\u662f\u4e00\u79cd\u6d88\u606f\u901a\u4fe1\u6a21\u5f0f\uff1a\u53d1\u9001\u8005(pub)\u53d1\u9001\u6d88\u606f\uff0c\u8ba2\u9605\u8005(sub)\u63a5\u6536\u6d88\u606f\u3002 Redis \u5ba2\u6237\u7aef\u53ef\u4ee5\u8ba2\u9605\u4efb\u610f\u6570\u91cf\u7684\u9891\u9053\u3002 \u4e0b\u56fe\u5c55\u793a\u4e86\u9891\u9053 channel1 \uff0c \u4ee5\u53ca\u8ba2\u9605\u8fd9\u4e2a\u9891\u9053\u7684\u4e09\u4e2a\u5ba2\u6237\u7aef \u2014\u2014 client2 \u3001 client5 \u548c client1 \u4e4b\u95f4\u7684\u5173\u7cfb\uff1a \u4e0b\u56fe\u5c55\u793a\u4e86\u9891\u9053 channel1 \uff0c \u4ee5\u53ca\u8ba2\u9605\u8fd9\u4e2a\u9891\u9053\u7684\u4e09\u4e2a\u5ba2\u6237\u7aef \u2014\u2014 client2 \u3001 client5 \u548c client1 \u4e4b\u95f4\u7684\u5173\u7cfb\uff1a graph TB client1-->channel1 client2-->channel1 client3-->channel1 \u5f53\u6709\u65b0\u6d88\u606f\u901a\u8fc7 PUBLISH \u547d\u4ee4\u53d1\u9001\u7ed9\u9891\u9053 channel1 \u65f6\uff0c \u8fd9\u4e2a\u6d88\u606f\u5c31\u4f1a\u88ab\u53d1\u9001\u7ed9\u8ba2\u9605\u5b83\u7684\u4e09\u4e2a\u5ba2\u6237\u7aef\uff1a graph TB publish_channel1_message --> channel1 channel1-->client1 channel1-->client2 channel1-->client3 2. \u5b9e\u4f8b \u00b6 \u5728\u6211\u4eec\u5b9e\u4f8b\u4e2d\u6211\u4eec\u521b\u5efa\u4e86\u8ba2\u9605\u9891\u9053\u540d\u4e3a redisChat 2.1 \u53d1\u5e03\u7aef \u00b6 root@leco:~/code/redis# redis-cli 127.0.0.1:6379> PUBLISH redisChat \"Redis is a great caching technique\" (integer) 1 127.0.0.1:6379> PUBLISH redisChat \"Learn redis by summer\" (integer) 1 127.0.0.1:6379> \u53d1\u5e03\u8005\u53d1\u5e03\u4e86\u4e24\u6761\u6d88\u606f 2.2 \u63a5\u6536\u7aef \u00b6 root@leco:~/code/redis# redis-cli 127.0.0.1:6379> SUBSCRIBE redisChat Reading messages... (press Ctrl-C to quit) 1) \"subscribe\" 2) \"redisChat\" 3) (integer) 1 1) \"message\" 2) \"redisChat\" 3) \"Redis is a great caching technique\" 1) \"message\" 2) \"redisChat\" 3) \"Learn redis by summer\" \u63a5\u6536\u5230\u6536\u5230\u4e86\u4e24\u6761\u6d88\u606f python \u5b9e\u73b0 root@leco:~/code/redis# cat p.py import redis r=redis.Redis(host=\"localhost\",port=6379,decode_responses=True) #\u53d1\u5e03\u4f7f\u7528publish(self, channel, message):Publish ``message`` on ``channel``. Flag=True while Flag: msg=input(\"\u4e3b\u64ad\u8bf7\u8bb2\u8bdd>>:\") if len(msg)==0: continue elif msg=='quit': break else: r.publish('cctv0',msg) root@leco:~/code/redis# cat r.py import redis r=redis.Redis(host=\"localhost\",port=6379,decode_responses=True) #\u53d1\u5e03\u4f7f\u7528publish(self, channel, message):Publish ``message`` on ``channel``. Flag=True chan=r.pubsub()#\u8fd4\u56de\u4e00\u4e2a\u53d1\u5e03/\u8ba2\u9605\u5bf9\u8c61 msg_reciver=chan.subscribe('cctv0')#\u8ba2\u9605 msg=chan.parse_response()#\u7b2c\u4e00\u6b21\u4f1a\u8fd4\u56de\u8ba2\u9605\u786e\u8ba4\u4fe1\u606f print(msg) print(\"\u8ba2\u9605\u6210\u529f\uff0c\u5f00\u59cb\u63a5\u6536------\") while Flag: msg=chan.parse_response()#\u63a5\u6536\u6d88\u606f print(\">>:\",msg[2])#\u6b64\u5904\u7684\u4fe1\u606f\u683c\u5f0f['\u6d88\u606f\u7c7b\u578b', '\u9891\u9053', '\u6d88\u606f']\uff0c\u6240\u4ee5\u4f7f\u7528[2]\u6765\u83b7\u53d6 \u6d4b\u8bd5 \u53d1\u5e03\u7aef root@leco:~/code/redis# python3 p.py \u4e3b\u64ad\u8bf7\u8bb2\u8bdd>>:\u6211\u662fredis\u7684\u53d1\u5e03\u5e73\u53f0 \u4e3b\u64ad\u8bf7\u8bb2\u8bdd>>: \u63a5\u53d7\u7aef root@leco:~/code/redis# python3 r.py ['subscribe', 'cctv0', 1] \u8ba2\u9605\u6210\u529f\uff0c\u5f00\u59cb\u63a5\u6536------ >>: \u6211\u662fredis\u7684\u53d1\u5e03\u5e73\u53f0 \u963b\u585e\u5728\u8fd9\uff0c\u7b49\u5f85\u63a5\u53d7\u6570\u636e","title":"4. redis pub_sub"},{"location":"python/lib/nosql/redis/redis.pub_sub/#1","text":"Redis \u53d1\u5e03\u8ba2\u9605(pub/sub)\u662f\u4e00\u79cd\u6d88\u606f\u901a\u4fe1\u6a21\u5f0f\uff1a\u53d1\u9001\u8005(pub)\u53d1\u9001\u6d88\u606f\uff0c\u8ba2\u9605\u8005(sub)\u63a5\u6536\u6d88\u606f\u3002 Redis \u5ba2\u6237\u7aef\u53ef\u4ee5\u8ba2\u9605\u4efb\u610f\u6570\u91cf\u7684\u9891\u9053\u3002 \u4e0b\u56fe\u5c55\u793a\u4e86\u9891\u9053 channel1 \uff0c \u4ee5\u53ca\u8ba2\u9605\u8fd9\u4e2a\u9891\u9053\u7684\u4e09\u4e2a\u5ba2\u6237\u7aef \u2014\u2014 client2 \u3001 client5 \u548c client1 \u4e4b\u95f4\u7684\u5173\u7cfb\uff1a \u4e0b\u56fe\u5c55\u793a\u4e86\u9891\u9053 channel1 \uff0c \u4ee5\u53ca\u8ba2\u9605\u8fd9\u4e2a\u9891\u9053\u7684\u4e09\u4e2a\u5ba2\u6237\u7aef \u2014\u2014 client2 \u3001 client5 \u548c client1 \u4e4b\u95f4\u7684\u5173\u7cfb\uff1a graph TB client1-->channel1 client2-->channel1 client3-->channel1 \u5f53\u6709\u65b0\u6d88\u606f\u901a\u8fc7 PUBLISH \u547d\u4ee4\u53d1\u9001\u7ed9\u9891\u9053 channel1 \u65f6\uff0c \u8fd9\u4e2a\u6d88\u606f\u5c31\u4f1a\u88ab\u53d1\u9001\u7ed9\u8ba2\u9605\u5b83\u7684\u4e09\u4e2a\u5ba2\u6237\u7aef\uff1a graph TB publish_channel1_message --> channel1 channel1-->client1 channel1-->client2 channel1-->client3","title":"1. \u4ecb\u7ecd"},{"location":"python/lib/nosql/redis/redis.pub_sub/#2","text":"\u5728\u6211\u4eec\u5b9e\u4f8b\u4e2d\u6211\u4eec\u521b\u5efa\u4e86\u8ba2\u9605\u9891\u9053\u540d\u4e3a redisChat","title":"2. \u5b9e\u4f8b"},{"location":"python/lib/nosql/redis/redis.pub_sub/#21","text":"root@leco:~/code/redis# redis-cli 127.0.0.1:6379> PUBLISH redisChat \"Redis is a great caching technique\" (integer) 1 127.0.0.1:6379> PUBLISH redisChat \"Learn redis by summer\" (integer) 1 127.0.0.1:6379> \u53d1\u5e03\u8005\u53d1\u5e03\u4e86\u4e24\u6761\u6d88\u606f","title":"2.1 \u53d1\u5e03\u7aef"},{"location":"python/lib/nosql/redis/redis.pub_sub/#22","text":"root@leco:~/code/redis# redis-cli 127.0.0.1:6379> SUBSCRIBE redisChat Reading messages... (press Ctrl-C to quit) 1) \"subscribe\" 2) \"redisChat\" 3) (integer) 1 1) \"message\" 2) \"redisChat\" 3) \"Redis is a great caching technique\" 1) \"message\" 2) \"redisChat\" 3) \"Learn redis by summer\" \u63a5\u6536\u5230\u6536\u5230\u4e86\u4e24\u6761\u6d88\u606f python \u5b9e\u73b0 root@leco:~/code/redis# cat p.py import redis r=redis.Redis(host=\"localhost\",port=6379,decode_responses=True) #\u53d1\u5e03\u4f7f\u7528publish(self, channel, message):Publish ``message`` on ``channel``. Flag=True while Flag: msg=input(\"\u4e3b\u64ad\u8bf7\u8bb2\u8bdd>>:\") if len(msg)==0: continue elif msg=='quit': break else: r.publish('cctv0',msg) root@leco:~/code/redis# cat r.py import redis r=redis.Redis(host=\"localhost\",port=6379,decode_responses=True) #\u53d1\u5e03\u4f7f\u7528publish(self, channel, message):Publish ``message`` on ``channel``. Flag=True chan=r.pubsub()#\u8fd4\u56de\u4e00\u4e2a\u53d1\u5e03/\u8ba2\u9605\u5bf9\u8c61 msg_reciver=chan.subscribe('cctv0')#\u8ba2\u9605 msg=chan.parse_response()#\u7b2c\u4e00\u6b21\u4f1a\u8fd4\u56de\u8ba2\u9605\u786e\u8ba4\u4fe1\u606f print(msg) print(\"\u8ba2\u9605\u6210\u529f\uff0c\u5f00\u59cb\u63a5\u6536------\") while Flag: msg=chan.parse_response()#\u63a5\u6536\u6d88\u606f print(\">>:\",msg[2])#\u6b64\u5904\u7684\u4fe1\u606f\u683c\u5f0f['\u6d88\u606f\u7c7b\u578b', '\u9891\u9053', '\u6d88\u606f']\uff0c\u6240\u4ee5\u4f7f\u7528[2]\u6765\u83b7\u53d6 \u6d4b\u8bd5 \u53d1\u5e03\u7aef root@leco:~/code/redis# python3 p.py \u4e3b\u64ad\u8bf7\u8bb2\u8bdd>>:\u6211\u662fredis\u7684\u53d1\u5e03\u5e73\u53f0 \u4e3b\u64ad\u8bf7\u8bb2\u8bdd>>: \u63a5\u53d7\u7aef root@leco:~/code/redis# python3 r.py ['subscribe', 'cctv0', 1] \u8ba2\u9605\u6210\u529f\uff0c\u5f00\u59cb\u63a5\u6536------ >>: \u6211\u662fredis\u7684\u53d1\u5e03\u5e73\u53f0 \u963b\u585e\u5728\u8fd9\uff0c\u7b49\u5f85\u63a5\u53d7\u6570\u636e","title":"2.2 \u63a5\u6536\u7aef"},{"location":"python/lib/nosql/redis/redis.sentinel/","text":"redis sentinel root@leco:~/code/redis# cat sentinel.py #!/usr/bin/env python # -*- coding:utf-8 -*- # author: summer from redis.sentinel import Sentinel # \u8fde\u63a5\u54e8\u5175\u670d\u52a1\u5668(\u4e3b\u673a\u540d\u4e5f\u53ef\u4ee5\u7528\u57df\u540d) sentinel = Sentinel([('127.0.0.1', 26379), ('127.0.0.1', 26380), ('127.0.0.1', 26381)], socket_timeout=0.5) # \u83b7\u53d6\u4e3b\u670d\u52a1\u5668\u5730\u5740 master = sentinel.discover_master('mymaster') print(\"\u5f53\u524dmaster = \", master) # \u83b7\u53d6\u4ece\u670d\u52a1\u5668\u5730\u5740 slave = sentinel.discover_slaves('mymaster') print(\"\u5f53\u524dslave = \", slave) # \u83b7\u53d6\u4e3b\u670d\u52a1\u5668\u8fdb\u884c\u5199\u5165 master = sentinel.master_for('mymaster') master.set('name','summer') # \u83b7\u53d6\u4ece\u670d\u52a1\u5668\u8fdb\u884c\u8bfb\u53d6\uff08\u9ed8\u8ba4\u662fround-roubin\uff09 #slave = sentinel.slave_for('mymaster', password='redis_auth_pass') slave = sentinel.slave_for('mymaster') data = slave.get('name') print(data) \u8fd0\u884c\u7ed3\u679c root@leco:~/code/redis# python sentinel.py \u5f53\u524dmaster = ('127.0.0.1', 6379) \u5f53\u524dslave = [('127.0.0.1', 10380), ('127.0.0.1', 10381)] b'cmz'","title":"5. redis sentinel"},{"location":"python/lib/nosql/redis/redis.transaction/","text":"redis transcation 1\u3001\u57fa\u672c\u6982\u5ff5 \u00b6 1.1 \u4ec0\u4e48\u662fredis\u7684\u4e8b\u52a1\uff1f \u00b6 \u7b80\u5355\u7406\u89e3\uff0c\u53ef\u4ee5\u8ba4\u4e3aredis\u4e8b\u52a1\u662f\u4e00\u4e9b\u5217redis\u547d\u4ee4\u7684\u96c6\u5408\uff0c\u5e76\u4e14\u6709\u5982\u4e0b\u4e24\u4e2a\u7279\u70b9\uff1a \u4e8b\u52a1\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u9694\u79bb\u64cd\u4f5c\uff1a\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u90fd\u4f1a\u5e8f\u5217\u5316\u3001\u6309\u987a\u5e8f\u5730\u6267\u884c\u3002\u4e8b\u52a1\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684\u547d\u4ee4\u8bf7\u6c42\u6240\u6253\u65ad\u3002 \u4e8b\u52a1\u662f\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\uff1a\u4e8b\u52a1\u4e2d\u7684\u547d\u4ee4\u8981\u4e48\u5168\u90e8\u88ab\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u90fd\u4e0d\u6267\u884c\u3002 1.2 \u4e8b\u52a1\u7684\u6027\u8d28ACID \u00b6 \u4e00\u822c\u6765\u8bf4\uff0c\u4e8b\u52a1\u6709\u56db\u4e2a\u6027\u8d28\u79f0\u4e3aACID\uff0c\u5206\u522b\u662f\u539f\u5b50\u6027\uff0c\u4e00\u81f4\u6027\uff0c\u9694\u79bb\u6027\u548c\u6301\u4e45\u6027\u3002 \u539f\u5b50\u6027atomicity\uff1aredis\u4e8b\u52a1\u4fdd\u8bc1\u4e8b\u52a1\u4e2d\u7684\u547d\u4ee4\u8981\u4e48\u5168\u90e8\u6267\u884c\u8981\u4e0d\u5168\u90e8\u4e0d\u6267\u884c\u3002\u6709\u4e9b\u6587\u7ae0\u8ba4\u4e3aredis\u4e8b\u52a1\u5bf9\u4e8e\u6267\u884c\u9519\u8bef\u4e0d\u56de\u6eda\u8fdd\u80cc\u4e86\u539f\u5b50\u6027\uff0c\u662f\u504f\u9887\u7684\u3002 \u4e00\u81f4\u6027consistency\uff1aredis\u4e8b\u52a1\u53ef\u4ee5\u4fdd\u8bc1\u547d\u4ee4\u5931\u8d25\u7684\u60c5\u51b5\u4e0b\u5f97\u4ee5\u56de\u6eda\uff0c\u6570\u636e\u80fd\u6062\u590d\u5230\u6ca1\u6709\u6267\u884c\u4e4b\u524d\u7684\u6837\u5b50\uff0c\u662f\u4fdd\u8bc1\u4e00\u81f4\u6027\u7684\uff0c\u9664\u975eredis\u8fdb\u7a0b\u610f\u5916\u7ec8\u7ed3\u3002 \u9694\u79bb\u6027Isolation\uff1aredis\u4e8b\u52a1\u662f\u4e25\u683c\u9075\u5b88\u9694\u79bb\u6027\u7684\uff0c\u539f\u56e0\u662fredis\u662f\u5355\u8fdb\u7a0b\u5355\u7ebf\u7a0b\u6a21\u5f0f\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u547d\u4ee4\u6267\u884c\u8fc7\u7a0b\u4e2d\u4e0d\u4f1a\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u547d\u4ee4\u6253\u65ad\u3002 \u6301\u4e45\u6027Durability\uff1aredis\u4e8b\u52a1\u662f\u4e0d\u4fdd\u8bc1\u6301\u4e45\u6027\u7684\uff0c\u8fd9\u662f\u56e0\u4e3aredis\u6301\u4e45\u5316\u7b56\u7565\u4e2d\u4e0d\u7ba1\u662fRDB\u8fd8\u662fAOF\u90fd\u662f\u5f02\u6b65\u6267\u884c\u7684\uff0c\u4e0d\u4fdd\u8bc1\u6301\u4e45\u6027\u662f\u51fa\u4e8e\u5bf9\u6027\u80fd\u7684\u8003\u8651\u3002 1.3 redis\u4e8b\u52a1\u7684\u9519\u8bef \u00b6 \u4f7f\u7528\u4e8b\u52a1\u65f6\u53ef\u80fd\u4f1a\u9047\u4e0a\u4ee5\u4e0b\u4e24\u79cd\u9519\u8bef\uff1a \u5165\u961f\u9519\u8bef\uff1a\u4e8b\u52a1\u5728\u6267\u884c EXEC \u4e4b\u524d\uff0c\u5165\u961f\u7684\u547d\u4ee4\u53ef\u80fd\u4f1a\u51fa\u9519\u3002\u6bd4\u5982\u8bf4\uff0c\u547d\u4ee4\u53ef\u80fd\u4f1a\u4ea7\u751f\u8bed\u6cd5\u9519\u8bef\uff08\u53c2\u6570\u6570\u91cf\u9519\u8bef\uff0c\u53c2\u6570\u540d\u9519\u8bef\uff0c\u7b49\u7b49\uff09\uff0c\u6216\u8005\u5176\u4ed6\u66f4\u4e25\u91cd\u7684\u9519\u8bef\uff0c\u6bd4\u5982\u5185\u5b58\u4e0d\u8db3\uff08\u5982\u679c\u670d\u52a1\u5668\u4f7f\u7528 maxmemory \u8bbe\u7f6e\u4e86\u6700\u5927\u5185\u5b58\u9650\u5236\u7684\u8bdd\uff09\u3002 \u6267\u884c\u9519\u8bef\uff1a\u547d\u4ee4\u53ef\u80fd\u5728 EXEC \u8c03\u7528\u4e4b\u540e\u5931\u8d25\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e8b\u52a1\u4e2d\u7684\u547d\u4ee4\u53ef\u80fd\u5904\u7406\u4e86\u9519\u8bef\u7c7b\u578b\u7684\u952e\uff0c\u6bd4\u5982\u5c06\u5217\u8868\u547d\u4ee4\u7528\u5728\u4e86\u5b57\u7b26\u4e32\u952e\u4e0a\u9762\uff0c\u8bf8\u5982\u6b64\u7c7b\u3002 \u6ce8\u610f \u7b2c\u4e09\u79cd\u9519\u8bef\uff0credis\u8fdb\u7a0b\u7ec8\u7ed3\uff0c\u672c\u6587\u5e76\u6ca1\u6709\u8ba8\u8bba\u8fd9\u79cd\u9519\u8bef\u3002 2. redis\u4e8b\u52a1\u7684\u7528\u6cd5 \u00b6 redis\u4e8b\u52a1\u662f\u901a\u8fc7MULTI\uff0cEXEC\uff0cDISCARD\u548cWATCH\u56db\u4e2a\u539f\u8bed\u5b9e\u73b0\u7684\u3002 MULTI\u547d\u4ee4\u7528\u4e8e\u5f00\u542f\u4e00\u4e2a\u4e8b\u52a1\uff0c\u5b83\u603b\u662f\u8fd4\u56deOK\u3002 MULTI\u6267\u884c\u4e4b\u540e\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u7ee7\u7eed\u5411\u670d\u52a1\u5668\u53d1\u9001\u4efb\u610f\u591a\u6761\u547d\u4ee4\uff0c\u8fd9\u4e9b\u547d\u4ee4\u4e0d\u4f1a\u7acb\u5373\u88ab\u6267\u884c\uff0c\u800c\u662f\u88ab\u653e\u5230\u4e00\u4e2a\u961f\u5217\u4e2d\uff0c\u5f53EXEC\u547d\u4ee4\u88ab\u8c03\u7528\u65f6\uff0c\u6240\u6709\u961f\u5217\u4e2d\u7684\u547d\u4ee4\u624d\u4f1a\u88ab\u6267\u884c\u3002 \u53e6\u4e00\u65b9\u9762\uff0c\u901a\u8fc7\u8c03\u7528DISCARD\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u6e05\u7a7a\u4e8b\u52a1\u961f\u5217\uff0c\u5e76\u653e\u5f03\u6267\u884c\u4e8b\u52a1\u3002 Unwatch \u4e4b\u524d\u52a0\u7684\u76d1\u63a7\u9501\u90fd\u4f1a\u88ab\u53d6\u6d88\u6389\u4e86\uff0c\u4e4b\u524d\u6267\u884c\u7684\u5199\u64cd\u4f5c\u547d\u4ee4\u5168\u90e8\u53d6\u6d88 2.1 \u6b63\u5e38\u64cd\u4f5c \u00b6 127.0.0.1:6379> FLUSHALL OK 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> set key 1 QUEUED 127.0.0.1:6379> set key2 2 QUEUED 127.0.0.1:6379> sadd key3 3 QUEUED 127.0.0.1:6379> exec 1) OK 2) OK 3) (integer) 1 127.0.0.1:6379> keys * 1) \"key2\" 2) \"key3\" 3) \"key\" EXEC \u547d\u4ee4\u7684\u56de\u590d\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u662f\u6267\u884c\u4e8b\u52a1\u4e2d\u7684\u547d\u4ee4\u6240\u4ea7\u751f\u7684\u56de\u590d\u3002 \u5176\u4e2d\uff0c\u56de\u590d\u5143\u7d20\u7684\u5148\u540e\u987a\u5e8f\u548c\u547d\u4ee4\u53d1\u9001\u7684\u5148\u540e\u987a\u5e8f\u4e00\u81f4\u3002 \u5f53\u5ba2\u6237\u7aef\u5904\u4e8e\u4e8b\u52a1\u72b6\u6001\u65f6\uff0c\u6240\u6709\u4f20\u5165\u7684\u547d\u4ee4\u90fd\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5185\u5bb9\u4e3a QUEUED \u7684\u72b6\u6001\u56de\u590d\uff08status reply\uff09\uff0c\u8fd9\u4e9b\u88ab\u5165\u961f\u7684\u547d\u4ee4\u5c06\u5728 EXEC\u547d\u4ee4\u88ab\u8c03\u7528\u65f6\u6267\u884c\u3002 2.2 \u653e\u5f03\u4e8b\u52a1 \u00b6 \u5f53\u6267\u884c DISCARD \u547d\u4ee4\u65f6\uff0c\u4e8b\u52a1\u4f1a\u88ab\u653e\u5f03\uff0c\u4e8b\u52a1\u961f\u5217\u4f1a\u88ab\u6e05\u7a7a\uff0c\u5e76\u4e14\u5ba2\u6237\u7aef\u4f1a\u4ece\u4e8b\u52a1\u72b6\u6001\u4e2d\u9000\u51fa\uff1a 127.0.0.1:6379> get key \"1\" 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> set key 10 QUEUED 127.0.0.1:6379> DISCARD OK 127.0.0.1:6379> exec (error) ERR EXEC without MULTI 127.0.0.1:6379> get key \"1\" 2.3 \u5165\u961f\u9519\u8bef\u56de\u6eda \u00b6 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> set key 1 QUEUED 127.0.0.1:6379> HSET key2 1 (error) ERR wrong number of arguments for 'hset' command 127.0.0.1:6379> SADD key3 1 QUEUED 127.0.0.1:6379> exec (error) EXECABORT Transaction discarded because of previous errors. 127.0.0.1:6379> keys * (empty list or set) \u5bf9\u4e8e\u5165\u961f\u9519\u8bef\uff0credis 2.6.5\u7248\u672c\u540e\uff0c\u4f1a\u8bb0\u5f55\u8fd9\u79cd\u9519\u8bef\uff0c\u5e76\u4e14\u5728\u6267\u884cEXEC\u7684\u65f6\u5019\uff0c\u62a5\u9519\u5e76\u56de\u6eda\u4e8b\u52a1\u4e2d\u6240\u6709\u7684\u547d\u4ee4\uff0c\u5e76\u4e14\u7ec8\u6b62\u4e8b\u52a1 2.4 \u6267\u884c\u9519\u8bef\u653e\u8fc7 \u00b6 127.0.0.1:6379> flushall OK 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> set k1 v1 QUEUED 127.0.0.1:6379> set k2 v2 v3 QUEUED 127.0.0.1:6379> exec 1) OK 2) (error) ERR syntax error 127.0.0.1:6379> keys * 1) \"k1\" 127.0.0.1:6379> get k1 \"v1\" \u5f53\u9047\u5230\u6267\u884c\u9519\u8bef\u65f6\uff0credis\u653e\u8fc7\u8fd9\u79cd\u9519\u8bef\uff0c\u4fdd\u8bc1\u4e8b\u52a1\u6267\u884c\u5b8c\u6210\u3002 \u4e0d\u540c\u4e4b\u5904 \u4e0emysql\u4e2d\u4e8b\u52a1\u4e0d\u540c\uff0c\u5728redis\u4e8b\u52a1\u9047\u5230\u6267\u884c\u9519\u8bef\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u8fdb\u884c\u56de\u6eda\uff0c\u800c\u662f\u7b80\u5355\u7684\u653e\u8fc7\u4e86\uff0c\u5e76\u4fdd\u8bc1\u5176\u4ed6\u7684\u547d\u4ee4\u6b63\u5e38\u6267\u884c\u3002\u8fd9\u4e2a\u533a\u522b\u5728\u5b9e\u73b0\u4e1a\u52a1\u7684\u65f6\u5019\uff0c\u9700\u8981\u81ea\u5df1\u4fdd\u8bc1\u903b\u8f91\u7b26\u5408\u9884\u671f\u3002 2.5 watch \u00b6 WATCH \u547d\u4ee4\u53ef\u4ee5\u4e3a Redis \u4e8b\u52a1\u63d0\u4f9b check-and-set \uff08CAS\uff09\u884c\u4e3a\u3002 \u88ab WATCH \u7684\u952e\u4f1a\u88ab\u76d1\u89c6\uff0c\u5e76\u4f1a\u53d1\u89c9\u8fd9\u4e9b\u952e\u662f\u5426\u88ab\u6539\u52a8\u8fc7\u4e86\u3002 \u5982\u679c\u6709\u81f3\u5c11\u4e00\u4e2a\u88ab\u76d1\u89c6\u7684\u952e\u5728 EXEC \u6267\u884c\u4e4b\u524d\u88ab\u4fee\u6539\u4e86\uff0c \u90a3\u4e48\u6574\u4e2a\u4e8b\u52a1\u90fd\u4f1a\u88ab\u53d6\u6d88\uff0c EXEC \u8fd4\u56de\u7a7a\u591a\u6761\u6279\u91cf\u56de\u590d\uff08null multi-bulk reply\uff09\u6765\u8868\u793a\u4e8b\u52a1\u5df2\u7ecf\u5931\u8d25\u3002 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> watch key1 OK 127.0.0.1:6379> set key1 3 OK 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> set key1 3 QUEUED 127.0.0.1:6379> set key2 3 QUEUED 127.0.0.1:6379> exec (nil) 127.0.0.1:6379> keys * 1) \"key1\" \u4f7f\u7528\u4e0a\u9762\u7684\u4ee3\u7801\uff0c \u5982\u679c\u5728 WATCH \u6267\u884c\u4e4b\u540e\uff0c EXEC \u6267\u884c\u4e4b\u524d\uff0c \u6709\u5176\u4ed6\u5ba2\u6237\u7aef\u4fee\u6539\u4e86 key1 \u7684\u503c\uff0c \u90a3\u4e48\u5f53\u524d\u5ba2\u6237\u7aef\u7684\u4e8b\u52a1\u5c31\u4f1a\u5931\u8d25\u3002 \u7a0b\u5e8f\u9700\u8981\u505a\u7684\uff0c \u5c31\u662f\u4e0d\u65ad\u91cd\u8bd5\u8fd9\u4e2a\u64cd\u4f5c\uff0c \u76f4\u5230\u6ca1\u6709\u53d1\u751f\u78b0\u649e\u4e3a\u6b62\u3002 \u8fd9\u79cd\u5f62\u5f0f\u7684\u9501\u88ab\u79f0\u4f5c\u4e50\u89c2\u9501\uff0c \u5b83\u662f\u4e00\u79cd\u975e\u5e38\u5f3a\u5927\u7684\u9501\u673a\u5236\u3002 \u5e76\u4e14\u56e0\u4e3a\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c \u4e0d\u540c\u7684\u5ba2\u6237\u7aef\u4f1a\u8bbf\u95ee\u4e0d\u540c\u7684\u952e\uff0c \u78b0\u649e\u7684\u60c5\u51b5\u4e00\u822c\u90fd\u5f88\u5c11\uff0c \u6240\u4ee5\u901a\u5e38\u5e76\u4e0d\u9700\u8981\u8fdb\u884c\u91cd\u8bd5\u3002 3. demo \u00b6 \u8fd9\u91cc\u5c55\u793a\u4e00\u4e2a\u7528python\u5b9e\u73b0\u5bf9key\u8ba1\u6570\u51cf\u4e00\u7684\u539f\u5b50\u64cd\u4f5c\u3002 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/2/21 13:25 @File : pipeline_demo.py @Author : summer @Software: PyCharm \"\"\" import redis from redis import WatchError from concurrent.futures import ProcessPoolExecutor r = redis.Redis(host='127.0.0.1', port=6379) # \u51cf\u5e93\u5b58\u51fd\u6570, \u5faa\u73af\u76f4\u5230\u51cf\u5e93\u5b58\u5b8c\u6210 # \u5e93\u5b58\u5145\u8db3, \u51cf\u5e93\u5b58\u6210\u529f, \u8fd4\u56deTrue # \u5e93\u5b58\u4e0d\u8db3, \u51cf\u5e93\u5b58\u5931\u8d25, \u8fd4\u56deFalse def decr_stock(): # python\u4e2dredis\u4e8b\u52a1\u662f\u901a\u8fc7pipeline\u7684\u5c01\u88c5\u5b9e\u73b0\u7684 with r.pipeline() as pipe: while True: try: # watch\u5e93\u5b58\u952e, multi\u540e\u5982\u679c\u8be5key\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u6539\u53d8, \u4e8b\u52a1\u64cd\u4f5c\u4f1a\u629b\u51faWatchError\u5f02\u5e38 pipe.watch('stock:count') count = int(pipe.get('stock:count')) if count > 0: # \u6709\u5e93\u5b58 # \u4e8b\u52a1\u5f00\u59cb pipe.multi() pipe.decr('stock:count') # \u628a\u547d\u4ee4\u63a8\u9001\u8fc7\u53bb # execute\u8fd4\u56de\u547d\u4ee4\u6267\u884c\u7ed3\u679c\u5217\u8868, \u8fd9\u91cc\u53ea\u6709\u4e00\u4e2adecr\u8fd4\u56de\u5f53\u524d\u503c print(pipe.execute()[0]) return True else: return False except WatchError as ex: # \u6253\u5370WatchError\u5f02\u5e38, \u89c2\u5bdf\u88abwatch\u9501\u4f4f\u7684\u60c5\u51b5 print(ex, '\u9501\u4f4f\u4e86') pipe.unwatch() def worker(): while True: # \u6ca1\u6709\u5e93\u5b58\u5c31\u9000\u51fa if not decr_stock(): break # \u5b9e\u9a8c\u5f00\u59cb \u8bbe\u7f6e\u5e93\u5b58\u4e3a20 r.set(\"stock:count\", 20) # \u591a\u8fdb\u7a0b\u6a21\u62df\u591a\u4e2a\u5ba2\u6237\u7aef\u63d0\u4ea4 if __name__ == '__main__': with ProcessPoolExecutor(max_workers=2) as pool: for _ in range(10): pool.submit(worker)","title":"3. redis transaction"},{"location":"python/lib/nosql/redis/redis.transaction/#1","text":"","title":"1\u3001\u57fa\u672c\u6982\u5ff5"},{"location":"python/lib/nosql/redis/redis.transaction/#11-redis","text":"\u7b80\u5355\u7406\u89e3\uff0c\u53ef\u4ee5\u8ba4\u4e3aredis\u4e8b\u52a1\u662f\u4e00\u4e9b\u5217redis\u547d\u4ee4\u7684\u96c6\u5408\uff0c\u5e76\u4e14\u6709\u5982\u4e0b\u4e24\u4e2a\u7279\u70b9\uff1a \u4e8b\u52a1\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u9694\u79bb\u64cd\u4f5c\uff1a\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u90fd\u4f1a\u5e8f\u5217\u5316\u3001\u6309\u987a\u5e8f\u5730\u6267\u884c\u3002\u4e8b\u52a1\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684\u547d\u4ee4\u8bf7\u6c42\u6240\u6253\u65ad\u3002 \u4e8b\u52a1\u662f\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\uff1a\u4e8b\u52a1\u4e2d\u7684\u547d\u4ee4\u8981\u4e48\u5168\u90e8\u88ab\u6267\u884c\uff0c\u8981\u4e48\u5168\u90e8\u90fd\u4e0d\u6267\u884c\u3002","title":"1.1 \u4ec0\u4e48\u662fredis\u7684\u4e8b\u52a1\uff1f"},{"location":"python/lib/nosql/redis/redis.transaction/#12-acid","text":"\u4e00\u822c\u6765\u8bf4\uff0c\u4e8b\u52a1\u6709\u56db\u4e2a\u6027\u8d28\u79f0\u4e3aACID\uff0c\u5206\u522b\u662f\u539f\u5b50\u6027\uff0c\u4e00\u81f4\u6027\uff0c\u9694\u79bb\u6027\u548c\u6301\u4e45\u6027\u3002 \u539f\u5b50\u6027atomicity\uff1aredis\u4e8b\u52a1\u4fdd\u8bc1\u4e8b\u52a1\u4e2d\u7684\u547d\u4ee4\u8981\u4e48\u5168\u90e8\u6267\u884c\u8981\u4e0d\u5168\u90e8\u4e0d\u6267\u884c\u3002\u6709\u4e9b\u6587\u7ae0\u8ba4\u4e3aredis\u4e8b\u52a1\u5bf9\u4e8e\u6267\u884c\u9519\u8bef\u4e0d\u56de\u6eda\u8fdd\u80cc\u4e86\u539f\u5b50\u6027\uff0c\u662f\u504f\u9887\u7684\u3002 \u4e00\u81f4\u6027consistency\uff1aredis\u4e8b\u52a1\u53ef\u4ee5\u4fdd\u8bc1\u547d\u4ee4\u5931\u8d25\u7684\u60c5\u51b5\u4e0b\u5f97\u4ee5\u56de\u6eda\uff0c\u6570\u636e\u80fd\u6062\u590d\u5230\u6ca1\u6709\u6267\u884c\u4e4b\u524d\u7684\u6837\u5b50\uff0c\u662f\u4fdd\u8bc1\u4e00\u81f4\u6027\u7684\uff0c\u9664\u975eredis\u8fdb\u7a0b\u610f\u5916\u7ec8\u7ed3\u3002 \u9694\u79bb\u6027Isolation\uff1aredis\u4e8b\u52a1\u662f\u4e25\u683c\u9075\u5b88\u9694\u79bb\u6027\u7684\uff0c\u539f\u56e0\u662fredis\u662f\u5355\u8fdb\u7a0b\u5355\u7ebf\u7a0b\u6a21\u5f0f\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u547d\u4ee4\u6267\u884c\u8fc7\u7a0b\u4e2d\u4e0d\u4f1a\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u547d\u4ee4\u6253\u65ad\u3002 \u6301\u4e45\u6027Durability\uff1aredis\u4e8b\u52a1\u662f\u4e0d\u4fdd\u8bc1\u6301\u4e45\u6027\u7684\uff0c\u8fd9\u662f\u56e0\u4e3aredis\u6301\u4e45\u5316\u7b56\u7565\u4e2d\u4e0d\u7ba1\u662fRDB\u8fd8\u662fAOF\u90fd\u662f\u5f02\u6b65\u6267\u884c\u7684\uff0c\u4e0d\u4fdd\u8bc1\u6301\u4e45\u6027\u662f\u51fa\u4e8e\u5bf9\u6027\u80fd\u7684\u8003\u8651\u3002","title":"1.2 \u4e8b\u52a1\u7684\u6027\u8d28ACID"},{"location":"python/lib/nosql/redis/redis.transaction/#13-redis","text":"\u4f7f\u7528\u4e8b\u52a1\u65f6\u53ef\u80fd\u4f1a\u9047\u4e0a\u4ee5\u4e0b\u4e24\u79cd\u9519\u8bef\uff1a \u5165\u961f\u9519\u8bef\uff1a\u4e8b\u52a1\u5728\u6267\u884c EXEC \u4e4b\u524d\uff0c\u5165\u961f\u7684\u547d\u4ee4\u53ef\u80fd\u4f1a\u51fa\u9519\u3002\u6bd4\u5982\u8bf4\uff0c\u547d\u4ee4\u53ef\u80fd\u4f1a\u4ea7\u751f\u8bed\u6cd5\u9519\u8bef\uff08\u53c2\u6570\u6570\u91cf\u9519\u8bef\uff0c\u53c2\u6570\u540d\u9519\u8bef\uff0c\u7b49\u7b49\uff09\uff0c\u6216\u8005\u5176\u4ed6\u66f4\u4e25\u91cd\u7684\u9519\u8bef\uff0c\u6bd4\u5982\u5185\u5b58\u4e0d\u8db3\uff08\u5982\u679c\u670d\u52a1\u5668\u4f7f\u7528 maxmemory \u8bbe\u7f6e\u4e86\u6700\u5927\u5185\u5b58\u9650\u5236\u7684\u8bdd\uff09\u3002 \u6267\u884c\u9519\u8bef\uff1a\u547d\u4ee4\u53ef\u80fd\u5728 EXEC \u8c03\u7528\u4e4b\u540e\u5931\u8d25\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e8b\u52a1\u4e2d\u7684\u547d\u4ee4\u53ef\u80fd\u5904\u7406\u4e86\u9519\u8bef\u7c7b\u578b\u7684\u952e\uff0c\u6bd4\u5982\u5c06\u5217\u8868\u547d\u4ee4\u7528\u5728\u4e86\u5b57\u7b26\u4e32\u952e\u4e0a\u9762\uff0c\u8bf8\u5982\u6b64\u7c7b\u3002 \u6ce8\u610f \u7b2c\u4e09\u79cd\u9519\u8bef\uff0credis\u8fdb\u7a0b\u7ec8\u7ed3\uff0c\u672c\u6587\u5e76\u6ca1\u6709\u8ba8\u8bba\u8fd9\u79cd\u9519\u8bef\u3002","title":"1.3 redis\u4e8b\u52a1\u7684\u9519\u8bef"},{"location":"python/lib/nosql/redis/redis.transaction/#2-redis","text":"redis\u4e8b\u52a1\u662f\u901a\u8fc7MULTI\uff0cEXEC\uff0cDISCARD\u548cWATCH\u56db\u4e2a\u539f\u8bed\u5b9e\u73b0\u7684\u3002 MULTI\u547d\u4ee4\u7528\u4e8e\u5f00\u542f\u4e00\u4e2a\u4e8b\u52a1\uff0c\u5b83\u603b\u662f\u8fd4\u56deOK\u3002 MULTI\u6267\u884c\u4e4b\u540e\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u7ee7\u7eed\u5411\u670d\u52a1\u5668\u53d1\u9001\u4efb\u610f\u591a\u6761\u547d\u4ee4\uff0c\u8fd9\u4e9b\u547d\u4ee4\u4e0d\u4f1a\u7acb\u5373\u88ab\u6267\u884c\uff0c\u800c\u662f\u88ab\u653e\u5230\u4e00\u4e2a\u961f\u5217\u4e2d\uff0c\u5f53EXEC\u547d\u4ee4\u88ab\u8c03\u7528\u65f6\uff0c\u6240\u6709\u961f\u5217\u4e2d\u7684\u547d\u4ee4\u624d\u4f1a\u88ab\u6267\u884c\u3002 \u53e6\u4e00\u65b9\u9762\uff0c\u901a\u8fc7\u8c03\u7528DISCARD\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u6e05\u7a7a\u4e8b\u52a1\u961f\u5217\uff0c\u5e76\u653e\u5f03\u6267\u884c\u4e8b\u52a1\u3002 Unwatch \u4e4b\u524d\u52a0\u7684\u76d1\u63a7\u9501\u90fd\u4f1a\u88ab\u53d6\u6d88\u6389\u4e86\uff0c\u4e4b\u524d\u6267\u884c\u7684\u5199\u64cd\u4f5c\u547d\u4ee4\u5168\u90e8\u53d6\u6d88","title":"2. redis\u4e8b\u52a1\u7684\u7528\u6cd5"},{"location":"python/lib/nosql/redis/redis.transaction/#21","text":"127.0.0.1:6379> FLUSHALL OK 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> set key 1 QUEUED 127.0.0.1:6379> set key2 2 QUEUED 127.0.0.1:6379> sadd key3 3 QUEUED 127.0.0.1:6379> exec 1) OK 2) OK 3) (integer) 1 127.0.0.1:6379> keys * 1) \"key2\" 2) \"key3\" 3) \"key\" EXEC \u547d\u4ee4\u7684\u56de\u590d\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u662f\u6267\u884c\u4e8b\u52a1\u4e2d\u7684\u547d\u4ee4\u6240\u4ea7\u751f\u7684\u56de\u590d\u3002 \u5176\u4e2d\uff0c\u56de\u590d\u5143\u7d20\u7684\u5148\u540e\u987a\u5e8f\u548c\u547d\u4ee4\u53d1\u9001\u7684\u5148\u540e\u987a\u5e8f\u4e00\u81f4\u3002 \u5f53\u5ba2\u6237\u7aef\u5904\u4e8e\u4e8b\u52a1\u72b6\u6001\u65f6\uff0c\u6240\u6709\u4f20\u5165\u7684\u547d\u4ee4\u90fd\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5185\u5bb9\u4e3a QUEUED \u7684\u72b6\u6001\u56de\u590d\uff08status reply\uff09\uff0c\u8fd9\u4e9b\u88ab\u5165\u961f\u7684\u547d\u4ee4\u5c06\u5728 EXEC\u547d\u4ee4\u88ab\u8c03\u7528\u65f6\u6267\u884c\u3002","title":"2.1 \u6b63\u5e38\u64cd\u4f5c"},{"location":"python/lib/nosql/redis/redis.transaction/#22","text":"\u5f53\u6267\u884c DISCARD \u547d\u4ee4\u65f6\uff0c\u4e8b\u52a1\u4f1a\u88ab\u653e\u5f03\uff0c\u4e8b\u52a1\u961f\u5217\u4f1a\u88ab\u6e05\u7a7a\uff0c\u5e76\u4e14\u5ba2\u6237\u7aef\u4f1a\u4ece\u4e8b\u52a1\u72b6\u6001\u4e2d\u9000\u51fa\uff1a 127.0.0.1:6379> get key \"1\" 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> set key 10 QUEUED 127.0.0.1:6379> DISCARD OK 127.0.0.1:6379> exec (error) ERR EXEC without MULTI 127.0.0.1:6379> get key \"1\"","title":"2.2 \u653e\u5f03\u4e8b\u52a1"},{"location":"python/lib/nosql/redis/redis.transaction/#23","text":"127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> set key 1 QUEUED 127.0.0.1:6379> HSET key2 1 (error) ERR wrong number of arguments for 'hset' command 127.0.0.1:6379> SADD key3 1 QUEUED 127.0.0.1:6379> exec (error) EXECABORT Transaction discarded because of previous errors. 127.0.0.1:6379> keys * (empty list or set) \u5bf9\u4e8e\u5165\u961f\u9519\u8bef\uff0credis 2.6.5\u7248\u672c\u540e\uff0c\u4f1a\u8bb0\u5f55\u8fd9\u79cd\u9519\u8bef\uff0c\u5e76\u4e14\u5728\u6267\u884cEXEC\u7684\u65f6\u5019\uff0c\u62a5\u9519\u5e76\u56de\u6eda\u4e8b\u52a1\u4e2d\u6240\u6709\u7684\u547d\u4ee4\uff0c\u5e76\u4e14\u7ec8\u6b62\u4e8b\u52a1","title":"2.3 \u5165\u961f\u9519\u8bef\u56de\u6eda"},{"location":"python/lib/nosql/redis/redis.transaction/#24","text":"127.0.0.1:6379> flushall OK 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> set k1 v1 QUEUED 127.0.0.1:6379> set k2 v2 v3 QUEUED 127.0.0.1:6379> exec 1) OK 2) (error) ERR syntax error 127.0.0.1:6379> keys * 1) \"k1\" 127.0.0.1:6379> get k1 \"v1\" \u5f53\u9047\u5230\u6267\u884c\u9519\u8bef\u65f6\uff0credis\u653e\u8fc7\u8fd9\u79cd\u9519\u8bef\uff0c\u4fdd\u8bc1\u4e8b\u52a1\u6267\u884c\u5b8c\u6210\u3002 \u4e0d\u540c\u4e4b\u5904 \u4e0emysql\u4e2d\u4e8b\u52a1\u4e0d\u540c\uff0c\u5728redis\u4e8b\u52a1\u9047\u5230\u6267\u884c\u9519\u8bef\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u8fdb\u884c\u56de\u6eda\uff0c\u800c\u662f\u7b80\u5355\u7684\u653e\u8fc7\u4e86\uff0c\u5e76\u4fdd\u8bc1\u5176\u4ed6\u7684\u547d\u4ee4\u6b63\u5e38\u6267\u884c\u3002\u8fd9\u4e2a\u533a\u522b\u5728\u5b9e\u73b0\u4e1a\u52a1\u7684\u65f6\u5019\uff0c\u9700\u8981\u81ea\u5df1\u4fdd\u8bc1\u903b\u8f91\u7b26\u5408\u9884\u671f\u3002","title":"2.4 \u6267\u884c\u9519\u8bef\u653e\u8fc7"},{"location":"python/lib/nosql/redis/redis.transaction/#25-watch","text":"WATCH \u547d\u4ee4\u53ef\u4ee5\u4e3a Redis \u4e8b\u52a1\u63d0\u4f9b check-and-set \uff08CAS\uff09\u884c\u4e3a\u3002 \u88ab WATCH \u7684\u952e\u4f1a\u88ab\u76d1\u89c6\uff0c\u5e76\u4f1a\u53d1\u89c9\u8fd9\u4e9b\u952e\u662f\u5426\u88ab\u6539\u52a8\u8fc7\u4e86\u3002 \u5982\u679c\u6709\u81f3\u5c11\u4e00\u4e2a\u88ab\u76d1\u89c6\u7684\u952e\u5728 EXEC \u6267\u884c\u4e4b\u524d\u88ab\u4fee\u6539\u4e86\uff0c \u90a3\u4e48\u6574\u4e2a\u4e8b\u52a1\u90fd\u4f1a\u88ab\u53d6\u6d88\uff0c EXEC \u8fd4\u56de\u7a7a\u591a\u6761\u6279\u91cf\u56de\u590d\uff08null multi-bulk reply\uff09\u6765\u8868\u793a\u4e8b\u52a1\u5df2\u7ecf\u5931\u8d25\u3002 127.0.0.1:6379> keys * (empty list or set) 127.0.0.1:6379> watch key1 OK 127.0.0.1:6379> set key1 3 OK 127.0.0.1:6379> MULTI OK 127.0.0.1:6379> set key1 3 QUEUED 127.0.0.1:6379> set key2 3 QUEUED 127.0.0.1:6379> exec (nil) 127.0.0.1:6379> keys * 1) \"key1\" \u4f7f\u7528\u4e0a\u9762\u7684\u4ee3\u7801\uff0c \u5982\u679c\u5728 WATCH \u6267\u884c\u4e4b\u540e\uff0c EXEC \u6267\u884c\u4e4b\u524d\uff0c \u6709\u5176\u4ed6\u5ba2\u6237\u7aef\u4fee\u6539\u4e86 key1 \u7684\u503c\uff0c \u90a3\u4e48\u5f53\u524d\u5ba2\u6237\u7aef\u7684\u4e8b\u52a1\u5c31\u4f1a\u5931\u8d25\u3002 \u7a0b\u5e8f\u9700\u8981\u505a\u7684\uff0c \u5c31\u662f\u4e0d\u65ad\u91cd\u8bd5\u8fd9\u4e2a\u64cd\u4f5c\uff0c \u76f4\u5230\u6ca1\u6709\u53d1\u751f\u78b0\u649e\u4e3a\u6b62\u3002 \u8fd9\u79cd\u5f62\u5f0f\u7684\u9501\u88ab\u79f0\u4f5c\u4e50\u89c2\u9501\uff0c \u5b83\u662f\u4e00\u79cd\u975e\u5e38\u5f3a\u5927\u7684\u9501\u673a\u5236\u3002 \u5e76\u4e14\u56e0\u4e3a\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c \u4e0d\u540c\u7684\u5ba2\u6237\u7aef\u4f1a\u8bbf\u95ee\u4e0d\u540c\u7684\u952e\uff0c \u78b0\u649e\u7684\u60c5\u51b5\u4e00\u822c\u90fd\u5f88\u5c11\uff0c \u6240\u4ee5\u901a\u5e38\u5e76\u4e0d\u9700\u8981\u8fdb\u884c\u91cd\u8bd5\u3002","title":"2.5 watch"},{"location":"python/lib/nosql/redis/redis.transaction/#3-demo","text":"\u8fd9\u91cc\u5c55\u793a\u4e00\u4e2a\u7528python\u5b9e\u73b0\u5bf9key\u8ba1\u6570\u51cf\u4e00\u7684\u539f\u5b50\u64cd\u4f5c\u3002 #!/usr/bin/python # _*_ coding: utf-8 _*_ \"\"\" @Time : 2019/2/21 13:25 @File : pipeline_demo.py @Author : summer @Software: PyCharm \"\"\" import redis from redis import WatchError from concurrent.futures import ProcessPoolExecutor r = redis.Redis(host='127.0.0.1', port=6379) # \u51cf\u5e93\u5b58\u51fd\u6570, \u5faa\u73af\u76f4\u5230\u51cf\u5e93\u5b58\u5b8c\u6210 # \u5e93\u5b58\u5145\u8db3, \u51cf\u5e93\u5b58\u6210\u529f, \u8fd4\u56deTrue # \u5e93\u5b58\u4e0d\u8db3, \u51cf\u5e93\u5b58\u5931\u8d25, \u8fd4\u56deFalse def decr_stock(): # python\u4e2dredis\u4e8b\u52a1\u662f\u901a\u8fc7pipeline\u7684\u5c01\u88c5\u5b9e\u73b0\u7684 with r.pipeline() as pipe: while True: try: # watch\u5e93\u5b58\u952e, multi\u540e\u5982\u679c\u8be5key\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u6539\u53d8, \u4e8b\u52a1\u64cd\u4f5c\u4f1a\u629b\u51faWatchError\u5f02\u5e38 pipe.watch('stock:count') count = int(pipe.get('stock:count')) if count > 0: # \u6709\u5e93\u5b58 # \u4e8b\u52a1\u5f00\u59cb pipe.multi() pipe.decr('stock:count') # \u628a\u547d\u4ee4\u63a8\u9001\u8fc7\u53bb # execute\u8fd4\u56de\u547d\u4ee4\u6267\u884c\u7ed3\u679c\u5217\u8868, \u8fd9\u91cc\u53ea\u6709\u4e00\u4e2adecr\u8fd4\u56de\u5f53\u524d\u503c print(pipe.execute()[0]) return True else: return False except WatchError as ex: # \u6253\u5370WatchError\u5f02\u5e38, \u89c2\u5bdf\u88abwatch\u9501\u4f4f\u7684\u60c5\u51b5 print(ex, '\u9501\u4f4f\u4e86') pipe.unwatch() def worker(): while True: # \u6ca1\u6709\u5e93\u5b58\u5c31\u9000\u51fa if not decr_stock(): break # \u5b9e\u9a8c\u5f00\u59cb \u8bbe\u7f6e\u5e93\u5b58\u4e3a20 r.set(\"stock:count\", 20) # \u591a\u8fdb\u7a0b\u6a21\u62df\u591a\u4e2a\u5ba2\u6237\u7aef\u63d0\u4ea4 if __name__ == '__main__': with ProcessPoolExecutor(max_workers=2) as pool: for _ in range(10): pool.submit(worker)","title":"3. demo"},{"location":"python/lib/numPy/1.index/","text":"\u5b66\u4e60\u94fe\u63a5","title":"1. \u4ecb\u7ecd"},{"location":"python/lib/os/os.index/","text":"OS \u6a21\u5757 1. \u4ecb\u7ecd \u00b6 \u5728\u81ea\u52a8\u5316\u6d4b\u8bd5\u4e2d\uff0c\u7ecf\u5e38\u9700\u8981\u67e5\u627e\u64cd\u4f5c\u6587\u4ef6\uff0c\u6bd4\u5982\u8bf4\u67e5\u627e\u914d\u7f6e\u6587\u4ef6\uff08\u4ece\u800c\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\u7684\u4fe1\u606f\uff09\uff0c\u67e5\u627e\u6d4b\u8bd5\u62a5\u544a\uff08\u4ece\u800c\u53d1\u9001\u6d4b\u8bd5\u62a5\u544a\u90ae\u4ef6\uff09\uff0c\u7ecf\u5e38\u8981\u5bf9\u5927\u91cf\u6587\u4ef6\u548c\u5927\u91cf\u8def\u5f84\u8fdb\u884c\u64cd\u4f5c\uff0c\u8fd9\u5c31\u4f9d\u8d56\u4e8eos\u6a21\u5757\uff0c\u6240\u4ee5\u4eca\u5929\u6574\u7406\u4e0b\u6bd4\u8f83\u5e38\u7528\u7684\u51e0\u4e2a\u65b9\u6cd5\u3002\u7f51\u4e0a\u8fd9\u65b9\u9762\u8d44\u6599\u4e5f\u5f88\u591a\uff0c\u6bcf\u6b21\u6574\u7406\uff0c\u53ea\u662f\u5bf9\u81ea\u5df1\u6240\u5b66\u7684\u77e5\u8bc6\u8fdb\u884c\u68b3\u7406\uff0c\u4ece\u800c\u52a0\u6df1\u5bf9\u67d0\u4e2a\u6a21\u5757\u7684\u4f7f\u7528\u3002 os.remove(\u2018path/filename\u2019) \u5220\u9664\u6587\u4ef6 os.rename(oldname, newname) \u91cd\u547d\u540d\u6587\u4ef6 os.walk() \u751f\u6210\u76ee\u5f55\u6811\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u540d os.chdir('dirname') \u6539\u53d8\u76ee\u5f55 os.mkdir/makedirs('dirname')\u521b\u5efa\u76ee\u5f55/\u591a\u5c42\u76ee\u5f55 os.rmdir/removedirs('dirname') \u5220\u9664\u76ee\u5f55/\u591a\u5c42\u76ee\u5f55 os.listdir('dirname') \u5217\u51fa\u6307\u5b9a\u76ee\u5f55\u7684\u6587\u4ef6 os.getcwd() \u53d6\u5f97\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55 os.chmod() \u6539\u53d8\u76ee\u5f55\u6743\u9650 os.path.basename(\u2018path/filename\u2019) \u53bb\u6389\u76ee\u5f55\u8def\u5f84\uff0c\u8fd4\u56de\u6587\u4ef6\u540d os.path.dirname(\u2018path/filename\u2019) \u53bb\u6389\u6587\u4ef6\u540d\uff0c\u8fd4\u56de\u76ee\u5f55\u8def\u5f84 os.path.join(path1[,path2[,...]]) \u5c06\u5206\u79bb\u7684\u5404\u90e8\u5206\u7ec4\u5408\u6210\u4e00\u4e2a\u8def\u5f84\u540d os.path.split('path') \u8fd4\u56de( dirname(), basename())\u5143\u7ec4 os.path.splitext() \u8fd4\u56de (filename, extension) \u5143\u7ec4 os.path.getatime\\ctime\\mtime \u5206\u522b\u8fd4\u56de\u6700\u8fd1\u8bbf\u95ee\u3001\u521b\u5efa\u3001\u4fee\u6539\u65f6\u95f4 os.path.getsize() \u8fd4\u56de\u6587\u4ef6\u5927\u5c0f os.path.exists() \u662f\u5426\u5b58\u5728 os.path.isabs() \u662f\u5426\u4e3a\u7edd\u5bf9\u8def\u5f84 os.path.isdir() \u662f\u5426\u4e3a\u76ee\u5f55 os.path.isfile() \u662f\u5426\u4e3a\u6587\u4ef6 2. \u5f53\u524d\u8def\u5f84 \u00b6 os.getcwd()\uff1a\u67e5\u770b\u5f53\u524d\u6240\u5728\u8def\u5f84\u3002 In [1]: import os In [2]: os.getcwd() Out[2]: '/root/book/books' In [3]: os.getcwdb() Out[3]: b'/root/book/books' 3. \u5217\u4e3e\u6587\u4ef6 \u00b6 os.listdir(path):\u5217\u4e3e\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u3002\u8fd4\u56de\u7684\u662f\u5217\u8868\u7c7b\u578b\u3002 In [4]: os.listdir() Out[4]: ['docs', 'README.md', 'site', '.2.21.mkdocs.yml.ok', '.git', 'mkdocs.yml'] 4. \u7edd\u5bf9\u8def\u5f84 \u00b6 os.path.abspath(path):\u8fd4\u56depath\u7684\u7edd\u5bf9\u8def\u5f84\u3002 In [14]: os.path.abspath('.') Out[14]: '/root/book/books' In [15]: os.path.abspath('..') Out[15]: '/root/book' In [16]: os.path.abspath('/usr/local/src') Out[16]: '/usr/local/src' 5. \u6587\u4ef6\u540d \u00b6 os.path.basename(path):\u8fd4\u56depath\u4e2d\u7684\u6587\u4ef6\u540d\u3002 In [18]: os.path.basename('/usr/local/src/name.txt') Out[18]: 'name.txt' In [19]: os.path.basename('.') Out[19]: '.' 6. \u6587\u4ef6\u7236\u8def\u5f84 \u00b6 os.path.dirname(path):\u8fd4\u56depath\u4e2d\u7684\u6587\u4ef6\u5939\u90e8\u5206\uff0c\u7ed3\u679c\u4e0d\u5305\u542b'\\' In [23]: os.path.dirname('.') Out[23]: '' In [24]: os.path.dirname('/usr/local/src/cmz.log') Out[24]: '/usr/local/src' 7. \u6587\u4ef6\u5927\u5c0f \u00b6 os.path.getsize(path):\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u5927\u5c0f\uff0c\u82e5\u662f\u6587\u4ef6\u5939\u8fd4\u56de0\u3002 In [39]: os.path.getsize('mkdocs.yml') Out[39]: 13843 root@leco:~/book/books# du -sh mkdocs.yml 16K mkdocs.yml 8. \u6587\u4ef6\u8def\u5f84\u5206\u5272 \u00b6 os.path.split(path):\u5c06\u8def\u5f84\u5206\u89e3\u4e3a(\u6587\u4ef6\u5939,\u6587\u4ef6\u540d)\uff0c\u8fd4\u56de\u7684\u662f\u5143\u7ec4\u7c7b\u578b\u3002\u53ef\u4ee5\u770b\u51fa\uff0c\u82e5\u8def\u5f84\u5b57\u7b26\u4e32\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u662f/,\u5219\u53ea\u6709\u6587\u4ef6\u5939\u90e8\u5206\u6709\u503c\uff1b\u82e5\u8def\u5f84\u5b57\u7b26\u4e32\u4e2d\u5747\u65e0/,\u5219\u53ea\u6709\u6587\u4ef6\u540d\u90e8\u5206\u6709\u503c\u3002\u82e5\u8def\u5f84\u5b57\u7b26\u4e32\u6709/\uff0c\u4e14\u4e0d\u5728\u6700\u540e\uff0c\u5219\u6587\u4ef6\u5939\u548c\u6587\u4ef6\u540d\u5747\u6709\u503c\u3002\u4e14\u8fd4\u56de\u7684\u6587\u4ef6\u5939\u7684\u7ed3\u679c\u4e0d\u5305\u542b/. In [25]: os.path.split('/usr/local/src/cmz.log') Out[25]: ('/usr/local/src', 'cmz.log') In [26]: os.path.split('/opt/cmz.log') Out[26]: ('/opt', 'cmz.log') In [27]: os.path.split('/usr/local/src/') Out[27]: ('/usr/local/src', '') In [28]: os.path.split('/usr/local/src') Out[28]: ('/usr/local', 'src') 9. \u6587\u4ef6\u8def\u5f84\u62fc\u63a5 \u00b6 os.path.join(path1,path2,...):\u5c06path\u8fdb\u884c\u7ec4\u5408\uff0c\u82e5\u5176\u4e2d\u6709\u7edd\u5bf9\u8def\u5f84\uff0c\u5219\u4e4b\u524d\u7684path\u5c06\u88ab\u5220\u9664\u3002 In [31]: os.path.join('/a','cmz.txt') Out[31]: '/a/cmz.txt' In [32]: os.path.join('/a','/b','cmz.txt') Out[32]: '/b/cmz.txt' In [33]: os.path.join('/a','/b','/c','cmz.txt') Out[33]: '/c/cmz.txt' In [34]: os.path.join('/usr/local/src','cmz.txt') Out[34]: '/usr/local/src/cmz.txt' In [35]: os.path.join('a','b','c','cmz.txt') Out[35]: 'a/b/c/cmz.txt' 10. \u67e5\u770b\u6587\u4ef6\u662f\u5426\u5b58\u5728 \u00b6 os.path.exists(path):\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u662f\u5426\u5b58\u5728\uff0c\u8fd4\u56deTrue \u6216 False\u3002 In [2]: os.path.exists('mkdocs.yml') Out[2]: True In [3]: os.path.exists('mkdocs2222.yml') Out[3]: False 11. \u67e5\u770b\u65f6\u95f4 \u00b6 os.path.getmtime(path):\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\uff0c\u4ece\u65b0\u7eaa\u5143\u5230\u8bbf\u95ee\u65f6\u7684\u79d2\u6570\u3002 os.path.getatime(path):\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u6700\u540e\u8bbf\u95ee\u65f6\u95f4\uff0c\u4ece\u65b0\u7eaa\u5143\u5230\u8bbf\u95ee\u65f6\u7684\u79d2\u6570\u3002 os.path.getctime(path):\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u521b\u5efa\u65f6\u95f4\uff0c\u4ece\u65b0\u7eaa\u5143\u5230\u8bbf\u95ee\u65f6\u7684\u79d2\u6570\u3002 In [5]: ls docs/ mkdocs.yml README.md site/ In [6]: os.path.getmtime('mkdocs.yml') Out[6]: 1551450797.9045475 In [7]: os.path.getatime('mkdocs.yml') Out[7]: 1551450803.2045667 In [8]: os.path.getctime('mkdocs.yml') Out[8]: 1551450797.9045475 12. \u521b\u5efa\u786c\u94fe\u63a5 \u00b6 \u521b\u5efa\u786c\u94fe\u63a5\uff0c\u540d\u4e3a\u53c2\u6570 dst\uff0c\u6307\u5411\u53c2\u6570 src In [18]: pwd Out[18]: '/tmp/cmz' In [19]: ls hosts In [20]: os.link('hosts','mylink_hosts') In [21]: ls hosts mylink_hosts In [22]: ll \u603b\u7528\u91cf 8 -rw-r--r-- 2 root 369 3\u6708 2 22:48 hosts -rw-r--r-- 2 root 369 3\u6708 2 22:48 mylink_hosts 13. \u521b\u5efa\u8f6f\u94fe\u63a5 \u00b6 In [21]: ls myhosts mylink_hosts new_cmz/ In [22]: os.symlink('myhosts','mysoftlink_hosts') In [23]: ll \u603b\u7528\u91cf 12 -rw-r--r-- 2 root 369 3\u6708 2 22:48 myhosts -rw-r--r-- 2 root 369 3\u6708 2 22:48 mylink_hosts lrwxrwxrwx 1 root 7 3\u6708 2 23:02 mysoftlink_hosts -> myhosts drwxr-xr-x 3 root 4096 3\u6708 2 22:50 new_cmz/ 14. \u91cd\u547d\u540d\u6587\u4ef6\u6216\u8005\u76ee\u5f55 \u00b6 os.rename(src, dst)\uff0c\u91cd\u547d\u540d\u6587\u4ef6\u6216\u76ee\u5f55\uff0c\u4ece src \u5230 dst In [10]: ls cmz1/ hosts mylink_hosts In [11]: os.rename('hosts','myhosts') In [12]: ls cmz1/ myhosts mylink_hosts In [13]: os.rename('cmz1','new_cmz') In [14]: ls myhosts mylink_hosts new_cmz/ 15. \u6539\u53d8\u8def\u5f84 \u00b6 \u6539\u53d8\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55 In [24]: pwd Out[24]: '/tmp/cmz' In [25]: ls myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ In [26]: os.chdir('new_cmz') In [27]: pwd Out[27]: '/tmp/cmz/new_cmz' In [28]: ls cmz2/ 16. cpu\u4e2a\u6570 \u00b6 In [36]: os.cpu_count() Out[36]: 4 17. \u516c\u5171\u90e8\u5206 \u00b6 \u4ee5\"/\"\u5206\u5272\uff0c\u5c06\u8def\u5f84\u5206\u6210\u51e0\u90e8\u5206\uff0c\u627e\u5230\u516c\u5171\u7684\u8fd9\u4e00\u4e2a\u90e8\u5206\u3002 In [41]: name = ['/a/b/cmz1.txt','/a/b/cmz2.txt','/a/b/cmz3.txt'] In [42]: os.path.commonpath(name) Out[42]: '/a/b' In [43]: name = ['/a/cmz1.txt','/b/cmz2.txt','/c/cmz3.txt'] In [44]: os.path.commonpath(name) Out[44]: '/' In [45]: name = ['/a/b/c/cmz1.txt','/a/b/d/cmz2.txt','/a/b/m/cmz3.txt'] In [46]: os.path.commonpath(name) Out[46]: '/a/b' 18. \u5224\u65ad\u662f\u5426\u662f\u6587\u4ef6 \u00b6 In [52]: os.path.isfile('myhosts') Out[52]: True In [53]: os.path.isfile('new_cmz') Out[53]: False 19. \u5224\u65ad\u662f\u5426\u662f\u6587\u4ef6\u5939 \u00b6 \u8fd4\u56detrue\u6216\u8005false In [48]: ls myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ In [49]: os.path.isdir('myhosts') Out[49]: False In [50]: os.path.isdir('new_cmz') Out[50]: True 20. \u5224\u65ad\u662f\u5426\u662f\u6587\u4ef6\u5939 \u00b6 \u5224\u65ad\u662f\u5426 \u662f\u8f6f\u8fde\u63a5 In [54]: ls myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ In [55]: os.path.islink('myhosts') Out[55]: False In [56]: os.path.islink('mylink_hosts') Out[56]: False In [57]: os.path.islink('mysoftlink_hosts') Out[57]: True 21. \u751f\u6210\u5355\u7ea7\u76ee\u5f55 \u00b6 In [92]: ls a/ myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ In [93]: os.mkdir('test1') In [94]: ls a/ myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ test1/ 22. \u751f\u6210\u591a\u7ea7\u76ee\u5f55 \u00b6 \u7c7b\u4f3cmkdir -p a/b/c In [76]: os.makedirs('a/b/c') In [77]: ls a/ myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ In [78]: ls a/b/c In [79]: ls a/b c/ 23. \u5220\u5355\u7ea7\u7a7a\u76ee\u5f55 \u00b6 \u5220\u9664\u5355\u7ea7\u7a7a\u76ee\u5f55\uff0c\u82e5\u76ee\u5f55\u4e0d\u4e3a\u7a7a\u5219\u65e0\u6cd5\u5220\u9664\uff0c\u62a5\u9519 In [102]: os.mkdir('test') In [103]: ls a/ myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ test/ In [105]: ls a b/ In [106]: os.rmdir('a') --------------------------------------------------------------------------- OSError Traceback (most recent call last) <ipython-input-106-00cb998d57ad> in <module>() ----> 1 os.rmdir('a') OSError: [Errno 39] Directory not empty: 'a' In [107]: os.rmdir('test') In [108]: ls a/ myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ 24. \u5220\u5355\u6587\u4ef6 \u00b6 \u5220\u9664\u4e00\u4e2a\u6587\u4ef6\u3002\u5220\u9664\u975e\u6587\u4ef6\u5c31\u62a5\u9519 In [111]: ls a/ myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ In [112]: os.remove('myhosts','mysoftlink_hosts') --------------------------------------------------------------------------- TypeError Traceback (most recent call last) <ipython-input-112-985bdc8d4d7f> in <module>() ----> 1 os.remove('myhosts','mysoftlink_hosts') TypeError: Function takes at most 1 positional arguments (2 given) In [113]: os.remove('mysoftlink_hosts') In [114]: ls a/ myhosts mylink_hosts new_cmz/ 25. \u5206\u79bb\u6587\u4ef6\u540d\u548c\u6269\u5c55\u540d \u00b6 In [123]: os.path.splitext('cmz.log') Out[123]: ('cmz', '.log') In [124]: os.path.splitext('/usr/local/src/cmz.log') Out[124]: ('/usr/local/src/cmz', '.log') 26. \u64cd\u4f5c\u7cfb\u7edf\u7279\u5b9a\u8def\u5f84\u5206\u9694\u7b26 \u00b6 win\u4e0b\u4e3a\"\\\",Linux\u4e0b\u4e3a\"/\" In [115]: os.sep Out[115]: '/' 27. \u64cd\u4f5c\u7cfb\u7edf\u7ec8\u6b62\u7b26 \u00b6 \u8f93\u51fa\u5f53\u524d\u5e73\u53f0\u4f7f\u7528\u7684\u884c\u7ec8\u6b62\u7b26\uff0cwin\u4e0b\u4e3a\"\\t\\n\",Linux\u4e0b\u4e3a\"\\n\" In [116]: os.linesep Out[116]: '\\n' 28. \u5206\u5272\u8def\u5f84\u7684\u7b26 \u00b6 win\u4e0b\u4e3a; , Linux\u4e0b\u4e3a: In [117]: os.pathsep Out[117]: ':' 29. \u7cfb\u7edf\u73af\u5883\u53d8\u91cf \u00b6 In [120]: os.environ Out[120]: environ({'SHELL': '/bin/bash', 'TERM': 'xterm', 'JRE_HOME': '/usr/lib/jvm/jdk1.8.0_40/jre', 'USER':'root', 'LS_COLORS': 'rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:','SUDO_USER': 'leco', 'SUDO_UID': '1000', 'USERNAME': 'root', 'MAIL': '/var/mail/root', 'PATH': '/usr/lib/jvm/jdk1.8.0_40/bin:/root/anaconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games', 'PWD': '/root', 'JAVA_HOME': '/usr/lib/jvm/jdk1.8.0_40', 'LANG': 'zh_CN.UTF-8', 'SHLVL': '1','SUDO_COMMAND': '/bin/su', 'HOME': '/root', 'LANGUAGE': 'zh_CN:zh', 'LOGNAME': 'root', 'CLASSPATH': '.:/usr/lib/jvm/jdk1.8.0_40/lib:/usr/lib/jvm/jdk1.8.0_40/jre/lib', 'LESSOPEN': '| /usr/bin/lesspipe %s', 'SUDO_GID': '1000', 'DISPLAY': 'localhost:10.0', 'LESSCLOSE': '/usr/bin/lesspipe %s %s', '_': '/usr/local/bin/ipython', 'OLDPWD': '/root/book/books'}) 30. \u8fd0\u884cshell \u00b6 \u8fd0\u884cshell\u547d\u4ee4\uff0c\u76f4\u63a5\u663e\u793a In [121]: os.system('ls') a myhosts mylink_hosts new_cmz Out[121]: 0 In [122]: os.system('uptime') 23:37:50 up 3 days, 14:28, 3 users, load average: 0.15, 0.19, 0.17 Out[122]: 0 31. \u6587\u4ef6\u56db\u5927\u6743\u9650 \u00b6 os.F_OK \u4f5c\u4e3aaccess()\u7684mode\u53c2\u6570\uff0c\u6d4b\u8bd5path\u662f\u5426\u5b58\u5728. os.R_OK \u5305\u542b\u5728access()\u7684mode\u53c2\u6570\u4e2d \uff0c \u6d4b\u8bd5path\u662f\u5426\u53ef\u8bfb. os.W_OK \u5305\u542b\u5728access()\u7684mode\u53c2\u6570\u4e2d \uff0c\u6d4b\u8bd5path\u662f\u5426\u53ef\u5199. os.X_OK \u5305\u542b\u5728access()\u7684mode\u53c2\u6570\u4e2d \uff0c\u6d4b\u8bd5path\u662f\u5426\u53ef\u6267\u884c. In [130]: ls a/ myhosts mylink_hosts new_cmz/ In [131]: os.access('myhosts',os.F_OK) Out[131]: True In [132]: os.access('myhosts',os.R_OK) Out[132]: True In [133]: os.access('myhosts',os.W_OK) Out[133]: True In [134]: os.access('myhosts',os.X_OK) Out[134]: False","title":"14. os"},{"location":"python/lib/os/os.index/#1","text":"\u5728\u81ea\u52a8\u5316\u6d4b\u8bd5\u4e2d\uff0c\u7ecf\u5e38\u9700\u8981\u67e5\u627e\u64cd\u4f5c\u6587\u4ef6\uff0c\u6bd4\u5982\u8bf4\u67e5\u627e\u914d\u7f6e\u6587\u4ef6\uff08\u4ece\u800c\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\u7684\u4fe1\u606f\uff09\uff0c\u67e5\u627e\u6d4b\u8bd5\u62a5\u544a\uff08\u4ece\u800c\u53d1\u9001\u6d4b\u8bd5\u62a5\u544a\u90ae\u4ef6\uff09\uff0c\u7ecf\u5e38\u8981\u5bf9\u5927\u91cf\u6587\u4ef6\u548c\u5927\u91cf\u8def\u5f84\u8fdb\u884c\u64cd\u4f5c\uff0c\u8fd9\u5c31\u4f9d\u8d56\u4e8eos\u6a21\u5757\uff0c\u6240\u4ee5\u4eca\u5929\u6574\u7406\u4e0b\u6bd4\u8f83\u5e38\u7528\u7684\u51e0\u4e2a\u65b9\u6cd5\u3002\u7f51\u4e0a\u8fd9\u65b9\u9762\u8d44\u6599\u4e5f\u5f88\u591a\uff0c\u6bcf\u6b21\u6574\u7406\uff0c\u53ea\u662f\u5bf9\u81ea\u5df1\u6240\u5b66\u7684\u77e5\u8bc6\u8fdb\u884c\u68b3\u7406\uff0c\u4ece\u800c\u52a0\u6df1\u5bf9\u67d0\u4e2a\u6a21\u5757\u7684\u4f7f\u7528\u3002 os.remove(\u2018path/filename\u2019) \u5220\u9664\u6587\u4ef6 os.rename(oldname, newname) \u91cd\u547d\u540d\u6587\u4ef6 os.walk() \u751f\u6210\u76ee\u5f55\u6811\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u540d os.chdir('dirname') \u6539\u53d8\u76ee\u5f55 os.mkdir/makedirs('dirname')\u521b\u5efa\u76ee\u5f55/\u591a\u5c42\u76ee\u5f55 os.rmdir/removedirs('dirname') \u5220\u9664\u76ee\u5f55/\u591a\u5c42\u76ee\u5f55 os.listdir('dirname') \u5217\u51fa\u6307\u5b9a\u76ee\u5f55\u7684\u6587\u4ef6 os.getcwd() \u53d6\u5f97\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55 os.chmod() \u6539\u53d8\u76ee\u5f55\u6743\u9650 os.path.basename(\u2018path/filename\u2019) \u53bb\u6389\u76ee\u5f55\u8def\u5f84\uff0c\u8fd4\u56de\u6587\u4ef6\u540d os.path.dirname(\u2018path/filename\u2019) \u53bb\u6389\u6587\u4ef6\u540d\uff0c\u8fd4\u56de\u76ee\u5f55\u8def\u5f84 os.path.join(path1[,path2[,...]]) \u5c06\u5206\u79bb\u7684\u5404\u90e8\u5206\u7ec4\u5408\u6210\u4e00\u4e2a\u8def\u5f84\u540d os.path.split('path') \u8fd4\u56de( dirname(), basename())\u5143\u7ec4 os.path.splitext() \u8fd4\u56de (filename, extension) \u5143\u7ec4 os.path.getatime\\ctime\\mtime \u5206\u522b\u8fd4\u56de\u6700\u8fd1\u8bbf\u95ee\u3001\u521b\u5efa\u3001\u4fee\u6539\u65f6\u95f4 os.path.getsize() \u8fd4\u56de\u6587\u4ef6\u5927\u5c0f os.path.exists() \u662f\u5426\u5b58\u5728 os.path.isabs() \u662f\u5426\u4e3a\u7edd\u5bf9\u8def\u5f84 os.path.isdir() \u662f\u5426\u4e3a\u76ee\u5f55 os.path.isfile() \u662f\u5426\u4e3a\u6587\u4ef6","title":"1. \u4ecb\u7ecd"},{"location":"python/lib/os/os.index/#2","text":"os.getcwd()\uff1a\u67e5\u770b\u5f53\u524d\u6240\u5728\u8def\u5f84\u3002 In [1]: import os In [2]: os.getcwd() Out[2]: '/root/book/books' In [3]: os.getcwdb() Out[3]: b'/root/book/books'","title":"2. \u5f53\u524d\u8def\u5f84"},{"location":"python/lib/os/os.index/#3","text":"os.listdir(path):\u5217\u4e3e\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u3002\u8fd4\u56de\u7684\u662f\u5217\u8868\u7c7b\u578b\u3002 In [4]: os.listdir() Out[4]: ['docs', 'README.md', 'site', '.2.21.mkdocs.yml.ok', '.git', 'mkdocs.yml']","title":"3. \u5217\u4e3e\u6587\u4ef6"},{"location":"python/lib/os/os.index/#4","text":"os.path.abspath(path):\u8fd4\u56depath\u7684\u7edd\u5bf9\u8def\u5f84\u3002 In [14]: os.path.abspath('.') Out[14]: '/root/book/books' In [15]: os.path.abspath('..') Out[15]: '/root/book' In [16]: os.path.abspath('/usr/local/src') Out[16]: '/usr/local/src'","title":"4. \u7edd\u5bf9\u8def\u5f84"},{"location":"python/lib/os/os.index/#5","text":"os.path.basename(path):\u8fd4\u56depath\u4e2d\u7684\u6587\u4ef6\u540d\u3002 In [18]: os.path.basename('/usr/local/src/name.txt') Out[18]: 'name.txt' In [19]: os.path.basename('.') Out[19]: '.'","title":"5. \u6587\u4ef6\u540d"},{"location":"python/lib/os/os.index/#6","text":"os.path.dirname(path):\u8fd4\u56depath\u4e2d\u7684\u6587\u4ef6\u5939\u90e8\u5206\uff0c\u7ed3\u679c\u4e0d\u5305\u542b'\\' In [23]: os.path.dirname('.') Out[23]: '' In [24]: os.path.dirname('/usr/local/src/cmz.log') Out[24]: '/usr/local/src'","title":"6. \u6587\u4ef6\u7236\u8def\u5f84"},{"location":"python/lib/os/os.index/#7","text":"os.path.getsize(path):\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u5927\u5c0f\uff0c\u82e5\u662f\u6587\u4ef6\u5939\u8fd4\u56de0\u3002 In [39]: os.path.getsize('mkdocs.yml') Out[39]: 13843 root@leco:~/book/books# du -sh mkdocs.yml 16K mkdocs.yml","title":"7. \u6587\u4ef6\u5927\u5c0f"},{"location":"python/lib/os/os.index/#8","text":"os.path.split(path):\u5c06\u8def\u5f84\u5206\u89e3\u4e3a(\u6587\u4ef6\u5939,\u6587\u4ef6\u540d)\uff0c\u8fd4\u56de\u7684\u662f\u5143\u7ec4\u7c7b\u578b\u3002\u53ef\u4ee5\u770b\u51fa\uff0c\u82e5\u8def\u5f84\u5b57\u7b26\u4e32\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u662f/,\u5219\u53ea\u6709\u6587\u4ef6\u5939\u90e8\u5206\u6709\u503c\uff1b\u82e5\u8def\u5f84\u5b57\u7b26\u4e32\u4e2d\u5747\u65e0/,\u5219\u53ea\u6709\u6587\u4ef6\u540d\u90e8\u5206\u6709\u503c\u3002\u82e5\u8def\u5f84\u5b57\u7b26\u4e32\u6709/\uff0c\u4e14\u4e0d\u5728\u6700\u540e\uff0c\u5219\u6587\u4ef6\u5939\u548c\u6587\u4ef6\u540d\u5747\u6709\u503c\u3002\u4e14\u8fd4\u56de\u7684\u6587\u4ef6\u5939\u7684\u7ed3\u679c\u4e0d\u5305\u542b/. In [25]: os.path.split('/usr/local/src/cmz.log') Out[25]: ('/usr/local/src', 'cmz.log') In [26]: os.path.split('/opt/cmz.log') Out[26]: ('/opt', 'cmz.log') In [27]: os.path.split('/usr/local/src/') Out[27]: ('/usr/local/src', '') In [28]: os.path.split('/usr/local/src') Out[28]: ('/usr/local', 'src')","title":"8. \u6587\u4ef6\u8def\u5f84\u5206\u5272"},{"location":"python/lib/os/os.index/#9","text":"os.path.join(path1,path2,...):\u5c06path\u8fdb\u884c\u7ec4\u5408\uff0c\u82e5\u5176\u4e2d\u6709\u7edd\u5bf9\u8def\u5f84\uff0c\u5219\u4e4b\u524d\u7684path\u5c06\u88ab\u5220\u9664\u3002 In [31]: os.path.join('/a','cmz.txt') Out[31]: '/a/cmz.txt' In [32]: os.path.join('/a','/b','cmz.txt') Out[32]: '/b/cmz.txt' In [33]: os.path.join('/a','/b','/c','cmz.txt') Out[33]: '/c/cmz.txt' In [34]: os.path.join('/usr/local/src','cmz.txt') Out[34]: '/usr/local/src/cmz.txt' In [35]: os.path.join('a','b','c','cmz.txt') Out[35]: 'a/b/c/cmz.txt'","title":"9. \u6587\u4ef6\u8def\u5f84\u62fc\u63a5"},{"location":"python/lib/os/os.index/#10","text":"os.path.exists(path):\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u662f\u5426\u5b58\u5728\uff0c\u8fd4\u56deTrue \u6216 False\u3002 In [2]: os.path.exists('mkdocs.yml') Out[2]: True In [3]: os.path.exists('mkdocs2222.yml') Out[3]: False","title":"10. \u67e5\u770b\u6587\u4ef6\u662f\u5426\u5b58\u5728"},{"location":"python/lib/os/os.index/#11","text":"os.path.getmtime(path):\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\uff0c\u4ece\u65b0\u7eaa\u5143\u5230\u8bbf\u95ee\u65f6\u7684\u79d2\u6570\u3002 os.path.getatime(path):\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u6700\u540e\u8bbf\u95ee\u65f6\u95f4\uff0c\u4ece\u65b0\u7eaa\u5143\u5230\u8bbf\u95ee\u65f6\u7684\u79d2\u6570\u3002 os.path.getctime(path):\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u521b\u5efa\u65f6\u95f4\uff0c\u4ece\u65b0\u7eaa\u5143\u5230\u8bbf\u95ee\u65f6\u7684\u79d2\u6570\u3002 In [5]: ls docs/ mkdocs.yml README.md site/ In [6]: os.path.getmtime('mkdocs.yml') Out[6]: 1551450797.9045475 In [7]: os.path.getatime('mkdocs.yml') Out[7]: 1551450803.2045667 In [8]: os.path.getctime('mkdocs.yml') Out[8]: 1551450797.9045475","title":"11. \u67e5\u770b\u65f6\u95f4"},{"location":"python/lib/os/os.index/#12","text":"\u521b\u5efa\u786c\u94fe\u63a5\uff0c\u540d\u4e3a\u53c2\u6570 dst\uff0c\u6307\u5411\u53c2\u6570 src In [18]: pwd Out[18]: '/tmp/cmz' In [19]: ls hosts In [20]: os.link('hosts','mylink_hosts') In [21]: ls hosts mylink_hosts In [22]: ll \u603b\u7528\u91cf 8 -rw-r--r-- 2 root 369 3\u6708 2 22:48 hosts -rw-r--r-- 2 root 369 3\u6708 2 22:48 mylink_hosts","title":"12. \u521b\u5efa\u786c\u94fe\u63a5"},{"location":"python/lib/os/os.index/#13","text":"In [21]: ls myhosts mylink_hosts new_cmz/ In [22]: os.symlink('myhosts','mysoftlink_hosts') In [23]: ll \u603b\u7528\u91cf 12 -rw-r--r-- 2 root 369 3\u6708 2 22:48 myhosts -rw-r--r-- 2 root 369 3\u6708 2 22:48 mylink_hosts lrwxrwxrwx 1 root 7 3\u6708 2 23:02 mysoftlink_hosts -> myhosts drwxr-xr-x 3 root 4096 3\u6708 2 22:50 new_cmz/","title":"13. \u521b\u5efa\u8f6f\u94fe\u63a5"},{"location":"python/lib/os/os.index/#14","text":"os.rename(src, dst)\uff0c\u91cd\u547d\u540d\u6587\u4ef6\u6216\u76ee\u5f55\uff0c\u4ece src \u5230 dst In [10]: ls cmz1/ hosts mylink_hosts In [11]: os.rename('hosts','myhosts') In [12]: ls cmz1/ myhosts mylink_hosts In [13]: os.rename('cmz1','new_cmz') In [14]: ls myhosts mylink_hosts new_cmz/","title":"14. \u91cd\u547d\u540d\u6587\u4ef6\u6216\u8005\u76ee\u5f55"},{"location":"python/lib/os/os.index/#15","text":"\u6539\u53d8\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55 In [24]: pwd Out[24]: '/tmp/cmz' In [25]: ls myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ In [26]: os.chdir('new_cmz') In [27]: pwd Out[27]: '/tmp/cmz/new_cmz' In [28]: ls cmz2/","title":"15. \u6539\u53d8\u8def\u5f84"},{"location":"python/lib/os/os.index/#16-cpu","text":"In [36]: os.cpu_count() Out[36]: 4","title":"16. cpu\u4e2a\u6570"},{"location":"python/lib/os/os.index/#17","text":"\u4ee5\"/\"\u5206\u5272\uff0c\u5c06\u8def\u5f84\u5206\u6210\u51e0\u90e8\u5206\uff0c\u627e\u5230\u516c\u5171\u7684\u8fd9\u4e00\u4e2a\u90e8\u5206\u3002 In [41]: name = ['/a/b/cmz1.txt','/a/b/cmz2.txt','/a/b/cmz3.txt'] In [42]: os.path.commonpath(name) Out[42]: '/a/b' In [43]: name = ['/a/cmz1.txt','/b/cmz2.txt','/c/cmz3.txt'] In [44]: os.path.commonpath(name) Out[44]: '/' In [45]: name = ['/a/b/c/cmz1.txt','/a/b/d/cmz2.txt','/a/b/m/cmz3.txt'] In [46]: os.path.commonpath(name) Out[46]: '/a/b'","title":"17. \u516c\u5171\u90e8\u5206"},{"location":"python/lib/os/os.index/#18","text":"In [52]: os.path.isfile('myhosts') Out[52]: True In [53]: os.path.isfile('new_cmz') Out[53]: False","title":"18. \u5224\u65ad\u662f\u5426\u662f\u6587\u4ef6"},{"location":"python/lib/os/os.index/#19","text":"\u8fd4\u56detrue\u6216\u8005false In [48]: ls myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ In [49]: os.path.isdir('myhosts') Out[49]: False In [50]: os.path.isdir('new_cmz') Out[50]: True","title":"19. \u5224\u65ad\u662f\u5426\u662f\u6587\u4ef6\u5939"},{"location":"python/lib/os/os.index/#20","text":"\u5224\u65ad\u662f\u5426 \u662f\u8f6f\u8fde\u63a5 In [54]: ls myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ In [55]: os.path.islink('myhosts') Out[55]: False In [56]: os.path.islink('mylink_hosts') Out[56]: False In [57]: os.path.islink('mysoftlink_hosts') Out[57]: True","title":"20. \u5224\u65ad\u662f\u5426\u662f\u6587\u4ef6\u5939"},{"location":"python/lib/os/os.index/#21","text":"In [92]: ls a/ myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ In [93]: os.mkdir('test1') In [94]: ls a/ myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ test1/","title":"21. \u751f\u6210\u5355\u7ea7\u76ee\u5f55"},{"location":"python/lib/os/os.index/#22","text":"\u7c7b\u4f3cmkdir -p a/b/c In [76]: os.makedirs('a/b/c') In [77]: ls a/ myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ In [78]: ls a/b/c In [79]: ls a/b c/","title":"22. \u751f\u6210\u591a\u7ea7\u76ee\u5f55"},{"location":"python/lib/os/os.index/#23","text":"\u5220\u9664\u5355\u7ea7\u7a7a\u76ee\u5f55\uff0c\u82e5\u76ee\u5f55\u4e0d\u4e3a\u7a7a\u5219\u65e0\u6cd5\u5220\u9664\uff0c\u62a5\u9519 In [102]: os.mkdir('test') In [103]: ls a/ myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ test/ In [105]: ls a b/ In [106]: os.rmdir('a') --------------------------------------------------------------------------- OSError Traceback (most recent call last) <ipython-input-106-00cb998d57ad> in <module>() ----> 1 os.rmdir('a') OSError: [Errno 39] Directory not empty: 'a' In [107]: os.rmdir('test') In [108]: ls a/ myhosts mylink_hosts mysoftlink_hosts@ new_cmz/","title":"23. \u5220\u5355\u7ea7\u7a7a\u76ee\u5f55"},{"location":"python/lib/os/os.index/#24","text":"\u5220\u9664\u4e00\u4e2a\u6587\u4ef6\u3002\u5220\u9664\u975e\u6587\u4ef6\u5c31\u62a5\u9519 In [111]: ls a/ myhosts mylink_hosts mysoftlink_hosts@ new_cmz/ In [112]: os.remove('myhosts','mysoftlink_hosts') --------------------------------------------------------------------------- TypeError Traceback (most recent call last) <ipython-input-112-985bdc8d4d7f> in <module>() ----> 1 os.remove('myhosts','mysoftlink_hosts') TypeError: Function takes at most 1 positional arguments (2 given) In [113]: os.remove('mysoftlink_hosts') In [114]: ls a/ myhosts mylink_hosts new_cmz/","title":"24. \u5220\u5355\u6587\u4ef6"},{"location":"python/lib/os/os.index/#25","text":"In [123]: os.path.splitext('cmz.log') Out[123]: ('cmz', '.log') In [124]: os.path.splitext('/usr/local/src/cmz.log') Out[124]: ('/usr/local/src/cmz', '.log')","title":"25. \u5206\u79bb\u6587\u4ef6\u540d\u548c\u6269\u5c55\u540d"},{"location":"python/lib/os/os.index/#26","text":"win\u4e0b\u4e3a\"\\\",Linux\u4e0b\u4e3a\"/\" In [115]: os.sep Out[115]: '/'","title":"26. \u64cd\u4f5c\u7cfb\u7edf\u7279\u5b9a\u8def\u5f84\u5206\u9694\u7b26"},{"location":"python/lib/os/os.index/#27","text":"\u8f93\u51fa\u5f53\u524d\u5e73\u53f0\u4f7f\u7528\u7684\u884c\u7ec8\u6b62\u7b26\uff0cwin\u4e0b\u4e3a\"\\t\\n\",Linux\u4e0b\u4e3a\"\\n\" In [116]: os.linesep Out[116]: '\\n'","title":"27. \u64cd\u4f5c\u7cfb\u7edf\u7ec8\u6b62\u7b26"},{"location":"python/lib/os/os.index/#28","text":"win\u4e0b\u4e3a; , Linux\u4e0b\u4e3a: In [117]: os.pathsep Out[117]: ':'","title":"28. \u5206\u5272\u8def\u5f84\u7684\u7b26"},{"location":"python/lib/os/os.index/#29","text":"In [120]: os.environ Out[120]: environ({'SHELL': '/bin/bash', 'TERM': 'xterm', 'JRE_HOME': '/usr/lib/jvm/jdk1.8.0_40/jre', 'USER':'root', 'LS_COLORS': 'rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:','SUDO_USER': 'leco', 'SUDO_UID': '1000', 'USERNAME': 'root', 'MAIL': '/var/mail/root', 'PATH': '/usr/lib/jvm/jdk1.8.0_40/bin:/root/anaconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games', 'PWD': '/root', 'JAVA_HOME': '/usr/lib/jvm/jdk1.8.0_40', 'LANG': 'zh_CN.UTF-8', 'SHLVL': '1','SUDO_COMMAND': '/bin/su', 'HOME': '/root', 'LANGUAGE': 'zh_CN:zh', 'LOGNAME': 'root', 'CLASSPATH': '.:/usr/lib/jvm/jdk1.8.0_40/lib:/usr/lib/jvm/jdk1.8.0_40/jre/lib', 'LESSOPEN': '| /usr/bin/lesspipe %s', 'SUDO_GID': '1000', 'DISPLAY': 'localhost:10.0', 'LESSCLOSE': '/usr/bin/lesspipe %s %s', '_': '/usr/local/bin/ipython', 'OLDPWD': '/root/book/books'})","title":"29. \u7cfb\u7edf\u73af\u5883\u53d8\u91cf"},{"location":"python/lib/os/os.index/#30-shell","text":"\u8fd0\u884cshell\u547d\u4ee4\uff0c\u76f4\u63a5\u663e\u793a In [121]: os.system('ls') a myhosts mylink_hosts new_cmz Out[121]: 0 In [122]: os.system('uptime') 23:37:50 up 3 days, 14:28, 3 users, load average: 0.15, 0.19, 0.17 Out[122]: 0","title":"30. \u8fd0\u884cshell"},{"location":"python/lib/os/os.index/#31","text":"os.F_OK \u4f5c\u4e3aaccess()\u7684mode\u53c2\u6570\uff0c\u6d4b\u8bd5path\u662f\u5426\u5b58\u5728. os.R_OK \u5305\u542b\u5728access()\u7684mode\u53c2\u6570\u4e2d \uff0c \u6d4b\u8bd5path\u662f\u5426\u53ef\u8bfb. os.W_OK \u5305\u542b\u5728access()\u7684mode\u53c2\u6570\u4e2d \uff0c\u6d4b\u8bd5path\u662f\u5426\u53ef\u5199. os.X_OK \u5305\u542b\u5728access()\u7684mode\u53c2\u6570\u4e2d \uff0c\u6d4b\u8bd5path\u662f\u5426\u53ef\u6267\u884c. In [130]: ls a/ myhosts mylink_hosts new_cmz/ In [131]: os.access('myhosts',os.F_OK) Out[131]: True In [132]: os.access('myhosts',os.R_OK) Out[132]: True In [133]: os.access('myhosts',os.W_OK) Out[133]: True In [134]: os.access('myhosts',os.X_OK) Out[134]: False","title":"31. \u6587\u4ef6\u56db\u5927\u6743\u9650"},{"location":"python/lib/pandas/1.index/","text":"1. \u4ecb\u7ecd \u00b6 pandas \u662f\u57fa\u4e8eNumPy \u7684\u4e00\u79cd\u5de5\u5177\uff0c\u8be5\u5de5\u5177\u662f\u4e3a\u4e86\u89e3\u51b3\u6570\u636e\u5206\u6790\u4efb\u52a1\u800c\u521b\u5efa\u7684\u3002Pandas \u7eb3\u5165\u4e86\u5927\u91cf\u5e93\u548c\u4e00\u4e9b\u6807\u51c6\u7684\u6570\u636e\u6a21\u578b\uff0c\u63d0\u4f9b\u4e86\u9ad8\u6548\u5730\u64cd\u4f5c\u5927\u578b\u6570\u636e\u96c6\u6240\u9700\u7684\u5de5\u5177\u3002pandas\u63d0\u4f9b\u4e86\u5927\u91cf\u80fd\u4f7f\u6211\u4eec\u5feb\u901f\u4fbf\u6377\u5730\u5904\u7406\u6570\u636e\u7684\u51fd\u6570\u548c\u65b9\u6cd5\u3002\u4f60\u5f88\u5feb\u5c31\u4f1a\u53d1\u73b0\uff0c\u5b83\u662f\u4f7fPython\u6210\u4e3a\u5f3a\u5927\u800c\u9ad8\u6548\u7684\u6570\u636e\u5206\u6790\u73af\u5883\u7684\u91cd\u8981\u56e0\u7d20\u4e4b\u4e00\u3002 1.1 python \u652f\u6301\u7248\u672c \u00b6 Python\u7248\u672c\u652f\u6301\u5b98\u65b9 Python 2 Python 3 \u90fd\u652f\u6301 1.2 \u5b89\u88c5 \u00b6 pip install pandas \u6839\u636epip\u7684\u7248\u672c\u6765\u5b89\u88c5 root@leco:~# pip -V pip 9.0.1 from /usr/local/lib/python3.6/site-packages (python 3.6) \u7531\u6b64\u53ef\u89c1\u672c\u5730\u73af\u5883\u662fPython3 1.3 \u5904\u7406\u6570\u636e\u7c7b\u578b \u00b6 Pandas\u5904\u7406\u4ee5\u4e0b\u4e09\u4e2a\u6570\u636e\u7ed3\u6784 \u7cfb\u5217(Series) \u6570\u636e\u5e27(DataFrame) \u9762\u677f(Panel) \u8fd9\u4e9b\u6570\u636e\u7ed3\u6784\u6784\u5efa\u5728Numpy\u6570\u7ec4\u4e4b\u4e0a\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u4eec\u5f88\u5feb\u3002","title":"1. \u4ecb\u7ecd"},{"location":"python/lib/pandas/1.index/#1","text":"pandas \u662f\u57fa\u4e8eNumPy \u7684\u4e00\u79cd\u5de5\u5177\uff0c\u8be5\u5de5\u5177\u662f\u4e3a\u4e86\u89e3\u51b3\u6570\u636e\u5206\u6790\u4efb\u52a1\u800c\u521b\u5efa\u7684\u3002Pandas \u7eb3\u5165\u4e86\u5927\u91cf\u5e93\u548c\u4e00\u4e9b\u6807\u51c6\u7684\u6570\u636e\u6a21\u578b\uff0c\u63d0\u4f9b\u4e86\u9ad8\u6548\u5730\u64cd\u4f5c\u5927\u578b\u6570\u636e\u96c6\u6240\u9700\u7684\u5de5\u5177\u3002pandas\u63d0\u4f9b\u4e86\u5927\u91cf\u80fd\u4f7f\u6211\u4eec\u5feb\u901f\u4fbf\u6377\u5730\u5904\u7406\u6570\u636e\u7684\u51fd\u6570\u548c\u65b9\u6cd5\u3002\u4f60\u5f88\u5feb\u5c31\u4f1a\u53d1\u73b0\uff0c\u5b83\u662f\u4f7fPython\u6210\u4e3a\u5f3a\u5927\u800c\u9ad8\u6548\u7684\u6570\u636e\u5206\u6790\u73af\u5883\u7684\u91cd\u8981\u56e0\u7d20\u4e4b\u4e00\u3002","title":"1. \u4ecb\u7ecd"},{"location":"python/lib/pandas/1.index/#11-python","text":"Python\u7248\u672c\u652f\u6301\u5b98\u65b9 Python 2 Python 3 \u90fd\u652f\u6301","title":"1.1 python \u652f\u6301\u7248\u672c"},{"location":"python/lib/pandas/1.index/#12","text":"pip install pandas \u6839\u636epip\u7684\u7248\u672c\u6765\u5b89\u88c5 root@leco:~# pip -V pip 9.0.1 from /usr/local/lib/python3.6/site-packages (python 3.6) \u7531\u6b64\u53ef\u89c1\u672c\u5730\u73af\u5883\u662fPython3","title":"1.2 \u5b89\u88c5"},{"location":"python/lib/pandas/1.index/#13","text":"Pandas\u5904\u7406\u4ee5\u4e0b\u4e09\u4e2a\u6570\u636e\u7ed3\u6784 \u7cfb\u5217(Series) \u6570\u636e\u5e27(DataFrame) \u9762\u677f(Panel) \u8fd9\u4e9b\u6570\u636e\u7ed3\u6784\u6784\u5efa\u5728Numpy\u6570\u7ec4\u4e4b\u4e0a\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u4eec\u5f88\u5feb\u3002","title":"1.3 \u5904\u7406\u6570\u636e\u7c7b\u578b"},{"location":"python/lib/psutil/psutil.index/","text":"psutil 1. \u4ecb\u7ecd \u00b6 psutil\u662f\u4e00\u4e2a\u8de8\u5e73\u53f0\u5e93\uff0c\u80fd\u591f\u8f7b\u677e\u5b9e\u73b0\u83b7\u53d6\u7cfb\u7edf\u8fd0\u884c\u7684\u8fdb\u7a0b\u548c\u7cfb\u7edf\u5229\u7528\u7387\uff08\u5305\u62ecCPU\u3001\u5185\u5b58\u3001\u78c1\u76d8\u3001\u7f51\u7edc\u7b49\uff09\u4fe1\u606f\u3002\u5b83\u4e3b\u8981\u5e94\u7528\u4e8e\u7cfb\u7edf\u76d1\u63a7\uff0c\u5206\u6790\u548c\u9650\u5236\u7cfb\u7edf\u8d44\u6e90\u53ca\u8fdb\u7a0b\u7684\u7ba1\u7406\u3002\u5b83\u5b9e\u73b0\u4e86\u540c\u7b49\u547d\u4ee4\u884c\u5de5\u5177\u63d0\u4f9b\u7684\u529f\u80fd\uff0c\u5982ps\u3001top\u3001lsof\u3001netstat\u3001ifconfig\u3001who\u3001df\u3001kill\u3001free\u3001nice\u3001ionice\u3001iostat\u3001iotop\u3001uptime\u3001pidof\u3001tty\u3001taskset\u3001pmap\u7b49\u3002\u76ee\u524d\u652f\u630132\u4f4d\u548c64\u4f4d\u7684Linux\u3001Windows\u3001OS X\u3001FreeBSD\u548cSun Solaris\u7b49\u64cd\u4f5c\u7cfb\u7edf\uff0c 1.1 \u5b89\u88c5 \u00b6 pip install psutil \u53c2\u8003\u6307\u5357 2. \u4f7f\u7528 \u00b6 2.1 cpu \u00b6 >>> import psutil >>> >>> psutil.cpu_times() # \u663e\u793acpu\u6240\u6709\u903b\u8f91\u4fe1\u606f scputimes(user=3961.46, nice=169.729, system=2150.659, idle=16900.540, iowait=629.59, irq=0.0, softirq=19.42, steal=0.0, guest=0, nice=0.0) >>> >>> for x in range(3): ... psutil.cpu_percent(interval=1) ... 4.0 5.9 3.8 >>> >>> for x in range(3): ... psutil.cpu_percent(interval=1, percpu=True) ... [4.0, 6.9, 3.7, 9.2] [7.0, 8.5, 2.4, 2.1] [1.2, 9.0, 9.9, 7.2] >>> >>> for x in range(3): ... psutil.cpu_times_percent(interval=1, percpu=False) ... scputimes(user=1.5, nice=0.0, system=0.5, idle=96.5, iowait=1.5, irq=0.0, softirq=0.0, steal=0.0, guest=0.0, guest_nice=0.0) scputimes(user=1.0, nice=0.0, system=0.0, idle=99.0, iowait=0.0, irq=0.0, softirq=0.0, steal=0.0, guest=0.0, guest_nice=0.0) scputimes(user=2.0, nice=0.0, system=0.0, idle=98.0, iowait=0.0, irq=0.0, softirq=0.0, steal=0.0, guest=0.0, guest_nice=0.0) >>> >>> psutil.cpu_count() # \u67e5\u770bcpu\u903b\u8f91\u4e2a\u6570 4 >>> psutil.cpu_count(logical=False) # \u67e5\u770bcpu\u7269\u7406\u4e2a\u6570 2 >>> >>> psutil.cpu_stats() scpustats(ctx_switches=20455687, interrupts=6598984, soft_interrupts=2134212, syscalls=0) >>> >>> psutil.cpu_freq() scpufreq(current=931.42925, min=800.0, max=3500.0) >>> >>> psutil.cpu_times().user # \u67e5\u770b\u7528\u6237\u7684cpu\u65f6\u95f4\u6bd4 11684.4 2.2 \u5185\u5b58 \u00b6 >>> psutil.virtual_memory() svmem(total=10367352832, available=6472179712, percent=37.6, used=8186245120, free=2181107712, active=4748992512, inactive=2758115328, buffers=790724608, cached=3500347392, shared=787554304) >>> psutil.swap_memory() sswap(total=2097147904, used=296128512, free=1801019392, percent=14.1, sin=304193536, sout=677842944) >>> 2.4 \u78c1\u76d8 \u00b6 >>> psutil.disk_partitions() [sdiskpart(device='/dev/sda1', mountpoint='/', fstype='ext4', opts='rw,nosuid'), sdiskpart(device='/dev/sda2', mountpoint='/home', fstype='ext, opts='rw')] >>> >>> psutil.disk_usage('/') sdiskusage(total=21378641920, used=4809781248, free=15482871808, percent=22.5) >>> >>> psutil.disk_io_counters(perdisk=False) sdiskio(read_count=719566, write_count=1082197, read_bytes=18626220032, write_bytes=24081764352, read_time=5023392, write_time=63199568, read_merged_count=619166, write_merged_count=812396, busy_time=4523412) >>> 2.5 \u7f51\u7edc \u00b6 >>> psutil.net_io_counters(pernic=True) {'eth0': netio(bytes_sent=485291293, bytes_recv=6004858642, packets_sent=3251564, packets_recv=4787798, errin=0, errout=0, dropin=0, dropout=0), 'lo': netio(bytes_sent=2838627, bytes_recv=2838627, packets_sent=30567, packets_recv=30567, errin=0, errout=0, dropin=0, dropout=0)} >>> >>> psutil.net_connections() [sconn(fd=115, family=<AddressFamily.AF_INET: 2>, type=<SocketType.SOCK_STREAM: 1>, laddr=addr(ip='10.0.0.1', port=48776), raddr=addr(ip='93.186.135.91', port=80), status='ESTABLISHED', pid=1254), sconn(fd=117, family=<AddressFamily.AF_INET: 2>, type=<SocketType.SOCK_STREAM: 1>, laddr=addr(ip='10.0.0.1', port=43761), raddr=addr(ip='72.14.234.100', port=80), status='CLOSING', pid=2987), ...] >>> >>> psutil.net_if_addrs() {'lo': [snicaddr(family=<AddressFamily.AF_INET: 2>, address='127.0.0.1', netmask='255.0.0.0', broadcast='127.0.0.1', ptp=None), snicaddr(family=<AddressFamily.AF_INET6: 10>, address='::1', netmask='ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff', broadcast=None, ptp=None), snicaddr(family=<AddressFamily.AF_LINK: 17>, address='00:00:00:00:00:00', netmask=None, broadcast='00:00:00:00:00:00', ptp=None)], 'wlan0': [snicaddr(family=<AddressFamily.AF_INET: 2>, address='192.168.1.3', netmask='255.255.255.0', broadcast='192.168.1.255', ptp=None), snicaddr(family=<AddressFamily.AF_INET6: 10>, address='fe80::c685:8ff:fe45:641%wlan0', netmask='ffff:ffff:ffff:ffff::', broadcast=None, ptp=None), snicaddr(family=<AddressFamily.AF_LINK: 17>, address='c4:85:08:45:06:41', netmask=None, broadcast='ff:ff:ff:ff:ff:ff', ptp=None)]} >>> >>> psutil.net_if_stats() {'lo': snicstats(isup=True, duplex=<NicDuplex.NIC_DUPLEX_UNKNOWN: 0>, speed=0, mtu=65536), 'wlan0': snicstats(isup=True, duplex=<NicDuplex.NIC_DUPLEX_FULL: 2>, speed=100, mtu=1500)} >>> 2.5 \u4f20\u611f\u5668 \u00b6 >>> import psutil >>> psutil.sensors_temperatures() {'acpitz': [shwtemp(label='', current=47.0, high=103.0, critical=103.0)], 'asus': [shwtemp(label='', current=47.0, high=None, critical=None)], 'coretemp': [shwtemp(label='Physical id 0', current=52.0, high=100.0, critical=100.0), shwtemp(label='Core 0', current=45.0, high=100.0, critical=100.0)]} >>> >>> psutil.sensors_fans() {'asus': [sfan(label='cpu_fan', current=3200)]} >>> >>> psutil.sensors_battery() sbattery(percent=93, secsleft=16628, power_plugged=False) >>> 2.6 \u5176\u4ed6 \u00b6 >>> import psutil >>> psutil.users() [suser(name='giampaolo', terminal='pts/2', host='localhost', started=1340737536.0, pid=1352), suser(name='giampaolo', terminal='pts/3', host='localhost', started=1340737792.0, pid=1788)] >>> >>> psutil.boot_time() 1365519115.0 >>> 2.7 pid \u00b6 >>> import psutil >>> psutil.pids() [1, 2, 3, 4, 5, 6, 7, 46, 48, 50, 51, 178, 182, 222, 223, 224, 268, 1215, 1216, 1220, 1221, 1243, 1244, 1301, 1601, 2237, 2355, 2637, 2774, 3932, 4176, 4177, 4185, 4187, 4189, 4225, 4243, 4245, 4263, 4282, 4306, 4311, 4312, 4313, 4314, 4337, 4339, 4357, 4358, 4363, 4383, 4395, 4408, 4433, 4443, 4445, 4446, 5167, 5234, 5235, 5252, 5318, 5424, 5644, 6987, 7054, 7055, 7071] >>> >>> p = psutil.Process(7055) >>> p psutil.Process(pid=7055, name='python', started='09:04:44') >>> p.name() 'python' >>> p.exe() '/usr/bin/python' >>> p.cwd() '/home/giampaolo' >>> p.cmdline() ['/usr/bin/python', 'main.py'] >>> >>> p.pid 7055 >>> p.ppid() 7054 >>> p.children(recursive=True) [psutil.Process(pid=29835, name='python2.7', started='11:45:38'), psutil.Process(pid=29836, name='python2.7', started='11:43:39')] >>> >>> p.parent() psutil.Process(pid=4699, name='bash', started='09:06:44') >>> p.parents() [psutil.Process(pid=4699, name='bash', started='09:06:44'), psutil.Process(pid=4689, name='gnome-terminal-server', started='0:06:44'), psutil.Process(pid=1, name='systemd', started='05:56:55')] >>> >>> p.status() 'running' >>> p.username() 'giampaolo' >>> p.create_time() 1267551141.5019531 >>> p.terminal() '/dev/pts/0' >>> >>> p.uids() puids(real=1000, effective=1000, saved=1000) >>> p.gids() pgids(real=1000, effective=1000, saved=1000) >>> >>> p.cpu_times() pcputimes(user=1.02, system=0.31, children_user=0.32, children_system=0.1) >>> p.cpu_percent(interval=1.0) 12.1 >>> p.cpu_affinity() [0, 1, 2, 3] >>> p.cpu_affinity([0, 1]) # set >>> p.cpu_num() 1 >>> >>> p.memory_info() pmem(rss=10915840, vms=67608576, shared=3313664, text=2310144, lib=0, data=7262208, dirty=0) >>> p.memory_full_info() # \"real\" USS memory usage (Linux, macOS, Win only) pfullmem(rss=10199040, vms=52133888, shared=3887104, text=2867200, lib=0, data=5967872, dirty=0, uss=6545408, pss=6872064, swap=0) >>> p.memory_percent() 0.7823 >>> p.memory_maps() [pmmap_grouped(path='/lib/x8664-linux-gnu/libutil-2.15.so', rss=32768, size=2125824, pss=32768, shared_clean=0, shared_dirty=0, private_clean=20480, private_dirty=12288, referenced=32768, anonymous=12288, swap=0), pmmap_grouped(path='/lib/x8664-linux-gnu/libc-2.15.so', rss=3821568, size=3842048, pss=3821568, shared_clean=0, shared_dirty=0, private_clean=0, private_dirty=3821568, referenced=3575808, anonymous=3821568, swap=0), pmmap_grouped(path='[heap]', rss=32768, size=139264, pss=32768, shared_clean=0, shared_dirty=0, private_clean=0, private_dirty=32768, referenced=32768, anonymous=32768, swap=0), pmmap_grouped(path='[stack]', rss=2465792, size=2494464, pss=2465792, shared_clean=0, shared_dirty=0, private_clean=0, private_dirty=2465792, referenced=2277376, anonymous=2465792, swap=0), ...] >>> >>> p.io_counters() pio(read_count=478001, write_count=59371, read_bytes=700416, write_bytes=69632, read_chars=456232, write_chars=517543) >>> >>> p.open_files() [popenfile(path='/home/giampaolo/svn/psutil/setup.py', fd=3, position=0, mode='r', flags=32768), popenfile(path='/var/log/monitd', fd=4, position=235542, mode='a', flags=33793)] >>> >>> p.connections() [pconn(fd=115, family=<AddressFamily.AF_INET: 2>, type=<SocketType.SOCK_STREAM: 1>, laddr=addr(ip='10.0.0.1', port=48776), raddr=addr(ip='93.186.135.91', port=80), status='ESTABLISHED'), pconn(fd=117, family=<AddressFamily.AF_INET: 2>, type=<SocketType.SOCK_STREAM: 1>, laddr=addr(ip='10.0.0.1', port=43761), raddr=addr(ip='72.14.234.100', port=80), status='CLOSING')] >>> >>> p.num_threads() 4 >>> p.num_fds() 8 >>> p.threads() [pthread(id=5234, user_time=22.5, system_time=9.2891), pthread(id=5237, user_time=0.0707, system_time=1.1)] >>> >>> p.num_ctx_switches() pctxsw(voluntary=78, involuntary=19) >>> >>> p.nice() 0 >>> p.nice(10) # set >>> >>> p.ionice(psutil.IOPRIO_CLASS_IDLE) # IO priority (Win and Linux only) >>> p.ionice() pionice(ioclass=<IOPriority.IOPRIO_CLASS_IDLE: 3>, value=0) >>> >>> p.rlimit(psutil.RLIMIT_NOFILE, (5, 5)) # set resource limits (Linux only) >>> p.rlimit(psutil.RLIMIT_NOFILE) (5, 5) >>> >>> p.environ() {'LC_PAPER': 'it_IT.UTF-8', 'SHELL': '/bin/bash', 'GREP_OPTIONS': '--color=auto', 'XDG_CONFIG_DIRS': '/etc/xdg/xdg-ubuntu:/usr/share/upstart/xdg:/etc/xdg', ...} >>> >>> p.as_dict() {'status': 'running', 'num_ctx_switches': pctxsw(voluntary=63, involuntary=1), 'pid': 5457, ...} >>> p.is_running() True >>> p.suspend() >>> p.resume() >>> >>> p.terminate() >>> p.wait(timeout=3) 0 >>> >>> psutil.test() USER PID %CPU %MEM VSZ RSS TTY START TIME COMMAND root 1 0.0 0.0 24584 2240 Jun17 00:00 init root 2 0.0 0.0 0 0 Jun17 00:00 kthreadd ... giampaolo 31475 0.0 0.0 20760 3024 /dev/pts/0 Jun19 00:00 python2.4 giampaolo 31721 0.0 2.2 773060 181896 00:04 10:30 chrome root 31763 0.0 0.0 0 0 00:05 00:00 kworker/0:1 >>>","title":"16. psutil"},{"location":"python/lib/psutil/psutil.index/#1","text":"psutil\u662f\u4e00\u4e2a\u8de8\u5e73\u53f0\u5e93\uff0c\u80fd\u591f\u8f7b\u677e\u5b9e\u73b0\u83b7\u53d6\u7cfb\u7edf\u8fd0\u884c\u7684\u8fdb\u7a0b\u548c\u7cfb\u7edf\u5229\u7528\u7387\uff08\u5305\u62ecCPU\u3001\u5185\u5b58\u3001\u78c1\u76d8\u3001\u7f51\u7edc\u7b49\uff09\u4fe1\u606f\u3002\u5b83\u4e3b\u8981\u5e94\u7528\u4e8e\u7cfb\u7edf\u76d1\u63a7\uff0c\u5206\u6790\u548c\u9650\u5236\u7cfb\u7edf\u8d44\u6e90\u53ca\u8fdb\u7a0b\u7684\u7ba1\u7406\u3002\u5b83\u5b9e\u73b0\u4e86\u540c\u7b49\u547d\u4ee4\u884c\u5de5\u5177\u63d0\u4f9b\u7684\u529f\u80fd\uff0c\u5982ps\u3001top\u3001lsof\u3001netstat\u3001ifconfig\u3001who\u3001df\u3001kill\u3001free\u3001nice\u3001ionice\u3001iostat\u3001iotop\u3001uptime\u3001pidof\u3001tty\u3001taskset\u3001pmap\u7b49\u3002\u76ee\u524d\u652f\u630132\u4f4d\u548c64\u4f4d\u7684Linux\u3001Windows\u3001OS X\u3001FreeBSD\u548cSun Solaris\u7b49\u64cd\u4f5c\u7cfb\u7edf\uff0c","title":"1. \u4ecb\u7ecd"},{"location":"python/lib/psutil/psutil.index/#11","text":"pip install psutil \u53c2\u8003\u6307\u5357","title":"1.1 \u5b89\u88c5"},{"location":"python/lib/psutil/psutil.index/#2","text":"","title":"2. \u4f7f\u7528"},{"location":"python/lib/psutil/psutil.index/#21-cpu","text":">>> import psutil >>> >>> psutil.cpu_times() # \u663e\u793acpu\u6240\u6709\u903b\u8f91\u4fe1\u606f scputimes(user=3961.46, nice=169.729, system=2150.659, idle=16900.540, iowait=629.59, irq=0.0, softirq=19.42, steal=0.0, guest=0, nice=0.0) >>> >>> for x in range(3): ... psutil.cpu_percent(interval=1) ... 4.0 5.9 3.8 >>> >>> for x in range(3): ... psutil.cpu_percent(interval=1, percpu=True) ... [4.0, 6.9, 3.7, 9.2] [7.0, 8.5, 2.4, 2.1] [1.2, 9.0, 9.9, 7.2] >>> >>> for x in range(3): ... psutil.cpu_times_percent(interval=1, percpu=False) ... scputimes(user=1.5, nice=0.0, system=0.5, idle=96.5, iowait=1.5, irq=0.0, softirq=0.0, steal=0.0, guest=0.0, guest_nice=0.0) scputimes(user=1.0, nice=0.0, system=0.0, idle=99.0, iowait=0.0, irq=0.0, softirq=0.0, steal=0.0, guest=0.0, guest_nice=0.0) scputimes(user=2.0, nice=0.0, system=0.0, idle=98.0, iowait=0.0, irq=0.0, softirq=0.0, steal=0.0, guest=0.0, guest_nice=0.0) >>> >>> psutil.cpu_count() # \u67e5\u770bcpu\u903b\u8f91\u4e2a\u6570 4 >>> psutil.cpu_count(logical=False) # \u67e5\u770bcpu\u7269\u7406\u4e2a\u6570 2 >>> >>> psutil.cpu_stats() scpustats(ctx_switches=20455687, interrupts=6598984, soft_interrupts=2134212, syscalls=0) >>> >>> psutil.cpu_freq() scpufreq(current=931.42925, min=800.0, max=3500.0) >>> >>> psutil.cpu_times().user # \u67e5\u770b\u7528\u6237\u7684cpu\u65f6\u95f4\u6bd4 11684.4","title":"2.1 cpu"},{"location":"python/lib/psutil/psutil.index/#22","text":">>> psutil.virtual_memory() svmem(total=10367352832, available=6472179712, percent=37.6, used=8186245120, free=2181107712, active=4748992512, inactive=2758115328, buffers=790724608, cached=3500347392, shared=787554304) >>> psutil.swap_memory() sswap(total=2097147904, used=296128512, free=1801019392, percent=14.1, sin=304193536, sout=677842944) >>>","title":"2.2 \u5185\u5b58"},{"location":"python/lib/psutil/psutil.index/#24","text":">>> psutil.disk_partitions() [sdiskpart(device='/dev/sda1', mountpoint='/', fstype='ext4', opts='rw,nosuid'), sdiskpart(device='/dev/sda2', mountpoint='/home', fstype='ext, opts='rw')] >>> >>> psutil.disk_usage('/') sdiskusage(total=21378641920, used=4809781248, free=15482871808, percent=22.5) >>> >>> psutil.disk_io_counters(perdisk=False) sdiskio(read_count=719566, write_count=1082197, read_bytes=18626220032, write_bytes=24081764352, read_time=5023392, write_time=63199568, read_merged_count=619166, write_merged_count=812396, busy_time=4523412) >>>","title":"2.4 \u78c1\u76d8"},{"location":"python/lib/psutil/psutil.index/#25","text":">>> psutil.net_io_counters(pernic=True) {'eth0': netio(bytes_sent=485291293, bytes_recv=6004858642, packets_sent=3251564, packets_recv=4787798, errin=0, errout=0, dropin=0, dropout=0), 'lo': netio(bytes_sent=2838627, bytes_recv=2838627, packets_sent=30567, packets_recv=30567, errin=0, errout=0, dropin=0, dropout=0)} >>> >>> psutil.net_connections() [sconn(fd=115, family=<AddressFamily.AF_INET: 2>, type=<SocketType.SOCK_STREAM: 1>, laddr=addr(ip='10.0.0.1', port=48776), raddr=addr(ip='93.186.135.91', port=80), status='ESTABLISHED', pid=1254), sconn(fd=117, family=<AddressFamily.AF_INET: 2>, type=<SocketType.SOCK_STREAM: 1>, laddr=addr(ip='10.0.0.1', port=43761), raddr=addr(ip='72.14.234.100', port=80), status='CLOSING', pid=2987), ...] >>> >>> psutil.net_if_addrs() {'lo': [snicaddr(family=<AddressFamily.AF_INET: 2>, address='127.0.0.1', netmask='255.0.0.0', broadcast='127.0.0.1', ptp=None), snicaddr(family=<AddressFamily.AF_INET6: 10>, address='::1', netmask='ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff', broadcast=None, ptp=None), snicaddr(family=<AddressFamily.AF_LINK: 17>, address='00:00:00:00:00:00', netmask=None, broadcast='00:00:00:00:00:00', ptp=None)], 'wlan0': [snicaddr(family=<AddressFamily.AF_INET: 2>, address='192.168.1.3', netmask='255.255.255.0', broadcast='192.168.1.255', ptp=None), snicaddr(family=<AddressFamily.AF_INET6: 10>, address='fe80::c685:8ff:fe45:641%wlan0', netmask='ffff:ffff:ffff:ffff::', broadcast=None, ptp=None), snicaddr(family=<AddressFamily.AF_LINK: 17>, address='c4:85:08:45:06:41', netmask=None, broadcast='ff:ff:ff:ff:ff:ff', ptp=None)]} >>> >>> psutil.net_if_stats() {'lo': snicstats(isup=True, duplex=<NicDuplex.NIC_DUPLEX_UNKNOWN: 0>, speed=0, mtu=65536), 'wlan0': snicstats(isup=True, duplex=<NicDuplex.NIC_DUPLEX_FULL: 2>, speed=100, mtu=1500)} >>>","title":"2.5 \u7f51\u7edc"},{"location":"python/lib/psutil/psutil.index/#25_1","text":">>> import psutil >>> psutil.sensors_temperatures() {'acpitz': [shwtemp(label='', current=47.0, high=103.0, critical=103.0)], 'asus': [shwtemp(label='', current=47.0, high=None, critical=None)], 'coretemp': [shwtemp(label='Physical id 0', current=52.0, high=100.0, critical=100.0), shwtemp(label='Core 0', current=45.0, high=100.0, critical=100.0)]} >>> >>> psutil.sensors_fans() {'asus': [sfan(label='cpu_fan', current=3200)]} >>> >>> psutil.sensors_battery() sbattery(percent=93, secsleft=16628, power_plugged=False) >>>","title":"2.5 \u4f20\u611f\u5668"},{"location":"python/lib/psutil/psutil.index/#26","text":">>> import psutil >>> psutil.users() [suser(name='giampaolo', terminal='pts/2', host='localhost', started=1340737536.0, pid=1352), suser(name='giampaolo', terminal='pts/3', host='localhost', started=1340737792.0, pid=1788)] >>> >>> psutil.boot_time() 1365519115.0 >>>","title":"2.6 \u5176\u4ed6"},{"location":"python/lib/psutil/psutil.index/#27-pid","text":">>> import psutil >>> psutil.pids() [1, 2, 3, 4, 5, 6, 7, 46, 48, 50, 51, 178, 182, 222, 223, 224, 268, 1215, 1216, 1220, 1221, 1243, 1244, 1301, 1601, 2237, 2355, 2637, 2774, 3932, 4176, 4177, 4185, 4187, 4189, 4225, 4243, 4245, 4263, 4282, 4306, 4311, 4312, 4313, 4314, 4337, 4339, 4357, 4358, 4363, 4383, 4395, 4408, 4433, 4443, 4445, 4446, 5167, 5234, 5235, 5252, 5318, 5424, 5644, 6987, 7054, 7055, 7071] >>> >>> p = psutil.Process(7055) >>> p psutil.Process(pid=7055, name='python', started='09:04:44') >>> p.name() 'python' >>> p.exe() '/usr/bin/python' >>> p.cwd() '/home/giampaolo' >>> p.cmdline() ['/usr/bin/python', 'main.py'] >>> >>> p.pid 7055 >>> p.ppid() 7054 >>> p.children(recursive=True) [psutil.Process(pid=29835, name='python2.7', started='11:45:38'), psutil.Process(pid=29836, name='python2.7', started='11:43:39')] >>> >>> p.parent() psutil.Process(pid=4699, name='bash', started='09:06:44') >>> p.parents() [psutil.Process(pid=4699, name='bash', started='09:06:44'), psutil.Process(pid=4689, name='gnome-terminal-server', started='0:06:44'), psutil.Process(pid=1, name='systemd', started='05:56:55')] >>> >>> p.status() 'running' >>> p.username() 'giampaolo' >>> p.create_time() 1267551141.5019531 >>> p.terminal() '/dev/pts/0' >>> >>> p.uids() puids(real=1000, effective=1000, saved=1000) >>> p.gids() pgids(real=1000, effective=1000, saved=1000) >>> >>> p.cpu_times() pcputimes(user=1.02, system=0.31, children_user=0.32, children_system=0.1) >>> p.cpu_percent(interval=1.0) 12.1 >>> p.cpu_affinity() [0, 1, 2, 3] >>> p.cpu_affinity([0, 1]) # set >>> p.cpu_num() 1 >>> >>> p.memory_info() pmem(rss=10915840, vms=67608576, shared=3313664, text=2310144, lib=0, data=7262208, dirty=0) >>> p.memory_full_info() # \"real\" USS memory usage (Linux, macOS, Win only) pfullmem(rss=10199040, vms=52133888, shared=3887104, text=2867200, lib=0, data=5967872, dirty=0, uss=6545408, pss=6872064, swap=0) >>> p.memory_percent() 0.7823 >>> p.memory_maps() [pmmap_grouped(path='/lib/x8664-linux-gnu/libutil-2.15.so', rss=32768, size=2125824, pss=32768, shared_clean=0, shared_dirty=0, private_clean=20480, private_dirty=12288, referenced=32768, anonymous=12288, swap=0), pmmap_grouped(path='/lib/x8664-linux-gnu/libc-2.15.so', rss=3821568, size=3842048, pss=3821568, shared_clean=0, shared_dirty=0, private_clean=0, private_dirty=3821568, referenced=3575808, anonymous=3821568, swap=0), pmmap_grouped(path='[heap]', rss=32768, size=139264, pss=32768, shared_clean=0, shared_dirty=0, private_clean=0, private_dirty=32768, referenced=32768, anonymous=32768, swap=0), pmmap_grouped(path='[stack]', rss=2465792, size=2494464, pss=2465792, shared_clean=0, shared_dirty=0, private_clean=0, private_dirty=2465792, referenced=2277376, anonymous=2465792, swap=0), ...] >>> >>> p.io_counters() pio(read_count=478001, write_count=59371, read_bytes=700416, write_bytes=69632, read_chars=456232, write_chars=517543) >>> >>> p.open_files() [popenfile(path='/home/giampaolo/svn/psutil/setup.py', fd=3, position=0, mode='r', flags=32768), popenfile(path='/var/log/monitd', fd=4, position=235542, mode='a', flags=33793)] >>> >>> p.connections() [pconn(fd=115, family=<AddressFamily.AF_INET: 2>, type=<SocketType.SOCK_STREAM: 1>, laddr=addr(ip='10.0.0.1', port=48776), raddr=addr(ip='93.186.135.91', port=80), status='ESTABLISHED'), pconn(fd=117, family=<AddressFamily.AF_INET: 2>, type=<SocketType.SOCK_STREAM: 1>, laddr=addr(ip='10.0.0.1', port=43761), raddr=addr(ip='72.14.234.100', port=80), status='CLOSING')] >>> >>> p.num_threads() 4 >>> p.num_fds() 8 >>> p.threads() [pthread(id=5234, user_time=22.5, system_time=9.2891), pthread(id=5237, user_time=0.0707, system_time=1.1)] >>> >>> p.num_ctx_switches() pctxsw(voluntary=78, involuntary=19) >>> >>> p.nice() 0 >>> p.nice(10) # set >>> >>> p.ionice(psutil.IOPRIO_CLASS_IDLE) # IO priority (Win and Linux only) >>> p.ionice() pionice(ioclass=<IOPriority.IOPRIO_CLASS_IDLE: 3>, value=0) >>> >>> p.rlimit(psutil.RLIMIT_NOFILE, (5, 5)) # set resource limits (Linux only) >>> p.rlimit(psutil.RLIMIT_NOFILE) (5, 5) >>> >>> p.environ() {'LC_PAPER': 'it_IT.UTF-8', 'SHELL': '/bin/bash', 'GREP_OPTIONS': '--color=auto', 'XDG_CONFIG_DIRS': '/etc/xdg/xdg-ubuntu:/usr/share/upstart/xdg:/etc/xdg', ...} >>> >>> p.as_dict() {'status': 'running', 'num_ctx_switches': pctxsw(voluntary=63, involuntary=1), 'pid': 5457, ...} >>> p.is_running() True >>> p.suspend() >>> p.resume() >>> >>> p.terminate() >>> p.wait(timeout=3) 0 >>> >>> psutil.test() USER PID %CPU %MEM VSZ RSS TTY START TIME COMMAND root 1 0.0 0.0 24584 2240 Jun17 00:00 init root 2 0.0 0.0 0 0 Jun17 00:00 kthreadd ... giampaolo 31475 0.0 0.0 20760 3024 /dev/pts/0 Jun19 00:00 python2.4 giampaolo 31721 0.0 2.2 773060 181896 00:04 10:30 chrome root 31763 0.0 0.0 0 0 00:05 00:00 kworker/0:1 >>>","title":"2.7 pid"},{"location":"python/lib/sh/1.sh/","text":"\u53c2\u8003\u94fe\u63a5 python sh\u5e93 sh is a full-fledged subprocess replacement for Python 2.6 - 3.5, PyPy and PyPy3 that allows you to call any program as if it were a function: \u5b89\u88c5 pip install sh 1. \u67e5\u770b\u7f51\u5361\u4fe1\u606f \u00b6 In [1]: from sh import ifconfig In [2]: print(ifconfig('enp3s0')) enp3s0 Link encap:\u4ee5\u592a\u7f51 \u786c\u4ef6\u5730\u5740 74:27:ea:b0:aa:2c inet \u5730\u5740:192.168.5.110 \u5e7f\u64ad:192.168.5.255 \u63a9\u7801:255.255.255.0 inet6 \u5730\u5740: 2002::10/64 Scope:Global inet6 \u5730\u5740: fe80::7627:eaff:feb0:aa2c/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 \u8dc3\u70b9\u6570:1 \u63a5\u6536\u6570\u636e\u5305:30279078 \u9519\u8bef:0 \u4e22\u5f03:0 \u8fc7\u8f7d:0 \u5e27\u6570:0 \u53d1\u9001\u6570\u636e\u5305:28671072 \u9519\u8bef:0 \u4e22\u5f03:0 \u8fc7\u8f7d:0 \u8f7d\u6ce2:0 \u78b0\u649e:0 \u53d1\u9001\u961f\u5217\u957f\u5ea6:1000 \u63a5\u6536\u5b57\u8282:12743118233 (12.7 GB) \u53d1\u9001\u5b57\u8282:15521623957 (15.5 GB) In [3]: import sh In [5]: sh.ls(\"/tmp/yun\") Out[5]: crawler import stat.tgz 2. \u5f02\u5e38\u6355\u83b7 \u00b6 try: sh.ls(\"/doesnt/exist\") except sh.ErrorReturnCode_2: print(\"directory doesn't exist\") 3. \u8c03\u7528\u7cfb\u7edf\u7a0b\u5e8f \u00b6 In [12]: import sh In [14]: sh.ls('/tmp/yun') Out[14]: crawler import stat.tgz 4. \u8c03\u7528\u81ea\u5df1\u7684\u7a0b\u5e8f \u00b6 5. bake\u547d\u4ee4\u547d\u4ee4\u53c2\u6570 \u00b6 In [24]: import sh In [25]: du=sh.du.bake('-shc') In [26]: print (du('/tmp/yun')) 6.3M /tmp/yun 6.3M \u603b\u7528\u91cf 6. glob\u5217\u51fa\u6587\u4ef6 \u00b6 In [27]: import sh In [28]: list=sh.glob('/tmp/yun*') In [29]: print(list) ['/tmp/yun'] 7. \u7ba1\u9053 \u00b6 In [31]: import sh In [32]: print(sh.sort(sh.du(sh.glob('Python-2.7.8'),'-shc'),'-rn')) 132M \u603b\u7528\u91cf 132M Python-2.7.8 \u7ba1\u9053\u662f\u6709\u5e8f\u7684\uff0c\u9ed8\u8ba4\u7531\u5185\u800c\u5916\uff0c\u4f46\u5982\u679c\u9700\u8981\u5e76\u884c\u5462\uff1f\u52a0\u4e2a_piped=True In [33]: import sh In [34]: for line in sh.tr(sh.tail(\"-f\", \"/var/log/syslog\", _piped=True), \"[:upper:]\", \"[:lower:]\", _iter=True): ...: print(line) ...: jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/52/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/6/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/8/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/856/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/857/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/9/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/98/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/99/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z e! influxdb output error: post http://localhost:8086/write?consistency=any&db=telegraf: dial tcp 127.0.0.1:8086: getsockopt: connection refused jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z e! error writing to output [influxdb]: could not write to any influxdb server in cluster 8. \u540e\u53f0\u8fd0\u884c \u00b6 In [37]: out = sh.find('-name',\"test.sh\",_bg=True) In [38]: out Out[38]: ./test.sh ./py/pachong/node/deps/openssl/openssl/demos/tunala/test.sh","title":"1. sh\u4f7f\u7528"},{"location":"python/lib/sh/1.sh/#1","text":"In [1]: from sh import ifconfig In [2]: print(ifconfig('enp3s0')) enp3s0 Link encap:\u4ee5\u592a\u7f51 \u786c\u4ef6\u5730\u5740 74:27:ea:b0:aa:2c inet \u5730\u5740:192.168.5.110 \u5e7f\u64ad:192.168.5.255 \u63a9\u7801:255.255.255.0 inet6 \u5730\u5740: 2002::10/64 Scope:Global inet6 \u5730\u5740: fe80::7627:eaff:feb0:aa2c/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 \u8dc3\u70b9\u6570:1 \u63a5\u6536\u6570\u636e\u5305:30279078 \u9519\u8bef:0 \u4e22\u5f03:0 \u8fc7\u8f7d:0 \u5e27\u6570:0 \u53d1\u9001\u6570\u636e\u5305:28671072 \u9519\u8bef:0 \u4e22\u5f03:0 \u8fc7\u8f7d:0 \u8f7d\u6ce2:0 \u78b0\u649e:0 \u53d1\u9001\u961f\u5217\u957f\u5ea6:1000 \u63a5\u6536\u5b57\u8282:12743118233 (12.7 GB) \u53d1\u9001\u5b57\u8282:15521623957 (15.5 GB) In [3]: import sh In [5]: sh.ls(\"/tmp/yun\") Out[5]: crawler import stat.tgz","title":"1. \u67e5\u770b\u7f51\u5361\u4fe1\u606f"},{"location":"python/lib/sh/1.sh/#2","text":"try: sh.ls(\"/doesnt/exist\") except sh.ErrorReturnCode_2: print(\"directory doesn't exist\")","title":"2. \u5f02\u5e38\u6355\u83b7"},{"location":"python/lib/sh/1.sh/#3","text":"In [12]: import sh In [14]: sh.ls('/tmp/yun') Out[14]: crawler import stat.tgz","title":"3. \u8c03\u7528\u7cfb\u7edf\u7a0b\u5e8f"},{"location":"python/lib/sh/1.sh/#4","text":"","title":"4. \u8c03\u7528\u81ea\u5df1\u7684\u7a0b\u5e8f"},{"location":"python/lib/sh/1.sh/#5-bake","text":"In [24]: import sh In [25]: du=sh.du.bake('-shc') In [26]: print (du('/tmp/yun')) 6.3M /tmp/yun 6.3M \u603b\u7528\u91cf","title":"5. bake\u547d\u4ee4\u547d\u4ee4\u53c2\u6570"},{"location":"python/lib/sh/1.sh/#6-glob","text":"In [27]: import sh In [28]: list=sh.glob('/tmp/yun*') In [29]: print(list) ['/tmp/yun']","title":"6. glob\u5217\u51fa\u6587\u4ef6"},{"location":"python/lib/sh/1.sh/#7","text":"In [31]: import sh In [32]: print(sh.sort(sh.du(sh.glob('Python-2.7.8'),'-shc'),'-rn')) 132M \u603b\u7528\u91cf 132M Python-2.7.8 \u7ba1\u9053\u662f\u6709\u5e8f\u7684\uff0c\u9ed8\u8ba4\u7531\u5185\u800c\u5916\uff0c\u4f46\u5982\u679c\u9700\u8981\u5e76\u884c\u5462\uff1f\u52a0\u4e2a_piped=True In [33]: import sh In [34]: for line in sh.tr(sh.tail(\"-f\", \"/var/log/syslog\", _piped=True), \"[:upper:]\", \"[:lower:]\", _iter=True): ...: print(line) ...: jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/52/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/6/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/8/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/856/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/857/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/9/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/98/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z i! processes: unknown state [ i ] in file /proc/99/stat jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z e! influxdb output error: post http://localhost:8086/write?consistency=any&db=telegraf: dial tcp 127.0.0.1:8086: getsockopt: connection refused jan 14 09:38:40 localhost telegraf[2077]: 2019-01-14t01:38:40z e! error writing to output [influxdb]: could not write to any influxdb server in cluster","title":"7. \u7ba1\u9053"},{"location":"python/lib/sh/1.sh/#8","text":"In [37]: out = sh.find('-name',\"test.sh\",_bg=True) In [38]: out Out[38]: ./test.sh ./py/pachong/node/deps/openssl/openssl/demos/tunala/test.sh","title":"8. \u540e\u53f0\u8fd0\u884c"},{"location":"python/lib/sys/sys.index/","text":"sys \u6a21\u5757 1. \u4ecb\u7ecd \u00b6 sys\u6a21\u5757\u529f\u80fd\u591a\uff0c\u6211\u4eec\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e9b\u6bd4\u8f83\u5b9e\u7528\u7684\u529f\u80fd\uff0c\u76f8\u4fe1\u4f60\u4f1a\u559c\u6b22\u7684\uff0c\u548c\u6211\u4e00\u8d77\u8d70\u8fdbpython\u7684\u6a21\u5757\u5427\uff01 2 \u83b7\u53d6\u5e73\u53f0\u4fe1\u606f \u00b6 2.1 Linux\u5e73\u53f0 \u00b6 In [1]: import sys In [2]: sys.platform Out[2]: 'linux' 2.2 windows\u5e73\u53f0 \u00b6 In [1]: import sys In [2]: sys.platform Out[2]: 'win32'' 3. \u5728\u5916\u90e8\u5411\u7a0b\u5e8f\u5185\u90e8\u4f20\u9012\u53c2\u6570 \u00b6 root@leco:~/code/sys# cat demo1.py import sys print(sys.argv) # \u53c2\u6570\u5217\u8868\uff0c\u8fd4\u56de\u662f\u5217\u8868 print(len(sys.argv)) # \u53c2\u6570\u4e2a\u6570 print(sys.argv[0]) # \u811a\u672c\u540d print(sys.argv[1]) # \u7b2c\u4e00\u4e2a\u53c2\u6570 root@leco:~/code/sys# python demo1.py 1 2 ['demo1.py', '1', '2'] 3 demo1.py 1 4. \u9000\u51fa \u00b6 \u6267\u884c\u5230\u4e3b\u7a0b\u5e8f\u672b\u5c3e\uff0c\u89e3\u91ca\u5668\u81ea\u52a8\u9000\u51fa\uff0c\u4f46\u662f\u5982\u679c\u9700\u8981\u4e2d\u9014\u9000\u51fa\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u8c03\u7528sys.exit\u51fd\u6570\uff0c\u5e26\u6709\u4e00\u4e2a\u53ef\u9009\u7684\u6574\u6570\u53c2\u6570\u8fd4\u56de\u7ed9\u8c03\u7528\u5b83\u7684\u7a0b\u5e8f\uff0c\u8868\u793a\u4f60\u53ef\u4ee5\u5728\u4e3b\u7a0b\u5e8f\u4e2d\u6355\u83b7\u5bf9sys.exit\u7684\u8c03\u7528\u3002\uff080\u662f\u6b63\u5e38\u9000\u51fa\uff0c\u5176\u4ed6\u4e3a\u5f02\u5e38\uff09 In [1]: import sys In [2]: sys.exit(0) An exception has occurred, use %tb to see the full traceback. SystemExit: 0 /usr/local/lib/python3.6/site-packages/IPython/core/interactiveshell.py:2918: UserWarning: To exit: use 'exit', 'quit', or Ctrl-D. warn(\"To exit: use 'exit', 'quit', or Ctrl-D.\", stacklevel=1) In [3]: sys.exit(1) An exception has occurred, use %tb to see the full traceback.","title":"15. sys"},{"location":"python/lib/sys/sys.index/#1","text":"sys\u6a21\u5757\u529f\u80fd\u591a\uff0c\u6211\u4eec\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e9b\u6bd4\u8f83\u5b9e\u7528\u7684\u529f\u80fd\uff0c\u76f8\u4fe1\u4f60\u4f1a\u559c\u6b22\u7684\uff0c\u548c\u6211\u4e00\u8d77\u8d70\u8fdbpython\u7684\u6a21\u5757\u5427\uff01","title":"1. \u4ecb\u7ecd"},{"location":"python/lib/sys/sys.index/#2","text":"","title":"2 \u83b7\u53d6\u5e73\u53f0\u4fe1\u606f"},{"location":"python/lib/sys/sys.index/#21-linux","text":"In [1]: import sys In [2]: sys.platform Out[2]: 'linux'","title":"2.1 Linux\u5e73\u53f0"},{"location":"python/lib/sys/sys.index/#22-windows","text":"In [1]: import sys In [2]: sys.platform Out[2]: 'win32''","title":"2.2 windows\u5e73\u53f0"},{"location":"python/lib/sys/sys.index/#3","text":"root@leco:~/code/sys# cat demo1.py import sys print(sys.argv) # \u53c2\u6570\u5217\u8868\uff0c\u8fd4\u56de\u662f\u5217\u8868 print(len(sys.argv)) # \u53c2\u6570\u4e2a\u6570 print(sys.argv[0]) # \u811a\u672c\u540d print(sys.argv[1]) # \u7b2c\u4e00\u4e2a\u53c2\u6570 root@leco:~/code/sys# python demo1.py 1 2 ['demo1.py', '1', '2'] 3 demo1.py 1","title":"3. \u5728\u5916\u90e8\u5411\u7a0b\u5e8f\u5185\u90e8\u4f20\u9012\u53c2\u6570"},{"location":"python/lib/sys/sys.index/#4","text":"\u6267\u884c\u5230\u4e3b\u7a0b\u5e8f\u672b\u5c3e\uff0c\u89e3\u91ca\u5668\u81ea\u52a8\u9000\u51fa\uff0c\u4f46\u662f\u5982\u679c\u9700\u8981\u4e2d\u9014\u9000\u51fa\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u8c03\u7528sys.exit\u51fd\u6570\uff0c\u5e26\u6709\u4e00\u4e2a\u53ef\u9009\u7684\u6574\u6570\u53c2\u6570\u8fd4\u56de\u7ed9\u8c03\u7528\u5b83\u7684\u7a0b\u5e8f\uff0c\u8868\u793a\u4f60\u53ef\u4ee5\u5728\u4e3b\u7a0b\u5e8f\u4e2d\u6355\u83b7\u5bf9sys.exit\u7684\u8c03\u7528\u3002\uff080\u662f\u6b63\u5e38\u9000\u51fa\uff0c\u5176\u4ed6\u4e3a\u5f02\u5e38\uff09 In [1]: import sys In [2]: sys.exit(0) An exception has occurred, use %tb to see the full traceback. SystemExit: 0 /usr/local/lib/python3.6/site-packages/IPython/core/interactiveshell.py:2918: UserWarning: To exit: use 'exit', 'quit', or Ctrl-D. warn(\"To exit: use 'exit', 'quit', or Ctrl-D.\", stacklevel=1) In [3]: sys.exit(1) An exception has occurred, use %tb to see the full traceback.","title":"4. \u9000\u51fa"},{"location":"python/lib/uuid/uuid.index/","text":"uuid \u6a21\u5757 1. \u4ecb\u7ecd \u00b6 uuid\u662f128\u4f4d\u7684\u5168\u5c40\u552f\u4e00\u6807\u8bc6\u7b26\uff08univeral unique identifier\uff09\uff0c\u901a\u5e38\u752832\u4f4d\u7684\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u6765\u8868\u73b0\u3002\u6709\u65f6\u4e5f\u79f0guid(global unique identifier)\u3002python\u4e2d\u81ea\u5e26\u4e86uuid\u6a21\u5757\u6765\u8fdb\u884cuuid\u7684\u751f\u6210\u548c\u7ba1\u7406\u5de5\u4f5c\u3002 python\u4e2d\u7684uuid\u6a21\u5757\u57fa\u4e8e\u4fe1\u606f\u5982MAC\u5730\u5740\u3001\u65f6\u95f4\u6233\u3001\u547d\u540d\u7a7a\u95f4\u3001\u968f\u673a\u6570\u3001\u4f2a\u968f\u673a\u6570\u6765uuid\u3002\u5177\u4f53\u65b9\u6cd5\u6709\u5982\u4e0b\u51e0\u4e2a\u3002 1.1 uuid.uuid1() \u00b6 \u57fa\u4e8eMAC\u5730\u5740\uff0c\u65f6\u95f4\u6233\uff0c\u968f\u673a\u6570\u6765\u751f\u6210\u552f\u4e00\u7684uuid\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u5168\u7403\u8303\u56f4\u5185\u7684\u552f\u4e00\u6027\u3002 1.2 uuid.uuid2() \u00b6 \u7b97\u6cd5\u4e0euuid1\u76f8\u540c\uff0c\u4e0d\u540c\u7684\u662f\u628a\u65f6\u95f4\u6233\u7684\u524d4\u4f4d\u7f6e\u6362\u4e3aPOSIX\u7684UID\u3002\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u7684\u662fpython\u4e2d\u6ca1\u6709\u57fa\u4e8eDCE\u7684\u7b97\u6cd5\uff0c\u6240\u4ee5python\u7684uuid\u6a21\u5757\u4e2d\u6ca1\u6709uuid2\u8fd9\u4e2a\u65b9\u6cd5\u3002 1.3 uuid.uuid3(namespace,name) \u00b6 \u901a\u8fc7\u8ba1\u7b97\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\u548c\u540d\u5b57\u7684md5\u6563\u5217\u503c\u6765\u7ed9\u51fa\u4e00\u4e2auuid\uff0c\u6240\u4ee5\u53ef\u4ee5\u4fdd\u8bc1\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u4e0d\u540c\u540d\u5b57\u5177\u6709\u4e0d\u540c\u7684uuid\uff0c\u4f46\u662f\u76f8\u540c\u7684\u540d\u5b57\u5c31\u662f\u76f8\u540c\u7684uuid\u4e86\u3002namespace\u5e76\u4e0d\u662f\u4e00\u4e2a\u81ea\u5df1\u624b\u52a8\u6307\u5b9a\u7684\u5b57\u7b26\u4e32\u6216\u5176\u4ed6\u91cf\uff0c\u800c\u662f\u5728uuid\u6a21\u5757\u4e2d\u672c\u8eab\u7ed9\u51fa\u7684\u4e00\u4e9b\u503c\u3002\u6bd4\u5982uuid.NAMESPACE_DNS\uff0cuuid.NAMESPACE_OID\uff0cuuid.NAMESPACE_OID\u8fd9\u4e9b\u503c\u3002\u8fd9\u4e9b\u503c\u672c\u8eab\u4e5f\u662fUUID\u5bf9\u8c61\uff0c\u6839\u636e\u4e00\u5b9a\u7684\u89c4\u5219\u8ba1\u7b97\u5f97\u51fa\u3002 1.4 uuid.uuid4() \u00b6 \u901a\u8fc7\u4f2a\u968f\u673a\u6570\u5f97\u5230uuid\uff0c\u662f\u6709\u4e00\u5b9a\u6982\u7387\u91cd\u590d\u7684 1.5 uuid.uuid5(namespace,name) \u00b6 uuid3\u57fa\u672c\u76f8\u540c\uff0c\u53ea\u4e0d\u8fc7\u91c7\u7528\u7684\u6563\u5217\u7b97\u6cd5\u662fsha1\u3002 UUID: \u901a\u7528\u552f\u4e00\u6807\u8bc6\u7b26 ( Universally Unique Identifier ), \u5bf9\u4e8e\u6240\u6709\u7684UUID\u5b83\u53ef\u4ee5\u4fdd\u8bc1\u5728\u7a7a\u95f4\u548c\u65f6\u95f4\u4e0a\u7684\u552f\u4e00\u6027. \u5b83\u662f\u901a\u8fc7MAC\u5730\u5740, \u65f6\u95f4\u6233, \u547d\u540d\u7a7a\u95f4, \u968f\u673a\u6570, \u4f2a\u968f\u673a\u6570\u6765\u4fdd\u8bc1\u751f\u6210ID\u7684\u552f\u4e00\u6027, \u6709\u7740\u56fa\u5b9a\u7684\u5927\u5c0f( 128 bit ). \u5b83\u7684\u552f\u4e00\u6027\u548c\u4e00\u81f4\u6027\u7279\u70b9\u4f7f\u5f97\u53ef\u4ee5\u65e0\u9700\u6ce8\u518c\u8fc7\u7a0b\u5c31\u80fd\u591f\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684UUID. UUID\u53ef\u4ee5\u88ab\u7528\u4f5c\u591a\u79cd\u7528\u9014, \u65e2\u53ef\u4ee5\u7528\u6765\u77ed\u65f6\u95f4\u5185\u6807\u8bb0\u4e00\u4e2a\u5bf9\u8c61, \u4e5f\u53ef\u4ee5\u53ef\u9760\u7684\u8fa8\u522b\u7f51\u7edc\u4e2d\u7684\u6301\u4e45\u6027\u5bf9\u8c61. \u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528UUID? \u5f88\u591a\u5e94\u7528\u573a\u666f\u9700\u8981\u4e00\u4e2aid, \u4f46\u662f\u53c8\u4e0d\u8981\u6c42\u8fd9\u4e2aid \u6709\u5177\u4f53\u7684\u610f\u4e49, \u4ec5\u4ec5\u7528\u6765\u6807\u8bc6\u4e00\u4e2a\u5bf9\u8c61. \u5e38\u89c1\u7684\u4f8b\u5b50\u6709\u6570\u636e\u5e93\u8868\u7684id \u5b57\u6bb5. \u53e6\u4e00\u4e2a\u4f8b\u5b50\u662f\u524d\u7aef\u7684\u5404\u79cdUI\u5e93, \u56e0\u4e3a\u5b83\u4eec\u901a\u5e38\u9700\u8981\u52a8\u6001\u521b\u5efa\u5404\u79cdUI\u5143\u7d20, \u8fd9\u4e9b\u5143\u7d20\u9700\u8981\u552f\u4e00\u7684id , \u8fd9\u65f6\u5019\u5c31\u9700\u8981\u4f7f\u7528UUID\u4e86. 2. Python\u7684uuid\u6a21\u5757 \u00b6 python\u7684uuid\u6a21\u5757\u63d0\u4f9bUUID\u7c7b\u548c\u51fd\u6570uuid1(), uuid3(), uuid4(), uuid5() \u6765\u751f\u62101, 3, 4, 5\u5404\u4e2a\u7248\u672c\u7684UUID ( \u9700\u8981\u6ce8\u610f\u7684\u662f: python\u4e2d\u6ca1\u6709uuid2()\u8fd9\u4e2a\u51fd\u6570). \u5bf9uuid\u6a21\u5757\u4e2d\u6700\u5e38\u7528\u7684\u51e0\u4e2a\u51fd\u6570\u603b\u7ed3\u5982\u4e0b: 2.1 uuid.uuid1([node[, clock_seq]]) \u00b6 \u57fa\u4e8e\u65f6\u95f4\u6233 \u4f7f\u7528\u4e3b\u673aID, \u5e8f\u5217\u53f7, \u548c\u5f53\u524d\u65f6\u95f4\u6765\u751f\u6210UUID, \u53ef\u4fdd\u8bc1\u5168\u7403\u8303\u56f4\u7684\u552f\u4e00\u6027. \u4f46\u7531\u4e8e\u4f7f\u7528\u8be5\u65b9\u6cd5\u751f\u6210\u7684UUID\u4e2d\u5305\u542b\u6709\u4e3b\u673a\u7684\u7f51\u7edc\u5730\u5740, \u56e0\u6b64\u53ef\u80fd\u5371\u53ca\u9690\u79c1. \u8be5\u51fd\u6570\u6709\u4e24\u4e2a\u53c2\u6570, \u5982\u679c node \u53c2\u6570\u672a\u6307\u5b9a, \u7cfb\u7edf\u5c06\u4f1a\u81ea\u52a8\u8c03\u7528 getnode() \u51fd\u6570\u6765\u83b7\u53d6\u4e3b\u673a\u7684\u786c\u4ef6\u5730\u5740. \u5982\u679c clock_seq \u53c2\u6570\u672a\u6307\u5b9a\u7cfb\u7edf\u4f1a\u4f7f\u7528\u4e00\u4e2a\u968f\u673a\u4ea7\u751f\u768414\u4f4d\u5e8f\u5217\u53f7\u6765\u4ee3\u66ff. 2.2 uuid.uuid3(namespace, name) \u00b6 \u57fa\u4e8e\u540d\u5b57\u7684MD5\u6563\u5217\u503c \u901a\u8fc7\u8ba1\u7b97\u547d\u540d\u7a7a\u95f4\u548c\u540d\u5b57\u7684MD5\u6563\u5217\u503c\u6765\u751f\u6210UUID, \u53ef\u4ee5\u4fdd\u8bc1\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u4e2d\u4e0d\u540c\u540d\u5b57\u7684\u552f\u4e00\u6027\u548c\u4e0d\u540c\u547d\u540d\u7a7a\u95f4\u7684\u552f\u4e00\u6027, \u4f46\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u7684\u540c\u4e00\u540d\u5b57\u751f\u6210\u7684UUID\u76f8\u540c. 2.3 uuid.uuid4() \u00b6 \u57fa\u4e8e\u968f\u673a\u6570 \u901a\u8fc7\u968f\u673a\u6570\u6765\u751f\u6210UUID. \u4f7f\u7528\u7684\u662f\u4f2a\u968f\u673a\u6570\u6709\u4e00\u5b9a\u7684\u91cd\u590d\u6982\u7387. 2.4 uuid.uuid5(namespace, name) \u00b6 \u57fa\u4e8e\u540d\u5b57\u7684SHA-1\u6563\u5217\u503c \u901a\u8fc7\u8ba1\u7b97\u547d\u540d\u7a7a\u95f4\u548c\u540d\u5b57\u7684SHA-1\u6563\u5217\u503c\u6765\u751f\u6210UUID, \u7b97\u6cd5\u4e0e uuid.uuid3() \u76f8\u540c. In [1]: import uuid # make a UUID based on the host ID and current time In [4]: uuid.uuid1() Out[4]: UUID('4894dae8-35ad-11e9-a653-7427eab0aa2c') # make a UUID using an MD5 hash of a namespace UUID and a name In [5]: uuid.uuid3(uuid.NAMESPACE_DNS, 'python.org') Out[5]: UUID('6fa459ea-ee8a-3ca4-894e-db77e160355e') # make a random UUID In [6]: uuid.uuid4() Out[6]: UUID('c86ad986-498f-4caf-901e-198076f335d6') # make a UUID using a SHA-1 hash of a namespace UUID and a name In [7]: uuid.uuid5(uuid.NAMESPACE_DNS, 'python.org') Out[7]: UUID('886313e1-3b8a-5372-9b90-0c9aee199e5d') # make a UUID from a string of hex digits (braces and hyphens ignored) In [8]: x = uuid.UUID('{00010203-0405-0607-0809-0a0b0c0d0e0f}') # convert a UUID to a string of hex digits in standard form In [9]: str(x) Out[9]: '00010203-0405-0607-0809-0a0b0c0d0e0f' # get the raw 16 bytes of the UUID In [10]: x.bytes Out[10]: b'\\x00\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\t\\n\\x0b\\x0c\\r\\x0e\\x0f' # make a UUID from a 16-byte string In [11]: uuid.UUID(bytes=x.bytes) Out[11]: UUID('00010203-0405-0607-0809-0a0b0c0d0e0f')","title":"11. uuid"},{"location":"python/lib/uuid/uuid.index/#1","text":"uuid\u662f128\u4f4d\u7684\u5168\u5c40\u552f\u4e00\u6807\u8bc6\u7b26\uff08univeral unique identifier\uff09\uff0c\u901a\u5e38\u752832\u4f4d\u7684\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u6765\u8868\u73b0\u3002\u6709\u65f6\u4e5f\u79f0guid(global unique identifier)\u3002python\u4e2d\u81ea\u5e26\u4e86uuid\u6a21\u5757\u6765\u8fdb\u884cuuid\u7684\u751f\u6210\u548c\u7ba1\u7406\u5de5\u4f5c\u3002 python\u4e2d\u7684uuid\u6a21\u5757\u57fa\u4e8e\u4fe1\u606f\u5982MAC\u5730\u5740\u3001\u65f6\u95f4\u6233\u3001\u547d\u540d\u7a7a\u95f4\u3001\u968f\u673a\u6570\u3001\u4f2a\u968f\u673a\u6570\u6765uuid\u3002\u5177\u4f53\u65b9\u6cd5\u6709\u5982\u4e0b\u51e0\u4e2a\u3002","title":"1. \u4ecb\u7ecd"},{"location":"python/lib/uuid/uuid.index/#11-uuiduuid1","text":"\u57fa\u4e8eMAC\u5730\u5740\uff0c\u65f6\u95f4\u6233\uff0c\u968f\u673a\u6570\u6765\u751f\u6210\u552f\u4e00\u7684uuid\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u5168\u7403\u8303\u56f4\u5185\u7684\u552f\u4e00\u6027\u3002","title":"1.1 uuid.uuid1()"},{"location":"python/lib/uuid/uuid.index/#12-uuiduuid2","text":"\u7b97\u6cd5\u4e0euuid1\u76f8\u540c\uff0c\u4e0d\u540c\u7684\u662f\u628a\u65f6\u95f4\u6233\u7684\u524d4\u4f4d\u7f6e\u6362\u4e3aPOSIX\u7684UID\u3002\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u7684\u662fpython\u4e2d\u6ca1\u6709\u57fa\u4e8eDCE\u7684\u7b97\u6cd5\uff0c\u6240\u4ee5python\u7684uuid\u6a21\u5757\u4e2d\u6ca1\u6709uuid2\u8fd9\u4e2a\u65b9\u6cd5\u3002","title":"1.2 uuid.uuid2()"},{"location":"python/lib/uuid/uuid.index/#13-uuiduuid3namespacename","text":"\u901a\u8fc7\u8ba1\u7b97\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\u548c\u540d\u5b57\u7684md5\u6563\u5217\u503c\u6765\u7ed9\u51fa\u4e00\u4e2auuid\uff0c\u6240\u4ee5\u53ef\u4ee5\u4fdd\u8bc1\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u4e0d\u540c\u540d\u5b57\u5177\u6709\u4e0d\u540c\u7684uuid\uff0c\u4f46\u662f\u76f8\u540c\u7684\u540d\u5b57\u5c31\u662f\u76f8\u540c\u7684uuid\u4e86\u3002namespace\u5e76\u4e0d\u662f\u4e00\u4e2a\u81ea\u5df1\u624b\u52a8\u6307\u5b9a\u7684\u5b57\u7b26\u4e32\u6216\u5176\u4ed6\u91cf\uff0c\u800c\u662f\u5728uuid\u6a21\u5757\u4e2d\u672c\u8eab\u7ed9\u51fa\u7684\u4e00\u4e9b\u503c\u3002\u6bd4\u5982uuid.NAMESPACE_DNS\uff0cuuid.NAMESPACE_OID\uff0cuuid.NAMESPACE_OID\u8fd9\u4e9b\u503c\u3002\u8fd9\u4e9b\u503c\u672c\u8eab\u4e5f\u662fUUID\u5bf9\u8c61\uff0c\u6839\u636e\u4e00\u5b9a\u7684\u89c4\u5219\u8ba1\u7b97\u5f97\u51fa\u3002","title":"1.3 uuid.uuid3(namespace,name)"},{"location":"python/lib/uuid/uuid.index/#14-uuiduuid4","text":"\u901a\u8fc7\u4f2a\u968f\u673a\u6570\u5f97\u5230uuid\uff0c\u662f\u6709\u4e00\u5b9a\u6982\u7387\u91cd\u590d\u7684","title":"1.4 uuid.uuid4()"},{"location":"python/lib/uuid/uuid.index/#15-uuiduuid5namespacename","text":"uuid3\u57fa\u672c\u76f8\u540c\uff0c\u53ea\u4e0d\u8fc7\u91c7\u7528\u7684\u6563\u5217\u7b97\u6cd5\u662fsha1\u3002 UUID: \u901a\u7528\u552f\u4e00\u6807\u8bc6\u7b26 ( Universally Unique Identifier ), \u5bf9\u4e8e\u6240\u6709\u7684UUID\u5b83\u53ef\u4ee5\u4fdd\u8bc1\u5728\u7a7a\u95f4\u548c\u65f6\u95f4\u4e0a\u7684\u552f\u4e00\u6027. \u5b83\u662f\u901a\u8fc7MAC\u5730\u5740, \u65f6\u95f4\u6233, \u547d\u540d\u7a7a\u95f4, \u968f\u673a\u6570, \u4f2a\u968f\u673a\u6570\u6765\u4fdd\u8bc1\u751f\u6210ID\u7684\u552f\u4e00\u6027, \u6709\u7740\u56fa\u5b9a\u7684\u5927\u5c0f( 128 bit ). \u5b83\u7684\u552f\u4e00\u6027\u548c\u4e00\u81f4\u6027\u7279\u70b9\u4f7f\u5f97\u53ef\u4ee5\u65e0\u9700\u6ce8\u518c\u8fc7\u7a0b\u5c31\u80fd\u591f\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684UUID. UUID\u53ef\u4ee5\u88ab\u7528\u4f5c\u591a\u79cd\u7528\u9014, \u65e2\u53ef\u4ee5\u7528\u6765\u77ed\u65f6\u95f4\u5185\u6807\u8bb0\u4e00\u4e2a\u5bf9\u8c61, \u4e5f\u53ef\u4ee5\u53ef\u9760\u7684\u8fa8\u522b\u7f51\u7edc\u4e2d\u7684\u6301\u4e45\u6027\u5bf9\u8c61. \u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528UUID? \u5f88\u591a\u5e94\u7528\u573a\u666f\u9700\u8981\u4e00\u4e2aid, \u4f46\u662f\u53c8\u4e0d\u8981\u6c42\u8fd9\u4e2aid \u6709\u5177\u4f53\u7684\u610f\u4e49, \u4ec5\u4ec5\u7528\u6765\u6807\u8bc6\u4e00\u4e2a\u5bf9\u8c61. \u5e38\u89c1\u7684\u4f8b\u5b50\u6709\u6570\u636e\u5e93\u8868\u7684id \u5b57\u6bb5. \u53e6\u4e00\u4e2a\u4f8b\u5b50\u662f\u524d\u7aef\u7684\u5404\u79cdUI\u5e93, \u56e0\u4e3a\u5b83\u4eec\u901a\u5e38\u9700\u8981\u52a8\u6001\u521b\u5efa\u5404\u79cdUI\u5143\u7d20, \u8fd9\u4e9b\u5143\u7d20\u9700\u8981\u552f\u4e00\u7684id , \u8fd9\u65f6\u5019\u5c31\u9700\u8981\u4f7f\u7528UUID\u4e86.","title":"1.5 uuid.uuid5(namespace,name)"},{"location":"python/lib/uuid/uuid.index/#2-pythonuuid","text":"python\u7684uuid\u6a21\u5757\u63d0\u4f9bUUID\u7c7b\u548c\u51fd\u6570uuid1(), uuid3(), uuid4(), uuid5() \u6765\u751f\u62101, 3, 4, 5\u5404\u4e2a\u7248\u672c\u7684UUID ( \u9700\u8981\u6ce8\u610f\u7684\u662f: python\u4e2d\u6ca1\u6709uuid2()\u8fd9\u4e2a\u51fd\u6570). \u5bf9uuid\u6a21\u5757\u4e2d\u6700\u5e38\u7528\u7684\u51e0\u4e2a\u51fd\u6570\u603b\u7ed3\u5982\u4e0b:","title":"2. Python\u7684uuid\u6a21\u5757"},{"location":"python/lib/uuid/uuid.index/#21-uuiduuid1node-clock_seq","text":"\u57fa\u4e8e\u65f6\u95f4\u6233 \u4f7f\u7528\u4e3b\u673aID, \u5e8f\u5217\u53f7, \u548c\u5f53\u524d\u65f6\u95f4\u6765\u751f\u6210UUID, \u53ef\u4fdd\u8bc1\u5168\u7403\u8303\u56f4\u7684\u552f\u4e00\u6027. \u4f46\u7531\u4e8e\u4f7f\u7528\u8be5\u65b9\u6cd5\u751f\u6210\u7684UUID\u4e2d\u5305\u542b\u6709\u4e3b\u673a\u7684\u7f51\u7edc\u5730\u5740, \u56e0\u6b64\u53ef\u80fd\u5371\u53ca\u9690\u79c1. \u8be5\u51fd\u6570\u6709\u4e24\u4e2a\u53c2\u6570, \u5982\u679c node \u53c2\u6570\u672a\u6307\u5b9a, \u7cfb\u7edf\u5c06\u4f1a\u81ea\u52a8\u8c03\u7528 getnode() \u51fd\u6570\u6765\u83b7\u53d6\u4e3b\u673a\u7684\u786c\u4ef6\u5730\u5740. \u5982\u679c clock_seq \u53c2\u6570\u672a\u6307\u5b9a\u7cfb\u7edf\u4f1a\u4f7f\u7528\u4e00\u4e2a\u968f\u673a\u4ea7\u751f\u768414\u4f4d\u5e8f\u5217\u53f7\u6765\u4ee3\u66ff.","title":"2.1 uuid.uuid1([node[, clock_seq]])"},{"location":"python/lib/uuid/uuid.index/#22-uuiduuid3namespace-name","text":"\u57fa\u4e8e\u540d\u5b57\u7684MD5\u6563\u5217\u503c \u901a\u8fc7\u8ba1\u7b97\u547d\u540d\u7a7a\u95f4\u548c\u540d\u5b57\u7684MD5\u6563\u5217\u503c\u6765\u751f\u6210UUID, \u53ef\u4ee5\u4fdd\u8bc1\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u4e2d\u4e0d\u540c\u540d\u5b57\u7684\u552f\u4e00\u6027\u548c\u4e0d\u540c\u547d\u540d\u7a7a\u95f4\u7684\u552f\u4e00\u6027, \u4f46\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u7684\u540c\u4e00\u540d\u5b57\u751f\u6210\u7684UUID\u76f8\u540c.","title":"2.2 uuid.uuid3(namespace, name)"},{"location":"python/lib/uuid/uuid.index/#23-uuiduuid4","text":"\u57fa\u4e8e\u968f\u673a\u6570 \u901a\u8fc7\u968f\u673a\u6570\u6765\u751f\u6210UUID. \u4f7f\u7528\u7684\u662f\u4f2a\u968f\u673a\u6570\u6709\u4e00\u5b9a\u7684\u91cd\u590d\u6982\u7387.","title":"2.3 uuid.uuid4()"},{"location":"python/lib/uuid/uuid.index/#24-uuiduuid5namespace-name","text":"\u57fa\u4e8e\u540d\u5b57\u7684SHA-1\u6563\u5217\u503c \u901a\u8fc7\u8ba1\u7b97\u547d\u540d\u7a7a\u95f4\u548c\u540d\u5b57\u7684SHA-1\u6563\u5217\u503c\u6765\u751f\u6210UUID, \u7b97\u6cd5\u4e0e uuid.uuid3() \u76f8\u540c. In [1]: import uuid # make a UUID based on the host ID and current time In [4]: uuid.uuid1() Out[4]: UUID('4894dae8-35ad-11e9-a653-7427eab0aa2c') # make a UUID using an MD5 hash of a namespace UUID and a name In [5]: uuid.uuid3(uuid.NAMESPACE_DNS, 'python.org') Out[5]: UUID('6fa459ea-ee8a-3ca4-894e-db77e160355e') # make a random UUID In [6]: uuid.uuid4() Out[6]: UUID('c86ad986-498f-4caf-901e-198076f335d6') # make a UUID using a SHA-1 hash of a namespace UUID and a name In [7]: uuid.uuid5(uuid.NAMESPACE_DNS, 'python.org') Out[7]: UUID('886313e1-3b8a-5372-9b90-0c9aee199e5d') # make a UUID from a string of hex digits (braces and hyphens ignored) In [8]: x = uuid.UUID('{00010203-0405-0607-0809-0a0b0c0d0e0f}') # convert a UUID to a string of hex digits in standard form In [9]: str(x) Out[9]: '00010203-0405-0607-0809-0a0b0c0d0e0f' # get the raw 16 bytes of the UUID In [10]: x.bytes Out[10]: b'\\x00\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\t\\n\\x0b\\x0c\\r\\x0e\\x0f' # make a UUID from a 16-byte string In [11]: uuid.UUID(bytes=x.bytes) Out[11]: UUID('00010203-0405-0607-0809-0a0b0c0d0e0f')","title":"2.4 uuid.uuid5(namespace, name)"},{"location":"python/lib/wordcloud/1.wordcloud/","text":"1. \u5b89\u88c5 \u00b6 \u82e5\u4e0b\u8f7d\u6162\uff0c\u53ef\u66f4\u6362\u5b89\u88c5\u6e90\u4e3a\u8c46\u74e3 sudo pip install --trusted-host pypi.douban.com -i http://pypi.douban.com/simple/ wordcloud 2. word cloud \u5e93\u4ecb\u7ecd \u00b6 wordcloud\u5e93\uff0c\u53ef\u4ee5\u8bf4\u662fpython\u975e\u5e38\u4f18\u79c0\u7684\u8bcd\u4e91\u5c55\u793a\u7b2c\u4e09\u65b9\u5e93\u3002\u8bcd\u4e91\u4ee5\u8bcd\u8bed\u4e3a\u57fa\u672c\u5355\u4f4d\u66f4\u52a0\u76f4\u89c2\u548c\u827a\u672f\u7684\u5c55\u793a\u6587\u672c\uff0c\u4e0b\u9762\u7ed9\u5927\u5bb6\u770b\u4e00\u4e2a\u793a\u4f8b\uff1a 2.1 \u4ecb\u7ecd \u00b6 \u63a5\u4e0b\u6765\uff0c\u4ecb\u7ecd\u4e0bwordcloud\u7684\u57fa\u672c\u4f7f\u7528\u3002wordcloud\u628a\u8bcd\u4e91\u5f53\u4f5c\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5b83\u53ef\u4ee5\u5c06\u6587\u672c\u4e2d\u8bcd\u8bed\u51fa\u73b0\u7684\u9891\u7387\u4f5c\u4e3a\u4e00\u4e2a\u53c2\u6570\u7ed8\u5236\u8bcd\u4e91\uff0c\u800c\u8bcd\u4e91\u7684\u5927\u5c0f\u3001\u989c\u8272\u3001\u5f62\u72b6\u7b49\u90fd\u662f\u53ef\u4ee5\u8bbe\u5b9a\u7684\u3002 In [5]: from wordcloud import WordCloud In [6]: W = WordCloud() 2.2 \u53c2\u6570 \u00b6 \u5728wordcloud\u4f5c\u4e3a\u5bf9\u8c61\u65f6\uff0c\u5927\u5bb6\u8981\u6ce8\u610f\u5b57\u6bcd\u7684\u5927\u5c0f\u5199\u3002 \u603b\u7684\u6765\u8bf4\uff0c\u751f\u6210\u4e00\u4e2a\u6f02\u4eae\u7684\u8bcd\u4e91\u6587\u4ef6\u4e09\u6b65\u5c31\u53ef\u4ee5\u5b8c\u6210. 1\u3001\u914d\u7f6e\u5bf9\u8c61\u53c2\u6570 2\u3001\u52a0\u8f7d\u8bcd\u4e91\u6587\u672c 3\u3001\u8f93\u51fa\u8bcd\u4e91\u6587\u4ef6 \uff08\u5982\u679c\u4e0d\u52a0\u8bf4\u660e\u9ed8\u8ba4\u7684\u56fe\u7247\u5927\u5c0f\u4e3a400 * 200\uff09 wordcloud\u7684\u5e38\u89c4\u65b9\u6cd5\u5982\u4e0b\uff1a \u65b9\u6cd5 \u63cf\u8ff0 w.generate(txt) \u5411 WordCloud\u5bf9\u8c61W\u4e2d\u52a0\u8f7d\u6587\u4ef6txt\uff0c\u4f8b\u5982 w.generate(\"Python && wordcloud\") w.to_file(filename) \u5c06\u8bcd\u4e91\u8f93\u51fa\u7684\u56fe\u50cf\u539f\u4ef6.png\u6216\u8005.jpg\u683c\u5f0f\u4fdd\u5b58 w.to_file(\"pic.png\") 2.3 \u4ee3\u7801 \u00b6 #!/usr/bin/python # _*_ coding: utf-8 _*_ from wordcloud import WordCloud w = WordCloud() # \u8bbe\u7f6e\u5bf9\u8c61 w.generate(\"I love china\") # \u52a0\u8f7d\u6587\u672c w.to_file(\"love.png\") # \u4fdd\u5b58 \u8fd0\u884c\u7ed3\u679c images/love.png<\u6587\u4ef6\u5185> 2.4 \u6ce8\u610f \u00b6 wordcloud\u505a\u8bcd\u9891\u7edf\u8ba1\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a 1\u3001\u5206\u9694\uff1a\u4ee5\u7a7a\u683c\u5206\u9694\u5355\u8bcd 2\u3001\u7edf\u8ba1 \uff1a\u5355\u8bcd\u51fa\u73b0\u7684\u6b21\u6570\u5e76\u8fc7\u6ee4 3\u3001\u5b57\u4f53\uff1a\u6839\u636e\u7edf\u8ba1\u642d\u914d\u76f8\u5e94\u7684\u5b57\u53f7 4\u3001\u5e03\u5c40 \u5e38\u7528\u7684\u53c2\u6570\u5217\u8868\u5982\u4e0b\uff1a \u65b9\u6cd5 \u63cf\u8ff0 width \u6307\u5b9a\u8bcd\u4e91\u56fe\u7247\u7684\u5bbd \u4f8b\u5982w=WordCloud(width=200) height \u6307\u5b9a\u8bcd\u4e91\u56fe\u7247\u7684\u9ad8 \u7528\u6cd5\u7528\u4e0a min_font_size \u6700\u5c0f\u5b57\u53f7 \u9ed8\u8ba4\u4e3a\u56db\u53f7 \u4f8b\u5982 w=WordCloud(min_font_size=5) max_font-size \u6700\u5927\u5b57\u53f7 \u7528\u6cd5\u7528\u4e0a font_step \u6307\u5b9a\u8bcd\u4e91\u4e2d\u8bcd\u8bed\u6b65\u8fdb\u95f4\u9694\uff0c\u9ed8\u8ba4\u4e3a1 font_path \u6307\u5b9a\u5b57\u4f53\u8def\u5f84\uff0c\u9ed8\u8ba4\u4e3a\u7a7a max_words \u6307\u5b9a\u8bcd\u4e91\u663e\u793a\u7684\u6700\u5927\u5355\u8bcd\u6570\u91cf\uff0c\u9ed8\u8ba4\u662f200 stop_words \u6307\u5b9a\u8bcd\u4e91\u4e2d\u6392\u9664\u8bcd\u5217\u8868\uff0c\u5373\u4e0d\u663e\u793a\u7684\u5355\u8bcd\u5217\u8868 mask \u6307\u5b9a\u8bcd\u4e91\u7684\u5f62\u72b6\uff0c\u9ed8\u8ba4\u4e3a\u957f\u65b9\u5f62\uff0c\u9700\u8981\u5f15\u7528imread()\u51fd\u6570 background_color \u6307\u5b9a\u56fe\u7247\u989c\u8272 Note mask \u7528\u6cd5 From scipy.misc import imread M = imread('pic.png') W = WordCloud(mask=M)","title":"1. wordcloud"},{"location":"python/lib/wordcloud/1.wordcloud/#1","text":"\u82e5\u4e0b\u8f7d\u6162\uff0c\u53ef\u66f4\u6362\u5b89\u88c5\u6e90\u4e3a\u8c46\u74e3 sudo pip install --trusted-host pypi.douban.com -i http://pypi.douban.com/simple/ wordcloud","title":"1. \u5b89\u88c5"},{"location":"python/lib/wordcloud/1.wordcloud/#2-word-cloud","text":"wordcloud\u5e93\uff0c\u53ef\u4ee5\u8bf4\u662fpython\u975e\u5e38\u4f18\u79c0\u7684\u8bcd\u4e91\u5c55\u793a\u7b2c\u4e09\u65b9\u5e93\u3002\u8bcd\u4e91\u4ee5\u8bcd\u8bed\u4e3a\u57fa\u672c\u5355\u4f4d\u66f4\u52a0\u76f4\u89c2\u548c\u827a\u672f\u7684\u5c55\u793a\u6587\u672c\uff0c\u4e0b\u9762\u7ed9\u5927\u5bb6\u770b\u4e00\u4e2a\u793a\u4f8b\uff1a","title":"2. word cloud \u5e93\u4ecb\u7ecd"},{"location":"python/lib/wordcloud/1.wordcloud/#21","text":"\u63a5\u4e0b\u6765\uff0c\u4ecb\u7ecd\u4e0bwordcloud\u7684\u57fa\u672c\u4f7f\u7528\u3002wordcloud\u628a\u8bcd\u4e91\u5f53\u4f5c\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5b83\u53ef\u4ee5\u5c06\u6587\u672c\u4e2d\u8bcd\u8bed\u51fa\u73b0\u7684\u9891\u7387\u4f5c\u4e3a\u4e00\u4e2a\u53c2\u6570\u7ed8\u5236\u8bcd\u4e91\uff0c\u800c\u8bcd\u4e91\u7684\u5927\u5c0f\u3001\u989c\u8272\u3001\u5f62\u72b6\u7b49\u90fd\u662f\u53ef\u4ee5\u8bbe\u5b9a\u7684\u3002 In [5]: from wordcloud import WordCloud In [6]: W = WordCloud()","title":"2.1 \u4ecb\u7ecd"},{"location":"python/lib/wordcloud/1.wordcloud/#22","text":"\u5728wordcloud\u4f5c\u4e3a\u5bf9\u8c61\u65f6\uff0c\u5927\u5bb6\u8981\u6ce8\u610f\u5b57\u6bcd\u7684\u5927\u5c0f\u5199\u3002 \u603b\u7684\u6765\u8bf4\uff0c\u751f\u6210\u4e00\u4e2a\u6f02\u4eae\u7684\u8bcd\u4e91\u6587\u4ef6\u4e09\u6b65\u5c31\u53ef\u4ee5\u5b8c\u6210. 1\u3001\u914d\u7f6e\u5bf9\u8c61\u53c2\u6570 2\u3001\u52a0\u8f7d\u8bcd\u4e91\u6587\u672c 3\u3001\u8f93\u51fa\u8bcd\u4e91\u6587\u4ef6 \uff08\u5982\u679c\u4e0d\u52a0\u8bf4\u660e\u9ed8\u8ba4\u7684\u56fe\u7247\u5927\u5c0f\u4e3a400 * 200\uff09 wordcloud\u7684\u5e38\u89c4\u65b9\u6cd5\u5982\u4e0b\uff1a \u65b9\u6cd5 \u63cf\u8ff0 w.generate(txt) \u5411 WordCloud\u5bf9\u8c61W\u4e2d\u52a0\u8f7d\u6587\u4ef6txt\uff0c\u4f8b\u5982 w.generate(\"Python && wordcloud\") w.to_file(filename) \u5c06\u8bcd\u4e91\u8f93\u51fa\u7684\u56fe\u50cf\u539f\u4ef6.png\u6216\u8005.jpg\u683c\u5f0f\u4fdd\u5b58 w.to_file(\"pic.png\")","title":"2.2 \u53c2\u6570"},{"location":"python/lib/wordcloud/1.wordcloud/#23","text":"#!/usr/bin/python # _*_ coding: utf-8 _*_ from wordcloud import WordCloud w = WordCloud() # \u8bbe\u7f6e\u5bf9\u8c61 w.generate(\"I love china\") # \u52a0\u8f7d\u6587\u672c w.to_file(\"love.png\") # \u4fdd\u5b58 \u8fd0\u884c\u7ed3\u679c images/love.png<\u6587\u4ef6\u5185>","title":"2.3 \u4ee3\u7801"},{"location":"python/lib/wordcloud/1.wordcloud/#24","text":"wordcloud\u505a\u8bcd\u9891\u7edf\u8ba1\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a 1\u3001\u5206\u9694\uff1a\u4ee5\u7a7a\u683c\u5206\u9694\u5355\u8bcd 2\u3001\u7edf\u8ba1 \uff1a\u5355\u8bcd\u51fa\u73b0\u7684\u6b21\u6570\u5e76\u8fc7\u6ee4 3\u3001\u5b57\u4f53\uff1a\u6839\u636e\u7edf\u8ba1\u642d\u914d\u76f8\u5e94\u7684\u5b57\u53f7 4\u3001\u5e03\u5c40 \u5e38\u7528\u7684\u53c2\u6570\u5217\u8868\u5982\u4e0b\uff1a \u65b9\u6cd5 \u63cf\u8ff0 width \u6307\u5b9a\u8bcd\u4e91\u56fe\u7247\u7684\u5bbd \u4f8b\u5982w=WordCloud(width=200) height \u6307\u5b9a\u8bcd\u4e91\u56fe\u7247\u7684\u9ad8 \u7528\u6cd5\u7528\u4e0a min_font_size \u6700\u5c0f\u5b57\u53f7 \u9ed8\u8ba4\u4e3a\u56db\u53f7 \u4f8b\u5982 w=WordCloud(min_font_size=5) max_font-size \u6700\u5927\u5b57\u53f7 \u7528\u6cd5\u7528\u4e0a font_step \u6307\u5b9a\u8bcd\u4e91\u4e2d\u8bcd\u8bed\u6b65\u8fdb\u95f4\u9694\uff0c\u9ed8\u8ba4\u4e3a1 font_path \u6307\u5b9a\u5b57\u4f53\u8def\u5f84\uff0c\u9ed8\u8ba4\u4e3a\u7a7a max_words \u6307\u5b9a\u8bcd\u4e91\u663e\u793a\u7684\u6700\u5927\u5355\u8bcd\u6570\u91cf\uff0c\u9ed8\u8ba4\u662f200 stop_words \u6307\u5b9a\u8bcd\u4e91\u4e2d\u6392\u9664\u8bcd\u5217\u8868\uff0c\u5373\u4e0d\u663e\u793a\u7684\u5355\u8bcd\u5217\u8868 mask \u6307\u5b9a\u8bcd\u4e91\u7684\u5f62\u72b6\uff0c\u9ed8\u8ba4\u4e3a\u957f\u65b9\u5f62\uff0c\u9700\u8981\u5f15\u7528imread()\u51fd\u6570 background_color \u6307\u5b9a\u56fe\u7247\u989c\u8272 Note mask \u7528\u6cd5 From scipy.misc import imread M = imread('pic.png') W = WordCloud(mask=M)","title":"2.4 \u6ce8\u610f"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/","text":"\u4e00\u3001\u5b66\u4e60 url \u00b6 yaml\u8bed\u6cd5 \u5b66\u4e60\u7f51\u7ad9 \u4e8c\u3001yaml\u8bed\u6cd5 \u00b6 1\u3001\u57fa\u672c\u89c4\u5219 \u00b6 \u5927\u5c0f\u5199\u654f\u611f \u4f7f\u7528\u7f29\u8fdb\u8868\u793a\u5c42\u7ea7\u5173\u7cfb \u7f29\u8fdb\u65f6\u4e0d\u5141\u8bb8\u4f7f\u7528Tab \uff0c\u53ea\u5141\u8bb8\u4f7f\u7528\u7a7a\u683c \u7f29\u8fdb\u7684\u7a7a\u683c\u6570\u76ee\u4e0d\u91cd\u8981\uff0c\u53ea\u8981==\u76f8\u540c\u5c42\u7ea7\u7684\u5143\u7d20\u5de6\u5bf9\u9f50\u5373\u53ef== # \u8868\u793a\u6ce8\u91ca \uff0c\u4ece\u5b83\u5f00\u59cb\u5230\u884c\u5c3e\u90fd\u88ab\u5ffd\u7565 YAML \u8fd8\u6709\u4e00\u4e2a\u5c0f\u7684\u602a\u7656. \u6240\u6709\u7684 YAML \u6587\u4ef6\u5f00\u59cb\u884c\u90fd\u5e94\u8be5\u662f ---. \u8fd9\u662f YAML \u683c\u5f0f\u7684\u4e00\u90e8\u5206, \u8868\u660e\u4e00\u4e2a\u6587\u4ef6\u7684\u5f00\u59cb. \u5217\u8868\u4e2d\u7684\u6240\u6709\u6210\u5458\u90fd\u5f00\u59cb\u4e8e\u76f8\u540c\u7684\u7f29\u8fdb\u7ea7\u522b, \u5e76\u4e14\u4f7f\u7528\u4e00\u4e2a \"- \" \u4f5c\u4e3a\u5f00\u5934(\u4e00\u4e2a\u6a2a\u6760\u548c\u4e00\u4e2a\u7a7a\u683c) 2\u3001yaml\u8f6c\u5b57\u5178 \u00b6 yaml\u4e2d\u652f\u6301\u6620\u5c04\u6216\u5b57\u5178\u7684\u8868\u793a\uff0c\u5982\u4e0b\uff1a # \u4e0b\u9762\u683c\u5f0f\u8bfb\u5230Python\u91cc\u4f1a\u662f\u4e2adict name: \u7070\u84dd age: 0 job: Tester \u8f38\u51fa {'name': '\u7070\u84dd', 'age': 0, 'job': 'Tester'} 3\u3001yaml\u8f6c\u5217\u8868 \u00b6 yaml\u4e2d\u652f\u6301\u5217\u8868\u6216\u6570\u7ec4\u7684\u8868\u793a\uff0c\u5982\u4e0b\uff1a # \u4e0b\u9762\u683c\u5f0f\u8bfb\u5230Python\u91cc\u4f1a\u662f\u4e2alist - \u7070\u84dd - 0 - Tester \u8f38\u51fa ['\u7070\u84dd', 0, 'Tester'] 4\u3001\u590d\u5408\u7ed3\u6784 \u00b6 \u5b57\u5178\u548c\u5217\u8868\u53ef\u4ee5\u590d\u5408\u8d77\u6765\u4f7f\u7528\uff0c\u5982\u4e0b\uff1a # \u4e0b\u9762\u683c\u5f0f\u8bfb\u5230Python\u91cc\u662f\u4e2alist\u91cc\u5305\u542bdict - name: \u7070\u84dd age: 0 job: Tester - name: James age: 30 \u8f93\u51fa\uff1a [{'name': '\u7070\u84dd', 'age': 0, 'job': 'Tester'}, {'name': 'James', 'age': 30}] 5\u3001\u57fa\u672c\u7c7b\u578b \u00b6 yaml\u4e2d\u6709\u4ee5\u4e0b\u57fa\u672c\u7c7b\u578b\uff1a 1 \u5b57\u7b26\u4e32 2 \u6574\u578b 3 \u6d6e\u70b9\u578b 4 \u5e03\u5c14\u578b 5 null 6 \u65f6\u95f4 7 \u65e5\u671f \u6211\u4eec\u5199\u4e2a\u4f8b\u5b50\u6765\u770b\u4e0b\uff1a # \u8fd9\u4e2a\u4f8b\u5b50\u8f93\u51fa\u4e00\u4e2a\u5b57\u5178\uff0c\u5176\u4e2dvalue\u5305\u62ec\u6240\u6709\u57fa\u672c\u7c7b\u578b str: \"Hello World!\" int: 110 float: 3.141 boolean: true # or false None: null # \u4e5f\u53ef\u4ee5\u7528 ~ \u53f7\u6765\u8868\u793a null time: 2016-09-22t11:43:30.20+08:00 # ISO8601\uff0c\u5199\u6cd5\u767e\u5ea6 date: 2016-09-22 # \u540c\u6837ISO8601 \u8f38\u51fa {'str': 'Hello World!', 'int': 110, 'float': 3.141, 'boolean': True, 'None': None, 'time': datetime.datetime(2016, 9, 22, 3, 43, 30, 200000), 'date': datetime.date(2016, 9, 22)} json\u683c\u5f0f\u5316\u540e { 'str': 'Hello World!', 'int': 110, 'float': 3.141, 'boolean': True, 'None': None, 'time': datetime.datetime(2016, 9, 22, 3, 43, 30, 200000), 'date': datetime.date(2016, 9, 22) } \u5982\u679c\u5b57\u7b26\u4e32\u6ca1\u6709\u7a7a\u683c\u6216\u7279\u6b8a\u5b57\u7b26\uff0c\u4e0d\u9700\u8981\u52a0\u5f15\u53f7\uff0c\u4f46\u5982\u679c\u5176\u4e2d\u6709\u7a7a\u683c\u6216\u7279\u6b8a\u5b57\u7b26\uff0c\u5219\u9700\u8981\u52a0\u5f15\u53f7\u4e86 str: \u7070\u84dd str1: \"Hello World\" str2: \"Hello\\nWorld\" \u8f38\u51fa {'str': '\u7070\u84dd', 'str1': 'Hello World', 'str2': 'Hello\\nWorld'} \u8fd9\u91cc\u8981\u6ce8\u610f\u5355\u5f15\u53f7\u548c\u53cc\u5f15\u53f7\u7684\u533a\u522b\uff0c\u5355\u5f15\u53f7\u4e2d\u7684\u7279\u6b8a\u5b57\u7b26\u8f6c\u5230Python\u4f1a\u88ab\u8f6c\u4e49\uff0c\u4e5f\u5c31\u662f\u5230\u6700\u540e\u662f\u539f\u6837\u8f93\u51fa\u4e86\uff0c\u53cc\u5f15\u53f7\u4e0d\u4f1a\u88abPython\u8f6c\u4e49\uff0c\u5230\u6700\u540e\u662f\u8f93\u51fa\u4e86\u7279\u6b8a\u5b57\u7b26\uff1b\u5982\uff1a str1: 'Hello\\nWorld' str2: \"Hello\\nWorld\" \u8f38\u51fa {'str1': 'Hello\\\\nWorld', 'str2': 'Hello\\nWorld'} \u53ef\u4ee5\u770b\u5230\uff0c\u5355\u5f15\u53f7\u4e2d\u7684\u2019\\n\u2019\u6700\u540e\u662f\u8f93\u51fa\u4e86\uff0c\u53cc\u5f15\u53f7\u4e2d\u7684\u2019\\n\u2019\u6700\u540e\u662f\u8f6c\u4e49\u6210\u4e86\u56de\u8f66 6\u3001\u5f15\u7528 \u00b6 & \u548c * \u7528\u4e8e\u5f15\u7528 name: &name \u7070\u84dd tester: *name \u8fd9\u4e2a\u76f8\u5f53\u4e8e\u4e00\u4e0b\u811a\u672c\uff1a name: \u7070\u84dd tester: \u7070\u84dd \u8f93\u51fa\uff1a {'name': '\u7070\u84dd', 'tester': '\u7070\u84dd'} 7\u3001\u5f3a\u5236\u8f6c\u6362 \u00b6 yaml\u662f\u53ef\u4ee5\u8fdb\u884c\u5f3a\u5236\u8f6c\u6362\u7684\uff0c\u7528 !! \u5b9e\u73b0\uff0c\u5982\u4e0b\uff1a str: !!str 3.14 int: !!int \"123\" \u8f93\u51fa\uff1a {'int': 123, 'str': '3.14'} \u660e\u663e\u80fd\u591f\u770b\u51fa123\u88ab\u5f3a\u8f6c\u6210\u4e86int\u7c7b\u578b\uff0c\u800cfloat\u578b\u76843.14\u5219\u88ab\u5f3a\u8f6c\u6210\u4e86str\u578b\u3002 8\u3001\u5206\u6bb5 \u00b6 \u5728\u540c\u4e00\u4e2ayaml\u6587\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u7528 \u2014 \u6765\u5206\u6bb5\uff0c\u8fd9\u6837\u53ef\u4ee5\u5c06\u591a\u4e2a\u6587\u6863\u5199\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d --- name: James age: 20 --- name: Lily age: 19 \u4e09\u3001\u6784\u9020\u5668(constructors)\u3001\u8868\u793a\u5668(representers)\u3001\u89e3\u6790\u5668(resolvers ) \u00b6 1\u3001yaml.YAMLObject \u00b6 yaml.YAMLObject\u7528\u5143\u7c7b\u6765\u6ce8\u518c\u4e00\u4e2a\u6784\u9020\u5668\uff08\u4e5f\u5c31\u662f\u4ee3\u7801\u91cc\u7684 init() \u65b9\u6cd5\uff09\uff0c\u8ba9\u4f60\u628ayaml\u8282\u70b9\u8f6c\u4e3aPython\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u7528\u8868\u793a\u5668\uff08\u4e5f\u5c31\u662f\u4ee3\u7801\u91cc\u7684 repr() \u51fd\u6570\uff09\u6765\u8ba9\u4f60\u628aPython\u5bf9\u8c61\u8f6c\u4e3ayaml\u8282\u70b9\uff0c\u770b\u4ee3\u7801\uff1a import yaml class Person(yaml.YAMLObject): yaml_tag = '!person' def __init__(self, name, age): self.name = name self.age = age def __repr__(self): return '%s(name=%s, age=%d)' % (self.__class__.__name__, self.name, self.age) james = Person('James', 20) print (yaml.dump(james)) # Python\u5bf9\u8c61\u5b9e\u4f8b\u8f6c\u4e3ayaml lily = yaml.load('!person {name: Lily, age: 19}') print (lily) # yaml\u8f6c\u4e3aPython\u5bf9\u8c61\u5b9e\u4f8b \u8f93\u51fa !person {age: 20, name: James} Person(name=Lily, age=19) 2\u3001yaml.add_constructor \u548c yaml.add_representer \u00b6 \u4f60\u53ef\u80fd\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u5e76\u4e0d\u60f3\u901a\u8fc7\u4e0a\u9762\u8fd9\u79cd\u5143\u7c7b\u7684\u65b9\u5f0f\uff0c\u800c\u662f\u60f3\u5b9a\u4e49\u6b63\u5e38\u7684\u7c7b\uff0c\u90a3\u4e48\uff0c\u53ef\u4ee5\u7528\u8fd9\u4e24\u79cd\u65b9\u6cd5 import yaml class Person(object): def __init__(self, name, age): self.name = name self.age = age def __repr__(self): return 'Person(%s, %s)' % (self.name, self.age) james = Person('James', 20) print (yaml.dump(james)) # \u6ca1\u52a0\u8868\u793a\u5668\u4e4b\u524d def person_repr(dumper, data): return dumper.represent_mapping(u'!person', {\"name\": data.name, \"age\": data.age}) # mapping\u8868\u793a\u5668\uff0c\u7528\u4e8edict yaml.add_representer(Person, person_repr) # \u7528add_representer\u65b9\u6cd5\u4e3a\u5bf9\u8c61\u6dfb\u52a0\u8868\u793a\u5668 print (yaml.dump(james)) # \u52a0\u4e86\u8868\u793a\u5668\u4e4b\u540e \u8f93\u51fa Note \u7b2c\u4e00\u884c\u662f\u6ca1\u52a0\u8868\u793a\u5668\u4e4b\u524d\uff0c\u591a\u4e11\uff01\u4e2d\u95f4\u90a3\u884c\u662f\u52a0\u4e86\u8868\u793a\u5668\u4e4b\u540e\uff0c\u53d8\u6210\u4e86\u89c4\u8303\u7684\u683c\u5f0f\uff0c\u4e0b\u9762\u6dfb\u52a0\u4e86\u6784\u9020\u5668\uff0c\u80fd\u591f\u628a !person \u6807\u7b7e\u8f6c\u5316\u4e3aPerson\u5bf9\u8c61\u3002 \u56db\u3001\u793a\u4f8b \u00b6 yaml\u662f\u4e00\u79cd\u5f88\u6e05\u6670\u3001\u7b80\u6d01\u7684\u683c\u5f0f\uff0c\u800c\u4e14\u8ddfPython\u975e\u5e38\u5408\u62cd\uff0c\u975e\u5e38\u5bb9\u6613\u64cd\u4f5c\uff0c\u6211\u4eec\u5728\u642d\u5efa\u81ea\u52a8\u5316\u6d4b\u8bd5\u6846\u67b6\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u91c7\u7528yaml\u4f5c\u4e3a\u914d\u7f6e\u6587\u4ef6\uff0c\u6216\u8005\u7528\u4f8b\u6587\u4ef6\uff0c\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e2a\u7528\u4f8b\u7684\u793a\u4f8b # Test using included Django test app # First install python-django # Then launch the app in another terminal by doing # cd testapp # python manage.py testserver test_data.json # Once launched, tests can be executed via: # python resttest.py http://localhost:8000 miniapp-test.yaml --- - config: - testset: \"Tests using test app\" - test: # create entity - name: \"Basic get\" - url: \"/api/person/\" - test: # create entity - name: \"Get single person\" - url: \"/api/person/1/\" - test: # create entity - name: \"Get single person\" - url: \"/api/person/1/\" - method: 'DELETE' - test: # create entity by PUT - name: \"Create/update person\" - url: \"/api/person/1/\" - method: \"PUT\" - body: '{\"first_name\": \"Gaius\",\"id\": 1,\"last_name\": \"Baltar\",\"login\": \"gbaltar\"}' - headers: {'Content-Type': 'application/json'} - test: # create entity by POST - name: \"Create person\" - url: \"/api/person/\" - method: \"POST\" - body: '{\"first_name\": \"Willim\",\"last_name\": \"Adama\",\"login\": \"theadmiral\"}' - headers: {Content-Type: application/json}","title":"1. yaml\u8bed\u6cd5"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/#url","text":"yaml\u8bed\u6cd5 \u5b66\u4e60\u7f51\u7ad9","title":"\u4e00\u3001\u5b66\u4e60 url"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/#yaml","text":"","title":"\u4e8c\u3001yaml\u8bed\u6cd5"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/#1","text":"\u5927\u5c0f\u5199\u654f\u611f \u4f7f\u7528\u7f29\u8fdb\u8868\u793a\u5c42\u7ea7\u5173\u7cfb \u7f29\u8fdb\u65f6\u4e0d\u5141\u8bb8\u4f7f\u7528Tab \uff0c\u53ea\u5141\u8bb8\u4f7f\u7528\u7a7a\u683c \u7f29\u8fdb\u7684\u7a7a\u683c\u6570\u76ee\u4e0d\u91cd\u8981\uff0c\u53ea\u8981==\u76f8\u540c\u5c42\u7ea7\u7684\u5143\u7d20\u5de6\u5bf9\u9f50\u5373\u53ef== # \u8868\u793a\u6ce8\u91ca \uff0c\u4ece\u5b83\u5f00\u59cb\u5230\u884c\u5c3e\u90fd\u88ab\u5ffd\u7565 YAML \u8fd8\u6709\u4e00\u4e2a\u5c0f\u7684\u602a\u7656. \u6240\u6709\u7684 YAML \u6587\u4ef6\u5f00\u59cb\u884c\u90fd\u5e94\u8be5\u662f ---. \u8fd9\u662f YAML \u683c\u5f0f\u7684\u4e00\u90e8\u5206, \u8868\u660e\u4e00\u4e2a\u6587\u4ef6\u7684\u5f00\u59cb. \u5217\u8868\u4e2d\u7684\u6240\u6709\u6210\u5458\u90fd\u5f00\u59cb\u4e8e\u76f8\u540c\u7684\u7f29\u8fdb\u7ea7\u522b, \u5e76\u4e14\u4f7f\u7528\u4e00\u4e2a \"- \" \u4f5c\u4e3a\u5f00\u5934(\u4e00\u4e2a\u6a2a\u6760\u548c\u4e00\u4e2a\u7a7a\u683c)","title":"1\u3001\u57fa\u672c\u89c4\u5219"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/#2yaml","text":"yaml\u4e2d\u652f\u6301\u6620\u5c04\u6216\u5b57\u5178\u7684\u8868\u793a\uff0c\u5982\u4e0b\uff1a # \u4e0b\u9762\u683c\u5f0f\u8bfb\u5230Python\u91cc\u4f1a\u662f\u4e2adict name: \u7070\u84dd age: 0 job: Tester \u8f38\u51fa {'name': '\u7070\u84dd', 'age': 0, 'job': 'Tester'}","title":"2\u3001yaml\u8f6c\u5b57\u5178"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/#3yaml","text":"yaml\u4e2d\u652f\u6301\u5217\u8868\u6216\u6570\u7ec4\u7684\u8868\u793a\uff0c\u5982\u4e0b\uff1a # \u4e0b\u9762\u683c\u5f0f\u8bfb\u5230Python\u91cc\u4f1a\u662f\u4e2alist - \u7070\u84dd - 0 - Tester \u8f38\u51fa ['\u7070\u84dd', 0, 'Tester']","title":"3\u3001yaml\u8f6c\u5217\u8868"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/#4","text":"\u5b57\u5178\u548c\u5217\u8868\u53ef\u4ee5\u590d\u5408\u8d77\u6765\u4f7f\u7528\uff0c\u5982\u4e0b\uff1a # \u4e0b\u9762\u683c\u5f0f\u8bfb\u5230Python\u91cc\u662f\u4e2alist\u91cc\u5305\u542bdict - name: \u7070\u84dd age: 0 job: Tester - name: James age: 30 \u8f93\u51fa\uff1a [{'name': '\u7070\u84dd', 'age': 0, 'job': 'Tester'}, {'name': 'James', 'age': 30}]","title":"4\u3001\u590d\u5408\u7ed3\u6784"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/#5","text":"yaml\u4e2d\u6709\u4ee5\u4e0b\u57fa\u672c\u7c7b\u578b\uff1a 1 \u5b57\u7b26\u4e32 2 \u6574\u578b 3 \u6d6e\u70b9\u578b 4 \u5e03\u5c14\u578b 5 null 6 \u65f6\u95f4 7 \u65e5\u671f \u6211\u4eec\u5199\u4e2a\u4f8b\u5b50\u6765\u770b\u4e0b\uff1a # \u8fd9\u4e2a\u4f8b\u5b50\u8f93\u51fa\u4e00\u4e2a\u5b57\u5178\uff0c\u5176\u4e2dvalue\u5305\u62ec\u6240\u6709\u57fa\u672c\u7c7b\u578b str: \"Hello World!\" int: 110 float: 3.141 boolean: true # or false None: null # \u4e5f\u53ef\u4ee5\u7528 ~ \u53f7\u6765\u8868\u793a null time: 2016-09-22t11:43:30.20+08:00 # ISO8601\uff0c\u5199\u6cd5\u767e\u5ea6 date: 2016-09-22 # \u540c\u6837ISO8601 \u8f38\u51fa {'str': 'Hello World!', 'int': 110, 'float': 3.141, 'boolean': True, 'None': None, 'time': datetime.datetime(2016, 9, 22, 3, 43, 30, 200000), 'date': datetime.date(2016, 9, 22)} json\u683c\u5f0f\u5316\u540e { 'str': 'Hello World!', 'int': 110, 'float': 3.141, 'boolean': True, 'None': None, 'time': datetime.datetime(2016, 9, 22, 3, 43, 30, 200000), 'date': datetime.date(2016, 9, 22) } \u5982\u679c\u5b57\u7b26\u4e32\u6ca1\u6709\u7a7a\u683c\u6216\u7279\u6b8a\u5b57\u7b26\uff0c\u4e0d\u9700\u8981\u52a0\u5f15\u53f7\uff0c\u4f46\u5982\u679c\u5176\u4e2d\u6709\u7a7a\u683c\u6216\u7279\u6b8a\u5b57\u7b26\uff0c\u5219\u9700\u8981\u52a0\u5f15\u53f7\u4e86 str: \u7070\u84dd str1: \"Hello World\" str2: \"Hello\\nWorld\" \u8f38\u51fa {'str': '\u7070\u84dd', 'str1': 'Hello World', 'str2': 'Hello\\nWorld'} \u8fd9\u91cc\u8981\u6ce8\u610f\u5355\u5f15\u53f7\u548c\u53cc\u5f15\u53f7\u7684\u533a\u522b\uff0c\u5355\u5f15\u53f7\u4e2d\u7684\u7279\u6b8a\u5b57\u7b26\u8f6c\u5230Python\u4f1a\u88ab\u8f6c\u4e49\uff0c\u4e5f\u5c31\u662f\u5230\u6700\u540e\u662f\u539f\u6837\u8f93\u51fa\u4e86\uff0c\u53cc\u5f15\u53f7\u4e0d\u4f1a\u88abPython\u8f6c\u4e49\uff0c\u5230\u6700\u540e\u662f\u8f93\u51fa\u4e86\u7279\u6b8a\u5b57\u7b26\uff1b\u5982\uff1a str1: 'Hello\\nWorld' str2: \"Hello\\nWorld\" \u8f38\u51fa {'str1': 'Hello\\\\nWorld', 'str2': 'Hello\\nWorld'} \u53ef\u4ee5\u770b\u5230\uff0c\u5355\u5f15\u53f7\u4e2d\u7684\u2019\\n\u2019\u6700\u540e\u662f\u8f93\u51fa\u4e86\uff0c\u53cc\u5f15\u53f7\u4e2d\u7684\u2019\\n\u2019\u6700\u540e\u662f\u8f6c\u4e49\u6210\u4e86\u56de\u8f66","title":"5\u3001\u57fa\u672c\u7c7b\u578b"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/#6","text":"& \u548c * \u7528\u4e8e\u5f15\u7528 name: &name \u7070\u84dd tester: *name \u8fd9\u4e2a\u76f8\u5f53\u4e8e\u4e00\u4e0b\u811a\u672c\uff1a name: \u7070\u84dd tester: \u7070\u84dd \u8f93\u51fa\uff1a {'name': '\u7070\u84dd', 'tester': '\u7070\u84dd'}","title":"6\u3001\u5f15\u7528"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/#7","text":"yaml\u662f\u53ef\u4ee5\u8fdb\u884c\u5f3a\u5236\u8f6c\u6362\u7684\uff0c\u7528 !! \u5b9e\u73b0\uff0c\u5982\u4e0b\uff1a str: !!str 3.14 int: !!int \"123\" \u8f93\u51fa\uff1a {'int': 123, 'str': '3.14'} \u660e\u663e\u80fd\u591f\u770b\u51fa123\u88ab\u5f3a\u8f6c\u6210\u4e86int\u7c7b\u578b\uff0c\u800cfloat\u578b\u76843.14\u5219\u88ab\u5f3a\u8f6c\u6210\u4e86str\u578b\u3002","title":"7\u3001\u5f3a\u5236\u8f6c\u6362"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/#8","text":"\u5728\u540c\u4e00\u4e2ayaml\u6587\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u7528 \u2014 \u6765\u5206\u6bb5\uff0c\u8fd9\u6837\u53ef\u4ee5\u5c06\u591a\u4e2a\u6587\u6863\u5199\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d --- name: James age: 20 --- name: Lily age: 19","title":"8\u3001\u5206\u6bb5"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/#constructorsrepresentersresolvers","text":"","title":"\u4e09\u3001\u6784\u9020\u5668(constructors)\u3001\u8868\u793a\u5668(representers)\u3001\u89e3\u6790\u5668(resolvers )"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/#1yamlyamlobject","text":"yaml.YAMLObject\u7528\u5143\u7c7b\u6765\u6ce8\u518c\u4e00\u4e2a\u6784\u9020\u5668\uff08\u4e5f\u5c31\u662f\u4ee3\u7801\u91cc\u7684 init() \u65b9\u6cd5\uff09\uff0c\u8ba9\u4f60\u628ayaml\u8282\u70b9\u8f6c\u4e3aPython\u5bf9\u8c61\u5b9e\u4f8b\uff0c\u7528\u8868\u793a\u5668\uff08\u4e5f\u5c31\u662f\u4ee3\u7801\u91cc\u7684 repr() \u51fd\u6570\uff09\u6765\u8ba9\u4f60\u628aPython\u5bf9\u8c61\u8f6c\u4e3ayaml\u8282\u70b9\uff0c\u770b\u4ee3\u7801\uff1a import yaml class Person(yaml.YAMLObject): yaml_tag = '!person' def __init__(self, name, age): self.name = name self.age = age def __repr__(self): return '%s(name=%s, age=%d)' % (self.__class__.__name__, self.name, self.age) james = Person('James', 20) print (yaml.dump(james)) # Python\u5bf9\u8c61\u5b9e\u4f8b\u8f6c\u4e3ayaml lily = yaml.load('!person {name: Lily, age: 19}') print (lily) # yaml\u8f6c\u4e3aPython\u5bf9\u8c61\u5b9e\u4f8b \u8f93\u51fa !person {age: 20, name: James} Person(name=Lily, age=19)","title":"1\u3001yaml.YAMLObject"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/#2yamladd_constructor-yamladd_representer","text":"\u4f60\u53ef\u80fd\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u5e76\u4e0d\u60f3\u901a\u8fc7\u4e0a\u9762\u8fd9\u79cd\u5143\u7c7b\u7684\u65b9\u5f0f\uff0c\u800c\u662f\u60f3\u5b9a\u4e49\u6b63\u5e38\u7684\u7c7b\uff0c\u90a3\u4e48\uff0c\u53ef\u4ee5\u7528\u8fd9\u4e24\u79cd\u65b9\u6cd5 import yaml class Person(object): def __init__(self, name, age): self.name = name self.age = age def __repr__(self): return 'Person(%s, %s)' % (self.name, self.age) james = Person('James', 20) print (yaml.dump(james)) # \u6ca1\u52a0\u8868\u793a\u5668\u4e4b\u524d def person_repr(dumper, data): return dumper.represent_mapping(u'!person', {\"name\": data.name, \"age\": data.age}) # mapping\u8868\u793a\u5668\uff0c\u7528\u4e8edict yaml.add_representer(Person, person_repr) # \u7528add_representer\u65b9\u6cd5\u4e3a\u5bf9\u8c61\u6dfb\u52a0\u8868\u793a\u5668 print (yaml.dump(james)) # \u52a0\u4e86\u8868\u793a\u5668\u4e4b\u540e \u8f93\u51fa Note \u7b2c\u4e00\u884c\u662f\u6ca1\u52a0\u8868\u793a\u5668\u4e4b\u524d\uff0c\u591a\u4e11\uff01\u4e2d\u95f4\u90a3\u884c\u662f\u52a0\u4e86\u8868\u793a\u5668\u4e4b\u540e\uff0c\u53d8\u6210\u4e86\u89c4\u8303\u7684\u683c\u5f0f\uff0c\u4e0b\u9762\u6dfb\u52a0\u4e86\u6784\u9020\u5668\uff0c\u80fd\u591f\u628a !person \u6807\u7b7e\u8f6c\u5316\u4e3aPerson\u5bf9\u8c61\u3002","title":"2\u3001yaml.add_constructor \u548c yaml.add_representer"},{"location":"python/lib/yaml/1.yaml\u8bed\u6cd5/#_1","text":"yaml\u662f\u4e00\u79cd\u5f88\u6e05\u6670\u3001\u7b80\u6d01\u7684\u683c\u5f0f\uff0c\u800c\u4e14\u8ddfPython\u975e\u5e38\u5408\u62cd\uff0c\u975e\u5e38\u5bb9\u6613\u64cd\u4f5c\uff0c\u6211\u4eec\u5728\u642d\u5efa\u81ea\u52a8\u5316\u6d4b\u8bd5\u6846\u67b6\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u91c7\u7528yaml\u4f5c\u4e3a\u914d\u7f6e\u6587\u4ef6\uff0c\u6216\u8005\u7528\u4f8b\u6587\u4ef6\uff0c\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e2a\u7528\u4f8b\u7684\u793a\u4f8b # Test using included Django test app # First install python-django # Then launch the app in another terminal by doing # cd testapp # python manage.py testserver test_data.json # Once launched, tests can be executed via: # python resttest.py http://localhost:8000 miniapp-test.yaml --- - config: - testset: \"Tests using test app\" - test: # create entity - name: \"Basic get\" - url: \"/api/person/\" - test: # create entity - name: \"Get single person\" - url: \"/api/person/1/\" - test: # create entity - name: \"Get single person\" - url: \"/api/person/1/\" - method: 'DELETE' - test: # create entity by PUT - name: \"Create/update person\" - url: \"/api/person/1/\" - method: \"PUT\" - body: '{\"first_name\": \"Gaius\",\"id\": 1,\"last_name\": \"Baltar\",\"login\": \"gbaltar\"}' - headers: {'Content-Type': 'application/json'} - test: # create entity by POST - name: \"Create person\" - url: \"/api/person/\" - method: \"POST\" - body: '{\"first_name\": \"Willim\",\"last_name\": \"Adama\",\"login\": \"theadmiral\"}' - headers: {Content-Type: application/json}","title":"\u56db\u3001\u793a\u4f8b"},{"location":"python/lib/yaml/2.yaml\u4f7f\u7528/","text":"\u5b89\u88c5 \u00b6 pip install PyYAML YAML\u662f\u4e00\u79cd\u76f4\u89c2\u7684\u80fd\u591f\u88ab\u7535\u8111\u8bc6\u522b\u7684\u7684\u6570\u636e\u5e8f\u5217\u5316\u683c\u5f0f\uff0c\u5bb9\u6613\u88ab\u4eba\u7c7b\u9605\u8bfb\uff0c\u5e76\u4e14\u5bb9\u6613\u548c\u811a\u672c\u8bed\u8a00\u4ea4\u4e92\u3002YAML\u7c7b\u4f3c\u4e8eXML\uff0c\u4f46\u662f\u8bed\u6cd5\u6bd4XML\u7b80\u5355\u5f97\u591a\uff0c\u5bf9\u4e8e\u8f6c\u5316\u6210\u6570\u7ec4\u6216\u53ef\u4ee5hash\u7684\u6570\u636e\u65f6\u662f\u5f88\u7b80\u5355\u6709\u6548\u7684\u3002 1\u3001PyYaml \u00b6 1.1\u3001load() :\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61 \u00b6 \u6211\u4eec\u5148\u521b\u5efa\u4e00\u4e2ayml\u6587\u4ef6\uff0cconfig.yml: name: Tom Smith age: 37 spouse: name: Jane Smith age: 25 children: - name: Jimmy Smith age: 15 - name1: Jenny Smith age1: 12 1.2\u3001\u8bfb\u53d6yml\u6587\u4ef6\uff1a \u00b6 import yaml f = open('config.yml') y = yaml.load(f) print(y) \u8f93\u51fa {'name': 'Tom Smith', 'age': 37, 'spouse': {'name': 'Jane Smith', 'age': 25}, 'children': [{'name': 'Jimmy Smith', 'age': 15}, {'name1': 'Jenny Smith', 'age1': 12}]} json\u683c\u5f0f\u5316\u540e { 'name': 'Tom Smith', 'age': 37, 'spouse': { 'name': 'Jane Smith', 'age': 25 }, 'children': [{ 'name': 'Jimmy Smith', 'age': 15 }, { 'name1': 'Jenny Smith', 'age1': 12 }] } 2\u3001load_all()\u751f\u6210\u4e00\u4e2a\u8fed\u4ee3\u5668 \u00b6 \u5982\u679cstring\u6216\u6587\u4ef6\u5305\u542b\u51e0\u5757yaml\u6587\u6863\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528yaml.load_all\u6765\u89e3\u6790\u5168\u90e8\u7684\u6587\u6863\u3002 import yaml f = ''' --- name: James age: 20 --- name: Lily age: 19 ''' y = yaml.load_all(f) for data in y: print(data) \u8fd0\u884c\u7ed3\u679c {'name': 'James', 'age': 20} {'name': 'Lily', 'age': 19} 3\u3001yaml.dump \u5c06\u4e00\u4e2apython\u5bf9\u8c61\u751f\u6210\u4e3ayaml\u6587\u6863 \u00b6 import yaml aproject = {'name': 'Silenthand Olleander', 'race': 'Human', 'traits': ['ONE_HAND', 'ONE_EYE'] } print(yaml.dump(aproject)) \u8fd0\u884c\u7ed3\u679c name: Silenthand Olleander race: Human traits: [ONE_HAND, ONE_EYE] yaml.dump\u63a5\u6536\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e00\u5b9a\u8981\u662f\u4e00\u4e2a\u6253\u5f00\u7684\u6587\u672c\u6587\u4ef6\u6216\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0cyaml.dump\u4f1a\u628a\u751f\u6210\u7684yaml\u6587\u6863\u5199\u5230\u6587\u4ef6\u91cc import yaml aproject = {'name': 'Silenthand Olleander', 'race': 'Human', 'traits': ['ONE_HAND', 'ONE_EYE'] } f = open(r'config1.yml', 'w') print(yaml.dump(aproject, f)) \u8fd0\u884c\u540e\u6094\u4ea7\u751f\u4e00\u4e2a\u6587\u4ef6config1.yml \u5185\u5bb9 name: Silenthand Olleander race: Human traits: [ONE_HAND, ONE_EYE] 4\u3001yaml.dump_all()\u5c06\u591a\u4e2a\u6bb5\u8f93\u51fa\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d \u00b6 import yaml obj1 = {\"name\": \"James\", \"age\": 20} obj2 = [\"Lily\", 19] with open('config2.yml', 'w') as f: yaml.dump_all([obj1, obj2], f) \u6267\u884c\u540e\uff0c\u4ea7\u751fconfig2.yml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a {age: 20, name: James} --- [Lily, 19]","title":"2. yaml\u4f7f\u7528"},{"location":"python/lib/yaml/2.yaml\u4f7f\u7528/#_1","text":"pip install PyYAML YAML\u662f\u4e00\u79cd\u76f4\u89c2\u7684\u80fd\u591f\u88ab\u7535\u8111\u8bc6\u522b\u7684\u7684\u6570\u636e\u5e8f\u5217\u5316\u683c\u5f0f\uff0c\u5bb9\u6613\u88ab\u4eba\u7c7b\u9605\u8bfb\uff0c\u5e76\u4e14\u5bb9\u6613\u548c\u811a\u672c\u8bed\u8a00\u4ea4\u4e92\u3002YAML\u7c7b\u4f3c\u4e8eXML\uff0c\u4f46\u662f\u8bed\u6cd5\u6bd4XML\u7b80\u5355\u5f97\u591a\uff0c\u5bf9\u4e8e\u8f6c\u5316\u6210\u6570\u7ec4\u6216\u53ef\u4ee5hash\u7684\u6570\u636e\u65f6\u662f\u5f88\u7b80\u5355\u6709\u6548\u7684\u3002","title":"\u5b89\u88c5"},{"location":"python/lib/yaml/2.yaml\u4f7f\u7528/#1pyyaml","text":"","title":"1\u3001PyYaml"},{"location":"python/lib/yaml/2.yaml\u4f7f\u7528/#11load","text":"\u6211\u4eec\u5148\u521b\u5efa\u4e00\u4e2ayml\u6587\u4ef6\uff0cconfig.yml: name: Tom Smith age: 37 spouse: name: Jane Smith age: 25 children: - name: Jimmy Smith age: 15 - name1: Jenny Smith age1: 12","title":"1.1\u3001load() :\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61"},{"location":"python/lib/yaml/2.yaml\u4f7f\u7528/#12yml","text":"import yaml f = open('config.yml') y = yaml.load(f) print(y) \u8f93\u51fa {'name': 'Tom Smith', 'age': 37, 'spouse': {'name': 'Jane Smith', 'age': 25}, 'children': [{'name': 'Jimmy Smith', 'age': 15}, {'name1': 'Jenny Smith', 'age1': 12}]} json\u683c\u5f0f\u5316\u540e { 'name': 'Tom Smith', 'age': 37, 'spouse': { 'name': 'Jane Smith', 'age': 25 }, 'children': [{ 'name': 'Jimmy Smith', 'age': 15 }, { 'name1': 'Jenny Smith', 'age1': 12 }] }","title":"1.2\u3001\u8bfb\u53d6yml\u6587\u4ef6\uff1a"},{"location":"python/lib/yaml/2.yaml\u4f7f\u7528/#2load_all","text":"\u5982\u679cstring\u6216\u6587\u4ef6\u5305\u542b\u51e0\u5757yaml\u6587\u6863\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528yaml.load_all\u6765\u89e3\u6790\u5168\u90e8\u7684\u6587\u6863\u3002 import yaml f = ''' --- name: James age: 20 --- name: Lily age: 19 ''' y = yaml.load_all(f) for data in y: print(data) \u8fd0\u884c\u7ed3\u679c {'name': 'James', 'age': 20} {'name': 'Lily', 'age': 19}","title":"2\u3001load_all()\u751f\u6210\u4e00\u4e2a\u8fed\u4ee3\u5668"},{"location":"python/lib/yaml/2.yaml\u4f7f\u7528/#3yamldump-pythonyaml","text":"import yaml aproject = {'name': 'Silenthand Olleander', 'race': 'Human', 'traits': ['ONE_HAND', 'ONE_EYE'] } print(yaml.dump(aproject)) \u8fd0\u884c\u7ed3\u679c name: Silenthand Olleander race: Human traits: [ONE_HAND, ONE_EYE] yaml.dump\u63a5\u6536\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e00\u5b9a\u8981\u662f\u4e00\u4e2a\u6253\u5f00\u7684\u6587\u672c\u6587\u4ef6\u6216\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0cyaml.dump\u4f1a\u628a\u751f\u6210\u7684yaml\u6587\u6863\u5199\u5230\u6587\u4ef6\u91cc import yaml aproject = {'name': 'Silenthand Olleander', 'race': 'Human', 'traits': ['ONE_HAND', 'ONE_EYE'] } f = open(r'config1.yml', 'w') print(yaml.dump(aproject, f)) \u8fd0\u884c\u540e\u6094\u4ea7\u751f\u4e00\u4e2a\u6587\u4ef6config1.yml \u5185\u5bb9 name: Silenthand Olleander race: Human traits: [ONE_HAND, ONE_EYE]","title":"3\u3001yaml.dump \u5c06\u4e00\u4e2apython\u5bf9\u8c61\u751f\u6210\u4e3ayaml\u6587\u6863"},{"location":"python/lib/yaml/2.yaml\u4f7f\u7528/#4yamldump_all","text":"import yaml obj1 = {\"name\": \"James\", \"age\": 20} obj2 = [\"Lily\", 19] with open('config2.yml', 'w') as f: yaml.dump_all([obj1, obj2], f) \u6267\u884c\u540e\uff0c\u4ea7\u751fconfig2.yml\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a {age: 20, name: James} --- [Lily, 19]","title":"4\u3001yaml.dump_all()\u5c06\u591a\u4e2a\u6bb5\u8f93\u51fa\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d"},{"location":"python/lib/yield/1.yield/","text":"yield\u89e3\u6790\uff1a \u00b6 yield \u7684\u4f5c\u7528\u5c31\u662f\u628a\u4e00\u4e2a\u51fd\u6570\u53d8\u6210\u4e00\u4e2a\u751f\u6210\u5668(generator)\uff0c\u5e26\u6709yield\u7684\u51fd\u6570\u4e0d\u518d\u662f\u4e00\u4e2a\u666e\u901a\u51fd\u6570\uff0c Python\u89e3\u91ca\u5668\u4f1a\u5c06\u5176\u89c6\u4e3a\u4e00\u4e2agenerator\uff0c\u5355\u72ec\u8c03\u7528\uff08\u5982fab(5)\uff09\u4e0d\u4f1a\u6267\u884cfab\u51fd\u6570\uff0c \u800c\u662f\u8fd4\u56de\u4e00\u4e2a iterable \u5bf9\u8c61\uff01\u5728for\u5faa\u73af\u6267\u884c\u65f6\uff0c\u6bcf\u6b21\u5faa\u73af\u90fd\u4f1a\u6267\u884cfab\u51fd\u6570\u5185\u90e8\u7684\u4ee3\u7801\uff0c \u6267\u884c\u5230yield b\u65f6\uff0cfab\u51fd\u6570\u5c31\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u503c\uff0c\u4e0b\u6b21\u8fed\u4ee3\u65f6\uff0c\u4ee3\u7801\u4ece yield b \u7684\u4e0b\u4e00\u6761\u8bed\u53e5\u7ee7\u7eed\u6267\u884c\uff0c \u800c\u51fd\u6570\u7684\u672c\u5730\u53d8\u91cf\u770b\u8d77\u6765\u548c\u4e0a\u6b21\u4e2d\u65ad\u6267\u884c\u524d\u662f\u5b8c\u5168\u4e00\u6837\u7684\uff0c\u4e8e\u662f\u51fd\u6570\u7ee7\u7eed\u6267\u884c\uff0c\u76f4\u5230\u518d\u6b21\u9047\u5230 yield\u3002 \u53c2\u8003\u5b9e\u4f8b\u5982\u4e0b\uff1a 1.1 \u4f8b\u5b501 \u00b6 def fab(max): n, a, b = 0, 0, 1 while n < max: # print b yield b # print b a, b = b, a + b n = n + 1 print(fab(5)) \u7ed3\u679c <generator object fab at 0x00000170C16C8930> 1.2. \u4f8b\u5b502 \u00b6 for n in fab(5): print(n) \u7ed3\u679c 1 1 2 3 5 \u5bf9\u4e8e\u542b\u6709yield\u7684\u51fd\u6570\uff0c\u5916\u90e8\u8981\u4ee5\u8fed\u4ee3\u7684\u65b9\u5f0f\u8c03\u7528\uff0c\u5f53\u51fd\u6570\u6267\u884c\u7ed3\u675f\u65f6\uff0cgenerator \u81ea\u52a8\u629b\u51fa StopIteration \u5f02\u5e38\uff0c\u8868\u793a\u8fed\u4ee3\u5b8c\u6210\u3002 \u5728 for \u5faa\u73af\u91cc\uff0c\u65e0\u9700\u5904\u7406 StopIteration \u5f02\u5e38\uff0c\u5faa\u73af\u4f1a\u6b63\u5e38\u7ed3\u675f\u3002 def ff(max): a,b = 0,1 yield max # yield\u4e0d\u5728\u5faa\u73af\u4e2d\uff0c\u8fd9\u91cc\u5df2\u7ecf\u5230\u51fd\u6570\u6700\u540e\u6240\u4ee5\u76f4\u63a5\u8fd4\u56de\uff0c\u76f8\u5f53\u4e8ereturn for n in ff(5): print n \u7ed3\u679c 5 \u7ed3\u8bba\uff1a\u7efc\u4e0a\u53ef\u77e5\uff0cyield\u8981\u4f7f\u7528\u5728\u5faa\u73af\u4e2d\uff0c\u8fd9\u6837\u751f\u6210\u5668\u624d\u6709\u4f7f\u7528\u7684\u610f\u4e49\u3002","title":"8. yield\u5e93"},{"location":"python/lib/yield/1.yield/#yield","text":"yield \u7684\u4f5c\u7528\u5c31\u662f\u628a\u4e00\u4e2a\u51fd\u6570\u53d8\u6210\u4e00\u4e2a\u751f\u6210\u5668(generator)\uff0c\u5e26\u6709yield\u7684\u51fd\u6570\u4e0d\u518d\u662f\u4e00\u4e2a\u666e\u901a\u51fd\u6570\uff0c Python\u89e3\u91ca\u5668\u4f1a\u5c06\u5176\u89c6\u4e3a\u4e00\u4e2agenerator\uff0c\u5355\u72ec\u8c03\u7528\uff08\u5982fab(5)\uff09\u4e0d\u4f1a\u6267\u884cfab\u51fd\u6570\uff0c \u800c\u662f\u8fd4\u56de\u4e00\u4e2a iterable \u5bf9\u8c61\uff01\u5728for\u5faa\u73af\u6267\u884c\u65f6\uff0c\u6bcf\u6b21\u5faa\u73af\u90fd\u4f1a\u6267\u884cfab\u51fd\u6570\u5185\u90e8\u7684\u4ee3\u7801\uff0c \u6267\u884c\u5230yield b\u65f6\uff0cfab\u51fd\u6570\u5c31\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u503c\uff0c\u4e0b\u6b21\u8fed\u4ee3\u65f6\uff0c\u4ee3\u7801\u4ece yield b \u7684\u4e0b\u4e00\u6761\u8bed\u53e5\u7ee7\u7eed\u6267\u884c\uff0c \u800c\u51fd\u6570\u7684\u672c\u5730\u53d8\u91cf\u770b\u8d77\u6765\u548c\u4e0a\u6b21\u4e2d\u65ad\u6267\u884c\u524d\u662f\u5b8c\u5168\u4e00\u6837\u7684\uff0c\u4e8e\u662f\u51fd\u6570\u7ee7\u7eed\u6267\u884c\uff0c\u76f4\u5230\u518d\u6b21\u9047\u5230 yield\u3002 \u53c2\u8003\u5b9e\u4f8b\u5982\u4e0b\uff1a","title":"yield\u89e3\u6790\uff1a"},{"location":"python/lib/yield/1.yield/#11-1","text":"def fab(max): n, a, b = 0, 0, 1 while n < max: # print b yield b # print b a, b = b, a + b n = n + 1 print(fab(5)) \u7ed3\u679c <generator object fab at 0x00000170C16C8930>","title":"1.1 \u4f8b\u5b501"},{"location":"python/lib/yield/1.yield/#12-2","text":"for n in fab(5): print(n) \u7ed3\u679c 1 1 2 3 5 \u5bf9\u4e8e\u542b\u6709yield\u7684\u51fd\u6570\uff0c\u5916\u90e8\u8981\u4ee5\u8fed\u4ee3\u7684\u65b9\u5f0f\u8c03\u7528\uff0c\u5f53\u51fd\u6570\u6267\u884c\u7ed3\u675f\u65f6\uff0cgenerator \u81ea\u52a8\u629b\u51fa StopIteration \u5f02\u5e38\uff0c\u8868\u793a\u8fed\u4ee3\u5b8c\u6210\u3002 \u5728 for \u5faa\u73af\u91cc\uff0c\u65e0\u9700\u5904\u7406 StopIteration \u5f02\u5e38\uff0c\u5faa\u73af\u4f1a\u6b63\u5e38\u7ed3\u675f\u3002 def ff(max): a,b = 0,1 yield max # yield\u4e0d\u5728\u5faa\u73af\u4e2d\uff0c\u8fd9\u91cc\u5df2\u7ecf\u5230\u51fd\u6570\u6700\u540e\u6240\u4ee5\u76f4\u63a5\u8fd4\u56de\uff0c\u76f8\u5f53\u4e8ereturn for n in ff(5): print n \u7ed3\u679c 5 \u7ed3\u8bba\uff1a\u7efc\u4e0a\u53ef\u77e5\uff0cyield\u8981\u4f7f\u7528\u5728\u5faa\u73af\u4e2d\uff0c\u8fd9\u6837\u751f\u6210\u5668\u624d\u6709\u4f7f\u7528\u7684\u610f\u4e49\u3002","title":"1.2. \u4f8b\u5b502"},{"location":"python/note/note.extend_append/","text":"extend append 1. \u4ecb\u7ecd \u00b6 list.append(object) \u5411\u5217\u8868\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u5bf9\u8c61object list.extend(sequence) \u628a\u4e00\u4e2a\u5e8f\u5217seq\u7684\u5185\u5bb9\u6dfb\u52a0\u5230\u5217\u8868\u4e2d 2. \u4f8b\u5b50 \u00b6 In [6]: a=[1] In [7]: a1=[2,3] In [8]: a.append(a1) In [9]: a Out[9]: [1, [2, 3]] In [10]: b=[1] In [11]: b1=[2,3] In [12]: b.extend(b1) In [13]: b Out[13]: [1, 2, 3] \u533a\u522b \u4f7f\u7528append\u7684\u65f6\u5019\uff0c\u662f\u5c06a1\u770b\u4f5c\u4e00\u4e2a\u5bf9\u8c61\uff0c\u6574\u4f53\u6253\u5305\u6dfb\u52a0\u5230a\u5bf9\u8c61\u4e2d\u3002 \u4f7f\u7528extend\u7684\u65f6\u5019\uff0c\u662f\u5c06b1\u770b\u4f5c\u4e00\u4e2a\u5e8f\u5217\uff0c\u5c06\u8fd9\u4e2a\u5e8f\u5217\u548cb\u5e8f\u5217\u5408\u5e76\uff0c\u5e76\u653e\u5728\u5176\u540e\u9762\u3002","title":"1. \u5217\u8868"},{"location":"python/note/note.extend_append/#1","text":"list.append(object) \u5411\u5217\u8868\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u5bf9\u8c61object list.extend(sequence) \u628a\u4e00\u4e2a\u5e8f\u5217seq\u7684\u5185\u5bb9\u6dfb\u52a0\u5230\u5217\u8868\u4e2d","title":"1. \u4ecb\u7ecd"},{"location":"python/note/note.extend_append/#2","text":"In [6]: a=[1] In [7]: a1=[2,3] In [8]: a.append(a1) In [9]: a Out[9]: [1, [2, 3]] In [10]: b=[1] In [11]: b1=[2,3] In [12]: b.extend(b1) In [13]: b Out[13]: [1, 2, 3] \u533a\u522b \u4f7f\u7528append\u7684\u65f6\u5019\uff0c\u662f\u5c06a1\u770b\u4f5c\u4e00\u4e2a\u5bf9\u8c61\uff0c\u6574\u4f53\u6253\u5305\u6dfb\u52a0\u5230a\u5bf9\u8c61\u4e2d\u3002 \u4f7f\u7528extend\u7684\u65f6\u5019\uff0c\u662f\u5c06b1\u770b\u4f5c\u4e00\u4e2a\u5e8f\u5217\uff0c\u5c06\u8fd9\u4e2a\u5e8f\u5217\u548cb\u5e8f\u5217\u5408\u5e76\uff0c\u5e76\u653e\u5728\u5176\u540e\u9762\u3002","title":"2. \u4f8b\u5b50"},{"location":"python/tools/pip.index/","text":"pip \u66f4\u65b0\u6e90 1. \u4ecb\u7ecd \u00b6 \u7531\u4e8e\u5929\u671d\u7684\u539f\u56e0\uff0c\u6211\u4eec\u4f7f\u7528pip \u5b89\u88c5\u7684\u65f6\u5019\u3002\u8054\u7f51\u6709\u65f6\u5019\u4f1a\u6bd4\u8f83\u6162\u6216\u8005\u76f4\u63a5forbidden\u3002\u6211\u4eec\u6b64\u65f6\u5c31\u9700\u8981\u914d\u7f6e\u4f7f\u7528\u56fd\u5185\u7684\u6e90\u3002pip\u6e90\u7c7b\u4f3cyum\u6e90\u3001\u6216\u8005apt-get\u6e90 2. \u4f18\u70b9 \u00b6 \u56fd\u5185\u6e05\u534e\u6e90,\u8c46\u74e3\u6e90\u3002\u90fd\u662f\u5f88\u4e0d\u9519\u7684\u6e90 3. \u6e05\u534e\u6e90\u914d\u7f6e \u00b6 3.1 \u4e34\u65f6\u914d\u7f6e \u00b6 pip install -i https://pypi.tuna.tsinghua.edu.cn/simple some-package \u6ce8\u610f\uff0csimple \u4e0d\u80fd\u5c11, \u662f https \u800c\u4e0d\u662f http 3.2 \u6c38\u4e45\u914d\u7f6e \u00b6 \u5347\u7ea7 pip \u5230\u6700\u65b0\u7684\u7248\u672c (>=10.0.0) \u540e\u8fdb\u884c\u914d\u7f6e\uff1a pip install pip -U pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple \u5982\u679c\u60a8\u5230 pip \u9ed8\u8ba4\u6e90\u7684\u7f51\u7edc\u8fde\u63a5\u8f83\u5dee\uff0c\u4e34\u65f6\u4f7f\u7528\u672c\u955c\u50cf\u7ad9\u6765\u5347\u7ea7 pip\uff1a pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pip -U 4. \u8c46\u74e3\u6e90\u914d\u7f6e \u00b6 4.1 \u4e34\u65f6\u914d\u7f6e \u00b6 sudo pip install -i http://pypi.douban.com/simple/ --trusted-host=pypi.douban.com/simple ipython 4.2 \u6c38\u4e45\u914d\u7f6e \u00b6 linux $HOME/.config/pip/pip.conf \u6216\u8005 $HOME/.pip/pip.conf mac $HOME/Library/Application Support/pip/pip.conf \u6216\u8005 $HOME/.pip/pip.conf windows %APPDATA%\\pip\\pip.ini \u6216\u8005 %HOME%\\pip\\pip.ini pip.conf\u6216\u8005pip.ini\u5185\u5bb9 [global] timeout = 60 index-url = http://pypi.douban.com/simple trusted-host = pypi.douban.com","title":"1. \u6e05\u534e\u6e90"},{"location":"python/tools/pip.index/#1","text":"\u7531\u4e8e\u5929\u671d\u7684\u539f\u56e0\uff0c\u6211\u4eec\u4f7f\u7528pip \u5b89\u88c5\u7684\u65f6\u5019\u3002\u8054\u7f51\u6709\u65f6\u5019\u4f1a\u6bd4\u8f83\u6162\u6216\u8005\u76f4\u63a5forbidden\u3002\u6211\u4eec\u6b64\u65f6\u5c31\u9700\u8981\u914d\u7f6e\u4f7f\u7528\u56fd\u5185\u7684\u6e90\u3002pip\u6e90\u7c7b\u4f3cyum\u6e90\u3001\u6216\u8005apt-get\u6e90","title":"1. \u4ecb\u7ecd"},{"location":"python/tools/pip.index/#2","text":"\u56fd\u5185\u6e05\u534e\u6e90,\u8c46\u74e3\u6e90\u3002\u90fd\u662f\u5f88\u4e0d\u9519\u7684\u6e90","title":"2. \u4f18\u70b9"},{"location":"python/tools/pip.index/#3","text":"","title":"3. \u6e05\u534e\u6e90\u914d\u7f6e"},{"location":"python/tools/pip.index/#31","text":"pip install -i https://pypi.tuna.tsinghua.edu.cn/simple some-package \u6ce8\u610f\uff0csimple \u4e0d\u80fd\u5c11, \u662f https \u800c\u4e0d\u662f http","title":"3.1 \u4e34\u65f6\u914d\u7f6e"},{"location":"python/tools/pip.index/#32","text":"\u5347\u7ea7 pip \u5230\u6700\u65b0\u7684\u7248\u672c (>=10.0.0) \u540e\u8fdb\u884c\u914d\u7f6e\uff1a pip install pip -U pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple \u5982\u679c\u60a8\u5230 pip \u9ed8\u8ba4\u6e90\u7684\u7f51\u7edc\u8fde\u63a5\u8f83\u5dee\uff0c\u4e34\u65f6\u4f7f\u7528\u672c\u955c\u50cf\u7ad9\u6765\u5347\u7ea7 pip\uff1a pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pip -U","title":"3.2 \u6c38\u4e45\u914d\u7f6e"},{"location":"python/tools/pip.index/#4","text":"","title":"4. \u8c46\u74e3\u6e90\u914d\u7f6e"},{"location":"python/tools/pip.index/#41","text":"sudo pip install -i http://pypi.douban.com/simple/ --trusted-host=pypi.douban.com/simple ipython","title":"4.1 \u4e34\u65f6\u914d\u7f6e"},{"location":"python/tools/pip.index/#42","text":"linux $HOME/.config/pip/pip.conf \u6216\u8005 $HOME/.pip/pip.conf mac $HOME/Library/Application Support/pip/pip.conf \u6216\u8005 $HOME/.pip/pip.conf windows %APPDATA%\\pip\\pip.ini \u6216\u8005 %HOME%\\pip\\pip.ini pip.conf\u6216\u8005pip.ini\u5185\u5bb9 [global] timeout = 60 index-url = http://pypi.douban.com/simple trusted-host = pypi.douban.com","title":"4.2 \u6c38\u4e45\u914d\u7f6e"},{"location":"python/tools/virtualenv.index/","text":"Python \u865a\u62df\u73af\u5883\u4e4bvirtualenv 1. \u4ecb\u7ecd \u00b6 \u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u865a\u62df\u73af\u5883\uff1f\u968f\u7740\u4f60\u7684 Python \u9879\u76ee\u8d8a\u6765\u8d8a\u591a\uff0c\u4f60\u4f1a\u53d1\u73b0\u4e0d\u540c\u7684\u9879\u76ee\u4f1a\u9700\u8981 \u4e0d\u540c\u7684\u7248\u672c\u7684 Python \u5e93\u3002\u540c\u4e00\u4e2a Python \u5e93\u7684\u4e0d\u540c\u7248\u672c\u53ef\u80fd\u4e0d\u517c\u5bb9\u3002 \u865a\u62df\u73af\u5883\u53ef\u4ee5\u4e3a\u6bcf\u4e00\u4e2a\u9879\u76ee\u5b89\u88c5\u72ec\u7acb\u7684 Python \u5e93\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u9694\u79bb\u4e0d\u540c\u9879\u76ee\u4e4b\u95f4\u7684 Python \u5e93\uff0c\u4e5f\u53ef\u4ee5\u9694\u79bb\u9879\u76ee\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u4e4b\u95f4\u7684 Python \u5e93\u3002 Python 3 \u5185\u7f6e\u4e86\u7528\u4e8e\u521b\u5efa\u865a\u62df\u73af\u5883\u7684 venv \u6a21\u5757\u3002\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f\u8f83\u65b0\u7684 Python \u7248\u672c\uff0c\u90a3\u4e48\u8bf7\u63a5\u7740\u9605\u8bfb\u672c\u6587\u4e0b\u9762\u7684\u5185\u5bb9\u3002 2 virtualenv \u00b6 2.1 \u5b89\u88c5 \u00b6 # Debian, Ubuntu sudo apt-get install python-virtualenv # CentOS, Fedora sudo yum install python-virtualenv 2.2 \u5e2e\u52a9 \u00b6 root@leco:~/code/env# virtualenv --help Usage: virtualenv [OPTIONS] DEST_DIR Options: --version show program's version number and exit -h, --help show this help message and exit -v, --verbose Increase verbosity. -q, --quiet Decrease verbosity. -p PYTHON_EXE, --python=PYTHON_EXE The Python interpreter to use, e.g., --python=python3.5 will use the python3.5 interpreter to create the new environment. The default is the interpreter that virtualenv was installed with (/usr/local/bin/python3.6) --clear Clear out the non-root install and start from scratch. --no-site-packages DEPRECATED. Retained only for backward compatibility. Not having access to global site-packages is now the default behavior. --system-site-packages Give the virtual environment access to the global site-packages. --always-copy Always copy files rather than symlinking. --relocatable Make an EXISTING virtualenv environment relocatable. This fixes up scripts and makes all .pth files relative. --no-setuptools Do not install setuptools in the new virtualenv. --no-pip Do not install pip in the new virtualenv. --no-wheel Do not install wheel in the new virtualenv. --extra-search-dir=DIR Directory to look for setuptools/pip distributions in. This option can be used multiple times. --download Download preinstalled packages from PyPI. --no-download, --never-download Do not download preinstalled packages from PyPI. --prompt=PROMPT Provides an alternative prompt prefix for this environment. --setuptools DEPRECATED. Retained only for backward compatibility. This option has no effect. --distribute DEPRECATED. Retained only for backward compatibility. This option has no effect. --unzip-setuptools DEPRECATED. Retained only for backward compatibility. This option has no effect. 2.3 \u6848\u4f8b \u00b6 root@leco:~/code/env# ls # 1. \u5b89\u88c5Python2\u7684\u865a\u62df\u73af\u5883 root@leco:~/code/env# virtualenv -p `which python2` env2 Running virtualenv with interpreter /usr/bin/python2 New python executable in /root/code/env/env2/bin/python2 Also creating executable in /root/code/env/env2/bin/python Installing setuptools, pip, wheel...done. # 2. \u5b89\u88c5python3\u7684\u865a\u62df\u73af\u5883 root@leco:~/code/env# virtualenv -p `which python3` env3 Running virtualenv with interpreter /usr/local/bin/python3 Using base prefix '/usr/local' New python executable in /root/code/env/env3/bin/python3 Also creating executable in /root/code/env/env3/bin/python Installing setuptools, pip, wheel...done. root@leco:~/code/env# ls env2 env3 # 3. \u6fc0\u6d3b root@leco:~/code/env# source env3/bin/activate # 4. \u5b89\u88c5\u5305[\u5b89\u88c5\u540e\u7684\u5c31\u5728\u8fd9\u4e2a\u5f53\u524d\u865a\u62df\u73af\u5883\u4e2d] # \u6fc0\u6d3b\u597d\u865a\u62df\u73af\u5883\uff0c\u524d\u9762\u4f1a\u591a\u4e2a\u865a\u62df\u73af\u5883\u7684\u540d\u5b57 (env3) root@leco:~/code/env# pip install flask Collecting flask Using cached https://files.pythonhosted.org/packages/7f/e7/08578774ed4536d3242b14dacb4696386634607af824ea997202cd0edb4b/Flask-1.0.2-py2.py3-none-any.whl Collecting Jinja2>=2.10 (from flask) Using cached https://files.pythonhosted.org/packages/7f/ff/ae64bacdfc95f27a016a7bed8e8686763ba4d277a78ca76f32659220a731/Jinja2-2.10-py2.py3-none-any.whl Collecting click>=5.1 (from flask) Using cached https://files.pythonhosted.org/packages/fa/37/45185cb5abbc30d7257104c434fe0b07e5a195a6847506c074527aa599ec/Click-7.0-py2.py3-none-any.whl Collecting Werkzeug>=0.14 (from flask) Using cached https://files.pythonhosted.org/packages/20/c4/12e3e56473e52375aa29c4764e70d1b8f3efa6682bef8d0aae04fe335243/Werkzeug-0.14.1-py2.py3-none-any.whl Collecting itsdangerous>=0.24 (from flask) Using cached https://files.pythonhosted.org/packages/76/ae/44b03b253d6fade317f32c24d100b3b35c2239807046a4c953c7b89fa49e/itsdangerous-1.1.0-py2.py3-none-any.whl Collecting MarkupSafe>=0.23 (from Jinja2>=2.10->flask) Downloading https://files.pythonhosted.org/packages/b2/5f/23e0023be6bb885d00ffbefad2942bc51a620328ee910f64abe5a8d18dd1/MarkupSafe-1.1.1-cp36-cp36m-manylinux1_x86_64.whl Installing collected packages: MarkupSafe, Jinja2, click, Werkzeug, itsdangerous, flask Successfully installed Jinja2-2.10 MarkupSafe-1.1.1 Werkzeug-0.14.1 click-7.0 flask-1.0.2 itsdangerous-1.1.0 # 4. \u67e5\u770b\u5f53\u524d\u865a\u62df\u73af\u5883\u7684\u5b89\u88c5\u7684\u5305 (env3) root@leco:~/code/env# pip list Package Version ------------ ------- Click 7.0 Flask 1.0.2 itsdangerous 1.1.0 Jinja2 2.10 MarkupSafe 1.1.1 pip 19.0.3 setuptools 40.8.0 Werkzeug 0.14.1 wheel 0.33.1 # 5. \u5bfc\u51fa\u5b89\u88c5\u5305 (env3) root@leco:~/code/env# pip list >requirements.txt # \u8fd9\u4e2a\u6587\u4ef6\u540d\u968f\u4fbf\uff0c\u9ed8\u8ba4\u662f\u8fd9\u4e2a \u6709\u7684\u7248\u672c\u662fpip3 freeze > requirements.txt (env3) root@leco:~/code/env# cat requirements.txt Package Version ------------ ------- Click 7.0 Flask 1.0.2 itsdangerous 1.1.0 Jinja2 2.10 MarkupSafe 1.1.1 pip 19.0.3 setuptools 40.8.0 Werkzeug 0.14.1 wheel 0.33.1 \u8fd9\u5c06\u4f1a\u521b\u5efa\u4e00\u4e2a requirements.txt \u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u5f53\u524d\u73af\u5883\u4e2d\u6240\u6709\u5305\u53ca \u5404\u81ea\u7684\u7248\u672c\u7684\u7b80\u5355\u5217\u8868\u3002 \u53ef\u4ee5\u4f7f\u7528 \u201cpip list\u201d\u5728\u4e0d\u4ea7\u751frequirements\u6587\u4ef6\u7684\u60c5\u51b5\u4e0b\uff0c \u67e5\u770b\u5df2\u5b89\u88c5\u5305\u7684\u5217\u8868\u3002 # 6. \u8fd8\u539f\u73af\u5883\uff0c pip install -r requirements.txt # 7. \u9000\u51fa\u865a\u62df\u73af\u5883 (env3) root@leco:~/code/env# deactivate root@leco:~/code/env# \u9000\u51fa\u865a\u62df\u73af\u5883\u540e\uff0c\u524d\u9762\u865a\u62df\u73af\u5883\u540d\u5b57\u4e5f\u6d88\u5931\u4e86\u3002 3. \u5728\u5916\u90e8\u5411\u7a0b\u5e8f\u5185\u90e8\u4f20\u9012\u53c2\u6570 \u00b6 root@leco:~/code/sys# cat demo1.py import sys print(sys.argv) # \u53c2\u6570\u5217\u8868\uff0c\u8fd4\u56de\u662f\u5217\u8868 print(len(sys.argv)) # \u53c2\u6570\u4e2a\u6570 print(sys.argv[0]) # \u811a\u672c\u540d print(sys.argv[1]) # \u7b2c\u4e00\u4e2a\u53c2\u6570 root@leco:~/code/sys# python demo1.py 1 2 ['demo1.py', '1', '2'] 3 demo1.py 1 4. \u9000\u51fa \u00b6 \u6267\u884c\u5230\u4e3b\u7a0b\u5e8f\u672b\u5c3e\uff0c\u89e3\u91ca\u5668\u81ea\u52a8\u9000\u51fa\uff0c\u4f46\u662f\u5982\u679c\u9700\u8981\u4e2d\u9014\u9000\u51fa\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u8c03\u7528sys.exit\u51fd\u6570\uff0c\u5e26\u6709\u4e00\u4e2a\u53ef\u9009\u7684\u6574\u6570\u53c2\u6570\u8fd4\u56de\u7ed9\u8c03\u7528\u5b83\u7684\u7a0b\u5e8f\uff0c\u8868\u793a\u4f60\u53ef\u4ee5\u5728\u4e3b\u7a0b\u5e8f\u4e2d\u6355\u83b7\u5bf9sys.exit\u7684\u8c03\u7528\u3002\uff080\u662f\u6b63\u5e38\u9000\u51fa\uff0c\u5176\u4ed6\u4e3a\u5f02\u5e38\uff09 In [1]: import sys In [2]: sys.exit(0) An exception has occurred, use %tb to see the full traceback. SystemExit: 0 /usr/local/lib/python3.6/site-packages/IPython/core/interactiveshell.py:2918: UserWarning: To exit: use 'exit', 'quit', or Ctrl-D. warn(\"To exit: use 'exit', 'quit', or Ctrl-D.\", stacklevel=1) In [3]: sys.exit(1) An exception has occurred, use %tb to see the full traceback.","title":"1. virtualenv"},{"location":"python/tools/virtualenv.index/#1","text":"\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u865a\u62df\u73af\u5883\uff1f\u968f\u7740\u4f60\u7684 Python \u9879\u76ee\u8d8a\u6765\u8d8a\u591a\uff0c\u4f60\u4f1a\u53d1\u73b0\u4e0d\u540c\u7684\u9879\u76ee\u4f1a\u9700\u8981 \u4e0d\u540c\u7684\u7248\u672c\u7684 Python \u5e93\u3002\u540c\u4e00\u4e2a Python \u5e93\u7684\u4e0d\u540c\u7248\u672c\u53ef\u80fd\u4e0d\u517c\u5bb9\u3002 \u865a\u62df\u73af\u5883\u53ef\u4ee5\u4e3a\u6bcf\u4e00\u4e2a\u9879\u76ee\u5b89\u88c5\u72ec\u7acb\u7684 Python \u5e93\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u9694\u79bb\u4e0d\u540c\u9879\u76ee\u4e4b\u95f4\u7684 Python \u5e93\uff0c\u4e5f\u53ef\u4ee5\u9694\u79bb\u9879\u76ee\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u4e4b\u95f4\u7684 Python \u5e93\u3002 Python 3 \u5185\u7f6e\u4e86\u7528\u4e8e\u521b\u5efa\u865a\u62df\u73af\u5883\u7684 venv \u6a21\u5757\u3002\u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f\u8f83\u65b0\u7684 Python \u7248\u672c\uff0c\u90a3\u4e48\u8bf7\u63a5\u7740\u9605\u8bfb\u672c\u6587\u4e0b\u9762\u7684\u5185\u5bb9\u3002","title":"1. \u4ecb\u7ecd"},{"location":"python/tools/virtualenv.index/#2-virtualenv","text":"","title":"2 virtualenv"},{"location":"python/tools/virtualenv.index/#21","text":"# Debian, Ubuntu sudo apt-get install python-virtualenv # CentOS, Fedora sudo yum install python-virtualenv","title":"2.1 \u5b89\u88c5"},{"location":"python/tools/virtualenv.index/#22","text":"root@leco:~/code/env# virtualenv --help Usage: virtualenv [OPTIONS] DEST_DIR Options: --version show program's version number and exit -h, --help show this help message and exit -v, --verbose Increase verbosity. -q, --quiet Decrease verbosity. -p PYTHON_EXE, --python=PYTHON_EXE The Python interpreter to use, e.g., --python=python3.5 will use the python3.5 interpreter to create the new environment. The default is the interpreter that virtualenv was installed with (/usr/local/bin/python3.6) --clear Clear out the non-root install and start from scratch. --no-site-packages DEPRECATED. Retained only for backward compatibility. Not having access to global site-packages is now the default behavior. --system-site-packages Give the virtual environment access to the global site-packages. --always-copy Always copy files rather than symlinking. --relocatable Make an EXISTING virtualenv environment relocatable. This fixes up scripts and makes all .pth files relative. --no-setuptools Do not install setuptools in the new virtualenv. --no-pip Do not install pip in the new virtualenv. --no-wheel Do not install wheel in the new virtualenv. --extra-search-dir=DIR Directory to look for setuptools/pip distributions in. This option can be used multiple times. --download Download preinstalled packages from PyPI. --no-download, --never-download Do not download preinstalled packages from PyPI. --prompt=PROMPT Provides an alternative prompt prefix for this environment. --setuptools DEPRECATED. Retained only for backward compatibility. This option has no effect. --distribute DEPRECATED. Retained only for backward compatibility. This option has no effect. --unzip-setuptools DEPRECATED. Retained only for backward compatibility. This option has no effect.","title":"2.2 \u5e2e\u52a9"},{"location":"python/tools/virtualenv.index/#23","text":"root@leco:~/code/env# ls # 1. \u5b89\u88c5Python2\u7684\u865a\u62df\u73af\u5883 root@leco:~/code/env# virtualenv -p `which python2` env2 Running virtualenv with interpreter /usr/bin/python2 New python executable in /root/code/env/env2/bin/python2 Also creating executable in /root/code/env/env2/bin/python Installing setuptools, pip, wheel...done. # 2. \u5b89\u88c5python3\u7684\u865a\u62df\u73af\u5883 root@leco:~/code/env# virtualenv -p `which python3` env3 Running virtualenv with interpreter /usr/local/bin/python3 Using base prefix '/usr/local' New python executable in /root/code/env/env3/bin/python3 Also creating executable in /root/code/env/env3/bin/python Installing setuptools, pip, wheel...done. root@leco:~/code/env# ls env2 env3 # 3. \u6fc0\u6d3b root@leco:~/code/env# source env3/bin/activate # 4. \u5b89\u88c5\u5305[\u5b89\u88c5\u540e\u7684\u5c31\u5728\u8fd9\u4e2a\u5f53\u524d\u865a\u62df\u73af\u5883\u4e2d] # \u6fc0\u6d3b\u597d\u865a\u62df\u73af\u5883\uff0c\u524d\u9762\u4f1a\u591a\u4e2a\u865a\u62df\u73af\u5883\u7684\u540d\u5b57 (env3) root@leco:~/code/env# pip install flask Collecting flask Using cached https://files.pythonhosted.org/packages/7f/e7/08578774ed4536d3242b14dacb4696386634607af824ea997202cd0edb4b/Flask-1.0.2-py2.py3-none-any.whl Collecting Jinja2>=2.10 (from flask) Using cached https://files.pythonhosted.org/packages/7f/ff/ae64bacdfc95f27a016a7bed8e8686763ba4d277a78ca76f32659220a731/Jinja2-2.10-py2.py3-none-any.whl Collecting click>=5.1 (from flask) Using cached https://files.pythonhosted.org/packages/fa/37/45185cb5abbc30d7257104c434fe0b07e5a195a6847506c074527aa599ec/Click-7.0-py2.py3-none-any.whl Collecting Werkzeug>=0.14 (from flask) Using cached https://files.pythonhosted.org/packages/20/c4/12e3e56473e52375aa29c4764e70d1b8f3efa6682bef8d0aae04fe335243/Werkzeug-0.14.1-py2.py3-none-any.whl Collecting itsdangerous>=0.24 (from flask) Using cached https://files.pythonhosted.org/packages/76/ae/44b03b253d6fade317f32c24d100b3b35c2239807046a4c953c7b89fa49e/itsdangerous-1.1.0-py2.py3-none-any.whl Collecting MarkupSafe>=0.23 (from Jinja2>=2.10->flask) Downloading https://files.pythonhosted.org/packages/b2/5f/23e0023be6bb885d00ffbefad2942bc51a620328ee910f64abe5a8d18dd1/MarkupSafe-1.1.1-cp36-cp36m-manylinux1_x86_64.whl Installing collected packages: MarkupSafe, Jinja2, click, Werkzeug, itsdangerous, flask Successfully installed Jinja2-2.10 MarkupSafe-1.1.1 Werkzeug-0.14.1 click-7.0 flask-1.0.2 itsdangerous-1.1.0 # 4. \u67e5\u770b\u5f53\u524d\u865a\u62df\u73af\u5883\u7684\u5b89\u88c5\u7684\u5305 (env3) root@leco:~/code/env# pip list Package Version ------------ ------- Click 7.0 Flask 1.0.2 itsdangerous 1.1.0 Jinja2 2.10 MarkupSafe 1.1.1 pip 19.0.3 setuptools 40.8.0 Werkzeug 0.14.1 wheel 0.33.1 # 5. \u5bfc\u51fa\u5b89\u88c5\u5305 (env3) root@leco:~/code/env# pip list >requirements.txt # \u8fd9\u4e2a\u6587\u4ef6\u540d\u968f\u4fbf\uff0c\u9ed8\u8ba4\u662f\u8fd9\u4e2a \u6709\u7684\u7248\u672c\u662fpip3 freeze > requirements.txt (env3) root@leco:~/code/env# cat requirements.txt Package Version ------------ ------- Click 7.0 Flask 1.0.2 itsdangerous 1.1.0 Jinja2 2.10 MarkupSafe 1.1.1 pip 19.0.3 setuptools 40.8.0 Werkzeug 0.14.1 wheel 0.33.1 \u8fd9\u5c06\u4f1a\u521b\u5efa\u4e00\u4e2a requirements.txt \u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u5f53\u524d\u73af\u5883\u4e2d\u6240\u6709\u5305\u53ca \u5404\u81ea\u7684\u7248\u672c\u7684\u7b80\u5355\u5217\u8868\u3002 \u53ef\u4ee5\u4f7f\u7528 \u201cpip list\u201d\u5728\u4e0d\u4ea7\u751frequirements\u6587\u4ef6\u7684\u60c5\u51b5\u4e0b\uff0c \u67e5\u770b\u5df2\u5b89\u88c5\u5305\u7684\u5217\u8868\u3002 # 6. \u8fd8\u539f\u73af\u5883\uff0c pip install -r requirements.txt # 7. \u9000\u51fa\u865a\u62df\u73af\u5883 (env3) root@leco:~/code/env# deactivate root@leco:~/code/env# \u9000\u51fa\u865a\u62df\u73af\u5883\u540e\uff0c\u524d\u9762\u865a\u62df\u73af\u5883\u540d\u5b57\u4e5f\u6d88\u5931\u4e86\u3002","title":"2.3 \u6848\u4f8b"},{"location":"python/tools/virtualenv.index/#3","text":"root@leco:~/code/sys# cat demo1.py import sys print(sys.argv) # \u53c2\u6570\u5217\u8868\uff0c\u8fd4\u56de\u662f\u5217\u8868 print(len(sys.argv)) # \u53c2\u6570\u4e2a\u6570 print(sys.argv[0]) # \u811a\u672c\u540d print(sys.argv[1]) # \u7b2c\u4e00\u4e2a\u53c2\u6570 root@leco:~/code/sys# python demo1.py 1 2 ['demo1.py', '1', '2'] 3 demo1.py 1","title":"3. \u5728\u5916\u90e8\u5411\u7a0b\u5e8f\u5185\u90e8\u4f20\u9012\u53c2\u6570"},{"location":"python/tools/virtualenv.index/#4","text":"\u6267\u884c\u5230\u4e3b\u7a0b\u5e8f\u672b\u5c3e\uff0c\u89e3\u91ca\u5668\u81ea\u52a8\u9000\u51fa\uff0c\u4f46\u662f\u5982\u679c\u9700\u8981\u4e2d\u9014\u9000\u51fa\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u8c03\u7528sys.exit\u51fd\u6570\uff0c\u5e26\u6709\u4e00\u4e2a\u53ef\u9009\u7684\u6574\u6570\u53c2\u6570\u8fd4\u56de\u7ed9\u8c03\u7528\u5b83\u7684\u7a0b\u5e8f\uff0c\u8868\u793a\u4f60\u53ef\u4ee5\u5728\u4e3b\u7a0b\u5e8f\u4e2d\u6355\u83b7\u5bf9sys.exit\u7684\u8c03\u7528\u3002\uff080\u662f\u6b63\u5e38\u9000\u51fa\uff0c\u5176\u4ed6\u4e3a\u5f02\u5e38\uff09 In [1]: import sys In [2]: sys.exit(0) An exception has occurred, use %tb to see the full traceback. SystemExit: 0 /usr/local/lib/python3.6/site-packages/IPython/core/interactiveshell.py:2918: UserWarning: To exit: use 'exit', 'quit', or Ctrl-D. warn(\"To exit: use 'exit', 'quit', or Ctrl-D.\", stacklevel=1) In [3]: sys.exit(1) An exception has occurred, use %tb to see the full traceback.","title":"4. \u9000\u51fa"},{"location":"python/tools/virtualenvwrapper.index/","text":"Python \u865a\u62df\u73af\u5883\u4e4bvirtualenvwrapper 1. \u4ecb\u7ecd \u00b6 virtualenv \u7684\u4e00\u4e2a\u6700\u5927\u7684\u7f3a\u70b9\u5c31\u662f\uff1a\u6bcf\u6b21\u5f00\u542f\u865a\u62df\u73af\u5883\u4e4b\u524d\u8981\u53bb\u865a\u62df\u73af\u5883\u6240\u5728\u76ee\u5f55\u4e0b\u7684 bin \u76ee\u5f55\u4e0b source \u4e00\u4e0b activate\uff0c\u8fd9\u5c31\u9700\u8981\u6211\u4eec\u8bb0\u4f4f\u6bcf\u4e2a\u865a\u62df\u73af\u5883\u6240\u5728\u7684\u76ee\u5f55\u3002\u5e76\u4e14\u8fd8\u6709\u53ef\u80fd\u4f60\u5fd8\u8bb0\u4e86\u865a\u62df\u73af\u5883\u653e\u5728\u54ea\u3002 \u4e00\u79cd\u53ef\u884c\u7684\u89e3\u51b3\u65b9\u6848\u662f\uff0c\u5c06\u6240\u6709\u7684\u865a\u62df\u73af\u5883\u76ee\u5f55\u5168\u90fd\u96c6\u4e2d\u8d77\u6765\uff0c\u4f8b\u5982/opt/all_venv/\uff0c\u5e76\u4e14\u9488\u5bf9\u4e0d\u540c\u7684\u76ee\u5f55\u505a\u4e0d\u540c\u7684\u4e8b\u3002 \u4f7f\u7528virtualenvwrapper\u7ba1\u7406\u4f60\u7684\u865a\u62df\u73af\u5883\uff08virtualenv\uff09\uff0c\u5176\u5b9e\u4ed6\u5c31\u662f\u7edf\u4e00\u7ba1\u7406\u865a\u62df\u73af\u5883\u7684\u76ee\u5f55\uff0c\u5e76\u4e14\u7701\u53bb\u4e86source\u7684\u6b65\u9aa4\u3002 \u5217\u51fa\u865a\u62df\u73af\u5883\u5217\u8868: workon | lsvirtualenv \u65b0\u5efa\u865a\u62df\u73af\u5883: mkvirtualenv [\u865a\u62df\u73af\u5883\u540d\u79f0] \u542f\u52a8/\u5207\u6362\u865a\u62df\u73af\u5883: workon [\u865a\u62df\u73af\u5883\u540d\u79f0] \u5220\u9664\u865a\u62df\u73af\u5883: rmvirtualenv [\u865a\u62df\u73af\u5883\u540d\u79f0] 2 virtualenvwrapper \u00b6 2.1 \u5b89\u88c5 \u00b6 pip install virtualenvwrapper # linux \u4f7f\u7528\u8be5\u547d\u4ee4 pip install virtualenvwrapper-win\u3000\u3000# Windows\u4f7f\u7528\u8be5\u547d\u4ee4 \u6b64\u65f6\u8fd8\u4e0d\u80fd\u4f7f\u7528virtualenvwrapper\uff0c\u9ed8\u8ba4virtualenvwrapper\u5b89\u88c5\u5728/usr/local/bin\u4e0b\u9762\uff0c\u5b9e\u9645\u4e0a\u9700\u8981\u8fd0\u884cvirtualenvwrapper.sh\u6587\u4ef6\u624d\u884c\u3002\u4fee\u6539~/.bashrc\uff0c\u6dfb\u52a0\u4ee5\u4e0b\u8bed\u53e5 2.2 \u914d\u7f6e\u73af\u5883\u53d8\u91cf \u00b6 2.2.1 \u865a\u62df\u73af\u5883\u5bb6\u76ee\u5f55 \u00b6 sudo mkdir -p $WORKON_HOME 2.2.2 \u6dfb\u52a0\u914d\u7f6e \u00b6 \u5728~/.bashrc\u4e2d\u6700\u540e\u6dfb\u52a0 export WORKON_HOME=$HOME/.virtualenvs # \u6240\u6709\u865a\u62df\u73af\u5883\u7684\u5bb6\u76ee\u5f55 export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3 # \u6307\u5b9a\u865a\u62df\u73af\u5883\u7684python source /usr/local/bin/virtualenvwrapper.sh root@leco:~/book/books/docs/python/tools# source ~/.bashrc virtualenvwrapper.user_scripts creating /root/.virtualenvs/premkproject virtualenvwrapper.user_scripts creating /root/.virtualenvs/postmkproject virtualenvwrapper.user_scripts creating /root/.virtualenvs/initialize virtualenvwrapper.user_scripts creating /root/.virtualenvs/premkvirtualenv virtualenvwrapper.user_scripts creating /root/.virtualenvs/postmkvirtualenv virtualenvwrapper.user_scripts creating /root/.virtualenvs/prermvirtualenv virtualenvwrapper.user_scripts creating /root/.virtualenvs/postrmvirtualenv virtualenvwrapper.user_scripts creating /root/.virtualenvs/predeactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/postdeactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/preactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/postactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/get_env_details \u6b64\u65f6virtualenvwrapper\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e86\u3002 root@leco:/home/leco# ls $HOME/.virtualenvs get_env_details postactivate postmkproject postrmvirtualenv predeactivate premkvirtualenv zqxt initialize postdeactivate postmkvirtualenv preactivate premkproject prermvirtualenv root@leco:/home/leco# 2.3 \u6848\u4f8b \u00b6 # 1. \u5b89\u88c5\u865a\u62df\u73af\u5883 mkvirtualenv [\u865a\u62df\u73af\u5883\u540d\u79f0] root@leco:~/book/books/docs/python/tools# mkvirtualenv cmz Using base prefix '/usr/local' New python executable in /root/.virtualenvs/cmz/bin/python3.6 Also creating executable in /root/.virtualenvs/cmz/bin/python Installing setuptools, pip, wheel...done. virtualenvwrapper.user_scripts creating /root/.virtualenvs/cmz/bin/predeactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/cmz/bin/postdeactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/cmz/bin/preactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/cmz/bin/postactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/cmz/bin/get_env_details #2. \u67e5\u770b\u865a\u62df\u73af\u5883 (cmz) root@leco:~/book/books/docs/python/tools# workon cmz zqxt (cmz) root@leco:~/book/books/docs/python/tools# lsvirtualenv cmz === zqxt ==== # 3. \u5207\u6362\u5230\u865a\u62df\u73af\u5883 root@leco:/home/leco# workon cmz zqxt root@leco:/home/leco# workon cmz (cmz) root@leco:/home/leco# # 4. \u5220\u9664\u865a\u62df\u73af\u5883 root@leco:/home/leco# workon # \u67e5\u770b\u865a\u62df\u73af\u5883 cmz zqxt root@leco:/home/leco# rmvirtualenv cmz # \u5220\u9664\u865a\u62df\u73af\u5883 Removing cmz... root@leco:/home/leco# workon zqxt # 5. \u9000\u51fa\u865a\u62df\u73af\u5883 (cmz) root@leco:/home/leco# deactivate root@leco:/home/leco# \u9000\u51fa\u865a\u62df\u73af\u5883\u540e\uff0c\u524d\u9762\u865a\u62df\u73af\u5883\u540d\u5b57\u4e5f\u6d88\u5931\u4e86\u3002","title":"2. virtualenvwrapper"},{"location":"python/tools/virtualenvwrapper.index/#1","text":"virtualenv \u7684\u4e00\u4e2a\u6700\u5927\u7684\u7f3a\u70b9\u5c31\u662f\uff1a\u6bcf\u6b21\u5f00\u542f\u865a\u62df\u73af\u5883\u4e4b\u524d\u8981\u53bb\u865a\u62df\u73af\u5883\u6240\u5728\u76ee\u5f55\u4e0b\u7684 bin \u76ee\u5f55\u4e0b source \u4e00\u4e0b activate\uff0c\u8fd9\u5c31\u9700\u8981\u6211\u4eec\u8bb0\u4f4f\u6bcf\u4e2a\u865a\u62df\u73af\u5883\u6240\u5728\u7684\u76ee\u5f55\u3002\u5e76\u4e14\u8fd8\u6709\u53ef\u80fd\u4f60\u5fd8\u8bb0\u4e86\u865a\u62df\u73af\u5883\u653e\u5728\u54ea\u3002 \u4e00\u79cd\u53ef\u884c\u7684\u89e3\u51b3\u65b9\u6848\u662f\uff0c\u5c06\u6240\u6709\u7684\u865a\u62df\u73af\u5883\u76ee\u5f55\u5168\u90fd\u96c6\u4e2d\u8d77\u6765\uff0c\u4f8b\u5982/opt/all_venv/\uff0c\u5e76\u4e14\u9488\u5bf9\u4e0d\u540c\u7684\u76ee\u5f55\u505a\u4e0d\u540c\u7684\u4e8b\u3002 \u4f7f\u7528virtualenvwrapper\u7ba1\u7406\u4f60\u7684\u865a\u62df\u73af\u5883\uff08virtualenv\uff09\uff0c\u5176\u5b9e\u4ed6\u5c31\u662f\u7edf\u4e00\u7ba1\u7406\u865a\u62df\u73af\u5883\u7684\u76ee\u5f55\uff0c\u5e76\u4e14\u7701\u53bb\u4e86source\u7684\u6b65\u9aa4\u3002 \u5217\u51fa\u865a\u62df\u73af\u5883\u5217\u8868: workon | lsvirtualenv \u65b0\u5efa\u865a\u62df\u73af\u5883: mkvirtualenv [\u865a\u62df\u73af\u5883\u540d\u79f0] \u542f\u52a8/\u5207\u6362\u865a\u62df\u73af\u5883: workon [\u865a\u62df\u73af\u5883\u540d\u79f0] \u5220\u9664\u865a\u62df\u73af\u5883: rmvirtualenv [\u865a\u62df\u73af\u5883\u540d\u79f0]","title":"1. \u4ecb\u7ecd"},{"location":"python/tools/virtualenvwrapper.index/#2-virtualenvwrapper","text":"","title":"2 virtualenvwrapper"},{"location":"python/tools/virtualenvwrapper.index/#21","text":"pip install virtualenvwrapper # linux \u4f7f\u7528\u8be5\u547d\u4ee4 pip install virtualenvwrapper-win\u3000\u3000# Windows\u4f7f\u7528\u8be5\u547d\u4ee4 \u6b64\u65f6\u8fd8\u4e0d\u80fd\u4f7f\u7528virtualenvwrapper\uff0c\u9ed8\u8ba4virtualenvwrapper\u5b89\u88c5\u5728/usr/local/bin\u4e0b\u9762\uff0c\u5b9e\u9645\u4e0a\u9700\u8981\u8fd0\u884cvirtualenvwrapper.sh\u6587\u4ef6\u624d\u884c\u3002\u4fee\u6539~/.bashrc\uff0c\u6dfb\u52a0\u4ee5\u4e0b\u8bed\u53e5","title":"2.1 \u5b89\u88c5"},{"location":"python/tools/virtualenvwrapper.index/#22","text":"","title":"2.2 \u914d\u7f6e\u73af\u5883\u53d8\u91cf"},{"location":"python/tools/virtualenvwrapper.index/#221","text":"sudo mkdir -p $WORKON_HOME","title":"2.2.1 \u865a\u62df\u73af\u5883\u5bb6\u76ee\u5f55"},{"location":"python/tools/virtualenvwrapper.index/#222","text":"\u5728~/.bashrc\u4e2d\u6700\u540e\u6dfb\u52a0 export WORKON_HOME=$HOME/.virtualenvs # \u6240\u6709\u865a\u62df\u73af\u5883\u7684\u5bb6\u76ee\u5f55 export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3 # \u6307\u5b9a\u865a\u62df\u73af\u5883\u7684python source /usr/local/bin/virtualenvwrapper.sh root@leco:~/book/books/docs/python/tools# source ~/.bashrc virtualenvwrapper.user_scripts creating /root/.virtualenvs/premkproject virtualenvwrapper.user_scripts creating /root/.virtualenvs/postmkproject virtualenvwrapper.user_scripts creating /root/.virtualenvs/initialize virtualenvwrapper.user_scripts creating /root/.virtualenvs/premkvirtualenv virtualenvwrapper.user_scripts creating /root/.virtualenvs/postmkvirtualenv virtualenvwrapper.user_scripts creating /root/.virtualenvs/prermvirtualenv virtualenvwrapper.user_scripts creating /root/.virtualenvs/postrmvirtualenv virtualenvwrapper.user_scripts creating /root/.virtualenvs/predeactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/postdeactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/preactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/postactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/get_env_details \u6b64\u65f6virtualenvwrapper\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e86\u3002 root@leco:/home/leco# ls $HOME/.virtualenvs get_env_details postactivate postmkproject postrmvirtualenv predeactivate premkvirtualenv zqxt initialize postdeactivate postmkvirtualenv preactivate premkproject prermvirtualenv root@leco:/home/leco#","title":"2.2.2 \u6dfb\u52a0\u914d\u7f6e"},{"location":"python/tools/virtualenvwrapper.index/#23","text":"# 1. \u5b89\u88c5\u865a\u62df\u73af\u5883 mkvirtualenv [\u865a\u62df\u73af\u5883\u540d\u79f0] root@leco:~/book/books/docs/python/tools# mkvirtualenv cmz Using base prefix '/usr/local' New python executable in /root/.virtualenvs/cmz/bin/python3.6 Also creating executable in /root/.virtualenvs/cmz/bin/python Installing setuptools, pip, wheel...done. virtualenvwrapper.user_scripts creating /root/.virtualenvs/cmz/bin/predeactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/cmz/bin/postdeactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/cmz/bin/preactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/cmz/bin/postactivate virtualenvwrapper.user_scripts creating /root/.virtualenvs/cmz/bin/get_env_details #2. \u67e5\u770b\u865a\u62df\u73af\u5883 (cmz) root@leco:~/book/books/docs/python/tools# workon cmz zqxt (cmz) root@leco:~/book/books/docs/python/tools# lsvirtualenv cmz === zqxt ==== # 3. \u5207\u6362\u5230\u865a\u62df\u73af\u5883 root@leco:/home/leco# workon cmz zqxt root@leco:/home/leco# workon cmz (cmz) root@leco:/home/leco# # 4. \u5220\u9664\u865a\u62df\u73af\u5883 root@leco:/home/leco# workon # \u67e5\u770b\u865a\u62df\u73af\u5883 cmz zqxt root@leco:/home/leco# rmvirtualenv cmz # \u5220\u9664\u865a\u62df\u73af\u5883 Removing cmz... root@leco:/home/leco# workon zqxt # 5. \u9000\u51fa\u865a\u62df\u73af\u5883 (cmz) root@leco:/home/leco# deactivate root@leco:/home/leco# \u9000\u51fa\u865a\u62df\u73af\u5883\u540e\uff0c\u524d\u9762\u865a\u62df\u73af\u5883\u540d\u5b57\u4e5f\u6d88\u5931\u4e86\u3002","title":"2.3 \u6848\u4f8b"},{"location":"syntax/code_block/","text":"4\u4e2a\u7a7a\u683c \u00b6 \u5728\u6bcf\u884c\u524d\u9762\u52a0\u4e0a4\u4e2a\u7a7a\u683c text = \"Hello, world!\" print text \u6548\u679c text = \"Hello, world!\" print text 3\u4e2a ` \u00b6 ```text text = \"Hello, world!\" print text ``` \u6548\u679c text = \"Hello, world!\" print text \u6ce81: \u652f\u6301\u4ee3\u7801\u9ad8\u4eae \uff0c\u8be6\u89c1\" \u533a\u5757\u4ee3\u7801\u9ad8\u4eae \" \u6ce82: \u5982\u679c\u4ee3\u7801\u533a\u5757\u4e0a\u65b9\u662f\u5217\u8868\uff0c\u5982 \u65e0\u5e8f\u5217\u8868 \u6216 \u6709\u5e8f\u5217\u8868 \uff0c\u90a3\u4e484\u4e2a\u7a7a\u683c\u4e0d\u4f1a\u88ab\u89e3\u6790\u4e3a\u4ee3\u7801\u533a\u5757\uff0c\u800c\u662f\u88ab\u89e3\u6790\u4e3a\u4e00\u4e2a\u666e\u901a\u7f29\u8fdb","title":"6.2. \u533a\u5757"},{"location":"syntax/code_block/#4","text":"\u5728\u6bcf\u884c\u524d\u9762\u52a0\u4e0a4\u4e2a\u7a7a\u683c text = \"Hello, world!\" print text \u6548\u679c text = \"Hello, world!\" print text","title":"4\u4e2a\u7a7a\u683c"},{"location":"syntax/code_block/#3","text":"```text text = \"Hello, world!\" print text ``` \u6548\u679c text = \"Hello, world!\" print text \u6ce81: \u652f\u6301\u4ee3\u7801\u9ad8\u4eae \uff0c\u8be6\u89c1\" \u533a\u5757\u4ee3\u7801\u9ad8\u4eae \" \u6ce82: \u5982\u679c\u4ee3\u7801\u533a\u5757\u4e0a\u65b9\u662f\u5217\u8868\uff0c\u5982 \u65e0\u5e8f\u5217\u8868 \u6216 \u6709\u5e8f\u5217\u8868 \uff0c\u90a3\u4e484\u4e2a\u7a7a\u683c\u4e0d\u4f1a\u88ab\u89e3\u6790\u4e3a\u4ee3\u7801\u533a\u5757\uff0c\u800c\u662f\u88ab\u89e3\u6790\u4e3a\u4e00\u4e2a\u666e\u901a\u7f29\u8fdb","title":"3\u4e2a `"},{"location":"syntax/code_highlight/","text":"\u9ad8\u4eae\u90e8\u5206\u8be6\u89c1 \u4ee3\u7801\u9ad8\u4eae \u7ae0\u8282","title":"6.3. \u9ad8\u4eae"},{"location":"syntax/code_inline/","text":"\u5728\u4e00\u884c\u5185\u8981\u6807\u8bb0\u7684\u6587\u672c\u524d\u540e\u5404\u52a0\u4e00\u4e2a ` AAA`BBB`CCC \u6548\u679c\uff1a AAA BBB CCC \u6ce8: \u652f\u6301\u4ee3\u7801\u9ad8\u4eae \uff0c\u8be6\u89c1\" \u884c\u5185\u4ee3\u7801\u9ad8\u4eae \"","title":"6.1. \u884c\u5185"},{"location":"syntax/cutline/","text":"\u5206\u5272\u7ebf\u4f7f\u7528\u4e09\u4e2a\u6216\u4ee5\u4e0a * \uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 - \u548c _ \uff0c\u4e0b\u9762\u4ec5\u4ee5 - \u4f5c\u4e3a\u793a\u4f8b --- \u6548\u679c","title":"9. \u5206\u5272\u7ebf"},{"location":"syntax/emoji_main/","text":"\u4ec0\u4e48\u662femoji \u00b6 emoji\u662f\u65e5\u672c\u5728\u65e0\u7ebf\u901a\u4fe1\u4e2d\u6240\u4f7f\u7528\u7684\u89c6\u89c9\u60c5\u611f\u7b26\u53f7\uff0c\u5df2\u88abunicode\u91c7\u7eb3\uff0c\u5f53\u524dunicode\u5305\u542b\u4e86\u975e\u5e38\u591a\u7684emoji\u56fe\u6807\uff0c\u6bcf\u4e00\u6b21unicode\u66f4\u65b0\u90fd\u4f1a\u53d1\u5e03\u65b0\u7684emoji\u56fe\u6807\u3002\u53ea\u8981\u64cd\u4f5c\u7cfb\u7edf\u652f\u6301unicode\uff0c\u5c31\u80fd\u5728\u4efb\u610f\u4f7f\u7528unicode\u7f16\u7801\u7684\u5730\u65b9\u770b\u5230\u6f02\u4eae\u7684\u5f69\u8272\u56fe\u6807\uff0c\u6bd4\u5982\u6587\u672c\u3001mysql\u8868\u91cc\u3001\u7f51\u9875\u3002 emoji\u73b0\u72b6 \u00b6 \u867d\u7136unicode\u5b98\u7f51\u53ef\u4ee5\u67e5\u5230\u6240\u6709emoji\u56fe\u6807\uff0c\u4f46\u5e76\u672a\u63d0\u4f9b\u4e00\u4e2a\u4fbf\u5229\u7684\u56fe\u6807\u5206\u7c7b\u67e5\u8be2\u548c\u4f7f\u7528\u65b9\u6cd5\u3002\u56e0\u6b64\u5c31\u6709\u4e00\u4e9b\u7b2c\u4e09\u65b9emoji\u5382\u5546\u5c06\u90e8\u5206emoji\u56fe\u6807\uff0c\u5236\u4f5c\u6210\u4e0d\u540c\u683c\u5f0f\u3001\u4e0d\u540c\u5c3a\u5bf8(\u4f8b\u598264x64 PNG\u3001128x128 PNG\u6216SVG\u7b49\u683c\u5f0f)\u7684\u56fe\u7247\u653e\u5165\u81ea\u5df1\u7684CDN\u5e93\u3002\u7136\u540e\u5c06\u8fd9\u4e9bCDN\u56fe\u7247\u4ee5\u514d\u8d39\u6216\u4ed8\u8d39\u65b9\u5f0f\u5bf9\u5916\u63d0\u4f9b\u3002 \u5982\u4f55\u83b7\u5f97emoji \u00b6 \u6839\u636e\u4f7f\u7528\u9700\u6c42\u5206\u4e3a2\u79cd: \u4e0d\u6ee1\u8db3\u4e8eunicode\u7684emoji\u56fe\u6807\uff0c\u5e0c\u671b\u66f4\u597d\u770b\uff0c\u5e76\u4e14\u5c3a\u5bf8\u53ef\u9009\uff0c\u90a3\u4e48\u5c31\u4f7f\u7528\u7b2c\u4e09\u65b9emoji\u5382\u5546\u5e93\uff0c\u63a8\u8350\u4f7f\u7528EmojiOne\u7684png\u56fe\u5e93\uff0c\u5206\u4e3a\u514d\u8d39\u548c\u4ed8\u8d39\uff0c\u5176\u4e2d\u514d\u8d39\u7684\u56fe\u5e93\u5df2\u8db3\u591f\u6ee1\u8db3\u4e00\u822c\u6027\u4f7f\u7528\u9700\u6c42\uff0c\u5982\u679c\u60f3\u4f7f\u7528svg\uff0c\u514d\u8d39\u7684\u53ea\u6709EmojiOne-2.2.7\u4ee5\u5185\u7248\u672c\uff0c\u6700\u65b0\u7684svg\u90fd\u662f\u8981\u4ed8\u8d39\u7684\u3002\u4f7f\u7528\u65b9\u6cd5\u662f\u5728\u6587\u6863\u91cc\u7528 :\u77ed\u540d \u6765\u8ba9mkdocs\u81ea\u52a8\u5339\u914d\u5e76\u6e32\u67d3\u4e3a \u6807\u7b7e \u4e3e\u4f8b\u8bf4\u660e2.2.7\u4e0e\u9ad8\u7248\u672c\u533a\u522b \u5982\u679c\u7528\u7684 :\u77ed\u540d: \u662f2.2.7\u5305\u542b\u7684\uff0c\u90a3\u4e48\u56fe\u6807\u80fd\u6b63\u5e38\u663e\u793a\uff0c\u5426\u5219\u663e\u793a\u4e0d\u51fa\u6765 \u6bd4\u5982\uff1a https://cdn.jsdelivr.net/emojione/assets/svg/1f600.svg \u8fd9\u4e2a\u662f2.2.7\u5c31\u6709\u7684\uff0c\u8bbf\u95ee\u8fd9\u4e2aurl\u53ef\u4ee5\u770b\u5230\u56fe\u6807 https://cdn.jsdelivr.net/emojione/assets/svg/1f92e.svg \u8fd9\u4e2a\u662f2.2.7\u4e4b\u540e\u624d\u6709\u7684\uff0c\u9700\u8981\u4ed8\u8d39\u624d\u80fd\u83b7\u5f97\u56fe\u6807\uff0c\u672a\u4ed8\u8d39\u76f4\u63a5\u8bbf\u95ee\u4f1a\u5f97\u5230\u62a5\u9519\uff1a https://cdn.jsdelivr.net/emojione/assets/3.1/png/64/1f92e.png \u8fd9\u4e2a\u662fpng\uff0c\u4e0d\u5c5e\u4e8e\u4ed8\u8d39\u90e8\u5206\uff0c\u8bbf\u95ee\u8fd9\u4e2aurl\u53ef\u4ee5\u770b\u5230\u56fe\u6807 \u56e0\u6b64\u63a8\u8350\u7684\u6700\u4f73\u5165\u95e8\u5b9e\u8df5\u5e94\u5f53\u662f\u9996\u9009png\u3002 \u80fd\u591f\u63a5\u53d7unicode\u7684emoji\u56fe\u6807\uff0c\u5c31\u7b80\u5355\u4e86\uff0c\u76f4\u63a5\u5c06\u56fe\u6807\u590d\u5236\u7c98\u8d34\u5230\u6587\u672c\u91cc\u5373\u53ef \u8fd92\u79cd\u65b9\u6cd5\u5e76\u4e0d\u51b2\u7a81\uff0c\u53ef\u4ee5\u5728\u4e00\u4e2amarkdown\u6587\u672c\u91cc\u6df7\u5408\u4f7f\u7528","title":"18.1. \u4ecb\u7ecd"},{"location":"syntax/emoji_main/#emoji","text":"emoji\u662f\u65e5\u672c\u5728\u65e0\u7ebf\u901a\u4fe1\u4e2d\u6240\u4f7f\u7528\u7684\u89c6\u89c9\u60c5\u611f\u7b26\u53f7\uff0c\u5df2\u88abunicode\u91c7\u7eb3\uff0c\u5f53\u524dunicode\u5305\u542b\u4e86\u975e\u5e38\u591a\u7684emoji\u56fe\u6807\uff0c\u6bcf\u4e00\u6b21unicode\u66f4\u65b0\u90fd\u4f1a\u53d1\u5e03\u65b0\u7684emoji\u56fe\u6807\u3002\u53ea\u8981\u64cd\u4f5c\u7cfb\u7edf\u652f\u6301unicode\uff0c\u5c31\u80fd\u5728\u4efb\u610f\u4f7f\u7528unicode\u7f16\u7801\u7684\u5730\u65b9\u770b\u5230\u6f02\u4eae\u7684\u5f69\u8272\u56fe\u6807\uff0c\u6bd4\u5982\u6587\u672c\u3001mysql\u8868\u91cc\u3001\u7f51\u9875\u3002","title":"\u4ec0\u4e48\u662femoji"},{"location":"syntax/emoji_main/#emoji_1","text":"\u867d\u7136unicode\u5b98\u7f51\u53ef\u4ee5\u67e5\u5230\u6240\u6709emoji\u56fe\u6807\uff0c\u4f46\u5e76\u672a\u63d0\u4f9b\u4e00\u4e2a\u4fbf\u5229\u7684\u56fe\u6807\u5206\u7c7b\u67e5\u8be2\u548c\u4f7f\u7528\u65b9\u6cd5\u3002\u56e0\u6b64\u5c31\u6709\u4e00\u4e9b\u7b2c\u4e09\u65b9emoji\u5382\u5546\u5c06\u90e8\u5206emoji\u56fe\u6807\uff0c\u5236\u4f5c\u6210\u4e0d\u540c\u683c\u5f0f\u3001\u4e0d\u540c\u5c3a\u5bf8(\u4f8b\u598264x64 PNG\u3001128x128 PNG\u6216SVG\u7b49\u683c\u5f0f)\u7684\u56fe\u7247\u653e\u5165\u81ea\u5df1\u7684CDN\u5e93\u3002\u7136\u540e\u5c06\u8fd9\u4e9bCDN\u56fe\u7247\u4ee5\u514d\u8d39\u6216\u4ed8\u8d39\u65b9\u5f0f\u5bf9\u5916\u63d0\u4f9b\u3002","title":"emoji\u73b0\u72b6"},{"location":"syntax/emoji_main/#emoji_2","text":"\u6839\u636e\u4f7f\u7528\u9700\u6c42\u5206\u4e3a2\u79cd: \u4e0d\u6ee1\u8db3\u4e8eunicode\u7684emoji\u56fe\u6807\uff0c\u5e0c\u671b\u66f4\u597d\u770b\uff0c\u5e76\u4e14\u5c3a\u5bf8\u53ef\u9009\uff0c\u90a3\u4e48\u5c31\u4f7f\u7528\u7b2c\u4e09\u65b9emoji\u5382\u5546\u5e93\uff0c\u63a8\u8350\u4f7f\u7528EmojiOne\u7684png\u56fe\u5e93\uff0c\u5206\u4e3a\u514d\u8d39\u548c\u4ed8\u8d39\uff0c\u5176\u4e2d\u514d\u8d39\u7684\u56fe\u5e93\u5df2\u8db3\u591f\u6ee1\u8db3\u4e00\u822c\u6027\u4f7f\u7528\u9700\u6c42\uff0c\u5982\u679c\u60f3\u4f7f\u7528svg\uff0c\u514d\u8d39\u7684\u53ea\u6709EmojiOne-2.2.7\u4ee5\u5185\u7248\u672c\uff0c\u6700\u65b0\u7684svg\u90fd\u662f\u8981\u4ed8\u8d39\u7684\u3002\u4f7f\u7528\u65b9\u6cd5\u662f\u5728\u6587\u6863\u91cc\u7528 :\u77ed\u540d \u6765\u8ba9mkdocs\u81ea\u52a8\u5339\u914d\u5e76\u6e32\u67d3\u4e3a \u6807\u7b7e \u4e3e\u4f8b\u8bf4\u660e2.2.7\u4e0e\u9ad8\u7248\u672c\u533a\u522b \u5982\u679c\u7528\u7684 :\u77ed\u540d: \u662f2.2.7\u5305\u542b\u7684\uff0c\u90a3\u4e48\u56fe\u6807\u80fd\u6b63\u5e38\u663e\u793a\uff0c\u5426\u5219\u663e\u793a\u4e0d\u51fa\u6765 \u6bd4\u5982\uff1a https://cdn.jsdelivr.net/emojione/assets/svg/1f600.svg \u8fd9\u4e2a\u662f2.2.7\u5c31\u6709\u7684\uff0c\u8bbf\u95ee\u8fd9\u4e2aurl\u53ef\u4ee5\u770b\u5230\u56fe\u6807 https://cdn.jsdelivr.net/emojione/assets/svg/1f92e.svg \u8fd9\u4e2a\u662f2.2.7\u4e4b\u540e\u624d\u6709\u7684\uff0c\u9700\u8981\u4ed8\u8d39\u624d\u80fd\u83b7\u5f97\u56fe\u6807\uff0c\u672a\u4ed8\u8d39\u76f4\u63a5\u8bbf\u95ee\u4f1a\u5f97\u5230\u62a5\u9519\uff1a https://cdn.jsdelivr.net/emojione/assets/3.1/png/64/1f92e.png \u8fd9\u4e2a\u662fpng\uff0c\u4e0d\u5c5e\u4e8e\u4ed8\u8d39\u90e8\u5206\uff0c\u8bbf\u95ee\u8fd9\u4e2aurl\u53ef\u4ee5\u770b\u5230\u56fe\u6807 \u56e0\u6b64\u63a8\u8350\u7684\u6700\u4f73\u5165\u95e8\u5b9e\u8df5\u5e94\u5f53\u662f\u9996\u9009png\u3002 \u80fd\u591f\u63a5\u53d7unicode\u7684emoji\u56fe\u6807\uff0c\u5c31\u7b80\u5355\u4e86\uff0c\u76f4\u63a5\u5c06\u56fe\u6807\u590d\u5236\u7c98\u8d34\u5230\u6587\u672c\u91cc\u5373\u53ef \u8fd92\u79cd\u65b9\u6cd5\u5e76\u4e0d\u51b2\u7a81\uff0c\u53ef\u4ee5\u5728\u4e00\u4e2amarkdown\u6587\u672c\u91cc\u6df7\u5408\u4f7f\u7528","title":"\u5982\u4f55\u83b7\u5f97emoji"},{"location":"syntax/emoji_principle/","text":"\u672c\u6587\u4e2d\u4e3b\u8981\u4ecb\u7ecdmkdocs\u4f9d\u8d56pymdownx.emoji\u8fdb\u884c\u5339\u914d\u3001\u6e32\u67d3\uff0c\u56e0\u6b64\u4e0b\u9762\u7684\u8bf4\u660e\u5747\u662f\u5173\u4e8epymdownx.emoji\u3002 pymdownx\u652f\u63013\u4e2a\u4e3b\u6d41\u7684emoji\u5382\u5546\uff1aGemoji\uff08github.com\u505a\u7684\uff09\u3001EmojiOne\uff08\u7b2c\u4e09\u65b9\u7684\uff0c\u5206\u4e3a\u514d\u8d39\u7248\u3001\u4ed8\u8d39\u7248\u3001\u6218\u7565\u5408\u4f5c\u7248\uff09\u3001Twemoji\uff08twitter\u505a\u7684\uff09\uff0cpymdownx\u5b98\u65b9\u63a8\u8350\u7528EmojiOne\uff0c\u9ed8\u8ba4\u4e5f\u662fEmojiOne \u67092\u4e2a\u5173\u952e\u53c2\u6570 \u00b6 emoji_index\uff0c\u9009\u62e9emoji\u5382\u5546\uff0c\u9ed8\u8ba4\u4e3aEmojiOne emoji_generator\uff0c\u9009\u62e9\u5382\u5546\u5bf9\u5e94\u7684\u56fe\u7247\u683c\u5f0f\uff0c\u9ed8\u8ba4\u4e3ato_png generator\u67093\u7c7b \u00b6 to_png/to_svg : markdown\u5728\u6e32\u67d3\u65f6\u5019\uff0c\u5176\u4e2d\u7684 :\u77ed\u540d: \u6839\u636eemoji_index(\u5373Gemoji/EmojiOne/Twemoji)\u88ab\u6620\u5c04\u4e3a\u76f8\u5e94\u7684unicode\u7801 unicode\u7801\u88ab\u8f6c\u4e3aemoji_index\u5bf9\u5e94\u7684\u56fe\u7247CDN\u5730\u5740(Gemoji/EmojiOne/Twemoji\u90fd\u6709\u5404\u81ea\u7684CDN) \u6e32\u67d3\u6210html\u65f6\u5019\u56fe\u7247\u5730\u5740\u88ab\u5199\u5165 \u6807\u7b7e to_png_sprite/to_svg_sprite : \u6682\u4e0d\u4e86\u89e3 to_alt : markdown\u5728\u6e32\u67d3\u65f6\u5019\uff0c\u5176\u4e2d\u7684 :\u77ed\u540d: \u6839\u636eemoji_index(\u5373Gemoji/EmojiOne/Twemoji)\u88ab\u6620\u5c04\u4e3a\u76f8\u5e94\u7684unicode\u7801 \u6e32\u67d3\u6210html\u65f6\u5019unicode\u7801\u88ab\u76f4\u63a5\u5199\u5165 \u6807\u7b7e to_alt\u6548\u679c\u7b49\u540c\u4e8e\u76f4\u63a5\u5c06emoji\u56fe\u6807\u590d\u5236\u5230markdown\u6587\u6863\u4e2d","title":"18.2. \u5de5\u4f5c\u539f\u7406"},{"location":"syntax/emoji_principle/#2","text":"emoji_index\uff0c\u9009\u62e9emoji\u5382\u5546\uff0c\u9ed8\u8ba4\u4e3aEmojiOne emoji_generator\uff0c\u9009\u62e9\u5382\u5546\u5bf9\u5e94\u7684\u56fe\u7247\u683c\u5f0f\uff0c\u9ed8\u8ba4\u4e3ato_png","title":"\u67092\u4e2a\u5173\u952e\u53c2\u6570"},{"location":"syntax/emoji_principle/#generator3","text":"to_png/to_svg : markdown\u5728\u6e32\u67d3\u65f6\u5019\uff0c\u5176\u4e2d\u7684 :\u77ed\u540d: \u6839\u636eemoji_index(\u5373Gemoji/EmojiOne/Twemoji)\u88ab\u6620\u5c04\u4e3a\u76f8\u5e94\u7684unicode\u7801 unicode\u7801\u88ab\u8f6c\u4e3aemoji_index\u5bf9\u5e94\u7684\u56fe\u7247CDN\u5730\u5740(Gemoji/EmojiOne/Twemoji\u90fd\u6709\u5404\u81ea\u7684CDN) \u6e32\u67d3\u6210html\u65f6\u5019\u56fe\u7247\u5730\u5740\u88ab\u5199\u5165 \u6807\u7b7e to_png_sprite/to_svg_sprite : \u6682\u4e0d\u4e86\u89e3 to_alt : markdown\u5728\u6e32\u67d3\u65f6\u5019\uff0c\u5176\u4e2d\u7684 :\u77ed\u540d: \u6839\u636eemoji_index(\u5373Gemoji/EmojiOne/Twemoji)\u88ab\u6620\u5c04\u4e3a\u76f8\u5e94\u7684unicode\u7801 \u6e32\u67d3\u6210html\u65f6\u5019unicode\u7801\u88ab\u76f4\u63a5\u5199\u5165 \u6807\u7b7e to_alt\u6548\u679c\u7b49\u540c\u4e8e\u76f4\u63a5\u5c06emoji\u56fe\u6807\u590d\u5236\u5230markdown\u6587\u6863\u4e2d","title":"generator\u67093\u7c7b"},{"location":"syntax/emoji_usage/","text":"\u901a\u8fc7\u5728markdown\u91cc\u4f7f\u7528 :\u77ed\u540d: \uff0c\u53ef\u4ee5\u5728\u6e32\u67d3\u51fa\u7684html\u91cc\u5c55\u73b0emoji\u56fe\u7247 \u4f9d\u8d56\u6a21\u5757: pymdownx.emoji \u4f7f\u7528\u6b65\u9aa4: mkdocs.yml\u91cc\u914d\u7f6e: - pymdownx.emoji : emoji_generator : !!python/name:pymdownx.emoji.to_png \u5efa\u8bae\u4f7f\u7528to_png\uff0c\u5982\u679c\u4f7f\u7528to_svg\u4f1a\u6709\u90e8\u5206\u56fe\u7247\u56e0\u4e3a\u672a\u4ed8\u8d39\u5bfc\u81f4\u65e0\u6cd5\u663e\u793a \u6d4f\u89c8\u5668\u6253\u5f00 https://www.emojicopy.com/ (emojione\u5b98\u65b9\u63a8\u51fa\u7684emoji\u67e5\u8be2\u7f51\u7ad9\uff0c\u867d\u7136\u5e76\u975e\u5168\u90e8emoji\uff0c\u4f46\u4e5f\u662f\u76ee\u524d\u627e\u5230\u7684\u76f8\u5bf9\u6700\u5168\uff0c\u5e76\u4e14\u5206\u7c7b\u6e05\u695a\uff0c\u4f7f\u7528\u65b9\u4fbf\u7684emoji\u67e5\u8be2\u7f51\u7ad9)\uff0c\u5c06\u9f20\u6807\u60ac\u505c\u5728\u56fe\u6807\u4e0a\u65b9\u4e00\u4f1a\uff0c\u4f1a\u51fa\u73b0\u5bf9\u5e94\u7684\u5168\u540d\uff0c\u6bd4\u5982 \u8bb0\u5f55\u4e0b\u8fd9\u4e2a\u5168\u540d\uff0c\u6bd4\u5982\u8fd9\u91cc\u53eb\u505agrinning face \u70b9\u51fb\u8fdb\u5165\u9644\u5f55\u91cc\u7684 emojione\u5168\u540d\u77ed\u540d\u6620\u5c04\u8868 \uff0c\u5728\u91cc\u9762\u67e5\u627e\u5bf9\u5e94\u7684\u77ed\u540d \u5728markdown\u91cc\u4f7f\u7528\u8be5\u77ed\u540d \u6700\u7701\u4e8b\u505a\u6cd5: \u76f4\u63a5\u590d\u5236emoji\u56fe\u6807 \u65e0\u9700mkdocs.yml\u505a\u4efb\u4f55\u914d\u7f6e\uff0c\u53ea\u8981\u662femoji\u56fe\u6807(\u662f\u56fe\u6807\u4e0d\u662f\u56fe\u7247)\uff0c\u65e0\u8bba\u662f\u8f93\u5165\u6cd5\u81ea\u5e26\u7684emoji\u56fe\u6807\uff0c\u8fd8\u662f https://www.emojicopy.com/ \u4e0a\u7684emoji\u56fe\u6807\uff0c\u90fd\u53ef\u4ee5\u76f4\u63a5\u590d\u5236\u7c98\u8d34\u5230markdown\u6587\u6863\u91cc\u5373\u53ef\u3002\u6bd4\u5982\u8fd9\u4e2a\u7b11\u8138\ud83d\ude04\u5c31\u6765\u81ea\u6211\u7684\u8f93\u5165\u6cd5\uff0c\u53ef\u4ee5\u81ea\u884c\u590d\u5236\u5230markdown\u6587\u6863\u91cc\u6d4b\u8bd5\u3002 \u800c\u4e14\u8fd9\u79cd\u65b9\u5f0f\u9002\u7528\u4e8e\u6240\u6709markdown\u7f16\u8f91\u5668\u3002","title":"18.3. \u6700\u4f73\u5b9e\u8df5"},{"location":"syntax/escape/","text":"\u63a8\u8350\u4f9d\u7167\u5982\u4e0b\u987a\u5e8f\u8fdb\u884c\u8f6c\u4e49\u5c1d\u8bd5 1\u20e3\ufe0f \u4f7f\u7528\u8f6c\u4e49\u7b26\u53f7 \\ 2\u20e3\ufe0f \u4f7f\u7528 \u884c\u5185\u4ee3\u7801 \u6216 \u533a\u5757\u4ee3\u7801 \u65b9\u5f0f 3\u20e3\ufe0f \u5728\u884c\u5185\u4ee3\u7801\u6216\u533a\u5757\u4ee3\u7801\u91cc\u518d\u4f7f\u7528\u8f6c\u4e49\u7b26\u53f7 \\ 4\u20e3\ufe0f html\u6807\u7b7e: &lt;code&gt;\u9700\u8981\u8f6c\u4e49\u7684\u5185\u5bb9&lt;/code&gt; \u5982\u679c\u4e0a\u9762\u90fd\u884c\u4e0d\u901a\uff0c\u53ea\u6709\u6700\u540e\u4e00\u62db\uff0c\u622a\u56fe\u5e76 \u63d2\u5165\u56fe\u7247 \u63a8\u8350\u7684\u622a\u56fe\u65b9\u5f0f \u628a\u8981\u8f6c\u4e49\u7684\u6587\u672c\u590d\u5236\u5230\u5fae\u4fe1\u804a\u5929\u5bf9\u8bdd\u8f93\u5165\u6846\u91cc\uff0c\u7136\u540e\u7528\u4efb\u610f\u622a\u56fe\u5de5\u5177\u5bf9\u7740\u8f93\u5165\u6846\u622a\u56fe\uff0c\u8fd9\u6837\u622a\u56fe\u51fa\u6765\u7684\u5e26\u6709\u7070\u8272\u80cc\u666f\uff0c\u5373\u4ee3\u7801\u5757\u90a3\u79cd\u7070\u8272\u80cc\u666f\uff08\u4f1a\u8ba9\u4eba\u89c9\u5f97\u662f\u4f7f\u7528\u4ee3\u7801\u5757\u65b9\u5f0f\u5728\u8868\u8ff0\uff09\u3002 \u6ce8\u610f\u4e0a\u4e0b\u6587 \u76f8\u540c\u7684\u7b26\u53f7\uff0c\u4f1a\u56e0\u4e3a\u4e0a\u4e0b\u6587\u73af\u5883\u88abmkdocs\u8ba4\u4e3a\u662f\u4e0d\u540c\u7684\u610f\u601d\uff0c\u56e0\u6b64\u6709\u65f6\u4f1a\u9047\u5230\u4e00\u4e9b\u7b26\u53f7\u5728\u6709\u7684\u4e0a\u4e0b\u6587\u73af\u5883\u91cc\u53ef\u4ee5\u4f7f\u7528\u6216\u8f6c\u4e49\uff0c\u6709\u7684\u5c31\u4e0d\u884c\uff0c\u6bd4\u5982\u8ddf\u5728\u5217\u8868\u4e4b\u540e\u548c\u8ddf\u7740\u6807\u9898\u4e4b\u540e\u662f\u4e0d\u540c\u4e0a\u4e0b\u6587\u73af\u5883\u3002 \u6211\u7684\u6848\u4f8b \u53ef\u4ee5\u4e0agithub\u67e5\u770b\u672c\u6587\u6863\u4e2d\u8f6c\u4e49\u7ae0\u8282\u7684markdown\u6e90\u6587\u4ef6\uff0c\u5176\u4e2d\u5927\u91cf\u4f7f\u7528\u4e86\u8f6c\u4e49","title":"12. \u8f6c\u4e49"},{"location":"syntax/font_line/","text":"\u4e0d\u5e26\u9ad8\u4eae \u00b6 \u4f9d\u8d56\u6a21\u5757: pymdownx.critic This is ~~is~~ a test. \u6548\u679c This is is a test. \u80cc\u666f\u9ad8\u4eae \u00b6 \u8be6\u89c1 \u9ad8\u4eae\u7ae0\u8282\u6a2a\u7ebf\u90e8\u5206","title":"7.4. \u6a2a\u7ebf"},{"location":"syntax/font_line/#_1","text":"\u4f9d\u8d56\u6a21\u5757: pymdownx.critic This is ~~is~~ a test. \u6548\u679c This is is a test.","title":"\u4e0d\u5e26\u9ad8\u4eae"},{"location":"syntax/font_line/#_2","text":"\u8be6\u89c1 \u9ad8\u4eae\u7ae0\u8282\u6a2a\u7ebf\u90e8\u5206","title":"\u80cc\u666f\u9ad8\u4eae"},{"location":"syntax/font_stress/","text":"\u4f9d\u8d56\u6a21\u5757: pymdownx.betterem(smart_enable=all) *text* \u6216 _text_ \u659c\u4f53 **text** \u6216 __text__ \u7c97\u4f53 ***text*** \u6216 ___text___ \u7c97\u659c\u4f53 \u6548\u679c text \u659c\u4f53 text \u7c97\u4f53 text \u7c97\u659c\u4f53 \u907f\u514d\u51b2\u7a81 \u8fd9\u4e2a\u6269\u5c55\u548cmarkdown.extensions.smartstrong\u6269\u5c55\u51b2\u7a81\uff0c\u4e0d\u80fd\u540c\u65f6\u8f7d\u5165\uff0c\u524d\u8005\u66ff\u4ee3\u4e86\u540e\u8005\uff0c\u5b9e\u73b0\u66f4\u597d\u7684\u6548\u679c\u3002","title":"7.1. \u659c\u4f53,\u7c97\u4f53,\u7c97\u659c\u4f53"},{"location":"syntax/font_underline/","text":"\u4e0d\u5e26\u9ad8\u4eae \u00b6 \u4f9d\u8d56\u6a21\u5757: pymdownx.caret ^^underline me^^ \u6548\u679c underline me \u80cc\u666f\u9ad8\u4eae \u00b6 \u8be6\u89c1 \u9ad8\u4eae\u7ae0\u8282\u4e0b\u5212\u7ebf\u90e8\u5206","title":"7.3. \u4e0b\u5212\u7ebf"},{"location":"syntax/font_underline/#_1","text":"\u4f9d\u8d56\u6a21\u5757: pymdownx.caret ^^underline me^^ \u6548\u679c underline me","title":"\u4e0d\u5e26\u9ad8\u4eae"},{"location":"syntax/font_underline/#_2","text":"\u8be6\u89c1 \u9ad8\u4eae\u7ae0\u8282\u4e0b\u5212\u7ebf\u90e8\u5206","title":"\u80cc\u666f\u9ad8\u4eae"},{"location":"syntax/font_underline_line/","text":"\u53ea\u6709\u9ad8\u4eae\u5f62\u5f0f,\u8be6\u89c1 \u9ad8\u4eae\u7ae0\u8282\u4e0b\u5212\u7ebf+\u6a2a\u7ebf\u90e8\u5206","title":"7.5. \u4e0b\u5212\u7ebf+\u6a2a\u7ebf"},{"location":"syntax/font_updown/","text":"\u4e0a\u6807 \u00b6 \u4f9d\u8d56\u6a21\u5757: pymdownx.caret 10^2^ \u6548\u679c 10 2 \u9488\u5bf9\u82f1\u6587\u63cf\u8ff0\u7b2c\u51e0\u7684\u4e0a\u6807\uff0c\u53ef\u4ee5 1st \u8fd9\u79cd\u65b9\u5f0f(\u4f9d\u8d56\u6a21\u5757: pymdownx.smartsymbols) \u7528\u6cd5 \u6548\u679c 1st 2nd 3rd 1 st 2 nd 3 rd 1^st^ 2^nd^ 3^rd^ 1 st 2 nd 3 rd \u4e0b\u6807 \u00b6 \u4f9d\u8d56\u6a21\u5757: pymdownx.tilde H~2~O \u6548\u679c H 2 O","title":"7.2. \u4e0a\u6807,\u4e0b\u6807"},{"location":"syntax/font_updown/#_1","text":"\u4f9d\u8d56\u6a21\u5757: pymdownx.caret 10^2^ \u6548\u679c 10 2 \u9488\u5bf9\u82f1\u6587\u63cf\u8ff0\u7b2c\u51e0\u7684\u4e0a\u6807\uff0c\u53ef\u4ee5 1st \u8fd9\u79cd\u65b9\u5f0f(\u4f9d\u8d56\u6a21\u5757: pymdownx.smartsymbols) \u7528\u6cd5 \u6548\u679c 1st 2nd 3rd 1 st 2 nd 3 rd 1^st^ 2^nd^ 3^rd^ 1 st 2 nd 3 rd","title":"\u4e0a\u6807"},{"location":"syntax/font_updown/#_2","text":"\u4f9d\u8d56\u6a21\u5757: pymdownx.tilde H~2~O \u6548\u679c H 2 O","title":"\u4e0b\u6807"},{"location":"syntax/footnote/","text":"\u4f9d\u8d56\u6a21\u5757: footnotes \u7b2c\u4e00\u6b65. \u63d2\u5165\u5f15\u7528 Lorem ipsum[^1] dolor sit amet, consectetur adipiscing elit.[^2] \u7b2c\u4e8c\u6b65. \u63d2\u5165\u5185\u5bb9 [^1]: Lorem ipsum dolor sit amet, consectetur adipiscing elit. [^2]: Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. \u53ef\u4ee5\u770b\u5230\uff0c\u4e0a\u9762\u811a\u6ce81\u5185\u5bb9\u662f\u5355\u884c\u65b9\u5f0f\uff0c\u811a\u6ce82\u5185\u5bb9\u662f\u591a\u884c\u65b9\u5f0f \u6548\u679c Lorem ipsum 1 dolor sit amet, consectetur adipiscing elit. 2 \u6ce8\u610f \u4e0d\u4e00\u5b9a\u8981\u7528[^1]\uff0c\u4e5f\u53ef\u4ee5\u7528\u81ea\u5b9a\u4e49\u5173\u952e\u5b57\uff0c\u6bd4\u5982[^mykey]\uff0c\u4f46\u8fd9\u6837\u4e0b\u9762\u4e5f\u8981\u6539\u4e3a[^mykey]\uff0c\u4e5f\u53ef\u4ee5\u652f\u6301\u7a7a\u683c\uff0c\u6bd4\u5982[^my key]\uff08\u5f53\u7136\u540e\u9762\u4e5f\u8981[^my key]: \u65e0\u8bba\u811a\u6ce8\u6807\u7b7e\u5199\u7684\u662f\u4ec0\u4e48\uff08\u5373[^1]\u6216\u8005[^mykey]\uff0c\u5728\u5c55\u793a\u811a\u6ce8\u6807\u7b7e\u548c\u5c55\u793a\u811a\u6ce8\u5185\u5bb9\u65f6\u5019\u90fd\u662f\u81ea\u52a8\u7528\u6570\u5b57\u4ece1\u5f00\u59cb\u7d2f\u52a0\u6807\u8bb0\uff0c\u800c\u4e0d\u662f\u81ea\u5df1\u5199\u7684\u5185\u5bb9\uff09 [^1]: \u811a\u6ce8\u5185\u5bb9\u65e0\u8bba\u5199\u5728.md\u4e2d\u7684\u4efb\u4f55\u4f4d\u7f6e\uff0c\u5728\u5c55\u793a\u65f6\u5019\u90fd\u662f\u81ea\u52a8\u4f4d\u4e8e\u6587\u6863\u7684\u6700\u4e0b\u65b9\uff0c\u5e76\u4e14\u4f1a\u81ea\u52a8\u6dfb\u52a0---\u8fd9\u6837\u4e00\u4e2a\u6a2a\u7ebf Lorem ipsum dolor sit amet, consectetur adipiscing elit. \u21a9 Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. \u21a9","title":"15. \u811a\u6ce8"},{"location":"syntax/headline/","text":"\u4f7f\u7528 # \uff0c\u8868\u793a1-6\u7ea7\u6807\u9898\u3002 # \u4e00\u7ea7\u6807\u9898 ## \u4e8c\u7ea7\u6807\u9898 ### \u4e09\u7ea7\u6807\u9898 #### \u56db\u7ea7\u6807\u9898 ##### \u4e94\u7ea7\u6807\u9898 ###### \u516d\u7ea7\u6807\u9898 \u6ce8\u610f: \u4e00\u4e2a.md\u91cc\u53ea\u80fd\u6709\u4e00\u4e2a # \uff0c\u8ddf\u7740\u591a\u4e2a ## \u3002\u5982\u679c\u6709\u591a\u4e2a # \uff0c\u5219\u4e0d\u4f1a\u81ea\u52a8\u751f\u4ea7\u672c\u9875\u76ee\u5f55\u3002 \u5982\u679c\u6709 # \uff0c\u5219\u4f7f\u7528\u8be5\u6807\u9898\u4f5c\u4e3a\u672c\u9875\u6b63\u6587\u90e8\u5206\u7b2c\u4e00\u884c\uff0c\u5982\u679c\u6ca1\u6709#\uff0c\u5219\u4e3amkdocs.yml\u91cc\u6307\u5b9a\u7684pages\u540d\u3002 \u4e2a\u4eba\u5efa\u8bae.md\u4ece ## \u5f00\u59cb\uff0c\u4e0d\u8981\u7528 # \u3002","title":"2. \u6807\u9898"},{"location":"syntax/highlight_background/","text":"\u9ec4\u8272 \u00b6 2\u4e2a\u6a21\u5757\u5747\u63d0\u4f9b\u4e86\u76f8\u4f3c\u7684\u6548\u679c \u6a21\u57571: pymdownx.mark ==hello world== \u6548\u679c hello world \u6a21\u57572: pymdownx.critic \u6548\u679c hello world \u4f46\u8fd92\u4e2a\u6a21\u5757\u4e5f\u6709\u533a\u522b : \u533a\u522b1: pymdownx.mark\u6e32\u67d3\u51fa\u7684html\u662f <p><mark>hello world</mark></p> pymdownx.critic\u6e32\u67d3\u51fa\u7684html\u662f <p><mark class=\"critic\">hello world</mark></p> \u533a\u522b2: pymdownx.mark\u4e0d\u652f\u6301\u5757\u80cc\u666f\u9ad8\u4eae pymdownx.critic\u652f\u6301\u5757\u80cc\u666f\u9ad8\u4eae \u7528\u6cd5: \u6548\u679c: AAA BBB CCC \u652f\u6301\u5d4c\u5957\uff0c\u8be6\u89c1 \u9ec4\u8272\u533a\u5757\u5d4c\u5957\u9ad8\u4eae\u4ee3\u7801\u793a\u4f8b \u7eff\u8272(\u4e0b\u5212\u7ebf) \u00b6 \u8868\u793a\u63d2\u5165\u6587\u5b57 \u4f9d\u8d56\u6a21\u5757: pymdownx.critic \u6548\u679c Hello, my world! \u652f\u6301\u5d4c\u5957\uff0c\u8be6\u89c1 \u7eff\u8272\u533a\u5757\u5d4c\u5957\u9ad8\u4eae\u4ee3\u7801\u793a\u4f8b \u7ea2\u8272(\u6a2a\u7ebf) \u00b6 \u8868\u793a\u5220\u9664\u6587\u5b57 \u4f9d\u8d56\u6a21\u5757: pymdownx.tidle \u6548\u679c delete me \u652f\u6301\u5d4c\u5957\uff0c\u8be6\u89c1 \u7ea2\u8272\u533a\u5757\u5d4c\u5957\u9ad8\u4eae\u4ee3\u7801\u793a\u4f8b \u7eff\u8272+\u7ea2\u8272(\u4e0b\u5212\u7ebf+\u6a2a\u7ebf) \u00b6 \u8868\u793a\u66ff\u6362\u6587\u5b57 2\u79cd\u5b9e\u73b0\u65b9\u5f0f: \u5148\u4f7f\u7528\u7ea2\u8272(\u6a2a\u7ebf)\uff0c\u518d\u4f7f\u7528\u7eff\u8272(\u4e0b\u5212\u7ebf) \u4f7f\u7528\u4e13\u95e8\u7684\u8bed\u6cd5\uff0c\u4f9d\u8d56\u6a21\u5757pymdownx.tidle \u8fd92\u79cd\u65b9\u5f0f\u6548\u679c\u5b8c\u5168\u4e00\u81f4\uff0c\u5305\u62ec\u5b9e\u9645\u770b\u5230\u7684\u6837\u5f0f\u548chtml\u90fd\u662f\u76f8\u540c\u7684 Hello, my our world! \u652f\u6301\u5d4c\u5957\uff0c\u8be6\u89c1 \u7eff\u8272+\u7ea2\u8272\u533a\u5757\u5d4c\u5957\u9ad8\u4eae\u4ee3\u7801\u793a\u4f8b \u7070\u8272 \u00b6 \u8868\u793a\u6ce8\u89e3 \u4f9d\u8d56\u6a21\u5757: pymdownx.critic \u6548\u679c This is a test What is it a test of? . \u6ce8\u610f: \u53ea\u652f\u6301\u5355\u884c\u7528\u6cd5\uff0c\u4e0d\u652f\u6301\u533a\u5757\u7528\u6cd5 \u65e0\u6cd5\u4e0e\u4ee3\u7801\u9ad8\u4eae\u7ed3\u5408\uff0c\u5305\u62ec\u884c\u5185\u4ee3\u7801\u9ad8\u4eae\u548c\u533a\u5757\u4ee3\u7801\u9ad8\u4eae","title":"13.2. \u80cc\u666f\u9ad8\u4eae"},{"location":"syntax/highlight_background/#_1","text":"2\u4e2a\u6a21\u5757\u5747\u63d0\u4f9b\u4e86\u76f8\u4f3c\u7684\u6548\u679c \u6a21\u57571: pymdownx.mark ==hello world== \u6548\u679c hello world \u6a21\u57572: pymdownx.critic \u6548\u679c hello world \u4f46\u8fd92\u4e2a\u6a21\u5757\u4e5f\u6709\u533a\u522b : \u533a\u522b1: pymdownx.mark\u6e32\u67d3\u51fa\u7684html\u662f <p><mark>hello world</mark></p> pymdownx.critic\u6e32\u67d3\u51fa\u7684html\u662f <p><mark class=\"critic\">hello world</mark></p> \u533a\u522b2: pymdownx.mark\u4e0d\u652f\u6301\u5757\u80cc\u666f\u9ad8\u4eae pymdownx.critic\u652f\u6301\u5757\u80cc\u666f\u9ad8\u4eae \u7528\u6cd5: \u6548\u679c: AAA BBB CCC \u652f\u6301\u5d4c\u5957\uff0c\u8be6\u89c1 \u9ec4\u8272\u533a\u5757\u5d4c\u5957\u9ad8\u4eae\u4ee3\u7801\u793a\u4f8b","title":"\u9ec4\u8272"},{"location":"syntax/highlight_background/#_2","text":"\u8868\u793a\u63d2\u5165\u6587\u5b57 \u4f9d\u8d56\u6a21\u5757: pymdownx.critic \u6548\u679c Hello, my world! \u652f\u6301\u5d4c\u5957\uff0c\u8be6\u89c1 \u7eff\u8272\u533a\u5757\u5d4c\u5957\u9ad8\u4eae\u4ee3\u7801\u793a\u4f8b","title":"\u7eff\u8272(\u4e0b\u5212\u7ebf)"},{"location":"syntax/highlight_background/#_3","text":"\u8868\u793a\u5220\u9664\u6587\u5b57 \u4f9d\u8d56\u6a21\u5757: pymdownx.tidle \u6548\u679c delete me \u652f\u6301\u5d4c\u5957\uff0c\u8be6\u89c1 \u7ea2\u8272\u533a\u5757\u5d4c\u5957\u9ad8\u4eae\u4ee3\u7801\u793a\u4f8b","title":"\u7ea2\u8272(\u6a2a\u7ebf)"},{"location":"syntax/highlight_background/#_4","text":"\u8868\u793a\u66ff\u6362\u6587\u5b57 2\u79cd\u5b9e\u73b0\u65b9\u5f0f: \u5148\u4f7f\u7528\u7ea2\u8272(\u6a2a\u7ebf)\uff0c\u518d\u4f7f\u7528\u7eff\u8272(\u4e0b\u5212\u7ebf) \u4f7f\u7528\u4e13\u95e8\u7684\u8bed\u6cd5\uff0c\u4f9d\u8d56\u6a21\u5757pymdownx.tidle \u8fd92\u79cd\u65b9\u5f0f\u6548\u679c\u5b8c\u5168\u4e00\u81f4\uff0c\u5305\u62ec\u5b9e\u9645\u770b\u5230\u7684\u6837\u5f0f\u548chtml\u90fd\u662f\u76f8\u540c\u7684 Hello, my our world! \u652f\u6301\u5d4c\u5957\uff0c\u8be6\u89c1 \u7eff\u8272+\u7ea2\u8272\u533a\u5757\u5d4c\u5957\u9ad8\u4eae\u4ee3\u7801\u793a\u4f8b","title":"\u7eff\u8272+\u7ea2\u8272(\u4e0b\u5212\u7ebf+\u6a2a\u7ebf)"},{"location":"syntax/highlight_background/#_5","text":"\u8868\u793a\u6ce8\u89e3 \u4f9d\u8d56\u6a21\u5757: pymdownx.critic \u6548\u679c This is a test What is it a test of? . \u6ce8\u610f: \u53ea\u652f\u6301\u5355\u884c\u7528\u6cd5\uff0c\u4e0d\u652f\u6301\u533a\u5757\u7528\u6cd5 \u65e0\u6cd5\u4e0e\u4ee3\u7801\u9ad8\u4eae\u7ed3\u5408\uff0c\u5305\u62ec\u884c\u5185\u4ee3\u7801\u9ad8\u4eae\u548c\u533a\u5757\u4ee3\u7801\u9ad8\u4eae","title":"\u7070\u8272"},{"location":"syntax/highlight_code/","text":"\u884c\u5185\u4ee3\u7801\u9ad8\u4eae \u00b6 \u4f9d\u8d56\u6a21\u5757: pymdownx.inlinehilite \u4f7f\u7528shebang\u53ef\u4ee5\u5728\u4e00\u884c\u6587\u672c\u91cc\u5b9e\u73b0\u4ee3\u7801\u9ad8\u4eae `#!python print \"Hello, world!\"`\u6216`:::python print \"Hello, world!\"` \u6548\u679c print \"Hello, world!\" \u6216 print \"Hello, world!\" \u5f00\u5934\u4e0d\u80fd\u6709\u7a7a\u683c\uff0c\u5982\u679c\u6709\u7a7a\u683c\u7684\u8bdd\uff0c\u5c31\u4f1a\u88ab\u8ba4\u4e3a\u662f\u6b63\u6587 ` #!python print \"Hello, world!\"` \u6548\u679c #!python print \"Hello, world!\" ` :::python print \"Hello, world!\"` \u6548\u679c :::python print \"Hello, world!\" \u533a\u5757\u4ee3\u7801\u9ad8\u4eae \u00b6 \u7528\u6cd5 \u00b6 \u4f9d\u8d56\u6a21\u5757: codehilite \u5199\u6cd51: 3\u4e2a` ```python text = \"Hello, world!\" print text ``` \u6548\u679c text = \"Hello, world!\" print text \u5199\u6cd52: 4\u4e2a\u7a7a\u683c+shebang #!/usr/bin/python text = \"Hello, world!\" print text \u6548\u679c #!/usr/bin/python text = \"Hello, world!\" print text \u652f\u6301434\u79cd\u683c\u5f0f codehilite\u662f\u57fa\u4e8epygments\u5b9e\u73b0\u9ad8\u4eae\u7684\uff0c\u652f\u6301434\u79cd\u683c\u5f0f\uff0c\u8be6\u89c1 \u652f\u6301\u4ee3\u7801\u9ad8\u4eae\u7684\u8bed\u8a00 \u82e5\u6307\u5b9a\u4e86\u4e0d\u5b58\u5728\u7684\u683c\u5f0f\uff0c\u5219\u7b49\u540c\u4e8etext\uff0c\u4e0d\u505a\u4efb\u4f55\u9ad8\u4eae\u6e32\u67d3 \u82e5\u4e0d\u60f3\u4f7f\u7528\u9ad8\u4eae\uff0c\u7528text\uff0c\u5982\uff1a ```text text = \"Hello, world!\" print text ``` \u6548\u679c text = \"Hello, world!\" print text \u53c2\u65701. \u81ea\u52a8\u731c\u6d4b\u8bed\u8a00 \u00b6 \u5728mkdocs.yml\u91ccmarkdown_extensions\u90e8\u5206\u8bbe\u7f6e\u5982\u4e0b - codehilite(guess_lang=false) \u5173\u95ed\u731c\u6d4b\uff0c\u82e5\u4e0d\u6307\u5b9a\u8bed\u8a00\uff0c\u5219\u5173\u95ed\u9ad8\u4eae - codehilite(guess_lang=true) \u5f00\u542f\u731c\u6d4b\uff0c\u82e5\u4e0d\u6307\u5b9a\u8bed\u8a00\uff0c\u5219\u81ea\u52a8\u731c\u6d4b \u53c2\u65702. \u663e\u793a\u884c\u53f7 \u00b6 \u5728mkdocs.yml\u91ccmarkdown_extensions\u90e8\u5206\u8bbe\u7f6e - codehilite(linenums=true) \u663e\u793a\u884c\u53f7 - codehilite(linenums=false) \u4e0d\u663e\u793a\u884c\u53f7 \u82e5codehilite(linenums=true)\uff0c4\u4e2a\u7a7a\u683c\u7684\u4ee3\u7801\u5757\u65b9\u5f0f\u4e5f\u4f1a\u88ab\u81ea\u52a8\u52a0\u4e0a\u884c\u53f7 \u6307\u5b9a\u4ee3\u7801\u5757\u663e\u793a\u884c\u53f7 \u56e0\u6b64\uff0c\u5982\u679c\u60f3\u5168\u5c40\u9ed8\u8ba4\u4e0d\u663e\u793a\u884c\u53f7\uff0c\u800c\u6307\u5b9a\u4ee3\u7801\u5757\u663e\u793a\u884c\u53f7\uff0c\u53ef\u4ee5\u5728mkdocs.yml\u91cc\u6307\u5b9alinenums=false\uff0c\u7136\u540e\u60f3\u663e\u793a\u884c\u53f7\u7684\u4ee3\u7801\u5757\u7528linenums=\"1\" \u53c2\u65703. \u6307\u5b9a\u7b2c\u51e0\u884c\u80cc\u666f\u9ad8\u4eae \u00b6 \u5728mkdocs.yml\u91cc\u4e0d\u7528\u989d\u5916\u8bbe\u7f6e ```python hl_lines=\"2 4\" text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 ``` \u6548\u679c text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 \u53c2\u65704. \u6307\u5b9a\u884c\u53f7\u4ece\u591a\u5c11\u5f00\u59cb\u7f16\u53f7 \u00b6 ```python linenums=\"2\" text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 ``` \u6548\u679c 2 3 4 text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 \u5f3a\u5236\u663e\u5f0f\u884c\u53f7 \u5f53\u4ee3\u7801\u5757\u6307\u5b9a\u4e86linenums\u540e\uff0c\u5373\u4f7fmkdocs.yml\u91cclinenums=false\uff0c\u4e5f\u4f1a\u81ea\u52a8\u663e\u793a\u884c\u53f7 \u56e0\u6b64\uff0c\u5982\u679c\u60f3\u5168\u5c40\u9ed8\u8ba4\u4e0d\u663e\u793a\u884c\u53f7\uff0c\u800c\u6307\u5b9a\u4ee3\u7801\u5757\u663e\u793a\u884c\u53f7\uff0c\u53ef\u4ee5\u5728mkdocs.yml\u91cc\u6307\u5b9alinenums=false\uff0c\u7136\u540e\u60f3\u663e\u793a\u884c\u53f7\u7684\u4ee3\u7801\u5757\u7528linenums=\"1\" \u6ce8\u610f\uff1a\u4ee3\u7801\u5757linenums\u53c2\u6570\u4e0d\u4f1a\u5f71\u54cdhl_lines\uff0c\u5373\u65e0\u8bbalinenums\u6307\u5b9a\u4ece\u591a\u5c11\u884c\u5f00\u59cb\u7f16\u53f7\uff0chl_lines\u5b9e\u9645\u90fd\u4ee5\u884c\u53f7\u4ece1\u5f00\u59cb\u7f16\u53f7\u6765\u627e\u5230\u5bf9\u5e94\u884c\u8fdb\u884c\u80cc\u666f\u9ad8\u4eae\u6e32\u67d3\uff0c\u5982\uff1a ```python linenums=\"2\" hl_lines=\"3\" text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 ``` \u6548\u679c 2 3 4 text1 = \"Hello, \" text2 = \"world!\" print text1 + text2","title":"13.1. \u4ee3\u7801\u9ad8\u4eae"},{"location":"syntax/highlight_code/#_1","text":"\u4f9d\u8d56\u6a21\u5757: pymdownx.inlinehilite \u4f7f\u7528shebang\u53ef\u4ee5\u5728\u4e00\u884c\u6587\u672c\u91cc\u5b9e\u73b0\u4ee3\u7801\u9ad8\u4eae `#!python print \"Hello, world!\"`\u6216`:::python print \"Hello, world!\"` \u6548\u679c print \"Hello, world!\" \u6216 print \"Hello, world!\" \u5f00\u5934\u4e0d\u80fd\u6709\u7a7a\u683c\uff0c\u5982\u679c\u6709\u7a7a\u683c\u7684\u8bdd\uff0c\u5c31\u4f1a\u88ab\u8ba4\u4e3a\u662f\u6b63\u6587 ` #!python print \"Hello, world!\"` \u6548\u679c #!python print \"Hello, world!\" ` :::python print \"Hello, world!\"` \u6548\u679c :::python print \"Hello, world!\"","title":"\u884c\u5185\u4ee3\u7801\u9ad8\u4eae"},{"location":"syntax/highlight_code/#_2","text":"","title":"\u533a\u5757\u4ee3\u7801\u9ad8\u4eae"},{"location":"syntax/highlight_code/#_3","text":"\u4f9d\u8d56\u6a21\u5757: codehilite \u5199\u6cd51: 3\u4e2a` ```python text = \"Hello, world!\" print text ``` \u6548\u679c text = \"Hello, world!\" print text \u5199\u6cd52: 4\u4e2a\u7a7a\u683c+shebang #!/usr/bin/python text = \"Hello, world!\" print text \u6548\u679c #!/usr/bin/python text = \"Hello, world!\" print text \u652f\u6301434\u79cd\u683c\u5f0f codehilite\u662f\u57fa\u4e8epygments\u5b9e\u73b0\u9ad8\u4eae\u7684\uff0c\u652f\u6301434\u79cd\u683c\u5f0f\uff0c\u8be6\u89c1 \u652f\u6301\u4ee3\u7801\u9ad8\u4eae\u7684\u8bed\u8a00 \u82e5\u6307\u5b9a\u4e86\u4e0d\u5b58\u5728\u7684\u683c\u5f0f\uff0c\u5219\u7b49\u540c\u4e8etext\uff0c\u4e0d\u505a\u4efb\u4f55\u9ad8\u4eae\u6e32\u67d3 \u82e5\u4e0d\u60f3\u4f7f\u7528\u9ad8\u4eae\uff0c\u7528text\uff0c\u5982\uff1a ```text text = \"Hello, world!\" print text ``` \u6548\u679c text = \"Hello, world!\" print text","title":"\u7528\u6cd5"},{"location":"syntax/highlight_code/#1","text":"\u5728mkdocs.yml\u91ccmarkdown_extensions\u90e8\u5206\u8bbe\u7f6e\u5982\u4e0b - codehilite(guess_lang=false) \u5173\u95ed\u731c\u6d4b\uff0c\u82e5\u4e0d\u6307\u5b9a\u8bed\u8a00\uff0c\u5219\u5173\u95ed\u9ad8\u4eae - codehilite(guess_lang=true) \u5f00\u542f\u731c\u6d4b\uff0c\u82e5\u4e0d\u6307\u5b9a\u8bed\u8a00\uff0c\u5219\u81ea\u52a8\u731c\u6d4b","title":"\u53c2\u65701. \u81ea\u52a8\u731c\u6d4b\u8bed\u8a00"},{"location":"syntax/highlight_code/#2","text":"\u5728mkdocs.yml\u91ccmarkdown_extensions\u90e8\u5206\u8bbe\u7f6e - codehilite(linenums=true) \u663e\u793a\u884c\u53f7 - codehilite(linenums=false) \u4e0d\u663e\u793a\u884c\u53f7 \u82e5codehilite(linenums=true)\uff0c4\u4e2a\u7a7a\u683c\u7684\u4ee3\u7801\u5757\u65b9\u5f0f\u4e5f\u4f1a\u88ab\u81ea\u52a8\u52a0\u4e0a\u884c\u53f7 \u6307\u5b9a\u4ee3\u7801\u5757\u663e\u793a\u884c\u53f7 \u56e0\u6b64\uff0c\u5982\u679c\u60f3\u5168\u5c40\u9ed8\u8ba4\u4e0d\u663e\u793a\u884c\u53f7\uff0c\u800c\u6307\u5b9a\u4ee3\u7801\u5757\u663e\u793a\u884c\u53f7\uff0c\u53ef\u4ee5\u5728mkdocs.yml\u91cc\u6307\u5b9alinenums=false\uff0c\u7136\u540e\u60f3\u663e\u793a\u884c\u53f7\u7684\u4ee3\u7801\u5757\u7528linenums=\"1\"","title":"\u53c2\u65702. \u663e\u793a\u884c\u53f7"},{"location":"syntax/highlight_code/#3","text":"\u5728mkdocs.yml\u91cc\u4e0d\u7528\u989d\u5916\u8bbe\u7f6e ```python hl_lines=\"2 4\" text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 ``` \u6548\u679c text1 = \"Hello, \" text2 = \"world!\" print text1 + text2","title":"\u53c2\u65703. \u6307\u5b9a\u7b2c\u51e0\u884c\u80cc\u666f\u9ad8\u4eae"},{"location":"syntax/highlight_code/#4","text":"```python linenums=\"2\" text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 ``` \u6548\u679c 2 3 4 text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 \u5f3a\u5236\u663e\u5f0f\u884c\u53f7 \u5f53\u4ee3\u7801\u5757\u6307\u5b9a\u4e86linenums\u540e\uff0c\u5373\u4f7fmkdocs.yml\u91cclinenums=false\uff0c\u4e5f\u4f1a\u81ea\u52a8\u663e\u793a\u884c\u53f7 \u56e0\u6b64\uff0c\u5982\u679c\u60f3\u5168\u5c40\u9ed8\u8ba4\u4e0d\u663e\u793a\u884c\u53f7\uff0c\u800c\u6307\u5b9a\u4ee3\u7801\u5757\u663e\u793a\u884c\u53f7\uff0c\u53ef\u4ee5\u5728mkdocs.yml\u91cc\u6307\u5b9alinenums=false\uff0c\u7136\u540e\u60f3\u663e\u793a\u884c\u53f7\u7684\u4ee3\u7801\u5757\u7528linenums=\"1\" \u6ce8\u610f\uff1a\u4ee3\u7801\u5757linenums\u53c2\u6570\u4e0d\u4f1a\u5f71\u54cdhl_lines\uff0c\u5373\u65e0\u8bbalinenums\u6307\u5b9a\u4ece\u591a\u5c11\u884c\u5f00\u59cb\u7f16\u53f7\uff0chl_lines\u5b9e\u9645\u90fd\u4ee5\u884c\u53f7\u4ece1\u5f00\u59cb\u7f16\u53f7\u6765\u627e\u5230\u5bf9\u5e94\u884c\u8fdb\u884c\u80cc\u666f\u9ad8\u4eae\u6e32\u67d3\uff0c\u5982\uff1a ```python linenums=\"2\" hl_lines=\"3\" text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 ``` \u6548\u679c 2 3 4 text1 = \"Hello, \" text2 = \"world!\" print text1 + text2","title":"\u53c2\u65704. \u6307\u5b9a\u884c\u53f7\u4ece\u591a\u5c11\u5f00\u59cb\u7f16\u53f7"},{"location":"syntax/image_index/","text":"\u5f53\u4e00\u4e2a\u9875\u9762\u91cc\u591a\u6b21\u8c03\u7528\u76f8\u540c\u56fe\u7247\u65f6\uff0c\u8fd9\u79cd\u65b9\u6cd5\u66f4\u9002\u7528: ![alt][\u7d22\u5f15] [\u7d22\u5f15]: \u56fe\u7247\u5730\u5740 \"title\" \u6ce8\u610f: [\u7d22\u5f15]: \u56fe\u7247\u5730\u5740 \"title\" \u53ef\u4ee5\u5199\u5728\u4efb\u610f\u5730\u65b9\uff0c\u901a\u5e38\u4e60\u60ef\u4e8e\u653e\u5728markdown\u672c\u9875\u6587\u6863\u6700\u4e0b\u65b9 \u5982 ![alt][test icon] ... [test icon]: /img/test_icon.png \"title\" \u6548\u679c \u9f20\u6807\u60ac\u505c\u5728\u56fe\u6807\u4e0a\u53ef\u4ee5\u770b\u5230\"title\"\u5b57\u6837","title":"11.2. \u53c2\u8003\u5f0f"},{"location":"syntax/image_inline/","text":"\u6dfb\u52a0\u56fe\u7247\u7684\u5f62\u5f0f\u548c\u94fe\u63a5\u76f8\u4f3c\uff0c\u53ea\u9700\u5728\u94fe\u63a5\u7684\u57fa\u7840\u4e0a\u524d\u65b9\u52a0\u4e00\u4e2a ! ![alt](\u56fe\u7247\u5730\u5740 \"title\") \u5982 ![hello](./../img/test_icon.png \"title\") \u6548\u679c \u9f20\u6807\u60ac\u505c\u5728\u56fe\u6807\u4e0a\u53ef\u4ee5\u770b\u5230\"title\"\u5b57\u6837","title":"11.1. \u884c\u5185\u5f0f"},{"location":"syntax/link_anchor/","text":"\u82f1\u6587\u53ebPermalinks\uff0c\u662ftoc\u6269\u5c55\u6a21\u5757\u7684\u4e00\u4e2a\u529f\u80fd \u4f9d\u8d56\u6a21\u5757: toc \u9ed8\u8ba4\u503c: toc(permalink=false) \u7b14\u8005\u63a8\u8350\u503c: toc(permalink=true) \u53c2\u6570\u8bbe\u7f6e: toc(permalink=true) \u70b9\u51fb\u951a\u70b9\u6216\u8005\u8df3\u8f6c\u81f3\u951a\u70b9\u540e\u4f1a\u81ea\u52a8\u5728\u951a\u70b9\u5904\u663e\u793a\u56fe\u6807\u6216\u6587\u672c\uff0c\u5e76\u81ea\u52a8\u56fa\u5b9a\u5728\u8be5\u4f4d\u7f6e\uff0c\u5237\u65b0\u9875\u9762\u540e\u4e5f\u4f1a\u81ea\u52a8\u56de\u5230\u8be5\u4f4d\u7f6e\uff0c\u6548\u679c\u5982\u4e0b\uff1a toc(permalink=false) \u770b\u4e0d\u5230\u951a\u70b9\u5904\u7684\u56fe\u6807\u6216\u6587\u672c\uff0c\u4f46\u8df3\u8f6c\u81f3\u951a\u70b9\u5904\u540e\u81ea\u52a8\u56fa\u5b9a\u5728\u8be5\u4f4d\u7f6e\uff0c\u5237\u65b0\u9875\u9762\u540e\u4e5f\u4f1a\u81ea\u52a8\u56de\u5230\u8be5\u4f4d\u7f6e toc(permalink=false)\u7b49\u540c\u4e8e\u6ce8\u91ca\u6389\u8fd9\u4e2a\u6269\u5c55\uff0c\u6548\u679c\u5747\u5982\u4e0b\uff1a toc(permalink=\u81ea\u5b9a\u4e49\u540d) \u53ef\u4ee5\u652f\u6301\u81ea\u5b9a\u4e49\u540d\uff0c\u6bd4\u5982toc(permalinks=hello)\uff0c\u6548\u679c\u5982\u4e0b\uff1a","title":"10.3. \u951a\u70b9\u63d0\u793a"},{"location":"syntax/link_auto/","text":"\u4f9d\u8d56\u6a21\u5757: pymdownx.magiclink \u5f53\u8bc6\u522b\u5230HTML\u3001FTP\u3001Email\u5730\u5740\u65f6\u5019\u4f1a\u81ea\u52a8\u8f6c\u4e3a\u8d85\u94fe\u63a5\uff0c\u5982 http://www.example.cpm/ \u6548\u679c http://www.example.com/ \u7ecf\u6d4b\u8bd5\uff0c\u81f3\u5c11\u652f\u6301\u4ee5\u4e0b\u51e0\u79cd\u81ea\u52a8\u94fe\u63a5 http://www.example.com/ https://www.example.com/ ftp://www.example.com/ www.example.com user@example.com","title":"10.2. \u81ea\u52a8\u94fe\u63a5"},{"location":"syntax/link_normal/","text":"\u884c\u5185\u5f0f \u00b6 [example](http://www.example.com/ \"title\") \u6548\u679c example \u9f20\u6807\u60ac\u505c\u5728\u94fe\u63a5\u4e0a\u53ef\u4ee5\u770b\u5230\"title\"\u5b57\u6837 \u53c2\u8003\u5f0f \u00b6 \u5f53\u4e00\u4e2a\u9875\u9762\u91cc\u591a\u6b21\u8c03\u7528\u76f8\u540c\u94fe\u63a5\u65f6\uff0c\u8fd9\u79cd\u65b9\u6cd5\u66f4\u9002\u7528: [example][\u7d22\u5f15] ... [\u7d22\u5f15]: http://www.example.com/ \"title\" \u6ce8\u610f: [\u7d22\u5f15]: http://www.example.com/ \"title\" \u53ef\u4ee5\u5199\u5728\u4efb\u610f\u5730\u65b9\uff0c\u901a\u5e38\u4e60\u60ef\u4e8e\u653e\u5728markdown\u672c\u9875\u6587\u6863\u6700\u4e0b\u65b9 \u6548\u679c example \u9f20\u6807\u60ac\u505c\u5728\u94fe\u63a5\u4e0a\u53ef\u4ee5\u770b\u5230\"title\"\u5b57\u6837","title":"10.1. \u666e\u901a\u94fe\u63a5"},{"location":"syntax/link_normal/#_1","text":"[example](http://www.example.com/ \"title\") \u6548\u679c example \u9f20\u6807\u60ac\u505c\u5728\u94fe\u63a5\u4e0a\u53ef\u4ee5\u770b\u5230\"title\"\u5b57\u6837","title":"\u884c\u5185\u5f0f"},{"location":"syntax/link_normal/#_2","text":"\u5f53\u4e00\u4e2a\u9875\u9762\u91cc\u591a\u6b21\u8c03\u7528\u76f8\u540c\u94fe\u63a5\u65f6\uff0c\u8fd9\u79cd\u65b9\u6cd5\u66f4\u9002\u7528: [example][\u7d22\u5f15] ... [\u7d22\u5f15]: http://www.example.com/ \"title\" \u6ce8\u610f: [\u7d22\u5f15]: http://www.example.com/ \"title\" \u53ef\u4ee5\u5199\u5728\u4efb\u610f\u5730\u65b9\uff0c\u901a\u5e38\u4e60\u60ef\u4e8e\u653e\u5728markdown\u672c\u9875\u6587\u6863\u6700\u4e0b\u65b9 \u6548\u679c example \u9f20\u6807\u60ac\u505c\u5728\u94fe\u63a5\u4e0a\u53ef\u4ee5\u770b\u5230\"title\"\u5b57\u6837","title":"\u53c2\u8003\u5f0f"},{"location":"syntax/list_noseq/","text":"\u4f7f\u7528 * \u3001 + \u3001\u6216 - \u6807\u8bb0\u65e0\u5e8f\u5217\u8868\uff0c\u4e0b\u9762\u4ec5\u4ee5 - \u4f5c\u4e3a\u793a\u4f8b\uff0c - \u7b2c\u4e00\u9879 - \u7b2c\u4e8c\u9879 - \u7b2c\u4e09\u9879 \u6ce8: \u6807\u8bb0\u540e\u9762\u6700\u5c11\u6709\u4e00\u4e2a \u7a7a\u683c \u6216 \u5236\u8868\u7b26 \u3002\u82e5\u4e0d\u5728\u5f15\u7528\u533a\u5757\u4e2d\uff0c\u5fc5\u987b\u548c\u524d\u65b9\u6bb5\u843d\u4e4b\u95f4\u5b58\u5728\u7a7a\u884c\u3002 \u6548\u679c \u7b2c\u4e00\u9879 \u7b2c\u4e8c\u9879 \u7b2c\u4e09\u9879","title":"8.1. \u65e0\u5e8f\u5217\u8868"},{"location":"syntax/list_seq/","text":"\u6709\u5e8f\u5217\u8868\u7684\u6807\u8bb0\u65b9\u5f0f\u662f\u5c06\u4e0a\u8ff0\u7684\u7b26\u53f7\u6362\u6210\u6570\u5b57,\u5e76\u8f85\u4ee5 . 1. \u7b2c\u4e00\u9879 2. \u7b2c\u4e8c\u9879 3. \u7b2c\u4e09\u9879 \u6548\u679c \u7b2c\u4e00\u9879 \u7b2c\u4e8c\u9879 \u7b2c\u4e09\u9879","title":"8.2. \u6709\u5e8f\u5217\u8868"},{"location":"syntax/list_task/","text":"\u4f9d\u8d56\u6a21\u5757: pymdownx.tasklist \u7528\u6cd5: - [ ] \u6216 - [x] \uff0c\u5176\u4e2d [ ] \u8868\u793a\u4e0d\u6253\u52fe\uff0c [x] \u8868\u793a\u6253\u52fe\uff0c - \u53ef\u4ee5\u7528 + \u6216 * \u66ff\u4ee3 - [x] Lorem ipsum dolor sit amet, consectetur adipiscing elit - [x] Nulla lobortis egestas semper - [x] Curabitur elit nibh, euismod et ullamcorper at, iaculis feugiat est - [ ] Vestibulum convallis sit amet nisi a tincidunt - [x] In hac habitasse platea dictumst - [x] In scelerisque nibh non dolor mollis congue sed et metus - [x] Sed egestas felis quis elit dapibus, ac aliquet turpis mattis - [ ] Praesent sed risus massa - [x] Aenean pretium efficitur erat, donec pharetra, ligula non scelerisque - [ ] Nulla vel eros venenatis, imperdiet enim id, faucibus nisi \u6548\u679c Lorem ipsum dolor sit amet, consectetur adipiscing elit Nulla lobortis egestas semper Curabitur elit nibh, euismod et ullamcorper at, iaculis feugiat est Vestibulum convallis sit amet nisi a tincidunt In hac habitasse platea dictumst In scelerisque nibh non dolor mollis congue sed et metus Sed egestas felis quis elit dapibus, ac aliquet turpis mattis Praesent sed risus massa Aenean pretium efficitur erat, donec pharetra, ligula non scelerisque Nulla vel eros venenatis, imperdiet enim id, faucibus nisi","title":"8.3. \u4efb\u52a1\u5217\u8868"},{"location":"syntax/main/","text":"\u7531\u4e8e\u8bed\u6cd5\u4f17\u591a\uff0c\u56e0\u6b64\u5c06 \u5927\u90e8\u5206\u8bed\u6cd5 \u6c47\u603b\u5728\u4e0b\u9762\u8868\u683c\u91cc\uff0c\u4fbf\u4e8e\u4e00\u89c8\u3002 \u4f46\u8be5\u8868\u5e76\u672a\u6db5\u76d6\u5168\u90e8\u8bed\u6cd5(\u5982\u67d0\u4e9b\u7279\u6b8a\u7b26\u53f7) \uff0c\u56e0\u6b64\u8be6\u60c5\u8bf7\u7ffb\u770b\u8bed\u6cd5\u7684\u5177\u4f53\u7ae0\u8282\u3002 \u7b26\u53f7 \u7528\u9014 # \u6807\u9898 \u7a7a\u884c \u6bb5\u843d > \u5f15\u7528 [^sth] \u811a\u6ce8 !!! \u6ce8\u89e3 ??? \u6298\u53e0\u6ce8\u89e3 \\ \u8f6c\u4e49 * \u5217\u8868 + \u5217\u8868 - \u5217\u8868 *[x] \u4efb\u52a1\u5217\u8868 +[x] \u4efb\u52a1\u5217\u8868 -[x] \u4efb\u52a1\u5217\u8868 --- \u5206\u5272\u7ebf :shortname: emoji ` \u884c\u5185\u4ee3\u7801 ```\u8bed\u8a00 \u4ee3\u7801\u5757,\u5e26\u9ad8\u4eae TAB \u4ee3\u7801\u5757 #! \u4ee3\u7801\u9ad8\u4eae ::: \u4ee3\u7801\u9ad8\u4eae *sth* \u659c\u4f53 _sth_ \u659c\u4f53 **sth** \u7c97\u4f53 __sth__ \u7c97\u4f53 ***sth*** \u7c97\u659c\u4f53 ___sth___ \u7c97\u659c\u4f53 ^sth^ \u4e0a\u6807 ~sth~ \u4e0b\u6807 ^^sth^^ \u6587\u5b57\u4e0b\u5212\u7ebf ~~sth~~ \u6587\u5b57\u4e2d\u6a2a\u7ebf {++sth++} \u6587\u5b57\u4e0b\u5212\u7ebf,\u7eff\u8272\u80cc\u666f\u9ad8\u4eae {--sth--} \u6587\u5b57\u4e2d\u6a2a\u7ebf,\u7ea2\u8272\u80cc\u666f\u9ad8\u4eae {~~false~>true~~} \u6587\u5b57\u4e0b\u5212\u7ebf\u63a5\u6587\u5b57\u6a2a\u7ebf,\u7eff\u63a5\u7ea2\u80cc\u666f\u9ad8\u4eae {>>sth<<} \u8868\u793a\u6ce8\u89e3,\u7070\u8272\u80cc\u666f\u9ad8\u4eae ==sth== \u9ec4\u8272\u80cc\u666f\u9ad8\u4eae {==sth==} \u9ec4\u8272\u80cc\u666f\u9ad8\u4eae $sth$ \u884c\u5185\u5f0f\u6570\u5b66\u516c\u5f0f \\(sth)\\ \u884c\u5185\u5f0f\u6570\u5b66\u516c\u5f0f $$...$$ \u533a\u5757\u5f0f\u6570\u5b66\u516c\u5f0f \\begin{}...\\end{} \u533a\u5757\u5f0f\u6570\u5b66\u516c\u5f0f [text](url \"title\") \u884c\u5185\u5f0f\u94fe\u63a5 [text][index],\u6587\u6863\u6700\u540e[index]: url \"title\" \u53c2\u8003\u5f0f\u94fe\u63a5 \u7b26\u5408\u8981\u6c42\u7684URL \u81ea\u52a8\u94fe\u63a5 ![alt](url \"title\") \u884c\u5185\u5f0f\u56fe\u7247 ![alt][index],\u6587\u6863\u6700\u540e[index]: url \"title\" \u53c2\u8003\u5f0f\u56fe\u7247","title":"1. \u8bed\u6cd5\u603b\u89c8"},{"location":"syntax/math_js/","text":"\u5148\u5728docs\u91cc\u521b\u5efajs\u76ee\u5f55\uff0c\u5e76\u5728js\u76ee\u5f55\u4e2d\u653e\u7f6eextra.js\uff1a window . MathJax = { tex2jax : { inlineMath : [ [ \"\\\\(\" , \"\\\\)\" ] ], displayMath : [ [ \"\\\\[\" , \"\\\\]\" ] ] }, TeX : { TagSide : \"right\" , TagIndent : \".8em\" , MultLineWidth : \"85%\" , equationNumbers : { autoNumber : \"AMS\" , }, unicode : { fonts : \"STIXGeneral,'Arial Unicode MS'\" } }, displayAlign : \"left\" , showProcessingMessages : false , messageStyle : \"none\" }; \u7136\u540e\u5728mkdocs.yml\u91cc\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff0c\u7528\u4e8e\u5bfc\u5165js extra_javascript : - 'js/extra.js' - 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML'","title":"17.2. \u5bfc\u5165js"},{"location":"syntax/math_main/","text":"\u7528\u4e8eTeX\u6570\u5b66\u516c\u5f0f\u7684\u5c55\u793a\uff0c\u4f7f\u7528\u4e4b\u524d\u8981\u5148\u5728docs/\u91cc\u521b\u5efajavascripts\u76ee\u5f55\uff0c\u5e76\u5728\u76ee\u5f55\u4e2d\u653e\u7f6eextra.js \u4f9d\u8d56\u6a21\u5757: pymdownx.arithmatex","title":"17.1. \u4ecb\u7ecd"},{"location":"syntax/math_usage/","text":"\u884c\u5185\u5199\u6cd5\u67092\u79cd: $...$ \u548c \\(...\\) \u533a\u5757\u5199\u6cd5\u67093\u79cd: $$...$$ , \\[...\\] , \u548c \\begin{}...\\end{} \u5177\u4f53\u7528\u6cd5\u8be6\u89c1: https://math.meta.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference http://www.andy-roberts.net/writing/latex/mathematics_1 http://www.andy-roberts.net/writing/latex/mathematics_2 \u6b64\u5904\u4ec5\u4e3e\u4e2a\u4f8b\u5b50(\u56e0\u4e3abegin end\u65b9\u5f0f\u6211\u8fd8\u4e0d\u591f\u4e86\u89e3)\uff1a $$ p(x|y) = \\frac{p(y|x)p(x)}{p(y)} $$ \u6548\u679c p(x|y) = \\frac{p(y|x)p(x)}{p(y)} p(x|y) = \\frac{p(y|x)p(x)}{p(y)} $p(x|y) = \\frac{p(y|x)p(x)}{p(y)}$ \u6548\u679c p(x|y) = \\frac{p(y|x)p(x)}{p(y)} p(x|y) = \\frac{p(y|x)p(x)}{p(y)}","title":"17.3. \u7528\u6cd5"},{"location":"syntax/meta/","text":"\u4f9d\u8d56\u6a21\u5757\uff1ameta mkdocs\u652f\u6301(\u5b9e\u9645\u662fpython markdown\u652f\u6301)\u7684\u5143\u4fe1\u606f\u5185\u5bb9\uff0c\u4f1a\u88ab\u81ea\u52a8\u8f6c\u4e3a\u5bf9\u5e94\u7684html\uff0c\u76ee\u524d\u652f\u6301\u4ee5\u4e0b4\u79cdmeta title: Lorem ipsum dolor sit amet description: Nullam urna elit, malesuada eget finibus ut, ac tortor. path: path/to/file source: file.js \u6ce8\u610f: \u8981\u5199\u5728markdown\u6587\u6863\u7684\u6700\u4e0a\u65b9 \u5199\u5b8c\u540e\u8981\u52a0\u4e00\u4e2a\u7a7a\u884c \u4f1a\u88ab\u81ea\u52a8\u7ffb\u8bd1\u6210 &lt;head&gt; &lt;meta name=\"description\" content=\"Nullam urna elit, malesuada eget finibus ut, ac tortor.\"&gt; &lt;title&gt;Lorem ipsum dolor sit amet&lt;/title&gt; &lt;/head&gt; \u4ee5\u53ca&lt;body&gt;\u4e2d\u67d0\u4e2a\u4f4d\u7f6e\u4f1a\u770b\u5230&lt;a href=\"/path/to/file/file.js\" title=\"file.js\" class=\"md-source-file\"&gt; \u5176\u4e2dpath\u548csource\u7684\u6548\u679c:","title":"16. \u5143\u4fe1\u606f"},{"location":"syntax/nest_green_code/","text":"\u6548\u679c print \"Hello, world!\" print \"Hello, world!\" print \"Hello, world!\"","title":"20.9. \u7eff\u8272\u533a\u5757-\u4ee3\u7801"},{"location":"syntax/nest_greenred_code/","text":"\u6548\u679c print \"Hello, world!\" print \"Hello, our world!\" print \"Hello, my world!\" print \"Hello, our world!\"","title":"20.11. \u7eff\u63a5\u7ea2\u533a\u5757-\u4ee3\u7801"},{"location":"syntax/nest_list_code/","text":"\u4ee5\u4e0b3\u79cd\u6548\u679c\u76f8\u540c: \u4e00. \u4e0d\u7f29\u8fdb\uff0c\u65e0\u7a7a\u884c - list1 ```python text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 ``` \u4e8c. \u7f29\u8fdb\uff0c\u65e0\u7a7a\u884c - list1 ```python text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 ``` \u4e09. \u7f29\u8fdb\uff0c\u6709\u7a7a\u884c - list1 ```python text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 ``` \u6548\u679c\u5747\u5982\u4e0b list1 text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 \u6ce8\u610f: \u4e0d\u80fd\u65e0\u7f29\u8fdb\u5374\u6709\u7a7a\u884c\uff0c\u5982\u4e0b\u9762\u8fd9\u6837\u662f\u6709\u95ee\u9898\u7684\uff0c\u53ef\u4ee5\u81ea\u884c\u6d4b\u8bd5: - list1 ```python text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 ```","title":"20.6. \u5217\u8868-\u4ee3\u7801\u5757"},{"location":"syntax/nest_list_list/","text":"- aaa - bbb \u6548\u679c aaa bbb","title":"20.3. \u5217\u8868-\u5217\u8868"},{"location":"syntax/nest_list_list_quote/","text":"- aaa - bbb > ccc \u6548\u679c aaa bbb ccc","title":"20.13. \u5217\u8868-\u5217\u8868-\u5f15\u7528"},{"location":"syntax/nest_main/","text":"\u51e0\u4e4e\u6bcf\u79cd\u5177\u6709\u884c\u5185\u3001\u533a\u5757\u7684\u529f\u80fd\u6a21\u5757\u90fd\u80fd\u81ea\u8eab\u53ca\u76f8\u4e92\u4e4b\u95f4\u591a\u5c42\u5d4c\u5957\uff0c\u672c\u6587\u65e0\u6cd5\u4e00\u4e00\u9610\u8ff0\uff0c\u56e0\u6b64\u4ec5\u4e3e\u51e0\u4e2a\u4f8b\u5b50\u8bf4\u660e","title":"20.1. \u4ecb\u7ecd"},{"location":"syntax/nest_note_code/","text":"\u4f9d\u8d56\u6a21\u5757: pymdownx.superfences !!! note Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. ```python text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 ``` \u6548\u679c Note Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. text1 = \"Hello, \" text2 = \"world!\" print text1 + text2","title":"20.5. \u6ce8\u89e3-\u4ee3\u7801\u5757"},{"location":"syntax/nest_note_list_quote/","text":"!!! note \"test\" - aaa &gt; bbb \u6548\u679c test aaa bbb","title":"20.12. \u6ce8\u89e3-\u5217\u8868-\u5f15\u7528"},{"location":"syntax/nest_note_note/","text":"!!! note Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. !!! warning Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. \u6548\u679c Note Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. Warning Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.","title":"20.2. \u6ce8\u89e3-\u6ce8\u89e3"},{"location":"syntax/nest_quote_code/","text":"> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod > nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor > massa, nec semper lorem quam in massa. > ```go import \"fmt\" func main() { fmt.Println(\"Hello, world\") } ``` \u6548\u679c Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. import \"fmt\" func main () { fmt . Println ( \"Hello, world\" ) } \u53ef\u4ee5\u770b\u51fa\uff0c\u7528>\u65f6\u5019\uff0c\u8981\u6bcf\u884c\u7684>\u5185\u5bb9\u7f29\u8fdb\u5bf9\u9f50\uff0c\u4e0d\u8fc7\uff0c\u5982\u679c\u662f\u4e00\u4e2a\u4ee3\u7801\u5757\u7684\u8bdd\uff0c\u53ea\u9700\u8981\u7b2c\u4e00\u4e2a>\u5373\u53ef \u4f46\u8981\u6ce8\u610f, \u4e0a\u9762\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u80fd\u6709\u7a7a\u884c\uff0c\u5982\u679c\u6709\u7a7a\u884c\u5c31\u4f1a\u88ab\u8ba4\u4e3a\u7ec8\u6b62\uff0c\u6bd4\u5982\uff1a > ```go import \"fmt\" func main() { fmt.Println(\"Hello, world\") fmt.Println(\"last\") } ``` \u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u8981\u5728\u7a7a\u884c\u4e4b\u540e\u7684\u65b0\u884c\u518d\u7528>\u8868\u793a\u672a\u4e2d\u65ad\uff0c\u6bd4\u5982\uff1a > ```go import \"fmt\" func main() { fmt.Println(\"Hello, world\") > fmt.Println(\"last\") } ``` import \"fmt\" func main () { fmt . Println ( \"Hello, world\" ) fmt . Println ( \"last\" ) }","title":"20.7. \u5f15\u7528-\u4ee3\u7801\u5757"},{"location":"syntax/nest_quote_quote/","text":"> \u533a\u5757\u5f15\u7528 >> \u5d4c\u5957\u5f15\u7528 \u6548\u679c \u533a\u5757\u5f15\u7528 \u5d4c\u5957\u5f15\u7528","title":"20.4. \u5f15\u7528-\u5f15\u7528"},{"location":"syntax/nest_quote_quote_code/","text":"&gt; aaa &gt;&gt; bbb &gt;&gt;&gt; ```python text1 = \"Hello, \" text2 = \"world!\" print text1 + text2 ``` \u6548\u679c aaa bbb text1 = \"Hello, \" text2 = \"world!\" print text1 + text2","title":"20.14. \u5f15\u7528-\u5f15\u7528-\u4ee3\u7801"},{"location":"syntax/nest_red_code/","text":"\u6548\u679c print \"Hello, world!\" print \"Hello, world!\" print \"Hello, world!\"","title":"20.10. \u7ea2\u8272\u533a\u5757-\u4ee3\u7801"},{"location":"syntax/nest_yellow_code/","text":"\u6548\u679c print \"Hello, world!\" print \"Hello, world!\" print \"Hello, world!\"","title":"20.8. \u9ec4\u8272\u533a\u5757-\u4ee3\u7801"},{"location":"syntax/note_details/","text":"\u628a!!!\u6539\u6210???\uff0c\u6ce8\u610f\u6b64\u65f6\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u5426\u5219\u6837\u5f0f\u6709\u95ee\u9898 \u9002\u7528\u573a\u666f: \u6298\u53e0\u7279\u522b\u9002\u7528\u4e8eFAQ\uff0c\u5373\u6807\u9898\u91cc\u5199\u95ee\u9898\uff0c\u5185\u5bb9\u91cc\u5199\u7b54\u6848 \u4f9d\u8d56\u6a21\u5757: pymdownx.details ??? note \"\u6807\u9898\" \u5185\u5bb9 \u6548\u679c \u6807\u9898 \u5185\u5bb9 \u6ce8\u610f: \u6298\u53e0\u4e2d\u7684\u5185\u5bb9\u5728\u6298\u53e0\u672a\u6253\u5f00\u65f6\u5019\u901a\u8fc7ctrl-f\u662f\u641c\u7d22\u4e0d\u51fa\u6765\u7684\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u9875\u9762\u4e0a\u65b9\u7684Search\u680f\u91cc\u641c\u5230","title":"14.6. \u6298\u53e0"},{"location":"syntax/note_empty-title/","text":"!!! note \"\" \u5185\u5bb9 \u6548\u679c \u5185\u5bb9","title":"14.3. \u7a7a\u6807\u9898"},{"location":"syntax/note_full/","text":"!!! note \"\u6807\u9898\" \u5185\u5bb9 \u6548\u679c \u6807\u9898 \u5185\u5bb9","title":"14.2. \u5b8c\u6574\u683c\u5f0f"},{"location":"syntax/note_main/","text":"\u5199\u6ce8\u89e3\u4f7f\u7528\uff0c\u4f9d\u8d56\u6a21\u5757: admonition \u652f\u6301\u591a\u79cd\u6837\u5f0f\uff0c\u5982\u5e26\u6709\u6807\u9898\u3001\u65e0\u6807\u9898\u3001\u7a7a\u6807\u9898\uff0c\u8fd8\u652f\u6301\u6298\u53e0\u5f0f(\u5e38\u7528\u4e8eFAQ) \u652f\u6301\u591a\u79cd\u989c\u8272\u98ce\u683c\uff0c\u5305\u62ec\u8b66\u544a\u63d0\u793a\u3001\u9519\u8bef\u63d0\u793a\u3001\u6210\u529f\u63d0\u793a\u7b4911\u79cd\u98ce\u683c","title":"14.1. \u4ecb\u7ecd"},{"location":"syntax/note_nest/","text":"\u6ce8\u89e3\u6807\u9898\u548c\u5185\u5bb9\u652f\u6301\u591a\u79cd\u6837\u5f0f \u00b6 \u4f8b1. \u6807\u9898\u91cc\u4f7f\u7528\u659c\u4f53 !!! note \"*\u6807\u9898e*\" \u5185\u5bb9 \u6807\u9898 \u5185\u5bb9 \u4f8b2. \u5185\u5bb9\u91cc\u4f7f\u7528h1-h6 !!! note \"\u6807\u9898\" # h1 ## h2 ### h3 \u6ce8\u89e3\u5d4c\u5957\u4ee3\u7801\u5757 \u00b6 \u8be6\u89c1 \u6ce8\u89e3\u5d4c\u5957\u4ee3\u7801\u5757 \u7ae0\u8282 \u6ce8\u89e3\u5d4c\u5957\u6ce8\u89e3 \u00b6 \u8be6\u89c1 \u6ce8\u89e3\u5d4c\u5957\u6ce8\u89e3 \u7ae0\u8282","title":"14.8. \u5d4c\u5957"},{"location":"syntax/note_nest/#_1","text":"\u4f8b1. \u6807\u9898\u91cc\u4f7f\u7528\u659c\u4f53 !!! note \"*\u6807\u9898e*\" \u5185\u5bb9 \u6807\u9898 \u5185\u5bb9 \u4f8b2. \u5185\u5bb9\u91cc\u4f7f\u7528h1-h6 !!! note \"\u6807\u9898\" # h1 ## h2 ### h3","title":"\u6ce8\u89e3\u6807\u9898\u548c\u5185\u5bb9\u652f\u6301\u591a\u79cd\u6837\u5f0f"},{"location":"syntax/note_nest/#_2","text":"\u8be6\u89c1 \u6ce8\u89e3\u5d4c\u5957\u4ee3\u7801\u5757 \u7ae0\u8282","title":"\u6ce8\u89e3\u5d4c\u5957\u4ee3\u7801\u5757"},{"location":"syntax/note_nest/#_3","text":"\u8be6\u89c1 \u6ce8\u89e3\u5d4c\u5957\u6ce8\u89e3 \u7ae0\u8282","title":"\u6ce8\u89e3\u5d4c\u5957\u6ce8\u89e3"},{"location":"syntax/note_none-title/","text":"!!! note \u5185\u5bb9 \u6548\u679c Note \u5185\u5bb9 \u6ce8\u610f: \u65e0\u6807\u9898\u65f6\u7c7b\u578b\u9996\u5b57\u6bcd\u4f1a\u88ab\u5927\u5199\uff0c\u5982\u4e0a\u9762note\u88ab\u5927\u5199\u6210Note","title":"14.4. \u65e0\u6807\u9898"},{"location":"syntax/note_none-type/","text":"\u65e0\u7c7b\u578b\uff0c\u5219\u9ed8\u8ba4\u4e3anote \u6ce8\u610f\u8fd9\u4e2a\u65f6\u5019\u6807\u9898\u5fc5\u987b\u5199\u82f1\u6587\uff0c\u5e76\u4e14\u9996\u5b57\u6bcd\u4f1a\u88ab\u81ea\u52a8\u8f6c\u6210\u5927\u5199: !!! title \u5185\u5bb9 \u76f8\u5f53\u4e8e !!! note \"Title\" \u5185\u5bb9 \u6548\u679c Title \u5185\u5bb9","title":"14.5. \u65e0\u7c7b\u578b"},{"location":"syntax/note_style/","text":"\u670911\u79cd\u6837\u5f0f\uff0c\u6bcf\u4e00\u79cd\u6837\u5f0f\u90fd\u652f\u6301\u591a\u79cd\u5173\u952e\u5b57\uff0c\u6bd4\u5982note\u53ef\u4ee5\u7528seealso\u66ff\u4ee3\uff0csummary\u53ef\u4ee5\u7528tldr\u66ff\u4ee3 !!! note \"note, seealso\" Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. !!! summary \"summary, tldr\" Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. !!! info \"info, todo\" Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. !!! tip \"tip, hint, important\" Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. !!! success \"success, check, done\" Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. !!! question \"question, help, faq\" Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. !!! warning \"warning, caution, attention\" Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. !!! failure \"failure, fail, missing\" Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. !!! danger \"danger, error\" Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. !!! bug \"bug\" Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. !!! quote \"quote, cite\" Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. \u6548\u679c note, seealso Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. summary, tldr Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. info, todo Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. tip, hint, important Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. success, check, done Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor question, help, faq Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. warning, caution, attention Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. failure, fail, missing Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. danger, error Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. bug Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa. quote, cite Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.","title":"14.7. 11\u79cd\u989c\u8272\u6837\u5f0f"},{"location":"syntax/paragraph/","text":"\u4e00\u4e2a\u6bb5\u843d\u8868\u793a\u4e00\u4e2a\u8bed\u6cd5\u5757\uff0c\u6bcf\u4e2a\u8bed\u6cd5\u5757\u4e4b\u95f4\u8981\u6709\u7a7a\u884c\uff0c\u82e5\u60f3\u5728\u6bb5\u5185\u5f3a\u5236\u6362\u884c\u7684\u65b9\u5f0f\u662f\u4f7f\u7528 \u4e24\u4e2a\u4ee5\u4e0a \u7a7a\u683c\u52a0\u4e0a\u56de\u8f66\u3002 \u5efa\u8bae: \u5982\u679c\u5199\u4e00\u4e2a\u8bed\u6cd5\uff0c\u6548\u679c\u548c\u60f3\u8c61\u7684\u4e0d\u4e00\u6837\uff0c\u6bd4\u5982\u6324\u5728\u4e00\u884c\u5185\uff0c\u6216\u8005\u6ca1\u6709\u7f29\u8fdb\uff0c\u5219\u591a1\u30012\u4e2a\u6362\u884c\u8bd5\u8bd5","title":"3. \u6bb5\u843d"},{"location":"syntax/quote/","text":"\u5728\u6bb5\u843d\u7684\u6bcf\u884c\u6216\u8005\u53ea\u5728\u7b2c\u4e00\u884c\u4f7f\u7528\u7b26\u53f7 > \u8fd8\u53ef\u4f7f\u7528\u591a\u4e2a \u5d4c\u5957\u5f15\u7528 \uff0c\u5982\uff1a > \u533a\u5757\u5f15\u7528 \u6548\u679c\uff1a \u533a\u5757\u5f15\u7528","title":"4. \u5f15\u7528"},{"location":"syntax/symbol/","text":"\u4f9d\u8d56\u6a21\u5757: pymdownx.smartsymbols \u7528\u6cd5 \u6548\u679c (tm) \u2122 (c) \u00a9 (r) \u00ae c/o \u2105 +/- \u00b1 --> \u2192 <-- \u2190 <--> \u2194 =/= \u2260 1/4 3/5 \u00bc \u2157 1st 2nd 3rd 1 st 2 nd 3 rd","title":"19. \u7279\u6b8a\u7b26\u53f7"},{"location":"syntax/table/","text":"\u793a\u4f8b \u00b6 | \u5b57\u6bb51 | \u5b57\u6bb52 | \u5b57\u6bb53 | | :-- | :--: | --: | | A1 | B1 | C1 | | A2 | B2 | C2 | \u6548\u679c \u5b57\u6bb51 \u5b57\u6bb52 \u5b57\u6bb53 A1 B1 C1 A2 B2 C2 \u8be6\u89e3 \u00b6 \u81f3\u5c11\u75313\u884c\u7ec4\u6210 \u7b2c1\u884c\uff1a\u5b57\u6bb5\u540d | \u5b57\u6bb51 | \u5b57\u6bb52 | \u5b57\u6bb53 | \u7b2c2\u884c\uff1a\b\u8bbe\u7f6e\u5bf9\u9f50 | :-- | :--: | --: | \u5206\u522b\u8868\u793a\u4e3a\u5de6\u5bf9\u9f50\uff0c\u5c45\u4e2d\u5bf9\u9f50\uff0c\u53c8\u5bf9\u9f50\u3002\u53e6\u5916\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u8bbe\u7f6e\u5bf9\u9f50\uff0c\u5373\u4e0d\u5199\u5192\u53f7\uff0c\u4f46\u8fd9\u6837\u4e0d\u597d\u7ef4\u62a4\uff0c\u56e0\u6b64\u5efa\u8bae\u90fd\u8bbe\u7f6e\u5bf9\u9f50 \u7b2c3\u884c\u5f00\u59cb\uff1a\u6b63\u6587 | \u5185\u5bb91 | \u5185\u5bb92 | \u5185\u5bb93 | \u7a7a\u683c\u4e0d\u53ef\u5ffd\u7565 |\u5b57\u6bb51|\u5b57\u6bb52|\u5b57\u6bb53| \u8fd9\u6837\u662f\u6709\u95ee\u9898\u7684\uff0c\u7a7a\u683c1\u4e2a\uff0c\u4e5f\u53ef\u4ee5\u591a\u4e2a\uff0c\u4f46\u4e0d\u80fd\u4e0d\u5199 \u6700\u5de6\u8fb9\u548c\u6700\u53f3\u8fb9\u7684|\u53ef\u7701\u7565 | \u5b57\u6bb51 | \u5b57\u6bb52 | \u5b57\u6bb53 | \u4e5f\u53ef\u4ee5\u5199\u6210\u8fd9\u6837 \u5b57\u6bb51 | \u5b57\u6bb52 | \u5b57\u6bb53 \u4e0d\u4ec5\u662f\u7b2c1\u884c\uff0c\u6bcf\u4e00\u884c\u90fd\u53ef\u4ee5\u8fd9\u4e48\u7701\u7565","title":"5. \u8868\u683c"},{"location":"syntax/table/#_1","text":"| \u5b57\u6bb51 | \u5b57\u6bb52 | \u5b57\u6bb53 | | :-- | :--: | --: | | A1 | B1 | C1 | | A2 | B2 | C2 | \u6548\u679c \u5b57\u6bb51 \u5b57\u6bb52 \u5b57\u6bb53 A1 B1 C1 A2 B2 C2","title":"\u793a\u4f8b"},{"location":"syntax/table/#_2","text":"\u81f3\u5c11\u75313\u884c\u7ec4\u6210 \u7b2c1\u884c\uff1a\u5b57\u6bb5\u540d | \u5b57\u6bb51 | \u5b57\u6bb52 | \u5b57\u6bb53 | \u7b2c2\u884c\uff1a\b\u8bbe\u7f6e\u5bf9\u9f50 | :-- | :--: | --: | \u5206\u522b\u8868\u793a\u4e3a\u5de6\u5bf9\u9f50\uff0c\u5c45\u4e2d\u5bf9\u9f50\uff0c\u53c8\u5bf9\u9f50\u3002\u53e6\u5916\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u8bbe\u7f6e\u5bf9\u9f50\uff0c\u5373\u4e0d\u5199\u5192\u53f7\uff0c\u4f46\u8fd9\u6837\u4e0d\u597d\u7ef4\u62a4\uff0c\u56e0\u6b64\u5efa\u8bae\u90fd\u8bbe\u7f6e\u5bf9\u9f50 \u7b2c3\u884c\u5f00\u59cb\uff1a\u6b63\u6587 | \u5185\u5bb91 | \u5185\u5bb92 | \u5185\u5bb93 | \u7a7a\u683c\u4e0d\u53ef\u5ffd\u7565 |\u5b57\u6bb51|\u5b57\u6bb52|\u5b57\u6bb53| \u8fd9\u6837\u662f\u6709\u95ee\u9898\u7684\uff0c\u7a7a\u683c1\u4e2a\uff0c\u4e5f\u53ef\u4ee5\u591a\u4e2a\uff0c\u4f46\u4e0d\u80fd\u4e0d\u5199 \u6700\u5de6\u8fb9\u548c\u6700\u53f3\u8fb9\u7684|\u53ef\u7701\u7565 | \u5b57\u6bb51 | \u5b57\u6bb52 | \u5b57\u6bb53 | \u4e5f\u53ef\u4ee5\u5199\u6210\u8fd9\u6837 \u5b57\u6bb51 | \u5b57\u6bb52 | \u5b57\u6bb53 \u4e0d\u4ec5\u662f\u7b2c1\u884c\uff0c\u6bcf\u4e00\u884c\u90fd\u53ef\u4ee5\u8fd9\u4e48\u7701\u7565","title":"\u8be6\u89e3"},{"location":"tools/elinks/elinks.index/","text":"1. \u4ecb\u7ecd \u00b6 \u5229\u7528Linux\u670d\u52a1\u5668\u5b9e\u73b0\u5bf9\u76ee\u6807\u9875\u9762\u7684\u5b9a\u65f6\u8bbf\u95ee\u53ef\u80fd\u67d0\u4e9b\u540c\u5b66\u4f1a\u4f7f\u7528\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u7cfb\u7edf\uff0c\u80af\u5b9a\u6709\u65b9\u6cd5\u5b9e\u73b0\u5bf9\u7f51\u7ad9\u7684\u8bbf\u95ee\uff0c\u7ecf\u8fc7\u7814\u7a76\u5f97\u77e5\u5728linux\u7cfb\u7edf\u4e2d\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u884c\u6d4f\u89c8\u5668\u5b9e\u73b0\u5bf9\u7f51\u7ad9\u7684\u8bbf\u95ee\uff0c\u7279\u6b64\u6574\u7406\u4e86\u547d\u4ee4\u884c\u6d4f\u89c8\u5668\u7684\u5b89\u88c5\u65b9\u6cd5\u3002 2. \u5b89\u88c5 \u00b6 \u5728\u670d\u52a1\u5668centos\u7cfb\u7edf\u4e2d\u5b89\u88c5links\u547d\u4ee4\u884c\u6d4f\u89c8\u5668\uff0c\u6267\u884c\u547d\u4ee4 centos yum install elinks ubuntu apt-get install elinks root@leco:/home/leco/jike/pojie# elinks http://192.168.5.110:7000 --dump \u6781\u9a8c\u9a8c\u8bc1SDKDemo -------------------------------------------------------------------------- \u5f39\u51fa\u5f0fDemo\uff0c\u4f7f\u7528ajax\u5f62\u5f0f\u63d0\u4ea4\u4e8c\u6b21\u9a8c\u8bc1\u7801\u6240\u9700\u7684\u9a8c\u8bc1\u7ed3\u679c\u503c \u7528\u6237\u540d\uff1a [1]_____________________ \u5bc6 \u7801\uff1a [2]_____________________ [3][ \u63d0\u4ea4 ] -------------------------------------------------------------------------- \u5d4c\u5165\u5f0fDemo\uff0c\u4f7f\u7528\u8868\u5355\u5f62\u5f0f\u63d0\u4ea4\u4e8c\u6b21\u9a8c\u8bc1\u6240\u9700\u7684\u9a8c\u8bc1\u7ed3\u679c\u503c \u7528\u6237\u540d\uff1a [4]_____________________ \u5bc6 \u7801\uff1a [5]_____________________ \u6b63\u5728\u52a0\u8f7d\u9a8c\u8bc1\u7801...... \u8bf7\u5148\u62d6\u52a8\u9a8c\u8bc1\u7801\u5230\u76f8\u5e94\u4f4d\u7f6e [6][ \u63d0\u4ea4 ] References Visible links","title":"1. elinks"},{"location":"tools/elinks/elinks.index/#1","text":"\u5229\u7528Linux\u670d\u52a1\u5668\u5b9e\u73b0\u5bf9\u76ee\u6807\u9875\u9762\u7684\u5b9a\u65f6\u8bbf\u95ee\u53ef\u80fd\u67d0\u4e9b\u540c\u5b66\u4f1a\u4f7f\u7528\uff0c\u4f5c\u4e3a\u4e00\u4e2a\u7cfb\u7edf\uff0c\u80af\u5b9a\u6709\u65b9\u6cd5\u5b9e\u73b0\u5bf9\u7f51\u7ad9\u7684\u8bbf\u95ee\uff0c\u7ecf\u8fc7\u7814\u7a76\u5f97\u77e5\u5728linux\u7cfb\u7edf\u4e2d\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u884c\u6d4f\u89c8\u5668\u5b9e\u73b0\u5bf9\u7f51\u7ad9\u7684\u8bbf\u95ee\uff0c\u7279\u6b64\u6574\u7406\u4e86\u547d\u4ee4\u884c\u6d4f\u89c8\u5668\u7684\u5b89\u88c5\u65b9\u6cd5\u3002","title":"1. \u4ecb\u7ecd"},{"location":"tools/elinks/elinks.index/#2","text":"\u5728\u670d\u52a1\u5668centos\u7cfb\u7edf\u4e2d\u5b89\u88c5links\u547d\u4ee4\u884c\u6d4f\u89c8\u5668\uff0c\u6267\u884c\u547d\u4ee4 centos yum install elinks ubuntu apt-get install elinks root@leco:/home/leco/jike/pojie# elinks http://192.168.5.110:7000 --dump \u6781\u9a8c\u9a8c\u8bc1SDKDemo -------------------------------------------------------------------------- \u5f39\u51fa\u5f0fDemo\uff0c\u4f7f\u7528ajax\u5f62\u5f0f\u63d0\u4ea4\u4e8c\u6b21\u9a8c\u8bc1\u7801\u6240\u9700\u7684\u9a8c\u8bc1\u7ed3\u679c\u503c \u7528\u6237\u540d\uff1a [1]_____________________ \u5bc6 \u7801\uff1a [2]_____________________ [3][ \u63d0\u4ea4 ] -------------------------------------------------------------------------- \u5d4c\u5165\u5f0fDemo\uff0c\u4f7f\u7528\u8868\u5355\u5f62\u5f0f\u63d0\u4ea4\u4e8c\u6b21\u9a8c\u8bc1\u6240\u9700\u7684\u9a8c\u8bc1\u7ed3\u679c\u503c \u7528\u6237\u540d\uff1a [4]_____________________ \u5bc6 \u7801\uff1a [5]_____________________ \u6b63\u5728\u52a0\u8f7d\u9a8c\u8bc1\u7801...... \u8bf7\u5148\u62d6\u52a8\u9a8c\u8bc1\u7801\u5230\u76f8\u5e94\u4f4d\u7f6e [6][ \u63d0\u4ea4 ] References Visible links","title":"2. \u5b89\u88c5"},{"location":"tools/git/git.branch/","text":"Git \u5206\u652f \u4ecb\u7ecd \u00b6 git\u5206\u652f\uff0c\u4ece\u672c\u8d28\u4e0a\u6765\u8bb2\u4ec5\u4ec5\u662f\u6307\u5411\u63d0\u4ea4\u5bf9\u8c61\u7684\u53ef\u53d8\u6307\u9488\uff0c\u5728\u8fd9\u4e00\u70b9\u4e0a\u4e0eSVN\u662f\u6709\u672c\u8d28\u533a\u522b\uff0cSVN\u7684\u5206\u652f\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u76ee\u5f55\u3002 git\u7684\u9ed8\u8ba4\u5206\u652f\u540d\u5b57\u662fmaster\u3002\u5728\u591a\u6b21\u63d0\u4ea4\u64cd\u4f5c\u4e4b\u540e\uff0c\u4f60\u5176\u5b9e\u5df2\u7ecf\u6709\u4e00\u4e2a\u6307\u5411\u6700\u540e\u90a3\u4e2a\u63d0\u4ea4\u5bf9\u8c61\u7684master\u5206\u652f\uff0c\u5b83\u4f1a\u5728\u6bcf\u6b21\u7684\u63d0\u4ea4\u64cd\u4f5c\u4e2d\u81ea\u52a8\u5411\u524d\u79fb\u52a8\u3002 \u67e5\u770b\u5206\u652f git branch \u521b\u5efa\u5206\u652f git branch testing \u5207\u6362\u5206\u652f git checkout testing \u5408\u5e76\u5206\u652f \u5728\u8c01\u4e0a\u5408\u5e76\u8c01\u7684\u5206\u652f\u8981\u6ce8\u610f\uff0c\u6bd4\u5982\u5728master\u7684\u5206\u652f\u4e0a\u5408\u5e76testing\u5206\u652f\uff0c\u5c31\u5148\u5207\u6362\u5230master\u5206\u652f\u4e0a \u5207\u6362\u5230master\u5206\u652f\u4e0a\u5728\u6267\u884c git merge testing \u5220\u9664\u5206\u652f git branch -d testing root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# git log --oneline --decorate 1afadfd (HEAD -> master) modify a second # \u6700\u540e\u6307\u5411 ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a \u89e3\u91ca - HEAD \u6307\u5411\u8c01\uff0c\u5f53\u524d\u5c31\u662f\u54ea\u4e2a\u5206\u652f - \u64cd\u4f5c\u4e4b\u540e\uff0c\u6700\u540e\u6307\u5411\u90a3\u4e2a\u63d0\u4ea4\u7684\u5206\u652f graph LR A[HEAD]-->B[master] B-->C[f30ab] E[V1.0]-->C C-->D[Snapshot C] F[34ac2]-->C F-->G[Snapshot B] H[98ca9]-->F H-->I[Snapshot A] \u5728\u5b9e\u9645\u9879\u76ee\u5f00\u53d1\u4e2d\uff0c\u5c3d\u91cf\u4fdd\u8bc1master\u5206\u652f\u7a33\u5b9a\uff0c\u4ec5\u7528\u4e8e\u53d1\u5e03\u65b0\u9881\u5e03\uff0c\u5e73\u65f6\u4e0d\u8981\u968f\u4fbf\u76f4\u63a5\u4fee\u6539\u91cc\u9762\u7684\u6570\u636e\u6587\u4ef6 \u5e72\u6d3b\u90fd\u5728dev\u5206\u652f\u4e0a\uff0c\u6bcf\u4eba\u4ecedev\u5206\u652f\u521b\u5efa\u81ea\u5df1\u7684\u4e2a\u4eba\u5206\u652f\uff0c\u5f00\u53d1\u5b8c\u5408\u5e76\u5230dev\u5206\u652f\uff0c\u6700\u540edev\u5206\u652f\u5408\u5e76\u5230master\u5206\u652f\u4e0a \u521b\u5efa\u5206\u652f root@k8s4:~/git_test# git branch testing \u67e5\u770b\u5206\u652f root@k8s4:~/git_test# git branch * master # \u5f53\u524d\u5728master\u5206\u652f\uff08\u770b*\u53f7\u4f4d\u7f6e\uff09 testing \u6b64\u65f6master\u5206\u652f\u548ctesting\u5206\u652f\u90fd\u6307\u5411\u6700\u540e\u63d0\u4ea4\u7684\u90a3\u4e2acommit 1afadfd (HEAD -> master, testing) modify a second # \u770b\u5730\u65b9\u5c31\u6307\u5411\u4e86\u54ea\u4e2acommit ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a - \u5207\u6362\u5206\u652f root@k8s4:~/git_test# git checkout testing Switched to branch 'testing' root@k8s4:~/git_test# git branch master * testing root@k8s4:~/git_test# cat a 1 bbb \u5728testing\u5206\u652f\u4e0b\u64cd\u4f5c root@k8s4:~/git_test# git branch * master testing root@k8s4:~/git_test# git checkout testing Switched to branch 'testing' root@k8s4:~/git_test# git branch master * testing root@k8s4:~/git_test# cat a 1 bbb root@k8s4:~/git_test# git log --oneline --decorate 1afadfd (HEAD -> testing, master) modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a root@k8s4:~/git_test# touch test root@k8s4:~/git_test# git add . root@k8s4:~/git_test# git commit -m 'commit test on branch testing ' [testing 81cec5e] commit test on branch testing 1 file changed, 0 insertions(+), 0 deletions(-) create mode 100644 test root@k8s4:~/git_test# git status On branch testing nothing to commit, working directory clean root@k8s4:~/git_test# ls a test root@k8s4:~/git_test# git log --oneline --decorate 81cec5e (HEAD -> testing) commit test on branch testing 1afadfd (master) modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a root@k8s4:~/git_test# git branch master * testing root@k8s4:~/git_test# git checkout master Switched to branch 'master' root@k8s4:~/git_test# git branch * master testing root@k8s4:~/git_test# ls a \u6b64\u65f6\u770b\u5230\u5728testing\u5206\u652f\u4e0a\u7684\u64cd\u4f5c\uff0c\u5728master\u4e0a\u6ca1\u6709(\u9700\u8981\u5408\u5e76)\uff0c\u56e0\u4e3amaster\u548chead\u7684HEAD\u6307\u5411\u4e0d\u540c\u7684commit\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u591a\u4eba\u534f\u4f5c\u3002 \u5728master\u5206\u652f\u4e0b\u64cd\u4f5c root@k8s4:~/git_test# git branch * master testing root@k8s4:~/git_test# touch master root@k8s4:~/git_test# git add . root@k8s4:~/git_test# git commit -m 'commit master in branch master' [master 21af5cc] commit master in branch master 1 file changed, 0 insertions(+), 0 deletions(-) create mode 100644 master root@k8s4:~/git_test# git log --oneline --decorate 21af5cc (HEAD -> master) commit master in branch master 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a \u5408\u5e76\u5206\u652f testing\u5206\u652f\u5408\u5e76\u5230master\u5206\u652f\u4e0a \u9996\u5148\u5728master\u5206\u652f\u4e0a\u6267\u884c root@k8s4:~/git_test# git branch * master testing root@k8s4:~/git_test# git merge testing \u6b64\u65f6\u4f1a\u5f39\u51fa\u4e00\u4e2a\u754c\u9762\uff0c\u8bb0\u5f55\u6b64\u6b21\u64cd\u4f5c GNU nano 2.5.3 File: /root/git_test/.git/MERGE_MSG Modified Merge branch 'testing' # Please enter a commit message to explain why this merge is necessary, # especially if it merges an updated upstream into a topic branch. # # Lines starting with '#' will be ignored, and an empty message aborts # the commit. merge testing to master # \u65b0\u589e\u5185\u5bb9 \u8bb0\u5f55\u5408\u5e76\u4e86\u4ec0\u4e48\u4fe1\u606f merge test to master \u6b64\u65f6\u6309\u4e0bctrl + X \u540e\u518d\u6309\u4e0bY \u4fdd\u5b58\u9000\u51fa Merge made by the 'recursive' strategy. test | 0 1 file changed, 0 insertions(+), 0 deletions(-) create mode 100644 test # \u6b64\u65f6\u53ef\u4ee5\u770b\u5230testing\u5206\u652f\u4e0b\u7684\u6570\u636e\u5df2\u7ecf\u5408\u5e76\u8fc7\u6765\u4e86 root@k8s4:~/git_test# ls a master test root@k8s4:~/git_test# git branch * master \u6b64\u65f6\u53ef\u4ee5\u770b\u5230testing\u5206\u652f\u5408\u5e76\u8fc7\u6765\u7684\u6570\u636e root@k8s4:~/git_test# git log --oneline --decorat a369899 (HEAD -> master) Merge branch 'testing' 21af5cc commit master in branch master 81cec5e (testing, mster) commit test on branch testing 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a # \u5207\u6362\u5230testing\u5206\u652f\u67e5\u770b\u4fe1\u606f root@k8s4:~/git_test# git checkout testing Switched to branch 'testing' root@k8s4:~/git_test# ls a test root@k8s4:~/git_test# git log --oneline --decorat 81cec5e (HEAD -> testing, mster) commit test on branch testing 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a \u4e0d\u540c\u5206\u652f\u4fee\u6539\u540c\u4e00\u4e2a\u6587\u4ef6\u540e\u5408\u5e76 root@k8s4:~/git_test# git branch # \u67e5\u770b\u5f53\u524d\u5206\u652f * master testing root@k8s4:~/git_test# ls a master test root@k8s4:~/git_test# cat a 1 bbb root@k8s4:~/git_test# echo 'master'>>a # \u5728master\u5206\u652f\u4e0a\u4fee\u6539\u63d0\u4ea4\u6570\u636e root@k8s4:~/git_test# git add . root@k8s4:~/git_test# git commit -m 'modify a on master' [master 41d0dd3] modify a on master 1 file changed, 1 insertion(+) root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# git log --oneline --decorat # \u67e5\u770bmaster\u5206\u652f\u4e0a\u65e5\u5fd7 41d0dd3 (HEAD -> master) modify a on master a369899 Merge branch 'testing' 21af5cc commit master in branch master 81cec5e (testing, mster) commit test on branch testing 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a root@k8s4:~/git_test# git checkout testing # \u5207\u6362\u5230testing\u5206\u652f\u4e0a\u64cd\u4f5c\u6570\u636e Switched to branch 'testing' root@k8s4:~/git_test# ls a test root@k8s4:~/git_test# cat a 1 bbb root@k8s4:~/git_test# echo 'testing'>>a # testing\u5206\u652f\u4e0a\u4fee\u6539\u63d0\u4ea4\u6570\u636e root@k8s4:~/git_test# git add . root@k8s4:~/git_test# git commit -m 'modify a on testing branch' [testing 65b3dce] modify a on testing branch 1 file changed, 1 insertion(+) root@k8s4:~/git_test# git checkout master # \u5207\u6362\u5230master\u5206\u652f\u4e0a \u5408\u5e76testing\u5206\u652f Switched to branch 'master' root@k8s4:~/git_test# git merge testing Auto-merging a CONFLICT (content): Merge conflict in a Automatic merge failed; fix conflicts and then commit the result. root@k8s4:~/git_test# git status On branch master You have unmerged paths. (fix conflicts and run \"git commit\") Unmerged paths: (use \"git add <file>...\" to mark resolution) both modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") # \u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u5c31\u662fmaster\u5206\u652f\u548ctesting\u5206\u652f\u90fd\u540c\u65f6\u4fee\u6539\u4e86\u540c\u4e00\u4e2a\u6587\u4ef6a,\u8fd9\u6837\u7684\u60c5\u51b5\u5fc5\u987b\u624b\u52a8\u4fee\u6539 root@k8s4:~/git_test# cat a # \u67e5\u770b\u540c\u4e00\u4e2a\u6587\u4ef6\u5728\u4e24\u4e2a\u5206\u652f\u4e0b\u7684\u5dee\u5f02 1 bbb <<<<<<< HEAD master # \u5728master\u4e0b\u7684\u4fee\u6539 ======= testing # \u5728testing\u4e0b\u4fee\u6539 >>>>>>> testing - \u5982\u4f55\u89e3\u51b3\u51b2\u7a81 - \u5c31\u662f\u5728master\u5206\u652f\u4e0a\u4fee\u6539\u6210\u4f60\u8ba4\u4e3a\u5bf9 root@k8s4:~/git_test# git branch * master testing root@k8s4:~/git_test# vim a root@k8s4:~/git_test# cat a # \u8ba4\u4e3a\u6b63\u786e\u7684 1 bbb master testing root@k8s4:~/git_test# git status On branch master You have unmerged paths. (fix conflicts and run \"git commit\") Unmerged paths: (use \"git add <file>...\" to mark resolution) both modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git add . # \u91cd\u65b0\u63d0\u4ea4 root@k8s4:~/git_test# git commit -m 'meger testing to master both modify a' [master 495c011] meger testing to master both modify a root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# git log --oneline --decorat # \u67e5\u770b\u65e5\u5fd7 495c011 (HEAD -> master) meger testing to master both modify a 65b3dce (testing) modify a on testing branch 41d0dd3 modify a on master a369899 Merge branch 'testing' 21af5cc commit master in branch master 81cec5e (mster) commit test on branch testing 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a \u5220\u9664\u5206\u652f root@k8s4:~/git_test# git branch * master testing root@k8s4:~/git_test# git branch -d testing Deleted branch testing (was 65b3dce). root@k8s4:~/git_test# git branch * master","title":"3. git \u5206\u652f"},{"location":"tools/git/git.branch/#_1","text":"git\u5206\u652f\uff0c\u4ece\u672c\u8d28\u4e0a\u6765\u8bb2\u4ec5\u4ec5\u662f\u6307\u5411\u63d0\u4ea4\u5bf9\u8c61\u7684\u53ef\u53d8\u6307\u9488\uff0c\u5728\u8fd9\u4e00\u70b9\u4e0a\u4e0eSVN\u662f\u6709\u672c\u8d28\u533a\u522b\uff0cSVN\u7684\u5206\u652f\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u76ee\u5f55\u3002 git\u7684\u9ed8\u8ba4\u5206\u652f\u540d\u5b57\u662fmaster\u3002\u5728\u591a\u6b21\u63d0\u4ea4\u64cd\u4f5c\u4e4b\u540e\uff0c\u4f60\u5176\u5b9e\u5df2\u7ecf\u6709\u4e00\u4e2a\u6307\u5411\u6700\u540e\u90a3\u4e2a\u63d0\u4ea4\u5bf9\u8c61\u7684master\u5206\u652f\uff0c\u5b83\u4f1a\u5728\u6bcf\u6b21\u7684\u63d0\u4ea4\u64cd\u4f5c\u4e2d\u81ea\u52a8\u5411\u524d\u79fb\u52a8\u3002 \u67e5\u770b\u5206\u652f git branch \u521b\u5efa\u5206\u652f git branch testing \u5207\u6362\u5206\u652f git checkout testing \u5408\u5e76\u5206\u652f \u5728\u8c01\u4e0a\u5408\u5e76\u8c01\u7684\u5206\u652f\u8981\u6ce8\u610f\uff0c\u6bd4\u5982\u5728master\u7684\u5206\u652f\u4e0a\u5408\u5e76testing\u5206\u652f\uff0c\u5c31\u5148\u5207\u6362\u5230master\u5206\u652f\u4e0a \u5207\u6362\u5230master\u5206\u652f\u4e0a\u5728\u6267\u884c git merge testing \u5220\u9664\u5206\u652f git branch -d testing root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# git log --oneline --decorate 1afadfd (HEAD -> master) modify a second # \u6700\u540e\u6307\u5411 ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a \u89e3\u91ca - HEAD \u6307\u5411\u8c01\uff0c\u5f53\u524d\u5c31\u662f\u54ea\u4e2a\u5206\u652f - \u64cd\u4f5c\u4e4b\u540e\uff0c\u6700\u540e\u6307\u5411\u90a3\u4e2a\u63d0\u4ea4\u7684\u5206\u652f graph LR A[HEAD]-->B[master] B-->C[f30ab] E[V1.0]-->C C-->D[Snapshot C] F[34ac2]-->C F-->G[Snapshot B] H[98ca9]-->F H-->I[Snapshot A] \u5728\u5b9e\u9645\u9879\u76ee\u5f00\u53d1\u4e2d\uff0c\u5c3d\u91cf\u4fdd\u8bc1master\u5206\u652f\u7a33\u5b9a\uff0c\u4ec5\u7528\u4e8e\u53d1\u5e03\u65b0\u9881\u5e03\uff0c\u5e73\u65f6\u4e0d\u8981\u968f\u4fbf\u76f4\u63a5\u4fee\u6539\u91cc\u9762\u7684\u6570\u636e\u6587\u4ef6 \u5e72\u6d3b\u90fd\u5728dev\u5206\u652f\u4e0a\uff0c\u6bcf\u4eba\u4ecedev\u5206\u652f\u521b\u5efa\u81ea\u5df1\u7684\u4e2a\u4eba\u5206\u652f\uff0c\u5f00\u53d1\u5b8c\u5408\u5e76\u5230dev\u5206\u652f\uff0c\u6700\u540edev\u5206\u652f\u5408\u5e76\u5230master\u5206\u652f\u4e0a \u521b\u5efa\u5206\u652f root@k8s4:~/git_test# git branch testing \u67e5\u770b\u5206\u652f root@k8s4:~/git_test# git branch * master # \u5f53\u524d\u5728master\u5206\u652f\uff08\u770b*\u53f7\u4f4d\u7f6e\uff09 testing \u6b64\u65f6master\u5206\u652f\u548ctesting\u5206\u652f\u90fd\u6307\u5411\u6700\u540e\u63d0\u4ea4\u7684\u90a3\u4e2acommit 1afadfd (HEAD -> master, testing) modify a second # \u770b\u5730\u65b9\u5c31\u6307\u5411\u4e86\u54ea\u4e2acommit ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a - \u5207\u6362\u5206\u652f root@k8s4:~/git_test# git checkout testing Switched to branch 'testing' root@k8s4:~/git_test# git branch master * testing root@k8s4:~/git_test# cat a 1 bbb \u5728testing\u5206\u652f\u4e0b\u64cd\u4f5c root@k8s4:~/git_test# git branch * master testing root@k8s4:~/git_test# git checkout testing Switched to branch 'testing' root@k8s4:~/git_test# git branch master * testing root@k8s4:~/git_test# cat a 1 bbb root@k8s4:~/git_test# git log --oneline --decorate 1afadfd (HEAD -> testing, master) modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a root@k8s4:~/git_test# touch test root@k8s4:~/git_test# git add . root@k8s4:~/git_test# git commit -m 'commit test on branch testing ' [testing 81cec5e] commit test on branch testing 1 file changed, 0 insertions(+), 0 deletions(-) create mode 100644 test root@k8s4:~/git_test# git status On branch testing nothing to commit, working directory clean root@k8s4:~/git_test# ls a test root@k8s4:~/git_test# git log --oneline --decorate 81cec5e (HEAD -> testing) commit test on branch testing 1afadfd (master) modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a root@k8s4:~/git_test# git branch master * testing root@k8s4:~/git_test# git checkout master Switched to branch 'master' root@k8s4:~/git_test# git branch * master testing root@k8s4:~/git_test# ls a \u6b64\u65f6\u770b\u5230\u5728testing\u5206\u652f\u4e0a\u7684\u64cd\u4f5c\uff0c\u5728master\u4e0a\u6ca1\u6709(\u9700\u8981\u5408\u5e76)\uff0c\u56e0\u4e3amaster\u548chead\u7684HEAD\u6307\u5411\u4e0d\u540c\u7684commit\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u591a\u4eba\u534f\u4f5c\u3002 \u5728master\u5206\u652f\u4e0b\u64cd\u4f5c root@k8s4:~/git_test# git branch * master testing root@k8s4:~/git_test# touch master root@k8s4:~/git_test# git add . root@k8s4:~/git_test# git commit -m 'commit master in branch master' [master 21af5cc] commit master in branch master 1 file changed, 0 insertions(+), 0 deletions(-) create mode 100644 master root@k8s4:~/git_test# git log --oneline --decorate 21af5cc (HEAD -> master) commit master in branch master 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a \u5408\u5e76\u5206\u652f testing\u5206\u652f\u5408\u5e76\u5230master\u5206\u652f\u4e0a \u9996\u5148\u5728master\u5206\u652f\u4e0a\u6267\u884c root@k8s4:~/git_test# git branch * master testing root@k8s4:~/git_test# git merge testing \u6b64\u65f6\u4f1a\u5f39\u51fa\u4e00\u4e2a\u754c\u9762\uff0c\u8bb0\u5f55\u6b64\u6b21\u64cd\u4f5c GNU nano 2.5.3 File: /root/git_test/.git/MERGE_MSG Modified Merge branch 'testing' # Please enter a commit message to explain why this merge is necessary, # especially if it merges an updated upstream into a topic branch. # # Lines starting with '#' will be ignored, and an empty message aborts # the commit. merge testing to master # \u65b0\u589e\u5185\u5bb9 \u8bb0\u5f55\u5408\u5e76\u4e86\u4ec0\u4e48\u4fe1\u606f merge test to master \u6b64\u65f6\u6309\u4e0bctrl + X \u540e\u518d\u6309\u4e0bY \u4fdd\u5b58\u9000\u51fa Merge made by the 'recursive' strategy. test | 0 1 file changed, 0 insertions(+), 0 deletions(-) create mode 100644 test # \u6b64\u65f6\u53ef\u4ee5\u770b\u5230testing\u5206\u652f\u4e0b\u7684\u6570\u636e\u5df2\u7ecf\u5408\u5e76\u8fc7\u6765\u4e86 root@k8s4:~/git_test# ls a master test root@k8s4:~/git_test# git branch * master \u6b64\u65f6\u53ef\u4ee5\u770b\u5230testing\u5206\u652f\u5408\u5e76\u8fc7\u6765\u7684\u6570\u636e root@k8s4:~/git_test# git log --oneline --decorat a369899 (HEAD -> master) Merge branch 'testing' 21af5cc commit master in branch master 81cec5e (testing, mster) commit test on branch testing 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a # \u5207\u6362\u5230testing\u5206\u652f\u67e5\u770b\u4fe1\u606f root@k8s4:~/git_test# git checkout testing Switched to branch 'testing' root@k8s4:~/git_test# ls a test root@k8s4:~/git_test# git log --oneline --decorat 81cec5e (HEAD -> testing, mster) commit test on branch testing 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a \u4e0d\u540c\u5206\u652f\u4fee\u6539\u540c\u4e00\u4e2a\u6587\u4ef6\u540e\u5408\u5e76 root@k8s4:~/git_test# git branch # \u67e5\u770b\u5f53\u524d\u5206\u652f * master testing root@k8s4:~/git_test# ls a master test root@k8s4:~/git_test# cat a 1 bbb root@k8s4:~/git_test# echo 'master'>>a # \u5728master\u5206\u652f\u4e0a\u4fee\u6539\u63d0\u4ea4\u6570\u636e root@k8s4:~/git_test# git add . root@k8s4:~/git_test# git commit -m 'modify a on master' [master 41d0dd3] modify a on master 1 file changed, 1 insertion(+) root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# git log --oneline --decorat # \u67e5\u770bmaster\u5206\u652f\u4e0a\u65e5\u5fd7 41d0dd3 (HEAD -> master) modify a on master a369899 Merge branch 'testing' 21af5cc commit master in branch master 81cec5e (testing, mster) commit test on branch testing 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a root@k8s4:~/git_test# git checkout testing # \u5207\u6362\u5230testing\u5206\u652f\u4e0a\u64cd\u4f5c\u6570\u636e Switched to branch 'testing' root@k8s4:~/git_test# ls a test root@k8s4:~/git_test# cat a 1 bbb root@k8s4:~/git_test# echo 'testing'>>a # testing\u5206\u652f\u4e0a\u4fee\u6539\u63d0\u4ea4\u6570\u636e root@k8s4:~/git_test# git add . root@k8s4:~/git_test# git commit -m 'modify a on testing branch' [testing 65b3dce] modify a on testing branch 1 file changed, 1 insertion(+) root@k8s4:~/git_test# git checkout master # \u5207\u6362\u5230master\u5206\u652f\u4e0a \u5408\u5e76testing\u5206\u652f Switched to branch 'master' root@k8s4:~/git_test# git merge testing Auto-merging a CONFLICT (content): Merge conflict in a Automatic merge failed; fix conflicts and then commit the result. root@k8s4:~/git_test# git status On branch master You have unmerged paths. (fix conflicts and run \"git commit\") Unmerged paths: (use \"git add <file>...\" to mark resolution) both modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") # \u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\u5c31\u662fmaster\u5206\u652f\u548ctesting\u5206\u652f\u90fd\u540c\u65f6\u4fee\u6539\u4e86\u540c\u4e00\u4e2a\u6587\u4ef6a,\u8fd9\u6837\u7684\u60c5\u51b5\u5fc5\u987b\u624b\u52a8\u4fee\u6539 root@k8s4:~/git_test# cat a # \u67e5\u770b\u540c\u4e00\u4e2a\u6587\u4ef6\u5728\u4e24\u4e2a\u5206\u652f\u4e0b\u7684\u5dee\u5f02 1 bbb <<<<<<< HEAD master # \u5728master\u4e0b\u7684\u4fee\u6539 ======= testing # \u5728testing\u4e0b\u4fee\u6539 >>>>>>> testing - \u5982\u4f55\u89e3\u51b3\u51b2\u7a81 - \u5c31\u662f\u5728master\u5206\u652f\u4e0a\u4fee\u6539\u6210\u4f60\u8ba4\u4e3a\u5bf9 root@k8s4:~/git_test# git branch * master testing root@k8s4:~/git_test# vim a root@k8s4:~/git_test# cat a # \u8ba4\u4e3a\u6b63\u786e\u7684 1 bbb master testing root@k8s4:~/git_test# git status On branch master You have unmerged paths. (fix conflicts and run \"git commit\") Unmerged paths: (use \"git add <file>...\" to mark resolution) both modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git add . # \u91cd\u65b0\u63d0\u4ea4 root@k8s4:~/git_test# git commit -m 'meger testing to master both modify a' [master 495c011] meger testing to master both modify a root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# git log --oneline --decorat # \u67e5\u770b\u65e5\u5fd7 495c011 (HEAD -> master) meger testing to master both modify a 65b3dce (testing) modify a on testing branch 41d0dd3 modify a on master a369899 Merge branch 'testing' 21af5cc commit master in branch master 81cec5e (mster) commit test on branch testing 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a \u5220\u9664\u5206\u652f root@k8s4:~/git_test# git branch * master testing root@k8s4:~/git_test# git branch -d testing Deleted branch testing (was 65b3dce). root@k8s4:~/git_test# git branch * master","title":"\u4ecb\u7ecd"},{"location":"tools/git/git.gui/","text":"\u5229\u5668GIT 1. \u4ecb\u7ecd \u00b6 Git \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u7248\u672c\u63a7\u5236\u7cfb\u7edf\uff0c\u7528\u4e8e\u654f\u6377\u9ad8\u6548\u5730\u5904\u7406\u4efb\u4f55\u6216\u5c0f\u6216\u5927\u7684\u9879\u76ee\u3002 Git \u662f Linus Torvalds \u4e3a\u4e86\u5e2e\u52a9\u7ba1\u7406 Linux \u5185\u6838\u5f00\u53d1\u800c\u5f00\u53d1\u7684\u4e00\u4e2a\u5f00\u653e\u6e90\u7801\u7684\u7248\u672c\u63a7\u5236\u8f6f\u4ef6\u3002 Git \u4e0e\u5e38\u7528\u7684\u7248\u672c\u63a7\u5236\u5de5\u5177 CVS, Subversion \u7b49\u4e0d\u540c\uff0c\u5b83\u91c7\u7528\u4e86\u5206\u5e03\u5f0f\u7248\u672c\u5e93\u7684\u65b9\u5f0f\uff0c\u4e0d\u5fc5\u670d\u52a1\u5668\u7aef\u8f6f\u4ef6\u652f\u6301\u3002 1.2. Git \u4e0e SVN \u533a\u522b \u00b6 Git \u4e0d\u4ec5\u4ec5\u662f\u4e2a\u7248\u672c\u63a7\u5236\u7cfb\u7edf\uff0c\u5b83\u4e5f\u662f\u4e2a\u5185\u5bb9\u7ba1\u7406\u7cfb\u7edf(CMS)\uff0c\u5de5\u4f5c\u7ba1\u7406\u7cfb\u7edf\u7b49\u3002\u5982\u679c\u4f60\u662f\u4e00\u4e2a\u5177\u6709\u4f7f\u7528 SVN \u80cc\u666f\u7684\u4eba\uff0c\u4f60\u9700\u8981\u505a\u4e00\u5b9a\u7684\u601d\u60f3\u8f6c\u6362\uff0c\u6765\u9002\u5e94 Git \u63d0\u4f9b\u7684\u4e00\u4e9b\u6982\u5ff5\u548c\u7279\u5f81\u3002 Git \u4e0e SVN \u533a\u522b\u70b9\uff1a 1\u3001Git \u662f\u5206\u5e03\u5f0f\u7684\uff0cSVN \u4e0d\u662f\uff1a\u8fd9\u662f Git \u548c\u5176\u5b83\u975e\u5206\u5e03\u5f0f\u7684\u7248\u672c\u63a7\u5236\u7cfb\u7edf\uff0c\u4f8b\u5982 SVN\uff0cCVS \u7b49\uff0c\u6700\u6838\u5fc3\u7684\u533a\u522b\u3002 2\u3001Git \u628a\u5185\u5bb9\u6309\u5143\u6570\u636e\u65b9\u5f0f\u5b58\u50a8\uff0c\u800c SVN \u662f\u6309\u6587\u4ef6\uff1a\u6240\u6709\u7684\u8d44\u6e90\u63a7\u5236\u7cfb\u7edf\u90fd\u662f\u628a\u6587\u4ef6\u7684\u5143\u4fe1\u606f\u9690\u85cf\u5728\u4e00\u4e2a\u7c7b\u4f3c .svn\u3001.cvs \u7b49\u7684\u6587\u4ef6\u5939\u91cc\u3002 3\u3001Git \u5206\u652f\u548c SVN \u7684\u5206\u652f\u4e0d\u540c\uff1a\u5206\u652f\u5728 SVN \u4e2d\u4e00\u70b9\u90fd\u4e0d\u7279\u522b\uff0c\u5176\u5b9e\u5b83\u5c31\u662f\u7248\u672c\u5e93\u4e2d\u7684\u53e6\u5916\u4e00\u4e2a\u76ee\u5f55\u3002 4\u3001Git \u6ca1\u6709\u4e00\u4e2a\u5168\u5c40\u7684\u7248\u672c\u53f7\uff0c\u800c SVN \u6709\uff1a\u76ee\u524d\u4e3a\u6b62\u8fd9\u662f\u8ddf SVN \u76f8\u6bd4 Git \u7f3a\u5c11\u7684\u6700\u5927\u7684\u4e00\u4e2a\u7279\u5f81\u3002 5\u3001Git \u7684\u5185\u5bb9\u5b8c\u6574\u6027\u8981\u4f18\u4e8e SVN\uff1aGit \u7684\u5185\u5bb9\u5b58\u50a8\u4f7f\u7528\u7684\u662f SHA-1 \u54c8\u5e0c\u7b97\u6cd5\u3002\u8fd9\u80fd\u786e\u4fdd\u4ee3\u7801\u5185\u5bb9\u7684\u5b8c\u6574\u6027\uff0c\u786e\u4fdd\u5728\u9047\u5230\u78c1\u76d8\u6545\u969c\u548c\u7f51\u7edc\u95ee\u9898\u65f6\u964d\u4f4e\u5bf9\u7248\u672c\u5e93\u7684\u7834\u574f\u3002 \u603b\u4e4bGit\u548cSVN\u662f\u4e24\u4e2a\u5b8c\u5168\u4e0d\u540c\u601d\u7ef4\u65b9\u5f0f\u7684\u7248\u672c\u7ba1\u7406\uff0c\u7406\u89e3Git\u8981\u5b8c\u5168\u629b\u5f03SVN\u7684\u601d\u7ef4\u548c\u64cd\u4f5c\u3002 1.3 \u5206\u5e03\u5f0f \u00b6 \u548cSVN\u4e2d\u5fc3\u96c6\u4e2d\u5f0f\u6587\u4ef6\u7ba1\u7406\u7684\u4ed3\u50a8\u7ba1\u7406\u4e0d\u540c\uff0cGit\u4ece\u8bbe\u8ba1\u5230\u8bde\u751f\u5c31\u4ee5\u878d\u5165\u4e86\u5206\u5e03\u5f0f\u57fa\u56e0\u3002\u867d\u7136Git\u4e5f\u6709\u670d\u52a1\u5668\u7aef\u7684Github\u3001Gitlab\u3001Gogs\u7b49\u591a\u79cd\u670d\u52a1\u5668\u7aef\uff0c\u4f46\u662fGit\u6240\u6709\u64cd\u4f5c\u90fd\u53ef\u4ee5\u65e0\u670d\u52a1\u5668\u5b58\u5728\uff0c\u4f60\u53ef\u4ee5\u53ea\u5728\u672c\u5730\u90fd\u80fd\u5b8c\u6210\u6240\u6709git\u64cd\u4f5c\uff0c\u53ef\u4ee5\u5728\u76ee\u5f55\u4e4b\u95f4\u5b9e\u73b0clone\u3001push\u548cpull\u7b49\u9700\u8981\u670d\u52a1\u5668\u7aef\u7684\u64cd\u4f5c\u3002\u8bbe\u7f6e\u6743\u9650\u548c\u901a\u8baf\u65b9\u6cd5\u540e\uff0cGit\u5ba2\u6237\u7aef\u76f4\u63a5\u4e5f\u5b8c\u5168\u53ef\u4ee5\u5b9e\u73b0\u8fd9\u4e9b\u64cd\u4f5c\u3002\u6240\u4ee5\u6211\u4eec\u8bf4Git\u662f\u5929\u7136\u5206\u5e03\u5f0f\uff0c\u65e0\u9700\u4e2d\u5fc3\u670d\u52a1\u5668 \u4ecb\u5165\u3002Git\u670d\u52a1\u5668\u7684\u5f15\u5165\u4e00\u4e2a\u597d\u5904\u5c31\u662f\u628a\u4e00\u4e9b\u64cd\u4f5c\uff08\u6bd4\u5982\u6dfb\u52a0\u8bc1\u4e66\uff0c\u5efa\u7acb\u8d26\u53f7\u3001\u4ed3\u5e93\u5143\u4fe1\u606f\uff09\u548c\u901a\u8baf\u4f20\u8f93\u65b9\u6cd5\uff08http\u3001ssh\uff09\uff0c\u53ca\u5927\u91cf\u66f4\u591a\u6269\u5c55\u529f\u80fd\u5728\u670d\u52a1\u5668\u7aefWeb\u754c\u9762\u5b9e\u73b0\u4e86\uff0c\u65b9\u4fbf\u4e86\u7528\u6237\u7684\u4f7f\u7528\u3002\u5206\u5e03\u5f0f\u7684\u4e00\u4e2a\u597d\u5904\u662f\u4ee3\u7801\u53d8\u5316push\u597d\u7684\u4ed3\u5e93\u6570\u636e\uff0c\u6700\u5c11\u4fdd\u7559\u4e24\u4efd\uff1a\u672c\u5730\u4e00\u4efd\u548c\u670d\u52a1\u5668\u4e00\u4efd\uff0c\u4e0d\u6015\u4e22\u3002 1.4 \u4f18\u70b9 \u00b6 Git\u4e2d\u4ed3\u5e93\u4fe1\u606f\u90fd\u662f\u4ee5hash\u5065\u503c\u65b9\u5f0f\u4fdd\u5b58\u6587\u4ef6\u76f8\u5f53\u4e8e\u4e00\u4e2a\u6570\u636e\u5e93\uff0c\u5f53\u7528\u6237\u5b50\u5de5\u4f5c\u533a\u505a\u4e86add\u64cd\u4f5c\u540e\uff0c\u6b64\u540e\u53d8\u5316\u4fe1\u606f\u5c31\u6210\u4e86Git\u5bf9\u8c61\u6570\u636e\u5e93\u4e86\uff08blob\u3001commit\u3001three\u5bf9\u8c61\uff09\u3002\u901a\u8fc7git\u547d\u4ee4\uff08git clone checkout rest\uff09\u53ef\u4ee5\u5b9e\u73b0\u628agit\u6570\u636e\u5e93\uff08commit\u5386\u53f2\u5e93\u548c\u6682\u5b58\u533a\uff09\uff0c\u53d8\u5316\u6210\u7528\u6237\u5b9e\u9645\u63a5\u89e6\u5230\u6587\u4ef6\u548c\u76ee\u5f55\u7684\u5de5\u4f5c\u533a\u3002 \u8fd9\u662fGit\uff0c\u72ec\u7279\u4e4b\u5904\u548c\u4f18\u52bf\u4e4b\u5904\uff0c\u4e5f\u662f\u5f88\u591a\u521d\u5b66\u8005\u8ff7\u60d1\u6307\u51fa\uff0c\u5c24\u5176\u62ff\u4e4b\u524d\u4f7f\u7528SVN\u7684\u4eba\u65e0\u6cd5\u7406\u89e3\u7684\u3002Git\u7684\u56db\u4e2a\u533a\uff08\u5de5\u4f5c\u533a\u3001\u6682\u5b58\u533a\u3001\u672c\u5730\u4ed3\u5e93\u533a\u548c\u8fdc\u7a0b\u4ed3\u5e93\u533a\uff09\uff0c\u4e94\u4e2a\u72b6\u6001\u8f6c\u5316\u6d41\u7a0b\u5982\u4e0b\uff1a \u77e5\u9053\u4e86\u8fd9\u4e9bGit\u5c31\u5f88\u591a\u95ee\u9898\u5c31\u90fd\u5f88\u597d\u7406\u89e3\u4e86\u3002\u6bd4\u5982\u5206\u652f\uff0c\u6bd4\u5982\u6807\u7b7etag\uff0c\u6bd4\u5982Head\u8fd9\u4e9b\u90fd\u662f\u5bf9\u7279\u5b9acommit\u7684\u6307\u9488\uff0c\u6240\u4ee5\u5bf9\u62c9\u5206\u652f\uff0c\u5206\u652f\u95f4\u8f6c\u5316\u90fd\u5f88\u5bb9\u6613\uff0c\u4e0d\u8fc7\u628a\u6307\u9488\uff08\u5206\u652f\uff0cHead\uff09\u6307\u5411\u67d0\u4e2acommit\uff0c\u7136\u540e\u5229\u7528\u8be5commit ID\u518d\u751f\u6210\u5de5\u4f5c\u533a\u800c\u5df2\uff0c\u770b\u4e0a\u53bb\u5c31\u548c\u5728\u4e0d\u540c\u5206\u652f\u7684\u6587\u4ef6\u76ee\u5f55\u4e0b\u5207\u6362\uff0c\u800c\u4e14\u975e\u5e38\u8fc5\u901f\uff0c\u56e0\u4e3aGit\u7684\u662f\u6309\u7167\u5dee\u5f02\u5bf9\u6bd4\u6765\u751f\u6210\u5dee\u5f02\u7684\u76ee\u5f55\u548c\u6587\u4ef6\u7684\u3002 1.5 \u5de5\u4f5c\u539f\u7406 \u00b6 2.\u90e8\u7f72 \u00b6 2.1 \u5b89\u88c5\u5ba2\u6237\u7aef \u00b6 \u81ea\u884c\u767e\u5ea6\u4e0b\u8f7d\u3002 \u6211\u4ee5windows\u5b89\u88c5\u4e3a\u4f8b\u8bb2\u8ff0\u3002\u628a\u4ee5\u4e0b\u4e09\u4e2a\u8f6f\u4ef6\u4e0b\u8f7d\u3002 Git-2.21.0-64-bit.exe 08-Apr-2019 15:34 44M TortoiseGit-2.8.0.0-64bit.msi 08-Apr-2019 15:24 19M TortoiseGit-LanguagePack-2.8.0.0-64bit-zh_CN.msi 08-Apr-2019 15:24 4.1M 2.2 \u5b89\u88c5Git \u00b6 Git-2.21.0-64-bit.exe \u53cc\u51fb\u5b89\u88c5\uff0c\u4e0d\u8981\u505a\u4efb\u4f55\u4fee\u6539[\u9664\u975e\u4f60\u77e5\u9053\u600e\u4e48\u5b89\u88c5]\uff0c\u5b89\u88c5\u5b8c\u6bd5\u540e\uff0c\u5728windows\u684c\u9762\uff0c\u53f3\u51fb\u53ef\u4ee5\u770b\u5230\u4ee5\u4e0b\u4e24\u4e2a\u547d\u4ee4\u3002 Git GUI Here Git Bash Here \u4ee5\u4e0a\u8bf4\u660e\u4f60git\u8f6f\u4ef6\u5728windows\u7aef\u5b89\u88c5\u6210\u529f\u3002 2.3 \u5b89\u88c5TortoiseGit \u00b6 \u63a5\u4e0b\u6765\u5b89\u88c5\u5b89\u88c5git\u7684windows\u56fe\u50cf\u5316\u5de5\u5177TortoiseGit[\u4fd7\u79f0git\u5c0f\u4e4c\u9f9f]\u3002\u53cc\u51fb\u5b89\u88c5\u3002 \u70b9\u51fb\u4e2d\u95f4\u7684Next\u6309\u94ae\u3002 \u7ee7\u7eed\u70b9\u51fb\u4e2d\u95f4\u7684Next\u6309\u952e\u3002 \u4fdd\u6301\u9ed8\u8ba4\u3002\u7ee7\u7eed\u70b9\u51fb\u4e2d\u95f4Next\u6309\u952e\u3002 \u4e0d\u8981\u4efb\u4f55\u64cd\u4f5c\u3002\u9664\u975e\u4f60\u77e5\u9053\u600e\u4e48\u5b89\u88c5\u3002\u4e0d\u77e5\u9053\u7684\u8bdd\uff0c\u5c31\u70b9\u51fb\u90a3\u4e2aNext\u6309\u952e\u3002 \u70b9\u51fb\u4e2d\u95f4\u7684Install\u6309\u952e\uff0c\u7b49\u5f85\u5b89\u88c5\u5b8c\u6bd5\u3002 \u6b64\u65f6\u70b9\u51fbFinsh\u6309\u952e\u3002 \u6b64\u65f6\u6b64\u9875\u9762\u4e0d\u8981\u7740\u6025\u5173\u95ed\uff0c\u53bb\u5b89\u88c5\u6c49\u5316\u5305[\u4e0d\u9700\u8981\u7684\u53ef\u4ee5\u76f4\u63a5\u70b9\u51fb\u4e0b\u4e00\u6b65] 2.4 \u5b89\u88c5TortoiseGit\u6c49\u5316 \u00b6 \u53cc\u51fb\u5b89\u88c5\u6c49\u5316\u5305\u3002 TortoiseGit-LanguagePack-2.8.0.0-64bit-zh_CN.msi \u70b9\u51fb\u4e0b\u4e00\u6b65\u6309\u94ae\u3002 \u6b64\u65f6\u5b89\u88c5\u5b8c\u6bd5\uff0c\u4e0d\u8981\u914d\u7f6e\uff0c\u70b9\u51fb\u5b8c\u6210\u6309\u94ae\u3002 2.5 \u914d\u7f6eTortoiseGit\u6c49\u5316 \u00b6 \u5b89\u88c5\u5b8c\u6bd5\u3002 2.6 \u914d\u7f6e\u5168\u5c40\u53d8\u91cf \u00b6 \u684c\u9762\u53f3\u51fb\uff0c\u9009\u62e9 Git Bash Here \u5bf9git\u8fdb\u884c\u5168\u5c40\u914d\u7f6e git config --global credential.helper store git config --global https.sslVerify false \u5982\u4e0a\u8ff0\u64cd\u4f5c\u3002\u60f3\u77e5\u9053\u8fd9\u4e2a\u5e72\u5417\uff0c\u81ea\u884c\u53bb\u4f7f\u7528\u73b0\u4ee3\u5316\u5de5\u5177 \u767e\u5ea6\u4f20\u9001\u95e8 3. \u514b\u9686\u9879\u76ee \u00b6 3.1 \u5b58\u50a8 \u00b6 \u627e\u5230\u5408\u9002\u7684\u9879\u76ee\u5b58\u653e\u5730\u70b9\uff0c\u65b0\u5efa\u4e00\u4e2a\u7a7a\u6587\u4ef6\u5939\uff0c\u6587\u4ef6\u5939\u540d\u5b57\u770b\u4f60\u5fc3\u60c5\uff0c\u63a5\u4e0b\u6765\u6211\u521b\u5efa\u4e00\u4e2aserver[\u6211\u5c5e\u4e8e\u670d\u52a1\u5668\u7ec4]\u6587\u4ef6\u5939\u3002 \u8fdb\u5165\u65b0\u5efa\u7684server\u6587\u4ef6\u5939\uff0c\u53f3\u51fb \u9009\u62e9 Git Clone \u9009\u9879\uff0c\u7136\u540e\u8fdb\u9879\u9879\u76ee\u514b\u9686[\u4ece\u8fdc\u5904\u7684Git\u670d\u52a1\u5668\u4ed3\u5e93\u628a\u96b6\u5c5e\u4f60\u7684\u4ed3\u5e93\u9879\u76ee\u514b\u9686\u5230\u4f60\u672c\u5730]\u3002 \u6b64\u65f6\u4f1a\u5f39\u51fa\u4f60\u9a8c\u8bc1\u3002\u6b64\u65f6\u8f93\u5165\u4f60\u7684\u8d26\u53f7\u548c\u5bc6\u7801[\u627ehank\u7533\u8bf7]\u5373\u53ef \u5230\u6b64\u4e3a\u6b62\uff0c\u4f60\u4ece\u8fdc\u5904git\u4ed3\u5e93\u514b\u9686\u9879\u76ee\u5230\u672c\u5730\u7ed3\u675f\u3002 4. \u7b80\u5355\u5b9e\u7528 \u00b6 \u4ee5\u4e0b\u662f\u6211\u4ee5\u8fd9\u4e2aGUI\u7684\u5c0f\u4e4c\u9f9f\u4e3a\u4f8b\uff0c\u8bb2\u8ff0\u5728\u5de5\u4f5c\u4e2d\u7b80\u5355\u7684\u5982\u4f55\u4f7f\u7528\u3002 4.1 \u9879\u76ee\u4e0b\u8f7d \u00b6 \u5728\u4f60\u63d0\u4ea4\u4e4b\u524d\uff0c \u4e00\u5b9a\u8981\u5148\u540c\u6b65 4.2 \u9879\u76ee\u4e0a\u4f20 \u00b6 \u8fdb\u5165books\u6587\u4ef6\u5939\u5185\uff0c\u628a\u4f60\u8981\u4e0a\u4f20\u7684\u6587\u4ef6\u653e\u5728\u8be5\u6587\u4ef6\u5939\u5185\u3002\u671f\u4e2d .git \u8fd9\u4e2a\u6587\u4ef6\u5939\u5343\u4e07\u522b\u4fee\u6539\uff0c\u9664\u975e\u4f60\u77e5\u9053\u600e\u4e48\u4fee\u6539 \u5728\u4f60\u63d0\u4ea4\u4e4b\u524d\uff0c \u4e00\u5b9a\u8981\u5148\u540c\u6b65 \u6211\u628a\u4e0a\u4f20\u7684\u4e24\u4e2a\u6587\u4ef62.png\u548cgit.md\u6587\u4ef6\u653e\u5728\u8fd9\u4e2a\u6587\u4ef6\u5939\u5185\u3002 \u6b64\u65f6\u53f3\u51fb\u9009\u62e9\u63d0\u4ea4\u3002 \u6211\u8bf4\u660e\u4e00\u4e0b\u63d0\u4ea4\u7684\u65f6\u5019\u4e09\u4e2a\u6309\u94ae\u7684\u533a\u522b 1. \u63d0\u4ea4\uff1a \u53ea\u63d0\u4ea4\u5230\u4f60\u672c\u5730\u7684\u4ed3\u5e93\uff0c\u5176\u4ed6\u4eba\u662f\u770b\u4e0d\u5230\u4f60\u7684\u4fe1\u606f\uff0c\u5047\u5982\u4f60\u7535\u8111\u574f\u4e86\uff0c\u6570\u636e\u4e5f\u5c31\u968f\u4e4b\u4e1c\u53bb\u3002 2. \u91cd\u65b0\u63d0\u4ea4: \u4f60\u63d0\u4ea4\u540e\uff0c\u518d\u6b21\u4fee\u6539\u540e\uff0c\u53c8\u53ef\u4ee5\u5728\u63d0\u4ea4\u3002 3. \u63d0\u4ea4\u5e76\u63a8\u9001: \u4f60\u628a\u6587\u4ef6\u63d0\u4ea4\u81ea\u5df1\u7684\u4ed3\u5e93\uff0c\u540c\u65f6\u4e5f\u63d0\u4ea4\u5230\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u8fd9\u6837\u522b\u4eba\u5c31\u53ef\u4ee5\u4ece\u8fdc\u7a0b\u62c9\u53d6\u4f60\u7684\u9879\u76ee\u8d44\u6599\u4e86\u3002\u5373\u4f7f\u4f60\u672c\u5730\u7535\u8111\u6302\u4e86\uff0c\u6570\u636e\u8fd8\u53ef\u4ee5\u8fd8\u539f\u3002\u4e00\u822c\u4f7f\u7528\u8fd9\u4e2a\u6309\u94ae\u3002 \u6211\u4f7f\u7528\u4e86\uff0c\u63d0\u4ea4\u5e76\u63a8\u9001\u3002\u6b64\u65f6\u4f1a\u5f39\u51fa\u63a8\u9001\u60c5\u51b5\u3002\u4f1a\u6839\u636e\u4f60\u63d0\u4ea4\u7684\u6587\u4ef6\u603b\u5927\u5c0f\u548c\u7f51\u7edc\u5e26\u5bbd\u663e\u793a\u8fdb\u5ea6\u6761\u4fe1\u606f\u901f\u5ea6\u3002 \u767b\u5f55\u5230\u4f60\u9879\u76ee\u7684\u540e\u53f0[gitlab\u540e\u53f0]\uff0c\u53ef\u4ee5\u67e5\u770b\u4f60\u63d0\u4ea4\u7684\u6587\u4ef6\u76f8\u5173\u60c5\u51b5\u3002\u7136\u540e\u4f60\u5bf9\u6587\u4ef6\u4fee\u6539\uff0c\u5220\u9664\uff0c\u7b49\u64cd\u4f5c\uff0c\u90fd\u662f\u4e0a\u9762\u7684\u64cd\u4f5c\uff0c\u5148\u66f4\u65b0\uff0c\u7136\u540e\u63d0\u4ea4\uff0c\u7136\u540e\u5199\u6ce8\u91ca\uff0c\u7136\u540e\u63d0\u4ea4\u5e76\u63a8\u9001\uff0c\u7136\u540e\u4f60\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u73a9\u800d\u4e86\u3002","title":"6. git GUI"},{"location":"tools/git/git.gui/#1","text":"Git \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u5206\u5e03\u5f0f\u7248\u672c\u63a7\u5236\u7cfb\u7edf\uff0c\u7528\u4e8e\u654f\u6377\u9ad8\u6548\u5730\u5904\u7406\u4efb\u4f55\u6216\u5c0f\u6216\u5927\u7684\u9879\u76ee\u3002 Git \u662f Linus Torvalds \u4e3a\u4e86\u5e2e\u52a9\u7ba1\u7406 Linux \u5185\u6838\u5f00\u53d1\u800c\u5f00\u53d1\u7684\u4e00\u4e2a\u5f00\u653e\u6e90\u7801\u7684\u7248\u672c\u63a7\u5236\u8f6f\u4ef6\u3002 Git \u4e0e\u5e38\u7528\u7684\u7248\u672c\u63a7\u5236\u5de5\u5177 CVS, Subversion \u7b49\u4e0d\u540c\uff0c\u5b83\u91c7\u7528\u4e86\u5206\u5e03\u5f0f\u7248\u672c\u5e93\u7684\u65b9\u5f0f\uff0c\u4e0d\u5fc5\u670d\u52a1\u5668\u7aef\u8f6f\u4ef6\u652f\u6301\u3002","title":"1. \u4ecb\u7ecd"},{"location":"tools/git/git.gui/#12-git-svn","text":"Git \u4e0d\u4ec5\u4ec5\u662f\u4e2a\u7248\u672c\u63a7\u5236\u7cfb\u7edf\uff0c\u5b83\u4e5f\u662f\u4e2a\u5185\u5bb9\u7ba1\u7406\u7cfb\u7edf(CMS)\uff0c\u5de5\u4f5c\u7ba1\u7406\u7cfb\u7edf\u7b49\u3002\u5982\u679c\u4f60\u662f\u4e00\u4e2a\u5177\u6709\u4f7f\u7528 SVN \u80cc\u666f\u7684\u4eba\uff0c\u4f60\u9700\u8981\u505a\u4e00\u5b9a\u7684\u601d\u60f3\u8f6c\u6362\uff0c\u6765\u9002\u5e94 Git \u63d0\u4f9b\u7684\u4e00\u4e9b\u6982\u5ff5\u548c\u7279\u5f81\u3002 Git \u4e0e SVN \u533a\u522b\u70b9\uff1a 1\u3001Git \u662f\u5206\u5e03\u5f0f\u7684\uff0cSVN \u4e0d\u662f\uff1a\u8fd9\u662f Git \u548c\u5176\u5b83\u975e\u5206\u5e03\u5f0f\u7684\u7248\u672c\u63a7\u5236\u7cfb\u7edf\uff0c\u4f8b\u5982 SVN\uff0cCVS \u7b49\uff0c\u6700\u6838\u5fc3\u7684\u533a\u522b\u3002 2\u3001Git \u628a\u5185\u5bb9\u6309\u5143\u6570\u636e\u65b9\u5f0f\u5b58\u50a8\uff0c\u800c SVN \u662f\u6309\u6587\u4ef6\uff1a\u6240\u6709\u7684\u8d44\u6e90\u63a7\u5236\u7cfb\u7edf\u90fd\u662f\u628a\u6587\u4ef6\u7684\u5143\u4fe1\u606f\u9690\u85cf\u5728\u4e00\u4e2a\u7c7b\u4f3c .svn\u3001.cvs \u7b49\u7684\u6587\u4ef6\u5939\u91cc\u3002 3\u3001Git \u5206\u652f\u548c SVN \u7684\u5206\u652f\u4e0d\u540c\uff1a\u5206\u652f\u5728 SVN \u4e2d\u4e00\u70b9\u90fd\u4e0d\u7279\u522b\uff0c\u5176\u5b9e\u5b83\u5c31\u662f\u7248\u672c\u5e93\u4e2d\u7684\u53e6\u5916\u4e00\u4e2a\u76ee\u5f55\u3002 4\u3001Git \u6ca1\u6709\u4e00\u4e2a\u5168\u5c40\u7684\u7248\u672c\u53f7\uff0c\u800c SVN \u6709\uff1a\u76ee\u524d\u4e3a\u6b62\u8fd9\u662f\u8ddf SVN \u76f8\u6bd4 Git \u7f3a\u5c11\u7684\u6700\u5927\u7684\u4e00\u4e2a\u7279\u5f81\u3002 5\u3001Git \u7684\u5185\u5bb9\u5b8c\u6574\u6027\u8981\u4f18\u4e8e SVN\uff1aGit \u7684\u5185\u5bb9\u5b58\u50a8\u4f7f\u7528\u7684\u662f SHA-1 \u54c8\u5e0c\u7b97\u6cd5\u3002\u8fd9\u80fd\u786e\u4fdd\u4ee3\u7801\u5185\u5bb9\u7684\u5b8c\u6574\u6027\uff0c\u786e\u4fdd\u5728\u9047\u5230\u78c1\u76d8\u6545\u969c\u548c\u7f51\u7edc\u95ee\u9898\u65f6\u964d\u4f4e\u5bf9\u7248\u672c\u5e93\u7684\u7834\u574f\u3002 \u603b\u4e4bGit\u548cSVN\u662f\u4e24\u4e2a\u5b8c\u5168\u4e0d\u540c\u601d\u7ef4\u65b9\u5f0f\u7684\u7248\u672c\u7ba1\u7406\uff0c\u7406\u89e3Git\u8981\u5b8c\u5168\u629b\u5f03SVN\u7684\u601d\u7ef4\u548c\u64cd\u4f5c\u3002","title":"1.2. Git \u4e0e SVN \u533a\u522b"},{"location":"tools/git/git.gui/#13","text":"\u548cSVN\u4e2d\u5fc3\u96c6\u4e2d\u5f0f\u6587\u4ef6\u7ba1\u7406\u7684\u4ed3\u50a8\u7ba1\u7406\u4e0d\u540c\uff0cGit\u4ece\u8bbe\u8ba1\u5230\u8bde\u751f\u5c31\u4ee5\u878d\u5165\u4e86\u5206\u5e03\u5f0f\u57fa\u56e0\u3002\u867d\u7136Git\u4e5f\u6709\u670d\u52a1\u5668\u7aef\u7684Github\u3001Gitlab\u3001Gogs\u7b49\u591a\u79cd\u670d\u52a1\u5668\u7aef\uff0c\u4f46\u662fGit\u6240\u6709\u64cd\u4f5c\u90fd\u53ef\u4ee5\u65e0\u670d\u52a1\u5668\u5b58\u5728\uff0c\u4f60\u53ef\u4ee5\u53ea\u5728\u672c\u5730\u90fd\u80fd\u5b8c\u6210\u6240\u6709git\u64cd\u4f5c\uff0c\u53ef\u4ee5\u5728\u76ee\u5f55\u4e4b\u95f4\u5b9e\u73b0clone\u3001push\u548cpull\u7b49\u9700\u8981\u670d\u52a1\u5668\u7aef\u7684\u64cd\u4f5c\u3002\u8bbe\u7f6e\u6743\u9650\u548c\u901a\u8baf\u65b9\u6cd5\u540e\uff0cGit\u5ba2\u6237\u7aef\u76f4\u63a5\u4e5f\u5b8c\u5168\u53ef\u4ee5\u5b9e\u73b0\u8fd9\u4e9b\u64cd\u4f5c\u3002\u6240\u4ee5\u6211\u4eec\u8bf4Git\u662f\u5929\u7136\u5206\u5e03\u5f0f\uff0c\u65e0\u9700\u4e2d\u5fc3\u670d\u52a1\u5668 \u4ecb\u5165\u3002Git\u670d\u52a1\u5668\u7684\u5f15\u5165\u4e00\u4e2a\u597d\u5904\u5c31\u662f\u628a\u4e00\u4e9b\u64cd\u4f5c\uff08\u6bd4\u5982\u6dfb\u52a0\u8bc1\u4e66\uff0c\u5efa\u7acb\u8d26\u53f7\u3001\u4ed3\u5e93\u5143\u4fe1\u606f\uff09\u548c\u901a\u8baf\u4f20\u8f93\u65b9\u6cd5\uff08http\u3001ssh\uff09\uff0c\u53ca\u5927\u91cf\u66f4\u591a\u6269\u5c55\u529f\u80fd\u5728\u670d\u52a1\u5668\u7aefWeb\u754c\u9762\u5b9e\u73b0\u4e86\uff0c\u65b9\u4fbf\u4e86\u7528\u6237\u7684\u4f7f\u7528\u3002\u5206\u5e03\u5f0f\u7684\u4e00\u4e2a\u597d\u5904\u662f\u4ee3\u7801\u53d8\u5316push\u597d\u7684\u4ed3\u5e93\u6570\u636e\uff0c\u6700\u5c11\u4fdd\u7559\u4e24\u4efd\uff1a\u672c\u5730\u4e00\u4efd\u548c\u670d\u52a1\u5668\u4e00\u4efd\uff0c\u4e0d\u6015\u4e22\u3002","title":"1.3 \u5206\u5e03\u5f0f"},{"location":"tools/git/git.gui/#14","text":"Git\u4e2d\u4ed3\u5e93\u4fe1\u606f\u90fd\u662f\u4ee5hash\u5065\u503c\u65b9\u5f0f\u4fdd\u5b58\u6587\u4ef6\u76f8\u5f53\u4e8e\u4e00\u4e2a\u6570\u636e\u5e93\uff0c\u5f53\u7528\u6237\u5b50\u5de5\u4f5c\u533a\u505a\u4e86add\u64cd\u4f5c\u540e\uff0c\u6b64\u540e\u53d8\u5316\u4fe1\u606f\u5c31\u6210\u4e86Git\u5bf9\u8c61\u6570\u636e\u5e93\u4e86\uff08blob\u3001commit\u3001three\u5bf9\u8c61\uff09\u3002\u901a\u8fc7git\u547d\u4ee4\uff08git clone checkout rest\uff09\u53ef\u4ee5\u5b9e\u73b0\u628agit\u6570\u636e\u5e93\uff08commit\u5386\u53f2\u5e93\u548c\u6682\u5b58\u533a\uff09\uff0c\u53d8\u5316\u6210\u7528\u6237\u5b9e\u9645\u63a5\u89e6\u5230\u6587\u4ef6\u548c\u76ee\u5f55\u7684\u5de5\u4f5c\u533a\u3002 \u8fd9\u662fGit\uff0c\u72ec\u7279\u4e4b\u5904\u548c\u4f18\u52bf\u4e4b\u5904\uff0c\u4e5f\u662f\u5f88\u591a\u521d\u5b66\u8005\u8ff7\u60d1\u6307\u51fa\uff0c\u5c24\u5176\u62ff\u4e4b\u524d\u4f7f\u7528SVN\u7684\u4eba\u65e0\u6cd5\u7406\u89e3\u7684\u3002Git\u7684\u56db\u4e2a\u533a\uff08\u5de5\u4f5c\u533a\u3001\u6682\u5b58\u533a\u3001\u672c\u5730\u4ed3\u5e93\u533a\u548c\u8fdc\u7a0b\u4ed3\u5e93\u533a\uff09\uff0c\u4e94\u4e2a\u72b6\u6001\u8f6c\u5316\u6d41\u7a0b\u5982\u4e0b\uff1a \u77e5\u9053\u4e86\u8fd9\u4e9bGit\u5c31\u5f88\u591a\u95ee\u9898\u5c31\u90fd\u5f88\u597d\u7406\u89e3\u4e86\u3002\u6bd4\u5982\u5206\u652f\uff0c\u6bd4\u5982\u6807\u7b7etag\uff0c\u6bd4\u5982Head\u8fd9\u4e9b\u90fd\u662f\u5bf9\u7279\u5b9acommit\u7684\u6307\u9488\uff0c\u6240\u4ee5\u5bf9\u62c9\u5206\u652f\uff0c\u5206\u652f\u95f4\u8f6c\u5316\u90fd\u5f88\u5bb9\u6613\uff0c\u4e0d\u8fc7\u628a\u6307\u9488\uff08\u5206\u652f\uff0cHead\uff09\u6307\u5411\u67d0\u4e2acommit\uff0c\u7136\u540e\u5229\u7528\u8be5commit ID\u518d\u751f\u6210\u5de5\u4f5c\u533a\u800c\u5df2\uff0c\u770b\u4e0a\u53bb\u5c31\u548c\u5728\u4e0d\u540c\u5206\u652f\u7684\u6587\u4ef6\u76ee\u5f55\u4e0b\u5207\u6362\uff0c\u800c\u4e14\u975e\u5e38\u8fc5\u901f\uff0c\u56e0\u4e3aGit\u7684\u662f\u6309\u7167\u5dee\u5f02\u5bf9\u6bd4\u6765\u751f\u6210\u5dee\u5f02\u7684\u76ee\u5f55\u548c\u6587\u4ef6\u7684\u3002","title":"1.4 \u4f18\u70b9"},{"location":"tools/git/git.gui/#15","text":"","title":"1.5 \u5de5\u4f5c\u539f\u7406"},{"location":"tools/git/git.gui/#2","text":"","title":"2.\u90e8\u7f72"},{"location":"tools/git/git.gui/#21","text":"\u81ea\u884c\u767e\u5ea6\u4e0b\u8f7d\u3002 \u6211\u4ee5windows\u5b89\u88c5\u4e3a\u4f8b\u8bb2\u8ff0\u3002\u628a\u4ee5\u4e0b\u4e09\u4e2a\u8f6f\u4ef6\u4e0b\u8f7d\u3002 Git-2.21.0-64-bit.exe 08-Apr-2019 15:34 44M TortoiseGit-2.8.0.0-64bit.msi 08-Apr-2019 15:24 19M TortoiseGit-LanguagePack-2.8.0.0-64bit-zh_CN.msi 08-Apr-2019 15:24 4.1M","title":"2.1 \u5b89\u88c5\u5ba2\u6237\u7aef"},{"location":"tools/git/git.gui/#22-git","text":"Git-2.21.0-64-bit.exe \u53cc\u51fb\u5b89\u88c5\uff0c\u4e0d\u8981\u505a\u4efb\u4f55\u4fee\u6539[\u9664\u975e\u4f60\u77e5\u9053\u600e\u4e48\u5b89\u88c5]\uff0c\u5b89\u88c5\u5b8c\u6bd5\u540e\uff0c\u5728windows\u684c\u9762\uff0c\u53f3\u51fb\u53ef\u4ee5\u770b\u5230\u4ee5\u4e0b\u4e24\u4e2a\u547d\u4ee4\u3002 Git GUI Here Git Bash Here \u4ee5\u4e0a\u8bf4\u660e\u4f60git\u8f6f\u4ef6\u5728windows\u7aef\u5b89\u88c5\u6210\u529f\u3002","title":"2.2 \u5b89\u88c5Git"},{"location":"tools/git/git.gui/#23-tortoisegit","text":"\u63a5\u4e0b\u6765\u5b89\u88c5\u5b89\u88c5git\u7684windows\u56fe\u50cf\u5316\u5de5\u5177TortoiseGit[\u4fd7\u79f0git\u5c0f\u4e4c\u9f9f]\u3002\u53cc\u51fb\u5b89\u88c5\u3002 \u70b9\u51fb\u4e2d\u95f4\u7684Next\u6309\u94ae\u3002 \u7ee7\u7eed\u70b9\u51fb\u4e2d\u95f4\u7684Next\u6309\u952e\u3002 \u4fdd\u6301\u9ed8\u8ba4\u3002\u7ee7\u7eed\u70b9\u51fb\u4e2d\u95f4Next\u6309\u952e\u3002 \u4e0d\u8981\u4efb\u4f55\u64cd\u4f5c\u3002\u9664\u975e\u4f60\u77e5\u9053\u600e\u4e48\u5b89\u88c5\u3002\u4e0d\u77e5\u9053\u7684\u8bdd\uff0c\u5c31\u70b9\u51fb\u90a3\u4e2aNext\u6309\u952e\u3002 \u70b9\u51fb\u4e2d\u95f4\u7684Install\u6309\u952e\uff0c\u7b49\u5f85\u5b89\u88c5\u5b8c\u6bd5\u3002 \u6b64\u65f6\u70b9\u51fbFinsh\u6309\u952e\u3002 \u6b64\u65f6\u6b64\u9875\u9762\u4e0d\u8981\u7740\u6025\u5173\u95ed\uff0c\u53bb\u5b89\u88c5\u6c49\u5316\u5305[\u4e0d\u9700\u8981\u7684\u53ef\u4ee5\u76f4\u63a5\u70b9\u51fb\u4e0b\u4e00\u6b65]","title":"2.3 \u5b89\u88c5TortoiseGit"},{"location":"tools/git/git.gui/#24-tortoisegit","text":"\u53cc\u51fb\u5b89\u88c5\u6c49\u5316\u5305\u3002 TortoiseGit-LanguagePack-2.8.0.0-64bit-zh_CN.msi \u70b9\u51fb\u4e0b\u4e00\u6b65\u6309\u94ae\u3002 \u6b64\u65f6\u5b89\u88c5\u5b8c\u6bd5\uff0c\u4e0d\u8981\u914d\u7f6e\uff0c\u70b9\u51fb\u5b8c\u6210\u6309\u94ae\u3002","title":"2.4 \u5b89\u88c5TortoiseGit\u6c49\u5316"},{"location":"tools/git/git.gui/#25-tortoisegit","text":"\u5b89\u88c5\u5b8c\u6bd5\u3002","title":"2.5 \u914d\u7f6eTortoiseGit\u6c49\u5316"},{"location":"tools/git/git.gui/#26","text":"\u684c\u9762\u53f3\u51fb\uff0c\u9009\u62e9 Git Bash Here \u5bf9git\u8fdb\u884c\u5168\u5c40\u914d\u7f6e git config --global credential.helper store git config --global https.sslVerify false \u5982\u4e0a\u8ff0\u64cd\u4f5c\u3002\u60f3\u77e5\u9053\u8fd9\u4e2a\u5e72\u5417\uff0c\u81ea\u884c\u53bb\u4f7f\u7528\u73b0\u4ee3\u5316\u5de5\u5177 \u767e\u5ea6\u4f20\u9001\u95e8","title":"2.6 \u914d\u7f6e\u5168\u5c40\u53d8\u91cf"},{"location":"tools/git/git.gui/#3","text":"","title":"3. \u514b\u9686\u9879\u76ee"},{"location":"tools/git/git.gui/#31","text":"\u627e\u5230\u5408\u9002\u7684\u9879\u76ee\u5b58\u653e\u5730\u70b9\uff0c\u65b0\u5efa\u4e00\u4e2a\u7a7a\u6587\u4ef6\u5939\uff0c\u6587\u4ef6\u5939\u540d\u5b57\u770b\u4f60\u5fc3\u60c5\uff0c\u63a5\u4e0b\u6765\u6211\u521b\u5efa\u4e00\u4e2aserver[\u6211\u5c5e\u4e8e\u670d\u52a1\u5668\u7ec4]\u6587\u4ef6\u5939\u3002 \u8fdb\u5165\u65b0\u5efa\u7684server\u6587\u4ef6\u5939\uff0c\u53f3\u51fb \u9009\u62e9 Git Clone \u9009\u9879\uff0c\u7136\u540e\u8fdb\u9879\u9879\u76ee\u514b\u9686[\u4ece\u8fdc\u5904\u7684Git\u670d\u52a1\u5668\u4ed3\u5e93\u628a\u96b6\u5c5e\u4f60\u7684\u4ed3\u5e93\u9879\u76ee\u514b\u9686\u5230\u4f60\u672c\u5730]\u3002 \u6b64\u65f6\u4f1a\u5f39\u51fa\u4f60\u9a8c\u8bc1\u3002\u6b64\u65f6\u8f93\u5165\u4f60\u7684\u8d26\u53f7\u548c\u5bc6\u7801[\u627ehank\u7533\u8bf7]\u5373\u53ef \u5230\u6b64\u4e3a\u6b62\uff0c\u4f60\u4ece\u8fdc\u5904git\u4ed3\u5e93\u514b\u9686\u9879\u76ee\u5230\u672c\u5730\u7ed3\u675f\u3002","title":"3.1 \u5b58\u50a8"},{"location":"tools/git/git.gui/#4","text":"\u4ee5\u4e0b\u662f\u6211\u4ee5\u8fd9\u4e2aGUI\u7684\u5c0f\u4e4c\u9f9f\u4e3a\u4f8b\uff0c\u8bb2\u8ff0\u5728\u5de5\u4f5c\u4e2d\u7b80\u5355\u7684\u5982\u4f55\u4f7f\u7528\u3002","title":"4. \u7b80\u5355\u5b9e\u7528"},{"location":"tools/git/git.gui/#41","text":"\u5728\u4f60\u63d0\u4ea4\u4e4b\u524d\uff0c \u4e00\u5b9a\u8981\u5148\u540c\u6b65","title":"4.1 \u9879\u76ee\u4e0b\u8f7d"},{"location":"tools/git/git.gui/#42","text":"\u8fdb\u5165books\u6587\u4ef6\u5939\u5185\uff0c\u628a\u4f60\u8981\u4e0a\u4f20\u7684\u6587\u4ef6\u653e\u5728\u8be5\u6587\u4ef6\u5939\u5185\u3002\u671f\u4e2d .git \u8fd9\u4e2a\u6587\u4ef6\u5939\u5343\u4e07\u522b\u4fee\u6539\uff0c\u9664\u975e\u4f60\u77e5\u9053\u600e\u4e48\u4fee\u6539 \u5728\u4f60\u63d0\u4ea4\u4e4b\u524d\uff0c \u4e00\u5b9a\u8981\u5148\u540c\u6b65 \u6211\u628a\u4e0a\u4f20\u7684\u4e24\u4e2a\u6587\u4ef62.png\u548cgit.md\u6587\u4ef6\u653e\u5728\u8fd9\u4e2a\u6587\u4ef6\u5939\u5185\u3002 \u6b64\u65f6\u53f3\u51fb\u9009\u62e9\u63d0\u4ea4\u3002 \u6211\u8bf4\u660e\u4e00\u4e0b\u63d0\u4ea4\u7684\u65f6\u5019\u4e09\u4e2a\u6309\u94ae\u7684\u533a\u522b 1. \u63d0\u4ea4\uff1a \u53ea\u63d0\u4ea4\u5230\u4f60\u672c\u5730\u7684\u4ed3\u5e93\uff0c\u5176\u4ed6\u4eba\u662f\u770b\u4e0d\u5230\u4f60\u7684\u4fe1\u606f\uff0c\u5047\u5982\u4f60\u7535\u8111\u574f\u4e86\uff0c\u6570\u636e\u4e5f\u5c31\u968f\u4e4b\u4e1c\u53bb\u3002 2. \u91cd\u65b0\u63d0\u4ea4: \u4f60\u63d0\u4ea4\u540e\uff0c\u518d\u6b21\u4fee\u6539\u540e\uff0c\u53c8\u53ef\u4ee5\u5728\u63d0\u4ea4\u3002 3. \u63d0\u4ea4\u5e76\u63a8\u9001: \u4f60\u628a\u6587\u4ef6\u63d0\u4ea4\u81ea\u5df1\u7684\u4ed3\u5e93\uff0c\u540c\u65f6\u4e5f\u63d0\u4ea4\u5230\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u8fd9\u6837\u522b\u4eba\u5c31\u53ef\u4ee5\u4ece\u8fdc\u7a0b\u62c9\u53d6\u4f60\u7684\u9879\u76ee\u8d44\u6599\u4e86\u3002\u5373\u4f7f\u4f60\u672c\u5730\u7535\u8111\u6302\u4e86\uff0c\u6570\u636e\u8fd8\u53ef\u4ee5\u8fd8\u539f\u3002\u4e00\u822c\u4f7f\u7528\u8fd9\u4e2a\u6309\u94ae\u3002 \u6211\u4f7f\u7528\u4e86\uff0c\u63d0\u4ea4\u5e76\u63a8\u9001\u3002\u6b64\u65f6\u4f1a\u5f39\u51fa\u63a8\u9001\u60c5\u51b5\u3002\u4f1a\u6839\u636e\u4f60\u63d0\u4ea4\u7684\u6587\u4ef6\u603b\u5927\u5c0f\u548c\u7f51\u7edc\u5e26\u5bbd\u663e\u793a\u8fdb\u5ea6\u6761\u4fe1\u606f\u901f\u5ea6\u3002 \u767b\u5f55\u5230\u4f60\u9879\u76ee\u7684\u540e\u53f0[gitlab\u540e\u53f0]\uff0c\u53ef\u4ee5\u67e5\u770b\u4f60\u63d0\u4ea4\u7684\u6587\u4ef6\u76f8\u5173\u60c5\u51b5\u3002\u7136\u540e\u4f60\u5bf9\u6587\u4ef6\u4fee\u6539\uff0c\u5220\u9664\uff0c\u7b49\u64cd\u4f5c\uff0c\u90fd\u662f\u4e0a\u9762\u7684\u64cd\u4f5c\uff0c\u5148\u66f4\u65b0\uff0c\u7136\u540e\u63d0\u4ea4\uff0c\u7136\u540e\u5199\u6ce8\u91ca\uff0c\u7136\u540e\u63d0\u4ea4\u5e76\u63a8\u9001\uff0c\u7136\u540e\u4f60\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u73a9\u800d\u4e86\u3002","title":"4.2 \u9879\u76ee\u4e0a\u4f20"},{"location":"tools/git/git.index/","text":"Git \u5b89\u88c5 1. \u5728\u7ebf\u5b89\u88c5 \u00b6 ubuntu \u5728\u7ebf\u5b89\u88c5 apt-get install git -y centos \u5728\u7ebf\u5b89\u88c5 yum install -y git ubuntu root@k8s4:/home/leco# apt-get install git Reading package lists... Done Building dependency tree Reading state information... Done git is already the newest version (1:2.7.4-0ubuntu1.4). 0 upgraded, 0 newly installed, 0 to remove and 4 not upgraded. centos [root@leco ~]# yum install git Loaded plugins: fastestmirror Setting up Install Process Loading mirror speeds from cached hostfile base | 3.7 kB 00:00 epel | 4.7 kB 00:00 epel/primary_db | 6.0 MB 00:00 extras | 3.4 kB 00:00 mysql-connectors-community | 2.5 kB 00:00 mysql-tools-community | 2.5 kB 00:00 mysql56-community | 2.5 kB 00:00 saltstack | 2.9 kB 00:00 updates | 3.4 kB 00:00 Package git-1.7.1-9.el6_9.x86_64 already installed and latest version Nothing to do 2. git \u6d41\u7a0b \u00b6 3. \u521d\u59cb\u5316\u672c\u5730 \u00b6 root@k8s4:~/git_test# git init Initialized empty Git repository in /root/git_test/.git/ root@k8s4:~/git_test# ll -a total 12 drwxr-xr-x 3 root root 4096 Jan 15 11:25 ./ drwx------ 9 root root 4096 Jan 15 11:25 ../ drwxr-xr-x 7 root root 4096 Jan 15 11:25 .git/ 4.\u57fa\u672c\u914d\u7f6e \u00b6 root@k8s4:/home/leco# git config usage: git config [<options>] Config file location --global use global config file --system use system config file --local use repository config file -f, --file <file> use given config file --blob <blob-id> read config from given blob object Action --get get value: name [value-regex] --get-all get all values: key [value-regex] --get-regexp get values for regexp: name-regex [value-regex] --get-urlmatch get value specific for the URL: section[.var] URL --replace-all replace all matching variables: name value [value_regex] --add add a new variable: name value --unset remove a variable: name [value-regex] --unset-all remove all matches: name [value-regex] --rename-section rename section: old-name new-name --remove-section remove a section: name -l, --list list all -e, --edit open an editor --get-color find the color configured: slot [default] --get-colorbool find the color setting: slot [stdout-is-tty] Type --bool value is \"true\" or \"false\" --int value is decimal number --bool-or-int value is --bool or --int --path value is a path (file or directory name) Other -z, --null terminate values with NUL byte --name-only show variable names only --includes respect include directives on lookup 5.\u4eba\u5458\u4fe1\u606f\u914d\u7f6e \u00b6 root@k8s4:/home/leco# git config --global user.name leco root@k8s4:/home/leco# git config --global user.email leco@leco.com root@k8s4:/home/leco# cd root@k8s4:~# ll .gitconfig -rw-r--r-- 1 root root 43 Jan 15 11:22 .gitconfig root@k8s4:~# cat .gitconfig [user] name = leco email = leco@leco.com root@k8s4:~# git config --list user.name=leco user.email=leco@leco.com root@k8s4:~# mkdir git_test root@k8s4:~# cd git_test/ root@k8s4:~/git_test# git init Initialized empty Git repository in /root/git_test/.git/ root@k8s4:~/git_test# ll -a total 12 drwxr-xr-x 3 root root 4096 Jan 15 11:25 ./ drwx------ 9 root root 4096 Jan 15 11:25 ../ drwxr-xr-x 7 root root 4096 Jan 15 11:25 .git/ # git \u4ed3\u5e93 6. \u6d41\u7a0b\u56fe \u00b6 graph TD A[\u8fdc\u7a0b\u4ed3\u5e93]-->B[\u672c\u5730\u4ed3\u5e93] B -->A B-->C[\u6682\u5b58\u533a\u57df] C-->B C-->D[\u5de5\u4f5c\u76ee\u5f55] D-->C Workspace\uff1a \u5de5\u4f5c\u533a Index/Stage/Cached : \u7f13\u5b58\u533a Respository\uff1a \u672c\u5730\u4ed3\u5e93 Remote: \u8fdc\u7a0b\u4ed3\u5e93 Git \u547d\u4ee4\u5c31\u662f\u7528\u4e8e\u5c06\u6587\u4ef6\u6539\u52a8\u5207\u6362\u5230\u4e0d\u540c\u7a7a\u95f4\u6765\u8bb0\u5f55 7. \u72b6\u6001 \u00b6 root@k8s4:~/git_test# git status On branch master # \u5728master\u5206\u652f\u4e0a Initial commit nothing to commit (create/copy files and use \"git add\" to track) # \u4ed3\u5e93\u6ca1\u6709\u4efb\u52a1 8. \u65b0\u5efa\u540e\u67e5\u770b \u00b6 root@k8s4:~/git_test# git add . root@k8s4:~/git_test# git status On branch master Initial commit Untracked files: (use \"git add <file>...\" to include in what will be committed) a b c nothing added to commit but untracked files present (use \"git add\" to track) root@k8s4:~/git_test# 9. \u63d0\u4ea4\u6587\u4ef6\u540e \u00b6 root@k8s4:~/git_test# git add . root@k8s4:~/git_test# git status On branch master Initial commit Changes to be committed: (use \"git rm --cached <file>...\" to unstage) new file: a new file: b new file: c \u89e3\u91ca - untracked files\u5c31\u662f\u7f13\u5b58\u533a - git add filename \u6216\u8005git add .(\u63d0\u4ea4\u6240\u6709) \u5230\u7f13\u5b58\u533a - git rm --cached \u662f\u5c06\u4e4b\u524d\u63d0\u4ea4\u7684\u6587\u4ef6\uff08\u4e5f\u5c31\u662f\u63d0\u4ea4\u5230\u7f13\u5b58\u7684\u6587\u4ef6\uff09\u5220\u9664\uff0c\u8fd4\u56de\u5230\u672c\u5730 10. \u5220\u9664\u7f13\u5b58c\u7684\u6587\u4ef6 \u00b6 root@k8s4:~/git_test# git rm --cached c rm 'c' root@k8s4:~/git_test# ls a b c root@k8s4:~/git_test# git status On branch master Initial commit Changes to be committed: (use \"git rm --cached <file>...\" to unstage) new file: a new file: b \u89e3\u91ca\uff0c\u53ef\u4ee5\u770b\u5230\u7f13\u5b58\u6587\u4ef6\u53ea\u6709a\uff0cb\u4e24\u4e2a\u6587\u4ef6\u4e86\uff0cc\u6587\u4ef6\u88ab\u4ece\u7f13\u5b58\u533a\u4e2d\u5220\u9664\u4e86\uff0c - \u8981\u662f\u5b8c\u5168\u5220\u9664c\u7684\u8bdd\uff0c\u5c31\u76f4\u63a5\u518d\u672c\u5730\u7ee7\u7eed\u628ac\u6587\u4ef6\u5220\u9664\u5373\u53ef root@k8s4:~/git_test# rm c \u76f4\u63a5\u5220\u9664\u7684\u8bdd\uff08\u540c\u65f6\u5220\u9664\u7f13\u5b58\u533a\u6587\u4ef6\u548c\u672c\u5730\u6587\u4ef6\uff09 root@k8s4:~/git_test# git status On branch master Initial commit Changes to be committed: (use \"git rm --cached <file>...\" to unstage) new file: a new file: b root@k8s4:~/git_test# git rm -f b rm 'b' root@k8s4:~/git_test# git status On branch master Initial commit Changes to be committed: (use \"git rm --cached <file>...\" to unstage) new file: a 11. \u63d0\u4ea4 \u00b6 root@k8s4:~/git_test# git commit -m 'commit a' [master (root-commit) e73cff4] commit a 1 file changed, 0 insertions(+), 0 deletions(-) create mode 100644 a root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean \u6ce8\u91ca - git commit -m \"\u540e\u9762\u662f\u6ce8\u91ca\"\uff0c\u8fd9\u6837\u5c31\u5c06\u5de5\u4f5c\u533a\u6587\u4ef6\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93 - commit\u4e4b\u524d\u4e00\u5b9a\u8981add\u4e5f\u5c31\u662f\u5148\u5c06\u672c\u5730\u6587\u4ef6add\u5230\u7f13\u5b58\u533a\uff0c\u7136\u540ecommit\u540e\u4f1a\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93 12. \u6539\u540d \u00b6 \u65b9\u6cd51 \u73b0\u5c06\u672c\u5730\u6587\u4ef6a \u6539\u4e3aa.txt \u5220\u9664\u7f13\u5b58\u533aa\u6587\u4ef6 \u63d0\u4ea4a.txt\u6587\u4ef6 \u65b9\u6cd52 git mv oldfile newfile git commit -m 'newfile' # \u65b9\u6cd51 root@k8s4:~/git_test# ls a root@k8s4:~/git_test# mv a a.txt root@k8s4:~/git_test# ls a.txt root@k8s4:~/git_test# git status On branch master Changes not staged for commit: (use \"git add/rm <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) deleted: a Untracked files: (use \"git add <file>...\" to include in what will be committed) a.txt no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git rm --cached a rm 'a' root@k8s4:~/git_test# git status On branch master Changes to be committed: (use \"git reset HEAD <file>...\" to unstage) deleted: a Untracked files: (use \"git add <file>...\" to include in what will be committed) a.txt root@k8s4:~/git_test# git add a.txt root@k8s4:~/git_test# git status On branch master Changes to be committed: (use \"git reset HEAD <file>...\" to unstage) renamed: a -> a.txt root@k8s4:~/git_test# git commit -m 'commit a.txt' [master da4a5dd] commit a.txt 1 file changed, 0 insertions(+), 0 deletions(-) rename a => a.txt (100%) root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean # \u65b9\u6cd52 root@k8s4:~/git_test# git mv a.txt a root@k8s4:~/git_test# git commit -m 'rename a.txt to a' [master 26e567b] rename a.txt to a 1 file changed, 0 insertions(+), 0 deletions(-) rename a.txt => a (100%) root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean 13. \u5bf9\u6bd4\u67e5\u770b\uff0c\u4fee\u6539\u4e86\u4ec0\u4e48 \u00b6 git diff file \u5bf9\u6bd4\u6587\u4ef6\u5728\u672c\u5730\u548c\u7f13\u5b58\u533a\u7684\u5dee\u5f02 git diff --cached file \u5bf9\u6bd4\u6587\u4ef6\u5728\u7f13\u5b58\u533a\u548c\u672c\u5730\u4ed3\u5e93\u7684\u5dee\u5f02 git diff file \u5c31\u662f\u67e5\u770b\u672c\u5730\u548c\u7f13\u5b58\u533a\u6587\u4ef6\u7684\u5bf9\u6bd4 root@k8s4:~/git_test# echo '1'>>a root@k8s4:~/git_test# git status On branch master Changes not staged for commit: (use \"git add <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git diff a diff --git a/a b/a index e69de29..d00491f 100644 --- a/a +++ b/a @@ -0,0 +1 @@ +1 # \u65b0\u52a0\u5185\u5bb9 \u4fee\u6539\u540e\u518d\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\uff08git add\uff09\uff0c\u5728\u6bd4\u5bf9 \u8fd9\u6837\u7f13\u5b58\u533a\u6587\u4ef6\u548c\u672c\u5730\u6587\u4ef6\u5c31\u4e00\u6837\u4e86\uff0c\u6240\u4ee5\u5bf9\u6bd4\u540e\u5565\u90fd\u6ca1\u6709 root@k8s4:~/git_test# git add a root@k8s4:~/git_test# git status On branch master Changes to be committed: (use \"git reset HEAD <file>...\" to unstage) modified: a root@k8s4:~/git_test# git diff a - \u518d\u6b21\u5bf9\u6b64\uff0c\u7f13\u5b58\u533a\u548c\u672c\u5730\u4ed3\u5e93\u7684\u5dee\u5f02 - git diff --cached file \u5c31\u662f\u5bf9\u6bd4\u6587\u4ef6\u5728\u7f13\u5b58\u533a\u548c\u672c\u5730\u4ed3\u5e93\u7684\u5dee\u5f02 root@k8s4:~/git_test# git diff --cached a diff --git a/a b/a index e69de29..d00491f 100644 --- a/a +++ b/a @@ -0,0 +1 @@ +1 - \u7ee7\u7eed\u5c06\u7f13\u5b58\u533a\u7684\u6587\u4ef6\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93\u540e\u518d\u5bf9\u6bd4 root@k8s4:~/git_test# git commit -m 'modify a' [master ccf4d94] modify a 1 file changed, 1 insertion(+) root@k8s4:~/git_test# git diff --cached a # \u56e0\u4e3a\u6587\u4ef6\u90fd\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93\u4e86\uff0c\u6240\u4ee5\u5bf9\u6bd4\u540e\u90fd\u4e00\u6837\u4e86\uff0c \u67e5\u770b\u63d0\u4ea4\u7684\u65e5\u5fd7 \u00b6 root@k8s4:~/git_test# git log commit ccf4d94ce795364ec9157fbdee829cbf2c0108b1 Author: leco <leco@leco.com> Date: Tue Jan 15 12:43:28 2019 +0800 modify a commit 26e567b47ad85ba7ea48e030e8d259bddf3d9b69 Author: leco <leco@leco.com> Date: Tue Jan 15 12:35:04 2019 +0800 rename a.txt to a commit da4a5ddc2a9795ba231e0e8a86dc501b93a63dc9 Author: leco <leco@leco.com> Date: Tue Jan 15 12:31:36 2019 +0800 commit a.txt commit e73cff4891f06c86c59f0fe316902cf829ae17e4 Author: leco <leco@leco.com> Date: Tue Jan 15 12:24:57 2019 +0800 commit a - \u7b80\u5199 root@k8s4:~/git_test# git log --oneline 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a root@k8s4:~/git_test# git log --oneline --decorate 1afadfd (HEAD -> master) modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a - \u8be6\u7ec6\u65e5\u5fd7 root@k8s4:~/git_test# git log -p commit 1afadfd79ce4a2676650401e9334b60b36550372 Author: leco <leco@leco.com> Date: Tue Jan 15 12:53:33 2019 +0800 modify a second diff --git a/a b/a index d00491f..68fac01 100644 --- a/a +++ b/a @@ -1 +1,2 @@ 1 +bbb commit ccf4d94ce795364ec9157fbdee829cbf2c0108b1 Author: leco <leco@leco.com> Date: Tue Jan 15 12:43:28 2019 +0800 modify a diff --git a/a b/a index e69de29..d00491f 100644 --- a/a +++ b/a @@ -0,0 +1 @@ +1 commit 26e567b47ad85ba7ea48e030e8d259bddf3d9b69 Author: leco <leco@leco.com> Date: Tue Jan 15 12:35:04 2019 +0800 rename a.txt to a diff --git a/a b/a new file mode 100644 index 0000000..e69de29 diff --git a/a.txt b/a.txt deleted file mode 100644 index e69de29..0000000 commit da4a5ddc2a9795ba231e0e8a86dc501b93a63dc9 Author: leco <leco@leco.com> Date: Tue Jan 15 12:31:36 2019 +0800 commit a.txt diff --git a/a b/a deleted file mode 100644 index e69de29..0000000 diff --git a/a.txt b/a.txt new file mode 100644 index 0000000..e69de29 commit e73cff4891f06c86c59f0fe316902cf829ae17e4 Author: leco <leco@leco.com> Date: Tue Jan 15 12:24:57 2019 +0800 commit a diff --git a/a b/a new file mode 100644 index 0000000..e69de29 - \u67e5\u770b\u5386\u53f2\u51e0\u6761\u8bb0\u5f55 - git log -n n\u8868\u793a\u663e\u793a\u6700\u540e\u4fee\u6539\u7684\u51e0\u6761\u8bb0\u5f55 root@k8s4:~/git_test# git log -2 commit 1afadfd79ce4a2676650401e9334b60b36550372 Author: leco <leco@leco.com> Date: Tue Jan 15 12:53:33 2019 +0800 modify a second commit ccf4d94ce795364ec9157fbdee829cbf2c0108b1 Author: leco <leco@leco.com> Date: Tue Jan 15 12:43:28 2019 +0800 modify a","title":"1. git \u4ecb\u7ecd"},{"location":"tools/git/git.index/#1","text":"ubuntu \u5728\u7ebf\u5b89\u88c5 apt-get install git -y centos \u5728\u7ebf\u5b89\u88c5 yum install -y git ubuntu root@k8s4:/home/leco# apt-get install git Reading package lists... Done Building dependency tree Reading state information... Done git is already the newest version (1:2.7.4-0ubuntu1.4). 0 upgraded, 0 newly installed, 0 to remove and 4 not upgraded. centos [root@leco ~]# yum install git Loaded plugins: fastestmirror Setting up Install Process Loading mirror speeds from cached hostfile base | 3.7 kB 00:00 epel | 4.7 kB 00:00 epel/primary_db | 6.0 MB 00:00 extras | 3.4 kB 00:00 mysql-connectors-community | 2.5 kB 00:00 mysql-tools-community | 2.5 kB 00:00 mysql56-community | 2.5 kB 00:00 saltstack | 2.9 kB 00:00 updates | 3.4 kB 00:00 Package git-1.7.1-9.el6_9.x86_64 already installed and latest version Nothing to do","title":"1. \u5728\u7ebf\u5b89\u88c5"},{"location":"tools/git/git.index/#2-git","text":"","title":"2. git \u6d41\u7a0b"},{"location":"tools/git/git.index/#3","text":"root@k8s4:~/git_test# git init Initialized empty Git repository in /root/git_test/.git/ root@k8s4:~/git_test# ll -a total 12 drwxr-xr-x 3 root root 4096 Jan 15 11:25 ./ drwx------ 9 root root 4096 Jan 15 11:25 ../ drwxr-xr-x 7 root root 4096 Jan 15 11:25 .git/","title":"3. \u521d\u59cb\u5316\u672c\u5730"},{"location":"tools/git/git.index/#4","text":"root@k8s4:/home/leco# git config usage: git config [<options>] Config file location --global use global config file --system use system config file --local use repository config file -f, --file <file> use given config file --blob <blob-id> read config from given blob object Action --get get value: name [value-regex] --get-all get all values: key [value-regex] --get-regexp get values for regexp: name-regex [value-regex] --get-urlmatch get value specific for the URL: section[.var] URL --replace-all replace all matching variables: name value [value_regex] --add add a new variable: name value --unset remove a variable: name [value-regex] --unset-all remove all matches: name [value-regex] --rename-section rename section: old-name new-name --remove-section remove a section: name -l, --list list all -e, --edit open an editor --get-color find the color configured: slot [default] --get-colorbool find the color setting: slot [stdout-is-tty] Type --bool value is \"true\" or \"false\" --int value is decimal number --bool-or-int value is --bool or --int --path value is a path (file or directory name) Other -z, --null terminate values with NUL byte --name-only show variable names only --includes respect include directives on lookup","title":"4.\u57fa\u672c\u914d\u7f6e"},{"location":"tools/git/git.index/#5","text":"root@k8s4:/home/leco# git config --global user.name leco root@k8s4:/home/leco# git config --global user.email leco@leco.com root@k8s4:/home/leco# cd root@k8s4:~# ll .gitconfig -rw-r--r-- 1 root root 43 Jan 15 11:22 .gitconfig root@k8s4:~# cat .gitconfig [user] name = leco email = leco@leco.com root@k8s4:~# git config --list user.name=leco user.email=leco@leco.com root@k8s4:~# mkdir git_test root@k8s4:~# cd git_test/ root@k8s4:~/git_test# git init Initialized empty Git repository in /root/git_test/.git/ root@k8s4:~/git_test# ll -a total 12 drwxr-xr-x 3 root root 4096 Jan 15 11:25 ./ drwx------ 9 root root 4096 Jan 15 11:25 ../ drwxr-xr-x 7 root root 4096 Jan 15 11:25 .git/ # git \u4ed3\u5e93","title":"5.\u4eba\u5458\u4fe1\u606f\u914d\u7f6e"},{"location":"tools/git/git.index/#6","text":"graph TD A[\u8fdc\u7a0b\u4ed3\u5e93]-->B[\u672c\u5730\u4ed3\u5e93] B -->A B-->C[\u6682\u5b58\u533a\u57df] C-->B C-->D[\u5de5\u4f5c\u76ee\u5f55] D-->C Workspace\uff1a \u5de5\u4f5c\u533a Index/Stage/Cached : \u7f13\u5b58\u533a Respository\uff1a \u672c\u5730\u4ed3\u5e93 Remote: \u8fdc\u7a0b\u4ed3\u5e93 Git \u547d\u4ee4\u5c31\u662f\u7528\u4e8e\u5c06\u6587\u4ef6\u6539\u52a8\u5207\u6362\u5230\u4e0d\u540c\u7a7a\u95f4\u6765\u8bb0\u5f55","title":"6. \u6d41\u7a0b\u56fe"},{"location":"tools/git/git.index/#7","text":"root@k8s4:~/git_test# git status On branch master # \u5728master\u5206\u652f\u4e0a Initial commit nothing to commit (create/copy files and use \"git add\" to track) # \u4ed3\u5e93\u6ca1\u6709\u4efb\u52a1","title":"7. \u72b6\u6001"},{"location":"tools/git/git.index/#8","text":"root@k8s4:~/git_test# git add . root@k8s4:~/git_test# git status On branch master Initial commit Untracked files: (use \"git add <file>...\" to include in what will be committed) a b c nothing added to commit but untracked files present (use \"git add\" to track) root@k8s4:~/git_test#","title":"8. \u65b0\u5efa\u540e\u67e5\u770b"},{"location":"tools/git/git.index/#9","text":"root@k8s4:~/git_test# git add . root@k8s4:~/git_test# git status On branch master Initial commit Changes to be committed: (use \"git rm --cached <file>...\" to unstage) new file: a new file: b new file: c \u89e3\u91ca - untracked files\u5c31\u662f\u7f13\u5b58\u533a - git add filename \u6216\u8005git add .(\u63d0\u4ea4\u6240\u6709) \u5230\u7f13\u5b58\u533a - git rm --cached \u662f\u5c06\u4e4b\u524d\u63d0\u4ea4\u7684\u6587\u4ef6\uff08\u4e5f\u5c31\u662f\u63d0\u4ea4\u5230\u7f13\u5b58\u7684\u6587\u4ef6\uff09\u5220\u9664\uff0c\u8fd4\u56de\u5230\u672c\u5730","title":"9. \u63d0\u4ea4\u6587\u4ef6\u540e"},{"location":"tools/git/git.index/#10-c","text":"root@k8s4:~/git_test# git rm --cached c rm 'c' root@k8s4:~/git_test# ls a b c root@k8s4:~/git_test# git status On branch master Initial commit Changes to be committed: (use \"git rm --cached <file>...\" to unstage) new file: a new file: b \u89e3\u91ca\uff0c\u53ef\u4ee5\u770b\u5230\u7f13\u5b58\u6587\u4ef6\u53ea\u6709a\uff0cb\u4e24\u4e2a\u6587\u4ef6\u4e86\uff0cc\u6587\u4ef6\u88ab\u4ece\u7f13\u5b58\u533a\u4e2d\u5220\u9664\u4e86\uff0c - \u8981\u662f\u5b8c\u5168\u5220\u9664c\u7684\u8bdd\uff0c\u5c31\u76f4\u63a5\u518d\u672c\u5730\u7ee7\u7eed\u628ac\u6587\u4ef6\u5220\u9664\u5373\u53ef root@k8s4:~/git_test# rm c \u76f4\u63a5\u5220\u9664\u7684\u8bdd\uff08\u540c\u65f6\u5220\u9664\u7f13\u5b58\u533a\u6587\u4ef6\u548c\u672c\u5730\u6587\u4ef6\uff09 root@k8s4:~/git_test# git status On branch master Initial commit Changes to be committed: (use \"git rm --cached <file>...\" to unstage) new file: a new file: b root@k8s4:~/git_test# git rm -f b rm 'b' root@k8s4:~/git_test# git status On branch master Initial commit Changes to be committed: (use \"git rm --cached <file>...\" to unstage) new file: a","title":"10. \u5220\u9664\u7f13\u5b58c\u7684\u6587\u4ef6"},{"location":"tools/git/git.index/#11","text":"root@k8s4:~/git_test# git commit -m 'commit a' [master (root-commit) e73cff4] commit a 1 file changed, 0 insertions(+), 0 deletions(-) create mode 100644 a root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean \u6ce8\u91ca - git commit -m \"\u540e\u9762\u662f\u6ce8\u91ca\"\uff0c\u8fd9\u6837\u5c31\u5c06\u5de5\u4f5c\u533a\u6587\u4ef6\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93 - commit\u4e4b\u524d\u4e00\u5b9a\u8981add\u4e5f\u5c31\u662f\u5148\u5c06\u672c\u5730\u6587\u4ef6add\u5230\u7f13\u5b58\u533a\uff0c\u7136\u540ecommit\u540e\u4f1a\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93","title":"11. \u63d0\u4ea4"},{"location":"tools/git/git.index/#12","text":"\u65b9\u6cd51 \u73b0\u5c06\u672c\u5730\u6587\u4ef6a \u6539\u4e3aa.txt \u5220\u9664\u7f13\u5b58\u533aa\u6587\u4ef6 \u63d0\u4ea4a.txt\u6587\u4ef6 \u65b9\u6cd52 git mv oldfile newfile git commit -m 'newfile' # \u65b9\u6cd51 root@k8s4:~/git_test# ls a root@k8s4:~/git_test# mv a a.txt root@k8s4:~/git_test# ls a.txt root@k8s4:~/git_test# git status On branch master Changes not staged for commit: (use \"git add/rm <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) deleted: a Untracked files: (use \"git add <file>...\" to include in what will be committed) a.txt no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git rm --cached a rm 'a' root@k8s4:~/git_test# git status On branch master Changes to be committed: (use \"git reset HEAD <file>...\" to unstage) deleted: a Untracked files: (use \"git add <file>...\" to include in what will be committed) a.txt root@k8s4:~/git_test# git add a.txt root@k8s4:~/git_test# git status On branch master Changes to be committed: (use \"git reset HEAD <file>...\" to unstage) renamed: a -> a.txt root@k8s4:~/git_test# git commit -m 'commit a.txt' [master da4a5dd] commit a.txt 1 file changed, 0 insertions(+), 0 deletions(-) rename a => a.txt (100%) root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean # \u65b9\u6cd52 root@k8s4:~/git_test# git mv a.txt a root@k8s4:~/git_test# git commit -m 'rename a.txt to a' [master 26e567b] rename a.txt to a 1 file changed, 0 insertions(+), 0 deletions(-) rename a.txt => a (100%) root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean","title":"12. \u6539\u540d"},{"location":"tools/git/git.index/#13","text":"git diff file \u5bf9\u6bd4\u6587\u4ef6\u5728\u672c\u5730\u548c\u7f13\u5b58\u533a\u7684\u5dee\u5f02 git diff --cached file \u5bf9\u6bd4\u6587\u4ef6\u5728\u7f13\u5b58\u533a\u548c\u672c\u5730\u4ed3\u5e93\u7684\u5dee\u5f02 git diff file \u5c31\u662f\u67e5\u770b\u672c\u5730\u548c\u7f13\u5b58\u533a\u6587\u4ef6\u7684\u5bf9\u6bd4 root@k8s4:~/git_test# echo '1'>>a root@k8s4:~/git_test# git status On branch master Changes not staged for commit: (use \"git add <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git diff a diff --git a/a b/a index e69de29..d00491f 100644 --- a/a +++ b/a @@ -0,0 +1 @@ +1 # \u65b0\u52a0\u5185\u5bb9 \u4fee\u6539\u540e\u518d\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\uff08git add\uff09\uff0c\u5728\u6bd4\u5bf9 \u8fd9\u6837\u7f13\u5b58\u533a\u6587\u4ef6\u548c\u672c\u5730\u6587\u4ef6\u5c31\u4e00\u6837\u4e86\uff0c\u6240\u4ee5\u5bf9\u6bd4\u540e\u5565\u90fd\u6ca1\u6709 root@k8s4:~/git_test# git add a root@k8s4:~/git_test# git status On branch master Changes to be committed: (use \"git reset HEAD <file>...\" to unstage) modified: a root@k8s4:~/git_test# git diff a - \u518d\u6b21\u5bf9\u6b64\uff0c\u7f13\u5b58\u533a\u548c\u672c\u5730\u4ed3\u5e93\u7684\u5dee\u5f02 - git diff --cached file \u5c31\u662f\u5bf9\u6bd4\u6587\u4ef6\u5728\u7f13\u5b58\u533a\u548c\u672c\u5730\u4ed3\u5e93\u7684\u5dee\u5f02 root@k8s4:~/git_test# git diff --cached a diff --git a/a b/a index e69de29..d00491f 100644 --- a/a +++ b/a @@ -0,0 +1 @@ +1 - \u7ee7\u7eed\u5c06\u7f13\u5b58\u533a\u7684\u6587\u4ef6\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93\u540e\u518d\u5bf9\u6bd4 root@k8s4:~/git_test# git commit -m 'modify a' [master ccf4d94] modify a 1 file changed, 1 insertion(+) root@k8s4:~/git_test# git diff --cached a # \u56e0\u4e3a\u6587\u4ef6\u90fd\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93\u4e86\uff0c\u6240\u4ee5\u5bf9\u6bd4\u540e\u90fd\u4e00\u6837\u4e86\uff0c","title":"13. \u5bf9\u6bd4\u67e5\u770b\uff0c\u4fee\u6539\u4e86\u4ec0\u4e48"},{"location":"tools/git/git.index/#_1","text":"root@k8s4:~/git_test# git log commit ccf4d94ce795364ec9157fbdee829cbf2c0108b1 Author: leco <leco@leco.com> Date: Tue Jan 15 12:43:28 2019 +0800 modify a commit 26e567b47ad85ba7ea48e030e8d259bddf3d9b69 Author: leco <leco@leco.com> Date: Tue Jan 15 12:35:04 2019 +0800 rename a.txt to a commit da4a5ddc2a9795ba231e0e8a86dc501b93a63dc9 Author: leco <leco@leco.com> Date: Tue Jan 15 12:31:36 2019 +0800 commit a.txt commit e73cff4891f06c86c59f0fe316902cf829ae17e4 Author: leco <leco@leco.com> Date: Tue Jan 15 12:24:57 2019 +0800 commit a - \u7b80\u5199 root@k8s4:~/git_test# git log --oneline 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a root@k8s4:~/git_test# git log --oneline --decorate 1afadfd (HEAD -> master) modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a - \u8be6\u7ec6\u65e5\u5fd7 root@k8s4:~/git_test# git log -p commit 1afadfd79ce4a2676650401e9334b60b36550372 Author: leco <leco@leco.com> Date: Tue Jan 15 12:53:33 2019 +0800 modify a second diff --git a/a b/a index d00491f..68fac01 100644 --- a/a +++ b/a @@ -1 +1,2 @@ 1 +bbb commit ccf4d94ce795364ec9157fbdee829cbf2c0108b1 Author: leco <leco@leco.com> Date: Tue Jan 15 12:43:28 2019 +0800 modify a diff --git a/a b/a index e69de29..d00491f 100644 --- a/a +++ b/a @@ -0,0 +1 @@ +1 commit 26e567b47ad85ba7ea48e030e8d259bddf3d9b69 Author: leco <leco@leco.com> Date: Tue Jan 15 12:35:04 2019 +0800 rename a.txt to a diff --git a/a b/a new file mode 100644 index 0000000..e69de29 diff --git a/a.txt b/a.txt deleted file mode 100644 index e69de29..0000000 commit da4a5ddc2a9795ba231e0e8a86dc501b93a63dc9 Author: leco <leco@leco.com> Date: Tue Jan 15 12:31:36 2019 +0800 commit a.txt diff --git a/a b/a deleted file mode 100644 index e69de29..0000000 diff --git a/a.txt b/a.txt new file mode 100644 index 0000000..e69de29 commit e73cff4891f06c86c59f0fe316902cf829ae17e4 Author: leco <leco@leco.com> Date: Tue Jan 15 12:24:57 2019 +0800 commit a diff --git a/a b/a new file mode 100644 index 0000000..e69de29 - \u67e5\u770b\u5386\u53f2\u51e0\u6761\u8bb0\u5f55 - git log -n n\u8868\u793a\u663e\u793a\u6700\u540e\u4fee\u6539\u7684\u51e0\u6761\u8bb0\u5f55 root@k8s4:~/git_test# git log -2 commit 1afadfd79ce4a2676650401e9334b60b36550372 Author: leco <leco@leco.com> Date: Tue Jan 15 12:53:33 2019 +0800 modify a second commit ccf4d94ce795364ec9157fbdee829cbf2c0108b1 Author: leco <leco@leco.com> Date: Tue Jan 15 12:43:28 2019 +0800 modify a","title":"\u67e5\u770b\u63d0\u4ea4\u7684\u65e5\u5fd7"},{"location":"tools/git/git.label/","text":"Git \u6807\u7b7e 1. \u6807\u7b7e\u7684\u4f7f\u7528 \u00b6 \u524d\u9762\u56de\u6eda\u7684\u662f\u4e00\u4e32\u5b57\u7b26\uff0c\u53c8\u957f\u53c8\u96be\u8bb0\u3002 2. \u7b80\u5355\u5b9e\u7528 \u00b6 root@k8s4:~/git_test# git log --oneline --decorat 495c011 (HEAD -> master) meger testing to master both modify a 65b3dce modify a on testing branch 41d0dd3 modify a on master a369899 Merge branch 'testing' 21af5cc commit master in branch master 81cec5e commit test on branch testing 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a 3. \u57fa\u672c\u547d\u4ee4 \u00b6 git tag v1.0 # \u5f53\u524d\u63d0\u4ea4\u5185\u5bb9\u6253\u4e00\u4e2a\u6807\u7b7e\uff0c\u65b9\u4fbf\u56de\u6eda\uff0c\u6bcf\u6b21\u63d0\u4ea4\u90fd\u4f1a\u6253\u4e2atag git tag # \u67e5\u770b\u5f53\u524d\u6240\u6709\u6807\u7b7e git show v1.0 # \u67e5\u770b\u5f53\u524d1.0\u7248\u672c\u7684\u8be6\u7ec6\u4fe1\u606f git tag v1.2 -m 'version 1.2 release is test' # \u521b\u5efa\u5e26\u6709\u8bf4\u660e\u7684\u6807\u7b7e\uff0c -a \u662f\u6307\u5b9a\u6807\u7b7e\u540d -m \u662f\u6307\u5b9a\u8bf4\u660e\u6587\u5b57 git tag -d v1.0 # \u6211\u4eec\u4e3a\u540c\u4e00\u4e2a\u63d0\u4ea4\u7248\u672c\u8bbe\u7f6e\u4e86\u4e24\u6b21\u6807\u7b7e\uff0c\u5220\u9664\u4e4b\u524d\u7684v.10 4. \u6253\u6807\u7b7e \u00b6 4.1 \u6ca1\u6307\u5b9a\u7279\u5b9a\u7684\u7248\u672c \u00b6 root@k8s4:~/git_test# git log --oneline --decorat 495c011 (HEAD -> master) meger testing to master both modify a 65b3dce modify a on testing branch 41d0dd3 modify a on master a369899 Merge branch 'testing' 21af5cc commit master in branch master 81cec5e commit test on branch testing 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a root@k8s4:~/git_test# git tag -a v1.0 \u7136\u540e\u65b0\u5f00\u7684\u7a97\u53e3\u8bb0\u5f55tag\u7684\u4fe1\u606f\uff0c\u6211\u8bb0\u5f55\u4e3a This is my v1.0 version 4.1.1 \u67e5\u770b\u6253\u7684\u6807\u7b7e \u00b6 root@k8s4:~/git_test# git tag v1.0 4.2 \u6307\u5b9a\u7279\u5b9a\u7684\u7248\u672c \u00b6 root@k8s4:~/git_test# git log --oneline --decorat 495c011 (HEAD -> master, tag: v1.0) meger testing to master both modify a 65b3dce modify a on testing branch 41d0dd3 modify a on master a369899 Merge branch 'testing' 21af5cc commit master in branch master 81cec5e commit test on branch testing 1afadfd modify a second # \u6307\u5b9a\u8fd9\u4e2a\u7248\u672c\u6253\u6807\u7b7e ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a root@k8s4:~/git_test# git tag v1.0 root@k8s4:~/git_test# git tag -a v2.0 1afadfd root@k8s4:~/git_test# git tag v1.0 v2.0 4.2.1 \u67e5\u770b\u6253\u7684\u6807\u7b7e \u00b6 root@k8s4:~/git_test# git show v1.0 tag v1.0 Tagger: leco <leco@leco.com> Date: Tue Jan 15 14:56:45 2019 +0800 This is my v1.0 version commit 495c011cd59214a3d8de425203162e6af50f41be Merge: 41d0dd3 65b3dce Author: leco <leco@leco.com> Date: Tue Jan 15 14:38:27 2019 +0800 meger testing to master both modify a diff --cc a index 3bf17cd,a2b2d32..db90531 --- a/a +++ b/a @@@ -1,3 -1,3 +1,4 @@@ 1 bbb +master + testing 5. tag\u64cd\u4f5c \u00b6 5.1 \u901a\u8fc7tag \u6062\u590d\u7248\u672c \u00b6 \u4ee5\u4e0b\u662f\u6062\u590d\u52302.0\u7248\u672c root@k8s4:~/git_test# touch b root@k8s4:~/git_test# ls a b master test root@k8s4:~/git_test# git reset --hard v2.0 HEAD is now at 1afadfd modify a second root@k8s4:~/git_test# ls a b 5.2 \u5220\u9664tag \u00b6 root@k8s4:~/git_test# git tag v1.0 v2.0 root@k8s4:~/git_test# git tag -d v2.0 Deleted tag 'v2.0' (was 65b1d62) root@k8s4:~/git_test# git tag v1.0","title":"4. git \u6807\u7b7e"},{"location":"tools/git/git.label/#1","text":"\u524d\u9762\u56de\u6eda\u7684\u662f\u4e00\u4e32\u5b57\u7b26\uff0c\u53c8\u957f\u53c8\u96be\u8bb0\u3002","title":"1. \u6807\u7b7e\u7684\u4f7f\u7528"},{"location":"tools/git/git.label/#2","text":"root@k8s4:~/git_test# git log --oneline --decorat 495c011 (HEAD -> master) meger testing to master both modify a 65b3dce modify a on testing branch 41d0dd3 modify a on master a369899 Merge branch 'testing' 21af5cc commit master in branch master 81cec5e commit test on branch testing 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a","title":"2. \u7b80\u5355\u5b9e\u7528"},{"location":"tools/git/git.label/#3","text":"git tag v1.0 # \u5f53\u524d\u63d0\u4ea4\u5185\u5bb9\u6253\u4e00\u4e2a\u6807\u7b7e\uff0c\u65b9\u4fbf\u56de\u6eda\uff0c\u6bcf\u6b21\u63d0\u4ea4\u90fd\u4f1a\u6253\u4e2atag git tag # \u67e5\u770b\u5f53\u524d\u6240\u6709\u6807\u7b7e git show v1.0 # \u67e5\u770b\u5f53\u524d1.0\u7248\u672c\u7684\u8be6\u7ec6\u4fe1\u606f git tag v1.2 -m 'version 1.2 release is test' # \u521b\u5efa\u5e26\u6709\u8bf4\u660e\u7684\u6807\u7b7e\uff0c -a \u662f\u6307\u5b9a\u6807\u7b7e\u540d -m \u662f\u6307\u5b9a\u8bf4\u660e\u6587\u5b57 git tag -d v1.0 # \u6211\u4eec\u4e3a\u540c\u4e00\u4e2a\u63d0\u4ea4\u7248\u672c\u8bbe\u7f6e\u4e86\u4e24\u6b21\u6807\u7b7e\uff0c\u5220\u9664\u4e4b\u524d\u7684v.10","title":"3. \u57fa\u672c\u547d\u4ee4"},{"location":"tools/git/git.label/#4","text":"","title":"4. \u6253\u6807\u7b7e"},{"location":"tools/git/git.label/#41","text":"root@k8s4:~/git_test# git log --oneline --decorat 495c011 (HEAD -> master) meger testing to master both modify a 65b3dce modify a on testing branch 41d0dd3 modify a on master a369899 Merge branch 'testing' 21af5cc commit master in branch master 81cec5e commit test on branch testing 1afadfd modify a second ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a root@k8s4:~/git_test# git tag -a v1.0 \u7136\u540e\u65b0\u5f00\u7684\u7a97\u53e3\u8bb0\u5f55tag\u7684\u4fe1\u606f\uff0c\u6211\u8bb0\u5f55\u4e3a This is my v1.0 version","title":"4.1 \u6ca1\u6307\u5b9a\u7279\u5b9a\u7684\u7248\u672c"},{"location":"tools/git/git.label/#411","text":"root@k8s4:~/git_test# git tag v1.0","title":"4.1.1 \u67e5\u770b\u6253\u7684\u6807\u7b7e"},{"location":"tools/git/git.label/#42","text":"root@k8s4:~/git_test# git log --oneline --decorat 495c011 (HEAD -> master, tag: v1.0) meger testing to master both modify a 65b3dce modify a on testing branch 41d0dd3 modify a on master a369899 Merge branch 'testing' 21af5cc commit master in branch master 81cec5e commit test on branch testing 1afadfd modify a second # \u6307\u5b9a\u8fd9\u4e2a\u7248\u672c\u6253\u6807\u7b7e ccf4d94 modify a 26e567b rename a.txt to a da4a5dd commit a.txt e73cff4 commit a root@k8s4:~/git_test# git tag v1.0 root@k8s4:~/git_test# git tag -a v2.0 1afadfd root@k8s4:~/git_test# git tag v1.0 v2.0","title":"4.2 \u6307\u5b9a\u7279\u5b9a\u7684\u7248\u672c"},{"location":"tools/git/git.label/#421","text":"root@k8s4:~/git_test# git show v1.0 tag v1.0 Tagger: leco <leco@leco.com> Date: Tue Jan 15 14:56:45 2019 +0800 This is my v1.0 version commit 495c011cd59214a3d8de425203162e6af50f41be Merge: 41d0dd3 65b3dce Author: leco <leco@leco.com> Date: Tue Jan 15 14:38:27 2019 +0800 meger testing to master both modify a diff --cc a index 3bf17cd,a2b2d32..db90531 --- a/a +++ b/a @@@ -1,3 -1,3 +1,4 @@@ 1 bbb +master + testing","title":"4.2.1 \u67e5\u770b\u6253\u7684\u6807\u7b7e"},{"location":"tools/git/git.label/#5-tag","text":"","title":"5. tag\u64cd\u4f5c"},{"location":"tools/git/git.label/#51-tag","text":"\u4ee5\u4e0b\u662f\u6062\u590d\u52302.0\u7248\u672c root@k8s4:~/git_test# touch b root@k8s4:~/git_test# ls a b master test root@k8s4:~/git_test# git reset --hard v2.0 HEAD is now at 1afadfd modify a second root@k8s4:~/git_test# ls a b","title":"5.1 \u901a\u8fc7tag \u6062\u590d\u7248\u672c"},{"location":"tools/git/git.label/#52-tag","text":"root@k8s4:~/git_test# git tag v1.0 v2.0 root@k8s4:~/git_test# git tag -d v2.0 Deleted tag 'v2.0' (was 65b1d62) root@k8s4:~/git_test# git tag v1.0","title":"5.2 \u5220\u9664tag"},{"location":"tools/git/git.rollback/","text":"Git \u7248\u672c\u6062\u590d \u7248\u672c\u6062\u590d \u00b6 1.\u672c\u5730\u4fee\u6539\u540e\u9519\u8bef\u6062\u590d \u7528\u672c\u5730\u7f13\u5b58\u533a\u8986\u76d6\u672c\u5730\u6587\u4ef6 git checkout -- file 2.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u6062\u590d \u7528\u4ed3\u5e93\u8986\u76d6\u7f13\u5b58\u533a\u6587\u4ef6 git reset HEAD file git checkout -- file \u7528\u7f13\u5b58\u533a\u6587\u4ef6\u8986\u76d6\u672c\u5730\u6587\u4ef6 3.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u7136\u540e\u518d\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93\u540e\u6062\u590d git log \u67e5\u5386\u53f2\u7248\u672c\u53f7 git reflog \u67e5\u770b\u6240\u6709\u5386\u53f2\u7248\u672c\u53f7 git reset --hard \u7248\u672c\u53f7 1. \u672c\u5730\u4fee\u6539\u540e\u9519\u8bef\u6062\u590d \u00b6 root@k8s4:~/git_test# echo 'ccc'>>a root@k8s4:~/git_test# cat a 1 bbb ccc root@k8s4:~/git_test# git diff a diff --git a/a b/a index 68fac01..cc63771 100644 --- a/a +++ b/a @@ -1,2 +1,3 @@ 1 bbb +ccc root@k8s4:~/git_test# git status On branch master Changes not staged for commit: (use \"git add <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git checkout -- a root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# cat a 1 bbb 2.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u6062\u590d \u00b6 root@k8s4:~/git_test# echo 'ccc'>>a # \u4fee\u6539\u672c\u5730\u6587\u4ef6 root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u5730\u6587\u672c 1 bbb ccc root@k8s4:~/git_test# git status # \u67e5\u770b\u7f13\u5b58\u533a\u72b6\u6001 On branch master Changes not staged for commit: (use \"git add <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git add . # \u63d0\u4ea4\u6587\u4ef6\u5230\u7f13\u5b58\u533a root@k8s4:~/git_test# git status # \u67e5\u770b\u7f13\u5b58\u533a\u72b6\u6001 On branch master Changes to be committed: (use \"git reset HEAD <file>...\" to unstage) modified: a root@k8s4:~/git_test# git diff --cached # \u5bf9\u6bd4\u6587\u4ef6\u5728\u7f13\u5b58\u533a\u548c\u672c\u5730\u4ed3\u5e93\u7684\u5dee\u5f02 diff --git a/a b/a index 68fac01..cc63771 100644 --- a/a +++ b/a @@ -1,2 +1,3 @@ 1 bbb +ccc root@k8s4:~/git_test# git reset HEAD a # \u672c\u5730\u4ed3\u5e93\u6587\u4ef6\u8986\u76d6\u7f13\u5b58\u533a\u6587\u4ef6 Unstaged changes after reset: M a root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u5730\u6587\u4ef6\uff08\u6ca1\u53d8\u3002\u56e0\u4e3a\u53ea\u7528\u672c\u5730\u4ed3\u5e93\u8986\u76d6\u4e86\u7f13\u5b58\u533a\u6587\u4ef6\uff09 1 bbb ccc root@k8s4:~/git_test# git diff a # \u5bf9\u6bd4\u7f13\u5b58\u533a\u548c\u672c\u5730\u6587\u4ef6\u5dee\u5f02 diff --git a/a b/a index 68fac01..cc63771 100644 --- a/a +++ b/a @@ -1,2 +1,3 @@ 1 bbb +ccc root@k8s4:~/git_test# git diff --cached a # \u5bf9\u6bd4\u4ed3\u5e93\u548c\u7f13\u5b58\u533a\u6587\u4ef6\u5dee\u5f02 root@k8s4:~/git_test# git status On branch master Changes not staged for commit: (use \"git add <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git checkout -- a # \u7f13\u5b58\u533a\u6587\u4ef6\u8986\u76d6\u672c\u5730\u6587\u4ef6 root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# cat a # \u67e5\u770b\u6587\u4ef6 1 bbb 3.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u7136\u540e\u518d\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93\u540e\u6062\u590d \u00b6 root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u6587\u4ef6 1 bbb root@k8s4:~/git_test# echo 'ccc'>>a # \u4fee\u6539\u672c\u5730\u6587\u4ef6 root@k8s4:~/git_test# cat a 1 bbb ccc root@k8s4:~/git_test# git add . # \u63d0\u4ea4\u5230\u7f13\u5b58\u533a root@k8s4:~/git_test# git status # \u67e5\u770b\u72b6\u6001 On branch master Changes to be committed: (use \"git reset HEAD <file>...\" to unstage) modified: a root@k8s4:~/git_test# git log # \u67e5\u770b\u5386\u53f2\u65e5\u5fd7 commit 1afadfd79ce4a2676650401e9334b60b36550372 Author: leco <leco@leco.com> Date: Tue Jan 15 12:53:33 2019 +0800 modify a second commit ccf4d94ce795364ec9157fbdee829cbf2c0108b1 Author: leco <leco@leco.com> Date: Tue Jan 15 12:43:28 2019 +0800 modify a commit 26e567b47ad85ba7ea48e030e8d259bddf3d9b69 Author: leco <leco@leco.com> Date: Tue Jan 15 12:35:04 2019 +0800 rename a.txt to a commit da4a5ddc2a9795ba231e0e8a86dc501b93a63dc9 Author: leco <leco@leco.com> Date: Tue Jan 15 12:31:36 2019 +0800 commit a.txt commit e73cff4891f06c86c59f0fe316902cf829ae17e4 Author: leco <leco@leco.com> Date: Tue Jan 15 12:24:57 2019 +0800 commit a root@k8s4:~/git_test# git reset --hard ccf4d94ce # \u56de\u9000\u5230\u67d0\u4e2a\u7248\u672c\u4e5f\u5c31\u662f\u4e0a\u9762commit\u540e\u9762\u7684\u503c\uff08\u53ef\u4ee5\u53d6\u90e8\u5206\uff09 HEAD is now at ccf4d94 modify a root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u5730\u6587\u4ef6\uff0c\u5df2\u7ecf\u56de\u9000\u5230\u67d0\u4e00\u4e2a\u7248\u672c\u6587\u4ef6\u4e86 1 root@k8s4:~/git_test# git status # \u67e5\u770b\u72b6\u6001 On branch master nothing to commit, working directory clean # \u6062\u590d\u67d0\u4e2a\u7248\u672c\u540e\uff0c\u5728\u8fd9\u4e2a\u7248\u672c\u4e4b\u540e\u7684log\u4e5f\u770b\u4e0d\u5230\uff0c\u4f7f\u7528 git reflog\u662f\u67e5\u770b\u6240\u6709\u5386\u53f2\u8bb0\u5f55 root@k8s4:~/git_test# git log commit ccf4d94ce795364ec9157fbdee829cbf2c0108b1 Author: leco <leco@leco.com> Date: Tue Jan 15 12:43:28 2019 +0800 modify a commit 26e567b47ad85ba7ea48e030e8d259bddf3d9b69 Author: leco <leco@leco.com> Date: Tue Jan 15 12:35:04 2019 +0800 rename a.txt to a commit da4a5ddc2a9795ba231e0e8a86dc501b93a63dc9 Author: leco <leco@leco.com> Date: Tue Jan 15 12:31:36 2019 +0800 commit a.txt commit e73cff4891f06c86c59f0fe316902cf829ae17e4 Author: leco <leco@leco.com> Date: Tue Jan 15 12:24:57 2019 +0800 commit a root@k8s4:~/git_test# git reflog ccf4d94 HEAD@{0}: reset: moving to ccf4d94ce 1afadfd HEAD@{1}: commit: modify a second ccf4d94 HEAD@{2}: commit: modify a 26e567b HEAD@{3}: commit: rename a.txt to a da4a5dd HEAD@{4}: commit: commit a.txt e73cff4 HEAD@{5}: commit (initial): commit a root@k8s4:~/git_test# git reset --hard 1afadfd # \u56de\u9000\u5230\u67d0\u4e2a\u7248\u672c HEAD is now at 1afadfd modify a second root@k8s4:~/git_test# cat a 1 bbb t checkout -- file - 2.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u6062\u590d - \u7528\u4ed3\u5e93\u8986\u76d6\u7f13\u5b58\u533a\u6587\u4ef6 - git reset HEAD file - git checkout -- file - \u7528\u7f13\u5b58\u533a\u6587\u4ef6\u8986\u76d6\u672c\u5730\u6587\u4ef6 - 3.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u7136\u540e\u518d\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93\u540e\u6062\u590d - git log \u67e5\u5386\u53f2\u7248\u672c\u53f7 - git reflog \u67e5\u770b\u6240\u6709\u5386\u53f2\u7248\u672c\u53f7 - git reset --hard \u7248\u672c\u53f7 1. \u672c\u5730\u4fee\u6539\u540e\u9519\u8bef\u6062\u590d \u00b6 root@k8s4:~/git_test# echo 'ccc'>>a root@k8s4:~/git_test# cat a 1 bbb ccc root@k8s4:~/git_test# git diff a diff --git a/a b/a index 68fac01..cc63771 100644 --- a/a +++ b/a @@ -1,2 +1,3 @@ 1 bbb +ccc root@k8s4:~/git_test# git status On branch master Changes not staged for commit: (use \"git add <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git checkout -- a root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# cat a 1 bbb 2.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u6062\u590d \u00b6 root@k8s4:~/git_test# echo 'ccc'>>a # \u4fee\u6539\u672c\u5730\u6587\u4ef6 root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u5730\u6587\u672c 1 bbb ccc root@k8s4:~/git_test# git status # \u67e5\u770b\u7f13\u5b58\u533a\u72b6\u6001 On branch master Changes not staged for commit: (use \"git add <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git add . # \u63d0\u4ea4\u6587\u4ef6\u5230\u7f13\u5b58\u533a root@k8s4:~/git_test# git status # \u67e5\u770b\u7f13\u5b58\u533a\u72b6\u6001 On branch master Changes to be committed: (use \"git reset HEAD <file>...\" to unstage) modified: a root@k8s4:~/git_test# git diff --cached # \u5bf9\u6bd4\u6587\u4ef6\u5728\u7f13\u5b58\u533a\u548c\u672c\u5730\u4ed3\u5e93\u7684\u5dee\u5f02 diff --git a/a b/a index 68fac01..cc63771 100644 --- a/a +++ b/a @@ -1,2 +1,3 @@ 1 bbb +ccc root@k8s4:~/git_test# git reset HEAD a # \u672c\u5730\u4ed3\u5e93\u6587\u4ef6\u8986\u76d6\u7f13\u5b58\u533a\u6587\u4ef6 Unstaged changes after reset: M a root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u5730\u6587\u4ef6\uff08\u6ca1\u53d8\u3002\u56e0\u4e3a\u53ea\u7528\u672c\u5730\u4ed3\u5e93\u8986\u76d6\u4e86\u7f13\u5b58\u533a\u6587\u4ef6\uff09 1 bbb ccc root@k8s4:~/git_test# git diff a # \u5bf9\u6bd4\u7f13\u5b58\u533a\u548c\u672c\u5730\u6587\u4ef6\u5dee\u5f02 diff --git a/a b/a index 68fac01..cc63771 100644 --- a/a +++ b/a @@ -1,2 +1,3 @@ 1 bbb +ccc root@k8s4:~/git_test# git diff --cached a # \u5bf9\u6bd4\u4ed3\u5e93\u548c\u7f13\u5b58\u533a\u6587\u4ef6\u5dee\u5f02 root@k8s4:~/git_test# git status On branch master Changes not staged for commit: (use \"git add <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git checkout -- a # \u7f13\u5b58\u533a\u6587\u4ef6\u8986\u76d6\u672c\u5730\u6587\u4ef6 root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# cat a # \u67e5\u770b\u6587\u4ef6 1 bbb 3.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u7136\u540e\u518d\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93\u540e\u6062\u590d \u00b6 root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u6587\u4ef6 1 bbb root@k8s4:~/git_test# echo 'ccc'>>a # \u4fee\u6539\u672c\u5730\u6587\u4ef6 root@k8s4:~/git_test# cat a 1 bbb ccc root@k8s4:~/git_test# git add . # \u63d0\u4ea4\u5230\u7f13\u5b58\u533a root@k8s4:~/git_test# git status # \u67e5\u770b\u72b6\u6001 On branch master Changes to be committed: (use \"git reset HEAD <file>...\" to unstage) modified: a root@k8s4:~/git_test# git log # \u67e5\u770b\u5386\u53f2\u65e5\u5fd7 commit 1afadfd79ce4a2676650401e9334b60b36550372 Author: leco <leco@leco.com> Date: Tue Jan 15 12:53:33 2019 +0800 modify a second commit ccf4d94ce795364ec9157fbdee829cbf2c0108b1 Author: leco <leco@leco.com> Date: Tue Jan 15 12:43:28 2019 +0800 modify a commit 26e567b47ad85ba7ea48e030e8d259bddf3d9b69 Author: leco <leco@leco.com> Date: Tue Jan 15 12:35:04 2019 +0800 rename a.txt to a commit da4a5ddc2a9795ba231e0e8a86dc501b93a63dc9 Author: leco <leco@leco.com> Date: Tue Jan 15 12:31:36 2019 +0800 commit a.txt commit e73cff4891f06c86c59f0fe316902cf829ae17e4 Author: leco <leco@leco.com> Date: Tue Jan 15 12:24:57 2019 +0800 commit a root@k8s4:~/git_test# git reset --hard ccf4d94ce # \u56de\u9000\u5230\u67d0\u4e2a\u7248\u672c\u4e5f\u5c31\u662f\u4e0a\u9762commit\u540e\u9762\u7684\u503c\uff08\u53ef\u4ee5\u53d6\u90e8\u5206\uff09 HEAD is now at ccf4d94 modify a root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u5730\u6587\u4ef6\uff0c\u5df2\u7ecf\u56de\u9000\u5230\u67d0\u4e00\u4e2a\u7248\u672c\u6587\u4ef6\u4e86 1 root@k8s4:~/git_test# git status # \u67e5\u770b\u72b6\u6001 On branch master nothing to commit, working directory clean # \u6062\u590d\u67d0\u4e2a\u7248\u672c\u540e\uff0c\u5728\u8fd9\u4e2a\u7248\u672c\u4e4b\u540e\u7684log\u4e5f\u770b\u4e0d\u5230\uff0c\u4f7f\u7528 git reflog\u662f\u67e5\u770b\u6240\u6709\u5386\u53f2\u8bb0\u5f55 root@k8s4:~/git_test# git log commit ccf4d94ce795364ec9157fbdee829cbf2c0108b1 Author: leco <leco@leco.com> Date: Tue Jan 15 12:43:28 2019 +0800 modify a commit 26e567b47ad85ba7ea48e030e8d259bddf3d9b69 Author: leco <leco@leco.com> Date: Tue Jan 15 12:35:04 2019 +0800 rename a.txt to a commit da4a5ddc2a9795ba231e0e8a86dc501b93a63dc9 Author: leco <leco@leco.com> Date: Tue Jan 15 12:31:36 2019 +0800 commit a.txt commit e73cff4891f06c86c59f0fe316902cf829ae17e4 Author: leco <leco@leco.com> Date: Tue Jan 15 12:24:57 2019 +0800 commit a root@k8s4:~/git_test# git reflog ccf4d94 HEAD@{0}: reset: moving to ccf4d94ce 1afadfd HEAD@{1}: commit: modify a second ccf4d94 HEAD@{2}: commit: modify a 26e567b HEAD@{3}: commit: rename a.txt to a da4a5dd HEAD@{4}: commit: commit a.txt e73cff4 HEAD@{5}: commit (initial): commit a root@k8s4:~/git_test# git reset --hard 1afadfd # \u56de\u9000\u5230\u67d0\u4e2a\u7248\u672c HEAD is now at 1afadfd modify a second root@k8s4:~/git_test# cat a 1 bbb","title":"2. git \u56de\u6eda"},{"location":"tools/git/git.rollback/#_1","text":"1.\u672c\u5730\u4fee\u6539\u540e\u9519\u8bef\u6062\u590d \u7528\u672c\u5730\u7f13\u5b58\u533a\u8986\u76d6\u672c\u5730\u6587\u4ef6 git checkout -- file 2.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u6062\u590d \u7528\u4ed3\u5e93\u8986\u76d6\u7f13\u5b58\u533a\u6587\u4ef6 git reset HEAD file git checkout -- file \u7528\u7f13\u5b58\u533a\u6587\u4ef6\u8986\u76d6\u672c\u5730\u6587\u4ef6 3.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u7136\u540e\u518d\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93\u540e\u6062\u590d git log \u67e5\u5386\u53f2\u7248\u672c\u53f7 git reflog \u67e5\u770b\u6240\u6709\u5386\u53f2\u7248\u672c\u53f7 git reset --hard \u7248\u672c\u53f7","title":"\u7248\u672c\u6062\u590d"},{"location":"tools/git/git.rollback/#1","text":"root@k8s4:~/git_test# echo 'ccc'>>a root@k8s4:~/git_test# cat a 1 bbb ccc root@k8s4:~/git_test# git diff a diff --git a/a b/a index 68fac01..cc63771 100644 --- a/a +++ b/a @@ -1,2 +1,3 @@ 1 bbb +ccc root@k8s4:~/git_test# git status On branch master Changes not staged for commit: (use \"git add <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git checkout -- a root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# cat a 1 bbb","title":"1. \u672c\u5730\u4fee\u6539\u540e\u9519\u8bef\u6062\u590d"},{"location":"tools/git/git.rollback/#2","text":"root@k8s4:~/git_test# echo 'ccc'>>a # \u4fee\u6539\u672c\u5730\u6587\u4ef6 root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u5730\u6587\u672c 1 bbb ccc root@k8s4:~/git_test# git status # \u67e5\u770b\u7f13\u5b58\u533a\u72b6\u6001 On branch master Changes not staged for commit: (use \"git add <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git add . # \u63d0\u4ea4\u6587\u4ef6\u5230\u7f13\u5b58\u533a root@k8s4:~/git_test# git status # \u67e5\u770b\u7f13\u5b58\u533a\u72b6\u6001 On branch master Changes to be committed: (use \"git reset HEAD <file>...\" to unstage) modified: a root@k8s4:~/git_test# git diff --cached # \u5bf9\u6bd4\u6587\u4ef6\u5728\u7f13\u5b58\u533a\u548c\u672c\u5730\u4ed3\u5e93\u7684\u5dee\u5f02 diff --git a/a b/a index 68fac01..cc63771 100644 --- a/a +++ b/a @@ -1,2 +1,3 @@ 1 bbb +ccc root@k8s4:~/git_test# git reset HEAD a # \u672c\u5730\u4ed3\u5e93\u6587\u4ef6\u8986\u76d6\u7f13\u5b58\u533a\u6587\u4ef6 Unstaged changes after reset: M a root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u5730\u6587\u4ef6\uff08\u6ca1\u53d8\u3002\u56e0\u4e3a\u53ea\u7528\u672c\u5730\u4ed3\u5e93\u8986\u76d6\u4e86\u7f13\u5b58\u533a\u6587\u4ef6\uff09 1 bbb ccc root@k8s4:~/git_test# git diff a # \u5bf9\u6bd4\u7f13\u5b58\u533a\u548c\u672c\u5730\u6587\u4ef6\u5dee\u5f02 diff --git a/a b/a index 68fac01..cc63771 100644 --- a/a +++ b/a @@ -1,2 +1,3 @@ 1 bbb +ccc root@k8s4:~/git_test# git diff --cached a # \u5bf9\u6bd4\u4ed3\u5e93\u548c\u7f13\u5b58\u533a\u6587\u4ef6\u5dee\u5f02 root@k8s4:~/git_test# git status On branch master Changes not staged for commit: (use \"git add <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git checkout -- a # \u7f13\u5b58\u533a\u6587\u4ef6\u8986\u76d6\u672c\u5730\u6587\u4ef6 root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# cat a # \u67e5\u770b\u6587\u4ef6 1 bbb","title":"2.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u6062\u590d"},{"location":"tools/git/git.rollback/#3","text":"root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u6587\u4ef6 1 bbb root@k8s4:~/git_test# echo 'ccc'>>a # \u4fee\u6539\u672c\u5730\u6587\u4ef6 root@k8s4:~/git_test# cat a 1 bbb ccc root@k8s4:~/git_test# git add . # \u63d0\u4ea4\u5230\u7f13\u5b58\u533a root@k8s4:~/git_test# git status # \u67e5\u770b\u72b6\u6001 On branch master Changes to be committed: (use \"git reset HEAD <file>...\" to unstage) modified: a root@k8s4:~/git_test# git log # \u67e5\u770b\u5386\u53f2\u65e5\u5fd7 commit 1afadfd79ce4a2676650401e9334b60b36550372 Author: leco <leco@leco.com> Date: Tue Jan 15 12:53:33 2019 +0800 modify a second commit ccf4d94ce795364ec9157fbdee829cbf2c0108b1 Author: leco <leco@leco.com> Date: Tue Jan 15 12:43:28 2019 +0800 modify a commit 26e567b47ad85ba7ea48e030e8d259bddf3d9b69 Author: leco <leco@leco.com> Date: Tue Jan 15 12:35:04 2019 +0800 rename a.txt to a commit da4a5ddc2a9795ba231e0e8a86dc501b93a63dc9 Author: leco <leco@leco.com> Date: Tue Jan 15 12:31:36 2019 +0800 commit a.txt commit e73cff4891f06c86c59f0fe316902cf829ae17e4 Author: leco <leco@leco.com> Date: Tue Jan 15 12:24:57 2019 +0800 commit a root@k8s4:~/git_test# git reset --hard ccf4d94ce # \u56de\u9000\u5230\u67d0\u4e2a\u7248\u672c\u4e5f\u5c31\u662f\u4e0a\u9762commit\u540e\u9762\u7684\u503c\uff08\u53ef\u4ee5\u53d6\u90e8\u5206\uff09 HEAD is now at ccf4d94 modify a root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u5730\u6587\u4ef6\uff0c\u5df2\u7ecf\u56de\u9000\u5230\u67d0\u4e00\u4e2a\u7248\u672c\u6587\u4ef6\u4e86 1 root@k8s4:~/git_test# git status # \u67e5\u770b\u72b6\u6001 On branch master nothing to commit, working directory clean # \u6062\u590d\u67d0\u4e2a\u7248\u672c\u540e\uff0c\u5728\u8fd9\u4e2a\u7248\u672c\u4e4b\u540e\u7684log\u4e5f\u770b\u4e0d\u5230\uff0c\u4f7f\u7528 git reflog\u662f\u67e5\u770b\u6240\u6709\u5386\u53f2\u8bb0\u5f55 root@k8s4:~/git_test# git log commit ccf4d94ce795364ec9157fbdee829cbf2c0108b1 Author: leco <leco@leco.com> Date: Tue Jan 15 12:43:28 2019 +0800 modify a commit 26e567b47ad85ba7ea48e030e8d259bddf3d9b69 Author: leco <leco@leco.com> Date: Tue Jan 15 12:35:04 2019 +0800 rename a.txt to a commit da4a5ddc2a9795ba231e0e8a86dc501b93a63dc9 Author: leco <leco@leco.com> Date: Tue Jan 15 12:31:36 2019 +0800 commit a.txt commit e73cff4891f06c86c59f0fe316902cf829ae17e4 Author: leco <leco@leco.com> Date: Tue Jan 15 12:24:57 2019 +0800 commit a root@k8s4:~/git_test# git reflog ccf4d94 HEAD@{0}: reset: moving to ccf4d94ce 1afadfd HEAD@{1}: commit: modify a second ccf4d94 HEAD@{2}: commit: modify a 26e567b HEAD@{3}: commit: rename a.txt to a da4a5dd HEAD@{4}: commit: commit a.txt e73cff4 HEAD@{5}: commit (initial): commit a root@k8s4:~/git_test# git reset --hard 1afadfd # \u56de\u9000\u5230\u67d0\u4e2a\u7248\u672c HEAD is now at 1afadfd modify a second root@k8s4:~/git_test# cat a 1 bbb t checkout -- file - 2.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u6062\u590d - \u7528\u4ed3\u5e93\u8986\u76d6\u7f13\u5b58\u533a\u6587\u4ef6 - git reset HEAD file - git checkout -- file - \u7528\u7f13\u5b58\u533a\u6587\u4ef6\u8986\u76d6\u672c\u5730\u6587\u4ef6 - 3.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u7136\u540e\u518d\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93\u540e\u6062\u590d - git log \u67e5\u5386\u53f2\u7248\u672c\u53f7 - git reflog \u67e5\u770b\u6240\u6709\u5386\u53f2\u7248\u672c\u53f7 - git reset --hard \u7248\u672c\u53f7","title":"3.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u7136\u540e\u518d\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93\u540e\u6062\u590d"},{"location":"tools/git/git.rollback/#1_1","text":"root@k8s4:~/git_test# echo 'ccc'>>a root@k8s4:~/git_test# cat a 1 bbb ccc root@k8s4:~/git_test# git diff a diff --git a/a b/a index 68fac01..cc63771 100644 --- a/a +++ b/a @@ -1,2 +1,3 @@ 1 bbb +ccc root@k8s4:~/git_test# git status On branch master Changes not staged for commit: (use \"git add <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git checkout -- a root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# cat a 1 bbb","title":"1. \u672c\u5730\u4fee\u6539\u540e\u9519\u8bef\u6062\u590d"},{"location":"tools/git/git.rollback/#2_1","text":"root@k8s4:~/git_test# echo 'ccc'>>a # \u4fee\u6539\u672c\u5730\u6587\u4ef6 root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u5730\u6587\u672c 1 bbb ccc root@k8s4:~/git_test# git status # \u67e5\u770b\u7f13\u5b58\u533a\u72b6\u6001 On branch master Changes not staged for commit: (use \"git add <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git add . # \u63d0\u4ea4\u6587\u4ef6\u5230\u7f13\u5b58\u533a root@k8s4:~/git_test# git status # \u67e5\u770b\u7f13\u5b58\u533a\u72b6\u6001 On branch master Changes to be committed: (use \"git reset HEAD <file>...\" to unstage) modified: a root@k8s4:~/git_test# git diff --cached # \u5bf9\u6bd4\u6587\u4ef6\u5728\u7f13\u5b58\u533a\u548c\u672c\u5730\u4ed3\u5e93\u7684\u5dee\u5f02 diff --git a/a b/a index 68fac01..cc63771 100644 --- a/a +++ b/a @@ -1,2 +1,3 @@ 1 bbb +ccc root@k8s4:~/git_test# git reset HEAD a # \u672c\u5730\u4ed3\u5e93\u6587\u4ef6\u8986\u76d6\u7f13\u5b58\u533a\u6587\u4ef6 Unstaged changes after reset: M a root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u5730\u6587\u4ef6\uff08\u6ca1\u53d8\u3002\u56e0\u4e3a\u53ea\u7528\u672c\u5730\u4ed3\u5e93\u8986\u76d6\u4e86\u7f13\u5b58\u533a\u6587\u4ef6\uff09 1 bbb ccc root@k8s4:~/git_test# git diff a # \u5bf9\u6bd4\u7f13\u5b58\u533a\u548c\u672c\u5730\u6587\u4ef6\u5dee\u5f02 diff --git a/a b/a index 68fac01..cc63771 100644 --- a/a +++ b/a @@ -1,2 +1,3 @@ 1 bbb +ccc root@k8s4:~/git_test# git diff --cached a # \u5bf9\u6bd4\u4ed3\u5e93\u548c\u7f13\u5b58\u533a\u6587\u4ef6\u5dee\u5f02 root@k8s4:~/git_test# git status On branch master Changes not staged for commit: (use \"git add <file>...\" to update what will be committed) (use \"git checkout -- <file>...\" to discard changes in working directory) modified: a no changes added to commit (use \"git add\" and/or \"git commit -a\") root@k8s4:~/git_test# git checkout -- a # \u7f13\u5b58\u533a\u6587\u4ef6\u8986\u76d6\u672c\u5730\u6587\u4ef6 root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# cat a # \u67e5\u770b\u6587\u4ef6 1 bbb","title":"2.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u6062\u590d"},{"location":"tools/git/git.rollback/#3_1","text":"root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u6587\u4ef6 1 bbb root@k8s4:~/git_test# echo 'ccc'>>a # \u4fee\u6539\u672c\u5730\u6587\u4ef6 root@k8s4:~/git_test# cat a 1 bbb ccc root@k8s4:~/git_test# git add . # \u63d0\u4ea4\u5230\u7f13\u5b58\u533a root@k8s4:~/git_test# git status # \u67e5\u770b\u72b6\u6001 On branch master Changes to be committed: (use \"git reset HEAD <file>...\" to unstage) modified: a root@k8s4:~/git_test# git log # \u67e5\u770b\u5386\u53f2\u65e5\u5fd7 commit 1afadfd79ce4a2676650401e9334b60b36550372 Author: leco <leco@leco.com> Date: Tue Jan 15 12:53:33 2019 +0800 modify a second commit ccf4d94ce795364ec9157fbdee829cbf2c0108b1 Author: leco <leco@leco.com> Date: Tue Jan 15 12:43:28 2019 +0800 modify a commit 26e567b47ad85ba7ea48e030e8d259bddf3d9b69 Author: leco <leco@leco.com> Date: Tue Jan 15 12:35:04 2019 +0800 rename a.txt to a commit da4a5ddc2a9795ba231e0e8a86dc501b93a63dc9 Author: leco <leco@leco.com> Date: Tue Jan 15 12:31:36 2019 +0800 commit a.txt commit e73cff4891f06c86c59f0fe316902cf829ae17e4 Author: leco <leco@leco.com> Date: Tue Jan 15 12:24:57 2019 +0800 commit a root@k8s4:~/git_test# git reset --hard ccf4d94ce # \u56de\u9000\u5230\u67d0\u4e2a\u7248\u672c\u4e5f\u5c31\u662f\u4e0a\u9762commit\u540e\u9762\u7684\u503c\uff08\u53ef\u4ee5\u53d6\u90e8\u5206\uff09 HEAD is now at ccf4d94 modify a root@k8s4:~/git_test# cat a # \u67e5\u770b\u672c\u5730\u6587\u4ef6\uff0c\u5df2\u7ecf\u56de\u9000\u5230\u67d0\u4e00\u4e2a\u7248\u672c\u6587\u4ef6\u4e86 1 root@k8s4:~/git_test# git status # \u67e5\u770b\u72b6\u6001 On branch master nothing to commit, working directory clean # \u6062\u590d\u67d0\u4e2a\u7248\u672c\u540e\uff0c\u5728\u8fd9\u4e2a\u7248\u672c\u4e4b\u540e\u7684log\u4e5f\u770b\u4e0d\u5230\uff0c\u4f7f\u7528 git reflog\u662f\u67e5\u770b\u6240\u6709\u5386\u53f2\u8bb0\u5f55 root@k8s4:~/git_test# git log commit ccf4d94ce795364ec9157fbdee829cbf2c0108b1 Author: leco <leco@leco.com> Date: Tue Jan 15 12:43:28 2019 +0800 modify a commit 26e567b47ad85ba7ea48e030e8d259bddf3d9b69 Author: leco <leco@leco.com> Date: Tue Jan 15 12:35:04 2019 +0800 rename a.txt to a commit da4a5ddc2a9795ba231e0e8a86dc501b93a63dc9 Author: leco <leco@leco.com> Date: Tue Jan 15 12:31:36 2019 +0800 commit a.txt commit e73cff4891f06c86c59f0fe316902cf829ae17e4 Author: leco <leco@leco.com> Date: Tue Jan 15 12:24:57 2019 +0800 commit a root@k8s4:~/git_test# git reflog ccf4d94 HEAD@{0}: reset: moving to ccf4d94ce 1afadfd HEAD@{1}: commit: modify a second ccf4d94 HEAD@{2}: commit: modify a 26e567b HEAD@{3}: commit: rename a.txt to a da4a5dd HEAD@{4}: commit: commit a.txt e73cff4 HEAD@{5}: commit (initial): commit a root@k8s4:~/git_test# git reset --hard 1afadfd # \u56de\u9000\u5230\u67d0\u4e2a\u7248\u672c HEAD is now at 1afadfd modify a second root@k8s4:~/git_test# cat a 1 bbb","title":"3.\u672c\u5730\u4fee\u6539\u540e\u63d0\u4ea4\u5230\u7f13\u5b58\u533a\u540e\u7136\u540e\u518d\u63d0\u4ea4\u5230\u672c\u5730\u4ed3\u5e93\u540e\u6062\u590d"},{"location":"tools/git/git.standard/","text":"Git\u5206\u652f\u7ba1\u7406\u89c4\u8303 1. \u5206\u652f\u4e0e\u89d2\u8272\u8bf4\u660e \u00b6 master \u5206\u652f\uff08\u4e3b\u5206\u652f\uff09 \u7a33\u5b9a\u7248\u672c develop \u5206\u652f\uff08\u5f00\u53d1\u5206\u652f\uff09 \u6700\u65b0\u7248\u672c release \u5206\u652f\uff08\u53d1\u5e03\u5206\u652f\uff09 \u53d1\u5e03\u65b0\u7248\u672c hotfix \u5206\u652f\uff08\u70ed\u4fee\u590d\u5206\u652f\uff09 \u4fee\u590d\u7ebf\u4e0aBug feature \u5206\u652f\uff08\u7279\u6027\u5206\u652f\uff09 \u5b9e\u73b0\u65b0\u7279\u6027 Gitlab \u89d2\u8272\u4e0e\u9879\u76ee\u89d2\u8272\u5bf9\u5e94\u5173\u7cfb Owner\uff08\u62e5\u6709\u8005\uff09 Git \u7ba1\u7406\u5458 Master\uff08\u7ba1\u7406\u5458\uff09 \u5f00\u53d1\u4e3b\u7ba1 Developer\uff08\u5f00\u53d1\u8005\uff09 \u5f00\u53d1\u4eba\u5458 Reporter\uff08\u62a5\u544a\u8005\uff09 \u6d4b\u8bd5\u4eba\u5458 Guest\uff08\u89c2\u5bdf\u8005\uff09 \u5176\u4ed6\u4eba\u5458 2. \u5206\u652f\u7b80\u660e\u4f7f\u7528\u6d41\u7a0b \u00b6 1\u3001\u6bcf\u5f00\u53d1\u4e00\u4e2a\u65b0\u529f\u80fd\uff0c\u521b\u5efa\u4e00\u4e2a feature \u5206\u652f\uff0c\u591a\u4eba\u5728\u6b64\u5206\u652f\u4e0a\u5f00\u53d1 2\u3001\u63d0\u6d4b\u65f6\uff0c\u5c06 master \u5206\u652f\u548c\u9700\u8981\u63d0\u6d4b\u7684\u5206\u652f\u6c47\u603b\u5230\u4e00\u4e2a release \u5206\u652f\uff0c\u53d1\u5e03\u6d4b\u8bd5\u73af\u5883 3\u3001\u53d1\u73b0bug\u65f6\uff0c\u5728feature\u5206\u652f\u4e0adebug\u540e\uff0c\u518d\u6b21\u56de\u52302 4\u3001\u53d1\u5e03\u751f\u4ea7\u73af\u5883\u540e\uff0c\u5c06 release \u5206\u652f\u5408\u5e76\u5230 master \u5206\u652f\uff0c\u5220\u9664release\u5206\u652f 3. \u521b\u5efa\u65b0\u9879\u76ee\uff08master\u5206\u652f\uff09 \u00b6 \u5f00\u53d1\u4e3b\u7ba1\u63d0\u4ea4\u4ee3\u7801\u521d\u59cb\u7248\u672c\u5230master \u5206\u652f\uff0c\u5e76\u63a8\u9001\u81f3Gitlab\u7cfb\u7edf \u5f00\u53d1\u4e3b\u7ba1\u5728Gitlab \u7cfb\u7edf\u4e2d\u8bbe\u7f6emaster \u5206\u652f\u4e3aProtectd \u5206\u652f\uff08\u4fdd\u62a4\u5206\u652f\uff09 Protected \u5206\u652f\u4e0d\u5141\u8bb8Developer \u89d2\u8272\u63a8\u9001\u4ee3\u7801\uff0c\u4f46Master \u89d2\u8272\u53ef\u4ee5\u63a8\u9001\u4ee3\u7801 4. \u8fdb\u884c\u9879\u76ee\u5f00\u53d1\uff08develop\u5206\u652f\uff09 \u00b6 \u5f00\u53d1\u4e3b\u7ba1\u5728master \u5206\u652f\u4e0a\u521b\u5efadevelop \u5206\u652f\uff08\u5f00\u53d1\u5206\u652f\uff09\uff0c\u5e76\u63a8\u9001\u81f3Gitlab\u7cfb\u7edf\uff1b master \u5206\u652f\u4e0edevelop \u5206\u652f\u4e00\u6837\uff0c\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\uff1b \u5bf9\u4e8e\u975e\u5e76\u884c\u9879\u76ee\u53ef\u4ee5\u4f7f\u7528develop\u5206\u652f\u5f00\u53d1\u65b9\u5f0f\uff0c\u5bf9\u4e8e\u591a\u4eba\u5e76\u884c\u5f00\u53d1\u9879\u76ee\uff0c\u4f7f\u7528feature\u5206\u652f\u5f00\u53d1\u65b9\u5f0f\uff0c\u4f46develop\u548cfeature\u5f00\u53d1\u65b9\u5f0f\u4e0d\u5e94\u540c\u65f6\u4f7f\u7528 5. \u5f00\u53d1\u65b0\u7279\u6027\uff08feature\u5206\u652f\uff09 \u00b6 \u6bcf\u4e2a\u65b0\u9700\u6c42\u6216\u65b0\u7684\u7814\u7a76\u521b\u5efa\u4e00\u4e2afeature \u5206\u652f\uff1b \u547d\u540d\u89c4\u8303\uff1a f-\u5206\u652f\u521b\u5efa\u65e5\u671f-\u65b0\u7279\u6027\u5173\u952e\u5b57\uff0c\u4f8b\u5982\uff1af-20150508-\u6ee1\u7acb\u51cf \u63a8\u8350\u4f7f\u7528feature \u5206\u652f\uff0c\u4f46feature \u5206\u652f\u7684\u751f\u547d\u5468\u671f\u4e0d\u80fd\u8de8\u4e00\u6b21\u8fed\u4ee3 6. \u53d1\u5e03\u6d4b\u8bd5\u73af\u5883\uff08release\u5206\u652f\uff09 \u00b6 \u5f00\u53d1\u8d1f\u8d23\u4eba\u9700\u5b8c\u6210\u4ee5\u4e0b\u4efb\u52a1\uff1a 1. \u786e\u8ba4\u8981\u53d1\u5e03\u7684feature \u5206\u652f\u4e0a\u7684\u529f\u80fd\u662f\u5426\u5f00\u53d1\u5b8c\u6bd5\u5e76\u63d0\u4ea4\uff1b 2. \u521b\u5efarelease \u5206\u652f\uff08\u53d1\u5e03\u5206\u652f\uff09\uff0c\u5c06\u6240\u6709\u8981\u53d1\u5e03\u7684\u5206\u652f\u9010\u4e2a\u5408\u5e76\u5230release\u5206\u652f\uff0c\u6709\u5982\u4e0b\u60c5\u51b5\uff1a \u2460.feature\u5206\u652f\uff08\u53ef\u80fd\u6709\u591a\u4e2a\uff09 \u2461.master\u5206\u652f\uff08\u671f\u95f4\u53ef\u80fd\u6709\u5176\u4ed6release\u7248\u672c\u66f4\u65b0\u5230\u4e86master\uff09 3. \u547d\u540d\u89c4\u5219\uff1ar-\u5206\u652f\u521b\u5efa\u65e5\u671f-\u65b0\u7279\u6027\u548c\u5f85\u53d1\u5e03\u7248\u672c\u53f7\uff0c\u4f8b\u5982\uff1ar-201505081712-\u4e70\u7acb\u51cfv1.0.0\uff0c\u7248\u672c\u53ef\u6839\u636e\u9700\u8981\u6dfb\u52a0; 4. \u5220\u9664\u672c\u6b21\u53d1\u5e03\u7684\u6240\u6709feature\u5206\u652f; 5. \u53d1\u5e03\u5230\u6d4b\u8bd5\u73af\u5883\uff0c\u901a\u77e5\u6d4b\u8bd5; 7. \u4fee\u590d\u5f85\u53d1\u5e03\u7248\u672c\u4e2d\u7684Bug\uff08feature\u5206\u652f\uff09 \u00b6 \u5982\u679c\u53d1\u73b0bug\uff0c\u5f00\u53d1\u4eba\u5458\u5728feature \u5206\u652f\u4e0a\u4fee\u590d\u6d4b\u8bd5\u4eba\u5458\u63d0\u4ea4\u7ed9\u81ea\u5df1\u7684bug\uff0c\u4fee\u590d\u5b8c\u6210\u540e\uff0c\u7531\u8d1f\u8d23\u4eba\u518d\u6b21\u521b\u5efa release \u5206\u652f\uff0c\u53d1\u5e03\u6d4b\u8bd5\u73af\u5883\u3002 8. \u53d1\u5e03\u6b63\u5f0f\u73af\u5883 \u00b6 \u5f00\u53d1\u8d1f\u8d23\u4eba\u9700\u5b8c\u6210\u4ee5\u4e0b\u4efb\u52a1\uff1a 1. \u6839\u636e\u4fee\u590d\u540e\u7684release\u5206\u652f\u518d\u6b21\u5c06master\u5408\u5e76\uff0c\u6253\u5305\u53d1\u5e03\u751f\u4ea7\u73af\u5883; 2. \u786e\u8ba4\u53d1\u5e03\u6210\u529f\uff0c\u5e76\u7ebf\u4e0a\u9a8c\u6536\u901a\u8fc7\u540e\uff0c\u5c06release\u5206\u652f\u5408\u5e76\u5230master\u5206\u652f; 3. \u5728master\u5206\u652f\u4e0a\u521b\u5efa\u6807\u7b7e\uff0c\u547d\u540d\u89c4\u5219\uff1atag-\u65e5\u671f-\u65b0\u7279\u6027\u548c\u7248\u672c\u53f7\uff0c\u4f8b\u5982\uff1atag-201505081712-\u4e70\u7acb\u51cfv1.0.0\uff0c\u7248\u672c\u53ef\u6839\u636e\u9700\u8981\u6dfb\u52a0\uff0c\u4f5c\u4e3a\u53d1\u7248\u91cc\u7a0b\u7891\u6807\u8bb0; 4. \u5220\u9664\u5bf9\u5e94release \u5206\u652f; 9. \u4fee\u590d\u7ebf\u4e0aBug\uff08hotfix\u5206\u652f\uff09 \u00b6 \u7ebf\u4e0a\u7684\u4e0d\u540c\u7248\u672c\u51fa\u73b0\u4e86bug\u600e\u4e48\u529e\uff1f\u5f00\u53d1\u8d1f\u8d23\u4eba\u9700\u5b8c\u6210\u4ee5\u4e0b\u4efb\u52a1\uff1a 1. \u4ecemaster \u5206\u652f\u67d0\u4e2atag \u4e0a\u521b\u5efa\u4e00\u4e2ahotfix \u5206\u652f\uff08\u70ed\u4fee\u590d\u5206\u652f\uff09\uff0c\u4e00\u822c\u662f\u6700\u65b0\u7684tag\u5e94\u8be5\u548c\u5f53\u524d\u751f\u4ea7\u73af\u5883\u5bf9\u5e94\uff1b \u547d\u540d\u89c4\u5219\uff1ah-\u5206\u652f\u521b\u5efa\u65e5\u671f-bug\u540d\u79f0\u548c\u5f85\u53d1\u5e03\u7248\u672c\u53f7\uff0c\u4f8b\u5982\uff1ah-201705081614-\u8d2d\u7269\u8f66\u70b9\u51fb\u6ca1\u53cd\u5e94v1.0.1; 2. \u5f00\u53d1\u4eba\u5458\u5b8c\u6210Bug \u4fee\u590d\uff0c\u63d0\u4ea4hotfix\u5206\u652f\u5230\u6d4b\u8bd5\u73af\u5883\u9a8c\u6536\u901a\u8fc7; 3. \u518d\u6b21\u53d1\u5e03\u6b63\u5f0f\u73af\u5883\u6d41\u7a0b; 4. \u5c06hotfix \u5206\u652f\u5408\u5e76\u5230master\u5206\u652f; 5. \u5728master\u5206\u652f\u4e0a\u521b\u5efa\u6807\u7b7e\uff0c\u547d\u540d\u89c4\u5219\uff1atag-\u65e5\u671f-\u65b0\u7279\u6027\u548c\u7248\u672c\u53f7\uff0c\u4f8b\u5982\uff1atag-201505081712-\u4e70\u7acb\u51cfv1.0.0\uff0c\u7248\u672c\u53ef\u6839\u636e\u9700\u8981\u6dfb\u52a0\uff0c\u4f5c\u4e3a\u53d1\u7248\u91cc\u7a0b\u7891\u6807\u8bb0; 6. \u5220\u9664hotfix \u5206\u652f; 10.Git \u7684\u7279\u522b\u6ce8\u610f\u4e8b\u9879 \u00b6 \u7531\u4e8e git \u5206\u652f\u662f\u57fa\u4e8e\u6307\u9488\u7684\u6982\u5ff5\uff0c\u6240\u4ee5\u5206\u652f\u901f\u5ea6\u975e\u5e38\u5feb\uff0c\u5f53\u591a\u4e2a\u5206\u652f\u65f6\uff0c\u5b9e\u9645\u6307\u9488\u6307\u5411\u7684\u662f\u540c\u4e00\u4e2a\u6587\u4ef6\uff0c\u5f53\u6587\u4ef6\u88ab\u4fee\u6539\u65f6\uff0c\u4f7f\u7528\u7684\u662f\u6682\u5b58\u533a\u4fdd\u5b58\u4fee\u6539\uff0c\u6b64\u65f6\u5e76\u672a\u63d0\u4ea4\u5230\u76f8\u5e94\u5206\u652f\u3002 \u6240\u4ee5\u5207\u6362\u5206\u652f\u7684\u65f6\u5019\uff0c\u6682\u5b58\u533a\u53ea\u6709\u4e00\u4e2a\uff0c\u6240\u4ee5\u5207\u6362\u5206\u652f\u4e4b\u524d\uff0c\u4e00\u5b9a\u8981\u5c06\u6240\u6709\u4fee\u6539commit\u5230\u5f53\u524d\u5206\u652f\uff0c\u5426\u5219\u4f1a\u5728\u5176\u4ed6\u5206\u652f\u770b\u5230\u4fee\u6539\u7684\u5185\u5bb9\uff0c\u5f15\u8d77\u8bef\u89e3\u3002","title":"5. git \u5206\u652f\u7ba1\u7406"},{"location":"tools/git/git.standard/#1","text":"master \u5206\u652f\uff08\u4e3b\u5206\u652f\uff09 \u7a33\u5b9a\u7248\u672c develop \u5206\u652f\uff08\u5f00\u53d1\u5206\u652f\uff09 \u6700\u65b0\u7248\u672c release \u5206\u652f\uff08\u53d1\u5e03\u5206\u652f\uff09 \u53d1\u5e03\u65b0\u7248\u672c hotfix \u5206\u652f\uff08\u70ed\u4fee\u590d\u5206\u652f\uff09 \u4fee\u590d\u7ebf\u4e0aBug feature \u5206\u652f\uff08\u7279\u6027\u5206\u652f\uff09 \u5b9e\u73b0\u65b0\u7279\u6027 Gitlab \u89d2\u8272\u4e0e\u9879\u76ee\u89d2\u8272\u5bf9\u5e94\u5173\u7cfb Owner\uff08\u62e5\u6709\u8005\uff09 Git \u7ba1\u7406\u5458 Master\uff08\u7ba1\u7406\u5458\uff09 \u5f00\u53d1\u4e3b\u7ba1 Developer\uff08\u5f00\u53d1\u8005\uff09 \u5f00\u53d1\u4eba\u5458 Reporter\uff08\u62a5\u544a\u8005\uff09 \u6d4b\u8bd5\u4eba\u5458 Guest\uff08\u89c2\u5bdf\u8005\uff09 \u5176\u4ed6\u4eba\u5458","title":"1. \u5206\u652f\u4e0e\u89d2\u8272\u8bf4\u660e"},{"location":"tools/git/git.standard/#2","text":"1\u3001\u6bcf\u5f00\u53d1\u4e00\u4e2a\u65b0\u529f\u80fd\uff0c\u521b\u5efa\u4e00\u4e2a feature \u5206\u652f\uff0c\u591a\u4eba\u5728\u6b64\u5206\u652f\u4e0a\u5f00\u53d1 2\u3001\u63d0\u6d4b\u65f6\uff0c\u5c06 master \u5206\u652f\u548c\u9700\u8981\u63d0\u6d4b\u7684\u5206\u652f\u6c47\u603b\u5230\u4e00\u4e2a release \u5206\u652f\uff0c\u53d1\u5e03\u6d4b\u8bd5\u73af\u5883 3\u3001\u53d1\u73b0bug\u65f6\uff0c\u5728feature\u5206\u652f\u4e0adebug\u540e\uff0c\u518d\u6b21\u56de\u52302 4\u3001\u53d1\u5e03\u751f\u4ea7\u73af\u5883\u540e\uff0c\u5c06 release \u5206\u652f\u5408\u5e76\u5230 master \u5206\u652f\uff0c\u5220\u9664release\u5206\u652f","title":"2. \u5206\u652f\u7b80\u660e\u4f7f\u7528\u6d41\u7a0b"},{"location":"tools/git/git.standard/#3-master","text":"\u5f00\u53d1\u4e3b\u7ba1\u63d0\u4ea4\u4ee3\u7801\u521d\u59cb\u7248\u672c\u5230master \u5206\u652f\uff0c\u5e76\u63a8\u9001\u81f3Gitlab\u7cfb\u7edf \u5f00\u53d1\u4e3b\u7ba1\u5728Gitlab \u7cfb\u7edf\u4e2d\u8bbe\u7f6emaster \u5206\u652f\u4e3aProtectd \u5206\u652f\uff08\u4fdd\u62a4\u5206\u652f\uff09 Protected \u5206\u652f\u4e0d\u5141\u8bb8Developer \u89d2\u8272\u63a8\u9001\u4ee3\u7801\uff0c\u4f46Master \u89d2\u8272\u53ef\u4ee5\u63a8\u9001\u4ee3\u7801","title":"3. \u521b\u5efa\u65b0\u9879\u76ee\uff08master\u5206\u652f\uff09"},{"location":"tools/git/git.standard/#4-develop","text":"\u5f00\u53d1\u4e3b\u7ba1\u5728master \u5206\u652f\u4e0a\u521b\u5efadevelop \u5206\u652f\uff08\u5f00\u53d1\u5206\u652f\uff09\uff0c\u5e76\u63a8\u9001\u81f3Gitlab\u7cfb\u7edf\uff1b master \u5206\u652f\u4e0edevelop \u5206\u652f\u4e00\u6837\uff0c\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\uff1b \u5bf9\u4e8e\u975e\u5e76\u884c\u9879\u76ee\u53ef\u4ee5\u4f7f\u7528develop\u5206\u652f\u5f00\u53d1\u65b9\u5f0f\uff0c\u5bf9\u4e8e\u591a\u4eba\u5e76\u884c\u5f00\u53d1\u9879\u76ee\uff0c\u4f7f\u7528feature\u5206\u652f\u5f00\u53d1\u65b9\u5f0f\uff0c\u4f46develop\u548cfeature\u5f00\u53d1\u65b9\u5f0f\u4e0d\u5e94\u540c\u65f6\u4f7f\u7528","title":"4. \u8fdb\u884c\u9879\u76ee\u5f00\u53d1\uff08develop\u5206\u652f\uff09"},{"location":"tools/git/git.standard/#5-feature","text":"\u6bcf\u4e2a\u65b0\u9700\u6c42\u6216\u65b0\u7684\u7814\u7a76\u521b\u5efa\u4e00\u4e2afeature \u5206\u652f\uff1b \u547d\u540d\u89c4\u8303\uff1a f-\u5206\u652f\u521b\u5efa\u65e5\u671f-\u65b0\u7279\u6027\u5173\u952e\u5b57\uff0c\u4f8b\u5982\uff1af-20150508-\u6ee1\u7acb\u51cf \u63a8\u8350\u4f7f\u7528feature \u5206\u652f\uff0c\u4f46feature \u5206\u652f\u7684\u751f\u547d\u5468\u671f\u4e0d\u80fd\u8de8\u4e00\u6b21\u8fed\u4ee3","title":"5. \u5f00\u53d1\u65b0\u7279\u6027\uff08feature\u5206\u652f\uff09"},{"location":"tools/git/git.standard/#6-release","text":"\u5f00\u53d1\u8d1f\u8d23\u4eba\u9700\u5b8c\u6210\u4ee5\u4e0b\u4efb\u52a1\uff1a 1. \u786e\u8ba4\u8981\u53d1\u5e03\u7684feature \u5206\u652f\u4e0a\u7684\u529f\u80fd\u662f\u5426\u5f00\u53d1\u5b8c\u6bd5\u5e76\u63d0\u4ea4\uff1b 2. \u521b\u5efarelease \u5206\u652f\uff08\u53d1\u5e03\u5206\u652f\uff09\uff0c\u5c06\u6240\u6709\u8981\u53d1\u5e03\u7684\u5206\u652f\u9010\u4e2a\u5408\u5e76\u5230release\u5206\u652f\uff0c\u6709\u5982\u4e0b\u60c5\u51b5\uff1a \u2460.feature\u5206\u652f\uff08\u53ef\u80fd\u6709\u591a\u4e2a\uff09 \u2461.master\u5206\u652f\uff08\u671f\u95f4\u53ef\u80fd\u6709\u5176\u4ed6release\u7248\u672c\u66f4\u65b0\u5230\u4e86master\uff09 3. \u547d\u540d\u89c4\u5219\uff1ar-\u5206\u652f\u521b\u5efa\u65e5\u671f-\u65b0\u7279\u6027\u548c\u5f85\u53d1\u5e03\u7248\u672c\u53f7\uff0c\u4f8b\u5982\uff1ar-201505081712-\u4e70\u7acb\u51cfv1.0.0\uff0c\u7248\u672c\u53ef\u6839\u636e\u9700\u8981\u6dfb\u52a0; 4. \u5220\u9664\u672c\u6b21\u53d1\u5e03\u7684\u6240\u6709feature\u5206\u652f; 5. \u53d1\u5e03\u5230\u6d4b\u8bd5\u73af\u5883\uff0c\u901a\u77e5\u6d4b\u8bd5;","title":"6. \u53d1\u5e03\u6d4b\u8bd5\u73af\u5883\uff08release\u5206\u652f\uff09"},{"location":"tools/git/git.standard/#7-bugfeature","text":"\u5982\u679c\u53d1\u73b0bug\uff0c\u5f00\u53d1\u4eba\u5458\u5728feature \u5206\u652f\u4e0a\u4fee\u590d\u6d4b\u8bd5\u4eba\u5458\u63d0\u4ea4\u7ed9\u81ea\u5df1\u7684bug\uff0c\u4fee\u590d\u5b8c\u6210\u540e\uff0c\u7531\u8d1f\u8d23\u4eba\u518d\u6b21\u521b\u5efa release \u5206\u652f\uff0c\u53d1\u5e03\u6d4b\u8bd5\u73af\u5883\u3002","title":"7. \u4fee\u590d\u5f85\u53d1\u5e03\u7248\u672c\u4e2d\u7684Bug\uff08feature\u5206\u652f\uff09"},{"location":"tools/git/git.standard/#8","text":"\u5f00\u53d1\u8d1f\u8d23\u4eba\u9700\u5b8c\u6210\u4ee5\u4e0b\u4efb\u52a1\uff1a 1. \u6839\u636e\u4fee\u590d\u540e\u7684release\u5206\u652f\u518d\u6b21\u5c06master\u5408\u5e76\uff0c\u6253\u5305\u53d1\u5e03\u751f\u4ea7\u73af\u5883; 2. \u786e\u8ba4\u53d1\u5e03\u6210\u529f\uff0c\u5e76\u7ebf\u4e0a\u9a8c\u6536\u901a\u8fc7\u540e\uff0c\u5c06release\u5206\u652f\u5408\u5e76\u5230master\u5206\u652f; 3. \u5728master\u5206\u652f\u4e0a\u521b\u5efa\u6807\u7b7e\uff0c\u547d\u540d\u89c4\u5219\uff1atag-\u65e5\u671f-\u65b0\u7279\u6027\u548c\u7248\u672c\u53f7\uff0c\u4f8b\u5982\uff1atag-201505081712-\u4e70\u7acb\u51cfv1.0.0\uff0c\u7248\u672c\u53ef\u6839\u636e\u9700\u8981\u6dfb\u52a0\uff0c\u4f5c\u4e3a\u53d1\u7248\u91cc\u7a0b\u7891\u6807\u8bb0; 4. \u5220\u9664\u5bf9\u5e94release \u5206\u652f;","title":"8. \u53d1\u5e03\u6b63\u5f0f\u73af\u5883"},{"location":"tools/git/git.standard/#9-bughotfix","text":"\u7ebf\u4e0a\u7684\u4e0d\u540c\u7248\u672c\u51fa\u73b0\u4e86bug\u600e\u4e48\u529e\uff1f\u5f00\u53d1\u8d1f\u8d23\u4eba\u9700\u5b8c\u6210\u4ee5\u4e0b\u4efb\u52a1\uff1a 1. \u4ecemaster \u5206\u652f\u67d0\u4e2atag \u4e0a\u521b\u5efa\u4e00\u4e2ahotfix \u5206\u652f\uff08\u70ed\u4fee\u590d\u5206\u652f\uff09\uff0c\u4e00\u822c\u662f\u6700\u65b0\u7684tag\u5e94\u8be5\u548c\u5f53\u524d\u751f\u4ea7\u73af\u5883\u5bf9\u5e94\uff1b \u547d\u540d\u89c4\u5219\uff1ah-\u5206\u652f\u521b\u5efa\u65e5\u671f-bug\u540d\u79f0\u548c\u5f85\u53d1\u5e03\u7248\u672c\u53f7\uff0c\u4f8b\u5982\uff1ah-201705081614-\u8d2d\u7269\u8f66\u70b9\u51fb\u6ca1\u53cd\u5e94v1.0.1; 2. \u5f00\u53d1\u4eba\u5458\u5b8c\u6210Bug \u4fee\u590d\uff0c\u63d0\u4ea4hotfix\u5206\u652f\u5230\u6d4b\u8bd5\u73af\u5883\u9a8c\u6536\u901a\u8fc7; 3. \u518d\u6b21\u53d1\u5e03\u6b63\u5f0f\u73af\u5883\u6d41\u7a0b; 4. \u5c06hotfix \u5206\u652f\u5408\u5e76\u5230master\u5206\u652f; 5. \u5728master\u5206\u652f\u4e0a\u521b\u5efa\u6807\u7b7e\uff0c\u547d\u540d\u89c4\u5219\uff1atag-\u65e5\u671f-\u65b0\u7279\u6027\u548c\u7248\u672c\u53f7\uff0c\u4f8b\u5982\uff1atag-201505081712-\u4e70\u7acb\u51cfv1.0.0\uff0c\u7248\u672c\u53ef\u6839\u636e\u9700\u8981\u6dfb\u52a0\uff0c\u4f5c\u4e3a\u53d1\u7248\u91cc\u7a0b\u7891\u6807\u8bb0; 6. \u5220\u9664hotfix \u5206\u652f;","title":"9. \u4fee\u590d\u7ebf\u4e0aBug\uff08hotfix\u5206\u652f\uff09"},{"location":"tools/git/git.standard/#10git","text":"\u7531\u4e8e git \u5206\u652f\u662f\u57fa\u4e8e\u6307\u9488\u7684\u6982\u5ff5\uff0c\u6240\u4ee5\u5206\u652f\u901f\u5ea6\u975e\u5e38\u5feb\uff0c\u5f53\u591a\u4e2a\u5206\u652f\u65f6\uff0c\u5b9e\u9645\u6307\u9488\u6307\u5411\u7684\u662f\u540c\u4e00\u4e2a\u6587\u4ef6\uff0c\u5f53\u6587\u4ef6\u88ab\u4fee\u6539\u65f6\uff0c\u4f7f\u7528\u7684\u662f\u6682\u5b58\u533a\u4fdd\u5b58\u4fee\u6539\uff0c\u6b64\u65f6\u5e76\u672a\u63d0\u4ea4\u5230\u76f8\u5e94\u5206\u652f\u3002 \u6240\u4ee5\u5207\u6362\u5206\u652f\u7684\u65f6\u5019\uff0c\u6682\u5b58\u533a\u53ea\u6709\u4e00\u4e2a\uff0c\u6240\u4ee5\u5207\u6362\u5206\u652f\u4e4b\u524d\uff0c\u4e00\u5b9a\u8981\u5c06\u6240\u6709\u4fee\u6539commit\u5230\u5f53\u524d\u5206\u652f\uff0c\u5426\u5219\u4f1a\u5728\u5176\u4ed6\u5206\u652f\u770b\u5230\u4fee\u6539\u7684\u5185\u5bb9\uff0c\u5f15\u8d77\u8bef\u89e3\u3002","title":"10.Git \u7684\u7279\u522b\u6ce8\u610f\u4e8b\u9879"},{"location":"tools/github/github.index/","text":"GitHub Hub\u662f\u4e00\u4e2a\u9762\u5411\u5f00\u6e90\u53ca\u79c1\u6709\u8f6f\u4ef6\u9879\u76ee\u7684\u6258\u7ba1\u5e73\u53f0\uff0c\u56e0\u4e3a\u53ea\u652f\u6301git \u4f5c\u4e3a\u552f\u4e00\u7684\u7248\u672c\u5e93\u683c\u5f0f\u8fdb\u884c\u6258\u7ba1\uff0c\u6545\u540dgitHub\u3002 gitHub\u4e8e2008\u5e744\u670810\u65e5\u6b63\u5f0f\u4e0a\u7ebf\uff0c\u9664\u4e86git\u4ee3\u7801\u4ed3\u5e93\u6258\u7ba1\u53ca\u57fa\u672c\u7684 Web\u7ba1\u7406\u754c\u9762\u4ee5\u5916\uff0c\u8fd8\u63d0\u4f9b\u4e86\u8ba2\u9605\u3001\u8ba8\u8bba\u7ec4\u3001\u6587\u672c\u6e32\u67d3\u3001\u5728\u7ebf\u6587\u4ef6\u7f16\u8f91\u5668\u3001\u534f\u4f5c\u56fe\u8c31\uff08\u62a5\u8868\uff09\u3001\u4ee3\u7801\u7247\u6bb5\u5206\u4eab\uff08Gist\uff09\u7b49\u529f\u80fd\u3002\u76ee\u524d\uff0c\u5176\u6ce8\u518c\u7528\u6237\u5df2\u7ecf\u8d85\u8fc7350\u4e07\uff0c\u6258\u7ba1\u7248\u672c\u6570\u91cf\u4e5f\u662f\u975e\u5e38\u4e4b\u591a\uff0c\u5176\u4e2d\u4e0d\u4e4f\u77e5\u540d\u5f00\u6e90\u9879\u76ee Ruby on Rails\u3001jQuery\u3001python \u7b49\u3002 2018\u5e746\u67084\u65e5\uff0c\u5fae\u8f6f\u5ba3\u5e03\uff0c\u901a\u8fc775\u4ebf\u7f8e\u5143\u7684\u80a1\u7968\u4ea4\u6613\u6536\u8d2d\u4ee3\u7801\u6258\u7ba1\u5e73\u53f0GitHub\u3002 git\u4f7f\u7528 github\u4f7f\u7528 Github\u5b98\u7f51 - \u6ce8\u518c\u7528\u6237 - \u914d\u7f6essh-key - \u521b\u5efa\u9879\u76ee - \u514b\u9686\u9879\u76ee\u5230\u672c\u5730 - \u63a8\u9001\u4fee\u6539\u5230\u8fdc\u7a0b \u672c\u5730\u4ed3\u5e93\u5173\u8054\u8fdc\u7a0b\uff08github\uff09\u4ed3\u5e93\uff0c\u5e76\u628a\u672c\u5730\u4ed3\u5e93\u5185\u5bb9\u63a8\u9001\u5230\u8fdc\u7a0b\u4ed3\u5e93\u4e0a \u8be6\u7ec6\u65b9\u6cd5 \u672c\u5730\u65b0\u521b\u5efa\u4ed3\u5e93 \u672c\u5730\u5df2\u7ecf\u5b58\u5728\u4ed3\u5e93 \u2026or create a new repository on the command line echo \"# git\" >> README.md git init git add README.md git commit -m \"first commit\" git remote add origin git@github.com:caimengzhi/git.git git push -u origin master \u2026or push an existing repository from the command line git remote add origin git@github.com:caimengzhi/git.git git push -u origin master \u53ea\u6f14\u793a\u672c\u5730\u5b58\u5728\u7684\u4ed3\u5e93\u63a8\u5230\u5230github root@k8s4:~/git_test# git status On branch master nothing to commit, working directory clean root@k8s4:~/git_test# ls a b master test \u5173\u8054\u672c\u5730\u4ed3\u5e93\u548c\u8fdc\u7a0b\u4ed3\u5e93 root@k8s4:~/git_test# git remote add origin git@github.com:caimengzhi/git.git | |______________________________ \u8fdc\u7a0b\u4ed3\u5e93\u5730\u5740(github) |__________________________________________ \u8fdc\u7a0b\u4ed3\u5e93\u540d\u5b57 root@k8s4:~/git_test# git remote origin \u628a\u81ea\u5df1\u7684\u516c\u7ea6\u7ed1\u5b9a\u5230github root@k8s4:~/git_test# ssh-keygen -t rsa Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): /root/.ssh/id_rsa already exists. Overwrite (y/n)? y Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.ssh/id_rsa. Your public key has been saved in /root/.ssh/id_rsa.pub. The key fingerprint is: SHA256:Q/ctxUTf8bzz8VhNNpdIFV8vS1R2yAZ+9z1iUvLXczw root@k8s4 The key's randomart image is: +---[RSA 2048]----+ | .==**| | ..+=+X| | . ...+*o%| | . . .+= BO| | S .o+oEO| | . o.ooX| | . o| | | | | +----[SHA256]-----+ root@k8s4:~/git_test# ls /root/.ssh/id_rsa /root/.ssh/id_rsa root@k8s4:~/git_test# cat /root/.ssh//id_rsa.pub ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDdW9wXBlVkMGVjoBPK+TKC8+k8XDmzaZA1lHEGTv2T2NgmETIGLXsj2JzFcT600k8isLcwuPBTE1Sntm0829sbMtBaPjseFO7LAN64vWyXxEVyoRx1l4wM3zHMvBLlgb2Og5YzEhBd3rRPEAZlTq6vKeiJghkngDAHKA/0fk4oOiIHBB9p39EsBioi4EhIhvinie6LI0iGOZPQbrbGMnKOCIDzkN8WXtkIWS9VCwN88BGdgROYrJxcZFO7S5her6sjgBNvILw3uBhfGDwVtARtaFRwXG4TmK1n1OIoTE1LCEjNZwTq6bVkJvxDLQco2WcM9R4qcVrCrmokqVXaeYGn root@k8s4 \u63a8\u9001 root@k8s4:~/git_test# git push -u origin master Counting objects: 29, done. Delta compression using up to 4 threads. Compressing objects: 100% (19/19), done. Writing objects: 100% (29/29), 2.38 KiB | 0 bytes/s, done. Total 29 (delta 3), reused 0 (delta 0) remote: Resolving deltas: 100% (3/3), done. To git@github.com:caimengzhi/git.git * [new branch] master -> master Branch master set up to track remote branch master from origin. \u4ea7\u770bgithub\u4ed3\u5e93\u4e0a\u662f\u5426\u6709\u6570\u636e \u514b\u9686\u8fdc\u7a0b\u4ed3\u5e93\u6570\u636e root@k8s4:~/git_test# cd /opt/ root@k8s4:/opt# ls root@k8s4:/opt# git clone https://github.com/caimengzhi/git.git Cloning into 'git'... # \u56e0\u4e3a\u662f\u79c1\u6709\u4ed3\u5e93\u6240\u4ee5\u8981\u8f93\u5165github\u7684\u8d26\u53f7\u548c\u5bc6\u7801\uff0c\u624d\u80fdclone\u4e0b\u6765\uff0c Username for 'https://github.com': xxx # \u8fd9\u4e2a\u5730\u65b9\u8f93\u5165github\u8d26\u53f7 Password for 'https://caimengzhi@github.com': # github\u5bc6\u7801 remote: Enumerating objects: 29, done. remote: Counting objects: 100% (29/29), done. remote: Compressing objects: 100% (16/16), done. remote: Total 29 (delta 3), reused 29 (delta 3), pack-reused 0 Unpacking objects: 100% (29/29), done. Checking connectivity... done. root@k8s4:/opt# ls git root@k8s4:/opt# cd git/ root@k8s4:/opt/git# ls a b master test \u522b\u7684\u5176\u4ed6clone - \u8981\u52a0\u8d26\u53f7 [root@leco git]# git clone https://caimengzhi@github.com/caimengzhi/git.git Initialized empty Git repository in /opt/git/git/.git/ Password: # \u6b64\u5730\u65b9\u8981\u8f93\u5165\u5bc6\u7801 remote: Enumerating objects: 29, done. remote: Counting objects: 100% (29/29), done. remote: Compressing objects: 100% (16/16), done. remote: Total 29 (delta 3), reused 29 (delta 3), pack-reused 0 Unpacking objects: 100% (29/29), done. [root@leco git]# pwd /opt/git [root@leco git]# ls git [root@leco git]# tree . \u2514\u2500\u2500 git \u251c\u2500\u2500 a \u251c\u2500\u2500 b \u251c\u2500\u2500 master \u2514\u2500\u2500 test 1 directory, 4 files [root@leco git]# git remote origin \u672c\u5730\u4fee\u6539\u540e\u63a8\u9001 root@k8s4:/opt/git# touch c root@k8s4:/opt/git# git add . root@k8s4:/opt/git# git commit -m 'commit c' [master d381f99] commit c 1 file changed, 0 insertions(+), 0 deletions(-) create mode 100644 c root@k8s4:/opt/git# git push origin master Username for 'https://github.com': # \u8f93\u5165github\u8d26\u53f7 Password for 'https://caimengzhi@github.com': # \u8f93\u5165github\u5bc6\u7801 Counting objects: 2, done. Delta compression using up to 4 threads. Compressing objects: 100% (2/2), done. Writing objects: 100% (2/2), 207 bytes | 0 bytes/s, done. Total 2 (delta 1), reused 0 (delta 0) remote: Resolving deltas: 100% (1/1), completed with 1 local object. To https://github.com/caimengzhi/git.git d504270..d381f99 master -> master \u6b64\u65f6\u5728\u4f1a\u5230\u4e4b\u524d\u7684\u9879\u76ee\u4e0b\u521b\u5efa\u6587\u4ef6\u540e\u63d0\u4ea4 root@k8s4:/opt/git# cd root@k8s4:~# cd git_test/ root@k8s4:~/git_test# touch d root@k8s4:~/git_test# git add . root@k8s4:~/git_test# git commit -m 'commit -d' [master 28d37c5] commit -d 1 file changed, 0 insertions(+), 0 deletions(-) create mode 100644 d root@k8s4:~/git_test# git push origin master To git@github.com:caimengzhi/git.git ! [rejected] master -> master (fetch first) error: failed to push some refs to 'git@github.com:caimengzhi/git.git' hint: Updates were rejected because the remote contains work that you do hint: not have locally. This is usually caused by another repository pushing hint: to the same ref. You may want to first integrate the remote changes hint: (e.g., 'git pull ...') before pushing again. hint: See the 'Note about fast-forwards' in 'git push --help' for details. \u7adf\u7136\u62a5\u9519\u4e86\uff0c\u56e0\u4e3a\u522b\u7684\u5730\u65b9\u5df2\u7ecf\u63d0\u4ea4\u4e86\u6570\u636e\uff0c\u6b64\u65f6\u672c\u5730\u4ed3\u5e93\u548c\u8fdc\u7a0bgithub\u4ed3\u5e93\u4e0d\u4e00\u81f4\u3002\u89e3\u51b3\u529e\u6cd5\u5c31\u662f - \u628a\u8fdc\u7a0bgithub\u4ed3\u5e93\u62c9\u4e0b\u6765\uff0c\u5408\u5e76\u540e\u518d\u9000 # 1. \u5148\u4ecegithub\u4e0a\u62c9\u4e0b\u6765 root@k8s4:~/git_test# git fetch Warning: Permanently added the RSA host key for IP address '13.250.177.223' to the list of known hosts. remote: Enumerating objects: 3, done. remote: Counting objects: 100% (3/3), done. remote: Compressing objects: 100% (1/1), done. remote: Total 2 (delta 1), reused 2 (delta 1), pack-reused 0 Unpacking objects: 100% (2/2), done. From github.com:caimengzhi/git d504270..d381f99 master -> origin/master root@k8s4:~/git_test# ls a b d master test # 2. \u7136\u540e\u672c\u5730\u4ed3\u5e93\u548c\u4e4b\u524d\u62c9\u4e0b\u6765\u7684\u5408\u5e76 root@k8s4:~/git_test# git merge origin/master Merge made by the 'recursive' strategy. c | 0 1 file changed, 0 insertions(+), 0 deletions(-) create mode 100644 c \u8bb0\u5f55\u5408\u5e76\u7684\u5185\u5bb9 root@k8s4:~/git_test# ll total 16 drwxr-xr-x 3 root root 4096 Jan 15 15:53 ./ drwx------ 9 root root 4096 Jan 15 14:37 ../ drwxr-xr-x 8 root root 4096 Jan 15 15:53 .git/ -rw-r--r-- 1 root root 21 Jan 15 15:24 a -rw-r--r-- 1 root root 0 Jan 15 15:02 b -rw-r--r-- 1 root root 0 Jan 15 15:53 c -rw-r--r-- 1 root root 0 Jan 15 15:50 d -rw-r--r-- 1 root root 0 Jan 15 15:24 master -rw-r--r-- 1 root root 0 Jan 15 15:24 test # 3. \u7136\u540e\u518d\u63a8\u9001\u5230\u8fdc\u7a0b root@k8s4:~/git_test# git push -u origin master Counting objects: 4, done. Delta compression using up to 4 threads. Compressing objects: 100% (4/4), done. Writing objects: 100% (4/4), 426 bytes | 0 bytes/s, done. Total 4 (delta 2), reused 0 (delta 0) remote: Resolving deltas: 100% (2/2), completed with 1 local object. To git@github.com:caimengzhi/git.git d381f99..752ef29 master -> master Branch master set up to track remote branch master from origin. root@k8s4:~/git_test# \u6ce8\u610f - \u6bcf\u6b21\u63a8\u9001\u7684\u65f6\u5019\uff0c\u90fd\u8981\u62c9\u4e00\u4e0b\u8fdc\u7a0b\u4ed3\u5e93\u7684\u6570\u636e\u7136\u540e\u5408\u5e76\uff0c\u4fdd\u8bc1\u672c\u5730\u4ed3\u5e93\u548c\u8fdc\u7a0b\u4ed3\u5e93\u7684\u6570\u636e\u4e00\u81f4 - \u7136\u540e\u518d\u4fee\u6539\u672c\u5730\u6570\u636e\u540e\uff0c\u518d\u6b21\u63a8\u9001\u5230\u8fdc\u7a0b","title":"2. github"},{"location":"tools/gitlab/gitlab.close_register/","text":"Gitlab \u5173\u95ed\u6ce8\u518c\u7528\u6237\u63a5\u53e3 \u7528\u6237root\u767b\u5f55\u540e \u70b9\u51fb\u6700\u4e0b\u9762\u7684save\uff0c\u7136\u540e\u9000\u51fa\u91cd\u65b0\u767b\u5f55","title":"2. \u5173\u95ed\u6ce8\u518c"},{"location":"tools/gitlab/gitlab.index/","text":"Gitlab \u90e8\u7f72 1. \u4ecb\u7ecd \u00b6 1.1 \u53c2\u8003\u6307\u5357 \u00b6 \u5b98\u7f51 \u5b89\u88c5\u6307\u5357 \u79bb\u7ebf\u5b89\u88c5 \u6e05\u534e\u6e90 1.2 \u533a\u522b \u00b6 gitlab-ce \u793e\u533a\u7248\u672c(\u514d\u8d39) gitlab-ee \u4f01\u4e1a\u7248\u672c(\u6536\u8d39) 1.3 \u5728\u7ebf\u5b89\u88c5 \u00b6 sudo apt-get update sudo apt-get install -y curl openssh-server ca-certificates sudo apt-get install -y postfix 1.4 \u5728\u7ebf\u5b89\u88c5(\u6307\u5b9a\u7248\u672c) \u00b6 curl -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash sudo apt-get install gitlab-ce=10.2.2-ce.0 1.5 \u79bb\u7ebf\u5b89\u88c5\uff08\u6307\u5b9a\u7248\u672c\uff09 \u00b6 root@k8s4:~/git_test# lsb_release -a No LSB modules are available. Distributor ID: Ubuntu Description: Ubuntu 16.04.5 LTS Release: 16.04 Codename: xenial root@k8s4:~/git_test# wget --content-disposition https://packages.gitlab.com/gitlab/gitlab-ce/packages/ubuntu/xenial/gitlab-ce_10.2.2-ce.0_amd64.deb/download.deb --2019-01-15 16:15:50-- https://packages.gitlab.com/gitlab/gitlab-ce/packages/ubuntu/xenial/gitlab-ce_10.2.2-ce.0_amd64.deb/download.deb \u3002\u3002\u3002\u3002\u3002\u7701\u7565\u3002\u3002\u3002\u3002\u3002 \u5f00\u59cb\u5b89\u88c5 root@k8s4:~/git_test# dpkg -i gitlab-ce_10.2.2-ce.0_amd64.deb Selecting previously unselected package gitlab-ce. (Reading database ... 120662 files and directories currently installed.) Preparing to unpack gitlab-ce_10.2.2-ce.0_amd64.deb ... Unpacking gitlab-ce (10.2.2-ce.0) ... Setting up gitlab-ce (10.2.2-ce.0) ... It looks like GitLab has not been configured yet; skipping the upgrade script. *. *. *** *** ***** ***** .****** ******* ******** ******** ,,,,,,,,,***********,,,,,,,,, ,,,,,,,,,,,*********,,,,,,,,,,, .,,,,,,,,,,,*******,,,,,,,,,,,, ,,,,,,,,,*****,,,,,,,,,. ,,,,,,,****,,,,,, .,,,***,,,, ,*,. _______ __ __ __ / ____(_) /_/ / ____ _/ /_ / / __/ / __/ / / __ \\`/ __ \\ / /_/ / / /_/ /___/ /_/ / /_/ / \\____/_/\\__/_____/\\__,_/_.___/ Thank you for installing GitLab! GitLab was unable to detect a valid hostname for your instance. Please configure a URL for your GitLab instance by setting `external_url` configuration in /etc/gitlab/gitlab.rb file. Then, you can start your GitLab instance by running the following command: sudo gitlab-ctl reconfigure For a comprehensive list of configuration options please see the Omnibus GitLab readme https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md \u4e0b\u8f7d\u548c\u5b89\u88c5\u7684\u65f6\u5019\u90fd\u6bd4\u8f83\u6162\uff0c\u8bf7\u7a0d\u7b49\u7247\u523b 2. \u914d\u7f6e \u00b6 2.1 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 \u00b6 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 external_url \u4e3a\u672c\u673aIP\u5730\u5740 root@k8s4:/etc/gitlab# cp gitlab.rb gitlab.rb.ori root@k8s4:/etc/gitlab# vim /etc/gitlab/gitlab.rb root@k8s4:/etc/gitlab# diff gitlab.rb gitlab.rb.ori 13c13 < external_url 'http://192.168.5.106' --- > external_url 'http://gitlab.example.com # \u53ea\u6709\u4fee\u6539/etc/gitlab/gitlab.rb\u5c31\u8981\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c(\u5176\u4ed6\u5f88\u591a\u6587\u4ef6\u90fd\u4f9d\u8d56\u8fd9\u4e2a\u6587\u4ef6) root@k8s4:/etc/gitlab# gitlab-ctl reconfigure root@k8s4:/etc/gitlab# gitlab-ctl status run: gitaly: (pid 39985) 31s; run: log: (pid 39567) 70s run: gitlab-monitor: (pid 40000) 30s; run: log: (pid 39685) 62s run: gitlab-workhorse: (pid 39972) 31s; run: log: (pid 39470) 80s run: logrotate: (pid 39513) 72s; run: log: (pid 39512) 72s run: nginx: (pid 39490) 78s; run: log: (pid 39489) 78s run: node-exporter: (pid 39664) 64s; run: log: (pid 39663) 64s run: postgres-exporter: (pid 40034) 29s; run: log: (pid 39878) 48s run: postgresql: (pid 39075) 128s; run: log: (pid 39074) 128s run: prometheus: (pid 40010) 30s; run: log: (pid 39787) 54s run: redis: (pid 38976) 134s; run: log: (pid 38975) 134s run: redis-exporter: (pid 39768) 56s; run: log: (pid 39767) 56s run: sidekiq: (pid 39454) 81s; run: log: (pid 39453) 81s run: unicorn: (pid 39383) 87s; run: log: (pid 39382) 87s 2.2 \u67e5\u770b\u65e5\u5fd7 \u00b6 root@k8s4:/etc/gitlab# gitlab-ctl tail 2.3 \u65e5\u5fd7\u8def\u5f84 \u00b6 root@k8s4:/etc/gitlab# cd /var/log/gitlab/ 2.4 gitlab\u6570\u636e \u00b6 root@k8s4:/var/log/gitlab# ls /var/opt/gitlab/ 2.5 github\u5907\u4efd\u6570\u636e \u00b6 root@k8s4:/var/opt/gitlab/backups# pwd /var/opt/gitlab/backups 2.6 \u5b89\u88c5\u540e\u7a0b\u5e8f\u4f4d\u7f6e \u00b6 root@k8s4:/opt/gitlab# pwd /opt/gitlab root@k8s4:/opt/gitlab# ll total 1656 drwxr-xr-x 10 root root 4096 Jan 15 16:27 ./ drwxr-xr-x 4 root root 4096 Jan 15 16:21 ../ -rw-r--r-- 1 root root 1460869 Nov 24 2017 LICENSE drwxr-xr-x 2 root root 4096 Jan 15 16:22 LICENSES/ drwxr-xr-x 2 root root 4096 Jan 15 16:22 bin/ -rw-r--r-- 1 root root 157364 Nov 24 2017 dependency_licenses.json drwxr-xr-x 18 root root 4096 Jan 15 16:26 embedded/ drwxr-xr-x 6 root root 4096 Jan 15 16:28 etc/ drwxr-xr-x 2 root root 4096 Jan 15 16:28 init/ drwxr-xr-x 2 root root 4096 Jan 15 16:28 service/ drwxr-xr-x 15 root root 4096 Jan 15 16:28 sv/ drwxr-xr-x 3 root root 4096 Jan 15 16:27 var/ -rw-r--r-- 1 root root 19881 Nov 24 2017 version-manifest.json -rw-r--r-- 1 root root 8696 Nov 24 2017 version-manifest.txt","title":"1. gitlab"},{"location":"tools/gitlab/gitlab.index/#1","text":"","title":"1. \u4ecb\u7ecd"},{"location":"tools/gitlab/gitlab.index/#11","text":"\u5b98\u7f51 \u5b89\u88c5\u6307\u5357 \u79bb\u7ebf\u5b89\u88c5 \u6e05\u534e\u6e90","title":"1.1 \u53c2\u8003\u6307\u5357"},{"location":"tools/gitlab/gitlab.index/#12","text":"gitlab-ce \u793e\u533a\u7248\u672c(\u514d\u8d39) gitlab-ee \u4f01\u4e1a\u7248\u672c(\u6536\u8d39)","title":"1.2 \u533a\u522b"},{"location":"tools/gitlab/gitlab.index/#13","text":"sudo apt-get update sudo apt-get install -y curl openssh-server ca-certificates sudo apt-get install -y postfix","title":"1.3 \u5728\u7ebf\u5b89\u88c5"},{"location":"tools/gitlab/gitlab.index/#14","text":"curl -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash sudo apt-get install gitlab-ce=10.2.2-ce.0","title":"1.4 \u5728\u7ebf\u5b89\u88c5(\u6307\u5b9a\u7248\u672c)"},{"location":"tools/gitlab/gitlab.index/#15","text":"root@k8s4:~/git_test# lsb_release -a No LSB modules are available. Distributor ID: Ubuntu Description: Ubuntu 16.04.5 LTS Release: 16.04 Codename: xenial root@k8s4:~/git_test# wget --content-disposition https://packages.gitlab.com/gitlab/gitlab-ce/packages/ubuntu/xenial/gitlab-ce_10.2.2-ce.0_amd64.deb/download.deb --2019-01-15 16:15:50-- https://packages.gitlab.com/gitlab/gitlab-ce/packages/ubuntu/xenial/gitlab-ce_10.2.2-ce.0_amd64.deb/download.deb \u3002\u3002\u3002\u3002\u3002\u7701\u7565\u3002\u3002\u3002\u3002\u3002 \u5f00\u59cb\u5b89\u88c5 root@k8s4:~/git_test# dpkg -i gitlab-ce_10.2.2-ce.0_amd64.deb Selecting previously unselected package gitlab-ce. (Reading database ... 120662 files and directories currently installed.) Preparing to unpack gitlab-ce_10.2.2-ce.0_amd64.deb ... Unpacking gitlab-ce (10.2.2-ce.0) ... Setting up gitlab-ce (10.2.2-ce.0) ... It looks like GitLab has not been configured yet; skipping the upgrade script. *. *. *** *** ***** ***** .****** ******* ******** ******** ,,,,,,,,,***********,,,,,,,,, ,,,,,,,,,,,*********,,,,,,,,,,, .,,,,,,,,,,,*******,,,,,,,,,,,, ,,,,,,,,,*****,,,,,,,,,. ,,,,,,,****,,,,,, .,,,***,,,, ,*,. _______ __ __ __ / ____(_) /_/ / ____ _/ /_ / / __/ / __/ / / __ \\`/ __ \\ / /_/ / / /_/ /___/ /_/ / /_/ / \\____/_/\\__/_____/\\__,_/_.___/ Thank you for installing GitLab! GitLab was unable to detect a valid hostname for your instance. Please configure a URL for your GitLab instance by setting `external_url` configuration in /etc/gitlab/gitlab.rb file. Then, you can start your GitLab instance by running the following command: sudo gitlab-ctl reconfigure For a comprehensive list of configuration options please see the Omnibus GitLab readme https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md \u4e0b\u8f7d\u548c\u5b89\u88c5\u7684\u65f6\u5019\u90fd\u6bd4\u8f83\u6162\uff0c\u8bf7\u7a0d\u7b49\u7247\u523b","title":"1.5 \u79bb\u7ebf\u5b89\u88c5\uff08\u6307\u5b9a\u7248\u672c\uff09"},{"location":"tools/gitlab/gitlab.index/#2","text":"","title":"2. \u914d\u7f6e"},{"location":"tools/gitlab/gitlab.index/#21","text":"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 external_url \u4e3a\u672c\u673aIP\u5730\u5740 root@k8s4:/etc/gitlab# cp gitlab.rb gitlab.rb.ori root@k8s4:/etc/gitlab# vim /etc/gitlab/gitlab.rb root@k8s4:/etc/gitlab# diff gitlab.rb gitlab.rb.ori 13c13 < external_url 'http://192.168.5.106' --- > external_url 'http://gitlab.example.com # \u53ea\u6709\u4fee\u6539/etc/gitlab/gitlab.rb\u5c31\u8981\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c(\u5176\u4ed6\u5f88\u591a\u6587\u4ef6\u90fd\u4f9d\u8d56\u8fd9\u4e2a\u6587\u4ef6) root@k8s4:/etc/gitlab# gitlab-ctl reconfigure root@k8s4:/etc/gitlab# gitlab-ctl status run: gitaly: (pid 39985) 31s; run: log: (pid 39567) 70s run: gitlab-monitor: (pid 40000) 30s; run: log: (pid 39685) 62s run: gitlab-workhorse: (pid 39972) 31s; run: log: (pid 39470) 80s run: logrotate: (pid 39513) 72s; run: log: (pid 39512) 72s run: nginx: (pid 39490) 78s; run: log: (pid 39489) 78s run: node-exporter: (pid 39664) 64s; run: log: (pid 39663) 64s run: postgres-exporter: (pid 40034) 29s; run: log: (pid 39878) 48s run: postgresql: (pid 39075) 128s; run: log: (pid 39074) 128s run: prometheus: (pid 40010) 30s; run: log: (pid 39787) 54s run: redis: (pid 38976) 134s; run: log: (pid 38975) 134s run: redis-exporter: (pid 39768) 56s; run: log: (pid 39767) 56s run: sidekiq: (pid 39454) 81s; run: log: (pid 39453) 81s run: unicorn: (pid 39383) 87s; run: log: (pid 39382) 87s","title":"2.1 \u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},{"location":"tools/gitlab/gitlab.index/#22","text":"root@k8s4:/etc/gitlab# gitlab-ctl tail","title":"2.2 \u67e5\u770b\u65e5\u5fd7"},{"location":"tools/gitlab/gitlab.index/#23","text":"root@k8s4:/etc/gitlab# cd /var/log/gitlab/","title":"2.3 \u65e5\u5fd7\u8def\u5f84"},{"location":"tools/gitlab/gitlab.index/#24-gitlab","text":"root@k8s4:/var/log/gitlab# ls /var/opt/gitlab/","title":"2.4 gitlab\u6570\u636e"},{"location":"tools/gitlab/gitlab.index/#25-github","text":"root@k8s4:/var/opt/gitlab/backups# pwd /var/opt/gitlab/backups","title":"2.5 github\u5907\u4efd\u6570\u636e"},{"location":"tools/gitlab/gitlab.index/#26","text":"root@k8s4:/opt/gitlab# pwd /opt/gitlab root@k8s4:/opt/gitlab# ll total 1656 drwxr-xr-x 10 root root 4096 Jan 15 16:27 ./ drwxr-xr-x 4 root root 4096 Jan 15 16:21 ../ -rw-r--r-- 1 root root 1460869 Nov 24 2017 LICENSE drwxr-xr-x 2 root root 4096 Jan 15 16:22 LICENSES/ drwxr-xr-x 2 root root 4096 Jan 15 16:22 bin/ -rw-r--r-- 1 root root 157364 Nov 24 2017 dependency_licenses.json drwxr-xr-x 18 root root 4096 Jan 15 16:26 embedded/ drwxr-xr-x 6 root root 4096 Jan 15 16:28 etc/ drwxr-xr-x 2 root root 4096 Jan 15 16:28 init/ drwxr-xr-x 2 root root 4096 Jan 15 16:28 service/ drwxr-xr-x 15 root root 4096 Jan 15 16:28 sv/ drwxr-xr-x 3 root root 4096 Jan 15 16:27 var/ -rw-r--r-- 1 root root 19881 Nov 24 2017 version-manifest.json -rw-r--r-- 1 root root 8696 Nov 24 2017 version-manifest.txt","title":"2.6 \u5b89\u88c5\u540e\u7a0b\u5e8f\u4f4d\u7f6e"},{"location":"tools/gitlab/gitlab.set_root_pwd/","text":"Gitlab \u91cd\u7f6eroot\u767b\u5f55\u5bc6\u7801 \u65f6\u95f4\u957f\u7a81\u7136\u5fd8\u8bb0\u4e86root\u8d26\u53f7\u7684\u5bc6\u7801\uff0c\u4ee5\u4e0b\u662f\u627e\u56de\u5bc6\u7801\u8fc7\u7a0b \u627e\u56de\u6b65\u9aa4 \u00b6 [root@leco gitlab]# su - git -sh-4.1$ gitlab-rails console production ------------------------------------------------------------------------------------- GitLab: 11.7.5 (c5b5b18) GitLab Shell: 8.4.4 postgresql: 9.6.11 ------------------------------------------------------------------------------------- Loading production environment (Rails 5.0.7.1) irb(main):001:0> user = User.where(id: 1).first # \u786e\u5b9a\u662f\u5426\u662froot\u7528\u6237 => #<User id:1 @root> irb(main):002:0> user.password = 'caimengzhi!\\#@809' # \u8bbe\u7f6e\u767b\u5f55\u8d26\u53f7root\u7684\u5bc6\u7801 => \"caimengzhi!\\#@809\" irb(main):003:0> user.save! Enqueued ActionMailer::DeliveryJob (Job ID: 26a68d46-d3f4-46a1-92c8-79057ec4a13f) to Sidekiq(mailers) with arguments: \"DeviseMailer\", \"password_change\", \"deliver_now\", #<GlobalID:0x00007f225e449bc0 @uri=#<URI::GID gid://gitlab/User/1>> => true irb(main):004:0> exit \u518d\u6b21\u767b\u5f55 \u4f7f\u7528 \u8d26\u53f7: root \u5bc6\u7801: caimengzhi!#@809","title":"3. \u627e\u56deroot\u5bc6\u7801"},{"location":"tools/gitlab/gitlab.set_root_pwd/#_1","text":"[root@leco gitlab]# su - git -sh-4.1$ gitlab-rails console production ------------------------------------------------------------------------------------- GitLab: 11.7.5 (c5b5b18) GitLab Shell: 8.4.4 postgresql: 9.6.11 ------------------------------------------------------------------------------------- Loading production environment (Rails 5.0.7.1) irb(main):001:0> user = User.where(id: 1).first # \u786e\u5b9a\u662f\u5426\u662froot\u7528\u6237 => #<User id:1 @root> irb(main):002:0> user.password = 'caimengzhi!\\#@809' # \u8bbe\u7f6e\u767b\u5f55\u8d26\u53f7root\u7684\u5bc6\u7801 => \"caimengzhi!\\#@809\" irb(main):003:0> user.save! Enqueued ActionMailer::DeliveryJob (Job ID: 26a68d46-d3f4-46a1-92c8-79057ec4a13f) to Sidekiq(mailers) with arguments: \"DeviseMailer\", \"password_change\", \"deliver_now\", #<GlobalID:0x00007f225e449bc0 @uri=#<URI::GID gid://gitlab/User/1>> => true irb(main):004:0> exit \u518d\u6b21\u767b\u5f55 \u4f7f\u7528 \u8d26\u53f7: root \u5bc6\u7801: caimengzhi!#@809","title":"\u627e\u56de\u6b65\u9aa4"},{"location":"tools/nodepad/nodepad.nppftp/","text":"NodePad++ \u63d2\u4ef6 1. \u8d77\u56e0 \u00b6 \u6211\u4eec\u5728\u8c03\u8bd5\u8fdc\u7a0bLinux\u4ee3\u7801\u7684\u65f6\u5019\u3002\u901a\u5e38\u662f\u767b\u5f55\u5230\u670d\u52a1\u5668\u3002\u4f7f\u7528vim\u8fd9\u6837\u7684\u8f6f\u4ef6\u8c03\u8bd5\u4ee3\u7801\u3002\u4f46\u662f\u5728\u8c03\u8bd5\u5927\u7684\u5de5\u7a0b\u7684\u65f6\u5019\uff0c\u4fee\u6539\u6587\u4ef6\u7279\u522b\u9ebb\u70e6\uff0c\u5c24\u5176\u4f60vim\u8fd9\u6837\u7684\u8f6f\u4ef6\u4e0d\u719f\u7684\u8bdd\uff0c\u4f60\u4f1a\u6293\u72c2\u3002\u6b64\u65f6\u6709\u4e2awindows\u8f6f\u4ef6\u4f60\u503c\u5f97\u62e5\u6709\u3002\u90a3\u5c31\u662fNodePad++\u7ed3\u548c\u63d2\u4ef6NppFTP\uff0c\u5c31\u53ef\u4ee5\u5728\u672c\u5730\u7f16\u8f91\u8fdc\u7a0b\u6587\u4ef6(\u901a\u8fc7\u4e0a\u4f20\u3001\u4e0b\u8f7d\u8fdc\u7a0b\u6587\u4ef6\u76f4\u63a5\u5728NodePad++\u4e2d\u4fee\u6539) \u672c\u6559\u7a0b\u9002\u5408Windows\u8fdc\u7a0b\u4fee\u6539\u8fdc\u7a0bLinux\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\u3002 2. Linux \u00b6 2.1 \u4fe1\u606f \u00b6 \u4ee5\u4e0b\u662f\u8fdc\u7a0bLinux\u670d\u52a1\u5668\u7684\u76f8\u5173\u4fe1\u606f\u3002\u9700\u8981IP\uff0cLinux\u7684ssh\u767b\u5f55\u8d26\u53f7\u548c\u5bc6\u7801 root@leco:~# id uid=0(root) gid=0(root) \u7ec4=0(root) root@leco:~# ifconfig | grep 192.168.5.110 inet \u5730\u5740:192.168.5.110 \u5e7f\u64ad:192.168.5.255 \u63a9\u7801:255.255.255.0 \u4f60\u7684ssh\u8fdc\u7a0b\u8fde\u63a5Linux\u670d\u52a1\u5668\u7684\u8d26\u53f7\u51b3\u5b9a\u4f60\u80fd\u7f16\u8f91\u8fdc\u7a0b\u670d\u52a1\u5668\u7684\u6587\u4ef6\u7684\u6743\u9650\uff0c\u6240\u4ee5\u5efa\u8bae\u4f60\u7684\u8fd9\u7528\u6237\u80fd\u6709\u7f16\u8f91\u7684\u6587\u4ef6\u7684\u6743\u9650\u3002\u6211\u63a5\u4e0b\u6211\u4ee5root\u7528\u6237\u53bb\u64cd\u4f5c\uff0c\u4f60\u7684\u4ee5\u4f60\u5b9e\u9645\u60c5\u51b5\u6765 3. Windows \u00b6 3.1 \u5b89\u88c5nodepad \u00b6 \u9996\u5148\u5b89\u88c5\u597dNodePad++\uff0c\u8bf7== \u9009\u62e932\u4f4d\u7684 ==\u7248\u672c[64\u4f4d\u7684\u597d\u50cf\u4e0d\u53ef\u4ee5\u5b89\u88c5\u8fd9\u4e2a\u63d2\u4ef6]\uff0c\u5b89\u88c5\u597d\u540e\uff0c\u53cc\u51fb\u6253\u5f00NodePad++\uff0c\u4f60\u7684\u754c\u9762\u5982\u4e0b\uff1a 3.2 \u5b89\u88c5NppFTP\u63d2\u4ef6 \u00b6 \u70b9\u51fb\u56fe\u6807\u53f3\u4e0a\u89d2\u7684?\u53f7\uff0c\u9009\u62e9 \u83b7\u53d6\u63d2\u4ef6\u9009\u9879\u3002 \u7b49\u4e0b\u63d2\u4ef6\u4e0b\u8f7d\u5b8c\u6bd5\u3002 \u4e0b\u8f7d\u597d\u540e\uff0c\u76f4\u63a5\u89e3\u538b\u5230notepad++\u5b89\u88c5\u76ee\u5f55\u7684\u63d2\u4ef6\u6587\u4ef6\u5939 \u7684plugins\u3002\u6bd4\u5982\u6211\u7684\u5b89\u88c5\u8def\u5f84\u662f: C:\\Program Files (x86)\\Notepad++\\plugins ,\u4f60\u7684\u6839\u636e\u4f60\u7684\u6765\u3002\u627e\u5230\u5b89\u88c5\u8def\u5f84\u4e0b\u9762\u7684plugins\u6587\u4ef6\u5939\uff0c\u7136\u540e\u628a\u89e3\u538b\u540e\u7684\u6587\u4ef6 NppFTP.dll \u76f4\u63a5\u62f7\u8d1d\u5230plugins\u4e0b\u9762\uff0c\u5982\u4e0b\u56fe: \u7136\u540e\u91cd\u542fNodePad++\u8f6f\u4ef6\u3002 \u4ee5\u4e0a\u4e24\u79cd\u65b9\u5f0f\u90fd\u53ef\u4ee5\u8c03\u51faNppFTP\u9009\u9879\u3002\u5230\u6b64\u5b89\u88c5\u5c31\u6210\u529f\u4e86\uff0c\u4e0b\u9762\u5f00\u59cb\u8bb2\u89e3\uff0c\u5982\u4f55\u914d\u7f6e\u3002 3.3 NppFTP\u914d\u7f6e \u00b6 \u65b0\u5b89\u88c5\u7684NppFTP\u63d2\u4ef6\u540e\uff0c\u6253\u5f00NppFTP\u63d2\u4ef6\u9009\u9879\u5982\u4e0b\u7c7b\u4f3c\uff0c\u53f3\u4fa7\u662f\u7a7a\u767d\u7684\u3002\u9700\u8981\u4f60\u914d\u7f6e\u3002 \u9009\u9879Profile settings\u8fdb\u884c\u914d\u7f6e\u3002\u5982\u4e0b\u56fe: \u70b9\u51fb\u65b0\u5efaAdd New \u63a5\u4e0b\u6765\u7ed9\u4f60\u8fd9\u65b0\u5efa\u7684\u6761\u76ee\u8d77\u4e00\u4e2a\u540d\u5b57\u3002\u6211\u5efa\u8bae\u5199IP\u5730\u5740\uff0c\u4ee5\u540e\u5c31\u77e5\u9053\u4f60\u8fd9\u4e2a\u662f\u94fe\u63a5\u5230\u54ea\u91cc\u673a\u5668\u7684\u3002 \u7136\u540e\u5173\u95ed\uff0c\u56de\u5230\u4e3b\u754c\u9762\u3002\u8fde\u63a5 \u4f60\u64cd\u4f5c\u90fd\u4f1a\u6709\u8bb0\u5f55\uff0c\u6253\u5f00\u8be5\u6309\u94ae\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u4f60\u7684\u6240\u6709\u64cd\u4f5c\uff0c \u5e38\u89c1\u7684\u95ee\u9898\u5c31\u662f\u4f60\u7684ssh\u767b\u5f55linux\u670d\u52a1\u5668\u7684\u8d26\u53f7\uff0c\u6ca1\u6709\u7f16\u8f91\u8be5\u6587\u4ef6\u7684\u6743\u9650\uff0c\u603b\u662f\u4f1a\u5457\u62d2\u63a5\u3002\u4f60\u6b64\u65f6\u5c31\u9700\u8981\u5728Linux\u670d\u52a1\u5668\u4e0a\u6388\u6743\u8be5\u7528\u6237\u53bb\u7f16\u8f91\u8be5\u6587\u4ef6 # \u6388\u6743cmz\u7528\u6237\u548ccmz\u7528\u6237\u7ec4\u53ef\u4ee5\u64cd\u4f5cfiles_dir\u6587\u4ef6\u4e0b\u6240\u6709\u6587\u4ef6 chown -R cmz.cmz files_dir","title":"1. NppFTP"},{"location":"tools/nodepad/nodepad.nppftp/#1","text":"\u6211\u4eec\u5728\u8c03\u8bd5\u8fdc\u7a0bLinux\u4ee3\u7801\u7684\u65f6\u5019\u3002\u901a\u5e38\u662f\u767b\u5f55\u5230\u670d\u52a1\u5668\u3002\u4f7f\u7528vim\u8fd9\u6837\u7684\u8f6f\u4ef6\u8c03\u8bd5\u4ee3\u7801\u3002\u4f46\u662f\u5728\u8c03\u8bd5\u5927\u7684\u5de5\u7a0b\u7684\u65f6\u5019\uff0c\u4fee\u6539\u6587\u4ef6\u7279\u522b\u9ebb\u70e6\uff0c\u5c24\u5176\u4f60vim\u8fd9\u6837\u7684\u8f6f\u4ef6\u4e0d\u719f\u7684\u8bdd\uff0c\u4f60\u4f1a\u6293\u72c2\u3002\u6b64\u65f6\u6709\u4e2awindows\u8f6f\u4ef6\u4f60\u503c\u5f97\u62e5\u6709\u3002\u90a3\u5c31\u662fNodePad++\u7ed3\u548c\u63d2\u4ef6NppFTP\uff0c\u5c31\u53ef\u4ee5\u5728\u672c\u5730\u7f16\u8f91\u8fdc\u7a0b\u6587\u4ef6(\u901a\u8fc7\u4e0a\u4f20\u3001\u4e0b\u8f7d\u8fdc\u7a0b\u6587\u4ef6\u76f4\u63a5\u5728NodePad++\u4e2d\u4fee\u6539) \u672c\u6559\u7a0b\u9002\u5408Windows\u8fdc\u7a0b\u4fee\u6539\u8fdc\u7a0bLinux\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\u3002","title":"1. \u8d77\u56e0"},{"location":"tools/nodepad/nodepad.nppftp/#2-linux","text":"","title":"2. Linux"},{"location":"tools/nodepad/nodepad.nppftp/#21","text":"\u4ee5\u4e0b\u662f\u8fdc\u7a0bLinux\u670d\u52a1\u5668\u7684\u76f8\u5173\u4fe1\u606f\u3002\u9700\u8981IP\uff0cLinux\u7684ssh\u767b\u5f55\u8d26\u53f7\u548c\u5bc6\u7801 root@leco:~# id uid=0(root) gid=0(root) \u7ec4=0(root) root@leco:~# ifconfig | grep 192.168.5.110 inet \u5730\u5740:192.168.5.110 \u5e7f\u64ad:192.168.5.255 \u63a9\u7801:255.255.255.0 \u4f60\u7684ssh\u8fdc\u7a0b\u8fde\u63a5Linux\u670d\u52a1\u5668\u7684\u8d26\u53f7\u51b3\u5b9a\u4f60\u80fd\u7f16\u8f91\u8fdc\u7a0b\u670d\u52a1\u5668\u7684\u6587\u4ef6\u7684\u6743\u9650\uff0c\u6240\u4ee5\u5efa\u8bae\u4f60\u7684\u8fd9\u7528\u6237\u80fd\u6709\u7f16\u8f91\u7684\u6587\u4ef6\u7684\u6743\u9650\u3002\u6211\u63a5\u4e0b\u6211\u4ee5root\u7528\u6237\u53bb\u64cd\u4f5c\uff0c\u4f60\u7684\u4ee5\u4f60\u5b9e\u9645\u60c5\u51b5\u6765","title":"2.1 \u4fe1\u606f"},{"location":"tools/nodepad/nodepad.nppftp/#3-windows","text":"","title":"3. Windows"},{"location":"tools/nodepad/nodepad.nppftp/#31-nodepad","text":"\u9996\u5148\u5b89\u88c5\u597dNodePad++\uff0c\u8bf7== \u9009\u62e932\u4f4d\u7684 ==\u7248\u672c[64\u4f4d\u7684\u597d\u50cf\u4e0d\u53ef\u4ee5\u5b89\u88c5\u8fd9\u4e2a\u63d2\u4ef6]\uff0c\u5b89\u88c5\u597d\u540e\uff0c\u53cc\u51fb\u6253\u5f00NodePad++\uff0c\u4f60\u7684\u754c\u9762\u5982\u4e0b\uff1a","title":"3.1 \u5b89\u88c5nodepad"},{"location":"tools/nodepad/nodepad.nppftp/#32-nppftp","text":"\u70b9\u51fb\u56fe\u6807\u53f3\u4e0a\u89d2\u7684?\u53f7\uff0c\u9009\u62e9 \u83b7\u53d6\u63d2\u4ef6\u9009\u9879\u3002 \u7b49\u4e0b\u63d2\u4ef6\u4e0b\u8f7d\u5b8c\u6bd5\u3002 \u4e0b\u8f7d\u597d\u540e\uff0c\u76f4\u63a5\u89e3\u538b\u5230notepad++\u5b89\u88c5\u76ee\u5f55\u7684\u63d2\u4ef6\u6587\u4ef6\u5939 \u7684plugins\u3002\u6bd4\u5982\u6211\u7684\u5b89\u88c5\u8def\u5f84\u662f: C:\\Program Files (x86)\\Notepad++\\plugins ,\u4f60\u7684\u6839\u636e\u4f60\u7684\u6765\u3002\u627e\u5230\u5b89\u88c5\u8def\u5f84\u4e0b\u9762\u7684plugins\u6587\u4ef6\u5939\uff0c\u7136\u540e\u628a\u89e3\u538b\u540e\u7684\u6587\u4ef6 NppFTP.dll \u76f4\u63a5\u62f7\u8d1d\u5230plugins\u4e0b\u9762\uff0c\u5982\u4e0b\u56fe: \u7136\u540e\u91cd\u542fNodePad++\u8f6f\u4ef6\u3002 \u4ee5\u4e0a\u4e24\u79cd\u65b9\u5f0f\u90fd\u53ef\u4ee5\u8c03\u51faNppFTP\u9009\u9879\u3002\u5230\u6b64\u5b89\u88c5\u5c31\u6210\u529f\u4e86\uff0c\u4e0b\u9762\u5f00\u59cb\u8bb2\u89e3\uff0c\u5982\u4f55\u914d\u7f6e\u3002","title":"3.2 \u5b89\u88c5NppFTP\u63d2\u4ef6"},{"location":"tools/nodepad/nodepad.nppftp/#33-nppftp","text":"\u65b0\u5b89\u88c5\u7684NppFTP\u63d2\u4ef6\u540e\uff0c\u6253\u5f00NppFTP\u63d2\u4ef6\u9009\u9879\u5982\u4e0b\u7c7b\u4f3c\uff0c\u53f3\u4fa7\u662f\u7a7a\u767d\u7684\u3002\u9700\u8981\u4f60\u914d\u7f6e\u3002 \u9009\u9879Profile settings\u8fdb\u884c\u914d\u7f6e\u3002\u5982\u4e0b\u56fe: \u70b9\u51fb\u65b0\u5efaAdd New \u63a5\u4e0b\u6765\u7ed9\u4f60\u8fd9\u65b0\u5efa\u7684\u6761\u76ee\u8d77\u4e00\u4e2a\u540d\u5b57\u3002\u6211\u5efa\u8bae\u5199IP\u5730\u5740\uff0c\u4ee5\u540e\u5c31\u77e5\u9053\u4f60\u8fd9\u4e2a\u662f\u94fe\u63a5\u5230\u54ea\u91cc\u673a\u5668\u7684\u3002 \u7136\u540e\u5173\u95ed\uff0c\u56de\u5230\u4e3b\u754c\u9762\u3002\u8fde\u63a5 \u4f60\u64cd\u4f5c\u90fd\u4f1a\u6709\u8bb0\u5f55\uff0c\u6253\u5f00\u8be5\u6309\u94ae\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u4f60\u7684\u6240\u6709\u64cd\u4f5c\uff0c \u5e38\u89c1\u7684\u95ee\u9898\u5c31\u662f\u4f60\u7684ssh\u767b\u5f55linux\u670d\u52a1\u5668\u7684\u8d26\u53f7\uff0c\u6ca1\u6709\u7f16\u8f91\u8be5\u6587\u4ef6\u7684\u6743\u9650\uff0c\u603b\u662f\u4f1a\u5457\u62d2\u63a5\u3002\u4f60\u6b64\u65f6\u5c31\u9700\u8981\u5728Linux\u670d\u52a1\u5668\u4e0a\u6388\u6743\u8be5\u7528\u6237\u53bb\u7f16\u8f91\u8be5\u6587\u4ef6 # \u6388\u6743cmz\u7528\u6237\u548ccmz\u7528\u6237\u7ec4\u53ef\u4ee5\u64cd\u4f5cfiles_dir\u6587\u4ef6\u4e0b\u6240\u6709\u6587\u4ef6 chown -R cmz.cmz files_dir","title":"3.3 NppFTP\u914d\u7f6e"},{"location":"tools/pssh/pssh.index/","text":"pssh 1. \u8d77\u56e0 \u00b6 pssh\u547d\u4ee4\u662f\u4e00\u4e2apython\u7f16\u5199\u53ef\u4ee5\u5728\u591a\u53f0\u670d\u52a1\u5668\u4e0a\u6267\u884c\u547d\u4ee4\u7684\u5de5\u5177\uff0c\u540c\u65f6\u652f\u6301\u62f7\u8d1d\u6587\u4ef6\uff0c\u662f\u540c\u7c7b\u5de5\u5177\u4e2d\u5f88\u51fa\u8272\u7684\uff0c\u7c7b\u4f3cpdsh\uff0c\u4e2a\u4eba\u8ba4\u4e3a\u76f8\u5bf9pdsh\u66f4\u4e3a\u7b80\u4fbf\uff0c\u4f7f\u7528\u5fc5\u987b\u5728\u5404\u4e2a\u670d\u52a1\u5668\u4e0a\u914d\u7f6e\u597d\u5bc6\u94a5\u8ba4\u8bc1\u8bbf\u95ee\u3002 2. \u90e8\u7f72 \u00b6 2.1 \u5728\u7ebf\u88c5 \u00b6 # ubuntu apt-get install pssh -y # centos yum install pssh -y # mac brew install pssh -y 2.2 \u79bb\u7ebf\u5b89\u88c5 \u00b6 \u200b \u82e5\u662f\u6ca1\u6709\u7f51\u7edc\u7684\u673a\u5668\uff0c\u53ef\u4ee5\u9009\u62e9\u79bb\u7ebf\u5b89\u88c5\u3002 https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/parallel-ssh/pssh-2.3.1.tar.gz \u4e0b\u8f7d\u540e\u89e3\u7801\u538b\uff0c\u7136\u540e\u8fdb\u5165\u6e90\u7801\u76ee\u5f55\uff1a wget http://parallel-ssh.googlecode.com/files/pssh-2.3.1.tar.gz tar xf pssh-2.3.1.tar.gz cd pssh-2.3.1/ python setup.py install 3. \u57fa\u672c\u53c2\u6570 \u00b6 pssh\u53c2\u6570 \u5e38\u89c1\u53c2\u6570 \u200b ```python root@master:~/pssh-2.3.1# pssh --help Usage: pssh [OPTIONS] command [...] Options: --version show program's version number and exit --help show this help message and exit -h HOST_FILE, --hosts=HOST_FILE hosts file (each line \"[user@]host[:port]\") -H HOST_STRING, --host=HOST_STRING additional host entries (\"[user@]host[:port]\") -l USER, --user=USER username (OPTIONAL) -p PAR, --par=PAR max number of parallel threads (OPTIONAL) -o OUTDIR, --outdir=OUTDIR output directory for stdout files (OPTIONAL) -e ERRDIR, --errdir=ERRDIR output directory for stderr files (OPTIONAL) -t TIMEOUT, --timeout=TIMEOUT timeout (secs) (0 = no timeout) per host (OPTIONAL) -O OPTION, --option=OPTION SSH option (OPTIONAL) -v, --verbose turn on warning and diagnostic messages (OPTIONAL) -A, --askpass Ask for a password (OPTIONAL) -x ARGS, --extra-args=ARGS Extra command-line arguments, with processing for spaces, quotes, and backslashes -X ARG, --extra-arg=ARG Extra command-line argument -i, --inline inline aggregated output and error for each server --inline-stdout inline standard output for each server -I, --send-input read from standard input and send as input to ssh -P, --print print output as we get it Example: pssh -h hosts.txt -l irb2 -o /tmp/foo uptime \u200b ``` \u4e2d\u6587\u89e3\u91ca --version\uff1a\u67e5\u770b\u7248\u672c --help\uff1a\u67e5\u770b\u5e2e\u52a9\uff0c\u5373\u6b64\u4fe1\u606f -h\uff1a\u4e3b\u673a\u6587\u4ef6\u5217\u8868\uff0c\u5185\u5bb9\u683c\u5f0f\u201d[user@]host[:port]\u201d -H\uff1a\u4e3b\u673a\u5b57\u7b26\u4e32\uff0c\u5185\u5bb9\u683c\u5f0f\u201d[user@]host[:port]\u201d -\uff1a\u767b\u5f55\u4f7f\u7528\u7684\u7528\u6237\u540d -p\uff1a\u5e76\u53d1\u7684\u7ebf\u7a0b\u6570\u3010\u53ef\u9009\u3011 -o\uff1a\u8f93\u51fa\u7684\u6587\u4ef6\u76ee\u5f55\u3010\u53ef\u9009\u3011 -e\uff1a\u9519\u8bef\u8f93\u5165\u6587\u4ef6\u3010\u53ef\u9009\u3011 -t\uff1aTIMEOUT \u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e\uff0c0\u65e0\u9650\u5236\u3010\u53ef\u9009\u3011 -O\uff1aSSH\u7684\u9009\u9879 -v\uff1a\u8be6\u7ec6\u6a21\u5f0f -A\uff1a\u624b\u52a8\u8f93\u5165\u5bc6\u7801\u6a21\u5f0f -x\uff1a\u989d\u5916\u7684\u547d\u4ee4\u884c\u53c2\u6570\u4f7f\u7528\u7a7a\u767d\u7b26\u53f7\uff0c\u5f15\u53f7\uff0c\u53cd\u659c\u7ebf\u5904\u7406 -X\uff1a\u989d\u5916\u7684\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u5355\u4e2a\u53c2\u6570\u6a21\u5f0f\uff0c\u540c-x -i\uff1a\u6bcf\u4e2a\u670d\u52a1\u5668\u5185\u90e8\u5904\u7406\u4fe1\u606f\u8f93\u51fa -P\uff1a\u6253\u5370\u51fa\u670d\u52a1\u5668\u8fd4\u56de\u4fe1\u606f 4. \u57fa\u672c\u4f7f\u7528 \u00b6 \u6267\u884cpssh\u7684\u673a\u5668\u4e00\u5b9a\u8981\u5148\u505a\u597d\u7ebf\u6027\u5173\u7cfb(\u65e0\u5bc6\u7801\u94fe\u63a5) root@master:/opt# egrep -i 'node1|node2|node3' /etc/hosts 192.168.178.128 node3 192.168.178.129 node2 192.168.178.130 node1 \u914d\u7f6e\u4e00\u4e2a\u6587\u4ef6[\u540e\u9762pssh\u4f1a\u52a0\u8f7d\u8fd9\u4e2a\u6587\u4ef6]\uff0c\u91cc\u9762\u914d\u7f6e\u8fdc\u7aef\u7684\u673a\u5668 root@master:/opt# cat ip.txt node1 node2 node3 4.1 \u67e5\u770b\u65f6\u95f4 \u00b6 \u83b7\u53d6\u6bcf\u53f0\u670d\u52a1\u5668\u7684\u65f6\u95f4 root@master:/opt# pssh -h ip.txt -i date [1] 12:12:15 [SUCCESS] node1 Wed Apr 10 21:12:15 PDT 2019 [2] 12:12:15 [SUCCESS] node2 Wed Apr 10 21:12:15 PDT 2019 [3] 12:12:15 [SUCCESS] node3 Wed Apr 10 21:12:15 PDT 2019 4.2 \u67e5\u770b\u8fdb\u7a0b \u00b6 \u67e5\u770b\u6bcf\u53f0\u670d\u52a1\u5668\u4e0amongo\u7ebf\u7a0b\u8fd0\u884c\u72b6\u6001\u4fe1\u606f\uff1a root@master:/opt# pssh -h ip.txt -i 'ps aux|grep mongo' [1] 12:13:35 [SUCCESS] node2 root 3578 0.0 0.1 19592 2920 ? Ss 21:13 0:00 bash -c ps aux|grep mongo root 3581 0.0 0.0 21264 944 ? S 21:13 0:00 grep mongo [2] 12:13:35 [SUCCESS] node3 root 3614 0.0 0.2 19592 2932 ? Ss 21:13 0:00 bash -c ps aux|grep mongo root 3617 0.0 0.0 21264 924 ? S 21:13 0:00 grep mongo [3] 12:13:35 [SUCCESS] node1 root 2549 0.0 0.3 19592 2996 ? Ss 21:13 0:00 bash -c ps aux|grep mongo root 2552 0.0 0.1 21264 1088 ? R 21:13 0:00 grep mongo root 9867 1.0 5.7 1689044 57016 ? Sl Apr05 87:23 mongod -f /app/mongo/services/shard1/mongod.conf root 9899 1.0 5.6 1647068 55948 ? Sl Apr05 86:21 mongod -f /app/mongo/services/shard2/mongod.conf root 9931 1.0 5.8 1740472 57288 ? Sl Apr05 91:04 mongod -f /app/mongo/services/shard3/mongod.conf root 9963 1.4 16.2 1747468 159736 ? Sl Apr05 122:25 mongod -f /app/mongo/services/configsvr/cfg.conf root 10221 0.4 1.2 291696 12804 ? Sl Apr05 37:41 mongos -f /app/mongo/services/mongos/mongos.conf 4.3 \u67e5\u770b\u6587\u4ef6 \u00b6 \u67e5\u770b/opt\u4e0b\u6587\u4ef6 root@master:/opt# pssh -h ip.txt -i 'ls /opt' [1] 12:15:20 [SUCCESS] node2 cloudera old [2] 12:15:20 [SUCCESS] node1 cloudera cloudera-manager [3] 12:15:20 [SUCCESS] node3 4.4 \u4e0a\u4f20\u6587\u4ef6 \u00b6 \u62f7\u8d1d\u672c\u5730\u6587\u4ef6\u5230\u8fdc\u7aef root@master:/opt# echo 'cmz' >cmz.txt root@master:/opt# pscp -h ip.txt cmz.txt /tmp/ [ 1 ] 12 :17:42 [ SUCCESS ] node2 [ 2 ] 12 :17:42 [ SUCCESS ] node1 [ 3 ] 12 :17:42 [ SUCCESS ] node3 root@master:/opt# pssh -h ip.txt -i 'ls /tmp/cmz.txt' [ 1 ] 12 :19:26 [ SUCCESS ] node1 /tmp/cmz.txt [ 2 ] 12 :19:26 [ SUCCESS ] node2 /tmp/cmz.txt [ 3 ] 12 :19:26 [ SUCCESS ] node3 /tmp/cmz.txt 4.5 \u4e0b\u8f7d\u6587\u4ef6 \u00b6 \u4ece\u8fdc\u7aef\u670d\u52a1\u5668\u6587\u4ef6\u4e0b\u8f7d\u5230\u672c\u5730 root@master:/opt# pslurp -h ip.txt -L /opt /tmp/cmz.txt new_cmz.conf [1] 12:42:40 [SUCCESS] node1 [2] 12:42:40 [SUCCESS] node2 [3] 12:42:40 [SUCCESS] node3 root@master:/opt# ls chain cloudera cloudera-manager ip.txt node1 node2 node3 pycharm-2018.3.1 teamviewer root@master:/opt# tree node1 node2 node3 node1 \u2514\u2500\u2500 new_cmz.conf node2 \u2514\u2500\u2500 new_cmz.conf node3 \u2514\u2500\u2500 new_cmz.conf 0 directories, 3 files \u4e0a\u8fb9\u662f\uff0c\u5c06\u6240\u6709\u8fdc\u7a0b\u4e3b\u673a /tmp/cmz.txt\u590d\u5236\u5230\u672c\u5730\u4e3b\u673a/home/\u76ee\u5f55\u4e0b\uff0c\u5e76\u4e14\u91cd\u65b0\u547d\u540d\u4e3anew_cmz.conf, -L \u6765\u6307\u5b9a\u672c\u5730\u6587\u4ef6\u8def\u5f84 4.6 \u4e0b\u8f7d\u76ee\u5f55 \u00b6 \u53ef\u4ee5\u4ece\u8fdc\u7aef\u4e0b\u8f7d\u6587\u4ef6\u5230\u672c\u5730 root@master:/opt# pslurp -h ip.txt -r -L /home/ /usr/local/mongo/ new_dir [1] 12:46:15 [SUCCESS] node1 [2] 12:46:18 [SUCCESS] node2 [3] 12:46:26 [SUCCESS] node3 root@master:/opt# ls /home/ cmz node1 node2 node3 root@master:/opt# ls /home/node1 new_dir root@master:/opt# ls /home/node2 new_dir root@master:/opt# ls /home/node3 new_dir \u53ef\u4ee5\u770b\u5230\u4ece\u8fdc\u7aef\u76f4\u63a5\u628a/usr/local/mongo\u7684\u6587\u4ef6\u5939\u4e0b\u8f7d\u5230\u672c\u5730\u6307\u5b9a\u76ee\u5f55 4.6 \u6740\u6b7b\u8fdb\u7a0b \u00b6 pnuke\u6740\u6389\u67d0\u4e00\u8fdb\u7a0b\uff0c\u8fd9\u4e2a\u547d\u4ee4\u7c7b\u4f3c killall\u547d\u4ee4 root@master:/opt# pssh -h ip.txt -i 'ps aux|grep mongo' [1] 12:36:32 [SUCCESS] node3 root 5746 1.1 7.3 1498580 72724 ? Sl 21:22 0:09 mongod -f /app/mongo/services/shard1/mongod.conf root 5839 1.0 7.3 1482928 72160 ? Sl 21:22 0:09 mongod -f /app/mongo/services/shard2/mongod.conf root 5952 1.0 7.5 1517928 74072 ? Sl 21:22 0:08 mongod -f /app/mongo/services/shard3/mongod.conf root 6049 1.2 7.6 1481008 75508 ? Sl 21:22 0:10 mongod -f /app/mongo/services/configsvr/cfg.conf root 7250 0.0 0.2 19592 2876 ? Ss 21:36 0:00 bash -c ps aux|grep mongo root 7253 0.0 0.0 21264 932 ? S 21:36 0:00 grep mongo [2] 12:36:36 [SUCCESS] node2 root 6167 1.2 3.8 1523968 78244 ? Sl 21:21 0:10 mongod -f /app/mongo/services/shard1/mongod.conf root 6235 1.1 3.6 1508944 74500 ? Sl 21:21 0:10 mongod -f /app/mongo/services/shard2/mongod.conf root 6354 1.1 3.6 1490268 72800 ? Sl 21:21 0:10 mongod -f /app/mongo/services/shard3/mongod.conf root 6440 1.5 4.0 1535304 80932 ? Sl 21:21 0:13 mongod -f /app/mongo/services/configsvr/cfg.conf root 6534 0.3 1.3 226804 27376 ? Sl 21:21 0:03 mongos -f /app/mongo/services/mongos/mongos.conf root 7757 0.0 0.1 19592 2952 ? Ss 21:36 0:00 bash -c ps aux|grep mongo root 7760 0.0 0.0 21264 956 ? S 21:36 0:00 grep mongo [3] 12:36:38 [SUCCESS] node1 root 5769 0.0 0.3 19592 2964 ? Ss 21:36 0:00 bash -c ps aux|grep mongo root 5772 0.0 0.1 21264 1012 ? S 21:36 0:00 grep mongo root 9867 1.0 7.4 1705464 72904 ? Sl Apr05 87:46 mongod -f /app/mongo/services/shard1/mongod.conf root 9899 1.0 6.6 1675796 65804 ? Sl Apr05 86:40 mongod -f /app/mongo/services/shard2/mongod.conf root 9931 1.0 7.0 1768172 69144 ? Sl Apr05 91:24 mongod -f /app/mongo/services/shard3/mongod.conf root 9963 1.4 17.3 1772084 171388 ? Sl Apr05 122:48 mongod -f /app/mongo/services/configsvr/cfg.conf root 10221 0.4 1.2 291696 12756 ? Sl Apr05 37:48 mongos -f /app/mongo/services/mongos/mongos.conf # \u6740\u6b7b\u8fdb\u7a0b root@master:/opt# pnuke -h ip.txt mongod [1] 12:37:01 [SUCCESS] node2 [2] 12:37:01 [SUCCESS] node1 [3] 12:37:01 [SUCCESS] node3 root@master:/opt# pssh -h ip.txt -i 'ps aux|grep mongo' [1] 12:37:05 [SUCCESS] node2 root 6534 0.3 1.3 226804 27376 ? Sl 21:21 0:03 mongos -f /app/mongo/services/mongos/mongos.conf root 7878 0.0 0.1 19592 2952 ? Ss 21:37 0:00 bash -c ps aux|grep mongo root 7881 0.0 0.0 21264 936 ? S 21:37 0:00 grep mongo [2] 12:37:05 [SUCCESS] node1 root 6021 0.0 0.3 19592 3000 ? Ss 21:37 0:00 bash -c ps aux|grep mongo root 6024 0.0 0.1 21264 1020 ? R 21:37 0:00 grep mongo root 10221 0.4 1.2 291696 12756 ? Sl Apr05 37:48 mongos -f /app/mongo/services/mongos/mongos.conf [3] 12:37:05 [SUCCESS] node3 root 7424 0.0 0.2 19592 2928 ? Ss 21:37 0:00 bash -c ps aux|grep mongo root 7427 0.0 0.0 21264 932 ? S 21:37 0:00 grep mongo \u4e0a\u8fb9\u7684\u610f\u601d\u662f\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u6279\u91cf\u5173\u95edmongo\u670d\u52a1\u3002\u80fd\u901a\u8fc7killall\u5173\u95ed\u7684\u670d\u52a1\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7pnuke\u6765\u6279\u91cf\u5b8c\u6210 \u5efa\u8bae\u5206\u53d1\u6587\u4ef6\uff0c\u6267\u884c\u547d\u4ee4\uff0c\u6279\u91cf\u6740\u6b7b\u8fdb\u7a0b\uff0c\u4f7f\u7528pssh,pscp\uff0cpnuke,\u901f\u5ea6\u5f88\u5feb\u7684 \u00b6","title":"2. pssh"},{"location":"tools/pssh/pssh.index/#1","text":"pssh\u547d\u4ee4\u662f\u4e00\u4e2apython\u7f16\u5199\u53ef\u4ee5\u5728\u591a\u53f0\u670d\u52a1\u5668\u4e0a\u6267\u884c\u547d\u4ee4\u7684\u5de5\u5177\uff0c\u540c\u65f6\u652f\u6301\u62f7\u8d1d\u6587\u4ef6\uff0c\u662f\u540c\u7c7b\u5de5\u5177\u4e2d\u5f88\u51fa\u8272\u7684\uff0c\u7c7b\u4f3cpdsh\uff0c\u4e2a\u4eba\u8ba4\u4e3a\u76f8\u5bf9pdsh\u66f4\u4e3a\u7b80\u4fbf\uff0c\u4f7f\u7528\u5fc5\u987b\u5728\u5404\u4e2a\u670d\u52a1\u5668\u4e0a\u914d\u7f6e\u597d\u5bc6\u94a5\u8ba4\u8bc1\u8bbf\u95ee\u3002","title":"1. \u8d77\u56e0"},{"location":"tools/pssh/pssh.index/#2","text":"","title":"2. \u90e8\u7f72"},{"location":"tools/pssh/pssh.index/#21","text":"# ubuntu apt-get install pssh -y # centos yum install pssh -y # mac brew install pssh -y","title":"2.1 \u5728\u7ebf\u88c5"},{"location":"tools/pssh/pssh.index/#22","text":"\u200b \u82e5\u662f\u6ca1\u6709\u7f51\u7edc\u7684\u673a\u5668\uff0c\u53ef\u4ee5\u9009\u62e9\u79bb\u7ebf\u5b89\u88c5\u3002 https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/parallel-ssh/pssh-2.3.1.tar.gz \u4e0b\u8f7d\u540e\u89e3\u7801\u538b\uff0c\u7136\u540e\u8fdb\u5165\u6e90\u7801\u76ee\u5f55\uff1a wget http://parallel-ssh.googlecode.com/files/pssh-2.3.1.tar.gz tar xf pssh-2.3.1.tar.gz cd pssh-2.3.1/ python setup.py install","title":"2.2 \u79bb\u7ebf\u5b89\u88c5"},{"location":"tools/pssh/pssh.index/#3","text":"pssh\u53c2\u6570 \u5e38\u89c1\u53c2\u6570 \u200b ```python root@master:~/pssh-2.3.1# pssh --help Usage: pssh [OPTIONS] command [...] Options: --version show program's version number and exit --help show this help message and exit -h HOST_FILE, --hosts=HOST_FILE hosts file (each line \"[user@]host[:port]\") -H HOST_STRING, --host=HOST_STRING additional host entries (\"[user@]host[:port]\") -l USER, --user=USER username (OPTIONAL) -p PAR, --par=PAR max number of parallel threads (OPTIONAL) -o OUTDIR, --outdir=OUTDIR output directory for stdout files (OPTIONAL) -e ERRDIR, --errdir=ERRDIR output directory for stderr files (OPTIONAL) -t TIMEOUT, --timeout=TIMEOUT timeout (secs) (0 = no timeout) per host (OPTIONAL) -O OPTION, --option=OPTION SSH option (OPTIONAL) -v, --verbose turn on warning and diagnostic messages (OPTIONAL) -A, --askpass Ask for a password (OPTIONAL) -x ARGS, --extra-args=ARGS Extra command-line arguments, with processing for spaces, quotes, and backslashes -X ARG, --extra-arg=ARG Extra command-line argument -i, --inline inline aggregated output and error for each server --inline-stdout inline standard output for each server -I, --send-input read from standard input and send as input to ssh -P, --print print output as we get it Example: pssh -h hosts.txt -l irb2 -o /tmp/foo uptime \u200b ``` \u4e2d\u6587\u89e3\u91ca --version\uff1a\u67e5\u770b\u7248\u672c --help\uff1a\u67e5\u770b\u5e2e\u52a9\uff0c\u5373\u6b64\u4fe1\u606f -h\uff1a\u4e3b\u673a\u6587\u4ef6\u5217\u8868\uff0c\u5185\u5bb9\u683c\u5f0f\u201d[user@]host[:port]\u201d -H\uff1a\u4e3b\u673a\u5b57\u7b26\u4e32\uff0c\u5185\u5bb9\u683c\u5f0f\u201d[user@]host[:port]\u201d -\uff1a\u767b\u5f55\u4f7f\u7528\u7684\u7528\u6237\u540d -p\uff1a\u5e76\u53d1\u7684\u7ebf\u7a0b\u6570\u3010\u53ef\u9009\u3011 -o\uff1a\u8f93\u51fa\u7684\u6587\u4ef6\u76ee\u5f55\u3010\u53ef\u9009\u3011 -e\uff1a\u9519\u8bef\u8f93\u5165\u6587\u4ef6\u3010\u53ef\u9009\u3011 -t\uff1aTIMEOUT \u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e\uff0c0\u65e0\u9650\u5236\u3010\u53ef\u9009\u3011 -O\uff1aSSH\u7684\u9009\u9879 -v\uff1a\u8be6\u7ec6\u6a21\u5f0f -A\uff1a\u624b\u52a8\u8f93\u5165\u5bc6\u7801\u6a21\u5f0f -x\uff1a\u989d\u5916\u7684\u547d\u4ee4\u884c\u53c2\u6570\u4f7f\u7528\u7a7a\u767d\u7b26\u53f7\uff0c\u5f15\u53f7\uff0c\u53cd\u659c\u7ebf\u5904\u7406 -X\uff1a\u989d\u5916\u7684\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u5355\u4e2a\u53c2\u6570\u6a21\u5f0f\uff0c\u540c-x -i\uff1a\u6bcf\u4e2a\u670d\u52a1\u5668\u5185\u90e8\u5904\u7406\u4fe1\u606f\u8f93\u51fa -P\uff1a\u6253\u5370\u51fa\u670d\u52a1\u5668\u8fd4\u56de\u4fe1\u606f","title":"3. \u57fa\u672c\u53c2\u6570"},{"location":"tools/pssh/pssh.index/#4","text":"\u6267\u884cpssh\u7684\u673a\u5668\u4e00\u5b9a\u8981\u5148\u505a\u597d\u7ebf\u6027\u5173\u7cfb(\u65e0\u5bc6\u7801\u94fe\u63a5) root@master:/opt# egrep -i 'node1|node2|node3' /etc/hosts 192.168.178.128 node3 192.168.178.129 node2 192.168.178.130 node1 \u914d\u7f6e\u4e00\u4e2a\u6587\u4ef6[\u540e\u9762pssh\u4f1a\u52a0\u8f7d\u8fd9\u4e2a\u6587\u4ef6]\uff0c\u91cc\u9762\u914d\u7f6e\u8fdc\u7aef\u7684\u673a\u5668 root@master:/opt# cat ip.txt node1 node2 node3","title":"4. \u57fa\u672c\u4f7f\u7528"},{"location":"tools/pssh/pssh.index/#41","text":"\u83b7\u53d6\u6bcf\u53f0\u670d\u52a1\u5668\u7684\u65f6\u95f4 root@master:/opt# pssh -h ip.txt -i date [1] 12:12:15 [SUCCESS] node1 Wed Apr 10 21:12:15 PDT 2019 [2] 12:12:15 [SUCCESS] node2 Wed Apr 10 21:12:15 PDT 2019 [3] 12:12:15 [SUCCESS] node3 Wed Apr 10 21:12:15 PDT 2019","title":"4.1 \u67e5\u770b\u65f6\u95f4"},{"location":"tools/pssh/pssh.index/#42","text":"\u67e5\u770b\u6bcf\u53f0\u670d\u52a1\u5668\u4e0amongo\u7ebf\u7a0b\u8fd0\u884c\u72b6\u6001\u4fe1\u606f\uff1a root@master:/opt# pssh -h ip.txt -i 'ps aux|grep mongo' [1] 12:13:35 [SUCCESS] node2 root 3578 0.0 0.1 19592 2920 ? Ss 21:13 0:00 bash -c ps aux|grep mongo root 3581 0.0 0.0 21264 944 ? S 21:13 0:00 grep mongo [2] 12:13:35 [SUCCESS] node3 root 3614 0.0 0.2 19592 2932 ? Ss 21:13 0:00 bash -c ps aux|grep mongo root 3617 0.0 0.0 21264 924 ? S 21:13 0:00 grep mongo [3] 12:13:35 [SUCCESS] node1 root 2549 0.0 0.3 19592 2996 ? Ss 21:13 0:00 bash -c ps aux|grep mongo root 2552 0.0 0.1 21264 1088 ? R 21:13 0:00 grep mongo root 9867 1.0 5.7 1689044 57016 ? Sl Apr05 87:23 mongod -f /app/mongo/services/shard1/mongod.conf root 9899 1.0 5.6 1647068 55948 ? Sl Apr05 86:21 mongod -f /app/mongo/services/shard2/mongod.conf root 9931 1.0 5.8 1740472 57288 ? Sl Apr05 91:04 mongod -f /app/mongo/services/shard3/mongod.conf root 9963 1.4 16.2 1747468 159736 ? Sl Apr05 122:25 mongod -f /app/mongo/services/configsvr/cfg.conf root 10221 0.4 1.2 291696 12804 ? Sl Apr05 37:41 mongos -f /app/mongo/services/mongos/mongos.conf","title":"4.2 \u67e5\u770b\u8fdb\u7a0b"},{"location":"tools/pssh/pssh.index/#43","text":"\u67e5\u770b/opt\u4e0b\u6587\u4ef6 root@master:/opt# pssh -h ip.txt -i 'ls /opt' [1] 12:15:20 [SUCCESS] node2 cloudera old [2] 12:15:20 [SUCCESS] node1 cloudera cloudera-manager [3] 12:15:20 [SUCCESS] node3","title":"4.3 \u67e5\u770b\u6587\u4ef6"},{"location":"tools/pssh/pssh.index/#44","text":"\u62f7\u8d1d\u672c\u5730\u6587\u4ef6\u5230\u8fdc\u7aef root@master:/opt# echo 'cmz' >cmz.txt root@master:/opt# pscp -h ip.txt cmz.txt /tmp/ [ 1 ] 12 :17:42 [ SUCCESS ] node2 [ 2 ] 12 :17:42 [ SUCCESS ] node1 [ 3 ] 12 :17:42 [ SUCCESS ] node3 root@master:/opt# pssh -h ip.txt -i 'ls /tmp/cmz.txt' [ 1 ] 12 :19:26 [ SUCCESS ] node1 /tmp/cmz.txt [ 2 ] 12 :19:26 [ SUCCESS ] node2 /tmp/cmz.txt [ 3 ] 12 :19:26 [ SUCCESS ] node3 /tmp/cmz.txt","title":"4.4 \u4e0a\u4f20\u6587\u4ef6"},{"location":"tools/pssh/pssh.index/#45","text":"\u4ece\u8fdc\u7aef\u670d\u52a1\u5668\u6587\u4ef6\u4e0b\u8f7d\u5230\u672c\u5730 root@master:/opt# pslurp -h ip.txt -L /opt /tmp/cmz.txt new_cmz.conf [1] 12:42:40 [SUCCESS] node1 [2] 12:42:40 [SUCCESS] node2 [3] 12:42:40 [SUCCESS] node3 root@master:/opt# ls chain cloudera cloudera-manager ip.txt node1 node2 node3 pycharm-2018.3.1 teamviewer root@master:/opt# tree node1 node2 node3 node1 \u2514\u2500\u2500 new_cmz.conf node2 \u2514\u2500\u2500 new_cmz.conf node3 \u2514\u2500\u2500 new_cmz.conf 0 directories, 3 files \u4e0a\u8fb9\u662f\uff0c\u5c06\u6240\u6709\u8fdc\u7a0b\u4e3b\u673a /tmp/cmz.txt\u590d\u5236\u5230\u672c\u5730\u4e3b\u673a/home/\u76ee\u5f55\u4e0b\uff0c\u5e76\u4e14\u91cd\u65b0\u547d\u540d\u4e3anew_cmz.conf, -L \u6765\u6307\u5b9a\u672c\u5730\u6587\u4ef6\u8def\u5f84","title":"4.5 \u4e0b\u8f7d\u6587\u4ef6"},{"location":"tools/pssh/pssh.index/#46","text":"\u53ef\u4ee5\u4ece\u8fdc\u7aef\u4e0b\u8f7d\u6587\u4ef6\u5230\u672c\u5730 root@master:/opt# pslurp -h ip.txt -r -L /home/ /usr/local/mongo/ new_dir [1] 12:46:15 [SUCCESS] node1 [2] 12:46:18 [SUCCESS] node2 [3] 12:46:26 [SUCCESS] node3 root@master:/opt# ls /home/ cmz node1 node2 node3 root@master:/opt# ls /home/node1 new_dir root@master:/opt# ls /home/node2 new_dir root@master:/opt# ls /home/node3 new_dir \u53ef\u4ee5\u770b\u5230\u4ece\u8fdc\u7aef\u76f4\u63a5\u628a/usr/local/mongo\u7684\u6587\u4ef6\u5939\u4e0b\u8f7d\u5230\u672c\u5730\u6307\u5b9a\u76ee\u5f55","title":"4.6 \u4e0b\u8f7d\u76ee\u5f55"},{"location":"tools/pssh/pssh.index/#46_1","text":"pnuke\u6740\u6389\u67d0\u4e00\u8fdb\u7a0b\uff0c\u8fd9\u4e2a\u547d\u4ee4\u7c7b\u4f3c killall\u547d\u4ee4 root@master:/opt# pssh -h ip.txt -i 'ps aux|grep mongo' [1] 12:36:32 [SUCCESS] node3 root 5746 1.1 7.3 1498580 72724 ? Sl 21:22 0:09 mongod -f /app/mongo/services/shard1/mongod.conf root 5839 1.0 7.3 1482928 72160 ? Sl 21:22 0:09 mongod -f /app/mongo/services/shard2/mongod.conf root 5952 1.0 7.5 1517928 74072 ? Sl 21:22 0:08 mongod -f /app/mongo/services/shard3/mongod.conf root 6049 1.2 7.6 1481008 75508 ? Sl 21:22 0:10 mongod -f /app/mongo/services/configsvr/cfg.conf root 7250 0.0 0.2 19592 2876 ? Ss 21:36 0:00 bash -c ps aux|grep mongo root 7253 0.0 0.0 21264 932 ? S 21:36 0:00 grep mongo [2] 12:36:36 [SUCCESS] node2 root 6167 1.2 3.8 1523968 78244 ? Sl 21:21 0:10 mongod -f /app/mongo/services/shard1/mongod.conf root 6235 1.1 3.6 1508944 74500 ? Sl 21:21 0:10 mongod -f /app/mongo/services/shard2/mongod.conf root 6354 1.1 3.6 1490268 72800 ? Sl 21:21 0:10 mongod -f /app/mongo/services/shard3/mongod.conf root 6440 1.5 4.0 1535304 80932 ? Sl 21:21 0:13 mongod -f /app/mongo/services/configsvr/cfg.conf root 6534 0.3 1.3 226804 27376 ? Sl 21:21 0:03 mongos -f /app/mongo/services/mongos/mongos.conf root 7757 0.0 0.1 19592 2952 ? Ss 21:36 0:00 bash -c ps aux|grep mongo root 7760 0.0 0.0 21264 956 ? S 21:36 0:00 grep mongo [3] 12:36:38 [SUCCESS] node1 root 5769 0.0 0.3 19592 2964 ? Ss 21:36 0:00 bash -c ps aux|grep mongo root 5772 0.0 0.1 21264 1012 ? S 21:36 0:00 grep mongo root 9867 1.0 7.4 1705464 72904 ? Sl Apr05 87:46 mongod -f /app/mongo/services/shard1/mongod.conf root 9899 1.0 6.6 1675796 65804 ? Sl Apr05 86:40 mongod -f /app/mongo/services/shard2/mongod.conf root 9931 1.0 7.0 1768172 69144 ? Sl Apr05 91:24 mongod -f /app/mongo/services/shard3/mongod.conf root 9963 1.4 17.3 1772084 171388 ? Sl Apr05 122:48 mongod -f /app/mongo/services/configsvr/cfg.conf root 10221 0.4 1.2 291696 12756 ? Sl Apr05 37:48 mongos -f /app/mongo/services/mongos/mongos.conf # \u6740\u6b7b\u8fdb\u7a0b root@master:/opt# pnuke -h ip.txt mongod [1] 12:37:01 [SUCCESS] node2 [2] 12:37:01 [SUCCESS] node1 [3] 12:37:01 [SUCCESS] node3 root@master:/opt# pssh -h ip.txt -i 'ps aux|grep mongo' [1] 12:37:05 [SUCCESS] node2 root 6534 0.3 1.3 226804 27376 ? Sl 21:21 0:03 mongos -f /app/mongo/services/mongos/mongos.conf root 7878 0.0 0.1 19592 2952 ? Ss 21:37 0:00 bash -c ps aux|grep mongo root 7881 0.0 0.0 21264 936 ? S 21:37 0:00 grep mongo [2] 12:37:05 [SUCCESS] node1 root 6021 0.0 0.3 19592 3000 ? Ss 21:37 0:00 bash -c ps aux|grep mongo root 6024 0.0 0.1 21264 1020 ? R 21:37 0:00 grep mongo root 10221 0.4 1.2 291696 12756 ? Sl Apr05 37:48 mongos -f /app/mongo/services/mongos/mongos.conf [3] 12:37:05 [SUCCESS] node3 root 7424 0.0 0.2 19592 2928 ? Ss 21:37 0:00 bash -c ps aux|grep mongo root 7427 0.0 0.0 21264 932 ? S 21:37 0:00 grep mongo \u4e0a\u8fb9\u7684\u610f\u601d\u662f\u5728\u8fdc\u7a0b\u4e3b\u673a\u4e0a\u6279\u91cf\u5173\u95edmongo\u670d\u52a1\u3002\u80fd\u901a\u8fc7killall\u5173\u95ed\u7684\u670d\u52a1\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7pnuke\u6765\u6279\u91cf\u5b8c\u6210","title":"4.6 \u6740\u6b7b\u8fdb\u7a0b"},{"location":"tools/pssh/pssh.index/#psshpscppnuke","text":"","title":"\u5efa\u8bae\u5206\u53d1\u6587\u4ef6\uff0c\u6267\u884c\u547d\u4ee4\uff0c\u6279\u91cf\u6740\u6b7b\u8fdb\u7a0b\uff0c\u4f7f\u7528pssh,pscp\uff0cpnuke,\u901f\u5ea6\u5f88\u5feb\u7684"},{"location":"tools/script_scriptreplay/1.index/","text":"cript\u547d\u4ee4\u7b80\u4ecb \u5f53\u4f60\u5728\u7ec8\u7aef\u6216\u63a7\u5236\u53f0\u4e0a\u5de5\u4f5c\u65f6\uff0c\u4f60\u53ef\u80fd\u60f3\u8bb0\u5f55\u4e0b\u81ea\u5df1\u505a\u4e86\u4e9b\u4ec0\u4e48\u3002\u8fd9\u79cd\u8bb0\u5f55\u53ef\u4ee5\u770b\u6210\u662f\u4fdd\u5b58\u4e86\u7ec8\u7aef\u75d5\u8ff9\u7684\u6587\u6863\u3002\u5047\u8bbe\u4f60\u8ddf\u4e00\u4e9bLinux\u7ba1\u7406\u5458\u540c\u65f6\u5728\u7cfb\u7edf\u4e0a\u5e72\u6d3b\u3002\u6216\u8005\u8bf4\u4f60\u8ba9\u522b\u4eba\u8fdc\u7a0b\u5230\u4f60\u7684\u670d\u52a1\u5668\u3002\u4f60\u5c31\u4f1a\u60f3\u8bb0\u5f55\u4e0b\u7ec8\u7aef\u53d1\u751f\u8fc7\u4ec0\u4e48\u3002\u8981\u5b9e\u73b0\u5b83\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528script\u547d\u4ee4\u3002 2.1 \u4ec0\u4e48script\u547d\u4ee4 \u00b6 script \u662f\u4e00\u4e2a\u795e\u5947\u547d\u4ee4\uff0c\u53ef\u4ee5\u4f7f\u7528script\u5de5\u5177\u8bb0\u5f55\u7528\u6237\u5728\u5f53\u524d\u7ec8\u7aef\u7684\u6240\u6709\u7684\u64cd\u4f5c\uff0c\u5df2\u7ecf\u8f93\u51fa\u5230\u5c4f\u5e55\u7684\u5185\u5bb9\u3002\u5c06\u8fd9\u4e9b\u4fe1\u606f\u4fdd\u5b58\u5230\u6307\u5b9a\u7684\u6587\u672c\u6587\u4ef6\u4e2d\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0cscript\u547d\u4ee4\u5728\u4f60\u9700\u8981\u8bb0\u5f55\u6216\u8005\u5b58\u6863\u7ec8\u7aef\u6d3b\u52a8\u65f6\u53ef\u80fd\u5f88\u6709\u7528\uff0c\u8bb0\u5f55\u6587\u4ef6\u4f1a\u5b58\u50a8\u4e3a\u6587\u672c\u6587\u4ef6\uff0c\u6240\u4ee5\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u7528\u6587\u672c\u7f16\u8f91\u5668\u6253\u5f00\u3002 \u5728\u4f7f\u7528script\u547d\u4ee4\u5c06\u7ec8\u7aef\u7684\u4f1a\u8bdd\u8fc7\u7a0b\u5f55\u5236\u4e0b\u6765\u4e4b\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528 scriptreplay\u5c06\u5176\u5f55\u5236\u7684\u7ed3\u679c\u64ad\u653e\u7ed9\u4ed6\u4eba\u89c2\u770b\u3002 script \u7684\u597d\u5904\u5c31\u5728\u4e8e\u4f60\u5728\u7ec8\u7aef\u4e2d\u7684\u6240\u6709\u64cd\u4f5c\u3001\u6572\u8fc7\u7684\u547d\u4ee4\u548c\u6253\u5370\u51fa\u7684\u7ed3\u679c\u5b83\u90fd\u53ef\u4ee5\u539f\u539f\u672c\u672c\u5730\u8fdb\u884c\u5f55\u5236\u3002\u53ef\u4ee5\u5e94\u7528\u4e8e\u6559\u5b66\u3001\u6f14\u793a\u3001\u5ba1\u8ba1\u3002 2.2 script\u547d\u4ee4\u64cd\u4f5c \u00b6 \u4f7f\u7528 script --help \u547d\u4ee4\u6765\u67e5\u770b script\u547d\u4ee4\u7684\u7528\u6cd5 leco@leco:~$ script --help Usage: script [options] [file] Make a typescript of a terminal session. \u9009\u9879\uff1a -a, --append append the output -c, --command <command> run command rather than interactive shell -e, --return return exit code of the child process -f, --flush run flush after each write --force use output file even when it is a link -q, --quiet be quiet -t, --timing[=<file>] output timing data to stderr (or to FILE) -V, --version output version information and exit -h, --help display this help and exit For more details see script(1). \u89e3\u91ca -a\u9009\u9879 \u5728\u73b0\u6709\u8f93\u51fa\u5f55\u5236\u7684\u6587\u4ef6\u7684\u5185\u5bb9\u4e0a\u8ffd\u52a0\u65b0\u7684\u5185\u5bb9 -c\u9009\u9879 \u540e\u9762\u53ef\u4ee5\u52a0\u4e0a\u9700\u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u800c\u4e0d\u662f\u4ea4\u4e92\u5f0fshell\u4e0a\u6267\u884c\u7684\u547d\u4ee4 -r\u9009\u9879 \u5b50\u8fdb\u7a0b\u4e2d\u8fd4\u56de\u9000\u51fa\u4ee3\u7801 -f\u9009\u9879 \u5982\u679c\u9700\u8981\u5728\u8f93\u51fa\u5230\u65e5\u5fd7\u6587\u4ef6\u7684\u540c\u65f6\uff0c\u4e5f\u53ef\u4ee5\u67e5\u770b\u65e5\u5fd7\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u4f7f\u7528 -f \u53c2\u6570\u3002PS:\u53ef\u4ee5\u7528\u4e8e\u6559\u5b66,\u4e24\u4e2a\u547d\u4ee4\u884c\u63a5-f\u53ef\u4ee5\u5b9e\u65f6\u6f14\u793a -q\u9009\u9879 \u53ef\u4ee5\u4f7fscript\u547d\u4ee4\u4ee5\u9759\u9ed8\u6a21\u5f0f\u8fd0\u884c -t\u9009\u9879 \u6307\u660e\u8f93\u51fa\u5f55\u5236\u7684\u65f6\u95f4\u6570\u636e -V\u9009\u9879 \u8f93\u51fascript\u7684\u7248\u672c\u4fe1\u606f\uff0c\u7136\u540e\u9000\u51fa -h\u9009\u9879 \u8f93\u51fascript\u7684help\u4fe1\u606f\uff0c\u7136\u540e\u9000\u51fa [file] \u9009\u9879 1\u3001\u5f53file\u4e3a\u7a7a\u65f6\uff0c\u64cd\u4f5c\u5185\u5bb9\u5c06\u8bb0\u5f55\u5230\u5f53\u524d\u76ee\u5f55\u4e2d\u540d\u79f0\u4e3atypescript\u7684\u6587\u672c\u6587\u4ef6\u4e2d\u3002 root@leco:~/summer# ls # \u4e4b\u524d\u662f\u6ca1\u6709\u6587\u4ef6\u7684 root@leco:~/summer# script # \u542f\u52a8\uff0c\u9ed8\u8ba4\u4fdd\u5b58\u662ftypescript\u6587\u4ef6 \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a typescript root@leco:~/summer# exit #\u9000\u51fa exit \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a typescript root@leco:~/summer# ls typescript \u67e5\u770b\u5185\u5bb9 root@leco:~/summer# cat typescript \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 09\u65f656\u520656\u79d2 root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 09\u65f657\u520603\u79d2 2\u3001\u5982\u679c\u6307\u5b9afile\uff0c\u90a3\u4e48\u5c06\u628a\u7ec8\u7aef\u7684\u64cd\u4f5c\u5185\u5bb9\u8bb0\u5f55\u5230file\u6587\u4ef6\u4e2d\u3002 root@leco:~/summer# rm typescript # \u5220\u9664\u4e4b\u524d\u505a\u5b9e\u9a8c\u7684\u9ed8\u8ba4\u8f93\u51fa\u6587\u4ef6 root@leco:~/summer# ls root@leco:~/summer# script summerout.log # \u6307\u5b9a\u8f93\u51fa\u6587\u4ef6 \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a summerout.log root@leco:~/summer# ls # \u5f00\u59cb\u64cd\u4f5c summerout.log root@leco:~/summer# echo 'my love from summer' my love from summer root@leco:~/summer# exit # \u9000\u51fa exit \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a summerout.log root@leco:~/summer# ls # \u663e\u793a\u8bb0\u5f55\u7684\u6307\u5b9a\u6587\u4ef6\u5185\u5bb9 summerout.log root@leco:~/summer# cat summerout.log # \u67e5\u770b\u8bb0\u5f55\u7684\u5185\u5bb9\uff0c\u4ee5\u4e0b\u662f\u8bb0\u4fdd\u5b58\u4e86 \u64cd\u4f5c\u5386\u53f2 \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 09\u65f659\u520602\u79d2 root@leco:~/summer# ls summerout.log root@leco:~/summer# echo 'my love from summer' my love from summer root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 09\u65f659\u520625\u79d2 \u67e5\u770b\u7248\u672c root@leco:~/summer# script -V script\uff0c\u6765\u81ea util-linux 2.27.1 script -q \u9009\u9879 \u9759\u9ed8\u8f93\u51fa #1. \u4e0d\u5e26-q\u7684\u64cd\u4f5c root@leco:~/summer# ls root@leco:~/summer# script \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a typescript # \u6b64\u65f6\u4f1a\u63d0\u793a\u8fd9\u4e2a\u3002\u5e26-q\u5c31\u4e0d\u8f93\u51fa root@leco:~/summer# ls typescript root@leco:~/summer# echo 'hello' hello root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a typescript #2. \u5e26-q\u7684\u64cd\u4f5c root@leco:~/summer# ls typescript root@leco:~/summer# rm typescript root@leco:~/summer# ls root@leco:~/summer# script -q root@leco:~/summer# echo 'hello' hello root@leco:~/summer# exit exit root@leco:~/summer# ls typescript script -a \u9009\u9879 -a\u9009\u9879 \u5728\u73b0\u6709\u8f93\u51fa\u5f55\u5236\u7684\u6587\u4ef6\u7684\u5185\u5bb9\u4e0a\u8ffd\u52a0\u65b0\u7684\u5185\u5bb9 root@leco:~/summer# ls typescript root@leco:~/summer# rm typescript # \u5220\u9664\u4e4b\u524d\u64cd\u4f5c\u5386\u53f2 root@leco:~/summer# ls root@leco:~/summer# script # \u5f00\u59cb\u8bb0\u5f55 \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a typescript root@leco:~/summer# echo '123' 123 root@leco:~/summer# echo '345' 345 root@leco:~/summer# exit # \u9000\u51fa exit \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a typescript root@leco:~/summer# ls typescript root@leco:~/summer# cat typescript # \u67e5\u770b\u64cd\u4f5c\u5386\u53f2 \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f607\u520656\u79d2 root@leco:~/summer# echo '123' 123 root@leco:~/summer# echo '345' 345 root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f608\u520608\u79d2 # \u4ee5\u4e0a\u90fd\u662f\u7b2c\u4e00\u6b21\u64cd\u4f5c\u7684\u5386\u53f2\u2018 root@leco:~/summer# script -a # \u5f00\u59cb\u7b2c\u4e8c\u6b21\uff0c\u4e5f\u5c31\u662f-a \u5c31\u662f\u8ffd\u52a0\u5185\u5bb9\u5230\u7b2c\u4e00\u6b21\u64cd\u4f5c\u6587\u4ef6\u4e2d \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a typescript root@leco:~/summer# echo '\u7b2c\u4e8c\u6b21\u64cd\u4f5c123' \u7b2c\u4e8c\u6b21\u64cd\u4f5c123 root@leco:~/summer# echo '\u7b2c\u4e8c\u6b21\u64cd\u4f5c456' \u7b2c\u4e8c\u6b21\u64cd\u4f5c456 root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a typescript root@leco:~/summer# ls typescript root@leco:~/summer# cat typescript \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f607\u520656\u79d2 root@leco:~/summer# echo '123' 123 root@leco:~/summer# echo '345' 345 root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f608\u520608\u79d2 \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f608\u520620\u79d2 root@leco:~/summer# echo '\u7b2c\u4e8c\u6b21\u64cd\u4f5c123' \u7b2c\u4e8c\u6b21\u64cd\u4f5c123 root@leco:~/summer# echo '\u7b2c\u4e8c\u6b21\u64cd\u4f5c456' \u7b2c\u4e8c\u6b21\u64cd\u4f5c456 root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f608\u520635\u79d2 script -t \u9009\u9879 -t\u9009\u9879 \u6307\u660e\u8f93\u51fa\u5f55\u5236\u7684\u65f6\u95f4\u6570\u636e root@leco:~/summer# ls root@leco:~/summer# script -t 2>datas.time -aq commands.his root@leco:~/summer# echo '123' 123 root@leco:~/summer# echo '456' 456 root@leco:~/summer# exit exit root@leco:~/summer# ls commands.his datas.time root@leco:~/summer# cat commands.his \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f616\u520638\u79d2 root@leco:~/summer# echo '123' 123 root@leco:~/summer# echo '456' 456 root@leco:~/summer# exit exit root@leco:~/summer# cat datas.time 0.016874 44 1.117511 4 0.213036 12 0.189993 8 0.639560 2 0.000082 5 0.000225 44 0.316049 10 0.155868 16 0.388290 12 0.719740 2 0.000032 5 0.000301 44 1.598040 1 0.222087 1 0.368449 1 0.256182 1 0.269758 2 0.000071 6 root@leco:~/summer# \u89e3\u91ca \u9009\u9879-t\u7528\u4e8e\u5b58\u50a8\u65f6\u5e8f\u6587\u4ef6\uff0c\u8fd9\u91cc\u5bfc\u5165\u5230stderr\uff0c\u518d\u91cd\u5b9a\u5411\u5230datas.time\uff0c \u9009\u9879-a\u7528\u4e8e\u5c06\u547d\u4ee4\u8f93\u51fa\u4fe1\u606f\uff0c\u8ffd\u52a0\u5230commands.his\u6587\u4ef6\u3002 \u8fd9\u6837\u5f55\u5236\u89c6\u5c4f\u5c31\u5f88\u65b9\u4fbf\u5566\uff0c\u800c\u4e14\u8fd9\u4e24\u4e2a\u6587\u4ef6\u5f88\u5c0f\uff0c\u53ef\u4ee5\u62f7\u8d1d\u5230\u9700\u8981\u64ad\u653e\u7684\u673a\u5668\u4e0a\u8fdb\u884c\u64ad\u653e\u3002 \u4ee5\u4e0a\u662f\u5f55\u5236\uff0c\u4e0b\u9762\u5f00\u59cb\u56de\u653e\u4e4b\u524d\u64cd\u4f5c # \u56de\u653e\u547d\u4ee4\uff0c\u63a5\u4e0b\u6765\u540e\u9762\u5c31\u50cf\u653e\u7535\u5f71\u4e00\u6837\uff0c\u91cd\u590d\u4f60\u4e4b\u524d\u64cd\u4f5c\uff0c\u81ea\u5df1\u64cd\u4f5c\u4e00\u6ce2\uff0c\u4f53\u4f1a\u6548\u679c root@leco:~/summer# scriptreplay datas.time commands.his root@leco:~/summer# echo '123' 123 root@leco:~/summer# echo '456' 456 root@leco:~/summer# exit exit \u6ce8\u610f: scriptreplay \u540e\u9762\u6570\u636e\u6587\u4ef6\uff0c\u540e\u547d\u4ee4\u6587\u4ef6 script -f \u9009\u9879 -f\u9009\u9879 \u5982\u679c\u9700\u8981\u5728\u8f93\u51fa\u5230\u65e5\u5fd7\u6587\u4ef6\u7684\u540c\u65f6\uff0c\u4e5f\u53ef\u4ee5\u67e5\u770b\u65e5\u5fd7\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u4f7f\u7528 -f \u53c2\u6570\u3002PS:\u53ef\u4ee5\u7528\u4e8e\u6559\u5b66,\u4e24\u4e2a\u547d\u4ee4\u884c\u63a5-f\u53ef\u4ee5\u5b9e\u65f6\u6f14\u793a root@leco:~/summer# ls root@leco:~/summer# script -t 2>datas.time -a commands.his \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a commands.his root@leco:~/summer# echo '\u5f00\u59cb\u6559\u5b66\u4e86' \u5f00\u59cb\u6559\u5b66\u4e86 root@leco:~/summer# script -f \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a typescript root@leco:~/summer# echo '\u4f60\u5728\u8ba4\u771f\u770b\u5417' \u4f60\u5728\u8ba4\u771f\u770b\u5417 \u4f7f\u7528script -f \u5b9e\u65f6\u5237\u65b0\u6570\u636e\uff0c\u8bb0\u5f55\u6587\u4ef6\u5206\u522b\u4e3acommands.his\u548cdatas.time script -c \u9009\u9879 -c\u9009\u9879 \u540e\u9762\u53ef\u4ee5\u52a0\u4e0a\u9700\u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u800c\u4e0d\u662f\u4ea4\u4e92\u5f0fshell\u4e0a\u6267\u884c\u7684\u547d\u4ee4 root@leco:~/summer# script -a \"commands.his\" -c \"ifconfig|grep 192.168.5.110\" \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a commands.his inet \u5730\u5740:192.168.5.110 \u5e7f\u64ad:192.168.5.255 \u63a9\u7801:255.255.255.0 \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a commands.his root@leco:~/summer# exit exit root@leco:~/summer# ls commands.his root@leco:~/summer# cat commands.his \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f634\u520658\u79d2 inet \u5730\u5740:192.168.5.110 \u5e7f\u64ad:192.168.5.255 \u63a9\u7801:255.255.255.0 \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f634\u520658\u79d2 2.3 \u9000\u51fascript \u00b6 \u8981\u9000\u51fa\u8bb0\u5f55\u6d3b\u52a8\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u7ec8\u7aef\u4e2d\u6309\u4e0bCtrl+D\uff0c\u6216\u8005\u8f93\u5165exit\u3002\u5728\u9000\u51fascript\u524d\uff0c\u4f60\u4f1a\u53d1\u73b0\u8bb0\u5f55\u6587\u4ef6\u7684\u5927\u5c0f\u4e3a0 Kb\uff0c\u800c\u5728\u9000\u51fa\u4e4b\u540e\uff0c\u6587\u4ef6\u5927\u5c0f\u4f1a\u53d1\u751f\u6539\u53d8\u3002 \u8bb0\u5f55\u5386\u53f2\u7684\u6587\u4ef6\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u90fd\u662f0\u5b57\u8282\uff0c\u9000\u51fa\u7684\u65f6\u5019\u624d\u5199\u5165\u8be5\u6587\u4ef6\u3002 root@leco:~/summer# script exit.his \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a exit.his root@leco:~/summer# ls exit.his root@leco:~/summer# echo '123' 123 root@leco:~/summer# du -sh exit.his 0 exit.his root@leco:~/summer# echo '12312' 12312 root@leco:~/summer# du -sh exit.his 0 exit.his root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a exit.his root@leco:~/summer# du -sh exit.his 4.0K exit.his root@leco:~/summer# cat exit.his \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f637\u520644\u79d2 root@leco:~/summer# ls exit.his root@leco:~/summer# echo '123' 123 root@leco:~/summer# du -sh exit.his 0 exit.his root@leco:~/summer# echo '12312' 12312 root@leco:~/summer# du -sh exit.his 0 exit.his root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f638\u520605\u79d2 \u4e09\u3001Script\u547d\u4ee4\u7ed3\u5408\u5b9e\u9645\u4f7f\u7528\u573a\u666f \u00b6 3.1 \u6848\u4f8b1 \u5b9a\u65f6\u5907\u4efd \u00b6 \u5148\u5728\u7ec8\u7aef\u6267\u884cscript\u547d\u4ee4\u8bb0\u5f55scp\u547d\u4ee4\u8fc7\u7a0b\uff0c\u5148\u5728\u7ec8\u7aef\u6572\u4e2a\u547d\u4ee4 script datas.his -c 'sh for.sh' \u6211\u662f\u8bb0\u5f55\u6211\u811a\u672c\u7684\u6267\u884c\u8fc7\u7a0b\u7684\u8bb0\u5f55\u3002 root@leco:~/summer# ls for.sh root@leco:~/summer# cat for.sh for((i=0;i<10;i++)) do echo $i done root@leco:~/summer# script datas.his -c 'sh for.sh' \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a datas.his 0 1 2 3 4 5 6 7 8 9 \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a datas.his root@leco:~/summer# ls datas.his for.sh root@leco:~/summer# cat datas.his # \u67e5\u770b\u5386\u53f2\u8bb0\u5f55 \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f641\u520652\u79d2 0 1 2 3 4 5 6 7 8 9 \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f641\u520652\u79d2 script\u8bb0\u5f55\u6574\u4e2a\u8fc7\u7a0b\u7ed3\u675f\u3002 \u4ece\u7ed3\u679c\u6765\u770b\uff0c\u6574\u4e2a\u8fc7\u7a0b\u4f7f\u7528script\u547d\u4ee4\u8bb0\u5f55\u662f\u6ca1\u6709\u95ee\u9898\u7684 \u770b\u4e0b\u4ee5\u4e0b\u5b9e\u4f8b auto_backup_to_remote.sh #!/bin/bash # gitlab \u673a\u623f\u5907\u4efd\u8def\u5f84 LocalBackDir=/data/gitlabData/backups # \u8fdc\u7a0b\u5907\u4efd\u670d\u52a1\u5668(FTP\u670d\u52a1\u5668) gitlab\u5907\u4efd\u6587\u4ef6\u5b58\u653e\u8def\u5f84 RemoteBackDir=/data/gitlabDataBackup # \u8fdc\u7a0b\u5907\u4efd\u670d\u52a1\u5668 \u767b\u5f55\u8d26\u6237 RemoteUser=root # \u8fdc\u7a0b\u673a\u623f\u4ee3\u7801\u5907\u4efd\u670d\u52a1\u5668IP\u5730\u5740 RemoteIP1=\u8fdc\u7a0b\u670d\u52a1\u5668IP\u5730\u5740 #\u5f53\u524d\u7cfb\u7edf\u65e5\u671f DATE=`date +\"%Y-%m-%d\"` #Log\u5b58\u653e\u8def\u5f84 LogFile=$LocalBackDir/log/$DATE.log #\u90ae\u4ef6\u5199\u5165\u7684\u6587\u4ef6 mailcontent=$LocalBackDir/mail/mailcontent_$DATE mailToUser=ouyangpeng\u7684\u90ae\u7bb1 mailToUser1=\u9886\u5bfc1\u7684\u90ae\u7bb1 mailToUser2=\u9886\u5bfc2\u7684\u90ae\u7bb1 #\u65b0\u5efa\u65e5\u5fd7\u6587\u4ef6 touch $LogFile #\u8ffd\u52a0\u65e5\u5fd7\u5230\u65e5\u5fd7\u6587\u4ef6 echo \"Gitlab auto backup to remote server, start at $(date +\"%Y-%m-%d %H:%M:%S\")\" > $LogFile echo \"---------------------------------------------------------------------------\" >> $LogFile # \u67e5\u627e \u672c\u5730\u5907\u4efd\u76ee\u5f55\u4e0b \u65f6\u95f4\u4e3a180\u5206\u949f\u4e4b\u5185\u7684\uff0c\u5e76\u4e14\u540e\u7f00\u4e3a.tar\u7684gitlab\u5907\u4efd\u6587\u4ef6 BACKUPFILE_SEND_TO_REMOTE=$(find /data/gitlabData/backups -type f -mmin -180 -name '*.tar*') # \u8f93\u51fa\u65e5\u5fd7\uff0c\u6253\u5370\u51fa\u6bcf\u6b21scp\u7684\u6587\u4ef6\u540d echo \"---------------------The file to scp to remote server is: $BACKUPFILE_SEND_TO_REMOTE-------------------------------\" >> $LogFile #\u5907\u4efd\u5230 \u8fdc\u7a0b\u673a\u623f\u4ee3\u7801\u5907\u4efd\u670d\u52a1\u5668 scp -v $BACKUPFILE_SEND_TO_REMOTE $RemoteUser@$RemoteIP1:$RemoteBackDir # $?\u7b26\u53f7\u663e\u793a\u4e0a\u4e00\u6761\u547d\u4ee4\u7684\u8fd4\u56de\u503c\uff0c\u5982\u679c\u4e3a0\u5219\u4ee3\u8868\u6267\u884c\u6210\u529f\uff0c\u5176\u4ed6\u8868\u793a\u5931\u8d25 if [ $? -eq 0 ];then #\u8ffd\u52a0\u65e5\u5fd7\u5230\u65e5\u5fd7\u6587\u4ef6 echo \"-----------------------------------Success!----------------------------------------\" >> $LogFile echo \"Gitlab auto backup to remote server, end at $(date +\"%Y-%m-%d %H:%M:%S\")\" >> $LogFile #\u5199Email\u7684\u6b63\u6587\u5185\u5bb9 > \"$mailcontent\" echo \"GitLab Backup Daily Report, backup to remote server Success ! Please Check your Email and read the following log file\" >> $mailcontent #\u8bfb\u53d6mailcontent\u5185\u5bb9\u5f53\u505a\u90ae\u4ef6\u6b63\u6587 \uff0c\u9644\u4ef6\u4e3aLog\u6587\u4ef6 #cat $mailcontent | mail -s \"Congratulation! GitLab backup to remote server Success Report.\" -t $mailToUser $mailToUser1 $mailToUser2 -A $LogFile #\u6210\u529f\u7684\u8bdd\uff0c\u53ea\u53d1\u9001\u7ed9\u6211\u4e00\u4e2a\u4eba\u5373\u53ef\uff0c\u4e0d\u9700\u8981\u53d1\u9001\u7ed9\u5176\u4ed6\u4eba cat $mailcontent | mail -s \"Congratulation! GitLab backup to remote server Success Report.\" $mailToUser -A $LogFile else #\u8ffd\u52a0\u65e5\u5fd7\u5230\u65e5\u5fd7\u6587\u4ef6 echo \"-----------------------------------Failed!---------------------------------------\" >> $LogFile echo \"Gitlab auto backup to remote server failed at $(date +\"%Y-%m-%d %H:%M:%S\")\" >> $LogFile #\u5199Email\u7684\u6b63\u6587\u5185\u5bb9 > \"$mailcontent\" echo \"GitLab Backup Daily Report,Backup to remote server Failed ! Please Check your Email and read the following log file !\" >> $mailcontent #\u8bfb\u53d6mailcontent\u5185\u5bb9\u5f53\u505a\u90ae\u4ef6\u6b63\u6587 \uff0c\u9644\u4ef6\u4e3aLog\u6587\u4ef6 cat $mailcontent | mail -s \"Warning! GitLab Backup to remote server Failed Report.\" -t $mailToUser $mailToUser1 $mailToUser2 -A $LogFile fi auto_backup_to_remote_script.sh*\u6587\u4ef6\u6e90\u4ee3\u7801\u662f #!/bin/bash # gitlab \u673a\u623f\u5907\u4efd\u8def\u5f84 LocalBackDir=/data/gitlabData/backups #\u5f53\u524d\u7cfb\u7edf\u65e5\u671f DATE=`date +\"%Y-%m-%d\"` #Log\u5b58\u653e\u8def\u5f84 LogFile=$LocalBackDir/log/$DATE.log #Script\u547d\u4ee4\u8bb0\u5f55\u7684\u5b58\u653e\u8def\u5f84\u548c\u6587\u4ef6\u540d ScriptLogFile=$LocalBackDir/script_log/$DATE.log ScriptTimeFile=$LocalBackDir/script_log/$DATE.date #\u65b0\u5efa\u65e5\u5fd7\u6587\u4ef6 touch $ScriptLogFile touch $ScriptTimeFile #\u5f00\u59cb\u542f\u52a8script\u8bb0\u5f55\u6574\u4e2a\u8fc7\u7a0b\uff0c\u6267\u884c /data/gitlabData/backups/auto_backup_to_remote.sh \u811a\u672c script -a $ScriptLogFile -c\"/data/gitlabData/backups/auto_backup_to_remote.sh\" \u8fd9\u6837\u5c31\u53ef\u4ee5\u4e86\uff0c\u7136\u540e\u5c06\u539f\u6765\u7684\u5b9a\u65f6\u4efb\u52a1\u6267\u884c\u7684\u811a\u672c\u6587\u4ef6\u4fee\u6539\u4e0b\u5373\u53ef\u3002 crontab -e # edited by summer 2019-01-23 \u6dfb\u52a0\u5b9a\u65f6\u4efb\u52a1\uff0c\u6bcf\u5929\u51cc\u66681\u70b9\uff0c\u6267\u884cgitlab\u5907\u4efd\u5230\u8fdc\u7a0b\u670d\u52a1\u5668 0 1 * * * /bin/bash /scripts/gitlab/auto_backup_to_remote_script.sh 3.2 \u6848\u4f8b2 \u670d\u52a1\u5668\u5b89\u5168\u5ba1\u8ba1 \u00b6 \u76f4\u63a5\u64cd\u4f5c\u7ebf\u4e0a\u7684\u670d\u52a1\u5668\u6709\u5f88\u5927\u9690\u60a3\uff0c\u6240\u4ee5\u4e00\u822c\u90fd\u662f\u901a\u8fc7\u767b\u5f55\u8df3\u677f\u673a\uff0c\u7136\u540e\u8fde\u63a5\u7ebf\u4e0a\u670d\u52a1\u5668\uff0c\u8df3\u677f\u673a\u53ef\u4ee5\u8bbf\u95ee\u63a7\u5236\u548c\u5b89\u5168\u5ba1\u8ba1\uff0c\u67e5\u770b\u8bb0\u5f55\u6bcf\u4e2a\u4eba\u5bf9\u7ebf\u4e0a\u670d\u52a1\u5668\u7684\u64cd\u4f5c \u7528\u6237\u5bb6\u76ee\u5f55\u4e0b,\u4fee\u6539\u73af\u5883\u53d8\u91cf\uff0c\u4f7f\u5f97\u7528\u6237\u767b\u5f55\u5c31\u4f1a\u89e6\u53d1\u5f55\u50cf root@leco:/datas/commands# tail -1 /etc/profile script -t -f -q 2>/datas/commands/$USER-$UID-`date +%Y%m%d%H%M%S`.time -a /datas/commands/$USER-$UID-`date +%Y%m%d%H%M%S`.his root@leco:/datas/commands# chmod 777 /datas/commands/ root@leco:/datas/commands# ls root@leco:/datas/commands# \u6b64\u65f6\u8fd8\u6ca1\u6709\u65e5\u5fd7\uff0c\u63a5\u4e0b\u6765\uff0c\u91cd\u65b0\u767b\u5f55\u7528\u6237 \u6d4b\u8bd5\u767b\u5f55 \u65b0\u5f00\u4e00\u4e2a\u7ec8\u7aef *** \u9700\u8981\u91cd\u542f\u7cfb\u7edf *** Last login: Wed Jan 23 11:03:09 2019 from 192.168.5.1 leco@leco:~$ ip a|grep 192.168.5. inet 192.168.5.110/24 brd 192.168.5.255 scope global enp3s0 leco@leco:~$ echo 'hello' hello \u5728\u770b\u4fdd\u5b58\u7684\u6587\u4ef6 leco@leco:~$ root@leco:/datas/commands# ls leco-1000-20190123110350.his leco-1000-20190123110350.time # 1. \u5355\u72ec\u67e5\u770b \u547d\u4ee4\u5386\u53f2 root@leco:/datas/commands# cat leco-1000-20190123110350.his \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 11\u65f603\u520650\u79d2 leco@leco:~$ ip a|grep 192.168.5. inet 192.168.5.110/24 brd 192.168.5.255 scope global enp3s0 leco@leco:~$ echo 'hello' hello # \u67e5\u770b\u52a8\u6001\u5386\u53f2 root@leco:/datas/commands# scriptreplay leco-1000-20190123110350.time leco-1000-20190123110350.his leco@leco:~$ ip a|grep 192.168.5. inet 192.168.5.110/24 brd 192.168.5.255 scope global enp3s0 leco@leco:~$ echo 'hello' hello leco@leco:~$ \u81ea\u5df1\u64cd\u4f5c\uff0c\u67e5\u770b\u6548\u679c \u8fd9\u6837\u641e\u5b8c\u540e\uff0c\u53d1\u73b0\u6709\u4e00\u4e2a\u95ee\u9898\u662f\u6bcf\u6b21\u9000\u51fa\uff0c\u6211\u4e60\u60efCtrl+D\uff0c\u7136\u540e\u6309\u7b2c\u4e00\u904d\u505c\u6b62\u5f55\u50cf\uff0c\u7b2c\u4e8c\u904d\u624d\u80fd\u7528\u6237\u9000\u51fa\uff0c\u5982\u4f55\u89e3\u51b3\u5728\u540e\u9762\u6dfb\u52a0 if [ \"$SHLVL\" = 1 ]; then \u3000\u3000\u3000\u3000exit fi \u5b8c\u6574\u7248 root@leco:/datas/commands# tail -4 /etc/profile script -t -f -q 2>/datas/commands/$USER-$UID-`date +%Y%m%d%H%M%S`.time -a /datas/commands/$USER-$UID-`date +%Y%m%d%H%M%S`.his if [ \"$SHLVL\" = 1 ]; then exit fi \u8fd9\u6837\u5c31\u53ef\u4ee5\u4e00\u904dCtrl+D\u505c\u6b62\u5f55\u50cf\u548c\u9000\u51fa\u7528\u6237\u3002 \u533a\u522b SHLVL \u8fd9\u4e2a\u53d8\u91cf\u662f\u5e72\u4ec0\u4e48\u7684\uff1f shell\u4e2d\u7684 $SHLVL ,\u8bb0\u5f55\u5f53\u524dshell\u7684\u5d4c\u5957\u5c42\u6b21\uff0c\u521d\u59cb\u4e3a1 \u6bd4\u5982\u4e0b\u9762\u7684\u4f8b\u5b50\uff1a\u5f53\u524d\u662f\u5728\u7b2c1\u5c42\uff0c\u6267\u884cbash\u547d\u4ee4\u4e4b\u540e\uff0c $SHLVL \u53d8\u91cf\u53d8\u4e3a2 root@leco:/datas/commands# echo $SHLVL 1 root@leco:/datas/commands# bash root@leco:/datas/commands# echo $SHLVL 2 root@leco:/datas/commands# exit exit root@leco:/datas/commands# echo $SHLVL 1 \u4e0d\u77e5\u9053\u7684\u8bdd\uff0c\u53bb\u767e\u5ea6 SHLVL \u548c BASH_SUBSHELL \u4e24\u4e2a\u53d8\u91cf\u7684\u533a\u522b SHLVL \u548c BASH_SUBSHELL \u4e24\u4e2a\u53d8\u91cf\u7684\u533a\u522b\u53c2\u8003\u94fe\u63a5","title":"2. Linux\u7ec8\u7aef\u5f55\u5c4f\u548c\u56de\u653e"},{"location":"tools/script_scriptreplay/1.index/#21-script","text":"script \u662f\u4e00\u4e2a\u795e\u5947\u547d\u4ee4\uff0c\u53ef\u4ee5\u4f7f\u7528script\u5de5\u5177\u8bb0\u5f55\u7528\u6237\u5728\u5f53\u524d\u7ec8\u7aef\u7684\u6240\u6709\u7684\u64cd\u4f5c\uff0c\u5df2\u7ecf\u8f93\u51fa\u5230\u5c4f\u5e55\u7684\u5185\u5bb9\u3002\u5c06\u8fd9\u4e9b\u4fe1\u606f\u4fdd\u5b58\u5230\u6307\u5b9a\u7684\u6587\u672c\u6587\u4ef6\u4e2d\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0cscript\u547d\u4ee4\u5728\u4f60\u9700\u8981\u8bb0\u5f55\u6216\u8005\u5b58\u6863\u7ec8\u7aef\u6d3b\u52a8\u65f6\u53ef\u80fd\u5f88\u6709\u7528\uff0c\u8bb0\u5f55\u6587\u4ef6\u4f1a\u5b58\u50a8\u4e3a\u6587\u672c\u6587\u4ef6\uff0c\u6240\u4ee5\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u7528\u6587\u672c\u7f16\u8f91\u5668\u6253\u5f00\u3002 \u5728\u4f7f\u7528script\u547d\u4ee4\u5c06\u7ec8\u7aef\u7684\u4f1a\u8bdd\u8fc7\u7a0b\u5f55\u5236\u4e0b\u6765\u4e4b\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528 scriptreplay\u5c06\u5176\u5f55\u5236\u7684\u7ed3\u679c\u64ad\u653e\u7ed9\u4ed6\u4eba\u89c2\u770b\u3002 script \u7684\u597d\u5904\u5c31\u5728\u4e8e\u4f60\u5728\u7ec8\u7aef\u4e2d\u7684\u6240\u6709\u64cd\u4f5c\u3001\u6572\u8fc7\u7684\u547d\u4ee4\u548c\u6253\u5370\u51fa\u7684\u7ed3\u679c\u5b83\u90fd\u53ef\u4ee5\u539f\u539f\u672c\u672c\u5730\u8fdb\u884c\u5f55\u5236\u3002\u53ef\u4ee5\u5e94\u7528\u4e8e\u6559\u5b66\u3001\u6f14\u793a\u3001\u5ba1\u8ba1\u3002","title":"2.1 \u4ec0\u4e48script\u547d\u4ee4"},{"location":"tools/script_scriptreplay/1.index/#22-script","text":"\u4f7f\u7528 script --help \u547d\u4ee4\u6765\u67e5\u770b script\u547d\u4ee4\u7684\u7528\u6cd5 leco@leco:~$ script --help Usage: script [options] [file] Make a typescript of a terminal session. \u9009\u9879\uff1a -a, --append append the output -c, --command <command> run command rather than interactive shell -e, --return return exit code of the child process -f, --flush run flush after each write --force use output file even when it is a link -q, --quiet be quiet -t, --timing[=<file>] output timing data to stderr (or to FILE) -V, --version output version information and exit -h, --help display this help and exit For more details see script(1). \u89e3\u91ca -a\u9009\u9879 \u5728\u73b0\u6709\u8f93\u51fa\u5f55\u5236\u7684\u6587\u4ef6\u7684\u5185\u5bb9\u4e0a\u8ffd\u52a0\u65b0\u7684\u5185\u5bb9 -c\u9009\u9879 \u540e\u9762\u53ef\u4ee5\u52a0\u4e0a\u9700\u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u800c\u4e0d\u662f\u4ea4\u4e92\u5f0fshell\u4e0a\u6267\u884c\u7684\u547d\u4ee4 -r\u9009\u9879 \u5b50\u8fdb\u7a0b\u4e2d\u8fd4\u56de\u9000\u51fa\u4ee3\u7801 -f\u9009\u9879 \u5982\u679c\u9700\u8981\u5728\u8f93\u51fa\u5230\u65e5\u5fd7\u6587\u4ef6\u7684\u540c\u65f6\uff0c\u4e5f\u53ef\u4ee5\u67e5\u770b\u65e5\u5fd7\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u4f7f\u7528 -f \u53c2\u6570\u3002PS:\u53ef\u4ee5\u7528\u4e8e\u6559\u5b66,\u4e24\u4e2a\u547d\u4ee4\u884c\u63a5-f\u53ef\u4ee5\u5b9e\u65f6\u6f14\u793a -q\u9009\u9879 \u53ef\u4ee5\u4f7fscript\u547d\u4ee4\u4ee5\u9759\u9ed8\u6a21\u5f0f\u8fd0\u884c -t\u9009\u9879 \u6307\u660e\u8f93\u51fa\u5f55\u5236\u7684\u65f6\u95f4\u6570\u636e -V\u9009\u9879 \u8f93\u51fascript\u7684\u7248\u672c\u4fe1\u606f\uff0c\u7136\u540e\u9000\u51fa -h\u9009\u9879 \u8f93\u51fascript\u7684help\u4fe1\u606f\uff0c\u7136\u540e\u9000\u51fa [file] \u9009\u9879 1\u3001\u5f53file\u4e3a\u7a7a\u65f6\uff0c\u64cd\u4f5c\u5185\u5bb9\u5c06\u8bb0\u5f55\u5230\u5f53\u524d\u76ee\u5f55\u4e2d\u540d\u79f0\u4e3atypescript\u7684\u6587\u672c\u6587\u4ef6\u4e2d\u3002 root@leco:~/summer# ls # \u4e4b\u524d\u662f\u6ca1\u6709\u6587\u4ef6\u7684 root@leco:~/summer# script # \u542f\u52a8\uff0c\u9ed8\u8ba4\u4fdd\u5b58\u662ftypescript\u6587\u4ef6 \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a typescript root@leco:~/summer# exit #\u9000\u51fa exit \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a typescript root@leco:~/summer# ls typescript \u67e5\u770b\u5185\u5bb9 root@leco:~/summer# cat typescript \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 09\u65f656\u520656\u79d2 root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 09\u65f657\u520603\u79d2 2\u3001\u5982\u679c\u6307\u5b9afile\uff0c\u90a3\u4e48\u5c06\u628a\u7ec8\u7aef\u7684\u64cd\u4f5c\u5185\u5bb9\u8bb0\u5f55\u5230file\u6587\u4ef6\u4e2d\u3002 root@leco:~/summer# rm typescript # \u5220\u9664\u4e4b\u524d\u505a\u5b9e\u9a8c\u7684\u9ed8\u8ba4\u8f93\u51fa\u6587\u4ef6 root@leco:~/summer# ls root@leco:~/summer# script summerout.log # \u6307\u5b9a\u8f93\u51fa\u6587\u4ef6 \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a summerout.log root@leco:~/summer# ls # \u5f00\u59cb\u64cd\u4f5c summerout.log root@leco:~/summer# echo 'my love from summer' my love from summer root@leco:~/summer# exit # \u9000\u51fa exit \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a summerout.log root@leco:~/summer# ls # \u663e\u793a\u8bb0\u5f55\u7684\u6307\u5b9a\u6587\u4ef6\u5185\u5bb9 summerout.log root@leco:~/summer# cat summerout.log # \u67e5\u770b\u8bb0\u5f55\u7684\u5185\u5bb9\uff0c\u4ee5\u4e0b\u662f\u8bb0\u4fdd\u5b58\u4e86 \u64cd\u4f5c\u5386\u53f2 \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 09\u65f659\u520602\u79d2 root@leco:~/summer# ls summerout.log root@leco:~/summer# echo 'my love from summer' my love from summer root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 09\u65f659\u520625\u79d2 \u67e5\u770b\u7248\u672c root@leco:~/summer# script -V script\uff0c\u6765\u81ea util-linux 2.27.1 script -q \u9009\u9879 \u9759\u9ed8\u8f93\u51fa #1. \u4e0d\u5e26-q\u7684\u64cd\u4f5c root@leco:~/summer# ls root@leco:~/summer# script \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a typescript # \u6b64\u65f6\u4f1a\u63d0\u793a\u8fd9\u4e2a\u3002\u5e26-q\u5c31\u4e0d\u8f93\u51fa root@leco:~/summer# ls typescript root@leco:~/summer# echo 'hello' hello root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a typescript #2. \u5e26-q\u7684\u64cd\u4f5c root@leco:~/summer# ls typescript root@leco:~/summer# rm typescript root@leco:~/summer# ls root@leco:~/summer# script -q root@leco:~/summer# echo 'hello' hello root@leco:~/summer# exit exit root@leco:~/summer# ls typescript script -a \u9009\u9879 -a\u9009\u9879 \u5728\u73b0\u6709\u8f93\u51fa\u5f55\u5236\u7684\u6587\u4ef6\u7684\u5185\u5bb9\u4e0a\u8ffd\u52a0\u65b0\u7684\u5185\u5bb9 root@leco:~/summer# ls typescript root@leco:~/summer# rm typescript # \u5220\u9664\u4e4b\u524d\u64cd\u4f5c\u5386\u53f2 root@leco:~/summer# ls root@leco:~/summer# script # \u5f00\u59cb\u8bb0\u5f55 \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a typescript root@leco:~/summer# echo '123' 123 root@leco:~/summer# echo '345' 345 root@leco:~/summer# exit # \u9000\u51fa exit \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a typescript root@leco:~/summer# ls typescript root@leco:~/summer# cat typescript # \u67e5\u770b\u64cd\u4f5c\u5386\u53f2 \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f607\u520656\u79d2 root@leco:~/summer# echo '123' 123 root@leco:~/summer# echo '345' 345 root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f608\u520608\u79d2 # \u4ee5\u4e0a\u90fd\u662f\u7b2c\u4e00\u6b21\u64cd\u4f5c\u7684\u5386\u53f2\u2018 root@leco:~/summer# script -a # \u5f00\u59cb\u7b2c\u4e8c\u6b21\uff0c\u4e5f\u5c31\u662f-a \u5c31\u662f\u8ffd\u52a0\u5185\u5bb9\u5230\u7b2c\u4e00\u6b21\u64cd\u4f5c\u6587\u4ef6\u4e2d \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a typescript root@leco:~/summer# echo '\u7b2c\u4e8c\u6b21\u64cd\u4f5c123' \u7b2c\u4e8c\u6b21\u64cd\u4f5c123 root@leco:~/summer# echo '\u7b2c\u4e8c\u6b21\u64cd\u4f5c456' \u7b2c\u4e8c\u6b21\u64cd\u4f5c456 root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a typescript root@leco:~/summer# ls typescript root@leco:~/summer# cat typescript \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f607\u520656\u79d2 root@leco:~/summer# echo '123' 123 root@leco:~/summer# echo '345' 345 root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f608\u520608\u79d2 \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f608\u520620\u79d2 root@leco:~/summer# echo '\u7b2c\u4e8c\u6b21\u64cd\u4f5c123' \u7b2c\u4e8c\u6b21\u64cd\u4f5c123 root@leco:~/summer# echo '\u7b2c\u4e8c\u6b21\u64cd\u4f5c456' \u7b2c\u4e8c\u6b21\u64cd\u4f5c456 root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f608\u520635\u79d2 script -t \u9009\u9879 -t\u9009\u9879 \u6307\u660e\u8f93\u51fa\u5f55\u5236\u7684\u65f6\u95f4\u6570\u636e root@leco:~/summer# ls root@leco:~/summer# script -t 2>datas.time -aq commands.his root@leco:~/summer# echo '123' 123 root@leco:~/summer# echo '456' 456 root@leco:~/summer# exit exit root@leco:~/summer# ls commands.his datas.time root@leco:~/summer# cat commands.his \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f616\u520638\u79d2 root@leco:~/summer# echo '123' 123 root@leco:~/summer# echo '456' 456 root@leco:~/summer# exit exit root@leco:~/summer# cat datas.time 0.016874 44 1.117511 4 0.213036 12 0.189993 8 0.639560 2 0.000082 5 0.000225 44 0.316049 10 0.155868 16 0.388290 12 0.719740 2 0.000032 5 0.000301 44 1.598040 1 0.222087 1 0.368449 1 0.256182 1 0.269758 2 0.000071 6 root@leco:~/summer# \u89e3\u91ca \u9009\u9879-t\u7528\u4e8e\u5b58\u50a8\u65f6\u5e8f\u6587\u4ef6\uff0c\u8fd9\u91cc\u5bfc\u5165\u5230stderr\uff0c\u518d\u91cd\u5b9a\u5411\u5230datas.time\uff0c \u9009\u9879-a\u7528\u4e8e\u5c06\u547d\u4ee4\u8f93\u51fa\u4fe1\u606f\uff0c\u8ffd\u52a0\u5230commands.his\u6587\u4ef6\u3002 \u8fd9\u6837\u5f55\u5236\u89c6\u5c4f\u5c31\u5f88\u65b9\u4fbf\u5566\uff0c\u800c\u4e14\u8fd9\u4e24\u4e2a\u6587\u4ef6\u5f88\u5c0f\uff0c\u53ef\u4ee5\u62f7\u8d1d\u5230\u9700\u8981\u64ad\u653e\u7684\u673a\u5668\u4e0a\u8fdb\u884c\u64ad\u653e\u3002 \u4ee5\u4e0a\u662f\u5f55\u5236\uff0c\u4e0b\u9762\u5f00\u59cb\u56de\u653e\u4e4b\u524d\u64cd\u4f5c # \u56de\u653e\u547d\u4ee4\uff0c\u63a5\u4e0b\u6765\u540e\u9762\u5c31\u50cf\u653e\u7535\u5f71\u4e00\u6837\uff0c\u91cd\u590d\u4f60\u4e4b\u524d\u64cd\u4f5c\uff0c\u81ea\u5df1\u64cd\u4f5c\u4e00\u6ce2\uff0c\u4f53\u4f1a\u6548\u679c root@leco:~/summer# scriptreplay datas.time commands.his root@leco:~/summer# echo '123' 123 root@leco:~/summer# echo '456' 456 root@leco:~/summer# exit exit \u6ce8\u610f: scriptreplay \u540e\u9762\u6570\u636e\u6587\u4ef6\uff0c\u540e\u547d\u4ee4\u6587\u4ef6 script -f \u9009\u9879 -f\u9009\u9879 \u5982\u679c\u9700\u8981\u5728\u8f93\u51fa\u5230\u65e5\u5fd7\u6587\u4ef6\u7684\u540c\u65f6\uff0c\u4e5f\u53ef\u4ee5\u67e5\u770b\u65e5\u5fd7\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u4f7f\u7528 -f \u53c2\u6570\u3002PS:\u53ef\u4ee5\u7528\u4e8e\u6559\u5b66,\u4e24\u4e2a\u547d\u4ee4\u884c\u63a5-f\u53ef\u4ee5\u5b9e\u65f6\u6f14\u793a root@leco:~/summer# ls root@leco:~/summer# script -t 2>datas.time -a commands.his \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a commands.his root@leco:~/summer# echo '\u5f00\u59cb\u6559\u5b66\u4e86' \u5f00\u59cb\u6559\u5b66\u4e86 root@leco:~/summer# script -f \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a typescript root@leco:~/summer# echo '\u4f60\u5728\u8ba4\u771f\u770b\u5417' \u4f60\u5728\u8ba4\u771f\u770b\u5417 \u4f7f\u7528script -f \u5b9e\u65f6\u5237\u65b0\u6570\u636e\uff0c\u8bb0\u5f55\u6587\u4ef6\u5206\u522b\u4e3acommands.his\u548cdatas.time script -c \u9009\u9879 -c\u9009\u9879 \u540e\u9762\u53ef\u4ee5\u52a0\u4e0a\u9700\u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u800c\u4e0d\u662f\u4ea4\u4e92\u5f0fshell\u4e0a\u6267\u884c\u7684\u547d\u4ee4 root@leco:~/summer# script -a \"commands.his\" -c \"ifconfig|grep 192.168.5.110\" \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a commands.his inet \u5730\u5740:192.168.5.110 \u5e7f\u64ad:192.168.5.255 \u63a9\u7801:255.255.255.0 \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a commands.his root@leco:~/summer# exit exit root@leco:~/summer# ls commands.his root@leco:~/summer# cat commands.his \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f634\u520658\u79d2 inet \u5730\u5740:192.168.5.110 \u5e7f\u64ad:192.168.5.255 \u63a9\u7801:255.255.255.0 \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f634\u520658\u79d2","title":"2.2 script\u547d\u4ee4\u64cd\u4f5c"},{"location":"tools/script_scriptreplay/1.index/#23-script","text":"\u8981\u9000\u51fa\u8bb0\u5f55\u6d3b\u52a8\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u7ec8\u7aef\u4e2d\u6309\u4e0bCtrl+D\uff0c\u6216\u8005\u8f93\u5165exit\u3002\u5728\u9000\u51fascript\u524d\uff0c\u4f60\u4f1a\u53d1\u73b0\u8bb0\u5f55\u6587\u4ef6\u7684\u5927\u5c0f\u4e3a0 Kb\uff0c\u800c\u5728\u9000\u51fa\u4e4b\u540e\uff0c\u6587\u4ef6\u5927\u5c0f\u4f1a\u53d1\u751f\u6539\u53d8\u3002 \u8bb0\u5f55\u5386\u53f2\u7684\u6587\u4ef6\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u90fd\u662f0\u5b57\u8282\uff0c\u9000\u51fa\u7684\u65f6\u5019\u624d\u5199\u5165\u8be5\u6587\u4ef6\u3002 root@leco:~/summer# script exit.his \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a exit.his root@leco:~/summer# ls exit.his root@leco:~/summer# echo '123' 123 root@leco:~/summer# du -sh exit.his 0 exit.his root@leco:~/summer# echo '12312' 12312 root@leco:~/summer# du -sh exit.his 0 exit.his root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a exit.his root@leco:~/summer# du -sh exit.his 4.0K exit.his root@leco:~/summer# cat exit.his \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f637\u520644\u79d2 root@leco:~/summer# ls exit.his root@leco:~/summer# echo '123' 123 root@leco:~/summer# du -sh exit.his 0 exit.his root@leco:~/summer# echo '12312' 12312 root@leco:~/summer# du -sh exit.his 0 exit.his root@leco:~/summer# exit exit \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f638\u520605\u79d2","title":"2.3 \u9000\u51fascript"},{"location":"tools/script_scriptreplay/1.index/#script","text":"","title":"\u4e09\u3001Script\u547d\u4ee4\u7ed3\u5408\u5b9e\u9645\u4f7f\u7528\u573a\u666f"},{"location":"tools/script_scriptreplay/1.index/#31-1","text":"\u5148\u5728\u7ec8\u7aef\u6267\u884cscript\u547d\u4ee4\u8bb0\u5f55scp\u547d\u4ee4\u8fc7\u7a0b\uff0c\u5148\u5728\u7ec8\u7aef\u6572\u4e2a\u547d\u4ee4 script datas.his -c 'sh for.sh' \u6211\u662f\u8bb0\u5f55\u6211\u811a\u672c\u7684\u6267\u884c\u8fc7\u7a0b\u7684\u8bb0\u5f55\u3002 root@leco:~/summer# ls for.sh root@leco:~/summer# cat for.sh for((i=0;i<10;i++)) do echo $i done root@leco:~/summer# script datas.his -c 'sh for.sh' \u811a\u672c\u5df2\u542f\u52a8\uff0c\u6587\u4ef6\u4e3a datas.his 0 1 2 3 4 5 6 7 8 9 \u811a\u672c\u5b8c\u6210\uff0c\u6587\u4ef6\u4e3a datas.his root@leco:~/summer# ls datas.his for.sh root@leco:~/summer# cat datas.his # \u67e5\u770b\u5386\u53f2\u8bb0\u5f55 \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f641\u520652\u79d2 0 1 2 3 4 5 6 7 8 9 \u811a\u672c\u5b8c\u6210\uff0c\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 10\u65f641\u520652\u79d2 script\u8bb0\u5f55\u6574\u4e2a\u8fc7\u7a0b\u7ed3\u675f\u3002 \u4ece\u7ed3\u679c\u6765\u770b\uff0c\u6574\u4e2a\u8fc7\u7a0b\u4f7f\u7528script\u547d\u4ee4\u8bb0\u5f55\u662f\u6ca1\u6709\u95ee\u9898\u7684 \u770b\u4e0b\u4ee5\u4e0b\u5b9e\u4f8b auto_backup_to_remote.sh #!/bin/bash # gitlab \u673a\u623f\u5907\u4efd\u8def\u5f84 LocalBackDir=/data/gitlabData/backups # \u8fdc\u7a0b\u5907\u4efd\u670d\u52a1\u5668(FTP\u670d\u52a1\u5668) gitlab\u5907\u4efd\u6587\u4ef6\u5b58\u653e\u8def\u5f84 RemoteBackDir=/data/gitlabDataBackup # \u8fdc\u7a0b\u5907\u4efd\u670d\u52a1\u5668 \u767b\u5f55\u8d26\u6237 RemoteUser=root # \u8fdc\u7a0b\u673a\u623f\u4ee3\u7801\u5907\u4efd\u670d\u52a1\u5668IP\u5730\u5740 RemoteIP1=\u8fdc\u7a0b\u670d\u52a1\u5668IP\u5730\u5740 #\u5f53\u524d\u7cfb\u7edf\u65e5\u671f DATE=`date +\"%Y-%m-%d\"` #Log\u5b58\u653e\u8def\u5f84 LogFile=$LocalBackDir/log/$DATE.log #\u90ae\u4ef6\u5199\u5165\u7684\u6587\u4ef6 mailcontent=$LocalBackDir/mail/mailcontent_$DATE mailToUser=ouyangpeng\u7684\u90ae\u7bb1 mailToUser1=\u9886\u5bfc1\u7684\u90ae\u7bb1 mailToUser2=\u9886\u5bfc2\u7684\u90ae\u7bb1 #\u65b0\u5efa\u65e5\u5fd7\u6587\u4ef6 touch $LogFile #\u8ffd\u52a0\u65e5\u5fd7\u5230\u65e5\u5fd7\u6587\u4ef6 echo \"Gitlab auto backup to remote server, start at $(date +\"%Y-%m-%d %H:%M:%S\")\" > $LogFile echo \"---------------------------------------------------------------------------\" >> $LogFile # \u67e5\u627e \u672c\u5730\u5907\u4efd\u76ee\u5f55\u4e0b \u65f6\u95f4\u4e3a180\u5206\u949f\u4e4b\u5185\u7684\uff0c\u5e76\u4e14\u540e\u7f00\u4e3a.tar\u7684gitlab\u5907\u4efd\u6587\u4ef6 BACKUPFILE_SEND_TO_REMOTE=$(find /data/gitlabData/backups -type f -mmin -180 -name '*.tar*') # \u8f93\u51fa\u65e5\u5fd7\uff0c\u6253\u5370\u51fa\u6bcf\u6b21scp\u7684\u6587\u4ef6\u540d echo \"---------------------The file to scp to remote server is: $BACKUPFILE_SEND_TO_REMOTE-------------------------------\" >> $LogFile #\u5907\u4efd\u5230 \u8fdc\u7a0b\u673a\u623f\u4ee3\u7801\u5907\u4efd\u670d\u52a1\u5668 scp -v $BACKUPFILE_SEND_TO_REMOTE $RemoteUser@$RemoteIP1:$RemoteBackDir # $?\u7b26\u53f7\u663e\u793a\u4e0a\u4e00\u6761\u547d\u4ee4\u7684\u8fd4\u56de\u503c\uff0c\u5982\u679c\u4e3a0\u5219\u4ee3\u8868\u6267\u884c\u6210\u529f\uff0c\u5176\u4ed6\u8868\u793a\u5931\u8d25 if [ $? -eq 0 ];then #\u8ffd\u52a0\u65e5\u5fd7\u5230\u65e5\u5fd7\u6587\u4ef6 echo \"-----------------------------------Success!----------------------------------------\" >> $LogFile echo \"Gitlab auto backup to remote server, end at $(date +\"%Y-%m-%d %H:%M:%S\")\" >> $LogFile #\u5199Email\u7684\u6b63\u6587\u5185\u5bb9 > \"$mailcontent\" echo \"GitLab Backup Daily Report, backup to remote server Success ! Please Check your Email and read the following log file\" >> $mailcontent #\u8bfb\u53d6mailcontent\u5185\u5bb9\u5f53\u505a\u90ae\u4ef6\u6b63\u6587 \uff0c\u9644\u4ef6\u4e3aLog\u6587\u4ef6 #cat $mailcontent | mail -s \"Congratulation! GitLab backup to remote server Success Report.\" -t $mailToUser $mailToUser1 $mailToUser2 -A $LogFile #\u6210\u529f\u7684\u8bdd\uff0c\u53ea\u53d1\u9001\u7ed9\u6211\u4e00\u4e2a\u4eba\u5373\u53ef\uff0c\u4e0d\u9700\u8981\u53d1\u9001\u7ed9\u5176\u4ed6\u4eba cat $mailcontent | mail -s \"Congratulation! GitLab backup to remote server Success Report.\" $mailToUser -A $LogFile else #\u8ffd\u52a0\u65e5\u5fd7\u5230\u65e5\u5fd7\u6587\u4ef6 echo \"-----------------------------------Failed!---------------------------------------\" >> $LogFile echo \"Gitlab auto backup to remote server failed at $(date +\"%Y-%m-%d %H:%M:%S\")\" >> $LogFile #\u5199Email\u7684\u6b63\u6587\u5185\u5bb9 > \"$mailcontent\" echo \"GitLab Backup Daily Report,Backup to remote server Failed ! Please Check your Email and read the following log file !\" >> $mailcontent #\u8bfb\u53d6mailcontent\u5185\u5bb9\u5f53\u505a\u90ae\u4ef6\u6b63\u6587 \uff0c\u9644\u4ef6\u4e3aLog\u6587\u4ef6 cat $mailcontent | mail -s \"Warning! GitLab Backup to remote server Failed Report.\" -t $mailToUser $mailToUser1 $mailToUser2 -A $LogFile fi auto_backup_to_remote_script.sh*\u6587\u4ef6\u6e90\u4ee3\u7801\u662f #!/bin/bash # gitlab \u673a\u623f\u5907\u4efd\u8def\u5f84 LocalBackDir=/data/gitlabData/backups #\u5f53\u524d\u7cfb\u7edf\u65e5\u671f DATE=`date +\"%Y-%m-%d\"` #Log\u5b58\u653e\u8def\u5f84 LogFile=$LocalBackDir/log/$DATE.log #Script\u547d\u4ee4\u8bb0\u5f55\u7684\u5b58\u653e\u8def\u5f84\u548c\u6587\u4ef6\u540d ScriptLogFile=$LocalBackDir/script_log/$DATE.log ScriptTimeFile=$LocalBackDir/script_log/$DATE.date #\u65b0\u5efa\u65e5\u5fd7\u6587\u4ef6 touch $ScriptLogFile touch $ScriptTimeFile #\u5f00\u59cb\u542f\u52a8script\u8bb0\u5f55\u6574\u4e2a\u8fc7\u7a0b\uff0c\u6267\u884c /data/gitlabData/backups/auto_backup_to_remote.sh \u811a\u672c script -a $ScriptLogFile -c\"/data/gitlabData/backups/auto_backup_to_remote.sh\" \u8fd9\u6837\u5c31\u53ef\u4ee5\u4e86\uff0c\u7136\u540e\u5c06\u539f\u6765\u7684\u5b9a\u65f6\u4efb\u52a1\u6267\u884c\u7684\u811a\u672c\u6587\u4ef6\u4fee\u6539\u4e0b\u5373\u53ef\u3002 crontab -e # edited by summer 2019-01-23 \u6dfb\u52a0\u5b9a\u65f6\u4efb\u52a1\uff0c\u6bcf\u5929\u51cc\u66681\u70b9\uff0c\u6267\u884cgitlab\u5907\u4efd\u5230\u8fdc\u7a0b\u670d\u52a1\u5668 0 1 * * * /bin/bash /scripts/gitlab/auto_backup_to_remote_script.sh","title":"3.1 \u6848\u4f8b1 \u5b9a\u65f6\u5907\u4efd"},{"location":"tools/script_scriptreplay/1.index/#32-2","text":"\u76f4\u63a5\u64cd\u4f5c\u7ebf\u4e0a\u7684\u670d\u52a1\u5668\u6709\u5f88\u5927\u9690\u60a3\uff0c\u6240\u4ee5\u4e00\u822c\u90fd\u662f\u901a\u8fc7\u767b\u5f55\u8df3\u677f\u673a\uff0c\u7136\u540e\u8fde\u63a5\u7ebf\u4e0a\u670d\u52a1\u5668\uff0c\u8df3\u677f\u673a\u53ef\u4ee5\u8bbf\u95ee\u63a7\u5236\u548c\u5b89\u5168\u5ba1\u8ba1\uff0c\u67e5\u770b\u8bb0\u5f55\u6bcf\u4e2a\u4eba\u5bf9\u7ebf\u4e0a\u670d\u52a1\u5668\u7684\u64cd\u4f5c \u7528\u6237\u5bb6\u76ee\u5f55\u4e0b,\u4fee\u6539\u73af\u5883\u53d8\u91cf\uff0c\u4f7f\u5f97\u7528\u6237\u767b\u5f55\u5c31\u4f1a\u89e6\u53d1\u5f55\u50cf root@leco:/datas/commands# tail -1 /etc/profile script -t -f -q 2>/datas/commands/$USER-$UID-`date +%Y%m%d%H%M%S`.time -a /datas/commands/$USER-$UID-`date +%Y%m%d%H%M%S`.his root@leco:/datas/commands# chmod 777 /datas/commands/ root@leco:/datas/commands# ls root@leco:/datas/commands# \u6b64\u65f6\u8fd8\u6ca1\u6709\u65e5\u5fd7\uff0c\u63a5\u4e0b\u6765\uff0c\u91cd\u65b0\u767b\u5f55\u7528\u6237 \u6d4b\u8bd5\u767b\u5f55 \u65b0\u5f00\u4e00\u4e2a\u7ec8\u7aef *** \u9700\u8981\u91cd\u542f\u7cfb\u7edf *** Last login: Wed Jan 23 11:03:09 2019 from 192.168.5.1 leco@leco:~$ ip a|grep 192.168.5. inet 192.168.5.110/24 brd 192.168.5.255 scope global enp3s0 leco@leco:~$ echo 'hello' hello \u5728\u770b\u4fdd\u5b58\u7684\u6587\u4ef6 leco@leco:~$ root@leco:/datas/commands# ls leco-1000-20190123110350.his leco-1000-20190123110350.time # 1. \u5355\u72ec\u67e5\u770b \u547d\u4ee4\u5386\u53f2 root@leco:/datas/commands# cat leco-1000-20190123110350.his \u811a\u672c\u542f\u52a8\u4e8e 2019\u5e7401\u670823\u65e5 \u661f\u671f\u4e09 11\u65f603\u520650\u79d2 leco@leco:~$ ip a|grep 192.168.5. inet 192.168.5.110/24 brd 192.168.5.255 scope global enp3s0 leco@leco:~$ echo 'hello' hello # \u67e5\u770b\u52a8\u6001\u5386\u53f2 root@leco:/datas/commands# scriptreplay leco-1000-20190123110350.time leco-1000-20190123110350.his leco@leco:~$ ip a|grep 192.168.5. inet 192.168.5.110/24 brd 192.168.5.255 scope global enp3s0 leco@leco:~$ echo 'hello' hello leco@leco:~$ \u81ea\u5df1\u64cd\u4f5c\uff0c\u67e5\u770b\u6548\u679c \u8fd9\u6837\u641e\u5b8c\u540e\uff0c\u53d1\u73b0\u6709\u4e00\u4e2a\u95ee\u9898\u662f\u6bcf\u6b21\u9000\u51fa\uff0c\u6211\u4e60\u60efCtrl+D\uff0c\u7136\u540e\u6309\u7b2c\u4e00\u904d\u505c\u6b62\u5f55\u50cf\uff0c\u7b2c\u4e8c\u904d\u624d\u80fd\u7528\u6237\u9000\u51fa\uff0c\u5982\u4f55\u89e3\u51b3\u5728\u540e\u9762\u6dfb\u52a0 if [ \"$SHLVL\" = 1 ]; then \u3000\u3000\u3000\u3000exit fi \u5b8c\u6574\u7248 root@leco:/datas/commands# tail -4 /etc/profile script -t -f -q 2>/datas/commands/$USER-$UID-`date +%Y%m%d%H%M%S`.time -a /datas/commands/$USER-$UID-`date +%Y%m%d%H%M%S`.his if [ \"$SHLVL\" = 1 ]; then exit fi \u8fd9\u6837\u5c31\u53ef\u4ee5\u4e00\u904dCtrl+D\u505c\u6b62\u5f55\u50cf\u548c\u9000\u51fa\u7528\u6237\u3002 \u533a\u522b SHLVL \u8fd9\u4e2a\u53d8\u91cf\u662f\u5e72\u4ec0\u4e48\u7684\uff1f shell\u4e2d\u7684 $SHLVL ,\u8bb0\u5f55\u5f53\u524dshell\u7684\u5d4c\u5957\u5c42\u6b21\uff0c\u521d\u59cb\u4e3a1 \u6bd4\u5982\u4e0b\u9762\u7684\u4f8b\u5b50\uff1a\u5f53\u524d\u662f\u5728\u7b2c1\u5c42\uff0c\u6267\u884cbash\u547d\u4ee4\u4e4b\u540e\uff0c $SHLVL \u53d8\u91cf\u53d8\u4e3a2 root@leco:/datas/commands# echo $SHLVL 1 root@leco:/datas/commands# bash root@leco:/datas/commands# echo $SHLVL 2 root@leco:/datas/commands# exit exit root@leco:/datas/commands# echo $SHLVL 1 \u4e0d\u77e5\u9053\u7684\u8bdd\uff0c\u53bb\u767e\u5ea6 SHLVL \u548c BASH_SUBSHELL \u4e24\u4e2a\u53d8\u91cf\u7684\u533a\u522b SHLVL \u548c BASH_SUBSHELL \u4e24\u4e2a\u53d8\u91cf\u7684\u533a\u522b\u53c2\u8003\u94fe\u63a5","title":"3.2 \u6848\u4f8b2 \u670d\u52a1\u5668\u5b89\u5168\u5ba1\u8ba1"},{"location":"tools/sshpass/sshpass.index/","text":"sshpass 1. \u8d77\u56e0 \u00b6 \u5728\u67d0\u4e91\u5e73\u53f0\u521b\u5efa\u4e91\u670d\u52a1\u5668\u540e\uff0c\u751f\u6210\u4e86\u5de8\u957f\u3001\u5de8\u590d\u6742\u7684\u4e00\u4e32\u5bc6\u7801\uff0c\u5728\u8f93\u5165\u51e0\u5341\u6b21\u5bc6\u7801\u540e\uff0c\u4f9d\u7136\u662f\u5bc6\u7801\u9519\u8bef\u3002\u8fd9\u65f6\u5019\u5c31\u60f3\u5982\u679c\u5bc6\u7801\u662f\u975e\u4ea4\u4e92\u5f0f\u8f93\u5165\uff0c\u53ef\u4ee5\u5c06\u5bc6\u7801\u505a\u4e3a\u53c2\u6570\u6216\u4ece\u6587\u4ef6\u8f93\u5165\u5c31\u592a\u597d\u4e86\u3002sshpass\u5c31\u662f\u4e00\u6b3e\u5bc6\u7801\u8f93\u5165\u8f85\u52a9\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u4ece\u547d\u4ee4\u884c\u660e\u6587\u53c2\u6570\u3001\u6587\u4ef6\u6216\u73af\u5883\u53d8\u91cf\u4e2d\u6307\u5b9a\u5bc6\u7801\uff0c\u4ece\u800c\u907f\u514d\u4ea4\u4e92\u5f0f\u5bc6\u7801\u8f93\u5165\u3002 2. \u90e8\u7f72 \u00b6 2.1 \u5728\u7ebf\u88c5 \u00b6 # ubuntu root@leco:~# apt-get install sshpass -y # centos root@leco:~# yum install sshpass -y # mac brew install sshpass 2.2 \u79bb\u7ebf\u5b89\u88c5 \u00b6 \u200b \u82e5\u662f\u6ca1\u6709\u7f51\u7edc\u7684\u673a\u5668\uff0c\u53ef\u4ee5\u9009\u62e9\u79bb\u7ebf\u5b89\u88c5\u3002 https://sourceforge.net/projects/sshpass/ \u4e0b\u8f7d\u540e\u89e3\u7801\u538b\uff0c\u7136\u540e\u8fdb\u5165\u6e90\u7801\u76ee\u5f55\uff1a tar -zxvf sshpass-1.06.tar.gz cd sshpass-1.06 ./configure make &&make install \u8be6\u7ec6\u64cd\u4f5c [root@207_syslog src]# ls sshpass_1.06.orig.tar.gz [root@207_syslog src]# tar xf sshpass_1.06.orig.tar.gz [root@207_syslog src]# ls sshpass-1.06 sshpass_1.06.orig.tar.gz [root@207_syslog src]# cd sshpass-1.06/ [root@207_syslog sshpass-1.06]# ls aclocal.m4 compile configure.ac INSTALL Makefile.am NEWS AUTHORS config.h.in COPYING install-sh Makefile.in README ChangeLog configure depcomp main.c missing sshpass.1 [root@207_syslog sshpass-1.06]# ./configure [root@207_syslog sshpass-1.06]# make && make install 3. \u57fa\u672c\u53c2\u6570 \u00b6 sshpass\u53c2\u6570 root@leco:~# sshpass Usage: sshpass [-f|-d|-p|-e] [-hV] command parameters -f filename Take password to use from file -d number Use number as file descriptor for getting password -p password Provide password as argument (security unwise) -e Password is passed as env-var \"SSHPASS\" With no parameters - password will be taken from stdin -h Show help (this screen) -V Print version information At most one of -f, -d, -p or -e should be used \u5982\u4e0a\u6240\u793a\uff0ccommand parameters\u4e3a\u4f60\u8981\u6267\u884c\u7684\u9700\u8981\u4ea4\u4e92\u5f0f\u8f93\u5165\u5bc6\u7801\u7684\u547d\u4ee4\uff0c\u5982\uff1assh\u3001scp\u7b49\u3002\u5f53sshpass\u6ca1\u6709\u6307\u5b9a\u53c2\u6570\u65f6\u4f1a\u4ecestdin\u83b7\u53d6\u5bc6\u7801\uff0c\u51e0\u4e2a\u5bc6\u7801\u8f93\u5165\u76f8\u5173\u53c2\u6570\u5982\u4e0b\uff1a -f filename\uff1a\u4ece\u6587\u4ef6\u4e2d\u83b7\u53d6\u5bc6\u7801 -d number\uff1a \u4f7f\u7528\u6570\u5b57\u4f5c\u4e3a\u83b7\u53d6\u5bc6\u7801\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26 -p password\uff1a\u6307\u5b9a\u660e\u6587\u672c\u5bc6\u7801\u8f93\u5165\uff08\u5b89\u5168\u6027\u8f83\u5dee\uff09 -e\uff1a \u4ece\u73af\u5883\u53d8\u91cfSSHPASS\u83b7\u53d6\u5bc6\u7801 4. \u57fa\u672c\u4f7f\u7528 \u00b6 4.1 \u6587\u4ef6\u65b9\u5f0f \u00b6 [root@207_syslog ~]# sshpass echo \"cmz\" > user.passwd [root@207_syslog ~]# sshpass -f user.passwd ssh root@172.17.9.200 Last login: Wed Dec 7 10:40:13 2016 from 172.17.9.206 4.2 \u73af\u5883\u53d8\u91cf\u65b9\u5f0f \u00b6 [root@207_syslog sshpass-1.06]# export SSHPASS=\"cmz\" [root@207_syslog sshpass-1.06]# sshpass -e ssh root@172.17.9.200 Last login: Wed Dec 7 11:02:34 2016 from 172.17.9.207 4.3 \u5bc6\u7801\u65b9\u5f0f \u00b6 [root@207_syslog sshpass-1.06]# sshpass -p cmz ssh root@172.17.9.200 Last login: Wed Dec 7 11:00:12 2016 from 172.17.9.206 4.4 \u8fdc\u7a0b\u6267\u884c\u547d\u4ee4 \u00b6 [ root@207_syslog sshpass-1.06 ] # sshpass -p cmz ssh root@172.17.9.200 \"ifconfig|grep inet\" inet 172 .17.9.200 netmask 255 .255.255.192 broadcast 172 .17.9.255 inet6 fe80::250:56ff:feb0:710e prefixlen 64 scopeid 0x20<link> inet 127 .0.0.1 netmask 255 .0.0.0 inet6 ::1 prefixlen 128 scopeid 0x10<host> inet 172 .17.9.208 netmask 255 .255.255.255 inet 192 .168.122.1 netmask 255 .255.255.0 broadcast 192 .168.122.255 4.5 \u8fdc\u7a0b\u6267\u884c\u811a\u672c \u00b6 4.5.1 \u8fdc\u7a0b\u65b0\u5efa\u811a\u672c \u00b6 [root@200_tomcat ~]# ll /opt/test.sh -rw-r--r--. 1 root root 61 Dec 7 11:18 /opt/test.sh [root@200_tomcat ~]# cat /opt/test.sh #!/bin/bash echo \"this test for remote\" ifconfig | grep inet 4.5.2 \u672c\u5730\u8fdc\u7a0b\u6267\u884c \u00b6 [root@207_syslog sshpass-1.06]# sshpass -p cmz ssh root@172.17.9.200 \"sh /opt/test.sh\" this test for remote inet 172.17.9.200 netmask 255.255.255.192 broadcast 172.17.9.255 inet6 fe80::250:56ff:feb0:710e prefixlen 64 scopeid 0x20<link> inet 127.0.0.1 netmask 255.0.0.0 inet6 ::1 prefixlen 128 scopeid 0x10<host> inet 172.17.9.208 netmask 255.255.255.255 inet 192.168.122.1 netmask 255.255.255.0 broadcast 192.168.122.255 \u6b64\u65f6\u8bf4\u660e\uff0c\u5df2\u7ecf\u6267\u884c\u4e86\u8fdc\u7aef\u7a0b\u5e8f\u3002","title":"1. sshpass"},{"location":"tools/sshpass/sshpass.index/#1","text":"\u5728\u67d0\u4e91\u5e73\u53f0\u521b\u5efa\u4e91\u670d\u52a1\u5668\u540e\uff0c\u751f\u6210\u4e86\u5de8\u957f\u3001\u5de8\u590d\u6742\u7684\u4e00\u4e32\u5bc6\u7801\uff0c\u5728\u8f93\u5165\u51e0\u5341\u6b21\u5bc6\u7801\u540e\uff0c\u4f9d\u7136\u662f\u5bc6\u7801\u9519\u8bef\u3002\u8fd9\u65f6\u5019\u5c31\u60f3\u5982\u679c\u5bc6\u7801\u662f\u975e\u4ea4\u4e92\u5f0f\u8f93\u5165\uff0c\u53ef\u4ee5\u5c06\u5bc6\u7801\u505a\u4e3a\u53c2\u6570\u6216\u4ece\u6587\u4ef6\u8f93\u5165\u5c31\u592a\u597d\u4e86\u3002sshpass\u5c31\u662f\u4e00\u6b3e\u5bc6\u7801\u8f93\u5165\u8f85\u52a9\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u4ece\u547d\u4ee4\u884c\u660e\u6587\u53c2\u6570\u3001\u6587\u4ef6\u6216\u73af\u5883\u53d8\u91cf\u4e2d\u6307\u5b9a\u5bc6\u7801\uff0c\u4ece\u800c\u907f\u514d\u4ea4\u4e92\u5f0f\u5bc6\u7801\u8f93\u5165\u3002","title":"1. \u8d77\u56e0"},{"location":"tools/sshpass/sshpass.index/#2","text":"","title":"2. \u90e8\u7f72"},{"location":"tools/sshpass/sshpass.index/#21","text":"# ubuntu root@leco:~# apt-get install sshpass -y # centos root@leco:~# yum install sshpass -y # mac brew install sshpass","title":"2.1 \u5728\u7ebf\u88c5"},{"location":"tools/sshpass/sshpass.index/#22","text":"\u200b \u82e5\u662f\u6ca1\u6709\u7f51\u7edc\u7684\u673a\u5668\uff0c\u53ef\u4ee5\u9009\u62e9\u79bb\u7ebf\u5b89\u88c5\u3002 https://sourceforge.net/projects/sshpass/ \u4e0b\u8f7d\u540e\u89e3\u7801\u538b\uff0c\u7136\u540e\u8fdb\u5165\u6e90\u7801\u76ee\u5f55\uff1a tar -zxvf sshpass-1.06.tar.gz cd sshpass-1.06 ./configure make &&make install \u8be6\u7ec6\u64cd\u4f5c [root@207_syslog src]# ls sshpass_1.06.orig.tar.gz [root@207_syslog src]# tar xf sshpass_1.06.orig.tar.gz [root@207_syslog src]# ls sshpass-1.06 sshpass_1.06.orig.tar.gz [root@207_syslog src]# cd sshpass-1.06/ [root@207_syslog sshpass-1.06]# ls aclocal.m4 compile configure.ac INSTALL Makefile.am NEWS AUTHORS config.h.in COPYING install-sh Makefile.in README ChangeLog configure depcomp main.c missing sshpass.1 [root@207_syslog sshpass-1.06]# ./configure [root@207_syslog sshpass-1.06]# make && make install","title":"2.2 \u79bb\u7ebf\u5b89\u88c5"},{"location":"tools/sshpass/sshpass.index/#3","text":"sshpass\u53c2\u6570 root@leco:~# sshpass Usage: sshpass [-f|-d|-p|-e] [-hV] command parameters -f filename Take password to use from file -d number Use number as file descriptor for getting password -p password Provide password as argument (security unwise) -e Password is passed as env-var \"SSHPASS\" With no parameters - password will be taken from stdin -h Show help (this screen) -V Print version information At most one of -f, -d, -p or -e should be used \u5982\u4e0a\u6240\u793a\uff0ccommand parameters\u4e3a\u4f60\u8981\u6267\u884c\u7684\u9700\u8981\u4ea4\u4e92\u5f0f\u8f93\u5165\u5bc6\u7801\u7684\u547d\u4ee4\uff0c\u5982\uff1assh\u3001scp\u7b49\u3002\u5f53sshpass\u6ca1\u6709\u6307\u5b9a\u53c2\u6570\u65f6\u4f1a\u4ecestdin\u83b7\u53d6\u5bc6\u7801\uff0c\u51e0\u4e2a\u5bc6\u7801\u8f93\u5165\u76f8\u5173\u53c2\u6570\u5982\u4e0b\uff1a -f filename\uff1a\u4ece\u6587\u4ef6\u4e2d\u83b7\u53d6\u5bc6\u7801 -d number\uff1a \u4f7f\u7528\u6570\u5b57\u4f5c\u4e3a\u83b7\u53d6\u5bc6\u7801\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26 -p password\uff1a\u6307\u5b9a\u660e\u6587\u672c\u5bc6\u7801\u8f93\u5165\uff08\u5b89\u5168\u6027\u8f83\u5dee\uff09 -e\uff1a \u4ece\u73af\u5883\u53d8\u91cfSSHPASS\u83b7\u53d6\u5bc6\u7801","title":"3. \u57fa\u672c\u53c2\u6570"},{"location":"tools/sshpass/sshpass.index/#4","text":"","title":"4. \u57fa\u672c\u4f7f\u7528"},{"location":"tools/sshpass/sshpass.index/#41","text":"[root@207_syslog ~]# sshpass echo \"cmz\" > user.passwd [root@207_syslog ~]# sshpass -f user.passwd ssh root@172.17.9.200 Last login: Wed Dec 7 10:40:13 2016 from 172.17.9.206","title":"4.1 \u6587\u4ef6\u65b9\u5f0f"},{"location":"tools/sshpass/sshpass.index/#42","text":"[root@207_syslog sshpass-1.06]# export SSHPASS=\"cmz\" [root@207_syslog sshpass-1.06]# sshpass -e ssh root@172.17.9.200 Last login: Wed Dec 7 11:02:34 2016 from 172.17.9.207","title":"4.2 \u73af\u5883\u53d8\u91cf\u65b9\u5f0f"},{"location":"tools/sshpass/sshpass.index/#43","text":"[root@207_syslog sshpass-1.06]# sshpass -p cmz ssh root@172.17.9.200 Last login: Wed Dec 7 11:00:12 2016 from 172.17.9.206","title":"4.3 \u5bc6\u7801\u65b9\u5f0f"},{"location":"tools/sshpass/sshpass.index/#44","text":"[ root@207_syslog sshpass-1.06 ] # sshpass -p cmz ssh root@172.17.9.200 \"ifconfig|grep inet\" inet 172 .17.9.200 netmask 255 .255.255.192 broadcast 172 .17.9.255 inet6 fe80::250:56ff:feb0:710e prefixlen 64 scopeid 0x20<link> inet 127 .0.0.1 netmask 255 .0.0.0 inet6 ::1 prefixlen 128 scopeid 0x10<host> inet 172 .17.9.208 netmask 255 .255.255.255 inet 192 .168.122.1 netmask 255 .255.255.0 broadcast 192 .168.122.255","title":"4.4 \u8fdc\u7a0b\u6267\u884c\u547d\u4ee4"},{"location":"tools/sshpass/sshpass.index/#45","text":"","title":"4.5 \u8fdc\u7a0b\u6267\u884c\u811a\u672c"},{"location":"tools/sshpass/sshpass.index/#451","text":"[root@200_tomcat ~]# ll /opt/test.sh -rw-r--r--. 1 root root 61 Dec 7 11:18 /opt/test.sh [root@200_tomcat ~]# cat /opt/test.sh #!/bin/bash echo \"this test for remote\" ifconfig | grep inet","title":"4.5.1 \u8fdc\u7a0b\u65b0\u5efa\u811a\u672c"},{"location":"tools/sshpass/sshpass.index/#452","text":"[root@207_syslog sshpass-1.06]# sshpass -p cmz ssh root@172.17.9.200 \"sh /opt/test.sh\" this test for remote inet 172.17.9.200 netmask 255.255.255.192 broadcast 172.17.9.255 inet6 fe80::250:56ff:feb0:710e prefixlen 64 scopeid 0x20<link> inet 127.0.0.1 netmask 255.0.0.0 inet6 ::1 prefixlen 128 scopeid 0x10<host> inet 172.17.9.208 netmask 255.255.255.255 inet 192.168.122.1 netmask 255.255.255.0 broadcast 192.168.122.255 \u6b64\u65f6\u8bf4\u660e\uff0c\u5df2\u7ecf\u6267\u884c\u4e86\u8fdc\u7aef\u7a0b\u5e8f\u3002","title":"4.5.2 \u672c\u5730\u8fdc\u7a0b\u6267\u884c"},{"location":"tools/xshell/xshell.index/","text":"XSHELL \u914d\u7f6e\u8fc1\u79fb 1. \u8d77\u56e0 \u00b6 xshell \u91cd\u65b0\u5b89\u88c5\u7684\u65f6\u5019\uff0c\u6216\u8005\u5728\u522b\u7684\u673a\u5668\u4e0a\u5b89\u88c5\u65b0\u7684xshell\u7684\u65f6\u5019\uff0c\u90a3\u4e48\u600e\u4e48\u8fc1\u79fb\u4e00\u53f0\u673a\u5668\u7684\u914d\u7f6e\u7684\u6570\u636e\u5230\u53e6\u4e00\u4e2a\u673a\u5668\u4e0a\u5462\uff1f \u672c\u6587\u662f\u8be6\u7ec6\u8bb0\u5f55\u5c06\u4e00\u4e2a\u673a\u5668\u4e0a\u914d\u7f6e\u597d\u7684xshell\u7684\u6240\u6709\u914d\u7f6e\u53c2\u6570\uff0c\u5bfc\u5165\u5230\u65b0\u5b89\u88c5\u7684xshell\u673a\u5668\u4e0a\u3002 2. xshell\u5feb\u901f\u547d\u4ee4\u6570\u636e\u5bfc\u51fa \u00b6 2.1 \u6570\u636e\u5bfc\u51fa \u00b6 \u8fc1\u79fb\u4f1a\u8bdd\uff08\u5f53\u524d\u670d\u52a1\u5668\u4e3b\u673a\u914d\u7f6e\uff09\uff0c\u5f53\u524d\u670d\u52a1\u5668\u914d\u7f6e\u5bfc\u51fa \u6587\u4ef6--\u300b\u5bfc\u51fa--\u300b\u4e0b\u4e00\u6b65 2.2 \u6570\u636e\u5bfc\u5165 \u00b6 \u65b0\u7684\u670d\u52a1\u5668\u914d\u5bfc\u5165\u4e0a\u9762\u5907\u4efd\u7684\u6570\u636e\u3002 \u6587\u4ef6--\u300b\u5bfc\u5165--\u300b\u9009\u62e9\u5bfc\u5165\u7684.xts\u6587\u4ef6(\u4e4b\u524d\u5bfc\u51fa\u7684\u6570\u636e) 3. xshell\u670d\u52a1\u5668\u6570\u636e\u5bfc\u51fa \u00b6 3.1 \u6570\u636e\u5bfc\u51fa \u00b6 \u5de5\u5177--\u300b\u5feb\u901f\u547d\u4ee4\u96c6--\u300b\u9009\u62e9\u5f53\u524d\u7684\u7ec4\u5bfc\u51fa 3.2 \u6570\u636e\u5bfc\u5165 \u00b6 \u65b0\u7684\u670d\u52a1\u5668\u914d\u5bfc\u5165\u4e0a\u9762\u5907\u4efd\u7684\u6570\u636e\u3002 \u5de5\u5177--\u300b\u5feb\u901f\u547d\u4ee4\u96c6--\u300b \u5f00\u5173\u5feb\u901f\u547d\u4ee4\u7a97\u53e3 \u4e0b\u9762\u672c\u6765\u662f\u6ca1\u6709\u5feb\u901f\u547d\u4ee4\u7a97\u53e3\u7684\uff0c\u5f00\u542f\u540e\u5c31\u6709\u4e86","title":"1. xshell\u8fc1\u79fb\u6570\u636e"},{"location":"tools/xshell/xshell.index/#1","text":"xshell \u91cd\u65b0\u5b89\u88c5\u7684\u65f6\u5019\uff0c\u6216\u8005\u5728\u522b\u7684\u673a\u5668\u4e0a\u5b89\u88c5\u65b0\u7684xshell\u7684\u65f6\u5019\uff0c\u90a3\u4e48\u600e\u4e48\u8fc1\u79fb\u4e00\u53f0\u673a\u5668\u7684\u914d\u7f6e\u7684\u6570\u636e\u5230\u53e6\u4e00\u4e2a\u673a\u5668\u4e0a\u5462\uff1f \u672c\u6587\u662f\u8be6\u7ec6\u8bb0\u5f55\u5c06\u4e00\u4e2a\u673a\u5668\u4e0a\u914d\u7f6e\u597d\u7684xshell\u7684\u6240\u6709\u914d\u7f6e\u53c2\u6570\uff0c\u5bfc\u5165\u5230\u65b0\u5b89\u88c5\u7684xshell\u673a\u5668\u4e0a\u3002","title":"1. \u8d77\u56e0"},{"location":"tools/xshell/xshell.index/#2-xshell","text":"","title":"2. xshell\u5feb\u901f\u547d\u4ee4\u6570\u636e\u5bfc\u51fa"},{"location":"tools/xshell/xshell.index/#21","text":"\u8fc1\u79fb\u4f1a\u8bdd\uff08\u5f53\u524d\u670d\u52a1\u5668\u4e3b\u673a\u914d\u7f6e\uff09\uff0c\u5f53\u524d\u670d\u52a1\u5668\u914d\u7f6e\u5bfc\u51fa \u6587\u4ef6--\u300b\u5bfc\u51fa--\u300b\u4e0b\u4e00\u6b65","title":"2.1 \u6570\u636e\u5bfc\u51fa"},{"location":"tools/xshell/xshell.index/#22","text":"\u65b0\u7684\u670d\u52a1\u5668\u914d\u5bfc\u5165\u4e0a\u9762\u5907\u4efd\u7684\u6570\u636e\u3002 \u6587\u4ef6--\u300b\u5bfc\u5165--\u300b\u9009\u62e9\u5bfc\u5165\u7684.xts\u6587\u4ef6(\u4e4b\u524d\u5bfc\u51fa\u7684\u6570\u636e)","title":"2.2 \u6570\u636e\u5bfc\u5165"},{"location":"tools/xshell/xshell.index/#3-xshell","text":"","title":"3. xshell\u670d\u52a1\u5668\u6570\u636e\u5bfc\u51fa"},{"location":"tools/xshell/xshell.index/#31","text":"\u5de5\u5177--\u300b\u5feb\u901f\u547d\u4ee4\u96c6--\u300b\u9009\u62e9\u5f53\u524d\u7684\u7ec4\u5bfc\u51fa","title":"3.1 \u6570\u636e\u5bfc\u51fa"},{"location":"tools/xshell/xshell.index/#32","text":"\u65b0\u7684\u670d\u52a1\u5668\u914d\u5bfc\u5165\u4e0a\u9762\u5907\u4efd\u7684\u6570\u636e\u3002 \u5de5\u5177--\u300b\u5feb\u901f\u547d\u4ee4\u96c6--\u300b \u5f00\u5173\u5feb\u901f\u547d\u4ee4\u7a97\u53e3 \u4e0b\u9762\u672c\u6765\u662f\u6ca1\u6709\u5feb\u901f\u547d\u4ee4\u7a97\u53e3\u7684\uff0c\u5f00\u542f\u540e\u5c31\u6709\u4e86","title":"3.2 \u6570\u636e\u5bfc\u5165"},{"location":"tools/xshell/xshell.silent/","text":"xshell \u53bb\u9664\u58f0\u97f3 1. \u4ecb\u7ecd \u00b6 \u65b0\u5b89\u88c5\u7684xshell\u4f1a\u6709\u9ed8\u8ba4\u7684\u58f0\u97f3\uff0c\u5bf9\u4e8e\u6211\u8fd9\u6837\u7ecf\u5e38\u4f7f\u7528xshell\u7684\u4eba\u6765\u8bf4\u8fd9\u58f0\u97f3\u5bf9\u6211\u6765\u8bf4\u7684\u786e\u5f88\u7279\u70e6\u3002\u52a8\u4e0d\u52a8\u7684\u5c31\u6765\u4e2a\u58f0\u97f3\u3002\u4e0b\u9762\u8bb0\u5f55\uff0c\u6211\u5f7b\u5e95\u5173\u95edxshell\u58f0\u97f3\u7684\u6b65\u9aa4\u3002xshell5\u548cxshell6\u3002\u5730\u65b9\u4e0d\u4e00\u6837\u3002 2. xshell5 \u00b6 \u5de5\u5177 \u2192 \u9009\u9879 \u2192 \u9ad8\u7ea7 \u2192 \u7981\u7528\u94c3\u58f0 \u5728\u7981\u7528\u94c3\u58f0\u524d\u9762\u6253\u94a9\uff0c\u9009\u62e9\u8be5\u9879\uff0c\u53bb\u6389\u9ed8\u8ba4\u7684\u58f0\u97f3\u3002 3. xshell6 \u00b6 \u6587\u4ef6 \u2192 \u5c5e\u6027 \u2192 \u9ad8\u7ea7 \u2192 \u949f \u2192 \u9009\u9879 \u2192 \u65e0[\u5ffd\u7565\u94c3\u8bf7\u6c42] \u5728\u65e0[\u5ffd\u7565\u94c3\u8bf7\u6c42]\u524d\u9762\u6253\u94a9\uff0c\u9009\u62e9\u8be5\u9879\uff0c\u53bb\u6389\u9ed8\u8ba4\u7684\u58f0\u97f3\u3002","title":"2. xshell\u65e0\u58f0\u914d\u7f6e"},{"location":"tools/xshell/xshell.silent/#1","text":"\u65b0\u5b89\u88c5\u7684xshell\u4f1a\u6709\u9ed8\u8ba4\u7684\u58f0\u97f3\uff0c\u5bf9\u4e8e\u6211\u8fd9\u6837\u7ecf\u5e38\u4f7f\u7528xshell\u7684\u4eba\u6765\u8bf4\u8fd9\u58f0\u97f3\u5bf9\u6211\u6765\u8bf4\u7684\u786e\u5f88\u7279\u70e6\u3002\u52a8\u4e0d\u52a8\u7684\u5c31\u6765\u4e2a\u58f0\u97f3\u3002\u4e0b\u9762\u8bb0\u5f55\uff0c\u6211\u5f7b\u5e95\u5173\u95edxshell\u58f0\u97f3\u7684\u6b65\u9aa4\u3002xshell5\u548cxshell6\u3002\u5730\u65b9\u4e0d\u4e00\u6837\u3002","title":"1. \u4ecb\u7ecd"},{"location":"tools/xshell/xshell.silent/#2-xshell5","text":"\u5de5\u5177 \u2192 \u9009\u9879 \u2192 \u9ad8\u7ea7 \u2192 \u7981\u7528\u94c3\u58f0 \u5728\u7981\u7528\u94c3\u58f0\u524d\u9762\u6253\u94a9\uff0c\u9009\u62e9\u8be5\u9879\uff0c\u53bb\u6389\u9ed8\u8ba4\u7684\u58f0\u97f3\u3002","title":"2. xshell5"},{"location":"tools/xshell/xshell.silent/#3-xshell6","text":"\u6587\u4ef6 \u2192 \u5c5e\u6027 \u2192 \u9ad8\u7ea7 \u2192 \u949f \u2192 \u9009\u9879 \u2192 \u65e0[\u5ffd\u7565\u94c3\u8bf7\u6c42] \u5728\u65e0[\u5ffd\u7565\u94c3\u8bf7\u6c42]\u524d\u9762\u6253\u94a9\uff0c\u9009\u62e9\u8be5\u9879\uff0c\u53bb\u6389\u9ed8\u8ba4\u7684\u58f0\u97f3\u3002","title":"3. xshell6"},{"location":"url/url.index/","text":"URL 1. \u56fe\u6807\u7f51\u7ad9 \u00b6 http://fontawesome.dashgame.com/","title":"url"},{"location":"url/url.index/#1","text":"http://fontawesome.dashgame.com/","title":"1. \u56fe\u6807\u7f51\u7ad9"}]}